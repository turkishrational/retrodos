     1                                  ;
     2                                  ; +-------------------------------------------------------------------------+
     3                                  ; |   This file	has been generated by The Interactive Disassembler (IDA)    |
     4                                  ; |	      Copyright	(c) 2013 Hex-Rays, <support@hex-rays.com>	    |
     5                                  ; |			 Licensed to: Freeware version			    |
     6                                  ; +-------------------------------------------------------------------------+
     7                                  ;
     8                                  ; MSDOS 6.22 (original) Kernel
     9                                  ; NASM conversion: Erdogan Tan - 26/09/2023 (Last Update: 27/09/2023)
    10                                  ;
    11                                  ; (nasm msdos622.asm -l msdos622.lst -o MSDOS.SYS -Z error.txt)
    12                                  
    13                                  ; ---------------------------------------------------------------------------
    14                                  ; File Name   :	C:\retrodos4\MSDOS622.SYS
    15                                  ; Format      :	Binary file
    16                                  ; Base Address:	0000h Range: 0000h - 94FAh Loaded length: 94FAh
    17                                  ; ===========================================================================
    18                                  
    19                                  ; ----------------------------------------------------------------------------
    20                                  segment DOSCODE vstart=3DE0h
    21                                  ; ----------------------------------------------------------------------------
    22                                  
    23                                  		[org 3DE0h]
    24                                  $STARTCODE:
    25 00000000 E9747C                  		jmp	DOSINIT
    26                                  ; ---------------------------------------------------------------------------
    27 00000003 [0000]                  		dw $STARTCODE
    28 00000005 7000                    BioDataSeg:	dw 70h
    29 00000007 0000                    DosDSeg:	dw 0			; ...
    30 00000009 06                      MSMAJOR:	db 6
    31 0000000A 16                      MSMINOR:	db 22
    32 0000000B 38020102                I21_MAP_E_TAB:	db 38h,	2, 1, 2		; ...
    33 0000000F 3903030205              		db 39h,	2 dup(3), 2, 5
    34 00000014 3A0410030205            		db 3Ah,	4, 10h,	3, 2, 5
    35 0000001A 3B020203                		db 3Bh,	2 dup(2), 3
    36 0000001E 3C0403020405            		db 3Ch,	4, 3, 2, 4, 5
    37 00000024 3D0603020C041A05        		db 3Dh,	6, 3, 2, 0Ch, 4, 1Ah, 5
    38 0000002C 3E0106                  		db 3Eh,	1, 6
    39 0000002F 3F020605                		db 3Fh,	2, 6, 5
    40 00000033 40020605                		db 40h,	2, 6, 5
    41 00000037 4103030205              		db 41h,	2 dup(3), 2, 5
    42 0000003C 42020601                		db 42h,	2, 6, 1
    43 00000040 430403020105            		db 43h,	4, 3, 2, 1, 5
    44 00000046 44050F0D010605          		db 44h,	5, 0Fh,	0Dh, 1,	6, 5
    45 0000004D 45020604                		db 45h,	2, 6, 4
    46 00000051 46020604                		db 46h,	2, 6, 4
    47 00000055 47021A0F                		db 47h,	2, 1Ah,	0Fh
    48 00000059 48020708                		db 48h,	2, 7, 8
    49 0000005D 49020709                		db 49h,	2, 7, 9
    50 00000061 4A03070908              		db 4Ah,	3, 7, 9, 8
    51 00000066 4B08030102040B0A08-     		db 4Bh,	8, 3, 1, 2, 4, 0Bh, 0Ah, 8, 5
    51 0000006F 05                 
    52 00000070 4E03030212              		db 4Eh,	2 dup(3), 2, 12h
    53 00000075 4F0112                  		db 4Fh,	1, 12h
    54 00000078 56051103021005          		db 56h,	5, 11h,	3, 2, 10h, 5
    55 0000007F 570406080D01            		db 57h,	4, 6, 8, 0Dh, 1
    56 00000085 580101                  		db 58h,	2 dup(1)
    57 00000088 5A0403020405            		db 5Ah,	4, 3, 2, 4, 5
    58 0000008E 5B055003020405          		db 5Bh,	5, 50h,	3, 2, 4, 5
    59 00000095 5C0406012421            		db 5Ch,	4, 6, 1, 24h, 21h
    60 0000009B 65020102                		db 65h,	2, 1, 2
    61 0000009F 66020102                		db 66h,	2, 1, 2
    62 000000A3 680106                  		db 68h,	1, 6
    63 000000A6 6703040801              		db 67h,	3, 4, 8, 1
    64 000000AB 6C0A03020C0450081A-     		db 6Ch,	0Ah, 3,	2, 0Ch,	4, 50h,	8, 1Ah,	0Dh, 1,	5
    64 000000B4 0D0105             
    65 000000B7 69040F0D0105            		db 69h,	4, 0Fh,	0Dh, 1,	5
    66 000000BD FF                      		db 0FFh
    67 000000BE [1764]                  DISPATCH:	dw $ABORT	; ...
    68 000000C0 [0017]                  		dw $STD_CON_INPUT
    69 000000C2 [0917]                  		dw $STD_CON_OUTPUT
    70 000000C4 [BF17]                  		dw $STD_AUX_INPUT
    71 000000C6 [DC17]                  		dw $STD_AUX_OUTPUT
    72 000000C8 [E217]                  		dw $STD_PRINTER_OUTPUT
    73 000000CA [3C16]                  		dw $RAW_CON_IO
    74 000000CC [6B16]                  		dw $RAW_CON_INPUT
    75 000000CE [DA13]                  		dw $STD_CON_INPUT_NO_ECHO
    76 000000D0 [3414]                  		dw $STD_CON_STRING_OUTPUT
    77 000000D2 [4014]                  		dw $STD_CON_STRING_INPUT
    78 000000D4 [F617]                  		dw $STD_CON_INPUT_STATUS
    79 000000D6 [0018]                  		dw $STD_CON_INPUT_FLUSH
    80 000000D8 [C10F]                  		dw $DISK_RESET
    81 000000DA [980E]                  		dw $SET_DEFAULT_DRIVE
    82 000000DC [EC1E]                  		dw $FCB_OPEN
    83 000000DE [A818]                  		dw $FCB_CLOSE
    84 000000E0 [FF1F]                  		dw $DIR_SEARCH_FIRST
    85 000000E2 [9320]                  		dw $DIR_SEARCH_NEXT
    86 000000E4 [4518]                  		dw $FCB_DELETE
    87 000000E6 [EB1F]                  		dw $FCB_SEQ_READ
    88 000000E8 [F01F]                  		dw $FCB_SEQ_WRITE
    89 000000EA [D11F]                  		dw $FCB_CREATE
    90 000000EC [1919]                  		dw $FCB_RENAME
    91 000000EE [2D06]                  		dw NO_OP
    92 000000F0 [930E]                  		dw $GET_DEFAULT_DRIVE
    93 000000F2 [880E]                  		dw $SET_DMA
    94 000000F4 [4D0F]                  		dw $SLEAZEFUNC
    95 000000F6 [4F0F]                  		dw $SLEAZEFUNCDL
    96 000000F8 [2D06]                  		dw NO_OP
    97 000000FA [2D06]                  		dw NO_OP
    98 000000FC [910F]                  		dw $GET_DEFAULT_DPB
    99 000000FE [2D06]                  		dw NO_OP
   100 00000100 [F51F]                  		dw $FCB_RANDOM_READ
   101 00000102 [FA1F]                  		dw $FCB_RANDOM_WRITE
   102 00000104 [5918]                  		dw $GET_FCB_FILE_LENGTH
   103 00000106 [2D18]                  		dw $GET_FCB_POSITION
   104 00000108 [BA0E]                  		dw $SET_INTERRUPT_VECTOR
   105 0000010A [D610]                  		dw $CREATE_PROCESS_DATA_BLOCK
   106 0000010C [E61F]                  		dw $FCB_RANDOM_READ_BLOCK
   107 0000010E [E11F]                  		dw $FCB_RANDOM_WRITE_BLOCK
   108 00000110 [420F]                  		dw $PARSE_FILE_DESCRIPTOR
   109 00000112 [590A]                  		dw $GET_DATE
   110 00000114 [760A]                  		dw $SET_DATE
   111 00000116 [960A]                  		dw $GET_TIME
   112 00000118 [A70A]                  		dw $SET_TIME
   113 0000011A [660C]                  		dw $SET_VERIFY_ON_WRITE
   114 0000011C [740E]                  		dw $GET_DMA
   115 0000011E [3C0C]                  		dw $GET_VERSION
   116 00000120 [BB63]                  		dw $KEEP_PROCESS
   117 00000122 [930F]                  		dw $GET_DPB
   118 00000124 [7202]                  		dw $SET_CTRL_C_TRAPPING
   119 00000126 [790F]                  		dw $GET_INDOS_FLAG
   120 00000128 [AA0E]                  		dw $GET_INTERRUPT_VECTOR
   121 0000012A [4B0E]                  		dw $GET_DRIVE_FREESPACE
   122 0000012C [E90E]                  		dw $CHAR_OPER
   123 0000012E [6D0C]                  		dw $INTERNATIONAL
   124 00000130 [0123]                  		dw $MKDIR
   125 00000132 [4922]                  		dw $RMDIR
   126 00000134 [8522]                  		dw $CHDIR
   127 00000136 [0772]                  		dw $CREAT
   128 00000138 [3071]                  		dw $OPEN
   129 0000013A [4B69]                  		dw $CLOSE
   130 0000013C [5A6A]                  		dw $READ
   131 0000013E [C06A]                  		dw $WRITE
   132 00000140 [5972]                  		dw $UNLINK
   133 00000142 [C56A]                  		dw $LSEEK
   134 00000144 [1472]                  		dw $CHMOD
   135 00000146 [6223]                  		dw $IOCTL
   136 00000148 [7B6B]                  		dw $DUP
   137 0000014A [9B6B]                  		dw $DUP2
   138 0000014C [D021]                  		dw $CURRENT_DIR
   139 0000014E [AE64]                  		dw $ALLOC
   140 00000150 [3366]                  		dw $DEALLOC
   141 00000152 [0F66]                  		dw $SETBLOCK
   142 00000154 [7F5D]                  		dw $EXEC
   143 00000156 [F363]                  		dw $EXIT
   144 00000158 [755D]                  		dw $WAIT
   145 0000015A [0621]                  		dw $FIND_FIRST
   146 0000015C [5E21]                  		dw $FIND_NEXT
   147 0000015E [C902]                  		dw $SET_CURRENT_PDB
   148 00000160 [D502]                  		dw $GET_CURRENT_PDB
   149 00000162 [850F]                  		dw $GET_IN_VARS
   150 00000164 [F60F]                  		dw $SETDPB
   151 00000166 [610C]                  		dw $GET_VERIFY_ON_WRITE
   152 00000168 [C510]                  		dw $DUP_PDB
   153 0000016A [7F72]                  		dw $RENAME
   154 0000016C [2D6B]                  		dw $FILE_TIMES
   155 0000016E [6966]                  		dw $ALLOCOPER
   156 00000170 [FD0E]                  		dw $GetExtendedError
   157 00000172 [0A73]                  		dw $CreateTempFile
   158 00000174 [F272]                  		dw $CreateNewFile
   159 00000176 [F974]                  		dw $LockOper
   160 00000178 [5267]                  		dw $ServerCall
   161 0000017A [6A6C]                  		dw $UserOper
   162 0000017C [CB6B]                  		dw $AssignOper
   163 0000017E [C970]                  		dw $NameTrans
   164 00000180 [2D06]                  		dw NO_OP
   165 00000182 [D502]                  		dw $GET_CURRENT_PDB
   166 00000184 [2A0F]                  		dw $ECS_Call
   167 00000186 [E102]                  		dw $SET_PRINTER_FLAG
   168 00000188 [F80C]                  		dw $GetExtCntry
   169 0000018A [F60D]                  		dw $GetSetCdPg
   170 0000018C [9869]                  		dw $ExtHandle
   171 0000018E [7E69]                  		dw $COMMIT
   172 00000190 [DE11]                  		dw $GSetMediaID
   173 00000192 [7E69]                  		dw $COMMIT
   174 00000194 [2D06]                  		dw NO_OP
   175 00000196 [A473]                  		dw $Extended_Open
   176 00000198 [EA06]                  FOO:		dw Leave2F	; ...
   177 0000019A [9C01]                  DTab:		dw DOSTable	; ...
   178 0000019C 30                      DOSTable:	db 48			; ...
   179 0000019D [2E09]                  		dw DOSInstall
   180 0000019F [4E30]                  		dw DOS_CLOSE
   181 000001A1 [DE0E]                  		dw RECSET
   182 000001A3 [2809]                  		dw DOSGetGroup
   183 000001A5 [8752]                  		dw PATHCHRCMP
   184 000001A7 [0B17]                  		dw OUTT
   185 000001A9 [6355]                  		dw NET_I24_ENTRY
   186 000001AB [0B5B]                  		dw PLACEBUF
   187 000001AD [4F31]                  		dw FREE_SFT
   188 000001AF [C05C]                  		dw BUFWRITE
   189 000001B1 [B075]                  		dw SHARE_VIOLATION
   190 000001B3 [8A2D]                  		dw SHARE_ERROR
   191 000001B5 [732D]                  		dw SET_SFT_MODE
   192 000001B7 [EE0A]                  		dw DATE16
   193 000001B9 [5012]                  		dw Idle
   194 000001BB [045B]                  		dw SCANPLACE
   195 000001BD [5012]                  		dw Idle
   196 000001BF [1912]                  		dw StrCpy
   197 000001C1 [3112]                  		dw StrLen
   198 000001C3 [3252]                  		dw UCase
   199 000001C5 [485B]                  		dw POINTCOMP
   200 000001C7 [975C]                  		dw CHECKFLUSH
   201 000001C9 [C468]                  		dw SFFromSFN
   202 000001CB [336D]                  		dw GetCDSFromDrv
   203 000001CD [A204]                  		dw Get_User_Stack
   204 000001CF [DC6C]                  		dw GETTHISDRV
   205 000001D1 [EE70]                  		dw DriveFromText
   206 000001D3 [980B]                  		dw SETYEAR
   207 000001D5 [320C]                  		dw DSUM
   208 000001D7 [8C0B]                  		dw DSLIDE
   209 000001D9 [F711]                  		dw StrCmp
   210 000001DB [1D6C]                  		dw InitCDS
   211 000001DD [8D68]                  		dw pJFNFromHandle
   212 000001DF [C970]                  		dw $NameTrans
   213 000001E1 [5406]                  		dw CAL_LK
   214 000001E3 [6843]                  		dw DEVNAME
   215 000001E5 [5012]                  		dw Idle
   216 000001E7 [3F12]                  		dw DStrLen
   217 000001E9 [F412]                  		dw NLS_OPEN
   218 000001EB [4B69]                  		dw $CLOSE
   219 000001ED [FA12]                  		dw NLS_LSEEK
   220 000001EF [5A6A]                  		dw $READ
   221 000001F1 [B412]                  		dw FastInit
   222 000001F3 [3713]                  		dw NLS_IOCTL
   223 000001F5 [2613]                  		dw GetDevList
   224 000001F7 [5413]                  		dw NLS_GETEXT
   225 000001F9 [5913]                  		dw MSG_RETRIEVAL
   226 000001FB [2D06]                  		dw NO_OP
   227 000001FD 4D5320444F53205665-     ms_copyright:	db 'MS DOS Version 6 (C)Copyright 1981-1994 Microsoft Corp Licensed M'
   227 00000206 7273696F6E20362028-
   227 0000020F 4329436F7079726967-
   227 00000218 687420313938312D31-
   227 00000221 393934204D6963726F-
   227 0000022A 736F667420436F7270-
   227 00000233 204C6963656E736564-
   227 0000023C 204D               
   228 0000023E 6174657269616C202D-     		db 'aterial - Property of Microsoft All rights reserved '
   228 00000247 2050726F7065727479-
   228 00000250 206F66204D6963726F-
   228 00000259 736F667420416C6C20-
   228 00000262 726967687473207265-
   228 0000026B 73657276656420     
   229                                  ; ---------------------------------------------------------------------------
   230                                  ; START	OF FUNCTION CHUNK FOR STATCHK
   231                                  
   232                                  $SET_CTRL_C_TRAPPING:			; ...
   233 00000272 3C06                    		cmp	al, 6
   234 00000274 7603                    		jbe	short scct_1
   235 00000276 B0FF                    		mov	al, 0FFh
   236 00000278 CF                      		iret
   237                                  ; ---------------------------------------------------------------------------
   238                                  
   239                                  scct_1:					; ...
   240 00000279 1E                      		push	ds
   241 0000027A 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   242 0000027F 50                      		push	ax
   243 00000280 56                      		push	si
   244 00000281 BE[3703]                		mov	si, CNTCFLAG
   245 00000284 30E4                    		xor	ah, ah
   246 00000286 09C0                    		or	ax, ax
   247 00000288 7504                    		jnz	short scct_2
   248 0000028A 8A14                    		mov	dl, [si]
   249 0000028C EB35                    		jmp	short scct_9s
   250                                  ; ---------------------------------------------------------------------------
   251                                  
   252                                  scct_2:					; ...
   253 0000028E 48                      		dec	ax
   254 0000028F 7507                    		jnz	short scct_3
   255 00000291 80E201                  		and	dl, 1
   256 00000294 8814                    		mov	[si], dl
   257 00000296 EB2B                    		jmp	short scct_9s
   258                                  ; ---------------------------------------------------------------------------
   259                                  
   260                                  scct_3:					; ...
   261 00000298 48                      		dec	ax
   262 00000299 7507                    		jnz	short scct_4
   263 0000029B 80E201                  		and	dl, 1
   264 0000029E 8614                    		xchg	dl, [si]
   265 000002A0 EB21                    		jmp	short scct_9s
   266                                  ; ---------------------------------------------------------------------------
   267                                  
   268                                  scct_4:					; ...
   269 000002A2 83F803                  		cmp	ax, 3
   270 000002A5 7506                    		jnz	short scct_5
   271 000002A7 8A16[6900]              		mov	dl, [BOOTDRIVE]
   272 000002AB EB16                    		jmp	short scct_9s
   273                                  ; ---------------------------------------------------------------------------
   274                                  
   275                                  scct_5:					; ...
   276 000002AD 83F804                  		cmp	ax, 4
   277 000002B0 7511                    		jnz	short scct_9s
   278 000002B2 BB0616                  		mov	bx, 1606h
   279 000002B5 B200                    		mov	dl, 0
   280 000002B7 30F6                    		xor	dh, dh
   281 000002B9 803E[1112]00            		cmp	byte [DosHasHMA], 0
   282 000002BE 7403                    		jz	short scct_9s
   283 000002C0 80CE10                  		or	dh, 10h
   284                                  
   285                                  scct_9s:				; ...
   286 000002C3 5E                      		pop	si
   287 000002C4 58                      		pop	ax
   288 000002C5 1F                      		pop	ds
   289 000002C6 CF                      		iret
   290                                  ; ---------------------------------------------------------------------------
   291                                  
   292                                  SetCtrlShortEntry:			; ...
   293 000002C7 EBA9                    		jmp	short $SET_CTRL_C_TRAPPING
   294                                  ; ---------------------------------------------------------------------------
   295                                  
   296                                  $SET_CURRENT_PDB:			; ...
   297 000002C9 1E                      		push	ds
   298 000002CA 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   299 000002CF 891E[3003]              		mov	[CurrentPDB], bx
   300 000002D3 1F                      		pop	ds
   301 000002D4 CF                      		iret
   302                                  ; ---------------------------------------------------------------------------
   303                                  
   304                                  $GET_CURRENT_PDB:			; ...
   305 000002D5 1E                      		push	ds
   306 000002D6 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   307 000002DB 8B1E[3003]              		mov	bx, [CurrentPDB]
   308 000002DF 1F                      		pop	ds
   309 000002E0 CF                      		iret
   310                                  ; ---------------------------------------------------------------------------
   311                                  
   312                                  $SET_PRINTER_FLAG:			; ...
   313 000002E1 1E                      		push	ds
   314 000002E2 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   315 000002E7 A2[A00A]                		mov	[PRINTER_FLAG], al
   316 000002EA 1F                      		pop	ds
   317 000002EB CF                      		iret
   318                                  ; END OF FUNCTION CHUNK	FOR STATCHK
   319                                  ; ---------------------------------------------------------------------------
   320                                  
   321                                  quit:					; ...
   322 000002EC 30E4                    		xor	ah, ah
   323 000002EE EB2E                    		jmp	short SAVREGS
   324                                  ; ---------------------------------------------------------------------------
   325                                  ; START	OF FUNCTION CHUNK FOR STATCHK
   326                                  
   327                                  BADCALL:				; ...
   328 000002F0 30C0                    		xor	al, al
   329                                  
   330                                  irett:					; ...
   331 000002F2 CF                      		iret
   332                                  ; END OF FUNCTION CHUNK	FOR STATCHK
   333                                  ; ---------------------------------------------------------------------------
   334                                  
   335                                  call_entry:				; ...
   336 000002F3 1E                      		push	ds
   337 000002F4 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   338 000002F9 8F06[EC05]              		pop	word [SAVEDS]
   339 000002FD 58                      		pop	ax
   340 000002FE 58                      		pop	ax
   341 000002FF 8F06[8405]              		pop	word [USER_SP]
   342 00000303 9C                      		pushf
   343 00000304 FA                      		cli
   344 00000305 50                      		push	ax
   345 00000306 FF36[8405]              		push	word [USER_SP]
   346 0000030A FF36[EC05]              		push	word [SAVEDS]
   347 0000030E 1F                      		pop	ds
   348 0000030F 80F924                  		cmp	cl, 36
   349 00000312 77DC                    		ja	short BADCALL
   350 00000314 88CC                    		mov	ah, cl
   351 00000316 EB06                    		jmp	short SAVREGS
   352                                  ; ---------------------------------------------------------------------------
   353                                  ; START	OF FUNCTION CHUNK FOR STATCHK
   354                                  
   355                                  command:				; ...
   356 00000318 FA                      		cli
   357 00000319 80FC6C                  		cmp	ah, 6Ch
   358 0000031C 77D2                    		ja	short BADCALL
   359                                  
   360                                  SAVREGS:				; ...
   361 0000031E 80FC33                  		cmp	ah, 33h
   362 00000321 7218                    		jb	short SaveAllRegs
   363 00000323 74A2                    		jz	short SetCtrlShortEntry
   364 00000325 80FC64                  		cmp	ah, 64h
   365 00000328 7711                    		ja	short SaveAllRegs
   366 0000032A 74B5                    		jz	short $SET_PRINTER_FLAG
   367 0000032C 80FC51                  		cmp	ah, 51h
   368 0000032F 74A4                    		jz	short $GET_CURRENT_PDB
   369 00000331 80FC62                  		cmp	ah, 62h
   370 00000334 749F                    		jz	short $GET_CURRENT_PDB
   371 00000336 80FC50                  		cmp	ah, 50h
   372 00000339 748E                    		jz	short $SET_CURRENT_PDB
   373                                  
   374                                  SaveAllRegs:				; ...
   375 0000033B 06                      		push	es
   376 0000033C 1E                      		push	ds
   377 0000033D 55                      		push	bp
   378 0000033E 57                      		push	di
   379 0000033F 56                      		push	si
   380 00000340 52                      		push	dx
   381 00000341 51                      		push	cx
   382 00000342 53                      		push	bx
   383 00000343 50                      		push	ax
   384 00000344 8CD8                    		mov	ax, ds
   385 00000346 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   386 0000034B A3[EC05]                		mov	[SAVEDS], ax
   387 0000034E 891E[EA05]              		mov	[SAVEBX], bx
   388 00000352 A1[8405]                		mov	ax, [USER_SP]
   389 00000355 A3[F205]                		mov	[NSP], ax
   390 00000358 A1[8605]                		mov	ax, [USER_SS]
   391 0000035B A3[F005]                		mov	[NSS], ax
   392 0000035E 31C0                    		xor	ax, ax
   393 00000360 A2[7205]                		mov	byte [FSHARING], al
   394 00000363 F606[3010]01            		test	byte [IsWin386], 1
   395 00000368 7503                    		jnz	short set_indos_flag
   396 0000036A A3[3E03]                		mov	[USER_ID], ax
   397                                  
   398                                  set_indos_flag:				; ...
   399 0000036D FE06[2103]              		inc	byte [INDOS]
   400 00000371 8926[8405]              		mov	[USER_SP], sp
   401 00000375 8C16[8605]              		mov	[USER_SS], ss
   402 00000379 A1[3003]                		mov	ax, [CurrentPDB]
   403 0000037C A3[3C03]                		mov	[PROC_ID], ax
   404 0000037F 8ED8                    		mov	ds, ax
   405 00000381 58                      		pop	ax
   406 00000382 50                      		push	ax
   407 00000383 89262E00                		mov	[2Eh], sp
   408 00000387 8C163000                		mov	word [30h], ss
   409 0000038B 2E8E16[0700]            		mov	ss, [cs:DosDSeg]
   410                                  
   411                                  REDISP:					; ...
   412 00000390 BC[A007]                		mov	sp, AUXSTACK
   413 00000393 FB                      		sti
   414 00000394 8CD3                    		mov	bx, ss
   415 00000396 8EDB                    		mov	ds, bx
   416 00000398 93                      		xchg	ax, bx
   417 00000399 31C0                    		xor	ax, ax
   418 0000039B 36A2[F605]              		mov	byte [ss:EXTOPEN_ON], al
   419 0000039F 368126[1106]0008        		and	word [ss:DOS34_FLAG], 800h
   420 000003A6 36A2[5703]              		mov	byte [ss:CONSWAP], al
   421 000003AA 36A2[4C03]              		mov	byte [ss:NoSetDir], al
   422 000003AE 36A2[4A03]              		mov	byte [ss:FAILERR], al
   423 000003B2 40                      		inc	ax
   424 000003B3 36A2[5803]              		mov	byte [ss:IDLEINT], al
   425 000003B7 93                      		xchg	ax, bx
   426 000003B8 88E3                    		mov	bl, ah
   427 000003BA D1E3                    		shl	bx, 1
   428 000003BC FC                      		cld
   429 000003BD 08E4                    		or	ah, ah
   430 000003BF 7417                    		jz	short DSKROUT
   431 000003C1 80FC59                  		cmp	ah, 59h
   432 000003C4 7444                    		jz	short DISPCALL
   433 000003C6 80FC0C                  		cmp	ah, 0Ch
   434 000003C9 770D                    		ja	short DSKROUT
   435                                  
   436                                  IOROUT:
   437 000003CB 36803E[2003]00          		cmp	byte [ss:ERRORMODE], 0
   438 000003D1 7537                    		jnz	short DISPCALL
   439 000003D3 BC[A00A]                		mov	sp, PRINTER_FLAG
   440 000003D6 EB32                    		jmp	short DISPCALL
   441                                  ; ---------------------------------------------------------------------------
   442                                  
   443                                  DSKROUT:				; ...
   444 000003D8 36A3[3A03]              		mov	[ss:USER_IN_AX], ax
   445 000003DC 36C606[2303]01          		mov	byte [ss:EXTERR_LOCUS], 1
   446 000003E2 36C606[2003]00          		mov	byte [ss:ERRORMODE], 0
   447 000003E8 36C606[2203]FF          		mov	byte [ss:WPERR], 0FFh
   448 000003EE 50                      		push	ax
   449 000003EF B482                    		mov	ah, 82h
   450 000003F1 CD2A                    		int	2Ah		; Microsoft Networks - END DOS CRITICAL	SECTIONS 0 THROUGH 7
   451 000003F3 58                      		pop	ax
   452 000003F4 36C606[5803]00          		mov	byte [ss:IDLEINT], 0
   453 000003FA BC[2009]                		mov	sp, DSKSTACK
   454 000003FD 36F606[3703]FF          		test	byte [ss:CNTCFLAG], 0FFh
   455 00000403 7405                    		jz	short DISPCALL
   456 00000405 50                      		push	ax
   457 00000406 E8974E                  		call	DSKSTATCHK
   458 00000409 58                      		pop	ax
   459                                  
   460                                  DISPCALL:				; ...
   461 0000040A 2E8B9F[BE00]            		mov	bx, [cs:DISPATCH+bx]
   462 0000040F 36871E[EA05]            		xchg	bx, [ss:SAVEBX]
   463 00000414 368E1E[EC05]            		mov	ds, [ss:SAVEDS]
   464 00000419 36FF16[EA05]            		call	[ss:SAVEBX]
   465 0000041E 368026[8600]FB          		and	byte [ss:DOS_FLAG], 0FBh
   466                                  
   467                                  LeaveDOS:				; ...
   468 00000424 FA                      		cli
   469 00000425 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   470 0000042A 803E[8500]00            		cmp	byte [A20OFF_COUNT], 0
   471 0000042F 7527                    		jnz	short disa20
   472                                  
   473                                  LeaveA20On:				; ...
   474 00000431 FE0E[2103]              		dec	byte [INDOS]
   475 00000435 8E16[8605]              		mov	ss, [USER_SS]
   476 00000439 8B26[8405]              		mov	sp, [USER_SP]
   477 0000043D 89E5                    		mov	bp, sp
   478 0000043F 884600                  		mov	[bp+0],	al
   479 00000442 A1[F205]                		mov	ax, [NSP]
   480 00000445 A3[8405]                		mov	[USER_SP], ax
   481 00000448 A1[F005]                		mov	ax, [NSS]
   482 0000044B A3[8605]                		mov	[USER_SS], ax
   483 0000044E 58                      		pop	ax
   484 0000044F 5B                      		pop	bx
   485 00000450 59                      		pop	cx
   486 00000451 5A                      		pop	dx
   487 00000452 5E                      		pop	si
   488 00000453 5F                      		pop	di
   489 00000454 5D                      		pop	bp
   490 00000455 1F                      		pop	ds
   491 00000456 07                      		pop	es
   492 00000457 CF                      		iret
   493                                  ; ---------------------------------------------------------------------------
   494                                  
   495                                  disa20:					; ...
   496 00000458 8B1E[6300]              		mov	bx, [A20OFF_PSP]
   497 0000045C 3B1E[3003]              		cmp	bx, [CurrentPDB]
   498 00000460 75CF                    		jnz	short LeaveA20On
   499 00000462 FE0E[8500]              		dec	byte [A20OFF_COUNT]
   500 00000466 1E                      		push	ds
   501 00000467 BB[2D11]                		mov	bx, disa20_iret
   502 0000046A 53                      		push	bx
   503 0000046B CB                      		retf
   504                                  ; END OF FUNCTION CHUNK	FOR STATCHK
   505                                  
   506                                  ; =============== S U B	R O U T	I N E =======================================
   507                                  
   508                                  
   509                                  restore_world:		; ...
   510 0000046C 2E8E06[0700]            		mov	es, [cs:DosDSeg]
   511 00000471 268F06[EE05]            		pop	word [es:RESTORE_TMP]
   512 00000476 58                      		pop	ax
   513 00000477 5B                      		pop	bx
   514 00000478 59                      		pop	cx
   515 00000479 5A                      		pop	dx
   516 0000047A 5E                      		pop	si
   517 0000047B 5F                      		pop	di
   518 0000047C 5D                      		pop	bp
   519 0000047D 1F                      		pop	ds
   520 0000047E 26FF26[EE05]            		jmp	word [es:RESTORE_TMP]
   521                                  
   522                                  
   523                                  ; =============== S U B	R O U T	I N E =======================================
   524                                  
   525                                  ; Attributes: bp-based frame
   526                                  
   527                                  save_world:		; ...
   528 00000483 2E8E06[0700]            		mov	es, [cs:DosDSeg]
   529 00000488 268F06[EE05]            		pop	word [es:RESTORE_TMP]
   530 0000048D 1E                      		push	ds
   531 0000048E 55                      		push	bp
   532 0000048F 57                      		push	di
   533 00000490 56                      		push	si
   534 00000491 52                      		push	dx
   535 00000492 51                      		push	cx
   536 00000493 53                      		push	bx
   537 00000494 50                      		push	ax
   538 00000495 26FF36[EE05]            		push	word [es:RESTORE_TMP]
   539 0000049A 55                      		push	bp
   540 0000049B 89E5                    		mov	bp, sp
   541 0000049D 8E4614                  		mov	es, word [bp+20]
   542 000004A0 5D                      		pop	bp
   543 000004A1 C3                      		retn
   544                                  
   545                                  
   546                                  ; =============== S U B	R O U T	I N E =======================================
   547                                  
   548                                  
   549                                  Get_User_Stack:	; ...
   550 000004A2 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   551 000004A7 C536[8405]              		lds	si, [USER_SP]
   552 000004AB C3                      		retn
   553                                  
   554                                  
   555                                  ; ---------------------------------------------------------------------------
   556 000004AC 02                      ERRIN:		db 2			; ...
   557 000004AD 06                      		db 6
   558 000004AE 0C                      		db 12
   559 000004AF 04                      		db 4
   560 000004B0 08                      		db 8
   561 000004B1 00                      		db 0
   562 000004B2 80                      ERROUT:		db 80h
   563 000004B3 40                      		db 40h
   564 000004B4 02                      		db 2
   565 000004B5 10                      		db 10h
   566 000004B6 04                      		db 4
   567 000004B7 03                      		db 3
   568                                  
   569                                  ; =============== S U B	R O U T	I N E =======================================
   570                                  
   571                                  
   572                                  AbsSetup:
   573 000004B8 36FE06[2103]            		inc	byte [ss:INDOS]
   574 000004BD FB                      		sti
   575 000004BE FC                      		cld
   576 000004BF 1E                      		push	ds
   577 000004C0 16                      		push	ss
   578 000004C1 1F                      		pop	ds
   579 000004C2 E80C01                  		call	GETBP
   580 000004C5 7206                    		jb	short errdriv
   581 000004C7 26C7461FFFFF            		mov	word [es:bp+1Fh], 0FFFFh
   582                                  
   583                                  errdriv:				; ...
   584 000004CD 1F                      		pop	ds
   585 000004CE 7301                    		jnb	short AbsSetup2
   586                                  
   587                                  AbsSetup_retn:				; ...
   588 000004D0 C3                      		retn
   589                                  ; ---------------------------------------------------------------------------
   590                                  
   591                                  AbsSetup2:				; ...
   592 000004D1 36C706[0706]0000        		mov	word [ss:HIGH_SECTOR], 0
   593 000004D8 E85604                  		call	RW32_CONVERT
   594 000004DB 72F3                    		jb	short AbsSetup_retn
   595 000004DD E86E58                  		call	SET_RQ_SC_PARMS
   596 000004E0 1E                      		push	ds
   597 000004E1 56                      		push	si
   598 000004E2 50                      		push	ax
   599 000004E3 16                      		push	ss
   600 000004E4 1F                      		pop	ds
   601 000004E5 BE[BE03]                		mov	si, OPENBUF
   602 000004E8 8804                    		mov	[si], al
   603 000004EA 800441                  		add	byte [si], 'A'
   604 000004ED C744013A00              		mov	word [si+1], ':'
   605 000004F2 B80003                  		mov	ax, 300h
   606 000004F5 F8                      		clc
   607 000004F6 CD2A                    		int	2Ah		; Microsoft Networks - CHECK DIRECT I/O
   608                                  					; DS:SI	-> ASCIZ disk device name (may be full path or only drive
   609                                  					; specifier--must include the colon)
   610                                  					; Return: CF clear if absolute disk access allowed
   611 000004F8 58                      		pop	ax
   612 000004F9 5E                      		pop	si
   613 000004FA 1F                      		pop	ds
   614 000004FB 73D3                    		jnb	short AbsSetup_retn
   615 000004FD 36C706[2403]3200        		mov	word [ss:EXTERR], 32h
   616 00000504 C3                      		retn
   617                                  
   618                                  ; ---------------------------------------------------------------------------
   619                                  
   620                                  ABSDRD:					; ...
   621 00000505 FA                      		cli
   622 00000506 50                      		push	ax
   623 00000507 8CD8                    		mov	ax, ds
   624 00000509 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   625 0000050E A3[0A0D]                		mov	[TEMPSEG], ax
   626 00000511 58                      		pop	ax
   627 00000512 06                      		push	es
   628 00000513 8C16[1B06]              		mov	[AbsRdWr_SS], ss
   629 00000517 8926[1D06]              		mov	[AbsRdWr_SP], sp
   630 0000051B 2E8E16[0700]            		mov	ss, [cs:DosDSeg]
   631 00000520 BC[2009]                		mov	sp, DSKSTACK
   632 00000523 8E1E[0A0D]              		mov	ds, [TEMPSEG]
   633 00000527 06                      		push	es
   634 00000528 E858FF                  		call	save_world
   635 0000052B 06                      		push	es
   636 0000052C E889FF                  		call	AbsSetup
   637 0000052F 723D                    		jb	short ILEAVE
   638 00000531 E8260E                  		call	ECritDisk
   639 00000534 36C606[B00D]FF          		mov	byte [ss:CurSC_DRIVE], 0FFh
   640 0000053A E83D0E                  		call	LCritDisk
   641 0000053D E87933                  		call	DSKREAD
   642 00000540 7513                    		jnz	short ERR_LEAVE
   643 00000542 89F9                    		mov	cx, di
   644 00000544 368C1E[0E06]            		mov	[ss:TEMP_VAR2], ds
   645 00000549 36891E[0C06]            		mov	[ss:TEMP_VAR], bx
   646 0000054E E8BF35                  		call	DskRdBufScan
   647 00000551 EB1B                    		jmp	short ILEAVE
   648                                  ; ---------------------------------------------------------------------------
   649                                  
   650                                  TLEAVE:					; ...
   651 00000553 7419                    		jz	short ILEAVE
   652                                  
   653                                  ERR_LEAVE:				; ...
   654 00000555 06                      		push	es
   655 00000556 0E                      		push	cs
   656 00000557 07                      		pop	es
   657 00000558 30E4                    		xor	ah, ah
   658 0000055A B90600                  		mov	cx, 6
   659 0000055D BF[AC04]                		mov	di, ERRIN
   660 00000560 F2AE                    		repne scasb
   661 00000562 7504                    		jnz	short LEAVECODE
   662 00000564 268A6505                		mov	ah, [es:di+5]
   663                                  
   664                                  LEAVECODE:				; ...
   665 00000568 07                      		pop	es
   666 00000569 36A3[B80D]              		mov	[ss:AbsDskErr], ax
   667 0000056D F9                      		stc
   668                                  
   669                                  ILEAVE:					; ...
   670 0000056E 07                      		pop	es
   671 0000056F E8FAFE                  		call	restore_world
   672 00000572 07                      		pop	es
   673 00000573 FA                      		cli
   674 00000574 36A1[B80D]              		mov	ax, [ss:AbsDskErr]
   675 00000578 36FE0E[2103]            		dec	byte [ss:INDOS]
   676 0000057D 16                      		push	ss
   677 0000057E 07                      		pop	es
   678 0000057F 268E16[1B06]            		mov	ss, [es:AbsRdWr_SS]
   679 00000584 268B26[1D06]            		mov	sp, [es:AbsRdWr_SP]
   680 00000589 07                      		pop	es
   681 0000058A FB                      		sti
   682 0000058B CB                      		retf
   683                                  ; ---------------------------------------------------------------------------
   684                                  
   685                                  ABSDWRT:				; ...
   686 0000058C FA                      		cli
   687 0000058D 50                      		push	ax
   688 0000058E 8CD8                    		mov	ax, ds
   689 00000590 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   690 00000595 A3[0A0D]                		mov	[TEMPSEG], ax
   691 00000598 58                      		pop	ax
   692 00000599 06                      		push	es
   693 0000059A 8C16[1B06]              		mov	[AbsRdWr_SS], ss
   694 0000059E 8926[1D06]              		mov	[AbsRdWr_SP], sp
   695 000005A2 2E8E16[0700]            		mov	ss, [cs:DosDSeg]
   696 000005A7 BC[2009]                		mov	sp, DSKSTACK
   697 000005AA 8E1E[0A0D]              		mov	ds, [TEMPSEG]
   698 000005AE 06                      		push	es
   699 000005AF E8D1FE                  		call	save_world
   700 000005B2 06                      		push	es
   701 000005B3 E802FF                  		call	AbsSetup
   702 000005B6 72B6                    		jb	short ILEAVE
   703 000005B8 E89F0D                  		call	ECritDisk
   704 000005BB 36C606[B00D]FF          		mov	byte [ss:CurSC_DRIVE], 0FFh
   705 000005C1 E8B403                  		call	Fastxxx_Purge
   706 000005C4 E8B30D                  		call	LCritDisk
   707 000005C7 1E                      		push	ds
   708 000005C8 E86338                  		call	DskWrtBufPurge
   709 000005CB 1F                      		pop	ds
   710 000005CC E81333                  		call	DSKWRITE
   711 000005CF EB82                    		jmp	short TLEAVE
   712                                  
   713                                  ; =============== S U B	R O U T	I N E =======================================
   714                                  
   715                                  
   716                                  GETBP:
   717 000005D1 50                      		push	ax
   718 000005D2 0401                    		add	al, 1
   719 000005D4 7216                    		jb	short SKIPGET
   720 000005D6 E80367                  		call	GETTHISDRV
   721 000005D9 7311                    		jnb	short SKIPGET
   722 000005DB 30E4                    		xor	ah, ah
   723 000005DD 83F81A                  		cmp	ax, 1Ah
   724 000005E0 740A                    		jz	short SKIPGET
   725 000005E2 F9                      		stc
   726 000005E3 A3[2403]                		mov	word [EXTERR], ax
   727 000005E6 C706[B80D]0102          		mov	word [AbsDskErr], 201h
   728                                  
   729                                  SKIPGET:				; ...
   730 000005EC 58                      		pop	ax
   731 000005ED 7301                    		jnb	short GETBP_@f
   732 000005EF C3                      		retn
   733                                  ; ---------------------------------------------------------------------------
   734                                  
   735                                  GETBP_@f:				; ...
   736 000005F0 C42E[A205]              		les	bp, [THISCDS]
   737 000005F4 26F746430080            		test	word [es:bp+43h], 8000h
   738 000005FA 7408                    		jz	short GETBP_CDS
   739 000005FC C706[2403]3200          		mov	word [EXTERR], 32h ; '2'
   740 00000602 F9                      		stc
   741 00000603 C3                      		retn
   742                                  ; ---------------------------------------------------------------------------
   743                                  
   744                                  GETBP_CDS:				; ...
   745 00000604 26C46E45                		les	bp, [es:bp+45h]
   746                                  
   747                                  
   748                                  ; =============== S U B	R O U T	I N E =======================================
   749                                  
   750                                  
   751                                  GOTDPB:
   752 00000608 892E[8A05]              		mov	word [THISDPB], bp
   753 0000060C 8C06[8C05]              		mov	word [THISDPB+2], es
   754 00000610 C3                      		retn
   755                                  
   756                                  ; ---------------------------------------------------------------------------
   757                                  ; START	OF FUNCTION CHUNK FOR $IOCTL
   758                                  
   759                                  SYS_RET_OK:				; ...
   760 00000611 E88EFE                  		call	Get_User_Stack
   761 00000614 836416FE                		and	word [si+16h], 0FFFEh
   762 00000618 EB10                    		jmp	short DO_RET
   763                                  ; ---------------------------------------------------------------------------
   764                                  
   765                                  SYS_RET_ERR:				; ...
   766 0000061A 30E4                    		xor	ah, ah
   767 0000061C E86C00                  		call	ETAB_LK
   768 0000061F E81A00                  		call	ErrorMap
   769                                  
   770                                  From_GetSet:				; ...
   771 00000622 E87DFE                  		call	Get_User_Stack
   772 00000625 834C1601                		or	word [si+16h], 1
   773 00000629 F9                      		stc
   774                                  
   775                                  DO_RET:					; ...
   776 0000062A 8904                    		mov	[si], ax
   777 0000062C C3                      		retn
   778                                  ; END OF FUNCTION CHUNK	FOR $IOCTL
   779                                  ; ---------------------------------------------------------------------------
   780                                  
   781                                  NO_OP:					; ...
   782 0000062D 30C0                    		xor	al, al
   783 0000062F C3                      		retn
   784                                  
   785                                  ; =============== S U B	R O U T	I N E =======================================
   786                                  
   787                                  
   788                                  FCB_RET_ERR:
   789 00000630 30E4                    		xor	ah, ah
   790 00000632 36A3[2403]              		mov	word [ss:EXTERR], ax
   791 00000636 E80300                  		call	ErrorMap
   792 00000639 B0FF                    		mov	al, 0FFh
   793 0000063B C3                      		retn
   794                                  
   795                                  ; =============== S U B	R O U T	I N E =======================================
   796                                  
   797                                  
   798                                  ErrorMap:
   799 0000063C 56                      		push	si
   800 0000063D BE[DB0D]                		mov	si, ERR_TABLE_21
   801 00000640 36803E[4A03]00          		cmp	byte [ss:FAILERR], 0
   802 00000646 7407                    		jz	short EXTENDED_NORMAL
   803 00000648 36C706[2403]5300        		mov	word [ss:EXTERR], 53h
   804                                  
   805                                  EXTENDED_NORMAL:			; ...
   806 0000064F E80200                  		call	CAL_LK
   807 00000652 5E                      		pop	si
   808 00000653 C3                      		retn
   809                                  
   810                                  ; =============== S U B	R O U T	I N E =======================================
   811                                  
   812                                  
   813                                  CAL_LK:
   814 00000654 1E                      		push	ds
   815 00000655 50                      		push	ax
   816 00000656 53                      		push	bx
   817 00000657 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   818 0000065C 8B1E[2403]              		mov	bx, [EXTERR]
   819                                  
   820                                  TABLK1:					; ...
   821 00000660 AC                      		lodsb
   822 00000661 3CFF                    		cmp	al, 0FFh
   823 00000663 7409                    		jz	short GOT_VALS
   824 00000665 38D8                    		cmp	al, bl
   825 00000667 7405                    		jz	short GOT_VALS
   826 00000669 83C603                  		add	si, 3
   827 0000066C EBF2                    		jmp	short TABLK1
   828                                  ; ---------------------------------------------------------------------------
   829                                  
   830                                  GOT_VALS:				; ...
   831 0000066E AD                      		lodsw
   832 0000066F 80FCFF                  		cmp	ah, 0FFh
   833 00000672 7404                    		jz	short NO_SET_ACT
   834 00000674 8826[2603]              		mov	byte [EXTERR_ACT_CLASS], ah
   835                                  
   836                                  NO_SET_ACT:				; ...
   837 00000678 3CFF                    		cmp	al, 0FFh
   838 0000067A 7403                    		jz	short NO_SET_CLS
   839 0000067C A2[2703]                		mov	byte [EXTERR_ACT_CLASS+1], al
   840                                  
   841                                  NO_SET_CLS:				; ...
   842 0000067F AC                      		lodsb
   843 00000680 3CFF                    		cmp	al, 0FFh
   844 00000682 7403                    		jz	short NO_SET_LOC
   845 00000684 A2[2303]                		mov	byte [EXTERR_LOCUS], al
   846                                  
   847                                  NO_SET_LOC:				; ...
   848 00000687 5B                      		pop	bx
   849 00000688 58                      		pop	ax
   850 00000689 1F                      		pop	ds
   851 0000068A C3                      		retn
   852                                  
   853                                  ; =============== S U B	R O U T	I N E =======================================
   854                                  
   855                                  
   856                                  ETAB_LK:
   857 0000068B 1E                      		push	ds
   858 0000068C 56                      		push	si
   859 0000068D 51                      		push	cx
   860 0000068E 53                      		push	bx
   861 0000068F 16                      		push	ss
   862 00000690 1F                      		pop	ds
   863 00000691 A3[2403]                		mov	word [EXTERR], ax
   864 00000694 BE[0B00]                		mov	si, I21_MAP_E_TAB
   865 00000697 88C7                    		mov	bh, al
   866 00000699 8A1E[3B03]              		mov	bl, byte [USER_IN_AX+1]
   867                                  
   868                                  TABLK2:					; ...
   869                                  		;lods	word [cs:si]
   870 0000069D 2EAD                    		cs	lodsw
   871 0000069F 3CFF                    		cmp	al, 0FFh
   872 000006A1 740C                    		jz	short NOT_IN_TABLE
   873 000006A3 38D8                    		cmp	al, bl
   874 000006A5 740C                    		jz	short GOT_CALL
   875 000006A7 86E0                    		xchg	ah, al
   876 000006A9 30E4                    		xor	ah, ah
   877 000006AB 01C6                    		add	si, ax
   878 000006AD EBEE                    		jmp	short TABLK2
   879                                  ; ---------------------------------------------------------------------------
   880                                  
   881                                  NOT_IN_TABLE:				; ...
   882 000006AF 88F8                    		mov	al, bh
   883 000006B1 EB0C                    		jmp	short NO_MAP
   884                                  ; ---------------------------------------------------------------------------
   885                                  
   886                                  GOT_CALL:				; ...
   887 000006B3 88E1                    		mov	cl, ah
   888 000006B5 30ED                    		xor	ch, ch
   889                                  
   890                                  CHECK_CODE:				; ...
   891                                  		;lods	byte [cs:si]
   892 000006B7 2EAC                    		cs	lodsb	
   893 000006B9 38F8                    		cmp	al, bh
   894 000006BB 7402                    		jz	short NO_MAP
   895 000006BD E2F8                    		loop	CHECK_CODE
   896                                  
   897                                  NO_MAP:					; ...
   898 000006BF 30E4                    		xor	ah, ah
   899 000006C1 5B                      		pop	bx
   900 000006C2 59                      		pop	cx
   901 000006C3 5E                      		pop	si
   902 000006C4 1F                      		pop	ds
   903 000006C5 C3                      		retn
   904                                  
   905                                  ; =============== S U B	R O U T	I N E =======================================
   906                                  
   907                                  
   908                                  SetBad:
   909 000006C6 B80100                  		mov	ax, 1
   910 000006C9 1E                      		push	ds
   911 000006CA 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   912 000006CF C606[2303]01            		mov	byte [EXTERR_LOCUS], 1
   913 000006D4 1F                      		pop	ds
   914 000006D5 F9                      		stc
   915 000006D6 C3                      		retn
   916                                  
   917                                  ; =============== S U B	R O U T	I N E =======================================
   918                                  
   919                                  
   920                                  BadCall:
   921 000006D7 E8ECFF                  		call	SetBad
   922 000006DA CB                      		retf
   923                                  
   924                                  ; =============== S U B	R O U T	I N E =======================================
   925                                  
   926                                  
   927                                  OKCall:
   928 000006DB F8                      		clc
   929 000006DC CB                      		retf
   930                                  
   931                                  ; ---------------------------------------------------------------------------
   932                                  
   933                                  INT2F:					; ...
   934 000006DD FB                      		sti
   935 000006DE 80FC11                  		cmp	ah, 11h		; MultNET
   936 000006E1 750A                    		jnz	short INT2FSHR
   937                                  
   938                                  TestInstall:				; ...
   939 000006E3 08C0                    		or	al, al
   940 000006E5 7403                    		jz	short Leave2F
   941                                  
   942                                  BadFunc:				; ...
   943 000006E7 E8DCFF                  		call	SetBad
   944                                  
   945                                  Leave2F:				; ...
   946 000006EA CA0200                  		retf	2
   947                                  ; ---------------------------------------------------------------------------
   948                                  
   949                                  INT2FSHR:				; ...
   950 000006ED 80FC10                  		cmp	ah, 10h		; MultSHARE
   951 000006F0 74F1                    		jz	short TestInstall
   952 000006F2 80FC14                  		cmp	ah, 14h		; NLSFUNC
   953 000006F5 74EC                    		jz	short TestInstall
   954 000006F7 80FC12                  		cmp	ah, 12h		; MultDOS
   955 000006FA 7503                    		jnz	short check_win
   956 000006FC E91102                  		jmp	DispatchDOS
   957                                  ; ---------------------------------------------------------------------------
   958                                  
   959                                  check_win:				; ...
   960 000006FF 80FC16                  		cmp	ah, 16h
   961 00000702 740D                    		jz	short Win386_Msg
   962 00000704 80FC46                  		cmp	ah, 46h	; 'F'
   963 00000707 7503                    		jnz	short next_i2f
   964 00000709 E9B801                  		jmp	Winold_swap
   965                                  ; ---------------------------------------------------------------------------
   966                                  
   967                                  next_i2f:				; ...
   968 0000070C EA05007000              		jmp	70h:05h
   969                                  ; ---------------------------------------------------------------------------
   970                                  
   971                                  Win386_Msg:				; ...
   972 00000711 1E                      		push	ds
   973 00000712 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
   974 00000717 3C03                    		cmp	al, 3
   975 00000719 7503                    		jnz	short Win386_Msg_exit
   976 0000071B E93701                  		jmp	OldWin386Init
   977                                  ; ---------------------------------------------------------------------------
   978                                  
   979                                  Win386_Msg_exit:			; ...
   980 0000071E 3C06                    		cmp	al, 6
   981 00000720 7503                    		jnz	short Win386_Msg_devcall
   982 00000722 E9DC00                  		jmp	Win386_Leaving
   983                                  ; ---------------------------------------------------------------------------
   984                                  
   985                                  Win386_Msg_devcall:			; ...
   986 00000725 3C07                    		cmp	al, 7
   987 00000727 7503                    		jnz	short Win386_Msg_init
   988 00000729 E91801                  		jmp	Win386_Query
   989                                  ; ---------------------------------------------------------------------------
   990                                  
   991                                  Win386_Msg_init:			; ...
   992 0000072C 3C05                    		cmp	al, 5
   993 0000072E 7403                    		jz	short Win386_Starting
   994 00000730 E98001                  		jmp	win_nexti2f
   995                                  ; ---------------------------------------------------------------------------
   996                                  
   997                                  Win386_Starting:			; ...
   998 00000733 F7C20100                		test	dx, 1
   999 00000737 7403                    		jz	short Win386_vchk
  1000 00000739 E97701                  		jmp	win_nexti2f
  1001                                  ; ---------------------------------------------------------------------------
  1002                                  
  1003                                  Win386_vchk:				; ...
  1004 0000073C C706[E80F]0000          		mov	word [Win386_Info_6], 0
  1005 00000742 C706[EA0F]0000          		mov	word [Win386_Info_6+2], 0
  1006 00000748 81FF0A03                		cmp	di, 30Ah
  1007 0000074C 7203                    		jb	short Win386_vxd
  1008 0000074E E99400                  		jmp	noVxD31
  1009                                  ; ---------------------------------------------------------------------------
  1010                                  
  1011                                  Win386_vxd:				; ...
  1012 00000751 50                      		push	ax
  1013 00000752 53                      		push	bx
  1014 00000753 51                      		push	cx
  1015 00000754 52                      		push	dx
  1016 00000755 56                      		push	si
  1017 00000756 57                      		push	di
  1018 00000757 8B1E8C00                		mov	bx, [8Ch]	; UMB_HEAD
  1019 0000075B 83FBFF                  		cmp	bx, 0FFFFh
  1020 0000075E 7422                    		jz	short Vxd31
  1021 00000760 C606[DA0D]01            		mov	byte [UmbSaveFlag], 1
  1022 00000765 1E                      		push	ds
  1023 00000766 06                      		push	es
  1024 00000767 8CD8                    		mov	ax, ds
  1025 00000769 8EC0                    		mov	es, ax
  1026 0000076B 8EDB                    		mov	ds, bx
  1027 0000076D 31F6                    		xor	si, si
  1028 0000076F FC                      		cld
  1029 00000770 BF[1F12]                		mov	di, UmbSave1
  1030 00000773 B90B00                  		mov	cx, 11
  1031 00000776 F3A4                    		rep movsb
  1032 00000778 BF[D50D]                		mov	di, UmbSave2
  1033 0000077B B90500                  		mov	cx, 5
  1034 0000077E F3A4                    		rep movsb
  1035 00000780 07                      		pop	es
  1036 00000781 1F                      		pop	ds
  1037                                  
  1038                                  Vxd31:					; ...
  1039 00000782 F606[8600]02            		test	byte [DOS_FLAG], 2
  1040 00000787 7408                    		jz	short Dont_Supress
  1041 00000789 5F                      		pop	di
  1042 0000078A 5E                      		pop	si
  1043 0000078B 5A                      		pop	dx
  1044 0000078C 59                      		pop	cx
  1045 0000078D 5B                      		pop	bx
  1046 0000078E 58                      		pop	ax
  1047 0000078F EB54                    		jmp	short noVxD31
  1048                                  ; ---------------------------------------------------------------------------
  1049                                  
  1050                                  Dont_Supress:				; ...
  1051 00000791 A0[6900]                		mov	al, [BOOTDRIVE]
  1052 00000794 0440                    		add	al, 40h		; 'A'-1
  1053 00000796 A2[3110]                		mov	[VxDpath], al
  1054 00000799 B46C                    		mov	ah, 6Ch
  1055 0000079B B000                    		mov	al, 0
  1056 0000079D BB8020                  		mov	bx, 2080h
  1057 000007A0 B90700                  		mov	cx, 7
  1058 000007A3 BA0100                  		mov	dx, 1
  1059 000007A6 BE[3110]                		mov	si, VxDpath ; "c:\\wina20.386"
  1060 000007A9 BFFFFF                  		mov	di, 0FFFFh
  1061 000007AC CD21                    		int	21h		; DOS -	4.0 - EXTENDED OPEN/CREATE
  1062                                  					; BL = open mode as in AL for normal open (INT 21h/AH=3Dh)
  1063                                  					; BH = flags, CX = create attribute, DL	= action if file exists/does not exists
  1064                                  					; DH = 00h (reserved), [SI ->	ASCIZ file name
  1065 000007AE 5F                      		pop	di
  1066 000007AF 5E                      		pop	si
  1067 000007B0 5A                      		pop	dx
  1068 000007B1 59                      		pop	cx
  1069 000007B2 731E                    		jnb	short VxDthere
  1070 000007B4 52                      		push	dx
  1071 000007B5 1E                      		push	ds
  1072 000007B6 56                      		push	si
  1073 000007B7 BE[AD09]                		mov	si, NoVxDErrMsg ; "You must have	the file WINA20.386 in th"...
  1074 000007BA 0E                      		push	cs
  1075 000007BB 1F                      		pop	ds
  1076 000007BC B96300                  		mov	cx, 99
  1077 000007BF B402                    		mov	ah, 2
  1078 000007C1 FC                      		cld
  1079                                  
  1080                                  vxdlp:					; ...
  1081 000007C2 AC                      		lodsb
  1082 000007C3 86D0                    		xchg	dl, al
  1083 000007C5 CD21                    		int	21h		; DOS -
  1084 000007C7 E2F9                    		loop	vxdlp
  1085 000007C9 5E                      		pop	si
  1086 000007CA 1F                      		pop	ds
  1087 000007CB 5A                      		pop	dx
  1088 000007CC 5B                      		pop	bx
  1089 000007CD 58                      		pop	ax
  1090 000007CE 41                      		inc	cx
  1091 000007CF E9E100                  		jmp	win_nexti2f
  1092                                  ; ---------------------------------------------------------------------------
  1093                                  
  1094                                  VxDthere:				; ...
  1095 000007D2 89C3                    		mov	bx, ax
  1096 000007D4 B43E                    		mov	ah, 3Eh
  1097 000007D6 CD21                    		int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
  1098                                  					; BX = file handle
  1099 000007D8 BB[E20F]                		mov	bx, Win386_Info
  1100 000007DB C74706[3110]            		mov	word [bx+6], VxDpath ; "c:\\wina20.386"
  1101 000007E0 8C5F08                  		mov	word [bx+8], ds
  1102 000007E3 5B                      		pop	bx
  1103 000007E4 58                      		pop	ax
  1104                                  
  1105                                  noVxD31:				; ...
  1106 000007E5 800E[3010]01            		or	byte [IsWin386], 1
  1107 000007EA 800E[0C0D]01            		or	byte [redir_patch], 1
  1108 000007EF 52                      		push	dx
  1109 000007F0 89DA                    		mov	dx, bx
  1110 000007F2 BB[E20F]                		mov	bx, Win386_Info
  1111 000007F5 895702                  		mov	[bx+2],	dx
  1112 000007F8 8C4704                  		mov	word [bx+4], es
  1113 000007FB 5A                      		pop	dx
  1114 000007FC 1E                      		push	ds
  1115 000007FD 07                      		pop	es
  1116 000007FE E9B200                  		jmp	win_nexti2f
  1117                                  ; ---------------------------------------------------------------------------
  1118                                  
  1119                                  Win386_Leaving:				; ...
  1120 00000801 F7C20100                		test	dx, 1
  1121 00000805 7403                    		jz	short Win386_Leaving_c
  1122 00000807 E9A900                  		jmp	win_nexti2f
  1123                                  ; ---------------------------------------------------------------------------
  1124                                  
  1125                                  Win386_Leaving_c:			; ...
  1126 0000080A 803E[DA0D]01            		cmp	byte [UmbSaveFlag], 1
  1127 0000080F 7527                    		jnz	short noumb
  1128 00000811 C606[DA0D]00            		mov	byte [UmbSaveFlag], 0
  1129 00000816 50                      		push	ax
  1130 00000817 06                      		push	es
  1131 00000818 51                      		push	cx
  1132 00000819 56                      		push	si
  1133 0000081A 57                      		push	di
  1134 0000081B A18C00                  		mov	ax, [8Ch]	; UMB_HEAD
  1135 0000081E 8EC0                    		mov	es, ax
  1136 00000820 31FF                    		xor	di, di
  1137 00000822 FC                      		cld
  1138 00000823 BE[1F12]                		mov	si, UmbSave1
  1139 00000826 B90B00                  		mov	cx, 11
  1140 00000829 F3A4                    		rep movsb
  1141 0000082B BE[D50D]                		mov	si, UmbSave2
  1142 0000082E B90500                  		mov	cx, 5
  1143 00000831 F3A4                    		rep movsb
  1144 00000833 5F                      		pop	di
  1145 00000834 5E                      		pop	si
  1146 00000835 59                      		pop	cx
  1147 00000836 07                      		pop	es
  1148 00000837 58                      		pop	ax
  1149                                  
  1150                                  noumb:					; ...
  1151 00000838 8026[3010]00            		and	byte [IsWin386], 0
  1152 0000083D 8026[0C0D]00            		and	byte [redir_patch], 0
  1153 00000842 EB6F                    		jmp	short win_nexti2f
  1154                                  ; ---------------------------------------------------------------------------
  1155                                  
  1156                                  Win386_Query:				; ...
  1157 00000844 83FB15                  		cmp	bx, 15h
  1158 00000847 756A                    		jnz	short win_nexti2f
  1159 00000849 09C9                    		or	cx, cx
  1160 0000084B 7512                    		jnz	short dosmgr_func
  1161 0000084D 41                      		inc	cx
  1162 0000084E BB[2210]                		mov	bx, Win386_DOSVars
  1163 00000851 1E                      		push	ds
  1164 00000852 07                      		pop	es
  1165 00000853 EB5C                    		jmp	short PopIret
  1166                                  ; ---------------------------------------------------------------------------
  1167                                  
  1168                                  OldWin386Init:				; ...
  1169 00000855 58                      		pop	ax
  1170 00000856 BE[E711]                		mov	si, OldInstanceJunk
  1171 00000859 B84852                  		mov	ax, 5248h
  1172 0000085C E9ADFE                  		jmp	next_i2f
  1173                                  ; ---------------------------------------------------------------------------
  1174                                  
  1175                                  dosmgr_func:				; ...
  1176 0000085F 49                      		dec	cx
  1177 00000860 7436                    		jz	short win386_patch
  1178 00000862 49                      		dec	cx
  1179 00000863 744C                    		jz	short PopIret
  1180 00000865 49                      		dec	cx
  1181 00000866 7434                    		jz	short win386_size
  1182 00000868 49                      		dec	cx
  1183 00000869 743C                    		jz	short win386_inst
  1184 0000086B 49                      		dec	cx
  1185 0000086C 7543                    		jnz	short PopIret
  1186 0000086E 8CC0                    		mov	ax, es
  1187 00000870 48                      		dec	ax
  1188 00000871 06                      		push	es
  1189 00000872 8EC0                    		mov	es, ax
  1190 00000874 26803D44                		cmp	byte [es:di], 'D'
  1191 00000878 7517                    		jnz	short cantsize
  1192 0000087A 40                      		inc	ax
  1193 0000087B 26394501                		cmp	[es:di+1], ax
  1194 0000087F 7510                    		jnz	short cantsize
  1195 00000881 268B4503                		mov	ax, [es:di+3]
  1196 00000885 07                      		pop	es
  1197 00000886 BB1000                  		mov	bx, 16
  1198 00000889 F7E3                    		mul	bx
  1199 0000088B 89C1                    		mov	cx, ax
  1200 0000088D 89D3                    		mov	bx, dx
  1201 0000088F EB1A                    		jmp	short win386_done
  1202                                  ; ---------------------------------------------------------------------------
  1203                                  
  1204                                  cantsize:				; ...
  1205 00000891 07                      		pop	es
  1206 00000892 31C0                    		xor	ax, ax
  1207 00000894 31D2                    		xor	dx, dx
  1208 00000896 EB19                    		jmp	short PopIret
  1209                                  ; ---------------------------------------------------------------------------
  1210                                  
  1211                                  win386_patch:				; ...
  1212 00000898 89D3                    		mov	bx, dx
  1213 0000089A EB0F                    		jmp	short win386_done
  1214                                  ; ---------------------------------------------------------------------------
  1215                                  
  1216                                  win386_size:				; ...
  1217 0000089C F7C20100                		test	dx, 1
  1218 000008A0 740F                    		jz	short PopIret
  1219 000008A2 B95800                  		mov	cx, 88
  1220 000008A5 EB04                    		jmp	short win386_done
  1221                                  ; ---------------------------------------------------------------------------
  1222                                  
  1223                                  win386_inst:				; ...
  1224 000008A7 31D2                    		xor	dx, dx
  1225 000008A9 EB06                    		jmp	short PopIret
  1226                                  ; ---------------------------------------------------------------------------
  1227                                  
  1228                                  win386_done:				; ...
  1229 000008AB B87CB9                  		mov	ax, 0B97Ch	; WIN_OP_DONE
  1230 000008AE BAABA2                  		mov	dx, 0A2ABh	; DOSMGR_OP_DONE
  1231                                  
  1232                                  PopIret:				; ...
  1233 000008B1 1F                      		pop	ds
  1234 000008B2 CF                      		iret
  1235                                  ; ---------------------------------------------------------------------------
  1236                                  
  1237                                  win_nexti2f:				; ...
  1238 000008B3 1F                      		pop	ds
  1239 000008B4 E955FE                  		jmp	next_i2f
  1240                                  
  1241                                  ; =============== S U B	R O U T	I N E =======================================
  1242                                  
  1243                                  
  1244                                  getwinlast:
  1245 000008B7 8B36[3003]              		mov	si, [CurrentPDB]
  1246 000008BB 4E                      		dec	si
  1247 000008BC 8EC6                    		mov	es, si
  1248 000008BE 2603360300              		add	si, [es:3]
  1249 000008C3 C3                      		retn
  1250                                  
  1251                                  ; ---------------------------------------------------------------------------
  1252                                  
  1253                                  Winold_swap:				; ...
  1254 000008C4 1E                      		push	ds
  1255 000008C5 06                      		push	es
  1256 000008C6 56                      		push	si
  1257 000008C7 57                      		push	di
  1258 000008C8 51                      		push	cx
  1259 000008C9 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  1260 000008CE 3C01                    		cmp	al, 1
  1261 000008D0 751B                    		jnz	short swapin
  1262 000008D2 E8E2FF                  		call	getwinlast
  1263 000008D5 1E                      		push	ds
  1264 000008D6 07                      		pop	es
  1265 000008D7 8EDE                    		mov	ds, si
  1266 000008D9 31F6                    		xor	si, si
  1267 000008DB BF[0600]                		mov	di, WinoldPatch1
  1268 000008DE B90800                  		mov	cx, 8
  1269 000008E1 FC                      		cld
  1270 000008E2 51                      		push	cx
  1271 000008E3 F3A4                    		rep movsb
  1272 000008E5 59                      		pop	cx
  1273 000008E6 BF[CD0D]                		mov	di, WinoldPatch2
  1274 000008E9 F3A4                    		rep movsb
  1275 000008EB EB1B                    		jmp	short winold_done
  1276                                  ; ---------------------------------------------------------------------------
  1277                                  
  1278                                  swapin:					; ...
  1279 000008ED 3C02                    		cmp	al, 2
  1280 000008EF 7517                    		jnz	short winold_done
  1281 000008F1 E8C3FF                  		call	getwinlast
  1282 000008F4 8EC6                    		mov	es, si
  1283 000008F6 31FF                    		xor	di, di
  1284 000008F8 BE[0600]                		mov	si, WinoldPatch1
  1285 000008FB B90800                  		mov	cx, 8
  1286 000008FE FC                      		cld
  1287 000008FF 51                      		push	cx
  1288 00000900 F3A4                    		rep movsb
  1289 00000902 59                      		pop	cx
  1290 00000903 BE[CD0D]                		mov	si, WinoldPatch2
  1291 00000906 F3A4                    		rep movsb
  1292                                  
  1293                                  winold_done:				; ...
  1294 00000908 59                      		pop	cx
  1295 00000909 5F                      		pop	di
  1296 0000090A 5E                      		pop	si
  1297 0000090B 07                      		pop	es
  1298 0000090C 1F                      		pop	ds
  1299 0000090D E9FCFD                  		jmp	next_i2f
  1300                                  ; ---------------------------------------------------------------------------
  1301                                  
  1302                                  DispatchDOS:				; ...
  1303 00000910 2EFF36[9801]            		push	word [cs:FOO]
  1304 00000915 2EFF36[9A01]            		push	word [cs:DTab]
  1305 0000091A 50                      		push	ax
  1306 0000091B 55                      		push	bp
  1307 0000091C 89E5                    		mov	bp, sp
  1308 0000091E 8B460E                  		mov	ax, [bp+0Eh]
  1309 00000921 5D                      		pop	bp
  1310 00000922 E84509                  		call	TableDispatch
  1311 00000925 E9BFFD                  		jmp	BadFunc
  1312                                  ; ---------------------------------------------------------------------------
  1313                                  
  1314                                  DOSGetGroup:				; ...
  1315 00000928 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  1316 0000092D C3                      		retn
  1317                                  ; ---------------------------------------------------------------------------
  1318                                  
  1319                                  DOSInstall:				; ...
  1320 0000092E B0FF                    		mov	al, 0FFh
  1321 00000930 C3                      		retn
  1322                                  
  1323                                  ; =============== S U B	R O U T	I N E =======================================
  1324                                  
  1325                                  
  1326                                  RW32_CONVERT:
  1327 00000931 83F9FF                  		cmp	cx, 0FFFFh
  1328 00000934 742A                    		jz	short new32format
  1329 00000936 50                      		push	ax
  1330 00000937 52                      		push	dx
  1331 00000938 268B460D                		mov	ax, [es:bp+0Dh]
  1332 0000093C 268A5604                		mov	dl, [es:bp+4]
  1333 00000940 80FAFE                  		cmp	dl, 0FEh ; ''
  1334 00000943 7408                    		jz	short letold
  1335 00000945 FEC2                    		inc	dl
  1336 00000947 30F6                    		xor	dh, dh
  1337 00000949 F7E2                    		mul	dx
  1338 0000094B 09D2                    		or	dx, dx
  1339                                  
  1340                                  letold:					; ...
  1341 0000094D 5A                      		pop	dx
  1342 0000094E 58                      		pop	ax
  1343 0000094F 7425                    		jz	short old_style
  1344 00000951 1E                      		push	ds
  1345 00000952 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  1346 00000957 C706[B80D]0702          		mov	word [AbsDskErr], 207h
  1347 0000095D 1F                      		pop	ds
  1348 0000095E F9                      		stc
  1349 0000095F C3                      		retn
  1350                                  ; ---------------------------------------------------------------------------
  1351                                  
  1352                                  new32format:				; ...
  1353 00000960 8B5702                  		mov	dx, [bx+2]
  1354 00000963 1E                      		push	ds
  1355 00000964 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  1356 00000969 8916[0706]              		mov	word [HIGH_SECTOR],	dx
  1357 0000096D 1F                      		pop	ds
  1358 0000096E 8B17                    		mov	dx, [bx]
  1359 00000970 8B4F04                  		mov	cx, [bx+4]
  1360 00000973 C55F06                  		lds	bx, [bx+6]
  1361                                  
  1362                                  old_style:				; ...
  1363 00000976 F8                      		clc
  1364 00000977 C3                      		retn
  1365                                  
  1366                                  ; =============== S U B	R O U T	I N E =======================================
  1367                                  
  1368                                  
  1369                                  Fastxxx_Purge:
  1370 00000978 50                      		push	ax
  1371 00000979 56                      		push	si
  1372 0000097A 52                      		push	dx
  1373 0000097B 1E                      		push	ds
  1374 0000097C 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  1375 00000981 F606[3A0D]80            		test	byte [FastOpenFlg], 80h
  1376 00000986 1F                      		pop	ds
  1377 00000987 740B                    		jz	short nofast
  1378 00000989 B401                    		mov	ah, 1
  1379 0000098B B005                    		mov	al, 5
  1380 0000098D 268A5600                		mov	dl, [es:bp+0]
  1381 00000991 E8621E                  		call	Fast_Dispatch
  1382                                  
  1383                                  nofast:					; ...
  1384 00000994 5A                      		pop	dx
  1385 00000995 5E                      		pop	si
  1386 00000996 58                      		pop	ax
  1387 00000997 C3                      		retn
  1388                                  
  1389                                  ; ---------------------------------------------------------------------------
  1390 00000998 0D0A                    DIVMES:		db 0Dh,0Ah		; ...
  1391 0000099A 446976696465206F76-     		db 'Divide overflow',0Dh,0Ah
  1391 000009A3 6572666C6F770D0A   
  1392 000009AB 1300                    DivMesLen:	dw 19			; ...
  1393 000009AD 596F75206D75737420-     NoVxDErrMsg:	db 'You must have the file WINA20.386 in the root of your boot drive',0Dh ; ...
  1393 000009B6 686176652074686520-
  1393 000009BF 66696C652057494E41-
  1393 000009C8 32302E33383620696E-
  1393 000009D1 2074686520726F6F74-
  1393 000009DA 206F6620796F757220-
  1393 000009E3 626F6F742064726976-
  1393 000009EC 650D               
  1394 000009EE 0A                      		db 0Ah
  1395 000009EF 746F2072756E205769-     		db 'to run Windows in Enhanced Mode',0Dh,0Ah
  1395 000009F8 6E646F777320696E20-
  1395 00000A01 456E68616E63656420-
  1395 00000A0A 4D6F64650D0A       
  1396 00000A10 59                      NLS_YES:	db 'Y'                  ; ...
  1397 00000A11 4E                      NLS_NO:		db 'N'                  ; ...
  1398 00000A12 79                      NLS_yes2:	db 'y'                  ; ...
  1399 00000A13 6E                      NLS_no2:	db 'n'                  ; ...
  1400 00000A14 1B                      CANCHAR:	db 1Bh			; ...
  1401 00000A15 00                      ESCCHAR:	db 0			; ...
  1402 00000A16 404D3B533C3E3D3D3F-     ESCTAB:		db 64, 77, 59, 83, 60, 62, 2 dup(61), 63, 75, 2	dup(82)	; ...
  1402 00000A1F 4B5252             
  1403 00000A22 4141                    		db 2 dup(65)
  1404 00000A24 [7B14]                  ESCFUNC:	dw GETCH		; ...
  1405 00000A26 [9D15]                  		dw TWOESC
  1406 00000A28 [2516]                  		dw EXITINS_ENTERINS
  1407 00000A2A [2516]                  		dw EXITINS_ENTERINS
  1408 00000A2C [2615]                  		dw BACKSP
  1409 00000A2E [1116]                  		dw REEDIT
  1410 00000A30 [1315]                  		dw KILNEW
  1411 00000A32 [A415]                  		dw COPYLIN
  1412 00000A34 [D715]                  		dw SKIPSTR
  1413 00000A36 [AA15]                  		dw COPYSTR
  1414 00000A38 [CD15]                  		dw SKIPONE
  1415 00000A3A [AF15]                  		dw COPYONE
  1416 00000A3C [AF15]                  		dw COPYONE
  1417 00000A3E [2D16]                  		dw CTRLZ
  1418                                  ; ---------------------------------------------------------------------------
  1419                                  ; START	OF FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
  1420                                  
  1421                                  OEMFunctionKey:				; ...
  1422 00000A40 E89709                  		call	$STD_CON_INPUT_NO_ECHO
  1423 00000A43 B10E                    		mov	cl, 14
  1424 00000A45 57                      		push	di
  1425 00000A46 BF[160A]                		mov	di, ESCTAB
  1426 00000A49 06                      		push	es
  1427 00000A4A 0E                      		push	cs
  1428 00000A4B 07                      		pop	es
  1429 00000A4C F2AE                    		repne scasb
  1430 00000A4E 07                      		pop	es
  1431 00000A4F 5F                      		pop	di
  1432 00000A50 D1E1                    		shl	cx, 1
  1433 00000A52 89CD                    		mov	bp, cx
  1434 00000A54 2EFFA6[240A]            		jmp	word [cs:ESCFUNC+bp]
  1435                                  ; END OF FUNCTION CHUNK	FOR $STD_CON_STRING_INPUT
  1436                                  ; ---------------------------------------------------------------------------
  1437                                  
  1438                                  $GET_DATE:				; ...
  1439 00000A59 16                      		push	ss
  1440 00000A5A 1F                      		pop	ds
  1441 00000A5B E8BA00                  		call	READTIME
  1442 00000A5E A1[5203]                		mov	ax, [YEAR]
  1443 00000A61 8B1E[5003]              		mov	bx, word [DAY]
  1444 00000A65 E83AFA                  		call	Get_User_Stack
  1445 00000A68 895C06                  		mov	[si+6],	bx
  1446 00000A6B 05BC07                  		add	ax, 1980
  1447 00000A6E 894404                  		mov	[si+4],	ax
  1448 00000A71 36A0[5603]              		mov	al, [ss:WEEKDAY]
  1449                                  
  1450                                  _RET24:					; ...
  1451 00000A75 C3                      		retn
  1452                                  ; ---------------------------------------------------------------------------
  1453                                  
  1454                                  $SET_DATE:				; ...
  1455 00000A76 B0FF                    		mov	al, -1
  1456 00000A78 81E9BC07                		sub	cx, 1980
  1457 00000A7C 72F7                    		jb	short _RET24
  1458 00000A7E 83F977                  		cmp	cx, 119
  1459 00000A81 7712                    		ja	short RET24
  1460 00000A83 08F6                    		or	dh, dh
  1461 00000A85 74EE                    		jz	short _RET24
  1462 00000A87 08D2                    		or	dl, dl
  1463 00000A89 74EA                    		jz	short _RET24
  1464 00000A8B 80FE0C                  		cmp	dh, 12
  1465 00000A8E 7705                    		ja	short RET24
  1466 00000A90 16                      		push	ss
  1467 00000A91 1F                      		pop	ds
  1468 00000A92 E81901                  		call	DODATE
  1469                                  
  1470                                  RET24:					; ...
  1471 00000A95 C3                      		retn
  1472                                  ; ---------------------------------------------------------------------------
  1473                                  
  1474                                  $GET_TIME:				; ...
  1475 00000A96 16                      		push	ss
  1476 00000A97 1F                      		pop	ds
  1477 00000A98 E87D00                  		call	READTIME
  1478 00000A9B E804FA                  		call	Get_User_Stack
  1479 00000A9E 895406                  		mov	[si+6],	dx
  1480 00000AA1 894C04                  		mov	[si+4],	cx
  1481 00000AA4 30C0                    		xor	al, al
  1482                                  
  1483                                  RET26:					; ...
  1484 00000AA6 C3                      		retn
  1485                                  ; ---------------------------------------------------------------------------
  1486                                  
  1487                                  $SET_TIME:				; ...
  1488 00000AA7 B0FF                    		mov	al, -1
  1489 00000AA9 80FD18                  		cmp	ch, 24
  1490 00000AAC 73F8                    		jnb	short RET26
  1491 00000AAE 80F93C                  		cmp	cl, 60
  1492 00000AB1 73F3                    		jnb	short RET26
  1493 00000AB3 80FE3C                  		cmp	dh, 60
  1494 00000AB6 73EE                    		jnb	short RET26
  1495 00000AB8 80FA64                  		cmp	dl, 100
  1496 00000ABB 73E9                    		jnb	short RET26
  1497 00000ABD 51                      		push	cx
  1498 00000ABE 52                      		push	dx
  1499 00000ABF 16                      		push	ss
  1500 00000AC0 1F                      		pop	ds
  1501 00000AC1 BB[B603]                		mov	bx, TIMEBUF
  1502 00000AC4 B90600                  		mov	cx, 6
  1503 00000AC7 31D2                    		xor	dx, dx
  1504 00000AC9 89D0                    		mov	ax, dx
  1505 00000ACB 53                      		push	bx
  1506 00000ACC E8BA3D                  		call	SETREAD
  1507 00000ACF 1E                      		push	ds
  1508 00000AD0 C536[2E00]              		lds	si, [BCLOCK]
  1509 00000AD4 E8363D                  		call	DEVIOCALL2
  1510 00000AD7 1F                      		pop	ds
  1511 00000AD8 5B                      		pop	bx
  1512 00000AD9 E8E03D                  		call	SETWRITE
  1513 00000ADC 8F06[BA03]              		pop	word [TIMEBUF+4]
  1514 00000AE0 8F06[B803]              		pop	word [TIMEBUF+2]
  1515 00000AE4 C536[2E00]              		lds	si, [BCLOCK]
  1516 00000AE8 E8223D                  		call	DEVIOCALL2
  1517 00000AEB 30C0                    		xor	al, al
  1518 00000AED C3                      		retn
  1519                                  
  1520                                  ; =============== S U B	R O U T	I N E =======================================
  1521                                  
  1522                                  
  1523                                  DATE16	:
  1524 00000AEE 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  1525 00000AF3 51                      		push	cx
  1526 00000AF4 06                      		push	es
  1527 00000AF5 E82000                  		call	READTIME
  1528 00000AF8 07                      		pop	es
  1529 00000AF9 D0E1                    		shl	cl, 1
  1530 00000AFB D0E1                    		shl	cl, 1
  1531 00000AFD D1E1                    		shl	cx, 1
  1532 00000AFF D1E1                    		shl	cx, 1
  1533 00000B01 D1E1                    		shl	cx, 1
  1534 00000B03 D0EE                    		shr	dh, 1
  1535 00000B05 08F1                    		or	cl, dh
  1536 00000B07 89CA                    		mov	dx, cx
  1537 00000B09 A1[5103]                		mov	ax, word [MONTH]
  1538 00000B0C B104                    		mov	cl, 4
  1539 00000B0E D2E0                    		shl	al, cl
  1540 00000B10 D1E0                    		shl	ax, 1
  1541 00000B12 59                      		pop	cx
  1542 00000B13 0A06[5003]              		or	al, [DAY]
  1543                                  
  1544                                  RET21:					; ...
  1545 00000B17 C3                      		retn
  1546                                  
  1547                                  ; =============== S U B	R O U T	I N E =======================================
  1548                                  
  1549                                  
  1550                                  READTIME:
  1551 00000B18 C706[910D]0000          		mov	word [DATE_FLAG], 0
  1552 00000B1E 56                      		push	si
  1553 00000B1F 53                      		push	bx
  1554 00000B20 BB[B603]                		mov	bx, TIMEBUF
  1555 00000B23 B90600                  		mov	cx, 6
  1556 00000B26 31D2                    		xor	dx, dx
  1557 00000B28 89D0                    		mov	ax, dx
  1558 00000B2A E85C3D                  		call	SETREAD
  1559 00000B2D 1E                      		push	ds
  1560 00000B2E C536[2E00]              		lds	si, [BCLOCK]
  1561 00000B32 E8D83C                  		call	DEVIOCALL2
  1562 00000B35 1F                      		pop	ds
  1563 00000B36 5B                      		pop	bx
  1564 00000B37 5E                      		pop	si
  1565 00000B38 A1[B603]                		mov	ax, [TIMEBUF]
  1566 00000B3B 8B0E[B803]              		mov	cx, [TIMEBUF+2]
  1567 00000B3F 8B16[BA03]              		mov	dx, [TIMEBUF+4]
  1568 00000B43 3B06[5403]              		cmp	ax, [DAYCNT]
  1569 00000B47 74CE                    		jz	short RET21
  1570 00000B49 3D36AB                  		cmp	ax, 43830	; FOURYEARS*30
  1571 00000B4C 733D                    		jnb	short RET22
  1572 00000B4E A3[5403]                		mov	[DAYCNT], ax
  1573 00000B51 56                      		push	si
  1574 00000B52 51                      		push	cx
  1575 00000B53 52                      		push	dx
  1576 00000B54 31D2                    		xor	dx, dx
  1577 00000B56 B9B505                  		mov	cx, 1461	; FOURYEARS
  1578 00000B59 F7F1                    		div	cx
  1579 00000B5B D1E0                    		shl	ax, 1
  1580 00000B5D D1E0                    		shl	ax, 1
  1581 00000B5F D1E0                    		shl	ax, 1
  1582 00000B61 89C1                    		mov	cx, ax
  1583 00000B63 BE[140D]                		mov	si, YRTAB
  1584 00000B66 E82300                  		call	DSLIDE
  1585 00000B69 D1E9                    		shr	cx, 1
  1586 00000B6B 7304                    		jnb	short SK
  1587 00000B6D 81C2C800                		add	dx, 200
  1588                                  
  1589                                  SK:					; ...
  1590 00000B71 E82400                  		call	SETYEAR
  1591 00000B74 B101                    		mov	cl, 1
  1592 00000B76 BE[1C0D]                		mov	si, MONTAB
  1593 00000B79 E81000                  		call	DSLIDE
  1594 00000B7C 880E[5103]              		mov	[MONTH], cl
  1595 00000B80 42                      		inc	dx
  1596 00000B81 8816[5003]              		mov	[DAY], dl
  1597 00000B85 E89700                  		call	WKDAY
  1598 00000B88 5A                      		pop	dx
  1599 00000B89 59                      		pop	cx
  1600 00000B8A 5E                      		pop	si
  1601                                  
  1602                                  RET22:					; ...
  1603 00000B8B C3                      		retn
  1604                                  
  1605                                  ; =============== S U B	R O U T	I N E =======================================
  1606                                  
  1607                                  
  1608                                  DSLIDE	:
  1609 00000B8C B400                    		mov	ah, 0
  1610                                  
  1611                                  DSLIDE1:				; ...
  1612 00000B8E AC                      		lodsb
  1613 00000B8F 39C2                    		cmp	dx, ax
  1614 00000B91 72F8                    		jb	short RET22
  1615 00000B93 29C2                    		sub	dx, ax
  1616 00000B95 41                      		inc	cx
  1617 00000B96 EBF6                    		jmp	short DSLIDE1
  1618                                  
  1619                                  
  1620                                  ; =============== S U B	R O U T	I N E =======================================
  1621                                  
  1622                                  
  1623                                  SETYEAR	:
  1624 00000B98 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  1625 00000B9D 880E[5203]              		mov	byte [YEAR], cl
  1626                                  
  1627                                  CHKYR:					; ...
  1628 00000BA1 F6C103                  		test	cl, 3
  1629 00000BA4 B01C                    		mov	al, 28
  1630 00000BA6 7502                    		jnz	short SAVFEB
  1631 00000BA8 FEC0                    		inc	al
  1632                                  
  1633                                  SAVFEB:					; ...
  1634 00000BAA A2[1D0D]                		mov	[february], al
  1635                                  
  1636                                  RET23:					; ...
  1637 00000BAD C3                      		retn
  1638                                  
  1639                                  ; =============== S U B	R O U T	I N E =======================================
  1640                                  
  1641                                  
  1642                                  DODATE	:
  1643 00000BAE E8F0FF                  		call	CHKYR
  1644 00000BB1 88F0                    		mov	al, dh
  1645 00000BB3 BB[1B0D]                		mov	bx, YRTAB+7 ; MONTAB-1
  1646 00000BB6 D7                      		xlat
  1647 00000BB7 38D0                    		cmp	al, dl
  1648 00000BB9 B0FF                    		mov	al, -1
  1649 00000BBB 72F0                    		jb	short RET23
  1650 00000BBD E8D8FF                  		call	SETYEAR
  1651 00000BC0 8916[5003]              		mov	word [DAY], dx
  1652 00000BC4 D1E9                    		shr	cx, 1
  1653 00000BC6 D1E9                    		shr	cx, 1
  1654 00000BC8 B8B505                  		mov	ax, 1461
  1655 00000BCB 89D3                    		mov	bx, dx
  1656 00000BCD F7E1                    		mul	cx
  1657 00000BCF 8A0E[5203]              		mov	cl, byte [YEAR]
  1658 00000BD3 80E103                  		and	cl, 3
  1659 00000BD6 BE[140D]                		mov	si, YRTAB
  1660 00000BD9 89C2                    		mov	dx, ax
  1661 00000BDB D1E1                    		shl	cx, 1
  1662 00000BDD E85200                  		call	DSUM
  1663 00000BE0 88F9                    		mov	cl, bh
  1664 00000BE2 BE[1C0D]                		mov	si, MONTAB
  1665 00000BE5 49                      		dec	cx
  1666 00000BE6 E84900                  		call	DSUM
  1667 00000BE9 88D9                    		mov	cl, bl
  1668 00000BEB 49                      		dec	cx
  1669 00000BEC 01CA                    		add	dx, cx
  1670 00000BEE 92                      		xchg	ax, dx
  1671 00000BEF A3[5403]                		mov	[DAYCNT], ax
  1672 00000BF2 56                      		push	si
  1673 00000BF3 53                      		push	bx
  1674 00000BF4 50                      		push	ax
  1675 00000BF5 BB[B603]                		mov	bx, TIMEBUF
  1676 00000BF8 B90600                  		mov	cx, 6
  1677 00000BFB 31D2                    		xor	dx, dx
  1678 00000BFD 89D0                    		mov	ax, dx
  1679 00000BFF 53                      		push	bx
  1680 00000C00 E8863C                  		call	SETREAD
  1681 00000C03 1E                      		push	ds
  1682 00000C04 C536[2E00]              		lds	si, [BCLOCK]
  1683 00000C08 E8023C                  		call	DEVIOCALL2
  1684 00000C0B 1F                      		pop	ds
  1685 00000C0C 5B                      		pop	bx
  1686 00000C0D E8AC3C                  		call	SETWRITE
  1687 00000C10 8F06[B603]              		pop	word [TIMEBUF]
  1688 00000C14 1E                      		push	ds
  1689 00000C15 C536[2E00]              		lds	si, [BCLOCK]
  1690 00000C19 E8F13B                  		call	DEVIOCALL2
  1691 00000C1C 1F                      		pop	ds
  1692 00000C1D 5B                      		pop	bx
  1693 00000C1E 5E                      		pop	si
  1694                                  
  1695                                  WKDAY:					; ...
  1696 00000C1F A1[5403]                		mov	ax, [DAYCNT]
  1697 00000C22 31D2                    		xor	dx, dx
  1698 00000C24 B90700                  		mov	cx, 7
  1699 00000C27 40                      		inc	ax
  1700 00000C28 40                      		inc	ax
  1701 00000C29 F7F1                    		div	cx
  1702 00000C2B 8816[5603]              		mov	[WEEKDAY], dl
  1703 00000C2F 30C0                    		xor	al, al
  1704 00000C31 C3                      		retn
  1705                                  
  1706                                  ; =============== S U B	R O U T	I N E =======================================
  1707                                  
  1708                                  
  1709                                  DSUM	:
  1710 00000C32 B400                    		mov	ah, 0
  1711 00000C34 E305                    		jcxz	DSUM9
  1712                                  
  1713                                  DSUM1:					; ...
  1714 00000C36 AC                      		lodsb
  1715 00000C37 01C2                    		add	dx, ax
  1716 00000C39 E2FB                    		loop	DSUM1
  1717                                  
  1718                                  DSUM9:					; ...
  1719 00000C3B C3                      		retn
  1720                                  
  1721                                  ; ---------------------------------------------------------------------------
  1722                                  
  1723                                  $GET_VERSION:				; ...
  1724 00000C3C 16                      		push	ss
  1725 00000C3D 1F                      		pop	ds
  1726 00000C3E 8B1E[B403]              		mov	bx, word [USERNUM_hb]
  1727 00000C42 8B0E[B203]              		mov	cx, [USERNUM]
  1728 00000C46 3C01                    		cmp	al, 1
  1729 00000C48 7502                    		jnz	short norm_vers
  1730 00000C4A 30FF                    		xor	bh, bh
  1731                                  
  1732                                  norm_vers:				; ...
  1733 00000C4C 1E                      		push	ds
  1734 00000C4D 8E1E[3003]              		mov	ds, [CurrentPDB]
  1735 00000C51 A14000                  		mov	ax, [40h]	; PDB.Version
  1736 00000C54 1F                      		pop	ds
  1737 00000C55 E84AF8                  		call	Get_User_Stack
  1738 00000C58 8904                    		mov	[si], ax
  1739 00000C5A 895C02                  		mov	[si+2],	bx
  1740 00000C5D 894C04                  		mov	[si+4],	cx
  1741 00000C60 C3                      		retn
  1742                                  ; ---------------------------------------------------------------------------
  1743                                  
  1744                                  $GET_VERIFY_ON_WRITE:			; ...
  1745 00000C61 36A0[FF02]              		mov	al, [ss:VERFLG]
  1746 00000C65 C3                      		retn
  1747                                  ; ---------------------------------------------------------------------------
  1748                                  
  1749                                  $SET_VERIFY_ON_WRITE:			; ...
  1750 00000C66 2401                    		and	al, 1
  1751 00000C68 36A2[FF02]              		mov	[ss:VERFLG], al
  1752                                  
  1753                                  ; =============== S U B	R O U T	I N E =======================================
  1754                                  
  1755                                  
  1756                                  RET27:
  1757 00000C6C C3                      		retn
  1758                                  
  1759                                  ; ---------------------------------------------------------------------------
  1760                                  
  1761                                  $INTERNATIONAL:				; ...
  1762 00000C6D 3CFF                    		cmp	al, 0FFh
  1763 00000C6F 7404                    		jz	short BX_HAS_CODE
  1764 00000C71 88C3                    		mov	bl, al
  1765 00000C73 30FF                    		xor	bh, bh
  1766                                  
  1767                                  BX_HAS_CODE:				; ...
  1768 00000C75 1E                      		push	ds
  1769 00000C76 07                      		pop	es
  1770 00000C77 52                      		push	dx
  1771 00000C78 5F                      		pop	di
  1772 00000C79 16                      		push	ss
  1773 00000C7A 1F                      		pop	ds
  1774 00000C7B 83FFFF                  		cmp	di, 0FFFFh
  1775 00000C7E 7465                    		jz	short international_set
  1776 00000C80 09DB                    		or	bx, bx
  1777 00000C82 7505                    		jnz	short international_find
  1778 00000C84 BE[2A12]                		mov	si, COUNTRY_CDPG
  1779 00000C87 EB41                    		jmp	short international_copy
  1780                                  ; ---------------------------------------------------------------------------
  1781                                  
  1782                                  international_find:			; ...
  1783 00000C89 BD0000                  		mov	bp, 0
  1784 00000C8C E80B00                  		call	international_get
  1785 00000C8F 725C                    		jb	short errtn
  1786 00000C91 83FB00                  		cmp	bx, 0
  1787 00000C94 7534                    		jnz	short international_copy
  1788 00000C96 89D3                    		mov	bx, dx
  1789 00000C98 EB40                    		jmp	short international_ok3
  1790                                  
  1791                                  ; =============== S U B	R O U T	I N E =======================================
  1792                                  
  1793                                  
  1794                                  international_get:
  1795 00000C9A BE[2A12]                		mov	si, COUNTRY_CDPG
  1796 00000C9D 363B5C68                		cmp	bx, [ss:si+68h]
  1797 00000CA1 74C9                    		jz	short RET27
  1798 00000CA3 89DA                    		mov	dx, bx
  1799 00000CA5 31DB                    		xor	bx, bx
  1800 00000CA7 B80014                  		mov	ax, 1400h
  1801 00000CAA CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - INSTALLATION CHECK
  1802                                  					; Return: AL = 00h not installed, OK to	install
  1803                                  					; 01h not installed, not OK
  1804                                  					; FFh installed
  1805 00000CAC 3CFF                    		cmp	al, 0FFh
  1806 00000CAE 7516                    		jnz	short interr
  1807 00000CB0 09ED                    		or	bp, bp
  1808 00000CB2 7507                    		jnz	short stcdpg
  1809 00000CB4 B80414                  		mov	ax, 1404h
  1810 00000CB7 CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - GET COUNTRY INFO
  1811                                  					; BX = code page, DX = country code, [SI -> internal code page structure
  1812                                  					; ES:DI	-> user	buffer
  1813                                  					; Return: AL = status
  1814 00000CB9 EB05                    		jmp	short chkok
  1815                                  ; ---------------------------------------------------------------------------
  1816                                  
  1817                                  stcdpg:					; ...
  1818 00000CBB B80314                  		mov	ax, 1403h
  1819 00000CBE CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - SET COUNTRY INFO
  1820                                  					; DS:SI	-> internal code page structure
  1821                                  					; BX = code page, DX = country code
  1822                                  					; Return: AL = status
  1823                                  
  1824                                  chkok:					; ...
  1825 00000CC0 08C0                    		or	al, al
  1826 00000CC2 74A8                    		jz	short RET27
  1827                                  
  1828                                  setcarry:				; ...
  1829 00000CC4 F9                      		stc
  1830 00000CC5 C3                      		retn
  1831                                  ; ---------------------------------------------------------------------------
  1832                                  
  1833                                  interr:					; ...
  1834 00000CC6 B0FF                    		mov	al, 0FFh
  1835 00000CC8 EBFA                    		jmp	short setcarry
  1836                                  
  1837                                  ; ---------------------------------------------------------------------------
  1838                                  
  1839                                  international_copy:			; ...
  1840 00000CCA 368B5C68                		mov	bx, [ss:si+68h]
  1841 00000CCE BE[9612]                		mov	si, COUNTRY_CDPG_108
  1842 00000CD1 B91800                  		mov	cx, 24
  1843 00000CD4 1E                      		push	ds
  1844 00000CD5 16                      		push	ss
  1845 00000CD6 1F                      		pop	ds
  1846 00000CD7 F3A4                    		rep movsb
  1847 00000CD9 1F                      		pop	ds
  1848                                  
  1849                                  international_ok3:			; ...
  1850 00000CDA E8C5F7                  		call	Get_User_Stack
  1851 00000CDD 895C02                  		mov	[si+2],	bx
  1852                                  
  1853                                  international_ok:			; ...
  1854 00000CE0 89D8                    		mov	ax, bx
  1855                                  
  1856                                  SYS_RET_OK_jmp:				; ...
  1857 00000CE2 E92CF9                  		jmp	SYS_RET_OK
  1858                                  ; ---------------------------------------------------------------------------
  1859                                  
  1860                                  international_set:			; ...
  1861 00000CE5 BD0100                  		mov	bp, 1
  1862 00000CE8 E8AFFF                  		call	international_get
  1863 00000CEB 73F3                    		jnb	short international_ok
  1864                                  
  1865                                  errtn:					; ...
  1866 00000CED 3CFF                    		cmp	al, 0FFh
  1867 00000CEF 7403                    		jz	short errtn2
  1868                                  
  1869                                  errtn1:					; ...
  1870 00000CF1 E926F9                  		jmp	SYS_RET_ERR
  1871                                  ; ---------------------------------------------------------------------------
  1872                                  
  1873                                  errtn2:					; ...
  1874 00000CF4 B001                    		mov	al, 1
  1875 00000CF6 EBF9                    		jmp	short errtn1
  1876                                  ; ---------------------------------------------------------------------------
  1877                                  
  1878                                  $GetExtCntry:				; ...
  1879 00000CF8 3C20                    		cmp	al, 20h	; ' '
  1880 00000CFA 7269                    		jb	short notcap
  1881 00000CFC A880                    		test	al, 80h
  1882 00000CFE 7505                    		jnz	short fileupper
  1883 00000D00 BB[AF0A]                		mov	bx, UCASE_TAB_2
  1884 00000D03 EB03                    		jmp	short capit
  1885                                  ; ---------------------------------------------------------------------------
  1886                                  
  1887                                  fileupper:				; ...
  1888 00000D05 BB[310B]                		mov	bx, FILE_UCASE_TAB_2
  1889                                  
  1890                                  capit:					; ...
  1891 00000D08 3C20                    		cmp	al, 20h	; ' '
  1892 00000D0A 750D                    		jnz	short chkyes
  1893 00000D0C 88D0                    		mov	al, dl
  1894 00000D0E E84645                  		call	GETLET3
  1895 00000D11 E88EF7                  		call	Get_User_Stack
  1896 00000D14 884406                  		mov	[si+6],	al
  1897 00000D17 EB24                    		jmp	short nono
  1898                                  ; ---------------------------------------------------------------------------
  1899                                  
  1900                                  chkyes:					; ...
  1901 00000D19 3C23                    		cmp	al, 23h
  1902 00000D1B 7522                    		jnz	short capstring
  1903 00000D1D 31C0                    		xor	ax, ax
  1904 00000D1F 2E3A16[100A]            		cmp	dl, [cs:NLS_YES]
  1905 00000D24 7416                    		jz	short yesyes
  1906 00000D26 2E3A16[120A]            		cmp	dl, [cs:NLS_yes2]
  1907 00000D2B 740F                    		jz	short yesyes
  1908 00000D2D 2E3A16[110A]            		cmp	dl, [cs:NLS_NO]
  1909 00000D32 7409                    		jz	short nono
  1910 00000D34 2E3A16[130A]            		cmp	dl, [cs:NLS_no2]
  1911 00000D39 7402                    		jz	short nono
  1912 00000D3B 40                      		inc	ax
  1913                                  
  1914                                  yesyes:					; ...
  1915 00000D3C 40                      		inc	ax
  1916                                  
  1917                                  nono:					; ...
  1918 00000D3D EBA3                    		jmp	short SYS_RET_OK_jmp
  1919                                  ; ---------------------------------------------------------------------------
  1920                                  
  1921                                  capstring:				; ...
  1922 00000D3F 89D6                    		mov	si, dx
  1923 00000D41 3C21                    		cmp	al, 21h
  1924 00000D43 750F                    		jnz	short capascii
  1925 00000D45 09C9                    		or	cx, cx
  1926 00000D47 74F4                    		jz	short nono
  1927                                  
  1928                                  concap:					; ...
  1929 00000D49 AC                      		lodsb
  1930 00000D4A E80A45                  		call	GETLET3
  1931 00000D4D 8844FF                  		mov	[si-1],	al
  1932 00000D50 E2F7                    		loop	concap
  1933 00000D52 EBE9                    		jmp	short nono
  1934                                  ; ---------------------------------------------------------------------------
  1935                                  
  1936                                  capascii:				; ...
  1937 00000D54 3C22                    		cmp	al, 22h
  1938 00000D56 7545                    		jnz	short capinval
  1939                                  
  1940                                  concap2:				; ...
  1941 00000D58 AC                      		lodsb
  1942 00000D59 08C0                    		or	al, al
  1943 00000D5B 74E0                    		jz	short nono
  1944 00000D5D E8F744                  		call	GETLET3
  1945 00000D60 8844FF                  		mov	[si-1],	al
  1946 00000D63 EBF3                    		jmp	short concap2
  1947                                  ; ---------------------------------------------------------------------------
  1948                                  
  1949                                  notcap:					; ...
  1950 00000D65 83F905                  		cmp	cx, 5
  1951 00000D68 7278                    		jb	short sizeerror
  1952 00000D6A 16                      		push	ss
  1953 00000D6B 1F                      		pop	ds
  1954 00000D6C BE[2A12]                		mov	si, COUNTRY_CDPG
  1955 00000D6F 83FAFF                  		cmp	dx, 0FFFFh
  1956 00000D72 7503                    		jnz	short GETCDPG
  1957 00000D74 8B5468                  		mov	dx, [si+68h]
  1958                                  
  1959                                  GETCDPG:				; ...
  1960 00000D77 83FBFF                  		cmp	bx, 0FFFFh
  1961 00000D7A 7503                    		jnz	short CHKAGAIN
  1962 00000D7C 8B5C6A                  		mov	bx, [si+6Ah]
  1963                                  
  1964                                  CHKAGAIN:				; ...
  1965 00000D7F 3B5468                  		cmp	dx, [si+68h]
  1966 00000D82 7551                    		jnz	short CHKNLS
  1967 00000D84 3B5C6A                  		cmp	bx, [si+6Ah]
  1968 00000D87 754C                    		jnz	short CHKNLS
  1969 00000D89 8B5C48                  		mov	bx, [si+48h]
  1970 00000D8C 51                      		push	cx
  1971 00000D8D 8B4C4A                  		mov	cx, [si+4Ah]
  1972 00000D90 BE[7612]                		mov	si, COUNTRY_CDPG_76
  1973                                  
  1974                                  NXTENTRY:				; ...
  1975 00000D93 3A04                    		cmp	al, [si]
  1976 00000D95 740B                    		jz	short FOUNDIT
  1977 00000D97 83C605                  		add	si, 5
  1978 00000D9A E2F7                    		loop	NXTENTRY
  1979 00000D9C 59                      		pop	cx
  1980                                  
  1981                                  capinval:				; ...
  1982 00000D9D B001                    		mov	al, 1
  1983                                  
  1984                                  SYS_RET_ERR_jmp:			; ...
  1985 00000D9F E978F8                  		jmp	SYS_RET_ERR
  1986                                  ; ---------------------------------------------------------------------------
  1987                                  
  1988                                  FOUNDIT:				; ...
  1989 00000DA2 A4                      		movsb
  1990 00000DA3 59                      		pop	cx
  1991 00000DA4 3C01                    		cmp	al, 1
  1992 00000DA6 7414                    		jz	short setsize
  1993 00000DA8 B90400                  		mov	cx, 4
  1994 00000DAB B80500                  		mov	ax, 5
  1995                                  
  1996                                  OK_RETN:				; ...
  1997 00000DAE F3A4                    		rep movsb
  1998 00000DB0 89C1                    		mov	cx, ax
  1999 00000DB2 89D8                    		mov	ax, bx
  2000                                  
  2001                                  GETDONE:				; ...
  2002 00000DB4 E8EBF6                  		call	Get_User_Stack
  2003 00000DB7 894C04                  		mov	[si+4],	cx
  2004                                  
  2005                                  jmp_to_nono:				; ...
  2006 00000DBA EB81                    		jmp	short nono
  2007                                  ; ---------------------------------------------------------------------------
  2008                                  
  2009                                  setsize:				; ...
  2010 00000DBC 83E903                  		sub	cx, 3
  2011 00000DBF 390C                    		cmp	[si], cx
  2012 00000DC1 7302                    		jnb	short setsize2
  2013 00000DC3 8B0C                    		mov	cx, [si]
  2014                                  
  2015                                  setsize2:				; ...
  2016 00000DC5 26890D                  		mov	[es:di], cx
  2017 00000DC8 83C702                  		add	di, 2
  2018 00000DCB 83C602                  		add	si, 2
  2019 00000DCE 89C8                    		mov	ax, cx
  2020 00000DD0 83C003                  		add	ax, 3
  2021 00000DD3 EBD9                    		jmp	short OK_RETN
  2022                                  ; ---------------------------------------------------------------------------
  2023                                  
  2024                                  CHKNLS:					; ...
  2025 00000DD5 30E4                    		xor	ah, ah
  2026 00000DD7 50                      		push	ax
  2027 00000DD8 5D                      		pop	bp
  2028 00000DD9 B80014                  		mov	ax, 1400h
  2029 00000DDC CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - INSTALLATION CHECK
  2030                                  					; Return: AL = 00h not installed, OK to	install
  2031                                  					; 01h not installed, not OK
  2032                                  					; FFh installed
  2033 00000DDE 3CFF                    		cmp	al, 0FFh
  2034 00000DE0 7404                    		jz	short NLSNXT
  2035                                  
  2036                                  sizeerror:				; ...
  2037 00000DE2 B001                    		mov	al, 1
  2038                                  
  2039                                  sizeerror_jmp:				; ...
  2040 00000DE4 EBB9                    		jmp	short SYS_RET_ERR_jmp
  2041                                  ; ---------------------------------------------------------------------------
  2042                                  
  2043                                  NLSNXT:					; ...
  2044 00000DE6 B80214                  		mov	ax, 1402h
  2045 00000DE9 CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - GET COUNTRY INFO
  2046                                  					; BP = subfunction, BX = code page
  2047                                  					; DX = country code, [SI -> internal code page structure
  2048                                  					; ES:DI	-> user	buffer,	CX = size of user buffer
  2049                                  					; Return: AL = status
  2050                                  					; 00h successful
  2051                                  					; else DOS error code
  2052 00000DEB 3C00                    		cmp	al, 0
  2053 00000DED 7505                    		jnz	short NLSERROR
  2054 00000DEF 8B4448                  		mov	ax, [si+48h]
  2055 00000DF2 EBC0                    		jmp	short GETDONE
  2056                                  ; ---------------------------------------------------------------------------
  2057                                  
  2058                                  NLSERROR:				; ...
  2059 00000DF4 EBEE                    		jmp	short sizeerror_jmp
  2060                                  ; ---------------------------------------------------------------------------
  2061                                  
  2062                                  $GetSetCdPg:				; ...
  2063 00000DF6 16                      		push	ss
  2064 00000DF7 1F                      		pop	ds
  2065 00000DF8 BE[2A12]                		mov	si, COUNTRY_CDPG
  2066 00000DFB 3C01                    		cmp	al, 1
  2067 00000DFD 7511                    		jnz	short setglpg
  2068 00000DFF 8B5C6A                  		mov	bx, [si+6Ah]
  2069 00000E02 8B5448                  		mov	dx, [si+48h]
  2070 00000E05 E89AF6                  		call	Get_User_Stack
  2071 00000E08 895C02                  		mov	[si+2],	bx
  2072 00000E0B 895406                  		mov	[si+6],	dx
  2073                                  
  2074                                  OK_RETURN:				; ...
  2075 00000E0E EBAA                    		jmp	short jmp_to_nono
  2076                                  ; ---------------------------------------------------------------------------
  2077                                  
  2078                                  setglpg:				; ...
  2079 00000E10 3C02                    		cmp	al, 2
  2080 00000E12 7533                    		jnz	short nomem
  2081 00000E14 8B5468                  		mov	dx, [si+68h]
  2082 00000E17 B80014                  		mov	ax, 1400h
  2083 00000E1A CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - INSTALLATION CHECK
  2084                                  					; Return: AL = 00h not installed, OK to	install
  2085                                  					; 01h not installed, not OK
  2086                                  					; FFh installed
  2087 00000E1C 3CFF                    		cmp	al, 0FFh
  2088 00000E1E 7527                    		jnz	short nomem
  2089 00000E20 B80114                  		mov	ax, 1401h
  2090 00000E23 CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - CHANGE CODE PAGE
  2091                                  					; DS:SI	-> internal code page structure
  2092                                  					; BX = new code	page, DX = country code???
  2093                                  					; Return: AL = status
  2094                                  					; 00h successful
  2095                                  					; else DOS error code
  2096 00000E25 08C0                    		or	al, al
  2097 00000E27 74E5                    		jz	short OK_RETURN
  2098 00000E29 3C41                    		cmp	al, 65
  2099 00000E2B 7518                    		jnz	short seterr
  2100 00000E2D B84100                  		mov	ax, 65
  2101 00000E30 A3[2403]                		mov	word [EXTERR], ax
  2102 00000E33 C606[2603]06            		mov	byte [EXTERR_ACT_CLASS], 6
  2103 00000E38 C606[2703]05            		mov	byte [EXTERR_ACT_CLASS+1], 5
  2104 00000E3D C606[2303]04            		mov	byte [EXTERR_LOCUS], 4
  2105 00000E42 E9DDF7                  		jmp	From_GetSet
  2106                                  ; ---------------------------------------------------------------------------
  2107                                  
  2108                                  seterr:					; ...
  2109 00000E45 EBAD                    		jmp	short NLSERROR
  2110                                  ; ---------------------------------------------------------------------------
  2111                                  
  2112                                  nomem:					; ...
  2113 00000E47 B001                    		mov	al, 1
  2114 00000E49 EBFA                    		jmp	short seterr
  2115                                  ; ---------------------------------------------------------------------------
  2116                                  
  2117                                  $GET_DRIVE_FREESPACE:			; ...
  2118 00000E4B 16                      		push	ss
  2119 00000E4C 1F                      		pop	ds
  2120 00000E4D 88D0                    		mov	al, dl
  2121 00000E4F E88A5E                  		call	GETTHISDRV
  2122                                  
  2123                                  SET_AX_RET:				; ...
  2124 00000E52 7218                    		jb	short BADFDRV
  2125 00000E54 E89E1F                  		call	DISK_INFO
  2126 00000E57 87D3                    		xchg	dx, bx
  2127 00000E59 72F7                    		jb	short SET_AX_RET
  2128 00000E5B 30E4                    		xor	ah, ah
  2129                                  
  2130                                  DoSt:					; ...
  2131 00000E5D E842F6                  		call	Get_User_Stack
  2132 00000E60 895406                  		mov	[si+6],	dx
  2133 00000E63 894C04                  		mov	[si+4],	cx
  2134 00000E66 895C02                  		mov	[si+2],	bx
  2135 00000E69 8904                    		mov	[si], ax
  2136 00000E6B C3                      		retn
  2137                                  ; ---------------------------------------------------------------------------
  2138                                  
  2139                                  BADFDRV:				; ...
  2140 00000E6C E8C1F7                  		call	FCB_RET_ERR
  2141 00000E6F B8FFFF                  		mov	ax, -1
  2142 00000E72 EBE9                    		jmp	short DoSt
  2143                                  ; ---------------------------------------------------------------------------
  2144                                  
  2145                                  $GET_DMA:				; ...
  2146 00000E74 368B1E[2C03]            		mov	bx, word [ss:DMAADD]
  2147 00000E79 368B0E[2E03]            		mov	cx, word [ss:DMAADD+2]
  2148 00000E7E E821F6                  		call	Get_User_Stack
  2149 00000E81 895C02                  		mov	[si+2],	bx
  2150 00000E84 894C10                  		mov	[si+10h], cx
  2151 00000E87 C3                      		retn
  2152                                  ; ---------------------------------------------------------------------------
  2153                                  
  2154                                  $SET_DMA:				; ...
  2155 00000E88 368916[2C03]            		mov	word [ss:DMAADD], dx
  2156 00000E8D 368C1E[2E03]            		mov	word [ss:DMAADD+2], ds
  2157 00000E92 C3                      		retn
  2158                                  ; ---------------------------------------------------------------------------
  2159                                  
  2160                                  $GET_DEFAULT_DRIVE:			; ...
  2161 00000E93 36A0[3603]              		mov	al, [ss:CURDRV]
  2162 00000E97 C3                      		retn
  2163                                  ; ---------------------------------------------------------------------------
  2164                                  
  2165                                  $SET_DEFAULT_DRIVE:			; ...
  2166 00000E98 88D0                    		mov	al, dl
  2167 00000E9A FEC0                    		inc	al
  2168 00000E9C E8205E                  		call	GetVisDrv
  2169 00000E9F 7204                    		jb	short SETRET
  2170 00000EA1 36A2[3603]              		mov	[ss:CURDRV], al
  2171                                  
  2172                                  SETRET:					; ...
  2173 00000EA5 36A0[4700]              		mov	al, [ss:CDSCOUNT]
  2174 00000EA9 C3                      		retn
  2175                                  
  2176                                  ; =============== S U B	R O U T	I N E =======================================
  2177                                  
  2178                                  
  2179                                  $GET_INTERRUPT_VECTOR:
  2180 00000EAA E83100                  		call	RECSET
  2181 00000EAD 26C41F                  		les	bx, [es:bx]
  2182 00000EB0 E8EFF5                  		call	Get_User_Stack
  2183 00000EB3 895C02                  		mov	[si+2],	bx
  2184 00000EB6 8C4410                  		mov	word [si+10h], es
  2185 00000EB9 C3                      		retn
  2186                                  
  2187                                  ; ---------------------------------------------------------------------------
  2188                                  
  2189                                  $SET_INTERRUPT_VECTOR:			; ...
  2190 00000EBA E82100                  		call	RECSET
  2191 00000EBD FA                      		cli
  2192 00000EBE 268917                  		mov	[es:bx], dx
  2193 00000EC1 268C5F02                		mov	word [es:bx+2], ds
  2194 00000EC5 FB                      		sti
  2195 00000EC6 36F606[8600]04          		test	byte [ss:DOS_FLAG], 4
  2196 00000ECC 7501                    		jnz	short siv_1
  2197 00000ECE C3                      		retn
  2198                                  ; ---------------------------------------------------------------------------
  2199                                  
  2200                                  siv_1:					; ...
  2201 00000ECF 36803E[8500]00          		cmp	byte [ss:A20OFF_COUNT], 0
  2202 00000ED5 7506                    		jnz	short siv_2
  2203 00000ED7 36C606[8500]01          		mov	byte [ss:A20OFF_COUNT], 1
  2204                                  
  2205                                  siv_2:					; ...
  2206 00000EDD C3                      		retn
  2207                                  
  2208                                  ; =============== S U B	R O U T	I N E =======================================
  2209                                  
  2210                                  
  2211                                  RECSET:
  2212 00000EDE 31DB                    		xor	bx, bx
  2213 00000EE0 8EC3                    		mov	es, bx
  2214 00000EE2 88C3                    		mov	bl, al
  2215 00000EE4 D1E3                    		shl	bx, 1
  2216 00000EE6 D1E3                    		shl	bx, 1
  2217 00000EE8 C3                      		retn
  2218                                  
  2219                                  ; ---------------------------------------------------------------------------
  2220                                  
  2221                                  $CHAR_OPER:				; ...
  2222 00000EE9 08C0                    		or	al, al
  2223 00000EEB B22F                    		mov	dl, '/'
  2224 00000EED 7407                    		jz	short chop_1
  2225 00000EEF 3C02                    		cmp	al, 2
  2226 00000EF1 B2FF                    		mov	dl, 0FFh
  2227 00000EF3 7401                    		jz	short chop_1
  2228 00000EF5 C3                      		retn
  2229                                  ; ---------------------------------------------------------------------------
  2230                                  
  2231                                  chop_1:					; ...
  2232 00000EF6 E8A9F5                  		call	Get_User_Stack
  2233 00000EF9 895406                  		mov	[si+6],	dx
  2234 00000EFC C3                      		retn
  2235                                  ; ---------------------------------------------------------------------------
  2236                                  
  2237                                  $GetExtendedError:			; ...
  2238 00000EFD 16                      		push	ss
  2239 00000EFE 1F                      		pop	ds
  2240 00000EFF A1[2403]                		mov	ax, [EXTERR]
  2241 00000F02 C43E[2803]              		les	di, [EXTERRPT]
  2242 00000F06 8B1E[2603]              		mov	bx, [EXTERR_ACT_CLASS]
  2243 00000F0A 8A2E[2303]              		mov	ch, [EXTERR_LOCUS]
  2244 00000F0E E891F5                  		call	Get_User_Stack
  2245 00000F11 897C0A                  		mov	[si+0Ah], di
  2246 00000F14 8C4410                  		mov	word [si+10h], es
  2247 00000F17 895C02                  		mov	[si+2],	bx
  2248 00000F1A 894C04                  		mov	[si+4],	cx
  2249                                  
  2250                                  jmp_SYS_RET_OK:				; ...
  2251 00000F1D E9F1F6                  		jmp	SYS_RET_OK
  2252                                  ; ---------------------------------------------------------------------------
  2253 00000F20 56                      		push	si
  2254 00000F21 BE[2A12]                		mov	si, COUNTRY_CDPG
  2255 00000F24 368B446A                		mov	ax, [ss:si+6Ah]
  2256 00000F28 5E                      		pop	si
  2257 00000F29 C3                      		retn
  2258                                  ; ---------------------------------------------------------------------------
  2259                                  
  2260                                  $ECS_Call:				; ...
  2261 00000F2A 08C0                    		or	al, al
  2262 00000F2C 7512                    		jnz	short _okok
  2263 00000F2E E871F5                  		call	Get_User_Stack
  2264 00000F31 C74408[E50C]            		mov	word [si+8],	DBCS_TAB_2
  2265 00000F36 06                      		push	es
  2266 00000F37 2E8E06[0700]            		mov	es, [cs:DosDSeg]
  2267 00000F3C 8C440E                  		mov	word [si+14], es
  2268 00000F3F 07                      		pop	es
  2269                                  
  2270                                  _okok:					; ...
  2271 00000F40 EBDB                    		jmp	short jmp_SYS_RET_OK
  2272                                  ; ---------------------------------------------------------------------------
  2273                                  
  2274                                  $PARSE_FILE_DESCRIPTOR:			; ...
  2275 00000F42 E8AE41                  		call	MAKEFCB
  2276 00000F45 56                      		push	si
  2277 00000F46 E859F5                  		call	Get_User_Stack
  2278 00000F49 8F4408                  		pop	word [si+8]
  2279 00000F4C C3                      		retn
  2280                                  ; ---------------------------------------------------------------------------
  2281                                  
  2282                                  $SLEAZEFUNC:				; ...
  2283 00000F4D B200                    		mov	dl, 0
  2284                                  
  2285                                  $SLEAZEFUNCDL:				; ...
  2286 00000F4F 16                      		push	ss
  2287 00000F50 1F                      		pop	ds
  2288 00000F51 88D0                    		mov	al, dl
  2289 00000F53 E8865D                  		call	GETTHISDRV
  2290                                  
  2291                                  SET_AL_RET:				; ...
  2292 00000F56 721E                    		jb	short BADSLDRIVE
  2293 00000F58 E89A1E                  		call	DISK_INFO
  2294 00000F5B 72F9                    		jb	short SET_AL_RET
  2295 00000F5D 8826[9805]              		mov	byte [FATBYTE], ah
  2296 00000F61 BF[9805]                		mov	di, FATBYTE
  2297 00000F64 30E4                    		xor	ah, ah
  2298 00000F66 E839F5                  		call	Get_User_Stack
  2299 00000F69 894C04                  		mov	[si+4],	cx
  2300 00000F6C 895C06                  		mov	[si+6],	bx
  2301 00000F6F 897C02                  		mov	[si+2],	di
  2302 00000F72 8C540E                  		mov	word [si+0Eh], ss
  2303 00000F75 C3                      		retn
  2304                                  ; ---------------------------------------------------------------------------
  2305                                  
  2306                                  BADSLDRIVE:				; ...
  2307 00000F76 E9B7F6                  		jmp	FCB_RET_ERR
  2308                                  ; ---------------------------------------------------------------------------
  2309                                  
  2310                                  $GET_INDOS_FLAG:			; ...
  2311 00000F79 E826F5                  		call	Get_User_Stack
  2312 00000F7C C74402[2103]            		mov	word [si+2],	INDOS
  2313 00000F81 8C5410                  		mov	word [si+10h], ss
  2314 00000F84 C3                      		retn
  2315                                  ; ---------------------------------------------------------------------------
  2316                                  
  2317                                  $GET_IN_VARS:				; ...
  2318 00000F85 E81AF5                  		call	Get_User_Stack
  2319 00000F88 C74402[2600]            		mov	word [si+2],	DPBHEAD	; SYSINITVARS
  2320 00000F8D 8C5410                  		mov	word [si+10h], ss
  2321 00000F90 C3                      		retn
  2322                                  ; ---------------------------------------------------------------------------
  2323                                  
  2324                                  $GET_DEFAULT_DPB:			; ...
  2325 00000F91 B200                    		mov	dl, 0
  2326                                  
  2327                                  $GET_DPB:				; ...
  2328 00000F93 16                      		push	ss
  2329 00000F94 1F                      		pop	ds
  2330 00000F95 88D0                    		mov	al, dl
  2331 00000F97 E8425D                  		call	GETTHISDRV
  2332 00000F9A 7222                    		jb	short ISNODRV
  2333 00000F9C C43E[A205]              		les	di, [THISCDS]
  2334 00000FA0 26F6454480              		test	byte [es:di+44h], 80h
  2335 00000FA5 7517                    		jnz	short ISNODRV
  2336 00000FA7 E8B003                  		call	ECritDisk
  2337 00000FAA E83849                  		call	FATREAD_CDS
  2338 00000FAD E8CA03                  		call	LCritDisk
  2339 00000FB0 720C                    		jb	short ISNODRV
  2340 00000FB2 E8EDF4                  		call	Get_User_Stack
  2341 00000FB5 896C02                  		mov	[si+2],	bp
  2342 00000FB8 8C440E                  		mov	word [si+0Eh], es
  2343 00000FBB 30C0                    		xor	al, al
  2344 00000FBD C3                      		retn
  2345                                  ; ---------------------------------------------------------------------------
  2346                                  
  2347                                  ISNODRV:				; ...
  2348 00000FBE B0FF                    		mov	al, 0FFh
  2349 00000FC0 C3                      		retn
  2350                                  ; ---------------------------------------------------------------------------
  2351                                  
  2352                                  $DISK_RESET:				; ...
  2353 00000FC1 B0FF                    		mov	al, 0FFh
  2354 00000FC3 16                      		push	ss
  2355 00000FC4 1F                      		pop	ds
  2356 00000FC5 E89203                  		call	ECritDisk
  2357 00000FC8 830E[1106]04            		or	word [DOS34_FLAG], 4
  2358 00000FCD E8854C                  		call	FLUSHBUF
  2359 00000FD0 8326[1106]FB            		and	word [DOS34_FLAG], 0FFFBh
  2360 00000FD5 C706[B50D]0000          		mov	word [SC_STATUS], 0
  2361 00000FDB BBFFFF                  		mov	bx, 0FFFFh
  2362 00000FDE 891E[2000]              		mov	word [LastBuffer+2], bx
  2363 00000FE2 891E[1E00]              		mov	word [LastBuffer], bx
  2364 00000FE6 E89103                  		call	LCritDisk
  2365 00000FE9 B8FFFF                  		mov	ax, 0FFFFh
  2366 00000FEC 50                      		push	ax
  2367 00000FED B82011                  		mov	ax, 1120h
  2368 00000FF0 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - FLUSH ALL DISK BUFFERS
  2369                                  					; DS = DOS CS
  2370                                  					; Return: CF clear (successful)
  2371 00000FF2 58                      		pop	ax
  2372 00000FF3 C3                      		retn
  2373                                  ; ---------------------------------------------------------------------------
  2374 00000FF4 0300                    word3		dw 3			; ...
  2375                                  
  2376                                  ; =============== S U B	R O U T	I N E =======================================
  2377                                  
  2378                                  
  2379                                  $SETDPB	:
  2380 00000FF6 89EF                    		mov	di, bp
  2381 00000FF8 83C702                  		add	di, 2
  2382 00000FFB AD                      		lodsw
  2383 00000FFC AB                      		stosw
  2384 00000FFD 807C0300                		cmp	byte [si+3], 0
  2385 00001001 7507                    		jnz	short yesfat
  2386 00001003 26C6450400              		mov	byte [es:di+4], 0
  2387 00001008 EB77                    		jmp	short setend
  2388                                  ; ---------------------------------------------------------------------------
  2389                                  
  2390                                  yesfat:					; ...
  2391 0000100A 89C2                    		mov	dx, ax
  2392 0000100C AC                      		lodsb
  2393 0000100D FEC8                    		dec	al
  2394 0000100F AA                      		stosb
  2395 00001010 FEC0                    		inc	al
  2396 00001012 30E4                    		xor	ah, ah
  2397                                  
  2398                                  LOG2LOOP:				; ...
  2399 00001014 A801                    		test	al, 1
  2400 00001016 7506                    		jnz	short SAVLOG
  2401 00001018 FEC4                    		inc	ah
  2402 0000101A D0E8                    		shr	al, 1
  2403 0000101C EBF6                    		jmp	short LOG2LOOP
  2404                                  ; ---------------------------------------------------------------------------
  2405                                  
  2406                                  SAVLOG:					; ...
  2407 0000101E 88E0                    		mov	al, ah
  2408 00001020 AA                      		stosb
  2409 00001021 88C3                    		mov	bl, al
  2410 00001023 A5                      		movsw
  2411 00001024 AC                      		lodsb
  2412 00001025 AA                      		stosb
  2413 00001026 88C7                    		mov	bh, al
  2414 00001028 AD                      		lodsw
  2415 00001029 AB                      		stosw
  2416 0000102A B105                    		mov	cl, 5
  2417 0000102C D3EA                    		shr	dx, cl
  2418 0000102E 48                      		dec	ax
  2419 0000102F 01D0                    		add	ax, dx
  2420 00001031 89D1                    		mov	cx, dx
  2421 00001033 31D2                    		xor	dx, dx
  2422 00001035 F7F1                    		div	cx
  2423 00001037 89C1                    		mov	cx, ax
  2424 00001039 47                      		inc	di
  2425 0000103A 47                      		inc	di
  2426 0000103B A5                      		movsw
  2427 0000103C AC                      		lodsb
  2428 0000103D 26884617                		mov	[es:bp+17h], al
  2429 00001041 AD                      		lodsw
  2430 00001042 AB                      		stosw
  2431 00001043 88FA                    		mov	dl, bh
  2432 00001045 30F6                    		xor	dh, dh
  2433 00001047 F7E2                    		mul	dx
  2434 00001049 26034606                		add	ax, [es:bp+6]
  2435 0000104D AB                      		stosw
  2436 0000104E 01C8                    		add	ax, cx
  2437 00001050 2689460B                		mov	[es:bp+0Bh], ax
  2438 00001054 88D9                    		mov	cl, bl
  2439 00001056 26837E0D00              		cmp	word [es:bp+0Dh], 0
  2440 0000105B 751C                    		jnz	short normal_dpb
  2441 0000105D 30ED                    		xor	ch, ch
  2442 0000105F 8B5C08                  		mov	bx, [si+8]
  2443 00001062 8B540A                  		mov	dx, [si+0Ah]
  2444 00001065 29C3                    		sub	bx, ax
  2445 00001067 83DA00                  		sbb	dx, 0
  2446 0000106A 09C9                    		or	cx, cx
  2447 0000106C 7407                    		jz	short norot
  2448                                  
  2449                                  rott:					; ...
  2450 0000106E F8                      		clc
  2451 0000106F D1DA                    		rcr	dx, 1
  2452 00001071 D1DB                    		rcr	bx, 1
  2453 00001073 E2F9                    		loop	rott
  2454                                  
  2455                                  norot:					; ...
  2456 00001075 89D8                    		mov	ax, bx
  2457 00001077 EB08                    		jmp	short setend
  2458                                  ; ---------------------------------------------------------------------------
  2459                                  
  2460                                  normal_dpb:				; ...
  2461 00001079 262B460D                		sub	ax, [es:bp+0Dh]
  2462 0000107D F7D8                    		neg	ax
  2463 0000107F D3E8                    		shr	ax, cl
  2464                                  
  2465                                  setend:					; ...
  2466 00001081 40                      		inc	ax
  2467 00001082 89C3                    		mov	bx, ax
  2468 00001084 268B460F                		mov	ax, [es:bp+0Fh]
  2469 00001088 26F76602                		mul	word [es:bp+2]
  2470 0000108C 81FBF60F                		cmp	bx, 0FF6h
  2471 00001090 720D                    		jb	short setend_fat12
  2472 00001092 D1EA                    		shr	dx, 1
  2473 00001094 751C                    		jnz	short setend_faterr
  2474 00001096 D1D8                    		rcr	ax, 1
  2475 00001098 3DF70F                  		cmp	ax, 0FF7h
  2476 0000109B 7215                    		jb	short setend_faterr
  2477 0000109D EB0E                    		jmp	short setend_fat16
  2478                                  ; ---------------------------------------------------------------------------
  2479                                  
  2480                                  setend_fat12:				; ...
  2481 0000109F 01C0                    		add	ax, ax
  2482 000010A1 11D2                    		adc	dx, dx
  2483 000010A3 83FA03                  		cmp	dx, 3
  2484 000010A6 730A                    		jnb	short setend_faterr
  2485 000010A8 2EF736[F40F]            		div	word [cs:word3]
  2486                                  
  2487                                  setend_fat16:				; ...
  2488 000010AD 48                      		dec	ax
  2489 000010AE 39D8                    		cmp	ax, bx
  2490 000010B0 7602                    		jbe	short setend_fat
  2491                                  
  2492                                  setend_faterr:				; ...
  2493 000010B2 89D8                    		mov	ax, bx
  2494                                  
  2495                                  setend_fat:				; ...
  2496 000010B4 2689460D                		mov	[es:bp+0Dh], ax
  2497 000010B8 26C7461D0000            		mov	word [es:bp+1Dh], 0
  2498 000010BE 26C7461FFFFF            		mov	word [es:bp+1Fh], 0FFFFh
  2499 000010C4 C3                      		retn
  2500                                  
  2501                                  ; =============== S U B	R O U T	I N E =======================================
  2502                                  
  2503                                  
  2504                                  $DUP_PDB:
  2505 000010C5 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  2506 000010CA C606[A803]FF            		mov	byte [CreatePDB], 0FFh
  2507 000010CF 8E1E[3003]              		mov	ds, [CurrentPDB]
  2508 000010D3 56                      		push	si
  2509 000010D4 EB0A                    		jmp	short CreateCopy
  2510                                  
  2511                                  ; =============== S U B	R O U T	I N E =======================================
  2512                                  
  2513                                  
  2514                                  $CREATE_PROCESS_DATA_BLOCK:
  2515 000010D6 E8C9F3                  		call	Get_User_Stack
  2516 000010D9 8E5C14                  		mov	ds, word [si+14h]
  2517 000010DC FF360200                		push	word [2]	; PDB.BLOCK_LEN
  2518                                  
  2519                                  CreateCopy:				; ...
  2520 000010E0 8EC2                    		mov	es, dx
  2521 000010E2 31F6                    		xor	si, si
  2522 000010E4 89F7                    		mov	di, si
  2523 000010E6 B98000                  		mov	cx, 128
  2524 000010E9 F3A5                    		rep movsw
  2525 000010EB B91400                  		mov	cx, 20
  2526 000010EE BF1800                  		mov	di, 18h		; PDB.JFN_TABLE
  2527 000010F1 1E                      		push	ds
  2528 000010F2 C5363400                		lds	si, [34h]	; PDB.JFN_Pointer
  2529 000010F6 F3A4                    		rep movsb
  2530 000010F8 1F                      		pop	ds
  2531 000010F9 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  2532 000010FE 803E[A803]00            		cmp	byte [CreatePDB], 0
  2533 00001103 744D                    		jz	short Create_PDB_cont
  2534 00001105 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  2535 0000110A 31DB                    		xor	bx, bx
  2536 0000110C B91400                  		mov	cx, 20
  2537                                  
  2538                                  Create_dup_jfn:				; ...
  2539 0000110F 06                      		push	es
  2540 00001110 E89757                  		call	SFFromHandle
  2541 00001113 B0FF                    		mov	al, 0FFh
  2542 00001115 7224                    		jb	short CreateStash
  2543 00001117 26F6450610              		test	byte [es:di+6], 10h
  2544 0000111C 751D                    		jnz	short CreateStash
  2545 0000111E 268A6502                		mov	ah, [es:di+2]
  2546 00001122 80E4F0                  		and	ah, 0F0h
  2547 00001125 80FC70                  		cmp	ah, 70h
  2548 00001128 7411                    		jz	short CreateStash
  2549 0000112A 893E[9E05]              		mov	word [THISSFT], di
  2550 0000112E 8C06[A005]              		mov	word [THISSFT+2], es
  2551 00001132 E8091A                  		call	DOS_DUP
  2552 00001135 E85557                  		call	pJFNFromHandle
  2553 00001138 268A05                  		mov	al, [es:di]
  2554                                  
  2555                                  CreateStash:				; ...
  2556 0000113B 07                      		pop	es
  2557 0000113C 26884718                		mov	[es:bx+18h], al
  2558 00001140 43                      		inc	bx
  2559 00001141 E2CC                    		loop	Create_dup_jfn
  2560 00001143 8B1E[3003]              		mov	bx, [CurrentPDB]
  2561 00001147 26891E1600              		mov	[es:16h], bx	; PDB.PARENT_PID
  2562 0000114C 8C06[3003]              		mov	[CurrentPDB], es
  2563 00001150 8EDB                    		mov	ds, bx
  2564                                  
  2565                                  Create_PDB_cont:			; ...
  2566 00001152 1E                      		push	ds
  2567 00001153 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  2568 00001158 C606[A803]00            		mov	byte [CreatePDB], 0
  2569 0000115D 1F                      		pop	ds
  2570 0000115E 58                      		pop	ax
  2571                                  
  2572                                  SETMEM:					; ...
  2573 0000115F 31C9                    		xor	cx, cx
  2574 00001161 8ED9                    		mov	ds, cx
  2575 00001163 8EC2                    		mov	es, dx
  2576 00001165 BE8800                  		mov	si, 88h
  2577 00001168 BF0A00                  		mov	di, 10
  2578 0000116B B90600                  		mov	cx, 6
  2579 0000116E F3A5                    		rep movsw
  2580 00001170 26A30200                		mov	[es:2], ax
  2581 00001174 29D0                    		sub	ax, dx
  2582 00001176 3DFF0F                  		cmp	ax, 0FFFh
  2583 00001179 7603                    		jbe	short HAVDIF
  2584 0000117B B8FF0F                  		mov	ax, 0FFFh
  2585                                  
  2586                                  HAVDIF:					; ...
  2587 0000117E 83E810                  		sub	ax, 10h
  2588 00001181 BB0C00                  		mov	bx, 0Ch
  2589 00001184 29C3                    		sub	bx, ax
  2590 00001186 B104                    		mov	cl, 4
  2591 00001188 D3E0                    		shl	ax, cl
  2592 0000118A 8EDA                    		mov	ds, dx
  2593 0000118C A30600                  		mov	[6], ax
  2594 0000118F 891E0800                		mov	[8], bx
  2595 00001193 3DF0FE                  		cmp	ax, 0FEF0h
  2596 00001196 740C                    		jz	short addr_ok
  2597 00001198 C7060600C000            		mov	word [6], 0C0h
  2598 0000119E C70608000000            		mov	word [8], 0
  2599                                  
  2600                                  addr_ok:				; ...
  2601 000011A4 C7060000CD20            		mov	word [0], 20CDh
  2602 000011AA C60605009A              		mov	byte [5], 9Ah
  2603 000011AF C7065000CD21            		mov	word [50h], 21CDh
  2604 000011B5 C6065200CB              		mov	byte [52h], 0CBh
  2605 000011BA C70634001800            		mov	word [34h], 18h
  2606 000011C0 8C1E3600                		mov	word [36h], ds
  2607 000011C4 C70632001400            		mov	word [32h], 20
  2608 000011CA C7063800FFFF            		mov	word [38h], 0FFFFh
  2609 000011D0 C7063A00FFFF            		mov	word [3Ah], 0FFFFh
  2610 000011D6 26C70640000616          		mov	word [es:40h], 1606h ; 6.22
  2611 000011DD C3                      		retn
  2612                                  
  2613                                  ; ---------------------------------------------------------------------------
  2614                                  
  2615                                  $GSetMediaID:				; ...
  2616 000011DE B96608                  		mov	cx, 866h
  2617 000011E1 3C00                    		cmp	al, 0
  2618 000011E3 7407                    		jz	short doioctl
  2619 000011E5 3C01                    		cmp	al, 1
  2620 000011E7 7509                    		jnz	short errorfunc
  2621 000011E9 B94608                  		mov	cx, 846h
  2622                                  
  2623                                  doioctl:				; ...
  2624 000011EC B00D                    		mov	al, 0Dh
  2625 000011EE E87111                  		call	$IOCTL
  2626 000011F1 C3                      		retn
  2627                                  ; ---------------------------------------------------------------------------
  2628                                  
  2629                                  errorfunc:				; ...
  2630 000011F2 B001                    		mov	al, 1
  2631 000011F4 E923F4                  		jmp	SYS_RET_ERR
  2632                                  
  2633                                  ; =============== S U B	R O U T	I N E =======================================
  2634                                  
  2635                                  
  2636                                  StrCmp:
  2637 000011F7 56                      		push	si
  2638 000011F8 57                      		push	di
  2639 000011F9 50                      		push	ax
  2640                                  
  2641                                  Cmplp:					; ...
  2642 000011FA AC                      		lodsb
  2643 000011FB E83440                  		call	UCase
  2644 000011FE E88640                  		call	PATHCHRCMP
  2645 00001201 88C4                    		mov	ah, al
  2646 00001203 268A05                  		mov	al, [es:di]
  2647 00001206 47                      		inc	di
  2648 00001207 E82840                  		call	UCase
  2649 0000120A E87A40                  		call	PATHCHRCMP
  2650 0000120D 38C4                    		cmp	ah, al
  2651 0000120F 7504                    		jnz	short PopRet
  2652 00001211 08C0                    		or	al, al
  2653 00001213 75E5                    		jnz	short Cmplp
  2654                                  
  2655                                  PopRet:					; ...
  2656 00001215 58                      		pop	ax
  2657 00001216 5F                      		pop	di
  2658 00001217 5E                      		pop	si
  2659 00001218 C3                      		retn
  2660                                  
  2661                                  ; =============== S U B	R O U T	I N E =======================================
  2662                                  
  2663                                  
  2664                                  StrCpy:
  2665 00001219 50                      		push	ax
  2666                                  
  2667                                  CPYLoop:				; ...
  2668 0000121A AC                      		lodsb
  2669 0000121B E81440                  		call	UCase
  2670 0000121E E86640                  		call	PATHCHRCMP
  2671 00001221 AA                      		stosb
  2672 00001222 08C0                    		or	al, al
  2673 00001224 75F4                    		jnz	short CPYLoop
  2674 00001226 58                      		pop	ax
  2675 00001227 C3                      		retn
  2676                                  
  2677                                  ; =============== S U B	R O U T	I N E =======================================
  2678                                  
  2679                                  
  2680                                  FStrCpy:
  2681 00001228 50                      		push	ax
  2682                                  
  2683                                  FCPYLoop:				; ...
  2684 00001229 AC                      		lodsb
  2685 0000122A AA                      		stosb
  2686 0000122B 08C0                    		or	al, al
  2687 0000122D 75FA                    		jnz	short FCPYLoop
  2688 0000122F 58                      		pop	ax
  2689 00001230 C3                      		retn
  2690                                  
  2691                                  ; =============== S U B	R O U T	I N E =======================================
  2692                                  
  2693                                  
  2694                                  StrLen:
  2695 00001231 57                      		push	di
  2696 00001232 50                      		push	ax
  2697 00001233 B9FFFF                  		mov	cx, 0FFFFh	; 65535
  2698 00001236 30C0                    		xor	al, al
  2699 00001238 F2AE                    		repne scasb
  2700 0000123A F7D1                    		not	cx
  2701 0000123C 58                      		pop	ax
  2702 0000123D 5F                      		pop	di
  2703 0000123E C3                      		retn
  2704                                  
  2705                                  ; =============== S U B	R O U T	I N E =======================================
  2706                                  
  2707                                  
  2708                                  DStrLen:
  2709 0000123F E80700                  		call	XCHGP
  2710 00001242 E8ECFF                  		call	StrLen
  2711 00001245 E80100                  		call	XCHGP
  2712 00001248 C3                      		retn
  2713                                  
  2714                                  ; =============== S U B	R O U T	I N E =======================================
  2715                                  
  2716                                  
  2717                                  XCHGP:
  2718 00001249 1E                      		push	ds
  2719 0000124A 06                      		push	es
  2720 0000124B 1F                      		pop	ds
  2721 0000124C 07                      		pop	es
  2722 0000124D 87F7                    		xchg	si, di
  2723                                  
  2724                                  xchgp_retn:				; ...
  2725 0000124F C3                      		retn
  2726                                  
  2727                                  ; =============== S U B	R O U T	I N E =======================================
  2728                                  
  2729                                  
  2730                                  Idle:
  2731 00001250 36803E[7205]00          		cmp	byte [ss:FSHARING], 0
  2732 00001256 75F7                    		jnz	short xchgp_retn
  2733 00001258 51                      		push	cx
  2734 00001259 368B0E[1C00]            		mov	cx, [ss:RetryLoop]
  2735 0000125E E308                    		jcxz	Idle3
  2736                                  
  2737                                  Idle1:					; ...
  2738 00001260 51                      		push	cx
  2739 00001261 31C9                    		xor	cx, cx
  2740                                  
  2741                                  Idle2:					; ...
  2742 00001263 E2FE                    		loop	Idle2
  2743 00001265 59                      		pop	cx
  2744 00001266 E2F8                    		loop	Idle1
  2745                                  
  2746                                  Idle3:					; ...
  2747 00001268 59                      		pop	cx
  2748 00001269 C3                      		retn
  2749                                  
  2750                                  ; =============== S U B	R O U T	I N E =======================================
  2751                                  
  2752                                  ; Attributes: bp-based frame
  2753                                  
  2754                                  TableDispatch:
  2755                                  
  2756                                  ;TFrame.Index	= byte ptr  4
  2757                                  ;TFrame.Tab	= word ptr  6
  2758                                  
  2759                                  TFrame.Index	equ 4
  2760                                  TFrame.Tab	equ 6
  2761                                  
  2762 0000126A 55                      		push	bp
  2763 0000126B 89E5                    		mov	bp, sp
  2764 0000126D 53                      		push	bx
  2765 0000126E 8B5E06                  		mov	bx, [bp+TFrame.Tab]
  2766 00001271 2E8A1F                  		mov	bl, [cs:bx]
  2767 00001274 385E04                  		cmp	[bp+TFrame.Index], bl
  2768 00001277 7317                    		jnb	short TableError
  2769 00001279 8A5E04                  		mov	bl, [bp+TFrame.Index]
  2770 0000127C 30FF                    		xor	bh, bh
  2771 0000127E D1E3                    		shl	bx, 1
  2772 00001280 43                      		inc	bx
  2773 00001281 035E06                  		add	bx, [bp+TFrame.Tab]
  2774 00001284 2E8B1F                  		mov	bx, [cs:bx]
  2775 00001287 895E06                  		mov	[bp+TFrame.Tab], bx
  2776 0000128A 5B                      		pop	bx
  2777 0000128B 5D                      		pop	bp
  2778 0000128C 83C404                  		add	sp, 4
  2779 0000128F C3                      		retn
  2780                                  ; ---------------------------------------------------------------------------
  2781                                  
  2782                                  TableError:				; ...
  2783 00001290 5B                      		pop	bx
  2784 00001291 5D                      		pop	bp
  2785 00001292 C20600                  		retn	6
  2786                                  
  2787                                  ; =============== S U B	R O U T	I N E =======================================
  2788                                  
  2789                                  
  2790                                  TestNet	:
  2791 00001295 2E8E06[0700]            		mov	es, [cs:DosDSeg]
  2792 0000129A 26C43E[A205]            		les	di, [es:THISCDS]
  2793 0000129F 83FFFF                  		cmp	di, 0FFFFh
  2794 000012A2 7408                    		jz	short CMCRet
  2795 000012A4 26F6454480              		test	byte [es:di+44h], 80h
  2796 000012A9 7501                    		jnz	short CMCRet
  2797 000012AB C3                      		retn
  2798                                  ; ---------------------------------------------------------------------------
  2799                                  
  2800                                  CMCRet:					; ...
  2801 000012AC F5                      		cmc
  2802 000012AD C3                      		retn
  2803                                  
  2804                                  ; =============== S U B	R O U T	I N E =======================================
  2805                                  
  2806                                  
  2807                                  IsSFTNet:
  2808 000012AE 26F6450680              		test	byte [es:di+6], 80h
  2809 000012B3 C3                      		retn
  2810                                  
  2811                                  ; ---------------------------------------------------------------------------
  2812                                  
  2813                                  FastInit:				; ...
  2814 000012B4 06                      		push	es
  2815 000012B5 2E8E06[0700]            		mov	es, [cs:DosDSeg]
  2816 000012BA BF[320D]                		mov	di, FastTable_2
  2817 000012BD 4B                      		dec	bx
  2818 000012BE 89DA                    		mov	dx, bx
  2819 000012C0 D1E3                    		shl	bx, 1
  2820 000012C2 D1E3                    		shl	bx, 1
  2821 000012C4 01DF                    		add	di, bx
  2822 000012C6 268B4502                		mov	ax, [es:di+2]
  2823 000012CA 8CC9                    		mov	cx, cs
  2824 000012CC 39C8                    		cmp	ax, cx
  2825 000012CE 7407                    		jz	short ok_install
  2826 000012D0 09C0                    		or	ax, ax
  2827 000012D2 7403                    		jz	short ok_install
  2828 000012D4 F9                      		stc
  2829 000012D5 EB17                    		jmp	short FSret
  2830                                  ; ---------------------------------------------------------------------------
  2831                                  
  2832                                  ok_install:				; ...
  2833 000012D7 83FEFF                  		cmp	si, 0FFFFh
  2834 000012DA 7412                    		jz	short FSret
  2835 000012DC 8CD9                    		mov	cx, ds
  2836 000012DE 26894D02                		mov	[es:di+2], cx
  2837 000012E2 268935                  		mov	[es:di], si
  2838 000012E5 BF[3A0D]                		mov	di, FastOpenFlg
  2839 000012E8 01D7                    		add	di, dx
  2840 000012EA 26800D80                		or	byte [es:di], 80h
  2841                                  
  2842                                  FSret:					; ...
  2843 000012EE 07                      		pop	es
  2844 000012EF C3                      		retn
  2845                                  ; ---------------------------------------------------------------------------
  2846                                  
  2847                                  FastRet:				; ...
  2848 000012F0 F9                      		stc
  2849 000012F1 19C0                    		sbb	ax, ax
  2850 000012F3 CB                      		retf
  2851                                  ; ---------------------------------------------------------------------------
  2852                                  
  2853                                  NLS_OPEN:				; ...
  2854 000012F4 88C8                    		mov	al, cl
  2855 000012F6 E8375E                  		call	$OPEN
  2856 000012F9 C3                      		retn
  2857                                  ; ---------------------------------------------------------------------------
  2858                                  
  2859                                  NLS_LSEEK:				; ...
  2860 000012FA 36FF36[8405]            		push	word [ss:USER_SP]
  2861 000012FF 36FF36[8605]            		push	word [ss:USER_SS]
  2862 00001304 E81000                  		call	Fake_User_Stack
  2863 00001307 89E8                    		mov	ax, bp
  2864 00001309 E8B957                  		call	$LSEEK
  2865 0000130C 368F06[8605]            		pop	word [ss:USER_SS]
  2866 00001311 368F06[8405]            		pop	word [ss:USER_SP]
  2867 00001316 C3                      		retn
  2868                                  
  2869                                  ; =============== S U B	R O U T	I N E =======================================
  2870                                  
  2871                                  
  2872                                  Fake_User_Stack:
  2873 00001317 36A1[6A0D]              		mov	ax, [ss:USER_SP_2F]
  2874 0000131B 36A3[8405]              		mov	[ss:USER_SP], ax
  2875 0000131F 8CD0                    		mov	ax, ss
  2876 00001321 36A3[8605]              		mov	[ss:USER_SS], ax
  2877 00001325 C3                      		retn
  2878                                  
  2879                                  ; ---------------------------------------------------------------------------
  2880                                  
  2881                                  GetDevList:				; ...
  2882 00001326 BE[280D]                		mov	si, SysInitTable
  2883 00001329 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  2884 0000132E C534                    		lds	si, [si]
  2885 00001330 8B4422                  		mov	ax, [si+22h]
  2886 00001333 8B5C24                  		mov	bx, [si+24h]
  2887 00001336 C3                      		retn
  2888                                  ; ---------------------------------------------------------------------------
  2889                                  
  2890                                  NLS_IOCTL:				; ...
  2891 00001337 36FF36[8405]            		push	word [ss:USER_SP]
  2892 0000133C 36FF36[8605]            		push	word [ss:USER_SS]
  2893 00001341 E8D3FF                  		call	Fake_User_Stack
  2894 00001344 89E8                    		mov	ax, bp
  2895 00001346 E81910                  		call	$IOCTL
  2896 00001349 368F06[8605]            		pop	word [ss:USER_SS]
  2897 0000134E 368F06[8405]            		pop	word [ss:USER_SP]
  2898 00001353 C3                      		retn
  2899                                  ; ---------------------------------------------------------------------------
  2900                                  
  2901                                  NLS_GETEXT:				; ...
  2902 00001354 36A1[2403]              		mov	ax, [ss:EXTERR]
  2903 00001358 C3                      		retn
  2904                                  ; ---------------------------------------------------------------------------
  2905                                  
  2906                                  MSG_RETRIEVAL:				; ...
  2907 00001359 C3                      		retn
  2908                                  
  2909                                  ; =============== S U B	R O U T	I N E =======================================
  2910                                  
  2911                                  
  2912                                  ECritDisk:
  2913                                  
  2914                                  ; FUNCTION CHUNK AT 5146 SIZE 0000000E BYTES
  2915                                  ; FUNCTION CHUNK AT 5155 SIZE 00000005 BYTES
  2916                                  
  2917 0000135A 9C                      		pushf
  2918 0000135B 36803E[0C0D]00          		cmp	byte [ss:redir_patch], 0
  2919 00001361 740F                    		jz	short ECritDisk_2
  2920 00001363 EB01                    		jmp	short ECritDisk_1
  2921                                  
  2922                                  ; =============== S U B	R O U T	I N E =======================================
  2923                                  
  2924                                  
  2925                                  ECritDisk_iret:
  2926 00001365 CF                      		iret
  2927                                  
  2928                                  ; ---------------------------------------------------------------------------
  2929                                  ; START	OF FUNCTION CHUNK FOR ECritDisk
  2930                                  
  2931                                  ECritDisk_1:				; ...
  2932 00001366 0E                      		push	cs
  2933 00001367 E8FBFF                  		call	ECritDisk_iret
  2934 0000136A 50                      		push	ax
  2935 0000136B B80180                  		mov	ax, 8001h
  2936 0000136E CD2A                    		int	2Ah		; Microsoft Networks - BEGIN DOS CRITICAL SECTION
  2937                                  					; AL = critical	section	number (00h-0Fh)
  2938 00001370 58                      		pop	ax
  2939 00001371 C3                      		retn
  2940                                  ; ---------------------------------------------------------------------------
  2941                                  
  2942                                  ECritDisk_2:				; ...
  2943 00001372 EB01                    		jmp	short ECritDisk_3
  2944                                  ; END OF FUNCTION CHUNK	FOR ECritDisk
  2945                                  
  2946                                  ; =============== S U B	R O U T	I N E =======================================
  2947                                  
  2948                                  
  2949                                  ECritDisk_iret2:
  2950 00001374 CF                      		iret
  2951                                  
  2952                                  ; ---------------------------------------------------------------------------
  2953                                  ; START	OF FUNCTION CHUNK FOR ECritDisk
  2954                                  
  2955                                  ECritDisk_3:				; ...
  2956 00001375 0E                      		push	cs
  2957 00001376 E8FBFF                  		call	ECritDisk_iret2
  2958 00001379 C3                      		retn
  2959                                  ; END OF FUNCTION CHUNK	FOR ECritDisk
  2960                                  
  2961                                  ; =============== S U B	R O U T	I N E =======================================
  2962                                  
  2963                                  
  2964                                  LCritDisk:
  2965                                  
  2966                                  ; FUNCTION CHUNK AT 5166 SIZE 0000000E BYTES
  2967                                  ; FUNCTION CHUNK AT 5175 SIZE 00000005 BYTES
  2968                                  
  2969 0000137A 9C                      		pushf
  2970 0000137B 36803E[0C0D]00          		cmp	byte [ss:redir_patch], 0
  2971 00001381 740F                    		jz	short LCritDisk_2
  2972 00001383 EB01                    		jmp	short LCritDisk_1
  2973                                  
  2974                                  ; =============== S U B	R O U T	I N E =======================================
  2975                                  
  2976                                  
  2977                                  LCritDisk_iret:
  2978 00001385 CF                      		iret
  2979                                  
  2980                                  ; ---------------------------------------------------------------------------
  2981                                  ; START	OF FUNCTION CHUNK FOR LCritDisk
  2982                                  
  2983                                  LCritDisk_1:				; ...
  2984 00001386 0E                      		push	cs
  2985 00001387 E8FBFF                  		call	LCritDisk_iret
  2986 0000138A 50                      		push	ax
  2987 0000138B B80181                  		mov	ax, 8101h
  2988 0000138E CD2A                    		int	2Ah		; Microsoft Networks - END DOS CRITICAL	SECTION
  2989                                  					; AL = critical	section	number (00h-0Fh)
  2990 00001390 58                      		pop	ax
  2991 00001391 C3                      		retn
  2992                                  ; ---------------------------------------------------------------------------
  2993                                  
  2994                                  LCritDisk_2:				; ...
  2995 00001392 EB01                    		jmp	short LCritDisk_3
  2996                                  ; END OF FUNCTION CHUNK	FOR LCritDisk
  2997                                  
  2998                                  ; =============== S U B	R O U T	I N E =======================================
  2999                                  
  3000                                  
  3001                                  LCritDisk_iret2:
  3002 00001394 CF                      		iret
  3003                                  
  3004                                  ; ---------------------------------------------------------------------------
  3005                                  ; START	OF FUNCTION CHUNK FOR LCritDisk
  3006                                  
  3007                                  LCritDisk_3:				; ...
  3008 00001395 0E                      		push	cs
  3009 00001396 E8FBFF                  		call	LCritDisk_iret2
  3010 00001399 C3                      		retn
  3011                                  ; END OF FUNCTION CHUNK	FOR LCritDisk
  3012                                  
  3013                                  ; =============== S U B	R O U T	I N E =======================================
  3014                                  
  3015                                  
  3016                                  ECritDevice:
  3017                                  
  3018                                  ; FUNCTION CHUNK AT 5186 SIZE 0000000E BYTES
  3019                                  ; FUNCTION CHUNK AT 5195 SIZE 00000005 BYTES
  3020                                  
  3021 0000139A 9C                      		pushf
  3022 0000139B 36803E[0C0D]00          		cmp	byte [ss:redir_patch], 0
  3023 000013A1 740F                    		jz	short ECritDevice_2
  3024 000013A3 EB01                    		jmp	short ECritDevice_1
  3025                                  
  3026                                  ; =============== S U B	R O U T	I N E =======================================
  3027                                  
  3028                                  
  3029                                  ECritDevice_iret:
  3030 000013A5 CF                      		iret
  3031                                  
  3032                                  ; ---------------------------------------------------------------------------
  3033                                  ; START	OF FUNCTION CHUNK FOR ECritDevice
  3034                                  
  3035                                  ECritDevice_1:				; ...
  3036 000013A6 0E                      		push	cs
  3037 000013A7 E8FBFF                  		call	ECritDevice_iret
  3038 000013AA 50                      		push	ax
  3039 000013AB B80280                  		mov	ax, 8002h
  3040 000013AE CD2A                    		int	2Ah		; Microsoft Networks - BEGIN DOS CRITICAL SECTION
  3041                                  					; AL = critical	section	number (00h-0Fh)
  3042 000013B0 58                      		pop	ax
  3043 000013B1 C3                      		retn
  3044                                  ; ---------------------------------------------------------------------------
  3045                                  
  3046                                  ECritDevice_2:				; ...
  3047 000013B2 EB01                    		jmp	short ECritDevice_3
  3048                                  ; END OF FUNCTION CHUNK	FOR ECritDevice
  3049                                  
  3050                                  ; =============== S U B	R O U T	I N E =======================================
  3051                                  
  3052                                  
  3053                                  ECritDevice_iret2:
  3054 000013B4 CF                      		iret
  3055                                  
  3056                                  ; ---------------------------------------------------------------------------
  3057                                  ; START	OF FUNCTION CHUNK FOR ECritDevice
  3058                                  
  3059                                  ECritDevice_3:				; ...
  3060 000013B5 0E                      		push	cs
  3061 000013B6 E8FBFF                  		call	ECritDevice_iret2
  3062 000013B9 C3                      		retn
  3063                                  ; END OF FUNCTION CHUNK	FOR ECritDevice
  3064                                  
  3065                                  ; =============== S U B	R O U T	I N E =======================================
  3066                                  
  3067                                  LCritDevice:
  3068                                  
  3069                                  ; FUNCTION CHUNK AT 51A6 SIZE 0000000E BYTES
  3070                                  ; FUNCTION CHUNK AT 51B5 SIZE 00000005 BYTES
  3071                                  
  3072 000013BA 9C                      		pushf
  3073 000013BB 36803E[0C0D]00          		cmp	byte [ss:redir_patch], 0
  3074 000013C1 740F                    		jz	short LCritDevice_2
  3075 000013C3 EB01                    		jmp	short LCritDevice_1
  3076                                  
  3077                                  ; =============== S U B	R O U T	I N E =======================================
  3078                                  
  3079                                  
  3080                                  LCritDevice_iret:
  3081 000013C5 CF                      		iret
  3082                                  
  3083                                  ; ---------------------------------------------------------------------------
  3084                                  ; START	OF FUNCTION CHUNK FOR LCritDevice
  3085                                  
  3086                                  LCritDevice_1:				; ...
  3087 000013C6 0E                      		push	cs
  3088 000013C7 E8FBFF                  		call	LCritDevice_iret
  3089 000013CA 50                      		push	ax
  3090 000013CB B80281                  		mov	ax, 8102h
  3091 000013CE CD2A                    		int	2Ah		; Microsoft Networks - END DOS CRITICAL	SECTION
  3092                                  					; AL = critical	section	number (00h-0Fh)
  3093 000013D0 58                      		pop	ax
  3094 000013D1 C3                      		retn
  3095                                  ; ---------------------------------------------------------------------------
  3096                                  
  3097                                  LCritDevice_2:				; ...
  3098 000013D2 EB01                    		jmp	short LCritDevice_3
  3099                                  ; END OF FUNCTION CHUNK	FOR LCritDevice
  3100                                  
  3101                                  ; =============== S U B	R O U T	I N E =======================================
  3102                                  
  3103                                  
  3104                                  LCritDevice_iret2:
  3105 000013D4 CF                      		iret
  3106                                  
  3107                                  ; ---------------------------------------------------------------------------
  3108                                  ; START	OF FUNCTION CHUNK FOR LCritDevice
  3109                                  
  3110                                  LCritDevice_3:				; ...
  3111 000013D5 0E                      		push	cs
  3112 000013D6 E8FBFF                  		call	LCritDevice_iret2
  3113 000013D9 C3                      		retn
  3114                                  ; END OF FUNCTION CHUNK	FOR LCritDevice
  3115                                  
  3116                                  ; =============== S U B	R O U T	I N E =======================================
  3117                                  
  3118                                  
  3119                                  $STD_CON_INPUT_NO_ECHO:
  3120 000013DA 1E                      		push	ds
  3121 000013DB 56                      		push	si
  3122                                  
  3123                                  INTEST:					; ...
  3124 000013DC E8783F                  		call	STATCHK
  3125 000013DF 753B                    		jnz	short GET
  3126 000013E1 36803E[A00A]00          		cmp	byte [ss:PRINTER_FLAG], 0
  3127 000013E7 7505                    		jnz	short no_sys_wait
  3128 000013E9 B405                    		mov	ah, 5
  3129 000013EB E84532                  		call	IOFUNC
  3130                                  
  3131                                  no_sys_wait:				; ...
  3132 000013EE B484                    		mov	ah, 84h
  3133 000013F0 CD2A                    		int	2Ah		; Microsoft Networks - KEYBOARD	BUSY LOOP
  3134 000013F2 36803E[910D]FF          		cmp	byte [ss:DATE_FLAG], 0FFh
  3135 000013F8 751B                    		jnz	short NoUpdate
  3136 000013FA 50                      		push	ax
  3137 000013FB 53                      		push	bx
  3138 000013FC 51                      		push	cx
  3139 000013FD 52                      		push	dx
  3140 000013FE 1E                      		push	ds
  3141 000013FF 16                      		push	ss
  3142 00001400 1F                      		pop	ds
  3143 00001401 B80000                  		mov	ax, 0
  3144 00001404 E8D202                  		call	Save_Restore_Packet
  3145 00001407 E80EF7                  		call	READTIME
  3146 0000140A B80100                  		mov	ax, 1
  3147 0000140D E8C902                  		call	Save_Restore_Packet
  3148 00001410 1F                      		pop	ds
  3149 00001411 5A                      		pop	dx
  3150 00001412 59                      		pop	cx
  3151 00001413 5B                      		pop	bx
  3152 00001414 58                      		pop	ax
  3153                                  
  3154                                  NoUpdate:				; ...
  3155 00001415 36FF06[910D]            		inc	word [ss:DATE_FLAG]
  3156 0000141A EBC0                    		jmp	short INTEST
  3157                                  ; ---------------------------------------------------------------------------
  3158                                  
  3159                                  GET:					; ...
  3160 0000141C 30E4                    		xor	ah, ah
  3161 0000141E E81232                  		call	IOFUNC
  3162 00001421 5E                      		pop	si
  3163 00001422 1F                      		pop	ds
  3164 00001423 36C606[900D]00          		mov	byte [ss:SCAN_FLAG], 0
  3165 00001429 3C00                    		cmp	al, 0
  3166 0000142B 7506                    		jnz	short noscan
  3167 0000142D 36C606[900D]01          		mov	byte [ss:SCAN_FLAG], 1
  3168                                  
  3169                                  noscan:					; ...
  3170 00001433 C3                      		retn
  3171                                  
  3172                                  ; ---------------------------------------------------------------------------
  3173                                  
  3174                                  $STD_CON_STRING_OUTPUT:			; ...
  3175 00001434 89D6                    		mov	si, dx
  3176                                  
  3177                                  STRING_OUT1:				; ...
  3178 00001436 AC                      		lodsb
  3179 00001437 3C24                    		cmp	al, '$'
  3180 00001439 74F8                    		jz	short noscan
  3181 0000143B E8CD02                  		call	OUTT
  3182 0000143E EBF6                    		jmp	short STRING_OUT1
  3183                                  
  3184                                  ; =============== S U B	R O U T	I N E =======================================
  3185                                  
  3186                                  
  3187                                  $STD_CON_STRING_INPUT:
  3188                                  
  3189                                  ; FUNCTION CHUNK AT 4820 SIZE 00000019 BYTES
  3190                                  ; FUNCTION CHUNK AT 52C5 SIZE 00000005 BYTES
  3191                                  ; FUNCTION CHUNK AT 52F3 SIZE 00000019 BYTES
  3192                                  ; FUNCTION CHUNK AT 537D SIZE 00000044 BYTES
  3193                                  ; FUNCTION CHUNK AT 53F1 SIZE 00000021 BYTES
  3194                                  
  3195 00001440 8CD0                    		mov	ax, ss
  3196 00001442 8EC0                    		mov	es, ax
  3197 00001444 89D6                    		mov	si, dx
  3198 00001446 30ED                    		xor	ch, ch
  3199 00001448 AD                      		lodsw
  3200 00001449 08C0                    		or	al, al
  3201 0000144B 74E6                    		jz	short noscan
  3202 0000144D 88E3                    		mov	bl, ah
  3203 0000144F 88EF                    		mov	bh, ch
  3204 00001451 38D8                    		cmp	al, bl
  3205 00001453 7605                    		jbe	short NOEDIT
  3206 00001455 80380D                  		cmp	byte [bx+si], 0Dh
  3207 00001458 7402                    		jz	short EDITON
  3208                                  
  3209                                  NOEDIT:					; ...
  3210 0000145A 88EB                    		mov	bl, ch
  3211                                  
  3212                                  EDITON:					; ...
  3213 0000145C 88C2                    		mov	dl, al
  3214 0000145E 4A                      		dec	dx
  3215                                  
  3216                                  NEWLIN:					; ...
  3217 0000145F 36A0[F901]              		mov	al, [ss:CARPOS]
  3218 00001463 36A2[FA01]              		mov	[ss:STARTPOS], al
  3219 00001467 56                      		push	si
  3220 00001468 BF[FB01]                		mov	di, INBUF
  3221 0000146B 36882E[7905]            		mov	byte [ss:INSMODE], ch
  3222 00001470 88EF                    		mov	bh, ch
  3223 00001472 88EE                    		mov	dh, ch
  3224 00001474 E863FF                  		call	$STD_CON_INPUT_NO_ECHO
  3225 00001477 3C0A                    		cmp	al, 0Ah
  3226 00001479 7503                    		jnz	short GOTCH
  3227                                  
  3228                                  GETCH:					; ...
  3229 0000147B E85CFF                  		call	$STD_CON_INPUT_NO_ECHO
  3230                                  
  3231                                  GOTCH:					; ...
  3232 0000147E 3C06                    		cmp	al, 6
  3233 00001480 74F9                    		jz	short GETCH
  3234 00001482 2E3A06[150A]            		cmp	al, [cs:ESCCHAR]
  3235 00001487 7443                    		jz	short ESCAPE
  3236 00001489 3C7F                    		cmp	al, 7Fh
  3237 0000148B 7436                    		jz	short BACKSPJ
  3238 0000148D 3C08                    		cmp	al, 8
  3239 0000148F 7432                    		jz	short BACKSPJ
  3240 00001491 3C17                    		cmp	al, 17h
  3241 00001493 90                      		nop
  3242 00001494 90                      		nop
  3243 00001495 3C15                    		cmp	al, 15h
  3244 00001497 90                      		nop
  3245 00001498 90                      		nop
  3246 00001499 3C0D                    		cmp	al, 0Dh
  3247 0000149B 7432                    		jz	short ENDLIN
  3248 0000149D 3C0A                    		cmp	al, 0Ah
  3249 0000149F 7444                    		jz	short PHYCRLF
  3250 000014A1 2E3A06[140A]            		cmp	al, [cs:CANCHAR]
  3251 000014A6 746B                    		jz	short KILNEW
  3252                                  
  3253                                  SAVCH:					; ...
  3254 000014A8 38D6                    		cmp	dh, dl
  3255 000014AA 7319                    		jnb	short BUFFUL
  3256 000014AC AA                      		stosb
  3257 000014AD FEC6                    		inc	dh
  3258 000014AF E8F002                  		call	BUFOUT
  3259 000014B2 36803E[7905]00          		cmp	byte [ss:INSMODE], 0
  3260 000014B8 75C1                    		jnz	short GETCH
  3261 000014BA 38DF                    		cmp	bh, bl
  3262 000014BC 73BD                    		jnb	short GETCH
  3263 000014BE 46                      		inc	si
  3264 000014BF FEC7                    		inc	bh
  3265 000014C1 EBB8                    		jmp	short GETCH
  3266                                  ; ---------------------------------------------------------------------------
  3267                                  
  3268                                  BACKSPJ:				; ...
  3269 000014C3 EB61                    		jmp	short BACKSP
  3270                                  ; ---------------------------------------------------------------------------
  3271                                  
  3272                                  BUFFUL:					; ...
  3273 000014C5 B007                    		mov	al, 7
  3274 000014C7 E84102                  		call	OUTT
  3275 000014CA EBAF                    		jmp	short GETCH
  3276                                  ; ---------------------------------------------------------------------------
  3277                                  
  3278                                  ESCAPE:					; ...
  3279 000014CC E971F5                  		jmp	OEMFunctionKey
  3280                                  ; ---------------------------------------------------------------------------
  3281                                  
  3282                                  ENDLIN:					; ...
  3283 000014CF AA                      		stosb
  3284 000014D0 E83802                  		call	OUTT
  3285 000014D3 5F                      		pop	di
  3286 000014D4 8875FF                  		mov	[di-1],	dh
  3287 000014D7 FEC6                    		inc	dh
  3288                                  
  3289                                  ; =============== S U B	R O U T	I N E =======================================
  3290                                  
  3291                                  
  3292                                  COPYNEW:
  3293 000014D9 1E                      		push	ds
  3294 000014DA 06                      		push	es
  3295 000014DB 1F                      		pop	ds
  3296 000014DC 07                      		pop	es
  3297 000014DD BE[FB01]                		mov	si, INBUF
  3298 000014E0 88F1                    		mov	cl, dh
  3299 000014E2 F3A4                    		rep movsb
  3300                                  
  3301                                  OLDBAK_RETN:				; ...
  3302 000014E4 C3                      		retn
  3303                                  
  3304                                  ; ---------------------------------------------------------------------------
  3305                                  ; START	OF FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
  3306                                  
  3307                                  PHYCRLF:				; ...
  3308 000014E5 E84A01                  		call	CRLF
  3309 000014E8 EB91                    		jmp	short GETCH
  3310                                  ; END OF FUNCTION CHUNK	FOR $STD_CON_STRING_INPUT
  3311                                  ; ---------------------------------------------------------------------------
  3312                                  
  3313                                  LineDel:				; ...
  3314 000014EA 08F6                    		or	dh, dh
  3315 000014EC 748D                    		jz	short GETCH
  3316 000014EE E83B00                  		call	BackSpace
  3317 000014F1 EBF7                    		jmp	short LineDel
  3318                                  ; ---------------------------------------------------------------------------
  3319                                  
  3320                                  WordDel:				; ...
  3321 000014F3 E83600                  		call	BackSpace
  3322 000014F6 08F6                    		or	dh, dh
  3323 000014F8 7416                    		jz	short getchj
  3324 000014FA 268A45FF                		mov	al, [es:di-1]
  3325 000014FE 3C30                    		cmp	al, '0'
  3326 00001500 720E                    		jb	short getchj
  3327 00001502 3C39                    		cmp	al, '9'
  3328 00001504 76ED                    		jbe	short WordDel
  3329 00001506 0C20                    		or	al, 20h
  3330 00001508 3C61                    		cmp	al, 'a'
  3331 0000150A 7204                    		jb	short getchj
  3332 0000150C 3C7A                    		cmp	al, 'z'
  3333 0000150E 76E3                    		jbe	short WordDel
  3334                                  
  3335                                  getchj:					; ...
  3336 00001510 E968FF                  		jmp	GETCH
  3337                                  ; ---------------------------------------------------------------------------
  3338                                  ; START	OF FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
  3339                                  
  3340                                  KILNEW:					; ...
  3341 00001513 B05C                    		mov	al, '\'
  3342 00001515 E8F301                  		call	OUTT
  3343 00001518 5E                      		pop	si
  3344                                  
  3345                                  PUTNEW:					; ...
  3346 00001519 E81601                  		call	CRLF
  3347 0000151C 36A0[FA01]              		mov	al, [ss:STARTPOS]
  3348 00001520 E85C02                  		call	TAB
  3349 00001523 E939FF                  		jmp	NEWLIN
  3350                                  ; ---------------------------------------------------------------------------
  3351                                  
  3352                                  BACKSP:					; ...
  3353 00001526 E80300                  		call	BackSpace
  3354 00001529 E94FFF                  		jmp	GETCH
  3355                                  ; END OF FUNCTION CHUNK	FOR $STD_CON_STRING_INPUT
  3356                                  
  3357                                  ; =============== S U B	R O U T	I N E =======================================
  3358                                  
  3359                                  
  3360                                  BackSpace:
  3361 0000152C 08F6                    		or	dh, dh
  3362 0000152E 7419                    		jz	short OLDBAK
  3363 00001530 E85800                  		call	BACKUP
  3364 00001533 268A05                  		mov	al, [es:di]
  3365 00001536 3C20                    		cmp	al, 20h	; ' '
  3366 00001538 730F                    		jnb	short OLDBAK
  3367 0000153A 3C09                    		cmp	al, 9
  3368 0000153C 741B                    		jz	short BAKTAB
  3369 0000153E 3C15                    		cmp	al, 15h
  3370 00001540 7407                    		jz	short OLDBAK
  3371 00001542 3C14                    		cmp	al, 14h
  3372 00001544 7403                    		jz	short OLDBAK
  3373 00001546 E84500                  		call	BACKMES
  3374                                  
  3375                                  OLDBAK:					; ...
  3376 00001549 36803E[7905]00          		cmp	byte [ss:INSMODE], 0
  3377 0000154F 7593                    		jnz	short OLDBAK_RETN
  3378 00001551 08FF                    		or	bh, bh
  3379 00001553 748F                    		jz	short OLDBAK_RETN
  3380 00001555 FECF                    		dec	bh
  3381 00001557 4E                      		dec	si
  3382 00001558 C3                      		retn
  3383                                  ; ---------------------------------------------------------------------------
  3384                                  
  3385                                  BAKTAB:					; ...
  3386 00001559 57                      		push	di
  3387 0000155A 4F                      		dec	di
  3388 0000155B FD                      		std
  3389 0000155C 88F1                    		mov	cl, dh
  3390 0000155E B020                    		mov	al, 20h	; ' '
  3391 00001560 53                      		push	bx
  3392 00001561 B307                    		mov	bl, 7
  3393 00001563 E30E                    		jcxz	FIGTAB
  3394                                  
  3395                                  FNDPOS:					; ...
  3396 00001565 AE                      		scasb
  3397 00001566 7609                    		jbe	short CHKCNT
  3398 00001568 26807D0109              		cmp	byte [es:di+1], 9
  3399 0000156D 7409                    		jz	short HAVTAB
  3400 0000156F FECB                    		dec	bl
  3401                                  
  3402                                  CHKCNT:					; ...
  3403 00001571 E2F2                    		loop	FNDPOS
  3404                                  
  3405                                  FIGTAB:					; ...
  3406 00001573 362A1E[FA01]            		sub	bl, [ss:STARTPOS]
  3407                                  
  3408                                  HAVTAB:					; ...
  3409 00001578 28F3                    		sub	bl, dh
  3410 0000157A 00D9                    		add	cl, bl
  3411 0000157C 80E107                  		and	cl, 7
  3412 0000157F FC                      		cld
  3413 00001580 5B                      		pop	bx
  3414 00001581 5F                      		pop	di
  3415 00001582 74C5                    		jz	short OLDBAK
  3416                                  
  3417                                  TABBAK:					; ...
  3418 00001584 E80700                  		call	BACKMES
  3419 00001587 E2FB                    		loop	TABBAK
  3420 00001589 EBBE                    		jmp	short OLDBAK
  3421                                  
  3422                                  ; =============== S U B	R O U T	I N E =======================================
  3423                                  
  3424                                  
  3425                                  BACKUP:
  3426 0000158B FECE                    		dec	dh
  3427 0000158D 4F                      		dec	di
  3428                                  
  3429                                  ; =============== S U B	R O U T	I N E =======================================
  3430                                  
  3431                                  
  3432                                  BACKMES:
  3433 0000158E B008                    		mov	al, 8
  3434 00001590 E87801                  		call	OUTT
  3435 00001593 B020                    		mov	al, 20h	; ' '
  3436 00001595 E87301                  		call	OUTT
  3437 00001598 B008                    		mov	al, 8
  3438 0000159A E96E01                  		jmp	OUTT
  3439                                  
  3440                                  ; ---------------------------------------------------------------------------
  3441                                  ; START	OF FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
  3442                                  
  3443                                  TWOESC:					; ...
  3444 0000159D 2EA0[150A]              		mov	al, [cs:ESCCHAR]
  3445 000015A1 E904FF                  		jmp	SAVCH
  3446                                  ; ---------------------------------------------------------------------------
  3447                                  
  3448                                  COPYLIN:				; ...
  3449 000015A4 88D9                    		mov	cl, bl
  3450 000015A6 28F9                    		sub	cl, bh
  3451 000015A8 EB07                    		jmp	short COPYEACH
  3452                                  ; ---------------------------------------------------------------------------
  3453                                  
  3454                                  COPYSTR:				; ...
  3455 000015AA E83400                  		call	FINDOLD
  3456 000015AD EB02                    		jmp	short COPYEACH
  3457                                  ; ---------------------------------------------------------------------------
  3458                                  
  3459                                  COPYONE:				; ...
  3460 000015AF B101                    		mov	cl, 1
  3461                                  
  3462                                  COPYEACH:				; ...
  3463 000015B1 36C606[7905]00          		mov	byte [ss:INSMODE], 0
  3464 000015B7 38D6                    		cmp	dh, dl
  3465 000015B9 740F                    		jz	short GETCH2
  3466 000015BB 38DF                    		cmp	bh, bl
  3467 000015BD 740B                    		jz	short GETCH2
  3468 000015BF AC                      		lodsb
  3469 000015C0 AA                      		stosb
  3470 000015C1 E8DE01                  		call	BUFOUT
  3471 000015C4 FEC7                    		inc	bh
  3472 000015C6 FEC6                    		inc	dh
  3473 000015C8 E2E7                    		loop	COPYEACH
  3474                                  
  3475                                  GETCH2:					; ...
  3476 000015CA E9AEFE                  		jmp	GETCH
  3477                                  ; ---------------------------------------------------------------------------
  3478                                  
  3479                                  SKIPONE:				; ...
  3480 000015CD 38DF                    		cmp	bh, bl
  3481 000015CF 74F9                    		jz	short GETCH2
  3482 000015D1 FEC7                    		inc	bh
  3483 000015D3 46                      		inc	si
  3484 000015D4 E9A4FE                  		jmp	GETCH
  3485                                  ; ---------------------------------------------------------------------------
  3486                                  
  3487                                  SKIPSTR:				; ...
  3488 000015D7 E80700                  		call	FINDOLD
  3489 000015DA 01CE                    		add	si, cx
  3490 000015DC 00CF                    		add	bh, cl
  3491 000015DE E99AFE                  		jmp	GETCH
  3492                                  ; END OF FUNCTION CHUNK	FOR $STD_CON_STRING_INPUT
  3493                                  
  3494                                  ; =============== S U B	R O U T	I N E =======================================
  3495                                  
  3496                                  
  3497                                  FINDOLD:
  3498 000015E1 E8F6FD                  		call	$STD_CON_INPUT_NO_ECHO
  3499 000015E4 2E3A06[150A]            		cmp	al, [cs:ESCCHAR]
  3500 000015E9 7505                    		jnz	short FINDSETUP
  3501 000015EB E8ECFD                  		call	$STD_CON_INPUT_NO_ECHO
  3502 000015EE EB1D                    		jmp	short NOTFND
  3503                                  ; ---------------------------------------------------------------------------
  3504                                  
  3505                                  FINDSETUP:				; ...
  3506 000015F0 88D9                    		mov	cl, bl
  3507 000015F2 28F9                    		sub	cl, bh
  3508 000015F4 7417                    		jz	short NOTFND
  3509 000015F6 49                      		dec	cx
  3510 000015F7 7414                    		jz	short NOTFND
  3511 000015F9 06                      		push	es
  3512 000015FA 1E                      		push	ds
  3513 000015FB 07                      		pop	es
  3514 000015FC 57                      		push	di
  3515 000015FD 89F7                    		mov	di, si
  3516 000015FF 47                      		inc	di
  3517 00001600 F2AE                    		repne scasb
  3518 00001602 5F                      		pop	di
  3519 00001603 07                      		pop	es
  3520 00001604 7507                    		jnz	short NOTFND
  3521 00001606 F6D1                    		not	cl
  3522 00001608 00D9                    		add	cl, bl
  3523 0000160A 28F9                    		sub	cl, bh
  3524                                  
  3525                                  FINDOLD_RETN:				; ...
  3526 0000160C C3                      		retn
  3527                                  ; ---------------------------------------------------------------------------
  3528                                  
  3529                                  NOTFND:					; ...
  3530 0000160D 5D                      		pop	bp
  3531 0000160E E96AFE                  		jmp	GETCH
  3532                                  
  3533                                  ; ---------------------------------------------------------------------------
  3534                                  ; START	OF FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
  3535                                  
  3536                                  REEDIT:					; ...
  3537 00001611 B040                    		mov	al, '@'
  3538 00001613 E8F500                  		call	OUTT
  3539 00001616 5F                      		pop	di
  3540 00001617 57                      		push	di
  3541 00001618 06                      		push	es
  3542 00001619 1E                      		push	ds
  3543 0000161A E8BCFE                  		call	COPYNEW
  3544 0000161D 1F                      		pop	ds
  3545 0000161E 07                      		pop	es
  3546 0000161F 5E                      		pop	si
  3547 00001620 88F3                    		mov	bl, dh
  3548 00001622 E9F4FE                  		jmp	PUTNEW
  3549                                  ; ---------------------------------------------------------------------------
  3550                                  
  3551                                  EXITINS_ENTERINS:			; ...
  3552 00001625 36F616[7905]            		not	byte [ss:INSMODE]
  3553 0000162A E94EFE                  		jmp	GETCH
  3554                                  ; ---------------------------------------------------------------------------
  3555                                  
  3556                                  CTRLZ:					; ...
  3557 0000162D B01A                    		mov	al, 1Ah
  3558 0000162F E976FE                  		jmp	SAVCH
  3559                                  ; END OF FUNCTION CHUNK	FOR $STD_CON_STRING_INPUT
  3560                                  
  3561                                  ; =============== S U B	R O U T	I N E =======================================
  3562                                  
  3563                                  
  3564                                  CRLF:
  3565 00001632 B00D                    		mov	al, 0Dh
  3566 00001634 E8D400                  		call	OUTT
  3567 00001637 B00A                    		mov	al, 0Ah
  3568 00001639 E9CF00                  		jmp	OUTT
  3569                                  
  3570                                  ; ---------------------------------------------------------------------------
  3571                                  
  3572                                  $RAW_CON_IO:				; ...
  3573 0000163C 88D0                    		mov	al, dl
  3574 0000163E 3CFF                    		cmp	al, 0FFh
  3575 00001640 7403                    		jz	short rcio1
  3576 00001642 EB43                    		jmp	short RAWOUT
  3577                                  ; ---------------------------------------------------------------------------
  3578 00001644 90                      		nop
  3579                                  
  3580                                  rcio1:					; ...
  3581 00001645 36C43E[8405]            		les	di, [ss:USER_SP]
  3582 0000164A 31DB                    		xor	bx, bx
  3583 0000164C E85421                  		call	GET_IO_SFT
  3584 0000164F 72BB                    		jb	short FINDOLD_RETN
  3585 00001651 B401                    		mov	ah, 1
  3586 00001653 E8DD2F                  		call	IOFUNC
  3587 00001656 750B                    		jnz	short RESFLG
  3588 00001658 E8CE3C                  		call	SPOOLINT
  3589 0000165B 26804D1640              		or	byte [es:di+16h], 40h
  3590 00001660 30C0                    		xor	al, al
  3591                                  
  3592                                  RET17:					; ...
  3593 00001662 C3                      		retn
  3594                                  ; ---------------------------------------------------------------------------
  3595                                  
  3596                                  RESFLG:					; ...
  3597 00001663 26806516BF              		and	byte [es:di+16h], 0BFh
  3598                                  
  3599                                  rci0:					; ...
  3600 00001668 E8BE3C                  		call	SPOOLINT
  3601                                  
  3602                                  $RAW_CON_INPUT:				; ...
  3603 0000166B 53                      		push	bx
  3604 0000166C 31DB                    		xor	bx, bx
  3605 0000166E E83221                  		call	GET_IO_SFT
  3606 00001671 5B                      		pop	bx
  3607 00001672 72EE                    		jb	short RET17
  3608 00001674 B401                    		mov	ah, 1
  3609 00001676 E8BA2F                  		call	IOFUNC
  3610 00001679 7506                    		jnz	short rci5
  3611 0000167B B484                    		mov	ah, 84h
  3612 0000167D CD2A                    		int	2Ah		; Microsoft Networks - KEYBOARD	BUSY LOOP
  3613 0000167F EBE7                    		jmp	short rci0
  3614                                  ; ---------------------------------------------------------------------------
  3615                                  
  3616                                  rci5:					; ...
  3617 00001681 30E4                    		xor	ah, ah
  3618 00001683 E8AD2F                  		call	IOFUNC
  3619 00001686 C3                      		retn
  3620                                  
  3621                                  ; =============== S U B	R O U T	I N E =======================================
  3622                                  
  3623                                  
  3624                                  RAWOUT:
  3625 00001687 53                      		push	bx
  3626 00001688 BB0100                  		mov	bx, 1
  3627 0000168B E81521                  		call	GET_IO_SFT
  3628 0000168E 721B                    		jb	short RAWRET1
  3629 00001690 8B5C05                  		mov	bx, [si+5]
  3630 00001693 81E38080                		and	bx, 8080h
  3631 00001697 81FB8000                		cmp	bx, 80h	; ''
  3632 0000169B 7510                    		jnz	short RAWNORM
  3633 0000169D 1E                      		push	ds
  3634 0000169E C55C07                  		lds	bx, [si+7]
  3635 000016A1 F6470410                		test	byte [bx+4], 10h
  3636 000016A5 1F                      		pop	ds
  3637 000016A6 7405                    		jz	short RAWNORM
  3638 000016A8 CD29                    		int	29h		; DOS 2+ internal - FAST PUTCHAR
  3639                                  					; AL = character to display
  3640                                  
  3641                                  RAWRET:					; ...
  3642 000016AA F8                      		clc
  3643                                  
  3644                                  RAWRET1:				; ...
  3645 000016AB 5B                      		pop	bx
  3646                                  
  3647                                  RAWRET2:				; ...
  3648 000016AC C3                      		retn
  3649                                  ; ---------------------------------------------------------------------------
  3650                                  
  3651                                  RAWNORM:				; ...
  3652 000016AD E80700                  		call	RAWOUT3
  3653 000016B0 EBF8                    		jmp	short RAWRET
  3654                                  
  3655                                  ; =============== S U B	R O U T	I N E =======================================
  3656                                  
  3657                                  
  3658                                  RAWOUT2:
  3659 000016B2 E8EE20                  		call	GET_IO_SFT
  3660 000016B5 72F5                    		jb	short RAWRET2
  3661                                  
  3662                                  ; =============== S U B	R O U T	I N E =======================================
  3663                                  
  3664                                  
  3665                                  RAWOUT3:
  3666 000016B7 50                      		push	ax
  3667 000016B8 EB0D                    		jmp	short RAWOSTRT
  3668                                  ; ---------------------------------------------------------------------------
  3669                                  
  3670                                  ROLP:					; ...
  3671 000016BA E86C3C                  		call	SPOOLINT
  3672 000016BD 36810E[1106]0002        		or	word [ss:DOS34_FLAG], 200h
  3673 000016C4 E8D93B                  		call	DSKSTATCHK
  3674                                  
  3675                                  RAWOSTRT:				; ...
  3676 000016C7 B403                    		mov	ah, 3
  3677 000016C9 E8672F                  		call	IOFUNC
  3678 000016CC 74EC                    		jz	short ROLP
  3679 000016CE 40                      		inc	ax
  3680 000016CF 58                      		pop	ax
  3681 000016D0 7405                    		jz	short nosend
  3682 000016D2 B402                    		mov	ah, 2
  3683 000016D4 E85C2F                  		call	IOFUNC
  3684                                  
  3685                                  nosend:					; ...
  3686 000016D7 F8                      		clc
  3687 000016D8 C3                      		retn
  3688                                  
  3689                                  ; =============== S U B	R O U T	I N E =======================================
  3690                                  
  3691                                  
  3692                                  Save_Restore_Packet:
  3693 000016D9 1E                      		push	ds
  3694 000016DA 06                      		push	es
  3695 000016DB 56                      		push	si
  3696 000016DC 57                      		push	di
  3697 000016DD 83F800                  		cmp	ax, 0
  3698 000016E0 7408                    		jz	short save_packet
  3699                                  
  3700                                  restore_packet:
  3701 000016E2 BE[6C0D]                		mov	si, FAKE_STACK_2F
  3702 000016E5 BF[5A03]                		mov	di, DEVCALL
  3703 000016E8 EB06                    		jmp	short set_seg
  3704                                  ; ---------------------------------------------------------------------------
  3705                                  
  3706                                  save_packet:				; ...
  3707 000016EA BF[6C0D]                		mov	di, FAKE_STACK_2F
  3708 000016ED BE[5A03]                		mov	si, DEVCALL
  3709                                  
  3710                                  set_seg:				; ...
  3711 000016F0 8CD0                    		mov	ax, ss
  3712 000016F2 8ED8                    		mov	ds, ax
  3713 000016F4 8EC0                    		mov	es, ax
  3714 000016F6 B90B00                  		mov	cx, 11
  3715 000016F9 F3A5                    		rep movsw
  3716 000016FB 5F                      		pop	di
  3717 000016FC 5E                      		pop	si
  3718 000016FD 07                      		pop	es
  3719 000016FE 1F                      		pop	ds
  3720 000016FF C3                      		retn
  3721                                  
  3722                                  ; ---------------------------------------------------------------------------
  3723                                  
  3724                                  $STD_CON_INPUT:				; ...
  3725 00001700 E8D7FC                  		call	$STD_CON_INPUT_NO_ECHO
  3726 00001703 50                      		push	ax
  3727 00001704 E80400                  		call	OUTT
  3728 00001707 58                      		pop	ax
  3729                                  
  3730                                  ; =============== S U B	R O U T	I N E =======================================
  3731                                  
  3732                                  
  3733                                  CON_INPUT_RETN:
  3734 00001708 C3                      		retn
  3735                                  
  3736                                  ; ---------------------------------------------------------------------------
  3737                                  
  3738                                  $STD_CON_OUTPUT:			; ...
  3739 00001709 88D0                    		mov	al, dl
  3740                                  
  3741                                  ; =============== S U B	R O U T	I N E =======================================
  3742                                  
  3743                                  
  3744                                  OUTT:
  3745                                  
  3746                                  ; FUNCTION CHUNK AT 556F SIZE 00000008 BYTES
  3747                                  ; FUNCTION CHUNK AT 557A SIZE 00000008 BYTES
  3748                                  ; FUNCTION CHUNK AT 55CF SIZE 00000007 BYTES
  3749                                  
  3750 0000170B 3C20                    		cmp	al, 20h
  3751 0000170D 725C                    		jb	short CTRLOUT
  3752 0000170F 3C7F                    		cmp	al, 7Fh
  3753 00001711 7405                    		jz	short OUTCH
  3754 00001713 36FE06[F901]            		inc	byte [ss:CARPOS]
  3755                                  
  3756                                  OUTCH:					; ...
  3757 00001718 1E                      		push	ds
  3758 00001719 56                      		push	si
  3759 0000171A 36FE06[0003]            		inc	byte [ss:CHARCO]
  3760 0000171F 368026[0003]3F          		and	byte [ss:CHARCO], 3Fh
  3761 00001725 7505                    		jnz	short OUTSKIP
  3762 00001727 50                      		push	ax
  3763 00001728 E82C3C                  		call	STATCHK
  3764 0000172B 58                      		pop	ax
  3765                                  
  3766                                  OUTSKIP:				; ...
  3767 0000172C E858FF                  		call	RAWOUT
  3768 0000172F 5E                      		pop	si
  3769 00001730 1F                      		pop	ds
  3770 00001731 36F606[FE02]FF          		test	byte [ss:PFLAG], 0FFh
  3771 00001737 74CF                    		jz	short CON_INPUT_RETN
  3772 00001739 53                      		push	bx
  3773 0000173A 1E                      		push	ds
  3774 0000173B 56                      		push	si
  3775 0000173C BB0100                  		mov	bx, 1
  3776 0000173F E86120                  		call	GET_IO_SFT
  3777 00001742 7221                    		jb	short TRIPOPJ
  3778 00001744 8B5C05                  		mov	bx, [si+5]
  3779 00001747 F6C780                  		test	bh, 80h
  3780 0000174A 7519                    		jnz	short TRIPOPJ
  3781 0000174C F6C380                  		test	bl, 80h
  3782 0000174F 7414                    		jz	short TRIPOPJ
  3783 00001751 BB0400                  		mov	bx, 4
  3784 00001754 E84C20                  		call	GET_IO_SFT
  3785 00001757 720C                    		jb	short TRIPOPJ
  3786 00001759 F6440608                		test	byte [si+6], 8
  3787 0000175D 7409                    		jz	short LISSTRT2J
  3788 0000175F 36C606[FE02]00          		mov	byte [ss:PFLAG], 0
  3789                                  
  3790                                  TRIPOPJ:				; ...
  3791 00001765 E98A00                  		jmp	TRIPOP
  3792                                  ; ---------------------------------------------------------------------------
  3793                                  
  3794                                  LISSTRT2J:				; ...
  3795 00001768 E98400                  		jmp	LISSTRT2
  3796                                  ; ---------------------------------------------------------------------------
  3797                                  
  3798                                  CTRLOUT:				; ...
  3799 0000176B 3C0D                    		cmp	al, 0Dh
  3800 0000176D 7420                    		jz	short ZERPOS
  3801 0000176F 3C08                    		cmp	al, 8
  3802 00001771 7427                    		jz	short BACKPOS
  3803 00001773 3C09                    		cmp	al, 9
  3804 00001775 75A1                    		jnz	short OUTCH
  3805 00001777 36A0[F901]              		mov	al, [ss:CARPOS]
  3806 0000177B 0CF8                    		or	al, 0F8h
  3807 0000177D F6D8                    		neg	al
  3808                                  
  3809                                  ; =============== S U B	R O U T	I N E =======================================
  3810                                  
  3811                                  
  3812                                  TAB:
  3813 0000177F 51                      		push	cx
  3814 00001780 88C1                    		mov	cl, al
  3815 00001782 B500                    		mov	ch, 0
  3816 00001784 E307                    		jcxz	POPTAB
  3817                                  
  3818                                  TABLP:					; ...
  3819 00001786 B020                    		mov	al, ' '
  3820 00001788 E880FF                  		call	OUTT
  3821 0000178B E2F9                    		loop	TABLP
  3822                                  
  3823                                  POPTAB:					; ...
  3824 0000178D 59                      		pop	cx
  3825 0000178E C3                      		retn
  3826                                  
  3827                                  ; ---------------------------------------------------------------------------
  3828                                  ; START	OF FUNCTION CHUNK FOR OUTT
  3829                                  
  3830                                  ZERPOS:					; ...
  3831 0000178F 36C606[F901]00          		mov	byte [ss:CARPOS], 0
  3832 00001795 EB81                    		jmp	short OUTCH
  3833                                  ; END OF FUNCTION CHUNK	FOR OUTT
  3834                                  ; ---------------------------------------------------------------------------
  3835                                  
  3836                                  j_OUTT:					; ...
  3837 00001797 E971FF                  		jmp	OUTT
  3838                                  ; ---------------------------------------------------------------------------
  3839                                  ; START	OF FUNCTION CHUNK FOR OUTT
  3840                                  
  3841                                  BACKPOS:				; ...
  3842 0000179A 36FE0E[F901]            		dec	byte [ss:CARPOS]
  3843 0000179F E976FF                  		jmp	OUTCH
  3844                                  ; END OF FUNCTION CHUNK	FOR OUTT
  3845                                  
  3846                                  ; =============== S U B	R O U T	I N E =======================================
  3847                                  
  3848                                  
  3849                                  BUFOUT:
  3850 000017A2 3C20                    		cmp	al, ' '
  3851 000017A4 73F1                    		jnb	short j_OUTT
  3852 000017A6 3C09                    		cmp	al, 9
  3853 000017A8 74ED                    		jz	short j_OUTT
  3854 000017AA 3C15                    		cmp	al, 15h
  3855 000017AC 740D                    		jz	short CTRLU
  3856 000017AE 3C14                    		cmp	al, 14h
  3857 000017B0 7409                    		jz	short CTRLU
  3858                                  
  3859                                  NOT_CTRLU:
  3860 000017B2 50                      		push	ax
  3861 000017B3 B05E                    		mov	al, '^'
  3862 000017B5 E853FF                  		call	OUTT
  3863 000017B8 58                      		pop	ax
  3864 000017B9 0C40                    		or	al, 40h
  3865                                  
  3866                                  CTRLU:					; ...
  3867 000017BB E84DFF                  		call	OUTT
  3868                                  
  3869                                  BUFOUT_RETN:				; ...
  3870 000017BE C3                      		retn
  3871                                  
  3872                                  ; ---------------------------------------------------------------------------
  3873                                  
  3874                                  $STD_AUX_INPUT:				; ...
  3875 000017BF E8953B                  		call	STATCHK
  3876 000017C2 BB0300                  		mov	bx, 3
  3877 000017C5 E8DB1F                  		call	GET_IO_SFT
  3878 000017C8 72F4                    		jb	short BUFOUT_RETN
  3879 000017CA EB03                    		jmp	short TAISTRT
  3880                                  ; ---------------------------------------------------------------------------
  3881                                  
  3882                                  AUXILP:					; ...
  3883 000017CC E85A3B                  		call	SPOOLINT
  3884                                  
  3885                                  TAISTRT:				; ...
  3886 000017CF B401                    		mov	ah, 1
  3887 000017D1 E85F2E                  		call	IOFUNC
  3888 000017D4 74F6                    		jz	short AUXILP
  3889 000017D6 30E4                    		xor	ah, ah
  3890 000017D8 E8582E                  		call	IOFUNC
  3891 000017DB C3                      		retn
  3892                                  ; ---------------------------------------------------------------------------
  3893                                  
  3894                                  $STD_AUX_OUTPUT:			; ...
  3895 000017DC 53                      		push	bx
  3896 000017DD BB0300                  		mov	bx, 3
  3897 000017E0 EB04                    		jmp	short SENDOUT
  3898                                  ; ---------------------------------------------------------------------------
  3899                                  
  3900                                  $STD_PRINTER_OUTPUT:			; ...
  3901 000017E2 53                      		push	bx
  3902 000017E3 BB0400                  		mov	bx, 4
  3903                                  
  3904                                  SENDOUT:				; ...
  3905 000017E6 88D0                    		mov	al, dl
  3906 000017E8 50                      		push	ax
  3907 000017E9 E86B3B                  		call	STATCHK
  3908 000017EC 58                      		pop	ax
  3909 000017ED 1E                      		push	ds
  3910 000017EE 56                      		push	si
  3911                                  ; START	OF FUNCTION CHUNK FOR OUTT
  3912                                  
  3913                                  LISSTRT2:				; ...
  3914 000017EF E8C0FE                  		call	RAWOUT2
  3915                                  
  3916                                  TRIPOP:					; ...
  3917 000017F2 5E                      		pop	si
  3918 000017F3 1F                      		pop	ds
  3919 000017F4 5B                      		pop	bx
  3920                                  
  3921                                  SCIS_RETN:				; ...
  3922 000017F5 C3                      		retn
  3923                                  ; END OF FUNCTION CHUNK	FOR OUTT
  3924                                  ; ---------------------------------------------------------------------------
  3925                                  
  3926                                  $STD_CON_INPUT_STATUS:			; ...
  3927 000017F6 E85E3B                  		call	STATCHK
  3928 000017F9 B000                    		mov	al, 0
  3929 000017FB 74F8                    		jz	short SCIS_RETN
  3930 000017FD 0CFF                    		or	al, 0FFh
  3931 000017FF C3                      		retn
  3932                                  ; ---------------------------------------------------------------------------
  3933                                  
  3934                                  $STD_CON_INPUT_FLUSH:			; ...
  3935 00001800 50                      		push	ax
  3936 00001801 52                      		push	dx
  3937 00001802 31DB                    		xor	bx, bx
  3938 00001804 E89C1F                  		call	GET_IO_SFT
  3939 00001807 7205                    		jb	short BADJFNCON
  3940 00001809 B404                    		mov	ah, 4
  3941 0000180B E8252E                  		call	IOFUNC
  3942                                  
  3943                                  BADJFNCON:				; ...
  3944 0000180E 5A                      		pop	dx
  3945 0000180F 58                      		pop	ax
  3946 00001810 88C4                    		mov	ah, al
  3947 00001812 3C01                    		cmp	al, 1
  3948 00001814 7413                    		jz	short REDISPJ
  3949 00001816 3C06                    		cmp	al, 6
  3950 00001818 740F                    		jz	short REDISPJ
  3951 0000181A 3C07                    		cmp	al, 7
  3952 0000181C 740B                    		jz	short REDISPJ
  3953 0000181E 3C08                    		cmp	al, 8
  3954 00001820 7407                    		jz	short REDISPJ
  3955 00001822 3C0A                    		cmp	al, 0Ah
  3956 00001824 7403                    		jz	short REDISPJ
  3957 00001826 B000                    		mov	al, 0
  3958 00001828 C3                      		retn
  3959                                  ; ---------------------------------------------------------------------------
  3960                                  
  3961                                  REDISPJ:				; ...
  3962 00001829 FA                      		cli
  3963 0000182A E963EB                  		jmp	REDISP
  3964                                  ; ---------------------------------------------------------------------------
  3965                                  
  3966                                  $GET_FCB_POSITION:			; ...
  3967 0000182D E80005                  		call	GetExtended
  3968 00001830 E8D004                  		call	GetExtent
  3969 00001833 894421                  		mov	[si+21h], ax
  3970 00001836 885423                  		mov	[si+23h], dl
  3971 00001839 837C0E40                		cmp	word [si+0Eh], 64
  3972 0000183D 7303                    		jnb	short GetFCBBye
  3973 0000183F 887424                  		mov	[si+24h], dh
  3974                                  
  3975                                  GetFCBBye:				; ...
  3976 00001842 E9E8ED                  		jmp	NO_OP
  3977                                  ; ---------------------------------------------------------------------------
  3978                                  
  3979                                  $FCB_DELETE:				; ...
  3980 00001845 BF[BE03]                		mov	di, OPENBUF
  3981 00001848 E80C55                  		call	TransFCB
  3982 0000184B 7209                    		jb	short BadPath
  3983 0000184D 16                      		push	ss
  3984 0000184E 1F                      		pop	ds
  3985 0000184F E8CB0D                  		call	DOS_DELETE
  3986 00001852 7202                    		jb	short BadPath
  3987                                  
  3988                                  GoodPath:				; ...
  3989 00001854 EBEC                    		jmp	short GetFCBBye
  3990                                  ; ---------------------------------------------------------------------------
  3991                                  
  3992                                  BadPath:				; ...
  3993 00001856 E9D7ED                  		jmp	FCB_RET_ERR
  3994                                  ; ---------------------------------------------------------------------------
  3995                                  
  3996                                  $GET_FCB_FILE_LENGTH:			; ...
  3997 00001859 E8D404                  		call	GetExtended
  3998 0000185C BF[BE03]                		mov	di, OPENBUF
  3999 0000185F 1E                      		push	ds
  4000 00001860 56                      		push	si
  4001 00001861 E8F354                  		call	TransFCB
  4002 00001864 5E                      		pop	si
  4003 00001865 1F                      		pop	ds
  4004 00001866 72EE                    		jb	short BadPath
  4005 00001868 1E                      		push	ds
  4006 00001869 56                      		push	si
  4007 0000186A 16                      		push	ss
  4008 0000186B 1F                      		pop	ds
  4009 0000186C E8CB11                  		call	GET_FILE_INFO
  4010 0000186F 5E                      		pop	si
  4011 00001870 1F                      		pop	ds
  4012 00001871 72E3                    		jb	short BadPath
  4013 00001873 89DA                    		mov	dx, bx
  4014 00001875 89F8                    		mov	ax, di
  4015 00001877 8B5C0E                  		mov	bx, [si+0Eh]
  4016 0000187A 09DB                    		or	bx, bx
  4017 0000187C 7503                    		jnz	short GetSize
  4018 0000187E BB8000                  		mov	bx, 128
  4019                                  
  4020                                  GetSize:				; ...
  4021 00001881 89C7                    		mov	di, ax
  4022 00001883 89D0                    		mov	ax, dx
  4023 00001885 31D2                    		xor	dx, dx
  4024 00001887 F7F3                    		div	bx
  4025 00001889 50                      		push	ax
  4026 0000188A 89F8                    		mov	ax, di
  4027 0000188C F7F3                    		div	bx
  4028 0000188E 89D1                    		mov	cx, dx
  4029 00001890 5A                      		pop	dx
  4030 00001891 E306                    		jcxz	LengthStore
  4031 00001893 83C001                  		add	ax, 1
  4032 00001896 83D200                  		adc	dx, 0
  4033                                  
  4034                                  LengthStore:				; ...
  4035 00001899 894421                  		mov	[si+21h], ax
  4036 0000189C 885423                  		mov	[si+23h], dl
  4037 0000189F 08F6                    		or	dh, dh
  4038 000018A1 74B1                    		jz	short GoodPath
  4039 000018A3 887424                  		mov	[si+24h], dh
  4040                                  
  4041                                  GoodRet:				; ...
  4042 000018A6 EBAC                    		jmp	short GoodPath
  4043                                  ; ---------------------------------------------------------------------------
  4044                                  
  4045                                  $FCB_CLOSE:				; ...
  4046 000018A8 30C0                    		xor	al, al
  4047 000018AA E88304                  		call	GetExtended
  4048 000018AD 7403                    		jz	short NoAttr
  4049 000018AF 8A44FF                  		mov	al, [si-1]
  4050                                  
  4051                                  NoAttr:					; ...
  4052 000018B2 36A2[6B05]              		mov	byte [ss:ATTRIB], al
  4053 000018B6 E8E503                  		call	SFTFromFCB
  4054 000018B9 72EB                    		jb	short GoodRet
  4055 000018BB 268A4504                		mov	al, [es:di+4]
  4056 000018BF 30E4                    		xor	ah, ah
  4057 000018C1 50                      		push	ax
  4058 000018C2 E8D95C                  		call	CheckShare
  4059 000018C5 7508                    		jnz	short NoStash
  4060 000018C7 36A0[6B05]              		mov	al, [ss:ATTRIB]
  4061 000018CB 26884504                		mov	[es:di+4], al
  4062                                  
  4063                                  NoStash:				; ...
  4064 000018CF 8B4414                  		mov	ax, [si+14h]
  4065 000018D2 2689450F                		mov	[es:di+0Fh], ax
  4066 000018D6 8B4416                  		mov	ax, [si+16h]
  4067 000018D9 2689450D                		mov	[es:di+0Dh], ax
  4068 000018DD 8B4410                  		mov	ax, [si+10h]
  4069 000018E0 26894511                		mov	[es:di+11h], ax
  4070 000018E4 8B4412                  		mov	ax, [si+12h]
  4071 000018E7 26894513                		mov	[es:di+13h], ax
  4072 000018EB 26814D050040            		or	word [es:di+5], 4000h
  4073 000018F1 16                      		push	ss
  4074 000018F2 1F                      		pop	ds
  4075 000018F3 E85817                  		call	DOS_CLOSE
  4076 000018F6 C43E[9E05]              		les	di, [THISSFT]
  4077 000018FA 59                      		pop	cx
  4078 000018FB 26884D04                		mov	[es:di+4], cl
  4079 000018FF 9C                      		pushf
  4080 00001900 26833D00                		cmp	word [es:di], 0
  4081 00001904 7507                    		jnz	short CloseOK
  4082 00001906 50                      		push	ax
  4083 00001907 B04D                    		mov	al, 'M'
  4084 00001909 E80203                  		call	BlastSFT
  4085 0000190C 58                      		pop	ax
  4086                                  
  4087                                  CloseOK:				; ...
  4088 0000190D 9D                      		popf
  4089 0000190E 7396                    		jnb	short GoodRet
  4090 00001910 3C06                    		cmp	al, 6
  4091 00001912 7492                    		jz	short GoodRet
  4092 00001914 B002                    		mov	al, 2
  4093                                  
  4094                                  jmp_to_FCB_RET_ERR:			; ...
  4095 00001916 E917ED                  		jmp	FCB_RET_ERR
  4096                                  ; ---------------------------------------------------------------------------
  4097                                  
  4098                                  $FCB_RENAME:				; ...
  4099 00001919 E81404                  		call	GetExtended
  4100 0000191C 52                      		push	dx
  4101 0000191D 8A04                    		mov	al, [si]
  4102 0000191F 83C610                  		add	si, 10h
  4103 00001922 BF[3E04]                		mov	di, RENBUF
  4104 00001925 FF34                    		push	word [si]
  4105 00001927 1E                      		push	ds
  4106 00001928 56                      		push	si
  4107 00001929 8804                    		mov	[si], al
  4108 0000192B 89F2                    		mov	dx, si
  4109 0000192D E82754                  		call	TransFCB
  4110 00001930 5E                      		pop	si
  4111 00001931 1F                      		pop	ds
  4112 00001932 8F04                    		pop	word [si]
  4113 00001934 5A                      		pop	dx
  4114 00001935 721A                    		jb	short fren90
  4115 00001937 368B36[B205]            		mov	si, [ss:WFP_START]
  4116 0000193C 368936[B405]            		mov	[ss:REN_WFP], si
  4117 00001941 BF[BE03]                		mov	di, OPENBUF
  4118 00001944 E81054                  		call	TransFCB
  4119 00001947 7208                    		jb	short fren90
  4120 00001949 E8B10E                  		call	DOS_RENAME
  4121 0000194C 7203                    		jb	short fren90
  4122 0000194E E9DCEC                  		jmp	NO_OP
  4123                                  ; ---------------------------------------------------------------------------
  4124                                  
  4125                                  fren90:					; ...
  4126 00001951 EBC3                    		jmp	short jmp_to_FCB_RET_ERR
  4127                                  
  4128                                  ; =============== S U B	R O U T	I N E =======================================
  4129                                  
  4130                                  
  4131                                  SaveFCBInfo:
  4132 00001953 36C43E[9E05]            		les	di, [ss:THISSFT]
  4133 00001958 E853F9                  		call	IsSFTNet
  4134 0000195B 740B                    		jz	short SaveLocal
  4135 0000195D 268B450B                		mov	ax, [es:di+0Bh]
  4136 00001961 89441C                  		mov	[si+1Ch], ax
  4137 00001964 B380                    		mov	bl, 80h	; ''
  4138 00001966 EB67                    		jmp	short SaveSFN
  4139                                  ; ---------------------------------------------------------------------------
  4140                                  
  4141                                  SaveLocal:				; ...
  4142 00001968 E8335C                  		call	CheckShare
  4143 0000196B 7402                    		jz	short SaveNoShare
  4144 0000196D EB5B                    		jmp	short SaveShare
  4145                                  ; ---------------------------------------------------------------------------
  4146                                  
  4147                                  SaveNoShare:				; ...
  4148 0000196F 26F6450580              		test	byte [es:di+5], 80h
  4149 00001974 7542                    		jnz	short SaveNoShareDev
  4150 00001976 268B451B                		mov	ax, [es:di+1Bh]
  4151 0000197A 89441D                  		mov	[si+1Dh], ax
  4152 0000197D 268B451D                		mov	ax, [es:di+1Dh]
  4153 00001981 268A5D04                		mov	bl, [es:di+4]
  4154 00001985 88DF                    		mov	bh, bl
  4155 00001987 D0CB                    		ror	bl, 1
  4156 00001989 D0E7                    		shl	bh, 1
  4157 0000198B 08FB                    		or	bl, bh
  4158 0000198D 80E3C0                  		and	bl, 0C0h
  4159 00001990 08D8                    		or	al, bl
  4160 00001992 884418                  		mov	[si+18h], al
  4161 00001995 268A451F                		mov	al, [es:di+1Fh]
  4162 00001999 88441F                  		mov	[si+1Fh], al
  4163 0000199C 268B450B                		mov	ax, [es:di+0Bh]
  4164 000019A0 89441B                  		mov	[si+1Bh], ax
  4165 000019A3 B300                    		mov	bl, 0
  4166                                  
  4167                                  SetFCBBits:				; ...
  4168 000019A5 268B4505                		mov	ax, [es:di+5]
  4169 000019A9 24C0                    		and	al, 0C0h
  4170 000019AB 260A4502                		or	al, [es:di+2]
  4171 000019AF 88441A                  		mov	[si+1Ah], al
  4172 000019B2 08DB                    		or	bl, bl
  4173 000019B4 742A                    		jz	short SaveNoSFN
  4174 000019B6 EB17                    		jmp	short SaveSFN
  4175                                  ; ---------------------------------------------------------------------------
  4176                                  
  4177                                  SaveNoShareDev:				; ...
  4178 000019B8 268B4507                		mov	ax, [es:di+7]
  4179 000019BC 89441A                  		mov	[si+1Ah], ax
  4180 000019BF 268B4509                		mov	ax, [es:di+9]
  4181 000019C3 89441C                  		mov	[si+1Ch], ax
  4182 000019C6 B340                    		mov	bl, 40h	; '@'
  4183 000019C8 EBDB                    		jmp	short SetFCBBits
  4184                                  ; ---------------------------------------------------------------------------
  4185                                  
  4186                                  SaveShare:				; ...
  4187 000019CA 36FF1E[B800]            		call	far [ss:ShSave]
  4188                                  
  4189                                  SaveSFN:				; ...
  4190 000019CF 8D45FA                  		lea	ax, [di-6]
  4191 000019D2 362B06[4000]            		sub	ax, word [ss:SFTFCB]
  4192 000019D7 53                      		push	bx
  4193 000019D8 B33B                    		mov	bl, 59
  4194 000019DA F6F3                    		div	bl
  4195 000019DC 884418                  		mov	[si+18h], al
  4196 000019DF 5B                      		pop	bx
  4197                                  
  4198                                  SaveNoSFN:				; ...
  4199 000019E0 268B4505                		mov	ax, [es:di+5]
  4200 000019E4 243F                    		and	al, 3Fh
  4201 000019E6 08D8                    		or	al, bl
  4202 000019E8 884419                  		mov	[si+19h], al
  4203 000019EB 36A1[1000]              		mov	ax, [ss:FCBLRU]
  4204 000019EF 40                      		inc	ax
  4205 000019F0 26894515                		mov	[es:di+15h], ax
  4206 000019F4 7506                    		jnz	short SimpleStuff
  4207 000019F6 BB1500                  		mov	bx, 15h
  4208 000019F9 E80500                  		call	ResetLRU
  4209                                  
  4210                                  SimpleStuff:				; ...
  4211 000019FC 36A3[1000]              		mov	[ss:FCBLRU], ax
  4212 00001A00 C3                      		retn
  4213                                  
  4214                                  ; =============== S U B	R O U T	I N E =======================================
  4215                                  
  4216                                  
  4217                                  ResetLRU:
  4218 00001A01 B80080                  		mov	ax, 8000h
  4219 00001A04 06                      		push	es
  4220 00001A05 57                      		push	di
  4221 00001A06 36C43E[4000]            		les	di, [ss:SFTFCB]
  4222 00001A0B 268B4D04                		mov	cx, [es:di+4]
  4223 00001A0F 8D7D06                  		lea	di, [di+6]
  4224                                  
  4225                                  ovScan:					; ...
  4226 00001A12 262901                  		sub	[es:bx+di], ax
  4227 00001A15 7703                    		ja	short ovLoop
  4228 00001A17 268901                  		mov	[es:bx+di], ax
  4229                                  
  4230                                  ovLoop:					; ...
  4231 00001A1A 83C73B                  		add	di, 59
  4232 00001A1D E2F3                    		loop	ovScan
  4233 00001A1F 5F                      		pop	di
  4234 00001A20 07                      		pop	es
  4235 00001A21 268901                  		mov	[es:bx+di], ax
  4236 00001A24 C3                      		retn
  4237                                  
  4238                                  ; =============== S U B	R O U T	I N E =======================================
  4239                                  
  4240                                  
  4241                                  LRUFCB:
  4242 00001A25 06                      		push	es
  4243 00001A26 E85AEA                  		call	save_world
  4244 00001A29 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  4245 00001A2E 08C0                    		or	al, al
  4246 00001A30 751A                    		jnz	short lru1
  4247 00001A32 8B3E[5D10]              		mov	di, word [LocalSFT]
  4248 00001A36 0B3E[5F10]              		or	di, word [LocalSFT+2]
  4249 00001A3A 7410                    		jz	short lru1
  4250 00001A3C C43E[5D10]              		les	di, [LocalSFT]
  4251                                  
  4252                                  gotlocalSFT:				; ...
  4253 00001A40 893E[9E05]              		mov	word [THISSFT], di
  4254 00001A44 8C06[A005]              		mov	word [THISSFT+2], es
  4255 00001A48 F8                      		clc
  4256 00001A49 E9AE00                  		jmp	LRUDone
  4257                                  ; ---------------------------------------------------------------------------
  4258                                  
  4259                                  lru1:					; ...
  4260 00001A4C C43E[4000]              		les	di, [SFTFCB]
  4261 00001A50 268B4D04                		mov	cx, [es:di+4]
  4262 00001A54 8D7D06                  		lea	di, [di+6]
  4263 00001A57 BBFFFF                  		mov	bx, 0FFFFh
  4264 00001A5A 89DE                    		mov	si, bx
  4265 00001A5C 89DA                    		mov	dx, bx
  4266 00001A5E 89DD                    		mov	bp, bx
  4267                                  
  4268                                  findSFT:				; ...
  4269 00001A60 26830D00                		or	word [es:di], 0
  4270 00001A64 744E                    		jz	short gotSFT
  4271 00001A66 26833DFF                		cmp	word [es:di], 0FFFFh
  4272 00001A6A 7448                    		jz	short gotSFT
  4273 00001A6C 26F745050080            		test	word [es:di+5], 8000h
  4274 00001A72 7532                    		jnz	short lru5
  4275 00001A74 E8275B                  		call	CheckShare
  4276 00001A77 752D                    		jnz	short lru5
  4277                                  
  4278                                  hackpoint:				; ...
  4279 00001A79 893E[5D10]              		mov	word [LocalSFT], di
  4280 00001A7D 8C06[5F10]              		mov	word [LocalSFT+2], es
  4281 00001A81 08C0                    		or	al, al
  4282 00001A83 74BB                    		jz	short gotlocalSFT
  4283 00001A85 26395D15                		cmp	[es:di+15h], bx
  4284 00001A89 7306                    		jnb	short lru4
  4285 00001A8B 268B5D15                		mov	bx, [es:di+15h]
  4286 00001A8F 89FE                    		mov	si, di
  4287                                  
  4288                                  lru4:					; ...
  4289 00001A91 83C73B                  		add	di, 59
  4290 00001A94 E2CA                    		loop	findSFT
  4291 00001A96 89F7                    		mov	di, si
  4292 00001A98 83FEFF                  		cmp	si, 0FFFFh
  4293 00001A9B 7517                    		jnz	short gotSFT
  4294 00001A9D 89EF                    		mov	di, bp
  4295 00001A9F 83FDFF                  		cmp	bp, 0FFFFh
  4296 00001AA2 7530                    		jnz	short gotnetSFT
  4297 00001AA4 EB51                    		jmp	short errorbadSFT
  4298                                  ; ---------------------------------------------------------------------------
  4299                                  
  4300                                  lru5:					; ...
  4301 00001AA6 26395515                		cmp	[es:di+15h], dx
  4302 00001AAA 73E5                    		jnb	short lru4
  4303 00001AAC 268B5515                		mov	dx, [es:di+15h]
  4304 00001AB0 89FD                    		mov	bp, di
  4305 00001AB2 EBDD                    		jmp	short lru4
  4306                                  ; ---------------------------------------------------------------------------
  4307                                  
  4308                                  gotSFT:					; ...
  4309 00001AB4 08C0                    		or	al, al
  4310 00001AB6 74C1                    		jz	short hackpoint
  4311                                  
  4312                                  notlocaluse:
  4313 00001AB8 8CC0                    		mov	ax, es
  4314 00001ABA 393E[5D10]              		cmp	word [LocalSFT], di
  4315 00001ABE 7506                    		jnz	short notinvalid
  4316 00001AC0 3906[5F10]              		cmp	word [LocalSFT+2], ax
  4317 00001AC4 7403                    		jz	short zerolocalSFT
  4318                                  
  4319                                  notinvalid:				; ...
  4320 00001AC6 E977FF                  		jmp	gotlocalSFT
  4321                                  ; ---------------------------------------------------------------------------
  4322                                  
  4323                                  zerolocalSFT:				; ...
  4324 00001AC9 31C0                    		xor	ax, ax
  4325 00001ACB A3[5D10]                		mov	word [LocalSFT], ax
  4326 00001ACE A3[5F10]                		mov	word [LocalSFT+2], ax
  4327 00001AD1 E96CFF                  		jmp	gotlocalSFT
  4328                                  ; ---------------------------------------------------------------------------
  4329                                  
  4330                                  gotnetSFT:				; ...
  4331 00001AD4 08C0                    		or	al, al
  4332 00001AD6 7508                    		jnz	short closenet
  4333 00001AD8 893E[5D10]              		mov	word [LocalSFT], di
  4334 00001ADC 8C06[5F10]              		mov	word [LocalSFT+2], es
  4335                                  
  4336                                  closenet:				; ...
  4337 00001AE0 893E[9E05]              		mov	word [THISSFT], di
  4338 00001AE4 8C06[A005]              		mov	word [THISSFT+2], es
  4339                                  
  4340                                  LRUClose:				; ...
  4341 00001AE8 26833D00                		cmp	word [es:di], 0
  4342 00001AEC 740C                    		jz	short LRUDone
  4343 00001AEE E85D15                  		call	DOS_CLOSE
  4344 00001AF1 73F5                    		jnb	short LRUClose
  4345 00001AF3 3C06                    		cmp	al, 6
  4346 00001AF5 74F1                    		jz	short LRUClose
  4347                                  
  4348                                  errorbadSFT:				; ...
  4349 00001AF7 F9                      		stc
  4350 00001AF8 EB05                    		jmp	short LRUDead
  4351                                  ; ---------------------------------------------------------------------------
  4352                                  
  4353                                  LRUDone:				; ...
  4354 00001AFA 30C0                    		xor	al, al
  4355 00001AFC E80F01                  		call	BlastSFT
  4356                                  
  4357                                  LRUDead:				; ...
  4358 00001AFF E86AE9                  		call	restore_world
  4359 00001B02 07                      		pop	es
  4360 00001B03 2E8E06[0700]            		mov	es, [cs:DosDSeg]
  4361 00001B08 26C43E[9E05]            		les	di, [es:THISSFT]
  4362 00001B0D 7201                    		jb	short LruFCB_err
  4363 00001B0F C3                      		retn
  4364                                  ; ---------------------------------------------------------------------------
  4365                                  
  4366                                  LruFCB_err:				; ...
  4367 00001B10 B023                    		mov	al, 23h	; '#'
  4368 00001B12 C3                      		retn
  4369                                  
  4370                                  ; =============== S U B	R O U T	I N E =======================================
  4371                                  
  4372                                  
  4373                                  RegenCopyName:
  4374 00001B13 AC                      		lodsb
  4375 00001B14 E81B37                  		call	UCase
  4376 00001B17 AA                      		stosb
  4377 00001B18 E2F9                    		loop	RegenCopyName
  4378 00001B1A C3                      		retn
  4379                                  
  4380                                  ; =============== S U B	R O U T	I N E =======================================
  4381                                  
  4382                                  
  4383                                  FCBRegen:
  4384 00001B1B 8A4419                  		mov	al, [si+19h]
  4385 00001B1E A880                    		test	al, 80h
  4386 00001B20 741C                    		jz	short RegenNoSharing
  4387 00001B22 E8795A                  		call	CheckShare
  4388 00001B25 7509                    		jnz	short RegenFail
  4389 00001B27 B80011                  		mov	ax, 1100h
  4390 00001B2A CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - INSTALLATION	CHECK
  4391                                  					; Return: AL = 00h  not	installed, OK to install
  4392                                  					; 01h  not installed, not OK to	install
  4393                                  					; FFh  installed
  4394 00001B2C 08C0                    		or	al, al
  4395 00001B2E 740C                    		jz	short RegenDead
  4396                                  
  4397                                  RegenFail:				; ...
  4398 00001B30 36A1[3A03]              		mov	ax, [ss:USER_IN_AX]
  4399 00001B34 80FC10                  		cmp	ah, 10h
  4400 00001B37 7403                    		jz	short RegenDead
  4401 00001B39 E89801                  		call	FCBHardErr
  4402                                  
  4403                                  RegenDead:				; ...
  4404 00001B3C F9                      		stc
  4405                                  
  4406                                  FCBRegen_retn:				; ...
  4407 00001B3D C3                      		retn
  4408                                  ; ---------------------------------------------------------------------------
  4409                                  
  4410                                  RegenNoSharing:				; ...
  4411 00001B3E E85D5A                  		call	CheckShare
  4412 00001B41 75ED                    		jnz	short RegenFail
  4413 00001B43 50                      		push	ax
  4414 00001B44 B000                    		mov	al, 0
  4415 00001B46 E8DCFE                  		call	LRUFCB
  4416 00001B49 58                      		pop	ax
  4417 00001B4A 72F1                    		jb	short FCBRegen_retn
  4418 00001B4C 26C745020280            		mov	word [es:di+2], 8002h
  4419 00001B52 243F                    		and	al, 3Fh
  4420 00001B54 98                      		cbw
  4421 00001B55 0D0040                  		or	ax, 4000h
  4422 00001B58 8A4C1A                  		mov	cl, [si+1Ah]
  4423 00001B5B 88CD                    		mov	ch, cl
  4424 00001B5D 80E5C0                  		and	ch, 0C0h
  4425 00001B60 08E8                    		or	al, ch
  4426 00001B62 80E10F                  		and	cl, 0Fh
  4427 00001B65 26884D02                		mov	[es:di+2], cl
  4428 00001B69 26894505                		mov	[es:di+5], ax
  4429 00001B6D 36A1[3C03]              		mov	ax, [ss:PROC_ID]
  4430 00001B71 26894531                		mov	[es:di+31h], ax
  4431 00001B75 1E                      		push	ds
  4432 00001B76 56                      		push	si
  4433 00001B77 06                      		push	es
  4434 00001B78 57                      		push	di
  4435 00001B79 16                      		push	ss
  4436 00001B7A 07                      		pop	es
  4437 00001B7B BF[4B05]                		mov	di, NAME1
  4438 00001B7E B90800                  		mov	cx, 8
  4439 00001B81 46                      		inc	si
  4440 00001B82 E88EFF                  		call	RegenCopyName
  4441 00001B85 16                      		push	ss
  4442 00001B86 1F                      		pop	ds
  4443 00001B87 C606[6B05]16            		mov	byte [ATTRIB], 16h
  4444 00001B8C E8D927                  		call	DEVNAME
  4445 00001B8F 5F                      		pop	di
  4446 00001B90 07                      		pop	es
  4447 00001B91 5E                      		pop	si
  4448 00001B92 1F                      		pop	ds
  4449 00001B93 7219                    		jb	short RegenFileNoSharing
  4450 00001B95 26887D05                		mov	[es:di+5], bh
  4451 00001B99 26C6450400              		mov	byte [es:di+4], 0
  4452 00001B9E 36C536[9A05]            		lds	si, [ss:DEVPT]
  4453 00001BA3 26897507                		mov	[es:di+7], si
  4454 00001BA7 268C5D09                		mov	word [es:di+9], ds
  4455 00001BAB C3                      		retn
  4456                                  ; ---------------------------------------------------------------------------
  4457                                  
  4458                                  RegenDeadJ:				; ...
  4459 00001BAC EB8E                    		jmp	short RegenDead
  4460                                  ; ---------------------------------------------------------------------------
  4461                                  
  4462                                  RegenFileNoSharing:			; ...
  4463 00001BAE 268B4505                		mov	ax, [es:di+5]
  4464 00001BB2 83E03F                  		and	ax, 3Fh
  4465 00001BB5 1E                      		push	ds
  4466 00001BB6 56                      		push	si
  4467 00001BB7 E84E50                  		call	FIND_DPB
  4468 00001BBA 26897507                		mov	[es:di+7], si
  4469 00001BBE 268C5D09                		mov	word [es:di+9], ds
  4470 00001BC2 5E                      		pop	si
  4471 00001BC3 1F                      		pop	ds
  4472 00001BC4 72E6                    		jb	short RegenDeadJ
  4473 00001BC6 8B441D                  		mov	ax, [si+1Dh]
  4474 00001BC9 2689451B                		mov	[es:di+1Bh], ax
  4475 00001BCD 8A4418                  		mov	al, [si+18h]
  4476 00001BD0 24C0                    		and	al, 0C0h
  4477 00001BD2 88C4                    		mov	ah, al
  4478 00001BD4 D0C4                    		rol	ah, 1
  4479 00001BD6 D0E8                    		shr	al, 1
  4480 00001BD8 08E0                    		or	al, ah
  4481 00001BDA 243F                    		and	al, 3Fh
  4482 00001BDC 26884504                		mov	[es:di+4], al
  4483 00001BE0 8A4418                  		mov	al, [si+18h]
  4484 00001BE3 243F                    		and	al, 3Fh
  4485 00001BE5 28E4                    		sub	ah, ah
  4486 00001BE7 2689451D                		mov	[es:di+1Dh], ax
  4487 00001BEB 8B441B                  		mov	ax, [si+1Bh]
  4488 00001BEE 2689450B                		mov	[es:di+0Bh], ax
  4489 00001BF2 26894535                		mov	[es:di+35h], ax
  4490 00001BF6 8A441F                  		mov	al, [si+1Fh]
  4491 00001BF9 2688451F                		mov	[es:di+1Fh], al
  4492 00001BFD 26FF05                  		inc	word [es:di]
  4493 00001C00 8D7401                  		lea	si, [si+1]
  4494 00001C03 8D7D20                  		lea	di, [di+20h]
  4495 00001C06 B90B00                  		mov	cx, 11
  4496 00001C09 E807FF                  		call	RegenCopyName
  4497 00001C0C F8                      		clc
  4498 00001C0D C3                      		retn
  4499                                  
  4500                                  ; =============== S U B	R O U T	I N E =======================================
  4501                                  
  4502                                  
  4503                                  BlastSFT:
  4504 00001C0E 57                      		push	di
  4505 00001C0F B93B00                  		mov	cx, 59
  4506 00001C12 F3AA                    		rep stosb
  4507 00001C14 5F                      		pop	di
  4508 00001C15 29C0                    		sub	ax, ax
  4509 00001C17 268905                  		mov	[es:di], ax
  4510 00001C1A 26894515                		mov	[es:di+15h], ax
  4511 00001C1E 48                      		dec	ax
  4512 00001C1F 26894517                		mov	[es:di+17h], ax
  4513 00001C23 C3                      		retn
  4514                                  
  4515                                  ; =============== S U B	R O U T	I N E =======================================
  4516                                  
  4517                                  
  4518                                  CheckFCB:
  4519 00001C24 F64419C0                		test	byte [si+19h], 0C0h
  4520 00001C28 7450                    		jz	short BadSFT
  4521 00001C2A 36C43E[4000]            		les	di, [ss:SFTFCB]
  4522 00001C2F 26384504                		cmp	[es:di+4], al
  4523 00001C33 7245                    		jb	short BadSFT
  4524 00001C35 B33B                    		mov	bl, 59
  4525 00001C37 F6E3                    		mul	bl
  4526 00001C39 8D7D06                  		lea	di, [di+6]
  4527 00001C3C 01C7                    		add	di, ax
  4528 00001C3E 36A1[3C03]              		mov	ax, [ss:PROC_ID]
  4529 00001C42 26394531                		cmp	[es:di+31h], ax
  4530 00001C46 7532                    		jnz	short BadSFT
  4531 00001C48 26833D00                		cmp	word [es:di], 0
  4532 00001C4C 742C                    		jz	short BadSFT
  4533 00001C4E 8A4419                  		mov	al, [si+19h]
  4534 00001C51 A880                    		test	al, 80h
  4535 00001C53 7431                    		jz	short CheckNoShare
  4536 00001C55 50                      		push	ax
  4537 00001C56 24C0                    		and	al, 0C0h
  4538 00001C58 3CC0                    		cmp	al, 0C0h ; ''
  4539 00001C5A 58                      		pop	ax
  4540 00001C5B 751F                    		jnz	short CheckNet
  4541 00001C5D 36FF1E[BC00]            		call	far [ss:ShChk]
  4542 00001C62 7216                    		jb	short BadSFT
  4543 00001C64 EB06                    		jmp	short CheckD
  4544                                  ; ---------------------------------------------------------------------------
  4545                                  
  4546                                  CheckFirClus:
  4547 00001C66 263B5D0B                		cmp	bx, [es:di+0Bh]
  4548 00001C6A 750E                    		jnz	short BadSFT
  4549                                  
  4550                                  CheckD:					; ...
  4551 00001C6C 243F                    		and	al, 3Fh
  4552 00001C6E 268A6505                		mov	ah, [es:di+5]
  4553 00001C72 80E43F                  		and	ah, 3Fh
  4554 00001C75 38C4                    		cmp	ah, al
  4555 00001C77 7501                    		jnz	short BadSFT
  4556                                  
  4557                                  BlastSFT_retn:				; ...
  4558 00001C79 C3                      		retn
  4559                                  ; ---------------------------------------------------------------------------
  4560                                  
  4561                                  BadSFT:					; ...
  4562 00001C7A F9                      		stc
  4563 00001C7B C3                      		retn
  4564                                  ; ---------------------------------------------------------------------------
  4565                                  
  4566                                  CheckNet:				; ...
  4567 00001C7C 8B441C                  		mov	ax, [si+1Ch]
  4568 00001C7F 263B450B                		cmp	ax, [es:di+0Bh]
  4569 00001C83 75F5                    		jnz	short BadSFT
  4570 00001C85 C3                      		retn
  4571                                  
  4572                                  ; ---------------------------------------------------------------------------
  4573                                  
  4574                                  CheckNoShare:				; ...
  4575 00001C86 A840                    		test	al, 40h
  4576 00001C88 7500                    		jnz	short $+2
  4577 00001C8A 8B5C1A                  		mov	bx, [si+1Ah]
  4578 00001C8D 263B5D07                		cmp	bx, [es:di+7]
  4579 00001C91 75E7                    		jnz	short BadSFT
  4580 00001C93 8B5C1C                  		mov	bx, [si+1Ch]
  4581 00001C96 263B5D09                		cmp	bx, [es:di+9]
  4582 00001C9A 75DE                    		jnz	short BadSFT
  4583 00001C9C EBCE                    		jmp	short CheckD
  4584                                  
  4585                                  ; =============== S U B	R O U T	I N E =======================================
  4586                                  
  4587                                  
  4588                                  SFTFromFCB:
  4589 00001C9E 50                      		push	ax
  4590 00001C9F 53                      		push	bx
  4591 00001CA0 8A4418                  		mov	al, [si+18h]
  4592 00001CA3 E87EFF                  		call	CheckFCB
  4593 00001CA6 5B                      		pop	bx
  4594 00001CA7 58                      		pop	ax
  4595 00001CA8 36893E[9E05]            		mov	word [ss:THISSFT], di
  4596 00001CAD 368C06[A005]            		mov	word [ss:THISSFT+2], es
  4597 00001CB2 7311                    		jnb	short Set_SFT
  4598 00001CB4 06                      		push	es
  4599 00001CB5 E8CBE7                  		call	save_world
  4600 00001CB8 E860FE                  		call	FCBRegen
  4601 00001CBB E8AEE7                  		call	restore_world
  4602 00001CBE 07                      		pop	es
  4603 00001CBF 36A1[2403]              		mov	ax, [ss:EXTERR]
  4604 00001CC3 72B4                    		jb	short BlastSFT_retn
  4605                                  
  4606                                  Set_SFT:				; ...
  4607 00001CC5 36C43E[9E05]            		les	di, [ss:THISSFT]
  4608 00001CCA 36FF36[3C03]            		push	word [ss:PROC_ID]
  4609 00001CCF 268F4531                		pop	word [es:di+31h]
  4610 00001CD3 C3                      		retn
  4611                                  
  4612                                  ; =============== S U B	R O U T	I N E =======================================
  4613                                  
  4614                                  
  4615                                  FCBHardErr:
  4616 00001CD4 2E8E06[0700]            		mov	es, [cs:DosDSeg]
  4617 00001CD9 B82300                  		mov	ax, 23h	; '#'
  4618 00001CDC 26C606[4B03]08          		mov	byte [es:ALLOWED], 8
  4619 00001CE2 26C42E[8A05]            		les	bp, [es:THISDPB]
  4620 00001CE7 BF0100                  		mov	di, 1
  4621 00001CEA 89F9                    		mov	cx, di
  4622 00001CEC 268B560B                		mov	dx, [es:bp+0Bh]
  4623 00001CF0 E80338                  		call	HARDERR
  4624 00001CF3 F9                      		stc
  4625 00001CF4 C3                      		retn
  4626                                  
  4627                                  ; =============== S U B	R O U T	I N E =======================================
  4628                                  
  4629                                  
  4630                                  GetRR:
  4631 00001CF5 8B4421                  		mov	ax, [si+21h]
  4632 00001CF8 8B5423                  		mov	dx, [si+23h]
  4633 00001CFB 83FB40                  		cmp	bx, 64
  4634 00001CFE 7202                    		jb	short GetRRBye
  4635 00001D00 30F6                    		xor	dh, dh
  4636                                  
  4637                                  GetRRBye:				; ...
  4638 00001D02 C3                      		retn
  4639                                  
  4640                                  ; =============== S U B	R O U T	I N E =======================================
  4641                                  
  4642                                  
  4643                                  GetExtent:
  4644 00001D03 8A4420                  		mov	al, [si+20h]
  4645 00001D06 8B540C                  		mov	dx, [si+0Ch]
  4646 00001D09 D0E0                    		shl	al, 1
  4647 00001D0B D1EA                    		shr	dx, 1
  4648 00001D0D D0D8                    		rcr	al, 1
  4649 00001D0F 88D4                    		mov	ah, dl
  4650 00001D11 88F2                    		mov	dl, dh
  4651 00001D13 30F6                    		xor	dh, dh
  4652 00001D15 C3                      		retn
  4653                                  
  4654                                  ; =============== S U B	R O U T	I N E =======================================
  4655                                  
  4656                                  
  4657                                  SetExtent:
  4658 00001D16 50                      		push	ax
  4659 00001D17 52                      		push	dx
  4660 00001D18 89C1                    		mov	cx, ax
  4661 00001D1A 247F                    		and	al, 7Fh
  4662 00001D1C 884420                  		mov	[si+20h], al
  4663 00001D1F 80E180                  		and	cl, 80h
  4664 00001D22 D1E1                    		shl	cx, 1
  4665 00001D24 D1D2                    		rcl	dx, 1
  4666 00001D26 88E8                    		mov	al, ch
  4667 00001D28 88D4                    		mov	ah, dl
  4668 00001D2A 89440C                  		mov	[si+0Ch], ax
  4669 00001D2D 5A                      		pop	dx
  4670 00001D2E 58                      		pop	ax
  4671 00001D2F C3                      		retn
  4672                                  
  4673                                  ; =============== S U B	R O U T	I N E =======================================
  4674                                  
  4675                                  
  4676                                  GetExtended:
  4677 00001D30 89D6                    		mov	si, dx
  4678 00001D32 803CFF                  		cmp	byte [si], 0FFh
  4679 00001D35 7503                    		jnz	short GetBye
  4680 00001D37 83C607                  		add	si, 7
  4681                                  
  4682                                  GetBye:					; ...
  4683 00001D3A 39D6                    		cmp	si, dx
  4684                                  
  4685                                  getextd_retn:				; ...
  4686 00001D3C C3                      		retn
  4687                                  
  4688                                  ; =============== S U B	R O U T	I N E =======================================
  4689                                  
  4690                                  
  4691                                  GetRecSize:
  4692 00001D3D 8B5C0E                  		mov	bx, [si+0Eh]
  4693 00001D40 09DB                    		or	bx, bx
  4694 00001D42 75F8                    		jnz	short getextd_retn
  4695 00001D44 BB8000                  		mov	bx, 128
  4696 00001D47 895C0E                  		mov	[si+0Eh], bx
  4697 00001D4A C3                      		retn
  4698                                  
  4699                                  ; =============== S U B	R O U T	I N E =======================================
  4700                                  
  4701                                  ; Attributes: bp-based frame
  4702                                  
  4703                                  FCBIO:
  4704                                  
  4705                                  ;FCBOp		= byte ptr -14h
  4706                                  ;cRecRes	= word ptr -13h
  4707                                  ;cResult	= word ptr -11h
  4708                                  ;cByte		= word ptr -0Fh
  4709                                  ;bPosL		= word ptr -0Dh
  4710                                  ;bPosH		= word ptr -0Bh
  4711                                  ;RecSize	= word ptr -9
  4712                                  ;RecPosL	= word ptr -7
  4713                                  ;RecPosH	= word ptr -5
  4714                                  ;cRec		= word ptr -3
  4715                                  ;FCBErr		= byte ptr -1
  4716                                  
  4717                                  FCBErr	equ -1	
  4718                                  cRec	equ -3
  4719                                  RecPosH equ -5
  4720                                  RecPosL	equ -7
  4721                                  RecSize	equ -9
  4722                                  bPosH	equ -11
  4723                                  bPosL	equ -13
  4724                                  cByte	equ -15	
  4725                                  cResult equ -17	
  4726                                  cRecRes	equ -19
  4727                                  FCBOp	equ -20
  4728                                  
  4729 00001D4B 55                      		push	bp
  4730 00001D4C 89E5                    		mov	bp, sp
  4731 00001D4E 83EC14                  		sub	sp, 20
  4732 00001D51 8846EC                  		mov	[bp+FCBOp], al
  4733 00001D54 C646FF00                		mov	byte [bp+FCBErr], 0
  4734 00001D58 E8D5FF                  		call	GetExtended
  4735 00001D5B F646EC08                		test	byte [bp+FCBOp], 8
  4736 00001D5F 7503                    		jnz	short GetPos
  4737 00001D61 B90100                  		mov	cx, 1
  4738                                  
  4739                                  GetPos:					; ...
  4740 00001D64 894EFD                  		mov	[bp+cRec], cx
  4741 00001D67 E899FF                  		call	GetExtent
  4742 00001D6A E8D0FF                  		call	GetRecSize
  4743 00001D6D 895EF7                  		mov	[bp+RecSize], bx
  4744 00001D70 F646EC02                		test	byte [bp+FCBOp], 2
  4745 00001D74 7403                    		jz	short GetRec
  4746 00001D76 E87CFF                  		call	GetRR
  4747                                  
  4748                                  GetRec:					; ...
  4749 00001D79 8946F9                  		mov	[bp+RecPosL], ax
  4750 00001D7C 8956FB                  		mov	[bp+RecPosH], dx
  4751 00001D7F E894FF                  		call	SetExtent
  4752 00001D82 8B46FB                  		mov	ax, [bp+RecPosH]
  4753 00001D85 F7E3                    		mul	bx
  4754 00001D87 89C7                    		mov	di, ax
  4755 00001D89 8B46F9                  		mov	ax, [bp+RecPosL]
  4756 00001D8C F7E3                    		mul	bx
  4757 00001D8E 01FA                    		add	dx, di
  4758 00001D90 8946F3                  		mov	[bp+bPosL], ax
  4759 00001D93 8956F5                  		mov	[bp+bPosH], dx
  4760 00001D96 8B46FD                  		mov	ax, [bp+cRec]
  4761 00001D99 F7E3                    		mul	bx
  4762 00001D9B 8946F1                  		mov	[bp+cByte], ax
  4763 00001D9E 360306[2C03]            		add	ax, word [ss:DMAADD]
  4764 00001DA3 83D200                  		adc	dx, 0
  4765 00001DA6 7419                    		jz	short DoOper
  4766 00001DA8 C646FF02                		mov	byte [bp+FCBErr], 2
  4767 00001DAC 36A1[2C03]              		mov	ax, word [ss:DMAADD]
  4768 00001DB0 F7D8                    		neg	ax
  4769 00001DB2 7501                    		jnz	short DoDiv
  4770 00001DB4 48                      		dec	ax
  4771                                  
  4772                                  DoDiv:					; ...
  4773 00001DB5 31D2                    		xor	dx, dx
  4774 00001DB7 F7F3                    		div	bx
  4775 00001DB9 8946FD                  		mov	[bp+cRec], ax
  4776 00001DBC F7E3                    		mul	bx
  4777 00001DBE 8946F1                  		mov	[bp+cByte], ax
  4778                                  
  4779                                  DoOper:					; ...
  4780 00001DC1 31DB                    		xor	bx, bx
  4781 00001DC3 895EEF                  		mov	[bp+cResult], bx
  4782 00001DC6 395EF1                  		cmp	[bp+cByte], bx
  4783 00001DC9 7508                    		jnz	short DoGetExt
  4784 00001DCB F646FF02                		test	byte [bp+FCBErr], 2
  4785 00001DCF 7402                    		jz	short DoGetExt
  4786 00001DD1 EB76                    		jmp	short SkipOp
  4787                                  ; ---------------------------------------------------------------------------
  4788                                  
  4789                                  DoGetExt:				; ...
  4790 00001DD3 E8C8FE                  		call	SFTFromFCB
  4791 00001DD6 730F                    		jnb	short ContinueOp
  4792                                  
  4793                                  FCBDeath:				; ...
  4794 00001DD8 E855E8                  		call	FCB_RET_ERR
  4795 00001DDB C746ED0000              		mov	word [bp+cRecRes], 0
  4796 00001DE0 C646FF01                		mov	byte [bp+FCBErr], 1
  4797 00001DE4 E9EF00                  		jmp	FCBSave
  4798                                  ; ---------------------------------------------------------------------------
  4799                                  
  4800                                  ContinueOp:				; ...
  4801 00001DE7 8B4410                  		mov	ax, [si+10h]
  4802 00001DEA 26894511                		mov	[es:di+11h], ax
  4803 00001DEE 8B4412                  		mov	ax, [si+12h]
  4804 00001DF1 26894513                		mov	[es:di+13h], ax
  4805 00001DF5 8B46F3                  		mov	ax, [bp+bPosL]
  4806 00001DF8 8B56F5                  		mov	dx, [bp+bPosH]
  4807 00001DFB 26894515                		mov	[es:di+15h], ax
  4808 00001DFF 26875517                		xchg	dx, [es:di+17h]
  4809 00001E03 52                      		push	dx
  4810 00001E04 8B4EF1                  		mov	cx, [bp+cByte]
  4811 00001E07 BF[1D34]                		mov	di, DOS_READ
  4812 00001E0A F646EC04                		test	byte [bp+FCBOp], 4
  4813 00001E0E 7503                    		jnz	short DoContext
  4814 00001E10 BF[4C36]                		mov	di, DOS_WRITE
  4815                                  
  4816                                  DoContext:				; ...
  4817 00001E13 55                      		push	bp
  4818 00001E14 1E                      		push	ds
  4819 00001E15 56                      		push	si
  4820 00001E16 16                      		push	ss
  4821 00001E17 1F                      		pop	ds
  4822 00001E18 FFD7                    		call	di ; DOS_READ
  4823 00001E1A 5E                      		pop	si
  4824 00001E1B 1F                      		pop	ds
  4825 00001E1C 5D                      		pop	bp
  4826 00001E1D 72B9                    		jb	short FCBDeath
  4827 00001E1F 36803E[0B06]00          		cmp	byte [ss:DISK_FULL], 0
  4828 00001E25 740A                    		jz	short NODSKFULL
  4829 00001E27 36C606[0B06]00          		mov	byte [ss:DISK_FULL], 0
  4830 00001E2D C646FF01                		mov	byte [bp+FCBErr], 1
  4831                                  
  4832                                  NODSKFULL:				; ...
  4833 00001E31 894EEF                  		mov	[bp+cResult], cx
  4834 00001E34 E81CFB                  		call	SaveFCBInfo
  4835 00001E37 268F4517                		pop	word [es:di+17h]
  4836 00001E3B 268B4511                		mov	ax, [es:di+11h]
  4837 00001E3F 894410                  		mov	[si+10h], ax
  4838 00001E42 268B4513                		mov	ax, [es:di+13h]
  4839 00001E46 894412                  		mov	[si+12h], ax
  4840                                  
  4841                                  SkipOp:					; ...
  4842 00001E49 8B46EF                  		mov	ax, [bp+cResult]
  4843 00001E4C 31D2                    		xor	dx, dx
  4844 00001E4E F776F7                  		div	word [bp+RecSize]
  4845 00001E51 8946ED                  		mov	[bp+cRecRes], ax
  4846 00001E54 0146F9                  		add	[bp+RecPosL], ax
  4847 00001E57 8356FB00                		adc	word [bp+RecPosH], 0
  4848 00001E5B 3B46FD                  		cmp	ax, [bp+cRec]
  4849 00001E5E 7411                    		jz	short TryBlank
  4850 00001E60 F646EC04                		test	byte [bp+FCBOp], 4
  4851 00001E64 7507                    		jnz	short SetEOF
  4852 00001E66 26F6450580              		test	byte [es:di+5], 80h
  4853 00001E6B 7504                    		jnz	short TryBlank
  4854                                  
  4855                                  SetEOF:					; ...
  4856 00001E6D C646FF01                		mov	byte [bp+FCBErr], 1
  4857                                  
  4858                                  TryBlank:				; ...
  4859 00001E71 09D2                    		or	dx, dx
  4860 00001E73 7426                    		jz	short SetExt
  4861 00001E75 8346F901                		add	word [bp+RecPosL], 1
  4862 00001E79 8356FB00                		adc	word [bp+RecPosH], 0
  4863 00001E7D F646EC04                		test	byte [bp+FCBOp], 4
  4864 00001E81 7418                    		jz	short SetExt
  4865 00001E83 FF46ED                  		inc	word [bp+cRecRes]
  4866 00001E86 C646FF03                		mov	byte [bp+FCBErr], 3
  4867 00001E8A 8B4EF7                  		mov	cx, [bp+RecSize]
  4868 00001E8D 29D1                    		sub	cx, dx
  4869 00001E8F 30C0                    		xor	al, al
  4870 00001E91 36C43E[2C03]            		les	di, [ss:DMAADD]
  4871 00001E96 037EEF                  		add	di, [bp+cResult]
  4872 00001E99 F3AA                    		rep stosb
  4873                                  
  4874                                  SetExt:					; ...
  4875 00001E9B 8B56FB                  		mov	dx, [bp+RecPosH]
  4876 00001E9E 8B46F9                  		mov	ax, [bp+RecPosL]
  4877 00001EA1 F646EC02                		test	byte [bp+FCBOp], 2
  4878 00001EA5 7406                    		jz	short DoSetExt
  4879 00001EA7 F646EC08                		test	byte [bp+FCBOp], 8
  4880 00001EAB 7403                    		jz	short TrySetRR
  4881                                  
  4882                                  DoSetExt:				; ...
  4883 00001EAD E866FE                  		call	SetExtent
  4884                                  
  4885                                  TrySetRR:				; ...
  4886 00001EB0 F646EC08                		test	byte [bp+FCBOp], 8
  4887 00001EB4 740F                    		jz	short TryReturn
  4888 00001EB6 894421                  		mov	[si+21h], ax
  4889 00001EB9 885423                  		mov	[si+23h], dl
  4890 00001EBC 837C0E40                		cmp	word [si+0Eh], 64
  4891 00001EC0 7303                    		jnb	short TryReturn
  4892 00001EC2 887424                  		mov	[si+24h], dh
  4893                                  
  4894                                  TryReturn:				; ...
  4895 00001EC5 F646EC04                		test	byte [bp+FCBOp], 4
  4896 00001EC9 750B                    		jnz	short FCBSave
  4897 00001ECB 1E                      		push	ds
  4898 00001ECC E81FEC                  		call	DATE16
  4899 00001ECF 1F                      		pop	ds
  4900 00001ED0 894414                  		mov	[si+14h], ax
  4901 00001ED3 895416                  		mov	[si+16h], dx
  4902                                  
  4903                                  FCBSave:				; ...
  4904 00001ED6 F646EC08                		test	byte [bp+FCBOp], 8
  4905 00001EDA 7409                    		jz	short DoReturn
  4906 00001EDC 8B4EED                  		mov	cx, [bp+cRecRes]
  4907 00001EDF E8C0E5                  		call	Get_User_Stack
  4908 00001EE2 894C04                  		mov	[si+4],	cx
  4909                                  
  4910                                  DoReturn:				; ...
  4911 00001EE5 8A46FF                  		mov	al, [bp+FCBErr]
  4912 00001EE8 89EC                    		mov	sp, bp
  4913 00001EEA 5D                      		pop	bp
  4914 00001EEB C3                      		retn
  4915                                  
  4916                                  ; =============== S U B	R O U T	I N E =======================================
  4917                                  
  4918                                  
  4919                                  $FCB_OPEN:
  4920 00001EEC B80200                  		mov	ax, 2
  4921 00001EEF B9[802C]                		mov	cx, DOS_OPEN
  4922                                  
  4923                                  DoAccess:				; ...
  4924 00001EF2 1E                      		push	ds
  4925 00001EF3 52                      		push	dx
  4926 00001EF4 51                      		push	cx
  4927 00001EF5 50                      		push	ax
  4928 00001EF6 BF[BE03]                		mov	di, OPENBUF
  4929 00001EF9 E85B4E                  		call	TransFCB
  4930 00001EFC 58                      		pop	ax
  4931 00001EFD 59                      		pop	cx
  4932 00001EFE 5A                      		pop	dx
  4933 00001EFF 1F                      		pop	ds
  4934 00001F00 7303                    		jnb	short FindFCB
  4935                                  
  4936                                  FCBOpenErr:				; ...
  4937 00001F02 E92BE7                  		jmp	FCB_RET_ERR
  4938                                  ; ---------------------------------------------------------------------------
  4939                                  
  4940                                  FindFCB:				; ...
  4941 00001F05 E828FE                  		call	GetExtended
  4942 00001F08 50                      		push	ax
  4943 00001F09 B001                    		mov	al, 1
  4944 00001F0B E817FB                  		call	LRUFCB
  4945 00001F0E 58                      		pop	ax
  4946 00001F0F 722A                    		jb	short HardMessage
  4947 00001F11 26C745020080            		mov	word [es:di+2], 8000h
  4948 00001F17 1E                      		push	ds
  4949 00001F18 56                      		push	si
  4950 00001F19 53                      		push	bx
  4951 00001F1A 89CE                    		mov	si, cx
  4952 00001F1C 16                      		push	ss
  4953 00001F1D 1F                      		pop	ds
  4954 00001F1E FFD6                    		call	si
  4955 00001F20 5B                      		pop	bx
  4956 00001F21 5E                      		pop	si
  4957 00001F22 1F                      		pop	ds
  4958 00001F23 36C43E[9E05]            		les	di, [ss:THISSFT]
  4959 00001F28 7318                    		jnb	short FCBOK
  4960 00001F2A 50                      		push	ax
  4961 00001F2B B052                    		mov	al, 'R'
  4962 00001F2D E8DEFC                  		call	BlastSFT
  4963 00001F30 58                      		pop	ax
  4964 00001F31 83F804                  		cmp	ax, 4
  4965 00001F34 7405                    		jz	short HardMessage
  4966 00001F36 83F824                  		cmp	ax, 24h	; '$'
  4967 00001F39 7505                    		jnz	short DeadFCB
  4968                                  
  4969                                  HardMessage:				; ...
  4970 00001F3B 50                      		push	ax
  4971 00001F3C E895FD                  		call	FCBHardErr
  4972 00001F3F 58                      		pop	ax
  4973                                  
  4974                                  DeadFCB:				; ...
  4975 00001F40 EBC0                    		jmp	short FCBOpenErr
  4976                                  ; ---------------------------------------------------------------------------
  4977                                  
  4978                                  FCBOK:					; ...
  4979 00001F42 E869F3                  		call	IsSFTNet
  4980 00001F45 750F                    		jnz	short FCBOK2
  4981 00001F47 E85456                  		call	CheckShare
  4982 00001F4A 750A                    		jnz	short FCBOK2
  4983 00001F4C 36893E[5D10]            		mov	word [ss:LocalSFT], di
  4984 00001F51 368C06[5F10]            		mov	word [ss:LocalSFT+2], es
  4985                                  
  4986                                  FCBOK2:					; ...
  4987 00001F56 26FF05                  		inc	word [es:di]
  4988 00001F59 E8F7F9                  		call	SaveFCBInfo
  4989 00001F5C 26F6450580              		test	byte [es:di+5], 80h
  4990 00001F61 7509                    		jnz	short FCBNoDrive
  4991 00001F63 8A04                    		mov	al, [si]
  4992 00001F65 E8744D                  		call	GETTHISDRV
  4993 00001F68 FEC0                    		inc	al
  4994 00001F6A 8804                    		mov	[si], al
  4995                                  
  4996                                  FCBNoDrive:				; ...
  4997 00001F6C C7440E8000              		mov	word [si+0Eh], 80h
  4998 00001F71 268B450D                		mov	ax, [es:di+0Dh]
  4999 00001F75 894416                  		mov	[si+16h], ax
  5000 00001F78 268B450F                		mov	ax, [es:di+0Fh]
  5001 00001F7C 894414                  		mov	[si+14h], ax
  5002 00001F7F 268B4511                		mov	ax, [es:di+11h]
  5003 00001F83 894410                  		mov	[si+10h], ax
  5004 00001F86 268B4513                		mov	ax, [es:di+13h]
  5005 00001F8A 894412                  		mov	[si+12h], ax
  5006 00001F8D 31C0                    		xor	ax, ax
  5007 00001F8F 89440C                  		mov	[si+0Ch], ax
  5008 00001F92 36C43E[4000]            		les	di, [ss:SFTFCB]
  5009 00001F97 268A6504                		mov	ah, [es:di+4]
  5010                                  
  5011                                  OpenScan:				; ...
  5012 00001F9B 3A4418                  		cmp	al, [si+18h]
  5013 00001F9E 7407                    		jz	short SkipCheck
  5014 00001FA0 50                      		push	ax
  5015 00001FA1 E880FC                  		call	CheckFCB
  5016 00001FA4 58                      		pop	ax
  5017 00001FA5 7309                    		jnb	short OpenFound
  5018                                  
  5019                                  SkipCheck:				; ...
  5020 00001FA7 FEC0                    		inc	al
  5021 00001FA9 38E0                    		cmp	al, ah
  5022 00001FAB 75EE                    		jnz	short OpenScan
  5023                                  
  5024                                  OpenDone:				; ...
  5025 00001FAD 30C0                    		xor	al, al
  5026 00001FAF C3                      		retn
  5027                                  ; ---------------------------------------------------------------------------
  5028                                  
  5029                                  OpenFound:				; ...
  5030 00001FB0 884418                  		mov	[si+18h], al
  5031 00001FB3 26FF05                  		inc	word [es:di]
  5032 00001FB6 36A1[1000]              		mov	ax, [ss:FCBLRU]
  5033 00001FBA 26894515                		mov	[es:di+15h], ax
  5034 00001FBE 16                      		push	ss
  5035 00001FBF 1F                      		pop	ds
  5036 00001FC0 C43E[9E05]              		les	di, [THISSFT]
  5037 00001FC4 26FF0D                  		dec	word [es:di]
  5038 00001FC7 E80C56                  		call	ShareEnd
  5039 00001FCA B043                    		mov	al, 'C'
  5040 00001FCC E83FFC                  		call	BlastSFT
  5041 00001FCF EBDC                    		jmp	short OpenDone
  5042                                  
  5043                                  ; ---------------------------------------------------------------------------
  5044                                  
  5045                                  $FCB_CREATE:				; ...
  5046 00001FD1 B9[542B]                		mov	cx, DOS_CREATE
  5047 00001FD4 31C0                    		xor	ax, ax
  5048 00001FD6 E857FD                  		call	GetExtended
  5049 00001FD9 7403                    		jz	short DoAccessJ
  5050 00001FDB 8A44FF                  		mov	al, [si-1]
  5051                                  
  5052                                  DoAccessJ:				; ...
  5053 00001FDE E911FF                  		jmp	DoAccess
  5054                                  ; ---------------------------------------------------------------------------
  5055                                  
  5056                                  $FCB_RANDOM_WRITE_BLOCK:		; ...
  5057 00001FE1 B00A                    		mov	al, 0Ah
  5058 00001FE3 E965FD                  		jmp	FCBIO
  5059                                  ; ---------------------------------------------------------------------------
  5060                                  
  5061                                  $FCB_RANDOM_READ_BLOCK:			; ...
  5062 00001FE6 B00E                    		mov	al, 0Eh
  5063 00001FE8 E960FD                  		jmp	FCBIO
  5064                                  ; ---------------------------------------------------------------------------
  5065                                  
  5066                                  $FCB_SEQ_READ:				; ...
  5067 00001FEB B004                    		mov	al, 4
  5068 00001FED E95BFD                  		jmp	FCBIO
  5069                                  ; ---------------------------------------------------------------------------
  5070                                  
  5071                                  $FCB_SEQ_WRITE:				; ...
  5072 00001FF0 B000                    		mov	al, 0
  5073 00001FF2 E956FD                  		jmp	FCBIO
  5074                                  ; ---------------------------------------------------------------------------
  5075                                  
  5076                                  $FCB_RANDOM_READ:			; ...
  5077 00001FF5 B006                    		mov	al, 6
  5078 00001FF7 E951FD                  		jmp	FCBIO
  5079                                  ; ---------------------------------------------------------------------------
  5080                                  
  5081                                  $FCB_RANDOM_WRITE:			; ...
  5082 00001FFA B002                    		mov	al, 2
  5083 00001FFC E94CFD                  		jmp	FCBIO
  5084                                  ; ---------------------------------------------------------------------------
  5085                                  
  5086                                  $DIR_SEARCH_FIRST:			; ...
  5087 00001FFF 368916[A605]            		mov	word [ss:THISFCB], dx
  5088 00002004 368C1E[A805]            		mov	word [ss:THISFCB+2], ds
  5089 00002009 89D6                    		mov	si, dx
  5090 0000200B 803CFF                  		cmp	byte [si], 0FFh
  5091 0000200E 7503                    		jnz	short NORMFCB4
  5092 00002010 83C607                  		add	si, 7
  5093                                  
  5094                                  NORMFCB4:				; ...
  5095 00002013 FF34                    		push	word [si]
  5096 00002015 16                      		push	ss
  5097 00002016 07                      		pop	es
  5098 00002017 BF[BE03]                		mov	di, OPENBUF
  5099 0000201A E83A4D                  		call	TransFCB
  5100 0000201D 7304                    		jnb	short SearchIt
  5101 0000201F 5B                      		pop	bx
  5102                                  
  5103                                  dsf_err:				; ...
  5104 00002020 E90DE6                  		jmp	FCB_RET_ERR
  5105                                  ; ---------------------------------------------------------------------------
  5106                                  
  5107                                  SearchIt:				; ...
  5108 00002023 16                      		push	ss
  5109 00002024 1F                      		pop	ds
  5110 00002025 FF36[2C03]              		push	word [DMAADD]
  5111 00002029 FF36[2E03]              		push	word [DMAADD+2]
  5112 0000202D C706[2C03][BE04]        		mov	word [DMAADD], SEARCHBUF
  5113 00002033 8C1E[2E03]              		mov	word [DMAADD+2], ds
  5114 00002037 E88B01                  		call	GET_FAST_SEARCH
  5115 0000203A 8F06[2E03]              		pop	word [DMAADD+2]
  5116 0000203E 8F06[2C03]              		pop	word [DMAADD]
  5117 00002042 7303                    		jnb	short SearchSet
  5118 00002044 5B                      		pop	bx
  5119 00002045 EBD9                    		jmp	short dsf_err
  5120                                  ; ---------------------------------------------------------------------------
  5121                                  
  5122                                  SearchSet:				; ...
  5123 00002047 BE[BE04]                		mov	si, SEARCHBUF
  5124 0000204A C43E[A605]              		les	di, [THISFCB]
  5125 0000204E F606[6C05]FF            		test	byte [EXTFCB], 0FFh
  5126 00002053 7403                    		jz	short NORMFCB1
  5127 00002055 83C707                  		add	di, 7
  5128                                  
  5129                                  NORMFCB1:				; ...
  5130 00002058 5B                      		pop	bx
  5131 00002059 08DB                    		or	bl, bl
  5132 0000205B 7506                    		jnz	short SearchDrv
  5133 0000205D 8A1E[3603]              		mov	bl, [CURDRV]
  5134 00002061 FEC3                    		inc	bl
  5135                                  
  5136                                  SearchDrv:				; ...
  5137 00002063 AC                      		lodsb
  5138 00002064 86C3                    		xchg	al, bl
  5139 00002066 47                      		inc	di
  5140 00002067 B90A00                  		mov	cx, 10
  5141 0000206A F3A5                    		rep movsw
  5142 0000206C 86C3                    		xchg	al, bl
  5143 0000206E AA                      		stosb
  5144 0000206F C43E[2C03]              		les	di, [DMAADD]
  5145 00002073 F606[6C05]FF            		test	byte [EXTFCB], 0FFh
  5146 00002078 740E                    		jz	short NORMFCB2
  5147 0000207A B0FF                    		mov	al, 0FFh
  5148 0000207C AA                      		stosb
  5149 0000207D FEC0                    		inc	al
  5150 0000207F B90500                  		mov	cx, 5
  5151 00002082 F3AA                    		rep stosb
  5152 00002084 A0[6D05]                		mov	al, [SATTRIB]
  5153 00002087 AA                      		stosb
  5154                                  
  5155                                  NORMFCB2:				; ...
  5156 00002088 88D8                    		mov	al, bl
  5157 0000208A AA                      		stosb
  5158 0000208B B91000                  		mov	cx, 16
  5159 0000208E F3A5                    		rep movsw
  5160 00002090 E99AE5                  		jmp	NO_OP
  5161                                  ; ---------------------------------------------------------------------------
  5162                                  
  5163                                  $DIR_SEARCH_NEXT:			; ...
  5164 00002093 368916[A605]            		mov	word [ss:THISFCB], dx
  5165 00002098 368C1E[A805]            		mov	word [ss:THISFCB+2], ds
  5166 0000209D 36C606[6D05]00          		mov	byte [ss:SATTRIB], 0
  5167 000020A3 36C606[6C05]00          		mov	byte [ss:EXTFCB], 0
  5168 000020A9 16                      		push	ss
  5169 000020AA 07                      		pop	es
  5170 000020AB BF[BE04]                		mov	di, SEARCHBUF
  5171 000020AE 89D6                    		mov	si, dx
  5172 000020B0 803CFF                  		cmp	byte [si], 0FFh
  5173 000020B3 750D                    		jnz	short NORMFCB6
  5174 000020B5 83C606                  		add	si, 6
  5175 000020B8 AC                      		lodsb
  5176 000020B9 36A2[6D05]              		mov	byte [ss:SATTRIB], al
  5177 000020BD 36FE0E[6C05]            		dec	byte [ss:EXTFCB]
  5178                                  
  5179                                  NORMFCB6:				; ...
  5180 000020C2 AC                      		lodsb
  5181 000020C3 50                      		push	ax
  5182 000020C4 8A4414                  		mov	al, [si+20]
  5183 000020C7 AA                      		stosb
  5184 000020C8 B90A00                  		mov	cx, 10
  5185 000020CB F3A5                    		rep movsw
  5186 000020CD 16                      		push	ss
  5187 000020CE 1F                      		pop	ds
  5188 000020CF FF36[2C03]              		push	word [DMAADD]
  5189 000020D3 FF36[2E03]              		push	word [DMAADD+2]
  5190 000020D7 C706[2C03][BE04]        		mov	word [DMAADD], SEARCHBUF
  5191 000020DD 8C1E[2E03]              		mov	word [DMAADD+2], ds
  5192 000020E1 E8630E                  		call	DOS_SEARCH_NEXT
  5193 000020E4 8F06[2E03]              		pop	word [DMAADD+2]
  5194 000020E8 8F06[2C03]              		pop	word [DMAADD]
  5195 000020EC 7203                    		jb	short SearchNoMore
  5196 000020EE E956FF                  		jmp	SearchSet
  5197                                  ; ---------------------------------------------------------------------------
  5198                                  
  5199                                  SearchNoMore:				; ...
  5200 000020F1 C43E[A605]              		les	di, [THISFCB]
  5201 000020F5 F606[6C05]FF            		test	byte [EXTFCB], 0FFh
  5202 000020FA 7403                    		jz	short NORMFCB8
  5203 000020FC 83C707                  		add	di, 7
  5204                                  
  5205                                  NORMFCB8:				; ...
  5206 000020FF 5B                      		pop	bx
  5207 00002100 26881D                  		mov	[es:di], bl
  5208 00002103 E92AE5                  		jmp	FCB_RET_ERR
  5209                                  ; ---------------------------------------------------------------------------
  5210                                  
  5211                                  $FIND_FIRST:				; ...
  5212 00002106 89D6                    		mov	si, dx
  5213 00002108 36880E[6D05]            		mov	byte [ss:SATTRIB], cl
  5214 0000210D BF[BE03]                		mov	di, OPENBUF
  5215 00002110 E8AA4C                  		call	TransPathSet
  5216 00002113 7305                    		jnb	short Find_it
  5217 00002115 B003                    		mov	al, 3
  5218                                  
  5219                                  FindError:				; ...
  5220 00002117 E900E5                  		jmp	SYS_RET_ERR
  5221                                  ; ---------------------------------------------------------------------------
  5222                                  
  5223                                  Find_it:				; ...
  5224 0000211A 16                      		push	ss
  5225 0000211B 1F                      		pop	ds
  5226 0000211C FF36[2C03]              		push	word [DMAADD]
  5227 00002120 FF36[2E03]              		push	word [DMAADD+2]
  5228 00002124 C706[2C03][BE04]        		mov	word [DMAADD], SEARCHBUF
  5229 0000212A 8C1E[2E03]              		mov	word [DMAADD+2], ds
  5230 0000212E E89400                  		call	GET_FAST_SEARCH
  5231 00002131 8F06[2E03]              		pop	word [DMAADD+2]
  5232 00002135 8F06[2C03]              		pop	word [DMAADD]
  5233 00002139 7302                    		jnb	short FindSet
  5234                                  
  5235                                  FindItError:				; ...
  5236 0000213B EBDA                    		jmp	short FindError
  5237                                  ; ---------------------------------------------------------------------------
  5238                                  
  5239                                  FindSet:				; ...
  5240 0000213D BE[BE04]                		mov	si, SEARCHBUF
  5241 00002140 C43E[2C03]              		les	di, [DMAADD]
  5242 00002144 B91500                  		mov	cx, 21
  5243 00002147 F3A4                    		rep movsb
  5244 00002149 56                      		push	si
  5245 0000214A 8A440B                  		mov	al, [si+0Bh]
  5246 0000214D AA                      		stosb
  5247 0000214E 83C616                  		add	si, 16h
  5248 00002151 A5                      		movsw
  5249 00002152 A5                      		movsw
  5250 00002153 46                      		inc	si
  5251 00002154 46                      		inc	si
  5252 00002155 A5                      		movsw
  5253 00002156 A5                      		movsw
  5254 00002157 5E                      		pop	si
  5255 00002158 E83500                  		call	PackName
  5256 0000215B E9B3E4                  		jmp	SYS_RET_OK
  5257                                  ; ---------------------------------------------------------------------------
  5258                                  
  5259                                  $FIND_NEXT:				; ...
  5260 0000215E 16                      		push	ss
  5261 0000215F 07                      		pop	es
  5262 00002160 BF[BE04]                		mov	di, SEARCHBUF
  5263 00002163 36C536[2C03]            		lds	si, [ss:DMAADD]
  5264 00002168 B91500                  		mov	cx, 21
  5265 0000216B F3A4                    		rep movsb
  5266 0000216D 16                      		push	ss
  5267 0000216E 1F                      		pop	ds
  5268 0000216F FF36[2C03]              		push	word [DMAADD]
  5269 00002173 FF36[2E03]              		push	word [DMAADD+2]
  5270 00002177 C706[2C03][BE04]        		mov	word [DMAADD], SEARCHBUF
  5271 0000217D 8C1E[2E03]              		mov	word [DMAADD+2], ds
  5272 00002181 E8C30D                  		call	DOS_SEARCH_NEXT
  5273 00002184 8F06[2E03]              		pop	word [DMAADD+2]
  5274 00002188 8F06[2C03]              		pop	word [DMAADD]
  5275 0000218C 73AF                    		jnb	short FindSet
  5276 0000218E EBAB                    		jmp	short FindItError
  5277                                  
  5278                                  ; =============== S U B	R O U T	I N E =======================================
  5279                                  
  5280                                  
  5281                                  PackName:
  5282 00002190 B90800                  		mov	cx, 8
  5283 00002193 F3A4                    		rep movsb
  5284                                  
  5285                                  main_kill_tail:				; ...
  5286 00002195 26807DFF20              		cmp	byte [es:di-1], ' '
  5287 0000219A 7507                    		jnz	short find_check_dot
  5288 0000219C 4F                      		dec	di
  5289 0000219D 41                      		inc	cx
  5290 0000219E 83F908                  		cmp	cx, 8
  5291 000021A1 72F2                    		jb	short main_kill_tail
  5292                                  
  5293                                  find_check_dot:				; ...
  5294 000021A3 813C2020                		cmp	word [si], '  '
  5295 000021A7 7506                    		jnz	short got_ext
  5296 000021A9 807C0220                		cmp	byte [si+2], ' '
  5297 000021AD 7412                    		jz	short find_done
  5298                                  
  5299                                  got_ext:				; ...
  5300 000021AF B02E                    		mov	al, '.'
  5301 000021B1 AA                      		stosb
  5302 000021B2 B90300                  		mov	cx, 3
  5303 000021B5 F3A4                    		rep movsb
  5304                                  
  5305                                  ext_kill_tail:				; ...
  5306 000021B7 26807DFF20              		cmp	byte [es:di-1], ' '
  5307 000021BC 7503                    		jnz	short find_done
  5308 000021BE 4F                      		dec	di
  5309 000021BF EBF6                    		jmp	short ext_kill_tail
  5310                                  ; ---------------------------------------------------------------------------
  5311                                  
  5312                                  find_done:				; ...
  5313 000021C1 31C0                    		xor	ax, ax
  5314 000021C3 AA                      		stosb
  5315 000021C4 C3                      		retn
  5316                                  
  5317                                  ; =============== S U B	R O U T	I N E =======================================
  5318                                  
  5319                                  
  5320                                  GET_FAST_SEARCH:
  5321 000021C5 36810E[1106]0004        		or	word [ss:DOS34_FLAG], 400h
  5322 000021CC E8870C                  		call	DOS_SEARCH_FIRST
  5323 000021CF C3                      		retn
  5324                                  
  5325                                  ; ---------------------------------------------------------------------------
  5326                                  
  5327                                  $CURRENT_DIR:				; ...
  5328 000021D0 E887F1                  		call	ECritDisk
  5329 000021D3 88D0                    		mov	al, dl
  5330 000021D5 E8E74A                  		call	GetVisDrv
  5331 000021D8 7310                    		jnb	short CurrentValidate
  5332                                  
  5333                                  CurdirErr:				; ...
  5334 000021DA E89DF1                  		call	LCritDisk
  5335 000021DD 1E                      		push	ds
  5336 000021DE 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  5337 000021E3 A0[1006]                		mov	al, [DrvErr]
  5338 000021E6 1F                      		pop	ds
  5339                                  
  5340                                  curdir_errj:				; ...
  5341 000021E7 E930E4                  		jmp	SYS_RET_ERR
  5342                                  ; ---------------------------------------------------------------------------
  5343                                  
  5344                                  CurrentValidate:			; ...
  5345 000021EA 1E                      		push	ds
  5346 000021EB 56                      		push	si
  5347 000021EC 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  5348 000021F1 C536[A205]              		lds	si, [THISCDS]
  5349 000021F5 F744430080              		test	word [si+43h], 8000h
  5350 000021FA 7500                    		jnz	short $+2
  5351 000021FC 1E                      		push	ds
  5352 000021FD 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
  5353 00002202 C606[4C03]00            		mov	byte [NoSetDir], 0
  5354 00002207 1F                      		pop	ds
  5355 00002208 BF[BE03]                		mov	di, OPENBUF
  5356 0000220B E8E821                  		call	ValidateCDS
  5357 0000220E 06                      		push	es
  5358 0000220F 57                      		push	di
  5359 00002210 5E                      		pop	si
  5360 00002211 1F                      		pop	ds
  5361 00002212 5F                      		pop	di
  5362 00002213 07                      		pop	es
  5363 00002214 72C4                    		jb	short CurdirErr
  5364 00002216 83C600                  		add	si, 0
  5365 00002219 03744F                  		add	si, [si+4Fh]
  5366 0000221C 803C5C                  		cmp	byte [si], '\'
  5367 0000221F 7501                    		jnz	short CurrentCopy
  5368 00002221 46                      		inc	si
  5369                                  
  5370                                  CurrentCopy:				; ...
  5371 00002222 50                      		push	ax
  5372 00002223 AC                      		lodsb
  5373 00002224 08C0                    		or	al, al
  5374 00002226 7413                    		jz	short FOK
  5375 00002228 3C05                    		cmp	al, 5
  5376 0000222A 740D                    		jz	short FCHANGE
  5377 0000222C EB01                    		jmp	short FFF
  5378                                  ; ---------------------------------------------------------------------------
  5379                                  
  5380                                  FCPYNEXT:				; ...
  5381 0000222E AC                      		lodsb
  5382                                  
  5383                                  FFF:					; ...
  5384 0000222F 3C5C                    		cmp	al, '\'
  5385 00002231 7508                    		jnz	short FOK
  5386 00002233 AA                      		stosb
  5387 00002234 AC                      		lodsb
  5388 00002235 3C05                    		cmp	al, 5
  5389 00002237 7502                    		jnz	short FOK
  5390                                  
  5391                                  FCHANGE:				; ...
  5392 00002239 B0E5                    		mov	al, 0E5h ; ''
  5393                                  
  5394                                  FOK:					; ...
  5395 0000223B AA                      		stosb
  5396 0000223C 08C0                    		or	al, al
  5397 0000223E 75EE                    		jnz	short FCPYNEXT
  5398 00002240 58                      		pop	ax
  5399 00002241 30C0                    		xor	al, al
  5400 00002243 E834F1                  		call	LCritDisk
  5401 00002246 E9C8E3                  		jmp	SYS_RET_OK
  5402                                  ; ---------------------------------------------------------------------------
  5403                                  
  5404                                  $RMDIR:					; ...
  5405 00002249 52                      		push	dx
  5406 0000224A 1E                      		push	ds
  5407 0000224B 89D6                    		mov	si, dx
  5408 0000224D BF[BE03]                		mov	di, OPENBUF
  5409 00002250 57                      		push	di
  5410 00002251 E8714B                  		call	TransPathNoSet
  5411 00002254 5F                      		pop	di
  5412 00002255 7306                    		jnb	short rmlset
  5413 00002257 1F                      		pop	ds
  5414 00002258 5A                      		pop	dx
  5415 00002259 B003                    		mov	al, 3
  5416                                  
  5417                                  rmdir_errj:				; ...
  5418 0000225B EB8A                    		jmp	short curdir_errj
  5419                                  ; ---------------------------------------------------------------------------
  5420                                  
  5421                                  rmlset:					; ...
  5422 0000225D 36803E[7A05]FF          		cmp	byte [ss:CMETA], 0FFh
  5423 00002263 7512                    		jnz	short rmerr
  5424 00002265 16                      		push	ss
  5425 00002266 07                      		pop	es
  5426 00002267 30C0                    		xor	al, al
  5427                                  
  5428                                  rmloop:					; ...
  5429 00002269 E8C74A                  		call	GetCDSFromDrv
  5430 0000226C 720F                    		jb	short rmcont
  5431 0000226E E886EF                  		call	StrCmp
  5432 00002271 7404                    		jz	short rmerr
  5433 00002273 FEC0                    		inc	al
  5434 00002275 EBF2                    		jmp	short rmloop
  5435                                  ; ---------------------------------------------------------------------------
  5436                                  
  5437                                  rmerr:					; ...
  5438 00002277 1F                      		pop	ds
  5439 00002278 5A                      		pop	dx
  5440 00002279 B010                    		mov	al, 10h
  5441                                  
  5442                                  rmerrj:					; ...
  5443 0000227B EBDE                    		jmp	short rmdir_errj
  5444                                  ; ---------------------------------------------------------------------------
  5445                                  
  5446                                  rmcont:					; ...
  5447 0000227D 1F                      		pop	ds
  5448 0000227E 5A                      		pop	dx
  5449 0000227F BE[3F33]                		mov	si, DOS_RMDIR
  5450                                  		;; 27/09/2023 (*)
  5451                                  		;jmp	DoDirCall	; jmp short DoDirCall ; db 0EBh,7Fh
  5452                                  		;			; (!NASM converts it to short jump!)
  5453                                  		; 27/09/2023 (*)
  5454                                  		;db	0E9h,7Fh,0	; near call
  5455                                  		;			; (as in the original MSDOS.SYS)
  5456 00002282 E9                      		db	0E9h
  5457 00002283 7F00                    		dw	(DoDirCall-nextinstr)
  5458                                  nextinstr:		
  5459                                  
  5460                                  ; ---------------------------------------------------------------------------
  5461                                  
  5462                                  $CHDIR:					; (Here must be DOSCODE:6065h) (*)
  5463 00002285 BF[BE03]                		mov	di, OPENBUF
  5464 00002288 89D6                    		mov	si, dx
  5465 0000228A E82C4B                  		call	TransPath
  5466 0000228D 7304                    		jnb	short ChDirCrack
  5467                                  
  5468                                  ChDirErrP:				; ...
  5469 0000228F B003                    		mov	al, 3
  5470                                  
  5471                                  ChDirErr:				; ...
  5472 00002291 EBE8                    		jmp	short rmerrj
  5473                                  ; ---------------------------------------------------------------------------
  5474                                  
  5475                                  ChDirCrack:				; ...
  5476 00002293 803E[7A05]FF            		cmp	byte [CMETA], 0FFh
  5477 00002298 75F5                    		jnz	short ChDirErrP
  5478 0000229A C43E[A205]              		les	di, [THISCDS]
  5479 0000229E 83FFFF                  		cmp	di, 0FFFFh
  5480 000022A1 74EC                    		jz	short ChDirErrP
  5481 000022A3 E85410                  		call	DOS_CHDIR
  5482 000022A6 72E9                    		jb	short ChDirErr
  5483 000022A8 C43E[A205]              		les	di, [THISCDS]
  5484 000022AC 26F745430020            		test	word [es:di+43h], 2000h
  5485 000022B2 7425                    		jz	short GotCDS
  5486 000022B4 06                      		push	es
  5487 000022B5 57                      		push	di
  5488 000022B6 51                      		push	cx
  5489 000022B7 E8E8E1                  		call	Get_User_Stack
  5490 000022BA 8B7C06                  		mov	di, [si+6]
  5491 000022BD 8E5C0E                  		mov	ds, word [si+0Eh]
  5492 000022C0 BE[BE03]                		mov	si, OPENBUF
  5493 000022C3 87F7                    		xchg	si, di
  5494 000022C5 30C0                    		xor	al, al
  5495 000022C7 57                      		push	di
  5496 000022C8 E8FA4A                  		call	TransPathNoSet
  5497 000022CB 5E                      		pop	si
  5498 000022CC C43E[A205]              		les	di, [THISCDS]
  5499 000022D0 26C74549FFFF            		mov	word [es:di+49h], 0FFFFh
  5500 000022D6 59                      		pop	cx
  5501 000022D7 5F                      		pop	di
  5502 000022D8 07                      		pop	es
  5503                                  
  5504                                  GotCDS:					; ...
  5505 000022D9 E85200                  		call	Check_PathLen
  5506 000022DC 77B1                    		ja	short ChDirErrP
  5507 000022DE 26F745430080            		test	word [es:di+43h], 8000h
  5508 000022E4 7513                    		jnz	short SkipRecency
  5509 000022E6 26F745430020            		test	word [es:di+43h], 2000h
  5510 000022EC 7403                    		jz	short setdirclus
  5511 000022EE B9FFFF                  		mov	cx, 0FFFFh
  5512                                  
  5513                                  setdirclus:				; ...
  5514 000022F1 26894D49                		mov	[es:di+49h], cx
  5515 000022F5 C43E[A205]              		les	di, [THISCDS]
  5516                                  
  5517                                  SkipRecency:				; ...
  5518 000022F9 E82CEF                  		call	FStrCpy
  5519 000022FC 30C0                    		xor	al, al
  5520                                  
  5521                                  mkdir_ok:				; ...
  5522 000022FE E910E3                  		jmp	SYS_RET_OK
  5523                                  ; ---------------------------------------------------------------------------
  5524                                  
  5525                                  $MKDIR:					; ...
  5526 00002301 BE[FA31]                		mov	si, DOS_MKDIR
  5527                                  
  5528                                  DoDirCall:				; ...
  5529 00002304 BF[BE03]                		mov	di, OPENBUF
  5530 00002307 56                      		push	si
  5531 00002308 89D6                    		mov	si, dx
  5532 0000230A E8AC4A                  		call	TransPath
  5533 0000230D 5E                      		pop	si
  5534 0000230E 7305                    		jnb	short MkDirCrack
  5535                                  
  5536                                  MkErrP:					; ...
  5537 00002310 B003                    		mov	al, 3
  5538                                  
  5539                                  MkErr:					; ...
  5540 00002312 E905E3                  		jmp	SYS_RET_ERR
  5541                                  ; ---------------------------------------------------------------------------
  5542                                  
  5543                                  MkDirCrack:				; ...
  5544 00002315 36803E[7A05]FF          		cmp	byte [ss:CMETA], 0FFh
  5545 0000231B 75F3                    		jnz	short MkErrP
  5546 0000231D 56                      		push	si
  5547 0000231E E80D00                  		call	Check_PathLen
  5548 00002321 5E                      		pop	si
  5549 00002322 7604                    		jbe	short pathok
  5550 00002324 B005                    		mov	al, 5
  5551 00002326 EBEA                    		jmp	short MkErr
  5552                                  ; ---------------------------------------------------------------------------
  5553                                  
  5554                                  pathok:					; ...
  5555 00002328 FFD6                    		call	si
  5556 0000232A 72E6                    		jb	short MkErr
  5557 0000232C EBD0                    		jmp	short mkdir_ok
  5558                                  
  5559                                  ; =============== S U B	R O U T	I N E =======================================
  5560                                  
  5561                                  
  5562                                  Check_PathLen:
  5563 0000232E 368B36[B205]            		mov	si, [ss:WFP_START]
  5564                                  
  5565                                  ; =============== S U B	R O U T	I N E =======================================
  5566                                  
  5567                                  
  5568                                  check_PathLen2:
  5569 00002333 16                      		push	ss
  5570 00002334 1F                      		pop	ds
  5571 00002335 51                      		push	cx
  5572 00002336 E806EF                  		call	DStrLen
  5573 00002339 83F943                  		cmp	cx, 67
  5574 0000233C 59                      		pop	cx
  5575 0000233D C3                      		retn
  5576                                  
  5577                                  ; ---------------------------------------------------------------------------
  5578 0000233E [7C23]                  IOCTLJMPTABLE:	dw ioctl_getset_data ; ...
  5579 00002340 [7C23]                  		dw ioctl_getset_data
  5580 00002342 [CB23]                  		dw ioctl_control_string
  5581 00002344 [CB23]                  		dw ioctl_control_string
  5582 00002346 [2B25]                  		dw ioctl_get_dev
  5583 00002348 [2B25]                  		dw ioctl_get_dev
  5584 0000234A [E523]                  		dw ioctl_status
  5585 0000234C [E523]                  		dw ioctl_status
  5586 0000234E [8824]                  		dw ioctl_rem_media
  5587 00002350 [C624]                  		dw ioctl_drive_attr
  5588 00002352 [1A25]                  		dw ioctl_handle_redir
  5589 00002354 [0324]                  		dw Set_Retry_Parameters
  5590 00002356 [1124]                  		dw GENERICIOCTLHANDLE
  5591 00002358 [2824]                  		dw GENERICIOCTL
  5592 0000235A [D825]                  		dw ioctl_drive_owner
  5593 0000235C [D825]                  		dw ioctl_drive_owner
  5594 0000235E [1124]                  		dw GENERICIOCTLHANDLE ; query_handle_support
  5595 00002360 [2824]                  		dw GENERICIOCTL	; query_device_support
  5596                                  
  5597                                  ; =============== S U B	R O U T	I N E =======================================
  5598                                  
  5599                                  
  5600                                  $IOCTL:
  5601                                  
  5602                                  ; FUNCTION CHUNK AT 43F1 SIZE 0000001C BYTES
  5603                                  ; FUNCTION CHUNK AT 63B3 SIZE 0000004A BYTES
  5604                                  
  5605 00002362 8CDE                    		mov	si, ds
  5606 00002364 16                      		push	ss
  5607 00002365 1F                      		pop	ds
  5608 00002366 3C11                    		cmp	al, 11h
  5609 00002368 770F                    		ja	short ioctl_bad_funj2
  5610 0000236A 50                      		push	ax
  5611 0000236B 89C7                    		mov	di, ax
  5612 0000236D 81E7FF00                		and	di, 0FFh
  5613 00002371 D1E7                    		shl	di, 1
  5614 00002373 58                      		pop	ax
  5615 00002374 2EFFA5[3E23]            		jmp	[cs:IOCTLJMPTABLE+di]
  5616                                  ; ---------------------------------------------------------------------------
  5617                                  
  5618                                  ioctl_bad_funj2:			; ...
  5619 00002379 E90401                  		jmp	ioctl_bad_fun
  5620                                  ; ---------------------------------------------------------------------------
  5621                                  
  5622                                  ioctl_getset_data:			; ...
  5623 0000237C E82B45                  		call	SFFromHandle
  5624 0000237F 7305                    		jnb	short ioctl_check_permissions
  5625                                  
  5626                                  ioctl_bad_handle:			; ...
  5627 00002381 B006                    		mov	al, 6
  5628                                  
  5629                                  ioctl_error:				; ...
  5630 00002383 E994E2                  		jmp	SYS_RET_ERR
  5631                                  ; ---------------------------------------------------------------------------
  5632                                  
  5633                                  ioctl_check_permissions:		; ...
  5634 00002386 3C00                    		cmp	al, 0
  5635 00002388 268A4505                		mov	al, [es:di+5]
  5636 0000238C 741B                    		jz	short ioctl_read
  5637 0000238E 08F6                    		or	dh, dh
  5638 00002390 7404                    		jz	short ioctl_check_device
  5639 00002392 B00D                    		mov	al, 0Dh
  5640 00002394 EBED                    		jmp	short ioctl_error
  5641                                  ; ---------------------------------------------------------------------------
  5642                                  
  5643                                  ioctl_check_device:			; ...
  5644 00002396 A880                    		test	al, 80h
  5645 00002398 74DF                    		jz	short ioctl_bad_funj2
  5646 0000239A 80CA80                  		or	dl, 80h
  5647 0000239D C606[2303]04            		mov	byte [EXTERR_LOCUS], 4
  5648 000023A2 26885505                		mov	[es:di+5], dl
  5649                                  
  5650                                  ioctl_ok:				; ...
  5651 000023A6 E968E2                  		jmp	SYS_RET_OK
  5652                                  ; ---------------------------------------------------------------------------
  5653                                  
  5654                                  ioctl_read:				; ...
  5655 000023A9 C606[2303]02            		mov	byte [EXTERR_LOCUS], 2
  5656 000023AE 30E4                    		xor	ah, ah
  5657 000023B0 A880                    		test	al, 80h
  5658 000023B2 740D                    		jz	short ioctl_no_high
  5659 000023B4 C606[2303]04            		mov	byte [EXTERR_LOCUS], 4
  5660 000023B9 26C47D07                		les	di, [es:di+7]
  5661 000023BD 268A6505                		mov	ah, [es:di+5]
  5662                                  
  5663                                  ioctl_no_high:				; ...
  5664 000023C1 89C2                    		mov	dx, ax
  5665 000023C3 E8DCE0                  		call	Get_User_Stack
  5666 000023C6 895406                  		mov	[si+6],	dx
  5667                                  
  5668                                  jmp_to_ioctl_ok:			; ...
  5669 000023C9 EBDB                    		jmp	short ioctl_ok
  5670                                  ; ---------------------------------------------------------------------------
  5671                                  
  5672                                  ioctl_control_string:			; ...
  5673 000023CB E8DC44                  		call	SFFromHandle
  5674 000023CE 72B1                    		jb	short ioctl_bad_handle
  5675 000023D0 26F6450580              		test	byte [es:di+5], 80h
  5676 000023D5 74A2                    		jz	short ioctl_bad_funj2
  5677 000023D7 C606[2303]04            		mov	byte [EXTERR_LOCUS], 4
  5678 000023DC 26C47D07                		les	di, [es:di+7]
  5679 000023E0 30DB                    		xor	bl, bl
  5680 000023E2 E94B01                  		jmp	ioctl_do_string
  5681                                  ; ---------------------------------------------------------------------------
  5682                                  
  5683                                  ioctl_status:				; ...
  5684 000023E5 B401                    		mov	ah, 1
  5685 000023E7 2C06                    		sub	al, 6
  5686 000023E9 7402                    		jz	short ioctl_get_status
  5687 000023EB B403                    		mov	ah, 3
  5688                                  
  5689                                  ioctl_get_status:			; ...
  5690 000023ED 50                      		push	ax
  5691 000023EE E8B213                  		call	GET_IO_SFT
  5692 000023F1 58                      		pop	ax
  5693 000023F2 7302                    		jnb	short DO_IOFUNC
  5694 000023F4 EB8B                    		jmp	short ioctl_bad_handle
  5695                                  ; ---------------------------------------------------------------------------
  5696                                  
  5697                                  DO_IOFUNC:				; ...
  5698 000023F6 E83A22                  		call	IOFUNC
  5699 000023F9 88C4                    		mov	ah, al
  5700 000023FB B0FF                    		mov	al, 0FFh
  5701 000023FD 7502                    		jnz	short ioctl_status_ret
  5702 000023FF FEC0                    		inc	al
  5703                                  
  5704                                  ioctl_status_ret:			; ...
  5705 00002401 EBC6                    		jmp	short jmp_to_ioctl_ok
  5706                                  ; ---------------------------------------------------------------------------
  5707                                  
  5708                                  Set_Retry_Parameters:			; ...
  5709 00002403 890E[1C00]              		mov	[RetryLoop], cx
  5710 00002407 09D2                    		or	dx, dx
  5711 00002409 7475                    		jz	short ioctl_bad_fun
  5712 0000240B 8916[1A00]              		mov	[RetryCount], dx
  5713 0000240F EBF0                    		jmp	short ioctl_status_ret
  5714                                  ; ---------------------------------------------------------------------------
  5715                                  
  5716                                  GENERICIOCTLHANDLE:			; ...
  5717 00002411 E89644                  		call	SFFromHandle
  5718 00002414 726F                    		jb	short ioctl_bad_handlej
  5719 00002416 26F6450680              		test	byte [es:di+6], 80h
  5720 0000241B 7563                    		jnz	short ioctl_bad_fun
  5721 0000241D C606[2303]04            		mov	byte [EXTERR_LOCUS], 4
  5722 00002422 26C47D07                		les	di, [es:di+7]
  5723 00002426 EB0F                    		jmp	short Do_GenIOCTL
  5724                                  ; ---------------------------------------------------------------------------
  5725                                  
  5726                                  GENERICIOCTL:				; ...
  5727 00002428 C606[2303]02            		mov	byte [EXTERR_LOCUS], 2
  5728 0000242D 80FD08                  		cmp	ch, 8
  5729 00002430 754E                    		jnz	short ioctl_bad_fun
  5730 00002432 E88701                  		call	Check_If_Net
  5731 00002435 7549                    		jnz	short ioctl_bad_fun
  5732                                  
  5733                                  Do_GenIOCTL:				; ...
  5734 00002437 26F6450440              		test	byte [es:di+4], 40h
  5735 0000243C 7442                    		jz	short ioctl_bad_fun
  5736 0000243E C606[7E03]13            		mov	byte [IOCALL_REQFUNC], 13h
  5737 00002443 3C10                    		cmp	al, 10h
  5738 00002445 7C0C                    		jl	short SetIOCtlBlock
  5739 00002447 26F6450480              		test	byte [es:di+4], 80h
  5740 0000244C 7432                    		jz	short ioctl_bad_fun
  5741 0000244E C606[7E03]19            		mov	byte [IOCALL_REQFUNC], 19h
  5742                                  
  5743                                  SetIOCtlBlock:				; ...
  5744 00002453 06                      		push	es
  5745 00002454 57                      		push	di
  5746 00002455 C606[7C03]17            		mov	byte [IOCALL], 23
  5747 0000245A 881E[7D03]              		mov	[IOCALL_REQUNIT], bl
  5748 0000245E 882E[8903]              		mov	byte [IOMED], ch
  5749 00002462 880E[8A03]              		mov	byte [IOXAD], cl
  5750 00002466 8936[8B03]              		mov	word [IOXAD+1], si
  5751 0000246A 893E[8D03]              		mov	word [IOXAD+3], di
  5752 0000246E 8916[8F03]              		mov	[IOSCNT+1], dx
  5753 00002472 8936[9103]              		mov	[IOSSEC+1], si
  5754 00002476 BB[7C03]                		mov	bx, IOCALL
  5755 00002479 16                      		push	ss
  5756 0000247A 07                      		pop	es
  5757 0000247B 5E                      		pop	si
  5758 0000247C 1F                      		pop	ds
  5759 0000247D E9E900                  		jmp	ioctl_do_IO
  5760                                  ; ---------------------------------------------------------------------------
  5761                                  
  5762                                  ioctl_bad_fun:				; ...
  5763 00002480 B001                    		mov	al, 1
  5764 00002482 E995E1                  		jmp	SYS_RET_ERR
  5765                                  ; ---------------------------------------------------------------------------
  5766                                  
  5767                                  ioctl_bad_handlej:			; ...
  5768 00002485 E9F9FE                  		jmp	ioctl_bad_handle
  5769                                  ; ---------------------------------------------------------------------------
  5770                                  
  5771                                  ioctl_rem_media:			; ...
  5772 00002488 E83101                  		call	Check_If_Net
  5773 0000248B 75F3                    		jnz	short ioctl_bad_fun
  5774 0000248D 26F6450508              		test	byte [es:di+5], 8
  5775 00002492 74EC                    		jz	short ioctl_bad_fun
  5776 00002494 36C606[7E03]0F          		mov	byte [ss:IOCALL_REQFUNC], 15
  5777 0000249A B00D                    		mov	al, 13
  5778 0000249C 88DC                    		mov	ah, bl
  5779 0000249E 36A3[7C03]              		mov	word [ss:IOCALL], ax
  5780 000024A2 31C0                    		xor	ax, ax
  5781 000024A4 36A3[7F03]              		mov	[ss:IOCALL_REQSTAT], ax
  5782 000024A8 06                      		push	es
  5783 000024A9 1F                      		pop	ds
  5784 000024AA 89FE                    		mov	si, di
  5785 000024AC 16                      		push	ss
  5786 000024AD 07                      		pop	es
  5787 000024AE BB[7C03]                		mov	bx, IOCALL
  5788 000024B1 1E                      		push	ds
  5789 000024B2 56                      		push	si
  5790 000024B3 E85723                  		call	DEVIOCALL2
  5791 000024B6 5E                      		pop	si
  5792 000024B7 1F                      		pop	ds
  5793 000024B8 36A1[7F03]              		mov	ax, [ss:IOCALL_REQSTAT]
  5794 000024BC 250002                  		and	ax, 200h
  5795 000024BF B109                    		mov	cl, 9
  5796 000024C1 D3E8                    		shr	ax, cl
  5797                                  
  5798                                  ioctlt_rmed_ok:				; ...
  5799 000024C3 E94BE1                  		jmp	SYS_RET_OK
  5800                                  ; ---------------------------------------------------------------------------
  5801                                  
  5802                                  ioctl_drive_attr:			; ...
  5803 000024C6 88D8                    		mov	al, bl
  5804 000024C8 E81148                  		call	GETTHISDRV
  5805 000024CB 7248                    		jb	short ioctl_drv_err
  5806 000024CD E8BE00                  		call	Get_Driver_BL
  5807 000024D0 7243                    		jb	short ioctl_drv_err
  5808 000024D2 268B5504                		mov	dx, [es:di+4]
  5809 000024D6 88C3                    		mov	bl, al
  5810 000024D8 36C43E[A205]            		les	di, [ss:THISCDS]
  5811 000024DD 26F6454480              		test	byte [es:di+44h], 80h
  5812 000024E2 7403                    		jz	short IOCTLShare
  5813 000024E4 BA0010                  		mov	dx, 1000h
  5814                                  
  5815                                  IOCTLShare:				; ...
  5816 000024E7 16                      		push	ss
  5817 000024E8 1F                      		pop	ds
  5818 000024E9 BE[BE03]                		mov	si, OPENBUF
  5819 000024EC 80C341                  		add	bl, 'A'
  5820 000024EF 881C                    		mov	[si], bl
  5821 000024F1 C744013A00              		mov	word [si+1], ':'
  5822 000024F6 B80003                  		mov	ax, 300h
  5823 000024F9 F8                      		clc
  5824 000024FA CD2A                    		int	2Ah		; Microsoft Networks - CHECK DIRECT I/O
  5825                                  					; DS:SI	-> ASCIZ disk device name (may be full path or only drive
  5826                                  					; specifier--must include the colon)
  5827                                  					; Return: CF clear if absolute disk access allowed
  5828 000024FC 7304                    		jnb	short IOCTLLocal
  5829 000024FE 81CA0002                		or	dx, 200h
  5830                                  
  5831                                  IOCTLLocal:				; ...
  5832 00002502 26F6454410              		test	byte [es:di+44h], 10h
  5833 00002507 7404                    		jz	short ioctl_set_DX
  5834 00002509 81CA0080                		or	dx, 8000h
  5835                                  
  5836                                  ioctl_set_DX:				; ...
  5837 0000250D E892DF                  		call	Get_User_Stack
  5838 00002510 895406                  		mov	[si+6],	dx
  5839                                  
  5840                                  ioctl_dattr_ok:				; ...
  5841 00002513 EBAE                    		jmp	short ioctlt_rmed_ok
  5842                                  ; ---------------------------------------------------------------------------
  5843                                  
  5844                                  ioctl_drv_err:				; ...
  5845 00002515 B00F                    		mov	al, 0Fh
  5846                                  
  5847                                  ioctl_dattr_errj:			; ...
  5848 00002517 E900E1                  		jmp	SYS_RET_ERR
  5849                                  ; ---------------------------------------------------------------------------
  5850                                  
  5851                                  ioctl_handle_redir:			; ...
  5852 0000251A E88D43                  		call	SFFromHandle
  5853 0000251D 7303                    		jnb	short ioctl_got_sft
  5854 0000251F E95FFE                  		jmp	ioctl_bad_handle
  5855                                  ; ---------------------------------------------------------------------------
  5856                                  
  5857                                  ioctl_got_sft:				; ...
  5858 00002522 268B5505                		mov	dx, [es:di+5]
  5859 00002526 EBE5                    		jmp	short ioctl_set_DX
  5860                                  ; ---------------------------------------------------------------------------
  5861                                  
  5862                                  ioctl_bad_funj:				; ...
  5863 00002528 E955FF                  		jmp	ioctl_bad_fun
  5864                                  ; ---------------------------------------------------------------------------
  5865                                  
  5866                                  ioctl_get_dev:				; ...
  5867 0000252B E88E00                  		call	Check_If_Net
  5868 0000252E 75F8                    		jnz	short ioctl_bad_funj
  5869                                  
  5870                                  ioctl_do_string:			; ...
  5871 00002530 26F6450540              		test	byte [es:di+5], 40h
  5872 00002535 74F1                    		jz	short ioctl_bad_funj
  5873 00002537 C606[7E03]03            		mov	byte [IOCALL_REQFUNC], 3
  5874 0000253C A801                    		test	al, 1
  5875 0000253E 7405                    		jz	short ioctl_control_call
  5876 00002540 C606[7E03]0C            		mov	byte [IOCALL_REQFUNC], 12
  5877                                  
  5878                                  ioctl_control_call:			; ...
  5879 00002545 B016                    		mov	al, 22
  5880 00002547 88DC                    		mov	ah, bl
  5881 00002549 A3[7C03]                		mov	word [IOCALL], ax
  5882 0000254C 31C0                    		xor	ax, ax
  5883 0000254E A3[7F03]                		mov	[IOCALL_REQSTAT], ax
  5884 00002551 A2[8903]                		mov	byte [IOMED], al
  5885 00002554 890E[8E03]              		mov	word [IOSCNT], cx
  5886 00002558 8916[8A03]              		mov	word [IOXAD], dx
  5887 0000255C 8936[8C03]              		mov	word [IOXAD+2], si
  5888 00002560 06                      		push	es
  5889 00002561 1F                      		pop	ds
  5890 00002562 89FE                    		mov	si, di
  5891 00002564 16                      		push	ss
  5892 00002565 07                      		pop	es
  5893 00002566 BB[7C03]                		mov	bx, IOCALL
  5894                                  
  5895                                  ioctl_do_IO:				; ...
  5896 00002569 E8A122                  		call	DEVIOCALL2
  5897 0000256C 36F606[8003]80          		test	byte [ss:IOCALL_REQSTAT+1], 80h
  5898 00002572 7506                    		jnz	short ioctl_string_err
  5899 00002574 36A1[8E03]              		mov	ax, [ss:IOSCNT]
  5900 00002578 EB99                    		jmp	short ioctl_dattr_ok
  5901                                  ; ---------------------------------------------------------------------------
  5902                                  
  5903                                  ioctl_string_err:			; ...
  5904 0000257A 368B3E[7F03]            		mov	di, [ss:IOCALL_REQSTAT]
  5905 0000257F 81E7FF00                		and	di, 0FFh
  5906 00002583 89F8                    		mov	ax, di
  5907 00002585 E86B31                  		call	SET_I24_EXTENDED_ERROR
  5908 00002588 36A1[2403]              		mov	ax, [ss:EXTERR]
  5909 0000258C EB89                    		jmp	short ioctl_dattr_errj
  5910                                  
  5911                                  ; =============== S U B	R O U T	I N E =======================================
  5912                                  
  5913                                  
  5914                                  Get_Driver_BL:
  5915 0000258E 50                      		push	ax
  5916 0000258F 88D8                    		mov	al, bl
  5917 00002591 E84847                  		call	GETTHISDRV
  5918 00002594 7224                    		jb	short ioctl_bad_drv
  5919 00002596 30DB                    		xor	bl, bl
  5920 00002598 C606[2303]03            		mov	byte [EXTERR_LOCUS], 3
  5921 0000259D C43E[A205]              		les	di, [THISCDS]
  5922 000025A1 26F6454480              		test	byte [es:di+44h], 80h
  5923 000025A6 26C47D45                		les	di, [es:di+45h]
  5924 000025AA 750D                    		jnz	short got_dev_ptr
  5925 000025AC C606[2303]02            		mov	byte [EXTERR_LOCUS], 2
  5926 000025B1 268A5D01                		mov	bl, [es:di+1]
  5927 000025B5 26C47D13                		les	di, [es:di+13h]
  5928                                  
  5929                                  got_dev_ptr:				; ...
  5930 000025B9 F8                      		clc
  5931                                  
  5932                                  ioctl_bad_drv:				; ...
  5933 000025BA 58                      		pop	ax
  5934 000025BB C3                      		retn
  5935                                  
  5936                                  
  5937                                  ; =============== S U B	R O U T	I N E =======================================
  5938                                  
  5939                                  
  5940                                  Check_If_Net:
  5941 000025BC E8CFFF                  		call	Get_Driver_BL
  5942 000025BF 720E                    		jb	short ioctl_drv_err_pop
  5943 000025C1 06                      		push	es
  5944 000025C2 57                      		push	di
  5945 000025C3 C43E[A205]              		les	di, [THISCDS]
  5946 000025C7 26F6454480              		test	byte [es:di+44h], 80h
  5947 000025CC 5F                      		pop	di
  5948 000025CD 07                      		pop	es
  5949 000025CE C3                      		retn
  5950                                  ; ---------------------------------------------------------------------------
  5951                                  
  5952                                  ioctl_drv_err_pop:			; ...
  5953 000025CF 58                      		pop	ax
  5954 000025D0 E942FF                  		jmp	ioctl_drv_err
  5955                                  
  5956                                  ; ---------------------------------------------------------------------------
  5957                                  ; START	OF FUNCTION CHUNK FOR $IOCTL
  5958                                  
  5959                                  ioctl_bad_funj3:			; ...
  5960 000025D3 E9AAFE                  		jmp	ioctl_bad_fun
  5961                                  ; ---------------------------------------------------------------------------
  5962                                  
  5963                                  ioctl_string_errj:			; ...
  5964 000025D6 EBA2                    		jmp	short ioctl_string_err
  5965                                  ; ---------------------------------------------------------------------------
  5966                                  
  5967                                  ioctl_drive_owner:			; ...
  5968 000025D8 E8E1FF                  		call	Check_If_Net
  5969 000025DB 75F6                    		jnz	short ioctl_bad_funj3
  5970 000025DD 26F6450440              		test	byte [es:di+4], 40h
  5971 000025E2 74EF                    		jz	short ioctl_bad_funj3
  5972 000025E4 C606[7E03]17            		mov	byte [IOCALL_REQFUNC], 23
  5973 000025E9 3C0E                    		cmp	al, 0Eh
  5974 000025EB 7405                    		jz	short GetOwner
  5975 000025ED C606[7E03]18            		mov	byte [IOCALL_REQFUNC], 24
  5976                                  
  5977                                  GetOwner:				; ...
  5978 000025F2 B00D                    		mov	al, 13
  5979 000025F4 88DC                    		mov	ah, bl
  5980 000025F6 A3[7C03]                		mov	word [IOCALL], ax
  5981 000025F9 31C0                    		xor	ax, ax
  5982 000025FB A3[7F03]                		mov	[IOCALL_REQSTAT], ax
  5983 000025FE 06                      		push	es
  5984 000025FF 1F                      		pop	ds
  5985 00002600 89FE                    		mov	si, di
  5986 00002602 16                      		push	ss
  5987 00002603 07                      		pop	es
  5988 00002604 BB[7C03]                		mov	bx, IOCALL
  5989 00002607 1E                      		push	ds
  5990 00002608 56                      		push	si
  5991 00002609 E80122                  		call	DEVIOCALL2
  5992 0000260C 5E                      		pop	si
  5993 0000260D 1F                      		pop	ds
  5994 0000260E 36F606[8003]80          		test	byte [ss:IOCALL_REQSTAT+1], 80h
  5995 00002614 75C0                    		jnz	short ioctl_string_errj
  5996 00002616 36A0[7D03]              		mov	al, [ss:IOCALL_REQUNIT]
  5997 0000261A E9F4DF                  		jmp	SYS_RET_OK
  5998                                  ; END OF FUNCTION CHUNK	FOR $IOCTL
  5999                                  
  6000                                  ; =============== S U B	R O U T	I N E =======================================
  6001                                  
  6002                                  
  6003                                  DOS_DELETE:
  6004 0000261D E875EC                  		call	TestNet
  6005 00002620 7306                    		jnb	short LOCAL_DELETE
  6006 00002622 B81311                  		mov	ax, 1113h
  6007 00002625 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - DELETE REMOTE FILE
  6008                                  					; SS = DS = DOS	CS, SDA	first filename pointer -> fully-qualified filename in DOS CS
  6009                                  					; SDA CDS pointer -> current directory structure for drive with	file
  6010                                  					; Return: CF set on error
  6011 00002627 C3                      		retn
  6012                                  ; ---------------------------------------------------------------------------
  6013                                  
  6014                                  LOCAL_DELETE:				; ...
  6015 00002628 C606[6F05]00            		mov	byte [FOUNDDEL], 0
  6016 0000262D E82AED                  		call	ECritDisk
  6017 00002630 C706[7E05]00E5          		mov	word [CREATING], 0E500h
  6018 00002636 8B36[B205]              		mov	si, [WFP_START]
  6019                                  
  6020                                  SKPNUL:					; ...
  6021 0000263A AC                      		lodsb
  6022 0000263B 08C0                    		or	al, al
  6023 0000263D 75FB                    		jnz	short SKPNUL
  6024 0000263F 83EE04                  		sub	si, 4
  6025 00002642 813C2A2E                		cmp	word [si], '*.'	; '.*' 
  6026 00002646 7506                    		jnz	short TEST_QUEST
  6027 00002648 807C022A                		cmp	byte [si+2], '*'
  6028 0000264C 741F                    		jz	short CHECK_ATTS
  6029                                  
  6030                                  TEST_QUEST:				; ...
  6031 0000264E 83EE09                  		sub	si, 9
  6032 00002651 87FE                    		xchg	di, si
  6033 00002653 16                      		push	ss
  6034 00002654 07                      		pop	es
  6035 00002655 B83F3F                  		mov	ax, '??'
  6036 00002658 B90400                  		mov	cx, 4
  6037 0000265B F3AF                    		repe scasw
  6038 0000265D 751C                    		jnz	short NOT_ALL
  6039 0000265F 87FE                    		xchg	di, si
  6040 00002661 AD                      		lodsw
  6041 00002662 3D3F2E                  		cmp	ax, '?.'
  6042 00002665 7514                    		jnz	short NOT_ALL
  6043 00002667 AD                      		lodsw
  6044 00002668 3D3F3F                  		cmp	ax, '??'
  6045 0000266B 750E                    		jnz	short NOT_ALL
  6046                                  
  6047                                  CHECK_ATTS:				; ...
  6048 0000266D A0[6D05]                		mov	al, [SATTRIB]
  6049 00002670 241F                    		and	al, 1Fh
  6050 00002672 3C1F                    		cmp	al, 1Fh
  6051 00002674 7505                    		jnz	short NOT_ALL
  6052 00002676 C606[7F05]00            		mov	byte [DELALL], 0
  6053                                  
  6054                                  NOT_ALL:				; ...
  6055 0000267B C606[4C03]01            		mov	byte [NoSetDir], 1
  6056 00002680 E81F1A                  		call	GetPathNoSet
  6057 00002683 7313                    		jnb	short Del_found
  6058 00002685 750C                    		jnz	short _bad_path
  6059 00002687 08C9                    		or	cl, cl
  6060 00002689 7408                    		jz	short _bad_path
  6061                                  
  6062                                  No_file:				; ...
  6063 0000268B B80200                  		mov	ax, 2
  6064                                  
  6065                                  ErrorReturn:				; ...
  6066 0000268E F9                      		stc
  6067 0000268F E8E8EC                  		call	LCritDisk
  6068 00002692 C3                      		retn
  6069                                  ; ---------------------------------------------------------------------------
  6070                                  
  6071                                  _bad_path:				; ...
  6072 00002693 B80300                  		mov	ax, 3
  6073 00002696 EBF6                    		jmp	short ErrorReturn
  6074                                  ; ---------------------------------------------------------------------------
  6075                                  
  6076                                  Del_found:				; ...
  6077 00002698 750C                    		jnz	short NOT_DIR
  6078 0000269A 803E[7F05]00            		cmp	byte [DELALL], 0
  6079 0000269F 7405                    		jz	short NOT_DIR
  6080                                  
  6081                                  Del_access_err:				; ...
  6082 000026A1 B80500                  		mov	ax, 5
  6083 000026A4 EBE8                    		jmp	short ErrorReturn
  6084                                  ; ---------------------------------------------------------------------------
  6085                                  
  6086                                  NOT_DIR:				; ...
  6087 000026A6 08E4                    		or	ah, ah
  6088 000026A8 78F7                    		js	short Del_access_err
  6089                                  
  6090                                  DELFILE:				; ...
  6091 000026AA 800E[6F05]01            		or	byte [FOUNDDEL], 1
  6092 000026AF 1E                      		push	ds
  6093 000026B0 8A26[7F05]              		mov	ah, [DELALL]
  6094 000026B4 C53E[E205]              		lds	di, [CURBUF]
  6095 000026B8 36F606[6B05]01          		test	byte [ss:ATTRIB], 1
  6096 000026BE 7509                    		jnz	short DoDelete
  6097 000026C0 F6470B01                		test	byte [bx+0Bh], 1
  6098 000026C4 7403                    		jz	short DoDelete
  6099 000026C6 1F                      		pop	ds
  6100 000026C7 EB32                    		jmp	short DELNXT
  6101                                  ; ---------------------------------------------------------------------------
  6102                                  
  6103                                  DoDelete:				; ...
  6104 000026C9 E88500                  		call	REN_DEL_Check
  6105 000026CC 7303                    		jnb	short DEL_SHARE_OK
  6106 000026CE 1F                      		pop	ds
  6107 000026CF EB2A                    		jmp	short DELNXT
  6108                                  ; ---------------------------------------------------------------------------
  6109                                  
  6110                                  DEL_SHARE_OK:				; ...
  6111 000026D1 F6450540                		test	byte [di+5], 40h
  6112 000026D5 7507                    		jnz	short yesdirty
  6113 000026D7 E88736                  		call	INC_DIRTY_COUNT
  6114 000026DA 804D0540                		or	byte [di+5], 40h
  6115                                  
  6116                                  yesdirty:				; ...
  6117 000026DE 8827                    		mov	[bx], ah
  6118 000026E0 8B1C                    		mov	bx, [si]
  6119 000026E2 1F                      		pop	ds
  6120 000026E3 800E[6F05]10            		or	byte [FOUNDDEL], 10h
  6121 000026E8 83FB02                  		cmp	bx, 2
  6122 000026EB 720E                    		jb	short DELNXT
  6123 000026ED 263B5E0D                		cmp	bx, [es:bp+0Dh]
  6124 000026F1 7708                    		ja	short DELNXT
  6125 000026F3 E8B029                  		call	RELEASE
  6126 000026F6 7253                    		jb	short No_fileJ
  6127 000026F8 E8C400                  		call	FastOpen_Delete
  6128                                  
  6129                                  DELNXT:					; ...
  6130 000026FB C42E[8A05]              		les	bp, [THISDPB]
  6131 000026FF E80219                  		call	GETENTRY
  6132 00002702 7247                    		jb	short No_fileJ
  6133 00002704 E83418                  		call	NEXTENT
  6134 00002707 73A1                    		jnb	short DELFILE
  6135 00002709 C42E[8A05]              		les	bp, [THISDPB]
  6136 0000270D 268A4600                		mov	al, [es:bp+0]
  6137 00002711 E84135                  		call	FLUSHBUF
  6138 00002714 7235                    		jb	short No_fileJ
  6139 00002716 F606[6F05]10            		test	byte [FOUNDDEL], 10h
  6140 0000271B 7427                    		jz	short DelError
  6141 0000271D F606[6B05]08            		test	byte [ATTRIB], 8
  6142 00002722 741C                    		jz	short No_Set_Flag
  6143 00002724 50                      		push	ax
  6144 00002725 06                      		push	es
  6145 00002726 57                      		push	di
  6146 00002727 C43E[A205]              		les	di, [THISCDS]
  6147 0000272B 268A25                  		mov	ah, [es:di]
  6148 0000272E 80EC41                  		sub	ah, 'A'
  6149 00002731 8826[A10A]              		mov	byte [VOLCHNG_FLAG], ah
  6150 00002735 30FF                    		xor	bh, bh
  6151 00002737 E8EE04                  		call	Set_Media_ID
  6152 0000273A E8A831                  		call	FATREAD_CDS
  6153 0000273D 5F                      		pop	di
  6154 0000273E 07                      		pop	es
  6155 0000273F 58                      		pop	ax
  6156                                  
  6157                                  No_Set_Flag:				; ...
  6158 00002740 E837EC                  		call	LCritDisk
  6159 00002743 C3                      		retn
  6160                                  ; ---------------------------------------------------------------------------
  6161                                  
  6162                                  DelError:				; ...
  6163 00002744 F606[6F05]01            		test	byte [FOUNDDEL], 1
  6164 00002749 7503                    		jnz	short Del_access_errJ
  6165                                  
  6166                                  No_fileJ:				; ...
  6167 0000274B E93DFF                  		jmp	No_file
  6168                                  ; ---------------------------------------------------------------------------
  6169                                  
  6170                                  Del_access_errJ:			; ...
  6171 0000274E E950FF                  		jmp	Del_access_err
  6172                                  
  6173                                  ; =============== S U B	R O U T	I N E =======================================
  6174                                  
  6175                                  
  6176                                  REN_DEL_Check:
  6177 00002751 1E                      		push	ds
  6178 00002752 57                      		push	di
  6179 00002753 50                      		push	ax
  6180 00002754 53                      		push	bx
  6181 00002755 56                      		push	si
  6182 00002756 16                      		push	ss
  6183 00002757 07                      		pop	es
  6184 00002758 368B3E[B205]            		mov	di, [ss:WFP_START]
  6185 0000275D 89DE                    		mov	si, bx
  6186 0000275F 368E1E[E405]            		mov	ds, word [ss:CURBUF+2]
  6187 00002764 89FB                    		mov	bx, di
  6188 00002766 83C302                  		add	bx, 2
  6189 00002769 E8C5EA                  		call	StrLen
  6190 0000276C 49                      		dec	cx
  6191 0000276D 01CF                    		add	di, cx
  6192 0000276F E82F48                  		call	SkipBack
  6193 00002772 47                      		inc	di
  6194 00002773 36893E[0106]            		mov	[ss:SAVE_BX], di
  6195 00002778 E815FA                  		call	PackName
  6196 0000277B 5E                      		pop	si
  6197 0000277C 5B                      		pop	bx
  6198 0000277D 53                      		push	bx
  6199 0000277E 56                      		push	si
  6200 0000277F 16                      		push	ss
  6201 00002780 1F                      		pop	ds
  6202 00002781 FF1E[C400]              		call	far [ShCloseFile]
  6203 00002785 8C1E[A005]              		mov	word [THISSFT+2], ds
  6204 00002789 C706[9E05][6507]        		mov	word [THISSFT], RENAMEDMA+145h ; AUXSTACK-SF_ENTRY.size
  6205                                  					; RENAMEDMA+(384-59)
  6206 0000278F 30E4                    		xor	ah, ah
  6207 00002791 E87025                  		call	DOOPEN
  6208 00002794 C43E[9E05]              		les	di, [THISSFT]
  6209 00002798 26C745021000            		mov	word [es:di+2], 10h
  6210 0000279E 26C7050100              		mov	word [es:di], 1
  6211 000027A3 E8354E                  		call	ShareEnter
  6212 000027A6 720D                    		jb	short CheckDone
  6213 000027A8 C43E[9E05]              		les	di, [THISSFT]
  6214 000027AC 26C7050000              		mov	word [es:di], 0
  6215 000027B1 E8224E                  		call	ShareEnd
  6216 000027B4 F8                      		clc
  6217                                  
  6218                                  CheckDone:				; ...
  6219 000027B5 C42E[8A05]              		les	bp, [THISDPB]
  6220 000027B9 5E                      		pop	si
  6221 000027BA 5B                      		pop	bx
  6222 000027BB 58                      		pop	ax
  6223 000027BC 5F                      		pop	di
  6224 000027BD 1F                      		pop	ds
  6225 000027BE C3                      		retn
  6226                                  
  6227                                  ; =============== S U B	R O U T	I N E =======================================
  6228                                  
  6229                                  
  6230                                  FastOpen_Delete:
  6231 000027BF 9C                      		pushf
  6232 000027C0 56                      		push	si
  6233 000027C1 53                      		push	bx
  6234 000027C2 50                      		push	ax
  6235 000027C3 368B36[B205]            		mov	si, [ss:WFP_START]
  6236 000027C8 B003                    		mov	al, 3
  6237                                  
  6238                                  fastinvoke:				; ...
  6239 000027CA BB[320D]                		mov	bx, FastTable_2
  6240 000027CD FF1F                    		call	far [bx]
  6241 000027CF 58                      		pop	ax
  6242 000027D0 5B                      		pop	bx
  6243 000027D1 5E                      		pop	si
  6244 000027D2 9D                      		popf
  6245 000027D3 C3                      		retn
  6246                                  
  6247                                  ; =============== S U B	R O U T	I N E =======================================
  6248                                  
  6249                                  
  6250                                  FastOpen_Rename:
  6251 000027D4 9C                      		pushf
  6252 000027D5 56                      		push	si
  6253 000027D6 57                      		push	di
  6254 000027D7 53                      		push	bx
  6255 000027D8 50                      		push	ax
  6256 000027D9 368B36[B405]            		mov	si, [ss:REN_WFP]
  6257 000027DE BF[4B05]                		mov	di, NAME1
  6258 000027E1 B006                    		mov	al, 6
  6259 000027E3 BB[320D]                		mov	bx, FastTable_2
  6260 000027E6 FF1F                    		call	far [bx]
  6261 000027E8 58                      		pop	ax
  6262 000027E9 5B                      		pop	bx
  6263 000027EA 5F                      		pop	di
  6264 000027EB 5E                      		pop	si
  6265 000027EC 9D                      		popf
  6266 000027ED C3                      		retn
  6267                                  
  6268                                  ; =============== S U B	R O U T	I N E =======================================
  6269                                  
  6270                                  
  6271                                  FastOpen_Update:
  6272 000027EE 9C                      		pushf
  6273 000027EF 56                      		push	si
  6274 000027F0 53                      		push	bx
  6275 000027F1 50                      		push	ax
  6276 000027F2 B004                    		mov	al, 4
  6277 000027F4 EBD4                    		jmp	short fastinvoke
  6278                                  
  6279                                  ; =============== S U B	R O U T	I N E =======================================
  6280                                  
  6281                                  
  6282                                  Fast_Dispatch:
  6283 000027F6 BE[320D]                		mov	si, FastTable_2
  6284 000027F9 36FF1C                  		call	far [ss:si]
  6285 000027FC C3                      		retn
  6286                                  
  6287                                  ; =============== S U B	R O U T	I N E =======================================
  6288                                  
  6289                                  
  6290                                  DOS_RENAME:
  6291 000027FD E895EA                  		call	TestNet
  6292 00002800 7306                    		jnb	short LOCAL_RENAME
  6293 00002802 B81111                  		mov	ax, 1111h
  6294 00002805 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - RENAME REMOTE FILE
  6295                                  					; SS = DS = DOS	CS, SDA	first filename pointer = offset	of fully-qualified old name
  6296                                  					; SDA CDS pointer -> current directory
  6297                                  					; Return: CF set on error
  6298 00002807 C3                      		retn
  6299                                  ; ---------------------------------------------------------------------------
  6300                                  
  6301                                  LOCAL_RENAME:				; ...
  6302 00002808 C606[2303]02            		mov	byte [EXTERR_LOCUS], 2
  6303 0000280D 8B36[B205]              		mov	si, [WFP_START]
  6304 00002811 8B3E[B405]              		mov	di, [REN_WFP]
  6305 00002815 8A04                    		mov	al, [si]
  6306 00002817 8A25                    		mov	ah, [di]
  6307 00002819 0D2020                  		or	ax, 2020h
  6308 0000281C 38E0                    		cmp	al, ah
  6309 0000281E 7405                    		jz	short SAMEDRV
  6310 00002820 B81100                  		mov	ax, 11h
  6311 00002823 F9                      		stc
  6312 00002824 C3                      		retn
  6313                                  ; ---------------------------------------------------------------------------
  6314                                  
  6315                                  SAMEDRV:				; ...
  6316 00002825 FF36[2E03]              		push	word [DMAADD+2]
  6317 00002829 FF36[2C03]              		push	word [DMAADD]
  6318 0000282D 8C1E[2E03]              		mov	word [DMAADD+2], ds
  6319 00002831 C706[2C03][2006]        		mov	word [DMAADD], RENAMEDMA
  6320 00002837 C606[7005]00            		mov	byte [FOUND_DEV], 0
  6321 0000283C E81BEB                  		call	ECritDisk
  6322 0000283F E81406                  		call	DOS_SEARCH_FIRST
  6323 00002842 7315                    		jnb	short Check_Dev
  6324 00002844 83F812                  		cmp	ax, 12h
  6325 00002847 7503                    		jnz	short GOTERR
  6326 00002849 B80200                  		mov	ax, 2
  6327                                  
  6328                                  GOTERR:					; ...
  6329 0000284C F9                      		stc
  6330                                  
  6331                                  RENAME_POP:				; ...
  6332 0000284D 8F06[2C03]              		pop	word [DMAADD]
  6333 00002851 8F06[2E03]              		pop	word [DMAADD+2]
  6334 00002855 E822EB                  		call	LCritDisk
  6335 00002858 C3                      		retn
  6336                                  ; ---------------------------------------------------------------------------
  6337                                  
  6338                                  Check_Dev:				; ...
  6339 00002859 B80500                  		mov	ax, 5
  6340 0000285C 1E                      		push	ds
  6341 0000285D C536[2C03]              		lds	si, [DMAADD]
  6342 00002861 83C615                  		add	si, 21
  6343 00002864 F6440B10                		test	byte [si+11], 10h
  6344 00002868 7407                    		jz	short notdir
  6345 0000286A 8B36[B405]              		mov	si, [REN_WFP]
  6346 0000286E E8C2FA                  		call	check_PathLen2
  6347                                  
  6348                                  notdir:					; ...
  6349 00002871 1F                      		pop	ds
  6350 00002872 77D8                    		ja	short GOTERR
  6351 00002874 803E[7005]00            		cmp	byte [FOUND_DEV], 0
  6352 00002879 75D1                    		jnz	short GOTERR
  6353 0000287B 89DE                    		mov	si, bx
  6354 0000287D 83C61A                  		add	si, 26
  6355 00002880 E8CEFE                  		call	REN_DEL_Check
  6356 00002883 7305                    		jnb	short REN_OK1
  6357 00002885 B82000                  		mov	ax, 20h
  6358 00002888 EBC3                    		jmp	short RENAME_POP
  6359                                  ; ---------------------------------------------------------------------------
  6360                                  
  6361                                  REN_OK1:				; ...
  6362 0000288A 56                      		push	si
  6363 0000288B C536[2C03]              		lds	si, [DMAADD]
  6364 0000288F 83C615                  		add	si, 21
  6365 00002892 F6440B10                		test	byte [si+11], 10h
  6366 00002896 7403                    		jz	short NOT_DIR1
  6367 00002898 5E                      		pop	si
  6368 00002899 EB04                    		jmp	short SWAP_SOURCE
  6369                                  ; ---------------------------------------------------------------------------
  6370                                  
  6371                                  NOT_DIR1:				; ...
  6372 0000289B 5E                      		pop	si
  6373 0000289C E820FF                  		call	FastOpen_Delete
  6374                                  
  6375                                  SWAP_SOURCE:				; ...
  6376 0000289F A1[B205]                		mov	ax, [WFP_START]
  6377 000028A2 8B36[B405]              		mov	si, [REN_WFP]
  6378 000028A6 8936[B205]              		mov	[WFP_START], si
  6379 000028AA A3[B405]                		mov	[REN_WFP], ax
  6380 000028AD C706[B605]FFFF          		mov	word [CURR_DIR_END], 0FFFFh
  6381 000028B3 C706[7E05]FFE5          		mov	word [CREATING], 0E5FFh
  6382 000028B9 E8E617                  		call	GetPathNoSet
  6383 000028BC 7223                    		jb	short NODEST
  6384 000028BE 08E4                    		or	ah, ah
  6385 000028C0 7933                    		jns	short SAVEDEST
  6386                                  
  6387                                  BAD_ACC:				; ...
  6388 000028C2 B80500                  		mov	ax, 5
  6389 000028C5 F9                      		stc
  6390                                  
  6391                                  RENAME_CLEAN:				; ...
  6392 000028C6 9C                      		pushf
  6393 000028C7 50                      		push	ax
  6394 000028C8 A0[7605]                		mov	al, [THISDRV]
  6395 000028CB E88733                  		call	FLUSHBUF
  6396 000028CE 58                      		pop	ax
  6397 000028CF 803E[4A03]00            		cmp	byte [FAILERR], 0
  6398 000028D4 7504                    		jnz	short BAD_ERR
  6399 000028D6 9D                      		popf
  6400 000028D7 E973FF                  		jmp	RENAME_POP
  6401                                  ; ---------------------------------------------------------------------------
  6402                                  
  6403                                  BAD_ERR:				; ...
  6404 000028DA 58                      		pop	ax
  6405 000028DB B80300                  		mov	ax, 3
  6406 000028DE E96BFF                  		jmp	GOTERR
  6407                                  ; ---------------------------------------------------------------------------
  6408                                  
  6409                                  NODEST:					; ...
  6410 000028E1 750B                    		jnz	short BAD_PATH
  6411 000028E3 803E[4A03]00            		cmp	byte [FAILERR], 0
  6412 000028E8 7504                    		jnz	short BAD_PATH
  6413 000028EA 08C9                    		or	cl, cl
  6414 000028EC 7507                    		jnz	short SAVEDEST
  6415                                  
  6416                                  BAD_PATH:				; ...
  6417 000028EE B80300                  		mov	ax, 3
  6418 000028F1 F9                      		stc
  6419 000028F2 E958FF                  		jmp	RENAME_POP
  6420                                  ; ---------------------------------------------------------------------------
  6421                                  
  6422                                  SAVEDEST:				; ...
  6423 000028F5 16                      		push	ss
  6424 000028F6 07                      		pop	es
  6425 000028F7 BF[5705]                		mov	di, NAME2
  6426 000028FA BE[4B05]                		mov	si, NAME1
  6427 000028FD B90B00                  		mov	cx, 11
  6428 00002900 F3A4                    		rep movsb
  6429 00002902 A1[C205]                		mov	ax, [DIRSTART]
  6430 00002905 A3[6405]                		mov	[DESTSTART], ax
  6431                                  
  6432                                  BUILDDEST:				; ...
  6433 00002908 16                      		push	ss
  6434 00002909 07                      		pop	es
  6435 0000290A BB[3506]                		mov	bx, RENAMEDMA+15h
  6436 0000290D BF[4B05]                		mov	di, NAME1
  6437 00002910 BE[5705]                		mov	si, NAME2
  6438 00002913 B90B00                  		mov	cx, 11
  6439 00002916 E81501                  		call	NEW_RENAME
  6440 00002919 C606[6B05]16            		mov	byte [ATTRIB], 16h
  6441 0000291E C606[7E05]FF            		mov	byte [CREATING], 0FFh
  6442 00002923 E8421A                  		call	DEVNAME
  6443 00002926 739A                    		jnb	short BAD_ACC
  6444 00002928 8B1E[6405]              		mov	bx, [DESTSTART]
  6445 0000292C C42E[8A05]              		les	bp, [THISDPB]
  6446 00002930 E80417                  		call	SETDIRSRCH
  6447 00002933 728D                    		jb	short BAD_ACC
  6448 00002935 E8B215                  		call	SEARCH
  6449 00002938 7388                    		jnb	short BAD_ACC
  6450 0000293A 803E[4A03]00            		cmp	byte [FAILERR], 0
  6451 0000293F 752A                    		jnz	short BAD_ACCJ
  6452 00002941 A1[6405]                		mov	ax, [DESTSTART]
  6453 00002944 3B06[2F06]              		cmp	ax, word [RENAMEDMA+0Fh]
  6454 00002948 745D                    		jz	short SIMPLE_RENAME
  6455 0000294A A0[4006]                		mov	al, [RENAMEDMA+20h]
  6456 0000294D A810                    		test	al, 10h
  6457 0000294F 751A                    		jnz	short BAD_ACCJ
  6458 00002951 A2[6B05]                		mov	byte [ATTRIB], al
  6459 00002954 8C1E[A005]              		mov	word [THISSFT+2], ds
  6460 00002958 BE[6507]                		mov	si, RENAMEDMA+145h
  6461 0000295B 8936[9E05]              		mov	word [THISSFT], si
  6462 0000295F C744020200              		mov	word [si+2], 2
  6463 00002964 31C9                    		xor	cx, cx
  6464 00002966 E80222                  		call	RENAME_MAKE
  6465 00002969 7303                    		jnb	short GOT_DEST
  6466                                  
  6467                                  BAD_ACCJ:				; ...
  6468 0000296B E954FF                  		jmp	BAD_ACC
  6469                                  ; ---------------------------------------------------------------------------
  6470                                  
  6471                                  GOT_DEST:				; ...
  6472 0000296E 53                      		push	bx
  6473 0000296F C43E[9E05]              		les	di, [THISSFT]
  6474 00002973 E8604C                  		call	ShareEnd
  6475 00002976 5B                      		pop	bx
  6476 00002977 C43E[E205]              		les	di, [CURBUF]
  6477 0000297B 26F6450540              		test	byte [es:di+5], 40h
  6478 00002980 7508                    		jnz	short yesdirty1
  6479 00002982 E8DC33                  		call	INC_DIRTY_COUNT
  6480 00002985 26804D0540              		or	byte [es:di+5], 40h
  6481                                  
  6482                                  yesdirty1:				; ...
  6483 0000298A 89DF                    		mov	di, bx
  6484 0000298C 83C70B                  		add	di, 11
  6485 0000298F BE[4006]                		mov	si, RENAMEDMA+20h
  6486 00002992 B91500                  		mov	cx, 21
  6487 00002995 F3A4                    		rep movsb
  6488 00002997 E87D00                  		call	GET_SOURCE
  6489 0000299A 7277                    		jb	short RENAME_OVER
  6490 0000299C 89DF                    		mov	di, bx
  6491 0000299E 8E06[E405]              		mov	es, word [CURBUF+2]
  6492 000029A2 B0E5                    		mov	al, 0E5h
  6493 000029A4 AA                      		stosb
  6494 000029A5 EB13                    		jmp	short DIRTY_IT
  6495                                  ; ---------------------------------------------------------------------------
  6496                                  
  6497                                  SIMPLE_RENAME:				; ...
  6498 000029A7 E86D00                  		call	GET_SOURCE
  6499 000029AA 7267                    		jb	short RENAME_OVER
  6500 000029AC 89DF                    		mov	di, bx
  6501 000029AE 8E06[E405]              		mov	es, word [CURBUF+2]
  6502 000029B2 BE[4B05]                		mov	si, NAME1
  6503 000029B5 B90B00                  		mov	cx, 11
  6504 000029B8 F3A4                    		rep movsb
  6505                                  
  6506                                  DIRTY_IT:				; ...
  6507 000029BA 8B3E[E205]              		mov	di, word [CURBUF]
  6508 000029BE 26F6450540              		test	byte [es:di+5], 40h
  6509 000029C3 7508                    		jnz	short yesdirty2
  6510 000029C5 E89933                  		call	INC_DIRTY_COUNT
  6511 000029C8 26804D0540              		or	byte [es:di+5], 40h
  6512                                  
  6513                                  yesdirty2:				; ...
  6514 000029CD 56                      		push	si
  6515 000029CE C536[2C03]              		lds	si, [DMAADD]
  6516 000029D2 83C615                  		add	si, 21
  6517 000029D5 F6440B10                		test	byte [si+11], 10h
  6518 000029D9 7406                    		jz	short NOT_DIR2
  6519 000029DB E8F6FD                  		call	FastOpen_Rename
  6520 000029DE 5E                      		pop	si
  6521 000029DF EB01                    		jmp	short NOT_DIRTY1
  6522                                  ; ---------------------------------------------------------------------------
  6523                                  
  6524                                  NOT_DIR2:				; ...
  6525 000029E1 5E                      		pop	si
  6526                                  
  6527                                  NOT_DIRTY1:				; ...
  6528 000029E2 BE[2106]                		mov	si, RENAMEDMA+1
  6529 000029E5 E872E9                  		call	ECritDisk
  6530 000029E8 C606[7E05]00            		mov	byte [CREATING], 0
  6531 000029ED E8A305                  		call	RENAME_NEXT
  6532 000029F0 7221                    		jb	short RENAME_OVER
  6533 000029F2 8D771A                  		lea	si, [bx+26]
  6534 000029F5 E859FD                  		call	REN_DEL_Check
  6535 000029F8 7306                    		jnb	short REN_OK2
  6536 000029FA B82000                  		mov	ax, 20h
  6537 000029FD E9C6FE                  		jmp	RENAME_CLEAN
  6538                                  ; ---------------------------------------------------------------------------
  6539                                  
  6540                                  REN_OK2:				; ...
  6541 00002A00 A0[4006]                		mov	al, [RENAMEDMA+20h]
  6542 00002A03 A810                    		test	al, 10h
  6543 00002A05 7406                    		jz	short Ren_Directory
  6544 00002A07 E8B5FD                  		call	FastOpen_Delete
  6545 00002A0A E9FBFE                  		jmp	BUILDDEST
  6546                                  ; ---------------------------------------------------------------------------
  6547                                  
  6548                                  Ren_Directory:				; ...
  6549 00002A0D E8C4FD                  		call	FastOpen_Rename
  6550 00002A10 E9F5FE                  		jmp	BUILDDEST
  6551                                  ; ---------------------------------------------------------------------------
  6552                                  
  6553                                  RENAME_OVER:				; ...
  6554 00002A13 F8                      		clc
  6555 00002A14 E9AFFE                  		jmp	RENAME_CLEAN
  6556                                  
  6557                                  ; =============== S U B	R O U T	I N E =======================================
  6558                                  
  6559                                  
  6560                                  GET_SOURCE:
  6561 00002A17 8B1E[2F06]              		mov	bx, word [RENAMEDMA+0Fh]
  6562 00002A1B C42E[8A05]              		les	bp, [THISDPB]
  6563 00002A1F E81516                  		call	SETDIRSRCH
  6564 00002A22 7209                    		jb	short gs_ret_label
  6565 00002A24 E82019                  		call	STARTSRCH
  6566 00002A27 A1[2D06]                		mov	ax, word [RENAMEDMA+0Dh]
  6567 00002A2A E8DA15                  		call	GETENT
  6568                                  
  6569                                  gs_ret_label:				; ...
  6570 00002A2D C3                      		retn
  6571                                  
  6572                                  ; =============== S U B	R O U T	I N E =======================================
  6573                                  
  6574                                  
  6575                                  NEW_RENAME:
  6576 00002A2E AC                      		lodsb
  6577 00002A2F 3C3F                    		cmp	al, '?'
  6578 00002A31 7502                    		jnz	short NOCHG
  6579 00002A33 8A07                    		mov	al, [bx]
  6580                                  
  6581                                  NOCHG:					; ...
  6582 00002A35 AA                      		stosb
  6583 00002A36 43                      		inc	bx
  6584 00002A37 E2F5                    		loop	NEW_RENAME
  6585 00002A39 C3                      		retn
  6586                                  
  6587                                  ; =============== S U B	R O U T	I N E =======================================
  6588                                  
  6589                                  
  6590                                  GET_FILE_INFO:
  6591 00002A3A E858E8                  		call	TestNet
  6592 00002A3D 7306                    		jnb	short LOCAL_INFO
  6593 00002A3F B80F11                  		mov	ax, 110Fh
  6594 00002A42 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - GET REMOTE FILE'S ATTRIBUTES
  6595                                  					; SS = DOS CS, SDA first filename pointer -> fully-qualified name of file
  6596                                  					; SDA CDS pointer -> current directory
  6597                                  					; Return: CF set on error, AX =	file attributes
  6598 00002A44 C3                      		retn
  6599                                  ; ---------------------------------------------------------------------------
  6600                                  
  6601                                  LOCAL_INFO:				; ...
  6602 00002A45 E812E9                  		call	ECritDisk
  6603 00002A48 C606[4C03]01            		mov	byte [NoSetDir], 1
  6604 00002A4D E8DC00                  		call	Get_FAST_PATH
  6605 00002A50 7313                    		jnb	short info_check_dev
  6606                                  
  6607                                  NO_PATH:				; ...
  6608 00002A52 750C                    		jnz	short bad_path1
  6609 00002A54 08C9                    		or	cl, cl
  6610 00002A56 7408                    		jz	short bad_path1
  6611                                  
  6612                                  info_no_file:				; ...
  6613 00002A58 B80200                  		mov	ax, 2
  6614                                  
  6615                                  BadRet:					; ...
  6616 00002A5B F9                      		stc
  6617                                  
  6618                                  JustRet:				; ...
  6619 00002A5C E81BE9                  		call	LCritDisk
  6620 00002A5F C3                      		retn
  6621                                  ; ---------------------------------------------------------------------------
  6622                                  
  6623                                  bad_path1:				; ...
  6624 00002A60 B80300                  		mov	ax, 3
  6625 00002A63 EBF6                    		jmp	short BadRet
  6626                                  ; ---------------------------------------------------------------------------
  6627                                  
  6628                                  info_check_dev:				; ...
  6629 00002A65 08E4                    		or	ah, ah
  6630 00002A67 78EF                    		js	short info_no_file
  6631 00002A69 833E[E205]FF            		cmp	word [CURBUF], 0FFFFh
  6632 00002A6E 7507                    		jnz	short not_root
  6633 00002A70 30E4                    		xor	ah, ah
  6634 00002A72 B010                    		mov	al, 10h
  6635 00002A74 F8                      		clc
  6636 00002A75 EBE5                    		jmp	short JustRet
  6637                                  ; ---------------------------------------------------------------------------
  6638                                  
  6639                                  not_root:				; ...
  6640 00002A77 1E                      		push	ds
  6641 00002A78 8E1E[E405]              		mov	ds, word [CURBUF+2]
  6642 00002A7C 89DE                    		mov	si, bx
  6643 00002A7E 31DB                    		xor	bx, bx
  6644 00002A80 89DF                    		mov	di, bx
  6645 00002A82 8B4C16                  		mov	cx, [si+16h]
  6646 00002A85 8B5418                  		mov	dx, [si+18h]
  6647 00002A88 30E4                    		xor	ah, ah
  6648 00002A8A 8A440B                  		mov	al, [si+0Bh]
  6649 00002A8D A810                    		test	al, 10h
  6650 00002A8F 7506                    		jnz	short NO_SIZE
  6651 00002A91 8B7C1C                  		mov	di, [si+1Ch]
  6652 00002A94 8B5C1E                  		mov	bx, [si+1Eh]
  6653                                  
  6654                                  NO_SIZE:				; ...
  6655 00002A97 1F                      		pop	ds
  6656 00002A98 F8                      		clc
  6657 00002A99 EBC1                    		jmp	short JustRet
  6658                                  
  6659                                  ; =============== S U B	R O U T	I N E =======================================
  6660                                  
  6661                                  
  6662                                  SET_FILE_ATTRIBUTE:
  6663 00002A9B A9D8FF                  		test	ax, 0FFD8h
  6664 00002A9E 7414                    		jz	short set_look
  6665                                  
  6666                                  _BAD_ACC:				; ...
  6667 00002AA0 C606[2303]01            		mov	byte [EXTERR_LOCUS], 1
  6668 00002AA5 C606[2703]07            		mov	byte [EXTERR_ACT_CLASS+1], 7
  6669 00002AAA C606[2603]04            		mov	byte [EXTERR_ACT_CLASS], 4
  6670 00002AAF B80500                  		mov	ax, 5
  6671 00002AB2 F9                      		stc
  6672 00002AB3 C3                      		retn
  6673                                  ; ---------------------------------------------------------------------------
  6674                                  
  6675                                  set_look:				; ...
  6676 00002AB4 E8DEE7                  		call	TestNet
  6677 00002AB7 7308                    		jnb	short LOCAL_SET
  6678 00002AB9 50                      		push	ax
  6679 00002ABA B80E11                  		mov	ax, 110Eh
  6680 00002ABD CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - SET REMOTE FILE'S ATTRIBUTES
  6681                                  					; SS = DOS CS, SDA first filename pointer -> fully-qualified name of file
  6682                                  					; SDA CDS pointer -> current directory
  6683                                  					; STACK: WORD new file attributes
  6684                                  					; Return: CF set on error
  6685 00002ABF 5B                      		pop	bx
  6686 00002AC0 C3                      		retn
  6687                                  ; ---------------------------------------------------------------------------
  6688                                  
  6689                                  LOCAL_SET:				; ...
  6690 00002AC1 E896E8                  		call	ECritDisk
  6691 00002AC4 50                      		push	ax
  6692 00002AC5 C606[4C03]01            		mov	byte [NoSetDir], 1
  6693 00002ACA E8CF15                  		call	GETPATH
  6694 00002ACD 7303                    		jnb	short set_check_device
  6695 00002ACF 5B                      		pop	bx
  6696 00002AD0 EB80                    		jmp	short NO_PATH
  6697                                  ; ---------------------------------------------------------------------------
  6698                                  
  6699                                  set_check_device:			; ...
  6700 00002AD2 08E4                    		or	ah, ah
  6701 00002AD4 7906                    		jns	short set_check_share
  6702 00002AD6 58                      		pop	ax
  6703 00002AD7 E8A0E8                  		call	LCritDisk
  6704 00002ADA EBC4                    		jmp	short _BAD_ACC
  6705                                  ; ---------------------------------------------------------------------------
  6706                                  
  6707                                  set_check_share:			; ...
  6708 00002ADC 58                      		pop	ax
  6709 00002ADD 833E[E205]FF            		cmp	word [CURBUF], 0FFFFh
  6710 00002AE2 740A                    		jz	short cannot_set_root
  6711 00002AE4 E86AFC                  		call	REN_DEL_Check
  6712 00002AE7 730B                    		jnb	short set_do
  6713 00002AE9 B82000                  		mov	ax, 32
  6714 00002AEC EB3A                    		jmp	short OK_BYE
  6715                                  ; ---------------------------------------------------------------------------
  6716                                  
  6717                                  cannot_set_root:			; ...
  6718 00002AEE B80500                  		mov	ax, 5
  6719 00002AF1 F9                      		stc
  6720 00002AF2 EB34                    		jmp	short OK_BYE
  6721                                  ; ---------------------------------------------------------------------------
  6722                                  
  6723                                  set_do:					; ...
  6724 00002AF4 C43E[E205]              		les	di, [CURBUF]
  6725 00002AF8 2680670BD8              		and	byte [es:bx+0Bh], 0D8h
  6726 00002AFD 2608470B                		or	[es:bx+0Bh], al
  6727 00002B01 26F6450540              		test	byte [es:di+5], 40h
  6728 00002B06 7508                    		jnz	short yesdirty3
  6729 00002B08 E85632                  		call	INC_DIRTY_COUNT
  6730 00002B0B 26804D0540              		or	byte [es:di+5], 40h
  6731                                  
  6732                                  yesdirty3:				; ...
  6733 00002B10 A0[7605]                		mov	al, [THISDRV]
  6734 00002B13 52                      		push	dx
  6735 00002B14 57                      		push	di
  6736 00002B15 B400                    		mov	ah, 0
  6737 00002B17 88C2                    		mov	dl, al
  6738 00002B19 89DF                    		mov	di, bx
  6739 00002B1B E8D0FC                  		call	FastOpen_Update
  6740 00002B1E 5F                      		pop	di
  6741 00002B1F 5A                      		pop	dx
  6742 00002B20 E83231                  		call	FLUSHBUF
  6743 00002B23 7303                    		jnb	short OK_BYE
  6744 00002B25 B80200                  		mov	ax, 2
  6745                                  
  6746                                  OK_BYE:					; ...
  6747 00002B28 E84FE8                  		call	LCritDisk
  6748 00002B2B C3                      		retn
  6749                                  
  6750                                  ; =============== S U B	R O U T	I N E =======================================
  6751                                  
  6752                                  
  6753                                  Get_FAST_PATH:
  6754 00002B2C 36800E[3A0D]01          		or	byte [ss:FastOpenFlg], 1
  6755 00002B32 E86715                  		call	GETPATH
  6756 00002B35 9C                      		pushf
  6757 00002B36 368026[3A0D]80          		and	byte [ss:FastOpenFlg], 80h
  6758 00002B3C 9D                      		popf
  6759 00002B3D C3                      		retn
  6760                                  
  6761                                  ; =============== S U B	R O U T	I N E =======================================
  6762                                  
  6763                                  
  6764                                  DOS_DUP	:
  6765 00002B3E 2E8E06[0700]            		mov	es, [cs:DosDSeg]
  6766 00002B43 26C43E[9E05]            		les	di, [es:THISSFT]
  6767                                  
  6768                                  DOS_Dup_Direct:				; ...
  6769 00002B48 E863E7                  		call	IsSFTNet
  6770 00002B4B 7503                    		jnz	short DO_INC
  6771 00002B4D E8391C                  		call	DEV_OPEN_SFT
  6772                                  
  6773                                  DO_INC:					; ...
  6774 00002B50 26FF05                  		inc	word [es:di]
  6775 00002B53 C3                      		retn
  6776                                  
  6777                                  ; ---------------------------------------------------------------------------
  6778                                  
  6779                                  DOS_CREATE:				; ...
  6780 00002B54 30E4                    		xor	ah, ah
  6781                                  
  6782                                  Create_inter:				; ...
  6783 00002B56 A880                    		test	al, 80h
  6784 00002B58 7512                    		jnz	short AttErr
  6785 00002B5A A808                    		test	al, 8
  6786 00002B5C 7408                    		jz	short NoReset
  6787 00002B5E 810E[1106]8000          		or	word [DOS34_FLAG], 80h
  6788 00002B64 B008                    		mov	al, 8
  6789                                  
  6790                                  NoReset:				; ...
  6791 00002B66 0C20                    		or	al, 20h
  6792 00002B68 A850                    		test	al, 50h
  6793 00002B6A 740A                    		jz	short ATT_OK
  6794                                  
  6795                                  AttErr:					; ...
  6796 00002B6C B80500                  		mov	ax, 5
  6797 00002B6F C606[2303]01            		mov	byte [EXTERR_LOCUS], 1
  6798 00002B74 EB67                    		jmp	short SET_MKND_ERR
  6799                                  ; ---------------------------------------------------------------------------
  6800                                  
  6801                                  ATT_OK:					; ...
  6802 00002B76 C43E[9E05]              		les	di, [THISSFT]
  6803 00002B7A 06                      		push	es
  6804 00002B7B C436[A205]              		les	si, [THISCDS]
  6805 00002B7F 83FEFF                  		cmp	si, 0FFFFh
  6806 00002B82 751D                    		jnz	short TEST_RE_NET
  6807 00002B84 07                      		pop	es
  6808 00002B85 F606[F605]01            		test	byte [EXTOPEN_ON], 1
  6809 00002B8A 740D                    		jz	short NOEXTOP
  6810                                  
  6811                                  IFS_extopen:				; ...
  6812 00002B8C 50                      		push	ax
  6813 00002B8D B82E11                  		mov	ax, 112Eh
  6814 00002B90 CD2F                    		int	2Fh		; Multiplex - DOS 4 IFSFUNC.EXE	- ???
  6815                                  					; SS = DS = DOS	CS, STACK: WORD	???   low byte = ???
  6816                                  					; Return: CF set on error
  6817                                  					; CF clear if successful
  6818 00002B92 5B                      		pop	bx
  6819 00002B93 C606[F605]00            		mov	byte [EXTOPEN_ON], 0
  6820 00002B98 C3                      		retn
  6821                                  ; ---------------------------------------------------------------------------
  6822                                  
  6823                                  NOEXTOP:				; ...
  6824 00002B99 50                      		push	ax
  6825 00002B9A B81811                  		mov	ax, 1118h
  6826 00002B9D CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - CREATE/TRUNCATE FILE
  6827                                  					; ES:DI	-> uninitialized SFT, SS = DOS CS
  6828                                  					; SDA first filename pointer ->	fully-qualified	name of	file
  6829                                  					; STACK: WORD file creation mode???
  6830 00002B9F 5B                      		pop	bx
  6831 00002BA0 C3                      		retn
  6832                                  ; ---------------------------------------------------------------------------
  6833                                  
  6834                                  TEST_RE_NET:				; ...
  6835 00002BA1 26F744430080            		test	word [es:si+43h], 8000h
  6836 00002BA7 07                      		pop	es
  6837 00002BA8 7419                    		jz	short LOCAL_CREATE
  6838 00002BAA E8BF00                  		call	Set_EXT_mode
  6839 00002BAD 7205                    		jb	short dochk
  6840 00002BAF 26834D0202              		or	word [es:di+2], 2
  6841                                  
  6842                                  dochk:					; ...
  6843 00002BB4 F606[F605]01            		test	byte [EXTOPEN_ON], 1
  6844 00002BB9 75D1                    		jnz	short IFS_extopen
  6845 00002BBB 50                      		push	ax
  6846 00002BBC B81711                  		mov	ax, 1117h
  6847 00002BBF CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - CREATE/TRUNCATE REMOTE FILE
  6848                                  					; ES:DI	-> uninitialized SFT, SS = DOS CS
  6849                                  					; SDA first filename pointer ->	fully-qualified	name of	file to	open
  6850                                  					; SDA CDS pointer -> current directory
  6851                                  					; Return: CF set on error
  6852 00002BC1 5B                      		pop	bx
  6853 00002BC2 C3                      		retn
  6854                                  ; ---------------------------------------------------------------------------
  6855                                  
  6856                                  LOCAL_CREATE:				; ...
  6857 00002BC3 E8A600                  		call	Set_EXT_mode
  6858 00002BC6 7205                    		jb	short setdone
  6859 00002BC8 26834D0202              		or	word [es:di+2], 2
  6860                                  
  6861                                  setdone:				; ...
  6862 00002BCD E88AE7                  		call	ECritDisk
  6863 00002BD0 E8721F                  		call	MakeNode
  6864 00002BD3 7317                    		jnb	short Create_ok
  6865 00002BD5 C606[A10A]FF            		mov	byte [VOLCHNG_FLAG], 0FFh
  6866 00002BDA E89DE7                  		call	LCritDisk
  6867                                  
  6868                                  SET_MKND_ERR:				; ...
  6869 00002BDD BB[E42B]                		mov	bx, CRTERRTAB
  6870                                  		;xlat	byte [cs:bx]
  6871 00002BE0 2ED7                    		cs	xlat
  6872 00002BE2 F9                      		stc
  6873 00002BE3 C3                      		retn
  6874                                  ; ---------------------------------------------------------------------------
  6875 00002BE4 0005525003052002        CRTERRTAB	db 0, 5, 52h, 50h, 3, 5, 20h, 2	; ...
  6876                                  ; ---------------------------------------------------------------------------
  6877                                  
  6878                                  Create_ok:				; ...
  6879 00002BEC E8D0FB                  		call	FastOpen_Delete
  6880 00002BEF A0[6D05]                		mov	al, [SATTRIB]
  6881 00002BF2 A808                    		test	al, 8
  6882 00002BF4 741C                    		jz	short NoVolLabel
  6883 00002BF6 C43E[A205]              		les	di, [THISCDS]
  6884 00002BFA 268A25                  		mov	ah, [es:di]
  6885 00002BFD 80EC41                  		sub	ah, 'A'
  6886 00002C00 8826[A10A]              		mov	byte [VOLCHNG_FLAG], ah
  6887 00002C04 B701                    		mov	bh, 1
  6888 00002C06 E81F00                  		call	Set_Media_ID
  6889 00002C09 E84EE7                  		call	ECritDisk
  6890 00002C0C E8D62C                  		call	FATREAD_CDS
  6891 00002C0F E868E7                  		call	LCritDisk
  6892                                  
  6893                                  NoVolLabel:				; ...
  6894 00002C12 B80200                  		mov	ax, 2
  6895 00002C15 C43E[9E05]              		les	di, [THISSFT]
  6896 00002C19 FF1E[C800]              		call	far [ShSU]
  6897 00002C1D E85AE7                  		call	LCritDisk
  6898 00002C20 E95001                  		jmp	SET_SFT_MODE
  6899                                  ; ---------------------------------------------------------------------------
  6900                                  
  6901                                  DOS_Create_New:				; ...
  6902 00002C23 B401                    		mov	ah, 1
  6903 00002C25 E92EFF                  		jmp	Create_inter
  6904                                  
  6905                                  ; =============== S U B	R O U T	I N E =======================================
  6906                                  
  6907                                  
  6908                                  Set_Media_ID:
  6909 00002C28 50                      		push	ax
  6910 00002C29 06                      		push	es
  6911 00002C2A 57                      		push	di
  6912 00002C2B FEC4                    		inc	ah
  6913 00002C2D 88E3                    		mov	bl, ah
  6914 00002C2F B00D                    		mov	al, 0Dh
  6915 00002C31 B96608                  		mov	cx, 866h
  6916 00002C34 BA[6C0D]                		mov	dx, FAKE_STACK_2F
  6917 00002C37 53                      		push	bx
  6918 00002C38 52                      		push	dx
  6919 00002C39 30FF                    		xor	bh, bh
  6920 00002C3B E824F7                  		call	$IOCTL
  6921 00002C3E 5A                      		pop	dx
  6922 00002C3F 5B                      		pop	bx
  6923 00002C40 7224                    		jb	short geterr
  6924 00002C42 08FF                    		or	bh, bh
  6925 00002C44 7405                    		jz	short NoName
  6926 00002C46 BE[4B05]                		mov	si, NAME1
  6927 00002C49 EB03                    		jmp	short doset
  6928                                  ; ---------------------------------------------------------------------------
  6929                                  
  6930                                  NoName:					; ...
  6931 00002C4B BE[BA0D]                		mov	si, NO_NAME_ID ;	"NO NAME    "
  6932                                  
  6933                                  doset:					; ...
  6934 00002C4E 89D7                    		mov	di, dx
  6935 00002C50 83C706                  		add	di, 6
  6936 00002C53 16                      		push	ss
  6937 00002C54 1F                      		pop	ds
  6938 00002C55 16                      		push	ss
  6939 00002C56 07                      		pop	es
  6940 00002C57 B90B00                  		mov	cx, 11
  6941 00002C5A F3A4                    		rep movsb
  6942 00002C5C B94608                  		mov	cx, 846h
  6943 00002C5F B00D                    		mov	al, 0Dh
  6944 00002C61 30FF                    		xor	bh, bh
  6945 00002C63 E8FCF6                  		call	$IOCTL
  6946                                  
  6947                                  geterr:					; ...
  6948 00002C66 16                      		push	ss
  6949 00002C67 1F                      		pop	ds
  6950 00002C68 5F                      		pop	di
  6951 00002C69 07                      		pop	es
  6952 00002C6A 58                      		pop	ax
  6953 00002C6B C3                      		retn
  6954                                  
  6955                                  ; =============== S U B	R O U T	I N E =======================================
  6956                                  
  6957                                  
  6958                                  Set_EXT_mode:
  6959 00002C6C 36F606[F605]01          		test	byte [ss:EXTOPEN_ON], 1
  6960 00002C72 740B                    		jz	short NOTEX
  6961 00002C74 50                      		push	ax
  6962 00002C75 36A1[0106]              		mov	ax, [ss:SAVE_BX]
  6963 00002C79 26094502                		or	[es:di+2], ax
  6964 00002C7D 58                      		pop	ax
  6965 00002C7E F9                      		stc
  6966                                  
  6967                                  NOTEX:					; ...
  6968 00002C7F C3                      		retn
  6969                                  
  6970                                  ; =============== S U B	R O U T	I N E =======================================
  6971                                  
  6972                                  
  6973                                  DOS_OPEN:
  6974 00002C80 C606[4C03]00            		mov	byte [NoSetDir], 0
  6975 00002C85 E84001                  		call	Check_Access_AX
  6976 00002C88 722B                    		jb	short do_ret_label
  6977 00002C8A C43E[9E05]              		les	di, [THISSFT]
  6978 00002C8E 30E4                    		xor	ah, ah
  6979 00002C90 26884502                		mov	[es:di+2], al
  6980 00002C94 06                      		push	es
  6981 00002C95 C436[A205]              		les	si, [THISCDS]
  6982 00002C99 83FEFF                  		cmp	si, 0FFFFh
  6983 00002C9C 7530                    		jnz	short TEST_RE_NET1
  6984 00002C9E 07                      		pop	es
  6985 00002C9F F606[F605]01            		test	byte [EXTOPEN_ON], 1
  6986 00002CA4 7410                    		jz	short _NOEXTOP
  6987                                  
  6988                                  _IFS_extopen:				; ...
  6989 00002CA6 A0[0106]                		mov	al, byte [SAVE_BX]
  6990 00002CA9 50                      		push	ax
  6991 00002CAA B82E11                  		mov	ax, 112Eh
  6992 00002CAD CD2F                    		int	2Fh		; Multiplex - DOS 4 IFSFUNC.EXE	- ???
  6993                                  					; SS = DS = DOS	CS, STACK: WORD	???   low byte = ???
  6994                                  					; Return: CF set on error
  6995                                  					; CF clear if successful
  6996 00002CAF 5B                      		pop	bx
  6997 00002CB0 C606[F605]00            		mov	byte [EXTOPEN_ON], 0
  6998                                  
  6999                                  do_ret_label:				; ...
  7000 00002CB5 C3                      		retn
  7001                                  ; ---------------------------------------------------------------------------
  7002                                  
  7003                                  _NOEXTOP:				; ...
  7004 00002CB6 F606[8600]01            		test	byte [DOS_FLAG], 1
  7005 00002CBB 7409                    		jz	short not_exec_open
  7006 00002CBD F606[1206]08            		test	byte [DOS34_FLAG+1], 8
  7007 00002CC2 7402                    		jz	short not_exec_open
  7008 00002CC4 B023                    		mov	al, 23h
  7009                                  
  7010                                  not_exec_open:				; ...
  7011 00002CC6 50                      		push	ax
  7012 00002CC7 B81611                  		mov	ax, 1116h
  7013 00002CCA CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - OPEN	EXISTING REMOTE	FILE
  7014                                  					; ES:DI	-> uninitialized SFT, SS = DOS CS
  7015                                  					; SDA first filename pointer ->	fully-qualified	name of	file to	open
  7016                                  					; STACK: WORD file open	mode
  7017                                  					; Return: CF set on error
  7018 00002CCC 5B                      		pop	bx
  7019 00002CCD C3                      		retn
  7020                                  ; ---------------------------------------------------------------------------
  7021                                  
  7022                                  TEST_RE_NET1:				; ...
  7023 00002CCE 26F744430080            		test	word [es:si+43h], 8000h
  7024 00002CD4 07                      		pop	es
  7025 00002CD5 7409                    		jz	short LOCAL_OPEN
  7026 00002CD7 F606[F605]01            		test	byte [EXTOPEN_ON], 1
  7027 00002CDC 75C8                    		jnz	short _IFS_extopen
  7028 00002CDE EBD6                    		jmp	short _NOEXTOP
  7029                                  ; ---------------------------------------------------------------------------
  7030                                  
  7031                                  LOCAL_OPEN:				; ...
  7032 00002CE0 E877E6                  		call	ECritDisk
  7033 00002CE3 800E[3A0D]05            		or	byte [FastOpenFlg],	5
  7034 00002CE8 E8B113                  		call	GETPATH
  7035 00002CEB 7320                    		jnb	short Open_found
  7036 00002CED 7514                    		jnz	short bad_path2
  7037 00002CEF 08C9                    		or	cl, cl
  7038 00002CF1 7410                    		jz	short bad_path2
  7039                                  
  7040                                  OpenFNF:
  7041 00002CF3 B80200                  		mov	ax, 2
  7042                                  
  7043                                  OpenBadRet:				; ...
  7044 00002CF6 368026[3A0D]80          		and	byte [ss:FastOpenFlg],	80h
  7045 00002CFC F9                      		stc
  7046 00002CFD E87AE6                  		call	LCritDisk
  7047 00002D00 E98600                  		jmp	Clear_FastOpen
  7048                                  ; ---------------------------------------------------------------------------
  7049                                  
  7050                                  bad_path2:				; ...
  7051 00002D03 B80300                  		mov	ax, 3
  7052 00002D06 EBEE                    		jmp	short OpenBadRet
  7053                                  ; ---------------------------------------------------------------------------
  7054                                  
  7055                                  Open_Bad_Access:			; ...
  7056 00002D08 B80500                  		mov	ax, 5
  7057 00002D0B EBE9                    		jmp	short OpenBadRet
  7058                                  ; ---------------------------------------------------------------------------
  7059                                  
  7060                                  Open_found:				; ...
  7061 00002D0D 74F9                    		jz	short Open_Bad_Access
  7062 00002D0F 08E4                    		or	ah, ah
  7063 00002D11 783F                    		js	short open_ok
  7064 00002D13 8E06[E405]              		mov	es, word [CURBUF+2]
  7065 00002D17 268A470B                		mov	al, [es:bx+0Bh]
  7066 00002D1B A808                    		test	al, 8
  7067 00002D1D 75E9                    		jnz	short Open_Bad_Access
  7068 00002D1F A801                    		test	al, 1
  7069 00002D21 742F                    		jz	short open_ok
  7070 00002D23 1E                      		push	ds
  7071 00002D24 56                      		push	si
  7072 00002D25 C536[9E05]              		lds	si, [THISSFT]
  7073 00002D29 8B4C02                  		mov	cx, [si+2]
  7074 00002D2C F7C10080                		test	cx, 8000h
  7075 00002D30 750A                    		jnz	short ResetAccess
  7076 00002D32 88CA                    		mov	dl, cl
  7077 00002D34 80E2F0                  		and	dl, 0F0h
  7078 00002D37 80FA70                  		cmp	dl, 70h	; 'p'
  7079 00002D3A 7508                    		jnz	short NormalOpen
  7080                                  
  7081                                  ResetAccess:				; ...
  7082 00002D3C 83E1F0                  		and	cx, 0FFF0h
  7083 00002D3F 894C02                  		mov	[si+2],	cx
  7084 00002D42 EB0C                    		jmp	short FillSFT
  7085                                  ; ---------------------------------------------------------------------------
  7086                                  
  7087                                  NormalOpen:				; ...
  7088 00002D44 80E10F                  		and	cl, 0Fh
  7089 00002D47 80F900                  		cmp	cl, 0
  7090 00002D4A 7404                    		jz	short FillSFT
  7091 00002D4C 5E                      		pop	si
  7092 00002D4D 1F                      		pop	ds
  7093 00002D4E EBB8                    		jmp	short Open_Bad_Access
  7094                                  ; ---------------------------------------------------------------------------
  7095                                  
  7096                                  FillSFT:				; ...
  7097 00002D50 5E                      		pop	si
  7098 00002D51 1F                      		pop	ds
  7099                                  
  7100                                  open_ok:				; ...
  7101 00002D52 E8AF1F                  		call	DOOPEN
  7102 00002D55 368026[3A0D]80          		and	byte [ss:FastOpenFlg], 80h
  7103 00002D5B E84A00                  		call	DO_SHARE_CHECK
  7104 00002D5E 7305                    		jnb	short SHARE_OK
  7105 00002D60 E817E6                  		call	LCritDisk
  7106 00002D63 EB24                    		jmp	short Clear_FastOpen
  7107                                  ; ---------------------------------------------------------------------------
  7108                                  
  7109                                  SHARE_OK:				; ...
  7110 00002D65 B80300                  		mov	ax, 3
  7111 00002D68 C43E[9E05]              		les	di, [THISSFT]
  7112 00002D6C FF1E[C800]              		call	far [ShSU]
  7113 00002D70 E807E6                  		call	LCritDisk
  7114                                  
  7115                                  SET_SFT_MODE:				; ...
  7116 00002D73 C43E[9E05]              		les	di, [THISSFT]
  7117 00002D77 E80F1A                  		call	DEV_OPEN_SFT
  7118 00002D7A 26F745020080            		test	word [es:di+2], 8000h
  7119 00002D80 7407                    		jz	short Clear_FastOpen
  7120 00002D82 A1[3003]                		mov	ax, [CurrentPDB]
  7121 00002D85 26894531                		mov	[es:di+31h], ax
  7122                                  
  7123                                  Clear_FastOpen:				; ...
  7124 00002D89 C3                      		retn
  7125                                  
  7126                                  ; =============== S U B	R O U T	I N E =======================================
  7127                                  
  7128                                  
  7129                                  SHARE_ERROR:
  7130 00002D8A 26F745020080            		test	word [es:di+2], 8000h
  7131 00002D90 750C                    		jnz	short _HARD_ERR
  7132 00002D92 268A4D02                		mov	cl, [es:di+2]
  7133 00002D96 80E1F0                  		and	cl, 0F0h
  7134 00002D99 80F900                  		cmp	cl, 0
  7135 00002D9C 7505                    		jnz	short _NO_HARD_ERR
  7136                                  
  7137                                  _HARD_ERR:				; ...
  7138 00002D9E E80F48                  		call	SHARE_VIOLATION
  7139 00002DA1 73E6                    		jnb	short Clear_FastOpen
  7140                                  
  7141                                  _NO_HARD_ERR:				; ...
  7142 00002DA3 B82000                  		mov	ax, 20h	; ' '
  7143 00002DA6 F9                      		stc
  7144 00002DA7 C3                      		retn
  7145                                  
  7146                                  ; =============== S U B	R O U T	I N E =======================================
  7147                                  
  7148                                  
  7149                                  DO_SHARE_CHECK:
  7150 00002DA8 E8AFE5                  		call	ECritDisk
  7151                                  
  7152                                  OPN_RETRY:				; ...
  7153 00002DAB 8B0E[1A00]              		mov	cx, [RetryCount]
  7154                                  
  7155                                  OpenShareRetry:				; ...
  7156 00002DAF 51                      		push	cx
  7157 00002DB0 E8F847                  		call	SHARE_CHECK
  7158 00002DB3 59                      		pop	cx
  7159 00002DB4 730E                    		jnb	short Share_Ok2
  7160 00002DB6 E897E4                  		call	Idle
  7161 00002DB9 E2F4                    		loop	OpenShareRetry
  7162 00002DBB C43E[9E05]              		les	di, [THISSFT]
  7163 00002DBF E8C8FF                  		call	SHARE_ERROR
  7164 00002DC2 73E7                    		jnb	short OPN_RETRY
  7165                                  
  7166                                  Share_Ok2:				; ...
  7167 00002DC4 E8B3E5                  		call	LCritDisk
  7168 00002DC7 C3                      		retn
  7169                                  
  7170                                  ; =============== S U B	R O U T	I N E =======================================
  7171                                  
  7172                                  
  7173                                  Check_Access_AX:
  7174 00002DC8 A2[6E05]                		mov	[OPEN_ACCESS],	al
  7175 00002DCB 53                      		push	bx
  7176 00002DCC 88C3                    		mov	bl, al
  7177 00002DCE 80E3F0                  		and	bl, 0F0h
  7178 00002DD1 803E[7205]FF            		cmp	byte [FSHARING], 0FFh
  7179 00002DD6 7505                    		jnz	short CheckShareMode
  7180 00002DD8 80FB70                  		cmp	bl, 70h
  7181 00002DDB 7405                    		jz	short CheckAccessMode
  7182                                  
  7183                                  CheckShareMode:				; ...
  7184 00002DDD 80FB40                  		cmp	bl, 40h
  7185 00002DE0 770D                    		ja	short Make_Bad_Access
  7186                                  
  7187                                  CheckAccessMode:			; ...
  7188 00002DE2 88C3                    		mov	bl, al
  7189 00002DE4 80E30F                  		and	bl, 0Fh
  7190 00002DE7 80FB02                  		cmp	bl, 2
  7191 00002DEA 7703                    		ja	short Make_Bad_Access
  7192 00002DEC 5B                      		pop	bx
  7193 00002DED F8                      		clc
  7194 00002DEE C3                      		retn
  7195                                  ; ---------------------------------------------------------------------------
  7196                                  
  7197                                  Make_Bad_Access:			; ...
  7198 00002DEF B80C00                  		mov	ax, 0Ch
  7199 00002DF2 5B                      		pop	bx
  7200 00002DF3 F9                      		stc
  7201 00002DF4 C3                      		retn
  7202                                  
  7203                                  ; =============== S U B	R O U T	I N E =======================================
  7204                                  
  7205                                  
  7206                                  DISK_INFO:
  7207 00002DF5 E89DE4                  		call	TestNet
  7208 00002DF8 7306                    		jnb	short LOCAL_DSK_INFO
  7209 00002DFA B80C11                  		mov	ax, 110Ch
  7210 00002DFD CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - GET DISK SPACE
  7211                                  					; ES:DI	-> current directory
  7212                                  					; Return: AL = sectors per cluster, BX = total clusters
  7213                                  					; CX = bytes per sector, DX = number of	available clusters
  7214 00002DFF C3                      		retn
  7215                                  ; ---------------------------------------------------------------------------
  7216                                  
  7217                                  LOCAL_DSK_INFO:				; ...
  7218 00002E00 C606[2303]02            		mov	byte [EXTERR_LOCUS], 2
  7219 00002E05 E852E5                  		call	ECritDisk
  7220 00002E08 E8DA2A                  		call	FATREAD_CDS
  7221 00002E0B 7241                    		jb	short CRIT_LEAVE
  7222 00002E0D BB0200                  		mov	bx, 2
  7223 00002E10 E81E29                  		call	UNPACK
  7224 00002E13 7239                    		jb	short CRIT_LEAVE
  7225 00002E15 C536[E205]              		lds	si, [CURBUF]
  7226 00002E19 8A6414                  		mov	ah, [si+20]
  7227 00002E1C 16                      		push	ss
  7228 00002E1D 1F                      		pop	ds
  7229 00002E1E 268B4E0D                		mov	cx, [es:bp+0Dh]
  7230 00002E22 268B561F                		mov	dx, [es:bp+1Fh]
  7231 00002E26 83FAFF                  		cmp	dx, 0FFFFh
  7232 00002E29 7404                    		jz	short DoScan
  7233 00002E2B 39CA                    		cmp	dx, cx
  7234 00002E2D 7223                    		jb	short GotVal
  7235                                  
  7236                                  DoScan:					; ...
  7237 00002E2F 31D2                    		xor	dx, dx
  7238 00002E31 49                      		dec	cx
  7239                                  
  7240                                  SCANFREE:				; ...
  7241 00002E32 E8FC28                  		call	UNPACK
  7242 00002E35 7217                    		jb	short CRIT_LEAVE
  7243 00002E37 7501                    		jnz	short NOTFREECLUS
  7244 00002E39 42                      		inc	dx
  7245                                  
  7246                                  NOTFREECLUS:				; ...
  7247 00002E3A 43                      		inc	bx
  7248 00002E3B E2F5                    		loop	SCANFREE
  7249 00002E3D 4B                      		dec	bx
  7250                                  
  7251                                  ReturnVals:				; ...
  7252 00002E3E 4B                      		dec	bx
  7253 00002E3F 268A4604                		mov	al, [es:bp+4]
  7254 00002E43 FEC0                    		inc	al
  7255 00002E45 268B4E02                		mov	cx, [es:bp+2]
  7256 00002E49 2689561F                		mov	[es:bp+1Fh], dx
  7257 00002E4D F8                      		clc
  7258                                  
  7259                                  CRIT_LEAVE:				; ...
  7260 00002E4E E829E5                  		call	LCritDisk
  7261 00002E51 C3                      		retn
  7262                                  ; ---------------------------------------------------------------------------
  7263                                  
  7264                                  GotVal:					; ...
  7265 00002E52 89CB                    		mov	bx, cx
  7266 00002E54 EBE8                    		jmp	short ReturnVals
  7267                                  
  7268                                  ; =============== S U B	R O U T	I N E =======================================
  7269                                  
  7270                                  
  7271                                  DOS_SEARCH_FIRST:
  7272                                  
  7273                                  ; FUNCTION CHUNK AT 6C8B SIZE 0000009C BYTES
  7274                                  
  7275 00002E56 C43E[A205]              		les	di, [THISCDS]
  7276 00002E5A 83FFFF                  		cmp	di, 0FFFFh
  7277 00002E5D 7506                    		jnz	short TEST_RE_NET2
  7278 00002E5F B81911                  		mov	ax, 1119h
  7279 00002E62 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - ???
  7280 00002E64 C3                      		retn
  7281                                  ; ---------------------------------------------------------------------------
  7282                                  
  7283                                  TEST_RE_NET2:				; ...
  7284 00002E65 26F745430080            		test	word [es:di+43h], 8000h
  7285 00002E6B 7406                    		jz	short LOCAL_SEARCH_FIRST
  7286 00002E6D B81B11                  		mov	ax, 111Bh
  7287 00002E70 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - FINDFIRST
  7288                                  					; SS = DS = DOS	CS, [DTA] = uninitialized 21-byte findfirst search data
  7289                                  					; SDA first filename pointer ->	fully-qualified	search template
  7290                                  					; SDA CDS pointer -> current directory
  7291                                  					; Return: CF set on error
  7292 00002E72 C3                      		retn
  7293                                  ; ---------------------------------------------------------------------------
  7294                                  
  7295                                  LOCAL_SEARCH_FIRST:			; ...
  7296 00002E73 E8E4E4                  		call	ECritDisk
  7297 00002E76 F706[1106]0004          		test	word [DOS34_FLAG], 400h
  7298 00002E7C 7405                    		jz	short NOFN
  7299 00002E7E 800E[3A0D]01            		or	byte [FastOpenFlg],	1
  7300                                  
  7301                                  NOFN:					; ...
  7302 00002E83 C606[4C03]01            		mov	byte [NoSetDir], 1
  7303 00002E88 E84401                  		call	CHECK_QUESTION
  7304 00002E8B 7305                    		jnb	short norm_GETPATH
  7305 00002E8D 8026[3A0D]80            		and	byte [FastOpenFlg],	80h
  7306                                  
  7307                                  norm_GETPATH:				; ...
  7308 00002E92 E80712                  		call	GETPATH
  7309 00002E95 7319                    		jnb	short find_check_dev
  7310 00002E97 7512                    		jnz	short bad_path3
  7311 00002E99 08C9                    		or	cl, cl
  7312 00002E9B 740E                    		jz	short bad_path3
  7313                                  
  7314                                  ; START	OF FUNCTION CHUNK FOR DOS_SEARCH_NEXT
  7315                                  
  7316                                  find_no_more:				; ...
  7317 00002E9D B81200                  		mov	ax, 12h
  7318                                  
  7319                                  BadBye:					; ...
  7320 00002EA0 368026[3A0D]80          		and	byte [ss:FastOpenFlg],	80h
  7321 00002EA6 F9                      		stc
  7322 00002EA7 E8D0E4                  		call	LCritDisk
  7323 00002EAA C3                      		retn
  7324                                  ; END OF FUNCTION CHUNK	FOR DOS_SEARCH_NEXT
  7325                                  ; ---------------------------------------------------------------------------
  7326                                  ; START	OF FUNCTION CHUNK FOR DOS_SEARCH_FIRST
  7327                                  
  7328                                  bad_path3:				; ...
  7329 00002EAB B80300                  		mov	ax, 3
  7330 00002EAE EBF0                    		jmp	short BadBye
  7331                                  ; ---------------------------------------------------------------------------
  7332                                  
  7333                                  find_check_dev:				; ...
  7334 00002EB0 08E4                    		or	ah, ah
  7335 00002EB2 790A                    		jns	short found_entry
  7336 00002EB4 C706[4803]FFFF          		mov	word [LASTENT], 0FFFFh
  7337 00002EBA FE06[7005]              		inc	byte [FOUND_DEV]
  7338                                  
  7339                                  found_entry:				; ...
  7340 00002EBE C43E[2C03]              		les	di, [DMAADD]
  7341 00002EC2 8B36[B205]              		mov	si, [WFP_START]
  7342 00002EC6 AC                      		lodsb
  7343 00002EC7 2C40                    		sub	al, 40h	; '@'
  7344 00002EC9 AA                      		stosb
  7345                                  
  7346                                  found_it:				; ...
  7347 00002ECA C43E[2C03]              		les	di, [DMAADD]
  7348 00002ECE 47                      		inc	di
  7349 00002ECF 1E                      		push	ds
  7350 00002ED0 F606[3A0D]10            		test	byte [FastOpenFlg],	10h
  7351 00002ED5 7408                    		jz	short notfast
  7352 00002ED7 89DE                    		mov	si, bx
  7353 00002ED9 8E1E[E405]              		mov	ds, word [CURBUF+2]
  7354 00002EDD EB03                    		jmp	short movmov
  7355                                  ; ---------------------------------------------------------------------------
  7356                                  
  7357                                  notfast:				; ...
  7358 00002EDF BE[4B05]                		mov	si, NAME1
  7359                                  
  7360                                  movmov:					; ...
  7361 00002EE2 A4                      		movsb
  7362 00002EE3 26807DFF05              		cmp	byte [es:di-1], 5
  7363 00002EE8 7505                    		jnz	short NOTKANJB
  7364 00002EEA 26C645FFE5              		mov	byte [es:di-1], 0E5h ; ''
  7365                                  
  7366                                  NOTKANJB:				; ...
  7367 00002EEF B90A00                  		mov	cx, 10
  7368 00002EF2 F3A4                    		rep movsb
  7369 00002EF4 1F                      		pop	ds
  7370 00002EF5 A0[6B05]                		mov	al, [ATTRIB]
  7371 00002EF8 AA                      		stosb
  7372 00002EF9 50                      		push	ax
  7373 00002EFA A1[4803]                		mov	ax, [LASTENT]
  7374 00002EFD AB                      		stosw
  7375 00002EFE A1[C205]                		mov	ax, [DIRSTART]
  7376 00002F01 AB                      		stosw
  7377 00002F02 83C704                  		add	di, 4
  7378 00002F05 58                      		pop	ax
  7379 00002F06 08E4                    		or	ah, ah
  7380 00002F08 781B                    		js	short DOSREL
  7381 00002F0A 833E[E205]FF            		cmp	word [CURBUF], 0FFFFh
  7382 00002F0F 7510                    		jnz	short OKSTORE
  7383 00002F11 F606[3A0D]10            		test	byte [FastOpenFlg], 10h
  7384 00002F16 7509                    		jnz	short OKSTORE
  7385 00002F18 26C745F8FFFF            		mov	word [es:di-8], 0FFFFh
  7386 00002F1E E97CFF                  		jmp	find_no_more
  7387                                  ; ---------------------------------------------------------------------------
  7388                                  
  7389                                  OKSTORE:				; ...
  7390 00002F21 8E1E[E405]              		mov	ds, word [CURBUF+2]
  7391                                  
  7392                                  DOSREL:					; ...
  7393 00002F25 89DE                    		mov	si, bx
  7394 00002F27 B92000                  		mov	cx, 32
  7395 00002F2A 89F8                    		mov	ax, di
  7396 00002F2C F3A4                    		rep movsb
  7397 00002F2E 89C7                    		mov	di, ax
  7398 00002F30 26803D05                		cmp	byte [es:di], 5
  7399 00002F34 7504                    		jnz	short NO05
  7400 00002F36 26C605E5                		mov	byte [es:di], 0E5h
  7401                                  
  7402                                  NO05:					; ...
  7403 00002F3A 368026[3A0D]80          		and	byte [ss:FastOpenFlg], 80h
  7404 00002F40 16                      		push	ss
  7405 00002F41 1F                      		pop	ds
  7406 00002F42 F8                      		clc
  7407 00002F43 E834E4                  		call	LCritDisk
  7408 00002F46 C3                      		retn
  7409                                  ; END OF FUNCTION CHUNK	FOR DOS_SEARCH_FIRST
  7410                                  
  7411                                  ; =============== S U B	R O U T	I N E =======================================
  7412                                  
  7413                                  
  7414                                  DOS_SEARCH_NEXT:
  7415                                  
  7416                                  ; FUNCTION CHUNK AT 6C7D SIZE 0000000E BYTES
  7417                                  
  7418 00002F47 C43E[2C03]              		les	di, [DMAADD]
  7419 00002F4B 268A05                  		mov	al, [es:di]
  7420 00002F4E A880                    		test	al, 80h
  7421 00002F50 7406                    		jz	short LOCAL_SEARCH_NEXT
  7422 00002F52 B81C11                  		mov	ax, 111Ch
  7423 00002F55 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - FINDNEXT
  7424                                  					; SS = DS = DOS	CS, [DTA] = 21-byte findfirst search data
  7425                                  					; Return: CF set on error, AX =	DOS error code
  7426                                  					; CF clear if successful
  7427 00002F57 C3                      		retn
  7428                                  ; ---------------------------------------------------------------------------
  7429                                  
  7430                                  LOCAL_SEARCH_NEXT:			; ...
  7431 00002F58 C606[2303]02            		mov	byte [EXTERR_LOCUS], 2
  7432 00002F5D E8FAE3                  		call	ECritDisk
  7433 00002F60 C706[A205][F304]        		mov	word [THISCDS], DUMMYCDS
  7434 00002F66 8C1E[A405]              		mov	word [THISCDS+2], ds
  7435 00002F6A 0440                    		add	al, 40h	; '@'
  7436 00002F6C E8AE3C                  		call	InitCDS
  7437 00002F6F 7236                    		jb	short No_files
  7438 00002F71 C43E[A205]              		les	di, [THISCDS]
  7439 00002F75 26C46D45                		les	bp, [es:di+45h]
  7440 00002F79 E88CD6                  		call	GOTDPB
  7441 00002F7C 268A4600                		mov	al, [es:bp+0]
  7442 00002F80 A2[7605]                		mov	[THISDRV], al
  7443 00002F83 C706[7E05]00E5          		mov	word [CREATING], 0E500h
  7444 00002F89 C606[4C03]01            		mov	byte [NoSetDir], 1
  7445 00002F8E C536[2C03]              		lds	si, [DMAADD]
  7446 00002F92 AC                      		lodsb
  7447                                  
  7448                                  RENAME_NEXT:				; ...
  7449 00002F93 16                      		push	ss
  7450 00002F94 07                      		pop	es
  7451 00002F95 BF[4B05]                		mov	di, NAME1
  7452 00002F98 B90B00                  		mov	cx, 11
  7453 00002F9B F3A4                    		rep movsb
  7454 00002F9D AC                      		lodsb
  7455 00002F9E 36A2[6B05]              		mov	byte [ss:ATTRIB], al
  7456 00002FA2 AD                      		lodsw
  7457 00002FA3 09C0                    		or	ax, ax
  7458 00002FA5 7903                    		jns	short cont_load
  7459                                  
  7460                                  No_files:				; ...
  7461 00002FA7 E9F3FE                  		jmp	find_no_more
  7462                                  ; ---------------------------------------------------------------------------
  7463                                  
  7464                                  cont_load:				; ...
  7465 00002FAA 50                      		push	ax
  7466 00002FAB AD                      		lodsw
  7467 00002FAC 89C3                    		mov	bx, ax
  7468 00002FAE 16                      		push	ss
  7469 00002FAF 1F                      		pop	ds
  7470 00002FB0 C42E[8A05]              		les	bp, [THISDPB]
  7471 00002FB4 E88010                  		call	SETDIRSRCH
  7472 00002FB7 7303                    		jnb	short SEARCH_GOON
  7473 00002FB9 58                      		pop	ax
  7474 00002FBA EBEB                    		jmp	short No_files
  7475                                  ; ---------------------------------------------------------------------------
  7476                                  
  7477                                  SEARCH_GOON:				; ...
  7478 00002FBC E88813                  		call	STARTSRCH
  7479 00002FBF 58                      		pop	ax
  7480 00002FC0 E84410                  		call	GETENT
  7481 00002FC3 72E2                    		jb	short No_files
  7482 00002FC5 E8730F                  		call	NEXTENT
  7483 00002FC8 72DD                    		jb	short No_files
  7484 00002FCA 30E4                    		xor	ah, ah
  7485 00002FCC E9FBFE                  		jmp	found_it
  7486                                  
  7487                                  ; =============== S U B	R O U T	I N E =======================================
  7488                                  
  7489                                  
  7490                                  CHECK_QUESTION:
  7491 00002FCF 16                      		push	ss
  7492 00002FD0 1F                      		pop	ds
  7493 00002FD1 368B36[B205]            		mov	si, [ss:WFP_START]
  7494                                  
  7495                                  getnext:				; ...
  7496 00002FD6 AC                      		lodsb
  7497 00002FD7 08C0                    		or	al, al
  7498 00002FD9 7405                    		jz	short NO_Question
  7499 00002FDB 3C3F                    		cmp	al, '?'
  7500 00002FDD 75F7                    		jnz	short getnext
  7501 00002FDF F9                      		stc
  7502                                  
  7503                                  NO_Question:				; ...
  7504 00002FE0 C3                      		retn
  7505                                  
  7506                                  ; =============== S U B	R O U T	I N E =======================================
  7507                                  
  7508                                  
  7509                                  DOS_ABORT:
  7510 00002FE1 368E06[3003]            		mov	es, [ss:CurrentPDB]
  7511 00002FE6 268B0E3200              		mov	cx, [es:32h]	; [ES:PDB.JFN_Length]
  7512                                  
  7513                                  reset_free_jfn:				; ...
  7514 00002FEB 89CB                    		mov	bx, cx
  7515 00002FED 51                      		push	cx
  7516 00002FEE 4B                      		dec	bx
  7517 00002FEF E85939                  		call	$CLOSE
  7518 00002FF2 59                      		pop	cx
  7519 00002FF3 E2F6                    		loop	reset_free_jfn
  7520 00002FF5 16                      		push	ss
  7521 00002FF6 1F                      		pop	ds
  7522 00002FF7 B81D11                  		mov	ax, 111Dh
  7523 00002FFA CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - CLOSE ALL REMOTE FILES FOR PROCESS
  7524                                  					; DS???, SS = DOS CS
  7525 00002FFC FF1E[A000]              		call	far [MFTCloseP]
  7526 00003000 36C43E[4000]            		les	di, [ss:SFTFCB]
  7527 00003005 268B4D04                		mov	cx, [es:di+4]
  7528 00003009 E317                    		jcxz	FCBScanDone
  7529 0000300B 8D7D06                  		lea	di, [di+6]
  7530 0000300E 36A1[3C03]              		mov	ax, [ss:PROC_ID]
  7531                                  
  7532                                  FCBTest:				; ...
  7533 00003012 26394531                		cmp	[es:di+31h], ax
  7534 00003016 7505                    		jnz	short FCBNext
  7535 00003018 26C7050000              		mov	word [es:di], 0
  7536                                  
  7537                                  FCBNext:				; ...
  7538 0000301D 83C73B                  		add	di, 59
  7539 00003020 E2F0                    		loop	FCBTest
  7540                                  
  7541                                  FCBScanDone:				; ...
  7542 00003022 31DB                    		xor	bx, bx
  7543                                  
  7544                                  Scan:					; ...
  7545 00003024 53                      		push	bx
  7546 00003025 E89C38                  		call	SFFromSFN
  7547 00003028 5B                      		pop	bx
  7548 00003029 7301                    		jnb	short Scan1
  7549 0000302B C3                      		retn
  7550                                  ; ---------------------------------------------------------------------------
  7551                                  
  7552                                  Scan1:					; ...
  7553 0000302C 26833DFF                		cmp	word [es:di], 0FFFFh
  7554 00003030 7519                    		jnz	short scan_next
  7555 00003032 36A1[3C03]              		mov	ax, [ss:PROC_ID]
  7556 00003036 26394531                		cmp	[es:di+31h], ax
  7557 0000303A 750F                    		jnz	short scan_next
  7558 0000303C 36A1[3E03]              		mov	ax, [ss:USER_ID]
  7559 00003040 2639452F                		cmp	[es:di+2Fh], ax
  7560 00003044 7505                    		jnz	short scan_next
  7561 00003046 26C7050000              		mov	word [es:di], 0
  7562                                  
  7563                                  scan_next:				; ...
  7564 0000304B 43                      		inc	bx
  7565 0000304C EBD6                    		jmp	short Scan
  7566                                  
  7567                                  ; =============== S U B	R O U T	I N E =======================================
  7568                                  
  7569                                  
  7570                                  DOS_CLOSE:
  7571 0000304E C43E[9E05]              		les	di, [THISSFT]
  7572 00003052 268B5D05                		mov	bx, [es:di+5]
  7573 00003056 F7C30080                		test	bx, 8000h
  7574 0000305A 7406                    		jz	short LocalClose
  7575 0000305C B80611                  		mov	ax, 1106h
  7576 0000305F CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - CLOSE REMOTE	FILE
  7577                                  					; ES:DI	-> SFT
  7578                                  					; SFT DPB field	-> DPB of drive	containing file
  7579                                  					; Return: CF set on error, AX =	DOS error code
  7580                                  					; CF clear if successful
  7581 00003061 C3                      		retn
  7582                                  ; ---------------------------------------------------------------------------
  7583                                  
  7584                                  LocalClose:				; ...
  7585 00003062 E8F5E2                  		call	ECritDisk
  7586 00003065 E87001                  		call	SetSFTTimes
  7587 00003068 E8E400                  		call	FREE_SFT
  7588 0000306B 16                      		push	ss
  7589 0000306C 1F                      		pop	ds
  7590 0000306D 50                      		push	ax
  7591 0000306E 53                      		push	bx
  7592 0000306F E86445                  		call	ShareEnd
  7593 00003072 5B                      		pop	bx
  7594 00003073 58                      		pop	ax
  7595                                  
  7596                                  CloseEntry:				; ...
  7597 00003074 50                      		push	ax
  7598 00003075 F7C3C000                		test	bx, 0C0h
  7599 00003079 7403                    		jz	short rdir
  7600 0000307B E9BE00                  		jmp	FREE_SFT_OK
  7601                                  ; ---------------------------------------------------------------------------
  7602                                  
  7603                                  rdir:					; ...
  7604 0000307E E8DB00                  		call	DirFromSFT
  7605 00003081 B005                    		mov	al, 5
  7606 00003083 7303                    		jnb	short clook
  7607 00003085 E9B500                  		jmp	CloseFinish
  7608                                  ; ---------------------------------------------------------------------------
  7609                                  
  7610                                  clook:					; ...
  7611 00003088 57                      		push	di
  7612 00003089 56                      		push	si
  7613 0000308A 8D7420                  		lea	si, [si+20h]
  7614 0000308D E8B9E1                  		call	XCHGP
  7615 00003090 E8060F                  		call	MetaCompare
  7616 00003093 E8B3E1                  		call	XCHGP
  7617 00003096 5E                      		pop	si
  7618 00003097 5F                      		pop	di
  7619 00003098 740C                    		jz	short CLOSE_GO
  7620 0000309A 89F7                    		mov	di, si
  7621 0000309C 1E                      		push	ds
  7622 0000309D 07                      		pop	es
  7623 0000309E 16                      		push	ss
  7624 0000309F 1F                      		pop	ds
  7625 000030A0 F9                      		stc
  7626 000030A1 B002                    		mov	al, 2
  7627 000030A3 E99700                  		jmp	CloseFinish
  7628                                  ; ---------------------------------------------------------------------------
  7629                                  
  7630                                  CLOSE_GO:				; ...
  7631 000030A6 F744020080              		test	word [si+2], 8000h
  7632 000030AB 740D                    		jz	short nofcb
  7633 000030AD 268A6D0B                		mov	ch, [es:di+0Bh]
  7634 000030B1 8A4404                  		mov	al, [si+4]
  7635 000030B4 36A2[6B05]              		mov	byte [ss:ATTRIB], al
  7636 000030B8 EB07                    		jmp	short setattr
  7637                                  ; ---------------------------------------------------------------------------
  7638                                  
  7639                                  nofcb:					; ...
  7640 000030BA 8A4404                  		mov	al, [si+4]
  7641 000030BD 2688450B                		mov	[es:di+0Bh], al
  7642                                  
  7643                                  setattr:				; ...
  7644 000030C1 26804D0B20              		or	byte [es:di+0Bh], 20h
  7645 000030C6 268B451A                		mov	ax, [es:di+1Ah]
  7646 000030CA 36A3[BE0F]              		mov	[ss:OLD_FIRSTCLUS], ax
  7647 000030CE 8B440B                  		mov	ax, [si+0Bh]
  7648 000030D1 2689451A                		mov	[es:di+1Ah], ax
  7649 000030D5 8B4411                  		mov	ax, [si+11h]
  7650 000030D8 2689451C                		mov	[es:di+1Ch], ax
  7651 000030DC 8B4413                  		mov	ax, [si+13h]
  7652 000030DF 2689451E                		mov	[es:di+1Eh], ax
  7653 000030E3 8B440F                  		mov	ax, [si+0Fh]
  7654 000030E6 26894518                		mov	[es:di+18h], ax
  7655 000030EA 8B440D                  		mov	ax, [si+0Dh]
  7656 000030ED 26894516                		mov	[es:di+16h], ax
  7657 000030F1 26F6470540              		test	byte [es:bx+5], 40h
  7658 000030F6 7508                    		jnz	short yesdirty4
  7659 000030F8 E8662C                  		call	INC_DIRTY_COUNT
  7660 000030FB 26804F0540              		or	byte [es:bx+5], 40h
  7661                                  
  7662                                  yesdirty4:				; ...
  7663 00003100 1E                      		push	ds
  7664 00003101 56                      		push	si
  7665 00003102 8B4C0B                  		mov	cx, [si+0Bh]
  7666 00003105 36A0[7605]              		mov	al, [ss:THISDRV]
  7667 00003109 52                      		push	dx
  7668 0000310A B400                    		mov	ah, 0
  7669 0000310C 88C2                    		mov	dl, al
  7670 0000310E 09C9                    		or	cx, cx
  7671 00003110 750D                    		jnz	short do_update2
  7672 00003112 B403                    		mov	ah, 3
  7673 00003114 8B7C1B                  		mov	di, [si+1Bh]
  7674 00003117 8B4C1D                  		mov	cx, [si+1Dh]
  7675 0000311A 8A741F                  		mov	dh, [si+1Fh]
  7676 0000311D EB0E                    		jmp	short do_update
  7677                                  ; ---------------------------------------------------------------------------
  7678                                  
  7679                                  do_update2:				; ...
  7680 0000311F 363B0E[BE0F]            		cmp	cx, [ss:OLD_FIRSTCLUS]
  7681 00003124 7407                    		jz	short do_update
  7682 00003126 B402                    		mov	ah, 2
  7683 00003128 368B0E[BE0F]            		mov	cx, [ss:OLD_FIRSTCLUS]
  7684                                  
  7685                                  do_update:				; ...
  7686 0000312D 16                      		push	ss
  7687 0000312E 1F                      		pop	ds
  7688 0000312F E8BCF6                  		call	FastOpen_Update
  7689 00003132 5A                      		pop	dx
  7690 00003133 E81F2B                  		call	FLUSHBUF
  7691 00003136 5F                      		pop	di
  7692 00003137 07                      		pop	es
  7693 00003138 B005                    		mov	al, 5
  7694 0000313A 7201                    		jb	short CloseFinish
  7695                                  
  7696                                  FREE_SFT_OK:				; ...
  7697 0000313C F8                      		clc
  7698                                  
  7699                                  CloseFinish:				; ...
  7700 0000313D 9C                      		pushf
  7701 0000313E E85016                  		call	DEV_CLOSE_SFT
  7702 00003141 9D                      		popf
  7703 00003142 59                      		pop	cx
  7704 00003143 9C                      		pushf
  7705 00003144 49                      		dec	cx
  7706 00003145 7503                    		jnz	short NoFree
  7707 00003147 26890D                  		mov	[es:di], cx
  7708                                  
  7709                                  NoFree:					; ...
  7710 0000314A E82DE2                  		call	LCritDisk
  7711 0000314D 9D                      		popf
  7712 0000314E C3                      		retn
  7713                                  
  7714                                  ; =============== S U B	R O U T	I N E =======================================
  7715                                  
  7716                                  
  7717                                  FREE_SFT:
  7718 0000314F 9C                      		pushf
  7719 00003150 268B05                  		mov	ax, [es:di]
  7720 00003153 48                      		dec	ax
  7721 00003154 7501                    		jnz	short SetCount
  7722 00003156 48                      		dec	ax
  7723                                  
  7724                                  SetCount:				; ...
  7725 00003157 268705                  		xchg	ax, [es:di]
  7726 0000315A 9D                      		popf
  7727 0000315B C3                      		retn
  7728                                  
  7729                                  ; =============== S U B	R O U T	I N E =======================================
  7730                                  
  7731                                  
  7732                                  DirFromSFT:
  7733 0000315C C606[2303]02            		mov	byte [EXTERR_LOCUS], 2
  7734 00003161 06                      		push	es
  7735 00003162 57                      		push	di
  7736 00003163 268B551D                		mov	dx, [es:di+1Dh]
  7737 00003167 8916[0706]              		mov	word [HIGH_SECTOR], dx
  7738 0000316B 268B551B                		mov	dx, [es:di+1Bh]
  7739 0000316F FF36[0706]              		push	word [HIGH_SECTOR]
  7740 00003173 52                      		push	dx
  7741 00003174 E85C27                  		call	FATREAD_SFT
  7742 00003177 5A                      		pop	dx
  7743 00003178 8F06[0706]              		pop	word [HIGH_SECTOR]
  7744 0000317C 7225                    		jb	short PopDone
  7745 0000317E 30C0                    		xor	al, al
  7746 00003180 C606[4B03]18            		mov	byte [ALLOWED], 18h
  7747 00003185 E8CF29                  		call	GETBUFFR
  7748 00003188 7219                    		jb	short PopDone
  7749 0000318A 5E                      		pop	si
  7750 0000318B 1F                      		pop	ds
  7751 0000318C 36C43E[E205]            		les	di, [ss:CURBUF]
  7752 00003191 26804D0504              		or	byte [es:di+5], 4
  7753 00003196 89FB                    		mov	bx, di
  7754 00003198 8D7D14                  		lea	di, [di+14h]
  7755 0000319B B020                    		mov	al, 20h	; ' '
  7756 0000319D F6641F                  		mul	byte [si+1Fh]
  7757 000031A0 01C7                    		add	di, ax
  7758 000031A2 C3                      		retn
  7759                                  ; ---------------------------------------------------------------------------
  7760                                  
  7761                                  PopDone:				; ...
  7762 000031A3 5F                      		pop	di
  7763 000031A4 07                      		pop	es
  7764                                  
  7765                                  PopDone_retn:				; ...
  7766 000031A5 C3                      		retn
  7767                                  
  7768                                  ; =============== S U B	R O U T	I N E =======================================
  7769                                  
  7770                                  
  7771                                  DOS_COMMIT:
  7772 000031A6 C43E[9E05]              		les	di, [THISSFT]
  7773 000031AA 268B5D05                		mov	bx, [es:di+5]
  7774 000031AE F7C3C000                		test	bx, 0C0h
  7775 000031B2 75F1                    		jnz	short PopDone_retn
  7776 000031B4 F7C30080                		test	bx, 8000h
  7777 000031B8 7406                    		jz	short LOCAL_COMMIT
  7778 000031BA B80711                  		mov	ax, 1107h
  7779 000031BD CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - COMMIT REMOTE FILE
  7780                                  					; ES:DI	-> SFT
  7781                                  					; SFT DPB field	-> DPB of drive	containing file
  7782                                  					; Return: CF set on error, AX =	DOS error code
  7783                                  					; CF clear if successful
  7784 000031BF C3                      		retn
  7785                                  ; ---------------------------------------------------------------------------
  7786                                  
  7787                                  LOCAL_COMMIT:				; ...
  7788 000031C0 E897E1                  		call	ECritDisk
  7789 000031C3 E894E1                  		call	ECritDisk
  7790 000031C6 E80F00                  		call	SetSFTTimes
  7791 000031C9 B8FFFF                  		mov	ax, 0FFFFh
  7792 000031CC E8A5FE                  		call	CloseEntry
  7793 000031CF 9C                      		pushf
  7794 000031D0 E8B615                  		call	DEV_OPEN_SFT
  7795 000031D3 9D                      		popf
  7796 000031D4 E8A3E1                  		call	LCritDisk
  7797                                  
  7798                                  localcommit_retn:			; ...
  7799 000031D7 C3                      		retn
  7800                                  
  7801                                  ; =============== S U B	R O U T	I N E =======================================
  7802                                  
  7803                                  
  7804                                  SetSFTTimes:
  7805 000031D8 F7C3C000                		test	bx, 0C0h
  7806 000031DC 75F9                    		jnz	short localcommit_retn
  7807 000031DE F7C30040                		test	bx, 4000h
  7808 000031E2 75F3                    		jnz	short localcommit_retn
  7809 000031E4 50                      		push	ax
  7810 000031E5 53                      		push	bx
  7811 000031E6 E805D9                  		call	DATE16
  7812 000031E9 2689450F                		mov	[es:di+0Fh], ax
  7813 000031ED 2689550D                		mov	[es:di+0Dh], dx
  7814 000031F1 31C0                    		xor	ax, ax
  7815 000031F3 FF1E[C800]              		call	far [ShSU]
  7816 000031F7 5B                      		pop	bx
  7817 000031F8 58                      		pop	ax
  7818 000031F9 C3                      		retn
  7819                                  
  7820                                  ; ---------------------------------------------------------------------------
  7821                                  
  7822                                  DOS_MKDIR:				; ...
  7823 000031FA E898E0                  		call	TestNet
  7824 000031FD 7314                    		jnb	short LOCAL_MKDIR
  7825 000031FF B80311                  		mov	ax, 1103h
  7826 00003202 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - MAKE	REMOTE DIRECTORY
  7827                                  					; SS = DOS CS
  7828                                  					; SDA first filename pointer ->	fully-qualified	directory name
  7829                                  					; SDA CDS pointer -> current directory
  7830                                  					; Return: CF set on error, AX =	DOS error code
  7831                                  					; CF clear if successful
  7832 00003204 C3                      		retn
  7833                                  ; ---------------------------------------------------------------------------
  7834                                  ; START	OF FUNCTION CHUNK FOR DOS_RMDIR
  7835                                  
  7836                                  NODEACCERRJ:				; ...
  7837 00003205 B80500                  		mov	ax, 5
  7838                                  
  7839                                  _BadRet:				; ...
  7840 00003208 F9                      		stc
  7841 00003209 E86EE1                  		call	LCritDisk
  7842 0000320C C3                      		retn
  7843                                  ; END OF FUNCTION CHUNK	FOR DOS_RMDIR
  7844                                  ; ---------------------------------------------------------------------------
  7845                                  
  7846                                  PATHNFJ:				; ...
  7847 0000320D E86AE1                  		call	LCritDisk
  7848 00003210 E9CAF9                  		jmp	SET_MKND_ERR
  7849                                  ; ---------------------------------------------------------------------------
  7850                                  
  7851                                  LOCAL_MKDIR:				; ...
  7852 00003213 E844E1                  		call	ECritDisk
  7853 00003216 8C16[A005]              		mov	word [THISSFT+2], ss
  7854 0000321A C706[9E05][3E04]        		mov	word [THISSFT], RENBUF
  7855 00003220 C706[7104]0000          		mov	word [RENBUF+33h], 0 ; [RENBUF+SF_ENTRY.sf_MFT]
  7856 00003226 B010                    		mov	al, 10h
  7857 00003228 E81A19                  		call	MakeNode
  7858 0000322B 72E0                    		jb	short PATHNFJ
  7859 0000322D 83F803                  		cmp	ax, 3
  7860 00003230 74D3                    		jz	short NODEACCERRJ
  7861 00003232 C42E[8A05]              		les	bp, [THISDPB]
  7862 00003236 C53E[E205]              		lds	di, [CURBUF]
  7863 0000323A 29FE                    		sub	si, di
  7864 0000323C 56                      		push	si
  7865 0000323D FF7508                  		push	word [di+8]
  7866 00003240 FF7506                  		push	word [di+6]
  7867 00003243 16                      		push	ss
  7868 00003244 1F                      		pop	ds
  7869 00003245 FF36[C205]              		push	word [DIRSTART]
  7870 00003249 31C0                    		xor	ax, ax
  7871 0000324B A3[C205]                		mov	word [DIRSTART], ax
  7872 0000324E E82718                  		call	NEWDIR
  7873 00003251 7277                    		jb	short NODEEXISTSPOPDEL
  7874 00003253 E8B10D                  		call	GETENT
  7875 00003256 7272                    		jb	short NODEEXISTSPOPDEL
  7876 00003258 C43E[E205]              		les	di, [CURBUF]
  7877 0000325C 26F6450540              		test	byte [es:di+5], 40h
  7878 00003261 7508                    		jnz	short yesdirty5
  7879 00003263 E8FB2A                  		call	INC_DIRTY_COUNT
  7880 00003266 26804D0540              		or	byte [es:di+5], 40h
  7881                                  
  7882                                  yesdirty5:				; ...
  7883 0000326B 83C714                  		add	di, 20
  7884 0000326E B82E20                  		mov	ax, 202Eh
  7885 00003271 8B16[C205]              		mov	dx, [DIRSTART]
  7886 00003275 E8A918                  		call	SETDOTENT
  7887 00003278 B82E2E                  		mov	ax, 2E2Eh
  7888 0000327B 5A                      		pop	dx
  7889 0000327C E8A218                  		call	SETDOTENT
  7890 0000327F C42E[8A05]              		les	bp, [THISDPB]
  7891 00003283 C606[4B03]18            		mov	byte [ALLOWED], 18h
  7892 00003288 5A                      		pop	dx
  7893 00003289 8F06[0706]              		pop	word [HIGH_SECTOR]
  7894 0000328D 30C0                    		xor	al, al
  7895 0000328F E8C528                  		call	GETBUFFR
  7896 00003292 7263                    		jb	short NODEEXISTSP
  7897 00003294 8B16[C205]              		mov	dx, [DIRSTART]
  7898 00003298 C53E[E205]              		lds	di, [CURBUF]
  7899 0000329C 804D0504                		or	byte [di+5], 4
  7900 000032A0 5E                      		pop	si
  7901 000032A1 01FE                    		add	si, di
  7902 000032A3 8914                    		mov	[si], dx
  7903 000032A5 31D2                    		xor	dx, dx
  7904 000032A7 895402                  		mov	[si+2],	dx
  7905 000032AA 895404                  		mov	[si+4],	dx
  7906                                  
  7907                                  ; =============== S U B	R O U T	I N E =======================================
  7908                                  
  7909                                  
  7910                                  DIRUP	:
  7911 000032AD F6450540                		test	byte [di+5], 40h
  7912 000032B1 7507                    		jnz	short yesdirty6
  7913 000032B3 E8AB2A                  		call	INC_DIRTY_COUNT
  7914 000032B6 804D0540                		or	byte [di+5], 40h
  7915                                  
  7916                                  yesdirty6:				; ...
  7917 000032BA 16                      		push	ss
  7918 000032BB 1F                      		pop	ds
  7919 000032BC 268A4600                		mov	al, [es:bp+0]
  7920 000032C0 E89229                  		call	FLUSHBUF
  7921 000032C3 B80500                  		mov	ax, 5
  7922 000032C6 E8B1E0                  		call	LCritDisk
  7923 000032C9 C3                      		retn
  7924                                  
  7925                                  ; ---------------------------------------------------------------------------
  7926                                  
  7927                                  NODEEXISTSPOPDEL:			; ...
  7928 000032CA 5A                      		pop	dx
  7929 000032CB 5A                      		pop	dx
  7930 000032CC 8F06[0706]              		pop	word [HIGH_SECTOR]
  7931 000032D0 C42E[8A05]              		les	bp, [THISDPB]
  7932 000032D4 C606[4B03]18            		mov	byte [ALLOWED], 18h
  7933 000032D9 30C0                    		xor	al, al
  7934 000032DB E87928                  		call	GETBUFFR
  7935 000032DE 7217                    		jb	short NODEEXISTSP
  7936 000032E0 C53E[E205]              		lds	di, [CURBUF]
  7937 000032E4 804D0504                		or	byte [di+5], 4
  7938 000032E8 5E                      		pop	si
  7939 000032E9 01FE                    		add	si, di
  7940 000032EB 83EE1A                  		sub	si, 1Ah
  7941 000032EE C604E5                  		mov	byte [si], 0E5h
  7942 000032F1 E8B9FF                  		call	DIRUP
  7943                                  
  7944                                  NODEEXISTS:				; ...
  7945 000032F4 E90EFF                  		jmp	NODEACCERRJ
  7946                                  ; ---------------------------------------------------------------------------
  7947                                  
  7948                                  NODEEXISTSP:				; ...
  7949 000032F7 5E                      		pop	si
  7950 000032F8 EBFA                    		jmp	short NODEEXISTS
  7951                                  
  7952                                  ; =============== S U B	R O U T	I N E =======================================
  7953                                  
  7954                                  
  7955                                  DOS_CHDIR:
  7956 000032FA E898DF                  		call	TestNet
  7957 000032FD 7306                    		jnb	short LOCAL_CHDIR
  7958 000032FF B80511                  		mov	ax, 1105h
  7959 00003302 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - CHDIR
  7960                                  					; SS = DOS CS
  7961                                  					; SDA first filename pointer ->	fully-qualified	directory name
  7962                                  					; SDA CDS pointer -> current directory
  7963                                  					; Return: CF set on error, AX =	DOS error code
  7964                                  					; CF clear if successful
  7965 00003304 C3                      		retn
  7966                                  ; ---------------------------------------------------------------------------
  7967                                  
  7968                                  LOCAL_CHDIR:				; ...
  7969 00003305 E852E0                  		call	ECritDisk
  7970 00003308 26F745430020            		test	word [es:di+43h], 2000h
  7971 0000330E 7406                    		jz	short nojoin
  7972 00003310 26C74549FFFF            		mov	word [es:di+49h], 0FFFFh
  7973                                  
  7974                                  nojoin:					; ...
  7975 00003316 C606[4C03]00            		mov	byte [NoSetDir], 0
  7976 0000331B C606[6D05]16            		mov	byte [SATTRIB], 16h
  7977 00003320 800E[3A0D]01            		or	byte [FastOpenFlg],	1
  7978 00003325 E8740D                  		call	GETPATH
  7979 00003328 9C                      		pushf
  7980 00003329 8026[3A0D]80            		and	byte [FastOpenFlg],	80h
  7981 0000332E 9D                      		popf
  7982 0000332F B80300                  		mov	ax, 3
  7983 00003332 7207                    		jb	short ChDirDone
  7984 00003334 753B                    		jnz	short NOTDIRPATH
  7985 00003336 8B0E[C205]              		mov	cx, [DIRSTART]
  7986 0000333A F8                      		clc
  7987                                  
  7988                                  ChDirDone:				; ...
  7989 0000333B E83CE0                  		call	LCritDisk
  7990 0000333E C3                      		retn
  7991                                  
  7992                                  ; =============== S U B	R O U T	I N E =======================================
  7993                                  
  7994                                  
  7995                                  DOS_RMDIR:
  7996                                  
  7997                                  ; FUNCTION CHUNK AT 6FE5 SIZE 00000008 BYTES
  7998                                  
  7999 0000333F E853DF                  		call	TestNet
  8000 00003342 7306                    		jnb	short LOCAL_RMDIR
  8001 00003344 B80111                  		mov	ax, 1101h
  8002 00003347 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - REMOVE REMOTE DIRECTORY
  8003                                  					; SS = DOS CS
  8004                                  					; SDA first filename pointer ->	fully-qualified	directory name
  8005                                  					; SDA CDS pointer -> current directory
  8006                                  					; Return: CF set on error, AX =	DOS error code
  8007                                  					; CF clear if successful
  8008 00003349 C3                      		retn
  8009                                  ; ---------------------------------------------------------------------------
  8010                                  
  8011                                  LOCAL_RMDIR:				; ...
  8012 0000334A E80DE0                  		call	ECritDisk
  8013 0000334D C606[4C03]00            		mov	byte [NoSetDir], 0
  8014 00003352 C606[6D05]16            		mov	byte [SATTRIB], 16h
  8015 00003357 E8420D                  		call	GETPATH
  8016 0000335A 720C                    		jb	short NOPATH
  8017 0000335C 7513                    		jnz	short NOTDIRPATH
  8018 0000335E 8B3E[C205]              		mov	di, [DIRSTART]
  8019 00003362 09FF                    		or	di, di
  8020 00003364 750E                    		jnz	short rmdir_get_buf
  8021 00003366 EB09                    		jmp	short NOTDIRPATH
  8022                                  ; ---------------------------------------------------------------------------
  8023                                  
  8024                                  NOPATH:					; ...
  8025 00003368 B80300                  		mov	ax, 3
  8026 0000336B E99AFE                  		jmp	_BadRet
  8027                                  ; ---------------------------------------------------------------------------
  8028                                  
  8029                                  NOTDIRPATHPOP:				; ...
  8030 0000336E 58                      		pop	ax
  8031 0000336F 58                      		pop	ax
  8032                                  
  8033                                  NOTDIRPATHPOP2:				; ...
  8034 00003370 58                      		pop	ax
  8035                                  
  8036                                  NOTDIRPATH:				; ...
  8037 00003371 E991FE                  		jmp	NODEACCERRJ
  8038                                  ; ---------------------------------------------------------------------------
  8039                                  
  8040                                  rmdir_get_buf:				; ...
  8041 00003374 C53E[E205]              		lds	di, [CURBUF]
  8042 00003378 29FB                    		sub	bx, di
  8043 0000337A 53                      		push	bx
  8044 0000337B FF7508                  		push	word [di+8]
  8045 0000337E FF7506                  		push	word [di+6]
  8046 00003381 16                      		push	ss
  8047 00003382 1F                      		pop	ds
  8048 00003383 16                      		push	ss
  8049 00003384 07                      		pop	es
  8050 00003385 BF[4B05]                		mov	di, NAME1
  8051 00003388 B03F                    		mov	al, '?'
  8052 0000338A B90B00                  		mov	cx, 11
  8053 0000338D F3AA                    		rep stosb
  8054 0000338F 30C0                    		xor	al, al
  8055 00003391 AA                      		stosb
  8056 00003392 E8B20F                  		call	STARTSRCH
  8057 00003395 E86C0C                  		call	GETENTRY
  8058 00003398 72D4                    		jb	short NOTDIRPATHPOP
  8059 0000339A 8E1E[E405]              		mov	ds, word [CURBUF+2]
  8060 0000339E 89DE                    		mov	si, bx
  8061 000033A0 AD                      		lodsw
  8062 000033A1 3D2E20                  		cmp	ax, 202Eh
  8063 000033A4 75C8                    		jnz	short NOTDIRPATHPOP
  8064 000033A6 83C61E                  		add	si, 30
  8065 000033A9 AD                      		lodsw
  8066 000033AA 3D2E2E                  		cmp	ax, 2E2Eh
  8067 000033AD 75BF                    		jnz	short NOTDIRPATHPOP
  8068 000033AF 16                      		push	ss
  8069 000033B0 1F                      		pop	ds
  8070 000033B1 C706[4803]0200          		mov	word [LASTENT], 2
  8071 000033B7 E84A0C                  		call	GETENTRY
  8072 000033BA 72B2                    		jb	short NOTDIRPATHPOP
  8073 000033BC C606[6B05]16            		mov	byte [ATTRIB], 16h
  8074 000033C1 E83D0B                  		call	SRCH
  8075 000033C4 73A8                    		jnb	short NOTDIRPATHPOP
  8076 000033C6 803E[4A03]00            		cmp	byte [FAILERR], 0
  8077 000033CB 75A1                    		jnz	short NOTDIRPATHPOP
  8078 000033CD C42E[8A05]              		les	bp, [THISDPB]
  8079 000033D1 8B1E[C205]              		mov	bx, [DIRSTART]
  8080 000033D5 E8CE1C                  		call	RELEASE
  8081 000033D8 7294                    		jb	short NOTDIRPATHPOP
  8082 000033DA 5A                      		pop	dx
  8083 000033DB 8F06[0706]              		pop	word [HIGH_SECTOR]
  8084 000033DF C606[4B03]18            		mov	byte [ALLOWED], 18h
  8085 000033E4 30C0                    		xor	al, al
  8086 000033E6 E86E27                  		call	GETBUFFR
  8087 000033E9 7285                    		jb	short NOTDIRPATHPOP2
  8088 000033EB C53E[E205]              		lds	di, [CURBUF]
  8089 000033EF 804D0504                		or	byte [di+5], 4
  8090 000033F3 5B                      		pop	bx
  8091 000033F4 01FB                    		add	bx, di
  8092 000033F6 C607E5                  		mov	byte [bx], 0E5h
  8093 000033F9 1E                      		push	ds
  8094 000033FA 16                      		push	ss
  8095 000033FB 1F                      		pop	ds
  8096 000033FC E8C0F3                  		call	FastOpen_Delete
  8097 000033FF 1F                      		pop	ds
  8098 00003400 E9AAFE                  		jmp	DIRUP
  8099                                  
  8100                                  ; =============== S U B	R O U T	I N E =======================================
  8101                                  
  8102                                  
  8103                                  SWAPBACK:
  8104 00003403 C606[5703]00            		mov	byte [CONSWAP], 0
  8105 00003408 C3                      		retn
  8106                                  
  8107                                  ; =============== S U B	R O U T	I N E =======================================
  8108                                  
  8109                                  
  8110                                  SWAPCON	:
  8111 00003409 C606[5703]01            		mov	byte [CONSWAP], 1
  8112 0000340E 50                      		push	ax
  8113 0000340F A1[9E05]                		mov	ax, word [THISSFT]
  8114 00003412 A3[E605]                		mov	word [CONSFT], ax
  8115 00003415 A1[A005]                		mov	ax, word [THISSFT+2]
  8116 00003418 A3[E805]                		mov	word [CONSFT+2], ax
  8117 0000341B 58                      		pop	ax
  8118 0000341C C3                      		retn
  8119                                  
  8120                                  ; =============== S U B	R O U T	I N E =======================================
  8121                                  
  8122                                  
  8123                                  DOS_READ:
  8124 0000341D C43E[9E05]              		les	di, [THISSFT]
  8125 00003421 268A4502                		mov	al, [es:di+2]
  8126 00003425 240F                    		and	al, 0Fh
  8127 00003427 3C01                    		cmp	al, 1
  8128 00003429 7503                    		jnz	short READ_NO_MODE
  8129 0000342B E92206                  		jmp	SET_ACC_ERR
  8130                                  ; ---------------------------------------------------------------------------
  8131                                  
  8132                                  READ_NO_MODE:				; ...
  8133 0000342E E8FA04                  		call	SETUP
  8134 00003431 E30B                    		jcxz	NoIORet
  8135 00003433 E878DE                  		call	IsSFTNet
  8136 00003436 7408                    		jz	short LOCAL_READ
  8137 00003438 B80811                  		mov	ax, 1108h
  8138 0000343B CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - READ	FROM REMOTE FILE
  8139                                  					; ES:DI	-> SFT
  8140                                  					; SFT DPB field	-> DPB of drive	containing file
  8141                                  					; CX = number of bytes,	SS = DOS CS, SDA DTA field -> user buffer
  8142                                  					; Return: CF set on error, CX =	bytes read
  8143 0000343D C3                      		retn
  8144                                  ; ---------------------------------------------------------------------------
  8145                                  
  8146                                  NoIORet:				; ...
  8147 0000343E F8                      		clc
  8148 0000343F C3                      		retn
  8149                                  ; ---------------------------------------------------------------------------
  8150                                  
  8151                                  LOCAL_READ:				; ...
  8152 00003440 26F6450580              		test	byte [es:di+5], 80h
  8153 00003445 750F                    		jnz	short READDEV
  8154 00003447 C606[2303]02            		mov	byte [EXTERR_LOCUS], 2
  8155 0000344C E80BDF                  		call	ECritDisk
  8156 0000344F E8BA05                  		call	DISKREAD
  8157                                  
  8158                                  critexit:
  8159 00003452 E825DF                  		call	LCritDisk
  8160 00003455 C3                      		retn
  8161                                  ; ---------------------------------------------------------------------------
  8162                                  
  8163                                  READDEV:				; ...
  8164 00003456 C606[2303]04            		mov	byte [EXTERR_LOCUS], 4
  8165 0000345B 268A5D05                		mov	bl, [es:di+5]
  8166 0000345F C43E[2C03]              		les	di, [DMAADD]
  8167 00003463 F6C340                  		test	bl, 40h
  8168 00003466 7407                    		jz	short ENDRDDEVJ3
  8169 00003468 F6C304                  		test	bl, 4
  8170 0000346B 7405                    		jz	short TESTRAW
  8171 0000346D 30C0                    		xor	al, al
  8172                                  
  8173                                  ENDRDDEVJ3:				; ...
  8174 0000346F E9D600                  		jmp	ENDRDDEVJ2
  8175                                  ; ---------------------------------------------------------------------------
  8176                                  
  8177                                  TESTRAW:				; ...
  8178 00003472 F6C320                  		test	bl, 20h
  8179 00003475 7508                    		jnz	short DVRDRAW
  8180 00003477 F6C301                  		test	bl, 1
  8181 0000347A 7461                    		jz	short NOTRDCON
  8182 0000347C E99401                  		jmp	READCON
  8183                                  ; ---------------------------------------------------------------------------
  8184                                  
  8185                                  DVRDRAW:				; ...
  8186 0000347F 06                      		push	es
  8187 00003480 1F                      		pop	ds
  8188 00003481 36F606[3010]01          		test	byte [ss:IsWin386], 1
  8189 00003487 7408                    		jz	short ReadRawRetry
  8190 00003489 F6C301                  		test	bl, 1
  8191 0000348C 7403                    		jz	short ReadRawRetry
  8192 0000348E E9BA00                  		jmp	do_polling
  8193                                  ; ---------------------------------------------------------------------------
  8194                                  
  8195                                  ReadRawRetry:				; ...
  8196 00003491 89FB                    		mov	bx, di
  8197 00003493 31C0                    		xor	ax, ax
  8198 00003495 89C2                    		mov	dx, ax
  8199 00003497 E8EF13                  		call	SETREAD
  8200 0000349A 1E                      		push	ds
  8201 0000349B 36C536[9E05]            		lds	si, [ss:THISSFT]
  8202 000034A0 E86713                  		call	DEVIOCALL
  8203 000034A3 89FA                    		mov	dx, di
  8204 000034A5 B486                    		mov	ah, 86h
  8205 000034A7 368B3E[5D03]            		mov	di, [ss:DEVCALL_REQSTAT]
  8206 000034AC 09FF                    		or	di, di
  8207 000034AE 7923                    		jns	short CRDROK
  8208 000034B0 E81220                  		call	CHARHARD
  8209 000034B3 89D7                    		mov	di, dx
  8210 000034B5 36033E[6C03]            		add	di, word [ss:CALLBPB]
  8211 000034BA 362B0E[6C03]            		sub	cx, word [ss:CALLBPB]
  8212 000034BF 08C0                    		or	al, al
  8213 000034C1 7410                    		jz	short CRDROK
  8214 000034C3 3C03                    		cmp	al, 3
  8215 000034C5 7403                    		jz	short CRDFERR
  8216 000034C7 1F                      		pop	ds
  8217 000034C8 EBC7                    		jmp	short ReadRawRetry
  8218                                  ; ---------------------------------------------------------------------------
  8219                                  
  8220                                  CRDFERR:				; ...
  8221 000034CA 5F                      		pop	di
  8222                                  
  8223                                  DEVIOFERR:				; ...
  8224 000034CB 36C43E[9E05]            		les	di, [ss:THISSFT]
  8225 000034D0 E97B05                  		jmp	SET_ACC_ERR_DS
  8226                                  ; ---------------------------------------------------------------------------
  8227                                  
  8228                                  CRDROK:					; ...
  8229 000034D3 5F                      		pop	di
  8230 000034D4 89D7                    		mov	di, dx
  8231 000034D6 36033E[6C03]            		add	di, word [ss:CALLBPB]
  8232 000034DB EB92                    		jmp	short ENDRDDEVJ3
  8233                                  ; ---------------------------------------------------------------------------
  8234                                  
  8235                                  NOTRDCON:				; ...
  8236 000034DD 8CC0                    		mov	ax, es
  8237 000034DF 8ED8                    		mov	ds, ax
  8238 000034E1 89FB                    		mov	bx, di
  8239 000034E3 31D2                    		xor	dx, dx
  8240 000034E5 89D0                    		mov	ax, dx
  8241 000034E7 51                      		push	cx
  8242 000034E8 B90100                  		mov	cx, 1
  8243 000034EB E89B13                  		call	SETREAD
  8244 000034EE 59                      		pop	cx
  8245 000034EF 36C536[9E05]            		lds	si, [ss:THISSFT]
  8246 000034F4 C57407                  		lds	si, [si+7]
  8247                                  
  8248                                  DVRDLP:					; ...
  8249 000034F7 E8A61D                  		call	DSKSTATCHK
  8250 000034FA E81013                  		call	DEVIOCALL2
  8251 000034FD 57                      		push	di
  8252 000034FE B486                    		mov	ah, 86h
  8253 00003500 368B3E[5D03]            		mov	di, [ss:DEVCALL_REQSTAT]
  8254 00003505 09FF                    		or	di, di
  8255 00003507 7917                    		jns	short CRDOK
  8256 00003509 E8B91F                  		call	CHARHARD
  8257 0000350C 5F                      		pop	di
  8258 0000350D 36C706[6C03]0100        		mov	word [ss:CALLBPB], 1
  8259 00003514 3C01                    		cmp	al, 1
  8260 00003516 74DF                    		jz	short DVRDLP
  8261 00003518 3C03                    		cmp	al, 3
  8262 0000351A 74AF                    		jz	short DEVIOFERR
  8263 0000351C 30C0                    		xor	al, al
  8264 0000351E EB12                    		jmp	short DVRDIGN
  8265                                  ; ---------------------------------------------------------------------------
  8266                                  
  8267                                  CRDOK:					; ...
  8268 00003520 5F                      		pop	di
  8269 00003521 36833E[6C03]01          		cmp	word [ss:CALLBPB], 1 ; [SS:CALLSCNT]
  8270 00003527 751F                    		jnz	short ENDRDDEVJ2
  8271 00003529 1E                      		push	ds
  8272 0000352A 368E1E[6A03]            		mov	ds, word [ss:CALLBR+2] ; [SS:CALLXAD+2]
  8273 0000352F 8A05                    		mov	al, [di]
  8274 00003531 1F                      		pop	ds
  8275                                  
  8276                                  DVRDIGN:				; ...
  8277 00003532 36FF06[6803]            		inc	word [ss:CALLBR] ; [SS:CALLXAD]
  8278 00003537 36C706[5D03]0000        		mov	word [ss:DEVCALL_REQSTAT], 0
  8279 0000353E 47                      		inc	di
  8280 0000353F 3C1A                    		cmp	al, 1Ah
  8281 00003541 7405                    		jz	short ENDRDDEVJ2
  8282 00003543 3C0D                    		cmp	al, 0Dh
  8283 00003545 E0B0                    		loopne	DVRDLP
  8284 00003547 40                      		inc	ax
  8285                                  
  8286                                  ENDRDDEVJ2:				; ...
  8287 00003548 E9B300                  		jmp	ENDRDDEV
  8288                                  ; ---------------------------------------------------------------------------
  8289                                  
  8290                                  do_polling:				; ...
  8291 0000354B 89FB                    		mov	bx, di
  8292 0000354D 31C0                    		xor	ax, ax
  8293 0000354F 89C2                    		mov	dx, ax
  8294 00003551 E83513                  		call	SETREAD
  8295                                  
  8296                                  do_io:					; ...
  8297 00003554 26C6470205              		mov	byte [es:bx+2], 5
  8298 00003559 1E                      		push	ds
  8299 0000355A 36C536[9E05]            		lds	si, [ss:THISSFT]
  8300 0000355F E8A812                  		call	DEVIOCALL
  8301 00003562 1F                      		pop	ds
  8302 00003563 26F747030080            		test	word [es:bx+3], 8000h
  8303 00003569 7413                    		jz	short check_busy
  8304 0000356B 1E                      		push	ds
  8305 0000356C 89FA                    		mov	dx, di
  8306 0000356E E8541F                  		call	CHARHARD
  8307 00003571 89D7                    		mov	di, dx
  8308 00003573 08C0                    		or	al, al
  8309 00003575 745F                    		jz	short pop_done_read
  8310 00003577 3C03                    		cmp	al, 3
  8311 00003579 7449                    		jz	short devrderr
  8312 0000357B 1F                      		pop	ds
  8313 0000357C EBD6                    		jmp	short do_io
  8314                                  ; ---------------------------------------------------------------------------
  8315                                  
  8316                                  check_busy:				; ...
  8317 0000357E 26F747030002            		test	word [es:bx+3], 200h
  8318 00003584 7547                    		jnz	short no_char
  8319 00003586 26C6470204              		mov	byte [es:bx+2], 4
  8320 0000358B 26C747120100            		mov	word [es:bx+12h], 1
  8321 00003591 1E                      		push	ds
  8322 00003592 36C536[9E05]            		lds	si, [ss:THISSFT]
  8323 00003597 E87012                  		call	DEVIOCALL
  8324 0000359A 89FA                    		mov	dx, di
  8325 0000359C B486                    		mov	ah, 86h
  8326 0000359E 268B7F03                		mov	di, [es:bx+3]
  8327 000035A2 F7C70080                		test	di, 8000h
  8328 000035A6 7410                    		jz	short next_char
  8329 000035A8 E81A1F                  		call	CHARHARD
  8330 000035AB 89D7                    		mov	di, dx
  8331 000035AD 08C0                    		or	al, al
  8332 000035AF 7425                    		jz	short pop_done_read
  8333 000035B1 3C03                    		cmp	al, 3
  8334 000035B3 740F                    		jz	short devrderr
  8335 000035B5 1F                      		pop	ds
  8336 000035B6 EB9C                    		jmp	short do_io
  8337                                  ; ---------------------------------------------------------------------------
  8338                                  
  8339                                  next_char:				; ...
  8340 000035B8 1F                      		pop	ds
  8341 000035B9 89D7                    		mov	di, dx
  8342 000035BB 49                      		dec	cx
  8343 000035BC E319                    		jcxz	done_read
  8344 000035BE 26FF470E                		inc	word [es:bx+14]
  8345 000035C2 EB90                    		jmp	short do_io
  8346                                  ; ---------------------------------------------------------------------------
  8347                                  
  8348                                  devrderr:				; ...
  8349 000035C4 5F                      		pop	di
  8350 000035C5 36C43E[9E05]            		les	di, [ss:THISSFT]
  8351 000035CA E98104                  		jmp	SET_ACC_ERR_DS
  8352                                  ; ---------------------------------------------------------------------------
  8353                                  
  8354                                  no_char:				; ...
  8355 000035CD 50                      		push	ax
  8356 000035CE B484                    		mov	ah, 84h
  8357 000035D0 CD2A                    		int	2Ah		; Microsoft Networks - KEYBOARD	BUSY LOOP
  8358 000035D2 58                      		pop	ax
  8359 000035D3 E97EFF                  		jmp	do_io
  8360                                  ; ---------------------------------------------------------------------------
  8361                                  
  8362                                  pop_done_read:				; ...
  8363 000035D6 1F                      		pop	ds
  8364                                  
  8365                                  done_read:				; ...
  8366 000035D7 36033E[6C03]            		add	di, word [ss:CALLBPB]
  8367 000035DC E990FE                  		jmp	ENDRDDEVJ3
  8368                                  ; ---------------------------------------------------------------------------
  8369                                  
  8370                                  TRANBUF:				; ...
  8371 000035DF AC                      		lodsb
  8372 000035E0 AA                      		stosb
  8373 000035E1 3C0D                    		cmp	al, 0Dh
  8374 000035E3 7503                    		jnz	short NORMCH
  8375 000035E5 C6040A                  		mov	byte [si], 0Ah
  8376                                  
  8377                                  NORMCH:					; ...
  8378 000035E8 3C0A                    		cmp	al, 0Ah
  8379 000035EA E0F3                    		loopne	TRANBUF
  8380 000035EC 7507                    		jnz	short ENDRDCON
  8381 000035EE 31F6                    		xor	si, si
  8382 000035F0 E818E1                  		call	OUTT
  8383 000035F3 0C01                    		or	al, 1
  8384                                  
  8385                                  ENDRDCON:				; ...
  8386 000035F5 16                      		push	ss
  8387 000035F6 1F                      		pop	ds
  8388 000035F7 E809FE                  		call	SWAPBACK
  8389 000035FA 8936[2200]              		mov	[CONTPOS], si
  8390                                  
  8391                                  ENDRDDEV:				; ...
  8392 000035FE 16                      		push	ss
  8393 000035FF 1F                      		pop	ds
  8394 00003600 893E[B805]              		mov	[NEXTADD], di
  8395 00003604 7509                    		jnz	short SETSFTC
  8396 00003606 C43E[9E05]              		les	di, [THISSFT]
  8397 0000360A 26806505BF              		and	byte [es:di+5], 0BFh
  8398                                  
  8399                                  SETSFTC:				; ...
  8400 0000360F E8D004                  		call	SETSFT
  8401 00003612 C3                      		retn
  8402                                  ; ---------------------------------------------------------------------------
  8403                                  
  8404                                  READCON:				; ...
  8405 00003613 E8F3FD                  		call	SWAPCON
  8406 00003616 8B36[2200]              		mov	si, [CONTPOS]
  8407 0000361A 09F6                    		or	si, si
  8408 0000361C 75C1                    		jnz	short TRANBUF
  8409 0000361E 803E[7B02]80            		cmp	byte [CONBUF], 128
  8410 00003623 7406                    		jz	short GETBUF
  8411 00003625 C706[7B02]80FF          		mov	word [CONBUF], 0FF80h
  8412                                  
  8413                                  GETBUF:					; ...
  8414 0000362B 51                      		push	cx
  8415 0000362C 06                      		push	es
  8416 0000362D 57                      		push	di
  8417 0000362E BA[7B02]                		mov	dx, CONBUF
  8418 00003631 E80CDE                  		call	$STD_CON_STRING_INPUT
  8419 00003634 5F                      		pop	di
  8420 00003635 07                      		pop	es
  8421 00003636 59                      		pop	cx
  8422 00003637 BE[7D02]                		mov	si, CONBUF+2
  8423 0000363A 803C1A                  		cmp	byte [si], 1Ah
  8424 0000363D 75A0                    		jnz	short TRANBUF
  8425 0000363F B01A                    		mov	al, 1Ah
  8426 00003641 AA                      		stosb
  8427 00003642 4F                      		dec	di
  8428 00003643 B00A                    		mov	al, 0Ah
  8429 00003645 E8C3E0                  		call	OUTT
  8430 00003648 31F6                    		xor	si, si
  8431 0000364A EBA9                    		jmp	short ENDRDCON
  8432                                  
  8433                                  ; =============== S U B	R O U T	I N E =======================================
  8434                                  
  8435                                  
  8436                                  DOS_WRITE:
  8437 0000364C C43E[9E05]              		les	di, [THISSFT]
  8438 00003650 268A4502                		mov	al, [es:di+2]
  8439 00003654 240F                    		and	al, 0Fh
  8440 00003656 3C00                    		cmp	al, 0
  8441 00003658 7503                    		jnz	short Check_FCB_RO
  8442                                  
  8443                                  BadMode:				; ...
  8444 0000365A E9F303                  		jmp	SET_ACC_ERR
  8445                                  ; ---------------------------------------------------------------------------
  8446                                  
  8447                                  Check_FCB_RO:				; ...
  8448 0000365D 26F6450380              		test	byte [es:di+3], 80h
  8449 00003662 7407                    		jz	short WRITE_NO_MODE
  8450 00003664 26F6450401              		test	byte [es:di+4], 1
  8451 00003669 75EF                    		jnz	short BadMode
  8452                                  
  8453                                  WRITE_NO_MODE:				; ...
  8454 0000366B E8BD02                  		call	SETUP
  8455 0000366E E83DDC                  		call	IsSFTNet
  8456 00003671 7406                    		jz	short LOCAL_WRITE
  8457 00003673 B80911                  		mov	ax, 1109h
  8458 00003676 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - WRITE TO REMOTE FILE
  8459                                  					; ES:DI	-> SFT
  8460                                  					; SFT DPB field	-> DPB of drive	containing file
  8461                                  					; CX = number of bytes,	SS = DOS CS, SDA DTA field -> user buffer
  8462                                  					; Return: CF set on error, CX =	bytes written
  8463 00003678 C3                      		retn
  8464                                  ; ---------------------------------------------------------------------------
  8465                                  
  8466                                  LOCAL_WRITE:				; ...
  8467 00003679 26F6450580              		test	byte [es:di+5], 80h
  8468 0000367E 7570                    		jnz	short WRTDEV
  8469 00003680 C606[2303]02            		mov	byte [EXTERR_LOCUS], 2
  8470 00003685 E8D2DC                  		call	ECritDisk
  8471 00003688 E80F05                  		call	DISKWRITE
  8472 0000368B 7210                    		jb	short nocommit
  8473 0000368D C43E[9E05]              		les	di, [THISSFT]
  8474 00003691 26F6450340              		test	byte [es:di+3], 40h
  8475 00003696 7405                    		jz	short nocommit
  8476 00003698 51                      		push	cx
  8477 00003699 E80AFB                  		call	DOS_COMMIT
  8478 0000369C 59                      		pop	cx
  8479                                  
  8480                                  nocommit:				; ...
  8481 0000369D E8DADC                  		call	LCritDisk
  8482 000036A0 C3                      		retn
  8483                                  ; ---------------------------------------------------------------------------
  8484                                  
  8485                                  DVWRTRAW:				; ...
  8486 000036A1 31C0                    		xor	ax, ax
  8487 000036A3 E81612                  		call	SETWRITE
  8488 000036A6 1E                      		push	ds
  8489 000036A7 36C536[9E05]            		lds	si, [ss:THISSFT]
  8490 000036AC E85B11                  		call	DEVIOCALL
  8491 000036AF 89FA                    		mov	dx, di
  8492 000036B1 B487                    		mov	ah, 87h
  8493 000036B3 368B3E[5D03]            		mov	di, [ss:DEVCALL_REQSTAT]
  8494 000036B8 09FF                    		or	di, di
  8495 000036BA 7920                    		jns	short CWRTROK
  8496 000036BC E8061E                  		call	CHARHARD
  8497 000036BF 362B0E[6C03]            		sub	cx, word [ss:CALLBPB]	; [ss:CALLSCNT]
  8498 000036C4 89D3                    		mov	bx, dx
  8499 000036C6 36031E[6C03]            		add	bx, word [ss:CALLBPB]
  8500 000036CB 89DF                    		mov	di, bx
  8501 000036CD 08C0                    		or	al, al
  8502 000036CF 740B                    		jz	short CWRTROK
  8503 000036D1 3C03                    		cmp	al, 3
  8504 000036D3 7403                    		jz	short CWRFERR
  8505 000036D5 1F                      		pop	ds
  8506 000036D6 EBC9                    		jmp	short DVWRTRAW
  8507                                  ; ---------------------------------------------------------------------------
  8508                                  
  8509                                  CWRFERR:				; ...
  8510 000036D8 58                      		pop	ax
  8511 000036D9 E9EEFD                  		jmp	CRDFERR
  8512                                  ; ---------------------------------------------------------------------------
  8513                                  
  8514                                  CWRTROK:				; ...
  8515 000036DC 58                      		pop	ax
  8516 000036DD 1F                      		pop	ds
  8517 000036DE A1[6C03]                		mov	ax, word [CALLBPB]
  8518                                  
  8519                                  ENDWRDEV:				; ...
  8520 000036E1 C43E[9E05]              		les	di, [THISSFT]
  8521 000036E5 89C1                    		mov	cx, ax
  8522 000036E7 E81904                  		call	ADDREC
  8523 000036EA C3                      		retn
  8524                                  ; ---------------------------------------------------------------------------
  8525                                  
  8526                                  WRTNUL:					; ...
  8527 000036EB 89CA                    		mov	dx, cx
  8528                                  
  8529                                  WRTCOOKJ:				; ...
  8530 000036ED E98F00                  		jmp	WRTCOOKDONE
  8531                                  ; ---------------------------------------------------------------------------
  8532                                  
  8533                                  WRTDEV:					; ...
  8534 000036F0 C606[2303]04            		mov	byte [EXTERR_LOCUS], 4
  8535 000036F5 26804D0540              		or	byte [es:di+5], 40h
  8536 000036FA 268A5D05                		mov	bl, [es:di+5]
  8537 000036FE 31C0                    		xor	ax, ax
  8538 00003700 E3DF                    		jcxz	ENDWRDEV
  8539 00003702 1E                      		push	ds
  8540 00003703 88D8                    		mov	al, bl
  8541 00003705 C51E[2C03]              		lds	bx, [DMAADD]
  8542 00003709 89DF                    		mov	di, bx
  8543 0000370B 31D2                    		xor	dx, dx
  8544 0000370D A820                    		test	al, 20h
  8545 0000370F 7402                    		jz	short TEST_DEV_CON
  8546 00003711 EB8E                    		jmp	short DVWRTRAW
  8547                                  ; ---------------------------------------------------------------------------
  8548                                  
  8549                                  TEST_DEV_CON:				; ...
  8550 00003713 A802                    		test	al, 2
  8551 00003715 756E                    		jnz	short WRITECON
  8552 00003717 A804                    		test	al, 4
  8553 00003719 75D0                    		jnz	short WRTNUL
  8554 0000371B 89D0                    		mov	ax, dx
  8555 0000371D 803F1A                  		cmp	byte [bx], 1Ah
  8556 00003720 74CB                    		jz	short WRTCOOKJ
  8557 00003722 51                      		push	cx
  8558 00003723 B90100                  		mov	cx, 1
  8559 00003726 E89311                  		call	SETWRITE
  8560 00003729 59                      		pop	cx
  8561 0000372A 36C536[9E05]            		lds	si, [ss:THISSFT]
  8562 0000372F C57407                  		lds	si, [si+7]
  8563                                  
  8564                                  DVWRTLP:				; ...
  8565 00003732 E86B1B                  		call	DSKSTATCHK
  8566 00003735 E8D510                  		call	DEVIOCALL2
  8567 00003738 57                      		push	di
  8568 00003739 B487                    		mov	ah, 87h
  8569 0000373B 368B3E5D03              		mov	di, [ss:35Dh]
  8570 00003740 09FF                    		or	di, di
  8571 00003742 7916                    		jns	short CWROK
  8572 00003744 E87E1D                  		call	CHARHARD
  8573 00003747 5F                      		pop	di
  8574 00003748 36C706[6C03]0100        		mov	word [ss:CALLBPB], 1
  8575 0000374F 3C01                    		cmp	al, 1
  8576 00003751 74DF                    		jz	short DVWRTLP
  8577 00003753 08C0                    		or	al, al
  8578 00003755 740C                    		jz	short DVWRTIGN
  8579 00003757 E970FD                  		jmp	CRDFERR
  8580                                  ; ---------------------------------------------------------------------------
  8581                                  
  8582                                  CWROK:					; ...
  8583 0000375A 5F                      		pop	di
  8584 0000375B 36833E[6C03]00          		cmp	word [ss:CALLBPB], 0
  8585 00003761 741C                    		jz	short WRTCOOKDONE
  8586                                  
  8587                                  DVWRTIGN:				; ...
  8588 00003763 42                      		inc	dx
  8589 00003764 36FF06[6803]            		inc	word [ss:CALLBR]
  8590 00003769 47                      		inc	di
  8591 0000376A 1E                      		push	ds
  8592 0000376B 368E1E[6A03]            		mov	ds, word [ss:CALLBR+2]
  8593 00003770 803D1A                  		cmp	byte [di], 1Ah
  8594 00003773 1F                      		pop	ds
  8595 00003774 7409                    		jz	short WRTCOOKDONE
  8596 00003776 36C706[5D03]0000        		mov	word [ss:DEVCALL_REQSTAT], 0
  8597 0000377D E2B3                    		loop	DVWRTLP
  8598                                  
  8599                                  WRTCOOKDONE:				; ...
  8600 0000377F 89D0                    		mov	ax, dx
  8601 00003781 1F                      		pop	ds
  8602 00003782 E95CFF                  		jmp	ENDWRDEV
  8603                                  ; ---------------------------------------------------------------------------
  8604                                  
  8605                                  WRITECON:				; ...
  8606 00003785 1E                      		push	ds
  8607 00003786 16                      		push	ss
  8608 00003787 1F                      		pop	ds
  8609 00003788 E87EFC                  		call	SWAPCON
  8610 0000378B 1F                      		pop	ds
  8611 0000378C 89DE                    		mov	si, bx
  8612 0000378E 51                      		push	cx
  8613                                  
  8614                                  WRCONLP:				; ...
  8615 0000378F AC                      		lodsb
  8616 00003790 3C1A                    		cmp	al, 1Ah
  8617 00003792 7405                    		jz	short CONEOF
  8618 00003794 E874DF                  		call	OUTT
  8619 00003797 E2F6                    		loop	WRCONLP
  8620                                  
  8621                                  CONEOF:					; ...
  8622 00003799 58                      		pop	ax
  8623 0000379A 29C8                    		sub	ax, cx
  8624 0000379C 1F                      		pop	ds
  8625 0000379D E863FC                  		call	SWAPBACK
  8626 000037A0 E93EFF                  		jmp	ENDWRDEV
  8627                                  
  8628                                  ; =============== S U B	R O U T	I N E =======================================
  8629                                  
  8630                                  
  8631                                  GET_IO_SFT:
  8632 000037A3 36803E[5703]00          		cmp	byte [ss:CONSWAP], 0
  8633 000037A9 7512                    		jnz	short GetRedir
  8634                                  
  8635                                  GetNormal:				; ...
  8636 000037AB 16                      		push	ss
  8637 000037AC 1F                      		pop	ds
  8638 000037AD 06                      		push	es
  8639 000037AE 57                      		push	di
  8640 000037AF E8F830                  		call	SFFromHandle
  8641 000037B2 7206                    		jb	short RET44P
  8642 000037B4 8CC6                    		mov	si, es
  8643 000037B6 8EDE                    		mov	ds, si
  8644 000037B8 89FE                    		mov	si, di
  8645                                  
  8646                                  RET44P:					; ...
  8647 000037BA 5F                      		pop	di
  8648 000037BB 07                      		pop	es
  8649 000037BC C3                      		retn
  8650                                  ; ---------------------------------------------------------------------------
  8651                                  
  8652                                  GetRedir:				; ...
  8653 000037BD 83FB01                  		cmp	bx, 1
  8654 000037C0 77E9                    		ja	short GetNormal
  8655 000037C2 36C536[E605]            		lds	si, [ss:CONSFT]
  8656 000037C7 F8                      		clc
  8657                                  
  8658                                  get_io_sft_retn:			; ...
  8659 000037C8 C3                      		retn
  8660                                  
  8661                                  ; =============== S U B	R O U T	I N E =======================================
  8662                                  
  8663                                  
  8664                                  DIRREAD:
  8665 000037C9 31D2                    		xor	dx, dx
  8666 000037CB 833E[C205]00            		cmp	word [DIRSTART], 0
  8667 000037D0 7503                    		jnz	short SubDir
  8668 000037D2 92                      		xchg	ax, dx
  8669 000037D3 EB0C                    		jmp	short DoRead
  8670                                  ; ---------------------------------------------------------------------------
  8671                                  
  8672                                  SubDir:					; ...
  8673 000037D5 88C2                    		mov	dl, al
  8674 000037D7 26225604                		and	dl, [es:bp+4]
  8675 000037DB 268A4E05                		mov	cl, [es:bp+5]
  8676 000037DF D3E8                    		shr	ax, cl
  8677                                  
  8678                                  DoRead:					; ...
  8679 000037E1 8816[7305]              		mov	[SECCLUSPOS], dl
  8680 000037E5 89C1                    		mov	cx, ax
  8681 000037E7 88D4                    		mov	ah, dl
  8682 000037E9 8B16[C005]              		mov	dx, [DIRSEC+2]
  8683 000037ED 8916[0706]              		mov	word [HIGH_SECTOR], dx
  8684 000037F1 8B16[BE05]              		mov	dx, [DIRSEC]
  8685 000037F5 00E2                    		add	dl, ah
  8686 000037F7 80D600                  		adc	dh, 0
  8687 000037FA 8316[0706]00            		adc	word [HIGH_SECTOR], 0
  8688 000037FF 8B1E[BC05]              		mov	bx, [CLUSNUM]
  8689 00003803 891E[DC05]              		mov	[NXTCLUSNUM], bx
  8690 00003807 E319                    		jcxz	FIRSTCLUSTER
  8691                                  
  8692                                  SKPCLLP:				; ...
  8693 00003809 E8251F                  		call	UNPACK
  8694 0000380C 72BA                    		jb	short get_io_sft_retn
  8695 0000380E 87DF                    		xchg	bx, di
  8696 00003810 E8071F                  		call	IsEOF
  8697 00003813 7302                    		jnb	short HAVESKIPPED
  8698 00003815 E2F2                    		loop	SKPCLLP
  8699                                  
  8700                                  HAVESKIPPED:				; ...
  8701 00003817 891E[DC05]              		mov	[NXTCLUSNUM], bx
  8702 0000381B 89FA                    		mov	dx, di
  8703 0000381D 88E3                    		mov	bl, ah
  8704 0000381F E89417                  		call	FIGREC
  8705                                  
  8706                                  FIRSTCLUSTER:				; ...
  8707 00003822 C606[4B03]18            		mov	byte [ALLOWED], 18h
  8708 00003827 30C0                    		xor	al, al
  8709 00003829 E82B23                  		call	GETBUFFR
  8710 0000382C 729A                    		jb	short get_io_sft_retn
  8711                                  
  8712                                  SET_BUF_AS_DIR:				; ...
  8713 0000382E 1E                      		push	ds
  8714 0000382F 56                      		push	si
  8715 00003830 C536[E205]              		lds	si, [CURBUF]
  8716 00003834 804C0504                		or	byte [si+5], 4
  8717 00003838 5E                      		pop	si
  8718 00003839 1F                      		pop	ds
  8719                                  
  8720                                  dirread_retn:				; ...
  8721 0000383A C3                      		retn
  8722                                  
  8723                                  ; =============== S U B	R O U T	I N E =======================================
  8724                                  
  8725                                  
  8726                                  FATSECRD:
  8727                                  
  8728                                  ; FUNCTION CHUNK AT 7660 SIZE 00000002 BYTES
  8729                                  
  8730 0000383B 36C606[4B03]18          		mov	byte [ss:ALLOWED], 18h
  8731 00003841 89CF                    		mov	di, cx
  8732 00003843 268A4E08                		mov	cl, [es:bp+8]
  8733 00003847 268B460F                		mov	ax, [es:bp+0Fh]
  8734 0000384B 30ED                    		xor	ch, ch
  8735 0000384D 52                      		push	dx
  8736                                  
  8737                                  NXTFAT:					; ...
  8738 0000384E 36C706[0706]0000        		mov	word [ss:HIGH_SECTOR], 0
  8739 00003855 51                      		push	cx
  8740 00003856 50                      		push	ax
  8741 00003857 89F9                    		mov	cx, di
  8742 00003859 E85D00                  		call	DSKREAD
  8743 0000385C 58                      		pop	ax
  8744 0000385D 59                      		pop	cx
  8745 0000385E 7420                    		jz	short RET41P
  8746 00003860 01C2                    		add	dx, ax
  8747 00003862 E2EA                    		loop	NXTFAT
  8748 00003864 5A                      		pop	dx
  8749 00003865 89F9                    		mov	cx, di
  8750                                  
  8751                                  ; =============== S U B	R O U T	I N E =======================================
  8752                                  
  8753                                  
  8754                                  DREAD:
  8755 00003867 E84F00                  		call	DSKREAD
  8756 0000386A 74CE                    		jz	short dirread_retn
  8757 0000386C 36C606[7505]00          		mov	byte [ss:READOP], 0
  8758 00003872 E89C00                  		call	HARDERRRW
  8759 00003875 3C01                    		cmp	al, 1
  8760 00003877 74EE                    		jz	short DREAD
  8761 00003879 3C03                    		cmp	al, 3
  8762 0000387B F8                      		clc
  8763 0000387C 7501                    		jnz	short NO_CAR
  8764 0000387E F9                      		stc
  8765                                  
  8766                                  NO_CAR:					; ...
  8767 0000387F C3                      		retn
  8768                                  
  8769                                  ; ---------------------------------------------------------------------------
  8770                                  ; START	OF FUNCTION CHUNK FOR FATSECRD
  8771                                  
  8772                                  RET41P:					; ...
  8773 00003880 5A                      		pop	dx
  8774 00003881 C3                      		retn
  8775                                  ; END OF FUNCTION CHUNK	FOR FATSECRD
  8776                                  
  8777                                  ; =============== S U B	R O U T	I N E =======================================
  8778                                  
  8779                                  
  8780                                  CHECK_WRITE_LOCK:
  8781 00003882 26F6450408              		test	byte [es:di+4], 8
  8782 00003887 7404                    		jz	short write_cont
  8783 00003889 E8C201                  		call	SET_ACC_ERR_DS
  8784 0000388C C3                      		retn
  8785                                  ; ---------------------------------------------------------------------------
  8786                                  
  8787                                  write_cont:				; ...
  8788 0000388D 51                      		push	cx
  8789 0000388E 09C9                    		or	cx, cx
  8790 00003890 7501                    		jnz	short Not_Truncate
  8791 00003892 49                      		dec	cx
  8792                                  
  8793                                  Not_Truncate:				; ...
  8794 00003893 B080                    		mov	al, 80h	
  8795 00003895 E8CA3C                  		call	LOCK_CHECK
  8796 00003898 59                      		pop	cx
  8797 00003899 7305                    		jnb	short WRITE_OK
  8798 0000389B E86701                  		call	WRITE_LOCK_VIOLATION
  8799 0000389E 73ED                    		jnb	short write_cont
  8800                                  
  8801                                  WRITE_OK:				; ...
  8802 000038A0 C3                      		retn
  8803                                  
  8804                                  ; =============== S U B	R O U T	I N E =======================================
  8805                                  
  8806                                  
  8807                                  CHECK_READ_LOCK:
  8808 000038A1 26F6450408              		test	byte [es:di+4], 8
  8809 000038A6 7404                    		jz	short do_retry
  8810 000038A8 E8A501                  		call	SET_ACC_ERR
  8811 000038AB C3                      		retn
  8812                                  ; ---------------------------------------------------------------------------
  8813                                  
  8814                                  do_retry:				; ...
  8815 000038AC 30C0                    		xor	al, al
  8816 000038AE E8B13C                  		call	LOCK_CHECK
  8817 000038B1 7305                    		jnb	short READLOCK_OK
  8818 000038B3 E82901                  		call	READ_LOCK_VIOLATION
  8819 000038B6 73F4                    		jnb	short do_retry
  8820                                  
  8821                                  READLOCK_OK:				; ...
  8822 000038B8 C3                      		retn
  8823                                  
  8824                                  ; =============== S U B	R O U T	I N E =======================================
  8825                                  
  8826                                  
  8827                                  DSKREAD	:
  8828 000038B9 51                      		push	cx
  8829 000038BA 268A6617                		mov	ah, [es:bp+17h]
  8830 000038BE 268A4601                		mov	al, [es:bp+1]
  8831 000038C2 53                      		push	bx
  8832 000038C3 06                      		push	es
  8833 000038C4 E8C20F                  		call	SETREAD
  8834 000038C7 EB27                    		jmp	short DODSKOP
  8835                                  
  8836                                  ; =============== S U B	R O U T	I N E =======================================
  8837                                  
  8838                                  
  8839                                  DWRITE	:
  8840 000038C9 E81600                  		call	DSKWRITE
  8841 000038CC 7413                    		jz	short dw_ret_label
  8842 000038CE 36C606[7505]01          		mov	byte [ss:READOP], 1
  8843 000038D4 E83A00                  		call	HARDERRRW
  8844 000038D7 3C01                    		cmp	al, 1
  8845 000038D9 74EE                    		jz	short DWRITE
  8846 000038DB 3C03                    		cmp	al, 3
  8847 000038DD F8                      		clc
  8848 000038DE 7501                    		jnz	short dw_ret_label
  8849 000038E0 F9                      		stc
  8850                                  
  8851                                  dw_ret_label:				; ...
  8852 000038E1 C3                      		retn
  8853                                  
  8854                                  ; =============== S U B	R O U T	I N E =======================================
  8855                                  
  8856                                  
  8857                                  DSKWRITE:
  8858 000038E2 51                      		push	cx
  8859 000038E3 268A6617                		mov	ah, [es:bp+17h]
  8860 000038E7 268A4601                		mov	al, [es:bp+1]
  8861 000038EB 53                      		push	bx
  8862 000038EC 06                      		push	es
  8863 000038ED E8CC0F                  		call	SETWRITE
  8864                                  
  8865                                  DODSKOP:				; ...
  8866 000038F0 8CD9                    		mov	cx, ds
  8867 000038F2 1F                      		pop	ds
  8868 000038F3 1E                      		push	ds
  8869 000038F4 3EC57613                		lds	si, [ds:bp+13h]	; 27/09/2023
  8870 000038F8 E8120F                  		call	DEVIOCALL2
  8871 000038FB 8ED9                    		mov	ds, cx
  8872 000038FD 07                      		pop	es
  8873 000038FE 5B                      		pop	bx
  8874 000038FF 368B0E[6C03]            		mov	cx, word [ss:CALLBPB]
  8875 00003904 5F                      		pop	di
  8876 00003905 29F9                    		sub	cx, di
  8877 00003907 F7D9                    		neg	cx
  8878 00003909 36A1[5D03]              		mov	ax, [ss:DEVCALL_REQSTAT]
  8879 0000390D A90080                  		test	ax, 8000h
  8880 00003910 C3                      		retn
  8881                                  
  8882                                  ; =============== S U B	R O U T	I N E =======================================
  8883                                  
  8884                                  
  8885                                  HARDERRRW:
  8886 00003911 3C0F                    		cmp	al, 0Fh
  8887 00003913 7512                    		jnz	short DO_ERR
  8888 00003915 50                      		push	ax
  8889 00003916 36A1[7003]              		mov	ax, word [ss:CALLVIDRW]
  8890 0000391A 36A3[2803]              		mov	word [ss:EXTERRPT], ax
  8891 0000391E 36A1[7203]              		mov	ax, word [ss:CALLVIDRW+2]
  8892 00003922 36A3[2A03]              		mov	word [ss:EXTERRPT+2], ax
  8893 00003926 58                      		pop	ax
  8894                                  
  8895                                  DO_ERR:					; ...
  8896 00003927 E8CC1B                  		call	HARDERR
  8897 0000392A C3                      		retn
  8898                                  
  8899                                  ; =============== S U B	R O U T	I N E =======================================
  8900                                  
  8901                                  
  8902                                  SETUP:
  8903 0000392B 26C57507                		lds	si, [es:di+7]
  8904 0000392F 368C1E[8C05]            		mov	word [ss:THISDPB+2], ds
  8905 00003934 16                      		push	ss
  8906 00003935 1F                      		pop	ds
  8907 00003936 8936[8A05]              		mov	word [THISDPB], si
  8908 0000393A 8B1E[2C03]              		mov	bx, word [DMAADD]
  8909 0000393E 891E[B805]              		mov	[NEXTADD], bx
  8910 00003942 C606[7405]00            		mov	byte [TRANS], 0
  8911 00003947 268B4515                		mov	ax, [es:di+15h]
  8912 0000394B 268B5517                		mov	dx, [es:di+17h]
  8913 0000394F 8916[D005]              		mov	[BYTPOS+2], dx
  8914 00003953 A3[CE05]                		mov	[BYTPOS], ax
  8915 00003956 26F745058080            		test	word [es:di+5], 8080h
  8916 0000395C 753C                    		jnz	short NOSETSTUFF
  8917 0000395E 06                      		push	es
  8918 0000395F C42E[8A05]              		les	bp, [THISDPB]
  8919 00003963 268A5E00                		mov	bl, [es:bp+0]
  8920 00003967 881E[7605]              		mov	[THISDRV], bl
  8921 0000396B 268B5E02                		mov	bx, [es:bp+2]
  8922 0000396F 51                      		push	cx
  8923 00003970 E84105                  		call	DIV32
  8924 00003973 8916[CC05]              		mov	word [BYTSECPOS], dx
  8925 00003977 A3[C405]                		mov	[SECPOS], ax
  8926 0000397A 890E[C605]              		mov	word [SECPOS+2], cx
  8927 0000397E 89CA                    		mov	dx, cx
  8928 00003980 89C3                    		mov	bx, ax
  8929 00003982 26225E04                		and	bl, [es:bp+4]
  8930 00003986 881E[7305]              		mov	[SECCLUSPOS], bl
  8931 0000398A E84E05                  		call	SHR32
  8932 0000398D 59                      		pop	cx
  8933 0000398E 751F                    		jnz	short EOFERR
  8934 00003990 263B460D                		cmp	ax, [es:bp+0Dh]
  8935 00003994 7719                    		ja	short EOFERR
  8936 00003996 A3[BC05]                		mov	[CLUSNUM], ax
  8937 00003999 07                      		pop	es
  8938                                  
  8939                                  NOSETSTUFF:				; ...
  8940 0000399A 89C8                    		mov	ax, cx
  8941 0000399C 0306[2C03]              		add	ax, word [DMAADD]
  8942 000039A0 730C                    		jnb	short setup_OK
  8943 000039A2 A1[2C03]                		mov	ax, word [DMAADD]
  8944 000039A5 F7D8                    		neg	ax
  8945 000039A7 7501                    		jnz	short NoDec
  8946 000039A9 48                      		dec	ax
  8947                                  
  8948                                  NoDec:					; ...
  8949 000039AA 89C1                    		mov	cx, ax
  8950 000039AC E304                    		jcxz	NOROOM
  8951                                  
  8952                                  setup_OK:				; ...
  8953 000039AE C3                      		retn
  8954                                  ; ---------------------------------------------------------------------------
  8955                                  
  8956                                  EOFERR:					; ...
  8957 000039AF 07                      		pop	es
  8958 000039B0 31C9                    		xor	cx, cx
  8959                                  
  8960                                  NOROOM:					; ...
  8961 000039B2 5B                      		pop	bx
  8962 000039B3 F8                      		clc
  8963 000039B4 C3                      		retn
  8964                                  
  8965                                  ; =============== S U B	R O U T	I N E =======================================
  8966                                  
  8967                                  
  8968                                  BREAKDOWN:
  8969 000039B5 A1[CC05]                		mov	ax, [BYTSECPOS]
  8970 000039B8 89CB                    		mov	bx, cx
  8971 000039BA 09C0                    		or	ax, ax
  8972 000039BC 740E                    		jz	short SAVFIR
  8973 000039BE 262B4602                		sub	ax, [es:bp+2]
  8974 000039C2 F7D8                    		neg	ax
  8975 000039C4 29C3                    		sub	bx, ax
  8976 000039C6 7304                    		jnb	short SAVFIR
  8977 000039C8 01D8                    		add	ax, bx
  8978 000039CA 31DB                    		xor	bx, bx
  8979                                  
  8980                                  SAVFIR:					; ...
  8981 000039CC A3[D205]                		mov	word [BYTCNT1], ax
  8982 000039CF 89D8                    		mov	ax, bx
  8983 000039D1 31D2                    		xor	dx, dx
  8984 000039D3 26F77602                		div	word [es:bp+2]
  8985 000039D7 A3[D605]                		mov	word [SECCNT], ax
  8986 000039DA 8916[D405]              		mov	[BYTCNT2], dx
  8987                                  
  8988                                  _RET45:					; ...
  8989 000039DE C3                      		retn
  8990                                  
  8991                                  ; =============== S U B	R O U T	I N E =======================================
  8992                                  
  8993                                  
  8994                                  READ_LOCK_VIOLATION:
  8995 000039DF C606[7505]00            		mov	byte [READOP], 0
  8996                                  
  8997                                  ERR_ON_CHECK:				; ...
  8998 000039E4 26F6450380              		test	byte [es:di+3], 80h
  8999 000039E9 750E                    		jnz	short HARD_ERR
  9000 000039EB 51                      		push	cx
  9001 000039EC 268A4D02                		mov	cl, [es:di+2]
  9002 000039F0 80E1F0                  		and	cl, 0F0h
  9003 000039F3 80F900                  		cmp	cl, 0
  9004 000039F6 59                      		pop	cx
  9005 000039F7 7505                    		jnz	short NO_HARD_ERR
  9006                                  
  9007                                  HARD_ERR:				; ...
  9008 000039F9 E87C3B                  		call	LOCK_VIOLATION
  9009 000039FC 73E0                    		jnb	short _RET45
  9010                                  
  9011                                  NO_HARD_ERR:				; ...
  9012 000039FE 31C9                    		xor	cx, cx
  9013 00003A00 B82100                  		mov	ax, 21h
  9014 00003A03 F9                      		stc
  9015 00003A04 C3                      		retn
  9016                                  
  9017                                  
  9018                                  ; =============== S U B	R O U T	I N E =======================================
  9019                                  
  9020                                  
  9021                                  WRITE_LOCK_VIOLATION:
  9022 00003A05 C606[7505]01            		mov	byte [READOP], 1
  9023 00003A0A EBD8                    		jmp	short ERR_ON_CHECK
  9024                                  
  9025                                  
  9026                                  ; =============== S U B	R O U T	I N E =======================================
  9027                                  
  9028                                  
  9029                                  DISKREAD:
  9030                                  
  9031                                  ; FUNCTION CHUNK AT 782C SIZE 00000002 BYTES
  9032                                  ; FUNCTION CHUNK AT 7837 SIZE 0000008B BYTES
  9033                                  ; FUNCTION CHUNK AT 7A4E SIZE 0000000B BYTES
  9034                                  
  9035 00003A0C 268B4511                		mov	ax, [es:di+11h]
  9036 00003A10 268B5D13                		mov	bx, [es:di+13h]
  9037 00003A14 2B06[CE05]              		sub	ax, [BYTPOS]
  9038 00003A18 1B1E[D005]              		sbb	bx, [BYTPOS+2]
  9039 00003A1C 7226                    		jb	short RDERR
  9040 00003A1E 750A                    		jnz	short ENUF
  9041 00003A20 09C0                    		or	ax, ax
  9042 00003A22 7420                    		jz	short RDERR
  9043 00003A24 39C8                    		cmp	ax, cx
  9044 00003A26 7302                    		jnb	short ENUF
  9045 00003A28 89C1                    		mov	cx, ax
  9046                                  
  9047                                  ENUF:					; ...
  9048 00003A2A E874FE                  		call	CHECK_READ_LOCK
  9049 00003A2D 7301                    		jnb	short _READ_OK
  9050 00003A2F C3                      		retn
  9051                                  ; ---------------------------------------------------------------------------
  9052                                  
  9053                                  _READ_OK:				; ...
  9054 00003A30 C42E[8A05]              		les	bp, [THISDPB]
  9055 00003A34 E87EFF                  		call	BREAKDOWN
  9056 00003A37 8B0E[BC05]              		mov	cx, [CLUSNUM]
  9057 00003A3B E8D413                  		call	FNDCLUS
  9058 00003A3E 720E                    		jb	short SET_ACC_ERR_DS
  9059 00003A40 09C9                    		or	cx, cx
  9060 00003A42 7413                    		jz	short SKIPERR
  9061                                  
  9062                                  RDERR:					; ...
  9063 00003A44 B40E                    		mov	ah, 0Eh
  9064 00003A46 E92502                  		jmp	WRTERR22
  9065                                  
  9066                                  ; =============== S U B	R O U T	I N E =======================================
  9067                                  
  9068                                  ; Attributes: thunk
  9069                                  
  9070                                  SETSFTJ2:
  9071 00003A49 E99600                  		jmp	SETSFT
  9072                                  
  9073                                  ; ---------------------------------------------------------------------------
  9074                                  ; START	OF FUNCTION CHUNK FOR DISKREAD
  9075                                  
  9076                                  CANOT_READ:				; ...
  9077 00003A4C 59                      		pop	cx
  9078 00003A4D 5B                      		pop	bx
  9079                                  ; END OF FUNCTION CHUNK	FOR DISKREAD
  9080                                  
  9081                                  ; =============== S U B	R O U T	I N E =======================================
  9082                                  
  9083                                  
  9084                                  SET_ACC_ERR_DS:
  9085 00003A4E 16                      		push	ss
  9086 00003A4F 1F                      		pop	ds
  9087                                  
  9088                                  ; =============== S U B	R O U T	I N E =======================================
  9089                                  
  9090                                  
  9091                                  SET_ACC_ERR:
  9092 00003A50 31C9                    		xor	cx, cx
  9093 00003A52 B80500                  		mov	ax, 5
  9094 00003A55 F9                      		stc
  9095 00003A56 C3                      		retn
  9096                                  
  9097                                  ; ---------------------------------------------------------------------------
  9098                                  ; START	OF FUNCTION CHUNK FOR DISKREAD
  9099                                  
  9100                                  SKIPERR:				; ...
  9101 00003A57 8916[BA05]              		mov	word [LASTPOS], dx
  9102 00003A5B 891E[BC05]              		mov	[CLUSNUM], bx
  9103 00003A5F 833E[D205]00            		cmp	word [BYTCNT1], 0
  9104 00003A64 7405                    		jz	short RDMID
  9105 00003A66 E81F14                  		call	BUFRD
  9106 00003A69 72E3                    		jb	short SET_ACC_ERR_DS
  9107                                  
  9108                                  RDMID:					; ...
  9109 00003A6B 833E[D605]00            		cmp	word [SECCNT], 0
  9110 00003A70 7453                    		jz	short RDLAST
  9111 00003A72 E8B014                  		call	NEXTSEC
  9112 00003A75 72D2                    		jb	short SETSFTJ2
  9113 00003A77 C606[7405]01            		mov	byte [TRANS], 1
  9114 00003A7C 8A16[7305]              		mov	dl, [SECCLUSPOS]
  9115 00003A80 8B0E[D605]              		mov	cx, [SECCNT]
  9116 00003A84 8B1E[BC05]              		mov	bx, [CLUSNUM]
  9117                                  
  9118                                  RDLP:					; ...
  9119 00003A88 E8CB14                  		call	OPTIMIZE
  9120 00003A8B 72C1                    		jb	short SET_ACC_ERR_DS
  9121 00003A8D 57                      		push	di
  9122 00003A8E 50                      		push	ax
  9123 00003A8F 53                      		push	bx
  9124 00003A90 C606[4B03]38            		mov	byte [ALLOWED], 38h
  9125 00003A95 8E1E[2E03]              		mov	ds, word [DMAADD+2]
  9126 00003A99 52                      		push	dx
  9127 00003A9A 51                      		push	cx
  9128 00003A9B E8B022                  		call	SET_RQ_SC_PARMS
  9129 00003A9E E8C6FD                  		call	DREAD
  9130 00003AA1 59                      		pop	cx
  9131 00003AA2 5A                      		pop	dx
  9132 00003AA3 368F06[0C06]            		pop	word [ss:TEMP_VAR]
  9133 00003AA8 72A2                    		jb	short CANOT_READ
  9134 00003AAA 368C1E[0E06]            		mov	[ss:TEMP_VAR2], ds
  9135 00003AAF E85E00                  		call	DskRdBufScan
  9136 00003AB2 16                      		push	ss
  9137 00003AB3 1F                      		pop	ds
  9138 00003AB4 59                      		pop	cx
  9139 00003AB5 5B                      		pop	bx
  9140 00003AB6 E30D                    		jcxz	RDLAST
  9141 00003AB8 E85F1C                  		call	IsEOF
  9142 00003ABB 7325                    		jnb	short SETSFT
  9143 00003ABD B200                    		mov	dl, 0
  9144 00003ABF FF06[BA05]              		inc	word [LASTPOS]
  9145 00003AC3 EBC3                    		jmp	short RDLP
  9146                                  ; ---------------------------------------------------------------------------
  9147                                  
  9148                                  RDLAST:					; ...
  9149 00003AC5 A1[D405]                		mov	ax, [BYTCNT2]
  9150 00003AC8 09C0                    		or	ax, ax
  9151 00003ACA 7416                    		jz	short SETSFT
  9152 00003ACC A3[D205]                		mov	word [BYTCNT1], ax
  9153 00003ACF E85314                  		call	NEXTSEC
  9154 00003AD2 720E                    		jb	short SETSFT
  9155 00003AD4 C706[CC05]0000          		mov	word [BYTSECPOS], 0
  9156 00003ADA E8AB13                  		call	BUFRD
  9157 00003ADD 7303                    		jnb	short SETSFT
  9158 00003ADF E96CFF                  		jmp	SET_ACC_ERR_DS
  9159                                  ; END OF FUNCTION CHUNK	FOR DISKREAD
  9160                                  
  9161                                  ; =============== S U B	R O U T	I N E =======================================
  9162                                  
  9163                                  
  9164                                  SETSFT:
  9165 00003AE2 C43E[9E05]              		les	di, [THISSFT]
  9166                                  
  9167                                  SETCLUS:				; ...
  9168 00003AE6 8B0E[B805]              		mov	cx, [NEXTADD]
  9169 00003AEA 2B0E[2C03]              		sub	cx, word [DMAADD]
  9170 00003AEE 26F6450580              		test	byte [es:di+5], 80h
  9171 00003AF3 750E                    		jnz	short ADDREC
  9172 00003AF5 A1[BC05]                		mov	ax, [CLUSNUM]
  9173 00003AF8 26894535                		mov	[es:di+35h], ax
  9174 00003AFC A1[BA05]                		mov	ax, [LASTPOS]
  9175 00003AFF 26894519                		mov	[es:di+19h], ax
  9176                                  
  9177                                  ; =============== S U B	R O U T	I N E =======================================
  9178                                  
  9179                                  
  9180                                  ADDREC:
  9181 00003B03 E309                    		jcxz	RET28
  9182 00003B05 26014D15                		add	[es:di+15h], cx
  9183 00003B09 2683551700              		adc	word [es:di+17h], 0
  9184                                  
  9185                                  RET28:					; ...
  9186 00003B0E F8                      		clc
  9187 00003B0F C3                      		retn
  9188                                  
  9189                                  ; =============== S U B	R O U T	I N E =======================================
  9190                                  
  9191                                  
  9192                                  DskRdBufScan:
  9193 00003B10 36833E[7100]00          		cmp	word [ss:DirtyBufferCount], 0
  9194 00003B16 743C                    		jz	short bufx
  9195 00003B18 368B1E[0706]            		mov	bx, [ss:HIGH_SECTOR]
  9196 00003B1D 89DE                    		mov	si, bx
  9197 00003B1F 01D1                    		add	cx, dx
  9198 00003B21 83D600                  		adc	si, 0
  9199 00003B24 E8CB1F                  		call	GETCURHEAD
  9200 00003B27 8B4502                  		mov	ax, [di+2]
  9201 00003B2A 36A3[BB0E]              		mov	[ss:FIRST_BUFF_ADDR], ax
  9202 00003B2E 268A4600                		mov	al, [es:bp+0]
  9203                                  
  9204                                  bufq:					; ...
  9205 00003B32 3A4504                  		cmp	al, [di+4]
  9206 00003B35 7514                    		jnz	short bufq1
  9207 00003B37 3B5D08                  		cmp	bx, [di+8]
  9208 00003B3A 7503                    		jnz	short bufq01
  9209 00003B3C 3B5506                  		cmp	dx, [di+6]
  9210                                  
  9211                                  bufq01:					; ...
  9212 00003B3F 770A                    		ja	short bufq1
  9213 00003B41 3B7508                  		cmp	si, [di+8]
  9214 00003B44 7503                    		jnz	short bufq02
  9215 00003B46 3B4D06                  		cmp	cx, [di+6]
  9216                                  
  9217                                  bufq02:					; ...
  9218 00003B49 770A                    		ja	short bufq2
  9219                                  
  9220                                  bufq1:					; ...
  9221 00003B4B 363B3E[BB0E]            		cmp	di, [ss:FIRST_BUFF_ADDR]
  9222 00003B50 8B3D                    		mov	di, [di]
  9223 00003B52 75DE                    		jnz	short bufq
  9224                                  
  9225                                  bufx:					; ...
  9226 00003B54 C3                      		retn
  9227                                  ; ---------------------------------------------------------------------------
  9228                                  
  9229                                  bufq2:					; ...
  9230 00003B55 50                      		push	ax
  9231 00003B56 F6450540                		test	byte [di+5], 40h
  9232 00003B5A 742F                    		jz	short bufq3
  9233 00003B5C 51                      		push	cx
  9234 00003B5D 52                      		push	dx
  9235 00003B5E 56                      		push	si
  9236 00003B5F 57                      		push	di
  9237 00003B60 06                      		push	es
  9238 00003B61 89D0                    		mov	ax, dx
  9239 00003B63 2B4506                  		sub	ax, [di+6]
  9240 00003B66 F7D8                    		neg	ax
  9241 00003B68 8D7514                  		lea	si, [di+20]
  9242 00003B6B 268B4E02                		mov	cx, [es:bp+2]
  9243 00003B6F F7E1                    		mul	cx
  9244 00003B71 368B3E[0C06]            		mov	di, [ss:TEMP_VAR]
  9245 00003B76 01C7                    		add	di, ax
  9246 00003B78 368E06[0E06]            		mov	es, [ss:TEMP_VAR2]
  9247 00003B7D D1E9                    		shr	cx, 1
  9248 00003B7F F3A5                    		rep movsw
  9249 00003B81 83D100                  		adc	cx, 0
  9250 00003B84 F3A4                    		rep movsb
  9251 00003B86 07                      		pop	es
  9252 00003B87 5F                      		pop	di
  9253 00003B88 5E                      		pop	si
  9254 00003B89 5A                      		pop	dx
  9255 00003B8A 59                      		pop	cx
  9256                                  
  9257                                  bufq3:					; ...
  9258 00003B8B 89F8                    		mov	ax, di
  9259 00003B8D E8741F                  		call	SCANPLACE
  9260 00003B90 363B06[BB0E]            		cmp	ax, [ss:FIRST_BUFF_ADDR]
  9261 00003B95 58                      		pop	ax
  9262 00003B96 759A                    		jnz	short bufq
  9263 00003B98 EBBA                    		jmp	short bufx
  9264                                  
  9265                                  ; =============== S U B	R O U T	I N E =======================================
  9266                                  
  9267                                  
  9268                                  DISKWRITE:
  9269                                  
  9270                                  ; FUNCTION CHUNK AT 7A59 SIZE 000001B5 BYTES
  9271                                  
  9272 00003B9A E8E5FC                  		call	CHECK_WRITE_LOCK
  9273 00003B9D 7304                    		jnb	short _WRITE_OK
  9274 00003B9F C3                      		retn
  9275                                  ; ---------------------------------------------------------------------------
  9276                                  
  9277                                  WRTEOFJ:				; ...
  9278 00003BA0 E9E201                  		jmp	WRTEOF
  9279                                  ; ---------------------------------------------------------------------------
  9280                                  
  9281                                  _WRITE_OK:				; ...
  9282 00003BA3 26816505BFBF            		and	word [es:di+5], 0BFBFh
  9283 00003BA9 268B4511                		mov	ax, [es:di+11h]
  9284 00003BAD A3[0C06]                		mov	[TEMP_VAR], ax
  9285 00003BB0 268B4513                		mov	ax, [es:di+13h]
  9286 00003BB4 A3[0E06]                		mov	[TEMP_VAR2], ax
  9287 00003BB7 C42E[8A05]              		les	bp, [THISDPB]
  9288 00003BBB E8F7FD                  		call	BREAKDOWN
  9289 00003BBE A1[CE05]                		mov	ax, [BYTPOS]
  9290 00003BC1 8B16[D005]              		mov	dx, [BYTPOS+2]
  9291 00003BC5 E3D9                    		jcxz	WRTEOFJ
  9292 00003BC7 01C8                    		add	ax, cx
  9293 00003BC9 83D200                  		adc	dx, 0
  9294 00003BCC 268B5E02                		mov	bx, [es:bp+2]
  9295 00003BD0 E8E102                  		call	DIV32
  9296 00003BD3 89C6                    		mov	si, ax
  9297 00003BD5 890E[0706]              		mov	word [HIGH_SECTOR], cx
  9298 00003BD9 09D2                    		or	dx, dx
  9299 00003BDB 52                      		push	dx
  9300 00003BDC 89CA                    		mov	dx, cx
  9301 00003BDE 7506                    		jnz	short CALCLUS
  9302 00003BE0 83E801                  		sub	ax, 1
  9303 00003BE3 83DA00                  		sbb	dx, 0
  9304                                  
  9305                                  CALCLUS:				; ...
  9306 00003BE6 E8F202                  		call	SHR32
  9307 00003BE9 5A                      		pop	dx
  9308 00003BEA 50                      		push	ax
  9309 00003BEB 52                      		push	dx
  9310 00003BEC 8B16[0E06]              		mov	dx, [TEMP_VAR2]
  9311 00003BF0 A1[0C06]                		mov	ax, [TEMP_VAR]
  9312 00003BF3 E8BE02                  		call	DIV32
  9313 00003BF6 890E[0E06]              		mov	[TEMP_VAR2], cx
  9314 00003BFA 890E[CA05]              		mov	[VALSEC+2], cx
  9315 00003BFE 89C1                    		mov	cx, ax
  9316 00003C00 89F3                    		mov	bx, si
  9317 00003C02 09D2                    		or	dx, dx
  9318 00003C04 7408                    		jz	short NORND
  9319 00003C06 83C001                  		add	ax, 1
  9320 00003C09 8316[CA05]00            		adc	word [VALSEC+2], 0
  9321                                  
  9322                                  NORND:					; ...
  9323 00003C0E A3[C805]                		mov	[VALSEC], ax
  9324 00003C11 31C0                    		xor	ax, ax
  9325 00003C13 A3[DE05]                		mov	[GROWCNT], ax
  9326 00003C16 A3[E005]                		mov	[GROWCNT+2], ax
  9327 00003C19 58                      		pop	ax
  9328 00003C1A 8B3E[0706]              		mov	di, [HIGH_SECTOR]
  9329 00003C1E 3B3E[0E06]              		cmp	di, [TEMP_VAR2]
  9330 00003C22 7267                    		jb	short NOGROW
  9331 00003C24 7408                    		jz	short lowsec
  9332 00003C26 29CB                    		sub	bx, cx
  9333 00003C28 1B3E[0E06]              		sbb	di, [TEMP_VAR2]
  9334 00003C2C EB09                    		jmp	short yesgrow
  9335                                  ; ---------------------------------------------------------------------------
  9336                                  
  9337                                  lowsec:					; ...
  9338 00003C2E BF0000                  		mov	di, 0
  9339 00003C31 29CB                    		sub	bx, cx
  9340 00003C33 7256                    		jb	short NOGROW
  9341 00003C35 7447                    		jz	short TESTTAIL
  9342                                  
  9343                                  yesgrow:				; ...
  9344 00003C37 89D1                    		mov	cx, dx
  9345 00003C39 93                      		xchg	ax, bx
  9346 00003C3A 26F76602                		mul	word [es:bp+2]
  9347 00003C3E 8916[0706]              		mov	word [HIGH_SECTOR], dx
  9348 00003C42 A3[0E06]                		mov	[TEMP_VAR2], ax
  9349 00003C45 89F8                    		mov	ax, di
  9350 00003C47 26F76602                		mul	word [es:bp+2]
  9351 00003C4B 0306[0706]              		add	ax, [HIGH_SECTOR]
  9352 00003C4F 89C2                    		mov	dx, ax
  9353 00003C51 A1[0E06]                		mov	ax, [TEMP_VAR2]
  9354 00003C54 29C8                    		sub	ax, cx
  9355 00003C56 83DA00                  		sbb	dx, 0
  9356 00003C59 01D8                    		add	ax, bx
  9357 00003C5B 83D200                  		adc	dx, 0
  9358 00003C5E EB24                    		jmp	short SETGRW
  9359                                  ; ---------------------------------------------------------------------------
  9360                                  
  9361                                  HAVSTART:				; ...
  9362 00003C60 89C1                    		mov	cx, ax
  9363 00003C62 E8CD11                  		call	SKPCLP
  9364 00003C65 E312                    		jcxz	DOWRTJ
  9365 00003C67 E87F13                  		call	ALLOCATE
  9366 00003C6A 730D                    		jnb	short DOWRTJ
  9367                                  
  9368                                  WRTERR:					; ...
  9369 00003C6C B40F                    		mov	ah, 0Fh
  9370                                  
  9371                                  ; START	OF FUNCTION CHUNK FOR DISKREAD
  9372                                  
  9373                                  WRTERR22:				; ...
  9374 00003C6E A0[7605]                		mov	al, [THISDRV]
  9375 00003C71 31C9                    		xor	cx, cx
  9376 00003C73 C43E[9E05]              		les	di, [THISSFT]
  9377 00003C77 F8                      		clc
  9378 00003C78 C3                      		retn
  9379                                  ; END OF FUNCTION CHUNK	FOR DISKREAD
  9380                                  ; ---------------------------------------------------------------------------
  9381                                  ; START	OF FUNCTION CHUNK FOR DISKWRITE
  9382                                  
  9383                                  DOWRTJ:					; ...
  9384 00003C79 EB46                    		jmp	short DOWRT
  9385                                  ; ---------------------------------------------------------------------------
  9386                                  
  9387                                  ACC_ERRWJ:				; ...
  9388 00003C7B E9C700                  		jmp	SET_ACC_ERRW
  9389                                  ; ---------------------------------------------------------------------------
  9390                                  
  9391                                  TESTTAIL:				; ...
  9392 00003C7E 29D0                    		sub	ax, dx
  9393 00003C80 7609                    		jbe	short NOGROW
  9394 00003C82 31D2                    		xor	dx, dx
  9395                                  
  9396                                  SETGRW:					; ...
  9397 00003C84 A3[DE05]                		mov	[GROWCNT], ax
  9398 00003C87 8916[E005]              		mov	[GROWCNT+2], dx
  9399                                  
  9400                                  NOGROW:					; ...
  9401 00003C8B 58                      		pop	ax
  9402 00003C8C 8B0E[BC05]              		mov	cx, [CLUSNUM]
  9403 00003C90 E87F11                  		call	FNDCLUS
  9404 00003C93 72E6                    		jb	short ACC_ERRWJ
  9405 00003C95 891E[BC05]              		mov	[CLUSNUM], bx
  9406 00003C99 8916[BA05]              		mov	word [LASTPOS], dx
  9407 00003C9D 29D0                    		sub	ax, dx
  9408 00003C9F 7420                    		jz	short DOWRT
  9409 00003CA1 E3BD                    		jcxz	HAVSTART
  9410 00003CA3 51                      		push	cx
  9411 00003CA4 89C1                    		mov	cx, ax
  9412 00003CA6 E84013                  		call	ALLOCATE
  9413 00003CA9 59                      		pop	cx
  9414 00003CAA 72C0                    		jb	short WRTERR
  9415 00003CAC 8B16[BA05]              		mov	dx, [LASTPOS]
  9416 00003CB0 42                      		inc	dx
  9417 00003CB1 49                      		dec	cx
  9418 00003CB2 7405                    		jz	short NOSKIP
  9419 00003CB4 E87B11                  		call	SKPCLP
  9420 00003CB7 72C2                    		jb	short ACC_ERRWJ
  9421                                  
  9422                                  NOSKIP:					; ...
  9423 00003CB9 891E[BC05]              		mov	[CLUSNUM], bx
  9424 00003CBD 8916[BA05]              		mov	word [LASTPOS], dx
  9425                                  
  9426                                  DOWRT:					; ...
  9427 00003CC1 833E[D205]00            		cmp	word [BYTCNT1], 0
  9428 00003CC6 7409                    		jz	short WRTMID
  9429 00003CC8 8B1E[BC05]              		mov	bx, [CLUSNUM]
  9430 00003CCC E8F411                  		call	BUFWRT
  9431 00003CCF 72AA                    		jb	short ACC_ERRWJ
  9432                                  
  9433                                  WRTMID:					; ...
  9434 00003CD1 A1[D605]                		mov	ax, [SECCNT]
  9435 00003CD4 09C0                    		or	ax, ax
  9436 00003CD6 7470                    		jz	short WRTLAST
  9437 00003CD8 0106[C405]              		add	[SECPOS], ax
  9438 00003CDC 8316[C605]00            		adc	word [SECPOS+2], 0
  9439 00003CE1 E84112                  		call	NEXTSEC
  9440 00003CE4 725F                    		jb	short SET_ACC_ERRW
  9441 00003CE6 C606[7405]01            		mov	byte [TRANS], 1
  9442 00003CEB 8A16[7305]              		mov	dl, [SECCLUSPOS]
  9443 00003CEF 8B1E[BC05]              		mov	bx, [CLUSNUM]
  9444 00003CF3 8B0E[D605]              		mov	cx, [SECCNT]
  9445                                  
  9446                                  WRTLP:					; ...
  9447 00003CF7 E85C12                  		call	OPTIMIZE
  9448 00003CFA 7249                    		jb	short SET_ACC_ERRW
  9449 00003CFC 57                      		push	di
  9450 00003CFD 50                      		push	ax
  9451 00003CFE E82D01                  		call	DskWrtBufPurge
  9452 00003D01 368E1E[2E03]            		mov	ds, word [ss:DMAADD+2]
  9453 00003D06 36C606[4B03]38          		mov	byte [ss:ALLOWED], 38h
  9454                                  
  9455                                  DWRITE_LUP:				; ...
  9456 00003D0C E8D3FB                  		call	DSKWRITE
  9457 00003D0F 7417                    		jz	short DWRITE_OKAY
  9458 00003D11 3C27                    		cmp	al, 27h
  9459 00003D13 7423                    		jz	short DWRITE_DISK_FULL
  9460 00003D15 36C606[7505]01          		mov	byte [ss:READOP], 1
  9461 00003D1B E8F3FB                  		call	HARDERRRW
  9462 00003D1E 3C01                    		cmp	al, 1
  9463 00003D20 74EA                    		jz	short DWRITE_LUP
  9464 00003D22 3C03                    		cmp	al, 3
  9465 00003D24 F8                      		clc
  9466 00003D25 7501                    		jnz	short DWRITE_OKAY
  9467 00003D27 F9                      		stc
  9468                                  
  9469                                  DWRITE_OKAY:				; ...
  9470 00003D28 59                      		pop	cx
  9471 00003D29 5B                      		pop	bx
  9472 00003D2A 16                      		push	ss
  9473 00003D2B 1F                      		pop	ds
  9474 00003D2C 7217                    		jb	short SET_ACC_ERRW
  9475 00003D2E E318                    		jcxz	WRTLAST
  9476 00003D30 B200                    		mov	dl, 0
  9477 00003D32 FF06[BA05]              		inc	word [LASTPOS]
  9478 00003D36 EBBF                    		jmp	short WRTLP
  9479                                  ; ---------------------------------------------------------------------------
  9480                                  
  9481                                  DWRITE_DISK_FULL:			; ...
  9482 00003D38 16                      		push	ss
  9483 00003D39 1F                      		pop	ds
  9484 00003D3A 59                      		pop	cx
  9485 00003D3B 5B                      		pop	bx
  9486 00003D3C C606[0B06]01            		mov	byte [DISK_FULL], 1
  9487 00003D41 F9                      		stc
  9488 00003D42 E927FF                  		jmp	WRTERR
  9489                                  ; ---------------------------------------------------------------------------
  9490                                  
  9491                                  SET_ACC_ERRW:				; ...
  9492 00003D45 E906FD                  		jmp	SET_ACC_ERR_DS
  9493                                  ; ---------------------------------------------------------------------------
  9494                                  
  9495                                  WRTLAST:				; ...
  9496 00003D48 A1[D405]                		mov	ax, [BYTCNT2]
  9497 00003D4B 09C0                    		or	ax, ax
  9498 00003D4D 7413                    		jz	short FINWRT
  9499 00003D4F A3[D205]                		mov	word [BYTCNT1], ax
  9500 00003D52 E8D011                  		call	NEXTSEC
  9501 00003D55 72EE                    		jb	short SET_ACC_ERRW
  9502 00003D57 C706[CC05]0000          		mov	word [BYTSECPOS], 0
  9503 00003D5D E86311                  		call	BUFWRT
  9504 00003D60 72E3                    		jb	short SET_ACC_ERRW
  9505                                  
  9506                                  FINWRT:					; ...
  9507 00003D62 C43E[9E05]              		les	di, [THISSFT]
  9508 00003D66 A1[DE05]                		mov	ax, [GROWCNT]
  9509 00003D69 8B0E[E005]              		mov	cx, [GROWCNT+2]
  9510 00003D6D 09C0                    		or	ax, ax
  9511 00003D6F 7502                    		jnz	short UPDATE_size
  9512 00003D71 E30F                    		jcxz	SAMSIZ
  9513                                  
  9514                                  UPDATE_size:				; ...
  9515 00003D73 26014511                		add	[es:di+11h], ax
  9516 00003D77 26114D13                		adc	[es:di+13h], cx
  9517 00003D7B B80100                  		mov	ax, 1
  9518 00003D7E FF1E[C800]              		call	far [ShSU]
  9519                                  
  9520                                  SAMSIZ:					; ...
  9521 00003D82 E961FD                  		jmp	SETCLUS
  9522                                  ; ---------------------------------------------------------------------------
  9523                                  
  9524                                  WRTEOF:					; ...
  9525 00003D85 89C1                    		mov	cx, ax
  9526 00003D87 09D1                    		or	cx, dx
  9527 00003D89 746B                    		jz	short KILLFIL
  9528 00003D8B 83E801                  		sub	ax, 1
  9529 00003D8E 83DA00                  		sbb	dx, 0
  9530 00003D91 53                      		push	bx
  9531 00003D92 268B5E02                		mov	bx, [es:bp+2]
  9532 00003D96 E81B01                  		call	DIV32
  9533 00003D99 5B                      		pop	bx
  9534 00003D9A 89CA                    		mov	dx, cx
  9535 00003D9C 890E[0706]              		mov	word [HIGH_SECTOR],	cx
  9536 00003DA0 E83801                  		call	SHR32
  9537 00003DA3 89C1                    		mov	cx, ax
  9538 00003DA5 E86A10                  		call	FNDCLUS
  9539                                  
  9540                                  SET_ACC_ERRWJ2:				; ...
  9541 00003DA8 729B                    		jb	short SET_ACC_ERRW
  9542 00003DAA E326                    		jcxz	RELFILE
  9543 00003DAC E83A12                  		call	ALLOCATE
  9544 00003DAF 721E                    		jb	short WRTERRJ
  9545                                  
  9546                                  UPDATE:					; ...
  9547 00003DB1 C43E[9E05]              		les	di, [THISSFT]
  9548 00003DB5 A1[CE05]                		mov	ax, [BYTPOS]
  9549 00003DB8 26894511                		mov	[es:di+11h], ax
  9550 00003DBC A1[D005]                		mov	ax, [BYTPOS+2]
  9551 00003DBF 26894513                		mov	[es:di+13h], ax
  9552 00003DC3 B80200                  		mov	ax, 2
  9553 00003DC6 FF1E[C800]              		call	far [ShSU]
  9554 00003DCA 31C9                    		xor	cx, cx
  9555 00003DCC E934FD                  		jmp	ADDREC
  9556                                  ; ---------------------------------------------------------------------------
  9557                                  
  9558                                  WRTERRJ:				; ...
  9559 00003DCF E99AFE                  		jmp	WRTERR
  9560                                  ; ---------------------------------------------------------------------------
  9561                                  
  9562                                  RELFILE:				; ...
  9563 00003DD2 06                      		push	es
  9564 00003DD3 C43E[9E05]              		les	di, [THISSFT]
  9565 00003DD7 263B5519                		cmp	dx, [es:di+19h]
  9566 00003DDB 730E                    		jnb	short SKIPRESET
  9567 00003DDD 26C745190000            		mov	word [es:di+19h], 0
  9568 00003DE3 268B550B                		mov	dx, [es:di+0Bh]
  9569 00003DE7 26895535                		mov	[es:di+35h], dx
  9570                                  
  9571                                  SKIPRESET:				; ...
  9572 00003DEB 07                      		pop	es
  9573 00003DEC BAFFFF                  		mov	dx, 0FFFFh
  9574 00003DEF E8B612                  		call	RELBLKS
  9575                                  
  9576                                  SET_ACC_ERRWJ:				; ...
  9577 00003DF2 72B4                    		jb	short SET_ACC_ERRWJ2
  9578 00003DF4 EBBB                    		jmp	short UPDATE
  9579                                  ; ---------------------------------------------------------------------------
  9580                                  
  9581                                  KILLFIL:				; ...
  9582 00003DF6 31DB                    		xor	bx, bx
  9583 00003DF8 06                      		push	es
  9584 00003DF9 C43E[9E05]              		les	di, [THISSFT]
  9585 00003DFD 26895D19                		mov	[es:di+19h], bx
  9586 00003E01 26895D35                		mov	[es:di+35h], bx
  9587 00003E05 26875D0B                		xchg	bx, [es:di+0Bh]
  9588 00003E09 07                      		pop	es
  9589 00003E0A 09DB                    		or	bx, bx
  9590 00003E0C 741E                    		jz	short UPDATEJ
  9591 00003E0E 06                      		push	es
  9592 00003E0F 55                      		push	bp
  9593 00003E10 50                      		push	ax
  9594 00003E11 51                      		push	cx
  9595 00003E12 52                      		push	dx
  9596 00003E13 C42E[8A05]              		les	bp, [THISDPB]
  9597 00003E17 268A5600                		mov	dl, [es:bp+0]
  9598 00003E1B 89D9                    		mov	cx, bx
  9599 00003E1D B402                    		mov	ah, 2
  9600 00003E1F E8CCE9                  		call	FastOpen_Update
  9601 00003E22 5A                      		pop	dx
  9602 00003E23 59                      		pop	cx
  9603 00003E24 58                      		pop	ax
  9604 00003E25 5D                      		pop	bp
  9605 00003E26 07                      		pop	es
  9606 00003E27 E87C12                  		call	RELEASE
  9607 00003E2A 72C6                    		jb	short SET_ACC_ERRWJ
  9608                                  
  9609                                  UPDATEJ:				; ...
  9610 00003E2C EB83                    		jmp	short UPDATE
  9611                                  ; END OF FUNCTION CHUNK	FOR DISKWRITE
  9612                                  
  9613                                  ; =============== S U B	R O U T	I N E =======================================
  9614                                  
  9615                                  
  9616                                  DskWrtBufPurge:
  9617 00003E2E 53                      		push	bx
  9618 00003E2F 51                      		push	cx
  9619 00003E30 368B1E[0706]            		mov	bx, [ss:HIGH_SECTOR]
  9620 00003E35 89DE                    		mov	si, bx
  9621 00003E37 01D1                    		add	cx, dx
  9622 00003E39 83D600                  		adc	si, 0
  9623 00003E3C 268A4600                		mov	al, [es:bp+0]
  9624 00003E40 36833E[7700]00          		cmp	word [ss:SC_CACHE_COUNT], 0
  9625 00003E46 7431                    		jz	short nosc
  9626 00003E48 363A06[B00D]            		cmp	al, [ss:CurSC_DRIVE]
  9627 00003E4D 752A                    		jnz	short nosc
  9628 00003E4F 50                      		push	ax
  9629 00003E50 36A1[B10D]              		mov	ax, [ss:CurSC_SECTOR]
  9630 00003E54 368B3E[B30D]            		mov	di, [ss:CurSC_SECTOR+2]
  9631 00003E59 39FE                    		cmp	si, di
  9632 00003E5B 7502                    		jnz	short sc01
  9633 00003E5D 39C1                    		cmp	cx, ax
  9634                                  
  9635                                  sc01:					; ...
  9636 00003E5F 7617                    		jbe	short sc5
  9637 00003E61 360306[7700]            		add	ax, [ss:SC_CACHE_COUNT]
  9638 00003E66 83D700                  		adc	di, 0
  9639 00003E69 39FB                    		cmp	bx, di
  9640 00003E6B 7502                    		jnz	short sc02
  9641 00003E6D 39C2                    		cmp	dx, ax
  9642                                  
  9643                                  sc02:					; ...
  9644 00003E6F 7307                    		jnb	short sc5
  9645 00003E71 36C706[B50D]0000        		mov	word [ss:SC_STATUS], 0
  9646                                  
  9647                                  sc5:					; ...
  9648 00003E78 58                      		pop	ax
  9649                                  
  9650                                  nosc:					; ...
  9651 00003E79 E8761C                  		call	GETCURHEAD
  9652                                  
  9653                                  _bufq:					; ...
  9654 00003E7C 3A4504                  		cmp	al, [di+4]
  9655 00003E7F 7527                    		jnz	short bufq5
  9656 00003E81 3B5D08                  		cmp	bx, [di+8]
  9657 00003E84 7503                    		jnz	short bufq04
  9658 00003E86 3B5506                  		cmp	dx, [di+6]
  9659                                  
  9660                                  bufq04:					; ...
  9661 00003E89 771D                    		ja	short bufq5
  9662 00003E8B 3B7508                  		cmp	si, [di+8]
  9663 00003E8E 7503                    		jnz	short bufq05
  9664 00003E90 3B4D06                  		cmp	cx, [di+6]
  9665                                  
  9666                                  bufq05:					; ...
  9667 00003E93 7613                    		jbe	short bufq5
  9668 00003E95 F6450540                		test	byte [di+5], 40h
  9669 00003E99 7403                    		jz	short bufq4
  9670 00003E9B E8C91E                  		call	DEC_DIRTY_COUNT
  9671                                  
  9672                                  bufq4:					; ...
  9673 00003E9E C74504FF20              		mov	word [di+4], 20FFh
  9674 00003EA3 E85E1C                  		call	SCANPLACE
  9675 00003EA6 EB02                    		jmp	short bufq6
  9676                                  ; ---------------------------------------------------------------------------
  9677                                  
  9678                                  bufq5:					; ...
  9679 00003EA8 8B3D                    		mov	di, [di]
  9680                                  
  9681                                  bufq6:					; ...
  9682 00003EAA 363B3E[BB0E]            		cmp	di, [ss:FIRST_BUFF_ADDR]
  9683 00003EAF 75CB                    		jnz	short _bufq
  9684 00003EB1 59                      		pop	cx
  9685 00003EB2 5B                      		pop	bx
  9686 00003EB3 C3                      		retn
  9687                                  
  9688                                  ; =============== S U B	R O U T	I N E =======================================
  9689                                  
  9690                                  
  9691                                  DIV32:
  9692 00003EB4 81FB0002                		cmp	bx, 512
  9693 00003EB8 7515                    		jnz	short div5
  9694 00003EBA 89D1                    		mov	cx, dx
  9695 00003EBC 89C2                    		mov	dx, ax
  9696 00003EBE 81E2FF01                		and	dx, 511
  9697 00003EC2 88E0                    		mov	al, ah
  9698 00003EC4 88CC                    		mov	ah, cl
  9699 00003EC6 88E9                    		mov	cl, ch
  9700 00003EC8 30ED                    		xor	ch, ch
  9701 00003ECA D1E9                    		shr	cx, 1
  9702 00003ECC D1D8                    		rcr	ax, 1
  9703 00003ECE C3                      		retn
  9704                                  ; ---------------------------------------------------------------------------
  9705                                  
  9706                                  div5:					; ...
  9707 00003ECF 89C1                    		mov	cx, ax
  9708 00003ED1 89D0                    		mov	ax, dx
  9709 00003ED3 31D2                    		xor	dx, dx
  9710 00003ED5 F7F3                    		div	bx
  9711 00003ED7 91                      		xchg	ax, cx
  9712 00003ED8 F7F3                    		div	bx
  9713 00003EDA C3                      		retn
  9714                                  
  9715                                  ; =============== S U B	R O U T	I N E =======================================
  9716                                  
  9717                                  
  9718                                  SHR32:
  9719 00003EDB 268A4E05                		mov	cl, [es:bp+5]
  9720 00003EDF 30ED                    		xor	ch, ch
  9721 00003EE1 E306                    		jcxz	norota
  9722                                  
  9723                                  rotashft2:				; ...
  9724 00003EE3 D1EA                    		shr	dx, 1
  9725 00003EE5 D1D8                    		rcr	ax, 1
  9726 00003EE7 E2FA                    		loop	rotashft2
  9727                                  
  9728                                  norota:					; ...
  9729 00003EE9 C3                      		retn
  9730                                  
  9731                                  ; =============== S U B	R O U T	I N E =======================================
  9732                                  
  9733                                  
  9734                                  SEARCH:
  9735 00003EEA E85A04                  		call	STARTSRCH
  9736 00003EED A0[6B05]                		mov	al, [ATTRIB]
  9737 00003EF0 249E                    		and	al, 9Eh
  9738 00003EF2 3C08                    		cmp	al, 8
  9739 00003EF4 7503                    		jnz	short NOTVOLSRCH
  9740 00003EF6 E87E01                  		call	SETROOTSRCH
  9741                                  
  9742                                  NOTVOLSRCH:				; ...
  9743 00003EF9 E80801                  		call	GETENTRY
  9744 00003EFC 7303                    		jnb	short SRCH
  9745 00003EFE E99500                  		jmp	SETESRET
  9746                                  ; ---------------------------------------------------------------------------
  9747                                  
  9748                                  SRCH:					; ...
  9749 00003F01 1E                      		push	ds
  9750 00003F02 8E1E[E405]              		mov	ds, word [CURBUF+2]
  9751 00003F06 8A27                    		mov	ah, [bx]
  9752 00003F08 08E4                    		or	ah, ah
  9753 00003F0A 743A                    		jz	short FREE
  9754 00003F0C 363A26[7F05]            		cmp	ah, [ss:DELALL]
  9755 00003F11 7433                    		jz	short FREE
  9756 00003F13 F6470B08                		test	byte [bx+0Bh], 8
  9757 00003F17 7405                    		jz	short CHKFNAM
  9758 00003F19 36FE06[7B05]            		inc	byte [ss:VOLID]
  9759                                  
  9760                                  CHKFNAM:				; ...
  9761 00003F1E 8CD6                    		mov	si, ss
  9762 00003F20 8EC6                    		mov	es, si
  9763 00003F22 89DE                    		mov	si, bx
  9764 00003F24 BF[4B05]                		mov	di, NAME1
  9765 00003F27 36803E[4B05]E5          		cmp	byte [ss:NAME1], 0E5h
  9766 00003F2D 7506                    		jnz	short NO_E5
  9767 00003F2F 36C606[4B05]05          		mov	byte [ss:NAME1], 5
  9768                                  
  9769                                  NO_E5:					; ...
  9770 00003F35 E86100                  		call	MetaCompare
  9771 00003F38 7428                    		jz	short FOUND
  9772 00003F3A 1F                      		pop	ds
  9773                                  
  9774                                  NEXTENT:				; ...
  9775 00003F3B C42E[8A05]              		les	bp, [THISDPB]
  9776 00003F3F E86600                  		call	NEXTENTRY
  9777 00003F42 73BD                    		jnb	short SRCH
  9778 00003F44 EB50                    		jmp	short SETESRET
  9779                                  ; ---------------------------------------------------------------------------
  9780                                  
  9781                                  FREE:					; ...
  9782 00003F46 1F                      		pop	ds
  9783 00003F47 8B0E[4803]              		mov	cx, [LASTENT]
  9784 00003F4B 3B0E[D805]              		cmp	cx, [ENTFREE]
  9785 00003F4F 7304                    		jnb	short TSTALL
  9786 00003F51 890E[D805]              		mov	[ENTFREE], cx
  9787                                  
  9788                                  TSTALL:					; ...
  9789 00003F55 3A26[7F05]              		cmp	ah, [DELALL]
  9790                                  
  9791                                  NEXTENTJ:				; ...
  9792 00003F59 74E0                    		jz	short NEXTENT
  9793 00003F5B 890E[DA05]              		mov	[ENTLAST], cx
  9794 00003F5F F9                      		stc
  9795 00003F60 EB34                    		jmp	short SETESRET
  9796                                  ; ---------------------------------------------------------------------------
  9797                                  
  9798                                  FOUND:					; ...
  9799 00003F62 8A2C                    		mov	ch, [si]
  9800 00003F64 1F                      		pop	ds
  9801 00003F65 8A26[6B05]              		mov	ah, [ATTRIB]
  9802 00003F69 80E49E                  		and	ah, 9Eh
  9803 00003F6C 8D740F                  		lea	si, [si+0Fh]
  9804 00003F6F F6C508                  		test	ch, 8
  9805 00003F72 7409                    		jz	short check_one_volume_id
  9806 00003F74 F6C408                  		test	ah, 8
  9807 00003F77 74E0                    		jz	short NEXTENTJ
  9808 00003F79 30E4                    		xor	ah, ah
  9809 00003F7B EB11                    		jmp	short RETFF
  9810                                  ; ---------------------------------------------------------------------------
  9811                                  
  9812                                  check_one_volume_id:			; ...
  9813 00003F7D 80FC08                  		cmp	ah, 8
  9814 00003F80 74D7                    		jz	short NEXTENTJ
  9815 00003F82 E8D603                  		call	MatchAttributes
  9816 00003F85 7407                    		jz	short RETFF
  9817 00003F87 F606[7E05]FF            		test	byte [CREATING], 0FFh
  9818 00003F8C 74CB                    		jz	short NEXTENTJ
  9819                                  
  9820                                  RETFF:					; ...
  9821 00003F8E C42E[8A05]              		les	bp, [THISDPB]
  9822 00003F92 268A6600                		mov	ah, [es:bp+0]
  9823                                  
  9824                                  SETESRET:				; ...
  9825 00003F96 16                      		push	ss
  9826 00003F97 07                      		pop	es
  9827 00003F98 C3                      		retn
  9828                                  
  9829                                  ; =============== S U B	R O U T	I N E =======================================
  9830                                  
  9831                                  
  9832                                  MetaCompare:
  9833 00003F99 B90B00                  		mov	cx, 11
  9834                                  
  9835                                  WILDCRD:				; ...
  9836 00003F9C F3A6                    		repe cmpsb
  9837 00003F9E 7407                    		jz	short MetaRet
  9838 00003FA0 26807DFF3F              		cmp	byte [es:di-1], '?'
  9839 00003FA5 74F5                    		jz	short WILDCRD
  9840                                  
  9841                                  MetaRet:				; ...
  9842 00003FA7 C3                      		retn
  9843                                  
  9844                                  ; =============== S U B	R O U T	I N E =======================================
  9845                                  
  9846                                  
  9847                                  NEXTENTRY:
  9848 00003FA8 A1[4803]                		mov	ax, [LASTENT]
  9849 00003FAB 3B06[DA05]              		cmp	ax, [ENTLAST]
  9850 00003FAF 7424                    		jz	short NONE
  9851 00003FB1 40                      		inc	ax
  9852 00003FB2 8D5F20                  		lea	bx, [bx+32]
  9853 00003FB5 39D3                    		cmp	bx, dx
  9854 00003FB7 751E                    		jnz	short HAVIT
  9855 00003FB9 8A1E[7305]              		mov	bl, [SECCLUSPOS]
  9856 00003FBD FEC3                    		inc	bl
  9857 00003FBF 3A1E[7705]              		cmp	bl, [CLUSFAC]
  9858 00003FC3 7217                    		jb	short SAMECLUS
  9859 00003FC5 8B1E[DC05]              		mov	bx, [NXTCLUSNUM]
  9860 00003FC9 E84E17                  		call	IsEOF
  9861 00003FCC 7307                    		jnb	short NONE
  9862 00003FCE 83FB02                  		cmp	bx, 2
  9863 00003FD1 7202                    		jb	short NONE
  9864 00003FD3 EB32                    		jmp	short GETENT
  9865                                  ; ---------------------------------------------------------------------------
  9866                                  
  9867                                  NONE:					; ...
  9868 00003FD5 F9                      		stc
  9869 00003FD6 C3                      		retn
  9870                                  ; ---------------------------------------------------------------------------
  9871                                  
  9872                                  HAVIT:					; ...
  9873 00003FD7 A3[4803]                		mov	word [LASTENT], ax
  9874 00003FDA F8                      		clc
  9875                                  
  9876                                  nextentry_retn:				; ...
  9877 00003FDB C3                      		retn
  9878                                  ; ---------------------------------------------------------------------------
  9879                                  
  9880                                  SAMECLUS:				; ...
  9881 00003FDC 881E[7305]              		mov	[SECCLUSPOS], bl
  9882 00003FE0 A3[4803]                		mov	word [LASTENT], ax
  9883 00003FE3 1E                      		push	ds
  9884 00003FE4 C53E[E205]              		lds	di, [CURBUF]
  9885 00003FE8 8B5508                  		mov	dx, [di+8]
  9886 00003FEB 368916[0706]            		mov	word [ss:HIGH_SECTOR], dx
  9887 00003FF0 8B5506                  		mov	dx, [di+6]
  9888 00003FF3 83C201                  		add	dx, 1
  9889 00003FF6 368316[0706]00          		adc	word [ss:HIGH_SECTOR], 0
  9890 00003FFC 1F                      		pop	ds
  9891 00003FFD E822F8                  		call	FIRSTCLUSTER
  9892 00004000 31DB                    		xor	bx, bx
  9893 00004002 EB24                    		jmp	short SETENTRY
  9894                                  
  9895                                  ; =============== S U B	R O U T	I N E =======================================
  9896                                  
  9897                                  
  9898                                  GETENTRY:
  9899 00004004 A1[4803]                		mov	ax, [LASTENT]
  9900                                  
  9901                                  GETENT:					; ...
  9902 00004007 A3[4803]                		mov	word [LASTENT], ax
  9903 0000400A B105                    		mov	cl, 5
  9904 0000400C D3C0                    		rol	ax, cl
  9905 0000400E 89C2                    		mov	dx, ax
  9906 00004010 83E0E0                  		and	ax, 0FFE0h
  9907 00004013 83E21F                  		and	dx, 1Fh
  9908 00004016 268B5E02                		mov	bx, [es:bp+2]
  9909 0000401A 80E3E0                  		and	bl, 0E0h	; 255-31
  9910 0000401D F7F3                    		div	bx
  9911 0000401F 89D3                    		mov	bx, dx
  9912 00004021 53                      		push	bx
  9913 00004022 E8A4F7                  		call	DIRREAD
  9914 00004025 5B                      		pop	bx
  9915 00004026 72B3                    		jb	short nextentry_retn
  9916                                  
  9917                                  SETENTRY:				; ...
  9918 00004028 8B16[E205]              		mov	dx, word [CURBUF]
  9919 0000402C 83C214                  		add	dx, 20
  9920 0000402F 01D3                    		add	bx, dx
  9921 00004031 26035602                		add	dx, [es:bp+2]
  9922 00004035 F8                      		clc
  9923 00004036 C3                      		retn
  9924                                  
  9925                                  ; =============== S U B	R O U T	I N E =======================================
  9926                                  
  9927                                  
  9928                                  SETDIRSRCH:
  9929 00004037 09DB                    		or	bx, bx
  9930 00004039 743C                    		jz	short SETROOTSRCH
  9931 0000403B 891E[C205]              		mov	word [DIRSTART], bx
  9932 0000403F 268A4604                		mov	al, [es:bp+4]
  9933 00004043 FEC0                    		inc	al
  9934 00004045 A2[7705]                		mov	[CLUSFAC], al
  9935 00004048 56                      		push	si
  9936 00004049 F606[3A0D]02            		test	byte [FastOpenFlg], 2
  9937 0000404E 7507                    		jnz	short UNP_OK
  9938 00004050 E8DE16                  		call	UNPACK
  9939 00004053 7302                    		jnb	short UNP_OK
  9940 00004055 5E                      		pop	si
  9941 00004056 C3                      		retn
  9942                                  ; ---------------------------------------------------------------------------
  9943                                  
  9944                                  UNP_OK:					; ...
  9945 00004057 893E[BC05]              		mov	[CLUSNUM], di
  9946 0000405B 89DA                    		mov	dx, bx
  9947 0000405D 30DB                    		xor	bl, bl
  9948 0000405F 881E[7305]              		mov	[SECCLUSPOS], bl
  9949 00004063 E8500F                  		call	FIGREC
  9950 00004066 5E                      		pop	si
  9951 00004067 52                      		push	dx
  9952 00004068 8B16[0706]              		mov	dx, [HIGH_SECTOR]
  9953 0000406C 8916[C005]              		mov	word [DIRSEC+2], dx
  9954 00004070 5A                      		pop	dx
  9955 00004071 8916[BE05]              		mov	[DIRSEC], dx
  9956 00004075 F8                      		clc
  9957 00004076 C3                      		retn
  9958                                  
  9959                                  ; =============== S U B	R O U T	I N E =======================================
  9960                                  
  9961                                  
  9962                                  SETROOTSRCH:
  9963 00004077 31C0                    		xor	ax, ax
  9964 00004079 A3[C205]                		mov	word [DIRSTART], ax
  9965 0000407C A2[7305]                		mov	[SECCLUSPOS], al
  9966 0000407F 48                      		dec	ax
  9967 00004080 A3[BC05]                		mov	[CLUSNUM], ax
  9968 00004083 268B460B                		mov	ax, [es:bp+0Bh]
  9969 00004087 268B5611                		mov	dx, [es:bp+11h]
  9970 0000408B 29D0                    		sub	ax, dx
  9971 0000408D A2[7705]                		mov	[CLUSFAC], al
  9972 00004090 8916[BE05]              		mov	[DIRSEC], dx
  9973 00004094 C706[C005]0000          		mov	word [DIRSEC+2], 0
  9974 0000409A F8                      		clc
  9975 0000409B C3                      		retn
  9976                                  
  9977                                  ; =============== S U B	R O U T	I N E =======================================
  9978                                  
  9979                                  
  9980                                  GETPATH	:
  9981                                  
  9982                                  ; FUNCTION CHUNK AT 7F82 SIZE 000001A5 BYTES
  9983                                  
  9984 0000409C C706[7E05]00E5          		mov	word [CREATING], 0E500h
  9985                                  
  9986                                  GetPathNoSet:				; ...
  9987 000040A2 C606[2303]02            		mov	byte [EXTERR_LOCUS], 2
  9988 000040A7 C706[E205]FFFF          		mov	word [CURBUF], 0FFFFh
  9989 000040AD 8B3E[B205]              		mov	di, [WFP_START]
  9990 000040B1 817D013A5C              		cmp	word [di+1], ':\' ; '\:'
  9991 000040B6 743A                    		jz	short CrackIt
  9992 000040B8 83C703                  		add	di, 3
  9993 000040BB 89FE                    		mov	si, di
  9994 000040BD E8B200                  		call	CHKDEV
  9995 000040C0 722E                    		jb	short InternalError
  9996                                  
  9997                                  Build_devJ:				; ...
  9998 000040C2 A0[6D05]                		mov	al, [SATTRIB]
  9999 000040C5 A2[6B05]                		mov	byte [ATTRIB], al
 10000 000040C8 C606[2303]01            		mov	byte [EXTERR_LOCUS], 1
 10001 000040CD 16                      		push	ss
 10002 000040CE 07                      		pop	es
 10003 000040CF BE[4B05]                		mov	si, NAME1
 10004 000040D2 8B3E[B205]              		mov	di, [WFP_START]
 10005 000040D6 89FA                    		mov	dx, di
 10006 000040D8 B90800                  		mov	cx, 8
 10007                                  
 10008                                  MoveLoop:				; ...
 10009 000040DB AC                      		lodsb
 10010 000040DC AA                      		stosb
 10011 000040DD 3C20                    		cmp	al, 20h	; ' '
 10012 000040DF 7402                    		jz	short NoSave
 10013 000040E1 89FA                    		mov	dx, di
 10014                                  
 10015                                  NoSave:					; ...
 10016 000040E3 E2F6                    		loop	MoveLoop
 10017 000040E5 89D7                    		mov	di, dx
 10018 000040E7 C60500                  		mov	byte [di], 0
 10019 000040EA E8DB02                  		call	Build_device_ent
 10020 000040ED FEC0                    		inc	al
 10021 000040EF C3                      		retn
 10022                                  ; ---------------------------------------------------------------------------
 10023                                  
 10024                                  InternalError:				; ...
 10025 000040F0 EBFE                    		jmp	short InternalError
 10026                                  ; ---------------------------------------------------------------------------
 10027                                  
 10028                                  CrackIt:				; ...
 10029 000040F2 8B36[B605]              		mov	si, [CURR_DIR_END]
 10030 000040F6 83FEFF                  		cmp	si, 0FFFFh
 10031 000040F9 7503                    		jnz	short LOOK_SING
 10032 000040FB 8D7503                  		lea	si, [di+3]
 10033                                  
 10034                                  LOOK_SING:				; ...
 10035 000040FE C606[6B05]16            		mov	byte [ATTRIB], 16h
 10036 00004103 C43E[A205]              		les	di, [THISCDS]
 10037 00004107 B8FFFF                  		mov	ax, 0FFFFh
 10038 0000410A 268B5D49                		mov	bx, [es:di+73]
 10039 0000410E 8B36[B605]              		mov	si, [CURR_DIR_END]
 10040 00004112 39C6                    		cmp	si, ax
 10041 00004114 7440                    		jz	short NO_CURR_D
 10042 00004116 39C3                    		cmp	bx, ax
 10043 00004118 743C                    		jz	short NO_CURR_D
 10044 0000411A F606[3A0D]01            		test	byte [FastOpenFlg],	1
 10045 0000411F 7442                    		jz	short GOT_SEARCH_CLUSTER
 10046 00004121 06                      		push	es
 10047 00004122 57                      		push	di
 10048 00004123 51                      		push	cx
 10049 00004124 FF74FF                  		push	word [si-1]
 10050 00004127 56                      		push	si
 10051 00004128 53                      		push	bx
 10052 00004129 C644FF00                		mov	byte [si-1], 0
 10053 0000412D 8B36[B205]              		mov	si, [WFP_START]
 10054 00004131 BB[300D]                		mov	bx, FastOpenTable
 10055 00004134 BF[460D]                		mov	di, Dir_Info_Buff
 10056 00004137 B9[3B0D]                		mov	cx, FastOpen_Ext_Info
 10057 0000413A B001                    		mov	al, 1
 10058 0000413C 1E                      		push	ds
 10059 0000413D 07                      		pop	es
 10060 0000413E FF5F02                  		call	far [bx+2]
 10061 00004141 7208                    		jb	short GO_Chk_end1
 10062 00004143 803C00                  		cmp	byte [si], 0
 10063 00004146 7404                    		jz	short GO_Chk_end
 10064 00004148 F9                      		stc
 10065 00004149 EB01                    		jmp	short GO_Chk_end
 10066                                  ; ---------------------------------------------------------------------------
 10067                                  
 10068                                  GO_Chk_end1:				; ...
 10069 0000414B F8                      		clc
 10070                                  
 10071                                  GO_Chk_end:				; ...
 10072 0000414C 5B                      		pop	bx
 10073 0000414D 5E                      		pop	si
 10074 0000414E 8F44FF                  		pop	word [si-1]
 10075 00004151 59                      		pop	cx
 10076 00004152 5F                      		pop	di
 10077 00004153 07                      		pop	es
 10078 00004154 730D                    		jnb	short GOT_SEARCH_CLUSTER
 10079                                  
 10080                                  NO_CURR_D:				; ...
 10081 00004156 8B36[B205]              		mov	si, [WFP_START]
 10082 0000415A 8D7403                  		lea	si, [si+3]
 10083 0000415D C42E[8A05]              		les	bp, [THISDPB]
 10084 00004161 EB3F                    		jmp	short ROOTPATH
 10085                                  ; ---------------------------------------------------------------------------
 10086                                  
 10087                                  GOT_SEARCH_CLUSTER:			; ...
 10088 00004163 C42E[8A05]              		les	bp, [THISDPB]
 10089 00004167 E8CDFE                  		call	SETDIRSRCH
 10090 0000416A 7202                    		jb	short SETFERR
 10091 0000416C EB45                    		jmp	short FINDPATH
 10092                                  ; ---------------------------------------------------------------------------
 10093                                  
 10094                                  SETFERR:				; ...
 10095 0000416E 30C9                    		xor	cl, cl
 10096 00004170 F9                      		stc
 10097 00004171 C3                      		retn
 10098                                  
 10099                                  ; =============== S U B	R O U T	I N E =======================================
 10100                                  
 10101                                  
 10102                                  CHKDEV	:
 10103 00004172 89FE                    		mov	si, di
 10104 00004174 8CD7                    		mov	di, ss
 10105 00004176 8EC7                    		mov	es, di
 10106 00004178 BF[4B05]                		mov	di, NAME1
 10107 0000417B B90900                  		mov	cx, 9
 10108                                  
 10109                                  TESTLOOP:				; ...
 10110 0000417E E8B010                  		call	GETLET
 10111 00004181 3C2E                    		cmp	al, 2Eh	; '.'
 10112 00004183 740E                    		jz	short TESTDEVICE
 10113 00004185 E8FF10                  		call	PATHCHRCMP
 10114 00004188 7407                    		jz	short NOTDEV
 10115 0000418A 08C0                    		or	al, al
 10116 0000418C 7405                    		jz	short TESTDEVICE
 10117 0000418E AA                      		stosb
 10118 0000418F E2ED                    		loop	TESTLOOP
 10119                                  
 10120                                  NOTDEV:					; ...
 10121 00004191 F9                      		stc
 10122 00004192 C3                      		retn
 10123                                  ; ---------------------------------------------------------------------------
 10124                                  
 10125                                  TESTDEVICE:				; ...
 10126 00004193 83C102                  		add	cx, 2
 10127 00004196 B020                    		mov	al, 20h	; ' '
 10128 00004198 F3AA                    		rep stosb
 10129 0000419A 8CD0                    		mov	ax, ss
 10130 0000419C 8ED8                    		mov	ds, ax
 10131 0000419E E8C701                  		call	DEVNAME
 10132 000041A1 C3                      		retn
 10133                                  
 10134                                  ; ---------------------------------------------------------------------------
 10135                                  ; START	OF FUNCTION CHUNK FOR GETPATH
 10136                                  
 10137                                  ROOTPATH:				; ...
 10138 000041A2 E8D2FE                  		call	SETROOTSRCH
 10139 000041A5 803C00                  		cmp	byte [si], 0
 10140 000041A8 7509                    		jnz	short FINDPATH
 10141 000041AA A0[6D05]                		mov	al, [SATTRIB]
 10142 000041AD A2[6B05]                		mov	byte [ATTRIB], al
 10143 000041B0 30E4                    		xor	ah, ah
 10144 000041B2 C3                      		retn
 10145                                  ; ---------------------------------------------------------------------------
 10146                                  
 10147                                  FINDPATH:				; ...
 10148 000041B3 06                      		push	es
 10149 000041B4 56                      		push	si
 10150 000041B5 89F7                    		mov	di, si
 10151 000041B7 8B0E[C205]              		mov	cx, [DIRSTART]
 10152 000041BB 833E[B605]FF            		cmp	word [CURR_DIR_END], 0FFFFh
 10153 000041C0 740E                    		jz	short NOIDS
 10154 000041C2 3B3E[B605]              		cmp	di, [CURR_DIR_END]
 10155 000041C6 7508                    		jnz	short NOIDS
 10156 000041C8 C43E[A205]              		les	di, [THISCDS]
 10157 000041CC 26894D49                		mov	[es:di+73], cx
 10158                                  
 10159                                  NOIDS:					; ...
 10160 000041D0 8CD0                    		mov	ax, ss
 10161 000041D2 8EC0                    		mov	es, ax
 10162 000041D4 BF[4B05]                		mov	di, NAME1
 10163 000041D7 B82020                  		mov	ax, 2020h
 10164 000041DA AA                      		stosb
 10165 000041DB AB                      		stosw
 10166 000041DC AB                      		stosw
 10167 000041DD AB                      		stosw
 10168 000041DE AB                      		stosw
 10169 000041DF AB                      		stosw
 10170 000041E0 BF[4B05]                		mov	di, NAME1
 10171 000041E3 30E4                    		xor	ah, ah
 10172                                  
 10173                                  GetNam:					; ...
 10174 000041E5 FEC1                    		inc	cl
 10175 000041E7 AC                      		lodsb
 10176 000041E8 3C2E                    		cmp	al, '.'
 10177 000041EA 7412                    		jz	short _SetExt
 10178 000041EC 08C0                    		or	al, al
 10179 000041EE 7424                    		jz	short _GetDone
 10180 000041F0 3C5C                    		cmp	al, '\'
 10181 000041F2 7420                    		jz	short _GetDone
 10182 000041F4 3C3F                    		cmp	al, '?'
 10183 000041F6 7503                    		jnz	short StoNam
 10184 000041F8 80CC01                  		or	ah, 1
 10185                                  
 10186                                  StoNam:					; ...
 10187 000041FB AA                      		stosb
 10188 000041FC EBE7                    		jmp	short GetNam
 10189                                  ; ---------------------------------------------------------------------------
 10190                                  
 10191                                  _SetExt:				; ...
 10192 000041FE BF[5305]                		mov	di, NAME1+8
 10193                                  
 10194                                  GetExt:					; ...
 10195 00004201 AC                      		lodsb
 10196 00004202 08C0                    		or	al, al
 10197 00004204 740E                    		jz	short _GetDone
 10198 00004206 3C5C                    		cmp	al, '\'
 10199 00004208 740A                    		jz	short _GetDone
 10200 0000420A 3C3F                    		cmp	al, '?'
 10201 0000420C 7503                    		jnz	short StoExt
 10202 0000420E 80CC01                  		or	ah, 1
 10203                                  
 10204                                  StoExt:					; ...
 10205 00004211 AA                      		stosb
 10206 00004212 EBED                    		jmp	short GetExt
 10207                                  ; ---------------------------------------------------------------------------
 10208                                  
 10209                                  _GetDone:				; ...
 10210 00004214 4E                      		dec	si
 10211 00004215 88E1                    		mov	cl, ah
 10212 00004217 80C980                  		or	cl, 80h
 10213 0000421A 5F                      		pop	di
 10214 0000421B 07                      		pop	es
 10215 0000421C 39FE                    		cmp	si, di
 10216 0000421E 7503                    		jnz	short check_device
 10217 00004220 E9EC00                  		jmp	_BADPATH
 10218                                  ; ---------------------------------------------------------------------------
 10219                                  
 10220                                  check_device:				; ...
 10221 00004223 56                      		push	si
 10222 00004224 8A04                    		mov	al, [si]
 10223 00004226 08C0                    		or	al, al
 10224 00004228 7508                    		jnz	short NOT_LAST
 10225 0000422A 8A3E[6D05]              		mov	bh, [SATTRIB]
 10226 0000422E 883E[6B05]              		mov	byte [ATTRIB], bh
 10227                                  
 10228                                  NOT_LAST:				; ...
 10229 00004232 06                      		push	es
 10230 00004233 16                      		push	ss
 10231 00004234 07                      		pop	es
 10232 00004235 E83001                  		call	DEVNAME
 10233 00004238 07                      		pop	es
 10234 00004239 720B                    		jb	short FindFile
 10235 0000423B 08C0                    		or	al, al
 10236 0000423D 7403                    		jz	short GO_BDEV
 10237 0000423F E9D100                  		jmp	FILEINPATH
 10238                                  ; ---------------------------------------------------------------------------
 10239                                  
 10240                                  GO_BDEV:				; ...
 10241 00004242 5E                      		pop	si
 10242 00004243 E97CFE                  		jmp	Build_devJ
 10243                                  ; ---------------------------------------------------------------------------
 10244                                  
 10245                                  FindFile:				; ...
 10246 00004246 803E[4B05]E5            		cmp	byte [NAME1], 0E5h
 10247 0000424B 7505                    		jnz	short NOE5
 10248 0000424D C606[4B05]05            		mov	byte [NAME1], 5
 10249                                  
 10250                                  NOE5:					; ...
 10251 00004252 57                      		push	di
 10252 00004253 06                      		push	es
 10253 00004254 51                      		push	cx
 10254 00004255 E8A102                  		call	LookupPath
 10255 00004258 7303                    		jnb	short DIR_FOUND
 10256 0000425A E88DFC                  		call	SEARCH
 10257                                  
 10258                                  DIR_FOUND:				; ...
 10259 0000425D 59                      		pop	cx
 10260 0000425E 07                      		pop	es
 10261 0000425F 5F                      		pop	di
 10262 00004260 7303                    		jnb	short LOAD_BUF
 10263 00004262 E9D300                  		jmp	BADPATHPOP
 10264                                  ; ---------------------------------------------------------------------------
 10265                                  
 10266                                  LOAD_BUF:				; ...
 10267 00004265 C53E[E205]              		lds	di, [CURBUF]
 10268 00004269 F6470B10                		test	byte [bx+0Bh], 10h
 10269 0000426D 7503                    		jnz	short GO_NEXT
 10270 0000426F E9A100                  		jmp	FILEINPATH
 10271                                  ; ---------------------------------------------------------------------------
 10272                                  
 10273                                  GO_NEXT:				; ...
 10274 00004272 36803E[4C03]00          		cmp	byte [ss:NoSetDir], 0
 10275 00004278 7426                    		jz	short SetDir
 10276 0000427A 89FA                    		mov	dx, di
 10277 0000427C 8CD9                    		mov	cx, ds
 10278 0000427E 16                      		push	ss
 10279 0000427F 1F                      		pop	ds
 10280 00004280 5F                      		pop	di
 10281 00004281 F606[3A0D]01            		test	byte [FastOpenFlg],	1
 10282 00004286 740B                    		jz	short _nofast
 10283 00004288 F606[3A0D]02            		test	byte [FastOpenFlg],	2
 10284 0000428D 7404                    		jz	short _nofast
 10285 0000428F 8B3E[660D]              		mov	di, [Next_Element_Start]
 10286                                  
 10287                                  _nofast:				; ...
 10288 00004293 803D00                  		cmp	byte [di], 0
 10289 00004296 7503                    		jnz	short NEXT_ONE
 10290 00004298 E99C00                  		jmp	_SETRET
 10291                                  ; ---------------------------------------------------------------------------
 10292                                  
 10293                                  NEXT_ONE:				; ...
 10294 0000429B 57                      		push	di
 10295 0000429C 89D7                    		mov	di, dx
 10296 0000429E 8ED9                    		mov	ds, cx
 10297                                  
 10298                                  SetDir:					; ...
 10299 000042A0 8B14                    		mov	dx, [si]
 10300 000042A2 1E                      		push	ds
 10301 000042A3 16                      		push	ss
 10302 000042A4 1F                      		pop	ds
 10303 000042A5 F606[3A0D]02            		test	byte [FastOpenFlg],	2
 10304 000042AA 7410                    		jz	short DO_NORMAL
 10305 000042AC 89D3                    		mov	bx, dx
 10306 000042AE 8B3E[BC05]              		mov	di, [CLUSNUM]
 10307 000042B2 50                      		push	ax
 10308 000042B3 E881FD                  		call	SETDIRSRCH
 10309 000042B6 58                      		pop	ax
 10310 000042B7 83C402                  		add	sp, 2
 10311 000042BA EB3D                    		jmp	short FAST_OPEN_SKIP
 10312                                  ; ---------------------------------------------------------------------------
 10313                                  
 10314                                  DO_NORMAL:				; ...
 10315 000042BC 1F                      		pop	ds
 10316 000042BD 29FB                    		sub	bx, di
 10317 000042BF 29FE                    		sub	si, di
 10318 000042C1 53                      		push	bx
 10319 000042C2 50                      		push	ax
 10320 000042C3 56                      		push	si
 10321 000042C4 51                      		push	cx
 10322 000042C5 FF7506                  		push	word [di+6]
 10323 000042C8 FF7508                  		push	word [di+8]
 10324 000042CB 89D3                    		mov	bx, dx
 10325 000042CD 16                      		push	ss
 10326 000042CE 1F                      		pop	ds
 10327 000042CF E865FD                  		call	SETDIRSRCH
 10328 000042D2 8F06[0706]              		pop	word [HIGH_SECTOR]
 10329 000042D6 5A                      		pop	dx
 10330 000042D7 720A                    		jb	short SKIP_GETB
 10331 000042D9 C606[4B03]18            		mov	byte [ALLOWED], 18h
 10332 000042DE 30C0                    		xor	al, al
 10333 000042E0 E87418                  		call	GETBUFFR
 10334                                  
 10335                                  SKIP_GETB:				; ...
 10336 000042E3 59                      		pop	cx
 10337 000042E4 5E                      		pop	si
 10338 000042E5 58                      		pop	ax
 10339 000042E6 5B                      		pop	bx
 10340 000042E7 7305                    		jnb	short SET_THE_BUF
 10341 000042E9 5F                      		pop	di
 10342 000042EA 89FE                    		mov	si, di
 10343 000042EC EB21                    		jmp	short _BADPATH
 10344                                  ; ---------------------------------------------------------------------------
 10345                                  
 10346                                  SET_THE_BUF:				; ...
 10347 000042EE E83DF5                  		call	SET_BUF_AS_DIR
 10348 000042F1 8B3E[E205]              		mov	di, word [CURBUF]
 10349 000042F5 01FE                    		add	si, di
 10350 000042F7 01FB                    		add	bx, di
 10351                                  
 10352                                  FAST_OPEN_SKIP:				; ...
 10353 000042F9 5F                      		pop	di
 10354 000042FA E8A002                  		call	InsertPath
 10355 000042FD 8A05                    		mov	al, [di]
 10356 000042FF 08C0                    		or	al, al
 10357 00004301 7434                    		jz	short _SETRET
 10358 00004303 47                      		inc	di
 10359 00004304 89FE                    		mov	si, di
 10360 00004306 E87E0F                  		call	PATHCHRCMP
 10361 00004309 7503                    		jnz	short find_bad_name
 10362 0000430B E9A5FE                  		jmp	FINDPATH
 10363                                  ; ---------------------------------------------------------------------------
 10364                                  
 10365                                  find_bad_name:				; ...
 10366 0000430E 4E                      		dec	si
 10367                                  
 10368                                  _BADPATH:				; ...
 10369 0000430F 30C9                    		xor	cl, cl
 10370 00004311 EB2C                    		jmp	short BADPRET
 10371                                  ; ---------------------------------------------------------------------------
 10372                                  
 10373                                  FILEINPATH:				; ...
 10374 00004313 5F                      		pop	di
 10375 00004314 16                      		push	ss
 10376 00004315 1F                      		pop	ds
 10377 00004316 F606[3A0D]01            		test	byte [FastOpenFlg],	1
 10378 0000431B 740B                    		jz	short NO_FAST
 10379 0000431D F606[3A0D]02            		test	byte [FastOpenFlg],	2
 10380 00004322 7404                    		jz	short NO_FAST
 10381 00004324 8B3E[660D]              		mov	di, [Next_Element_Start]
 10382                                  
 10383                                  NO_FAST:				; ...
 10384 00004328 8A05                    		mov	al, [di]
 10385 0000432A 08C0                    		or	al, al
 10386 0000432C 7404                    		jz	short INCRET
 10387 0000432E 89FE                    		mov	si, di
 10388 00004330 EB0D                    		jmp	short BADPRET
 10389                                  ; ---------------------------------------------------------------------------
 10390                                  
 10391                                  INCRET:					; ...
 10392 00004332 E86802                  		call	InsertPath
 10393 00004335 FEC0                    		inc	al
 10394                                  
 10395                                  _SETRET:				; ...
 10396 00004337 C3                      		retn
 10397                                  ; ---------------------------------------------------------------------------
 10398                                  
 10399                                  BADPATHPOP:				; ...
 10400 00004338 5E                      		pop	si
 10401 00004339 8A04                    		mov	al, [si]
 10402 0000433B 89FE                    		mov	si, di
 10403 0000433D 08C0                    		or	al, al
 10404                                  
 10405                                  BADPRET:				; ...
 10406 0000433F A0[6D05]                		mov	al, [SATTRIB]
 10407 00004342 A2[6B05]                		mov	byte [ATTRIB], al
 10408 00004345 F9                      		stc
 10409 00004346 C3                      		retn
 10410                                  ; END OF FUNCTION CHUNK	FOR GETPATH
 10411                                  
 10412                                  ; =============== S U B	R O U T	I N E =======================================
 10413                                  
 10414                                  
 10415                                  STARTSRCH:
 10416 00004347 C42E[8A05]              		les	bp, [THISDPB]
 10417 0000434B 31C0                    		xor	ax, ax
 10418 0000434D A3[4803]                		mov	word [LASTENT], ax
 10419 00004350 A2[7B05]                		mov	byte [VOLID], al
 10420 00004353 48                      		dec	ax
 10421 00004354 A3[D805]                		mov	[ENTFREE], ax
 10422 00004357 A3[DA05]                		mov	[ENTLAST], ax
 10423 0000435A C3                      		retn
 10424                                  
 10425                                  ; =============== S U B	R O U T	I N E =======================================
 10426                                  
 10427                                  
 10428                                  MatchAttributes:
 10429 0000435B 50                      		push	ax
 10430 0000435C 36A0[6B05]              		mov	al, [ss:ATTRIB]
 10431 00004360 F6D0                    		not	al
 10432 00004362 20E8                    		and	al, ch
 10433 00004364 2416                    		and	al, 16h
 10434 00004366 58                      		pop	ax
 10435 00004367 C3                      		retn
 10436                                  
 10437                                  ; =============== S U B	R O U T	I N E =======================================
 10438                                  
 10439                                  
 10440                                  DEVNAME	:
 10441 00004368 56                      		push	si
 10442 00004369 57                      		push	di
 10443 0000436A 51                      		push	cx
 10444 0000436B 50                      		push	ax
 10445 0000436C FF36[4B05]              		push	word [NAME1]
 10446 00004370 803E[4B05]05            		cmp	byte [NAME1], 5
 10447 00004375 7505                    		jnz	short NOKTR
 10448 00004377 C606[4B05]E5            		mov	byte [NAME1], 0E5h
 10449                                  
 10450                                  NOKTR:					; ...
 10451 0000437C F606[6B05]08            		test	byte [ATTRIB], 8
 10452 00004381 7522                    		jnz	short RET31
 10453 00004383 BE[4800]                		mov	si, NULDEV
 10454                                  
 10455                                  LOOKIO:					; ...
 10456 00004386 F744040080              		test	word [si+4], 8000h
 10457 0000438B 7411                    		jz	short SKIPDEV
 10458 0000438D 89F0                    		mov	ax, si
 10459 0000438F 83C60A                  		add	si, 10
 10460 00004392 BF[4B05]                		mov	di, NAME1
 10461 00004395 B90400                  		mov	cx, 4
 10462 00004398 F3A7                    		repe cmpsw
 10463 0000439A 89C6                    		mov	si, ax
 10464 0000439C 7415                    		jz	short IOCHK
 10465                                  
 10466                                  SKIPDEV:				; ...
 10467 0000439E C534                    		lds	si, [si]
 10468 000043A0 83FEFF                  		cmp	si, 0FFFFh
 10469 000043A3 75E1                    		jnz	short LOOKIO
 10470                                  
 10471                                  RET31:					; ...
 10472 000043A5 F9                      		stc
 10473                                  
 10474                                  RETNV:					; ...
 10475 000043A6 8CD1                    		mov	cx, ss
 10476 000043A8 8ED9                    		mov	ds, cx
 10477 000043AA 8F06[4B05]              		pop	word [NAME1]
 10478 000043AE 58                      		pop	ax
 10479 000043AF 59                      		pop	cx
 10480 000043B0 5F                      		pop	di
 10481 000043B1 5E                      		pop	si
 10482 000043B2 C3                      		retn
 10483                                  ; ---------------------------------------------------------------------------
 10484                                  
 10485                                  IOCHK:					; ...
 10486 000043B3 368C1E[9C05]            		mov	word [ss:DEVPT+2], ds
 10487 000043B8 8A7C04                  		mov	bh, [si+4]
 10488 000043BB 80CFC0                  		or	bh, 0C0h
 10489 000043BE 80E7DF                  		and	bh, 0DFh
 10490 000043C1 368936[9A05]            		mov	word [ss:DEVPT], si
 10491 000043C6 EBDE                    		jmp	short RETNV
 10492                                  
 10493                                  ; =============== S U B	R O U T	I N E =======================================
 10494                                  
 10495                                  
 10496                                  Build_device_ent:
 10497 000043C8 B82020                  		mov	ax, 2020h
 10498 000043CB BF[5305]                		mov	di, NAME1+8 ; DEVFCB+8
 10499 000043CE AB                      		stosw
 10500 000043CF AA                      		stosb
 10501 000043D0 B040                    		mov	al, 40h
 10502 000043D2 AA                      		stosb
 10503 000043D3 31C0                    		xor	ax, ax
 10504 000043D5 B90A00                  		mov	cx, 10
 10505 000043D8 F3AB                    		rep stosw
 10506 000043DA E811C7                  		call	DATE16
 10507 000043DD BF[6105]                		mov	di, NAME2+0Ah
 10508 000043E0 92                      		xchg	ax, dx
 10509 000043E1 AB                      		stosw
 10510 000043E2 92                      		xchg	ax, dx
 10511 000043E3 AB                      		stosw
 10512 000043E4 89FE                    		mov	si, di
 10513 000043E6 A1[9A05]                		mov	ax, word [DEVPT]
 10514 000043E9 AB                      		stosw
 10515 000043EA A1[9C05]                		mov	ax, word [DEVPT+2]
 10516 000043ED AB                      		stosw
 10517 000043EE 88FC                    		mov	ah, bh
 10518 000043F0 BB[4B05]                		mov	bx, NAME1
 10519 000043F3 30C0                    		xor	al, al
 10520 000043F5 C3                      		retn
 10521                                  
 10522                                  ; =============== S U B	R O U T	I N E =======================================
 10523                                  
 10524                                  ; Attributes: bp-based frame
 10525                                  
 10526                                  ValidateCDS:
 10527                                  
 10528                                  ;SaveCDS	= dword	ptr -6
 10529                                  ;Temp		= word ptr -2
 10530                                  
 10531                                  SaveCDS	equ -6
 10532                                  Temp	equ -2
 10533 000043F6 55                      		push	bp
 10534 000043F7 89E5                    		mov	bp, sp
 10535 000043F9 83EC06                  		sub	sp, 6
 10536 000043FC 897EFE                  		mov	[bp+Temp], di
 10537 000043FF 36C536[A205]            		lds	si, [ss:THISCDS]
 10538 00004404 8976FA                  		mov	word [bp+SaveCDS], si
 10539 00004407 8C5EFC                  		mov	word [bp+SaveCDS+2], ds
 10540 0000440A E84DCF                  		call	ECritDisk
 10541 0000440D F744430080              		test	word [si+43h], 8000h
 10542 00004412 7403                    		jz	short _DoSplice
 10543 00004414 E99300                  		jmp	FatFail
 10544                                  ; ---------------------------------------------------------------------------
 10545                                  
 10546                                  _DoSplice:				; ...
 10547 00004417 30D2                    		xor	dl, dl
 10548 00004419 368616[4C03]            		xchg	dl, [ss:NoSetDir]
 10549 0000441E 16                      		push	ss
 10550 0000441F 07                      		pop	es
 10551 00004420 E805CE                  		call	FStrCpy
 10552 00004423 8B76FE                  		mov	si, [bp+Temp]
 10553 00004426 16                      		push	ss
 10554 00004427 1F                      		pop	ds
 10555 00004428 E8172C                  		call	Splice
 10556 0000442B 16                      		push	ss
 10557 0000442C 1F                      		pop	ds
 10558 0000442D 8816[4C03]              		mov	byte [NoSetDir], dl
 10559 00004431 C43E[A205]              		les	di, [THISCDS]
 10560 00004435 55                      		push	bp
 10561 00004436 E8AC14                  		call	FATREAD_CDS
 10562 00004439 5D                      		pop	bp
 10563 0000443A 726E                    		jb	short FatFail
 10564 0000443C C536[A205]              		lds	si, [THISCDS]
 10565 00004440 837C49FF                		cmp	word [si+49h], 0FFFFh
 10566 00004444 7556                    		jnz	short RestoreCDS
 10567 00004446 16                      		push	ss
 10568 00004447 07                      		pop	es
 10569 00004448 36FF36[B205]            		push	word [ss:WFP_START]
 10570 0000444D 3B76FA                  		cmp	si, word [bp+SaveCDS]
 10571 00004450 750B                    		jnz	short DoChdir
 10572 00004452 8B7EFE                  		mov	di, [bp+Temp]
 10573 00004455 36893E[B205]            		mov	[ss:WFP_START], di
 10574 0000445A E8CBCD                  		call	FStrCpy
 10575                                  
 10576                                  DoChdir:				; ...
 10577 0000445D 16                      		push	ss
 10578 0000445E 1F                      		pop	ds
 10579 0000445F FF36[6D05]              		push	word [SATTRIB]
 10580 00004463 55                      		push	bp
 10581 00004464 E893EE                  		call	DOS_CHDIR
 10582 00004467 5D                      		pop	bp
 10583 00004468 5B                      		pop	bx
 10584 00004469 8F06[B205]              		pop	word [WFP_START]
 10585 0000446D 881E[6D05]              		mov	byte [SATTRIB], bl
 10586 00004471 C576FA                  		lds	si, [bp+SaveCDS]
 10587 00004474 730F                    		jnb	short SetCluster
 10588 00004476 368936[A205]            		mov	word [ss:THISCDS], si
 10589 0000447B 368C1E[A405]            		mov	word [ss:THISCDS+2], ds
 10590 00004480 31C9                    		xor	cx, cx
 10591 00004482 884C03                  		mov	[si+3],	cl
 10592                                  
 10593                                  SetCluster:				; ...
 10594 00004485 C74449FFFF              		mov	word [si+49h], 0FFFFh
 10595 0000448A 36C536[A205]            		lds	si, [ss:THISCDS]
 10596 0000448F F744430020              		test	word [si+43h], 2000h
 10597 00004494 7403                    		jz	short _setdirclus
 10598 00004496 B9FFFF                  		mov	cx, 0FFFFh
 10599                                  
 10600                                  _setdirclus:				; ...
 10601 00004499 894C49                  		mov	[si+49h], cx
 10602                                  
 10603                                  RestoreCDS:				; ...
 10604 0000449C C47EFA                  		les	di, [bp+SaveCDS]
 10605 0000449F 36893E[A205]            		mov	word [ss:THISCDS], di
 10606 000044A4 368C06[A405]            		mov	word [ss:THISCDS+2], es
 10607 000044A9 F8                      		clc
 10608                                  
 10609                                  FatFail:				; ...
 10610 000044AA E8CDCE                  		call	LCritDisk
 10611 000044AD C47EFA                  		les	di, [bp+SaveCDS]
 10612 000044B0 89EC                    		mov	sp, bp
 10613 000044B2 5D                      		pop	bp
 10614 000044B3 C3                      		retn
 10615                                  
 10616                                  ; =============== S U B	R O U T	I N E =======================================
 10617                                  
 10618                                  
 10619                                  CheckThisDevice:
 10620 000044B4 57                      		push	di
 10621 000044B5 56                      		push	si
 10622 000044B6 89F7                    		mov	di, si
 10623 000044B8 8A04                    		mov	al, [si]
 10624 000044BA E8CA0D                  		call	PATHCHRCMP
 10625 000044BD 7517                    		jnz	short ParseDev
 10626 000044BF 46                      		inc	si
 10627 000044C0 AD                      		lodsw
 10628 000044C1 0D2020                  		or	ax, 2020h
 10629 000044C4 3D6465                  		cmp	ax, 'de'        ; 'ed'
 10630 000044C7 752D                    		jnz	short NotDevice
 10631 000044C9 AC                      		lodsb
 10632 000044CA 0C20                    		or	al, 20h
 10633 000044CC 3C76                    		cmp	al, 'v'
 10634 000044CE 7526                    		jnz	short NotDevice
 10635 000044D0 AC                      		lodsb
 10636 000044D1 E8B30D                  		call	PATHCHRCMP
 10637 000044D4 7520                    		jnz	short NotDevice
 10638                                  
 10639                                  ParseDev:				; ...
 10640 000044D6 1E                      		push	ds
 10641 000044D7 56                      		push	si
 10642 000044D8 E8EA0C                  		call	NAMETRANS
 10643 000044DB 803C00                  		cmp	byte [si], 0
 10644 000044DE F9                      		stc
 10645 000044DF 750B                    		jnz	short SkipSearch
 10646 000044E1 16                      		push	ss
 10647 000044E2 1F                      		pop	ds
 10648 000044E3 A0[6D05]                		mov	al, [SATTRIB]
 10649 000044E6 A2[6B05]                		mov	byte [ATTRIB], al
 10650 000044E9 E87CFE                  		call	DEVNAME
 10651                                  
 10652                                  SkipSearch:				; ...
 10653 000044EC 5E                      		pop	si
 10654 000044ED 1F                      		pop	ds
 10655                                  
 10656                                  CheckReturn:				; ...
 10657 000044EE 5F                      		pop	di
 10658 000044EF 7302                    		jnb	short Check_Done
 10659 000044F1 89FE                    		mov	si, di
 10660                                  
 10661                                  Check_Done:				; ...
 10662 000044F3 5F                      		pop	di
 10663 000044F4 F5                      		cmc
 10664 000044F5 C3                      		retn
 10665                                  ; ---------------------------------------------------------------------------
 10666                                  
 10667                                  NotDevice:				; ...
 10668 000044F6 F9                      		stc
 10669 000044F7 EBF5                    		jmp	short CheckReturn
 10670                                  
 10671                                  ; =============== S U B	R O U T	I N E =======================================
 10672                                  
 10673                                  
 10674                                  LookupPath:
 10675 000044F9 36F606[3A0D]01          		test	byte [ss:FastOpenFlg], 1
 10676 000044FF 7503                    		jnz	short FASTINST
 10677                                  
 10678                                  NOLOOK:					; ...
 10679 00004501 E99700                  		jmp	NOLOOKUP
 10680                                  ; ---------------------------------------------------------------------------
 10681                                  
 10682                                  FASTINST:				; ...
 10683 00004504 36F606[3A0D]08          		test	byte [ss:FastOpenFlg], 8
 10684 0000450A 75F5                    		jnz	short NOLOOK
 10685 0000450C BB[300D]                		mov	bx, FastOpenTable
 10686 0000450F 368B36[B205]            		mov	si, [ss:WFP_START]
 10687 00004514 BF[460D]                		mov	di, Dir_Info_Buff
 10688 00004517 B9[3B0D]                		mov	cx, FastOpen_Ext_Info
 10689 0000451A B001                    		mov	al, 1
 10690 0000451C 1E                      		push	ds
 10691 0000451D 07                      		pop	es
 10692 0000451E FF5F02                  		call	far [bx+2]
 10693 00004521 7267                    		jb	short NOTFOUND
 10694 00004523 8D5CFE                  		lea	bx, [si-2]
 10695 00004526 363B1E[B205]            		cmp	bx, [ss:WFP_START]
 10696 0000452B 745D                    		jz	short NOTFOUND
 10697 0000452D 803C00                  		cmp	byte [si], 0
 10698 00004530 751A                    		jnz	short parfnd
 10699 00004532 51                      		push	cx
 10700 00004533 368A0E[6B05]            		mov	cl, [ss:ATTRIB]
 10701 00004538 368A2E[6D05]            		mov	ch, [ss:SATTRIB]
 10702 0000453D 36882E[6B05]            		mov	byte [ss:ATTRIB], ch
 10703 00004542 268A6D0B                		mov	ch, [es:di+0Bh]
 10704 00004546 E812FE                  		call	MatchAttributes
 10705 00004549 59                      		pop	cx
 10706 0000454A 754F                    		jnz	short NOLOOKUP
 10707                                  
 10708                                  parfnd:					; ...
 10709 0000454C 368936[660D]            		mov	[ss:Next_Element_Start], si
 10710 00004551 89CB                    		mov	bx, cx
 10711 00004553 8B4707                  		mov	ax, [bx+7]
 10712 00004556 36A3[4803]              		mov	word [ss:LASTENT], ax
 10713 0000455A 8B4709                  		mov	ax, [bx+9]
 10714 0000455D 36A3[C205]              		mov	word [ss:DIRSTART], ax
 10715 00004561 8B4705                  		mov	ax, [bx+5]
 10716 00004564 36A3[BC05]              		mov	[ss:CLUSNUM], ax
 10717 00004568 06                      		push	es
 10718 00004569 36C41E[8A05]            		les	bx, [ss:THISDPB]
 10719 0000456E 268A27                  		mov	ah, [es:bx]
 10720 00004571 07                      		pop	es
 10721 00004572 36C706[E205]0000        		mov	word [ss:CURBUF], 0
 10722 00004579 368C06[E405]            		mov	word [ss:CURBUF+2], es
 10723 0000457E 89FB                    		mov	bx, di
 10724 00004580 8D751A                  		lea	si, [di+1Ah]
 10725 00004583 36800E[3A0D]12          		or	byte [ss:FastOpenFlg], 12h
 10726 00004589 C3                      		retn
 10727                                  ; ---------------------------------------------------------------------------
 10728                                  
 10729                                  NOTFOUND:				; ...
 10730 0000458A 83F8FF                  		cmp	ax, 0FFFFh
 10731 0000458D 7506                    		jnz	short Partial_Success
 10732 0000458F 36C606[3A0D]00          		mov	byte [ss:FastOpenFlg], 0
 10733                                  
 10734                                  Partial_Success:			; ...
 10735 00004595 368026[3A0D]FB          		and	byte [ss:FastOpenFlg], 0FBh
 10736                                  
 10737                                  NOLOOKUP:				; ...
 10738 0000459B F9                      		stc
 10739 0000459C C3                      		retn
 10740                                  
 10741                                  ; =============== S U B	R O U T	I N E =======================================
 10742                                  
 10743                                  
 10744                                  InsertPath:
 10745 0000459D 9C                      		pushf
 10746 0000459E 36F606[3A0D]01          		test	byte [ss:FastOpenFlg], 1
 10747 000045A4 7479                    		jz	short GET_NEXT_ELEMENT
 10748 000045A6 36F606[3A0D]02          		test	byte [ss:FastOpenFlg], 2
 10749 000045AC 740D                    		jz	short INSERT_DIR_INFO
 10750 000045AE 368026[3A0D]FD          		and	byte [ss:FastOpenFlg], 0FDh
 10751 000045B4 368B3E[660D]            		mov	di, [ss:Next_Element_Start]
 10752 000045B9 EB5E                    		jmp	short GET_NEXT2
 10753                                  ; ---------------------------------------------------------------------------
 10754                                  
 10755                                  INSERT_DIR_INFO:
 10756 000045BB 1E                      		push	ds
 10757 000045BC 06                      		push	es
 10758 000045BD 53                      		push	bx
 10759 000045BE 56                      		push	si
 10760 000045BF 57                      		push	di
 10761 000045C0 51                      		push	cx
 10762 000045C1 50                      		push	ax
 10763 000045C2 36C53E[E205]            		lds	di, [ss:CURBUF]
 10764 000045C7 BE[3B0D]                		mov	si, FastOpen_Ext_Info
 10765 000045CA 8B4506                  		mov	ax, [di+6]
 10766 000045CD 36894401                		mov	[ss:si+1], ax
 10767 000045D1 8B4508                  		mov	ax, [di+8]
 10768 000045D4 16                      		push	ss
 10769 000045D5 1F                      		pop	ds
 10770 000045D6 894403                  		mov	[si+3],	ax
 10771 000045D9 A1[BC05]                		mov	ax, [CLUSNUM]
 10772 000045DC 894405                  		mov	[si+5],	ax
 10773 000045DF A1[4803]                		mov	ax, [LASTENT]
 10774 000045E2 894407                  		mov	[si+7],	ax
 10775 000045E5 A1[C205]                		mov	ax, [DIRSTART]
 10776 000045E8 894409                  		mov	[si+9],	ax
 10777 000045EB 89D8                    		mov	ax, bx
 10778 000045ED 83C714                  		add	di, 20
 10779 000045F0 29F8                    		sub	ax, di
 10780 000045F2 B120                    		mov	cl, 32
 10781 000045F4 F6F1                    		div	cl
 10782 000045F6 8804                    		mov	[si], al
 10783 000045F8 1E                      		push	ds
 10784 000045F9 07                      		pop	es
 10785 000045FA 8E1E[E405]              		mov	ds, word [CURBUF+2]
 10786 000045FE 89DF                    		mov	di, bx
 10787 00004600 837D1A00                		cmp	word [di+1Ah], 0
 10788 00004604 740C                    		jz	short SKIP_INSERT
 10789 00004606 56                      		push	si
 10790 00004607 5B                      		pop	bx
 10791 00004608 B002                    		mov	al, 2
 10792 0000460A BE[300D]                		mov	si, FastOpenTable
 10793 0000460D 26FF5C02                		call	far [es:si+2]
 10794 00004611 F8                      		clc
 10795                                  
 10796                                  SKIP_INSERT:
 10797 00004612 58                      		pop	ax
 10798 00004613 59                      		pop	cx
 10799 00004614 5F                      		pop	di
 10800 00004615 5E                      		pop	si
 10801 00004616 5B                      		pop	bx
 10802 00004617 07                      		pop	es
 10803 00004618 1F                      		pop	ds
 10804                                  
 10805                                  GET_NEXT2:
 10806 00004619 36800E[3A0D]08          		or	byte [ss:FastOpenFlg], 8
 10807                                  
 10808                                  GET_NEXT_ELEMENT:
 10809 0000461F 9D                      		popf
 10810 00004620 C3                      		retn
 10811                                  
 10812                                  ; ---------------------------------------------------------------------------
 10813 00004621 160E160D0F0E            LenTab:		db 22, 14, 22, 13, 15, 14 ; ...
 10814 00004627 8604                    CmdTab:		db 86h,	4		; ...
 10815 00004629 8605                    		db 86h,	5
 10816 0000462B 8708                    		db 87h,	8
 10817 0000462D 870A                    		db 87h,	0Ah
 10818 0000462F 8607                    		db 86h,	7
 10819 00004631 8605                    		db 86h,	5
 10820                                  
 10821                                  ; =============== S U B	R O U T	I N E =======================================
 10822                                  
 10823                                  
 10824                                  IOFUNC:
 10825 00004633 368C16[8C03]            		mov	word [ss:IOXAD+2], ss
 10826 00004638 36C706[8A03][BC03]      		mov	word [ss:IOXAD], DEVIOBUF
 10827 0000463F 36C706[8E03]0100        		mov	word [ss:IOSCNT], 1
 10828 00004646 36A3[BC03]              		mov	[ss:DEVIOBUF], ax
 10829 0000464A F6440680                		test	byte [si+6], 80h
 10830 0000464E 7403                    		jz	short IOTO22
 10831 00004650 E9A600                  		jmp	IOTOFILE
 10832                                  ; ---------------------------------------------------------------------------
 10833                                  
 10834                                  IOTO22:					; ...
 10835 00004653 F6440580                		test	byte [si+5], 80h
 10836 00004657 7503                    		jnz	short IOTO33
 10837 00004659 E99D00                  		jmp	IOTOFILE
 10838                                  ; ---------------------------------------------------------------------------
 10839                                  
 10840                                  IOTO33:					; ...
 10841 0000465C 06                      		push	es
 10842 0000465D E823BE                  		call	save_world
 10843 00004660 8CDA                    		mov	dx, ds
 10844 00004662 8CD3                    		mov	bx, ss
 10845 00004664 8EDB                    		mov	ds, bx
 10846 00004666 8EC3                    		mov	es, bx
 10847 00004668 31DB                    		xor	bx, bx
 10848 0000466A 80FC05                  		cmp	ah, 5
 10849 0000466D 7504                    		jnz	short _no_sys_wait
 10850 0000466F 81CB0004                		or	bx, 400h
 10851                                  
 10852                                  _no_sys_wait:				; ...
 10853 00004673 891E[7F03]              		mov	[IOCALL_REQSTAT], bx
 10854 00004677 31DB                    		xor	bx, bx
 10855 00004679 881E[8903]              		mov	byte [IOMED], bl
 10856 0000467D 88E3                    		mov	bl, ah
 10857 0000467F 2E8AA7[2146]            		mov	ah, [cs:LenTab+bx]
 10858 00004684 D1E3                    		shl	bx, 1
 10859 00004686 2E8B8F[2746]            		mov	cx, word [cs:CmdTab+bx]
 10860 0000468B BB[7C03]                		mov	bx, IOCALL
 10861 0000468E 8826[7C03]              		mov	byte [IOCALL], ah
 10862 00004692 882E[7E03]              		mov	byte [IOCALL_REQFUNC], ch
 10863 00004696 8EDA                    		mov	ds, dx
 10864 00004698 E86F01                  		call	DEVIOCALL
 10865 0000469B 368B3E[7F03]            		mov	di, [ss:IOCALL_REQSTAT]
 10866 000046A0 21FF                    		and	di, di
 10867 000046A2 7834                    		js	short DevErr
 10868                                  
 10869                                  OKDevIO:				; ...
 10870 000046A4 8CD0                    		mov	ax, ss
 10871 000046A6 8ED8                    		mov	ds, ax
 10872 000046A8 80FD05                  		cmp	ch, 5
 10873 000046AB 7506                    		jnz	short DNODRD
 10874 000046AD A0[8903]                		mov	al, [IOMED]
 10875 000046B0 A2[BC03]                		mov	byte [DEVIOBUF], al
 10876                                  
 10877                                  DNODRD:					; ...
 10878 000046B3 8A26[8003]              		mov	ah, byte [IOCALL_REQSTAT+1]
 10879 000046B7 F6D4                    		not	ah
 10880 000046B9 80E402                  		and	ah, 2
 10881                                  
 10882                                  QuickReturn:
 10883 000046BC E8ADBD                  		call	restore_world
 10884 000046BF 07                      		pop	es
 10885 000046C0 9C                      		pushf
 10886 000046C1 36A0[8300]              		mov	al, [ss:IoStatFail]
 10887 000046C5 98                      		cbw
 10888 000046C6 83F8FF                  		cmp	ax, 0FFFFh
 10889 000046C9 7507                    		jnz	short not_fail_ret
 10890 000046CB 36FE06[8300]            		inc	byte [ss:IoStatFail]
 10891 000046D0 9D                      		popf
 10892 000046D1 C3                      		retn
 10893                                  ; ---------------------------------------------------------------------------
 10894                                  
 10895                                  not_fail_ret:				; ...
 10896 000046D2 36A1[BC03]              		mov	ax, [ss:DEVIOBUF]
 10897 000046D6 9D                      		popf
 10898 000046D7 C3                      		retn
 10899                                  ; ---------------------------------------------------------------------------
 10900                                  
 10901                                  DevErr:					; ...
 10902 000046D8 88CC                    		mov	ah, cl
 10903 000046DA E8E80D                  		call	CHARHARD
 10904 000046DD 3C01                    		cmp	al, 1
 10905 000046DF 7507                    		jnz	short NO_RETRY
 10906 000046E1 E888BD                  		call	restore_world
 10907 000046E4 07                      		pop	es
 10908 000046E5 E94BFF                  		jmp	IOFUNC
 10909                                  ; ---------------------------------------------------------------------------
 10910                                  
 10911                                  NO_RETRY:				; ...
 10912 000046E8 368026[8003]FD          		and	byte [ss:IOCALL_REQSTAT+1], 0FDh
 10913 000046EE 3C03                    		cmp	al, 3
 10914 000046F0 7505                    		jnz	short not_fail
 10915 000046F2 36FE0E[8300]            		dec	byte [ss:IoStatFail]
 10916                                  
 10917                                  not_fail:				; ...
 10918 000046F7 EBAB                    		jmp	short OKDevIO
 10919                                  ; ---------------------------------------------------------------------------
 10920                                  
 10921                                  IOTOFILE:				; ...
 10922 000046F9 08E4                    		or	ah, ah
 10923 000046FB 7423                    		jz	short IOIN
 10924 000046FD FECC                    		dec	ah
 10925 000046FF 7405                    		jz	short IOIST
 10926 00004701 FECC                    		dec	ah
 10927 00004703 7411                    		jz	short IOUT
 10928 00004705 C3                      		retn
 10929                                  ; ---------------------------------------------------------------------------
 10930                                  
 10931                                  IOIST:					; ...
 10932 00004706 FF7415                  		push	word [si+15h]
 10933 00004709 FF7417                  		push	word [si+17h]
 10934 0000470C E81100                  		call	IOIN
 10935 0000470F 8F4417                  		pop	word [si+17h]
 10936 00004712 8F4415                  		pop	word [si+15h]
 10937 00004715 C3                      		retn
 10938                                  ; ---------------------------------------------------------------------------
 10939                                  
 10940                                  IOUT:					; ...
 10941 00004716 E82700                  		call	SETXADDR
 10942 00004719 E830EF                  		call	DOS_WRITE
 10943 0000471C E85500                  		call	RESTXADDR
 10944                                  
 10945                                  IOUT_retn:				; ...
 10946 0000471F C3                      		retn
 10947                                  
 10948                                  ; =============== S U B	R O U T	I N E =======================================
 10949                                  
 10950                                  
 10951                                  IOIN:
 10952 00004720 E81D00                  		call	SETXADDR
 10953 00004723 36830E[1106]40          		or	word [ss:DOS34_FLAG], 40h
 10954 00004729 E8F1EC                  		call	DOS_READ
 10955 0000472C 368326[1106]BF          		and	word [ss:DOS34_FLAG], 0FFBFh
 10956 00004732 09C9                    		or	cx, cx
 10957 00004734 E83D00                  		call	RESTXADDR
 10958 00004737 36A0[BC03]              		mov	al, byte [ss:DEVIOBUF]
 10959 0000473B 75E2                    		jnz	short IOUT_retn
 10960 0000473D B01A                    		mov	al, 1Ah
 10961 0000473F C3                      		retn
 10962                                  
 10963                                  ; =============== S U B	R O U T	I N E =======================================
 10964                                  
 10965                                  
 10966                                  SETXADDR:
 10967 00004740 368F06[6C03]            		pop	word [ss:CALLBPB]
 10968 00004745 06                      		push	es
 10969 00004746 E83ABD                  		call	save_world
 10970 00004749 36FF36[2C03]            		push	word [ss:DMAADD]
 10971 0000474E 36FF36[2E03]            		push	word [ss:DMAADD+2]
 10972 00004753 368C1E[A005]            		mov	word [ss:THISSFT+2], ds
 10973 00004758 16                      		push	ss
 10974 00004759 1F                      		pop	ds
 10975 0000475A 8936[9E05]              		mov	word [THISSFT], si
 10976 0000475E 8B0E[8C03]              		mov	cx, word [IOXAD+2]
 10977 00004762 890E[2E03]              		mov	word [DMAADD+2], cx
 10978 00004766 8B0E[8A03]              		mov	cx, word [IOXAD]
 10979 0000476A 890E[2C03]              		mov	word [DMAADD], cx
 10980 0000476E 8B0E[8E03]              		mov	cx, [IOSCNT]
 10981 00004772 EB10                    		jmp	short RESTRET
 10982                                  
 10983                                  ; =============== S U B	R O U T	I N E =======================================
 10984                                  
 10985                                  
 10986                                  RESTXADDR:
 10987 00004774 8F06[6C03]              		pop	word [CALLBPB]
 10988 00004778 8F06[2E03]              		pop	word [DMAADD+2]
 10989 0000477C 8F06[2C03]              		pop	word [DMAADD]
 10990 00004780 E8E9BC                  		call	restore_world
 10991 00004783 07                      		pop	es
 10992                                  
 10993                                  RESTRET:				; ...
 10994 00004784 36FF26[6C03]            		jmp	word [ss:CALLBPB]
 10995                                  
 10996                                  ; =============== S U B	R O U T	I N E =======================================
 10997                                  
 10998                                  
 10999                                  DEV_OPEN_SFT:
 11000 00004789 06                      		push	es
 11001 0000478A E8F6BC                  		call	save_world
 11002 0000478D B00D                    		mov	al, 0Dh
 11003 0000478F EB06                    		jmp	short DO_OPCLS
 11004                                  
 11005                                  ; =============== S U B	R O U T	I N E =======================================
 11006                                  
 11007                                  
 11008                                  DEV_CLOSE_SFT:
 11009 00004791 06                      		push	es
 11010 00004792 E8EEBC                  		call	save_world
 11011 00004795 B00E                    		mov	al, 0Eh
 11012                                  
 11013                                  DO_OPCLS:				; ...
 11014 00004797 26F6450680              		test	byte [es:di+6], 80h
 11015 0000479C 7567                    		jnz	short OPCLS_DONE
 11016 0000479E 30E4                    		xor	ah, ah
 11017 000047A0 26F6450580              		test	byte [es:di+5], 80h
 11018 000047A5 26C47D07                		les	di, [es:di+7]
 11019 000047A9 7513                    		jnz	short GOT_DEV_ADDR
 11020 000047AB 36803E[0303]01          		cmp	byte [ss:fShare], 1
 11021 000047B1 7652                    		jbe	short OPCLS_DONE
 11022 000047B3 268A6501                		mov	ah, [es:di+1]
 11023 000047B7 268A0D                  		mov	cl, [es:di]
 11024 000047BA 26C47D13                		les	di, [es:di+13h]
 11025                                  
 11026                                  GOT_DEV_ADDR:				; ...
 11027 000047BE 26F6450508              		test	byte [es:di+5], 8
 11028 000047C3 7440                    		jz	short OPCLS_DONE
 11029 000047C5 06                      		push	es
 11030 000047C6 1F                      		pop	ds
 11031 000047C7 89FE                    		mov	si, di
 11032                                  
 11033                                  OPCLS_RETRY:				; ...
 11034 000047C9 16                      		push	ss
 11035 000047CA 07                      		pop	es
 11036 000047CB BF[5A03]                		mov	di, DEVCALL
 11037 000047CE 89FB                    		mov	bx, di
 11038 000047D0 50                      		push	ax
 11039 000047D1 B00D                    		mov	al, 13
 11040 000047D3 AA                      		stosb
 11041 000047D4 58                      		pop	ax
 11042 000047D5 86E0                    		xchg	ah, al
 11043 000047D7 AA                      		stosb
 11044 000047D8 86E0                    		xchg	ah, al
 11045 000047DA AA                      		stosb
 11046 000047DB 26C7050000              		mov	word [es:di], 0
 11047 000047E0 50                      		push	ax
 11048 000047E1 E82900                  		call	DEVIOCALL2
 11049 000047E4 268B7F03                		mov	di, [es:bx+3]
 11050 000047E8 21FF                    		and	di, di
 11051 000047EA 7918                    		jns	short OPCLS_DONEP
 11052 000047EC F6440580                		test	byte [si+5], 80h
 11053 000047F0 7404                    		jz	short BLKDEV
 11054 000047F2 B486                    		mov	ah, 86h
 11055 000047F4 EB04                    		jmp	short HRDERR
 11056                                  ; ---------------------------------------------------------------------------
 11057                                  
 11058                                  BLKDEV:					; ...
 11059 000047F6 88C8                    		mov	al, cl
 11060 000047F8 B406                    		mov	ah, 6
 11061                                  
 11062                                  HRDERR:					; ...
 11063 000047FA E8C80C                  		call	CHARHARD
 11064 000047FD 3C01                    		cmp	al, 1
 11065 000047FF 7503                    		jnz	short OPCLS_DONEP
 11066 00004801 58                      		pop	ax
 11067 00004802 EBC5                    		jmp	short OPCLS_RETRY
 11068                                  ; ---------------------------------------------------------------------------
 11069                                  
 11070                                  OPCLS_DONEP:				; ...
 11071 00004804 58                      		pop	ax
 11072                                  
 11073                                  OPCLS_DONE:				; ...
 11074 00004805 E864BC                  		call	restore_world
 11075 00004808 07                      		pop	es
 11076 00004809 C3                      		retn
 11077                                  
 11078                                  ; =============== S U B	R O U T	I N E =======================================
 11079                                  
 11080                                  
 11081                                  DEVIOCALL:
 11082 0000480A C57407                  		lds	si, [si+7]
 11083                                  
 11084                                  ; =============== S U B	R O U T	I N E =======================================
 11085                                  
 11086                                  
 11087                                  DEVIOCALL2:
 11088 0000480D E88ACB                  		call	ECritDevice
 11089 00004810 F6440580                		test	byte [si+5], 80h
 11090 00004814 754D                    		jnz	short chardev2
 11091 00004816 26807F0204              		cmp	byte [es:bx+2], 4
 11092 0000481B 740E                    		jz	short chkext
 11093 0000481D 26807F0208              		cmp	byte [es:bx+2], 8
 11094 00004822 7407                    		jz	short chkext
 11095 00004824 26807F0209              		cmp	byte [es:bx+2], 9
 11096 00004829 7538                    		jnz	short chardev2
 11097                                  
 11098                                  chkext:					; ...
 11099 0000482B E89A00                  		call	RW_SC
 11100 0000482E 7255                    		jb	short dev_exit
 11101 00004830 F6440402                		test	byte [si+4], 2
 11102 00004834 741D                    		jz	short chksector
 11103 00004836 26800708                		add	byte [es:bx], 8
 11104 0000483A 36A1[6E03]              		mov	ax, word [ss:CALLBPB+2]
 11105 0000483E 36C706[6E03]FFFF        		mov	word [ss:CALLBPB+2], 0FFFFh
 11106 00004845 36A3[7403]              		mov	word [ss:CALLNEWSC], ax
 11107 00004849 36A1[0706]              		mov	ax, [ss:HIGH_SECTOR]
 11108 0000484D 36A3[7603]              		mov	word [ss:CALLNEWSC+2], ax
 11109 00004851 EB10                    		jmp	short chardev2
 11110                                  ; ---------------------------------------------------------------------------
 11111                                  
 11112                                  chksector:				; ...
 11113 00004853 36833E[0706]00          		cmp	word [ss:HIGH_SECTOR], 0
 11114 00004859 7408                    		jz	short chardev2
 11115 0000485B 26C747030781            		mov	word [es:bx+3], 8107h
 11116 00004861 EB22                    		jmp	short dev_exit
 11117                                  ; ---------------------------------------------------------------------------
 11118                                  
 11119                                  chardev2:				; ...
 11120 00004863 8B4406                  		mov	ax, [si+6]
 11121 00004866 36A3[7803]              		mov	word [ss:CALLDEVAD], ax
 11122 0000486A 368C1E[7A03]            		mov	word [ss:CALLDEVAD+2], ds
 11123 0000486F 36FF1E[7803]            		call	far [ss:CALLDEVAD]
 11124 00004874 8B4408                  		mov	ax, [si+8]
 11125 00004877 36A3[7803]              		mov	word [ss:CALLDEVAD], ax
 11126 0000487B 36FF1E[7803]            		call	far [ss:CALLDEVAD]
 11127 00004880 E84201                  		call	VIRREAD
 11128 00004883 72DE                    		jb	short chardev2
 11129                                  
 11130                                  dev_exit:				; ...
 11131 00004885 E832CB                  		call	LCritDevice
 11132 00004888 C3                      		retn
 11133                                  
 11134                                  ; =============== S U B	R O U T	I N E =======================================
 11135                                  
 11136                                  
 11137                                  SETREAD	:
 11138 00004889 57                      		push	di
 11139 0000488A 51                      		push	cx
 11140 0000488B 50                      		push	ax
 11141 0000488C B104                    		mov	cl, 4
 11142                                  
 11143                                  SETCALLHEAD:				; ...
 11144 0000488E B016                    		mov	al, 16h
 11145 00004890 16                      		push	ss
 11146 00004891 07                      		pop	es
 11147 00004892 BF[5A03]                		mov	di, DEVCALL
 11148 00004895 AA                      		stosb
 11149 00004896 58                      		pop	ax
 11150 00004897 AA                      		stosb
 11151 00004898 50                      		push	ax
 11152 00004899 88C8                    		mov	al, cl
 11153 0000489B AA                      		stosb
 11154 0000489C 31C0                    		xor	ax, ax
 11155 0000489E AB                      		stosw
 11156 0000489F 83C708                  		add	di, 8
 11157 000048A2 58                      		pop	ax
 11158 000048A3 86E0                    		xchg	ah, al
 11159 000048A5 AA                      		stosb
 11160 000048A6 86C4                    		xchg	al, ah
 11161 000048A8 50                      		push	ax
 11162 000048A9 89D8                    		mov	ax, bx
 11163 000048AB AB                      		stosw
 11164 000048AC 8CD8                    		mov	ax, ds
 11165 000048AE AB                      		stosw
 11166 000048AF 59                      		pop	cx
 11167 000048B0 58                      		pop	ax
 11168 000048B1 AB                      		stosw
 11169 000048B2 92                      		xchg	ax, dx
 11170 000048B3 AB                      		stosw
 11171 000048B4 91                      		xchg	ax, cx
 11172 000048B5 87D1                    		xchg	dx, cx
 11173 000048B7 5F                      		pop	di
 11174 000048B8 BB[5A03]                		mov	bx, DEVCALL
 11175 000048BB C3                      		retn
 11176                                  
 11177                                  ; =============== S U B	R O U T	I N E =======================================
 11178                                  
 11179                                  
 11180                                  SETWRITE:
 11181 000048BC 57                      		push	di
 11182 000048BD 51                      		push	cx
 11183 000048BE 50                      		push	ax
 11184 000048BF B108                    		mov	cl, 8
 11185 000048C1 36020E[FF02]            		add	cl, [ss:VERFLG]
 11186 000048C6 EBC6                    		jmp	short SETCALLHEAD
 11187                                  
 11188                                  ; =============== S U B	R O U T	I N E =======================================
 11189                                  
 11190                                  
 11191                                  RW_SC	:
 11192 000048C8 36833E[7700]00          		cmp	word [ss:SC_CACHE_COUNT], 0
 11193 000048CE 7421                    		jz	short scexit4
 11194 000048D0 36833E[6C03]01          		cmp	word [ss:CALLBPB], 1
 11195 000048D6 7519                    		jnz	short scexit4
 11196 000048D8 51                      		push	cx
 11197 000048D9 52                      		push	dx
 11198 000048DA 1E                      		push	ds
 11199 000048DB 56                      		push	si
 11200 000048DC 06                      		push	es
 11201 000048DD 57                      		push	di
 11202 000048DE 368B16[6E03]            		mov	dx, word [ss:CALLBPB+2]
 11203 000048E3 36803E[5C03]04          		cmp	byte [ss:DEVCALL_REQFUNC], 4
 11204 000048E9 7408                    		jz	short doread
 11205 000048EB E8C500                  		call	INVALIDATE_SC
 11206 000048EE E98E00                  		jmp	scexit2
 11207                                  ; ---------------------------------------------------------------------------
 11208                                  
 11209                                  scexit4:				; ...
 11210 000048F1 F8                      		clc
 11211 000048F2 C3                      		retn
 11212                                  ; ---------------------------------------------------------------------------
 11213                                  
 11214                                  doread:					; ...
 11215 000048F3 E82701                  		call	SC2BUF
 11216 000048F6 720A                    		jb	short readSC
 11217 000048F8 36C706[5D03]0001        		mov	word [ss:DEVCALL_REQSTAT], 100h
 11218 000048FF F9                      		stc
 11219 00004900 EB6B                    		jmp	short saveseq
 11220                                  ; ---------------------------------------------------------------------------
 11221                                  
 11222                                  readSC:					; ...
 11223 00004902 36A1[0706]              		mov	ax, [ss:HIGH_SECTOR]
 11224 00004906 368B0E[6E03]            		mov	cx, word [ss:CALLBPB+2]
 11225 0000490B 362B0E[A90D]            		sub	cx, [ss:SEQ_SECTOR]
 11226 00004910 361B06[AB0D]            		sbb	ax, [ss:SEQ_SECTOR+2]
 11227 00004915 83F800                  		cmp	ax, 0
 11228 00004918 7552                    		jnz	short saveseq2
 11229                                  
 11230                                  chklow:
 11231 0000491A 83F901                  		cmp	cx, 1
 11232 0000491D 774D                    		ja	short saveseq2
 11233 0000491F 36C706[B50D]FFFF        		mov	word [ss:SC_STATUS], 0FFFFh
 11234 00004926 36A1[7700]              		mov	ax, [ss:SC_CACHE_COUNT]
 11235 0000492A 36A3[6C03]              		mov	word [ss:CALLBPB], ax	; [ss:CALLSCNT]
 11236                                  
 11237                                  readsr:
 11238 0000492E 36A1[6A03]              		mov	ax, word [ss:CALLBR+2]
 11239 00004932 36A3[0E06]              		mov	[ss:TEMP_VAR2], ax
 11240 00004936 36A1[6803]              		mov	ax, word [ss:CALLBR]
 11241 0000493A 36A3[0C06]              		mov	[ss:TEMP_VAR], ax
 11242 0000493E 36A1[7300]              		mov	ax, word [ss:SC_CACHE_PTR]
 11243 00004942 36A3[6803]              		mov	word [ss:CALLBR], ax
 11244 00004946 36A1[7500]              		mov	ax, word [ss:SC_CACHE_PTR+2]
 11245 0000494A 36A3[6A03]              		mov	word [ss:CALLBR+2], ax
 11246 0000494E 36C606[B70D]01          		mov	byte [ss:SC_FLAG], 1
 11247 00004954 36A0[AF0D]              		mov	al, [ss:SC_DRIVE]
 11248 00004958 36A2[B00D]              		mov	byte [ss:CurSC_DRIVE], al
 11249 0000495C 36A1[6E03]              		mov	ax, word [ss:CALLBPB+2]
 11250 00004960 36A3[B10D]              		mov	[ss:CurSC_SECTOR], ax
 11251 00004964 36A1[0706]              		mov	ax, [ss:HIGH_SECTOR]
 11252 00004968 36A3[B30D]              		mov	[ss:CurSC_SECTOR+2], ax
 11253                                  
 11254                                  saveseq2:				; ...
 11255 0000496C F8                      		clc
 11256                                  
 11257                                  saveseq:				; ...
 11258 0000496D 36A1[0706]              		mov	ax, [ss:HIGH_SECTOR]
 11259 00004971 36A3[AB0D]              		mov	[ss:SEQ_SECTOR+2], ax
 11260 00004975 36A1[6E03]              		mov	ax, word [ss:CALLBPB+2]
 11261 00004979 36A3[A90D]              		mov	[ss:SEQ_SECTOR], ax
 11262 0000497D EB01                    		jmp	short scexit
 11263                                  ; ---------------------------------------------------------------------------
 11264                                  
 11265                                  scexit2:				; ...
 11266 0000497F F8                      		clc
 11267                                  
 11268                                  scexit:					; ...
 11269 00004980 5F                      		pop	di
 11270 00004981 07                      		pop	es
 11271 00004982 5E                      		pop	si
 11272 00004983 1F                      		pop	ds
 11273 00004984 5A                      		pop	dx
 11274 00004985 59                      		pop	cx
 11275 00004986 C3                      		retn
 11276                                  
 11277                                  ; =============== S U B	R O U T	I N E =======================================
 11278                                  
 11279                                  
 11280                                  IN_SC:
 11281 00004987 36A0[AF0D]              		mov	al, [ss:SC_DRIVE]
 11282 0000498B 363A06[B00D]            		cmp	al, [ss:CurSC_DRIVE]
 11283 00004990 751F                    		jnz	short outrange2
 11284 00004992 36A1[0706]              		mov	ax, [ss:HIGH_SECTOR]
 11285 00004996 89D1                    		mov	cx, dx
 11286 00004998 362B0E[B10D]            		sub	cx, [ss:CurSC_SECTOR]
 11287 0000499D 361B06[B30D]            		sbb	ax, [ss:CurSC_SECTOR+2]
 11288 000049A2 83F800                  		cmp	ax, 0
 11289 000049A5 750A                    		jnz	short outrange2
 11290 000049A7 363B0E[7700]            		cmp	cx, [ss:SC_CACHE_COUNT]
 11291 000049AC 7303                    		jnb	short outrange2
 11292 000049AE F8                      		clc
 11293 000049AF EB01                    		jmp	short inexit
 11294                                  ; ---------------------------------------------------------------------------
 11295                                  
 11296                                  outrange2:				; ...
 11297 000049B1 F9                      		stc
 11298                                  
 11299                                  inexit:					; ...
 11300 000049B2 C3                      		retn
 11301                                  
 11302                                  ; =============== S U B	R O U T	I N E =======================================
 11303                                  
 11304                                  
 11305                                  INVALIDATE_SC:
 11306 000049B3 E8D1FF                  		call	IN_SC
 11307 000049B6 720C                    		jb	short outrange
 11308 000049B8 B80100                  		mov	ax, 1
 11309 000049BB D3E0                    		shl	ax, cl
 11310 000049BD F7D0                    		not	ax
 11311 000049BF 362106[B50D]            		and	word [ss:SC_STATUS], ax
 11312                                  
 11313                                  outrange:				; ...
 11314 000049C4 C3                      		retn
 11315                                  
 11316                                  ; =============== S U B	R O U T	I N E =======================================
 11317                                  
 11318                                  
 11319                                  VIRREAD	:
 11320 000049C5 36803E[B70D]00          		cmp	byte [ss:SC_FLAG], 0
 11321 000049CB 744E                    		jz	short sc2end
 11322 000049CD 36A1[0E06]              		mov	ax, [ss:TEMP_VAR2]
 11323 000049D1 36A3[6A03]              		mov	word [ss:CALLBR+2], ax
 11324 000049D5 36A1[0C06]              		mov	ax, [ss:TEMP_VAR]
 11325 000049D9 36A3[6803]              		mov	word [ss:CALLBR], ax
 11326 000049DD 36C606[B70D]00          		mov	byte [ss:SC_FLAG], 0
 11327 000049E3 36C706[6C03]0100        		mov	word [ss:CALLBPB], 1 ; [ss:CALLSCNT]
 11328 000049EA 36F606[5E03]80          		test	byte [ss:DEVCALL_REQSTAT+1], 80h
 11329 000049F0 7513                    		jnz	short scerror
 11330 000049F2 1E                      		push	ds
 11331 000049F3 56                      		push	si
 11332 000049F4 06                      		push	es
 11333 000049F5 57                      		push	di
 11334 000049F6 52                      		push	dx
 11335 000049F7 51                      		push	cx
 11336 000049F8 31C9                    		xor	cx, cx
 11337 000049FA E83100                  		call	SC2BUF2
 11338 000049FD 59                      		pop	cx
 11339 000049FE 5A                      		pop	dx
 11340 000049FF 5F                      		pop	di
 11341 00004A00 07                      		pop	es
 11342 00004A01 5E                      		pop	si
 11343 00004A02 1F                      		pop	ds
 11344 00004A03 EB16                    		jmp	short sc2end
 11345                                  ; ---------------------------------------------------------------------------
 11346                                  
 11347                                  scerror:				; ...
 11348 00004A05 36C706[6C03]0100        		mov	word [ss:CALLBPB], 1
 11349 00004A0C 36C706[B50D]0000        		mov	word [ss:SC_STATUS], 0
 11350 00004A13 36C606[B00D]FF          		mov	byte [ss:CurSC_DRIVE], 0FFh
 11351 00004A19 F9                      		stc
 11352 00004A1A C3                      		retn
 11353                                  ; ---------------------------------------------------------------------------
 11354                                  
 11355                                  sc2end:					; ...
 11356 00004A1B F8                      		clc
 11357 00004A1C C3                      		retn
 11358                                  
 11359                                  ; =============== S U B	R O U T	I N E =======================================
 11360                                  
 11361                                  
 11362                                  SC2BUF:
 11363 00004A1D E867FF                  		call	IN_SC
 11364 00004A20 7241                    		jb	short noSC
 11365 00004A22 B80100                  		mov	ax, 1
 11366 00004A25 D3E0                    		shl	ax, cl
 11367 00004A27 368506[B50D]            		test	word [ss:SC_STATUS], ax
 11368 00004A2C 7435                    		jz	short noSC
 11369                                  
 11370                                  SC2BUF2:				; ...
 11371 00004A2E 89C8                    		mov	ax, cx
 11372 00004A30 36F726[AD0D]            		mul	word [ss:SC_SECTOR_SIZE]
 11373 00004A35 360306[7300]            		add	ax, word [ss:SC_CACHE_PTR]
 11374 00004A3A 361316[7500]            		adc	dx, word [ss:SC_CACHE_PTR+2]
 11375 00004A3F 8EDA                    		mov	ds, dx
 11376 00004A41 89C6                    		mov	si, ax
 11377 00004A43 368E06[6A03]            		mov	es, word [ss:CALLBR+2]
 11378 00004A48 368B3E[6803]            		mov	di, word [ss:CALLBR]
 11379 00004A4D 368B0E[AD0D]            		mov	cx, [ss:SC_SECTOR_SIZE]
 11380 00004A52 D1E9                    		shr	cx, 1
 11381                                  
 11382                                  MOVWORDS:
 11383 00004A54 36803E[6A00]00          		cmp	byte [ss:DDMOVE], 0
 11384 00004A5A 7403                    		jz	short nodd
 11385 00004A5C D1E9                    		shr	cx, 1
 11386                                  ; ---------------------------------------------------------------------------
 11387 00004A5E 66                      		db 66h			; 80386, 32 bit	op prefix
 11388                                  ; ---------------------------------------------------------------------------
 11389                                  
 11390                                  nodd:					; ...
 11391 00004A5F F3A5                    		rep movsw
 11392 00004A61 F8                      		clc
 11393 00004A62 C3                      		retn
 11394                                  ; ---------------------------------------------------------------------------
 11395                                  
 11396                                  noSC:					; ...
 11397 00004A63 F9                      		stc
 11398 00004A64 C3                      		retn
 11399                                  
 11400                                  ; =============== S U B	R O U T	I N E =======================================
 11401                                  
 11402                                  
 11403                                  BUILDDIR:
 11404 00004A65 A1[D805]                		mov	ax, [ENTFREE]
 11405 00004A68 83F8FF                  		cmp	ax, 0FFFFh
 11406 00004A6B 7402                    		jz	short CHECK_IF_ROOT
 11407 00004A6D F8                      		clc
 11408 00004A6E C3                      		retn
 11409                                  ; ---------------------------------------------------------------------------
 11410                                  
 11411                                  CHECK_IF_ROOT:				; ...
 11412 00004A6F 833E[C205]00            		cmp	word [DIRSTART], 0
 11413 00004A74 7502                    		jnz	short NEWDIR
 11414 00004A76 F9                      		stc
 11415                                  
 11416                                  builddir_retn:				; ...
 11417 00004A77 C3                      		retn
 11418                                  ; ---------------------------------------------------------------------------
 11419                                  
 11420                                  NEWDIR:					; ...
 11421 00004A78 8B1E[C205]              		mov	bx, [DIRSTART]
 11422 00004A7C 09DB                    		or	bx, bx
 11423 00004A7E 7405                    		jz	short NULLDIR
 11424 00004A80 E85E06                  		call	GETEOF
 11425 00004A83 72F2                    		jb	short builddir_retn
 11426                                  
 11427                                  NULLDIR:				; ...
 11428 00004A85 B90100                  		mov	cx, 1
 11429 00004A88 E85E05                  		call	ALLOCATE
 11430 00004A8B 72EA                    		jb	short builddir_retn
 11431 00004A8D 8B16[C205]              		mov	dx, [DIRSTART]
 11432 00004A91 09D2                    		or	dx, dx
 11433 00004A93 750D                    		jnz	short ADDINGDIR
 11434 00004A95 E89FF5                  		call	SETDIRSRCH
 11435 00004A98 72DD                    		jb	short builddir_retn
 11436 00004A9A C706[4803]FFFF          		mov	word [LASTENT], 0FFFFh
 11437 00004AA0 EB2B                    		jmp	short GOTDIRREC
 11438                                  ; ---------------------------------------------------------------------------
 11439                                  
 11440                                  ADDINGDIR:				; ...
 11441 00004AA2 53                      		push	bx
 11442 00004AA3 8B1E[BC05]              		mov	bx, [CLUSNUM]
 11443 00004AA7 E8700C                  		call	IsEOF
 11444 00004AAA 5B                      		pop	bx
 11445 00004AAB 7219                    		jb	short NOTFIRSTGROW
 11446 00004AAD 891E[BC05]              		mov	[CLUSNUM], bx
 11447 00004AB1 51                      		push	cx
 11448 00004AB2 50                      		push	ax
 11449 00004AB3 55                      		push	bp
 11450 00004AB4 B401                    		mov	ah, 1
 11451 00004AB6 268A5600                		mov	dl, [es:bp+0]
 11452 00004ABA 8B0E[C205]              		mov	cx, [DIRSTART]
 11453 00004ABE 89DD                    		mov	bp, bx
 11454 00004AC0 E82BDD                  		call	FastOpen_Update
 11455 00004AC3 5D                      		pop	bp
 11456 00004AC4 58                      		pop	ax
 11457 00004AC5 59                      		pop	cx
 11458                                  
 11459                                  NOTFIRSTGROW:				; ...
 11460 00004AC6 89DA                    		mov	dx, bx
 11461 00004AC8 30DB                    		xor	bl, bl
 11462 00004ACA E8E904                  		call	FIGREC
 11463                                  
 11464                                  GOTDIRREC:				; ...
 11465 00004ACD 268A4E04                		mov	cl, [es:bp+4]
 11466 00004AD1 FEC1                    		inc	cl
 11467 00004AD3 30ED                    		xor	ch, ch
 11468                                  
 11469                                  ZERODIR:				; ...
 11470 00004AD5 51                      		push	cx
 11471 00004AD6 C606[4B03]18            		mov	byte [ALLOWED], 18h
 11472 00004ADB B0FF                    		mov	al, 0FFh
 11473 00004ADD E87710                  		call	GETBUFFR
 11474 00004AE0 7302                    		jnb	short GET_SSIZE
 11475 00004AE2 59                      		pop	cx
 11476 00004AE3 C3                      		retn
 11477                                  ; ---------------------------------------------------------------------------
 11478                                  
 11479                                  GET_SSIZE:				; ...
 11480 00004AE4 268B4E02                		mov	cx, [es:bp+2]
 11481 00004AE8 06                      		push	es
 11482 00004AE9 C43E[E205]              		les	di, [CURBUF]
 11483 00004AED 26804D0504              		or	byte [es:di+5], 4
 11484 00004AF2 57                      		push	di
 11485 00004AF3 83C714                  		add	di, 20
 11486 00004AF6 31C0                    		xor	ax, ax
 11487 00004AF8 D1E9                    		shr	cx, 1
 11488 00004AFA F3AB                    		rep stosw
 11489 00004AFC 7301                    		jnb	short EVENZ
 11490 00004AFE AA                      		stosb
 11491                                  
 11492                                  EVENZ:					; ...
 11493 00004AFF 5F                      		pop	di
 11494 00004B00 26F6450540              		test	byte [es:di+5], 40h
 11495 00004B05 7508                    		jnz	short yesdirty7
 11496 00004B07 E85712                  		call	INC_DIRTY_COUNT
 11497 00004B0A 26804D0540              		or	byte [es:di+5], 40h
 11498                                  
 11499                                  yesdirty7:				; ...
 11500 00004B0F 07                      		pop	es
 11501 00004B10 59                      		pop	cx
 11502 00004B11 83C201                  		add	dx, 1
 11503 00004B14 8316[0706]00            		adc	word [HIGH_SECTOR],	0
 11504 00004B19 E2BA                    		loop	ZERODIR
 11505 00004B1B A1[4803]                		mov	ax, [LASTENT]
 11506 00004B1E 40                      		inc	ax
 11507 00004B1F F8                      		clc
 11508 00004B20 C3                      		retn
 11509                                  
 11510                                  ; =============== S U B	R O U T	I N E =======================================
 11511                                  
 11512                                  
 11513                                  SETDOTENT:
 11514 00004B21 AB                      		stosw
 11515 00004B22 B90400                  		mov	cx, 4
 11516 00004B25 B82020                  		mov	ax, 2020h
 11517 00004B28 F3AB                    		rep stosw
 11518 00004B2A AA                      		stosb
 11519 00004B2B B010                    		mov	al, 10h
 11520 00004B2D AA                      		stosb
 11521 00004B2E 83C70A                  		add	di, 10
 11522 00004B31 8B36[9E05]              		mov	si, word [THISSFT]
 11523 00004B35 8B440D                  		mov	ax, [si+0Dh]
 11524 00004B38 AB                      		stosw
 11525 00004B39 8B440F                  		mov	ax, [si+0Fh]
 11526 00004B3C AB                      		stosw
 11527 00004B3D 89D0                    		mov	ax, dx
 11528 00004B3F AB                      		stosw
 11529 00004B40 31C0                    		xor	ax, ax
 11530 00004B42 AB                      		stosw
 11531 00004B43 AB                      		stosw
 11532 00004B44 C3                      		retn
 11533                                  
 11534                                  ; =============== S U B	R O U T	I N E =======================================
 11535                                  
 11536                                  
 11537                                  MakeNode:
 11538 00004B45 C706[7E05]FFE5          		mov	word [CREATING], 0E5FFh
 11539 00004B4B 50                      		push	ax
 11540 00004B4C C606[4C03]00            		mov	byte [NoSetDir], 0
 11541 00004B51 A2[6D05]                		mov	byte [SATTRIB], al
 11542 00004B54 E84BF5                  		call	GetPathNoSet
 11543 00004B57 88CA                    		mov	dl, cl
 11544 00004B59 89C1                    		mov	cx, ax
 11545 00004B5B 58                      		pop	ax
 11546 00004B5C 732E                    		jnb	short make_exists
 11547 00004B5E 7505                    		jnz	short make_err_4
 11548 00004B60 80FA80                  		cmp	dl, 80h
 11549 00004B63 7406                    		jz	short RENAME_MAKE
 11550                                  
 11551                                  make_err_4:				; ...
 11552 00004B65 B004                    		mov	al, 4
 11553                                  
 11554                                  make_err_ret:				; ...
 11555 00004B67 30E4                    		xor	ah, ah
 11556 00004B69 F9                      		stc
 11557 00004B6A C3                      		retn
 11558                                  ; ---------------------------------------------------------------------------
 11559                                  
 11560                                  RENAME_MAKE:				; ...
 11561 00004B6B F606[F605]01            		test	byte [EXTOPEN_ON], 1
 11562 00004B70 7411                    		jz	short make_type2
 11563 00004B72 800E[F605]04            		or	byte [EXTOPEN_ON], 4
 11564 00004B77 F606[F405]F0            		test	byte [EXTOPEN_FLAG], 0F0h
 11565 00004B7C 7505                    		jnz	short make_type2
 11566 00004B7E F9                      		stc
 11567 00004B7F B80700                  		mov	ax, 7
 11568                                  
 11569                                  make_retn:				; ...
 11570 00004B82 C3                      		retn
 11571                                  ; ---------------------------------------------------------------------------
 11572                                  
 11573                                  make_type2:				; ...
 11574 00004B83 C43E[9E05]              		les	di, [THISSFT]
 11575 00004B87 31C0                    		xor	ax, ax
 11576 00004B89 F9                      		stc
 11577 00004B8A EB5A                    		jmp	short make_new
 11578                                  ; ---------------------------------------------------------------------------
 11579                                  
 11580                                  make_exists:				; ...
 11581 00004B8C 7448                    		jz	short make_exists_dir
 11582 00004B8E B003                    		mov	al, 3
 11583 00004B90 F606[6B05]18            		test	byte [ATTRIB], 18h
 11584 00004B95 753B                    		jnz	short make_err_ret_5
 11585 00004B97 08ED                    		or	ch, ch
 11586 00004B99 781A                    		js	short make_share
 11587 00004B9B 08E4                    		or	ah, ah
 11588 00004B9D 75C8                    		jnz	short make_err_ret
 11589 00004B9F 51                      		push	cx
 11590 00004BA0 8E06[E405]              		mov	es, word [CURBUF+2]
 11591 00004BA4 268A6F0B                		mov	ch, [es:bx+0Bh]
 11592 00004BA8 F6C501                  		test	ch, 1
 11593 00004BAB 7524                    		jnz	short make_err_ret_5P
 11594 00004BAD E8ABF7                  		call	MatchAttributes
 11595 00004BB0 59                      		pop	cx
 11596 00004BB1 751F                    		jnz	short make_err_ret_5
 11597 00004BB3 30C0                    		xor	al, al
 11598                                  
 11599                                  make_share:				; ...
 11600 00004BB5 30E4                    		xor	ah, ah
 11601 00004BB7 50                      		push	ax
 11602 00004BB8 51                      		push	cx
 11603 00004BB9 88EC                    		mov	ah, ch
 11604 00004BBB E84601                  		call	DOOPEN
 11605 00004BBE C43E[9E05]              		les	di, [THISSFT]
 11606 00004BC2 56                      		push	si
 11607 00004BC3 53                      		push	bx
 11608 00004BC4 E8142A                  		call	ShareEnter
 11609 00004BC7 735A                    		jnb	short MakeEndShare
 11610 00004BC9 5B                      		pop	bx
 11611 00004BCA 5E                      		pop	si
 11612 00004BCB 59                      		pop	cx
 11613 00004BCC 58                      		pop	ax
 11614                                  
 11615                                  Make_Share_ret:				; ...
 11616 00004BCD B006                    		mov	al, 6
 11617 00004BCF EB96                    		jmp	short make_err_ret
 11618                                  ; ---------------------------------------------------------------------------
 11619                                  
 11620                                  make_err_ret_5P:			; ...
 11621 00004BD1 59                      		pop	cx
 11622                                  
 11623                                  make_err_ret_5:				; ...
 11624 00004BD2 B005                    		mov	al, 5
 11625 00004BD4 EB91                    		jmp	short make_err_ret
 11626                                  ; ---------------------------------------------------------------------------
 11627                                  
 11628                                  make_exists_dir:			; ...
 11629 00004BD6 B001                    		mov	al, 1
 11630 00004BD8 EB8D                    		jmp	short make_err_ret
 11631                                  ; ---------------------------------------------------------------------------
 11632                                  
 11633                                  make_save:				; ...
 11634 00004BDA 50                      		push	ax
 11635 00004BDB 89C8                    		mov	ax, cx
 11636 00004BDD E87400                  		call	NEWENTRY
 11637 00004BE0 58                      		pop	ax
 11638 00004BE1 739F                    		jnb	short make_retn
 11639 00004BE3 B002                    		mov	al, 2
 11640                                  
 11641                                  make_save_retn:				; ...
 11642 00004BE5 C3                      		retn
 11643                                  ; ---------------------------------------------------------------------------
 11644                                  
 11645                                  make_new:				; ...
 11646 00004BE6 E8F1FF                  		call	make_save
 11647 00004BE9 72FA                    		jb	short make_save_retn
 11648 00004BEB F606[6B05]10            		test	byte [ATTRIB], 10h
 11649 00004BF0 75F3                    		jnz	short make_save_retn
 11650 00004BF2 50                      		push	ax
 11651 00004BF3 53                      		push	bx
 11652 00004BF4 56                      		push	si
 11653 00004BF5 E8E329                  		call	ShareEnter
 11654 00004BF8 5E                      		pop	si
 11655 00004BF9 5B                      		pop	bx
 11656 00004BFA 58                      		pop	ax
 11657 00004BFB 73E8                    		jnb	short make_save_retn
 11658 00004BFD 50                      		push	ax
 11659 00004BFE C43E[E205]              		les	di, [CURBUF]
 11660 00004C02 26C607E5                		mov	byte [es:bx], 0E5h
 11661 00004C06 26F6450540              		test	byte [es:di+5], 40h
 11662 00004C0B 7508                    		jnz	short yesdirty8
 11663 00004C0D E85111                  		call	INC_DIRTY_COUNT
 11664 00004C10 26804D0540              		or	byte [es:di+5], 40h
 11665                                  
 11666                                  yesdirty8:				; ...
 11667 00004C15 C42E[8A05]              		les	bp, [THISDPB]
 11668 00004C19 268A4600                		mov	al, [es:bp+0]
 11669 00004C1D E83510                  		call	FLUSHBUF
 11670 00004C20 58                      		pop	ax
 11671 00004C21 EBAA                    		jmp	short Make_Share_ret
 11672                                  ; ---------------------------------------------------------------------------
 11673                                  
 11674                                  MakeEndShare:				; ...
 11675 00004C23 C43E[9E05]              		les	di, [THISSFT]
 11676 00004C27 31C0                    		xor	ax, ax
 11677 00004C29 E82EC7                  		call	ECritDisk
 11678 00004C2C 268705                  		xchg	ax, [es:di]
 11679 00004C2F 50                      		push	ax
 11680 00004C30 57                      		push	di
 11681 00004C31 06                      		push	es
 11682 00004C32 9C                      		pushf
 11683 00004C33 E8A029                  		call	ShareEnd
 11684 00004C36 9D                      		popf
 11685 00004C37 07                      		pop	es
 11686 00004C38 5F                      		pop	di
 11687 00004C39 268F05                  		pop	word [es:di]
 11688 00004C3C E83BC7                  		call	LCritDisk
 11689 00004C3F 5B                      		pop	bx
 11690 00004C40 5E                      		pop	si
 11691 00004C41 59                      		pop	cx
 11692 00004C42 58                      		pop	ax
 11693 00004C43 E894FF                  		call	make_save
 11694 00004C46 729D                    		jb	short make_save_retn
 11695 00004C48 50                      		push	ax
 11696 00004C49 53                      		push	bx
 11697 00004C4A 56                      		push	si
 11698 00004C4B 9C                      		pushf
 11699 00004C4C E88C29                  		call	ShareEnter
 11700 00004C4F 9D                      		popf
 11701 00004C50 5E                      		pop	si
 11702 00004C51 5B                      		pop	bx
 11703 00004C52 58                      		pop	ax
 11704                                  
 11705                                  makeendshare_retn:			; ...
 11706 00004C53 C3                      		retn
 11707                                  
 11708                                  ; =============== S U B	R O U T	I N E =======================================
 11709                                  
 11710                                  
 11711                                  NEWENTRY:
 11712 00004C54 C42E[8A05]              		les	bp, [THISDPB]
 11713 00004C58 7316                    		jnb	short EXISTENT
 11714 00004C5A 803E[4A03]00            		cmp	byte [FAILERR], 0
 11715 00004C5F F9                      		stc
 11716 00004C60 75F1                    		jnz	short makeendshare_retn
 11717 00004C62 E800FE                  		call	BUILDDIR
 11718 00004C65 72EC                    		jb	short makeendshare_retn
 11719 00004C67 E89DF3                  		call	GETENT
 11720 00004C6A 72E7                    		jb	short makeendshare_retn
 11721 00004C6C EB0E                    		jmp	short FREESPOT
 11722                                  ; ---------------------------------------------------------------------------
 11723                                  
 11724                                  ERRRET3:				; ...
 11725 00004C6E F9                      		stc
 11726                                  
 11727                                  newentry_retn:				; ...
 11728 00004C6F C3                      		retn
 11729                                  ; ---------------------------------------------------------------------------
 11730                                  
 11731                                  EXISTENT:				; ...
 11732 00004C70 08E4                    		or	ah, ah
 11733 00004C72 7903                    		jns	short NOT_DEV1
 11734 00004C74 E98D00                  		jmp	DOOPEN
 11735                                  ; ---------------------------------------------------------------------------
 11736                                  
 11737                                  NOT_DEV1:				; ...
 11738 00004C77 E82D01                  		call	FREEENT
 11739 00004C7A 72F3                    		jb	short newentry_retn
 11740                                  
 11741                                  FREESPOT:				; ...
 11742 00004C7C F606[6B05]08            		test	byte [ATTRIB], 8
 11743 00004C81 7407                    		jz	short NOTVOLID
 11744 00004C83 803E[7B05]00            		cmp	byte [VOLID], 0
 11745 00004C88 75E4                    		jnz	short ERRRET3
 11746                                  
 11747                                  NOTVOLID:				; ...
 11748 00004C8A 8E06[E405]              		mov	es, word [CURBUF+2]
 11749 00004C8E 89DF                    		mov	di, bx
 11750 00004C90 BE[4B05]                		mov	si, NAME1
 11751 00004C93 B90500                  		mov	cx, 5
 11752 00004C96 F3A5                    		rep movsw
 11753 00004C98 A4                      		movsb
 11754 00004C99 A0[6B05]                		mov	al, [ATTRIB]
 11755 00004C9C AA                      		stosb
 11756 00004C9D B105                    		mov	cl, 5
 11757 00004C9F 31C0                    		xor	ax, ax
 11758 00004CA1 F3AB                    		rep stosw
 11759 00004CA3 E848BE                  		call	DATE16
 11760 00004CA6 92                      		xchg	ax, dx
 11761 00004CA7 AB                      		stosw
 11762 00004CA8 92                      		xchg	ax, dx
 11763 00004CA9 AB                      		stosw
 11764 00004CAA 31C0                    		xor	ax, ax
 11765 00004CAC 57                      		push	di
 11766 00004CAD AB                      		stosw
 11767 00004CAE AB                      		stosw
 11768 00004CAF AB                      		stosw
 11769 00004CB0 8B36[E205]              		mov	si, word [CURBUF]
 11770 00004CB4 26F6440540              		test	byte [es:si+5], 40h
 11771 00004CB9 7508                    		jnz	short yesdirty9
 11772 00004CBB E8A310                  		call	INC_DIRTY_COUNT
 11773 00004CBE 26804C0540              		or	byte [es:si+5], 40h
 11774                                  
 11775                                  yesdirty9:				; ...
 11776 00004CC3 C42E[8A05]              		les	bp, [THISDPB]
 11777 00004CC7 268A4600                		mov	al, [es:bp+0]
 11778 00004CCB 50                      		push	ax
 11779 00004CCC 53                      		push	bx
 11780 00004CCD 06                      		push	es
 11781 00004CCE 57                      		push	di
 11782 00004CCF C43E[9E05]              		les	di, [THISSFT]
 11783 00004CD3 26F6450580              		test	byte [es:di+5], 80h
 11784 00004CD8 751A                    		jnz	short GotADevice
 11785 00004CDA 1E                      		push	ds
 11786 00004CDB 53                      		push	bx
 11787 00004CDC C51E[8A05]              		lds	bx, [THISDPB]
 11788 00004CE0 26895D07                		mov	[es:di+7], bx
 11789 00004CE4 8CDB                    		mov	bx, ds
 11790 00004CE6 26895D09                		mov	[es:di+9], bx
 11791 00004CEA 5B                      		pop	bx
 11792 00004CEB 1F                      		pop	ds
 11793 00004CEC E89AFA                  		call	DEV_OPEN_SFT
 11794 00004CEF C606[A20A]01            		mov	byte [VIRTUAL_OPEN], 1
 11795                                  
 11796                                  GotADevice:				; ...
 11797 00004CF4 5F                      		pop	di
 11798 00004CF5 07                      		pop	es
 11799 00004CF6 E85C0F                  		call	FLUSHBUF
 11800 00004CF9 E8FA00                  		call	CHECK_VIRT_OPEN
 11801 00004CFC 5B                      		pop	bx
 11802 00004CFD 58                      		pop	ax
 11803 00004CFE 5E                      		pop	si
 11804 00004CFF 88C4                    		mov	ah, al
 11805 00004D01 7301                    		jnb	short DOOPEN
 11806 00004D03 C3                      		retn
 11807                                  
 11808                                  ; =============== S U B	R O U T	I N E =======================================
 11809                                  
 11810                                  
 11811                                  DOOPEN:
 11812 00004D04 88E6                    		mov	dh, ah
 11813 00004D06 C43E[9E05]              		les	di, [THISSFT]
 11814 00004D0A 83C704                  		add	di, 4
 11815 00004D0D 30C0                    		xor	al, al
 11816 00004D0F 08F6                    		or	dh, dh
 11817 00004D11 7807                    		js	short DEV_SFT1
 11818 00004D13 8E1E[E405]              		mov	ds, word [CURBUF+2]
 11819 00004D17 8A470B                  		mov	al, [bx+0Bh]
 11820                                  
 11821                                  DEV_SFT1:				; ...
 11822 00004D1A AA                      		stosb
 11823 00004D1B 31C0                    		xor	ax, ax
 11824 00004D1D 88F0                    		mov	al, dh
 11825 00004D1F 0C40                    		or	al, 40h
 11826 00004D21 AB                      		stosw
 11827 00004D22 1E                      		push	ds
 11828 00004D23 C5471A                  		lds	ax, [bx+1Ah]
 11829 00004D26 08F6                    		or	dh, dh
 11830 00004D28 7805                    		js	short DEV_SFT2
 11831 00004D2A 36C506[8A05]            		lds	ax, [ss:THISDPB]
 11832                                  
 11833                                  DEV_SFT2:				; ...
 11834 00004D2F AB                      		stosw
 11835 00004D30 8CD8                    		mov	ax, ds
 11836 00004D32 1F                      		pop	ds
 11837 00004D33 AB                      		stosw
 11838 00004D34 56                      		push	si
 11839 00004D35 A5                      		movsw
 11840 00004D36 83EE06                  		sub	si, 6
 11841 00004D39 A5                      		movsw
 11842 00004D3A A5                      		movsw
 11843 00004D3B AD                      		lodsw
 11844 00004D3C AD                      		lodsw
 11845 00004D3D 89C1                    		mov	cx, ax
 11846 00004D3F AD                      		lodsw
 11847 00004D40 08F6                    		or	dh, dh
 11848 00004D42 7904                    		jns	short FILE_SFT1
 11849 00004D44 31C0                    		xor	ax, ax
 11850 00004D46 89C1                    		mov	cx, ax
 11851                                  
 11852                                  FILE_SFT1:				; ...
 11853 00004D48 91                      		xchg	ax, cx
 11854 00004D49 AB                      		stosw
 11855 00004D4A 91                      		xchg	ax, cx
 11856 00004D4B AB                      		stosw
 11857 00004D4C 31C0                    		xor	ax, ax
 11858 00004D4E AB                      		stosw
 11859 00004D4F AB                      		stosw
 11860 00004D50 08F6                    		or	dh, dh
 11861 00004D52 7844                    		js	short DEV_SFT3
 11862 00004D54 AB                      		stosw
 11863 00004D55 8B471A                  		mov	ax, [bx+1Ah]
 11864 00004D58 57                      		push	di
 11865 00004D59 83EF1B                  		sub	di, 1Bh		; SF_ENTRY.sf_dirsec
 11866 00004D5C 26894535                		mov	[es:di+35h], ax
 11867 00004D60 5F                      		pop	di
 11868 00004D61 1E                      		push	ds
 11869 00004D62 16                      		push	ss
 11870 00004D63 1F                      		pop	ds
 11871 00004D64 F606[3A0D]04            		test	byte [FastOpenFlg],	4
 11872 00004D69 7411                    		jz	short Not_FastOpen
 11873 00004D6B BE[3B0D]                		mov	si, FastOpen_Ext_Info
 11874 00004D6E 8B4401                  		mov	ax, [si+1]
 11875 00004D71 AB                      		stosw
 11876 00004D72 8B4403                  		mov	ax, [si+3]
 11877 00004D75 AB                      		stosw
 11878 00004D76 8A04                    		mov	al, [si]
 11879 00004D78 AA                      		stosb
 11880 00004D79 1F                      		pop	ds
 11881 00004D7A EB1A                    		jmp	short Next_Name
 11882                                  ; ---------------------------------------------------------------------------
 11883                                  
 11884                                  Not_FastOpen:				; ...
 11885 00004D7C 1F                      		pop	ds
 11886 00004D7D 368B36[E205]            		mov	si, word [ss:CURBUF]
 11887 00004D82 8B4406                  		mov	ax, [si+6]
 11888 00004D85 AB                      		stosw
 11889 00004D86 8B4408                  		mov	ax, [si+8]
 11890 00004D89 AB                      		stosw
 11891 00004D8A 89D8                    		mov	ax, bx
 11892 00004D8C 83C614                  		add	si, 20
 11893 00004D8F 29F0                    		sub	ax, si
 11894 00004D91 B120                    		mov	cl, 32
 11895 00004D93 F6F1                    		div	cl
 11896 00004D95 AA                      		stosb
 11897                                  
 11898                                  Next_Name:				; ...
 11899 00004D96 EB03                    		jmp	short FILE_SFT2
 11900                                  ; ---------------------------------------------------------------------------
 11901                                  
 11902                                  DEV_SFT3:				; ...
 11903 00004D98 83C707                  		add	di, 7
 11904                                  
 11905                                  FILE_SFT2:				; ...
 11906 00004D9B 89DE                    		mov	si, bx
 11907 00004D9D B90B00                  		mov	cx, 11
 11908 00004DA0 F3A4                    		rep movsb
 11909 00004DA2 5E                      		pop	si
 11910 00004DA3 16                      		push	ss
 11911 00004DA4 1F                      		pop	ds
 11912 00004DA5 F8                      		clc
 11913 00004DA6 C3                      		retn
 11914                                  
 11915                                  ; =============== S U B	R O U T	I N E =======================================
 11916                                  
 11917                                  
 11918                                  FREEENT:
 11919 00004DA7 1E                      		push	ds
 11920 00004DA8 C53E[E205]              		lds	di, [CURBUF]
 11921 00004DAC 8B0C                    		mov	cx, [si]
 11922 00004DAE 8B5508                  		mov	dx, [di+8]
 11923 00004DB1 368916[0706]            		mov	word [ss:HIGH_SECTOR], dx
 11924 00004DB6 8B5506                  		mov	dx, [di+6]
 11925 00004DB9 1F                      		pop	ds
 11926 00004DBA 83F902                  		cmp	cx, 2
 11927 00004DBD 7235                    		jb	short RET1
 11928 00004DBF 263B4E0D                		cmp	cx, [es:bp+0Dh]
 11929 00004DC3 772F                    		ja	short RET1
 11930 00004DC5 29FB                    		sub	bx, di
 11931 00004DC7 53                      		push	bx
 11932 00004DC8 FF36[0706]              		push	word [HIGH_SECTOR]
 11933 00004DCC 52                      		push	dx
 11934 00004DCD 89CB                    		mov	bx, cx
 11935 00004DCF E8D402                  		call	RELEASE
 11936 00004DD2 5A                      		pop	dx
 11937 00004DD3 8F06[0706]              		pop	word [HIGH_SECTOR]
 11938 00004DD7 7302                    		jnb	short GET_BUF_BACK
 11939 00004DD9 5B                      		pop	bx
 11940                                  
 11941                                  freeent_retn:				; ...
 11942 00004DDA C3                      		retn
 11943                                  ; ---------------------------------------------------------------------------
 11944                                  
 11945                                  GET_BUF_BACK:				; ...
 11946 00004DDB C606[4B03]18            		mov	byte [ALLOWED], 18h
 11947 00004DE0 30C0                    		xor	al, al
 11948 00004DE2 E8720D                  		call	GETBUFFR
 11949 00004DE5 5B                      		pop	bx
 11950 00004DE6 72F2                    		jb	short freeent_retn
 11951 00004DE8 E843EA                  		call	SET_BUF_AS_DIR
 11952 00004DEB 031E[E205]              		add	bx, word [CURBUF]
 11953 00004DEF 89DE                    		mov	si, bx
 11954 00004DF1 83C61A                  		add	si, 1Ah
 11955                                  
 11956                                  RET1:					; ...
 11957 00004DF4 F8                      		clc
 11958 00004DF5 C3                      		retn
 11959                                  
 11960                                  ; =============== S U B	R O U T	I N E =======================================
 11961                                  
 11962                                  
 11963                                  CHECK_VIRT_OPEN:
 11964 00004DF6 50                      		push	ax
 11965 00004DF7 9F                      		lahf
 11966 00004DF8 803E[A20A]00            		cmp	byte [VIRTUAL_OPEN], 0
 11967 00004DFD 7410                    		jz	short ALL_CLOSED
 11968 00004DFF C606[A20A]00            		mov	byte [VIRTUAL_OPEN], 0
 11969 00004E04 06                      		push	es
 11970 00004E05 57                      		push	di
 11971 00004E06 C43E[9E05]              		les	di, [THISSFT]
 11972 00004E0A E884F9                  		call	DEV_CLOSE_SFT
 11973 00004E0D 5F                      		pop	di
 11974 00004E0E 07                      		pop	es
 11975                                  
 11976                                  ALL_CLOSED:				; ...
 11977 00004E0F 9E                      		sahf
 11978 00004E10 58                      		pop	ax
 11979 00004E11 C3                      		retn
 11980                                  
 11981                                  ; =============== S U B	R O U T	I N E =======================================
 11982                                  
 11983                                  
 11984                                  FNDCLUS:
 11985 00004E12 06                      		push	es
 11986 00004E13 C43E[9E05]              		les	di, [THISSFT]
 11987 00004E17 268B5D35                		mov	bx, [es:di+35h]
 11988 00004E1B 268B5519                		mov	dx, [es:di+19h]
 11989 00004E1F 09DB                    		or	bx, bx
 11990 00004E21 7424                    		jz	short NOCLUS
 11991 00004E23 29D1                    		sub	cx, dx
 11992 00004E25 7308                    		jnb	short FINDIT
 11993 00004E27 01D1                    		add	cx, dx
 11994 00004E29 31D2                    		xor	dx, dx
 11995 00004E2B 268B5D0B                		mov	bx, [es:di+0Bh]
 11996                                  
 11997                                  FINDIT:					; ...
 11998 00004E2F 07                      		pop	es
 11999 00004E30 E313                    		jcxz	RET9
 12000                                  
 12001                                  SKPCLP:					; ...
 12002 00004E32 E8FC08                  		call	UNPACK
 12003 00004E35 7214                    		jb	short fndclus_retn
 12004 00004E37 87DF                    		xchg	bx, di
 12005 00004E39 E8DE08                  		call	IsEOF
 12006 00004E3C 87DF                    		xchg	bx, di
 12007 00004E3E 7305                    		jnb	short RET9
 12008 00004E40 87DF                    		xchg	bx, di
 12009 00004E42 42                      		inc	dx
 12010 00004E43 E2ED                    		loop	SKPCLP
 12011                                  
 12012                                  RET9:					; ...
 12013 00004E45 F8                      		clc
 12014 00004E46 C3                      		retn
 12015                                  ; ---------------------------------------------------------------------------
 12016                                  
 12017                                  NOCLUS:					; ...
 12018 00004E47 07                      		pop	es
 12019 00004E48 41                      		inc	cx
 12020 00004E49 4A                      		dec	dx
 12021 00004E4A F8                      		clc
 12022                                  
 12023                                  fndclus_retn:				; ...
 12024 00004E4B C3                      		retn
 12025                                  
 12026                                  ; =============== S U B	R O U T	I N E =======================================
 12027                                  
 12028                                  
 12029                                  BUFSEC:
 12030 00004E4C 8B16[BC05]              		mov	dx, [CLUSNUM]
 12031 00004E50 8A1E[7305]              		mov	bl, [SECCLUSPOS]
 12032 00004E54 C606[4B03]38            		mov	byte [ALLOWED], 38h
 12033 00004E59 E85A01                  		call	FIGREC
 12034 00004E5C E8F80C                  		call	GETBUFFR
 12035 00004E5F 72EA                    		jb	short fndclus_retn
 12036 00004E61 C606[7405]01            		mov	byte [TRANS], 1
 12037 00004E66 8B36[B805]              		mov	si, [NEXTADD]
 12038 00004E6A 89F7                    		mov	di, si
 12039 00004E6C 8B0E[D205]              		mov	cx, [BYTCNT1]
 12040 00004E70 01CF                    		add	di, cx
 12041 00004E72 893E[B805]              		mov	[NEXTADD], di
 12042 00004E76 C43E[E205]              		les	di, [CURBUF]
 12043 00004E7A 26804D0508              		or	byte [es:di+5], 8
 12044 00004E7F 8D7D14                  		lea	di, [di+20]
 12045 00004E82 033E[CC05]              		add	di, [BYTSECPOS]
 12046 00004E86 F8                      		clc
 12047 00004E87 C3                      		retn
 12048                                  
 12049                                  ; =============== S U B	R O U T	I N E =======================================
 12050                                  
 12051                                  
 12052                                  BUFRD:
 12053 00004E88 06                      		push	es
 12054 00004E89 31C0                    		xor	ax, ax
 12055 00004E8B E8BEFF                  		call	BUFSEC
 12056 00004E8E 7303                    		jnb	short BUF_OK
 12057                                  
 12058                                  BUF_IO_FAIL:				; ...
 12059 00004E90 07                      		pop	es
 12060 00004E91 EB2D                    		jmp	short RBUFPLACED
 12061                                  ; ---------------------------------------------------------------------------
 12062                                  
 12063                                  BUF_OK:					; ...
 12064 00004E93 8CC3                    		mov	bx, es
 12065 00004E95 8E06[2E03]              		mov	es, word [DMAADD+2]
 12066 00004E99 8EDB                    		mov	ds, bx
 12067 00004E9B 87FE                    		xchg	di, si
 12068 00004E9D D1E9                    		shr	cx, 1
 12069 00004E9F F3A5                    		rep movsw
 12070 00004EA1 83D100                  		adc	cx, 0
 12071 00004EA4 F3A4                    		rep movsb
 12072 00004EA6 07                      		pop	es
 12073 00004EA7 36C53E[E205]            		lds	di, [ss:CURBUF]
 12074 00004EAC 8D5D14                  		lea	bx, [di+20]
 12075 00004EAF 29DE                    		sub	si, bx
 12076 00004EB1 E8570C                  		call	PLACEBUF
 12077 00004EB4 263B7602                		cmp	si, [es:bp+2]
 12078 00004EB8 7205                    		jb	short RBUFPLACEDC
 12079 00004EBA 36893E[6D00]            		mov	word [ss:BufferQueue], di
 12080                                  
 12081                                  RBUFPLACEDC:				; ...
 12082 00004EBF F8                      		clc
 12083                                  
 12084                                  RBUFPLACED:				; ...
 12085 00004EC0 16                      		push	ss
 12086 00004EC1 1F                      		pop	ds
 12087 00004EC2 C3                      		retn
 12088                                  
 12089                                  ; =============== S U B	R O U T	I N E =======================================
 12090                                  
 12091                                  
 12092                                  BUFWRT:
 12093 00004EC3 A1[C405]                		mov	ax, [SECPOS]
 12094 00004EC6 83C001                  		add	ax, 1
 12095 00004EC9 A3[C405]                		mov	[SECPOS], ax
 12096 00004ECC 8316[C605]00            		adc	word [SECPOS+2], 0
 12097 00004ED1 A1[C605]                		mov	ax, [SECPOS+2]
 12098 00004ED4 3B06[CA05]              		cmp	ax, [VALSEC+2]
 12099 00004ED8 B001                    		mov	al, 1
 12100 00004EDA 770F                    		ja	short NOREAD
 12101 00004EDC 720B                    		jb	short _doread
 12102 00004EDE A1[C405]                		mov	ax, [SECPOS]
 12103 00004EE1 3B06[C805]              		cmp	ax, [VALSEC]
 12104 00004EE5 B001                    		mov	al, 1
 12105 00004EE7 7702                    		ja	short NOREAD
 12106                                  
 12107                                  _doread:				; ...
 12108 00004EE9 30C0                    		xor	al, al
 12109                                  
 12110                                  NOREAD:					; ...
 12111 00004EEB 06                      		push	es
 12112 00004EEC E85DFF                  		call	BUFSEC
 12113 00004EEF 729F                    		jb	short BUF_IO_FAIL
 12114 00004EF1 8E1E[2E03]              		mov	ds, word [DMAADD+2]
 12115 00004EF5 D1E9                    		shr	cx, 1
 12116 00004EF7 F3A5                    		rep movsw
 12117 00004EF9 83D100                  		adc	cx, 0
 12118 00004EFC F3A4                    		rep movsb
 12119 00004EFE 07                      		pop	es
 12120 00004EFF 36C51E[E205]            		lds	bx, [ss:CURBUF]
 12121 00004F04 F6470540                		test	byte [bx+5], 40h
 12122 00004F08 7507                    		jnz	short yesdirty10
 12123 00004F0A E8540E                  		call	INC_DIRTY_COUNT
 12124 00004F0D 804F0540                		or	byte [bx+5], 40h
 12125                                  
 12126                                  yesdirty10:				; ...
 12127 00004F11 8D7714                  		lea	si, [bx+20]
 12128 00004F14 29F7                    		sub	di, si
 12129 00004F16 263B7E02                		cmp	di, [es:bp+2]
 12130 00004F1A 7205                    		jb	short WBUFPLACED
 12131 00004F1C 36891E[6D00]            		mov	word [ss:BufferQueue], bx
 12132                                  
 12133                                  WBUFPLACED:				; ...
 12134 00004F21 F8                      		clc
 12135 00004F22 16                      		push	ss
 12136 00004F23 1F                      		pop	ds
 12137 00004F24 C3                      		retn
 12138                                  
 12139                                  ; =============== S U B	R O U T	I N E =======================================
 12140                                  
 12141                                  
 12142                                  NEXTSEC:
 12143 00004F25 F606[7405]FF            		test	byte [TRANS], 0FFh
 12144 00004F2A 7426                    		jz	short CLRET
 12145 00004F2C A0[7305]                		mov	al, [SECCLUSPOS]
 12146 00004F2F FEC0                    		inc	al
 12147 00004F31 263A4604                		cmp	al, [es:bp+4]
 12148 00004F35 7618                    		jbe	short SAVPOS
 12149 00004F37 8B1E[BC05]              		mov	bx, [CLUSNUM]
 12150 00004F3B E8DC07                  		call	IsEOF
 12151 00004F3E 7314                    		jnb	short NONEXT
 12152 00004F40 E8EE07                  		call	UNPACK
 12153 00004F43 720F                    		jb	short NONEXT
 12154 00004F45 893E[BC05]              		mov	[CLUSNUM], di
 12155 00004F49 FF06[BA05]              		inc	word [LASTPOS]
 12156 00004F4D B000                    		mov	al, 0
 12157                                  
 12158                                  SAVPOS:					; ...
 12159 00004F4F A2[7305]                		mov	[SECCLUSPOS], al
 12160                                  
 12161                                  CLRET:					; ...
 12162 00004F52 F8                      		clc
 12163 00004F53 C3                      		retn
 12164                                  ; ---------------------------------------------------------------------------
 12165                                  
 12166                                  NONEXT:					; ...
 12167 00004F54 F9                      		stc
 12168 00004F55 C3                      		retn
 12169                                  
 12170                                  ; =============== S U B	R O U T	I N E =======================================
 12171                                  
 12172                                  
 12173                                  OPTIMIZE:
 12174 00004F56 52                      		push	dx
 12175 00004F57 53                      		push	bx
 12176 00004F58 268A4604                		mov	al, [es:bp+4]
 12177 00004F5C FEC0                    		inc	al
 12178 00004F5E 88C4                    		mov	ah, al
 12179 00004F60 28D0                    		sub	al, dl
 12180 00004F62 89CA                    		mov	dx, cx
 12181 00004F64 B90000                  		mov	cx, 0
 12182                                  
 12183                                  OPTCLUS:				; ...
 12184 00004F67 E8C707                  		call	UNPACK
 12185 00004F6A 7237                    		jb	short OP_ERR
 12186 00004F6C 00C1                    		add	cl, al
 12187 00004F6E 80D500                  		adc	ch, 0
 12188 00004F71 39D1                    		cmp	cx, dx
 12189 00004F73 7333                    		jnb	short BLKDON
 12190 00004F75 88E0                    		mov	al, ah
 12191 00004F77 43                      		inc	bx
 12192 00004F78 39DF                    		cmp	di, bx
 12193 00004F7A 74EB                    		jz	short OPTCLUS
 12194 00004F7C 4B                      		dec	bx
 12195                                  
 12196                                  FINCLUS:				; ...
 12197 00004F7D 891E[BC05]              		mov	[CLUSNUM], bx
 12198 00004F81 29CA                    		sub	dx, cx
 12199 00004F83 52                      		push	dx
 12200 00004F84 89C8                    		mov	ax, cx
 12201 00004F86 26F76602                		mul	word [es:bp+2]
 12202 00004F8A 8B36[B805]              		mov	si, [NEXTADD]
 12203 00004F8E 01F0                    		add	ax, si
 12204 00004F90 A3[B805]                		mov	[NEXTADD], ax
 12205 00004F93 58                      		pop	ax
 12206 00004F94 5A                      		pop	dx
 12207 00004F95 29D3                    		sub	bx, dx
 12208 00004F97 011E[BA05]              		add	word [LASTPOS], bx
 12209 00004F9B 5B                      		pop	bx
 12210 00004F9C E81700                  		call	FIGREC
 12211 00004F9F 89F3                    		mov	bx, si
 12212 00004FA1 F8                      		clc
 12213 00004FA2 C3                      		retn
 12214                                  ; ---------------------------------------------------------------------------
 12215                                  
 12216                                  OP_ERR:					; ...
 12217 00004FA3 83C404                  		add	sp, 4
 12218 00004FA6 F9                      		stc
 12219 00004FA7 C3                      		retn
 12220                                  ; ---------------------------------------------------------------------------
 12221                                  
 12222                                  BLKDON:					; ...
 12223 00004FA8 29D1                    		sub	cx, dx
 12224 00004FAA 28CC                    		sub	ah, cl
 12225 00004FAC FECC                    		dec	ah
 12226 00004FAE 8826[7305]              		mov	[SECCLUSPOS], ah
 12227 00004FB2 89D1                    		mov	cx, dx
 12228 00004FB4 EBC7                    		jmp	short FINCLUS
 12229                                  
 12230                                  ; =============== S U B	R O U T	I N E =======================================
 12231                                  
 12232                                  
 12233                                  FIGREC:
 12234 00004FB6 51                      		push	cx
 12235 00004FB7 268A4E05                		mov	cl, [es:bp+5]
 12236 00004FBB 4A                      		dec	dx
 12237 00004FBC 4A                      		dec	dx
 12238 00004FBD 36C706[0706]0000        		mov	word [ss:HIGH_SECTOR], 0
 12239 00004FC4 08C9                    		or	cl, cl
 12240 00004FC6 740C                    		jz	short noshift
 12241 00004FC8 30ED                    		xor	ch, ch
 12242                                  
 12243                                  rotleft:				; ...
 12244 00004FCA F8                      		clc
 12245 00004FCB D1D2                    		rcl	dx, 1
 12246 00004FCD 36D116[0706]            		rcl	word [ss:HIGH_SECTOR], 1
 12247 00004FD2 E2F6                    		loop	rotleft
 12248                                  
 12249                                  noshift:				; ...
 12250 00004FD4 08DA                    		or	dl, bl
 12251 00004FD6 2603560B                		add	dx, [es:bp+0Bh]
 12252 00004FDA 368316[0706]00          		adc	word [ss:HIGH_SECTOR], 0
 12253 00004FE0 59                      		pop	cx
 12254                                  
 12255                                  figrec_retn:				; ...
 12256 00004FE1 C3                      		retn
 12257                                  
 12258                                  ; =============== S U B	R O U T	I N E =======================================
 12259                                  
 12260                                  callmagic:
 12261 00004FE2 1E                      		push	ds
 12262 00004FE3 36FF36[0906]            		push	word [ss:OffsetMagicPatch]
 12263 00004FE8 CB                      		retf
 12264                                  
 12265                                  ; =============== S U B	R O U T	I N E =======================================
 12266                                  
 12267                                  
 12268                                  ALLOCATE:
 12269 00004FE9 F8                      		clc
 12270 00004FEA 0E                      		push	cs
 12271 00004FEB E8F4FF                  		call	callmagic
 12272 00004FEE 7303                    		jnb	short Regular_Allocate_Path
 12273 00004FF0 E99C00                  		jmp	Disk_Full_Return
 12274                                  ; ---------------------------------------------------------------------------
 12275                                  
 12276                                  Regular_Allocate_Path:			; ...
 12277 00004FF3 53                      		push	bx
 12278 00004FF4 31DB                    		xor	bx, bx
 12279 00004FF6 E83807                  		call	UNPACK
 12280 00004FF9 893E[9605]              		mov	[FATBYT], di
 12281 00004FFD 5B                      		pop	bx
 12282 00004FFE 72E1                    		jb	short figrec_retn
 12283 00005000 51                      		push	cx
 12284 00005001 53                      		push	bx
 12285 00005002 89DA                    		mov	dx, bx
 12286 00005004 268B5E1D                		mov	bx, [es:bp+1Dh]
 12287 00005008 83FB02                  		cmp	bx, 2
 12288 0000500B 7709                    		ja	short FINDFRE
 12289                                  
 12290                                  ads1:					; ...
 12291 0000500D 26C7461D0200            		mov	word [es:bp+1Dh], 2
 12292 00005013 BB0100                  		mov	bx, 1
 12293                                  
 12294                                  FINDFRE:				; ...
 12295 00005016 43                      		inc	bx
 12296 00005017 263B5E0D                		cmp	bx, [es:bp+0Dh]
 12297 0000501B 775E                    		ja	short ads7
 12298 0000501D E81107                  		call	UNPACK
 12299 00005020 722F                    		jb	short ads4
 12300 00005022 75F2                    		jnz	short FINDFRE
 12301 00005024 26895E1D                		mov	[es:bp+1Dh], bx
 12302 00005028 92                      		xchg	ax, dx
 12303 00005029 BA0100                  		mov	dx, 1
 12304 0000502C E85607                  		call	PACK
 12305 0000502F 7220                    		jb	short ads4
 12306 00005031 26837E1FFF              		cmp	word [es:bp+1Fh], 0FFFFh
 12307 00005036 7404                    		jz	short NO_ALLOC
 12308 00005038 26FF4E1F                		dec	word [es:bp+1Fh]
 12309                                  
 12310                                  NO_ALLOC:				; ...
 12311 0000503C 92                      		xchg	ax, dx
 12312 0000503D 87DA                    		xchg	bx, dx
 12313 0000503F 89D0                    		mov	ax, dx
 12314 00005041 E84107                  		call	PACK
 12315 00005044 720B                    		jb	short ads4
 12316 00005046 93                      		xchg	ax, bx
 12317 00005047 89DA                    		mov	dx, bx
 12318 00005049 E2CB                    		loop	FINDFRE
 12319 0000504B BAFFFF                  		mov	dx, 0FFFFh
 12320 0000504E E83407                  		call	PACK
 12321                                  
 12322                                  ads4:					; ...
 12323 00005051 5B                      		pop	bx
 12324 00005052 59                      		pop	cx
 12325 00005053 728C                    		jb	short figrec_retn
 12326 00005055 E8D906                  		call	UNPACK
 12327 00005058 7287                    		jb	short figrec_retn
 12328 0000505A E83900                  		call	RESTFATBYT
 12329 0000505D 7282                    		jb	short figrec_retn
 12330 0000505F 87DF                    		xchg	bx, di
 12331 00005061 09FF                    		or	di, di
 12332 00005063 7401                    		jz	short dofastk
 12333 00005065 C3                      		retn
 12334                                  ; ---------------------------------------------------------------------------
 12335                                  
 12336                                  dofastk:				; ...
 12337 00005066 52                      		push	dx
 12338 00005067 268A5600                		mov	dl, [es:bp+0]
 12339 0000506B 06                      		push	es
 12340 0000506C C43E[9E05]              		les	di, [THISSFT]
 12341 00005070 26895D0B                		mov	[es:di+0Bh], bx
 12342 00005074 26895D35                		mov	[es:di+35h], bx
 12343 00005078 07                      		pop	es
 12344 00005079 5A                      		pop	dx
 12345 0000507A C3                      		retn
 12346                                  ; ---------------------------------------------------------------------------
 12347                                  
 12348                                  ads7:					; ...
 12349 0000507B 26837E1D02              		cmp	word [es:bp+1Dh], 2
 12350 00005080 758B                    		jnz	short ads1
 12351 00005082 5B                      		pop	bx
 12352 00005083 BAFFFF                  		mov	dx, 0FFFFh
 12353 00005086 E81F00                  		call	RELBLKS
 12354 00005089 58                      		pop	ax
 12355 0000508A 29C8                    		sub	ax, cx
 12356 0000508C E80700                  		call	RESTFATBYT
 12357                                  
 12358                                  Disk_Full_Return:			; ...
 12359 0000508F C606[0B06]01            		mov	byte [DISK_FULL], 1
 12360 00005094 F9                      		stc
 12361 00005095 C3                      		retn
 12362                                  
 12363                                  ; =============== S U B	R O U T	I N E =======================================
 12364                                  
 12365                                  
 12366                                  RESTFATBYT:
 12367 00005096 53                      		push	bx
 12368 00005097 52                      		push	dx
 12369 00005098 57                      		push	di
 12370 00005099 31DB                    		xor	bx, bx
 12371 0000509B 8B16[9605]              		mov	dx, [FATBYT]
 12372 0000509F E8E306                  		call	PACK
 12373 000050A2 5F                      		pop	di
 12374 000050A3 5A                      		pop	dx
 12375 000050A4 5B                      		pop	bx
 12376 000050A5 C3                      		retn
 12377                                  
 12378                                  ; =============== S U B	R O U T	I N E =======================================
 12379                                  
 12380                                  
 12381                                  RELEASE	:
 12382 000050A6 31D2                    		xor	dx, dx
 12383                                  
 12384                                  RELBLKS:				; ...
 12385 000050A8 E88606                  		call	UNPACK
 12386 000050AB 7224                    		jb	short RELEASE_flush
 12387 000050AD 7422                    		jz	short RELEASE_flush
 12388 000050AF 89F8                    		mov	ax, di
 12389 000050B1 52                      		push	dx
 12390 000050B2 E8D006                  		call	PACK
 12391 000050B5 5A                      		pop	dx
 12392 000050B6 7219                    		jb	short RELEASE_flush
 12393 000050B8 09D2                    		or	dx, dx
 12394 000050BA 750B                    		jnz	short NO_DEALLOC
 12395 000050BC 26837E1FFF              		cmp	word [es:bp+1Fh], -1
 12396 000050C1 7404                    		jz	short NO_DEALLOC
 12397 000050C3 26FF461F                		inc	word [es:bp+1Fh]
 12398                                  
 12399                                  NO_DEALLOC:				; ...
 12400 000050C7 89C3                    		mov	bx, ax
 12401 000050C9 48                      		dec	ax
 12402 000050CA 7405                    		jz	short RELEASE_flush
 12403 000050CC E84B06                  		call	IsEOF
 12404 000050CF 72D5                    		jb	short RELEASE
 12405                                  
 12406                                  RELEASE_flush:				; ...
 12407 000050D1 268A4600                		mov	al, [es:bp+0]
 12408 000050D5 56                      		push	si
 12409 000050D6 51                      		push	cx
 12410 000050D7 06                      		push	es
 12411 000050D8 55                      		push	bp
 12412 000050D9 E8790B                  		call	FLUSHBUF
 12413 000050DC 5D                      		pop	bp
 12414 000050DD 07                      		pop	es
 12415 000050DE 59                      		pop	cx
 12416 000050DF 5E                      		pop	si
 12417                                  
 12418                                  RET12:					; ...
 12419 000050E0 C3                      		retn
 12420                                  
 12421                                  ; =============== S U B	R O U T	I N E =======================================
 12422                                  
 12423                                  
 12424                                  GETEOF:
 12425 000050E1 E84D06                  		call	UNPACK
 12426 000050E4 72FA                    		jb	short RET12
 12427 000050E6 53                      		push	bx
 12428 000050E7 89FB                    		mov	bx, di
 12429 000050E9 E82E06                  		call	IsEOF
 12430 000050EC 5B                      		pop	bx
 12431 000050ED 73F1                    		jnb	short RET12
 12432 000050EF 89FB                    		mov	bx, di
 12433 000050F1 EBEE                    		jmp	short GETEOF
 12434                                  
 12435                                  ; =============== S U B	R O U T	I N E =======================================
 12436                                  
 12437                                  
 12438                                  MAKEFCB	:
 12439 000050F3 36C606[4E03]00          		mov	byte [ss:SpaceFlag], 0
 12440 000050F9 30D2                    		xor	dl, dl
 12441 000050FB A802                    		test	al, 2
 12442 000050FD 7504                    		jnz	short DEFDRV
 12443 000050FF 26C60500                		mov	byte [es:di], 0
 12444                                  
 12445                                  DEFDRV:					; ...
 12446 00005103 47                      		inc	di
 12447 00005104 B90800                  		mov	cx, 8
 12448 00005107 A804                    		test	al, 4
 12449 00005109 93                      		xchg	ax, bx
 12450 0000510A B020                    		mov	al, ' '
 12451 0000510C 7404                    		jz	short FILLB
 12452 0000510E 01CF                    		add	di, cx
 12453 00005110 31C9                    		xor	cx, cx
 12454                                  
 12455                                  FILLB:					; ...
 12456 00005112 F3AA                    		rep stosb
 12457 00005114 B103                    		mov	cl, 3
 12458 00005116 F6C308                  		test	bl, 8
 12459 00005119 7404                    		jz	short FILLB2
 12460 0000511B 01CF                    		add	di, cx
 12461 0000511D 31C9                    		xor	cx, cx
 12462                                  
 12463                                  FILLB2:					; ...
 12464 0000511F F3AA                    		rep stosb
 12465 00005121 91                      		xchg	ax, cx
 12466 00005122 AB                      		stosw
 12467 00005123 AB                      		stosw
 12468 00005124 83EF10                  		sub	di, 16
 12469 00005127 F6C301                  		test	bl, 1
 12470 0000512A 7409                    		jz	short SKPSPC
 12471 0000512C E88E00                  		call	SCANB
 12472 0000512F E82801                  		call	DELIM
 12473 00005132 7504                    		jnz	short NOSCAN
 12474 00005134 46                      		inc	si
 12475                                  
 12476                                  SKPSPC:					; ...
 12477 00005135 E88500                  		call	SCANB
 12478                                  
 12479                                  NOSCAN:					; ...
 12480 00005138 E8F600                  		call	GETLET
 12481 0000513B 761E                    		jbe	short NODRV
 12482 0000513D 803C3A                  		cmp	byte [si], ':'
 12483 00005140 7519                    		jnz	short NODRV
 12484 00005142 46                      		inc	si
 12485 00005143 2C40                    		sub	al, '@'
 12486 00005145 760F                    		jbe	short BADDRV
 12487 00005147 50                      		push	ax
 12488 00005148 E8741B                  		call	GetVisDrv
 12489 0000514B 58                      		pop	ax
 12490 0000514C 730A                    		jnb	short HAVDRV
 12491 0000514E 36803E[1006]1A          		cmp	byte [ss:DrvErr], 1Ah
 12492 00005154 7402                    		jz	short HAVDRV
 12493                                  
 12494                                  BADDRV:					; ...
 12495 00005156 B2FF                    		mov	dl, -1
 12496                                  
 12497                                  HAVDRV:					; ...
 12498 00005158 AA                      		stosb
 12499 00005159 46                      		inc	si
 12500 0000515A 4F                      		dec	di
 12501                                  
 12502                                  NODRV:					; ...
 12503 0000515B 4E                      		dec	si
 12504 0000515C 47                      		inc	di
 12505                                  
 12506                                  NORMSCAN:				; ...
 12507 0000515D B90800                  		mov	cx, 8
 12508 00005160 E82800                  		call	GETWORD
 12509 00005163 803C2E                  		cmp	byte [si], '.'
 12510 00005166 7515                    		jnz	short NODOT
 12511 00005168 46                      		inc	si
 12512 00005169 36F606[1206]01          		test	byte [ss:DOS34_FLAG+1], 1
 12513 0000516F 7406                    		jz	short VOLOK
 12514 00005171 A4                      		movsb
 12515 00005172 B90200                  		mov	cx, 2
 12516 00005175 EB03                    		jmp	short contvol
 12517                                  ; ---------------------------------------------------------------------------
 12518                                  
 12519                                  VOLOK:					; ...
 12520 00005177 B90300                  		mov	cx, 3
 12521                                  
 12522                                  contvol:				; ...
 12523 0000517A E81400                  		call	MUSTGETWORD
 12524                                  
 12525                                  NODOT:					; ...
 12526 0000517D 88D0                    		mov	al, dl
 12527 0000517F 368126[1106]FFFE        		and	word [ss:DOS34_FLAG], 0FEFFh
 12528 00005186 C3                      		retn
 12529                                  
 12530                                  ; ---------------------------------------------------------------------------
 12531                                  ; START	OF FUNCTION CHUNK FOR GETWORD
 12532                                  
 12533                                  NONAM:					; ...
 12534 00005187 01CF                    		add	di, cx
 12535 00005189 4E                      		dec	si
 12536 0000518A C3                      		retn
 12537                                  ; END OF FUNCTION CHUNK	FOR GETWORD
 12538                                  
 12539                                  ; =============== S U B	R O U T	I N E =======================================
 12540                                  
 12541                                  
 12542                                  GETWORD	:
 12543                                  
 12544                                  ; FUNCTION CHUNK AT 8F67 SIZE 00000004 BYTES
 12545                                  
 12546 0000518B E8A300                  		call	GETLET
 12547 0000518E 76F7                    		jbe	short NONAM
 12548 00005190 4E                      		dec	si
 12549                                  
 12550                                  MUSTGETWORD:				; ...
 12551 00005191 E89D00                  		call	GETLET
 12552 00005194 750C                    		jnz	short MustCheckCX
 12553 00005196 36F606[4E03]FF          		test	byte [ss:SpaceFlag], 0FFh
 12554 0000519C 7419                    		jz	short FILLNAM
 12555 0000519E 3C20                    		cmp	al, ' '
 12556 000051A0 7515                    		jnz	short FILLNAM
 12557                                  
 12558                                  MustCheckCX:				; ...
 12559 000051A2 E3ED                    		jcxz	MUSTGETWORD
 12560 000051A4 49                      		dec	cx
 12561 000051A5 3C2A                    		cmp	al, '*'
 12562 000051A7 7504                    		jnz	short NOSTAR
 12563 000051A9 B03F                    		mov	al, '?'
 12564 000051AB F3AA                    		rep stosb
 12565                                  
 12566                                  NOSTAR:					; ...
 12567 000051AD AA                      		stosb
 12568 000051AE 3C3F                    		cmp	al, '?'
 12569 000051B0 75DF                    		jnz	short MUSTGETWORD
 12570 000051B2 80CA01                  		or	dl, 1
 12571 000051B5 EBDA                    		jmp	short MUSTGETWORD
 12572                                  ; ---------------------------------------------------------------------------
 12573                                  
 12574                                  FILLNAM:				; ...
 12575 000051B7 B020                    		mov	al, ' '
 12576 000051B9 F3AA                    		rep stosb
 12577 000051BB 4E                      		dec	si
 12578 000051BC C3                      		retn
 12579                                  
 12580                                  ; =============== S U B	R O U T	I N E =======================================
 12581                                  
 12582                                  
 12583                                  SCANB	:
 12584 000051BD AC                      		lodsb
 12585 000051BE E8A100                  		call	SPCHK
 12586 000051C1 74FA                    		jz	short SCANB
 12587 000051C3 4E                      		dec	si
 12588                                  
 12589                                  scanb_retn:				; ...
 12590 000051C4 C3                      		retn
 12591                                  
 12592                                  ; =============== S U B	R O U T	I N E =======================================
 12593                                  
 12594                                  
 12595                                  NAMETRANS:
 12596 000051C5 36C606[4E03]01          		mov	byte [ss:SpaceFlag], 1
 12597 000051CB 16                      		push	ss
 12598 000051CC 07                      		pop	es
 12599 000051CD BF[4B05]                		mov	di, NAME1
 12600 000051D0 57                      		push	di
 12601 000051D1 B82020                  		mov	ax, '  '
 12602 000051D4 B90500                  		mov	cx, 5
 12603 000051D7 AA                      		stosb
 12604 000051D8 F3AB                    		rep stosw
 12605 000051DA 30C0                    		xor	al, al
 12606 000051DC 88C2                    		mov	dl, al
 12607 000051DE AA                      		stosb
 12608 000051DF 5F                      		pop	di
 12609 000051E0 E87AFF                  		call	NORMSCAN
 12610 000051E3 36803E[4B05]E5          		cmp	byte [ss:NAME1], 0E5h
 12611 000051E9 75D9                    		jnz	short scanb_retn
 12612 000051EB 36C606[4B05]05          		mov	byte [ss:NAME1], 5
 12613 000051F1 C3                      		retn
 12614                                  
 12615                                  ; ---------------------------------------------------------------------------
 12616 000051F2 6666666606666666        CharType:	db  66h, 66h, 66h, 66h,	06h, 66h, 66h, 66h; 0 ;	...
 12617 000051FA 6666666666666666        		db  66h, 66h, 66h, 66h,	66h, 66h, 66h, 66h; 8
 12618 00005202 F8F6FFFFFF4FF46E        		db 0F8h,0F6h,0FFh,0FFh,0FFh, 4Fh,0F4h, 6Eh; 16
 12619 0000520A FFFFFFFFFF4444F4        		db 0FFh,0FFh,0FFh,0FFh,0FFh, 44h, 44h,0F4h; 24
 12620 00005212 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh; 32
 12621 0000521A FFFFFFFFFF6F66FF        		db 0FFh,0FFh,0FFh,0FFh,0FFh, 6Fh, 66h,0FFh; 40
 12622 00005222 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh; 48
 12623 0000522A FFFFFFFFFFFFF4          		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0F4h; 56
 12624                                  
 12625                                  ; =============== S U B	R O U T	I N E =======================================
 12626                                  
 12627                                  
 12628                                  GETLET:
 12629 00005231 AC                      		lodsb
 12630                                  
 12631                                  ; =============== S U B	R O U T	I N E =======================================
 12632                                  
 12633                                  
 12634                                  UCase:
 12635 00005232 53                      		push	bx
 12636 00005233 BB[310B]                		mov	bx, FILE_UCASE_TAB_2
 12637                                  
 12638                                  gl_0:					; ...
 12639 00005236 3C61                    		cmp	al, 'a'
 12640 00005238 7214                    		jb	short gl_2
 12641 0000523A 3C7A                    		cmp	al, 'z'
 12642 0000523C 7702                    		ja	short gl_1
 12643 0000523E 2C20                    		sub	al, 20h
 12644                                  
 12645                                  gl_1:					; ...
 12646 00005240 3C80                    		cmp	al, 80h
 12647 00005242 720A                    		jb	short gl_2
 12648 00005244 2C80                    		sub	al, 80h
 12649 00005246 1E                      		push	ds
 12650 00005247 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
 12651 0000524C D7                      		xlat
 12652 0000524D 1F                      		pop	ds
 12653                                  
 12654                                  gl_2:					; ...
 12655 0000524E 50                      		push	ax
 12656 0000524F E81800                  		call	GetCharType
 12657 00005252 A801                    		test	al, 1
 12658 00005254 58                      		pop	ax
 12659 00005255 5B                      		pop	bx
 12660 00005256 C3                      		retn
 12661                                  
 12662                                  ; =============== S U B	R O U T	I N E =======================================
 12663                                  
 12664                                  
 12665                                  GETLET3:
 12666 00005257 53                      		push	bx
 12667 00005258 EBDC                    		jmp	short gl_0
 12668                                  
 12669                                  ; =============== S U B	R O U T	I N E =======================================
 12670                                  
 12671                                  
 12672                                  DELIM:
 12673 0000525A 50                      		push	ax
 12674 0000525B E80C00                  		call	GetCharType
 12675 0000525E A802                    		test	al, 2
 12676 00005260 58                      		pop	ax
 12677 00005261 C3                      		retn
 12678                                  
 12679                                  ; =============== S U B	R O U T	I N E =======================================
 12680                                  
 12681                                  
 12682                                  SPCHK:
 12683 00005262 50                      		push	ax
 12684 00005263 E80400                  		call	GetCharType
 12685 00005266 A804                    		test	al, 4
 12686 00005268 58                      		pop	ax
 12687 00005269 C3                      		retn
 12688                                  
 12689                                  ; =============== S U B	R O U T	I N E =======================================
 12690                                  
 12691                                  
 12692                                  GetCharType:
 12693 0000526A 3C7E                    		cmp	al, 7Eh
 12694 0000526C 7316                    		jnb	short gct_90
 12695 0000526E 53                      		push	bx
 12696 0000526F BB[F251]                		mov	bx, CharType
 12697 00005272 D0E8                    		shr	al, 1
 12698                                  		;xlat	byte [cs:bx]
 12699 00005274 2ED7                    		cs	xlat
 12700 00005276 5B                      		pop	bx
 12701 00005277 7308                    		jnb	short gct_80
 12702 00005279 D0E8                    		shr	al, 1
 12703 0000527B D0E8                    		shr	al, 1
 12704 0000527D D0E8                    		shr	al, 1
 12705 0000527F D0E8                    		shr	al, 1
 12706                                  
 12707                                  gct_80:					; ...
 12708 00005281 240F                    		and	al, 0Fh
 12709 00005283 C3                      		retn
 12710                                  ; ---------------------------------------------------------------------------
 12711                                  
 12712                                  gct_90:					; ...
 12713 00005284 B00F                    		mov	al, 0Fh
 12714 00005286 C3                      		retn
 12715                                  
 12716                                  ; =============== S U B	R O U T	I N E =======================================
 12717                                  
 12718                                  
 12719                                  PATHCHRCMP:
 12720 00005287 3C2F                    		cmp	al, '/'
 12721 00005289 7606                    		jbe	short PathRet
 12722 0000528B 3C5C                    		cmp	al, '\'
 12723 0000528D C3                      		retn
 12724                                  ; ---------------------------------------------------------------------------
 12725                                  
 12726                                  GotFor:					; ...
 12727 0000528E B05C                    		mov	al, '\'
 12728 00005290 C3                      		retn
 12729                                  ; ---------------------------------------------------------------------------
 12730                                  
 12731                                  PathRet:				; ...
 12732 00005291 74FB                    		jz	short GotFor
 12733 00005293 C3                      		retn
 12734                                  
 12735                                  ; ---------------------------------------------------------------------------
 12736 00005294 [E7100000]              LowInt23Addr:	dd LowInt23		; ...
 12737 00005298 [FB100000]              LowInt24Addr:	dd LowInt24		; ...
 12738 0000529C [0F110000]              LowInt28Addr:	dd LowInt28		; ...
 12739                                  
 12740                                  ; =============== S U B	R O U T	I N E =======================================
 12741                                  
 12742                                  
 12743                                  DSKSTATCHK:
 12744 000052A0 36803E[2103]01          		cmp	byte [ss:INDOS], 1
 12745 000052A6 7401                    		jz	short dskstatchk1
 12746 000052A8 C3                      		retn
 12747                                  ; ---------------------------------------------------------------------------
 12748                                  
 12749                                  dskstatchk1:				; ...
 12750 000052A9 51                      		push	cx
 12751 000052AA 06                      		push	es
 12752 000052AB 53                      		push	bx
 12753 000052AC 1E                      		push	ds
 12754 000052AD 56                      		push	si
 12755 000052AE 8CD3                    		mov	bx, ss
 12756 000052B0 8EC3                    		mov	es, bx
 12757 000052B2 8EDB                    		mov	ds, bx
 12758 000052B4 36C606[9403]05          		mov	byte [ss:DSKSTCOM], 5
 12759 000052BA 36C606[9203]0E          		mov	byte [ss:DSKSTCALL], 0Eh
 12760 000052C0 36C706[9503]0000        		mov	word [ss:DSKSTST], 0
 12761 000052C7 BB[9203]                		mov	bx, DSKSTCALL
 12762 000052CA 36C536[3200]            		lds	si, [ss:BCON]
 12763 000052CF E83BF5                  		call	DEVIOCALL2
 12764 000052D2 36F606[9603]02          		test	byte [ss:DSKSTST+1], 2
 12765 000052D8 7408                    		jz	short _GotCh
 12766 000052DA 30C0                    		xor	al, al
 12767                                  
 12768                                  RET36:					; ...
 12769 000052DC 5E                      		pop	si
 12770 000052DD 1F                      		pop	ds
 12771 000052DE 5B                      		pop	bx
 12772 000052DF 07                      		pop	es
 12773 000052E0 59                      		pop	cx
 12774 000052E1 C3                      		retn
 12775                                  ; ---------------------------------------------------------------------------
 12776                                  
 12777                                  _GotCh:					; ...
 12778 000052E2 36A0[9F03]              		mov	al, [ss:DSKCHRET]
 12779 000052E6 3C03                    		cmp	al, 3
 12780 000052E8 75F2                    		jnz	short RET36
 12781 000052EA 36C606[9403]04          		mov	byte [ss:DSKSTCOM], 4
 12782 000052F0 36C606[9203]16          		mov	byte [ss:DSKSTCALL], 16h
 12783 000052F6 36880E[9F03]            		mov	[ss:DSKCHRET], cl
 12784 000052FB 36C706[9503]0000        		mov	word [ss:DSKSTST], 0
 12785 00005302 36C706[A403]0100        		mov	word [ss:DSKSTCNT], 1
 12786 00005309 E801F5                  		call	DEVIOCALL2
 12787 0000530C 5E                      		pop	si
 12788 0000530D 1F                      		pop	ds
 12789 0000530E 5B                      		pop	bx
 12790 0000530F 07                      		pop	es
 12791 00005310 59                      		pop	cx
 12792 00005311 E9D000                  		jmp	CNTCHAND
 12793                                  
 12794                                  ; ---------------------------------------------------------------------------
 12795                                  ; START	OF FUNCTION CHUNK FOR STATCHK
 12796                                  
 12797                                  NOSTOP:					; ...
 12798 00005314 3C10                    		cmp	al, 10h		; "P"-"@"
 12799 00005316 7509                    		jnz	short check_next
 12800 00005318 36803E[900D]00          		cmp	byte [ss:SCAN_FLAG], 0
 12801 0000531E 7406                    		jz	short INCHKJ
 12802 00005320 C3                      		retn
 12803                                  ; ---------------------------------------------------------------------------
 12804                                  
 12805                                  check_next:				; ...
 12806 00005321 3C03                    		cmp	al, 3		; "C"-"@"
 12807 00005323 7401                    		jz	short INCHKJ
 12808                                  
 12809                                  check_end:				; ...
 12810 00005325 C3                      		retn
 12811                                  ; ---------------------------------------------------------------------------
 12812                                  
 12813                                  INCHKJ:					; ...
 12814 00005326 E9A500                  		jmp	INCHK
 12815                                  ; END OF FUNCTION CHUNK	FOR STATCHK
 12816                                  
 12817                                  ; =============== S U B	R O U T	I N E =======================================
 12818                                  
 12819                                  
 12820                                  SPOOLINT:
 12821 00005329 9C                      		pushf
 12822 0000532A 36803E[5803]00          		cmp	byte [ss:IDLEINT], 0
 12823 00005330 7423                    		jz	short POPFRET
 12824 00005332 36803E[2003]00          		cmp	byte [ss:ERRORMODE], 0
 12825 00005338 751B                    		jnz	short POPFRET
 12826 0000533A 36FF36[5803]            		push	word [ss:IDLEINT]
 12827 0000533F 36803E[1112]00          		cmp	byte [ss:DosHasHMA], 0
 12828 00005345 7504                    		jnz	short do_low_int28
 12829 00005347 CD28                    		int	28h		; DOS 2+ internal - KEYBOARD BUSY LOOP
 12830 00005349 EB05                    		jmp	short spool_ret_addr
 12831                                  ; ---------------------------------------------------------------------------
 12832                                  
 12833                                  do_low_int28:				; ...
 12834 0000534B 2EFF1E[9C52]            		call	far [cs:LowInt28Addr]
 12835                                  
 12836                                  spool_ret_addr:				; ...
 12837 00005350 368F06[5803]            		pop	word [ss:IDLEINT]
 12838                                  
 12839                                  POPFRET:				; ...
 12840 00005355 9D                      		popf
 12841                                  
 12842                                  _RET18:					; ...
 12843 00005356 C3                      		retn
 12844                                  
 12845                                  ; =============== S U B	R O U T	I N E =======================================
 12846                                  
 12847                                  
 12848                                  STATCHK:
 12849                                  
 12850                                  ; FUNCTION CHUNK AT 4052 SIZE 0000007A BYTES
 12851                                  ; FUNCTION CHUNK AT 40D0 SIZE 00000003 BYTES
 12852                                  ; FUNCTION CHUNK AT 40F8 SIZE 00000154 BYTES
 12853                                  ; FUNCTION CHUNK AT 90F4 SIZE 00000015 BYTES
 12854                                  
 12855 00005357 E846FF                  		call	DSKSTATCHK
 12856 0000535A 53                      		push	bx
 12857 0000535B 31DB                    		xor	bx, bx
 12858 0000535D E843E4                  		call	GET_IO_SFT
 12859 00005360 5B                      		pop	bx
 12860 00005361 72F3                    		jb	short _RET18
 12861 00005363 B401                    		mov	ah, 1
 12862 00005365 E8CBF2                  		call	IOFUNC
 12863 00005368 74BF                    		jz	short SPOOLINT
 12864 0000536A 3C13                    		cmp	al, 13h		; 'S'-'@'
 12865 0000536C 75A6                    		jnz	short NOSTOP
 12866 0000536E 36803E[900D]00          		cmp	byte [ss:SCAN_FLAG], 0
 12867 00005374 75AF                    		jnz	short check_end
 12868 00005376 30E4                    		xor	ah, ah
 12869 00005378 E8B8F2                  		call	IOFUNC
 12870 0000537B EB4A                    		jmp	short PAUSOSTRT
 12871                                  ; ---------------------------------------------------------------------------
 12872                                  
 12873                                  PRINTONOFF:				; ...
 12874 0000537D 36F616[FE02]            		not	byte [ss:PFLAG]
 12875 00005382 53                      		push	bx
 12876 00005383 BB0400                  		mov	bx, 4
 12877 00005386 E81AE4                  		call	GET_IO_SFT
 12878 00005389 5B                      		pop	bx
 12879 0000538A 72CA                    		jb	short _RET18
 12880 0000538C 06                      		push	es
 12881 0000538D 57                      		push	di
 12882 0000538E 1E                      		push	ds
 12883 0000538F 07                      		pop	es
 12884 00005390 89F7                    		mov	di, si
 12885 00005392 26F6450608              		test	byte [es:di+6], 8
 12886 00005397 7418                    		jz	short NORM_PR
 12887 00005399 50                      		push	ax
 12888 0000539A B82611                  		mov	ax, 1126h
 12889 0000539D CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - ???
 12890                                  					; Return: CF set on error, AX =	error code
 12891                                  					; STACK	unchanged
 12892 0000539F 58                      		pop	ax
 12893 000053A0 730F                    		jnb	short NORM_PR
 12894 000053A2 36C606[FE02]00          		mov	byte [ss:PFLAG], 0
 12895 000053A8 50                      		push	ax
 12896 000053A9 B82411                  		mov	ax, 1124h
 12897 000053AC CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - ???
 12898                                  					; ES:DI	-> SFT,	SS = DOS CS
 12899 000053AE 58                      		pop	ax
 12900 000053AF EB10                    		jmp	short RETP6
 12901                                  ; ---------------------------------------------------------------------------
 12902                                  
 12903                                  NORM_PR:				; ...
 12904 000053B1 36803E[FE02]00          		cmp	byte [ss:PFLAG], 0
 12905 000053B7 7505                    		jnz	short PRNOPN
 12906 000053B9 E8D5F3                  		call	DEV_CLOSE_SFT
 12907 000053BC EB03                    		jmp	short RETP6
 12908                                  ; ---------------------------------------------------------------------------
 12909                                  
 12910                                  PRNOPN:					; ...
 12911 000053BE E8C8F3                  		call	DEV_OPEN_SFT
 12912                                  
 12913                                  RETP6:					; ...
 12914 000053C1 5F                      		pop	di
 12915 000053C2 07                      		pop	es
 12916                                  
 12917                                  STATCHK_RETN:				; ...
 12918 000053C3 C3                      		retn
 12919                                  ; ---------------------------------------------------------------------------
 12920                                  
 12921                                  PAUSOLP:				; ...
 12922 000053C4 E862FF                  		call	SPOOLINT
 12923                                  
 12924                                  PAUSOSTRT:				; ...
 12925 000053C7 B401                    		mov	ah, 1
 12926 000053C9 E867F2                  		call	IOFUNC
 12927 000053CC 74F6                    		jz	short PAUSOLP
 12928                                  
 12929                                  INCHK:					; ...
 12930 000053CE 53                      		push	bx
 12931 000053CF 31DB                    		xor	bx, bx
 12932 000053D1 E8CFE3                  		call	GET_IO_SFT
 12933 000053D4 5B                      		pop	bx
 12934 000053D5 72EC                    		jb	short STATCHK_RETN
 12935 000053D7 30E4                    		xor	ah, ah
 12936 000053D9 E857F2                  		call	IOFUNC
 12937 000053DC 3C10                    		cmp	al, 10h		; "P"-"@"
 12938 000053DE 749D                    		jz	short PRINTONOFF
 12939 000053E0 3C03                    		cmp	al, 3		; "C"-"@"
 12940 000053E2 75DF                    		jnz	short STATCHK_RETN
 12941                                  
 12942                                  CNTCHAND:				; ...
 12943 000053E4 36F606[1206]02          		test	byte [ss:DOS34_FLAG+1], 2
 12944 000053EA 7508                    		jnz	short around_deadlock
 12945 000053EC B003                    		mov	al, 3
 12946 000053EE E8B1C3                  		call	BUFOUT
 12947 000053F1 E83EC2                  		call	CRLF
 12948                                  
 12949                                  around_deadlock:			; ...
 12950 000053F4 16                      		push	ss
 12951 000053F5 1F                      		pop	ds
 12952 000053F6 803E[5703]00            		cmp	byte [CONSWAP], 0
 12953 000053FB 7403                    		jz	short NOSWAP
 12954 000053FD E803E0                  		call	SWAPBACK
 12955                                  
 12956                                  NOSWAP:					; ...
 12957 00005400 FA                      		cli
 12958 00005401 8E16[8605]              		mov	ss, [USER_SS]
 12959 00005405 8B26[8405]              		mov	sp, [USER_SP]
 12960 00005409 E860B0                  		call	restore_world
 12961 0000540C 07                      		pop	es
 12962 0000540D 1E                      		push	ds
 12963 0000540E 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
 12964 00005413 C606[2103]00            		mov	byte [INDOS], 0
 12965 00005418 C606[2003]00            		mov	byte [ERRORMODE], 0
 12966 0000541D 8926[3203]              		mov	[ConC_Spsave], sp
 12967 00005421 8306[3203]02            		add	word [ConC_Spsave], 2
 12968 00005426 803E[1112]00            		cmp	byte [DosHasHMA], 0
 12969 0000542B 1F                      		pop	ds
 12970 0000542C 7505                    		jnz	short do_low_int23
 12971 0000542E F8                      		clc
 12972 0000542F CD23                    		int	23h		; DOS -	CONTROL	"C" EXIT ADDRESS
 12973                                  					; Return: return via RETF 2 with CF set
 12974                                  					; DOS will abort program with errorlevel 0
 12975                                  					; else
 12976                                  					; interrupted DOS call continues
 12977 00005431 EB06                    		jmp	short ctrlc_ret_addr
 12978                                  ; ---------------------------------------------------------------------------
 12979                                  
 12980                                  do_low_int23:				; ...
 12981 00005433 F8                      		clc
 12982 00005434 2EFF1E[9452]            		call	far [cs:LowInt23Addr]
 12983                                  
 12984                                  ctrlc_ret_addr:				; ...
 12985 00005439 FA                      		cli
 12986 0000543A 50                      		push	ax
 12987 0000543B 8CD8                    		mov	ax, ds
 12988 0000543D 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
 12989 00005442 A3[0A0D]                		mov	[TEMPSEG], ax
 12990 00005445 58                      		pop	ax
 12991 00005446 A3[3A03]                		mov	[USER_IN_AX], ax
 12992 00005449 9C                      		pushf
 12993 0000544A 58                      		pop	ax
 12994 0000544B 3B26[3203]              		cmp	sp, [ConC_Spsave]
 12995 0000544F 750A                    		jnz	short ctrlc_try_new
 12996                                  
 12997                                  ctrlc_repeat:				; ...
 12998 00005451 A1[3A03]                		mov	ax, [USER_IN_AX]
 12999 00005454 8E1E[0A0D]              		mov	ds, [TEMPSEG]
 13000                                  
 13001                                  COMMANDJ:				; ...
 13002 00005458 E9BDAE                  		jmp	command
 13003                                  ; ---------------------------------------------------------------------------
 13004                                  
 13005                                  ctrlc_try_new:				; ...
 13006 0000545B 83C402                  		add	sp, 2
 13007 0000545E A801                    		test	al, 1
 13008 00005460 74EF                    		jz	short ctrlc_repeat
 13009 00005462 8E1E[0A0D]              		mov	ds, [TEMPSEG]
 13010                                  
 13011                                  ctrlc_abort:				; ...
 13012 00005466 B8004C                  		mov	ax, 4C00h
 13013 00005469 1E                      		push	ds
 13014 0000546A 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
 13015 0000546F C606[4D03]FF            		mov	byte [DidCTRLC], 0FFh
 13016 00005474 1F                      		pop	ds
 13017 00005475 EBE1                    		jmp	short COMMANDJ
 13018                                  
 13019                                  ; ---------------------------------------------------------------------------
 13020                                  
 13021                                  DIVOV:					; ...
 13022 00005477 BE[9809]                		mov	si, DIVMES	; "\r\nDivide overflow\r\n"
 13023 0000547A 2E8B1E[AB09]            		mov	bx, [cs:DivMesLen]
 13024 0000547F 2E8E16[0700]            		mov	ss, [cs:DosDSeg]
 13025 00005484 BC[A007]                		mov	sp, AUXSTACK
 13026 00005487 E80200                  		call	_OUTMES
 13027 0000548A EBDA                    		jmp	short ctrlc_abort
 13028                                  
 13029                                  ; =============== S U B	R O U T	I N E =======================================
 13030                                  
 13031                                  
 13032                                  _OUTMES	:
 13033 0000548C 16                      		push	ss
 13034 0000548D 07                      		pop	es
 13035 0000548E 16                      		push	ss
 13036 0000548F 1F                      		pop	ds
 13037 00005490 C606[9403]08            		mov	byte [DSKSTCOM], 8
 13038 00005495 C606[9203]16            		mov	byte [DSKSTCALL], 16h
 13039 0000549A C706[9503]0000          		mov	word [DSKSTST], 0
 13040 000054A0 891E[A403]              		mov	[DSKSTCNT], bx
 13041 000054A4 BB[9203]                		mov	bx, DSKSTCALL
 13042 000054A7 8936[A003]              		mov	[DEVIOBUF_PTR], si ; [DSKCHRET+1]
 13043 000054AB 8C0E[A203]              		mov	[DOSSEG_INIT],	cs ; [DSKCHRET+3]
 13044 000054AF C536[3200]              		lds	si, [BCON]
 13045 000054B3 E857F3                  		call	DEVIOCALL2
 13046 000054B6 26C706[A003][BC03]      		mov	word [es:DEVIOBUF_PTR], DEVIOBUF
 13047 000054BD 26C706[A403]0100        		mov	word [es:DSKSTCNT], 1
 13048 000054C4 C3                      		retn
 13049                                  
 13050                                  ; =============== S U B	R O U T	I N E =======================================
 13051                                  
 13052                                  
 13053                                  CHARHARD:
 13054 000054C5 36803E[2003]00          		cmp	byte [ss:ERRORMODE], 0
 13055 000054CB 750B                    		jnz	short chard1
 13056 000054CD 80CC10                  		or	ah, 10h
 13057 000054D0 36F606[FE02]FF          		test	byte [ss:PFLAG], 0FFh
 13058 000054D6 7503                    		jnz	short ctrlp
 13059                                  
 13060                                  chard1:					; ...
 13061 000054D8 80CC38                  		or	ah, 38h
 13062                                  
 13063                                  ctrlp:					; ...
 13064 000054DB 368826[4B03]            		mov	byte [ss:ALLOWED], ah
 13065 000054E0 368C06[8205]            		mov	word [ss:EXITHOLD+2], es
 13066 000054E5 36892E[8005]            		mov	word [ss:EXITHOLD], bp
 13067 000054EA 56                      		push	si
 13068 000054EB 81E7FF00                		and	di, 0FFh
 13069 000054EF 8CDD                    		mov	bp, ds
 13070 000054F1 E86400                  		call	FATALC
 13071 000054F4 5E                      		pop	si
 13072 000054F5 C3                      		retn
 13073                                  
 13074                                  ; =============== S U B	R O U T	I N E =======================================
 13075                                  
 13076                                  
 13077                                  HARDERR	:
 13078 000054F6 97                      		xchg	ax, di
 13079 000054F7 81E7FF00                		and	di, 0FFh
 13080 000054FB 83FF00                  		cmp	di, 0
 13081 000054FE 750A                    		jnz	short NOSETWRPERR
 13082 00005500 50                      		push	ax
 13083 00005501 268A4600                		mov	al, [es:bp+0]
 13084 00005505 36A2[2203]              		mov	byte [ss:WPERR], al
 13085 00005509 58                      		pop	ax
 13086                                  
 13087                                  NOSETWRPERR:				; ...
 13088 0000550A 29C8                    		sub	ax, cx
 13089 0000550C 01C2                    		add	dx, ax
 13090 0000550E 52                      		push	dx
 13091 0000550F 26F76602                		mul	word [es:bp+2]
 13092 00005513 5A                      		pop	dx
 13093 00005514 01C3                    		add	bx, ax
 13094 00005516 30E4                    		xor	ah, ah
 13095 00005518 263B5606                		cmp	dx, [es:bp+6]
 13096 0000551C 721A                    		jb	short ERRINT
 13097 0000551E FEC4                    		inc	ah
 13098 00005520 263B5611                		cmp	dx, [es:bp+11h]
 13099 00005524 7308                    		jnb	short TESTDIR
 13100 00005526 26C7461FFFFF            		mov	word [es:bp+1Fh], 0FFFFh
 13101 0000552C EB0A                    		jmp	short ERRINT
 13102                                  ; ---------------------------------------------------------------------------
 13103                                  
 13104                                  TESTDIR:				; ...
 13105 0000552E FEC4                    		inc	ah
 13106 00005530 263B560B                		cmp	dx, [es:bp+0Bh]
 13107 00005534 7202                    		jb	short ERRINT
 13108 00005536 FEC4                    		inc	ah
 13109                                  
 13110                                  ERRINT:					; ...
 13111 00005538 D0E4                    		shl	ah, 1
 13112 0000553A 360A26[7505]            		or	ah, [ss:READOP]
 13113 0000553F 360A26[4B03]            		or	ah, [ss:ALLOWED]
 13114                                  
 13115                                  FATAL:					; ...
 13116 00005544 268A4600                		mov	al, [es:bp+0]
 13117                                  
 13118                                  FATAL1:					; ...
 13119 00005548 368C06[8205]            		mov	word [ss:EXITHOLD+2], es
 13120 0000554D 36892E[8005]            		mov	word [ss:EXITHOLD], bp
 13121 00005552 26C47613                		les	si, [es:bp+13h]
 13122 00005556 8CC5                    		mov	bp, es
 13123                                  
 13124                                  ; =============== S U B	R O U T	I N E =======================================
 13125                                  
 13126                                  
 13127                                  FATALC:
 13128                                  
 13129                                  ; FUNCTION CHUNK AT A1EA SIZE 0000000D BYTES
 13130                                  ; FUNCTION CHUNK AT A1FF SIZE 00000022 BYTES
 13131                                  
 13132 00005558 E89801                  		call	SET_I24_EXTENDED_ERROR
 13133 0000555B 83FF0C                  		cmp	di, 0Ch
 13134 0000555E 7603                    		jbe	short NET_I24_ENTRY
 13135 00005560 BF0C00                  		mov	di, 0Ch
 13136                                  
 13137                                  NET_I24_ENTRY:				; ...
 13138 00005563 36803E[2003]00          		cmp	byte [ss:ERRORMODE], 0
 13139 00005569 7404                    		jz	short NoSetFail
 13140 0000556B B003                    		mov	al, 3
 13141 0000556D EB6C                    		jmp	short FailRet
 13142                                  ; ---------------------------------------------------------------------------
 13143                                  
 13144                                  NoSetFail:				; ...
 13145 0000556F 368926[8805]            		mov	[ss:CONTSTK], sp
 13146 00005574 16                      		push	ss
 13147 00005575 07                      		pop	es
 13148 00005576 36833E[AA05]FF          		cmp	word [ss:SFN], 0FFFFh
 13149 0000557C 740C                    		jz	short _NoFree
 13150 0000557E 1E                      		push	ds
 13151 0000557F 56                      		push	si
 13152 00005580 36C536[AE05]            		lds	si, [ss:PJFN]
 13153 00005585 C604FF                  		mov	byte [si], 0FFh
 13154 00005588 5E                      		pop	si
 13155 00005589 1F                      		pop	ds
 13156                                  
 13157                                  _NoFree:				; ...
 13158 0000558A FA                      		cli
 13159 0000558B 36FE06[2003]            		inc	byte [ss:ERRORMODE]
 13160 00005590 36FE0E[2103]            		dec	byte [ss:INDOS]
 13161 00005595 36F606[F605]02          		test	byte [ss:EXTOPEN_ON], 2
 13162 0000559B 7404                    		jz	short i24yes
 13163 0000559D B003                    		mov	al, 3
 13164 0000559F EB29                    		jmp	short passi24
 13165                                  ; ---------------------------------------------------------------------------
 13166                                  
 13167                                  i24yes:					; ...
 13168 000055A1 368E16[8605]            		mov	ss, [ss:USER_SS]
 13169 000055A6 268B26[8405]            		mov	sp, [es:USER_SP]
 13170 000055AB 26803E[1112]00          		cmp	byte [es:DosHasHMA], 0
 13171 000055B1 7504                    		jnz	short do_low_int24
 13172 000055B3 CD24                    		int	24h		; DOS -	FATAL ERROR HANDLER ADDRESS
 13173                                  					; Automatically	called upon detection of unrecoverable I/O error.
 13174 000055B5 EB05                    		jmp	short criterr_ret_addr
 13175                                  ; ---------------------------------------------------------------------------
 13176                                  
 13177                                  do_low_int24:				; ...
 13178 000055B7 2EFF1E[9852]            		call	far [cs:LowInt24Addr]
 13179                                  
 13180                                  criterr_ret_addr:			; ...
 13181 000055BC 268926[8405]            		mov	[es:USER_SP], sp
 13182 000055C1 268C16[8605]            		mov	[es:USER_SS], ss
 13183 000055C6 8CC5                    		mov	bp, es
 13184 000055C8 8ED5                    		mov	ss, bp
 13185                                  
 13186                                  passi24:				; ...
 13187 000055CA 368B26[8805]            		mov	sp, [ss:CONTSTK]
 13188 000055CF 36FE06[2103]            		inc	byte [ss:INDOS]
 13189 000055D4 36C606[2003]00          		mov	byte [ss:ERRORMODE], 0
 13190 000055DA FB                      		sti
 13191                                  
 13192                                  FailRet:				; ...
 13193 000055DB 36C42E[8005]            		les	bp, [ss:EXITHOLD]
 13194 000055E0 3C01                    		cmp	al, 1
 13195 000055E2 723E                    		jb	short CheckIgnore
 13196 000055E4 7446                    		jz	short CheckRetry
 13197 000055E6 3C03                    		cmp	al, 3
 13198 000055E8 754C                    		jnz	short DoAbort
 13199 000055EA 36F606[4B03]08          		test	byte [ss:ALLOWED], 8
 13200 000055F0 7444                    		jz	short DoAbort
 13201                                  
 13202                                  DoFail:					; ...
 13203 000055F2 B003                    		mov	al, 3
 13204 000055F4 36F606[F605]02          		test	byte [ss:EXTOPEN_ON], 2
 13205 000055FA 7505                    		jnz	short CleanUp
 13206 000055FC 36FE06[4A03]            		inc	byte [ss:FAILERR]
 13207                                  
 13208                                  CleanUp:				; ...
 13209 00005601 36C606[2203]FF          		mov	byte [ss:WPERR], 0FFh
 13210 00005607 36833E[AA05]FF          		cmp	word [ss:SFN], 0FFFFh
 13211 0000560D 7501                    		jnz	short CleanUp2
 13212 0000560F C3                      		retn
 13213                                  ; ---------------------------------------------------------------------------
 13214                                  
 13215                                  CleanUp2:				; ...
 13216 00005610 1E                      		push	ds
 13217 00005611 56                      		push	si
 13218 00005612 50                      		push	ax
 13219 00005613 36A1[AA05]              		mov	ax, [ss:SFN]
 13220 00005617 36C536[AE05]            		lds	si, [ss:PJFN]
 13221 0000561C 8804                    		mov	[si], al
 13222 0000561E 58                      		pop	ax
 13223 0000561F 5E                      		pop	si
 13224 00005620 1F                      		pop	ds
 13225 00005621 C3                      		retn
 13226                                  ; ---------------------------------------------------------------------------
 13227                                  
 13228                                  CheckIgnore:				; ...
 13229 00005622 36F606[4B03]20          		test	byte [ss:ALLOWED], 20h
 13230 00005628 74C8                    		jz	short DoFail
 13231 0000562A EBD5                    		jmp	short CleanUp
 13232                                  ; ---------------------------------------------------------------------------
 13233                                  
 13234                                  CheckRetry:				; ...
 13235 0000562C 36F606[4B03]10          		test	byte [ss:ALLOWED], 10h
 13236 00005632 74BE                    		jz	short DoFail
 13237 00005634 EBCB                    		jmp	short CleanUp
 13238                                  ; ---------------------------------------------------------------------------
 13239                                  
 13240                                  DoAbort:				; ...
 13241 00005636 16                      		push	ss
 13242 00005637 1F                      		pop	ds
 13243 00005638 803E[5703]00            		cmp	byte [CONSWAP], 0
 13244 0000563D 7403                    		jz	short NOSWAP2
 13245 0000563F E8C1DD                  		call	SWAPBACK
 13246                                  
 13247                                  NOSWAP2:				; ...
 13248 00005642 803E[5903]00            		cmp	byte [fAborting], 0
 13249 00005647 75A9                    		jnz	short DoFail
 13250 00005649 C606[7C05]02            		mov	byte [EXIT_TYPE], 2
 13251 0000564E 30C0                    		xor	al, al
 13252 00005650 E9B70D                  		jmp	exit_inner
 13253                                  ; ---------------------------------------------------------------------------
 13254                                  
 13255                                  reset_environment:			; ...
 13256 00005653 1E                      		push	ds
 13257 00005654 B482                    		mov	ah, 82h
 13258 00005656 CD2A                    		int	2Ah		; Microsoft Networks - END DOS CRITICAL	SECTIONS 0 THROUGH 7
 13259 00005658 36C606[5903]FF          		mov	byte [ss:fAborting], 0FFh ; -1
 13260 0000565E B82211                  		mov	ax, 1122h
 13261 00005661 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - PROCESS TERMINATION HOOK
 13262                                  					; SS = DOS CS
 13263 00005663 B022                    		mov	al, 22h
 13264 00005665 E842B8                  		call	$GET_INTERRUPT_VECTOR
 13265 00005668 59                      		pop	cx
 13266 00005669 06                      		push	es
 13267 0000566A 53                      		push	bx
 13268 0000566B 368B1E[3003]            		mov	bx, [ss:CurrentPDB]
 13269 00005670 8EDB                    		mov	ds, bx
 13270 00005672 A11600                  		mov	ax, [16h]	; [PDB.PARENT_PID]
 13271 00005675 39D8                    		cmp	ax, bx
 13272 00005677 7418                    		jz	short reset_return
 13273 00005679 39CB                    		cmp	bx, cx
 13274 0000567B 7514                    		jnz	short reset_return
 13275 0000567D 50                      		push	ax
 13276 0000567E 36803E[7C05]03          		cmp	byte [ss:EXIT_TYPE], 3
 13277 00005684 7406                    		jz	short reset_to_parent
 13278 00005686 E8B90D                  		call	arena_free_process
 13279 00005689 E855D9                  		call	DOS_ABORT
 13280                                  
 13281                                  reset_to_parent:			; ...
 13282 0000568C 368F06[3003]            		pop	word [ss:CurrentPDB]
 13283                                  
 13284                                  reset_return:				; ...
 13285 00005691 16                      		push	ss
 13286 00005692 1F                      		pop	ds
 13287 00005693 B0FF                    		mov	al, 0FFh
 13288 00005695 E8C2BC                  		call	ECritDisk
 13289 00005698 E8BA05                  		call	FLUSHBUF
 13290 0000569B E8DCBC                  		call	LCritDisk
 13291 0000569E E855F7                  		call	CHECK_VIRT_OPEN
 13292 000056A1 FA                      		cli
 13293                                  
 13294 000056A2 C606[2103]00            		mov	byte [INDOS], 0
 13295 000056A7 C606[2203]FF            		mov	byte [WPERR], 0FFh
 13296 000056AC C606[5903]00            		mov	byte [fAborting], 0
 13297 000056B1 8F06[8005]              		pop	word [EXITHOLD]
 13298 000056B5 8F06[8205]              		pop	word [EXITHOLD+2]
 13299 000056B9 8E1E[3003]              		mov	ds, [CurrentPDB]
 13300 000056BD 8E163000                		mov	ss, word [30h]
 13301 000056C1 8B262E00                		mov	sp, [2Eh]	; [PDB.USER_STACK]
 13302 000056C5 E8A4AD                  		call	restore_world
 13303 000056C8 07                      		pop	es
 13304 000056C9 50                      		push	ax
 13305 000056CA 8CD8                    		mov	ax, ds
 13306 000056CC 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
 13307 000056D1 A3[0A0D]                		mov	[TEMPSEG], ax
 13308 000056D4 58                      		pop	ax
 13309 000056D5 A3[8405]                		mov	[USER_SP], ax
 13310 000056D8 58                      		pop	ax
 13311 000056D9 58                      		pop	ax
 13312 000056DA 58                      		pop	ax
 13313 000056DB 9F                      		lahf
 13314 000056DC 86E0                    		xchg	ah, al
 13315 000056DE 2402                    		and	al, 2
 13316 000056E0 B4F2                    		mov	ah, 0F2h
 13317 000056E2 50                      		push	ax
 13318 000056E3 FF36[8205]              		push	word [EXITHOLD+2]
 13319 000056E7 FF36[8005]              		push	word [EXITHOLD]
 13320 000056EB A1[8405]                		mov	ax, [USER_SP]
 13321 000056EE 8E1E[0A0D]              		mov	ds, [TEMPSEG]
 13322 000056F2 CF                      		iret
 13323                                  
 13324                                  ; =============== S U B	R O U T	I N E =======================================
 13325                                  
 13326                                  
 13327                                  SET_I24_EXTENDED_ERROR:
 13328 000056F3 50                      		push	ax
 13329 000056F4 B8[BB0E]                		mov	ax, FIRST_BUFF_ADDR ; ErrMap24End
 13330 000056F7 2D[AB0E]                		sub	ax, ErrMap24
 13331 000056FA 1E                      		push	ds
 13332 000056FB 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
 13333 00005700 39C7                    		cmp	di, ax
 13334 00005702 89F8                    		mov	ax, di
 13335 00005704 7306                    		jnb	short NoTrans
 13336 00005706 8A85[AB0E]              		mov	al, [ErrMap24+di]
 13337 0000570A 30E4                    		xor	ah, ah
 13338                                  
 13339                                  NoTrans:				; ...
 13340 0000570C A3[2403]                		mov	word [EXTERR], ax
 13341 0000570F 1F                      		pop	ds
 13342 00005710 58                      		pop	ax
 13343 00005711 56                      		push	si
 13344 00005712 BE[5B0E]                		mov	si, ERR_TABLE_24
 13345 00005715 E83CAF                  		call	CAL_LK
 13346 00005718 5E                      		pop	si
 13347 00005719 C3                      		retn
 13348                                  
 13349                                  ; =============== S U B	R O U T	I N E =======================================
 13350                                  
 13351                                  
 13352                                  IsEOF:
 13353 0000571A 26817E0DF60F            		cmp	word [es:bp+0Dh], 0FF6h
 13354 00005720 730B                    		jnb	short EOF16
 13355 00005722 81FBF00F                		cmp	bx, 0FF0h
 13356 00005726 7404                    		jz	short IsEOF_other
 13357 00005728 81FBF80F                		cmp	bx, 0FF8h
 13358                                  
 13359                                  IsEOF_other:				; ...
 13360 0000572C C3                      		retn
 13361                                  ; ---------------------------------------------------------------------------
 13362                                  
 13363                                  EOF16:					; ...
 13364 0000572D 83FBF8                  		cmp	bx, 0FFF8h
 13365 00005730 C3                      		retn
 13366                                  
 13367                                  ; =============== S U B	R O U T	I N E =======================================
 13368                                  
 13369                                  
 13370                                  UNPACK:
 13371 00005731 09DB                    		or	bx, bx
 13372 00005733 7507                    		jnz	short up_cont
 13373 00005735 8B3E[8100]              		mov	di, [CL0FATENTRY]
 13374 00005739 09FF                    		or	di, di
 13375 0000573B C3                      		retn
 13376                                  ; ---------------------------------------------------------------------------
 13377                                  
 13378                                  up_cont:				; ...
 13379 0000573C 263B5E0D                		cmp	bx, [es:bp+0Dh]
 13380 00005740 7726                    		ja	short HURTFAT
 13381 00005742 E8DC00                  		call	MAPCLUSTER
 13382 00005745 721E                    		jb	short _DoContext
 13383 00005747 8B3D                    		mov	di, [di]
 13384 00005749 750E                    		jnz	short High12
 13385 0000574B 268B760D                		mov	si, [es:bp+0Dh]
 13386 0000574F 81FEF60F                		cmp	si, 0FF6h
 13387 00005753 720C                    		jb	short Unpack12
 13388 00005755 09FF                    		or	di, di
 13389 00005757 EB0C                    		jmp	short _DoContext
 13390                                  ; ---------------------------------------------------------------------------
 13391                                  
 13392                                  High12:					; ...
 13393 00005759 D1EF                    		shr	di, 1
 13394 0000575B D1EF                    		shr	di, 1
 13395 0000575D D1EF                    		shr	di, 1
 13396 0000575F D1EF                    		shr	di, 1
 13397                                  
 13398                                  Unpack12:				; ...
 13399 00005761 81E7FF0F                		and	di, 0FFFh
 13400                                  
 13401                                  _DoContext:				; ...
 13402 00005765 16                      		push	ss
 13403 00005766 1F                      		pop	ds
 13404 00005767 C3                      		retn
 13405                                  ; ---------------------------------------------------------------------------
 13406                                  
 13407                                  HURTFAT:				; ...
 13408 00005768 26C7461FFFFF            		mov	word [es:bp+1Fh], 0FFFFh
 13409 0000576E 50                      		push	ax
 13410 0000576F B488                    		mov	ah, 88h
 13411 00005771 36C606[4B03]08          		mov	byte [ss:ALLOWED], 8
 13412 00005777 BFFF0F                  		mov	di, 0FFFh
 13413 0000577A E8C7FD                  		call	FATAL
 13414 0000577D 3C03                    		cmp	al, 3
 13415 0000577F F8                      		clc
 13416 00005780 7501                    		jnz	short OKU_RET
 13417 00005782 F9                      		stc
 13418                                  
 13419                                  OKU_RET:				; ...
 13420 00005783 58                      		pop	ax
 13421                                  
 13422                                  hurtfat_retn:				; ...
 13423 00005784 C3                      		retn
 13424                                  
 13425                                  ; =============== S U B	R O U T	I N E =======================================
 13426                                  
 13427                                  
 13428                                  PACK:
 13429 00005785 09DB                    		or	bx, bx
 13430 00005787 7505                    		jnz	short p_cont
 13431 00005789 8916[8100]              		mov	[CL0FATENTRY], dx
 13432 0000578D C3                      		retn
 13433                                  ; ---------------------------------------------------------------------------
 13434                                  
 13435                                  p_cont:					; ...
 13436 0000578E E89000                  		call	MAPCLUSTER
 13437 00005791 72D2                    		jb	short _DoContext
 13438 00005793 8B35                    		mov	si, [di]
 13439 00005795 740B                    		jz	short ALIGNED
 13440 00005797 51                      		push	cx
 13441 00005798 B104                    		mov	cl, 4
 13442 0000579A D3E2                    		shl	dx, cl
 13443 0000579C 59                      		pop	cx
 13444 0000579D 83E60F                  		and	si, 0Fh
 13445 000057A0 EB14                    		jmp	short PACKIN
 13446                                  ; ---------------------------------------------------------------------------
 13447                                  
 13448                                  ALIGNED:				; ...
 13449 000057A2 26817E0DF60F            		cmp	word [es:bp+0Dh], 0FF6h
 13450 000057A8 730A                    		jnb	short Pack16
 13451 000057AA 81E600F0                		and	si, 0F000h
 13452 000057AE 81E2FF0F                		and	dx, 0FFFh
 13453 000057B2 EB02                    		jmp	short PACKIN
 13454                                  ; ---------------------------------------------------------------------------
 13455                                  
 13456                                  Pack16:					; ...
 13457 000057B4 31F6                    		xor	si, si
 13458                                  
 13459                                  PACKIN:					; ...
 13460 000057B6 09D6                    		or	si, dx
 13461 000057B8 8935                    		mov	[di], si
 13462 000057BA 36C536[E205]            		lds	si, [ss:CURBUF]
 13463 000057BF F6440540                		test	byte [si+5], 40h
 13464 000057C3 7507                    		jnz	short yesdirty11
 13465 000057C5 E89905                  		call	INC_DIRTY_COUNT
 13466 000057C8 804C0540                		or	byte [si+5], 40h
 13467                                  
 13468                                  yesdirty11:				; ...
 13469 000057CC 36803E[7805]00          		cmp	byte [ss:CLUSSPLIT], 0
 13470 000057D2 16                      		push	ss
 13471 000057D3 1F                      		pop	ds
 13472 000057D4 74AE                    		jz	short hurtfat_retn
 13473 000057D6 50                      		push	ax
 13474 000057D7 53                      		push	bx
 13475 000057D8 51                      		push	cx
 13476 000057D9 A1[8E05]                		mov	ax, [CLUSSAVE]
 13477 000057DC 8E1E[E405]              		mov	ds, word [CURBUF+2]
 13478 000057E0 83C614                  		add	si, 20
 13479 000057E3 8824                    		mov	[si], ah
 13480 000057E5 16                      		push	ss
 13481 000057E6 1F                      		pop	ds
 13482 000057E7 50                      		push	ax
 13483 000057E8 8B16[9205]              		mov	dx, [CLUSSEC+2]
 13484 000057EC 8916[0706]              		mov	word [HIGH_SECTOR], dx
 13485 000057F0 8B16[9005]              		mov	dx, [CLUSSEC]
 13486 000057F4 BE0100                  		mov	si, 1
 13487 000057F7 30C0                    		xor	al, al
 13488 000057F9 E85D03                  		call	GETBUFFRB
 13489 000057FC 58                      		pop	ax
 13490 000057FD 721C                    		jb	short POPP_RET
 13491 000057FF C53E[E205]              		lds	di, [CURBUF]
 13492 00005803 F6450540                		test	byte [di+5], 40h
 13493 00005807 7507                    		jnz	short yesdirty12
 13494 00005809 E85505                  		call	INC_DIRTY_COUNT
 13495 0000580C 804D0540                		or	byte [di+5], 40h
 13496                                  
 13497                                  yesdirty12:				; ...
 13498 00005810 83C714                  		add	di, 20
 13499 00005813 4F                      		dec	di
 13500 00005814 26037E02                		add	di, [es:bp+2]
 13501 00005818 8805                    		mov	[di], al
 13502 0000581A F8                      		clc
 13503                                  
 13504                                  POPP_RET:				; ...
 13505 0000581B 16                      		push	ss
 13506 0000581C 1F                      		pop	ds
 13507 0000581D 59                      		pop	cx
 13508 0000581E 5B                      		pop	bx
 13509 0000581F 58                      		pop	ax
 13510 00005820 C3                      		retn
 13511                                  
 13512                                  ; =============== S U B	R O U T	I N E =======================================
 13513                                  
 13514                                  
 13515                                  MAPCLUSTER:
 13516 00005821 C606[7805]00            		mov	byte [CLUSSPLIT], 0
 13517 00005826 50                      		push	ax
 13518 00005827 53                      		push	bx
 13519 00005828 51                      		push	cx
 13520 00005829 52                      		push	dx
 13521 0000582A 89D8                    		mov	ax, bx
 13522 0000582C 26817E0DF60F            		cmp	word [es:bp+0Dh], 0FF6h
 13523 00005832 7302                    		jnb	short Map16
 13524 00005834 D1E8                    		shr	ax, 1
 13525                                  
 13526                                  Map16:					; ...
 13527 00005836 31FF                    		xor	di, di
 13528 00005838 01D8                    		add	ax, bx
 13529 0000583A 11FF                    		adc	di, di
 13530 0000583C 268B4E02                		mov	cx, [es:bp+2]
 13531 00005840 81F90002                		cmp	cx, 512
 13532 00005844 7510                    		jnz	short _DoDiv
 13533 00005846 89C2                    		mov	dx, ax
 13534 00005848 81E2FF01                		and	dx, 1FFh
 13535 0000584C 88E0                    		mov	al, ah
 13536 0000584E D1EF                    		shr	di, 1
 13537 00005850 D0D8                    		rcr	al, 1
 13538 00005852 30E4                    		xor	ah, ah
 13539 00005854 EB04                    		jmp	short DivDone
 13540                                  ; ---------------------------------------------------------------------------
 13541                                  
 13542                                  _DoDiv:					; ...
 13543 00005856 89FA                    		mov	dx, di
 13544 00005858 F7F1                    		div	cx
 13545                                  
 13546                                  DivDone:				; ...
 13547 0000585A 26034606                		add	ax, [es:bp+6]
 13548 0000585E 49                      		dec	cx
 13549 0000585F 50                      		push	ax
 13550 00005860 52                      		push	dx
 13551 00005861 51                      		push	cx
 13552 00005862 89C2                    		mov	dx, ax
 13553 00005864 C706[0706]0000          		mov	word [HIGH_SECTOR], 0
 13554 0000586A 30C0                    		xor	al, al
 13555 0000586C BE0100                  		mov	si, 1
 13556 0000586F E8E702                  		call	GETBUFFRB
 13557 00005872 59                      		pop	cx
 13558 00005873 58                      		pop	ax
 13559 00005874 5A                      		pop	dx
 13560 00005875 7257                    		jb	short MAP_POP
 13561 00005877 C536[E205]              		lds	si, [CURBUF]
 13562 0000587B 8D7C14                  		lea	di, [si+20]
 13563 0000587E 01C7                    		add	di, ax
 13564 00005880 39C8                    		cmp	ax, cx
 13565 00005882 7537                    		jnz	short MAPRET
 13566 00005884 8A05                    		mov	al, [di]
 13567 00005886 16                      		push	ss
 13568 00005887 1F                      		pop	ds
 13569 00005888 FE06[7805]              		inc	byte [CLUSSPLIT]
 13570 0000588C A2[8E05]                		mov	byte [CLUSSAVE], al
 13571 0000588F 8916[9005]              		mov	[CLUSSEC], dx
 13572 00005893 C706[9205]0000          		mov	word [CLUSSEC+2], 0
 13573 00005899 42                      		inc	dx
 13574 0000589A C706[0706]0000          		mov	word [HIGH_SECTOR], 0
 13575 000058A0 30C0                    		xor	al, al
 13576 000058A2 BE0100                  		mov	si, 1
 13577 000058A5 E8B102                  		call	GETBUFFRB
 13578 000058A8 7224                    		jb	short MAP_POP
 13579 000058AA C536[E205]              		lds	si, [CURBUF]
 13580 000058AE 8D7C14                  		lea	di, [si+20]
 13581 000058B1 8A05                    		mov	al, [di]
 13582 000058B3 16                      		push	ss
 13583 000058B4 1F                      		pop	ds
 13584 000058B5 A2[8F05]                		mov	byte [CLUSSAVE+1], al
 13585 000058B8 BF[8E05]                		mov	di, CLUSSAVE
 13586                                  
 13587                                  MAPRET:					; ...
 13588 000058BB 5A                      		pop	dx
 13589 000058BC 59                      		pop	cx
 13590 000058BD 5B                      		pop	bx
 13591 000058BE 31C0                    		xor	ax, ax
 13592 000058C0 26817E0DF60F            		cmp	word [es:bp+0Dh], 0FF6h
 13593 000058C6 7302                    		jnb	short MapSet
 13594 000058C8 89D8                    		mov	ax, bx
 13595                                  
 13596                                  MapSet:					; ...
 13597 000058CA A801                    		test	al, 1
 13598 000058CC 58                      		pop	ax
 13599 000058CD C3                      		retn
 13600                                  ; ---------------------------------------------------------------------------
 13601                                  
 13602                                  MAP_POP:				; ...
 13603 000058CE 5A                      		pop	dx
 13604 000058CF 59                      		pop	cx
 13605 000058D0 5B                      		pop	bx
 13606 000058D1 58                      		pop	ax
 13607 000058D2 C3                      		retn
 13608                                  
 13609                                  ; =============== S U B	R O U T	I N E =======================================
 13610                                  
 13611                                  
 13612                                  FATREAD_SFT:
 13613 000058D3 26C46D07                		les	bp, [es:di+7]
 13614 000058D7 268A4600                		mov	al, [es:bp+0]
 13615 000058DB A2[7605]                		mov	[THISDRV], al
 13616 000058DE E827AD                  		call	GOTDPB
 13617 000058E1 E87900                  		call	FAT_GOT_DPB
 13618                                  
 13619                                  fatread_sft_retn:			; ...
 13620 000058E4 C3                      		retn
 13621                                  
 13622                                  ; =============== S U B	R O U T	I N E =======================================
 13623                                  
 13624                                  
 13625                                  FATREAD_CDS:
 13626 000058E5 06                      		push	es
 13627 000058E6 57                      		push	di
 13628 000058E7 26C46D45                		les	bp, [es:di+45h]
 13629 000058EB 268A4600                		mov	al, [es:bp+0]
 13630 000058EF A2[7605]                		mov	[THISDRV], al
 13631 000058F2 E813AD                  		call	GOTDPB
 13632 000058F5 E86500                  		call	FAT_GOT_DPB
 13633 000058F8 5F                      		pop	di
 13634 000058F9 07                      		pop	es
 13635 000058FA 72E8                    		jb	short fatread_sft_retn
 13636 000058FC 7538                    		jnz	short NO_CHANGE
 13637 000058FE 31C0                    		xor	ax, ax
 13638 00005900 48                      		dec	ax
 13639 00005901 1E                      		push	ds
 13640 00005902 8A0E[4700]              		mov	cl, [CDSCOUNT]
 13641 00005906 30ED                    		xor	ch, ch
 13642 00005908 26C57545                		lds	si, [es:di+45h]
 13643 0000590C 36C43E[3C00]            		les	di, [ss:CDSADDR]
 13644                                  
 13645                                  frcd20:					; ...
 13646 00005911 26F6454480              		test	byte [es:di+44h], 80h
 13647 00005916 7518                    		jnz	short frcd25
 13648 00005918 263B7545                		cmp	si, [es:di+45h]
 13649 0000591C 7512                    		jnz	short frcd25
 13650 0000591E 8CDB                    		mov	bx, ds
 13651 00005920 263B5D47                		cmp	bx, [es:di+47h]
 13652 00005924 750A                    		jnz	short frcd25
 13653 00005926 26854549                		test	[es:di+49h], ax
 13654 0000592A 7404                    		jz	short frcd25
 13655 0000592C 26894549                		mov	[es:di+49h], ax
 13656                                  
 13657                                  frcd25:					; ...
 13658 00005930 83C758                  		add	di, 88
 13659 00005933 E2DC                    		loop	frcd20
 13660 00005935 1F                      		pop	ds
 13661                                  
 13662                                  NO_CHANGE:				; ...
 13663 00005936 C42E[8A05]              		les	bp, [THISDPB]
 13664 0000593A F8                      		clc
 13665 0000593B C3                      		retn
 13666                                  
 13667                                  ; ---------------------------------------------------------------------------
 13668                                  ; START	OF FUNCTION CHUNK FOR FAT_GOT_DPB
 13669                                  
 13670                                  FATERR:					; ...
 13671 0000593C 26C7461FFFFF            		mov	word [es:bp+1Fh], 0FFFFh ; -1
 13672 00005942 81E7FF00                		and	di, 0FFh
 13673 00005946 C606[4B03]18            		mov	byte [ALLOWED], 18h
 13674 0000594B B41A                    		mov	ah, 1Ah
 13675 0000594D A0[7605]                		mov	al, [THISDRV]
 13676 00005950 E8F5FB                  		call	FATAL1
 13677 00005953 C42E[8A05]              		les	bp, [THISDPB]
 13678 00005957 3C03                    		cmp	al, 3
 13679 00005959 7502                    		jnz	short FAT_GOT_DPB
 13680 0000595B F9                      		stc
 13681 0000595C C3                      		retn
 13682                                  ; END OF FUNCTION CHUNK	FOR FAT_GOT_DPB
 13683                                  
 13684                                  ; =============== S U B	R O U T	I N E =======================================
 13685                                  
 13686                                  
 13687                                  FAT_GOT_DPB:
 13688                                  
 13689                                  ; FUNCTION CHUNK AT 971C SIZE 00000021 BYTES
 13690                                  
 13691 0000595D 16                      		push	ss
 13692 0000595E 1F                      		pop	ds
 13693 0000595F B00F                    		mov	al, 0Fh
 13694 00005961 268A6601                		mov	ah, [es:bp+1]
 13695 00005965 A3[5A03]                		mov	word [DEVCALL], ax
 13696 00005968 C606[5C03]01            		mov	byte [DEVCALL_REQFUNC], 1
 13697 0000596D C706[5D03]0000          		mov	word [DEVCALL_REQSTAT], 0
 13698 00005973 268A4617                		mov	al, [es:bp+17h]	; [ES:BP+DPB.MEDIA]
 13699 00005977 A2[6703]                		mov	[CALLUNIT], al	; [CALLMED]
 13700 0000597A 06                      		push	es
 13701 0000597B 1E                      		push	ds
 13702 0000597C BB[5A03]                		mov	bx, DEVCALL
 13703 0000597F 26C57613                		lds	si, [es:bp+13h]	; [ES:BP+DPB.DRIVER_ADDR]
 13704 00005983 07                      		pop	es
 13705 00005984 E886EE                  		call	DEVIOCALL2
 13706 00005987 16                      		push	ss
 13707 00005988 1F                      		pop	ds
 13708 00005989 07                      		pop	es
 13709 0000598A 8B3E[5D03]              		mov	di, [DEVCALL_REQSTAT]
 13710 0000598E 09FF                    		or	di, di
 13711 00005990 78AA                    		js	short FATERR
 13712 00005992 30E4                    		xor	ah, ah
 13713 00005994 26866618                		xchg	ah, [es:bp+18h]	; [ES:BP+DPB.FIRST_ACCESS]
 13714 00005998 A0[7605]                		mov	al, [THISDRV]
 13715 0000599B 3806[A10A]              		cmp	byte [VOLCHNG_FLAG], al
 13716 0000599F 7508                    		jnz	short CHECK_BYT
 13717 000059A1 C606[A10A]FF            		mov	byte [VOLCHNG_FLAG], 0FFh ;	-1
 13718 000059A6 E9A900                  		jmp	GOGETBPB
 13719                                  ; ---------------------------------------------------------------------------
 13720                                  
 13721                                  CHECK_BYT:				; ...
 13722 000059A9 0A26[6803]              		or	ah, byte [CALLBR] ; [CALLRBYT]
 13723 000059AD 7902                    		jns	short CHECK_ZR
 13724 000059AF EB65                    		jmp	short NEWDSK
 13725                                  ; ---------------------------------------------------------------------------
 13726                                  
 13727                                  CHECK_ZR:				; ...
 13728 000059B1 743C                    		jz	short CHKBUFFDIRT
 13729 000059B3 F8                      		clc
 13730 000059B4 C3                      		retn
 13731                                  ; ---------------------------------------------------------------------------
 13732                                  
 13733                                  DISK_CHNG_ERR:				; ...
 13734 000059B5 06                      		push	es
 13735 000059B6 55                      		push	bp
 13736 000059B7 26C46E13                		les	bp, [es:bp+13h]
 13737 000059BB 26F6460508              		test	byte [es:bp+5], 8
 13738 000059C0 5D                      		pop	bp
 13739 000059C1 07                      		pop	es
 13740 000059C2 7426                    		jz	short FAIL_OPJ2
 13741 000059C4 1E                      		push	ds
 13742 000059C5 57                      		push	di
 13743 000059C6 16                      		push	ss
 13744 000059C7 1F                      		pop	ds
 13745 000059C8 C606[4B03]18            		mov	byte [ALLOWED], 18h	; Allowed_FAIL+Allowed_RETRY
 13746 000059CD 06                      		push	es
 13747 000059CE C43E[6903]              		les	di, [CALLBR+1]	; [CALLVIDM]
 13748 000059D2 8C06[2A03]              		mov	word [EXTERRPT+2], es
 13749 000059D6 07                      		pop	es
 13750 000059D7 893E[2803]              		mov	word [EXTERRPT], di
 13751 000059DB B80F00                  		mov	ax, 0Fh
 13752 000059DE C606[7505]01            		mov	byte [READOP], 1
 13753 000059E3 E810FB                  		call	HARDERR
 13754 000059E6 5F                      		pop	di
 13755 000059E7 1F                      		pop	ds
 13756 000059E8 3C03                    		cmp	al, 3
 13757                                  
 13758                                  FAIL_OPJ2:				; ...
 13759 000059EA 741D                    		jz	short FAIL_OP
 13760 000059EC E96EFF                  		jmp	FAT_GOT_DPB
 13761                                  ; ---------------------------------------------------------------------------
 13762                                  
 13763                                  CHKBUFFDIRT:				; ...
 13764 000059EF 36833E[7100]00          		cmp	word [ss:DirtyBufferCount], 0
 13765 000059F5 741F                    		jz	short NEWDSK
 13766 000059F7 E8F800                  		call	GETCURHEAD
 13767                                  
 13768                                  nbuffer:				; ...
 13769 000059FA 384504                  		cmp	[di+4],	al	; [di+BUFFINFO.buf_ID]
 13770 000059FD 750E                    		jnz	short lfnxt
 13771 000059FF F6450540                		test	byte [di+5], 40h ; [di+BUFFINFO.buf_flags]
 13772 00005A03 7408                    		jz	short lfnxt
 13773 00005A05 16                      		push	ss
 13774 00005A06 1F                      		pop	ds
 13775 00005A07 F8                      		clc
 13776 00005A08 C3                      		retn
 13777                                  ; ---------------------------------------------------------------------------
 13778                                  
 13779                                  FAIL_OP:				; ...
 13780 00005A09 16                      		push	ss
 13781 00005A0A 1F                      		pop	ds
 13782 00005A0B F9                      		stc
 13783 00005A0C C3                      		retn
 13784                                  ; ---------------------------------------------------------------------------
 13785                                  
 13786                                  lfnxt:					; ...
 13787 00005A0D 8B3D                    		mov	di, [di]
 13788 00005A0F 36393E[BB0E]            		cmp	[ss:FIRST_BUFF_ADDR], di
 13789 00005A14 75E4                    		jnz	short nbuffer
 13790                                  
 13791                                  NEWDSK:					; ...
 13792 00005A16 26C7461FFFFF            		mov	word [es:bp+1Fh], 0FFFFh ; -1
 13793 00005A1C E8D300                  		call	GETCURHEAD
 13794                                  
 13795                                  nxbuffer:				; ...
 13796 00005A1F 384504                  		cmp	[di+4],	al
 13797 00005A22 7510                    		jnz	short lfnxt2
 13798 00005A24 F6450540                		test	byte [di+5], 40h ; buf_dirty
 13799 00005A28 758B                    		jnz	short DISK_CHNG_ERR
 13800 00005A2A C74504FF20              		mov	word [di+4], 20FFh
 13801 00005A2F E8D200                  		call	SCANPLACE
 13802 00005A32 EB02                    		jmp	short skpbuff
 13803                                  ; ---------------------------------------------------------------------------
 13804                                  
 13805                                  lfnxt2:					; ...
 13806 00005A34 8B3D                    		mov	di, [di]
 13807                                  
 13808                                  skpbuff:				; ...
 13809 00005A36 363B3E[BB0E]            		cmp	di, [ss:FIRST_BUFF_ADDR]
 13810 00005A3B 75E2                    		jnz	short nxbuffer
 13811 00005A3D 36833E[7700]00          		cmp	word [ss:SC_CACHE_COUNT], 0
 13812 00005A43 740D                    		jz	short GOGETBPB
 13813 00005A45 363A06[B00D]            		cmp	al, [ss:CurSC_DRIVE]
 13814 00005A4A 7506                    		jnz	short GOGETBPB
 13815 00005A4C 36C606[B00D]FF          		mov	byte [ss:CurSC_DRIVE], 0FFh ; -1
 13816                                  
 13817                                  GOGETBPB:				; ...
 13818 00005A52 26C57E13                		lds	di, [es:bp+13h]
 13819 00005A56 F6450520                		test	byte [di+5], 20h
 13820 00005A5A 7510                    		jnz	short GETFREEBUF
 13821 00005A5C 16                      		push	ss
 13822 00005A5D 1F                      		pop	ds
 13823 00005A5E BB0200                  		mov	bx, 2
 13824 00005A61 E8CDFC                  		call	UNPACK
 13825                                  
 13826                                  FAIL_OPJ:				; ...
 13827 00005A64 72A3                    		jb	short FAIL_OP
 13828 00005A66 C53E[E205]              		lds	di, [CURBUF]
 13829 00005A6A EB13                    		jmp	short GOTGETBUF
 13830                                  ; ---------------------------------------------------------------------------
 13831                                  
 13832                                  GETFREEBUF:				; ...
 13833 00005A6C 06                      		push	es
 13834 00005A6D 55                      		push	bp
 13835 00005A6E 31D2                    		xor	dx, dx
 13836 00005A70 368916[0706]            		mov	word [ss:HIGH_SECTOR],	dx
 13837 00005A75 E87A00                  		call	GETCURHEAD
 13838 00005A78 E84502                  		call	BUFWRITE
 13839 00005A7B 5D                      		pop	bp
 13840 00005A7C 07                      		pop	es
 13841 00005A7D 72E5                    		jb	short FAIL_OPJ
 13842                                  
 13843                                  GOTGETBUF:				; ...
 13844 00005A7F 83C714                  		add	di, 20		; BUFINSIZ
 13845 00005A82 368C1E[6A03]            		mov	word [ss:CALLBR+2], ds ; [SS:CALLXAD+2]
 13846 00005A87 16                      		push	ss
 13847 00005A88 1F                      		pop	ds
 13848 00005A89 893E[6803]              		mov	word [CALLBR], di ; [CALLXAD]
 13849 00005A8D B016                    		mov	al, 16h
 13850 00005A8F 268A6601                		mov	ah, [es:bp+1]	; ES:BP+DPB.UNIT]
 13851 00005A93 A3[5A03]                		mov	word [DEVCALL], ax ; [DEVCALL_REQLEN]
 13852 00005A96 C606[5C03]02            		mov	byte [DEVCALL_REQFUNC], 2
 13853 00005A9B C706[5D03]0000          		mov	word [DEVCALL_REQSTAT], 0
 13854 00005AA1 268A4617                		mov	al, [es:bp+17h]	; [ES:BP+DPB.MEDIA]
 13855 00005AA5 A2[6703]                		mov	[CALLUNIT], al	; [CALLMED]
 13856 00005AA8 06                      		push	es
 13857 00005AA9 1E                      		push	ds
 13858 00005AAA 26FF7615                		push	word [es:bp+15h]
 13859 00005AAE 26FF7613                		push	word [es:bp+13h] ; [ES:BP+DPB.DRIVER_ADDR]
 13860 00005AB2 BB[5A03]                		mov	bx, DEVCALL
 13861 00005AB5 5E                      		pop	si
 13862 00005AB6 1F                      		pop	ds
 13863 00005AB7 07                      		pop	es
 13864 00005AB8 E852ED                  		call	DEVIOCALL2
 13865 00005ABB 07                      		pop	es
 13866 00005ABC 16                      		push	ss
 13867 00005ABD 1F                      		pop	ds
 13868 00005ABE 8B3E[5D03]              		mov	di, [DEVCALL_REQSTAT]
 13869 00005AC2 09FF                    		or	di, di
 13870 00005AC4 7829                    		js	short FATERRJ
 13871 00005AC6 268A4617                		mov	al, [es:bp+17h]
 13872 00005ACA C536[6C03]              		lds	si, [CALLBPB]
 13873 00005ACE 26C7461D0000            		mov	word [es:bp+1Dh], 0	; [ES:BP+DPB.NEXT_FREE]
 13874 00005AD4 E81FB5                  		call	$SETDPB
 13875 00005AD7 36C53E[6803]            		lds	di, [ss:CALLBR]	; [SS:CALLXAD]
 13876 00005ADC 268A4608                		mov	al, [es:bp+8]	; [ES:BP+DPB.FAT_COUNT]
 13877 00005AE0 8845F6                  		mov	[di-0Ah], al	; [DI+BUFFINFO.buf_wrtcnt-BUFINSIZ]
 13878 00005AE3 268B460F                		mov	ax, [es:bp+0Fh]	; [ES:BP+DPB.FAT_SIZE]
 13879 00005AE7 8945F7                  		mov	[di-9],	ax	; [DI+BUFFINFO.buf_wrtcntinc-BUFINSIZ]
 13880 00005AEA 16                      		push	ss
 13881 00005AEB 1F                      		pop	ds
 13882 00005AEC 30C0                    		xor	al, al
 13883 00005AEE C3                      		retn
 13884                                  ; ---------------------------------------------------------------------------
 13885                                  
 13886                                  FATERRJ:				; ...
 13887 00005AEF E94AFE                  		jmp	FATERR
 13888                                  
 13889                                  ; =============== S U B	R O U T	I N E =======================================
 13890                                  
 13891                                  
 13892                                  GETCURHEAD:
 13893 00005AF2 36C53E[6D00]            		lds	di, [ss:BufferQueue]
 13894 00005AF7 36C706[1E00]FFFF        		mov	word [ss:LastBuffer], 0FFFFh ; -1
 13895 00005AFE 36893E[BB0E]            		mov	[ss:FIRST_BUFF_ADDR], di
 13896 00005B03 C3                      		retn
 13897                                  
 13898                                  ; =============== S U B	R O U T	I N E =======================================
 13899                                  
 13900                                  
 13901                                  SCANPLACE:
 13902 00005B04 FF35                    		push	word [di]
 13903 00005B06 E80200                  		call	PLACEBUF
 13904 00005B09 5F                      		pop	di
 13905 00005B0A C3                      		retn
 13906                                  
 13907                                  ; =============== S U B	R O U T	I N E =======================================
 13908                                  
 13909                                  
 13910                                  PLACEBUF:
 13911 00005B0B 50                      		push	ax
 13912 00005B0C 53                      		push	bx
 13913 00005B0D 56                      		push	si
 13914 00005B0E 8B05                    		mov	ax, [di]
 13915 00005B10 368B1E[6D00]            		mov	bx, word [ss:BufferQueue]
 13916 00005B15 39D8                    		cmp	ax, bx
 13917 00005B17 7420                    		jz	short nret
 13918 00005B19 39DF                    		cmp	di, bx
 13919 00005B1B 7506                    		jnz	short not_first
 13920 00005B1D 36A3[6D00]              		mov	word [ss:BufferQueue], ax
 13921 00005B21 EB16                    		jmp	short nret
 13922                                  ; ---------------------------------------------------------------------------
 13923                                  
 13924                                  not_first:				; ...
 13925 00005B23 8B7502                  		mov	si, [di+2]
 13926 00005B26 8904                    		mov	[si], ax
 13927 00005B28 96                      		xchg	ax, si
 13928 00005B29 894402                  		mov	[si+2],	ax
 13929 00005B2C 8B7702                  		mov	si, [bx+2]
 13930 00005B2F 893C                    		mov	[si], di
 13931 00005B31 897F02                  		mov	[bx+2],	di
 13932 00005B34 897502                  		mov	[di+2],	si
 13933 00005B37 891D                    		mov	[di], bx
 13934                                  
 13935                                  nret:					; ...
 13936 00005B39 5E                      		pop	si
 13937 00005B3A 5B                      		pop	bx
 13938 00005B3B 58                      		pop	ax
 13939 00005B3C 807D04FF                		cmp	byte [di+4], 0FFh
 13940 00005B40 7505                    		jnz	short pbx
 13941 00005B42 36893E[6D00]            		mov	word [ss:BufferQueue], di
 13942                                  
 13943                                  pbx:					; ...
 13944 00005B47 C3                      		retn
 13945                                  
 13946                                  ; ---------------------------------------------------------------------------
 13947                                  
 13948                                  POINTCOMP:				; ...
 13949 00005B48 39FE                    		cmp	si, di
 13950 00005B4A 750A                    		jnz	short _ret_label
 13951 00005B4C 51                      		push	cx
 13952 00005B4D 52                      		push	dx
 13953 00005B4E 8CD9                    		mov	cx, ds
 13954 00005B50 8CC2                    		mov	dx, es
 13955 00005B52 39D1                    		cmp	cx, dx
 13956 00005B54 5A                      		pop	dx
 13957 00005B55 59                      		pop	cx
 13958                                  
 13959                                  _ret_label:				; ...
 13960 00005B56 C3                      		retn
 13961                                  
 13962                                  ; =============== S U B	R O U T	I N E =======================================
 13963                                  
 13964                                  
 13965                                  GETBUFFR:
 13966 00005B57 31F6                    		xor	si, si
 13967                                  
 13968                                  ; =============== S U B	R O U T	I N E =======================================
 13969                                  
 13970                                  
 13971                                  GETBUFFRB:
 13972 00005B59 A3[9405]                		mov	[PREREAD], ax
 13973 00005B5C 268A4600                		mov	al, [es:bp+0]	; [ES:BP+DPB.DRIVE]
 13974 00005B60 C53E[1E00]              		lds	di, [LastBuffer]
 13975 00005B64 368B0E[0706]            		mov	cx, [ss:HIGH_SECTOR]
 13976 00005B69 83FFFF                  		cmp	di, 0FFFFh	; -1
 13977 00005B6C 7412                    		jz	short getb5
 13978 00005B6E 3B5506                  		cmp	dx, [di+6]	; [DI+BUFFINFO.buf_sector]
 13979 00005B71 750D                    		jnz	short getb5
 13980 00005B73 3B4D08                  		cmp	cx, [di+8]	; [DI+BUFFINFO.buf_sector+2]
 13981 00005B76 7508                    		jnz	short getb5
 13982 00005B78 3A4504                  		cmp	al, [di+4]	; [DI+BUFFINFO.buf_ID]
 13983 00005B7B 7503                    		jnz	short getb5
 13984 00005B7D E9BD00                  		jmp	getb35
 13985                                  ; ---------------------------------------------------------------------------
 13986                                  
 13987                                  getb5:					; ...
 13988 00005B80 E86FFF                  		call	GETCURHEAD
 13989                                  
 13990                                  getb10:					; ...
 13991 00005B83 3B5506                  		cmp	dx, [di+6]
 13992 00005B86 750D                    		jnz	short getb12
 13993 00005B88 3B4D08                  		cmp	cx, [di+8]
 13994 00005B8B 7508                    		jnz	short getb12
 13995 00005B8D 3A4504                  		cmp	al, [di+4]
 13996 00005B90 7503                    		jnz	short getb12
 13997 00005B92 E98D00                  		jmp	getb25
 13998                                  ; ---------------------------------------------------------------------------
 13999                                  
 14000                                  getb12:					; ...
 14001 00005B95 8B3D                    		mov	di, [di]
 14002 00005B97 363B3E[BB0E]            		cmp	di, [ss:FIRST_BUFF_ADDR]
 14003 00005B9C 75E5                    		jnz	short getb10
 14004 00005B9E 51                      		push	cx
 14005 00005B9F 56                      		push	si
 14006 00005BA0 52                      		push	dx
 14007 00005BA1 55                      		push	bp
 14008 00005BA2 06                      		push	es
 14009 00005BA3 E81A01                  		call	BUFWRITE
 14010 00005BA6 07                      		pop	es
 14011 00005BA7 5D                      		pop	bp
 14012 00005BA8 5A                      		pop	dx
 14013 00005BA9 5E                      		pop	si
 14014 00005BAA 368F06[0706]            		pop	word [ss:HIGH_SECTOR]
 14015 00005BAF 7303                    		jnb	short getb13
 14016 00005BB1 E99E00                  		jmp	getbx
 14017                                  ; ---------------------------------------------------------------------------
 14018                                  
 14019                                  getb13:					; ...
 14020 00005BB4 E89701                  		call	SET_RQ_SC_PARMS
 14021 00005BB7 30E4                    		xor	ah, ah
 14022 00005BB9 363826[9405]            		cmp	byte [ss:PREREAD], ah
 14023 00005BBE 754A                    		jnz	short getb20
 14024 00005BC0 8D5D14                  		lea	bx, [di+20]	; [DI+BUFINSIZ]
 14025 00005BC3 B90100                  		mov	cx, 1
 14026 00005BC6 56                      		push	si
 14027 00005BC7 57                      		push	di
 14028 00005BC8 52                      		push	dx
 14029 00005BC9 06                      		push	es
 14030 00005BCA 36803E[7900]00          		cmp	byte [ss:BuffInHMA], 0
 14031 00005BD0 7407                    		jz	short getb14
 14032 00005BD2 1E                      		push	ds
 14033 00005BD3 53                      		push	bx
 14034 00005BD4 36C51E[7A00]            		lds	bx, [ss:LoMemBuff]
 14035                                  
 14036                                  getb14:					; ...
 14037 00005BD9 09F6                    		or	si, si
 14038 00005BDB 7407                    		jz	short getb15
 14039 00005BDD E85BDC                  		call	FATSECRD
 14040 00005BE0 B402                    		mov	ah, 2
 14041 00005BE2 EB05                    		jmp	short getb17
 14042                                  ; ---------------------------------------------------------------------------
 14043                                  
 14044                                  getb15:					; ...
 14045 00005BE4 E880DC                  		call	DREAD
 14046 00005BE7 B400                    		mov	ah, 0
 14047                                  
 14048                                  getb17:					; ...
 14049 00005BE9 9C                      		pushf
 14050 00005BEA 36803E[7900]00          		cmp	byte [ss:BuffInHMA], 0
 14051 00005BF0 7411                    		jz	short not_in_hma
 14052 00005BF2 268B4E02                		mov	cx, [es:bp+2]
 14053 00005BF6 D1E9                    		shr	cx, 1
 14054 00005BF8 9D                      		popf
 14055 00005BF9 89DE                    		mov	si, bx
 14056 00005BFB 5F                      		pop	di
 14057 00005BFC 07                      		pop	es
 14058 00005BFD FC                      		cld
 14059 00005BFE 9C                      		pushf
 14060 00005BFF F3A5                    		rep movsw
 14061 00005C01 06                      		push	es
 14062 00005C02 1F                      		pop	ds
 14063                                  
 14064                                  not_in_hma:				; ...
 14065 00005C03 9D                      		popf
 14066 00005C04 07                      		pop	es
 14067 00005C05 5A                      		pop	dx
 14068 00005C06 5F                      		pop	di
 14069 00005C07 5E                      		pop	si
 14070 00005C08 7248                    		jb	short getbx
 14071                                  
 14072                                  getb20:					; ...
 14073 00005C0A 368B0E[0706]            		mov	cx, [ss:HIGH_SECTOR]
 14074 00005C0F 894D08                  		mov	[di+8],	cx	; [DI+BUFFINFO.buf_sector+2]
 14075 00005C12 895506                  		mov	[di+6],	dx	; [DI+BUFFINFO.buf_sector]
 14076 00005C15 896D0D                  		mov	[di+0Dh], bp	; [DI+BUFFINFO.buf_DPB]
 14077 00005C18 8C450F                  		mov	word [di+0Fh], es ;	[DI+BUFFINFO.buf_DPB+2]
 14078 00005C1B 268A4600                		mov	al, [es:bp+0]	; [ES:BP+DPB.DRIVE]
 14079 00005C1F 894504                  		mov	[di+4],	ax	; [DI+BUFFINFO.buf_ID]
 14080                                  
 14081                                  getb25:					; ...
 14082 00005C22 C6450A01                		mov	byte [di+0Ah], 1 ; [DI+BUFFINFO.buf_wrtcnt]
 14083 00005C26 31C0                    		xor	ax, ax
 14084 00005C28 09F6                    		or	si, si
 14085 00005C2A 740B                    		jz	short getb30
 14086 00005C2C 268A4608                		mov	al, [es:bp+8]	; [ES:BP+DPB.FAT_COUNT]
 14087 00005C30 88450A                  		mov	[di+0Ah], al	; [DI+BUFFINFO.buf_wrtcnt]
 14088 00005C33 268B460F                		mov	ax, [es:bp+0Fh]	; [ES:BP+DPB.FAT_SIZE]
 14089                                  
 14090                                  getb30:					; ...
 14091 00005C37 89450B                  		mov	[di+0Bh], ax	; [DI+BUFFINFO.buf_wrtcntinc]
 14092 00005C3A E8CEFE                  		call	PLACEBUF
 14093                                  
 14094                                  getb35:					; ...
 14095 00005C3D 368C1E[E405]            		mov	word [ss:CURBUF+2], ds
 14096 00005C42 368C1E[2000]            		mov	word [ss:LastBuffer+2], ds
 14097 00005C47 36893E[E205]            		mov	word [ss:CURBUF], di
 14098 00005C4C 36893E[1E00]            		mov	word [ss:LastBuffer], di
 14099 00005C51 F8                      		clc
 14100                                  
 14101                                  getbx:					; ...
 14102 00005C52 16                      		push	ss
 14103 00005C53 1F                      		pop	ds
 14104                                  
 14105                                  getbuffrb_retn:				; ...
 14106 00005C54 C3                      		retn
 14107                                  
 14108                                  ; =============== S U B	R O U T	I N E =======================================
 14109                                  
 14110                                  
 14111                                  FLUSHBUF:
 14112 00005C55 E89AFE                  		call	GETCURHEAD
 14113 00005C58 36F606[1106]04          		test	byte [ss:DOS34_FLAG], 4
 14114 00005C5E 7508                    		jnz	short scan_buf_queue
 14115 00005C60 36833E[7100]00          		cmp	word [ss:DirtyBufferCount], 0
 14116 00005C66 7423                    		jz	short end_scan
 14117                                  
 14118                                  scan_buf_queue:				; ...
 14119 00005C68 E82C00                  		call	CHECKFLUSH
 14120 00005C6B 8A6504                  		mov	ah, [di+4]
 14121 00005C6E 363826[2203]            		cmp	byte [ss:WPERR], ah
 14122 00005C73 7408                    		jz	short free_the_buf
 14123 00005C75 36F606[1106]04          		test	byte [ss:DOS34_FLAG], 4
 14124 00005C7B 7405                    		jz	short dont_free_the_buf
 14125                                  
 14126                                  free_the_buf:				; ...
 14127 00005C7D C74504FF00              		mov	word [di+4], 0FFh ; [DI+BUFFINFO.buf_ID]
 14128                                  
 14129                                  dont_free_the_buf:			; ...
 14130 00005C82 8B3D                    		mov	di, [di]	; [DI+BUFFINFO.buf_link]
 14131 00005C84 363B3E[BB0E]            		cmp	di, [ss:FIRST_BUFF_ADDR]
 14132 00005C89 75DD                    		jnz	short scan_buf_queue
 14133                                  
 14134                                  end_scan:				; ...
 14135 00005C8B 16                      		push	ss
 14136 00005C8C 1F                      		pop	ds
 14137 00005C8D 803E[4A03]00            		cmp	byte [FAILERR], 0
 14138 00005C92 7501                    		jnz	short bad_flush
 14139 00005C94 C3                      		retn
 14140                                  ; ---------------------------------------------------------------------------
 14141                                  
 14142                                  bad_flush:				; ...
 14143 00005C95 F9                      		stc
 14144 00005C96 C3                      		retn
 14145                                  
 14146                                  ; =============== S U B	R O U T	I N E =======================================
 14147                                  
 14148                                  
 14149                                  CHECKFLUSH:
 14150 00005C97 B4FF                    		mov	ah, 0FFh
 14151 00005C99 386504                  		cmp	[di+4],	ah
 14152 00005C9C 74B6                    		jz	short getbuffrb_retn
 14153 00005C9E 38C4                    		cmp	ah, al
 14154 00005CA0 7406                    		jz	short DOBUFFER
 14155 00005CA2 3A4504                  		cmp	al, [di+4]
 14156 00005CA5 F8                      		clc
 14157 00005CA6 75AC                    		jnz	short getbuffrb_retn
 14158                                  
 14159                                  DOBUFFER:				; ...
 14160 00005CA8 F6450540                		test	byte [di+5], 40h ; buf_dirty
 14161 00005CAC 74A6                    		jz	short getbuffrb_retn
 14162 00005CAE 50                      		push	ax
 14163 00005CAF FF7504                  		push	word [di+4]
 14164 00005CB2 E80B00                  		call	BUFWRITE
 14165 00005CB5 58                      		pop	ax
 14166 00005CB6 7206                    		jb	short LEAVE_BUF
 14167 00005CB8 80E4BF                  		and	ah, 0BFh	; not 40h
 14168 00005CBB 894504                  		mov	[di+4],	ax
 14169                                  
 14170                                  LEAVE_BUF:				; ...
 14171 00005CBE 58                      		pop	ax
 14172                                  
 14173                                  checkflush_retn:			; ...
 14174 00005CBF C3                      		retn
 14175                                  
 14176                                  ; =============== S U B	R O U T	I N E =======================================
 14177                                  
 14178                                  
 14179                                  BUFWRITE:
 14180 00005CC0 B8FF00                  		mov	ax, 0FFh
 14181 00005CC3 874504                  		xchg	ax, [di+4]	; [DI+BUFFINFO.buf_ID]
 14182 00005CC6 3CFF                    		cmp	al, 0FFh
 14183 00005CC8 74F5                    		jz	short checkflush_retn
 14184 00005CCA F6C440                  		test	ah, 40h
 14185 00005CCD 74F0                    		jz	short checkflush_retn
 14186 00005CCF E89500                  		call	DEC_DIRTY_COUNT
 14187 00005CD2 363A06[2203]            		cmp	al, [ss:WPERR]
 14188 00005CD7 74E6                    		jz	short checkflush_retn
 14189 00005CD9 36A2[AF0D]              		mov	[ss:SC_DRIVE], al
 14190 00005CDD C46D0D                  		les	bp, [di+0Dh]	; [DI+BUFFINFO.buf_DPB]
 14191 00005CE0 8D5D14                  		lea	bx, [di+14h]	; [DI+BUFINSIZ]
 14192 00005CE3 8B5506                  		mov	dx, [di+6]	; [DI+BUFFINFO.buf_sector]
 14193 00005CE6 8B4D08                  		mov	cx, [di+8]
 14194 00005CE9 36890E[0706]            		mov	word [ss:HIGH_SECTOR], cx
 14195 00005CEE 8A4D0A                  		mov	cl, [di+0Ah]	; [DI+BUFFINFO.buf_wrtcnt]
 14196 00005CF1 30ED                    		xor	ch, ch
 14197 00005CF3 36C606[4B03]18          		mov	byte [ss:ALLOWED], 18h ; Allowed_RETRY+Allowed_FAIL
 14198 00005CF9 F6C408                  		test	ah, 8
 14199 00005CFC 7406                    		jz	short NO_IGNORE
 14200 00005CFE 36800E[4B03]20          		or	byte [ss:ALLOWED], 20h ; Allowed_IGNORE
 14201                                  
 14202                                  NO_IGNORE:				; ...
 14203 00005D04 8B450B                  		mov	ax, [di+11]	; [DI+BUFFINFO.buf_wrtcntinc]
 14204 00005D07 57                      		push	di
 14205 00005D08 31FF                    		xor	di, di
 14206 00005D0A 1E                      		push	ds
 14207 00005D0B 53                      		push	bx
 14208                                  
 14209                                  WRTAGAIN:				; ...
 14210 00005D0C 57                      		push	di
 14211 00005D0D 51                      		push	cx
 14212 00005D0E 50                      		push	ax
 14213 00005D0F B90100                  		mov	cx, 1
 14214 00005D12 53                      		push	bx
 14215 00005D13 52                      		push	dx
 14216 00005D14 1E                      		push	ds
 14217 00005D15 36803E[7900]00          		cmp	byte [ss:BuffInHMA], 0
 14218 00005D1B 7418                    		jz	short NBUFFINHMA
 14219 00005D1D 51                      		push	cx
 14220 00005D1E 06                      		push	es
 14221 00005D1F 89DE                    		mov	si, bx
 14222 00005D21 268B4E02                		mov	cx, [es:bp+2]	; [es:bp+DPB.SECTOR_SIZE]
 14223 00005D25 D1E9                    		shr	cx, 1
 14224 00005D27 36C43E[7A00]            		les	di, [ss:LoMemBuff]
 14225 00005D2C 89FB                    		mov	bx, di
 14226 00005D2E FC                      		cld
 14227 00005D2F F3A5                    		rep movsw
 14228 00005D31 06                      		push	es
 14229 00005D32 1F                      		pop	ds
 14230 00005D33 07                      		pop	es
 14231 00005D34 59                      		pop	cx
 14232                                  
 14233                                  NBUFFINHMA:				; ...
 14234 00005D35 E891DB                  		call	DWRITE
 14235 00005D38 1F                      		pop	ds
 14236 00005D39 5A                      		pop	dx
 14237 00005D3A 5B                      		pop	bx
 14238 00005D3B 58                      		pop	ax
 14239 00005D3C 59                      		pop	cx
 14240 00005D3D 5F                      		pop	di
 14241 00005D3E 7201                    		jb	short NOSET
 14242 00005D40 47                      		inc	di
 14243                                  
 14244                                  NOSET:					; ...
 14245 00005D41 01C2                    		add	dx, ax
 14246 00005D43 E2C7                    		loop	WRTAGAIN
 14247 00005D45 5B                      		pop	bx
 14248 00005D46 1F                      		pop	ds
 14249 00005D47 09FF                    		or	di, di
 14250 00005D49 7501                    		jnz	short BWROK
 14251 00005D4B F9                      		stc
 14252                                  
 14253                                  BWROK:					; ...
 14254 00005D4C 5F                      		pop	di
 14255 00005D4D C3                      		retn
 14256                                  
 14257                                  ; =============== S U B	R O U T	I N E =======================================
 14258                                  
 14259                                  
 14260                                  SET_RQ_SC_PARMS:
 14261 00005D4E 50                      		push	ax
 14262 00005D4F 268B4602                		mov	ax, [es:bp+2]
 14263 00005D53 36A3[AD0D]              		mov	word [ss:SC_SECTOR_SIZE], ax
 14264 00005D57 268A4600                		mov	al, [es:bp+0]
 14265 00005D5B 36A2[AF0D]              		mov	[ss:SC_DRIVE], al
 14266 00005D5F 58                      		pop	ax
 14267 00005D60 C3                      		retn
 14268                                  
 14269                                  ; =============== S U B	R O U T	I N E =======================================
 14270                                  
 14271                                  
 14272                                  INC_DIRTY_COUNT:
 14273 00005D61 36FF06[7100]            		inc	word [ss:DirtyBufferCount]
 14274 00005D66 C3                      		retn
 14275                                  
 14276                                  ; =============== S U B	R O U T	I N E =======================================
 14277                                  
 14278                                  
 14279                                  DEC_DIRTY_COUNT:
 14280 00005D67 36833E[7100]00          		cmp	word [ss:DirtyBufferCount], 0
 14281 00005D6D 7405                    		jz	short ddcx
 14282 00005D6F 36FF0E[7100]            		dec	word [ss:DirtyBufferCount]
 14283                                  
 14284                                  ddcx:					; ...
 14285 00005D74 C3                      		retn
 14286                                  
 14287                                  ; ---------------------------------------------------------------------------
 14288                                  
 14289                                  $WAIT:					; ...
 14290 00005D75 31C0                    		xor	ax, ax
 14291 00005D77 368706[3403]            		xchg	ax, [ss:exit_code]
 14292 00005D7C E992A8                  		jmp	SYS_RET_OK
 14293                                  
 14294                                  ; =============== S U B	R O U T	I N E =======================================
 14295                                  
 14296                                  
 14297                                  $EXEC:
 14298 00005D7F 36C606[8500]00          		mov	byte [ss:A20OFF_COUNT], 0
 14299 00005D85 3C05                    		cmp	al, 5
 14300 00005D87 7505                    		jnz	short Exec_@f
 14301 00005D89 59                      		pop	cx
 14302 00005D8A B9[2404]                		mov	cx, LeaveDOS
 14303 00005D8D 51                      		push	cx
 14304                                  
 14305                                  Exec_@f:				; ...
 14306 00005D8E 55                      		push	bp
 14307 00005D8F 89E5                    		mov	bp, sp
 14308 00005D91 83EC1D                  		sub	sp, 29		; sub sp, 30  ;	Retro DOS v4
 14309 00005D94 3C05                    		cmp	al, 5
 14310 00005D96 7614                    		jbe	short Exec_Check_2
 14311                                  
 14312                                  Exec_Bad_Fun:				; ...
 14313 00005D98 36C606[2303]01          		mov	byte [ss:EXTERR_LOCUS], 1
 14314 00005D9E B001                    		mov	al, 1
 14315                                  
 14316                                  Exec_Ret_Err:				; ...
 14317 00005DA0 89EC                    		mov	sp, bp
 14318 00005DA2 5D                      		pop	bp
 14319 00005DA3 E974A8                  		jmp	SYS_RET_ERR
 14320                                  ; ---------------------------------------------------------------------------
 14321                                  
 14322                                  ExecReadyJ:				; ...
 14323 00005DA6 E85418                  		call	ExecReady
 14324 00005DA9 E91404                  		jmp	norm_ovl
 14325                                  ; ---------------------------------------------------------------------------
 14326                                  
 14327                                  Exec_Check_2:				; ...
 14328 00005DAC 3C02                    		cmp	al, 2
 14329 00005DAE 74E8                    		jz	short Exec_Bad_Fun
 14330 00005DB0 3C04                    		cmp	al, 4
 14331 00005DB2 74E4                    		jz	short Exec_Bad_Fun
 14332 00005DB4 3C05                    		cmp	al, 5
 14333 00005DB6 74EE                    		jz	short ExecReadyJ
 14334 00005DB8 895EFC                  		mov	[bp-4],	bx
 14335 00005DBB 8C46FE                  		mov	word [bp-2], es
 14336 00005DBE 8846FB                  		mov	[bp-5],	al
 14337 00005DC1 C646FA00                		mov	byte [bp-6], 0
 14338 00005DC5 8956E6                  		mov	[bp-26], dx
 14339 00005DC8 8C5EE8                  		mov	word [bp-24], ds
 14340 00005DCB 89D6                    		mov	si, dx
 14341 00005DCD E86FB4                  		call	DStrLen
 14342 00005DD0 894EEA                  		mov	[bp-22], cx
 14343 00005DD3 36A0[0203]              		mov	al, [ss:AllocMethod]
 14344 00005DD7 36A2[8400]              		mov	[ss:ALLOCMSAVE], al
 14345 00005DDB 30C0                    		xor	al, al
 14346 00005DDD 55                      		push	bp
 14347 00005DDE 36800E[8600]01          		or	byte [ss:DOS_FLAG], 1
 14348 00005DE4 E84913                  		call	$OPEN
 14349 00005DE7 9C                      		pushf
 14350 00005DE8 368026[8600]FE          		and	byte [ss:DOS_FLAG], 0FEh ; not 1
 14351 00005DEE 9D                      		popf
 14352 00005DEF 5D                      		pop	bp
 14353 00005DF0 72AE                    		jb	short Exec_Ret_Err
 14354 00005DF2 8946F8                  		mov	[bp-8],	ax
 14355 00005DF5 89C3                    		mov	bx, ax
 14356 00005DF7 30C0                    		xor	al, al
 14357 00005DF9 E866C5                  		call	$IOCTL
 14358 00005DFC 7207                    		jb	short Exec_BombJ
 14359 00005DFE F6C280                  		test	dl, 80h
 14360 00005E01 740A                    		jz	short Exec_Check_Environ
 14361 00005E03 B002                    		mov	al, 2
 14362                                  
 14363                                  Exec_BombJ:				; ...
 14364 00005E05 E9CC00                  		jmp	Exec_Bomb
 14365                                  ; ---------------------------------------------------------------------------
 14366                                  
 14367                                  BadEnv:					; ...
 14368 00005E08 B00A                    		mov	al, 0Ah
 14369 00005E0A E9C700                  		jmp	Exec_Bomb
 14370                                  ; ---------------------------------------------------------------------------
 14371                                  
 14372                                  Exec_Check_Environ:			; ...
 14373 00005E0D C746EE0000              		mov	word [bp-18], 0
 14374 00005E12 C746F20000              		mov	word [bp-14], 0
 14375 00005E17 F646FB02                		test	byte [bp-5], 2
 14376 00005E1B 7554                    		jnz	short Exec_Read_Header
 14377 00005E1D C576FC                  		lds	si, [bp-4]
 14378 00005E20 8B04                    		mov	ax, [si]
 14379 00005E22 09C0                    		or	ax, ax
 14380 00005E24 750C                    		jnz	short Exec_Scan_Env
 14381 00005E26 368E1E[3003]            		mov	ds, [ss:CurrentPDB]
 14382 00005E2B A12C00                  		mov	ax, [2Ch]
 14383 00005E2E 09C0                    		or	ax, ax
 14384 00005E30 743F                    		jz	short Exec_Read_Header
 14385                                  
 14386                                  Exec_Scan_Env:				; ...
 14387 00005E32 8EC0                    		mov	es, ax
 14388 00005E34 31FF                    		xor	di, di
 14389 00005E36 B90080                  		mov	cx, 8000h
 14390 00005E39 30C0                    		xor	al, al
 14391                                  
 14392                                  Exec_Get_Environ_Len:			; ...
 14393 00005E3B F2AE                    		repne scasb
 14394 00005E3D 75C9                    		jnz	short BadEnv
 14395 00005E3F 49                      		dec	cx
 14396 00005E40 78C6                    		js	short BadEnv
 14397 00005E42 AE                      		scasb
 14398 00005E43 75F6                    		jnz	short Exec_Get_Environ_Len
 14399 00005E45 57                      		push	di
 14400 00005E46 8D5D11                  		lea	bx, [di+11h]
 14401 00005E49 035EEA                  		add	bx, [bp-22]
 14402 00005E4C B104                    		mov	cl, 4
 14403 00005E4E D3EB                    		shr	bx, cl
 14404 00005E50 06                      		push	es
 14405 00005E51 E85A06                  		call	$ALLOC
 14406 00005E54 1F                      		pop	ds
 14407 00005E55 59                      		pop	cx
 14408 00005E56 7302                    		jnb	short Exec_Save_Environ
 14409 00005E58 EB74                    		jmp	short Exec_No_Mem
 14410                                  ; ---------------------------------------------------------------------------
 14411                                  
 14412                                  Exec_Save_Environ:			; ...
 14413 00005E5A 8EC0                    		mov	es, ax
 14414 00005E5C 8946F2                  		mov	[bp-14], ax
 14415 00005E5F 31F6                    		xor	si, si
 14416 00005E61 89F7                    		mov	di, si
 14417 00005E63 F3A4                    		rep movsb
 14418 00005E65 B80100                  		mov	ax, 1
 14419 00005E68 AB                      		stosw
 14420 00005E69 C576E6                  		lds	si, [bp-26]
 14421 00005E6C 8B4EEA                  		mov	cx, [bp-22]
 14422 00005E6F F3A4                    		rep movsb
 14423                                  
 14424                                  Exec_Read_Header:			; ...
 14425 00005E71 16                      		push	ss
 14426 00005E72 1F                      		pop	ds
 14427 00005E73 B91A00                  		mov	cx, 26
 14428 00005E76 BA[C80F]                		mov	dx, exec_signature
 14429 00005E79 06                      		push	es
 14430 00005E7A 1E                      		push	ds
 14431 00005E7B E89104                  		call	ExecRead
 14432 00005E7E 1F                      		pop	ds
 14433 00005E7F 07                      		pop	es
 14434 00005E80 7250                    		jb	short Exec_Bad_File
 14435 00005E82 09C0                    		or	ax, ax
 14436 00005E84 744C                    		jz	short Exec_Bad_File
 14437 00005E86 83F81A                  		cmp	ax, 26
 14438 00005E89 7519                    		jnz	short Exec_Com_Filej
 14439 00005E8B F706[D40F]FFFF          		test	word [exec_max_BSS], 0FFFFh
 14440 00005E91 7504                    		jnz	short Exec_Check_Sig
 14441 00005E93 C646FAFF                		mov	byte [bp-6], 0FFh
 14442                                  
 14443                                  Exec_Check_Sig:				; ...
 14444 00005E97 A1[C80F]                		mov	ax, [exec_signature]
 14445 00005E9A 3D5A4D                  		cmp	ax, 'ZM'
 14446 00005E9D 7408                    		jz	short Exec_Save_Start
 14447 00005E9F 3D4D5A                  		cmp	ax, 'MZ'
 14448 00005EA2 7403                    		jz	short Exec_Save_Start
 14449                                  
 14450                                  Exec_Com_Filej:				; ...
 14451 00005EA4 E9F601                  		jmp	Exec_Com_File
 14452                                  ; ---------------------------------------------------------------------------
 14453                                  
 14454                                  Exec_Save_Start:			; ...
 14455 00005EA7 A1[CC0F]                		mov	ax, [exec_pages]
 14456 00005EAA B105                    		mov	cl, 5
 14457 00005EAC D3E0                    		shl	ax, cl
 14458 00005EAE 2B06[D00F]              		sub	ax, [exec_par_dir]
 14459 00005EB2 8946F4                  		mov	[bp-12], ax
 14460 00005EB5 F646FB02                		test	byte [bp-5], 2
 14461 00005EB9 7449                    		jz	short Exec_Allocate
 14462 00005EBB C47EFC                  		les	di, [bp-4]
 14463 00005EBE 268B05                  		mov	ax, [es:di]
 14464 00005EC1 8946EC                  		mov	[bp-20], ax
 14465 00005EC4 268B4502                		mov	ax, [es:di+2]
 14466 00005EC8 8946F6                  		mov	[bp-10], ax
 14467 00005ECB E9E300                  		jmp	Exec_Find_Res
 14468                                  ; ---------------------------------------------------------------------------
 14469                                  
 14470                                  Exec_No_Mem:				; ...
 14471 00005ECE B008                    		mov	al, 8
 14472 00005ED0 EB02                    		jmp	short Exec_Bomb
 14473                                  ; ---------------------------------------------------------------------------
 14474                                  
 14475                                  Exec_Bad_File:				; ...
 14476 00005ED2 B00B                    		mov	al, 0Bh
 14477                                  
 14478                                  Exec_Bomb:				; ...
 14479 00005ED4 8B5EF8                  		mov	bx, [bp-8]
 14480 00005ED7 E84404                  		call	Exec_Dealloc
 14481 00005EDA E89DB4                  		call	LCritDisk
 14482 00005EDD 50                      		push	ax
 14483 00005EDE 55                      		push	bp
 14484 00005EDF E8690A                  		call	$CLOSE
 14485 00005EE2 5D                      		pop	bp
 14486 00005EE3 58                      		pop	ax
 14487 00005EE4 E9B9FE                  		jmp	Exec_Ret_Err
 14488                                  ; ---------------------------------------------------------------------------
 14489                                  
 14490                                  Exec_Chk_Mem:				; ...
 14491 00005EE7 36A0[0203]              		mov	al, [ss:AllocMethod]
 14492 00005EEB 368A1E[8400]            		mov	bl, [ss:ALLOCMSAVE]
 14493 00005EF0 36881E[0203]            		mov	byte [ss:AllocMethod], bl
 14494 00005EF5 F6C340                  		test	bl, 40h
 14495 00005EF8 75D4                    		jnz	short Exec_No_Mem
 14496 00005EFA A840                    		test	al, 40h
 14497 00005EFC 74D0                    		jz	short Exec_No_Mem
 14498 00005EFE 36A1[8A00]              		mov	ax, [ss:SAVE_AX]
 14499 00005F02 EB29                    		jmp	short Exec_Norm_Alloc
 14500                                  ; ---------------------------------------------------------------------------
 14501                                  
 14502                                  Exec_Allocate:				; ...
 14503 00005F04 C646E300                		mov	byte [bp-29], 0
 14504 00005F08 833E[D60F]00            		cmp	word [exec_SS], 0
 14505 00005F0D 7512                    		jnz	short ea1
 14506 00005F0F 833E[D80F]00            		cmp	word [exec_SP], 0
 14507 00005F14 750B                    		jnz	short ea1
 14508 00005F16 FE46E3                  		inc	byte [bp-29]
 14509 00005F19 3DF00F                  		cmp	ax, 0FF0h	; 1000h-10h
 14510 00005F1C 7303                    		jnb	short ea1
 14511 00005F1E 83C010                  		add	ax, 10h
 14512                                  
 14513                                  ea1:					; ...
 14514 00005F21 F606[0203]80            		test	byte [AllocMethod], 80h ; HIGH_FIRST
 14515 00005F26 7405                    		jz	short Exec_Norm_Alloc
 14516 00005F28 800E[0203]40            		or	byte [AllocMethod], 40h ; HIGH_ONLY
 14517                                  
 14518                                  Exec_Norm_Alloc:			; ...
 14519 00005F2D A3[8A00]                		mov	[SAVE_AX], ax
 14520 00005F30 BBFFFF                  		mov	bx, 0FFFFh
 14521 00005F33 1E                      		push	ds
 14522 00005F34 E87705                  		call	$ALLOC
 14523 00005F37 1F                      		pop	ds
 14524 00005F38 A1[8A00]                		mov	ax, [SAVE_AX]
 14525 00005F3B 83C010                  		add	ax, 10h
 14526 00005F3E 83FB11                  		cmp	bx, 11h
 14527 00005F41 72A4                    		jb	short Exec_Chk_Mem
 14528 00005F43 39D8                    		cmp	ax, bx
 14529 00005F45 77A0                    		ja	short Exec_Chk_Mem
 14530 00005F47 F646FAFF                		test	byte [bp-6], 0FFh
 14531 00005F4B 7518                    		jnz	short Exec_BX_Max
 14532 00005F4D 0306[D20F]              		add	ax, [exec_min_BSS]
 14533 00005F51 7294                    		jb	short Exec_Chk_Mem
 14534 00005F53 39D8                    		cmp	ax, bx
 14535 00005F55 7790                    		ja	short Exec_Chk_Mem
 14536 00005F57 2B06[D20F]              		sub	ax, [exec_min_BSS]
 14537 00005F5B 0306[D40F]              		add	ax, [exec_max_BSS]
 14538 00005F5F 7204                    		jb	short Exec_BX_Max
 14539 00005F61 39D8                    		cmp	ax, bx
 14540 00005F63 7602                    		jbe	short Exec_Got_Block
 14541                                  
 14542                                  Exec_BX_Max:				; ...
 14543 00005F65 89D8                    		mov	ax, bx
 14544                                  
 14545                                  Exec_Got_Block:				; ...
 14546 00005F67 1E                      		push	ds
 14547 00005F68 89C3                    		mov	bx, ax
 14548 00005F6A 895EF0                  		mov	[bp-16], bx
 14549 00005F6D E83E05                  		call	$ALLOC
 14550 00005F70 1F                      		pop	ds
 14551 00005F71 7303                    		jnb	short eat0
 14552 00005F73 E971FF                  		jmp	Exec_Chk_Mem
 14553                                  ; ---------------------------------------------------------------------------
 14554                                  
 14555                                  eat0:					; ...
 14556 00005F76 8A0E[8400]              		mov	cl, [ALLOCMSAVE]
 14557 00005F7A 880E[0203]              		mov	byte [AllocMethod], cl
 14558 00005F7E 807EE300                		cmp	byte [bp-29], 0
 14559 00005F82 7412                    		jz	short ea2
 14560 00005F84 81FB0010                		cmp	bx, 1000h
 14561 00005F88 730C                    		jnb	short ea2
 14562 00005F8A B104                    		mov	cl, 4
 14563 00005F8C D3E3                    		shl	bx, cl
 14564 00005F8E 81EB0001                		sub	bx, 100h
 14565 00005F92 891E[D80F]              		mov	[exec_SP], bx
 14566                                  
 14567                                  ea2:					; ...
 14568 00005F96 8946EE                  		mov	[bp-18], ax
 14569 00005F99 83C010                  		add	ax, 10h
 14570 00005F9C F646FAFF                		test	byte [bp-6], 0FFh
 14571 00005FA0 7409                    		jz	short Exec_Use_AX
 14572 00005FA2 0346F0                  		add	ax, [bp-16]
 14573 00005FA5 2B46F4                  		sub	ax, [bp-12]
 14574 00005FA8 83E810                  		sub	ax, 10h
 14575                                  
 14576                                  Exec_Use_AX:				; ...
 14577 00005FAB 8946F6                  		mov	[bp-10], ax
 14578 00005FAE 8946EC                  		mov	[bp-20], ax
 14579                                  
 14580                                  Exec_Find_Res:				; ...
 14581 00005FB1 8B56EC                  		mov	dx, [bp-20]
 14582 00005FB4 8956E4                  		mov	[bp-28], dx
 14583 00005FB7 8B16[D00F]              		mov	dx, [exec_par_dir]
 14584 00005FBB 52                      		push	dx
 14585 00005FBC B104                    		mov	cl, 4
 14586 00005FBE D3E2                    		shl	dx, cl
 14587 00005FC0 58                      		pop	ax
 14588 00005FC1 B10C                    		mov	cl, 12
 14589 00005FC3 D3E8                    		shr	ax, cl
 14590 00005FC5 89C1                    		mov	cx, ax
 14591 00005FC7 8B5EF8                  		mov	bx, [bp-8]
 14592 00005FCA 1E                      		push	ds
 14593 00005FCB 30C0                    		xor	al, al
 14594 00005FCD E8F50A                  		call	$LSEEK
 14595 00005FD0 1F                      		pop	ds
 14596 00005FD1 7303                    		jnb	short Exec_Big_Read
 14597 00005FD3 E9FEFE                  		jmp	Exec_Bomb
 14598                                  ; ---------------------------------------------------------------------------
 14599                                  
 14600                                  Exec_Big_Read:				; ...
 14601 00005FD6 8B5EF4                  		mov	bx, [bp-12]
 14602 00005FD9 81FB0010                		cmp	bx, 1000h
 14603 00005FDD 7203                    		jb	short Exec_Read_OK
 14604 00005FDF BBE00F                  		mov	bx, 0FE0h
 14605                                  
 14606                                  Exec_Read_OK:				; ...
 14607 00005FE2 295EF4                  		sub	[bp-12], bx
 14608 00005FE5 53                      		push	bx
 14609 00005FE6 B104                    		mov	cl, 4
 14610 00005FE8 D3E3                    		shl	bx, cl
 14611 00005FEA 89D9                    		mov	cx, bx
 14612 00005FEC 1E                      		push	ds
 14613 00005FED 8E5EEC                  		mov	ds, word [bp-20]
 14614 00005FF0 31D2                    		xor	dx, dx
 14615 00005FF2 51                      		push	cx
 14616 00005FF3 E81903                  		call	ExecRead
 14617 00005FF6 59                      		pop	cx
 14618 00005FF7 1F                      		pop	ds
 14619 00005FF8 7248                    		jb	short Exec_Bad_FileJ
 14620 00005FFA 39C1                    		cmp	cx, ax
 14621 00005FFC 5B                      		pop	bx
 14622 00005FFD 7408                    		jz	short ExecCheckEnd
 14623 00005FFF 29C1                    		sub	cx, ax
 14624 00006001 81F90002                		cmp	cx, 512
 14625 00006005 733B                    		jnb	short Exec_Bad_FileJ
 14626                                  
 14627                                  ExecCheckEnd:				; ...
 14628 00006007 015EEC                  		add	[bp-20], bx
 14629 0000600A F746F4FFFF              		test	word [bp-12], 0FFFFh
 14630 0000600F 75C5                    		jnz	short Exec_Big_Read
 14631 00006011 8B4EF6                  		mov	cx, [bp-10]
 14632 00006014 A1[D60F]                		mov	ax, [exec_SS]
 14633 00006017 01C8                    		add	ax, cx
 14634 00006019 A3[C20F]                		mov	[exec_init_SS], ax
 14635 0000601C A1[D80F]                		mov	ax, [exec_SP]
 14636 0000601F A3[C00F]                		mov	[exec_init_SP], ax
 14637 00006022 C406[DC0F]              		les	ax, [exec_IP]
 14638 00006026 A3[C40F]                		mov	[exec_init_IP], ax
 14639 00006029 8CC0                    		mov	ax, es
 14640 0000602B 01C8                    		add	ax, cx
 14641 0000602D A3[C60F]                		mov	[exec_init_CS], ax
 14642 00006030 31C9                    		xor	cx, cx
 14643 00006032 8B16[E00F]              		mov	dx, [exec_rle_table]
 14644 00006036 8B5EF8                  		mov	bx, [bp-8]
 14645 00006039 1E                      		push	ds
 14646 0000603A 31C0                    		xor	ax, ax
 14647 0000603C E8860A                  		call	$LSEEK
 14648 0000603F 1F                      		pop	ds
 14649 00006040 7303                    		jnb	short exec_get_entries
 14650                                  
 14651                                  Exec_Bad_FileJ:				; ...
 14652 00006042 E98DFE                  		jmp	Exec_Bad_File
 14653                                  ; ---------------------------------------------------------------------------
 14654                                  
 14655                                  exec_get_entries:			; ...
 14656 00006045 8B16[CE0F]              		mov	dx, [exec_rle_count]
 14657                                  
 14658                                  exec_read_reloc:			; ...
 14659 00006049 52                      		push	dx
 14660 0000604A BA[BE03]                		mov	dx, OPENBUF ; Exec_Internal_Buffer
 14661 0000604D B98C01                  		mov	cx, 396		; (Exec_Internal_Buffer_Size)/4)*4
 14662 00006050 1E                      		push	ds
 14663 00006051 E8BB02                  		call	ExecRead
 14664 00006054 07                      		pop	es
 14665 00006055 5A                      		pop	dx
 14666 00006056 72EA                    		jb	short Exec_Bad_FileJ
 14667 00006058 B96300                  		mov	cx, 99		; (Exec_Internal_Buffer_Size)/4
 14668 0000605B BF[BE03]                		mov	di, OPENBUF ; Exec_Internal_Buffer
 14669 0000605E 8B76F6                  		mov	si, [bp-10]
 14670                                  
 14671                                  exec_reloc_one:				; ...
 14672 00006061 09D2                    		or	dx, dx
 14673 00006063 7416                    		jz	short Exec_Set_PDBJ
 14674                                  
 14675                                  exec_get_addr:
 14676 00006065 26C51D                  		lds	bx, [es:di]
 14677 00006068 8CD8                    		mov	ax, ds
 14678 0000606A 0346E4                  		add	ax, [bp-28]
 14679 0000606D 8ED8                    		mov	ds, ax
 14680 0000606F 0137                    		add	[bx], si
 14681 00006071 83C704                  		add	di, 4
 14682 00006074 4A                      		dec	dx
 14683 00006075 E2EA                    		loop	exec_reloc_one
 14684 00006077 06                      		push	es
 14685 00006078 1F                      		pop	ds
 14686 00006079 EBCE                    		jmp	short exec_read_reloc
 14687                                  ; ---------------------------------------------------------------------------
 14688                                  
 14689                                  Exec_Set_PDBJ:				; ...
 14690 0000607B 06                      		push	es
 14691 0000607C 50                      		push	ax
 14692 0000607D 51                      		push	cx
 14693 0000607E 8E46E4                  		mov	es, word [bp-28]
 14694 00006081 36A1[C60F]              		mov	ax, [ss:exec_init_CS]
 14695 00006085 368B0E[C40F]            		mov	cx, [ss:exec_init_IP]
 14696 0000608A 36FF16[1212]            		call	[ss:FixExePatch]
 14697 0000608F 36FF16[6213]            		call	[ss:Rational386PatchPtr]
 14698 00006094 59                      		pop	cx
 14699 00006095 58                      		pop	ax
 14700 00006096 07                      		pop	es
 14701 00006097 E9DE00                  		jmp	Exec_Set_PDB
 14702                                  ; ---------------------------------------------------------------------------
 14703                                  
 14704                                  Exec_No_Memj:				; ...
 14705 0000609A E931FE                  		jmp	Exec_No_Mem
 14706                                  ; ---------------------------------------------------------------------------
 14707                                  
 14708                                  Exec_Com_File:				; ...
 14709 0000609D F646FB02                		test	byte [bp-5], 2
 14710 000060A1 742D                    		jz	short Exec_Alloc_Com_File
 14711 000060A3 C576FC                  		lds	si, [bp-4]
 14712 000060A6 AD                      		lodsw
 14713 000060A7 8946EC                  		mov	[bp-20], ax
 14714 000060AA B8FFFF                  		mov	ax, 0FFFFh
 14715 000060AD EB63                    		jmp	short Exec_Read_Block
 14716                                  ; ---------------------------------------------------------------------------
 14717                                  
 14718                                  Exec_Chk_Com_Mem:			; ...
 14719 000060AF 36A0[0203]              		mov	al, [ss:AllocMethod]
 14720 000060B3 368A1E[8400]            		mov	bl, [ss:ALLOCMSAVE]
 14721 000060B8 36881E[0203]            		mov	byte [ss:AllocMethod], bl
 14722 000060BD F6C340                  		test	bl, 40h
 14723 000060C0 75D8                    		jnz	short Exec_No_Memj
 14724 000060C2 A840                    		test	al, 40h
 14725 000060C4 74D4                    		jz	short Exec_No_Memj
 14726 000060C6 8B46EE                  		mov	ax, [bp-18]
 14727 000060C9 31DB                    		xor	bx, bx
 14728 000060CB E87A02                  		call	ChangeOwner
 14729 000060CE EB0E                    		jmp	short Exec_Norm_Com_Alloc
 14730                                  ; ---------------------------------------------------------------------------
 14731                                  
 14732                                  Exec_Alloc_Com_File:			; ...
 14733 000060D0 36F606[0203]80          		test	byte [ss:AllocMethod], 80h
 14734 000060D6 7406                    		jz	short Exec_Norm_Com_Alloc
 14735 000060D8 36800E[0203]40          		or	byte [ss:AllocMethod], 40h
 14736                                  
 14737                                  Exec_Norm_Com_Alloc:			; ...
 14738 000060DE BBFFFF                  		mov	bx, 0FFFFh
 14739 000060E1 E8CA03                  		call	$ALLOC
 14740 000060E4 09DB                    		or	bx, bx
 14741 000060E6 74C7                    		jz	short Exec_Chk_Com_Mem
 14742 000060E8 895EF0                  		mov	[bp-16], bx
 14743 000060EB 53                      		push	bx
 14744 000060EC E8BF03                  		call	$ALLOC
 14745 000060EF 5B                      		pop	bx
 14746 000060F0 8946EE                  		mov	[bp-18], ax
 14747 000060F3 83C010                  		add	ax, 10h
 14748 000060F6 8946EC                  		mov	[bp-20], ax
 14749 000060F9 31C0                    		xor	ax, ax
 14750 000060FB 81FB0010                		cmp	bx, 1000h
 14751 000060FF 730E                    		jnb	short Exec_Read_Com
 14752 00006101 89D8                    		mov	ax, bx
 14753 00006103 B104                    		mov	cl, 4
 14754 00006105 D3E0                    		shl	ax, cl
 14755 00006107 3D0002                  		cmp	ax, 200h
 14756 0000610A 76A3                    		jbe	short Exec_Chk_Com_Mem
 14757 0000610C 2D0001                  		sub	ax, 100h
 14758                                  
 14759                                  Exec_Read_Com:				; ...
 14760 0000610F 2D0001                  		sub	ax, 100h
 14761                                  
 14762                                  Exec_Read_Block:			; ...
 14763 00006112 50                      		push	ax
 14764 00006113 8B5EF8                  		mov	bx, [bp-8]
 14765 00006116 31C9                    		xor	cx, cx
 14766 00006118 89CA                    		mov	dx, cx
 14767 0000611A 31C0                    		xor	ax, ax
 14768 0000611C E8A609                  		call	$LSEEK
 14769 0000611F 59                      		pop	cx
 14770 00006120 8E5EEC                  		mov	ds, word [bp-20]
 14771 00006123 31D2                    		xor	dx, dx
 14772 00006125 51                      		push	cx
 14773 00006126 E8E601                  		call	ExecRead
 14774 00006129 5E                      		pop	si
 14775 0000612A 7303                    		jnb	short OkRead
 14776 0000612C E9A3FD                  		jmp	Exec_Bad_File
 14777                                  ; ---------------------------------------------------------------------------
 14778                                  
 14779                                  OkRead:					; ...
 14780 0000612F 39F0                    		cmp	ax, si
 14781 00006131 7503                    		jnz	short OkRead2
 14782 00006133 E979FF                  		jmp	Exec_Chk_Com_Mem
 14783                                  ; ---------------------------------------------------------------------------
 14784                                  
 14785                                  OkRead2:				; ...
 14786 00006136 368A1E[8400]            		mov	bl, [ss:ALLOCMSAVE]
 14787 0000613B 36881E[0203]            		mov	byte [ss:AllocMethod], bl
 14788 00006140 F646FB02                		test	byte [bp-5], 2
 14789 00006144 7532                    		jnz	short Exec_Set_PDB
 14790 00006146 8B46EC                  		mov	ax, [bp-20]
 14791 00006149 83E810                  		sub	ax, 10h
 14792 0000614C 36A3[C60F]              		mov	[ss:exec_init_CS], ax
 14793 00006150 36C706[C40F]0001        		mov	word [ss:exec_init_IP], 100h
 14794 00006157 81C6FE00                		add	si, 0FEh
 14795 0000615B 83FEFE                  		cmp	si, 0FFFEh
 14796 0000615E 7404                    		jz	short Exec_St_Ok
 14797 00006160 81C60001                		add	si, 100h
 14798                                  
 14799                                  Exec_St_Ok:				; ...
 14800 00006164 368936[C00F]            		mov	[ss:exec_init_SP], si
 14801 00006169 36A3[C20F]              		mov	[ss:exec_init_SS], ax
 14802 0000616D 8ED8                    		mov	ds, ax
 14803 0000616F C7040000                		mov	word [si], 0
 14804 00006173 36FF16[6100]            		call	word [ss:ChkCopyProt]
 14805                                  
 14806                                  Exec_Set_PDB:				; ...
 14807 00006178 8B5EF8                  		mov	bx, [bp-8]
 14808 0000617B E8A001                  		call	Exec_Dealloc
 14809 0000617E 55                      		push	bp
 14810 0000617F E8C907                  		call	$CLOSE
 14811 00006182 5D                      		pop	bp
 14812 00006183 E8A301                  		call	Exec_Alloc
 14813 00006186 F646FB02                		test	byte [bp-5], 2 ; exec_func_overlay
 14814 0000618A 743A                    		jz	short Exec_Build_Header
 14815 0000618C E8C701                  		call	Scan_Execname
 14816 0000618F E8DB01                  		call	Scan_Special_Entries
 14817 00006192 36803E[3F10]00          		cmp	byte [ss:DriverLoad], 0
 14818 00006198 7426                    		jz	short norm_ovl
 14819 0000619A 56                      		push	si
 14820 0000619B 06                      		push	es
 14821 0000619C 36C436[4010]            		les	si, [ss:BiosDataPtr]
 14822 000061A1 26803C00                		cmp	byte [es:si], 0
 14823 000061A5 7411                    		jz	short sysinit_done
 14824 000061A7 368E06[3003]            		mov	es, [ss:CurrentPDB]
 14825 000061AC 36FF36[BD0E]            		push	word [ss:SPECIAL_VERSION]
 14826 000061B1 268F064000              		pop	word [es:40h]
 14827 000061B6 EB06                    		jmp	short setver_done
 14828                                  ; ---------------------------------------------------------------------------
 14829                                  
 14830                                  sysinit_done:				; ...
 14831 000061B8 36C606[3F10]00          		mov	byte [ss:DriverLoad], 0
 14832                                  
 14833                                  setver_done:				; ...
 14834 000061BE 07                      		pop	es
 14835 000061BF 5E                      		pop	si
 14836                                  
 14837                                  norm_ovl:				; ...
 14838 000061C0 89EC                    		mov	sp, bp
 14839 000061C2 5D                      		pop	bp
 14840 000061C3 E94BA4                  		jmp	SYS_RET_OK
 14841                                  ; ---------------------------------------------------------------------------
 14842                                  
 14843                                  Exec_Build_Header:			; ...
 14844 000061C6 8B56EE                  		mov	dx, [bp-18]
 14845 000061C9 BE0100                  		mov	si, 1
 14846 000061CC 8B46F2                  		mov	ax, [bp-14]
 14847 000061CF 09C0                    		or	ax, ax
 14848 000061D1 7405                    		jz	short No_Owner
 14849 000061D3 48                      		dec	ax
 14850 000061D4 8ED8                    		mov	ds, ax
 14851 000061D6 8914                    		mov	[si], dx
 14852                                  
 14853                                  No_Owner:				; ...
 14854 000061D8 8B46EE                  		mov	ax, [bp-18]
 14855 000061DB 48                      		dec	ax
 14856 000061DC 8ED8                    		mov	ds, ax
 14857 000061DE 8914                    		mov	[si], dx
 14858 000061E0 1E                      		push	ds
 14859 000061E1 07                      		pop	es
 14860 000061E2 BF0800                  		mov	di, 8
 14861 000061E5 E86E01                  		call	Scan_Execname
 14862 000061E8 51                      		push	cx
 14863 000061E9 56                      		push	si
 14864                                  
 14865                                  MoveName:				; ...
 14866 000061EA AC                      		lodsb
 14867 000061EB 3C2E                    		cmp	al, '.'
 14868 000061ED 7408                    		jz	short mem_done
 14869 000061EF AA                      		stosb
 14870 000061F0 83FF10                  		cmp	di, 16		; ARENAHEADERSIZE
 14871 000061F3 7302                    		jnb	short mem_done
 14872 000061F5 E2F3                    		loop	MoveName
 14873                                  
 14874                                  mem_done:				; ...
 14875 000061F7 30C0                    		xor	al, al
 14876 000061F9 83FF10                  		cmp	di, 16
 14877 000061FC 7301                    		jnb	short Fill8
 14878 000061FE AA                      		stosb
 14879                                  
 14880                                  Fill8:					; ...
 14881 000061FF 5E                      		pop	si
 14882 00006200 59                      		pop	cx
 14883 00006201 E86901                  		call	Scan_Special_Entries
 14884 00006204 52                      		push	dx
 14885 00006205 8B76F0                  		mov	si, [bp-16]
 14886 00006208 01D6                    		add	si, dx
 14887 0000620A E8B8AE                  		call	$DUP_PDB
 14888 0000620D 5A                      		pop	dx
 14889 0000620E FF76F2                  		push	word [bp-14]
 14890 00006211 268F062C00              		pop	word [es:2Ch]	; [ES:PDB.ENVIRON]
 14891 00006216 36FF36[BD0E]            		push	word [ss:SPECIAL_VERSION]
 14892 0000621B 268F064000              		pop	word [es:40h]	; [ES:PDB.Version]
 14893 00006220 C576FC                  		lds	si, [bp-4]
 14894 00006223 1E                      		push	ds
 14895 00006224 56                      		push	si
 14896 00006225 C57406                  		lds	si, [si+6]
 14897 00006228 B90C00                  		mov	cx, 12
 14898 0000622B 51                      		push	cx
 14899 0000622C BF5C00                  		mov	di, 5Ch
 14900 0000622F 8A1C                    		mov	bl, [si]
 14901 00006231 F3A4                    		rep movsb
 14902 00006233 31C0                    		xor	ax, ax
 14903 00006235 AB                      		stosw
 14904 00006236 AB                      		stosw
 14905 00006237 59                      		pop	cx
 14906 00006238 5E                      		pop	si
 14907 00006239 1F                      		pop	ds
 14908 0000623A 1E                      		push	ds
 14909 0000623B 56                      		push	si
 14910 0000623C C5740A                  		lds	si, [si+0Ah]
 14911 0000623F 8A3C                    		mov	bh, [si]
 14912 00006241 F3A4                    		rep movsb
 14913 00006243 AB                      		stosw
 14914 00006244 AB                      		stosw
 14915 00006245 5E                      		pop	si
 14916 00006246 1F                      		pop	ds
 14917 00006247 C57402                  		lds	si, [si+2]
 14918 0000624A 80C980                  		or	cl, 80h
 14919 0000624D 89CF                    		mov	di, cx
 14920 0000624F F3A4                    		rep movsb
 14921 00006251 FEC9                    		dec	cl
 14922 00006253 88F8                    		mov	al, bh
 14923 00006255 30FF                    		xor	bh, bh
 14924 00006257 E8650A                  		call	GetVisDrv
 14925 0000625A 7302                    		jnb	short Exec_BL
 14926 0000625C 88CF                    		mov	bh, cl
 14927                                  
 14928                                  Exec_BL:				; ...
 14929 0000625E 88D8                    		mov	al, bl
 14930 00006260 30DB                    		xor	bl, bl
 14931 00006262 E85A0A                  		call	GetVisDrv
 14932 00006265 7302                    		jnb	short Exec_Set_Return
 14933 00006267 88CB                    		mov	bl, cl
 14934                                  
 14935                                  Exec_Set_Return:			; ...
 14936 00006269 E836A2                  		call	Get_User_Stack
 14937 0000626C FF7414                  		push	word [si+14h]
 14938 0000626F FF7412                  		push	word [si+12h]
 14939 00006272 FF7414                  		push	word [si+14h]
 14940 00006275 FF7412                  		push	word [si+12h]
 14941 00006278 268F060A00              		pop	word [es:0Ah]	; [ES:PDB.EXIT]
 14942 0000627D 268F060C00              		pop	word [es:0Ch]
 14943 00006282 31C0                    		xor	ax, ax
 14944 00006284 8ED8                    		mov	ds, ax
 14945 00006286 8F068800                		pop	word [88h]	; [addr_int_terminate] ; 22h*4
 14946 0000628A 8F068A00                		pop	word [8Ah]
 14947 0000628E 36C706[2C03]8000        		mov	word [ss:DMAADD], 80h
 14948 00006295 368E1E[3003]            		mov	ds, [ss:CurrentPDB]
 14949 0000629A 368C1E[2E03]            		mov	word [ss:DMAADD+2], ds
 14950 0000629F F646FB01                		test	byte [bp-5], 1
 14951 000062A3 7427                    		jz	short exec_go
 14952 000062A5 36C536[C00F]            		lds	si, [ss:exec_init_SP]
 14953 000062AA C47EFC                  		les	di, [bp-4]
 14954 000062AD 268C5D10                		mov	word [es:di+10h], ds
 14955 000062B1 4E                      		dec	si
 14956 000062B2 4E                      		dec	si
 14957 000062B3 891C                    		mov	[si], bx
 14958 000062B5 2689750E                		mov	[es:di+0Eh], si
 14959 000062B9 36C506[C40F]            		lds	ax, [ss:exec_init_IP]
 14960 000062BE 268C5D14                		mov	word [es:di+14h], ds
 14961 000062C2 26894512                		mov	[es:di+12h], ax
 14962 000062C6 89EC                    		mov	sp, bp
 14963 000062C8 5D                      		pop	bp
 14964 000062C9 E945A3                  		jmp	SYS_RET_OK
 14965                                  ; ---------------------------------------------------------------------------
 14966                                  
 14967                                  exec_go:				; ...
 14968 000062CC 36C536[C40F]            		lds	si, [ss:exec_init_IP]
 14969 000062D1 36C43E[C00F]            		les	di, [ss:exec_init_SP]
 14970 000062D6 8CC0                    		mov	ax, es
 14971 000062D8 36803E[1112]00          		cmp	byte [ss:DosHasHMA], 0
 14972 000062DE 741A                    		jz	short Xfer_To_User
 14973 000062E0 1E                      		push	ds
 14974 000062E1 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
 14975 000062E6 800E[8600]04            		or	byte [DOS_FLAG], 4	; EXECA20OFF
 14976 000062EB 8916[6300]              		mov	[A20OFF_PSP], dx
 14977 000062EF 8CD8                    		mov	ax, ds
 14978 000062F1 1F                      		pop	ds
 14979 000062F2 50                      		push	ax
 14980 000062F3 B8[1511]                		mov	ax, disa20_xfer
 14981 000062F6 50                      		push	ax
 14982 000062F7 8CC0                    		mov	ax, es
 14983 000062F9 CB                      		retf
 14984                                  ; ---------------------------------------------------------------------------
 14985                                  
 14986                                  Xfer_To_User:				; ...
 14987 000062FA FA                      		cli
 14988 000062FB 36C606[2103]00          		mov	byte [ss:INDOS], 0
 14989 00006301 8ED0                    		mov	ss, ax
 14990 00006303 89FC                    		mov	sp, di
 14991 00006305 FB                      		sti
 14992 00006306 1E                      		push	ds
 14993 00006307 56                      		push	si
 14994 00006308 8EC2                    		mov	es, dx
 14995 0000630A 8EDA                    		mov	ds, dx
 14996 0000630C 89D8                    		mov	ax, bx
 14997 0000630E CB                      		retf
 14998                                  
 14999                                  ; =============== S U B	R O U T	I N E =======================================
 15000                                  
 15001                                  
 15002                                  ExecRead:
 15003 0000630F E80C00                  		call	Exec_Dealloc
 15004 00006312 8B5EF8                  		mov	bx, [bp-8]
 15005 00006315 55                      		push	bp
 15006 00006316 E84107                  		call	$READ
 15007 00006319 5D                      		pop	bp
 15008 0000631A E80C00                  		call	Exec_Alloc
 15009 0000631D C3                      		retn
 15010                                  
 15011                                  ; =============== S U B	R O U T	I N E =======================================
 15012                                  
 15013                                  
 15014                                  Exec_Dealloc:
 15015 0000631E 53                      		push	bx
 15016 0000631F 29DB                    		sub	bx, bx
 15017 00006321 E836B0                  		call	ECritDisk
 15018 00006324 E81000                  		call	ChangeOwners
 15019 00006327 5B                      		pop	bx
 15020 00006328 C3                      		retn
 15021                                  
 15022                                  ; =============== S U B	R O U T	I N E =======================================
 15023                                  
 15024                                  
 15025                                  Exec_Alloc:
 15026 00006329 53                      		push	bx
 15027 0000632A 368B1E[3003]            		mov	bx, [ss:CurrentPDB]
 15028 0000632F E80500                  		call	ChangeOwners
 15029 00006332 E845B0                  		call	LCritDisk
 15030 00006335 5B                      		pop	bx
 15031 00006336 C3                      		retn
 15032                                  
 15033                                  ; =============== S U B	R O U T	I N E =======================================
 15034                                  
 15035                                  
 15036                                  ChangeOwners:
 15037 00006337 9C                      		pushf
 15038 00006338 50                      		push	ax
 15039 00006339 8B46F2                  		mov	ax, [bp-14]
 15040 0000633C E80900                  		call	ChangeOwner
 15041 0000633F 8B46EE                  		mov	ax, [bp-18]
 15042 00006342 E80300                  		call	ChangeOwner
 15043 00006345 58                      		pop	ax
 15044 00006346 9D                      		popf
 15045                                  
 15046                                  chgown_retn:				; ...
 15047 00006347 C3                      		retn
 15048                                  
 15049                                  ; =============== S U B	R O U T	I N E =======================================
 15050                                  
 15051                                  
 15052                                  ChangeOwner:
 15053 00006348 09C0                    		or	ax, ax
 15054 0000634A 74FB                    		jz	short chgown_retn
 15055 0000634C 48                      		dec	ax
 15056 0000634D 1E                      		push	ds
 15057 0000634E 8ED8                    		mov	ds, ax
 15058 00006350 891E0100                		mov	[1], bx	; [ARENA.OWNER]
 15059 00006354 1F                      		pop	ds
 15060 00006355 C3                      		retn
 15061                                  
 15062                                  ; =============== S U B	R O U T	I N E =======================================
 15063                                  
 15064                                  
 15065                                  Scan_Execname:
 15066 00006356 C576E6                  		lds	si, [bp-26]
 15067                                  
 15068                                  Scan_Execname1:				; ...
 15069 00006359 89F1                    		mov	cx, si
 15070                                  
 15071                                  Scan0:					; ...
 15072 0000635B AC                      		lodsb
 15073 0000635C 3C3A                    		cmp	al, ':'
 15074 0000635E 74F9                    		jz	short Scan_Execname1
 15075 00006360 3C5C                    		cmp	al, '\'
 15076 00006362 74F5                    		jz	short Scan_Execname1
 15077 00006364 3C00                    		cmp	al, 0
 15078 00006366 75F3                    		jnz	short Scan0
 15079 00006368 29CE                    		sub	si, cx
 15080 0000636A 87F1                    		xchg	si, cx
 15081 0000636C C3                      		retn
 15082                                  
 15083                                  ; =============== S U B	R O U T	I N E =======================================
 15084                                  
 15085                                  
 15086                                  Scan_Special_Entries:
 15087 0000636D 49                      		dec	cx
 15088 0000636E 36C706[BD0E]0616        		mov	word [ss:SPECIAL_VERSION], 1606h
 15089 00006375 36C43E[5D00]            		les	di, [ss:UU_IFS_DOS_CALL]
 15090 0000637A 8CC0                    		mov	ax, es
 15091 0000637C 09F8                    		or	ax, di
 15092 0000637E 743A                    		jz	short End_List
 15093                                  
 15094                                  GetEntries:				; ...
 15095 00006380 268A05                  		mov	al, [es:di]
 15096 00006383 08C0                    		or	al, al
 15097 00006385 7433                    		jz	short End_List
 15098 00006387 36893E[0E06]            		mov	[ss:TEMP_VAR2], di
 15099 0000638C 38C8                    		cmp	al, cl
 15100 0000638E 751C                    		jnz	short SkipOne
 15101 00006390 47                      		inc	di
 15102 00006391 51                      		push	cx
 15103 00006392 56                      		push	si
 15104 00006393 50                      		push	ax
 15105                                  
 15106                                  sse_next_char:				; ...
 15107 00006394 AC                      		lodsb
 15108 00006395 E89AEE                  		call	UCase
 15109 00006398 AE                      		scasb
 15110 00006399 750E                    		jnz	short Not_Matched
 15111 0000639B E2F7                    		loop	sse_next_char
 15112 0000639D 58                      		pop	ax
 15113 0000639E 268B05                  		mov	ax, [es:di]
 15114 000063A1 36A3[BD0E]              		mov	[ss:SPECIAL_VERSION], ax
 15115 000063A5 5E                      		pop	si
 15116 000063A6 59                      		pop	cx
 15117 000063A7 EB11                    		jmp	short End_List
 15118                                  ; ---------------------------------------------------------------------------
 15119                                  
 15120                                  Not_Matched:				; ...
 15121 000063A9 58                      		pop	ax
 15122 000063AA 5E                      		pop	si
 15123 000063AB 59                      		pop	cx
 15124                                  
 15125                                  SkipOne:				; ...
 15126 000063AC 368B3E[0E06]            		mov	di, [ss:TEMP_VAR2]
 15127 000063B1 30E4                    		xor	ah, ah
 15128 000063B3 01C7                    		add	di, ax
 15129 000063B5 83C703                  		add	di, 3
 15130 000063B8 EBC6                    		jmp	short GetEntries
 15131                                  ; ---------------------------------------------------------------------------
 15132                                  
 15133                                  End_List:				; ...
 15134 000063BA C3                      		retn
 15135                                  
 15136                                  ; ---------------------------------------------------------------------------
 15137                                  
 15138                                  $KEEP_PROCESS:				; ...
 15139 000063BB 50                      		push	ax
 15140 000063BC 36C606[7C05]03          		mov	byte [ss:EXIT_TYPE], 3
 15141 000063C2 368E06[3003]            		mov	es, [ss:CurrentPDB]
 15142 000063C7 83FA06                  		cmp	dx, 6
 15143 000063CA 7303                    		jnb	short Keep_Shrink
 15144 000063CC BA0600                  		mov	dx, 6
 15145                                  
 15146                                  Keep_Shrink:				; ...
 15147 000063CF 89D3                    		mov	bx, dx
 15148 000063D1 53                      		push	bx
 15149 000063D2 06                      		push	es
 15150 000063D3 E83902                  		call	$SETBLOCK
 15151 000063D6 1F                      		pop	ds
 15152 000063D7 5B                      		pop	bx
 15153 000063D8 7207                    		jb	short Keep_Done
 15154 000063DA 8CD8                    		mov	ax, ds
 15155 000063DC 01D8                    		add	ax, bx
 15156 000063DE A30200                  		mov	[2], ax	; [PDB.BLOCK_LEN]
 15157                                  
 15158                                  Keep_Done:				; ...
 15159 000063E1 58                      		pop	ax
 15160 000063E2 EB26                    		jmp	short exit_inner
 15161                                  ; ---------------------------------------------------------------------------
 15162                                  
 15163                                  stay_resident:				; ...
 15164 000063E4 B80031                  		mov	ax, 3100h
 15165 000063E7 83C20F                  		add	dx, 15
 15166 000063EA D1DA                    		rcr	dx, 1
 15167 000063EC B103                    		mov	cl, 3
 15168 000063EE D3EA                    		shr	dx, cl
 15169 000063F0 E9259F                  		jmp	command
 15170                                  ; ---------------------------------------------------------------------------
 15171                                  
 15172                                  $EXIT:					; ...
 15173 000063F3 30E4                    		xor	ah, ah
 15174 000063F5 368626[4D03]            		xchg	ah, [ss:DidCTRLC]
 15175 000063FA 08E4                    		or	ah, ah
 15176 000063FC 36C606[7C05]00          		mov	byte [ss:EXIT_TYPE], 0	; EXIT_TERMINATE
 15177 00006402 7406                    		jz	short exit_inner
 15178 00006404 36C606[7C05]01          		mov	byte [ss:EXIT_TYPE], 1	; EXIT_CTRL_C
 15179                                  ; START	OF FUNCTION CHUNK FOR FATALC
 15180                                  
 15181                                  exit_inner:				; ...
 15182 0000640A E895A0                  		call	Get_User_Stack
 15183 0000640D 36FF36[3003]            		push	word [ss:CurrentPDB]
 15184 00006412 8F4414                  		pop	word [si+14h]
 15185 00006415 EB08                    		jmp	short abort_inner
 15186                                  ; END OF FUNCTION CHUNK	FOR FATALC
 15187                                  ; ---------------------------------------------------------------------------
 15188                                  
 15189                                  $ABORT:					; ...
 15190 00006417 30C0                    		xor	al, al
 15191 00006419 36C606[7C05]00          		mov	byte [ss:EXIT_TYPE], 0	; EXIT_ABORT
 15192                                  ; START	OF FUNCTION CHUNK FOR FATALC
 15193                                  
 15194                                  abort_inner:				; ...
 15195 0000641F 368A26[7C05]            		mov	ah, [ss:EXIT_TYPE]
 15196 00006424 36A3[3403]              		mov	[ss:exit_code], ax
 15197 00006428 E877A0                  		call	Get_User_Stack
 15198 0000642B 8E5C14                  		mov	ds, word [si+14h]
 15199 0000642E 31C0                    		xor	ax, ax
 15200 00006430 8EC0                    		mov	es, ax
 15201 00006432 BE0A00                  		mov	si, 10
 15202 00006435 BF8800                  		mov	di, 88h
 15203 00006438 A5                      		movsw
 15204 00006439 A5                      		movsw
 15205 0000643A A5                      		movsw
 15206 0000643B A5                      		movsw
 15207 0000643C A5                      		movsw
 15208 0000643D A5                      		movsw
 15209 0000643E E912F2                  		jmp	reset_environment
 15210                                  ; END OF FUNCTION CHUNK	FOR FATALC
 15211                                  ; ---------------------------------------------------------------------------
 15212                                  
 15213                                  RetExePatch:
 15214 00006441 C3                      		retn
 15215                                  
 15216                                  ; =============== S U B	R O U T	I N E =======================================
 15217                                  
 15218                                  
 15219                                  arena_free_process:
 15220 00006442 36A1[2400]              		mov	ax, [ss:arena_head]
 15221                                  
 15222                                  arena_free_process_start:
 15223 00006446 BF0000                  		mov	di, 0
 15224 00006449 E83000                  		call	check_signature
 15225                                  
 15226                                  arena_free_process_loop:
 15227 0000644C 723D                    		jb	short check_signature_ok
 15228 0000644E 06                      		push	es
 15229 0000644F 1F                      		pop	ds
 15230 00006450 391E0100                		cmp	[1], bx	; [ARENA.OWNER]
 15231 00006454 7504                    		jnz	short arena_free_next
 15232 00006456 893E0100                		mov	[1], di
 15233                                  
 15234                                  arena_free_next:
 15235 0000645A 803D5A                  		cmp	byte [di], 5Ah ; 'Z'
 15236 0000645D 7405                    		jz	short arena_chk_umbs
 15237 0000645F E81300                  		call	arena_next
 15238 00006462 EBE8                    		jmp	short arena_free_process_loop
 15239                                  ; ---------------------------------------------------------------------------
 15240                                  
 15241                                  arena_chk_umbs:
 15242 00006464 36A1[8C00]              		mov	ax, [ss:UMB_HEAD]
 15243 00006468 83F8FF                  		cmp	ax, 0FFFFh
 15244 0000646B 741E                    		jz	short check_signature_ok
 15245 0000646D 8CDF                    		mov	di, ds
 15246 0000646F 39C7                    		cmp	di, ax
 15247 00006471 7318                    		jnb	short check_signature_ok
 15248 00006473 EBD1                    		jmp	short arena_free_process_start
 15249                                  
 15250                                  ; =============== S U B	R O U T	I N E =======================================
 15251                                  
 15252                                  
 15253                                  arena_next:
 15254 00006475 8CD8                    		mov	ax, ds
 15255 00006477 03060300                		add	ax, [3]	; [ARENA.SIZE]
 15256 0000647B 40                      		inc	ax
 15257                                  
 15258                                  ; =============== S U B	R O U T	I N E =======================================
 15259                                  
 15260                                  
 15261                                  check_signature:
 15262 0000647C 8EC0                    		mov	es, ax
 15263 0000647E 26803D4D                		cmp	byte [es:di], 4Dh ;	'M'
 15264 00006482 7407                    		jz	short check_signature_ok
 15265 00006484 26803D5A                		cmp	byte [es:di], 5Ah ;	'Z'
 15266 00006488 7401                    		jz	short check_signature_ok
 15267 0000648A F9                      		stc
 15268                                  
 15269                                  check_signature_ok:			; ...
 15270 0000648B C3                      		retn
 15271                                  
 15272                                  ; =============== S U B	R O U T	I N E =======================================
 15273                                  
 15274                                  
 15275                                  Coalesce:
 15276 0000648C 803D5A                  		cmp	byte [di], 5Ah ; 'Z'
 15277 0000648F 74FA                    		jz	short check_signature_ok
 15278 00006491 E8E1FF                  		call	arena_next
 15279 00006494 72F5                    		jb	short check_signature_ok
 15280 00006496 26393E0100              		cmp	[es:1], di
 15281 0000649B 75EE                    		jnz	short check_signature_ok
 15282 0000649D 268B0E0300              		mov	cx, [es:3]
 15283 000064A2 41                      		inc	cx
 15284 000064A3 010E0300                		add	[3], cx
 15285 000064A7 268A0D                  		mov	cl, [es:di]
 15286 000064AA 880D                    		mov	[di], cl
 15287 000064AC EBDE                    		jmp	short Coalesce
 15288                                  
 15289                                  ; =============== S U B	R O U T	I N E =======================================
 15290                                  
 15291                                  
 15292                                  $ALLOC:
 15293 000064AE E8A9AE                  		call	ECritDisk	; ECritMEM
 15294 000064B1 36A1[2400]              		mov	ax, [ss:arena_head]
 15295 000064B5 36A3[8E00]              		mov	[ss:START_ARENA], ax
 15296 000064B9 36F606[0203]C0          		test	byte [ss:AllocMethod], 0C0h ; HIGH_FIRST+HIGH_ONLY
 15297 000064BF 7410                    		jz	short norm_alloc
 15298 000064C1 36F606[8900]01          		test	byte [ss:UMBFLAG], 1
 15299 000064C7 7408                    		jz	short norm_alloc
 15300 000064C9 36A1[8C00]              		mov	ax, [ss:UMB_HEAD]
 15301 000064CD 36A3[8E00]              		mov	[ss:START_ARENA], ax
 15302                                  
 15303                                  norm_alloc:				; ...
 15304 000064D1 31C0                    		xor	ax, ax
 15305 000064D3 89C7                    		mov	di, ax
 15306 000064D5 36A3[4003]              		mov	word [ss:FirstArena], ax
 15307 000064D9 36A3[4203]              		mov	word [ss:BestArena], ax
 15308 000064DD 36A3[4403]              		mov	[ss:LastArena], ax
 15309 000064E1 50                      		push	ax
 15310                                  
 15311                                  start_scan:				; ...
 15312 000064E2 36A1[8E00]              		mov	ax, [ss:START_ARENA]
 15313 000064E6 E893FF                  		call	check_signature
 15314 000064E9 7236                    		jb	short alloc_err
 15315                                  
 15316                                  alloc_scan:				; ...
 15317 000064EB 06                      		push	es
 15318 000064EC 1F                      		pop	ds
 15319 000064ED 393E0100                		cmp	[1], di
 15320 000064F1 7469                    		jz	short alloc_free
 15321                                  
 15322                                  alloc_next:				; ...
 15323 000064F3 36F606[8900]01          		test	byte [ss:UMBFLAG], 1
 15324 000064F9 741C                    		jz	short norm_strat
 15325 000064FB 36F606[0203]80          		test	byte [ss:AllocMethod], 80h
 15326 00006501 7414                    		jz	short norm_strat
 15327 00006503 36A1[8E00]              		mov	ax, [ss:START_ARENA]
 15328 00006507 363B06[2400]            		cmp	ax, [ss:arena_head]
 15329 0000650C 7509                    		jnz	short norm_strat
 15330 0000650E 8CD8                    		mov	ax, ds
 15331 00006510 363B06[8C00]            		cmp	ax, [ss:UMB_HEAD]
 15332 00006515 EB03                    		jmp	short alloc_chk_end
 15333                                  ; ---------------------------------------------------------------------------
 15334                                  
 15335                                  norm_strat:				; ...
 15336 00006517 803D5A                  		cmp	byte [di], 5Ah ; 'Z'
 15337                                  
 15338                                  alloc_chk_end:				; ...
 15339 0000651A 740E                    		jz	short alloc_end
 15340 0000651C E856FF                  		call	arena_next
 15341 0000651F 73CA                    		jnb	short alloc_scan
 15342                                  
 15343                                  alloc_err:				; ...
 15344 00006521 58                      		pop	ax
 15345                                  
 15346                                  alloc_trashed:				; ...
 15347 00006522 E855AE                  		call	LCritDisk	; LCritMEM
 15348 00006525 B007                    		mov	al, 7
 15349                                  
 15350                                  alloc_errj:				; ...
 15351 00006527 E9F0A0                  		jmp	SYS_RET_ERR
 15352                                  ; ---------------------------------------------------------------------------
 15353                                  
 15354                                  alloc_end:				; ...
 15355 0000652A 36833E[4003]00          		cmp	word [ss:FirstArena], 0
 15356 00006530 7403                    		jz	short alloc_chk
 15357 00006532 E98400                  		jmp	alloc_do_split
 15358                                  ; ---------------------------------------------------------------------------
 15359                                  
 15360                                  alloc_chk:				; ...
 15361 00006535 36A1[2400]              		mov	ax, [ss:arena_head]
 15362 00006539 363B06[8E00]            		cmp	ax, [ss:START_ARENA]
 15363 0000653E 740E                    		jz	short alloc_fail
 15364 00006540 36F606[0203]40          		test	byte [ss:AllocMethod], 40h
 15365 00006546 7506                    		jnz	short alloc_fail
 15366 00006548 36A3[8E00]              		mov	[ss:START_ARENA], ax
 15367 0000654C EB94                    		jmp	short start_scan
 15368                                  ; ---------------------------------------------------------------------------
 15369                                  
 15370                                  alloc_fail:				; ...
 15371 0000654E E8519F                  		call	Get_User_Stack
 15372 00006551 5B                      		pop	bx
 15373 00006552 895C02                  		mov	[si+2],	bx
 15374 00006555 E822AE                  		call	LCritDisk	; LCritMEM
 15375 00006558 B008                    		mov	al, 8
 15376 0000655A EBCB                    		jmp	short alloc_errj
 15377                                  ; ---------------------------------------------------------------------------
 15378                                  
 15379                                  alloc_free:				; ...
 15380 0000655C E82DFF                  		call	Coalesce
 15381 0000655F 72C0                    		jb	short alloc_err
 15382 00006561 8B0E0300                		mov	cx, [3]
 15383 00006565 5A                      		pop	dx
 15384 00006566 39D1                    		cmp	cx, dx
 15385 00006568 7602                    		jbe	short alloc_test
 15386 0000656A 89CA                    		mov	dx, cx
 15387                                  
 15388                                  alloc_test:				; ...
 15389 0000656C 52                      		push	dx
 15390 0000656D 39CB                    		cmp	bx, cx
 15391 0000656F 7782                    		ja	short alloc_next
 15392 00006571 36833E[4003]00          		cmp	word [ss:FirstArena], 0
 15393 00006577 7505                    		jnz	short alloc_best
 15394 00006579 368C1E[4003]            		mov	word [ss:FirstArena], ds
 15395                                  
 15396                                  alloc_best:				; ...
 15397 0000657E 36833E[4203]00          		cmp	word [ss:BestArena], 0
 15398 00006584 740E                    		jz	short alloc_make_best
 15399 00006586 06                      		push	es
 15400 00006587 368E06[4203]            		mov	es, [ss:BestArena]
 15401 0000658C 26390E0300              		cmp	[es:3], cx
 15402 00006591 07                      		pop	es
 15403 00006592 7605                    		jbe	short alloc_last
 15404                                  
 15405                                  alloc_make_best:			; ...
 15406 00006594 368C1E[4203]            		mov	word [ss:BestArena], ds
 15407                                  
 15408                                  alloc_last:				; ...
 15409 00006599 368C1E[4403]            		mov	[ss:LastArena], ds
 15410 0000659E E952FF                  		jmp	alloc_next
 15411                                  ; ---------------------------------------------------------------------------
 15412                                  
 15413                                  alloc_do_split_high:			; ...
 15414 000065A1 368E1E[4403]            		mov	ds, [ss:LastArena]
 15415 000065A6 8B0E0300                		mov	cx, [3]
 15416 000065AA 29D9                    		sub	cx, bx
 15417 000065AC 8CDA                    		mov	dx, ds
 15418 000065AE 744C                    		jz	short alloc_set_owner
 15419 000065B0 01CA                    		add	dx, cx
 15420 000065B2 8EC2                    		mov	es, dx
 15421 000065B4 49                      		dec	cx
 15422 000065B5 87D9                    		xchg	bx, cx
 15423 000065B7 EB2E                    		jmp	short alloc_set_sizes
 15424                                  ; ---------------------------------------------------------------------------
 15425                                  
 15426                                  alloc_do_split:				; ...
 15427 000065B9 31C9                    		xor	cx, cx
 15428 000065BB 368A0E[0203]            		mov	cl, [ss:AllocMethod]
 15429 000065C0 81E13FFF                		and	cx, 0FF3Fh
 15430 000065C4 83F901                  		cmp	cx, 1
 15431 000065C7 77D8                    		ja	short alloc_do_split_high
 15432 000065C9 368E1E[4003]            		mov	ds, [ss:FirstArena]
 15433 000065CE 7205                    		jb	short alloc_get_size
 15434 000065D0 368E1E[4203]            		mov	ds, [ss:BestArena]
 15435                                  
 15436                                  alloc_get_size:				; ...
 15437 000065D5 8B0E0300                		mov	cx, [3]
 15438 000065D9 29D9                    		sub	cx, bx
 15439 000065DB 8CD8                    		mov	ax, ds
 15440 000065DD 89C2                    		mov	dx, ax
 15441 000065DF 741B                    		jz	short alloc_set_owner
 15442 000065E1 01D8                    		add	ax, bx
 15443 000065E3 40                      		inc	ax
 15444 000065E4 8EC0                    		mov	es, ax
 15445 000065E6 49                      		dec	cx
 15446                                  
 15447                                  alloc_set_sizes:			; ...
 15448 000065E7 891E0300                		mov	[3], bx
 15449 000065EB 26890E0300              		mov	[es:3], cx
 15450 000065F0 B34D                    		mov	bl, 4Dh	; 'M'
 15451 000065F2 861D                    		xchg	bl, [di]
 15452 000065F4 26881D                  		mov	[es:di], bl
 15453 000065F7 26893E0100              		mov	[es:1], di
 15454                                  
 15455                                  alloc_set_owner:			; ...
 15456 000065FC 8EDA                    		mov	ds, dx
 15457 000065FE 36A1[3003]              		mov	ax, [ss:CurrentPDB]
 15458 00006602 A30100                  		mov	[1], ax
 15459 00006605 8CD8                    		mov	ax, ds
 15460 00006607 40                      		inc	ax
 15461 00006608 5B                      		pop	bx
 15462 00006609 E86EAD                  		call	LCritDisk	; LCritMEM
 15463                                  
 15464                                  alloc_ok:				; ...
 15465 0000660C E902A0                  		jmp	SYS_RET_OK
 15466                                  
 15467                                  ; =============== S U B	R O U T	I N E =======================================
 15468                                  
 15469                                  
 15470                                  $SETBLOCK:
 15471 0000660F E848AD                  		call	ECritDisk	; ECritMEM
 15472 00006612 BF0000                  		mov	di, 0
 15473 00006615 8CC0                    		mov	ax, es
 15474 00006617 48                      		dec	ax
 15475 00006618 E861FE                  		call	check_signature
 15476 0000661B 7303                    		jnb	short setblock_grab
 15477                                  
 15478                                  setblock_bad:				; ...
 15479 0000661D E902FF                  		jmp	alloc_trashed
 15480                                  ; ---------------------------------------------------------------------------
 15481                                  
 15482                                  setblock_grab:				; ...
 15483 00006620 8ED8                    		mov	ds, ax
 15484 00006622 E867FE                  		call	Coalesce
 15485 00006625 72F6                    		jb	short setblock_bad
 15486 00006627 8B0E0300                		mov	cx, [3]
 15487 0000662B 51                      		push	cx
 15488 0000662C 39CB                    		cmp	bx, cx
 15489 0000662E 76A5                    		jbe	short alloc_get_size
 15490 00006630 E91BFF                  		jmp	alloc_fail
 15491                                  
 15492                                  ; =============== S U B	R O U T	I N E =======================================
 15493                                  
 15494                                  
 15495                                  $DEALLOC:
 15496 00006633 E824AD                  		call	ECritDisk	; ECritMEM
 15497 00006636 36F606[8600]04          		test	byte [ss:DOS_FLAG], 4 ; EXECA20OFF
 15498 0000663C 740E                    		jz	short deallocate
 15499 0000663E 36803E[8500]00          		cmp	byte [ss:A20OFF_COUNT], 0
 15500 00006644 7506                    		jnz	short deallocate
 15501 00006646 36C606[8500]01          		mov	byte [ss:A20OFF_COUNT], 1
 15502                                  
 15503                                  deallocate:				; ...
 15504 0000664C BF0000                  		mov	di, 0
 15505 0000664F 8CC0                    		mov	ax, es
 15506 00006651 48                      		dec	ax
 15507 00006652 E827FE                  		call	check_signature
 15508 00006655 720A                    		jb	short dealloc_err
 15509 00006657 26893E0100              		mov	[es:1], di
 15510 0000665C E81BAD                  		call	LCritDisk	; LCritMEM
 15511                                  
 15512                                  dealloc_ok:				; ...
 15513 0000665F EBAB                    		jmp	short alloc_ok
 15514                                  ; ---------------------------------------------------------------------------
 15515                                  
 15516                                  dealloc_err:				; ...
 15517 00006661 E816AD                  		call	LCritDisk	; LCritMEM
 15518 00006664 B009                    		mov	al, 9
 15519                                  
 15520                                  dealloc_errj:				; ...
 15521 00006666 E9B19F                  		jmp	SYS_RET_ERR
 15522                                  
 15523                                  ; ---------------------------------------------------------------------------
 15524                                  
 15525                                  $ALLOCOPER:				; ...
 15526 00006669 08C0                    		or	al, al
 15527 0000666B 7420                    		jz	short AllocGetStrat
 15528 0000666D 3C01                    		cmp	al, 1
 15529 0000666F 7424                    		jz	short AllocSetStrat
 15530 00006671 3C02                    		cmp	al, 2
 15531 00006673 7432                    		jz	short AllocGetLink
 15532 00006675 3C03                    		cmp	al, 3
 15533 00006677 7436                    		jz	short AllocSetLink
 15534                                  
 15535                                  AllocOperError:				; ...
 15536 00006679 36C606[2303]05          		mov	byte [ss:EXTERR_LOCUS], 5
 15537 0000667F B001                    		mov	al, 1
 15538                                  
 15539                                  AllocOperErrj:				; ...
 15540 00006681 EBE3                    		jmp	short dealloc_errj
 15541                                  ; ---------------------------------------------------------------------------
 15542                                  
 15543                                  AllocArenaError:			; ...
 15544 00006683 36C606[2303]05          		mov	byte [ss:EXTERR_LOCUS], 5
 15545 00006689 B007                    		mov	al, 7
 15546 0000668B EBF4                    		jmp	short AllocOperErrj
 15547                                  ; ---------------------------------------------------------------------------
 15548                                  
 15549                                  AllocGetStrat:				; ...
 15550 0000668D 36A0[0203]              		mov	al, [ss:AllocMethod]
 15551 00006691 30E4                    		xor	ah, ah
 15552                                  
 15553                                  AllocOperOK:				; ...
 15554 00006693 EBCA                    		jmp	short dealloc_ok
 15555                                  ; ---------------------------------------------------------------------------
 15556                                  
 15557                                  AllocSetStrat:				; ...
 15558 00006695 53                      		push	bx
 15559 00006696 81E33FFF                		and	bx, 0FF3Fh
 15560 0000669A 83FB02                  		cmp	bx, 2
 15561 0000669D 5B                      		pop	bx
 15562 0000669E 77D9                    		ja	short AllocOperError
 15563                                  
 15564                                  AllocOperSet:
 15565 000066A0 36881E[0203]            		mov	byte [ss:AllocMethod], bl
 15566                                  
 15567                                  AllocOperSetOK:				; ...
 15568 000066A5 EBEC                    		jmp	short AllocOperOK
 15569                                  ; ---------------------------------------------------------------------------
 15570                                  
 15571                                  AllocGetLink:				; ...
 15572 000066A7 36A0[8900]              		mov	al, [ss:UMBFLAG]
 15573 000066AB 2401                    		and	al, 1
 15574                                  
 15575                                  AllocGetLinkOK:				; ...
 15576 000066AD EBF6                    		jmp	short AllocOperSetOK
 15577                                  ; ---------------------------------------------------------------------------
 15578                                  
 15579                                  AllocSetLink:				; ...
 15580 000066AF 368B0E[8C00]            		mov	cx, [ss:UMB_HEAD]
 15581 000066B4 83F9FF                  		cmp	cx, 0FFFFh
 15582 000066B7 74C0                    		jz	short AllocOperError
 15583 000066B9 83FB01                  		cmp	bx, 1
 15584 000066BC 7204                    		jb	short UnlinkUmbs
 15585 000066BE 741C                    		jz	short LinkUmbs
 15586 000066C0 EBB7                    		jmp	short AllocOperError
 15587                                  ; ---------------------------------------------------------------------------
 15588                                  
 15589                                  UnlinkUmbs:				; ...
 15590 000066C2 36F606[8900]01          		test	byte [ss:UMBFLAG], 1
 15591 000066C8 7410                    		jz	short unlinked
 15592 000066CA E82900                  		call	GetLastArena
 15593 000066CD 72B4                    		jb	short AllocArenaError
 15594 000066CF C60600005A              		mov	byte [0], 5Ah ; 'Z'
 15595 000066D4 368026[8900]FE          		and	byte [ss:UMBFLAG], 0FEh
 15596                                  
 15597                                  unlinked:				; ...
 15598 000066DA EBD1                    		jmp	short AllocGetLinkOK
 15599                                  ; ---------------------------------------------------------------------------
 15600                                  
 15601                                  LinkUmbs:				; ...
 15602 000066DC 36F606[8900]01          		test	byte [ss:UMBFLAG], 1
 15603 000066E2 7510                    		jnz	short linked
 15604 000066E4 E80F00                  		call	GetLastArena
 15605 000066E7 729A                    		jb	short AllocArenaError
 15606 000066E9 C60600004D              		mov	byte [0], 4Dh ; 'M'
 15607 000066EE 36800E[8900]01          		or	byte [ss:UMBFLAG], 1
 15608                                  
 15609                                  linked:					; ...
 15610 000066F4 EBE4                    		jmp	short unlinked
 15611                                  
 15612                                  ; =============== S U B	R O U T	I N E =======================================
 15613                                  
 15614                                  
 15615                                  GetLastArena:
 15616 000066F6 50                      		push	ax
 15617 000066F7 36A1[2400]              		mov	ax, [ss:arena_head]
 15618 000066FB 8EC0                    		mov	es, ax
 15619 000066FD 31FF                    		xor	di, di
 15620 000066FF 26803D5A                		cmp	byte [es:di], 5Ah ;	'Z'
 15621 00006703 7419                    		jz	short GLA_done
 15622                                  
 15623                                  GLA_next:				; ...
 15624 00006705 8ED8                    		mov	ds, ax
 15625 00006707 E86BFD                  		call	arena_next
 15626 0000670A 7228                    		jb	short GLA_err
 15627 0000670C 36F606[8900]01          		test	byte [ss:UMBFLAG], 1
 15628 00006712 7506                    		jnz	short GLA_chkumb
 15629 00006714 26803D5A                		cmp	byte [es:di], 5Ah ;	'Z'
 15630 00006718 EB02                    		jmp	short GLA_@f
 15631                                  ; ---------------------------------------------------------------------------
 15632                                  
 15633                                  GLA_chkumb:				; ...
 15634 0000671A 39C8                    		cmp	ax, cx
 15635                                  
 15636                                  GLA_@f:					; ...
 15637 0000671C 75E7                    		jnz	short GLA_next
 15638                                  
 15639                                  GLA_done:				; ...
 15640 0000671E 36F606[8900]01          		test	byte [ss:UMBFLAG], 1
 15641 00006724 750B                    		jnz	short GLA_ret
 15642 00006726 8ED8                    		mov	ds, ax
 15643 00006728 E84AFD                  		call	arena_next
 15644 0000672B 7207                    		jb	short GLA_err
 15645 0000672D 39C8                    		cmp	ax, cx
 15646 0000672F 7503                    		jnz	short GLA_err
 15647                                  
 15648                                  GLA_ret:				; ...
 15649 00006731 F8                      		clc
 15650 00006732 58                      		pop	ax
 15651 00006733 C3                      		retn
 15652                                  ; ---------------------------------------------------------------------------
 15653                                  
 15654                                  GLA_err:				; ...
 15655 00006734 F9                      		stc
 15656 00006735 58                      		pop	ax
 15657 00006736 C3                      		retn
 15658                                  
 15659                                  ; ---------------------------------------------------------------------------
 15660 00006737 [3B67]                  SERVERTAB:	dw SERVER_DISP	; ...
 15661 00006739 [8D67]                  SERVERLEAVE:	dw SERVERRETURN	; ...
 15662 0000673B 0B                      SERVER_DISP:	db 11			; ...
 15663 0000673C [F667]                  		dw SRV_CALL
 15664 0000673E [8E67]                  		dw COMMIT_ALL
 15665 00006740 [C567]                  		dw CLOSE_NAME
 15666 00006742 [D067]                  		dw CLOSE_UID
 15667 00006744 [D767]                  		dw CLOSE_UID_PID
 15668 00006746 [DE67]                  		dw GET_LIST
 15669 00006748 [3768]                  		dw GET_DOS_DATA
 15670 0000674A [5B68]                  		dw SPOOL_OPER
 15671 0000674C [5B68]                  		dw SPOOL_OPER
 15672 0000674E [5B68]                  		dw SPOOL_OPER
 15673 00006750 [6968]                  		dw _$SetExtendedError
 15674                                  ; ---------------------------------------------------------------------------
 15675                                  
 15676                                  $ServerCall:				; ...
 15677 00006752 3C07                    		cmp	al, 7
 15678 00006754 7204                    		jb	short SET_STUFF
 15679 00006756 3C09                    		cmp	al, 9
 15680 00006758 761A                    		jbe	short NO_SET_ID
 15681                                  
 15682                                  SET_STUFF:				; ...
 15683 0000675A 89D6                    		mov	si, dx
 15684 0000675C 8B5C12                  		mov	bx, [si+12h]
 15685 0000675F 36F606[3010]01          		test	byte [ss:IsWin386], 1
 15686 00006765 7505                    		jnz	short skip_win386
 15687 00006767 36891E[3E03]            		mov	[ss:USER_ID], bx
 15688                                  
 15689                                  skip_win386:				; ...
 15690 0000676C 8B5C14                  		mov	bx, [si+14h]
 15691 0000676F 36891E[3C03]            		mov	[ss:PROC_ID], bx
 15692                                  
 15693                                  NO_SET_ID:				; ...
 15694 00006774 2EFF36[3967]            		push	word [cs:SERVERLEAVE]
 15695 00006779 2EFF36[3767]            		push	word [cs:SERVERTAB]
 15696 0000677E 50                      		push	ax
 15697 0000677F E8E8AA                  		call	TableDispatch
 15698 00006782 36C606[2303]01          		mov	byte [ss:EXTERR_LOCUS], 1
 15699 00006788 B001                    		mov	al, 1
 15700                                  
 15701                                  servercall_error:			; ...
 15702 0000678A E98D9E                  		jmp	SYS_RET_ERR
 15703                                  ; ---------------------------------------------------------------------------
 15704                                  
 15705                                  SERVERRETURN:				; ...
 15706 0000678D C3                      		retn
 15707                                  ; ---------------------------------------------------------------------------
 15708                                  
 15709                                  COMMIT_ALL:				; ...
 15710 0000678E 31DB                    		xor	bx, bx
 15711 00006790 16                      		push	ss
 15712 00006791 1F                      		pop	ds
 15713 00006792 E8C5AB                  		call	ECritDisk
 15714                                  
 15715                                  CommitLoop:				; ...
 15716 00006795 53                      		push	bx
 15717 00006796 E82B01                  		call	SFFromSFN
 15718 00006799 7223                    		jb	short CommitDone
 15719 0000679B 26833D00                		cmp	word [es:di], 0
 15720 0000679F 7419                    		jz	short CommitNext
 15721 000067A1 26833DFF                		cmp	word [es:di], 0FFFFh
 15722 000067A5 7413                    		jz	short CommitNext
 15723 000067A7 26F745050080            		test	word [es:di+5], 8000h
 15724 000067AD 750B                    		jnz	short CommitNext
 15725 000067AF 893E[9E05]              		mov	word [THISSFT], di
 15726 000067B3 8C06[A005]              		mov	word [THISSFT+2], es
 15727 000067B7 E8ECC9                  		call	DOS_COMMIT
 15728                                  
 15729                                  CommitNext:				; ...
 15730 000067BA 5B                      		pop	bx
 15731 000067BB 43                      		inc	bx
 15732 000067BC EBD7                    		jmp	short CommitLoop
 15733                                  ; ---------------------------------------------------------------------------
 15734                                  
 15735                                  CommitDone:				; ...
 15736 000067BE E8B9AB                  		call	LCritDisk	; LCritSFT
 15737 000067C1 5B                      		pop	bx
 15738                                  
 15739                                  jmp_to_SYS_RET_OK:			; ...
 15740 000067C2 E94C9E                  		jmp	SYS_RET_OK
 15741                                  ; ---------------------------------------------------------------------------
 15742                                  
 15743                                  CLOSE_NAME:				; ...
 15744 000067C5 36FF1E[A400]            		call	far [ss:MFTCloN]
 15745                                  
 15746                                  CheckReturns:				; ...
 15747 000067CA 7202                    		jb	short func_err
 15748                                  
 15749                                  jmp_to_jmp_to_SYS_RET_OK:		; ...
 15750 000067CC EBF4                    		jmp	short jmp_to_SYS_RET_OK
 15751                                  ; ---------------------------------------------------------------------------
 15752                                  
 15753                                  func_err:				; ...
 15754 000067CE EBBA                    		jmp	short servercall_error
 15755                                  ; ---------------------------------------------------------------------------
 15756                                  
 15757                                  CLOSE_UID:				; ...
 15758 000067D0 36FF1E[9C00]            		call	far [ss:MFTclU]
 15759 000067D5 EBF3                    		jmp	short CheckReturns
 15760                                  ; ---------------------------------------------------------------------------
 15761                                  
 15762                                  CLOSE_UID_PID:				; ...
 15763 000067D7 36FF1E[A000]            		call	far [ss:MFTCloseP]
 15764 000067DC EBEC                    		jmp	short CheckReturns
 15765                                  ; ---------------------------------------------------------------------------
 15766                                  
 15767                                  GET_LIST:				; ...
 15768 000067DE 36FF1E[B400]            		call	far [ss:MFT_get]
 15769 000067E3 72E9                    		jb	short func_err
 15770 000067E5 E8BA9C                  		call	Get_User_Stack
 15771 000067E8 895C02                  		mov	[si+2],	bx
 15772 000067EB 897C0A                  		mov	[si+0Ah], di
 15773 000067EE 8C4410                  		mov	word [si+10h], es
 15774                                  
 15775                                  SetCXOK:				; ...
 15776 000067F1 894C04                  		mov	[si+4],	cx
 15777                                  
 15778                                  third_jmp_short_SYS_RET_OK:		; ...
 15779 000067F4 EBD6                    		jmp	short jmp_to_jmp_to_SYS_RET_OK
 15780                                  ; ---------------------------------------------------------------------------
 15781                                  
 15782                                  SRV_CALL:				; ...
 15783 000067F6 58                      		pop	ax
 15784 000067F7 1E                      		push	ds
 15785 000067F8 56                      		push	si
 15786 000067F9 E8A69C                  		call	Get_User_Stack
 15787 000067FC 5F                      		pop	di
 15788 000067FD 07                      		pop	es
 15789 000067FE E848AA                  		call	XCHGP
 15790 00006801 56                      		push	si
 15791 00006802 B90600                  		mov	cx, 6
 15792 00006805 F3A5                    		rep movsw
 15793 00006807 47                      		inc	di
 15794 00006808 47                      		inc	di
 15795 00006809 A5                      		movsw
 15796 0000680A A5                      		movsw
 15797 0000680B 5E                      		pop	si
 15798 0000680C 8B04                    		mov	ax, [si]
 15799 0000680E 8B5C02                  		mov	bx, [si+2]
 15800 00006811 8B4C04                  		mov	cx, [si+4]
 15801 00006814 8B5406                  		mov	dx, [si+6]
 15802 00006817 8B7C0A                  		mov	di, [si+0Ah]
 15803 0000681A 8E440E                  		mov	es, word [si+0Eh]
 15804 0000681D FF7408                  		push	word [si+8]
 15805 00006820 8E5C0C                  		mov	ds, word [si+0Ch]
 15806 00006823 5E                      		pop	si
 15807 00006824 368C1E[EC05]            		mov	[ss:SAVEDS], ds
 15808 00006829 36891E[EA05]            		mov	[ss:SAVEBX], bx
 15809 0000682E 36C606[7205]FF          		mov	byte [ss:FSHARING], 0FFh
 15810 00006834 E9599B                  		jmp	REDISP
 15811                                  ; ---------------------------------------------------------------------------
 15812                                  
 15813                                  GET_DOS_DATA:				; ...
 15814 00006837 16                      		push	ss
 15815 00006838 07                      		pop	es
 15816 00006839 BF[2003]                		mov	di, ERRORMODE ; SWAP_START
 15817 0000683C B9[AC0A]                		mov	cx, SWAP_END
 15818 0000683F BA[3A03]                		mov	dx, USER_IN_AX ;	SWAP_ALWAYS
 15819 00006842 29F9                    		sub	cx, di
 15820 00006844 29FA                    		sub	dx, di
 15821 00006846 D1E9                    		shr	cx, 1
 15822 00006848 83D100                  		adc	cx, 0
 15823 0000684B D1E1                    		shl	cx, 1
 15824 0000684D E8529C                  		call	Get_User_Stack
 15825 00006850 8C440E                  		mov	word [si+0Eh], es
 15826 00006853 897C08                  		mov	[si+8],	di
 15827 00006856 895406                  		mov	[si+6],	dx
 15828 00006859 EB96                    		jmp	short SetCXOK
 15829                                  ; ---------------------------------------------------------------------------
 15830                                  
 15831                                  SPOOL_OPER:				; ...
 15832 0000685B 50                      		push	ax
 15833 0000685C B82511                  		mov	ax, 1125h
 15834 0000685F CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - REDIRECTED PRINTER MODE
 15835                                  					; STACK: WORD subfunction
 15836                                  					; Return: CF set on error, AX =	error code
 15837                                  					; STACK	unchanged
 15838 00006861 5B                      		pop	bx
 15839 00006862 7202                    		jb	short func_err2
 15840 00006864 EB8E                    		jmp	short third_jmp_short_SYS_RET_OK
 15841                                  ; ---------------------------------------------------------------------------
 15842                                  
 15843                                  func_err2:				; ...
 15844 00006866 E9B19D                  		jmp	SYS_RET_ERR
 15845                                  ; ---------------------------------------------------------------------------
 15846                                  
 15847                                  _$SetExtendedError:			; ...
 15848 00006869 8B04                    		mov	ax, [si]
 15849 0000686B 36A3[2403]              		mov	word [ss:EXTERR], ax
 15850 0000686F 8B440A                  		mov	ax, [si+0Ah]
 15851 00006872 36A3[2803]              		mov	word [ss:EXTERRPT], ax
 15852 00006876 8B440E                  		mov	ax, [si+0Eh]
 15853 00006879 36A3[2A03]              		mov	word [ss:EXTERRPT+2], ax
 15854 0000687D 8B4402                  		mov	ax, [si+2]
 15855 00006880 36A3[2603]              		mov	[ss:EXTERR_ACT_CLASS], ax
 15856 00006884 8B4404                  		mov	ax, [si+4]
 15857 00006887 368826[2303]            		mov	byte [ss:EXTERR_LOCUS], ah
 15858 0000688C C3                      		retn
 15859                                  
 15860                                  ; =============== S U B	R O U T	I N E =======================================
 15861                                  
 15862                                  
 15863                                  pJFNFromHandle:
 15864 0000688D 2E8E06[0700]            		mov	es, [cs:DosDSeg]
 15865 00006892 268E06[3003]            		mov	es, [es:CurrentPDB]
 15866 00006897 263B1E3200              		cmp	bx, [es:32h]	; [ES:PDB.JFN_Length]
 15867 0000689C 7204                    		jb	short pjfn10
 15868 0000689E B006                    		mov	al, 6
 15869                                  
 15870                                  ReturnCarry:				; ...
 15871 000068A0 F9                      		stc
 15872 000068A1 C3                      		retn
 15873                                  ; ---------------------------------------------------------------------------
 15874                                  
 15875                                  pjfn10:					; ...
 15876 000068A2 26C43E3400              		les	di, [es:34h]	; [ES:PDB.JFN_Pointer]
 15877 000068A7 01DF                    		add	di, bx
 15878                                  
 15879                                  pJFNFromHandle_error:			; ...
 15880 000068A9 C3                      		retn
 15881                                  
 15882                                  ; =============== S U B	R O U T	I N E =======================================
 15883                                  
 15884                                  
 15885                                  SFFromHandle:
 15886 000068AA E8E0FF                  		call	pJFNFromHandle
 15887 000068AD 72FA                    		jb	short pJFNFromHandle_error
 15888 000068AF 26803DFF                		cmp	byte [es:di], 0FFh
 15889 000068B3 7504                    		jnz	short GetSF
 15890 000068B5 B006                    		mov	al, 6
 15891 000068B7 EBE7                    		jmp	short ReturnCarry
 15892                                  ; ---------------------------------------------------------------------------
 15893                                  
 15894                                  GetSF:					; ...
 15895 000068B9 53                      		push	bx
 15896 000068BA 268A1D                  		mov	bl, [es:di]
 15897 000068BD 30FF                    		xor	bh, bh
 15898 000068BF E80200                  		call	SFFromSFN
 15899 000068C2 5B                      		pop	bx
 15900 000068C3 C3                      		retn
 15901                                  
 15902                                  ; =============== S U B	R O U T	I N E =======================================
 15903                                  
 15904                                  
 15905                                  SFFromSFN:
 15906 000068C4 2E8E06[0700]            		mov	es, [cs:DosDSeg]
 15907 000068C9 26C43E[2A00]            		les	di, [es:SFT_ADDR]
 15908                                  
 15909                                  sfsfn5:					; ...
 15910 000068CE 263B5D04                		cmp	bx, [es:di+4]
 15911 000068D2 720E                    		jb	short sfsfn7
 15912 000068D4 262B5D04                		sub	bx, [es:di+4]
 15913 000068D8 26C43D                  		les	di, [es:di]
 15914 000068DB 83FFFF                  		cmp	di, 0FFFFh
 15915 000068DE 75EE                    		jnz	short sfsfn5
 15916 000068E0 F9                      		stc
 15917 000068E1 C3                      		retn
 15918                                  ; ---------------------------------------------------------------------------
 15919                                  
 15920                                  sfsfn7:					; ...
 15921 000068E2 50                      		push	ax
 15922 000068E3 B83B00                  		mov	ax, 59		; SF_ENTRY.size
 15923 000068E6 F6E3                    		mul	bl
 15924 000068E8 01C7                    		add	di, ax
 15925 000068EA 58                      		pop	ax
 15926 000068EB 83C706                  		add	di, 6
 15927 000068EE C3                      		retn			; SFT.SFTable
 15928                                  
 15929                                  ; =============== S U B	R O U T	I N E =======================================
 15930                                  
 15931                                  
 15932                                  JFNFree	:
 15933 000068EF 31DB                    		xor	bx, bx
 15934                                  
 15935                                  jfnf1:					; ...
 15936 000068F1 E899FF                  		call	pJFNFromHandle
 15937 000068F4 7209                    		jb	short jfnf5
 15938 000068F6 26803DFF                		cmp	byte [es:di], 0FFh
 15939 000068FA 7405                    		jz	short jfnfx
 15940 000068FC 43                      		inc	bx
 15941 000068FD EBF2                    		jmp	short jfnf1
 15942                                  ; ---------------------------------------------------------------------------
 15943                                  
 15944                                  jfnf5:					; ...
 15945 000068FF B004                    		mov	al, 4
 15946                                  
 15947                                  jfnfx:					; ...
 15948 00006901 C3                      		retn
 15949                                  
 15950                                  ; =============== S U B	R O U T	I N E =======================================
 15951                                  
 15952                                  
 15953                                  SFNFree	:
 15954 00006902 50                      		push	ax
 15955 00006903 31DB                    		xor	bx, bx
 15956                                  
 15957                                  sfnf5:					; ...
 15958 00006905 53                      		push	bx
 15959 00006906 E8BBFF                  		call	SFFromSFN
 15960 00006909 5B                      		pop	bx
 15961 0000690A 723B                    		jb	short sfnf95
 15962 0000690C 26833D00                		cmp	word [es:di], 0
 15963 00006910 741D                    		jz	short sfnf20
 15964 00006912 26833DFF                		cmp	word [es:di], 0FFFFh
 15965 00006916 7403                    		jz	short sfnf10
 15966                                  
 15967                                  sfnf7:					; ...
 15968 00006918 43                      		inc	bx
 15969 00006919 EBEA                    		jmp	short sfnf5
 15970                                  ; ---------------------------------------------------------------------------
 15971                                  
 15972                                  sfnf10:					; ...
 15973 0000691B 36A1[3E03]              		mov	ax, [ss:USER_ID]
 15974 0000691F 2639452F                		cmp	[es:di+2Fh], ax
 15975 00006923 75F3                    		jnz	short sfnf7
 15976 00006925 36A1[3C03]              		mov	ax, [ss:PROC_ID]
 15977 00006929 26394531                		cmp	[es:di+31h], ax
 15978 0000692D 75E9                    		jnz	short sfnf7
 15979                                  
 15980                                  sfnf20:					; ...
 15981 0000692F 26C705FFFF              		mov	word [es:di], 0FFFFh
 15982 00006934 36A1[3E03]              		mov	ax, [ss:USER_ID]
 15983 00006938 2689452F                		mov	[es:di+2Fh], ax
 15984 0000693C 36A1[3C03]              		mov	ax, [ss:PROC_ID]
 15985 00006940 26894531                		mov	[es:di+31h], ax
 15986 00006944 58                      		pop	ax
 15987 00006945 F8                      		clc
 15988 00006946 C3                      		retn
 15989                                  ; ---------------------------------------------------------------------------
 15990                                  
 15991                                  sfnf95:					; ...
 15992 00006947 58                      		pop	ax
 15993 00006948 B004                    		mov	al, 4
 15994 0000694A C3                      		retn
 15995                                  
 15996                                  ; =============== S U B	R O U T	I N E =======================================
 15997                                  
 15998                                  
 15999                                  $CLOSE:
 16000 0000694B E85B02                  		call	CheckOwner
 16001 0000694E 722B                    		jb	short CloseError
 16002 00006950 16                      		push	ss
 16003 00006951 1F                      		pop	ds
 16004 00006952 893E[9E05]              		mov	word [THISSFT], di
 16005 00006956 8C06[A005]              		mov	word [THISSFT+2], es
 16006 0000695A 26833D01                		cmp	word [es:di], 1
 16007 0000695E 740A                    		jz	short FreeJFN
 16008 00006960 268A4502                		mov	al, [es:di+2]
 16009 00006964 24F0                    		and	al, 0F0h
 16010 00006966 3C70                    		cmp	al, 70h
 16011 00006968 7407                    		jz	short PostFree
 16012                                  
 16013                                  FreeJFN:				; ...
 16014 0000696A E820FF                  		call	pJFNFromHandle
 16015 0000696D 26C605FF                		mov	byte [es:di], 0FFh
 16016                                  
 16017                                  PostFree:				; ...
 16018 00006971 E8DAC6                  		call	DOS_CLOSE
 16019 00006974 7205                    		jb	short CloseError
 16020 00006976 B43E                    		mov	ah, 3Eh
 16021                                  
 16022                                  Close_OK:				; ...
 16023 00006978 E9969C                  		jmp	SYS_RET_OK
 16024                                  ; ---------------------------------------------------------------------------
 16025                                  
 16026                                  CloseError:				; ...
 16027 0000697B E99C9C                  		jmp	SYS_RET_ERR
 16028                                  
 16029                                  ; ---------------------------------------------------------------------------
 16030                                  
 16031                                  $COMMIT:				; ...
 16032 0000697E E82802                  		call	CheckOwner
 16033 00006981 7213                    		jb	short CommitError
 16034 00006983 16                      		push	ss
 16035 00006984 1F                      		pop	ds
 16036 00006985 893E[9E05]              		mov	word [THISSFT], di
 16037 00006989 8C06[A005]              		mov	word [THISSFT+2], es
 16038 0000698D E816C8                  		call	DOS_COMMIT
 16039 00006990 7204                    		jb	short CommitError
 16040 00006992 B468                    		mov	ah, 68h
 16041                                  ; START	OF FUNCTION CHUNK FOR $READ
 16042                                  
 16043                                  CommitOk:				; ...
 16044 00006994 EBE2                    		jmp	short Close_OK
 16045                                  ; ---------------------------------------------------------------------------
 16046                                  
 16047                                  CommitError:				; ...
 16048 00006996 EBE3                    		jmp	short CloseError
 16049                                  ; END OF FUNCTION CHUNK	FOR $READ
 16050                                  ; ---------------------------------------------------------------------------
 16051                                  
 16052                                  $ExtHandle:				; ...
 16053 00006998 31ED                    		xor	bp, bp
 16054 0000699A 83FB14                  		cmp	bx, 20
 16055 0000699D 7303                    		jnb	short exth2
 16056 0000699F BB1400                  		mov	bx, 20		; FILPERPROC
 16057                                  
 16058                                  exth2:					; ...
 16059 000069A2 368E06[3003]            		mov	es, [ss:CurrentPDB]
 16060 000069A7 268B0E3200              		mov	cx, [es:32h]	; [ES:PDB.JFN_Length]
 16061 000069AC 39CB                    		cmp	bx, cx
 16062 000069AE 7450                    		jz	short ok_done
 16063 000069B0 7722                    		ja	short larger
 16064 000069B2 BD0100                  		mov	bp, 1
 16065 000069B5 268E1E3600              		mov	ds, word [es:36h] ; [ES:PDB.JFN_Pointer+2]
 16066 000069BA 89DE                    		mov	si, bx
 16067 000069BC 29D9                    		sub	cx, bx
 16068                                  
 16069                                  chck_handles:				; ...
 16070 000069BE 803CFF                  		cmp	byte [si], 0FFh
 16071 000069C1 753F                    		jnz	short too_many_files
 16072 000069C3 46                      		inc	si
 16073 000069C4 E2F8                    		loop	chck_handles
 16074 000069C6 83FB14                  		cmp	bx, 20
 16075 000069C9 7709                    		ja	short larger
 16076 000069CB BD0200                  		mov	bp, 2
 16077 000069CE BF1800                  		mov	di, 24		; PDB.JFN_TABLE
 16078 000069D1 53                      		push	bx
 16079 000069D2 EB1D                    		jmp	short movhandl
 16080                                  ; ---------------------------------------------------------------------------
 16081                                  
 16082                                  larger:					; ...
 16083 000069D4 83FBFF                  		cmp	bx, 0FFFFh
 16084 000069D7 747D                    		jz	short invalid_func
 16085 000069D9 F8                      		clc
 16086 000069DA 53                      		push	bx
 16087 000069DB 83C30F                  		add	bx, 0Fh
 16088 000069DE B104                    		mov	cl, 4
 16089 000069E0 D3DB                    		rcr	bx, cl
 16090 000069E2 81E3FF1F                		and	bx, 1FFFh
 16091 000069E6 55                      		push	bp
 16092 000069E7 E8C4FA                  		call	$ALLOC
 16093 000069EA 5D                      		pop	bp
 16094 000069EB 7264                    		jb	short no_memory
 16095 000069ED 8EC0                    		mov	es, ax
 16096 000069EF 31FF                    		xor	di, di
 16097                                  
 16098                                  movhandl:				; ...
 16099 000069F1 368E1E[3003]            		mov	ds, [ss:CurrentPDB]
 16100 000069F6 F7C50300                		test	bp, 3
 16101 000069FA 740A                    		jz	short enlarge
 16102 000069FC 59                      		pop	cx
 16103 000069FD 51                      		push	cx
 16104 000069FE EB0A                    		jmp	short copy_hand
 16105                                  ; ---------------------------------------------------------------------------
 16106                                  ; START	OF FUNCTION CHUNK FOR $READ
 16107                                  
 16108                                  ok_done:				; ...
 16109 00006A00 EB92                    		jmp	short CommitOk
 16110                                  ; END OF FUNCTION CHUNK	FOR $READ
 16111                                  ; ---------------------------------------------------------------------------
 16112                                  
 16113                                  too_many_files:				; ...
 16114 00006A02 B004                    		mov	al, 4
 16115                                  ; START	OF FUNCTION CHUNK FOR $READ
 16116                                  
 16117                                  CommitErrorj:				; ...
 16118 00006A04 EB90                    		jmp	short CommitError
 16119                                  ; END OF FUNCTION CHUNK	FOR $READ
 16120                                  ; ---------------------------------------------------------------------------
 16121                                  
 16122                                  enlarge:				; ...
 16123 00006A06 8B0E3200                		mov	cx, [32h]	; [PDB.JFN_Length]
 16124                                  
 16125                                  copy_hand:				; ...
 16126 00006A0A 89CA                    		mov	dx, cx
 16127 00006A0C C5363400                		lds	si, [34h]
 16128 00006A10 F3A4                    		rep movsb
 16129 00006A12 59                      		pop	cx
 16130 00006A13 51                      		push	cx
 16131 00006A14 29D1                    		sub	cx, dx
 16132 00006A16 B0FF                    		mov	al, 0FFh
 16133 00006A18 F3AA                    		rep stosb
 16134 00006A1A 368E1E[3003]            		mov	ds, [ss:CurrentPDB]
 16135 00006A1F 833E340000              		cmp	word [34h], 0 ; [PDB.JFN_Pointer]
 16136 00006A24 750D                    		jnz	short update_info
 16137 00006A26 55                      		push	bp
 16138 00006A27 1E                      		push	ds
 16139 00006A28 06                      		push	es
 16140 00006A29 8E063600                		mov	es, word [36h]	; [PDB.JFN_Pointer+2]
 16141 00006A2D E803FC                  		call	$DEALLOC
 16142 00006A30 07                      		pop	es
 16143 00006A31 1F                      		pop	ds
 16144 00006A32 5D                      		pop	bp
 16145                                  
 16146                                  update_info:				; ...
 16147 00006A33 F7C50200                		test	bp, 2
 16148 00006A37 7408                    		jz	short non_psp
 16149 00006A39 C70634001800            		mov	word [34h], 18h ; 24
 16150 00006A3F EB06                    		jmp	short final
 16151                                  ; ---------------------------------------------------------------------------
 16152                                  
 16153                                  non_psp:				; ...
 16154 00006A41 C70634000000            		mov	word [34h], 0
 16155                                  
 16156                                  final:					; ...
 16157 00006A47 8C063600                		mov	word [36h], es
 16158 00006A4B 8F063200                		pop	word [32h]
 16159                                  ; START	OF FUNCTION CHUNK FOR $READ
 16160                                  
 16161                                  ExtHandle_OK:				; ...
 16162 00006A4F EBAF                    		jmp	short ok_done
 16163                                  ; END OF FUNCTION CHUNK	FOR $READ
 16164                                  ; ---------------------------------------------------------------------------
 16165                                  
 16166                                  no_memory:				; ...
 16167 00006A51 5B                      		pop	bx
 16168 00006A52 B008                    		mov	al, 8
 16169                                  ; START	OF FUNCTION CHUNK FOR $READ
 16170                                  
 16171                                  CommitErrorj2:				; ...
 16172 00006A54 EBAE                    		jmp	short CommitErrorj
 16173                                  ; END OF FUNCTION CHUNK	FOR $READ
 16174                                  ; ---------------------------------------------------------------------------
 16175                                  
 16176                                  invalid_func:				; ...
 16177 00006A56 B001                    		mov	al, 1
 16178                                  ; START	OF FUNCTION CHUNK FOR $READ
 16179                                  
 16180                                  CommitErrorj3:				; ...
 16181 00006A58 EBFA                    		jmp	short CommitErrorj2
 16182                                  ; END OF FUNCTION CHUNK	FOR $READ
 16183                                  
 16184                                  ; =============== S U B	R O U T	I N E =======================================
 16185                                  
 16186                                  
 16187                                  $READ	:
 16188                                  
 16189                                  ; FUNCTION CHUNK AT A774 SIZE 00000004 BYTES
 16190                                  ; FUNCTION CHUNK AT A7E0 SIZE 00000002 BYTES
 16191                                  ; FUNCTION CHUNK AT A7E4 SIZE 00000002 BYTES
 16192                                  ; FUNCTION CHUNK AT A82F SIZE 00000002 BYTES
 16193                                  ; FUNCTION CHUNK AT A834 SIZE 00000002 BYTES
 16194                                  ; FUNCTION CHUNK AT A838 SIZE 00000002 BYTES
 16195                                  
 16196 00006A5A BE[1D34]                		mov	si, DOS_READ
 16197                                  
 16198                                  ReadDo:					; ...
 16199 00006A5D E82DFE                  		call	pJFNFromHandle
 16200 00006A60 7208                    		jb	short ReadError
 16201 00006A62 268A05                  		mov	al, [es:di]
 16202 00006A65 E84101                  		call	CheckOwner
 16203 00006A68 7302                    		jnb	short ReadSetup
 16204                                  
 16205                                  ReadError:				; ...
 16206 00006A6A EBEC                    		jmp	short CommitErrorj3
 16207                                  ; ---------------------------------------------------------------------------
 16208                                  
 16209                                  ReadSetup:				; ...
 16210 00006A6C 36893E[9E05]            		mov	word [ss:THISSFT], di
 16211 00006A71 368C06[A005]            		mov	word [ss:THISSFT+2], es
 16212 00006A76 26F6450320              		test	byte [es:di+3], 20h
 16213 00006A7B 7406                    		jz	short needi24
 16214 00006A7D 36800E[F605]02          		or	byte [ss:EXTOPEN_ON], 2
 16215                                  
 16216                                  needi24:				; ...
 16217 00006A83 36FF36[2C03]            		push	word [ss:DMAADD]
 16218 00006A88 36FF36[2E03]            		push	word [ss:DMAADD+2]
 16219 00006A8D E81400                  		call	Align_Buffer
 16220 00006A90 16                      		push	ss
 16221 00006A91 1F                      		pop	ds
 16222 00006A92 FFD6                    		call	si ; DOS_READ
 16223 00006A94 8F06[2E03]              		pop	word [DMAADD+2]
 16224 00006A98 8F06[2C03]              		pop	word [DMAADD]
 16225 00006A9C 7302                    		jnb	short READ_OK
 16226 00006A9E EBCA                    		jmp	short ReadError
 16227                                  ; ---------------------------------------------------------------------------
 16228                                  
 16229                                  READ_OK:				; ...
 16230 00006AA0 89C8                    		mov	ax, cx
 16231                                  
 16232                                  Read_OK_j:				; ...
 16233 00006AA2 EBAB                    		jmp	short ExtHandle_OK
 16234                                  
 16235                                  ; =============== S U B	R O U T	I N E =======================================
 16236                                  
 16237                                  
 16238                                  Align_Buffer:
 16239 00006AA4 89D3                    		mov	bx, dx
 16240 00006AA6 51                      		push	cx
 16241 00006AA7 B104                    		mov	cl, 4
 16242 00006AA9 D3EB                    		shr	bx, cl
 16243 00006AAB 59                      		pop	cx
 16244 00006AAC 8CD8                    		mov	ax, ds
 16245 00006AAE 01D8                    		add	ax, bx
 16246 00006AB0 8ED8                    		mov	ds, ax
 16247 00006AB2 83E20F                  		and	dx, 0Fh
 16248 00006AB5 368916[2C03]            		mov	word [ss:DMAADD], dx
 16249 00006ABA 368C1E[2E03]            		mov	word [ss:DMAADD+2], ds
 16250 00006ABF C3                      		retn
 16251                                  
 16252                                  ; ---------------------------------------------------------------------------
 16253                                  
 16254                                  $WRITE:					; ...
 16255 00006AC0 BE[4C36]                		mov	si, DOS_WRITE
 16256 00006AC3 EB98                    		jmp	short ReadDo
 16257                                  
 16258                                  ; =============== S U B	R O U T	I N E =======================================
 16259                                  
 16260                                  
 16261                                  $LSEEK:
 16262 00006AC5 E8E100                  		call	CheckOwner
 16263                                  
 16264                                  LSeekError:				; ...
 16265 00006AC8 7302                    		jnb	short CHKOWN_OK
 16266 00006ACA EB9E                    		jmp	short ReadError
 16267                                  ; ---------------------------------------------------------------------------
 16268                                  
 16269                                  CHKOWN_OK:				; ...
 16270 00006ACC 3C02                    		cmp	al, 2
 16271 00006ACE 760A                    		jbe	short LSeekDisp
 16272 00006AD0 36C606[2303]01          		mov	byte [ss:EXTERR_LOCUS], 1
 16273 00006AD6 B001                    		mov	al, 1
 16274                                  
 16275                                  jmp_to_ReadError:			; ...
 16276 00006AD8 EB90                    		jmp	short ReadError
 16277                                  ; ---------------------------------------------------------------------------
 16278                                  
 16279                                  LSeekDisp:				; ...
 16280 00006ADA 3C01                    		cmp	al, 1
 16281 00006ADC 720A                    		jb	short LSeekStore
 16282 00006ADE 771B                    		ja	short LSeekEOF
 16283 00006AE0 26035515                		add	dx, [es:di+15h]
 16284 00006AE4 26134D17                		adc	cx, [es:di+17h]
 16285                                  
 16286                                  LSeekStore:				; ...
 16287 00006AE8 89C8                    		mov	ax, cx
 16288 00006AEA 92                      		xchg	ax, dx
 16289                                  
 16290                                  LSeekSetpos:				; ...
 16291 00006AEB 26894515                		mov	[es:di+15h], ax
 16292 00006AEF 26895517                		mov	[es:di+17h], dx
 16293 00006AF3 E8AC99                  		call	Get_User_Stack
 16294 00006AF6 895406                  		mov	[si+6],	dx
 16295                                  
 16296                                  jmp_to_Read_OK_j:			; ...
 16297 00006AF9 EBA7                    		jmp	short Read_OK_j
 16298                                  ; ---------------------------------------------------------------------------
 16299                                  
 16300                                  LSeekEOF:				; ...
 16301 00006AFB 26F6450680              		test	byte [es:di+6], 80h
 16302 00006B00 750A                    		jnz	short Check_LSeek_Mode
 16303                                  
 16304                                  LOCAL_LSeek:				; ...
 16305 00006B02 26035511                		add	dx, [es:di+11h]
 16306 00006B06 26134D13                		adc	cx, [es:di+13h]
 16307 00006B0A EBDC                    		jmp	short LSeekStore
 16308                                  ; ---------------------------------------------------------------------------
 16309                                  
 16310                                  Check_LSeek_Mode:			; ...
 16311 00006B0C 26F6450380              		test	byte [es:di+3], 80h
 16312 00006B11 75EF                    		jnz	short LOCAL_LSeek
 16313 00006B13 268B4502                		mov	ax, [es:di+2]
 16314 00006B17 25F000                  		and	ax, 0F0h
 16315 00006B1A 83F840                  		cmp	ax, 40h
 16316 00006B1D 7405                    		jz	short NET_LSEEK
 16317 00006B1F 83F830                  		cmp	ax, 30h
 16318 00006B22 75DE                    		jnz	short LOCAL_LSeek
 16319                                  
 16320                                  NET_LSEEK:				; ...
 16321 00006B24 B82111                  		mov	ax, 1121h
 16322 00006B27 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - SEEK	FROM END OF REMOTE FILE
 16323                                  					; CX:DX	= offset (in bytes) from end
 16324                                  					; ES:DI	-> SFT,	SFT DPB	field -> DPB of	drive with file
 16325                                  					; SS = DOS CS
 16326                                  					; Return: CF set on error
 16327                                  					; CF clear if successful, DX:AX	= new file position
 16328 00006B29 73C0                    		jnb	short LSeekSetpos
 16329                                  
 16330                                  jmp_to_jmp_ReadError:			; ...
 16331 00006B2B EBAB                    		jmp	short jmp_to_ReadError
 16332                                  
 16333                                  ; ---------------------------------------------------------------------------
 16334                                  
 16335                                  $FILE_TIMES:				; ...
 16336 00006B2D 3C02                    		cmp	al, 2
 16337 00006B2F 7340                    		jnb	short inval_func
 16338 00006B31 E87500                  		call	CheckOwner
 16339 00006B34 7292                    		jb	short LSeekError
 16340 00006B36 08C0                    		or	al, al
 16341 00006B38 7515                    		jnz	short ft_set_time
 16342 00006B3A FA                      		cli
 16343 00006B3B 268B4D0D                		mov	cx, [es:di+0Dh]
 16344 00006B3F 268B550F                		mov	dx, [es:di+0Fh]
 16345 00006B43 FB                      		sti
 16346 00006B44 E85B99                  		call	Get_User_Stack
 16347 00006B47 894C04                  		mov	[si+4],	cx
 16348 00006B4A 895406                  		mov	[si+6],	dx
 16349 00006B4D EB20                    		jmp	short ok_ret
 16350                                  ; ---------------------------------------------------------------------------
 16351                                  
 16352                                  ft_set_time:				; ...
 16353 00006B4F E808A8                  		call	ECritDisk	; ECritSFT
 16354 00006B52 26894D0D                		mov	[es:di+0Dh], cx
 16355 00006B56 2689550F                		mov	[es:di+0Fh], dx
 16356 00006B5A 31C0                    		xor	ax, ax
 16357 00006B5C 36FF1E[C800]            		call	far [ss:ShSU]
 16358 00006B61 26836505BF              		and	word [es:di+5], 0FFBFh
 16359 00006B66 26814D050040            		or	word [es:di+5], 4000h
 16360 00006B6C E80BA8                  		call	LCritDisk	; LCritSFT
 16361                                  
 16362                                  ok_ret:					; ...
 16363 00006B6F EB88                    		jmp	short jmp_to_Read_OK_j
 16364                                  ; ---------------------------------------------------------------------------
 16365                                  
 16366                                  inval_func:				; ...
 16367 00006B71 36C606[2303]01          		mov	byte [ss:EXTERR_LOCUS], 1
 16368 00006B77 B001                    		mov	al, 1
 16369                                  
 16370                                  jmp3_to_ReadError:			; ...
 16371 00006B79 EBB0                    		jmp	short jmp_to_jmp_ReadError
 16372                                  ; ---------------------------------------------------------------------------
 16373                                  
 16374                                  $DUP:					; ...
 16375 00006B7B 89D8                    		mov	ax, bx
 16376 00006B7D E86FFD                  		call	JFNFree
 16377                                  
 16378                                  DupErrorCheck:				; ...
 16379 00006B80 7217                    		jb	short DupErr
 16380 00006B82 06                      		push	es
 16381 00006B83 57                      		push	di
 16382 00006B84 5E                      		pop	si
 16383 00006B85 1F                      		pop	ds
 16384 00006B86 93                      		xchg	ax, bx
 16385 00006B87 E81F00                  		call	CheckOwner
 16386 00006B8A 720D                    		jb	short DupErr
 16387 00006B8C E8B9BF                  		call	DOS_Dup_Direct
 16388 00006B8F E8FBFC                  		call	pJFNFromHandle
 16389 00006B92 268A1D                  		mov	bl, [es:di]
 16390 00006B95 881C                    		mov	[si], bl
 16391 00006B97 EBD6                    		jmp	short ok_ret
 16392                                  ; ---------------------------------------------------------------------------
 16393                                  
 16394                                  DupErr:					; ...
 16395 00006B99 EBDE                    		jmp	short jmp3_to_ReadError
 16396                                  ; ---------------------------------------------------------------------------
 16397                                  
 16398                                  $DUP2:					; ...
 16399 00006B9B 53                      		push	bx
 16400 00006B9C 51                      		push	cx
 16401 00006B9D 89CB                    		mov	bx, cx
 16402 00006B9F E8A9FD                  		call	$CLOSE
 16403 00006BA2 5B                      		pop	bx
 16404 00006BA3 58                      		pop	ax
 16405 00006BA4 E8E6FC                  		call	pJFNFromHandle
 16406 00006BA7 EBD7                    		jmp	short DupErrorCheck
 16407                                  
 16408                                  ; =============== S U B	R O U T	I N E =======================================
 16409                                  
 16410                                  
 16411                                  CheckOwner:
 16412 00006BA9 E8FEFC                  		call	SFFromHandle
 16413 00006BAC 721C                    		jb	short co_ret_label
 16414 00006BAE 50                      		push	ax
 16415 00006BAF 36F606[3010]01          		test	byte [ss:IsWin386], 1
 16416 00006BB5 7404                    		jz	short no_win386
 16417 00006BB7 31C0                    		xor	ax, ax
 16418 00006BB9 EB08                    		jmp	short _skip_win386
 16419                                  ; ---------------------------------------------------------------------------
 16420                                  
 16421                                  no_win386:				; ...
 16422 00006BBB 36A1[3E03]              		mov	ax, [ss:USER_ID]
 16423 00006BBF 263B452F                		cmp	ax, [es:di+47]	; [es:di+SF_ENTRY.sf_UID]
 16424                                  
 16425                                  _skip_win386:				; ...
 16426 00006BC3 58                      		pop	ax
 16427 00006BC4 7501                    		jnz	short CheckOwner_err
 16428 00006BC6 C3                      		retn
 16429                                  ; ---------------------------------------------------------------------------
 16430                                  
 16431                                  CheckOwner_err:				; ...
 16432 00006BC7 B006                    		mov	al, 6
 16433 00006BC9 F9                      		stc
 16434                                  
 16435                                  co_ret_label:				; ...
 16436 00006BCA C3                      		retn
 16437                                  
 16438                                  ; ---------------------------------------------------------------------------
 16439                                  
 16440                                  $AssignOper:				; ...
 16441 00006BCB 3C07                    		cmp	al, 7
 16442 00006BCD 7526                    		jnz	short chk08
 16443                                  
 16444                                  srinuse:				; ...
 16445 00006BCF 50                      		push	ax
 16446 00006BD0 88D0                    		mov	al, dl
 16447 00006BD2 E85E01                  		call	GetCDSFromDrv
 16448 00006BD5 58                      		pop	ax
 16449 00006BD6 7218                    		jb	short baddrv
 16450 00006BD8 837C4500                		cmp	word [si+45h], 0
 16451 00006BDC 7412                    		jz	short baddrv
 16452 00006BDE 3C07                    		cmp	al, 7
 16453 00006BE0 7507                    		jnz	short resetdrv
 16454 00006BE2 814C430040              		or	word [si+43h], 4000h
 16455 00006BE7 EB19                    		jmp	short okdone
 16456                                  ; ---------------------------------------------------------------------------
 16457                                  
 16458                                  resetdrv:				; ...
 16459 00006BE9 816443FFBF              		and	word [si+43h], 0BFFFh
 16460 00006BEE EB12                    		jmp	short okdone
 16461                                  ; ---------------------------------------------------------------------------
 16462                                  
 16463                                  baddrv:					; ...
 16464 00006BF0 B80F00                  		mov	ax, 0Fh
 16465 00006BF3 EB10                    		jmp	short ASS_ERR
 16466                                  ; ---------------------------------------------------------------------------
 16467                                  
 16468                                  chk08:					; ...
 16469 00006BF5 3C08                    		cmp	al, 8
 16470 00006BF7 74D6                    		jz	short srinuse
 16471 00006BF9 50                      		push	ax
 16472 00006BFA B81E11                  		mov	ax, 111Eh
 16473 00006BFD CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - DO REDIRECTION
 16474                                  					; SS = DOS CS
 16475                                  					; STACK: WORD function to execute
 16476                                  					; Return: CF set on error, AX =	error code
 16477                                  					; STACK	unchanged
 16478 00006BFF 5B                      		pop	bx
 16479 00006C00 7203                    		jb	short ASS_ERR
 16480                                  
 16481                                  okdone:					; ...
 16482 00006C02 E90C9A                  		jmp	SYS_RET_OK
 16483                                  ; ---------------------------------------------------------------------------
 16484                                  
 16485                                  ASS_ERR:				; ...
 16486 00006C05 E9129A                  		jmp	SYS_RET_ERR
 16487                                  
 16488                                  ; =============== S U B	R O U T	I N E =======================================
 16489                                  
 16490                                  
 16491                                  FIND_DPB:
 16492 00006C08 36C536[2600]            		lds	si, [ss:DPBHEAD]
 16493                                  
 16494                                  fdpb5:					; ...
 16495 00006C0D 83FEFF                  		cmp	si, 0FFFFh
 16496 00006C10 7409                    		jz	short fdpb10
 16497 00006C12 3A04                    		cmp	al, [si]	; [SI+DPB.DRIVE]
 16498 00006C14 7406                    		jz	short ret_label15
 16499 00006C16 C57419                  		lds	si, [si+19h]	; [SI+DPB.NEXT_DPB]
 16500 00006C19 EBF2                    		jmp	short fdpb5
 16501                                  ; ---------------------------------------------------------------------------
 16502                                  
 16503                                  fdpb10:					; ...
 16504 00006C1B F9                      		stc
 16505                                  
 16506                                  ret_label15:				; ...
 16507 00006C1C C3                      		retn
 16508                                  
 16509                                  ; =============== S U B	R O U T	I N E =======================================
 16510                                  
 16511                                  
 16512                                  InitCDS	:
 16513 00006C1D 50                      		push	ax
 16514 00006C1E 36C43E[A205]            		les	di, [ss:THISCDS]
 16515 00006C23 26C745430000            		mov	word [es:di+43h], 0
 16516 00006C29 2C40                    		sub	al, 40h	; '@'
 16517 00006C2B 363806[4600]            		cmp	[ss:NUMIO], al
 16518 00006C30 7236                    		jb	short icdsx
 16519 00006C32 48                      		dec	ax
 16520 00006C33 50                      		push	ax
 16521 00006C34 0441                    		add	al, 'A'
 16522 00006C36 B43A                    		mov	ah, ':'
 16523 00006C38 268905                  		mov	[es:di], ax
 16524 00006C3B 26C745025C00            		mov	word [es:di+2], '\'
 16525 00006C41 26804D4440              		or	byte [es:di+44h], 40h
 16526 00006C46 29C0                    		sub	ax, ax
 16527 00006C48 26894549                		mov	[es:di+49h], ax
 16528 00006C4C 2689454B                		mov	[es:di+4Bh], ax
 16529 00006C50 B002                    		mov	al, 2
 16530 00006C52 2689454F                		mov	[es:di+4Fh], ax
 16531 00006C56 58                      		pop	ax
 16532 00006C57 1E                      		push	ds
 16533 00006C58 56                      		push	si
 16534 00006C59 E8ACFF                  		call	FIND_DPB
 16535 00006C5C 7208                    		jb	short icds5
 16536 00006C5E 26897545                		mov	[es:di+45h], si
 16537 00006C62 268C5D47                		mov	word [es:di+47h], ds
 16538                                  
 16539                                  icds5:					; ...
 16540 00006C66 5E                      		pop	si
 16541 00006C67 1F                      		pop	ds
 16542                                  
 16543                                  icdsx:					; ...
 16544 00006C68 58                      		pop	ax
 16545                                  
 16546                                  RET45:					; ...
 16547 00006C69 C3                      		retn
 16548                                  
 16549                                  ; ---------------------------------------------------------------------------
 16550                                  
 16551                                  $UserOper:				; ...
 16552 00006C6A 50                      		push	ax
 16553 00006C6B 2C01                    		sub	al, 1
 16554 00006C6D 58                      		pop	ax
 16555 00006C6E 7210                    		jb	short UserGet
 16556 00006C70 742D                    		jz	short UserSet
 16557 00006C72 3C05                    		cmp	al, 5
 16558 00006C74 763C                    		jbe	short UserPrint
 16559 00006C76 36C606[2303]01          		mov	byte [ss:EXTERR_LOCUS], 1
 16560 00006C7C B001                    		mov	al, 1
 16561                                  
 16562                                  useroper_error:				; ...
 16563 00006C7E EB85                    		jmp	short ASS_ERR
 16564                                  ; ---------------------------------------------------------------------------
 16565                                  
 16566                                  UserGet:				; ...
 16567 00006C80 1E                      		push	ds
 16568 00006C81 07                      		pop	es
 16569 00006C82 89D7                    		mov	di, dx
 16570 00006C84 368B0E[0E00]            		mov	cx, [ss:MYNUM]
 16571 00006C89 E81698                  		call	Get_User_Stack
 16572 00006C8C 894C04                  		mov	[si+4],	cx
 16573 00006C8F 16                      		push	ss
 16574 00006C90 1F                      		pop	ds
 16575 00006C91 BE[0503]                		mov	si, MYNAME
 16576                                  
 16577                                  UserMove:				; ...
 16578 00006C94 B90F00                  		mov	cx, 15
 16579 00006C97 F3A4                    		rep movsb
 16580 00006C99 31C0                    		xor	ax, ax
 16581 00006C9B AA                      		stosb
 16582                                  
 16583                                  UserBye:				; ...
 16584 00006C9C E97299                  		jmp	SYS_RET_OK
 16585                                  ; ---------------------------------------------------------------------------
 16586                                  
 16587                                  UserSet:				; ...
 16588 00006C9F 36890E[0E00]            		mov	[ss:MYNUM], cx
 16589 00006CA4 89D6                    		mov	si, dx
 16590 00006CA6 16                      		push	ss
 16591 00006CA7 07                      		pop	es
 16592 00006CA8 BF[0503]                		mov	di, MYNAME
 16593 00006CAB 36FE06[0403]            		inc	byte [ss:DIFFNAM]
 16594 00006CB0 EBE2                    		jmp	short UserMove
 16595                                  ; ---------------------------------------------------------------------------
 16596                                  
 16597                                  UserPrint:				; ...
 16598 00006CB2 50                      		push	ax
 16599 00006CB3 B81F11                  		mov	ax, 111Fh
 16600 00006CB6 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - PRINTER SETUP
 16601                                  					; STACK: WORD function
 16602                                  					; Return: CF set on error, AX =	error code
 16603                                  					; STACK	unchanged
 16604 00006CB8 5A                      		pop	dx
 16605 00006CB9 7302                    		jnb	short OKPA
 16606 00006CBB EBC1                    		jmp	short useroper_error
 16607                                  ; ---------------------------------------------------------------------------
 16608                                  
 16609                                  OKPA:					; ...
 16610 00006CBD EBDD                    		jmp	short UserBye
 16611                                  
 16612                                  ; =============== S U B	R O U T	I N E =======================================
 16613                                  
 16614                                  
 16615                                  GetVisDrv:
 16616 00006CBF E81A00                  		call	GETTHISDRV
 16617 00006CC2 72A5                    		jb	short RET45
 16618 00006CC4 1E                      		push	ds
 16619 00006CC5 56                      		push	si
 16620 00006CC6 36C536[A205]            		lds	si, [ss:THISCDS]
 16621 00006CCB F744430020              		test	word [si+43h], 2000h
 16622 00006CD0 5E                      		pop	si
 16623 00006CD1 1F                      		pop	ds
 16624 00006CD2 7495                    		jz	short RET45
 16625 00006CD4 36C606[1006]0F          		mov	byte [ss:DrvErr], 0Fh
 16626 00006CDA F9                      		stc
 16627 00006CDB C3                      		retn
 16628                                  
 16629                                  ; =============== S U B	R O U T	I N E =======================================
 16630                                  
 16631                                  
 16632                                  GETTHISDRV:
 16633 00006CDC 08C0                    		or	al, al
 16634 00006CDE 7505                    		jnz	short GTD10
 16635 00006CE0 36A0[3603]              		mov	al, [ss:CURDRV]
 16636 00006CE4 40                      		inc	ax
 16637                                  
 16638                                  GTD10:					; ...
 16639 00006CE5 48                      		dec	ax
 16640 00006CE6 1E                      		push	ds
 16641 00006CE7 56                      		push	si
 16642 00006CE8 36C606[2303]02          		mov	byte [ss:EXTERR_LOCUS], 2
 16643 00006CEE 36F606[7205]FF          		test	byte [ss:FSHARING], 0FFh
 16644 00006CF4 7421                    		jz	short GTD20
 16645 00006CF6 50                      		push	ax
 16646 00006CF7 06                      		push	es
 16647 00006CF8 57                      		push	di
 16648 00006CF9 36C706[A205][F304]      		mov	word [ss:THISCDS], DUMMYCDS
 16649 00006D00 368C16[A405]            		mov	word [ss:THISCDS+2], ss
 16650 00006D05 0441                    		add	al, 'A'
 16651 00006D07 E813FF                  		call	InitCDS
 16652 00006D0A 26F745430040            		test	word [es:di+43h], 4000h
 16653 00006D10 5F                      		pop	di
 16654 00006D11 07                      		pop	es
 16655 00006D12 58                      		pop	ax
 16656 00006D13 740E                    		jz	short GTD30
 16657 00006D15 EB19                    		jmp	short GTDX
 16658                                  ; ---------------------------------------------------------------------------
 16659                                  
 16660                                  GTD20:					; ...
 16661 00006D17 E81900                  		call	GetCDSFromDrv
 16662 00006D1A 7207                    		jb	short GTD30
 16663 00006D1C F744430040              		test	word [si+43h], 4000h
 16664 00006D21 750D                    		jnz	short GTDX
 16665                                  
 16666                                  GTD30:					; ...
 16667 00006D23 B00F                    		mov	al, 0Fh
 16668 00006D25 36A2[1006]              		mov	byte [ss:DrvErr], al
 16669 00006D29 36C606[2303]01          		mov	byte [ss:EXTERR_LOCUS], 1
 16670 00006D2F F9                      		stc
 16671                                  
 16672                                  GTDX:					; ...
 16673 00006D30 5E                      		pop	si
 16674 00006D31 1F                      		pop	ds
 16675 00006D32 C3                      		retn
 16676                                  
 16677                                  ; =============== S U B	R O U T	I N E =======================================
 16678                                  
 16679                                  
 16680                                  GetCDSFromDrv:
 16681 00006D33 363A06[4700]            		cmp	al, [ss:CDSCOUNT]
 16682 00006D38 7202                    		jb	short GetCDS
 16683 00006D3A F9                      		stc
 16684 00006D3B C3                      		retn
 16685                                  ; ---------------------------------------------------------------------------
 16686                                  
 16687                                  GetCDS:					; ...
 16688 00006D3C 53                      		push	bx
 16689 00006D3D 50                      		push	ax
 16690 00006D3E 36C536[3C00]            		lds	si, [ss:CDSADDR]
 16691 00006D43 B358                    		mov	bl, 88		; curdir.size
 16692 00006D45 F6E3                    		mul	bl
 16693 00006D47 01C6                    		add	si, ax
 16694 00006D49 368936[A205]            		mov	word [ss:THISCDS], si
 16695 00006D4E 368C1E[A405]            		mov	word [ss:THISCDS+2], ds
 16696 00006D53 58                      		pop	ax
 16697 00006D54 5B                      		pop	bx
 16698 00006D55 F8                      		clc
 16699 00006D56 C3                      		retn
 16700                                  
 16701                                  ; =============== S U B	R O U T	I N E =======================================
 16702                                  
 16703                                  ; Attributes: bp-based frame
 16704                                  
 16705                                  TransFCB:
 16706 00006D57 55                      		push	bp
 16707 00006D58 89E5                    		mov	bp, sp
 16708 00006D5A 83EC10                  		sub	sp, 16
 16709 00006D5D 16                      		push	ss
 16710 00006D5E 07                      		pop	es
 16711 00006D5F 06                      		push	es
 16712 00006D60 57                      		push	di
 16713 00006D61 8D7EF0                  		lea	di, [bp-16]	; FCBTmp
 16714 00006D64 36C606[6C05]00          		mov	byte [ss:EXTFCB], 0
 16715 00006D6A 36C606[6D05]00          		mov	byte [ss:SATTRIB], 0
 16716 00006D70 E8BDAF                  		call	GetExtended
 16717 00006D73 740D                    		jz	short GetDrive
 16718 00006D75 8A44FF                  		mov	al, [si-1]
 16719 00006D78 36A2[6D05]              		mov	byte [ss:SATTRIB], al
 16720 00006D7C 36C606[6C05]FF          		mov	byte [ss:EXTFCB], 0FFh
 16721                                  
 16722                                  GetDrive:				; ...
 16723 00006D82 AC                      		lodsb
 16724 00006D83 E856FF                  		call	GETTHISDRV
 16725 00006D86 722A                    		jb	short BadPack
 16726 00006D88 E87A03                  		call	TextFromDrive
 16727 00006D8B B90B00                  		mov	cx, 11
 16728 00006D8E 56                      		push	si
 16729                                  
 16730                                  FCBScan:				; ...
 16731 00006D8F AC                      		lodsb
 16732 00006D90 E8D7E4                  		call	GetCharType
 16733 00006D93 A808                    		test	al, 8
 16734 00006D95 741B                    		jz	short BadPack
 16735 00006D97 E2F6                    		loop	FCBScan
 16736 00006D99 5E                      		pop	si
 16737 00006D9A 89FB                    		mov	bx, di
 16738 00006D9C E8F1B3                  		call	PackName
 16739 00006D9F 5F                      		pop	di
 16740 00006DA0 07                      		pop	es
 16741 00006DA1 16                      		push	ss
 16742 00006DA2 1F                      		pop	ds
 16743 00006DA3 8D76F0                  		lea	si, [bp-16]	;  FCBTmp
 16744 00006DA6 803F00                  		cmp	byte [bx], 0
 16745 00006DA9 7407                    		jz	short BadPack
 16746 00006DAB 55                      		push	bp
 16747 00006DAC E80E00                  		call	TransPathSet
 16748 00006DAF 5D                      		pop	bp
 16749 00006DB0 7303                    		jnb	short FCBRet
 16750                                  
 16751                                  BadPack:				; ...
 16752 00006DB2 F9                      		stc
 16753 00006DB3 B003                    		mov	al, 3
 16754                                  
 16755                                  FCBRet:					; ...
 16756 00006DB5 89EC                    		mov	sp, bp
 16757 00006DB7 5D                      		pop	bp
 16758                                  
 16759                                  TransPath_retn:				; ...
 16760 00006DB8 C3                      		retn
 16761                                  
 16762                                  ; =============== S U B	R O U T	I N E =======================================
 16763                                  
 16764                                  
 16765                                  TransPath:
 16766 00006DB9 30C0                    		xor	al, al
 16767 00006DBB EB02                    		jmp	short SetSplice
 16768                                  
 16769                                  ; =============== S U B	R O U T	I N E =======================================
 16770                                  
 16771                                  
 16772                                  TransPathSet:
 16773                                  
 16774                                  ; FUNCTION CHUNK AT AC6D SIZE 000000A5 BYTES
 16775                                  
 16776 00006DBD B0FF                    		mov	al, 0FFh
 16777                                  
 16778                                  SetSplice:				; ...
 16779 00006DBF 36A2[4C03]              		mov	byte [ss:NoSetDir], al
 16780 00006DC3 B0FF                    		mov	al, 0FFh
 16781                                  
 16782                                  TransPathNoSet:				; ...
 16783 00006DC5 36A2[7105]              		mov	[ss:FSPLICE], al
 16784 00006DC9 36C606[7A05]FF          		mov	byte [ss:CMETA], 0FFh
 16785 00006DCF 36893E[B205]            		mov	[ss:WFP_START], di
 16786 00006DD4 36C706[B605]FFFF        		mov	word [ss:CURR_DIR_END], 0FFFFh
 16787 00006DDB 16                      		push	ss
 16788 00006DDC 07                      		pop	es
 16789 00006DDD 8DAD8600                		lea	bp, [di+134]	; lea bp,[di+TEMPLEN]
 16790 00006DE1 36F606[7205]FF          		test	byte [ss:FSHARING], 0FFh
 16791 00006DE7 7435                    		jz	short CheckUNC
 16792 00006DE9 E80203                  		call	DriveFromText
 16793 00006DEC E8EDFE                  		call	GETTHISDRV
 16794 00006DEF 722A                    		jb	short NoPath
 16795 00006DF1 E81103                  		call	TextFromDrive
 16796 00006DF4 8D5D01                  		lea	bx, [di+1]
 16797 00006DF7 E83801                  		call	Canonicalize
 16798 00006DFA 72BC                    		jb	short TransPath_retn
 16799 00006DFC 16                      		push	ss
 16800 00006DFD 1F                      		pop	ds
 16801 00006DFE 8B36[B205]              		mov	si, [WFP_START]
 16802 00006E02 F606[7105]FF            		test	byte [FSPLICE], 0FFh
 16803 00006E07 7403                    		jz	short NoServerSplice
 16804 00006E09 E83602                  		call	Splice
 16805                                  
 16806                                  NoServerSplice:				; ...
 16807 00006E0C 16                      		push	ss
 16808 00006E0D 1F                      		pop	ds
 16809 00006E0E C43E[A205]              		les	di, [THISCDS]
 16810 00006E12 E845A5                  		call	ECritDisk
 16811 00006E15 E8CDEA                  		call	FATREAD_CDS
 16812 00006E18 E85FA5                  		call	LCritDisk
 16813                                  
 16814                                  NoPath:					; ...
 16815 00006E1B B003                    		mov	al, 3
 16816 00006E1D C3                      		retn
 16817                                  ; ---------------------------------------------------------------------------
 16818                                  
 16819                                  CheckUNC:				; ...
 16820 00006E1E 36C706[A205]FFFF        		mov	word [ss:THISCDS], 0FFFFh
 16821 00006E25 B82311                  		mov	ax, 1123h
 16822 00006E28 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - QUALIFY REMOTE FILENAME
 16823                                  					; DS:SI	-> ASCIZ filename to canonicalize
 16824                                  					; ES:DI	-> 128-byte buffer for qualified name
 16825                                  					; Return: CF set if not	resolved
 16826 00006E2A 7329                    		jnb	short UNCDone
 16827 00006E2C E8BF02                  		call	DriveFromText
 16828 00006E2F 50                      		push	ax
 16829 00006E30 8B04                    		mov	ax, [si]
 16830 00006E32 E852E4                  		call	PATHCHRCMP
 16831 00006E35 86E0                    		xchg	ah, al
 16832 00006E37 E84DE4                  		call	PATHCHRCMP
 16833 00006E3A 751F                    		jnz	short CheckDevice
 16834 00006E3C 38C4                    		cmp	ah, al
 16835 00006E3E 751B                    		jnz	short CheckDevice
 16836 00006E40 58                      		pop	ax
 16837 00006E41 A5                      		movsw
 16838                                  
 16839                                  UNCCpy:					; ...
 16840 00006E42 AC                      		lodsb
 16841 00006E43 E8ECE3                  		call	UCase
 16842 00006E46 08C0                    		or	al, al
 16843 00006E48 740E                    		jz	short UNCTerm
 16844 00006E4A E83AE4                  		call	PATHCHRCMP
 16845 00006E4D 89FB                    		mov	bx, di
 16846 00006E4F AA                      		stosb
 16847 00006E50 75F0                    		jnz	short UNCCpy
 16848 00006E52 E8DD00                  		call	Canonicalize
 16849                                  
 16850                                  UNCDone:				; ...
 16851 00006E55 16                      		push	ss
 16852 00006E56 1F                      		pop	ds
 16853 00006E57 C3                      		retn
 16854                                  ; ---------------------------------------------------------------------------
 16855                                  
 16856                                  UNCTerm:				; ...
 16857 00006E58 AA                      		stosb
 16858 00006E59 EBFA                    		jmp	short UNCDone
 16859                                  ; ---------------------------------------------------------------------------
 16860                                  
 16861                                  CheckDevice:				; ...
 16862 00006E5B 58                      		pop	ax
 16863 00006E5C 803C00                  		cmp	byte [si], 0
 16864 00006E5F 7504                    		jnz	short CheckPath
 16865 00006E61 B002                    		mov	al, 2
 16866 00006E63 F9                      		stc
 16867 00006E64 C3                      		retn
 16868                                  ; ---------------------------------------------------------------------------
 16869                                  
 16870                                  CheckPath:				; ...
 16871 00006E65 50                      		push	ax
 16872 00006E66 55                      		push	bp
 16873 00006E67 E82000                  		call	no5Dshere	; call CheckThisDevice
 16874 00006E6A 5D                      		pop	bp
 16875 00006E6B 58                      		pop	ax
 16876 00006E6C 731F                    		jnb	short DoFile
 16877 00006E6E 36C606[7205]FF          		mov	byte [ss:FSHARING], 0FFh
 16878 00006E74 E865FE                  		call	GETTHISDRV
 16879 00006E77 36C606[7205]00          		mov	byte [ss:FSHARING], 0
 16880 00006E7D E88502                  		call	TextFromDrive
 16881 00006E80 B02F                    		mov	al, '/'
 16882 00006E82 AA                      		stosb
 16883 00006E83 E893A3                  		call	StrCpy
 16884 00006E86 F8                      		clc
 16885 00006E87 16                      		push	ss
 16886 00006E88 1F                      		pop	ds
 16887                                  
 16888                                  DoFile_retn:				; ...
 16889 00006E89 C3                      		retn
 16890                                  
 16891                                  ; =============== S U B	R O U T	I N E =======================================
 16892                                  
 16893                                  ; Attributes: thunk
 16894                                  
 16895                                  no5Dshere:
 16896 00006E8A E927D6                  		jmp	CheckThisDevice
 16897                                  
 16898                                  ; ---------------------------------------------------------------------------
 16899                                  ; START	OF FUNCTION CHUNK FOR TransPathSet
 16900                                  
 16901                                  DoFile:					; ...
 16902 00006E8D E82FFE                  		call	GetVisDrv
 16903 00006E90 B003                    		mov	al, 3
 16904 00006E92 72F5                    		jb	short DoFile_retn
 16905 00006E94 1E                      		push	ds
 16906 00006E95 56                      		push	si
 16907 00006E96 06                      		push	es
 16908 00006E97 57                      		push	di
 16909 00006E98 E85BD5                  		call	ValidateCDS
 16910 00006E9B 5F                      		pop	di
 16911 00006E9C 07                      		pop	es
 16912 00006E9D 5E                      		pop	si
 16913 00006E9E 1F                      		pop	ds
 16914 00006E9F B003                    		mov	al, 3
 16915 00006EA1 72E6                    		jb	short DoFile_retn
 16916 00006EA3 1E                      		push	ds
 16917 00006EA4 56                      		push	si
 16918 00006EA5 36C536[A205]            		lds	si, [ss:THISCDS]
 16919 00006EAA 89FB                    		mov	bx, di
 16920 00006EAC 035C4F                  		add	bx, [si+79]
 16921 00006EAF 8DAD8600                		lea	bp, [di+134]
 16922 00006EB3 E872A3                  		call	FStrCpy
 16923 00006EB6 4F                      		dec	di
 16924 00006EB7 B05C                    		mov	al, '\'
 16925 00006EB9 263845FF                		cmp	[es:di-1], al
 16926 00006EBD 7401                    		jz	short GetOrig
 16927 00006EBF AA                      		stosb
 16928                                  
 16929                                  GetOrig:				; ...
 16930 00006EC0 4F                      		dec	di
 16931 00006EC1 5E                      		pop	si
 16932 00006EC2 1F                      		pop	ds
 16933 00006EC3 E8D100                  		call	PathSep
 16934 00006EC6 7511                    		jnz	short PathAssure
 16935 00006EC8 08C0                    		or	al, al
 16936 00006ECA 7410                    		jz	short DoCanon
 16937 00006ECC 89DF                    		mov	di, bx
 16938                                  
 16939                                  SkipPath:				; ...
 16940 00006ECE AC                      		lodsb
 16941 00006ECF E8B5E3                  		call	PATHCHRCMP
 16942 00006ED2 74FA                    		jz	short SkipPath
 16943 00006ED4 4E                      		dec	si
 16944 00006ED5 08C0                    		or	al, al
 16945 00006ED7 7403                    		jz	short DoCanon
 16946                                  
 16947                                  PathAssure:				; ...
 16948 00006ED9 B05C                    		mov	al, '\'
 16949 00006EDB AA                      		stosb
 16950                                  
 16951                                  DoCanon:				; ...
 16952 00006EDC E85300                  		call	Canonicalize
 16953 00006EDF 72A8                    		jb	short DoFile_retn
 16954 00006EE1 16                      		push	ss
 16955 00006EE2 1F                      		pop	ds
 16956 00006EE3 8B3E[B205]              		mov	di, [WFP_START]
 16957 00006EE7 C536[A205]              		lds	si, [THISCDS]
 16958 00006EEB E81F02                  		call	PathPref
 16959 00006EEE 7514                    		jnz	short DoSplice
 16960 00006EF0 8A44FF                  		mov	al, [si-1]
 16961 00006EF3 E891E3                  		call	PATHCHRCMP
 16962 00006EF6 740C                    		jz	short DoSplice
 16963                                  
 16964                                  Pathline:
 16965 00006EF8 26803D00                		cmp	byte [es:di], 0
 16966 00006EFC 7406                    		jz	short DoSplice
 16967 00006EFE 47                      		inc	di
 16968 00006EFF 36893E[B605]            		mov	[ss:CURR_DIR_END], di
 16969                                  
 16970                                  DoSplice:				; ...
 16971 00006F04 16                      		push	ss
 16972 00006F05 1F                      		pop	ds
 16973 00006F06 8B36[B205]              		mov	si, [WFP_START]
 16974 00006F0A 31C9                    		xor	cx, cx
 16975 00006F0C F606[7105]FF            		test	byte [FSPLICE], 0FFh
 16976 00006F11 7403                    		jz	short SkipSplice
 16977 00006F13 E82C01                  		call	Splice
 16978                                  
 16979                                  SkipSplice:				; ...
 16980 00006F16 16                      		push	ss
 16981 00006F17 1F                      		pop	ds
 16982 00006F18 C43E[A205]              		les	di, [THISCDS]
 16983 00006F1C 26F745430080            		test	word [es:di+67], 8000h
 16984 00006F22 750D                    		jnz	short Done
 16985 00006F24 E30B                    		jcxz	Done
 16986 00006F26 E831A4                  		call	ECritDisk
 16987 00006F29 E8B9E9                  		call	FATREAD_CDS
 16988 00006F2C E84BA4                  		call	LCritDisk
 16989 00006F2F B003                    		mov	al, 3
 16990                                  
 16991                                  Done:					; ...
 16992 00006F31 C3                      		retn
 16993                                  ; END OF FUNCTION CHUNK	FOR TransPathSet
 16994                                  
 16995                                  ; =============== S U B	R O U T	I N E =======================================
 16996                                  
 16997                                  
 16998                                  Canonicalize:
 16999 00006F32 AC                      		lodsb
 17000 00006F33 E851E3                  		call	PATHCHRCMP
 17001 00006F36 7507                    		jnz	short CanonDec
 17002 00006F38 39EF                    		cmp	di, bp
 17003 00006F3A 7319                    		jnb	short CanonBad
 17004 00006F3C AA                      		stosb
 17005 00006F3D EBF3                    		jmp	short Canonicalize
 17006                                  ; ---------------------------------------------------------------------------
 17007                                  
 17008                                  CanonDec:				; ...
 17009 00006F3F 4E                      		dec	si
 17010                                  
 17011                                  CanonLoop:				; ...
 17012 00006F40 31C0                    		xor	ax, ax
 17013 00006F42 3804                    		cmp	[si], al
 17014 00006F44 751A                    		jnz	short DoComponent
 17015 00006F46 26807DFF3A              		cmp	byte [es:di-1], ':'
 17016 00006F4B 7505                    		jnz	short DoTerminate
 17017 00006F4D B05C                    		mov	al, '\'
 17018 00006F4F AA                      		stosb
 17019 00006F50 88E0                    		mov	al, ah
 17020                                  
 17021                                  DoTerminate:				; ...
 17022 00006F52 AA                      		stosb
 17023 00006F53 F8                      		clc
 17024 00006F54 C3                      		retn
 17025                                  ; ---------------------------------------------------------------------------
 17026                                  
 17027                                  CanonBad:				; ...
 17028 00006F55 E8CE01                  		call	ScanPathChar
 17029 00006F58 B003                    		mov	al, 3
 17030 00006F5A 7402                    		jz	short PathEnc
 17031 00006F5C B002                    		mov	al, 2
 17032                                  
 17033                                  PathEnc:				; ...
 17034 00006F5E F9                      		stc
 17035                                  
 17036                                  CanonBad_retn:				; ...
 17037 00006F5F C3                      		retn
 17038                                  ; ---------------------------------------------------------------------------
 17039                                  
 17040                                  DoComponent:				; ...
 17041 00006F60 E85100                  		call	CopyComponent
 17042 00006F63 72FA                    		jb	short CanonBad_retn
 17043 00006F65 26833D2E                		cmp	word [es:di], '.' ; 2Eh
 17044 00006F69 7408                    		jz	short Skip1
 17045 00006F6B 26813D2E2E              		cmp	word [es:di], '..' ; 2E2Eh
 17046 00006F70 750A                    		jnz	short CanonNormal
 17047 00006F72 4F                      		dec	di
 17048                                  
 17049                                  Skip1:					; ...
 17050 00006F73 E82B00                  		call	SkipBack
 17051 00006F76 B003                    		mov	al, 3
 17052 00006F78 72E5                    		jb	short CanonBad_retn
 17053 00006F7A EB02                    		jmp	short CanonPath
 17054                                  ; ---------------------------------------------------------------------------
 17055                                  
 17056                                  CanonNormal:				; ...
 17057 00006F7C 01CF                    		add	di, cx
 17058                                  
 17059                                  CanonPath:				; ...
 17060 00006F7E E81600                  		call	PathSep
 17061 00006F81 75D2                    		jnz	short CanonBad
 17062 00006F83 AC                      		lodsb
 17063 00006F84 E800E3                  		call	PATHCHRCMP
 17064 00006F87 75B6                    		jnz	short CanonDec
 17065 00006F89 39EF                    		cmp	di, bp
 17066 00006F8B 73C8                    		jnb	short CanonBad
 17067 00006F8D AA                      		stosb
 17068                                  
 17069                                  CanonPathLoop:				; ...
 17070 00006F8E AC                      		lodsb
 17071 00006F8F E8F5E2                  		call	PATHCHRCMP
 17072 00006F92 74FA                    		jz	short CanonPathLoop
 17073 00006F94 4E                      		dec	si
 17074 00006F95 EBA9                    		jmp	short CanonLoop
 17075                                  
 17076                                  ; =============== S U B	R O U T	I N E =======================================
 17077                                  
 17078                                  
 17079                                  PathSep	:
 17080 00006F97 8A04                    		mov	al, [si]
 17081                                  
 17082                                  PathSepGotCh:				; ...
 17083 00006F99 08C0                    		or	al, al
 17084 00006F9B 74C2                    		jz	short CanonBad_retn
 17085 00006F9D E8E7E2                  		call	PATHCHRCMP
 17086 00006FA0 C3                      		retn
 17087                                  
 17088                                  ; =============== S U B	R O U T	I N E =======================================
 17089                                  
 17090                                  
 17091                                  SkipBack:
 17092 00006FA1 39DF                    		cmp	di, bx
 17093 00006FA3 720B                    		jb	short SkipBad
 17094 00006FA5 4F                      		dec	di
 17095 00006FA6 268A05                  		mov	al, [es:di]
 17096 00006FA9 E8DBE2                  		call	PATHCHRCMP
 17097 00006FAC 75F3                    		jnz	short SkipBack
 17098 00006FAE F8                      		clc
 17099 00006FAF C3                      		retn
 17100                                  ; ---------------------------------------------------------------------------
 17101                                  
 17102                                  SkipBad:				; ...
 17103 00006FB0 B003                    		mov	al, 3
 17104 00006FB2 F9                      		stc
 17105 00006FB3 C3                      		retn
 17106                                  
 17107                                  ; =============== S U B	R O U T	I N E =======================================
 17108                                  
 17109                                  
 17110                                  CopyComponent:
 17111 00006FB4 83EC0E                  		sub	sp, 14
 17112 00006FB7 1E                      		push	ds
 17113 00006FB8 56                      		push	si
 17114 00006FB9 06                      		push	es
 17115 00006FBA 57                      		push	di
 17116 00006FBB 55                      		push	bp
 17117 00006FBC 89E5                    		mov	bp, sp
 17118 00006FBE B42E                    		mov	ah, '.'
 17119 00006FC0 AC                      		lodsb
 17120 00006FC1 AA                      		stosb
 17121 00006FC2 38E0                    		cmp	al, ah
 17122 00006FC4 7518                    		jnz	short NormalComp
 17123 00006FC6 E8CEFF                  		call	PathSep
 17124 00006FC9 740B                    		jz	short NulTerm
 17125                                  
 17126                                  TryTwoDot:
 17127 00006FCB AC                      		lodsb
 17128 00006FCC AA                      		stosb
 17129 00006FCD 38E0                    		cmp	al, ah
 17130 00006FCF 7557                    		jnz	short CopyBad
 17131 00006FD1 E8C3FF                  		call	PathSep
 17132 00006FD4 7552                    		jnz	short CopyBad
 17133                                  
 17134                                  NulTerm:				; ...
 17135 00006FD6 30C0                    		xor	al, al
 17136 00006FD8 AA                      		stosb
 17137 00006FD9 897606                  		mov	[bp+6],	si
 17138 00006FDC EB47                    		jmp	short _GoodRet
 17139                                  ; ---------------------------------------------------------------------------
 17140                                  
 17141                                  NormalComp:				; ...
 17142 00006FDE 8B7606                  		mov	si, [bp+6]
 17143 00006FE1 E8E1E1                  		call	NAMETRANS
 17144 00006FE4 3B7606                  		cmp	si, [bp+6]
 17145 00006FE7 743F                    		jz	short CopyBad
 17146 00006FE9 36F606[7205]FF          		test	byte [ss:FSHARING], 0FFh
 17147 00006FEF 7510                    		jnz	short DoPack
 17148 00006FF1 80E201                  		and	dl, 1
 17149 00006FF4 360016[7A05]            		add	byte [ss:CMETA], dl
 17150 00006FF9 7F2D                    		jg	short CopyBad
 17151 00006FFB 7504                    		jnz	short DoPack
 17152 00006FFD 08D2                    		or	dl, dl
 17153 00006FFF 742F                    		jz	short CopyBadPath
 17154                                  
 17155                                  DoPack:					; ...
 17156 00007001 897606                  		mov	[bp+6],	si
 17157 00007004 16                      		push	ss
 17158 00007005 1F                      		pop	ds
 17159 00007006 BE[4B05]                		mov	si, NAME1
 17160 00007009 8D7E0A                  		lea	di, [bp+0Ah]
 17161 0000700C 57                      		push	di
 17162 0000700D E880B1                  		call	PackName
 17163 00007010 5F                      		pop	di
 17164 00007011 E81DA2                  		call	StrLen
 17165 00007014 49                      		dec	cx
 17166 00007015 034E02                  		add	cx, [bp+2]
 17167 00007018 3B4E00                  		cmp	cx, [bp+0]
 17168 0000701B 730B                    		jnb	short CopyBad
 17169 0000701D 89FE                    		mov	si, di
 17170 0000701F C47E02                  		les	di, [bp+2]
 17171 00007022 E803A2                  		call	FStrCpy
 17172                                  
 17173                                  _GoodRet:				; ...
 17174 00007025 F8                      		clc
 17175 00007026 EB0B                    		jmp	short CopyEnd
 17176                                  ; ---------------------------------------------------------------------------
 17177                                  
 17178                                  CopyBad:				; ...
 17179 00007028 F9                      		stc
 17180 00007029 E8FA00                  		call	ScanPathChar
 17181 0000702C B002                    		mov	al, 2
 17182 0000702E 7503                    		jnz	short CopyEnd
 17183                                  
 17184                                  CopyBadPath:				; ...
 17185 00007030 F9                      		stc
 17186 00007031 B003                    		mov	al, 3
 17187                                  
 17188                                  CopyEnd:				; ...
 17189 00007033 5D                      		pop	bp
 17190 00007034 5F                      		pop	di
 17191 00007035 07                      		pop	es
 17192 00007036 5E                      		pop	si
 17193 00007037 1F                      		pop	ds
 17194 00007038 9F                      		lahf
 17195 00007039 83C40E                  		add	sp, 14
 17196 0000703C E8F2A1                  		call	StrLen
 17197 0000703F 49                      		dec	cx
 17198 00007040 9E                      		sahf
 17199 00007041 C3                      		retn
 17200                                  
 17201                                  ; =============== S U B	R O U T	I N E =======================================
 17202                                  
 17203                                  
 17204                                  Splice	:
 17205 00007042 36F606[5A00]FF          		test	byte [ss:SPLICES], 0FFh
 17206 00007048 746A                    		jz	short AllDone
 17207 0000704A 36FF36[A205]            		push	word [ss:THISCDS]
 17208 0000704F 36FF36[A405]            		push	word [ss:THISCDS+2]
 17209 00007054 1E                      		push	ds
 17210 00007055 56                      		push	si
 17211 00007056 5F                      		pop	di
 17212 00007057 07                      		pop	es
 17213 00007058 31C0                    		xor	ax, ax
 17214                                  
 17215                                  SpliceScan:				; ...
 17216 0000705A E8D6FC                  		call	GetCDSFromDrv
 17217 0000705D 724B                    		jb	short SpliceDone
 17218 0000705F FEC0                    		inc	al
 17219 00007061 F744430020              		test	word [si+43h], 2000h
 17220 00007066 74F2                    		jz	short SpliceScan
 17221 00007068 57                      		push	di
 17222 00007069 E8A100                  		call	PathPref
 17223 0000706C 7403                    		jz	short SpliceFound
 17224                                  
 17225                                  SpliceSkip:				; ...
 17226 0000706E 5F                      		pop	di
 17227 0000706F EBE9                    		jmp	short SpliceScan
 17228                                  ; ---------------------------------------------------------------------------
 17229                                  
 17230                                  SpliceFound:				; ...
 17231 00007071 26803D00                		cmp	byte [es:di], 0
 17232 00007075 7508                    		jnz	short SpliceDo
 17233 00007077 36F606[4C03]FF          		test	byte [ss:NoSetDir], 0FFh
 17234 0000707D 75EF                    		jnz	short SpliceSkip
 17235                                  
 17236                                  SpliceDo:				; ...
 17237 0000707F 89FE                    		mov	si, di
 17238 00007081 06                      		push	es
 17239 00007082 1F                      		pop	ds
 17240 00007083 5F                      		pop	di
 17241 00007084 E88000                  		call	TextFromDrive1
 17242 00007087 36A1[B605]              		mov	ax, [ss:CURR_DIR_END]
 17243 0000708B 09C0                    		or	ax, ax
 17244 0000708D 7808                    		js	short NoPoke
 17245 0000708F 01F8                    		add	ax, di
 17246 00007091 29F0                    		sub	ax, si
 17247 00007093 36A3[B605]              		mov	[ss:CURR_DIR_END], ax
 17248                                  
 17249                                  NoPoke:					; ...
 17250 00007097 803C00                  		cmp	byte [si], 0
 17251 0000709A 7503                    		jnz	short SpliceCopy
 17252 0000709C B05C                    		mov	al, '\'
 17253 0000709E AA                      		stosb
 17254                                  
 17255                                  SpliceCopy:				; ...
 17256 0000709F E886A1                  		call	FStrCpy
 17257 000070A2 83C404                  		add	sp, 4
 17258 000070A5 80C901                  		or	cl, 1
 17259 000070A8 EB0C                    		jmp	short DoSet
 17260                                  ; ---------------------------------------------------------------------------
 17261                                  
 17262                                  SpliceDone:				; ...
 17263 000070AA 368F06[A405]            		pop	word [ss:THISCDS+2]
 17264 000070AF 368F06[A205]            		pop	word [ss:THISCDS]
 17265                                  
 17266                                  AllDone:				; ...
 17267 000070B4 31C9                    		xor	cx, cx
 17268                                  
 17269                                  DoSet:					; ...
 17270 000070B6 36C536[A205]            		lds	si, [ss:THISCDS]
 17271 000070BB C47C45                  		les	di, [si+45h]
 17272 000070BE 36893E[8A05]            		mov	word [ss:THISDPB], di
 17273 000070C3 368C06[8C05]            		mov	word [ss:THISDPB+2], es
 17274                                  
 17275                                  Splice_retn:				; ...
 17276 000070C8 C3                      		retn
 17277                                  
 17278                                  ; =============== S U B	R O U T	I N E =======================================
 17279                                  
 17280                                  
 17281                                  $NameTrans:
 17282 000070C9 1E                      		push	ds
 17283 000070CA 56                      		push	si
 17284 000070CB 06                      		push	es
 17285 000070CC 57                      		push	di
 17286 000070CD 51                      		push	cx
 17287 000070CE B516                    		mov	ch, 16h		; attr_hidden+attr_system+attr_directory
 17288 000070D0 E8C102                  		call	SetAttrib
 17289 000070D3 BF[BE03]                		mov	di, OPENBUF
 17290 000070D6 E8E0FC                  		call	TransPath
 17291 000070D9 59                      		pop	cx
 17292 000070DA 5F                      		pop	di
 17293 000070DB 07                      		pop	es
 17294 000070DC 5E                      		pop	si
 17295 000070DD 1F                      		pop	ds
 17296 000070DE 7303                    		jnb	short TransOK
 17297 000070E0 E93795                  		jmp	SYS_RET_ERR
 17298                                  ; ---------------------------------------------------------------------------
 17299                                  
 17300                                  TransOK:				; ...
 17301 000070E3 BE[BE03]                		mov	si, OPENBUF
 17302 000070E6 16                      		push	ss
 17303 000070E7 1F                      		pop	ds
 17304 000070E8 E83DA1                  		call	FStrCpy
 17305 000070EB E92395                  		jmp	SYS_RET_OK
 17306                                  
 17307                                  ; =============== S U B	R O U T	I N E =======================================
 17308                                  
 17309                                  
 17310                                  DriveFromText:
 17311 000070EE 30C0                    		xor	al, al
 17312 000070F0 803C00                  		cmp	byte [si], 0
 17313 000070F3 74D3                    		jz	short Splice_retn
 17314 000070F5 807C013A                		cmp	byte [si+1], ':'
 17315 000070F9 75CD                    		jnz	short Splice_retn
 17316 000070FB AD                      		lodsw
 17317 000070FC 0C20                    		or	al, 20h
 17318 000070FE 2C60                    		sub	al, 60h
 17319 00007100 75C6                    		jnz	short Splice_retn
 17320 00007102 B0FF                    		mov	al, 0FFh
 17321 00007104 C3                      		retn
 17322                                  
 17323                                  ; =============== S U B	R O U T	I N E =======================================
 17324                                  
 17325                                  
 17326                                  TextFromDrive:
 17327 00007105 FEC0                    		inc	al
 17328                                  
 17329                                  TextFromDrive1:				; ...
 17330 00007107 0440                    		add	al, 40h	; '@'   ; 'A'-1
 17331 00007109 B43A                    		mov	ah, ':'
 17332 0000710B AB                      		stosw
 17333                                  
 17334                                  PathPref_retn:				; ...
 17335 0000710C C3                      		retn
 17336                                  
 17337                                  ; =============== S U B	R O U T	I N E =======================================
 17338                                  
 17339                                  
 17340                                  PathPref:
 17341 0000710D E82FA1                  		call	DStrLen
 17342 00007110 49                      		dec	cx
 17343 00007111 F3A6                    		repe cmpsb
 17344 00007113 75F7                    		jnz	short PathPref_retn
 17345 00007115 50                      		push	ax
 17346 00007116 8A44FF                  		mov	al, [si-1]
 17347 00007119 E86BE1                  		call	PATHCHRCMP
 17348 0000711C 7406                    		jz	short Prefix
 17349 0000711E 268A05                  		mov	al, [es:di]
 17350 00007121 E875FE                  		call	PathSepGotCh
 17351                                  
 17352                                  Prefix:					; ...
 17353 00007124 58                      		pop	ax
 17354 00007125 C3                      		retn
 17355                                  
 17356                                  ; =============== S U B	R O U T	I N E =======================================
 17357                                  
 17358                                  
 17359                                  ScanPathChar:
 17360 00007126 AC                      		lodsb
 17361 00007127 E86FFE                  		call	PathSepGotCh
 17362 0000712A 75FA                    		jnz	short ScanPathChar
 17363 0000712C E858E1                  		call	PATHCHRCMP
 17364 0000712F C3                      		retn
 17365                                  
 17366                                  ; =============== S U B	R O U T	I N E =======================================
 17367                                  
 17368                                  
 17369                                  $OPEN:
 17370 00007130 30E4                    		xor	ah, ah
 17371                                  
 17372                                  $Open2:					; ...
 17373 00007132 B516                    		mov	ch, 16h		; attr_hidden+attr_system+attr_directory
 17374 00007134 E85D02                  		call	SetAttrib
 17375 00007137 B9[802C]                		mov	cx, DOS_OPEN
 17376 0000713A 50                      		push	ax
 17377                                  
 17378                                  AccessFile:				; ...
 17379 0000713B E81CA2                  		call	ECritDisk	; ECritSFT
 17380 0000713E E8C1F7                  		call	SFNFree
 17381 00007141 E836A2                  		call	LCritDisk	; LCritSFT
 17382 00007144 7214                    		jb	short OpenFailJ
 17383 00007146 36891E[AA05]            		mov	[ss:SFN], bx
 17384 0000714B 36893E[9E05]            		mov	word [ss:THISSFT], di
 17385 00007150 368C06[A005]            		mov	word [ss:THISSFT+2], es
 17386 00007155 E897F7                  		call	JFNFree
 17387 00007158 7303                    		jnb	short SaveJFN
 17388                                  
 17389                                  OpenFailJ:				; ...
 17390 0000715A E99300                  		jmp	OpenFail
 17391                                  ; ---------------------------------------------------------------------------
 17392                                  
 17393                                  SaveJFN:				; ...
 17394 0000715D 36893E[AE05]            		mov	word [ss:PJFN], di
 17395 00007162 368C06[B005]            		mov	word [ss:PJFN+2], es
 17396 00007167 36891E[AC05]            		mov	[ss:JFN], bx
 17397 0000716C 368B1E[AA05]            		mov	bx, [ss:SFN]
 17398 00007171 26881D                  		mov	[es:di], bl
 17399 00007174 89D6                    		mov	si, dx
 17400 00007176 BF[BE03]                		mov	di, OPENBUF
 17401 00007179 51                      		push	cx
 17402 0000717A E83CFC                  		call	TransPath
 17403 0000717D 5B                      		pop	bx
 17404 0000717E 36C536[9E05]            		lds	si, [ss:THISSFT]
 17405 00007183 720A                    		jb	short OpenCleanJ
 17406 00007185 36803E[7A05]FF          		cmp	byte [ss:CMETA], 0FFh
 17407 0000718B 7404                    		jz	short SetSearch
 17408 0000718D B002                    		mov	al, 2
 17409                                  
 17410                                  OpenCleanJ:				; ...
 17411 0000718F EB50                    		jmp	short OpenClean
 17412                                  ; ---------------------------------------------------------------------------
 17413                                  
 17414                                  SetSearch:				; ...
 17415 00007191 58                      		pop	ax
 17416 00007192 31C9                    		xor	cx, cx
 17417 00007194 894C02                  		mov	[si+2],	cx
 17418 00007197 894C33                  		mov	[si+51], cx
 17419 0000719A 81FB[802C]              		cmp	bx, DOS_OPEN
 17420 0000719E 7509                    		jnz	short _DoOper
 17421 000071A0 A880                    		test	al, 80h
 17422 000071A2 7405                    		jz	short _DoOper
 17423 000071A4 247F                    		and	al, 7Fh
 17424 000071A6 B90010                  		mov	cx, 1000h
 17425                                  
 17426                                  _DoOper:				; ...
 17427 000071A9 57                      		push	di
 17428 000071AA 06                      		push	es
 17429 000071AB 1E                      		push	ds
 17430 000071AC 07                      		pop	es
 17431 000071AD 56                      		push	si
 17432 000071AE 5F                      		pop	di
 17433 000071AF E8BABA                  		call	Set_EXT_mode
 17434 000071B2 07                      		pop	es
 17435 000071B3 5F                      		pop	di
 17436 000071B4 16                      		push	ss
 17437 000071B5 1F                      		pop	ds
 17438 000071B6 51                      		push	cx
 17439 000071B7 FFD3                    		call	bx
 17440 000071B9 59                      		pop	cx
 17441 000071BA C536[9E05]              		lds	si, [THISSFT]
 17442 000071BE 721A                    		jb	short OpenE2
 17443                                  
 17444                                  OpenOK:
 17445 000071C0 C7040100                		mov	word [si], 1
 17446 000071C4 094C05                  		or	[si+5],	cx
 17447 000071C7 36A1[AC05]              		mov	ax, [ss:JFN]
 17448 000071CB 36FF1E[C000]            		call	far [ss:ShCol]
 17449 000071D0 36C706[AA05]FFFF        		mov	word [ss:SFN], 0FFFFh
 17450                                  
 17451                                  OpenOKJ:				; ...
 17452 000071D7 E93794                  		jmp	SYS_RET_OK
 17453                                  ; ---------------------------------------------------------------------------
 17454                                  
 17455                                  OpenE2:					; ...
 17456 000071DA 83F857                  		cmp	ax, 57h
 17457 000071DD 7503                    		jnz	short OpenE
 17458 000071DF EB11                    		jmp	short OpenCritLeave
 17459                                  ; ---------------------------------------------------------------------------
 17460                                  
 17461                                  OpenClean:				; ...
 17462 000071E1 5B                      		pop	bx
 17463                                  
 17464                                  OpenE:					; ...
 17465 000071E2 C7040000                		mov	word [si], 0
 17466 000071E6 36C536[AE05]            		lds	si, [ss:PJFN]
 17467 000071EB C604FF                  		mov	byte [si], 0FFh
 17468 000071EE EB02                    		jmp	short OpenCritLeave
 17469                                  ; ---------------------------------------------------------------------------
 17470                                  
 17471                                  OpenFail:				; ...
 17472 000071F0 FB                      		sti
 17473 000071F1 59                      		pop	cx
 17474                                  
 17475                                  OpenCritLeave:				; ...
 17476 000071F2 36C706[AA05]FFFF        		mov	word [ss:SFN], 0FFFFh
 17477 000071F9 36833E[2403]25          		cmp	word [ss:EXTERR], 25h
 17478 000071FF 7503                    		jnz	short NORERR
 17479 00007201 E91E94                  		jmp	From_GetSet
 17480                                  ; ---------------------------------------------------------------------------
 17481                                  
 17482                                  NORERR:					; ...
 17483 00007204 E91394                  		jmp	SYS_RET_ERR
 17484                                  
 17485                                  ; =============== S U B	R O U T	I N E =======================================
 17486                                  
 17487                                  
 17488                                  $CREAT:
 17489 00007207 51                      		push	cx
 17490 00007208 B9[542B]                		mov	cx, DOS_CREATE
 17491                                  
 17492                                  ; START	OF FUNCTION CHUNK FOR $CreateNewFile
 17493                                  
 17494                                  AccessSet:				; ...
 17495 0000720B 36C606[6D05]06          		mov	byte [ss:SATTRIB], 6	; attr_hidden+attr_system
 17496 00007211 E927FF                  		jmp	AccessFile
 17497                                  ; END OF FUNCTION CHUNK	FOR $CreateNewFile
 17498                                  ; ---------------------------------------------------------------------------
 17499                                  
 17500                                  $CHMOD:					; ...
 17501 00007214 BF[BE03]                		mov	di, OPENBUF
 17502 00007217 50                      		push	ax
 17503 00007218 51                      		push	cx
 17504 00007219 89D6                    		mov	si, dx
 17505 0000721B E89FFB                  		call	TransPathSet
 17506 0000721E 59                      		pop	cx
 17507 0000721F 58                      		pop	ax
 17508 00007220 7233                    		jb	short ChModErr
 17509 00007222 16                      		push	ss
 17510 00007223 1F                      		pop	ds
 17511 00007224 803E[7A05]FF            		cmp	byte [CMETA], 0FFh
 17512 00007229 752A                    		jnz	short ChModErr
 17513 0000722B C606[6D05]16            		mov	byte [SATTRIB], 16h
 17514 00007230 2C01                    		sub	al, 1
 17515 00007232 720B                    		jb	short ChModGet
 17516 00007234 7416                    		jz	short ChModSet
 17517 00007236 C606[2303]01            		mov	byte [EXTERR_LOCUS], 1
 17518 0000723B B001                    		mov	al, 1
 17519                                  ; START	OF FUNCTION CHUNK FOR $UNLINK
 17520                                  
 17521                                  ChModErrj:				; ...
 17522 0000723D EBC5                    		jmp	short NORERR
 17523                                  ; END OF FUNCTION CHUNK	FOR $UNLINK
 17524                                  ; ---------------------------------------------------------------------------
 17525                                  
 17526                                  ChModGet:				; ...
 17527 0000723F E8F8B7                  		call	GET_FILE_INFO
 17528 00007242 7213                    		jb	short ChModE
 17529 00007244 E85B92                  		call	Get_User_Stack
 17530 00007247 894404                  		mov	[si+4],	ax
 17531                                  ; START	OF FUNCTION CHUNK FOR $UNLINK
 17532                                  
 17533                                  OpenOkj2:				; ...
 17534 0000724A EB8B                    		jmp	short OpenOKJ
 17535                                  ; END OF FUNCTION CHUNK	FOR $UNLINK
 17536                                  ; ---------------------------------------------------------------------------
 17537                                  
 17538                                  ChModSet:				; ...
 17539 0000724C 89C8                    		mov	ax, cx
 17540 0000724E E84AB8                  		call	SET_FILE_ATTRIBUTE
 17541 00007251 7204                    		jb	short ChModE
 17542                                  ; START	OF FUNCTION CHUNK FOR $UNLINK
 17543                                  
 17544                                  OpenOkj3:				; ...
 17545 00007253 EBF5                    		jmp	short OpenOkj2
 17546                                  ; ---------------------------------------------------------------------------
 17547                                  
 17548                                  ChModErr:				; ...
 17549 00007255 B003                    		mov	al, 3
 17550                                  
 17551                                  ChModE:					; ...
 17552 00007257 EBE4                    		jmp	short ChModErrj
 17553                                  ; END OF FUNCTION CHUNK	FOR $UNLINK
 17554                                  
 17555                                  ; =============== S U B	R O U T	I N E =======================================
 17556                                  
 17557                                  
 17558                                  $UNLINK:
 17559                                  
 17560                                  ; FUNCTION CHUNK AT B01D SIZE 00000002 BYTES
 17561                                  ; FUNCTION CHUNK AT B02A SIZE 00000002 BYTES
 17562                                  ; FUNCTION CHUNK AT B033 SIZE 00000006 BYTES
 17563                                  
 17564 00007259 51                      		push	cx
 17565 0000725A 89D6                    		mov	si, dx
 17566 0000725C BF[BE03]                		mov	di, OPENBUF
 17567 0000725F E85BFB                  		call	TransPathSet
 17568 00007262 59                      		pop	cx
 17569 00007263 72F0                    		jb	short ChModErr
 17570 00007265 36803E[7A05]FF          		cmp	byte [ss:CMETA], 0FFh ; -1
 17571 0000726B 750E                    		jnz	short NotFound
 17572 0000726D 16                      		push	ss
 17573 0000726E 1F                      		pop	ds
 17574 0000726F B506                    		mov	ch, 6
 17575 00007271 E82001                  		call	SetAttrib
 17576 00007274 E8A6B3                  		call	DOS_DELETE
 17577 00007277 7204                    		jb	short UnlinkE
 17578                                  
 17579                                  UnLinkOK:				; ...
 17580 00007279 EBD8                    		jmp	short OpenOkj3
 17581                                  ; ---------------------------------------------------------------------------
 17582                                  
 17583                                  NotFound:				; ...
 17584 0000727B B003                    		mov	al, 3
 17585                                  
 17586                                  UnlinkE:				; ...
 17587 0000727D EBD8                    		jmp	short ChModE
 17588                                  
 17589                                  ; ---------------------------------------------------------------------------
 17590                                  
 17591                                  $RENAME:				; ...
 17592 0000727F 51                      		push	cx
 17593 00007280 1E                      		push	ds
 17594 00007281 52                      		push	dx
 17595 00007282 06                      		push	es
 17596 00007283 1F                      		pop	ds
 17597 00007284 89FE                    		mov	si, di
 17598 00007286 BF[3E04]                		mov	di, RENBUF
 17599 00007289 E831FB                  		call	TransPathSet
 17600 0000728C 36FF36[B205]            		push	word [ss:WFP_START]
 17601 00007291 368F06[B405]            		pop	word [ss:REN_WFP]
 17602 00007296 5E                      		pop	si
 17603 00007297 1F                      		pop	ds
 17604 00007298 59                      		pop	cx
 17605                                  
 17606                                  epjc2:					; ...
 17607 00007299 72BA                    		jb	short ChModErr
 17608 0000729B 36803E[7A05]FF          		cmp	byte [ss:CMETA], 0FFh
 17609 000072A1 75D8                    		jnz	short NotFound
 17610 000072A3 51                      		push	cx
 17611 000072A4 BF[BE03]                		mov	di, OPENBUF
 17612 000072A7 E813FB                  		call	TransPathSet
 17613 000072AA 59                      		pop	cx
 17614 000072AB 72EC                    		jb	short epjc2
 17615 000072AD 16                      		push	ss
 17616 000072AE 1F                      		pop	ds
 17617 000072AF 803E[7A05]FF            		cmp	byte [CMETA], 0FFh
 17618 000072B4 72C5                    		jb	short NotFound
 17619 000072B6 FF36[A205]              		push	word [THISCDS]
 17620 000072BA FF36[A405]              		push	word [THISCDS+2]
 17621 000072BE BF[BE03]                		mov	di, OPENBUF
 17622 000072C1 16                      		push	ss
 17623 000072C2 07                      		pop	es
 17624 000072C3 30C0                    		xor	al, al
 17625                                  
 17626                                  rnloop:					; ...
 17627 000072C5 E86BFA                  		call	GetCDSFromDrv
 17628 000072C8 7210                    		jb	short dorn
 17629 000072CA E82A9F                  		call	StrCmp
 17630 000072CD 7404                    		jz	short rnerr
 17631 000072CF FEC0                    		inc	al
 17632 000072D1 EBF2                    		jmp	short rnloop
 17633                                  ; ---------------------------------------------------------------------------
 17634                                  
 17635                                  rnerr:					; ...
 17636 000072D3 83C404                  		add	sp, 4
 17637 000072D6 B010                    		mov	al, 10h
 17638 000072D8 EBA3                    		jmp	short UnlinkE
 17639                                  ; ---------------------------------------------------------------------------
 17640                                  
 17641                                  dorn:					; ...
 17642 000072DA 368F06[A405]            		pop	word [ss:THISCDS+2]
 17643 000072DF 368F06[A205]            		pop	word [ss:THISCDS]
 17644 000072E4 16                      		push	ss
 17645 000072E5 1F                      		pop	ds
 17646 000072E6 B516                    		mov	ch, 16h		; attr_directory+attr_hidden+attr_system
 17647 000072E8 E8A900                  		call	SetAttrib
 17648 000072EB E80FB5                  		call	DOS_RENAME
 17649 000072EE 728D                    		jb	short UnlinkE
 17650 000072F0 EB87                    		jmp	short UnLinkOK
 17651                                  
 17652                                  ; =============== S U B	R O U T	I N E =======================================
 17653                                  
 17654                                  
 17655                                  $CreateNewFile:
 17656                                  
 17657                                  ; FUNCTION CHUNK AT AFEB SIZE 00000009 BYTES
 17658                                  
 17659 000072F2 51                      		push	cx
 17660 000072F3 B9[232C]                		mov	cx, DOS_Create_New
 17661 000072F6 E912FF                  		jmp	AccessSet
 17662                                  
 17663                                  ; =============== S U B	R O U T	I N E =======================================
 17664                                  
 17665                                  
 17666                                  BinToAscii:
 17667 000072F9 B90404                  		mov	cx, 404h
 17668                                  
 17669                                  bta5:					; ...
 17670 000072FC D3C0                    		rol	ax, cl
 17671 000072FE 50                      		push	ax
 17672 000072FF 240F                    		and	al, 0Fh
 17673 00007301 0441                    		add	al, 'A'
 17674 00007303 AA                      		stosb
 17675 00007304 58                      		pop	ax
 17676 00007305 FECD                    		dec	ch
 17677 00007307 75F3                    		jnz	short bta5
 17678 00007309 C3                      		retn
 17679                                  
 17680                                  ; ---------------------------------------------------------------------------
 17681                                  
 17682                                  $CreateTempFile:			; ...
 17683 0000730A 55                      		push	bp
 17684 0000730B 89E5                    		mov	bp, sp
 17685 0000730D 83EC0A                  		sub	sp, 10
 17686 00007310 F7C1D8FF                		test	cx, 0FFD8h	; ~attr_changeable
 17687 00007314 7405                    		jz	short OKatts
 17688 00007316 B80500                  		mov	ax, 5
 17689 00007319 EB6D                    		jmp	short SETTMPERR
 17690                                  ; ---------------------------------------------------------------------------
 17691                                  
 17692                                  OKatts:					; ...
 17693 0000731B 894EF6                  		mov	[bp-10], cx
 17694 0000731E 8956F8                  		mov	[bp-8],	dx
 17695 00007321 8C5EFA                  		mov	word [bp-6], ds
 17696 00007324 8C5EFE                  		mov	word [bp-2], ds
 17697 00007327 1E                      		push	ds
 17698 00007328 07                      		pop	es
 17699 00007329 89D7                    		mov	di, dx
 17700 0000732B 89F9                    		mov	cx, di
 17701 0000732D F7D9                    		neg	cx
 17702 0000732F 09C9                    		or	cx, cx
 17703 00007331 7503                    		jnz	short okok
 17704 00007333 B9FFFF                  		mov	cx, 0FFFFh
 17705                                  
 17706                                  okok:					; ...
 17707 00007336 31C0                    		xor	ax, ax
 17708 00007338 F2AE                    		repne scasb
 17709 0000733A 4F                      		dec	di
 17710 0000733B 268A45FF                		mov	al, [es:di-1]
 17711 0000733F E845DF                  		call	PATHCHRCMP
 17712 00007342 7403                    		jz	short SETENDPTR
 17713 00007344 B05C                    		mov	al, '\'
 17714 00007346 AA                      		stosb
 17715                                  
 17716                                  SETENDPTR:				; ...
 17717 00007347 897EFC                  		mov	[bp-4],	di
 17718                                  
 17719                                  CreateLoop:				; ...
 17720 0000734A 16                      		push	ss
 17721 0000734B 1F                      		pop	ds
 17722 0000734C 55                      		push	bp
 17723 0000734D E8C897                  		call	READTIME
 17724 00007350 5D                      		pop	bp
 17725 00007351 C47EFC                  		les	di, [bp-4]
 17726 00007354 89C8                    		mov	ax, cx
 17727 00007356 E8A0FF                  		call	BinToAscii
 17728 00007359 89D0                    		mov	ax, dx
 17729 0000735B E89BFF                  		call	BinToAscii
 17730 0000735E 30C0                    		xor	al, al
 17731 00007360 AA                      		stosb
 17732 00007361 C556F8                  		lds	dx, [bp-8]
 17733 00007364 8B4EF6                  		mov	cx, [bp-10]
 17734 00007367 55                      		push	bp
 17735 00007368 E887FF                  		call	$CreateNewFile
 17736 0000736B 5D                      		pop	bp
 17737 0000736C 731B                    		jnb	short CreateDone
 17738 0000736E 3C50                    		cmp	al, 50h
 17739 00007370 74D8                    		jz	short CreateLoop
 17740 00007372 3C05                    		cmp	al, 5
 17741 00007374 7512                    		jnz	short SETTMPERR
 17742 00007376 36833E[2403]41          		cmp	word [ss:EXTERR], 41h
 17743 0000737C 740A                    		jz	short SETTMPERR
 17744 0000737E 36833E[2403]53          		cmp	word [ss:EXTERR], 53h
 17745 00007384 7402                    		jz	short SETTMPERR
 17746 00007386 EBC2                    		jmp	short CreateLoop
 17747                                  ; ---------------------------------------------------------------------------
 17748                                  
 17749                                  SETTMPERR:				; ...
 17750 00007388 F9                      		stc
 17751                                  
 17752                                  CreateDone:				; ...
 17753 00007389 89EC                    		mov	sp, bp
 17754 0000738B 5D                      		pop	bp
 17755 0000738C 7203                    		jb	short CreateFail
 17756 0000738E E98092                  		jmp	SYS_RET_OK
 17757                                  ; ---------------------------------------------------------------------------
 17758                                  ; START	OF FUNCTION CHUNK FOR $Extended_Open
 17759                                  
 17760                                  CreateFail:				; ...
 17761 00007391 E98692                  		jmp	SYS_RET_ERR
 17762                                  ; END OF FUNCTION CHUNK	FOR $Extended_Open
 17763                                  
 17764                                  ; =============== S U B	R O U T	I N E =======================================
 17765                                  
 17766                                  
 17767                                  SetAttrib:
 17768 00007394 36F606[7205]FF          		test	byte [ss:FSHARING], 0FFh
 17769 0000739A 7502                    		jnz	short Set
 17770 0000739C 88E9                    		mov	cl, ch
 17771                                  
 17772                                  Set:					; ...
 17773 0000739E 36880E[6D05]            		mov	byte [ss:SATTRIB], cl
 17774 000073A3 C3                      		retn
 17775                                  
 17776                                  ; =============== S U B	R O U T	I N E =======================================
 17777                                  
 17778                                  
 17779                                  $Extended_Open:
 17780                                  
 17781                                  ; FUNCTION CHUNK AT B171 SIZE 00000003 BYTES
 17782                                  
 17783 000073A4 368916[F405]            		mov	[ss:EXTOPEN_FLAG], dx
 17784 000073A9 36C706[F705]0000        		mov	word [ss:EXTOPEN_IO_MODE], 0
 17785 000073B0 F7C200FE                		test	dx, 0FE00h	; RESERVED_BITS_MASK
 17786 000073B4 7545                    		jnz	short ext_inval2
 17787 000073B6 88D4                    		mov	ah, dl
 17788 000073B8 80FA00                  		cmp	dl, 0
 17789 000073BB 743E                    		jz	short ext_inval2
 17790 000073BD 80E20F                  		and	dl, 0Fh
 17791 000073C0 80FA02                  		cmp	dl, 2
 17792 000073C3 7736                    		ja	short ext_inval2
 17793 000073C5 80E4F0                  		and	ah, 0F0h
 17794 000073C8 80FC10                  		cmp	ah, 10h
 17795 000073CB 772E                    		ja	short ext_inval2
 17796 000073CD 368C06[FB05]            		mov	[ss:SAVE_ES], es
 17797 000073D2 36893E[F905]            		mov	[ss:SAVE_DI], di
 17798 000073D7 36FF36[F405]            		push	word [ss:EXTOPEN_FLAG]
 17799 000073DC 368F06[FD05]            		pop	word [ss:SAVE_DX]
 17800 000073E1 36890E[FF05]            		mov	[ss:SAVE_CX], cx
 17801 000073E6 36891E[0106]            		mov	[ss:SAVE_BX], bx
 17802 000073EB 368C1E[0506]            		mov	[ss:SAVE_DS], ds
 17803 000073F0 368936[0306]            		mov	[ss:SAVE_SI], si
 17804 000073F5 89F2                    		mov	dx, si
 17805 000073F7 89D8                    		mov	ax, bx
 17806 000073F9 EB0B                    		jmp	short goopen2
 17807                                  ; ---------------------------------------------------------------------------
 17808                                  
 17809                                  ext_inval2:				; ...
 17810 000073FB B001                    		mov	al, 1
 17811                                  
 17812                                  jmp_to_CreateFail:			; ...
 17813 000073FD EB92                    		jmp	short CreateFail
 17814                                  ; ---------------------------------------------------------------------------
 17815                                  
 17816                                  ext_inval_parm:
 17817 000073FF 59                      		pop	cx
 17818 00007400 5E                      		pop	si
 17819 00007401 B00D                    		mov	al, 13
 17820 00007403 EBF8                    		jmp	short jmp_to_CreateFail
 17821                                  ; ---------------------------------------------------------------------------
 17822                                  
 17823                                  error_return:				; ...
 17824 00007405 C3                      		retn
 17825                                  ; ---------------------------------------------------------------------------
 17826                                  
 17827                                  goopen2:				; ...
 17828 00007406 F7C30020                		test	bx, 2000h
 17829 0000740A 7406                    		jz	short goopen
 17830 0000740C 36800E[F605]02          		or	byte [ss:EXTOPEN_ON], 2
 17831                                  
 17832                                  goopen:					; ...
 17833 00007412 36800E[F605]01          		or	byte [ss:EXTOPEN_ON], 1
 17834 00007418 368126[F405]FF00        		and	word [ss:EXTOPEN_FLAG], 0FFh
 17835 0000741F 36833E[F405]10          		cmp	word [ss:EXTOPEN_FLAG], 10h
 17836 00007425 751A                    		jnz	short chknext
 17837 00007427 E8C8FE                  		call	$CreateNewFile
 17838 0000742A 72D9                    		jb	short error_return
 17839 0000742C 36803E[F605]00          		cmp	byte [ss:EXTOPEN_ON], 0
 17840 00007432 740A                    		jz	short ok_return2
 17841 00007434 36C706[F405]0200        		mov	word [ss:EXTOPEN_FLAG], 2
 17842 0000743B E98300                  		jmp	setXAttr
 17843                                  ; ---------------------------------------------------------------------------
 17844                                  
 17845                                  ok_return2:				; ...
 17846 0000743E E9D091                  		jmp	SYS_RET_OK
 17847                                  ; ---------------------------------------------------------------------------
 17848                                  
 17849                                  chknext:				; ...
 17850 00007441 36F706[F405]0100        		test	word [ss:EXTOPEN_FLAG], 1
 17851 00007448 7527                    		jnz	short exist_open
 17852 0000744A E8BAFD                  		call	$CREAT
 17853 0000744D 72B6                    		jb	short error_return
 17854 0000744F 36803E[F605]00          		cmp	byte [ss:EXTOPEN_ON], 0
 17855 00007455 74E7                    		jz	short ok_return2
 17856 00007457 36C706[F405]0200        		mov	word [ss:EXTOPEN_FLAG], 2
 17857 0000745E 36F606[F605]04          		test	byte [ss:EXTOPEN_ON], 4
 17858 00007464 755B                    		jnz	short setXAttr
 17859 00007466 36C706[F405]0300        		mov	word [ss:EXTOPEN_FLAG], 3
 17860 0000746D EB52                    		jmp	short setXAttr
 17861                                  ; ---------------------------------------------------------------------------
 17862                                  
 17863                                  error_return2:				; ...
 17864 0000746F F9                      		stc
 17865 00007470 C3                      		retn
 17866                                  ; ---------------------------------------------------------------------------
 17867                                  
 17868                                  exist_open:				; ...
 17869 00007471 36F606[7205]FF          		test	byte [ss:FSHARING], 0FFh
 17870 00007477 7402                    		jz	short noserver
 17871 00007479 88E9                    		mov	cl, ch
 17872                                  
 17873                                  noserver:				; ...
 17874 0000747B E8B4FC                  		call	$Open2
 17875 0000747E 7332                    		jnb	short ext_ok
 17876 00007480 36803E[F605]00          		cmp	byte [ss:EXTOPEN_ON], 0
 17877 00007486 74E7                    		jz	short error_return2
 17878 00007488 83F802                  		cmp	ax, 2
 17879 0000748B 75E2                    		jnz	short error_return2
 17880 0000748D 36F706[F405]1000        		test	word [ss:EXTOPEN_FLAG], 10h
 17881 00007494 7502                    		jnz	short do_creat
 17882 00007496 EB5E                    		jmp	short extexit
 17883                                  ; ---------------------------------------------------------------------------
 17884                                  
 17885                                  do_creat:				; ...
 17886 00007498 368B0E[FF05]            		mov	cx, [ss:SAVE_CX]
 17887 0000749D 36C536[0306]            		lds	si, [ss:SAVE_SI]
 17888 000074A2 89F2                    		mov	dx, si
 17889 000074A4 E860FD                  		call	$CREAT
 17890 000074A7 724D                    		jb	short extexit
 17891 000074A9 36C706[F405]0200        		mov	word [ss:EXTOPEN_FLAG], 2
 17892 000074B0 EB0F                    		jmp	short setXAttr
 17893                                  ; ---------------------------------------------------------------------------
 17894                                  
 17895                                  ext_ok:					; ...
 17896 000074B2 36803E[F605]00          		cmp	byte [ss:EXTOPEN_ON], 0
 17897 000074B8 7415                    		jz	short ok_return
 17898 000074BA 36C706[F405]0100        		mov	word [ss:EXTOPEN_FLAG], 1
 17899                                  
 17900                                  setXAttr:				; ...
 17901 000074C1 50                      		push	ax
 17902 000074C2 E8DD8F                  		call	Get_User_Stack
 17903 000074C5 36A1[F405]              		mov	ax, [ss:EXTOPEN_FLAG]
 17904 000074C9 894404                  		mov	[si+4],	ax
 17905 000074CC 58                      		pop	ax
 17906 000074CD 8904                    		mov	[si], ax
 17907                                  
 17908                                  ok_return:				; ...
 17909 000074CF E93F91                  		jmp	SYS_RET_OK
 17910                                  ; ---------------------------------------------------------------------------
 17911                                  
 17912                                  extexit2:
 17913 000074D2 5B                      		pop	bx
 17914 000074D3 50                      		push	ax
 17915 000074D4 36833E[F405]02          		cmp	word [ss:EXTOPEN_FLAG], 2
 17916 000074DA 750C                    		jnz	short justopen
 17917 000074DC 36C536[0306]            		lds	si, [ss:SAVE_SI]
 17918 000074E1 C514                    		lds	dx, [si]
 17919 000074E3 E873FD                  		call	$UNLINK
 17920 000074E6 EB03                    		jmp	short reserror
 17921                                  ; ---------------------------------------------------------------------------
 17922                                  
 17923                                  justopen:				; ...
 17924 000074E8 E860F4                  		call	$CLOSE
 17925                                  
 17926                                  reserror:				; ...
 17927 000074EB 58                      		pop	ax
 17928 000074EC EB08                    		jmp	short extexit
 17929                                  ; ---------------------------------------------------------------------------
 17930 000074EE B80200                  		mov	ax, 2
 17931 000074F1 EB03                    		jmp	short extexit
 17932                                  ; ---------------------------------------------------------------------------
 17933 000074F3 B80100                  		mov	ax, 1
 17934                                  
 17935                                  extexit:				; ...
 17936 000074F6 E92191                  		jmp	SYS_RET_ERR
 17937                                  
 17938                                  ; ---------------------------------------------------------------------------
 17939                                  
 17940                                  $LockOper:				; ...
 17941 000074F9 3C01                    		cmp	al, 1
 17942 000074FB 770C                    		ja	short lock_bad_func
 17943 000074FD 57                      		push	di
 17944 000074FE E8A9F3                  		call	SFFromHandle
 17945 00007501 7310                    		jnb	short lock_do
 17946 00007503 5F                      		pop	di
 17947 00007504 B006                    		mov	al, 6
 17948                                  
 17949                                  LockOperErrj:				; ...
 17950 00007506 E91191                  		jmp	SYS_RET_ERR
 17951                                  ; ---------------------------------------------------------------------------
 17952                                  
 17953                                  lock_bad_func:				; ...
 17954 00007509 36C606[2303]01          		mov	byte [ss:EXTERR_LOCUS], 1
 17955 0000750F B001                    		mov	al, 1
 17956                                  
 17957                                  LockOperErr:				; ...
 17958 00007511 EBF3                    		jmp	short LockOperErrj
 17959                                  ; ---------------------------------------------------------------------------
 17960                                  
 17961                                  lock_do:				; ...
 17962 00007513 89C3                    		mov	bx, ax
 17963 00007515 BD[A903]                		mov	bp, Lock_Buffer
 17964 00007518 895600                  		mov	[bp+0],	dx
 17965 0000751B 894E02                  		mov	[bp+2],	cx
 17966 0000751E 59                      		pop	cx
 17967 0000751F 894E04                  		mov	[bp+4],	cx
 17968 00007522 897606                  		mov	[bp+6],	si
 17969 00007525 B90100                  		mov	cx, 1
 17970 00007528 16                      		push	ss
 17971 00007529 1F                      		pop	ds
 17972 0000752A 89EA                    		mov	dx, bp
 17973 0000752C A801                    		test	al, 1
 17974 0000752E 7502                    		jnz	short DOS_Unlock
 17975 00007530 EB1C                    		jmp	short DOS_Lock
 17976                                  ; ---------------------------------------------------------------------------
 17977                                  
 17978                                  DOS_Unlock:				; ...
 17979 00007532 26F6450680              		test	byte [es:di+6], 80h
 17980 00007537 7407                    		jz	short LOCAL_UNLOCK
 17981 00007539 B80A11                  		mov	ax, 110Ah
 17982 0000753C CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - LOCK	REGION OF FILE
 17983                                  					; BX = file handle, CX:DX = starting offset, SI	= high word of size
 17984                                  					; STACK: WORD low word of size,	[es:DI -> SFT
 17985                                  					; SFT DPB field	-> DPB of drive	containing file, SS = DOS CS
 17986                                  					; Return: CF set error
 17987 0000753E EB04                    		jmp	short ValChk
 17988                                  ; ---------------------------------------------------------------------------
 17989                                  
 17990                                  LOCAL_UNLOCK:				; ...
 17991 00007540 FF1E[AC00]              		call	far [clr_block]
 17992                                  
 17993                                  ValChk:					; ...
 17994 00007544 7302                    		jnb	short Lock_OK
 17995 00007546 EBC9                    		jmp	short LockOperErr
 17996                                  ; ---------------------------------------------------------------------------
 17997                                  
 17998                                  Lock_OK:				; ...
 17999 00007548 A1[0C06]                		mov	ax, [TEMP_VAR]
 18000 0000754B E9C390                  		jmp	SYS_RET_OK
 18001                                  ; ---------------------------------------------------------------------------
 18002                                  
 18003                                  DOS_Lock:				; ...
 18004 0000754E 26F6450680              		test	byte [es:di+6], 80h
 18005 00007553 7407                    		jz	short LOCAL_LOCK
 18006 00007555 B80A11                  		mov	ax, 110Ah
 18007 00007558 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - LOCK	REGION OF FILE
 18008                                  					; BX = file handle, CX:DX = starting offset, SI	= high word of size
 18009                                  					; STACK: WORD low word of size,	[es:DI -> SFT
 18010                                  					; SFT DPB field	-> DPB of drive	containing file, SS = DOS CS
 18011                                  					; Return: CF set error
 18012 0000755A EBE8                    		jmp	short ValChk
 18013                                  ; ---------------------------------------------------------------------------
 18014                                  
 18015                                  LOCAL_LOCK:				; ...
 18016 0000755C FF1E[A800]              		call	far [set_block]
 18017 00007560 EBE2                    		jmp	short ValChk
 18018                                  
 18019                                  ; =============== S U B	R O U T	I N E =======================================
 18020                                  
 18021                                  
 18022                                  LOCK_CHECK:
 18023 00007562 8B1E[1A00]              		mov	bx, [RetryCount]
 18024                                  
 18025                                  LockRetry:				; ...
 18026 00007566 53                      		push	bx
 18027 00007567 50                      		push	ax
 18028 00007568 FF1E[B000]              		call	far [chk_block]
 18029 0000756C 58                      		pop	ax
 18030 0000756D 5B                      		pop	bx
 18031 0000756E 7307                    		jnb	short lc_ret_label
 18032 00007570 E8DD9C                  		call	Idle
 18033 00007573 4B                      		dec	bx
 18034 00007574 75F0                    		jnz	short LockRetry
 18035 00007576 F9                      		stc
 18036                                  
 18037                                  lc_ret_label:				; ...
 18038 00007577 C3                      		retn
 18039                                  
 18040                                  ; =============== S U B	R O U T	I N E =======================================
 18041                                  
 18042                                  
 18043                                  LOCK_VIOLATION:
 18044 00007578 1E                      		push	ds
 18045 00007579 06                      		push	es
 18046 0000757A 57                      		push	di
 18047 0000757B 51                      		push	cx
 18048 0000757C B82100                  		mov	ax, 21h		; error_lock_violation
 18049 0000757F C606[4B03]18            		mov	byte [ALLOWED], 18h	; Allowed_FAIL+Allowed_RETRY
 18050 00007584 C42E[8A05]              		les	bp, [THISDPB]
 18051 00007588 BF0100                  		mov	di, 1
 18052 0000758B 89F9                    		mov	cx, di
 18053 0000758D 268B560B                		mov	dx, [es:bp+0Bh]	; [ES:BP+DPB.FIRST_SECTOR]
 18054 00007591 E862DF                  		call	HARDERR
 18055 00007594 59                      		pop	cx
 18056 00007595 5F                      		pop	di
 18057 00007596 07                      		pop	es
 18058 00007597 1F                      		pop	ds
 18059 00007598 3C01                    		cmp	al, 1
 18060 0000759A 74DB                    		jz	short lc_ret_label
 18061 0000759C F9                      		stc
 18062 0000759D C3                      		retn
 18063                                  
 18064                                  ; =============== S U B	R O U T	I N E =======================================
 18065                                  
 18066                                  
 18067                                  CheckShare:
 18068 0000759E 1E                      		push	ds
 18069 0000759F 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
 18070 000075A4 803E[0303]00            		cmp	byte [fShare], 0
 18071 000075A9 1F                      		pop	ds
 18072 000075AA C3                      		retn
 18073                                  
 18074                                  ; =============== S U B	R O U T	I N E =======================================
 18075                                  
 18076                                  
 18077                                  SHARE_CHECK:
 18078 000075AB FF1E[9400]              		call	far [MFT_enter]
 18079                                  
 18080                                  shchk_retn:				; ...
 18081 000075AF C3                      		retn
 18082                                  
 18083                                  ; =============== S U B	R O U T	I N E =======================================
 18084                                  
 18085                                  
 18086                                  SHARE_VIOLATION:
 18087 000075B0 1E                      		push	ds
 18088 000075B1 06                      		push	es
 18089 000075B2 57                      		push	di
 18090 000075B3 C606[7505]00            		mov	byte [READOP], 0
 18091 000075B8 C606[4B03]18            		mov	byte [ALLOWED], 18h	; Allowed_FAIL+Allowed_RETRY
 18092 000075BD C42E[8A05]              		les	bp, [THISDPB]
 18093 000075C1 BF0100                  		mov	di, 1
 18094 000075C4 89F9                    		mov	cx, di
 18095 000075C6 268B5611                		mov	dx, [es:bp+17]	; [ES:BP+DPB.DIR_SECTOR]
 18096 000075CA E829DF                  		call	HARDERR
 18097 000075CD 5F                      		pop	di
 18098 000075CE 07                      		pop	es
 18099 000075CF 1F                      		pop	ds
 18100 000075D0 3C01                    		cmp	al, 1
 18101 000075D2 74DB                    		jz	short shchk_retn
 18102 000075D4 F9                      		stc
 18103 000075D5 C3                      		retn
 18104                                  
 18105                                  ; =============== S U B	R O U T	I N E =======================================
 18106                                  
 18107                                  
 18108                                  ShareEnd:
 18109 000075D6 FF1E[9800]              		call	far [MFTClose]
 18110 000075DA C3                      		retn
 18111                                  
 18112                                  ; =============== S U B	R O U T	I N E =======================================
 18113                                  
 18114                                  
 18115                                  ShareEnter:
 18116 000075DB 51                      		push	cx
 18117                                  
 18118                                  retry:					; ...
 18119 000075DC 8B0E[1A00]              		mov	cx, [RetryCount]
 18120                                  
 18121                                  attempt:				; ...
 18122 000075E0 C43E[9E05]              		les	di, [THISSFT]
 18123 000075E4 31C0                    		xor	ax, ax
 18124 000075E6 26894533                		mov	[es:di+51], ax	; [ES:DI+SF_ENTRY.sf_MFT]
 18125 000075EA 51                      		push	cx
 18126 000075EB E8BDFF                  		call	SHARE_CHECK
 18127 000075EE 59                      		pop	cx
 18128 000075EF 730A                    		jnb	short done
 18129 000075F1 E85C9C                  		call	Idle
 18130 000075F4 E2EA                    		loop	attempt
 18131 000075F6 E8B7FF                  		call	SHARE_VIOLATION
 18132 000075F9 73E1                    		jnb	short retry
 18133                                  
 18134                                  done:					; ...
 18135 000075FB 59                      		pop	cx
 18136 000075FC C3                      		retn
 18137                                  
 18138                                  ; =============== S U B	R O U T	I N E =======================================
 18139                                  
 18140                                  
 18141                                  ExecReady:
 18142 000075FD 89D6                    		mov	si, dx
 18143 000075FF F744020100              		test	word [si+2], 1
 18144 00007604 7418                    		jz	short er_setver
 18145 00007606 8B4408                  		mov	ax, [si+8]
 18146 00007609 83C010                  		add	ax, 10h
 18147 0000760C 8EC0                    		mov	es, ax
 18148 0000760E 8B4C0A                  		mov	cx, [si+0Ah]
 18149 00007611 8B440C                  		mov	ax, [si+0Ch]
 18150 00007614 36FF16[1212]            		call	word [ss:FixExePatch]
 18151 00007619 36FF16[6213]            		call	word [ss:Rational386PatchPtr]
 18152                                  
 18153                                  er_setver:				; ...
 18154 0000761E F744020200              		test	word [si+2], 2
 18155 00007623 7518                    		jnz	short er_chkdoshi
 18156 00007625 1E                      		push	ds
 18157 00007626 56                      		push	si
 18158 00007627 C57404                  		lds	si, [si+4]
 18159 0000762A E82CED                  		call	Scan_Execname1
 18160 0000762D E83DED                  		call	Scan_Special_Entries
 18161 00007630 5E                      		pop	si
 18162 00007631 1F                      		pop	ds
 18163 00007632 8E4408                  		mov	es, word [si+8]
 18164 00007635 36A1[BD0E]              		mov	ax, [ss:SPECIAL_VERSION]
 18165 00007639 26A34000                		mov	[es:40h], ax	; [es:PDB.Version]
 18166                                  
 18167                                  er_chkdoshi:				; ...
 18168 0000763D 36803E[1112]00          		cmp	byte [ss:DosHasHMA], 0
 18169 00007643 7420                    		jz	short er_done
 18170 00007645 8B4408                  		mov	ax, [si+8]
 18171 00007648 36800E[8600]04          		or	byte [ss:DOS_FLAG], 4
 18172 0000764E F744020100              		test	word [si+2], 1
 18173 00007653 7507                    		jnz	short er_seta20
 18174 00007655 1E                      		push	ds
 18175 00007656 8ED8                    		mov	ds, ax
 18176 00007658 E8D705                  		call	IsCopyProt
 18177 0000765B 1F                      		pop	ds
 18178                                  
 18179                                  er_seta20:				; ...
 18180 0000765C 36FE06[8500]            		inc	byte [ss:A20OFF_COUNT]
 18181 00007661 36A3[6300]              		mov	[ss:A20OFF_PSP], ax
 18182                                  
 18183                                  er_done:				; ...
 18184 00007665 31C0                    		xor	ax, ax
 18185 00007667 C3                      		retn
 18186                                  
 18187                                  ; ---------------------------------------------------------------------------
 18188 00007668 FAE4216033C0E6438B-     rpFind1:	db 0FAh, 0E4h, 21h, 60h, 33h, 0C0h, 0E6h, 43h, 8Bh, 16h	; ...
 18188 00007671 16                 
 18189 00007672 B00EE63733C0E6F2        rpFind1a:	db 0B0h, 0Eh, 0E6h, 37h, 33h, 0C0h, 0E6h, 0F2h ; ...
 18190 0000767A 0F20C0                  rpFind2:	db 0Fh,	20h, 0C0h	; ...
 18191 0000767D 0F22C0EA                rpFind3:	db 0Fh,	22h, 0C0h, 0EAh	; ...
 18192 00007681 6650510F20C0            rpRepl2:	db 66h,	50h, 51h, 0Fh, 20h, 0C0h ; ...
 18193 00007687 8ED3596658              rpRepl3:	db 8Eh,	0D3h, 59h, 66h,	58h ; ...
 18194 0000768C 93588BCC                rpFind4:	db 93h,	58h, 8Bh, 0CCh	; ...
 18195 00007690 B80CDECD678BE1FFE3      rpFind5:	db 0B8h, 0Ch, 0DEh, 0CDh, 67h, 8Bh, 0E1h, 0FFh,	0E3h ; ...
 18196 00007699 93588BCC                rpRepl4:	db 93h,	58h, 8Bh, 0CCh	; ...
 18197 0000769D 2E66A3                  		db 2Eh,	66h, 0A3h
 18198 000076A0 0000                    		db 2 dup(0)
 18199 000076A2 2E668936                		db 2Eh,	66h, 89h, 36h
 18200 000076A6 0000                    		db 2 dup(0)
 18201 000076A8 8BE1                    rpRepl5:	db 8Bh,	0E1h		; ...
 18202 000076AA 2E66A1                  		db 2Eh,	66h, 0A1h
 18203 000076AD 0000                    		db 2 dup(0)
 18204 000076AF 2E668B36                		db 2Eh,	66h, 8Bh, 36h
 18205 000076B3 0000                    		db 2 dup(0)
 18206 000076B5 FFE3                    		db 0FFh, 0E3h
 18207 000076B7 FA5251                  rpFind6:	db 0FAh, 52h, 51h	; ...
 18208 000076BA B80CDE6626FF1E          rpFind7a:	db 0B8h, 0Ch, 0DEh, 66h, 26h, 0FFh, 1Eh	; ...
 18209 000076C1 595A5B                  rpFind7b:	db 59h,	5Ah, 5Bh	; ...
 18210 000076C4 FA6650665366516652      rpRepl6:	db 0FAh, 66h, 50h, 66h,	53h, 66h, 51h, 66h, 52h	; ...
 18211 000076CD 665A6659665B66585B      rpRepl7:	db 66h,	5Ah, 66h, 59h, 66h, 5Bh, 66h, 58h, 5Bh ; ...
 18212 000076D6 60061EB800008ED8        rpFind8:	db 60h,	6, 1Eh,	0B8h, 2	dup(0),	8Eh, 0D8h ; ...
 18213 000076DE 1F0761                  rpFind9:	db 1Fh,	7, 61h		; ...
 18214 000076E1 6660061E                rpRepl8:	db 66h,	60h, 6,	1Eh	; ...
 18215 000076E5 1F076661C3              rpRepl9:	db 1Fh,	7, 66h,	61h, 0C3h ; ...
 18216 000076EA [7A76]                  rpBug1Strs:	dw rpFind2	; ...
 18217 000076EC 0300                    		dw 3
 18218 000076EE [7D76]                  		dw rpFind3
 18219 000076F0 0400                    		dw 4
 18220 000076F2 2000                    		dw 20h
 18221 000076F4 [8C76]                  rpBug2Strs:	dw rpFind4	; ...
 18222 000076F6 0400                    		dw 4
 18223 000076F8 [9076]                  		dw rpFind5
 18224 000076FA 0900                    		dw 9
 18225 000076FC 8000                    		dw 80h
 18226 000076FE [B776]                  rpBug3Strs:	dw rpFind6	; ...
 18227 00007700 0300                    		dw 3
 18228 00007702 [BA76]                  		dw rpFind7a
 18229 00007704 0700                    		dw 7
 18230 00007706 8000                    		dw 80h
 18231 00007708 [D676]                  rpBug4Strs:	dw rpFind8	; ...
 18232 0000770A 0400                    		dw 4
 18233 0000770C [DE76]                  		dw rpFind9
 18234 0000770E 0300                    		dw 3
 18235 00007710 8000                    		dw 80h
 18236                                  ; ---------------------------------------------------------------------------
 18237                                  
 18238                                  Rational386Patch:			; ...
 18239 00007712 26813E00008B01          		cmp	word [es:0], 395
 18240 00007719 7322                    		jnb	short rp3QuickOut
 18241 0000771B 26833E0C0020            		cmp	word [es:0Ch], 20h ; ' '
 18242 00007721 751A                    		jnz	short rp3QuickOut
 18243 00007723 50                      		push	ax
 18244 00007724 B81800                  		mov	ax, 18h
 18245 00007727 2639061800              		cmp	[es:18h], ax
 18246 0000772C 750E                    		jnz	short rp3QO_ax
 18247 0000772E 2639061C00              		cmp	[es:1Ch], ax
 18248 00007733 7507                    		jnz	short rp3QO_ax
 18249 00007735 2639062400              		cmp	[es:24h], ax
 18250 0000773A 7402                    		jz	short rp3Maybe
 18251                                  
 18252                                  rp3QO_ax:				; ...
 18253 0000773C 58                      		pop	ax
 18254                                  
 18255                                  rp3QuickOut:				; ...
 18256 0000773D C3                      		retn
 18257                                  ; ---------------------------------------------------------------------------
 18258                                  
 18259                                  rp3Maybe:				; ...
 18260 0000773E FC                      		cld
 18261 0000773F 53                      		push	bx
 18262 00007740 51                      		push	cx
 18263 00007741 52                      		push	dx
 18264 00007742 56                      		push	si
 18265 00007743 57                      		push	di
 18266 00007744 06                      		push	es
 18267 00007745 1E                      		push	ds
 18268 00007746 55                      		push	bp
 18269 00007747 83EC06                  		sub	sp, 6
 18270 0000774A 89E5                    		mov	bp, sp
 18271 0000774C 0E                      		push	cs
 18272 0000774D 1F                      		pop	ds
 18273 0000774E 26A10000                		mov	ax, [es:0]
 18274 00007752 894600                  		mov	[bp+0],	ax
 18275 00007755 E89E01                  		call	VerifyVersion
 18276 00007758 7521                    		jnz	short rp3Exit_j
 18277 0000775A B90045                  		mov	cx, 4500h
 18278 0000775D 894E02                  		mov	[bp+2],	cx
 18279 00007760 268E062000              		mov	es, word [es:20h]
 18280 00007765 BE[6876]                		mov	si, rpFind1
 18281 00007768 BA0A00                  		mov	dx, 10
 18282 0000776B E87001                  		call	ScanCodeSeq
 18283 0000776E 740E                    		jz	short rpGotPatch
 18284 00007770 BE[7276]                		mov	si, rpFind1a
 18285 00007773 BA0800                  		mov	dx, 8
 18286 00007776 E86501                  		call	ScanCodeSeq
 18287 00007779 7403                    		jz	short rpGotPatch
 18288                                  
 18289                                  rp3Exit_j:				; ...
 18290 0000777B E9FE00                  		jmp	rp3Exit
 18291                                  ; ---------------------------------------------------------------------------
 18292                                  
 18293                                  rpGotPatch:				; ...
 18294 0000777E 897E04                  		mov	[bp+4],	di
 18295 00007781 817E007D01              		cmp	word [bp+0], 381
 18296 00007786 7348                    		jnb	short rpBug2
 18297 00007788 BB[EA76]                		mov	bx, rpBug1Strs
 18298 0000778B E8FB00                  		call	FindBadCode
 18299 0000778E 7240                    		jb	short rpBug2
 18300 00007790 57                      		push	di
 18301 00007791 89F7                    		mov	di, si
 18302 00007793 BA0300                  		mov	dx, 3
 18303 00007796 26807DFF51              		cmp	byte [es:di-1], 51h	; 'Q'
 18304 0000779B 7502                    		jnz	short rp_no_cx
 18305 0000779D 4F                      		dec	di
 18306 0000779E 42                      		inc	dx
 18307                                  
 18308                                  rp_no_cx:				; ...
 18309 0000779F BE[8176]                		mov	si, rpRepl2
 18310 000077A2 B90600                  		mov	cx, 6
 18311 000077A5 E80A01                  		call	GenPatch
 18312 000077A8 5F                      		pop	di
 18313 000077A9 26807DFF59              		cmp	byte [es:di-1], 59h	; 'Y'
 18314 000077AE 7505                    		jnz	short rp_no_cx2
 18315 000077B0 26C645FF90              		mov	byte [es:di-1], 90h	; ''
 18316                                  
 18317                                  rp_no_cx2:				; ...
 18318 000077B5 8B4604                  		mov	ax, [bp+4]
 18319 000077B8 26894504                		mov	[es:di+4], ax
 18320 000077BC 57                      		push	di
 18321 000077BD BE[8776]                		mov	si, rpRepl3
 18322 000077C0 B90500                  		mov	cx, 5
 18323 000077C3 E80001                  		call	CopyPatch
 18324 000077C6 5B                      		pop	bx
 18325 000077C7 83C308                  		add	bx, 8
 18326 000077CA E80501                  		call	GenJump
 18327 000077CD 897E04                  		mov	[bp+4],	di
 18328                                  
 18329                                  rpBug2:					; ...
 18330 000077D0 BB[F476]                		mov	bx, rpBug2Strs
 18331 000077D3 E8B300                  		call	FindBadCode
 18332 000077D6 7242                    		jb	short rpBug3
 18333 000077D8 FF7604                  		push	word [bp+4]
 18334 000077DB 57                      		push	di
 18335 000077DC 89F7                    		mov	di, si
 18336 000077DE BA0400                  		mov	dx, 4
 18337 000077E1 BE[9976]                		mov	si, rpRepl4
 18338 000077E4 B90F00                  		mov	cx, 15
 18339 000077E7 E8C800                  		call	GenPatch
 18340 000077EA 5F                      		pop	di
 18341 000077EB 83C705                  		add	di, 5
 18342 000077EE 8B5E04                  		mov	bx, [bp+4]
 18343 000077F1 53                      		push	bx
 18344 000077F2 E8DD00                  		call	GenJump
 18345 000077F5 BE[A876]                		mov	si, rpRepl5
 18346 000077F8 B90F00                  		mov	cx, 15
 18347 000077FB E8C800                  		call	CopyPatch
 18348 000077FE 5F                      		pop	di
 18349 000077FF 5E                      		pop	si
 18350 00007800 8B4604                  		mov	ax, [bp+4]
 18351 00007803 26894407                		mov	[es:si+7], ax
 18352 00007807 26894505                		mov	[es:di+5], ax
 18353 0000780B 83C004                  		add	ax, 4
 18354 0000780E 2689440D                		mov	[es:si+0Dh], ax
 18355 00007812 2689450B                		mov	[es:di+0Bh], ax
 18356 00007816 83460408                		add	word [bp+4], 8
 18357                                  
 18358                                  rpBug3:					; ...
 18359 0000781A BB[FE76]                		mov	bx, rpBug3Strs
 18360 0000781D E86900                  		call	FindBadCode
 18361 00007820 722C                    		jb	short rpBug4
 18362 00007822 83C709                  		add	di, 9
 18363 00007825 56                      		push	si
 18364 00007826 BE[C176]                		mov	si, rpFind7b
 18365 00007829 BA0300                  		mov	dx, 3
 18366 0000782C E8B200                  		call	ScanCodeSeq_di
 18367 0000782F 5E                      		pop	si
 18368 00007830 751C                    		jnz	short rpBug4
 18369 00007832 57                      		push	di
 18370 00007833 89F7                    		mov	di, si
 18371 00007835 BA0300                  		mov	dx, 3
 18372 00007838 BE[C476]                		mov	si, rpRepl6
 18373 0000783B B90900                  		mov	cx, 9
 18374 0000783E E87100                  		call	GenPatch
 18375 00007841 5F                      		pop	di
 18376 00007842 BA0300                  		mov	dx, 3
 18377 00007845 BE[CD76]                		mov	si, rpRepl7
 18378 00007848 B90900                  		mov	cx, 9
 18379 0000784B E86400                  		call	GenPatch
 18380                                  
 18381                                  rpBug4:					; ...
 18382 0000784E 817E006801              		cmp	word [bp+0], 360
 18383 00007853 7627                    		jbe	short rp3Exit
 18384 00007855 BB[0877]                		mov	bx, rpBug4Strs
 18385 00007858 E82E00                  		call	FindBadCode
 18386 0000785B 721F                    		jb	short rp3Exit
 18387 0000785D 57                      		push	di
 18388 0000785E 89F7                    		mov	di, si
 18389 00007860 BA0300                  		mov	dx, 3
 18390 00007863 BE[E176]                		mov	si, rpRepl8
 18391 00007866 B90400                  		mov	cx, 4
 18392 00007869 E84600                  		call	GenPatch
 18393 0000786C 5F                      		pop	di
 18394 0000786D 8B5E04                  		mov	bx, [bp+4]
 18395 00007870 E85F00                  		call	GenJump
 18396 00007873 BE[E576]                		mov	si, rpRepl9
 18397 00007876 B90500                  		mov	cx, 5
 18398 00007879 E84A00                  		call	CopyPatch
 18399                                  
 18400                                  rp3Exit:				; ...
 18401 0000787C 83C406                  		add	sp, 6
 18402 0000787F 5D                      		pop	bp
 18403 00007880 1F                      		pop	ds
 18404 00007881 07                      		pop	es
 18405 00007882 5F                      		pop	di
 18406 00007883 5E                      		pop	si
 18407 00007884 5A                      		pop	dx
 18408 00007885 59                      		pop	cx
 18409 00007886 5B                      		pop	bx
 18410 00007887 58                      		pop	ax
 18411 00007888 C3                      		retn
 18412                                  
 18413                                  ; =============== S U B	R O U T	I N E =======================================
 18414                                  
 18415                                  
 18416                                  FindBadCode:
 18417 00007889 8B4E02                  		mov	cx, [bp+2]
 18418 0000788C 8B37                    		mov	si, [bx]
 18419 0000788E 8B5702                  		mov	dx, [bx+2]
 18420 00007891 E84A00                  		call	ScanCodeSeq
 18421 00007894 751A                    		jnz	short fbc_error
 18422 00007896 57                      		push	di
 18423 00007897 8B7704                  		mov	si, [bx+4]
 18424 0000789A 8B5706                  		mov	dx, [bx+6]
 18425 0000789D E84100                  		call	ScanCodeSeq_di
 18426 000078A0 5E                      		pop	si
 18427 000078A1 750D                    		jnz	short fbc_error
 18428 000078A3 89F8                    		mov	ax, di
 18429 000078A5 29F0                    		sub	ax, si
 18430 000078A7 7207                    		jb	short fbc_error
 18431 000078A9 3B4708                  		cmp	ax, [bx+8]
 18432 000078AC 7702                    		ja	short fbc_error
 18433 000078AE F8                      		clc
 18434 000078AF C3                      		retn
 18435                                  ; ---------------------------------------------------------------------------
 18436                                  
 18437                                  fbc_error:				; ...
 18438 000078B0 F9                      		stc
 18439 000078B1 C3                      		retn
 18440                                  
 18441                                  ; =============== S U B	R O U T	I N E =======================================
 18442                                  
 18443                                  
 18444                                  GenPatch:
 18445 000078B2 57                      		push	di
 18446 000078B3 8B5E04                  		mov	bx, [bp+4]
 18447 000078B6 E81900                  		call	GenJump
 18448 000078B9 E80A00                  		call	CopyPatch
 18449 000078BC 5B                      		pop	bx
 18450 000078BD 01D3                    		add	bx, dx
 18451 000078BF E81000                  		call	GenJump
 18452 000078C2 897E04                  		mov	[bp+4],	di
 18453 000078C5 C3                      		retn
 18454                                  
 18455                                  ; =============== S U B	R O U T	I N E =======================================
 18456                                  
 18457                                  
 18458                                  CopyPatch:
 18459 000078C6 51                      		push	cx
 18460 000078C7 8B7E04                  		mov	di, [bp+4]
 18461 000078CA FC                      		cld
 18462 000078CB F3A4                    		rep movsb
 18463 000078CD 59                      		pop	cx
 18464 000078CE 897E04                  		mov	[bp+4],	di
 18465 000078D1 C3                      		retn
 18466                                  
 18467                                  ; =============== S U B	R O U T	I N E =======================================
 18468                                  
 18469                                  
 18470                                  GenJump	:
 18471 000078D2 B0E9                    		mov	al, 0E9h
 18472 000078D4 AA                      		stosb
 18473 000078D5 89D8                    		mov	ax, bx
 18474 000078D7 29F8                    		sub	ax, di
 18475 000078D9 83E802                  		sub	ax, 2
 18476 000078DC AB                      		stosw
 18477 000078DD C3                      		retn
 18478                                  
 18479                                  ; =============== S U B	R O U T	I N E =======================================
 18480                                  
 18481                                  
 18482                                  ScanCodeSeq:
 18483 000078DE BF0002                  		mov	di, 200h
 18484                                  
 18485                                  ; =============== S U B	R O U T	I N E =======================================
 18486                                  
 18487                                  
 18488                                  ScanCodeSeq_di:
 18489 000078E1 51                      		push	cx
 18490 000078E2 29D1                    		sub	cx, dx
 18491 000078E4 41                      		inc	cx
 18492                                  
 18493                                  scsagain:				; ...
 18494 000078E5 56                      		push	si
 18495 000078E6 57                      		push	di
 18496 000078E7 51                      		push	cx
 18497 000078E8 89D1                    		mov	cx, dx
 18498 000078EA F3A6                    		repe cmpsb
 18499 000078EC 59                      		pop	cx
 18500 000078ED 5F                      		pop	di
 18501 000078EE 5E                      		pop	si
 18502 000078EF 7403                    		jz	short scsfound
 18503 000078F1 47                      		inc	di
 18504 000078F2 E2F1                    		loop	scsagain
 18505                                  
 18506                                  scsfound:				; ...
 18507 000078F4 59                      		pop	cx
 18508 000078F5 C3                      		retn
 18509                                  
 18510                                  ; =============== S U B	R O U T	I N E =======================================
 18511                                  
 18512                                  
 18513                                  VerifyVersion:
 18514 000078F6 268B362A00              		mov	si, [es:2Ah]
 18515 000078FB B30A                    		mov	bl, 10
 18516 000078FD 83C603                  		add	si, 3
 18517 00007900 E81200                  		call	VVDigit
 18518 00007903 750F                    		jnz	short vvexit
 18519 00007905 E80D00                  		call	VVDigit
 18520 00007908 750A                    		jnz	short vvexit
 18521 0000790A 26803C2E                		cmp	byte [es:si], '.'
 18522 0000790E 7504                    		jnz	short vvexit
 18523 00007910 4E                      		dec	si
 18524 00007911 E80100                  		call	VVDigit
 18525                                  
 18526                                  vvexit:					; ...
 18527 00007914 C3                      		retn
 18528                                  
 18529                                  ; =============== S U B	R O U T	I N E =======================================
 18530                                  
 18531                                  
 18532                                  VVDigit	:
 18533 00007915 F6F3                    		div	bl
 18534 00007917 80C430                  		add	ah, '0'
 18535 0000791A 4E                      		dec	si
 18536 0000791B 26386401                		cmp	[es:si+1], ah
 18537 0000791F B400                    		mov	ah, 0
 18538 00007921 C3                      		retn
 18539                                  
 18540                                  ; ---------------------------------------------------------------------------
 18541                                  
 18542                                  exepatch_start:
 18543                                  ;str1:
 18544 00007922 06                      		db  06h	  		;push	es		 
 18545 00007923 8CD8                    		db  8Ch,0D8h		;mov	ax,ds 
 18546                                  
 18547                                  ;first_stop equ	$-str1
 18548                                  			
 18549 00007925 2BC2                    		db  2Bh, 0C2h		;sub	ax, dx			
 18550                                  first:
 18551 00007927 8ED8                    		db  8Eh,0D8h		;mov	ds,ax			
 18552 00007929 8EC0                    		db  8Eh,0C0h		;mov	es,ax			
 18553 0000792B BF0F00                  		db  0BFh,0Fh,00h	;mov	di,000FH
 18554 0000792E 57                      		db  57h	    		;push	di
 18555 0000792F B91000                  		db  0B9h,10h,00h	;mov	cx,0010H
 18556 00007932 B0FF                    		db  0B0h,0FFh 		;mov	al,0FFH 		
 18557 00007934 F3AE                    		db  0F3h,0AEh 		;repz	scasb			
 18558 00007936 47                      		db  47h	    		;inc	di			
 18559 00007937 8BF7                    		db  8Bh,0F7h  		;mov	si,di			
 18560 00007939 5F                      		db  5Fh	    		;pop	di
 18561 0000793A 58                      		db  58h	    		;pop	ax
 18562                                  
 18563                                  ;second_stop equ $-first
 18564                                  
 18565 0000793B 2BC2                    		db  2Bh,0C2h  		;sub	ax, dx			
 18566                                  second:
 18567 0000793D 8EC0                    		db  8Eh,0C0h  		;mov	es,ax			
 18568                                  		    		;NextRec:				
 18569 0000793F B90402                  		db  0B9h,04h,02h	;mov	cx, 0204h
 18570                                  		    		;norm_agn:				
 18571 00007942 8BC6                    		db  8Bh,0C6h		;mov	ax,si			
 18572 00007944 F7D0                    		db  0F7h,0D0h		;not	ax		
 18573 00007946 D3E8                    		db  0D3h,0E8h		;shr	ax,cl		
 18574 00007948 7413                    		db  74h,13h		;jz	short SI_ok			
 18575 0000794A 8CDA                    		db  8Ch,0DAh		;mov	dx,ds			
 18576 0000794C 83CEF0                  		db  83h,0CEh,0F0h	;or	si,0FFF0H
 18577 0000794F 2BD0                    		db  2Bh,0D0h		;sub	dx,ax			
 18578 00007951 7308                    		db  73h,08h		;jnc	short SItoDS			
 18579 00007953 F7DA                    		db  0F7h,0DAh		;neg	dx			
 18580 00007955 D3E2                    		db  0D3h,0E2h		;shl	dx,cl			
 18581 00007957 2BF2                    		db  2Bh,0F2h		;sub	si,dx			
 18582 00007959 33D2                    		db  33h,0D2h		;xor	dx,dx			
 18583                                  				;SItoDS: 				
 18584 0000795B 8EDA                    		db  8Eh,0DAh		;mov	ds,dx		
 18585                                  				;SI_ok:					
 18586 0000795D 87F7                    		db  87h,0F7h		;xchg	si,di			
 18587 0000795F 1E                      		db  1Eh			;push	ds			
 18588 00007960 06                      		db  06h			;push	es			
 18589 00007961 1F                      		db  1Fh			;pop	ds			
 18590 00007962 07                      		db  07h			;pop	es			
 18591 00007963 FECD                    		db  0FEh,0CDh		;dec	ch			
 18592 00007965 75DB                    		db  75h,0DBh		;jnz	short norm_agn		
 18593 00007967 AC                      		db  0ACh		;lodsb			
 18594 00007968 92                      		db  92h			;xchg	dx,ax
 18595 00007969 4E                      		db  4Eh			;dec	si
 18596 0000796A AD                      		db  0ADh		;lodsw			
 18597 0000796B 8BC8                    		db  8Bh,0C8h		;mov	cx,ax		
 18598 0000796D 46                      		db  46h			;inc	si		
 18599 0000796E 8AC2                    		db  8Ah,0C2h		;mov	al,dl		
 18600 00007970 24FE                    		db  24h,0FEh		;and	al,0FEH		
 18601 00007972 3CB0                    		db  3Ch,0B0h		;cmp	al,RPTREC
 18602 00007974 7505                    		db  75h,05h		;jne	short TryEnum
 18603 00007976 AC                      		db  0ACh		;lodsb				
 18604 00007977 F3AA                    		db  0F3h,0AAh		;rep stosb			
 18605                                  		;db 0EBh,07h,90h	;jmp	short TryNext
 18606 00007979 EB06                    		db  0EBh,06h		;jmp	short TryNext
 18607                                  				;TryEnum:
 18608 0000797B 3CB2                    		db  3Ch,0B2h		;cmp	al,ENMREC
 18609 0000797D 756C                    		db  75h,6Ch		;jne	short CorruptExe		
 18610 0000797F F3A4                    		db  0F3h,0A4h		;rep movsb			
 18611                                  				;TryNext:
 18612 00007981 92                      		db  92h			;xchg	dx,ax
 18613                                  		;db 8Ah,0C2h		;mov	al,dl			
 18614                                  
 18615 00007982 A801                    		db  0A8h,01h		;test	al,1			
 18616 00007984 74B9                    		db  74h,0B9h		;jz	short NextRec			
 18617 00007986 9090                    		db  90h,90h		;nop,nop
 18618                                  	
 18619                                  ;last_stop equ $-second
 18620                                  ;size_str1 equ $-str1
 18621                                  
 18622                                  scan_patch1:
 18623 00007988 8CC3                    		db  8Ch,0C3h		;mov	bx,es			
 18624 0000798A 8CD8                    		db  8Ch,0D8h		;mov	ax,ds
 18625 0000798C 2BC2                    		db  2Bh,0C2h		;sub	ax,dx
 18626 0000798E 8ED8                    		db  8Eh,0D8h		;mov	ds,ax			
 18627 00007990 8EC0                    		db  8Eh,0C0h		;mov	es,ax			
 18628 00007992 BF0F00                  		db  0BFh,0Fh,00h	;mov	di,000FH
 18629 00007995 B91000                  		db  0B9h,10h,00h	;mov	cx,0010H
 18630 00007998 B0FF                    		db  0B0h,0FFh		;mov	al,0FFH
 18631 0000799A F3AE                    		db  0F3h,0AEh		;repz	scasb			
 18632 0000799C 47                      		db  47h			;inc	di			
 18633 0000799D 8BF7                    		db  8Bh,0F7h		;mov	si,di
 18634 0000799F 8BC3                    		db  8Bh,0C3h		;mov	ax,bx			
 18635 000079A1 2BC2                    		db  2Bh,0C2h		;sub	ax, dx
 18636 000079A3 8EC0                    		db  8Eh,0C0h		;mov	es,ax
 18637 000079A5 BF0F00                  		db  0BFh,0Fh,00h	;mov	di,000FH
 18638                                  				;NextRec:
 18639 000079A8 B104                    		db  0B1h,04h		;mov	cl,4
 18640 000079AA 8BC6                    		db  8Bh,0C6h		;mov	ax,si
 18641 000079AC F7D0                    		db  0F7h,0D0h		;not	ax		
 18642 000079AE D3E8                    		db  0D3h,0E8h		;shr	ax,cl		
 18643 000079B0 7409                    		db  74h,09h		;jz	short SI_ok
 18644 000079B2 8CDA                    		db  8Ch,0DAh		;mov	dx,ds
 18645 000079B4 2BD0                    		db  2Bh,0D0h		;sub	dx,ax
 18646 000079B6 8EDA                    		db  8Eh,0DAh		;mov	ds,dx		
 18647 000079B8 83CEF0                  		db  83h,0CEh,0F0h	;or	si,0FFF0H	       
 18648                                  	       			;SI_ok:
 18649 000079BB 8BC7                    		db  8Bh,0C7h		;mov	ax,di		
 18650 000079BD F7D0                    		db  0F7h,0D0h		;not	ax
 18651 000079BF D3E8                    		db  0D3h,0E8h		;shr	ax,cl
 18652 000079C1 7409                    		db  74h,09h		;jz	short DI_ok
 18653 000079C3 8CC2                    		db  8Ch,0C2h		;mov	dx,es
 18654 000079C5 2BD0                    		db  2Bh,0D0h		;sub	dx,ax
 18655 000079C7 8EC2                    		db  8Eh,0C2h		;mov	es,dx
 18656 000079C9 83CFF0                  		db  83h,0CFh,0F0h	;or	di,0FFF0H
 18657                                  				;DI_ok:
 18658                                  
 18659                                  ;size_scan_patch1 equ $-scan_patch1
 18660                                  
 18661                                  scan_patch2:
 18662 000079CC 8CC3                    		db  8Ch,0C3h		;mov	bx,es			
 18663 000079CE 8CD8                    		db  8Ch,0D8h		;mov	ax,ds
 18664 000079D0 48                      		db  48h			;dec	ax
 18665 000079D1 8ED8                    		db  8Eh,0D8h		;mov	ds,ax			
 18666 000079D3 8EC0                    		db  8Eh,0C0h		;mov	es,ax			
 18667 000079D5 BF0F00                  		db  0BFh,0Fh,00h	;mov	di,000FH
 18668 000079D8 B91000                  		db  0B9h,10h,00h	;mov	cx,0010H
 18669 000079DB B0FF                    		db  0B0h,0FFh		;mov	al,0FFH
 18670 000079DD F3AE                    		db  0F3h,0AEh		;repz	scasb			
 18671 000079DF 47                      		db  47h			;inc	di			
 18672 000079E0 8BF7                    		db  8Bh,0F7h		;mov	si,di
 18673 000079E2 8BC3                    		db  8Bh,0C3h		;mov	ax,bx			
 18674 000079E4 48                      		db  48h			;dec	ax
 18675 000079E5 8EC0                    		db  8Eh,0C0h		;mov	es,ax
 18676 000079E7 BF0F00                  		db  0BFh,0Fh,00h	;mov	di,000FH		
 18677                                  				;NextRec:
 18678 000079EA B104                    		db  0B1h,04h		;mov	cl,4
 18679 000079EC 8BC6                    		db  8Bh,0C6h		;mov	ax,si
 18680 000079EE F7D0                    		db  0F7h,0D0h		;not	ax		
 18681 000079F0 D3E8                    		db  0D3h,0E8h		;shr	ax,cl		
 18682 000079F2 740A                    		db  74h,0Ah		;jz	short SI_ok
 18683 000079F4 8CDA                    		db  8Ch,0DAh		;mov	dx,ds
 18684 000079F6 2BD0                    		db  2Bh,0D0h		;sub	dx,ax
 18685 000079F8 8EDA                    		db  8Eh,0DAh		;mov	ds,dx		
 18686 000079FA 81CEF0FF                		db  81h,0CEh,0F0h,0FFh	;or	si,0FFF0H
 18687                                  				;SI_ok:
 18688 000079FE 8BC7                    		db  8Bh,0C7h		;mov	ax,di		
 18689 00007A00 F7D0                    		db  0F7h,0D0h		;not	ax
 18690 00007A02 D3E8                    		db  0D3h,0E8h		;shr	ax,cl
 18691 00007A04 740A                    		db  74h,0Ah		;jz	short DI_ok
 18692 00007A06 8CC2                    		db  8Ch,0C2h		;mov	dx,es
 18693 00007A08 2BD0                    		db  2Bh,0D0h		;sub	dx,ax
 18694 00007A0A 8EC2                    		db  8Eh,0C2h		;mov	es,dx
 18695 00007A0C 81CFF0FF                		db  81h,0CFh,0F0h,0FFh	;or	di,0FFF0H
 18696                                  				;DI_ok:
 18697                                  
 18698                                  ;size_scan_patch2 equ $-scan_patch2
 18699                                  
 18700                                  scan_patch3:
 18701 00007A10 8CC3                    		db  8Ch,0C3h		;mov	bx,es			
 18702 00007A12 8CD8                    		db  8Ch,0D8h		;mov	ax,ds
 18703 00007A14 48                      		db  48h			;dec	ax
 18704 00007A15 8ED8                    		db  8Eh,0D8h		;mov	ds,ax			
 18705 00007A17 8EC0                    		db  8Eh,0C0h		;mov	es,ax			
 18706 00007A19 BF0F00                  		db  0BFh,0Fh,00h	;mov	di,000FH
 18707 00007A1C B91000                  		db  0B9h,10h,00h	;mov	cx,0010H
 18708 00007A1F B0FF                    		db  0B0h,0FFh		;mov	al,0FFH
 18709 00007A21 F3AE                    		db  0F3h,0AEh		;repz	scasb			
 18710 00007A23 47                      		db  47h			;inc	di			
 18711 00007A24 8BF7                    		db  8Bh,0F7h		;mov	si,di
 18712 00007A26 8BC3                    		db  8Bh,0C3h		;mov	ax,bx			
 18713 00007A28 48                      		db  48h			;dec	ax
 18714 00007A29 8EC0                    		db  8Eh,0C0h		;mov	es,ax
 18715 00007A2B BF0F00                  		db  0BFh,0Fh,00h	;mov	di,000FH		
 18716                                  				;NextRec:
 18717 00007A2E B104                    		db  0B1h,04h		;mov	cl,4
 18718 00007A30 8BC6                    		db  8Bh,0C6h		;mov	ax,si
 18719 00007A32 F7D0                    		db  0F7h,0D0h		;not	ax		
 18720 00007A34 D3E8                    		db  0D3h,0E8h		;shr	ax,cl		
 18721 00007A36 7409                    		db  74h,09h		;jz	short SI_ok
 18722 00007A38 8CDA                    		db  8Ch,0DAh		;mov	dx,ds
 18723 00007A3A 2BD0                    		db  2Bh,0D0h		;sub	dx,ax
 18724 00007A3C 8EDA                    		db  8Eh,0DAh		;mov	ds,dx	
 18725 00007A3E 83CEF0                  		db  83h,0CEh,0F0h	;or	si,0FFF0H	
 18726                                  				;SI_ok:
 18727 00007A41 8BC7                    		db  8Bh,0C7h		;mov	ax,di		
 18728 00007A43 F7D0                    		db  0F7h,0D0h		;not	ax
 18729 00007A45 D3E8                    		db  0D3h,0E8h		;shr	ax,cl
 18730 00007A47 7409                    		db  74h,09h		;jz	short DI_ok
 18731 00007A49 8CC2                    		db  8Ch,0C2h		;mov	dx,es
 18732 00007A4B 2BD0                    		db  2Bh,0D0h		;sub	dx,ax
 18733 00007A4D 8EC2                    		db  8Eh,0C2h		;mov	es,dx
 18734 00007A4F 83CFF0                  		db  83h,0CFh,0F0h	;or	di,0FFF0H
 18735                                  				;DI_ok:
 18736                                  
 18737                                  ;size_scan_patch3 equ $-scan_patch3
 18738                                  
 18739                                  scan_com:
 18740 00007A52 AC                      		db  0ACh		;lodsb			
 18741 00007A53 8AD0                    		db  8Ah,0D0h		;mov	dl,al		
 18742 00007A55 4E                      		db  4Eh			;dec	si
 18743 00007A56 AD                      		db  0ADh		;lodsw			
 18744 00007A57 8BC8                    		db  8Bh,0C8h		;mov	cx,ax		
 18745 00007A59 46                      		db  46h			;inc	si		
 18746 00007A5A 8AC2                    		db  8Ah,0C2h		;mov	al,dl		
 18747 00007A5C 24FE                    		db  24h,0FEh		;and	al,0FEH		
 18748 00007A5E 3CB0                    		db  3Ch,0B0h		;cmp	al,RPTREC
 18749 00007A60 7506                    		db  75h,06h		;jne	short TryEnum
 18750 00007A62 AC                      		db  0ACh		;lodsb				
 18751 00007A63 F3AA                    		db  0F3h,0AAh		;rep stosb			
 18752 00007A65 EB0790                  		db  0EBh,07h,90h	;jmp	short TryNext
 18753                                  				;TryEnum:
 18754 00007A68 3CB2                    		db  3Ch,0B2h		;cmp	al,ENMREC
 18755 00007A6A 756B                    		db  75h,6Bh		;jne	short CorruptExe		
 18756 00007A6C F3A4                    		db  0F3h,0A4h		;rep movsb			
 18757                                  				;TryNext:
 18758 00007A6E 8AC2                    		db  8Ah,0C2h		;mov	al,dl			
 18759 00007A70 A801                    		db  0A8h,01h		;test	al,1			
 18760                                  		;db 74h,0BAh		;jz	short NextRec
 18761                                  	
 18762                                  ; ---------------------------------------------------------------------------
 18763                                  
 18764                                  ExePatch:
 18765 00007A72 E80600                  		call	ExePackPatch
 18766 00007A75 36FF16[1412]            		call	word [ss:RationalPatchPtr]
 18767 00007A7A C3                      		retn
 18768                                  
 18769                                  ; =============== S U B	R O U T	I N E =======================================
 18770                                  
 18771                                  
 18772                                  ExePackPatch:
 18773 00007A7B 53                      		push	bx
 18774 00007A7C 8CC3                    		mov	bx, es
 18775 00007A7E 81FBFF0F                		cmp	bx, 0FFFh
 18776 00007A82 7602                    		jbe	short ep_cont
 18777 00007A84 5B                      		pop	bx
 18778 00007A85 C3                      		retn
 18779                                  ; ---------------------------------------------------------------------------
 18780                                  
 18781                                  ep_cont:				; ...
 18782 00007A86 1E                      		push	ds
 18783 00007A87 06                      		push	es
 18784 00007A88 50                      		push	ax
 18785 00007A89 51                      		push	cx
 18786 00007A8A 56                      		push	si
 18787 00007A8B 57                      		push	di
 18788 00007A8C 83E902                  		sub	cx, 2
 18789 00007A8F 7303                    		jnb	short epp_1
 18790 00007A91 E9C500                  		jmp	ep_notpacked
 18791                                  ; ---------------------------------------------------------------------------
 18792                                  
 18793                                  epp_1:					; ...
 18794 00007A94 89CF                    		mov	di, cx
 18795 00007A96 8EC0                    		mov	es, ax
 18796                                  
 18797 00007A98 36893E[8700]            		mov	[ss:UNPACK_OFFSET], di
 18798 00007A9D 26813D5242              		cmp	word [es:di], 'RB'  ;'BR'
 18799 00007AA2 7403                    		jz	short epp_2
 18800 00007AA4 E9B200                  		jmp	ep_notpacked
 18801                                  ; ---------------------------------------------------------------------------
 18802                                  
 18803                                  epp_2:					; ...
 18804 00007AA7 0E                      		push	cs
 18805 00007AA8 1F                      		pop	ds
 18806 00007AA9 83C76C                  		add	di, 6Ch
 18807 00007AAC E8B200                  		call	chk_common_str
 18808 00007AAF 7524                    		jnz	short ep_chkpatch2
 18809 00007AB1 BE[8879]                		mov	si, scan_patch1
 18810 00007AB4 368B3E[8700]            		mov	di, [ss:UNPACK_OFFSET]
 18811 00007AB9 83C728                  		add	di, 28h
 18812 00007ABC B94400                  		mov	cx, 68
 18813 00007ABF BB8E00                  		mov	bx, 142
 18814 00007AC2 B84EEF                  		mov	ax, 0EF4Eh
 18815 00007AC5 E8AD00                  		call	chk_patchsum
 18816 00007AC8 7208                    		jb	short ep_done1
 18817 00007ACA BE[2279]                		mov	si, exepatch_start
 18818 00007ACD B96600                  		mov	cx, 102
 18819 00007AD0 F3A4                    		rep movsb
 18820                                  
 18821                                  ep_done1:				; ...
 18822 00007AD2 E98400                  		jmp	ep_notpacked
 18823                                  ; ---------------------------------------------------------------------------
 18824                                  
 18825                                  ep_chkpatch2:				; ...
 18826 00007AD5 BF7600                  		mov	di, 76h
 18827 00007AD8 E88600                  		call	chk_common_str
 18828 00007ADB 7544                    		jnz	short ep_chkpatch3
 18829 00007ADD BE[CC79]                		mov	si, scan_patch2
 18830 00007AE0 BF3200                  		mov	di, 32h
 18831 00007AE3 B94400                  		mov	cx, 68
 18832 00007AE6 BB8C00                  		mov	bx, 140
 18833 00007AE9 B8B278                  		mov	ax, 78B2h
 18834 00007AEC E88600                  		call	chk_patchsum
 18835 00007AEF 7311                    		jnb	short ep_patchcode2
 18836 00007AF1 BE[CC79]                		mov	si, scan_patch2
 18837 00007AF4 B94400                  		mov	cx, 68
 18838 00007AF7 BB8100                  		mov	bx, 129
 18839 00007AFA B8471C                  		mov	ax, 1C47h
 18840 00007AFD E87500                  		call	chk_patchsum
 18841 00007B00 7257                    		jb	short ep_notpacked
 18842                                  
 18843                                  ep_patchcode2:				; ...
 18844 00007B02 BE[2279]                		mov	si, exepatch_start
 18845 00007B05 B90300                  		mov	cx, 3
 18846 00007B08 F3A4                    		rep movsb
 18847 00007B0A B89048                  		mov	ax, 4890h
 18848 00007B0D AB                      		stosw
 18849 00007B0E 83C602                  		add	si, 2
 18850 00007B11 B91400                  		mov	cx, 20
 18851 00007B14 F3A4                    		rep movsb
 18852 00007B16 AB                      		stosw
 18853 00007B17 83C602                  		add	si, 2
 18854 00007B1A B94B00                  		mov	cx, 75
 18855 00007B1D F3A4                    		rep movsb
 18856 00007B1F EB38                    		jmp	short ep_notpacked
 18857                                  ; ---------------------------------------------------------------------------
 18858                                  
 18859                                  ep_chkpatch3:				; ...
 18860 00007B21 BF7400                  		mov	di, 74h
 18861 00007B24 E83A00                  		call	chk_common_str
 18862 00007B27 7530                    		jnz	short ep_notpacked
 18863 00007B29 BE[107A]                		mov	si, scan_patch3
 18864 00007B2C BF3200                  		mov	di, 32h
 18865 00007B2F B94200                  		mov	cx, 66
 18866 00007B32 BB8B00                  		mov	bx, 139
 18867 00007B35 B8DE4E                  		mov	ax, 4EDEh
 18868 00007B38 E83A00                  		call	chk_patchsum
 18869 00007B3B 721C                    		jb	short ep_notpacked
 18870 00007B3D BE[2279]                		mov	si, exepatch_start
 18871 00007B40 B90300                  		mov	cx, 3
 18872 00007B43 F3A4                    		rep movsb
 18873 00007B45 B048                    		mov	al, 48h	; 'H'
 18874 00007B47 AA                      		stosb
 18875 00007B48 83C602                  		add	si, 2
 18876 00007B4B B91400                  		mov	cx, 20
 18877 00007B4E F3A4                    		rep movsb
 18878 00007B50 AA                      		stosb
 18879 00007B51 83C602                  		add	si, 2
 18880 00007B54 B94B00                  		mov	cx, 75
 18881 00007B57 F3A4                    		rep movsb
 18882                                  
 18883                                  ep_notpacked:				; ...
 18884 00007B59 5F                      		pop	di
 18885 00007B5A 5E                      		pop	si
 18886 00007B5B 59                      		pop	cx
 18887 00007B5C 58                      		pop	ax
 18888 00007B5D 07                      		pop	es
 18889 00007B5E 1F                      		pop	ds
 18890 00007B5F 5B                      		pop	bx
 18891 00007B60 C3                      		retn
 18892                                  
 18893                                  ; =============== S U B	R O U T	I N E =======================================
 18894                                  
 18895                                  
 18896                                  chk_common_str:
 18897 00007B61 BE[527A]                		mov	si, scan_com
 18898 00007B64 B92000                  		mov	cx, 32
 18899 00007B67 F3A6                    		repe cmpsb
 18900 00007B69 7409                    		jz	short ccs_done
 18901 00007B6B 26807DFF56              		cmp	byte [es:di-1], 56h
 18902 00007B70 7502                    		jnz	short ccs_done
 18903 00007B72 F3A6                    		repe cmpsb
 18904                                  
 18905                                  ccs_done:				; ...
 18906 00007B74 C3                      		retn
 18907                                  
 18908                                  ; =============== S U B	R O U T	I N E =======================================
 18909                                  
 18910                                  
 18911                                  chk_patchsum:
 18912 00007B75 57                      		push	di
 18913 00007B76 F3A6                    		repe cmpsb
 18914 00007B78 751A                    		jnz	short cp_fail
 18915 00007B7A 368B3E8700              		mov	di, [ss:87h]
 18916 00007B7F 89D9                    		mov	cx, bx
 18917 00007B81 89C3                    		mov	bx, ax
 18918 00007B83 31C0                    		xor	ax, ax
 18919                                  
 18920                                  ep_chksum:				; ...
 18921 00007B85 260305                  		add	ax, [es:di]
 18922 00007B88 83C702                  		add	di, 2
 18923 00007B8B E2F8                    		loop	ep_chksum
 18924 00007B8D 5F                      		pop	di
 18925 00007B8E 39D8                    		cmp	ax, bx
 18926 00007B90 7502                    		jnz	short cp_fail
 18927 00007B92 F8                      		clc
 18928 00007B93 C3                      		retn
 18929                                  ; ---------------------------------------------------------------------------
 18930                                  
 18931                                  cp_fail:				; ...
 18932 00007B94 F9                      		stc
 18933 00007B95 C3                      		retn
 18934                                  
 18935                                  ; ---------------------------------------------------------------------------
 18936 00007B96 000020000000400001-     RScanPattern1:	db 2 dup(0), 20h, 3 dup(0), 40h, 0, 1, 0 ; ...
 18936 00007B9F 00                 
 18937 00007BA0 8B0E100090E2FEE8        RScanPattern2:	db 8Bh,	0Eh, 10h, 0, 90h, 0E2h,	0FEh, 0E8h ; ...
 18938 00007BA8 8B0E1000E2FEE8          RScanPattern3:	db 8Bh,	0Eh, 10h, 0, 0E2h, 0FEh, 0E8h ;	...
 18939                                  ; ---------------------------------------------------------------------------
 18940                                  
 18941                                  RationalPatch:				; ...
 18942 00007BAF FC                      		cld
 18943 00007BB0 50                      		push	ax
 18944 00007BB1 53                      		push	bx
 18945 00007BB2 51                      		push	cx
 18946 00007BB3 52                      		push	dx
 18947 00007BB4 56                      		push	si
 18948 00007BB5 57                      		push	di
 18949 00007BB6 06                      		push	es
 18950 00007BB7 1E                      		push	ds
 18951 00007BB8 BF0A00                  		mov	di, 0Ah
 18952 00007BBB 0E                      		push	cs
 18953 00007BBC 1F                      		pop	ds
 18954 00007BBD BE[967B]                		mov	si, RScanPattern1
 18955 00007BC0 B90A00                  		mov	cx, 10
 18956 00007BC3 F3A6                    		repe cmpsb
 18957 00007BC5 754A                    		jnz	short rpexit
 18958 00007BC7 26A10000                		mov	ax, [es:0]
 18959 00007BCB 3D5C01                  		cmp	ax, 348
 18960 00007BCE 7241                    		jb	short rpexit
 18961 00007BD0 3D7F01                  		cmp	ax, 383
 18962 00007BD3 773C                    		ja	short rpexit
 18963 00007BD5 E81EFD                  		call	VerifyVersion
 18964 00007BD8 7537                    		jnz	short rpexit
 18965 00007BDA 268B0E1600              		mov	cx, [es:16h]
 18966 00007BDF 81E90002                		sub	cx, 200h
 18967 00007BE3 268E062000              		mov	es, word [es:20h]
 18968 00007BE8 BE[A07B]                		mov	si, RScanPattern2
 18969 00007BEB BA0800                  		mov	dx, 8
 18970 00007BEE E8EDFC                  		call	ScanCodeSeq
 18971 00007BF1 740B                    		jz	short rpfound
 18972 00007BF3 BE[A87B]                		mov	si, RScanPattern3
 18973 00007BF6 BA0F00                  		mov	dx, 15
 18974 00007BF9 E8E2FC                  		call	ScanCodeSeq
 18975 00007BFC 7513                    		jnz	short rpexit
 18976                                  
 18977                                  rpfound:				; ...
 18978 00007BFE B09A                    		mov	al, 9Ah
 18979 00007C00 AA                      		stosb
 18980 00007C01 B8[1612]                		mov	ax, RatBugCode
 18981 00007C04 AB                      		stosw
 18982 00007C05 8CD0                    		mov	ax, ss
 18983 00007C07 AB                      		stosw
 18984 00007C08 89D1                    		mov	cx, dx
 18985 00007C0A 83E906                  		sub	cx, 6
 18986 00007C0D B090                    		mov	al, 90h
 18987 00007C0F F3AA                    		rep stosb
 18988                                  
 18989                                  rpexit:					; ...
 18990 00007C11 1F                      		pop	ds
 18991 00007C12 07                      		pop	es
 18992 00007C13 5F                      		pop	di
 18993 00007C14 5E                      		pop	si
 18994 00007C15 5A                      		pop	dx
 18995 00007C16 59                      		pop	cx
 18996 00007C17 5B                      		pop	bx
 18997 00007C18 58                      		pop	ax
 18998 00007C19 C3                      		retn
 18999                                  ; ---------------------------------------------------------------------------
 19000 00007C1A 89264801                CPScanPattern	db  89h, 26h, 48h, 01h	; 0 ; ...
 19001 00007C1E 8C0E4C01                		db  8Ch, 0Eh, 4Ch, 01h	; 4
 19002 00007C22 C7064A01                		db 0C7h, 06h, 4Ah, 01h	; 8
 19003 00007C26 00018C0E                		db  00h, 01h, 8Ch, 0Eh	; 12
 19004 00007C2A 1301B820                		db  13h, 01h,0B8h, 20h	; 16
 19005 00007C2E 01BE0001                		db  01h,0BEh, 00h, 01h	; 20
 19006                                  
 19007                                  ; =============== S U B	R O U T	I N E =======================================
 19008                                  
 19009                                  
 19010                                  IsCopyProt:
 19011 00007C32 813E1B014353            		cmp	word [11Bh], 5343h
 19012 00007C38 752D                    		jnz	short CP_done
 19013 00007C3A 813E73014450            		cmp	word [173h], 5044h
 19014 00007C40 7525                    		jnz	short CP_done
 19015 00007C42 813E460113F4            		cmp	word [146h], 0F413h
 19016 00007C48 751D                    		jnz	short CP_done
 19017 00007C4A 813E24010080            		cmp	word [124h], 8000h
 19018 00007C50 7515                    		jnz	short CP_done
 19019 00007C52 0E                      		push	cs
 19020 00007C53 07                      		pop	es
 19021 00007C54 BF[1A7C]                		mov	di, CPScanPattern
 19022 00007C57 BE7501                  		mov	si, 175h
 19023 00007C5A B91800                  		mov	cx, 24
 19024 00007C5D F3A6                    		repe cmpsb
 19025 00007C5F 7506                    		jnz	short CP_done
 19026 00007C61 36C606[8500]0A          		mov	byte [ss:A20OFF_COUNT], 0Ah
 19027                                  
 19028                                  CP_done:				; ...
 19029 00007C67 C3                      		retn
 19030                                  
 19031                                  ; ---------------------------------------------------------------------------
 19032                                  
 19033                                  initiret:				; ...
 19034 00007C68 CF                      		iret
 19035                                  ; ---------------------------------------------------------------------------
 19036 00007C69 7000                    InitBioDataSeg:	dw 70h			; ...
 19037                                  
 19038                                  ; =============== S U B	R O U T	I N E =======================================
 19039                                  
 19040                                  
 19041                                  ParaRound:
 19042 00007C6B 83C00F                  		add	ax, 15
 19043 00007C6E D1D8                    		rcr	ax, 1
 19044 00007C70 D1E8                    		shr	ax, 1
 19045 00007C72 D1E8                    		shr	ax, 1
 19046 00007C74 D1E8                    		shr	ax, 1
 19047 00007C76 C3                      		retn
 19048                                  
 19049                                  ; ---------------------------------------------------------------------------
 19050                                  
 19051                                  DOSINIT:				; ...
 19052 00007C77 FA                      		cli
 19053 00007C78 FC                      		cld
 19054 00007C79 52                      		push	dx
 19055 00007C7A 56                      		push	si
 19056 00007C7B 1E                      		push	ds
 19057 00007C7C 57                      		push	di
 19058 00007C7D 8CC3                    		mov	bx, es
 19059 00007C7F B8[8981]                		mov	ax, MEMSTRT
 19060 00007C82 83C00F                  		add	ax, 0Fh
 19061 00007C85 83E0F0                  		and	ax, 0FFF0h
 19062 00007C88 89C6                    		mov	si, ax
 19063 00007C8A 8CC8                    		mov	ax, cs
 19064 00007C8C 8ED8                    		mov	ds, ax
 19065 00007C8E 2E8E06[697C]            		mov	es, [cs:InitBioDataSeg]
 19066 00007C93 268E060300              		mov	es, word [es:3] ; DosDataSg equ 3
 19067 00007C98 31FF                    		xor	di, di
 19068 00007C9A B96A13                  		mov	cx, 4970	; DOSDATASIZE (MSDAT001E)
 19069 00007C9D F3A4                    		rep movsb
 19070 00007C9F 5F                      		pop	di
 19071 00007CA0 1F                      		pop	ds
 19072 00007CA1 5E                      		pop	si
 19073 00007CA2 5A                      		pop	dx
 19074 00007CA3 06                      		push	es
 19075 00007CA4 1E                      		push	ds
 19076 00007CA5 07                      		pop	es
 19077 00007CA6 1F                      		pop	ds
 19078 00007CA7 893E[4010]              		mov	word [BiosDataPtr], di
 19079 00007CAB 891E[4210]              		mov	word [BiosDataPtr+2], bx
 19080 00007CAF 2E8C1E[0700]            		mov	[cs:DosDSeg], ds
 19081 00007CB4 2E8C1E[9652]            		mov	word [cs:LowInt23Addr+2], ds
 19082 00007CB9 2E8C1E[9A52]            		mov	word [cs:LowInt24Addr+2], ds
 19083 00007CBE 2E8C1E[9E52]            		mov	word [cs:LowInt28Addr+2], ds
 19084 00007CC3 8916[4603]              		mov	[ENDMEM], dx
 19085 00007CC7 8926[8405]              		mov	[USER_SP], sp
 19086 00007CCB 8C16[8605]              		mov	[USER_SS], ss
 19087 00007CCF 8CD8                    		mov	ax, ds
 19088 00007CD1 8ED0                    		mov	ss, ax
 19089 00007CD3 BC[2009]                		mov	sp, DSKSTACK
 19090 00007CD6 C706[1212][4164]        		mov	word [FixExePatch], RetExePatch
 19091 00007CDC C706[1412][4164]        		mov	word [RationalPatchPtr], RetExePatch
 19092 00007CE2 C706[6100][4164]        		mov	word [ChkCopyProt], RetExePatch
 19093 00007CE8 E84203                  		call	WhatCPUType
 19094 00007CEB 3C02                    		cmp	al, 2
 19095 00007CED B8[1277]                		mov	ax, Rational386Patch
 19096 00007CF0 7303                    		jnb	short di_set_patch
 19097 00007CF2 B8[4164]                		mov	ax, RetExePatch
 19098                                  
 19099                                  di_set_patch:				; ...
 19100 00007CF5 A3[6213]                		mov	[Rational386PatchPtr], ax
 19101 00007CF8 8CC8                    		mov	ax, cs
 19102 00007CFA A3[AA0A]                		mov	[TEMP_DOSLOC], ax
 19103 00007CFD 8C06[4A00]              		mov	word [NULDEV+2], es
 19104 00007D01 8936[4800]              		mov	word [NULDEV], si
 19105 00007D05 8C1E[F20F]              		mov	[SIS_Instance_Data_Ptr_2], ds
 19106 00007D09 56                      		push	si
 19107 00007D0A B90700                  		mov	cx, 7
 19108 00007D0D BE[F60F]                		mov	si, Instance_Table_2
 19109                                  
 19110                                  Instance_init_loop:			; ...
 19111 00007D10 8C1C                    		mov	word [si], ds
 19112 00007D12 83C606                  		add	si, 6
 19113 00007D15 E2F9                    		loop	Instance_init_loop
 19114 00007D17 B90500                  		mov	cx, 5
 19115 00007D1A BE[ED11]                		mov	si, OldInstanceJunk_6
 19116                                  
 19117                                  OldInstance_init_loop:			; ...
 19118 00007D1D 8C1C                    		mov	word [si], ds
 19119 00007D1F 83C606                  		add	si, 6
 19120 00007D22 E2F9                    		loop	OldInstance_init_loop
 19121 00007D24 5E                      		pop	si
 19122 00007D25 06                      		push	es
 19123 00007D26 1F                      		pop	ds
 19124 00007D27 1E                      		push	ds
 19125 00007D28 31C0                    		xor	ax, ax
 19126 00007D2A 8ED8                    		mov	ds, ax
 19127 00007D2C B8[687C]                		mov	ax, initiret
 19128 00007D2F A3A800                  		mov	[0A8h], ax	; [2Ah*4]
 19129 00007D32 8CC8                    		mov	ax, cs
 19130 00007D34 A3AA00                  		mov	[0AAh], ax
 19131 00007D37 1F                      		pop	ds
 19132 00007D38 E83702                  		call	CHARINIT
 19133 00007D3B 56                      		push	si
 19134 00007D3C 16                      		push	ss
 19135 00007D3D 07                      		pop	es
 19136 00007D3E BF[D200]                		mov	di, SFT0_SFTable	; SFTABL+SFT.SFTable
 19137 00007D41 B80300                  		mov	ax, 3
 19138 00007D44 AB                      		stosw
 19139 00007D45 FEC8                    		dec	al
 19140 00007D47 AB                      		stosw
 19141 00007D48 30C0                    		xor	al, al
 19142 00007D4A AA                      		stosb
 19143 00007D4B B0C3                    		mov	al, 0C3h
 19144 00007D4D AB                      		stosw
 19145 00007D4E 89F0                    		mov	ax, si
 19146 00007D50 AB                      		stosw
 19147 00007D51 8CD8                    		mov	ax, ds
 19148 00007D53 AB                      		stosw
 19149 00007D54 31C0                    		xor	ax, ax
 19150 00007D56 AB                      		stosw
 19151 00007D57 AB                      		stosw
 19152 00007D58 AB                      		stosw
 19153 00007D59 48                      		dec	ax
 19154 00007D5A AB                      		stosw
 19155 00007D5B AB                      		stosw
 19156 00007D5C 40                      		inc	ax
 19157 00007D5D AB                      		stosw
 19158 00007D5E AB                      		stosw
 19159 00007D5F 83C707                  		add	di, 7
 19160 00007D62 83C60A                  		add	si, 10
 19161 00007D65 B90400                  		mov	cx, 4
 19162 00007D68 F3A5                    		rep movsw
 19163 00007D6A B103                    		mov	cl, 3
 19164 00007D6C B020                    		mov	al, ' '
 19165 00007D6E F3AA                    		rep stosb
 19166 00007D70 5E                      		pop	si
 19167 00007D71 804C0403                		or	byte [si+4], 3
 19168 00007D75 368936[3200]            		mov	word [ss:BCON], si
 19169 00007D7A 368C1E[3400]            		mov	word [ss:BCON+2], ds
 19170                                  
 19171                                  char_init_loop:				; ...
 19172 00007D7F C534                    		lds	si, [si]
 19173 00007D81 E8EE01                  		call	CHARINIT
 19174 00007D84 F6440408                		test	byte [si+4], 8
 19175 00007D88 74F5                    		jz	short char_init_loop
 19176 00007D8A 368936[2E00]            		mov	word [ss:BCLOCK], si
 19177 00007D8F 368C1E[3000]            		mov	word [ss:BCLOCK+2], ds
 19178 00007D94 BD6A13                  		mov	bp, 4970	; MSDAT001E
 19179 00007D97 36892E[2600]            		mov	word [ss:DPBHEAD], bp
 19180 00007D9C 368C06[2800]            		mov	word [ss:DPBHEAD+2], es
 19181                                  
 19182                                  PERDRV:					; ...
 19183 00007DA1 C534                    		lds	si, [si]
 19184 00007DA3 83FEFF                  		cmp	si, -1
 19185 00007DA6 747B                    		jz	short CONTINIT
 19186 00007DA8 E8C701                  		call	CHARINIT
 19187 00007DAB F744040080              		test	word [si+4], 8000h
 19188 00007DB0 75EF                    		jnz	short PERDRV
 19189 00007DB2 368A0E[6703]            		mov	cl, [ss:CALLUNIT]
 19190 00007DB7 30ED                    		xor	ch, ch
 19191 00007DB9 884C0A                  		mov	[si+10], cl
 19192 00007DBC 368A16[4600]            		mov	dl, [ss:NUMIO]
 19193 00007DC1 30F6                    		xor	dh, dh
 19194 00007DC3 36000E[4600]            		add	[ss:NUMIO], cl
 19195 00007DC8 1E                      		push	ds
 19196 00007DC9 56                      		push	si
 19197 00007DCA 36C51E[6C03]            		lds	bx, [ss:CALLBPB]
 19198                                  
 19199                                  PERUNIT:				; ...
 19200 00007DCF 8B37                    		mov	si, [bx]
 19201 00007DD1 43                      		inc	bx
 19202 00007DD2 43                      		inc	bx
 19203 00007DD3 26885600                		mov	[es:bp+0], dl
 19204 00007DD7 26887601                		mov	[es:bp+1], dh
 19205 00007DDB 53                      		push	bx
 19206 00007DDC 51                      		push	cx
 19207 00007DDD 52                      		push	dx
 19208 00007DDE E81592                  		call	$SETDPB
 19209 00007DE1 268B4602                		mov	ax, [es:bp+2]
 19210 00007DE5 363B06[3600]            		cmp	ax, [ss:MAXSEC]
 19211 00007DEA 7604                    		jbe	short NOTMAX
 19212 00007DEC 36A3[3600]              		mov	[ss:MAXSEC], ax
 19213                                  
 19214                                  NOTMAX:					; ...
 19215 00007DF0 89E8                    		mov	ax, bp
 19216 00007DF2 83C021                  		add	ax, 33		; DPBSIZ
 19217 00007DF5 26894619                		mov	[es:bp+19h], ax
 19218 00007DF9 268C461B                		mov	word [es:bp+1Bh], es
 19219 00007DFD 26C64618FF              		mov	byte [es:bp+18h], 0FFh
 19220 00007E02 5A                      		pop	dx
 19221 00007E03 59                      		pop	cx
 19222 00007E04 5B                      		pop	bx
 19223 00007E05 8CD8                    		mov	ax, ds
 19224 00007E07 5E                      		pop	si
 19225 00007E08 1F                      		pop	ds
 19226 00007E09 26897613                		mov	[es:bp+13h], si
 19227 00007E0D 268C5E15                		mov	word [es:bp+15h], ds
 19228 00007E11 1E                      		push	ds
 19229 00007E12 56                      		push	si
 19230 00007E13 FEC6                    		inc	dh
 19231 00007E15 FEC2                    		inc	dl
 19232 00007E17 8ED8                    		mov	ds, ax
 19233 00007E19 83C521                  		add	bp, 33		; DPBSIZ
 19234 00007E1C E2B1                    		loop	PERUNIT
 19235 00007E1E 5E                      		pop	si
 19236 00007E1F 1F                      		pop	ds
 19237 00007E20 E97EFF                  		jmp	PERDRV
 19238                                  ; ---------------------------------------------------------------------------
 19239                                  
 19240                                  CONTINIT:				; ...
 19241 00007E23 83ED21                  		sub	bp, 33
 19242 00007E26 C74619FFFF              		mov	word [bp+19h], 0FFFFh
 19243 00007E2B C7461BFFFF              		mov	word [bp+1Bh], 0FFFFh
 19244 00007E30 83C521                  		add	bp, 33
 19245 00007E33 16                      		push	ss
 19246 00007E34 1F                      		pop	ds
 19247 00007E35 89E8                    		mov	ax, bp
 19248 00007E37 E831FE                  		call	ParaRound
 19249 00007E3A 8CDA                    		mov	dx, ds
 19250 00007E3C 01C2                    		add	dx, ax
 19251 00007E3E BB0F00                  		mov	bx, 0Fh
 19252 00007E41 8B0E[4603]              		mov	cx, [ENDMEM]
 19253 00007E45 8C1E[A203]              		mov	[DOSSEG_INIT], ds
 19254 00007E49 52                      		push	dx
 19255 00007E4A A1[AA0A]                		mov	ax, [TEMP_DOSLOC]
 19256 00007E4D 8EC0                    		mov	es, ax
 19257 00007E4F C706[AA0A]FFFF          		mov	word [TEMP_DOSLOC], 0FFFFh
 19258 00007E55 E8FA01                  		call	patch_vec_segments
 19259 00007E58 E83A02                  		call	patch_misc_segments
 19260 00007E5B 8C06[AA0A]              		mov	[TEMP_DOSLOC], es
 19261 00007E5F 5A                      		pop	dx
 19262 00007E60 31C0                    		xor	ax, ax
 19263 00007E62 8ED8                    		mov	ds, ax
 19264 00007E64 8EC0                    		mov	es, ax
 19265 00007E66 BF9000                  		mov	di, 90h
 19266 00007E69 36A1[AA0A]              		mov	ax, [ss:TEMP_DOSLOC]
 19267 00007E6D 894502                  		mov	[di+2],	ax
 19268 00007E70 BF8200                  		mov	di, 82h
 19269 00007E73 C7060000[7754]          		mov	word [0], DIVOV
 19270 00007E79 BF8000                  		mov	di, 80h		; INTBASE
 19271 00007E7C B8[F202]                		mov	ax, irett
 19272 00007E7F B90900                  		mov	cx, 9
 19273                                  
 19274                                  iset1:					; ...
 19275 00007E82 AB                      		stosw
 19276 00007E83 83C702                  		add	di, 2
 19277 00007E86 E2FA                    		loop	iset1
 19278 00007E88 83C704                  		add	di, 4
 19279 00007E8B B90600                  		mov	cx, 6
 19280                                  
 19281                                  iset2:					; ...
 19282 00007E8E AB                      		stosw
 19283 00007E8F 83C702                  		add	di, 2
 19284 00007E92 E2FA                    		loop	iset2
 19285 00007E94 83C708                  		add	di, 8
 19286 00007E97 B90E00                  		mov	cx, 14
 19287                                  
 19288                                  iset3:					; ...
 19289 00007E9A AB                      		stosw
 19290 00007E9B 83C702                  		add	di, 2
 19291 00007E9E E2FA                    		loop	iset3
 19292 00007EA0 C706BC00[DD06]          		mov	word [0BCh], INT2F
 19293 00007EA6 36A1[AA0A]              		mov	ax, [ss:TEMP_DOSLOC]
 19294 00007EAA A3BE00                  		mov	[0BEh], ax
 19295 00007EAD C606C000EA              		mov	byte [0C0h], 0EAh
 19296 00007EB2 C706C100[F302]          		mov	word [0C1h], call_entry
 19297 00007EB8 C7068000[EC02]          		mov	word [80h], quit
 19298 00007EBE C7068400[1803]          		mov	word [84h], command
 19299 00007EC4 C70688000001            		mov	word [88h], 100h
 19300 00007ECA 89168A00                		mov	[8Ah], dx
 19301 00007ECE C7069400[0505]          		mov	word [94h], ABSDRD
 19302 00007ED4 C7069800[8C05]          		mov	word [98h], ABSDWRT
 19303 00007EDA C7069C00[E463]          		mov	word [9Ch], stay_resident
 19304 00007EE0 16                      		push	ss
 19305 00007EE1 1F                      		pop	ds
 19306 00007EE2 16                      		push	ss
 19307 00007EE3 07                      		pop	es
 19308 00007EE4 52                      		push	dx
 19309 00007EE5 42                      		inc	dx
 19310 00007EE6 8916[3003]              		mov	[CurrentPDB], dx
 19311 00007EEA 31FF                    		xor	di, di
 19312 00007EEC 8EC2                    		mov	es, dx
 19313 00007EEE 31C0                    		xor	ax, ax
 19314 00007EF0 B98000                  		mov	cx, 128
 19315 00007EF3 F3AB                    		rep stosw
 19316 00007EF5 A1[4603]                		mov	ax, [ENDMEM]
 19317 00007EF8 E86492                  		call	SETMEM
 19318 00007EFB 16                      		push	ss
 19319 00007EFC 1F                      		pop	ds
 19320 00007EFD BF1800                  		mov	di, 24
 19321 00007F00 31C0                    		xor	ax, ax
 19322 00007F02 AB                      		stosw
 19323 00007F03 AA                      		stosb
 19324 00007F04 B0FF                    		mov	al, 0FFh
 19325 00007F06 B91100                  		mov	cx, 17
 19326 00007F09 F3AA                    		rep stosb
 19327 00007F0B 16                      		push	ss
 19328 00007F0C 07                      		pop	es
 19329 00007F0D 8C1E[2C00]              		mov	word [SFT_ADDR+2], ds
 19330 00007F11 BE[280D]                		mov	si, SysInitTable
 19331 00007F14 268C4406                		mov	word [es:si+6], es
 19332 00007F18 268C4402                		mov	word [es:si+2], es
 19333 00007F1C 268C06[3A00]            		mov	word [es:BUFFHEAD+2], es
 19334 00007F21 BE[6D00]                		mov	si, BufferQueue ; HASHINITVAR
 19335 00007F24 268936[3800]            		mov	word [es:BUFFHEAD], si
 19336 00007F29 5A                      		pop	dx
 19337 00007F2A 8916[2E03]              		mov	word [DMAADD+2], dx
 19338 00007F2E 268916[2400]            		mov	[es:arena_head], dx
 19339 00007F33 8EDA                    		mov	ds, dx
 19340 00007F35 C60600005A              		mov	byte [0], 'Z'
 19341 00007F3A C70601000000            		mov	word [1], 0
 19342 00007F40 36A1[4603]              		mov	ax, [ss:ENDMEM]
 19343 00007F44 29D0                    		sub	ax, dx
 19344 00007F46 48                      		dec	ax
 19345 00007F47 A30300                  		mov	[3], ax
 19346 00007F4A BF[D200]                		mov	di, SFT0_SFTable
 19347 00007F4D B80300                  		mov	ax, 3
 19348 00007F50 AB                      		stosw
 19349 00007F51 BF[280D]                		mov	di, SysInitTable
 19350 00007F54 42                      		inc	dx
 19351 00007F55 8EDA                    		mov	ds, dx
 19352 00007F57 BA[C57F]                		mov	dx, _seg_reinit
 19353 00007F5A B9[2279]                		mov	cx, exepatch_start
 19354 00007F5D 81E9[0000]              		sub	cx, $STARTCODE
 19355 00007F61 B8[687C]                		mov	ax, initiret
 19356 00007F64 2D[0000]                		sub	ax, $STARTCODE
 19357 00007F67 368B26[8405]            		mov	sp, [ss:USER_SP]
 19358 00007F6C 368E16[8605]            		mov	ss, [ss:USER_SS]
 19359 00007F71 CB                      		retf
 19360                                  
 19361                                  ; =============== S U B	R O U T	I N E =======================================
 19362                                  
 19363                                  
 19364                                  CHARINIT:
 19365 00007F72 36C606[5A03]1A          		mov	byte [ss:DEVCALL], 26
 19366 00007F78 36C606[5B03]00          		mov	byte [ss:DEVCALL_REQUNIT], 0
 19367 00007F7E 36C606[5C03]00          		mov	byte [ss:DEVCALL_REQFUNC], 0
 19368 00007F84 36C706[5D03]0000        		mov	word [ss:DEVCALL_REQSTAT], 0
 19369 00007F8B 06                      		push	es
 19370 00007F8C 53                      		push	bx
 19371 00007F8D 50                      		push	ax
 19372 00007F8E BB[5A03]                		mov	bx, DEVCALL
 19373 00007F91 16                      		push	ss
 19374 00007F92 07                      		pop	es
 19375 00007F93 E877C8                  		call	DEVIOCALL2
 19376 00007F96 58                      		pop	ax
 19377 00007F97 5B                      		pop	bx
 19378 00007F98 07                      		pop	es
 19379 00007F99 C3                      		retn
 19380                                  
 19381                                  ; =============== S U B	R O U T	I N E =======================================
 19382                                  
 19383                                  
 19384                                  check_XMM:
 19385 00007F9A 50                      		push	ax
 19386 00007F9B B80043                  		mov	ax, 4300h
 19387 00007F9E CD2F                    		int	2Fh		; - Multiplex -	XMS - INSTALLATION CHECK
 19388                                  					; Return: AL = 80h XMS driver installed
 19389                                  					; AL <>	80h no driver
 19390 00007FA0 3C80                    		cmp	al, 80h
 19391 00007FA2 751D                    		jnz	short cXMM_no_driver
 19392 00007FA4 53                      		push	bx
 19393 00007FA5 52                      		push	dx
 19394 00007FA6 1E                      		push	ds
 19395 00007FA7 06                      		push	es
 19396 00007FA8 B81043                  		mov	ax, 4310h
 19397 00007FAB CD2F                    		int	2Fh		; - Multiplex -	XMS - GET DRIVER ADDRESS
 19398                                  					; Return: ES:BX	-> driver entry	point
 19399 00007FAD 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
 19400 00007FB2 891E[6311]              		mov	word [XMMcontrol], bx
 19401 00007FB6 8C06[6511]              		mov	word [XMMcontrol+2], es
 19402 00007FBA F8                      		clc
 19403 00007FBB 07                      		pop	es
 19404 00007FBC 1F                      		pop	ds
 19405 00007FBD 5A                      		pop	dx
 19406 00007FBE 5B                      		pop	bx
 19407 00007FBF 58                      		pop	ax
 19408 00007FC0 C3                      		retn
 19409                                  ; ---------------------------------------------------------------------------
 19410                                  
 19411                                  cXMM_no_driver:				; ...
 19412 00007FC1 F9                      		stc
 19413 00007FC2 58                      		pop	ax
 19414 00007FC3 C3                      		retn
 19415                                  
 19416                                  ; ---------------------------------------------------------------------------
 19417 00007FC4 00                      num_entry:	db 0			; ...
 19418                                  ; ---------------------------------------------------------------------------
 19419                                  
 19420                                  _seg_reinit:				; ...
 19421 00007FC5 1E                      		push	ds
 19422 00007FC6 2E8E1E[0700]            		mov	ds, [cs:DosDSeg]
 19423 00007FCB E8C700                  		call	patch_misc_segments
 19424 00007FCE 83F800                  		cmp	ax, 0
 19425 00007FD1 754D                    		jnz	short patch_vec_seg
 19426 00007FD3 2E803E[C47F]00          		cmp	byte [cs:num_entry], 0
 19427 00007FD9 7508                    		jnz	short second_entry
 19428 00007FDB 8CD8                    		mov	ax, ds
 19429 00007FDD E87200                  		call	patch_vec_segments
 19430 00007FE0 E80301                  		call	patch_offset
 19431                                  
 19432                                  second_entry:				; ...
 19433 00007FE3 8CC0                    		mov	ax, es
 19434 00007FE5 BF[6210]                		mov	di, DOSINTTABLE
 19435 00007FE8 B90900                  		mov	cx, 9
 19436 00007FEB 1E                      		push	ds
 19437 00007FEC 07                      		pop	es
 19438                                  
 19439                                  dosinttabloop:				; ...
 19440 00007FED 83C702                  		add	di, 2
 19441 00007FF0 AB                      		stosw
 19442 00007FF1 E2FA                    		loop	dosinttabloop
 19443 00007FF3 3D00F0                  		cmp	ax, 0F000h
 19444 00007FF6 722D                    		jb	short sr_done
 19445 00007FF8 E89FFF                  		call	check_XMM
 19446 00007FFB 7228                    		jb	short sr_done
 19447 00007FFD E87201                  		call	patch_in_nops
 19448 00008000 C606[1112]01            		mov	byte [DosHasHMA], 1
 19449 00008005 C706[1212][727A]        		mov	word [FixExePatch], ExePatch
 19450 0000800B C706[6100][327C]        		mov	word [ChkCopyProt], IsCopyProt
 19451 00008011 E81900                  		call	WhatCPUType
 19452 00008014 3C01                    		cmp	al, 1
 19453 00008016 750D                    		jnz	short sr_done
 19454 00008018 C706[1412][AF7B]        		mov	word [RationalPatchPtr], RationalPatch
 19455 0000801E EB05                    		jmp	short sr_done
 19456                                  ; ---------------------------------------------------------------------------
 19457                                  
 19458                                  patch_vec_seg:				; ...
 19459 00008020 8CC0                    		mov	ax, es
 19460 00008022 E82D00                  		call	patch_vec_segments
 19461                                  
 19462                                  sr_done:				; ...
 19463 00008025 2EC606[C47F]01          		mov	byte [cs:num_entry], 1
 19464 0000802B 1F                      		pop	ds
 19465 0000802C CB                      		retf
 19466                                  
 19467                                  ; =============== S U B	R O U T	I N E =======================================
 19468                                  
 19469                                  
 19470                                  WhatCPUType:
 19471 0000802D 9C                      		pushf
 19472 0000802E 53                      		push	bx
 19473 0000802F 31DB                    		xor	bx, bx
 19474 00008031 31C0                    		xor	ax, ax
 19475 00008033 50                      		push	ax
 19476 00008034 9D                      		popf
 19477 00008035 9C                      		pushf
 19478 00008036 58                      		pop	ax
 19479 00008037 2500F0                  		and	ax, 0F000h
 19480 0000803A 3D00F0                  		cmp	ax, 0F000h
 19481 0000803D 740E                    		jz	short cpu_8086
 19482 0000803F B800F0                  		mov	ax, 0F000h
 19483 00008042 50                      		push	ax
 19484 00008043 9D                      		popf
 19485 00008044 9C                      		pushf
 19486 00008045 58                      		pop	ax
 19487 00008046 2500F0                  		and	ax, 0F000h
 19488 00008049 7401                    		jz	short cpu_286
 19489                                  
 19490                                  cpu_386:
 19491 0000804B 43                      		inc	bx
 19492                                  
 19493                                  cpu_286:				; ...
 19494 0000804C 43                      		inc	bx
 19495                                  
 19496                                  cpu_8086:				; ...
 19497 0000804D 89D8                    		mov	ax, bx
 19498 0000804F 5B                      		pop	bx
 19499 00008050 9D                      		popf
 19500 00008051 C3                      		retn
 19501                                  
 19502                                  ; =============== S U B	R O U T	I N E =======================================
 19503                                  
 19504                                  
 19505                                  patch_vec_segments:
 19506 00008052 06                      		push	es
 19507 00008053 31C9                    		xor	cx, cx
 19508 00008055 8EC1                    		mov	es, cx
 19509 00008057 BF8200                  		mov	di, 82h		; INTBASE+2
 19510 0000805A 26A30200                		mov	[es:2], ax
 19511 0000805E B90200                  		mov	cx, 2
 19512                                  
 19513                                  ps_set1:				; ...
 19514 00008061 AB                      		stosw
 19515 00008062 83C702                  		add	di, 2
 19516 00008065 E2FA                    		loop	ps_set1
 19517 00008067 83C704                  		add	di, 4
 19518 0000806A AB                      		stosw
 19519 0000806B 83C706                  		add	di, 6
 19520 0000806E B90400                  		mov	cx, 4
 19521                                  
 19522                                  ps_set2:				; ...
 19523 00008071 AB                      		stosw
 19524 00008072 83C702                  		add	di, 2
 19525 00008075 E2FA                    		loop	ps_set2
 19526 00008077 83C704                  		add	di, 4
 19527 0000807A B90600                  		mov	cx, 6
 19528                                  
 19529                                  ps_set3:				; ...
 19530 0000807D AB                      		stosw
 19531 0000807E 83C702                  		add	di, 2
 19532 00008081 E2FA                    		loop	ps_set3
 19533 00008083 83C708                  		add	di, 8
 19534 00008086 B90E00                  		mov	cx, 14
 19535                                  
 19536                                  ps_set4:				; ...
 19537 00008089 AB                      		stosw
 19538 0000808A 83C702                  		add	di, 2
 19539 0000808D E2FA                    		loop	ps_set4
 19540 0000808F 26A3C300                		mov	[es:0C3h], ax
 19541 00008093 07                      		pop	es
 19542 00008094 C3                      		retn
 19543                                  
 19544                                  ; =============== S U B	R O U T	I N E =======================================
 19545                                  
 19546                                  
 19547                                  patch_misc_segments:
 19548 00008095 53                      		push	bx
 19549 00008096 06                      		push	es
 19550 00008097 50                      		push	ax
 19551 00008098 8CC0                    		mov	ax, es
 19552 0000809A 1E                      		push	ds
 19553 0000809B 07                      		pop	es
 19554 0000809C BF[9000]                		mov	di, JShare
 19555 0000809F 8B1E[AA0A]              		mov	bx, [TEMP_DOSLOC]
 19556 000080A3 B90F00                  		mov	cx, 15
 19557                                  
 19558                                  jumptabloop:				; ...
 19559 000080A6 83C702                  		add	di, 2
 19560 000080A9 83FBFF                  		cmp	bx, 0FFFFh
 19561 000080AC 7405                    		jz	short share_patch
 19562 000080AE 263B1D                  		cmp	bx, [es:di]
 19563 000080B1 7501                    		jnz	short no_share_patch
 19564                                  
 19565                                  share_patch:				; ...
 19566 000080B3 AB                      		stosw
 19567                                  
 19568                                  no_share_patch:				; ...
 19569 000080B4 E2F0                    		loop	jumptabloop
 19570 000080B6 BE[2A12]                		mov	si, COUNTRY_CDPG
 19571 000080B9 8C5C4F                  		mov	word [si+4Fh], ds
 19572 000080BC 8C5C54                  		mov	word [si+54h], ds
 19573 000080BF 8C5C59                  		mov	word [si+59h], ds
 19574 000080C2 8C5C5E                  		mov	word [si+5Eh], ds
 19575 000080C5 8C9C8000                		mov	word [si+80h], ds
 19576 000080C9 8C5C63                  		mov	word [si+63h], ds
 19577 000080CC BE[300D]                		mov	si, FastOpenTable
 19578 000080CF 833E[AA0A]FF            		cmp	word [TEMP_DOSLOC], 0FFFFh
 19579 000080D4 7409                    		jz	short fast_patch
 19580 000080D6 8B0E[AA0A]              		mov	cx, [TEMP_DOSLOC]
 19581 000080DA 3B4C04                  		cmp	cx, [si+4]
 19582 000080DD 7503                    		jnz	short no_fast_patch
 19583                                  
 19584                                  fast_patch:				; ...
 19585 000080DF 894404                  		mov	[si+4],	ax
 19586                                  
 19587                                  no_fast_patch:				; ...
 19588 000080E2 58                      		pop	ax
 19589 000080E3 07                      		pop	es
 19590 000080E4 5B                      		pop	bx
 19591 000080E5 C3                      		retn
 19592                                  
 19593                                  ; =============== S U B	R O U T	I N E =======================================
 19594                                  
 19595                                  
 19596                                  patch_offset:
 19597 000080E6 06                      		push	es
 19598 000080E7 31C0                    		xor	ax, ax
 19599 000080E9 8EC0                    		mov	es, ax
 19600 000080EB 26C7060000[8A10]        		mov	word [es:0], ldivov
 19601 000080F2 BF8000                  		mov	di, 80h
 19602 000080F5 B8[DA10]                		mov	ax, lirett
 19603 000080F8 B90200                  		mov	cx, 2
 19604                                  
 19605                                  po_iset1:				; ...
 19606 000080FB AB                      		stosw
 19607 000080FC 83C702                  		add	di, 2
 19608 000080FF E2FA                    		loop	po_iset1
 19609 00008101 83C704                  		add	di, 4
 19610 00008104 AB                      		stosw
 19611 00008105 83C706                  		add	di, 6
 19612 00008108 B90400                  		mov	cx, 4
 19613                                  
 19614                                  po_iset2:				; ...
 19615 0000810B AB                      		stosw
 19616 0000810C 83C702                  		add	di, 2
 19617 0000810F E2FA                    		loop	po_iset2
 19618 00008111 83C704                  		add	di, 4
 19619 00008114 B90600                  		mov	cx, 6
 19620                                  
 19621                                  po_iset3:				; ...
 19622 00008117 AB                      		stosw
 19623 00008118 83C702                  		add	di, 2
 19624 0000811B E2FA                    		loop	po_iset3
 19625 0000811D 83C708                  		add	di, 8
 19626 00008120 B90E00                  		mov	cx, 14
 19627                                  
 19628                                  po_iset4:				; ...
 19629 00008123 AB                      		stosw
 19630 00008124 83C702                  		add	di, 2
 19631 00008127 E2FA                    		loop	po_iset4
 19632 00008129 26C706BC00[C610]        		mov	word [es:0BCh], lint2f
 19633 00008130 26C606C000EA            		mov	byte [es:0C0h], 0EAh
 19634 00008136 26C706C100[D010]        		mov	word [es:0C1h], lcall_entry
 19635 0000813D 26C7068000[9410]        		mov	word [es:80h], lquit
 19636 00008144 26C7068400[9E10]        		mov	word [es:84h], lcommand
 19637 0000814B 26C7069400[A810]        		mov	word [es:94h], labsdrd
 19638 00008152 26C7069800[B210]        		mov	word [es:98h], labsdwrt
 19639 00008159 26C7069C00[BC10]        		mov	word [es:9Ch], lstay_resident
 19640 00008160 07                      		pop	es
 19641 00008161 C3                      		retn
 19642                                  
 19643                                  ; ---------------------------------------------------------------------------
 19644 00008162 [8A10]                  patch_table:	dw ldivov
 19645 00008164 [9410]                  		dw lquit
 19646 00008166 [9E10]                  		dw lcommand
 19647 00008168 [A810]                  		dw labsdrd
 19648 0000816A [B210]                  		dw labsdwrt
 19649 0000816C [BC10]                  		dw lstay_resident
 19650 0000816E [C610]                  		dw lint2f
 19651 00008170 [D010]                  		dw lcall_entry
 19652                                  
 19653                                  ; =============== S U B	R O U T	I N E =======================================
 19654                                  
 19655                                  
 19656                                  patch_in_nops:
 19657 00008172 50                      		push	ax
 19658 00008173 56                      		push	si
 19659 00008174 BE[6281]                		mov	si, patch_table
 19660 00008177 B89090                  		mov	ax, 9090h
 19661 0000817A B90800                  		mov	cx, 8
 19662                                  
 19663                                  pin_loop:				; ...
 19664 0000817D 2E8B3C                  		mov	di, [cs:si]
 19665 00008180 AB                      		stosw
 19666 00008181 83C602                  		add	si, 2
 19667 00008184 E2F7                    		loop	pin_loop
 19668 00008186 5E                      		pop	si
 19669 00008187 58                      		pop	ax
 19670 00008188 C3                      		retn
 19671                                  
 19672                                  ; ---------------------------------------------------------------------------
 19673 00008189 00000000000000          MEMSTRT		db 7 dup(0)		; (MSDOS.SYS - DOSCODE:BF69h)
 19674                                  
 19675                                  
 19676                                  ; ===========================================================================
 19677                                  
 19678                                  ; ----------------------------------------------------------------------------
 19679                                  segment DOSDATA vstart=0
 19680                                  ; ----------------------------------------------------------------------------
 19681                                  
 19682 00000000 00000000                byte_BF70	db 4 dup(0)		; ...
 19683 00000004 0100                    DataVersion	dw 1			; ...
 19684 00000006 0000000000000000        WinoldPatch1	db 8 dup(0)		; ...
 19685 0000000E 0000                    MYNUM		dw 0			; ...
 19686 00000010 0000                    FCBLRU		dw 0			; ...
 19687 00000012 0000                    OpenLRU		dw 0
 19688 00000014 FFFFFFFF                OEM_HANDLER	dd 0FFFFFFFFh		; ...
 19689 00000018 [2404]                  LeaveAddr	dw LeaveDOS		; ...
 19690 0000001A 0300                    RetryCount	dw 3			; ...
 19691 0000001C 0100                    RetryLoop	dw 1			; ...
 19692 0000001E FFFFFFFF                LastBuffer	dd 0FFFFFFFFh		; ...
 19693 00000022 0000                    CONTPOS		dw 0			; ...
 19694 00000024 0000                    arena_head	dw 0			; ...
 19695 00000026 00000000                DPBHEAD		dd 0			; ...
 19696 0000002A [CC000000]              SFT_ADDR	dd SFTABL		; ...
 19697 0000002E 00000000                BCLOCK		dd 0			; ...
 19698 00000032 00000000                BCON		dd 0			; ...
 19699 00000036 8000                    MAXSEC		dw 128			; ...
 19700 00000038 00000000                BUFFHEAD	dd 0			; ...
 19701 0000003C 00000000                CDSADDR		dd 0			; ...
 19702 00000040 00000000                SFTFCB		dd 0			; ...
 19703 00000044 0000                    KEEPCOUNT	dw 0
 19704 00000046 00                      NUMIO		db 0			; ...
 19705 00000047 00                      CDSCOUNT	db 0			; ...
 19706 00000048 00000000                NULDEV		dd 0			; ...
 19707 0000004C 0480                    		dw 8004h		; DEVTYP|ISNULL
 19708 0000004E [C60D]                  		dw SNULDEV
 19709 00000050 [CC0D]                  off_BFC0	dw INULDEV		; ...
 19710 00000052 4E554C2020202020        aNul		db 'NUL     '           ; ...
 19711 0000005A 00                      SPLICES		db 0			; ...
 19712 0000005B 0000                    Special_Entries	dw 0
 19713 0000005D 00000000                UU_IFS_DOS_CALL	dd 0			; ...
 19714 00000061 0000                    ChkCopyProt	dw 0			; ...
 19715 00000063 0000                    A20OFF_PSP	dw 0			; ...
 19716 00000065 0000                    BUFFERS_PARM1	dw 0
 19717 00000067 0000                    BUFFERS_PARM2	dw 0
 19718 00000069 00                      BOOTDRIVE	db 0			; ...
 19719 0000006A 00                      DDMOVE		db 0			; ...
 19720 0000006B 0000                    EXT_MEM_SIZE	dw 0
 19721 0000006D 00000000                BufferQueue	dd 0			; ...
 19722 00000071 0000                    DirtyBufferCount dw 0			; ...
 19723 00000073 00000000                SC_CACHE_PTR	dd 0			; ...
 19724 00000077 0000                    SC_CACHE_COUNT	dw 0			; ...
 19725 00000079 00                      BuffInHMA	db 0			; ...
 19726 0000007A 00000000                LoMemBuff	dd 0			; ...
 19727 0000007E 000000                  UU_BUF_EMS_FIRST_PAGE db 3 dup(0)	; ...
 19728 00000081 FFFF                    CL0FATENTRY	dw 0FFFFh		; ...
 19729 00000083 00                      IoStatFail	db 0			; ...
 19730 00000084 00                      ALLOCMSAVE	db 0			; ...
 19731 00000085 00                      A20OFF_COUNT	db 0			; ...
 19732 00000086 00                      DOS_FLAG	db 0			; ...
 19733 00000087 0000                    UNPACK_OFFSET	dw 0			; ...
 19734 00000089 00                      UMBFLAG		db 0			; ...
 19735 0000008A 0000                    SAVE_AX		dw 0			; ...
 19736 0000008C FFFF                    UMB_HEAD	dw 0FFFFh		; ...
 19737 0000008E 0100                    START_ARENA	dw 1			; ...
 19738 00000090 [D7060000]              JShare		dd BadCall		; ...
 19739 00000094 [DB060000]              MFT_enter	dd OKCall		; ...
 19740 00000098 [DB060000]              MFTClose	dd OKCall		; ...
 19741 0000009C [D7060000]              MFTclU		dd BadCall		; ...
 19742 000000A0 [D7060000]              MFTCloseP	dd BadCall		; ...
 19743 000000A4 [D7060000]              MFTCloN		dd BadCall		; ...
 19744 000000A8 [D7060000]              set_block	dd BadCall		; ...
 19745 000000AC [D7060000]              clr_block	dd BadCall		; ...
 19746 000000B0 [DB060000]              chk_block	dd OKCall		; ...
 19747 000000B4 [D7060000]              MFT_get		dd BadCall		; ...
 19748 000000B8 [D7060000]              ShSave		dd BadCall		; ...
 19749 000000BC [D7060000]              ShChk		dd BadCall		; ...
 19750 000000C0 [DB060000]              ShCol		dd OKCall		; ...
 19751 000000C4 [D7060000]              ShCloseFile	dd BadCall		; ...
 19752 000000C8 [D7060000]              ShSU		dd BadCall		; ...
 19753 000000CC FFFFFFFF                SFTABL		dd 0FFFFFFFFh		; ...
 19754 000000D0 0500                    		dw 5
 19755 000000D2 000000000000000000-     SFT0_SFTable	db 295 dup(0)		; ...
 19755 000000DB 000000000000000000-
 19755 000000E4 000000000000000000-
 19755 000000ED 000000000000000000-
 19755 000000F6 000000000000000000-
 19755 000000FF 000000000000000000-
 19755 00000108 000000000000000000-
 19755 00000111 000000000000000000-
 19755 0000011A 000000000000000000-
 19755 00000123 000000000000000000-
 19755 0000012C 000000000000000000-
 19755 00000135 000000000000000000-
 19755 0000013E 000000000000000000-
 19755 00000147 000000000000000000-
 19755 00000150 000000000000000000-
 19755 00000159 000000000000000000-
 19755 00000162 000000000000000000-
 19755 0000016B 000000000000000000-
 19755 00000174 000000000000000000-
 19755 0000017D 000000000000000000-
 19755 00000186 000000000000000000-
 19755 0000018F 000000000000000000-
 19755 00000198 000000000000000000-
 19755 000001A1 000000000000000000-
 19755 000001AA 000000000000000000-
 19755 000001B3 000000000000000000-
 19755 000001BC 000000000000000000-
 19755 000001C5 000000000000000000-
 19755 000001CE 000000000000000000-
 19755 000001D7 000000000000000000-
 19755 000001E0 000000000000000000-
 19755 000001E9 000000000000000000-
 19755 000001F2 00000000000000     
 19756 000001F9 00                      CARPOS		db 0			; ...
 19757 000001FA 00                      STARTPOS	db 0			; ...
 19758 000001FB 000000000000000000-     INBUF		db 128 dup(0)		; ...
 19758 00000204 000000000000000000-
 19758 0000020D 000000000000000000-
 19758 00000216 000000000000000000-
 19758 0000021F 000000000000000000-
 19758 00000228 000000000000000000-
 19758 00000231 000000000000000000-
 19758 0000023A 000000000000000000-
 19758 00000243 000000000000000000-
 19758 0000024C 000000000000000000-
 19758 00000255 000000000000000000-
 19758 0000025E 000000000000000000-
 19758 00000267 000000000000000000-
 19758 00000270 000000000000000000-
 19758 00000279 0000               
 19759 0000027B 000000000000000000-     CONBUF		db 131 dup(0)		; ...
 19759 00000284 000000000000000000-
 19759 0000028D 000000000000000000-
 19759 00000296 000000000000000000-
 19759 0000029F 000000000000000000-
 19759 000002A8 000000000000000000-
 19759 000002B1 000000000000000000-
 19759 000002BA 000000000000000000-
 19759 000002C3 000000000000000000-
 19759 000002CC 000000000000000000-
 19759 000002D5 000000000000000000-
 19759 000002DE 000000000000000000-
 19759 000002E7 000000000000000000-
 19759 000002F0 000000000000000000-
 19759 000002F9 0000000000         
 19760 000002FE 00                      PFLAG		db 0			; ...
 19761 000002FF 00                      VERFLG		db 0			; ...
 19762 00000300 03                      CHARCO		db 3			; ...
 19763 00000301 2F                      chSwitch	db '/'
 19764 00000302 00                      AllocMethod	db 0			; ...
 19765 00000303 00                      fShare		db 0			; ...
 19766 00000304 01                      DIFFNAM		db 1			; ...
 19767 00000305 202020202020202020-     MYNAME		db 16 dup(32)		; ...
 19767 0000030E 20202020202020     
 19768 00000315 [0C0D]                  CritPatch	dw redir_patch		; ...
 19769 00000317 [0C0D]                  		dw redir_patch
 19770 00000319 [0C0D]                  		dw redir_patch
 19771 0000031B [0C0D]                  		dw redir_patch
 19772 0000031D 0000                    		dw 0
 19773 0000031F 90                      		db 90h
 19774 00000320 00                      ERRORMODE	db 0			; ...
 19775 00000321 00                      INDOS		db 0			; ...
 19776 00000322 FF                      WPERR		db 0FFh			; ...
 19777 00000323 00                      EXTERR_LOCUS	db 0			; ...
 19778 00000324 0000                    EXTERR		dw 0			; ...
 19779 00000326 0000                    EXTERR_ACT_CLASS dw 0			; ...
 19780 00000328 00000000                EXTERRPT	dd 0			; ...
 19781 0000032C 80000000                DMAADD		dd 80h			; ...
 19782 00000330 0000                    CurrentPDB	dw 0			; ...
 19783 00000332 0000                    ConC_Spsave	dw 0			; ...
 19784 00000334 0000                    exit_code	dw 0			; ...
 19785 00000336 00                      CURDRV		db 0			; ...
 19786 00000337 00                      CNTCFLAG	db 0			; ...
 19787 00000338 00                      CPSWFLAG	db 0
 19788 00000339 00                      CPSWSAVE	db 0
 19789 0000033A 0000                    USER_IN_AX	dw 0			; ...
 19790 0000033C 0000                    PROC_ID		dw 0			; ...
 19791 0000033E 0000                    USER_ID		dw 0			; ...
 19792 00000340 0000                    FirstArena	dw 0			; ...
 19793 00000342 0000                    BestArena	dw 0			; ...
 19794 00000344 0000                    LastArena	dw 0			; ...
 19795 00000346 0000                    ENDMEM		dw 0			; ...
 19796 00000348 0000                    LASTENT		dw 0			; ...
 19797 0000034A 00                      FAILERR		db 0			; ...
 19798 0000034B 00                      ALLOWED		db 0			; ...
 19799 0000034C 00                      NoSetDir	db 0			; ...
 19800 0000034D 00                      DidCTRLC	db 0			; ...
 19801 0000034E 00                      SpaceFlag	db 0			; ...
 19802 0000034F 90                      		db 90h
 19803 00000350 00                      DAY		db 0			; ...
 19804 00000351 00                      MONTH		db 0			; ...
 19805 00000352 0000                    YEAR		dw 0			; ...
 19806 00000354 FFFF                    DAYCNT		dw 0FFFFh		; ...
 19807 00000356 00                      WEEKDAY		db 0			; ...
 19808 00000357 00                      CONSWAP		db 0			; ...
 19809 00000358 01                      IDLEINT		db 1			; ...
 19810 00000359 00                      fAborting	db 0			; ...
 19811 0000035A 00                      DEVCALL		db 0			; ...
 19812 0000035B 00                      DEVCALL_REQUNIT	db 0			; ...
 19813 0000035C 00                      DEVCALL_REQFUNC	db 0			; ...
 19814 0000035D 0000                    DEVCALL_REQSTAT	dw 0			; ...
 19815 0000035F 0000000000000000        		db 8 dup(0)
 19816 00000367 00                      CALLUNIT	db 0			; ...
 19817 00000368 00000000                CALLBR		dd 0			; ...
 19818 0000036C 00000000                CALLBPB		dd 0			; ...
 19819 00000370 00000000                CALLVIDRW	dd 0			; ...
 19820 00000374 00000000                CALLNEWSC	dd 0			; ...
 19821 00000378 00000000                CALLDEVAD	dd 0			; ...
 19822 0000037C 00                      IOCALL		db 0			; ...
 19823 0000037D 00                      IOCALL_REQUNIT	db 0			; ...
 19824 0000037E 00                      IOCALL_REQFUNC	db 0			; ...
 19825 0000037F 0000                    IOCALL_REQSTAT	dw 0			; ...
 19826 00000381 0000000000000000        		db 8 dup(0)
 19827 00000389 00                      IOMED		db 0			; ...
 19828 0000038A 00000000                IOXAD		dd 0			; ...
 19829 0000038E 0000                    IOSCNT		dw 0			; ...
 19830 00000390 0000                    IOSSEC		dw 0			; ...
 19831 00000392 0E                      DSKSTCALL	db 14			; ...
 19832 00000393 00                      		db 0
 19833 00000394 05                      DSKSTCOM	db 5			; ...
 19834 00000395 0000                    DSKSTST		dw 0			; ...
 19835 00000397 0000000000000000        		db 8 dup(0)
 19836 0000039F 00                      DSKCHRET	db 0			; ...
 19837 000003A0 [BC03]                  DEVIOBUF_PTR	dw DEVIOBUF		; ...
 19838 000003A2 0000                    DOSSEG_INIT	dw 0			; ...
 19839 000003A4 0100                    DSKSTCNT	dw 1			; ...
 19840 000003A6 0000                    		dw 0
 19841 000003A8 00                      CreatePDB	db 0			; ...
 19842 000003A9 00000000                Lock_Buffer	dd 0			; ...
 19843 000003AD 00000000                		dd 0
 19844 000003B1 90                      		db 90h
 19845 000003B2 0000                    USERNUM		dw 0			; ...
 19846 000003B4 00                      USERNUM_hb	db 0			; ...
 19847 000003B5 FF                      OEMNUM		db 0FFh
 19848 000003B6 000000000000            TIMEBUF		dw 3 dup(0)		; ...
 19849 000003BC 0000                    DEVIOBUF	dw 0			; ...
 19850 000003BE 000000000000000000-     OPENBUF		db 128 dup(0)		; ...
 19850 000003C7 000000000000000000-
 19850 000003D0 000000000000000000-
 19850 000003D9 000000000000000000-
 19850 000003E2 000000000000000000-
 19850 000003EB 000000000000000000-
 19850 000003F4 000000000000000000-
 19850 000003FD 000000000000000000-
 19850 00000406 000000000000000000-
 19850 0000040F 000000000000000000-
 19850 00000418 000000000000000000-
 19850 00000421 000000000000000000-
 19850 0000042A 000000000000000000-
 19850 00000433 000000000000000000-
 19850 0000043C 0000               
 19851 0000043E 000000000000000000-     RENBUF		db 128 dup(0)		; ...
 19851 00000447 000000000000000000-
 19851 00000450 000000000000000000-
 19851 00000459 000000000000000000-
 19851 00000462 000000000000000000-
 19851 0000046B 000000000000000000-
 19851 00000474 000000000000000000-
 19851 0000047D 000000000000000000-
 19851 00000486 000000000000000000-
 19851 0000048F 000000000000000000-
 19851 00000498 000000000000000000-
 19851 000004A1 000000000000000000-
 19851 000004AA 000000000000000000-
 19851 000004B3 000000000000000000-
 19851 000004BC 0000               
 19852 000004BE 000000000000000000-     SEARCHBUF	db 53 dup(0)		; ...
 19852 000004C7 000000000000000000-
 19852 000004D0 000000000000000000-
 19852 000004D9 000000000000000000-
 19852 000004E2 000000000000000000-
 19852 000004EB 0000000000000000   
 19853 000004F3 000000000000000000-     DUMMYCDS	db 88 dup(0)		; ...
 19853 000004FC 000000000000000000-
 19853 00000505 000000000000000000-
 19853 0000050E 000000000000000000-
 19853 00000517 000000000000000000-
 19853 00000520 000000000000000000-
 19853 00000529 000000000000000000-
 19853 00000532 000000000000000000-
 19853 0000053B 000000000000000000-
 19853 00000544 00000000000000     
 19854 0000054B 000000000000000000-     NAME1		db 12 dup(0)		; ...
 19854 00000554 000000             
 19855 00000557 000000000000000000-     NAME2		db 13 dup(0)		; ...
 19855 00000560 00000000           
 19856 00000564 0000                    DESTSTART	dw 0			; ...
 19857 00000566 0000000000              		db 5 dup(0)
 19858 0000056B 00                      ATTRIB		db 0			; ...
 19859 0000056C 00                      EXTFCB		db 0			; ...
 19860 0000056D 00                      SATTRIB		db 0			; ...
 19861 0000056E 00                      OPEN_ACCESS	db 0			; ...
 19862 0000056F 00                      FOUNDDEL	db 0			; ...
 19863 00000570 00                      FOUND_DEV	db 0			; ...
 19864 00000571 00                      FSPLICE		db 0			; ...
 19865 00000572 00                      FSHARING	db 0			; ...
 19866 00000573 00                      SECCLUSPOS	db 0			; ...
 19867 00000574 00                      TRANS		db 0			; ...
 19868 00000575 00                      READOP		db 0			; ...
 19869 00000576 00                      THISDRV		db 0			; ...
 19870 00000577 00                      CLUSFAC		db 0			; ...
 19871 00000578 00                      CLUSSPLIT	db 0			; ...
 19872 00000579 00                      INSMODE		db 0			; ...
 19873 0000057A 00                      CMETA		db 0			; ...
 19874 0000057B 00                      VOLID		db 0			; ...
 19875 0000057C 00                      EXIT_TYPE	db 0			; ...
 19876 0000057D 90                      		db 90h
 19877 0000057E 00                      CREATING	db 0			; ...
 19878 0000057F 00                      DELALL		db 0			; ...
 19879 00000580 00000000                EXITHOLD	dd 0			; ...
 19880 00000584 0000                    USER_SP		dw 0			; ...
 19881 00000586 0000                    USER_SS		dw 0			; ...
 19882 00000588 0000                    CONTSTK		dw 0			; ...
 19883 0000058A 00000000                THISDPB		dd 0			; ...
 19884 0000058E 0000                    CLUSSAVE	dw 0			; ...
 19885 00000590 00000000                CLUSSEC		dw 2 dup(0)		; ...
 19886 00000594 0000                    PREREAD		dw 0			; ...
 19887 00000596 0000                    FATBYT		dw 0			; ...
 19888 00000598 0000                    FATBYTE		dw 0			; ...
 19889 0000059A 00000000                DEVPT		dd 0			; ...
 19890 0000059E 00000000                THISSFT		dd 0			; ...
 19891 000005A2 00000000                THISCDS		dd 0			; ...
 19892 000005A6 00000000                THISFCB		dd 0			; ...
 19893 000005AA FFFF                    SFN		dw 0FFFFh		; ...
 19894 000005AC 0000                    JFN		dw 0			; ...
 19895 000005AE 00000000                PJFN		dd 0			; ...
 19896 000005B2 0000                    WFP_START	dw 0			; ...
 19897 000005B4 0000                    REN_WFP		dw 0			; ...
 19898 000005B6 0000                    CURR_DIR_END	dw 0			; ...
 19899 000005B8 0000                    NEXTADD		dw 0			; ...
 19900 000005BA 0000                    LASTPOS		dw 0			; ...
 19901 000005BC 0000                    CLUSNUM		dw 0			; ...
 19902 000005BE 00000000                DIRSEC		dw 2 dup(0)		; ...
 19903 000005C2 0000                    DIRSTART	dw 0			; ...
 19904 000005C4 00000000                SECPOS		dw 2 dup(0)		; ...
 19905 000005C8 00000000                VALSEC		dw 2 dup(0)		; ...
 19906 000005CC 0000                    BYTSECPOS	dw 0			; ...
 19907 000005CE 00000000                BYTPOS		dw 2 dup(0)		; ...
 19908 000005D2 0000                    BYTCNT1		dw 0			; ...
 19909 000005D4 0000                    BYTCNT2		dw 0			; ...
 19910 000005D6 0000                    SECCNT		dw 0			; ...
 19911 000005D8 0000                    ENTFREE		dw 0			; ...
 19912 000005DA 0000                    ENTLAST		dw 0			; ...
 19913 000005DC 0000                    NXTCLUSNUM	dw 0			; ...
 19914 000005DE 00000000                GROWCNT		dw 2 dup(0)		; ...
 19915 000005E2 00000000                CURBUF		dd 0			; ...
 19916 000005E6 00000000                CONSFT		dd 0			; ...
 19917 000005EA 0000                    SAVEBX		dw 0			; ...
 19918 000005EC 0000                    SAVEDS		dw 0			; ...
 19919 000005EE 0000                    RESTORE_TMP	dw 0			; ...
 19920 000005F0 0000                    NSS		dw 0			; ...
 19921 000005F2 0000                    NSP		dw 0			; ...
 19922 000005F4 0000                    EXTOPEN_FLAG	dw 0			; ...
 19923 000005F6 00                      EXTOPEN_ON	db 0			; ...
 19924 000005F7 0000                    EXTOPEN_IO_MODE	dw 0			; ...
 19925 000005F9 0000                    SAVE_DI		dw 0			; ...
 19926 000005FB 0000                    SAVE_ES		dw 0			; ...
 19927 000005FD 0000                    SAVE_DX		dw 0			; ...
 19928 000005FF 0000                    SAVE_CX		dw 0			; ...
 19929 00000601 0000                    SAVE_BX		dw 0			; ...
 19930 00000603 0000                    SAVE_SI		dw 0			; ...
 19931 00000605 0000                    SAVE_DS		dw 0			; ...
 19932 00000607 0000                    HIGH_SECTOR	dw 0			; ...
 19933 00000609 [6413]                  OffsetMagicPatch dw MagicPatch		; ...
 19934 0000060B 00                      DISK_FULL	db 0			; ...
 19935 0000060C 0000                    TEMP_VAR	dw 0			; ...
 19936 0000060E 0000                    TEMP_VAR2	dw 0			; ...
 19937 00000610 00                      DrvErr		db 0			; ...
 19938 00000611 0000                    DOS34_FLAG	dw 0			; ...
 19939 00000613 00000000                NO_FILTER_PATH	dd 0
 19940 00000617 00000000                NO_FILTER_DPATH	dd 0
 19941 0000061B 0000                    AbsRdWr_SS	dw 0			; ...
 19942 0000061D 0000                    AbsRdWr_SP	dw 0			; ...
 19943 0000061F 00                      		db 0
 19944 00000620 000000000000000000-     RENAMEDMA	db 180h	dup(0)		; ...
 19944 00000629 000000000000000000-
 19944 00000632 000000000000000000-
 19944 0000063B 000000000000000000-
 19944 00000644 000000000000000000-
 19944 0000064D 000000000000000000-
 19944 00000656 000000000000000000-
 19944 0000065F 000000000000000000-
 19944 00000668 000000000000000000-
 19944 00000671 000000000000000000-
 19944 0000067A 000000000000000000-
 19944 00000683 000000000000000000-
 19944 0000068C 000000000000000000-
 19944 00000695 000000000000000000-
 19944 0000069E 000000000000000000-
 19944 000006A7 000000000000000000-
 19944 000006B0 000000000000000000-
 19944 000006B9 000000000000000000-
 19944 000006C2 000000000000000000-
 19944 000006CB 000000000000000000-
 19944 000006D4 000000000000000000-
 19944 000006DD 000000000000000000-
 19944 000006E6 000000000000000000-
 19944 000006EF 000000000000000000-
 19944 000006F8 000000000000000000-
 19944 00000701 000000000000000000-
 19944 0000070A 000000000000000000-
 19944 00000713 000000000000000000-
 19944 0000071C 000000000000000000-
 19944 00000725 000000000000000000-
 19944 0000072E 000000000000000000-
 19944 00000737 000000000000000000-
 19944 00000740 000000000000000000-
 19944 00000749 000000000000000000-
 19944 00000752 000000000000000000-
 19944 0000075B 000000000000000000-
 19944 00000764 000000000000000000-
 19944 0000076D 000000000000000000-
 19944 00000776 000000000000000000-
 19944 0000077F 000000000000000000-
 19944 00000788 000000000000000000-
 19944 00000791 000000000000000000-
 19944 0000079A 000000000000       
 19945 000007A0 000000000000000000-     AUXSTACK	db 384 dup(0)		; ...
 19945 000007A9 000000000000000000-
 19945 000007B2 000000000000000000-
 19945 000007BB 000000000000000000-
 19945 000007C4 000000000000000000-
 19945 000007CD 000000000000000000-
 19945 000007D6 000000000000000000-
 19945 000007DF 000000000000000000-
 19945 000007E8 000000000000000000-
 19945 000007F1 000000000000000000-
 19945 000007FA 000000000000000000-
 19945 00000803 000000000000000000-
 19945 0000080C 000000000000000000-
 19945 00000815 000000000000000000-
 19945 0000081E 000000000000000000-
 19945 00000827 000000000000000000-
 19945 00000830 000000000000000000-
 19945 00000839 000000000000000000-
 19945 00000842 000000000000000000-
 19945 0000084B 000000000000000000-
 19945 00000854 000000000000000000-
 19945 0000085D 000000000000000000-
 19945 00000866 000000000000000000-
 19945 0000086F 000000000000000000-
 19945 00000878 000000000000000000-
 19945 00000881 000000000000000000-
 19945 0000088A 000000000000000000-
 19945 00000893 000000000000000000-
 19945 0000089C 000000000000000000-
 19945 000008A5 000000000000000000-
 19945 000008AE 000000000000000000-
 19945 000008B7 000000000000000000-
 19945 000008C0 000000000000000000-
 19945 000008C9 000000000000000000-
 19945 000008D2 000000000000000000-
 19945 000008DB 000000000000000000-
 19945 000008E4 000000000000000000-
 19945 000008ED 000000000000000000-
 19945 000008F6 000000000000000000-
 19945 000008FF 000000000000000000-
 19945 00000908 000000000000000000-
 19945 00000911 000000000000000000-
 19945 0000091A 000000000000       
 19946 00000920 000000000000000000-     DSKSTACK	db 384 dup(0)		; ...
 19946 00000929 000000000000000000-
 19946 00000932 000000000000000000-
 19946 0000093B 000000000000000000-
 19946 00000944 000000000000000000-
 19946 0000094D 000000000000000000-
 19946 00000956 000000000000000000-
 19946 0000095F 000000000000000000-
 19946 00000968 000000000000000000-
 19946 00000971 000000000000000000-
 19946 0000097A 000000000000000000-
 19946 00000983 000000000000000000-
 19946 0000098C 000000000000000000-
 19946 00000995 000000000000000000-
 19946 0000099E 000000000000000000-
 19946 000009A7 000000000000000000-
 19946 000009B0 000000000000000000-
 19946 000009B9 000000000000000000-
 19946 000009C2 000000000000000000-
 19946 000009CB 000000000000000000-
 19946 000009D4 000000000000000000-
 19946 000009DD 000000000000000000-
 19946 000009E6 000000000000000000-
 19946 000009EF 000000000000000000-
 19946 000009F8 000000000000000000-
 19946 00000A01 000000000000000000-
 19946 00000A0A 000000000000000000-
 19946 00000A13 000000000000000000-
 19946 00000A1C 000000000000000000-
 19946 00000A25 000000000000000000-
 19946 00000A2E 000000000000000000-
 19946 00000A37 000000000000000000-
 19946 00000A40 000000000000000000-
 19946 00000A49 000000000000000000-
 19946 00000A52 000000000000000000-
 19946 00000A5B 000000000000000000-
 19946 00000A64 000000000000000000-
 19946 00000A6D 000000000000000000-
 19946 00000A76 000000000000000000-
 19946 00000A7F 000000000000000000-
 19946 00000A88 000000000000000000-
 19946 00000A91 000000000000000000-
 19946 00000A9A 000000000000       
 19947 00000AA0 00                      PRINTER_FLAG	db 0			; ...
 19948 00000AA1 00                      VOLCHNG_FLAG	db 0			; ...
 19949 00000AA2 00                      VIRTUAL_OPEN	db 0			; ...
 19950 00000AA3 00                      FSeek_drive	db 0
 19951 00000AA4 0000                    FSeek_firclus	dw 0
 19952 00000AA6 0000                    FSeek_logclus	dw 0
 19953 00000AA8 0000                    FSeek_logsave	dw 0
 19954 00000AAA FFFF                    TEMP_DOSLOC	dw 0FFFFh		; ...
 19955 00000AAC 00                      SWAP_END	db 0			; ...
 19956 00000AAD 8000                    UCASE_TAB	dw 128			; ...
 19957 00000AAF 809A45418E418F8045-     UCASE_TAB_2	db 128,	154, 69, 65, 142, 65, 143, 128,	3 dup(69), 3 dup(73) ; ...
 19957 00000AB8 4545494949         
 19958 00000ABD 8E8F9092924F994F55-     		db 142,	143, 144, 2 dup(146), 79, 153, 79, 2 dup(85), 89
 19958 00000AC6 5559               
 19959 00000AC8 999A9B9C9D9E9F4149-     		db 153,	154, 155, 156, 157, 158, 159, 65, 73, 79, 85, 2	dup(165)
 19959 00000AD1 4F55A5A5           
 19960 00000AD5 A6A7A8A9AAABACADAE-     		db 166,	167, 168, 169, 170, 171, 172, 173, 174,	175, 176
 19960 00000ADE AFB0               
 19961 00000AE0 B1B2B3B4B5B6B7B8B9-     		db 177,	178, 179, 180, 181, 182, 183, 184, 185,	186, 187
 19961 00000AE9 BABB               
 19962 00000AEB BCBDBEBFC0C1C2C3C4-     		db 188,	189, 190, 191, 192, 193, 194, 195, 196,	197, 198
 19962 00000AF4 C5C6               
 19963 00000AF6 C7C8C9CACBCCCDCECF-     		db 199,	200, 201, 202, 203, 204, 205, 206, 207,	208, 209
 19963 00000AFF D0D1               
 19964 00000B01 D2D3D4D5D6D7D8D9DA-     		db 210,	211, 212, 213, 214, 215, 216, 217, 218,	219, 220
 19964 00000B0A DBDC               
 19965 00000B0C DDDEDFE0E1E2E3E4E5-     		db 221,	222, 223, 224, 225, 226, 227, 228, 229,	230, 231
 19965 00000B15 E6E7               
 19966 00000B17 E8E9EAEBECEDEEEFF0-     		db 232,	233, 234, 235, 236, 237, 238, 239, 240,	241, 242
 19966 00000B20 F1F2               
 19967 00000B22 F3F4F5F6F7F8F9FAFB-     		db 243,	244, 245, 246, 247, 248, 249, 250, 251,	252, 253
 19967 00000B2B FCFD               
 19968 00000B2D FEFF                    		db 254,	255
 19969 00000B2F 8000                    FILE_UCASE_TAB	dw 128			; ...
 19970 00000B31 809A45418E418F8045-     FILE_UCASE_TAB_2 db 128, 154, 69, 65, 142, 65, 143, 128, 3 dup(69), 3 dup(73) ;	...
 19970 00000B3A 4545494949         
 19971 00000B3F 8E8F9092924F994F55-     		db 142,	143, 144, 2 dup(146), 79, 153, 79, 2 dup(85), 89
 19971 00000B48 5559               
 19972 00000B4A 999A9B9C9D9E9F4149-     		db 153,	154, 155, 156, 157, 158, 159, 65, 73, 79, 85, 2	dup(165)
 19972 00000B53 4F55A5A5           
 19973 00000B57 A6A7A8A9AAABACADAE-     		db 166,	167, 168, 169, 170, 171, 172, 173, 174,	175, 176
 19973 00000B60 AFB0               
 19974 00000B62 B1B2B3B4B5B6B7B8B9-     		db 177,	178, 179, 180, 181, 182, 183, 184, 185,	186, 187
 19974 00000B6B BABB               
 19975 00000B6D BCBDBEBFC0C1C2C3C4-     		db 188,	189, 190, 191, 192, 193, 194, 195, 196,	197, 198
 19975 00000B76 C5C6               
 19976 00000B78 C7C8C9CACBCCCDCECF-     		db 199,	200, 201, 202, 203, 204, 205, 206, 207,	208, 209
 19976 00000B81 D0D1               
 19977 00000B83 D2D3D4D5D6D7D8D9DA-     		db 210,	211, 212, 213, 214, 215, 216, 217, 218,	219, 220
 19977 00000B8C DBDC               
 19978 00000B8E DDDEDFE0E1E2E3E4E5-     		db 221,	222, 223, 224, 225, 226, 227, 228, 229,	230, 231
 19978 00000B97 E6E7               
 19979 00000B99 E8E9EAEBECEDEEEFF0-     		db 232,	233, 234, 235, 236, 237, 238, 239, 240,	241, 242
 19979 00000BA2 F1F2               
 19980 00000BA4 F3F4F5F6F7F8F9FAFB-     		db 243,	244, 245, 246, 247, 248, 249, 250, 251,	252, 253
 19980 00000BAD FCFD               
 19981 00000BAF FEFF                    		db 254,	255
 19982 00000BB1 1600                    FILE_CHAR_TAB	dw 22			; ...
 19983 00000BB3 0100FF000020020E        		db 1, 0, 255, 2	dup(0),	32, 2, 14
 19984 00000BBB 2E222F5C5B5D3A7C3C-     		db '."/\[]:|<>+=;,'
 19984 00000BC4 3E2B3D3B2C         
 19985 00000BC9 000000000000000000-     		db 24 dup(0)
 19985 00000BD2 000000000000000000-
 19985 00000BDB 000000000000       
 19986 00000BE1 0001                    COLLATE_TAB	dw 256			; ...
 19987 00000BE3 000102030405060708-     		db 0, 1, 2, 3, 4, 5, 6,	7, 8, 9, 10, 11, 12, 13, 14, 15
 19987 00000BEC 090A0B0C0D0E0F     
 19988 00000BF3 101112131415161718-     		db 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28
 19988 00000BFC 191A1B1C           
 19989 00000C00 1D1E1F                  		db 29, 30, 31
 19990 00000C03 202122232425262728-     		db ' !"#$%&',27h,'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]'
 19990 00000C0C 292A2B2C2D2E2F3031-
 19990 00000C15 32333435363738393A-
 19990 00000C1E 3B3C3D3E3F40414243-
 19990 00000C27 4445464748494A4B4C-
 19990 00000C30 4D4E4F505152535455-
 19990 00000C39 565758595A5B5C5D   
 19991 00000C41 5E5F60414243444546-     		db '^_`ABCDEFGHIJKLMNOPQRSTUVWXYZ{|}~'
 19991 00000C4A 4748494A4B4C4D4E4F-
 19991 00000C53 505152535455565758-
 19991 00000C5C 595A7B7C7D7E       
 19992 00000C62 7F                      		db 127
 19993 00000C63 435545414141414345-     		db 'CUEAAAACEEEIIIAAEAAOOOUUYOU$$$$$AIOUNN'
 19993 00000C6C 454549494941414541-
 19993 00000C75 414F4F4F5555594F55-
 19993 00000C7E 242424242441494F55-
 19993 00000C87 4E4E               
 19994 00000C89 A6A7                    		db 166,	167
 19995 00000C8B 3F                      		db '?'
 19996 00000C8C A9AAABAC                		db 169,	170, 171, 172
 19997 00000C90 212222                  		db '!', 2 dup('"')
 19998 00000C93 B0B1B2B3B4B5B6B7B8-     		db 176,	177, 178, 179, 180, 181, 182, 183, 184,	185, 186
 19998 00000C9C B9BA               
 19999 00000C9E BBBCBDBEBFC0C1C2C3-     		db 187,	188, 189, 190, 191, 192, 193, 194, 195,	196, 197
 19999 00000CA7 C4C5               
 20000 00000CA9 C6C7C8C9CACBCCCDCE-     		db 198,	199, 200, 201, 202, 203, 204, 205, 206,	207, 208
 20000 00000CB2 CFD0               
 20001 00000CB4 D1D2D3D4D5D6D7D8D9-     		db 209,	210, 211, 212, 213, 214, 215, 216, 217,	218, 219
 20001 00000CBD DADB               
 20002 00000CBF DCDDDEDFE0              		db 220,	221, 222, 223, 224
 20003 00000CC4 53                      		db 'S'
 20004 00000CC5 E2E3E4E5E6E7E8E9EA-     		db 226,	227, 228, 229, 230, 231, 232, 233, 234,	235, 236
 20004 00000CCE EBEC               
 20005 00000CD0 EDEEEFF0F1F2F3F4F5-     		db 237,	238, 239, 240, 241, 242, 243, 244, 245,	246, 247
 20005 00000CD9 F6F7               
 20006 00000CDB F8F9FAFBFCFDFEFF        		db 248,	249, 250, 251, 252, 253, 254, 255
 20007 00000CE3 0000                    DBCS_TAB	dw 0			; ...
 20008 00000CE5 000000000000000000-     DBCS_TAB_2	db 16 dup(0)		; ...
 20008 00000CEE 00000000000000     
 20009                                  ; ---------------------------------------------------------------------------
 20010                                  
 20011                                  MAP_CASE:				; ...
 20012 00000CF5 3C80                    		cmp	al, 80h
 20013 00000CF7 7301                    		jnb	short Map1
 20014 00000CF9 CB                      		retf
 20015                                  ; ---------------------------------------------------------------------------
 20016                                  
 20017                                  Map1:					; ...
 20018 00000CFA 2C80                    		sub	al, 80h
 20019 00000CFC 1E                      		push	ds
 20020 00000CFD 53                      		push	bx
 20021 00000CFE BB[AF0A]                		mov	bx, UCASE_TAB_2
 20022 00000D01 0E                      		push	cs
 20023 00000D02 1F                      		pop	ds
 20024 00000D03 D7                      		xlat
 20025 00000D04 5B                      		pop	bx
 20026 00000D05 1F                      		pop	ds
 20027 00000D06 CB                      		retf
 20028                                  ; ---------------------------------------------------------------------------
 20029 00000D07 00                      InterChar	db 0
 20030 00000D08 00                      InterCon	db 0
 20031 00000D09 00                      SaveCurFlg	db 0
 20032 00000D0A 0000                    TEMPSEG		dw 0			; ...
 20033 00000D0C 00                      redir_patch	db 0			; ...
 20034 00000D0D 0000000000              Mark1		db 5 dup(0)
 20035 00000D12 06                      MSVERSION	db 6
 20036 00000D13 16                      		db 22
 20037 00000D14 C8A6C8A5C8A5C8A5        YRTAB		db 200,	166, 200, 165, 200, 165, 200, 165 ; ...
 20038 00000D1C 1F                      MONTAB		db 31			; ...
 20039 00000D1D 1C                      february	db 28			; ...
 20040 00000D1E 1F1E1F1E1F1F1E1F1E-     		db 31, 30, 31, 30, 2 dup(31), 30, 31, 30, 31
 20040 00000D27 1F                 
 20041 00000D28 [26000000]              SysInitTable	dd DPBHEAD	; ...
 20042 00000D2C [2A120000]              		dd COUNTRY_CDPG
 20043 00000D30 0200                    FastOpenTable	dw 2			; ...
 20044 00000D32 [F012]                  FastTable_2	dw FastRet	; ...
 20045 00000D34 0000                    		dw 0
 20046 00000D36 [F012]                  		dw FastRet
 20047 00000D38 0000                    		dw 0
 20048 00000D3A 00                      FastOpenFlg	db 0			; ...
 20049 00000D3B 000000000000000000-     FastOpen_Ext_Info db 11	dup(0)		; ...
 20049 00000D44 0000               
 20050 00000D46 000000000000000000-     Dir_Info_Buff	db 32 dup(0)		; ...
 20050 00000D4F 000000000000000000-
 20050 00000D58 000000000000000000-
 20050 00000D61 0000000000         
 20051 00000D66 0000                    Next_Element_Start dw 0			; ...
 20052 00000D68 0000                    Del_ExtCluster	dw 0
 20053 00000D6A [6C0D]                  USER_SP_2F	dw FAKE_STACK_2F	; ...
 20054 00000D6C 000000000000000000-     FAKE_STACK_2F	dw 14 dup(0)		; ...
 20054 00000D75 000000000000000000-
 20054 00000D7E 000000000000000000-
 20054 00000D87 00                 
 20055 00000D88 0000000000000000        Hash_Temp	dw 4 dup(0)
 20056 00000D90 00                      SCAN_FLAG	db 0			; ...
 20057 00000D91 0000                    DATE_FLAG	dw 0			; ...
 20058 00000D93 0000                    FETCHI_TAG	dw 0
 20059 00000D95 00000000                MSG_EXTERROR	dd 0
 20060 00000D99 00000000                		dd 0
 20061 00000D9D 00000000                		dd 0
 20062 00000DA1 00000000                		dd 0
 20063 00000DA5 00000000                		dd 0
 20064 00000DA9 FFFFFFFF                SEQ_SECTOR	dw 2 dup(0FFFFh)	; ...
 20065 00000DAD 0000                    SC_SECTOR_SIZE	dw 0			; ...
 20066 00000DAF 00                      SC_DRIVE	db 0			; ...
 20067 00000DB0 FF                      CurSC_DRIVE	db 0FFh			; ...
 20068 00000DB1 00000000                CurSC_SECTOR	dw 2 dup(0)		; ...
 20069 00000DB5 0000                    SC_STATUS	dw 0			; ...
 20070 00000DB7 00                      SC_FLAG		db 0			; ...
 20071 00000DB8 0000                    AbsDskErr	dw 0			; ...
 20072 00000DBA 4E4F204E414D452020-     NO_NAME_ID	db 'NO NAME    '        ; ...
 20072 00000DC3 2020               
 20073 00000DC5 00                      LOOKSIZ		db 0
 20074                                  ; ---------------------------------------------------------------------------
 20075                                  
 20076                                  SNULDEV:
 20077 00000DC6 26814F030001            		or	word [es:bx+3], 100h
 20078                                  
 20079                                  INULDEV:
 20080 00000DCC CB                      		retf
 20081                                  ; ---------------------------------------------------------------------------
 20082 00000DCD 0000000000000000        WinoldPatch2	db 8 dup(0)		; ...
 20083 00000DD5 0000000000              UmbSave2	db 5 dup(0)		; ...
 20084 00000DDA 00                      UmbSaveFlag	db 0			; ...
 20085 00000DDB 010704FF0208030203-     ERR_TABLE_21	db 1, 7, 4, 0FFh, 2, 8,	3, 2, 3, 8, 3, 2, 4, 1,	4, 1, 5	; ...
 20085 00000DE4 0803020401040105   
 20086 00000DEC 0303FF060704010707-     		db 2 dup(3), 0FFh, 6, 7, 4, 1, 2 dup(7), 2 dup(5), 8, 1
 20086 00000DF5 05050801           
 20087 00000DF9 0405090704050A0704-     		db 4, 5, 9, 7, 4, 5, 0Ah, 7, 4,	5, 0Bh,	9, 3, 1, 0Ch, 7
 20087 00000E02 050B0903010C07     
 20088 00000E09 04010D0904010F0803-     		db 4, 1, 0Dh, 9, 4, 1, 0Fh, 8, 3, 2, 10h, 2 dup(3), 2
 20088 00000E12 0210030302         
 20089 00000E17 110D03021208030250-     		db 11h,	0Dh, 3,	2, 12h,	8, 3, 2, 50h, 0Ch, 3, 2, 20h, 0Ah
 20089 00000E20 0C0302200A         
 20090 00000E25 0202210A0202540104-     		db 2 dup(2), 21h, 0Ah, 2 dup(2), 54h, 1, 4, 0FFh, 56h
 20090 00000E2E FF56               
 20091 00000E30 030301520104023209-     		db 2 dup(3), 1,	52h, 1,	4, 2, 32h, 9, 2	dup(3),	55h, 0Ch
 20091 00000E39 0303550C           
 20092 00000E3D 030357090301530D04-     		db 2 dup(3), 57h, 9, 3,	1, 53h,	0Dh, 4,	1, 24h,	1, 4, 5
 20092 00000E46 0124010405         
 20093 00000E4B 26010401270104015A-     		db 26h,	1, 4, 1, 27h, 1, 4, 1, 5Ah, 0Dh, 4, 2, 4 dup(0FFh)
 20093 00000E54 0D0402FFFFFFFF     
 20094 00000E5B 130B07021404050115-     ERR_TABLE_24	db 13h,	0Bh, 7,	2, 14h,	4, 5, 1, 15h, 5, 7, 0FFh, 16h ;	...
 20094 00000E64 0507FF16           
 20095 00000E68 040501170B04021804-     		db 4, 5, 1, 17h, 0Bh, 4, 2, 18h, 4, 5, 1, 19h, 5, 1, 2
 20095 00000E71 050119050102       
 20096 00000E77 1A0B07021B0B04021C-     		db 1Ah,	0Bh, 7,	2, 1Bh,	0Bh, 4,	2, 1Ch,	2, 7, 4, 1Dh, 5
 20096 00000E80 0207041D05         
 20097 00000E85 04FF1E0504FF1F0D04-     		db 4, 0FFh, 1Eh, 5, 4, 0FFh, 1Fh, 0Dh, 4, 0FFh,	20h, 0Ah
 20097 00000E8E FF200A             
 20098 00000E91 0202210A0202220B07-     		db 2 dup(2), 21h, 0Ah, 2 dup(2), 22h, 0Bh, 7, 2, 32h, 9
 20098 00000E9A 023209             
 20099 00000E9D 030323070401240104-     		db 2 dup(3), 23h, 7, 4,	1, 24h,	1, 4, 5, 0FFh, 0Dh, 5
 20099 00000EA6 05FF0D05           
 20100 00000EAA FF                      		db 0FFh
 20101 00000EAB 131415161718191A1B-     ErrMap24	db 13h,	14h, 15h, 16h, 17h, 18h, 19h, 1Ah, 1Bh,	1Ch, 1Dh ; ...
 20101 00000EB4 1C1D               
 20102 00000EB6 1E1F1F1F22              		db 1Eh,	3 dup(1Fh), 22h
 20103 00000EBB 0000                    FIRST_BUFF_ADDR	dw 0			; ...
 20104 00000EBD 0000                    SPECIAL_VERSION	dw 0			; ...
 20105 00000EBF 000000000000000000-     FAKE_COUNT	db 255 dup(0)
 20105 00000EC8 000000000000000000-
 20105 00000ED1 000000000000000000-
 20105 00000EDA 000000000000000000-
 20105 00000EE3 000000000000000000-
 20105 00000EEC 000000000000000000-
 20105 00000EF5 000000000000000000-
 20105 00000EFE 000000000000000000-
 20105 00000F07 000000000000000000-
 20105 00000F10 000000000000000000-
 20105 00000F19 000000000000000000-
 20105 00000F22 000000000000000000-
 20105 00000F2B 000000000000000000-
 20105 00000F34 000000000000000000-
 20105 00000F3D 000000000000000000-
 20105 00000F46 000000000000000000-
 20105 00000F4F 000000000000000000-
 20105 00000F58 000000000000000000-
 20105 00000F61 000000000000000000-
 20105 00000F6A 000000000000000000-
 20105 00000F73 000000000000000000-
 20105 00000F7C 000000000000000000-
 20105 00000F85 000000000000000000-
 20105 00000F8E 000000000000000000-
 20105 00000F97 000000000000000000-
 20105 00000FA0 000000000000000000-
 20105 00000FA9 000000000000000000-
 20105 00000FB2 000000000000000000-
 20105 00000FBB 000000             
 20106 00000FBE 0000                    OLD_FIRSTCLUS	dw 0			; ...
 20107 00000FC0 0000                    exec_init_SP	dw 0			; ...
 20108 00000FC2 0000                    exec_init_SS	dw 0			; ...
 20109 00000FC4 0000                    exec_init_IP	dw 0			; ...
 20110 00000FC6 0000                    exec_init_CS	dw 0			; ...
 20111 00000FC8 0000                    exec_signature	dw 0			; ...
 20112 00000FCA 0000                    exec_len_mod_512 dw 0
 20113 00000FCC 0000                    exec_pages	dw 0			; ...
 20114 00000FCE 0000                    exec_rle_count	dw 0			; ...
 20115 00000FD0 0000                    exec_par_dir	dw 0			; ...
 20116 00000FD2 0000                    exec_min_BSS	dw 0			; ...
 20117 00000FD4 0000                    exec_max_BSS	dw 0			; ...
 20118 00000FD6 0000                    exec_SS		dw 0			; ...
 20119 00000FD8 0000                    exec_SP		dw 0			; ...
 20120 00000FDA 0000                    exec_chksum	dw 0
 20121 00000FDC 0000                    exec_IP		dw 0			; ...
 20122 00000FDE 0000                    exec_CS		dw 0
 20123 00000FE0 0000                    exec_rle_table	dw 0			; ...
 20124 00000FE2 03                      Win386_Info	db 3			; ...
 20125 00000FE3 00                      		db 0
 20126 00000FE4 00000000                		dd 0
 20127 00000FE8 00000000                Win386_Info_6	dd 0			; ...
 20128 00000FEC 00000000                		dd 0
 20129 00000FF0 [F40F]                  SIS_Instance_Data_Ptr dw Instance_Table
 20130 00000FF2 0000                    SIS_Instance_Data_Ptr_2	dw 0		; ...
 20131 00000FF4 [2200]                  Instance_Table	dw CONTPOS		; ...
 20132 00000FF6 0000                    Instance_Table_2 dw 0			; ...
 20133 00000FF8 0200                    		dw 2
 20134 00000FFA [3200]                  		dw BCON
 20135 00000FFC 0000                    		dw 0
 20136 00000FFE 0400                    		dw 4
 20137 00001000 [F901]                  		dw CARPOS
 20138 00001002 0000                    		dw 0
 20139 00001004 0601                    		dw 106h
 20140 00001006 [0003]                  		dw CHARCO
 20141 00001008 0000                    		dw 0
 20142 0000100A 0100                    		dw 1
 20143 0000100C [C00F]                  		dw exec_init_SP
 20144 0000100E 0000                    		dw 0
 20145 00001010 2200                    		dw 34
 20146 00001012 [8900]                  		dw UMBFLAG
 20147 00001014 0000                    		dw 0
 20148 00001016 0100                    		dw 1
 20149 00001018 [8C00]                  		dw UMB_HEAD
 20150 0000101A 0000                    		dw 0
 20151 0000101C 0200                    		dw 2
 20152 0000101E 0000                    		dw 0
 20153 00001020 0000                    		dw 0
 20154 00001022 05                      Win386_DOSVars	db 5			; ...
 20155 00001023 00                      		db 0
 20156 00001024 [EC05]                  		dw SAVEDS
 20157 00001026 [EA05]                  		dw SAVEBX
 20158 00001028 [2103]                  		dw INDOS
 20159 0000102A [3E03]                  		dw USER_ID
 20160 0000102C [1503]                  		dw CritPatch
 20161 0000102E [8C00]                  		dw UMB_HEAD
 20162 00001030 00                      IsWin386	db 0			; ...
 20163 00001031 633A5C77696E613230-     VxDpath		db 'c:\wina20.386',0    ; ...
 20163 0000103A 2E33383600         
 20164 0000103F 01                      DriverLoad	db 1			; ...
 20165 00001040 00000000                BiosDataPtr	dd 0			; ...
 20166 00001044 36F6062003FF            		db 36h,	0F6h, 6, 20h, 3, 0FFh
 20167 0000104A 750C                    		db 75h,	0Ch
 20168 0000104C 36FF365803              		db 36h,	0FFh, 36h, 58h,	3
 20169 00001051 CD28                    		db 0CDh, 28h
 20170 00001053 803E200300              		db 80h,	3Eh, 20h, 3, 0
 20171 00001058 7537                    		db 75h,	37h
 20172 0000105A BCA00A                  		db 0BCh, 0A0h, 0Ah
 20173 0000105D 00000000                LocalSFT	dd 0			; ...
 20174 00001061 90                      		db 90h
 20175 00001062 [77540000]              DOSINTTABLE	dd DIVOV		; ...
 20176 00001066 [EC020000]              DOSINTTABLE_4	dd quit			; ...
 20177 0000106A [18030000]              DOSINTTABLE_8	dd command		; ...
 20178 0000106E [05050000]              DOSINTTABLE_12	dd ABSDRD		; ...
 20179 00001072 [8C050000]              DOSINTTABLE_16	dd ABSDWRT		; ...
 20180 00001076 [E4630000]              DOSINTTABLE_20	dd stay_resident	; ...
 20181 0000107A [DD060000]              DOSINTTABLE_24	dd INT2F		; ...
 20182 0000107E [F3020000]              DOSINTTABLE_28	dd call_entry		; ...
 20183 00001082 [F2020000]              DOSINTTABLE_32	dd irett
 20184 00001086 0000                    SS_Save		dw 0			; ...
 20185 00001088 0000                    SP_Save		dw 0			; ...
 20186                                  ; ---------------------------------------------------------------------------
 20187                                  
 20188                                  ldivov:
 20189 0000108A EB03                    		jmp	short divov_cont
 20190                                  ; ---------------------------------------------------------------------------
 20191 0000108C E8E000                  		call	EnsureA20ON
 20192                                  
 20193                                  divov_cont:
 20194 0000108F 2EFF2E[6210]            		jmp	far [cs:DOSINTTABLE]
 20195                                  ; ---------------------------------------------------------------------------
 20196                                  
 20197                                  lquit:
 20198 00001094 EB03                    		jmp	short quit_cont
 20199                                  ; ---------------------------------------------------------------------------
 20200 00001096 E8D600                  		call	EnsureA20ON
 20201                                  
 20202                                  quit_cont:
 20203 00001099 2EFF2E[6610]            		jmp	far [cs:DOSINTTABLE_4]
 20204                                  ; ---------------------------------------------------------------------------
 20205                                  
 20206                                  lcommand:
 20207 0000109E EB03                    		jmp	short command_cont
 20208                                  ; ---------------------------------------------------------------------------
 20209 000010A0 E8CC00                  		call	EnsureA20ON
 20210                                  
 20211                                  command_cont:
 20212 000010A3 2EFF2E[6A10]            		jmp	far [cs:DOSINTTABLE_8]
 20213                                  ; ---------------------------------------------------------------------------
 20214                                  
 20215                                  labsdrd:
 20216 000010A8 EB03                    		jmp	short absdrd_cont
 20217                                  ; ---------------------------------------------------------------------------
 20218 000010AA E8C200                  		call	EnsureA20ON
 20219                                  
 20220                                  absdrd_cont:
 20221 000010AD 2EFF2E[6E10]            		jmp	far [cs:DOSINTTABLE_12]
 20222                                  ; ---------------------------------------------------------------------------
 20223                                  
 20224                                  labsdwrt:
 20225 000010B2 EB03                    		jmp	short absdwrt_cont
 20226                                  ; ---------------------------------------------------------------------------
 20227 000010B4 E8B800                  		call	EnsureA20ON
 20228                                  
 20229                                  absdwrt_cont:
 20230 000010B7 2EFF2E[7210]            		jmp	far [cs:DOSINTTABLE_16]
 20231                                  ; ---------------------------------------------------------------------------
 20232                                  
 20233                                  lstay_resident:
 20234 000010BC EB03                    		jmp	short sr_cont
 20235                                  ; ---------------------------------------------------------------------------
 20236 000010BE E8AE00                  		call	EnsureA20ON
 20237                                  
 20238                                  sr_cont:
 20239 000010C1 2EFF2E[7610]            		jmp	far [cs:DOSINTTABLE_20]
 20240                                  ; ---------------------------------------------------------------------------
 20241                                  
 20242                                  lint2f:
 20243 000010C6 EB03                    		jmp	short int2f_cont
 20244                                  ; ---------------------------------------------------------------------------
 20245 000010C8 E8A400                  		call	EnsureA20ON
 20246                                  
 20247                                  int2f_cont:
 20248 000010CB 2EFF2E[7A10]            		jmp	far [cs:DOSINTTABLE_24]
 20249                                  ; ---------------------------------------------------------------------------
 20250                                  
 20251                                  lcall_entry:
 20252 000010D0 EB03                    		jmp	short callentry_cont
 20253                                  ; ---------------------------------------------------------------------------
 20254 000010D2 E89A00                  		call	EnsureA20ON
 20255                                  
 20256                                  callentry_cont:
 20257 000010D5 2EFF2E[7E10]            		jmp	far [cs:DOSINTTABLE_28]
 20258                                  ; ---------------------------------------------------------------------------
 20259                                  
 20260                                  lirett:
 20261 000010DA CF                      		iret
 20262                                  ; ---------------------------------------------------------------------------
 20263 000010DB 00000000                DosRetAddr23	dd 0			; ...
 20264 000010DF 00000000                DosRetAddr24	dd 0			; ...
 20265 000010E3 00000000                DosRetAddr28	dd 0
 20266                                  ; ---------------------------------------------------------------------------
 20267                                  
 20268                                  LowInt23:				; ...
 20269 000010E7 2E8F06[DB10]            		pop	word [cs:DosRetAddr23]
 20270 000010EC 2E8F06[DD10]            		pop	word [cs:DosRetAddr23+2]
 20271 000010F1 CD23                    		int	23h		; DOS -	CONTROL	"C" EXIT ADDRESS
 20272                                  					; Return: return via RETF 2 with CF set
 20273                                  					; DOS will abort program with errorlevel 0
 20274                                  					; else
 20275                                  					; interrupted DOS call continues
 20276 000010F3 E87900                  		call	EnsureA20ON
 20277 000010F6 2EFF2E[DB10]            		jmp	far [cs:DosRetAddr23]
 20278                                  ; ---------------------------------------------------------------------------
 20279                                  
 20280                                  LowInt24:				; ...
 20281 000010FB 2E8F06[DF10]            		pop	word [cs:DosRetAddr24]
 20282 00001100 2E8F06[E110]            		pop	word [cs:DosRetAddr24+2]
 20283 00001105 CD24                    		int	24h		; DOS -	FATAL ERROR HANDLER ADDRESS
 20284                                  					; Automatically	called upon detection of unrecoverable I/O error.
 20285 00001107 E86500                  		call	EnsureA20ON
 20286 0000110A 2EFF2E[DF10]            		jmp	far [cs:DosRetAddr24]
 20287                                  ; ---------------------------------------------------------------------------
 20288                                  
 20289                                  LowInt28:				; ...
 20290 0000110F CD28                    		int	28h		; DOS 2+ internal - KEYBOARD BUSY LOOP
 20291 00001111 E85B00                  		call	EnsureA20ON
 20292 00001114 CB                      		retf
 20293                                  ; ---------------------------------------------------------------------------
 20294                                  
 20295                                  disa20_xfer:				; ...
 20296 00001115 E83F00                  		call	XMMDisableA20
 20297 00001118 FA                      		cli
 20298 00001119 2EC606[2103]00          		mov	byte [cs:INDOS], 0
 20299 0000111F 8ED0                    		mov	ss, ax
 20300 00001121 89FC                    		mov	sp, di
 20301 00001123 FB                      		sti
 20302 00001124 1E                      		push	ds
 20303 00001125 56                      		push	si
 20304 00001126 8EC2                    		mov	es, dx
 20305 00001128 8EDA                    		mov	ds, dx
 20306 0000112A 89D8                    		mov	ax, bx
 20307 0000112C CB                      		retf
 20308                                  ; ---------------------------------------------------------------------------
 20309                                  
 20310                                  disa20_iret:				; ...
 20311 0000112D E82700                  		call	XMMDisableA20
 20312 00001130 FE0E[2103]              		dec	byte [INDOS]
 20313 00001134 8E16[8605]              		mov	ss, [USER_SS]
 20314 00001138 8B26[8405]              		mov	sp, [USER_SP]
 20315 0000113C 89E5                    		mov	bp, sp
 20316 0000113E 884600                  		mov	[bp+0],	al
 20317 00001141 A1[F205]                		mov	ax, [NSP]
 20318 00001144 A3[8405]                		mov	[USER_SP], ax
 20319 00001147 A1[F005]                		mov	ax, [NSS]
 20320 0000114A A3[8605]                		mov	[USER_SS], ax
 20321 0000114D 58                      		pop	ax
 20322 0000114E 5B                      		pop	bx
 20323 0000114F 59                      		pop	cx
 20324 00001150 5A                      		pop	dx
 20325 00001151 5E                      		pop	si
 20326 00001152 5F                      		pop	di
 20327 00001153 5D                      		pop	bp
 20328 00001154 1F                      		pop	ds
 20329 00001155 07                      		pop	es
 20330 00001156 CF                      		iret
 20331                                  
 20332                                  ; =============== S U B	R O U T	I N E =======================================
 20333                                  
 20334                                  
 20335                                  XMMDisableA20:
 20336 00001157 53                      		push	bx
 20337 00001158 50                      		push	ax
 20338 00001159 B406                    		mov	ah, 6
 20339 0000115B 2EFF1E[6311]            		call	far [cs:XMMcontrol]
 20340 00001160 58                      		pop	ax
 20341 00001161 5B                      		pop	bx
 20342 00001162 C3                      		retn
 20343                                  
 20344                                  ; ---------------------------------------------------------------------------
 20345 00001163 00000000                XMMcontrol:	dd 0			; ...
 20346 00001167 80000000                LowMemory:	dd 80h			; ...
 20347 0000116B 9000FFFF                HighMemory:	dd 0FFFF0090h		; ...
 20348                                  
 20349                                  ; =============== S U B	R O U T	I N E =======================================
 20350                                  
 20351                                  
 20352                                  EnsureA20ON:
 20353 0000116F 9C                      		pushf
 20354 00001170 1E                      		push	ds
 20355 00001171 06                      		push	es
 20356 00001172 51                      		push	cx
 20357 00001173 56                      		push	si
 20358 00001174 57                      		push	di
 20359 00001175 2EC536[6711]            		lds	si, [cs:LowMemory]
 20360 0000117A 2EC43E[6B11]            		les	di, [cs:HighMemory]
 20361 0000117F B90400                  		mov	cx, 4
 20362 00001182 FC                      		cld
 20363 00001183 F3A7                    		repe cmpsw
 20364 00001185 7407                    		jz	short EA20_OFF
 20365                                  
 20366                                  EA20_RET:				; ...
 20367 00001187 5F                      		pop	di
 20368 00001188 5E                      		pop	si
 20369 00001189 59                      		pop	cx
 20370 0000118A 07                      		pop	es
 20371 0000118B 1F                      		pop	ds
 20372 0000118C 9D                      		popf
 20373 0000118D C3                      		retn
 20374                                  ; ---------------------------------------------------------------------------
 20375                                  
 20376                                  EA20_OFF:				; ...
 20377 0000118E 53                      		push	bx
 20378 0000118F 50                      		push	ax
 20379 00001190 8CD0                    		mov	ax, ss
 20380 00001192 2EA3[8610]              		mov	[cs:SS_Save], ax
 20381 00001196 2E8926[8810]            		mov	[cs:SP_Save], sp
 20382 0000119B 8CC8                    		mov	ax, cs
 20383 0000119D 8ED0                    		mov	ss, ax
 20384 0000119F BC[A007]                		mov	sp, AUXSTACK
 20385 000011A2 B405                    		mov	ah, 5
 20386 000011A4 2EFF1E[6311]            		call	far [cs:XMMcontrol]
 20387 000011A9 09C0                    		or	ax, ax
 20388 000011AB 740F                    		jz	short XMMerror
 20389 000011AD 2EA1[8610]              		mov	ax, [cs:SS_Save]
 20390 000011B1 8ED0                    		mov	ss, ax
 20391 000011B3 2E8B26[8810]            		mov	sp, [cs:SP_Save]
 20392 000011B8 58                      		pop	ax
 20393 000011B9 5B                      		pop	bx
 20394 000011BA EBCB                    		jmp	short EA20_RET
 20395                                  ; ---------------------------------------------------------------------------
 20396                                  
 20397                                  XMMerror:				; ...
 20398 000011BC B40F                    		mov	ah, 0Fh
 20399 000011BE CD10                    		int	10h		; - VIDEO - GET	CURRENT	VIDEO MODE
 20400                                  					; Return: AH = number of columns on screen
 20401                                  					; AL = current video mode
 20402                                  					; BH = current active display page
 20403 000011C0 3C07                    		cmp	al, 7
 20404 000011C2 7406                    		jz	short XMMcont
 20405 000011C4 30E4                    		xor	ah, ah
 20406 000011C6 B002                    		mov	al, 2
 20407 000011C8 CD10                    		int	10h		; - VIDEO - SET	VIDEO MODE
 20408                                  					; AL = mode
 20409                                  
 20410                                  XMMcont:				; ...
 20411 000011CA B405                    		mov	ah, 5
 20412 000011CC 30C0                    		xor	al, al
 20413 000011CE CD10                    		int	10h		; - VIDEO - SELECT DISPLAY PAGE
 20414                                  					; AL = display page, 0-7  for modes 0 &	1, 0-3	for modes 2 & 3
 20415 000011D0 BE[B812]                		mov	si, XMMERRMSG ; "\r\nA20	Hardware Error\r\n$"
 20416 000011D3 0E                      		push	cs
 20417 000011D4 1F                      		pop	ds
 20418 000011D5 FC                      		cld
 20419                                  
 20420                                  XMMprnt:				; ...
 20421 000011D6 AC                      		lodsb
 20422 000011D7 3C24                    		cmp	al, '$'
 20423 000011D9 7409                    		jz	short XMMStall
 20424 000011DB B40E                    		mov	ah, 0Eh
 20425 000011DD BB0700                  		mov	bx, 7
 20426 000011E0 CD10                    		int	10h		; - VIDEO - WRITE CHARACTER AND	ADVANCE	CURSOR (TTY WRITE)
 20427                                  					; AL = character, BH = display page (alpha modes)
 20428                                  					; BL = foreground color	(graphics modes)
 20429 000011E2 EBF2                    		jmp	short XMMprnt
 20430                                  ; ---------------------------------------------------------------------------
 20431                                  
 20432                                  XMMStall:				; ...
 20433 000011E4 FB                      		sti
 20434 000011E5 EBFD                    		jmp	short XMMStall
 20435                                  
 20436                                  ; ---------------------------------------------------------------------------
 20437 000011E7 7000                    OldInstanceJunk: dw 70h			; ...
 20438 000011E9 0000                    		dw 0
 20439 000011EB 0600                    		dw 6
 20440 000011ED 0000                    OldInstanceJunk_6: dw 0			; ...
 20441 000011EF [2200]                  		dw CONTPOS
 20442 000011F1 0200                    		dw 2
 20443 000011F3 0000                    		dw 0
 20444 000011F5 [3200]                  		dw BCON
 20445 000011F7 0400                    		dw 4
 20446 000011F9 0000                    		dw 0
 20447 000011FB [F901]                  		dw CARPOS
 20448 000011FD 0601                    		dw 106h
 20449 000011FF 0000                    		dw 0
 20450 00001201 [0003]                  		dw CHARCO
 20451 00001203 0100                    		dw 1
 20452 00001205 0000                    		dw 0
 20453 00001207 [C00F]                  		dw exec_init_SP
 20454 00001209 2200                    		dw 34
 20455 0000120B 7000                    		dw 70h
 20456 0000120D 0C00                    		dw 0Ch
 20457 0000120F 0100                    		dw 1
 20458 00001211 00                      DosHasHMA:	db 0			; ...
 20459 00001212 0000                    FixExePatch:	dw 0			; ...
 20460 00001214 0000                    RationalPatchPtr: dw 0			; ...
 20461                                  ; ---------------------------------------------------------------------------
 20462                                  
 20463                                  RatBugCode:				; ...
 20464 00001216 51                      		push	cx
 20465                                  		; 27/09/2023
 20466 00001217 8B0E1000                		mov	cx, [10h]	; db 0B9h, dw 10h
 20467                                  rbc_loop:				; ...
 20468 0000121B E2FE                    		loop	rbc_loop
 20469 0000121D 59                      		pop	cx
 20470 0000121E CB                      		retf
 20471                                  ; ---------------------------------------------------------------------------
 20472 0000121F 000000000000000000-     UmbSave1:	db 11 dup(0)		; ...
 20472 00001228 0000               
 20473 0000122A 0000000000000000        COUNTRY_CDPG:	db 8 dup(0)		; ...
 20474 00001232 5C434F554E5452592E-     		db '\COUNTRY.SYS',0
 20474 0000123B 53595300           
 20475 0000123F 000000000000000000-     		db 51 dup(0)
 20475 00001248 000000000000000000-
 20475 00001251 000000000000000000-
 20475 0000125A 000000000000000000-
 20475 00001263 000000000000000000-
 20475 0000126C 000000000000       
 20476 00001272 B501                    		dw 437
 20477 00001274 0600                    		dw 6
 20478 00001276 02                      COUNTRY_CDPG_76: db 2			; ...
 20479 00001277 [AD0A]                  		dw UCASE_TAB
 20480 00001279 0000                    		dw 0
 20481 0000127B 04                      		db 4
 20482 0000127C [2F0B]                  		dw FILE_UCASE_TAB
 20483 0000127E 0000                    		dw 0
 20484 00001280 05                      		db 5
 20485 00001281 [B10B]                  		dw FILE_CHAR_TAB
 20486 00001283 0000                    		dw 0
 20487 00001285 06                      		db 6
 20488 00001286 [E10B]                  		dw COLLATE_TAB
 20489 00001288 0000                    		dw 0
 20490 0000128A 07                      		db 7
 20491 0000128B [E30C]                  		dw DBCS_TAB
 20492 0000128D 0000                    		dw 0
 20493 0000128F 01                      		db 1
 20494 00001290 2600                    		dw 38
 20495 00001292 0100                    		dw 1
 20496 00001294 B501                    		dw 437
 20497 00001296 0000                    COUNTRY_CDPG_108: dw 0			; ...
 20498 00001298 2400000000              		db '$',0,0,0,0
 20499 0000129D 2C00                    		db ',',0
 20500 0000129F 2E00                    		db '.',0
 20501 000012A1 2D00                    		db '-',0
 20502 000012A3 3A00                    		db ':',0
 20503 000012A5 00                      		db 0
 20504 000012A6 02                      		db 2
 20505 000012A7 00                      		db 0
 20506 000012A8 [F50C]                  		dw MAP_CASE
 20507 000012AA 0000                    		dw 0
 20508 000012AC 2C00                    		db ',',0
 20509 000012AE 000000000000000000-     		dw 5 dup(0)
 20509 000012B7 00                 
 20510 000012B8 0D0A                    XMMERRMSG:	db 0Dh,0Ah		; ...
 20511 000012BA 413230204861726477-     		db 'A20 Hardware Error',0Dh,0Ah,'$'
 20511 000012C3 617265204572726F72-
 20511 000012CC 0D0A24             
 20512 000012CF 36C536                  DOSP1_ID:	db 36h,	0C5h, 36h
 20513 000012D2 3605C57407E8            DOSP1_THISSFT:	db 36h,	5, 0C5h, 74h, 7, 0E8h
 20514 000012D8 9090                    		db 2 dup(90h)
 20515 000012DA 36C536                  DOSP12_ID:	db 36h,	0C5h, 36h
 20516 000012DD 3605C57407E8            DOSP12_THISSFT:	db 36h,	5, 0C5h, 74h, 7, 0E8h
 20517 000012E3 510657BA                DOSP3_ID:	db 51h,	6, 57h,	0BAh
 20518 000012E7 2902E8                  DOSP3_CONBUF:	db 29h,	2, 0E8h
 20519 000012EA 9AE35F07                		db 9Ah,	0E3h, 5Fh, 7
 20520 000012EE 59                      DOSP4_ID:	db 59h
 20521 000012EF 51                      DOSP5_ID:	db 51h
 20522 000012F0 AC3C1A7405              		db 0ACh, 3Ch, 1Ah, 74h,	5
 20523 000012F5 E8                      		db 0E8h
 20524 000012F6 2E8C1E                  DOSP7_ID:	db 2Eh,	8Ch, 1Eh
 20525 000012F9 7E05                    DOSP7_SAVEDS:	db 7Eh,	5
 20526 000012FB 2E891E                  		db 2Eh,	89h, 1Eh
 20527 000012FE 7C05                    DOSP7_SAVEBX:	db 7Ch,	5
 20528 00001300 8CCB                    		db 8Ch,	0CBh
 20529 00001302 8EDB                    		db 8Eh,	0DBh
 20530 00001304 FE06                    		db 0FEh, 6
 20531 00001306 CF02                    DOSP7_INDOS:	db 0CFh, 2
 20532 00001308 33C0                    		db 33h,	0C0h
 20533 0000130A 50                      DOSP8_ID:	db 50h
 20534 0000130B 36A1                    		db 36h,	0A1h
 20535 0000130D EA02                    DOSP8_USER_ID:	db 0EAh, 2
 20536 0000130F 263B45                  		db 26h,	3Bh, 45h
 20537 00001312 2F58                    		db 2Fh,	58h
 20538 00001314 061F                    DOSP10_ID:	db 6, 1Fh
 20539 00001316 8BDF                    DOSP10_LOC:	db 8Bh,	0DFh
 20540 00001318 33C08BD0E8              		db 33h,	0C0h, 8Bh, 0D0h, 0E8h
 20541 0000131D DF0E                    		db 0DFh, 0Eh
 20542 0000131F 1E36C5363605E8AF0E      		db 1Eh,	36h, 0C5h, 2 dup(36h), 5, 0E8h,	0AFh, 0Eh
 20543 00001328 8BD7B486368B3E          		db 8Bh,	0D7h, 0B4h, 86h, 36h, 8Bh, 3Eh
 20544 0000132F 0903                    		db 9, 3
 20545 00001331 F7C700807419E84717      		db 0F7h, 0C7h, 0, 80h, 74h, 19h, 0E8h, 47h, 17h
 20546 0000133A 8BFA0AC074103C0374-     		db 8Bh,	0FAh, 0Ah, 0C0h, 74h, 10h, 3Ch,	3, 74h,	3
 20546 00001343 03                 
 20547 00001344 1FEBCF                  		db 1Fh,	0EBh, 0CFh
 20548 00001347 5F                      		db 5Fh
 20549 00001348 36C43E3605E9A104        		db 36h,	0C4h, 3Eh, 36h,	5, 0E9h, 0A1h, 4
 20550 00001350 5F8BFA                  		db 5Fh,	8Bh, 0FAh
 20551 00001353 AC                      DOSP13_ID:	db 0ACh
 20552 00001354 3C24                    		db 3Ch,	24h
 20553 00001356 7408                    		db 74h,	8
 20554 00001358 B307                    		db 0B3h, 7
 20555 0000135A B40E                    		db 0B4h, 0Eh
 20556 0000135C CD10                    		db 0CDh, 10h
 20557 0000135E EBF3                    		db 0EBh, 0F3h
 20558 00001360 EBFE                    		db 0EBh, 0FEh
 20559 00001362 0000                    Rational386PatchPtr: dw 0		; ...
 20560                                  ; ---------------------------------------------------------------------------
 20561                                  
 20562                                  MagicPatch:				; ...
 20563 00001364 CB                      		retf
 20564                                  ; ---------------------------------------------------------------------------
 20565 00001365 90                      		nop
 20566 00001366 90                      		nop
 20567 00001367 90                      		nop
 20568 00001368 90                      		nop
 20569 00001369 90                      		nop
 20570                                  ; END
