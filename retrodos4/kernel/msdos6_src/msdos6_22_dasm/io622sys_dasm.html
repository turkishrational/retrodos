<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>IDA - G:\Yedek\retrodos4\etc\IO622SYS.idb (IO622.SYS)</title>
</head>
<body bgcolor="white">
<span style="white-space: pre; font-family: Fixedsys; color: blue; background: white">

<span style="color:maroon">BIOSDATA:0000 </span>;
<span style="color:maroon">BIOSDATA:0000 </span>; +-------------------------------------------------------------------------+
<span style="color:maroon">BIOSDATA:0000 </span>; |   This file has been generated by The Interactive Disassembler (IDA)    |
<span style="color:maroon">BIOSDATA:0000 </span>; |           Copyright (c) 2013 Hex-Rays, &lt;support@hex-rays.com&gt;           |
<span style="color:maroon">BIOSDATA:0000 </span>; |                      Licensed to: Freeware version                      |
<span style="color:maroon">BIOSDATA:0000 </span>; +-------------------------------------------------------------------------+
<span style="color:maroon">BIOSDATA:0000 </span>;
<span style="color:maroon">BIOSDATA:0000 </span>; Input MD5   : 3BE8D0C08E35500FA0E9FEFC20956F18
<span style="color:maroon">BIOSDATA:0000
BIOSDATA:0000 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:0000 </span>; File Name   : C:\Users\erdogan.tan\Desktop\IO622SYS.BIN
<span style="color:maroon">BIOSDATA:0000 </span>; Format      : Binary file
<span style="color:maroon">BIOSDATA:0000 </span>; Base Address: 0000h Range: 0000h - 98D0h Loaded length: 98D0h
<span style="color:maroon">BIOSDATA:0000
BIOSDATA:0000                 .</span>386
<span style="color:maroon">BIOSDATA:0000                 </span>.model flat
<span style="color:maroon">BIOSDATA:0000
BIOSDATA:0000 </span><span style="color:gray">; ===========================================================================
</span><span style="color:maroon">BIOSDATA:0000
BIOSDATA:0000 </span><span style="color:gray">; Segment type: Regular
</span><span style="color:maroon">BIOSDATA:0000 </span>BIOSDATA        segment byte public &#039;BIOSDATA&#039; use16
<span style="color:maroon">BIOSDATA:0000                 </span>assume cs:BIOSDATA
<span style="color:maroon">BIOSDATA:0000                 </span>assume es:nothing, ss:nothing, ds:nothing, fs:nothing, gs:nothing
<span style="color:maroon">BIOSDATA:0000
BIOSDATA:0000 </span>BData_start<span style="color:navy">:                            </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:0000                 </span><span style="color:navy">jmp     </span>init
<span style="color:maroon">BIOSDATA:0000 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:0003 </span>DosDataSg       <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0005 </span>bios_i2f        <span style="color:navy">db </span><span style="color:#008040">0EAh                 </span>; far jump to int_2f (segment may not be at 70h)
<span style="color:gray">BIOSDATA:0006                 </span><span style="color:navy">dw offset </span>int_2f
<span style="color:gray">BIOSDATA:0008                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:000A </span>romstartaddr    <span style="color:navy">dw </span><span style="color:#008040">0                    </span>; The start address for the romfind routines
<span style="color:gray">BIOSDATA:000C </span>altah           <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:000C                                         </span>; special key handling
<span style="color:gray">BIOSDATA:000D </span>inHMA           <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:000D                                         </span>; flag indicates we&#039;re running from HMA
<span style="color:gray">BIOSDATA:000E </span>xms             <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:000E                                         </span>; entry point to xms if above is true
<span style="color:gray">BIOSDATA:0012 </span>ptrsav          <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0012                                         </span>; pointer save
<span style="color:gray">BIOSDATA:0012                                         </span>; This variable holds the pointer to
<span style="color:gray">BIOSDATA:0012                                         </span>; the Request Header passed by a program wishing
<span style="color:gray">BIOSDATA:0012                                         </span>; to use a device driver. When the strategy routine
<span style="color:gray">BIOSDATA:0012                                         </span>; is called it puts the address of the Request header
<span style="color:gray">BIOSDATA:0012                                         </span>; in this variable and returns.
<span style="color:gray">BIOSDATA:0016 </span>auxbuf          <span style="color:navy">db </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0016                                         </span>; set of 1 byte buffers for com 1,2,3, and 4
<span style="color:gray">BIOSDATA:001A </span>zeroseg         <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:001A                                         </span>; easy way to load segment registers with zero
<span style="color:gray">BIOSDATA:001C </span>i13_ds          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:001C                                         </span>; ds register for int 13h call through
<span style="color:gray">BIOSDATA:001E </span>prevoper        <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:001E                                         </span>; holds int 13h request (i.e. register ax).
<span style="color:gray">BIOSDATA:0020 </span>number_of_sec   <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0020                                         </span>; holds number of secs. to read on an ecc error
<span style="color:gray">BIOSDATA:0021 </span>auxnum          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0021                                         </span>; which aux device was requested
<span style="color:gray">BIOSDATA:0023 </span>res_dev_list    <span style="color:navy">dw offset </span>auxdev2       <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0023                                         </span>; CONHeader ;  Device Header for the CON Device Driver
<span style="color:gray">BIOSDATA:0025                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:0027                 </span><span style="color:navy">dw </span><span style="color:#008040">8013h
</span><span style="color:gray">BIOSDATA:0029                 </span><span style="color:navy">dw offset </span>strategy
<span style="color:gray">BIOSDATA:002B                 </span><span style="color:navy">dw offset </span>con_entry
<span style="color:gray">BIOSDATA:002D </span><span style="color:navy">aCon            db &#039;CON     &#039;
</span><span style="color:gray">BIOSDATA:0035 </span>auxdev2         <span style="color:navy">dw offset </span>prndev2       <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0037                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:0039                 </span><span style="color:navy">dw </span><span style="color:#008040">8000h
</span><span style="color:gray">BIOSDATA:003B </span><span style="color:navy">off_3B          dw offset </span>strategy      <span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:003D </span><span style="color:navy">off_3D          dw offset </span>aux0_entry    <span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:003F </span><span style="color:navy">aAux            db &#039;AUX     &#039;           </span><span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:0047 </span>prndev2         <span style="color:navy">dw offset </span>timdev        <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0049                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:004B </span><span style="color:navy">word_4B         dw </span><span style="color:#008040">0A0C0h               </span><span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:004D </span><span style="color:navy">off_4D          dw offset </span>strategy      <span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:004F </span><span style="color:navy">off_4F          dw offset </span>prn0_entry    <span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:0051 </span><span style="color:navy">aPrn            db &#039;PRN     &#039;           </span><span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:0059 </span>timdev          <span style="color:navy">dw offset </span>dskdev        <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:005B                 </span><span style="color:navy">dw </span><span style="color:#008040">70h                  </span><span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:005D                 </span><span style="color:navy">dw </span><span style="color:#008040">8008h
</span><span style="color:gray">BIOSDATA:005F                 </span><span style="color:navy">dw offset </span>strategy
<span style="color:gray">BIOSDATA:0061                 </span><span style="color:navy">dw offset </span>tim_entry
<span style="color:gray">BIOSDATA:0063 </span><span style="color:navy">aClock          db &#039;CLOCK$  &#039;           </span><span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:006B </span>dskdev          <span style="color:navy">dw offset </span>com1dev       <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:006D </span><span style="color:navy">word_6D         dw </span><span style="color:#008040">70h                  </span><span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:006F                 </span><span style="color:navy">dw </span><span style="color:#008040">8C2h
</span><span style="color:gray">BIOSDATA:0071                 </span><span style="color:navy">dw offset </span>strategy
<span style="color:gray">BIOSDATA:0073                 </span><span style="color:navy">dw offset </span>dsk_entry
<span style="color:gray">BIOSDATA:0075 </span>drvmax          <span style="color:navy">db </span><span style="color:#008040">4                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0075                                         </span>; maximum number of drives
<span style="color:gray">BIOSDATA:0076 </span>step_drv        <span style="color:navy">db </span><span style="color:#008040">0FEh                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0076                                         </span>; -2 ; last drive accessed
<span style="color:gray">BIOSDATA:0077 </span>fhave96         <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0077                                         </span>; flag to indicate presence of 96tpi support
<span style="color:gray">BIOSDATA:0078 </span>single          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0078                                         </span>; used to detect single drive systems
<span style="color:gray">BIOSDATA:0079 </span>fhavek09        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0079                                         </span>; indicates if this is a k09 or not
<span style="color:gray">BIOSDATA:0079                                         </span>;  used by console driver.
<span style="color:gray">BIOSDATA:007A </span>fsetowner       <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:007A                                         </span>; = 1 if we are setting the owner of a drive.
<span style="color:gray">BIOSDATA:007A                                         </span>;  (examined by checksingle).
<span style="color:gray">BIOSDATA:007B </span>com1dev         <span style="color:navy">dw offset </span>lpt1dev       <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:007B                                         </span>; Device Header for device &quot;COM1&quot;
<span style="color:gray">BIOSDATA:007D                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:007F                 </span><span style="color:navy">dw </span><span style="color:#008040">8000h
</span><span style="color:gray">BIOSDATA:0081                 </span><span style="color:navy">dw offset </span>strategy
<span style="color:gray">BIOSDATA:0083                 </span><span style="color:navy">dw offset </span>aux0_entry    <span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:0085 </span><span style="color:navy">aCom1           db &#039;COM1    &#039;
</span><span style="color:gray">BIOSDATA:008D </span>lpt1dev         <span style="color:navy">dw offset </span>lpt2dev       <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:008F                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:0091                 </span><span style="color:navy">dw </span><span style="color:#008040">0A0C0h
</span><span style="color:gray">BIOSDATA:0093                 </span><span style="color:navy">dw offset </span>strategy
<span style="color:gray">BIOSDATA:0095                 </span><span style="color:navy">dw offset </span>prn1_entry
<span style="color:gray">BIOSDATA:0097 </span><span style="color:navy">aLpt1           db &#039;LPT1    &#039;
</span><span style="color:gray">BIOSDATA:009F </span>lpt2dev         <span style="color:navy">dw offset </span>lpt3dev       <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:00A1                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:00A3 </span><span style="color:navy">word_A3         dw </span><span style="color:#008040">0A0C0h               </span><span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:00A5 </span><span style="color:navy">off_A5          dw offset </span>strategy      <span style="color:olive">; ...
</span><span style="color:gray">BIOSDATA:00A7                 </span><span style="color:navy">dw offset </span>prn2_entry
<span style="color:gray">BIOSDATA:00A9 </span><span style="color:navy">aLpt2           db &#039;LPT2    &#039;
</span><span style="color:gray">BIOSDATA:00B1                 </span><span style="color:navy">db </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:00B4 </span>Orig13          <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:00B4                                         </span>; Orig13 needs to be at offset 0B4h
<span style="color:gray">BIOSDATA:00B4                                         </span>;  for the CMS floppy driver to work.
<span style="color:gray">BIOSDATA:00B8 </span>lpt3dev         <span style="color:navy">dw offset </span>com2dev       <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:00B8                                         </span>; Device Header for device LPT3
<span style="color:gray">BIOSDATA:00BA                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:00BC </span><span style="color:navy">word_BC         dw </span><span style="color:#008040">0A0C0h               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:00BE </span><span style="color:navy">off_BE          dw offset </span>strategy      <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:00C0                 </span><span style="color:navy">dw offset </span>prn3_entry
<span style="color:gray">BIOSDATA:00C2 </span><span style="color:navy">aLpt3           db &#039;LPT3    &#039;
</span><span style="color:gray">BIOSDATA:00CA </span>com2dev         <span style="color:navy">dw offset </span>com3dev       <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:00CC                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:00CE                 </span><span style="color:navy">dw </span><span style="color:#008040">8000h
</span><span style="color:gray">BIOSDATA:00D0                 </span><span style="color:navy">dw offset </span>strategy
<span style="color:gray">BIOSDATA:00D2                 </span><span style="color:navy">dw offset </span>aux1_entry
<span style="color:gray">BIOSDATA:00D4 </span><span style="color:navy">aCom2           db &#039;COM2    &#039;
</span><span style="color:gray">BIOSDATA:00DC </span>com3dev         <span style="color:navy">dw offset </span>com4dev       <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:00DE                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:00E0                 </span><span style="color:navy">dw </span><span style="color:#008040">8000h
</span><span style="color:gray">BIOSDATA:00E2                 </span><span style="color:navy">dw offset </span>strategy
<span style="color:gray">BIOSDATA:00E4                 </span><span style="color:navy">dw offset </span>aux2_entry
<span style="color:gray">BIOSDATA:00E6 </span><span style="color:navy">aCom3           db &#039;COM3    &#039;
</span><span style="color:gray">BIOSDATA:00EE </span>com4dev         <span style="color:navy">dw </span><span style="color:#008040">0FFFFh               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:00F0                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:00F2                 </span><span style="color:navy">dw </span><span style="color:#008040">8000h
</span><span style="color:gray">BIOSDATA:00F4                 </span><span style="color:navy">dw offset </span>strategy
<span style="color:gray">BIOSDATA:00F6                 </span><span style="color:navy">dw offset </span>aux3_entry
<span style="color:gray">BIOSDATA:00F8 </span><span style="color:navy">aCom4           db &#039;COM4    &#039;
</span><span style="color:gray">BIOSDATA:0100 </span>RomVectors      <span style="color:navy">db </span><span style="color:#008040">10h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0101 </span>Old10           <span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0105                 </span><span style="color:navy">db </span><span style="color:#008040">13h
</span><span style="color:gray">BIOSDATA:0106 </span>Old13           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:010A                 </span><span style="color:navy">db </span><span style="color:#008040">15h
</span><span style="color:gray">BIOSDATA:010B </span>Old15           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:010F                 </span><span style="color:navy">db </span><span style="color:#008040">19h
</span><span style="color:gray">BIOSDATA:0110 </span>Old19           <span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0114                 </span><span style="color:navy">db </span><span style="color:#008040">1Bh
</span><span style="color:gray">BIOSDATA:0115 </span>Old1B           <span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0119 </span>start_bds       <span style="color:navy">dd </span><span style="color:#008040">70034Eh              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0119                                         </span>; Start of linked list of BDS&#039;s
<span style="color:gray">BIOSDATA:011D </span>accesscount     <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:011E </span>tim_drv         <span style="color:navy">db </span><span style="color:#008040">0FFh                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:011F </span>medbyt          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0120 </span>rflag           <span style="color:navy">db </span><span style="color:#008040">2                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0120                                         </span>; 2 for read, 3 for write
<span style="color:gray">BIOSDATA:0121 </span>verify          <span style="color:navy">db </span><span style="color:#008040">0                    </span>; 1 if verify after write
<span style="color:gray">BIOSDATA:0122 </span>seccnt          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0124                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; -- pad where hardnum was
<span style="color:gray">BIOSDATA:0125 </span>dsktnum         <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0125                                         </span>; number of diskette drives
<span style="color:gray">BIOSDATA:0126 </span>motorstartup    <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0126                                         </span>; value from table
<span style="color:gray">BIOSDATA:0127 </span>settlecurrent   <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0127                                         </span>; value from table
<span style="color:gray">BIOSDATA:0128 </span>settleslow      <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0128                                         </span>; slow settle value
<span style="color:gray">BIOSDATA:0129 </span>nextspeed       <span style="color:navy">db </span><span style="color:#008040">0                    </span>; value of speed to be used
<span style="color:gray">BIOSDATA:012A </span>save_head_sttl  <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:012A                                         </span>; used by read_sector routine
<span style="color:gray">BIOSDATA:012B </span>save_eot        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:012B                                         </span>; saved eot from the default DPT
<span style="color:gray">BIOSDATA:012C </span>eot             <span style="color:navy">db </span><span style="color:#008040">9                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:012D </span>dpt             <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:012D                                         </span>; pointer to Disk Parameter Table
<span style="color:gray">BIOSDATA:0131 </span>cursec          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0131                                         </span>; current sector
<span style="color:gray">BIOSDATA:0132 </span>curhd           <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0132                                         </span>; current head
<span style="color:gray">BIOSDATA:0133 </span>curtrk          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0133                                         </span>; current track
<span style="color:gray">BIOSDATA:0135 </span>spsav           <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0135                                         </span>; save the stack pointer
<span style="color:gray">BIOSDATA:0137 </span>formt_eot       <span style="color:navy">db </span><span style="color:#008040">8                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0137                                         </span>; eot used for format
<span style="color:gray">BIOSDATA:0138 </span>hdnum           <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0138                                         </span>; head number
<span style="color:gray">BIOSDATA:0139 </span>trknum          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0139                                         </span>; track being manipulated
<span style="color:gray">BIOSDATA:013B </span>gap_patch       <span style="color:navy">db </span><span style="color:#008040">50h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:013B                                         </span>; format gap patched into dpt
<span style="color:gray">BIOSDATA:013C </span>errin           <span style="color:navy">db </span><span style="color:#008040">0CCh                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:013C                                         </span>; disk errors returned from the IBM rom
<span style="color:gray">BIOSDATA:013C                                         </span>; write fault
<span style="color:gray">BIOSDATA:013D                 </span><span style="color:navy">db </span><span style="color:#008040">80h                  </span>; no response
<span style="color:gray">BIOSDATA:013E                 </span><span style="color:navy">db </span><span style="color:#008040">40h                  </span>; seek failure
<span style="color:gray">BIOSDATA:013F                 </span><span style="color:navy">db </span><span style="color:#008040">10h                  </span>; bad crc
<span style="color:gray">BIOSDATA:0140                 </span><span style="color:navy">db </span><span style="color:#008040">8                    </span>; dma overrun
<span style="color:gray">BIOSDATA:0141                 </span><span style="color:navy">db </span><span style="color:#008040">6                    </span>; media change
<span style="color:gray">BIOSDATA:0142                 </span><span style="color:navy">db </span><span style="color:#008040">4                    </span>; sector not found
<span style="color:gray">BIOSDATA:0143                 </span><span style="color:navy">db </span><span style="color:#008040">3                    </span>; write attempt to write-protect disk
<span style="color:gray">BIOSDATA:0144 </span>lsterr          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0144                                         </span>; all other errors
<span style="color:gray">BIOSDATA:0145 </span>errout          <span style="color:navy">db </span><span style="color:#008040">10                   </span>; returned error codes corresponding to above
<span style="color:gray">BIOSDATA:0145                                         </span>;  write  fault error
<span style="color:gray">BIOSDATA:0146                 </span><span style="color:navy">db </span><span style="color:#008040">2                    </span>; no response
<span style="color:gray">BIOSDATA:0147                 </span><span style="color:navy">db </span><span style="color:#008040">6                    </span>; seek failure
<span style="color:gray">BIOSDATA:0148                 </span><span style="color:navy">db </span><span style="color:#008040">4                    </span>; bad crc
<span style="color:gray">BIOSDATA:0149                 </span><span style="color:navy">db </span><span style="color:#008040">4                    </span>; dma overrun
<span style="color:gray">BIOSDATA:014A                 </span><span style="color:navy">db </span><span style="color:#008040">15                   </span>; invalid media change
<span style="color:gray">BIOSDATA:014B                 </span><span style="color:navy">db </span><span style="color:#008040">8                    </span>; sector not found
<span style="color:gray">BIOSDATA:014C                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; write attempt to write-protect disk
<span style="color:gray">BIOSDATA:014D                 </span><span style="color:navy">db </span><span style="color:#008040">12                   </span>; general error
<span style="color:gray">BIOSDATA:014E </span>disksector      <span style="color:navy">db </span><span style="color:#008040">512 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:014E                                         </span>; read in boot sector here
<span style="color:gray">BIOSDATA:034E </span>bds1            <span style="color:navy">dw offset </span>bds2          ; dword link to next structure
<span style="color:gray">BIOSDATA:0350                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:0352                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; int 13h drive number
<span style="color:gray">BIOSDATA:0353                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; logical drive letter
<span style="color:gray">BIOSDATA:0354 </span>fdrive1         <span style="color:navy">dw </span><span style="color:#008040">512                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0354                                         </span>; physical sector size in bytes
<span style="color:olive">BIOSDATA:0356                 </span><span style="color:navy">db </span><span style="color:#008040">0FFh                 </span>; sectors/allocation unit
<span style="color:gray">BIOSDATA:0357                 </span><span style="color:navy">dw </span><span style="color:#008040">1                    </span>; reserved sectors for dos
<span style="color:gray">BIOSDATA:0359                 </span><span style="color:navy">db </span><span style="color:#008040">2                    </span>; no of file allocation tables
<span style="color:gray">BIOSDATA:035A                 </span><span style="color:navy">dw </span><span style="color:#008040">64                   </span>; number of root directory entries
<span style="color:gray">BIOSDATA:035C                 </span><span style="color:navy">dw </span><span style="color:#008040">360                  </span>; number of sectors (at 512 bytes each)
<span style="color:gray">BIOSDATA:035E                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; media descriptor, initially 0
<span style="color:gray">BIOSDATA:035F                 </span><span style="color:navy">dw </span><span style="color:#008040">2                    </span>; number of fat sectors
<span style="color:gray">BIOSDATA:0361                 </span><span style="color:navy">dw </span><span style="color:#008040">9                    </span>; sector limit (sectors per track)
<span style="color:gray">BIOSDATA:0363                 </span><span style="color:navy">dw </span><span style="color:#008040">1                    </span>; head limit (number of heads - 1)
<span style="color:gray">BIOSDATA:0365                 </span><span style="color:navy">dd </span><span style="color:#008040">0                    </span>; hidden sector count
<span style="color:gray">BIOSDATA:0369                 </span><span style="color:navy">dd </span><span style="color:#008040">0                    </span>; number of sectors (32 bit)
<span style="color:gray">BIOSDATA:036D </span>fatsiz          <span style="color:navy">db </span><span style="color:#008040">0                    </span>; true =&gt; large fats (BDS.fatsiz)
<span style="color:gray">BIOSDATA:036E </span>opcnt1          <span style="color:navy">dw </span><span style="color:#008040">0                    </span>; open ref. count
<span style="color:gray">BIOSDATA:0370                 </span><span style="color:navy">db </span><span style="color:#008040">3                    </span>; form factor
<span style="color:gray">BIOSDATA:0371 </span>flags1          <span style="color:navy">dw </span><span style="color:#008040">20h                  </span>; various flags
<span style="color:gray">BIOSDATA:0373                 </span><span style="color:navy">dw </span><span style="color:#008040">40                   </span>; number of cylinders
<span style="color:gray">BIOSDATA:0375 </span>recbpb1         <span style="color:navy">dw </span><span style="color:#008040">512                  </span>; recommended bps for this drive
<span style="color:gray">BIOSDATA:0377                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:0378                 </span><span style="color:navy">dw </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:037A                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:037B                 </span><span style="color:navy">dw </span><span style="color:#008040">224                  </span>; number of root directory entries
<span style="color:gray">BIOSDATA:037D                 </span><span style="color:navy">dw </span><span style="color:#008040">360
</span><span style="color:gray">BIOSDATA:037F                 </span><span style="color:navy">db </span><span style="color:#008040">0F0h                 </span>; media descriptor, initially 0F0h
<span style="color:gray">BIOSDATA:0380                 </span><span style="color:navy">dw </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:0382                 </span><span style="color:navy">dw </span><span style="color:#008040">9
</span><span style="color:gray">BIOSDATA:0384                 </span><span style="color:navy">dw </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:0386                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:038A                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:038E                 </span><span style="color:navy">db </span><span style="color:#008040">6 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0394                 </span><span style="color:navy">db </span><span style="color:#008040">0FFh                 </span>; last track accessed on this drive
<span style="color:gray">BIOSDATA:0395                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh               </span>; keep these two contiguous (?)
<span style="color:gray">BIOSDATA:0397                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0399 </span><span style="color:navy">aNoName         db &#039;NO NAME    &#039;,0      </span>; volume id for this disk
<span style="color:gray">BIOSDATA:03A5                 </span><span style="color:navy">dd </span><span style="color:#008040">0                    </span>; current volume serial from boot record
<span style="color:gray">BIOSDATA:03A9 </span><span style="color:navy">aFat12          db &#039;FAT12   &#039;,0         </span>; current file system id from boot record
<span style="color:gray">BIOSDATA:03B2 </span>bds2            <span style="color:navy">dw offset </span>bds3          <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:03B4                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:03B6                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:03B7                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:03B8 </span>fdrive2         <span style="color:navy">db </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0FFh</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">40h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">68h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">9</span><span style="color:navy">, </span><span style="color:#008040">0 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:03B8                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0Ch </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:03B8                 </span><span style="color:navy">db </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0E0h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">68h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0F0h</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">9</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0Fh </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:03B8                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0FFh</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:03B8                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0416 </span>bds3            <span style="color:navy">dw offset </span>bds4          <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0418                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:041A                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:041B                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:041C </span>fdrive3         <span style="color:navy">db </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0FFh</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">40h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">68h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">9</span><span style="color:navy">, </span><span style="color:#008040">0 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:041C                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0Ch </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:041C                 </span><span style="color:navy">db </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0E0h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">68h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0F0h</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">9</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0Fh </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:041C                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0FFh</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:041C                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:047A </span>bds4            <span style="color:navy">dw </span><span style="color:#008040">0FFFFh               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:047C                 </span><span style="color:navy">dw </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:047E                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:047F                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0480 </span>fdrive4         <span style="color:navy">db </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0FFh</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">40h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">68h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">9</span><span style="color:navy">, </span><span style="color:#008040">0 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0480                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0Ch </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0480                 </span><span style="color:navy">db </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0E0h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">68h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">0F0h</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">9</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0Fh </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0480                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0FFh</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0480                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:04DE </span>sm92            <span style="color:navy">db </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">9</span><span style="color:navy">, </span><span style="color:#008040">112</span><span style="color:navy">, </span><span style="color:#008040">160</span><span style="color:navy">, </span><span style="color:#008040">5</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">2</span><span style="color:navy">) </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:04E5 </span>keyrd_func      <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:04E6 </span>keysts_func     <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:04E7 </span>printdev        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:04E7                                         </span>; printer device index
<span style="color:gray">BIOSDATA:04E8 </span>wait_count      <span style="color:navy">dw </span><span style="color:#008040">50h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:04E8                                         </span>; retry counts for printers
<span style="color:gray">BIOSDATA:04EA                 </span><span style="color:navy">dw </span><span style="color:#008040">50h
</span><span style="color:gray">BIOSDATA:04EC                 </span><span style="color:navy">dw </span><span style="color:#008040">50h
</span><span style="color:gray">BIOSDATA:04EE                 </span><span style="color:navy">dw </span><span style="color:#008040">50h
</span><span style="color:gray">BIOSDATA:04F0 </span>daycnt          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:04F2 </span>t_switch        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:04F2                                         </span>; flag for updating daycnt
<span style="color:gray">BIOSDATA:04F3 </span>havecmoscloc    <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:04F4 </span>base_century    <span style="color:navy">db </span><span style="color:#008040">19                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:04F5 </span>base_year       <span style="color:navy">db </span><span style="color:#008040">80                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:04F6 </span>month_tab       <span style="color:navy">db </span><span style="color:#008040">31</span><span style="color:navy">, </span><span style="color:#008040">28</span><span style="color:navy">, </span><span style="color:#008040">31</span><span style="color:navy">, </span><span style="color:#008040">30</span><span style="color:navy">, </span><span style="color:#008040">31</span><span style="color:navy">, </span><span style="color:#008040">30</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">31</span><span style="color:navy">), </span><span style="color:#008040">30</span><span style="color:navy">, </span><span style="color:#008040">31</span><span style="color:navy">, </span><span style="color:#008040">30</span><span style="color:navy">, </span><span style="color:#008040">31 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0502 </span>bintobcd        <span style="color:navy">dd </span><span style="color:#008040">7014FFh              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0506 </span>daycnttoday     <span style="color:navy">dd </span><span style="color:#008040">70142Eh              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:050A </span>set_id_flag     <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:050A                                         </span>; flag for getbp routine
<span style="color:gray">BIOSDATA:050B </span>fat_12_id       <span style="color:navy">db &#039;FAT12   &#039;,0         </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0514 </span>fat_16_id       <span style="color:navy">db &#039;FAT16   &#039;,0         </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:051D </span>vol_no_name     <span style="color:navy">db &#039;NO NAME    &#039;,0      </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0529 </span>temp_h          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0529                                         </span>; temporary for 32 bit calculation
<span style="color:gray">BIOSDATA:052B </span>start_sec_h     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:052B                                         </span>; starting sector number high word
<span style="color:gray">BIOSDATA:052D </span>saved_word      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:052D                                         </span>; tempory saving place for a word
<span style="color:gray">BIOSDATA:052F </span>multrk_flag     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0531 </span>ec35_flag       <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0531                                         </span>; flags for 3.5 inch disk drives
<span style="color:gray">BIOSDATA:0532 </span>vretry_cnt      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0534 </span>soft_ecc_cnt    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0536 </span>multitrk_format_flag <span style="color:navy">db </span><span style="color:#008040">0               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0536                                         </span>; multi track format request flag
<span style="color:gray">BIOSDATA:0537 </span>xfer_seg        <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0537                                         </span>; temp for transfer segment
<span style="color:gray">BIOSDATA:0539 </span>sectorspertrack <span style="color:navy">dw </span><span style="color:#008040">36                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:053B </span>tracktable      <span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">2</span><span style="color:navy">), </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:053B                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">5</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">6</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:053B                 </span><span style="color:navy">db </span><span style="color:#008040">7</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">8</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">9</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">10
</span><span style="color:gray">BIOSDATA:053B                 </span><span style="color:navy">db </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">11</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">12</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">13</span><span style="color:navy">, </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:053B                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">14</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">15</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">16</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:053B                 </span><span style="color:navy">db </span><span style="color:#008040">17</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">18</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">19</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">20
</span><span style="color:gray">BIOSDATA:053B                 </span><span style="color:navy">db </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">21</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">22</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">23</span><span style="color:navy">, </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:053B                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">24</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">25</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">26</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:053B                 </span><span style="color:navy">db </span><span style="color:#008040">27</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">28</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">29</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">30
</span><span style="color:gray">BIOSDATA:053B                 </span><span style="color:navy">db </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">31</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">32</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">33</span><span style="color:navy">, </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:053B                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">34</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">35</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">36</span><span style="color:navy">, </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:05CB                 </span><span style="color:navy">db </span><span style="color:#008040">108 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0637 </span>mediatype       <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0638 </span>media_set_for_format <span style="color:navy">db </span><span style="color:#008040">0               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0638                                         </span>; 1 if we have done an int 13h
<span style="color:gray">BIOSDATA:0638                                         </span>; set media type for format call
<span style="color:gray">BIOSDATA:0639 </span>had_format_error <span style="color:navy">db </span><span style="color:#008040">0                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0639                                         </span>; 1 if the previous format operation failed.
<span style="color:gray">BIOSDATA:063A </span>tempdpt         <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:063A                                         </span>; -1 ; temp disk base table
<span style="color:gray">BIOSDATA:063E </span>model_byte      <span style="color:navy">db </span><span style="color:#008040">0FFh                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:063E                                         </span>; model byte set at init time
<span style="color:gray">BIOSDATA:063F </span>secondary_model_byte <span style="color:navy">db </span><span style="color:#008040">0               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0640 </span>int19sem        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0640                                         </span>; indicate that all int 19h
<span style="color:gray">BIOSDATA:0640                                         </span>; initialization is complete
<span style="color:gray">BIOSDATA:0641 </span>i19_lst         <span style="color:navy">db </span><span style="color:#008040">2                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0641                                         </span>; original hardware int. vectors for int 19h
<span style="color:gray">BIOSDATA:0642 </span>int19old02      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0646                 </span><span style="color:navy">db </span><span style="color:#008040">8
</span><span style="color:gray">BIOSDATA:0647 </span>int19old08      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:064B                 </span><span style="color:navy">db </span><span style="color:#008040">9
</span><span style="color:gray">BIOSDATA:064C </span>int19old09      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0650                 </span><span style="color:navy">db </span><span style="color:#008040">0Ah
</span><span style="color:gray">BIOSDATA:0651 </span>int19old0A      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0655                 </span><span style="color:navy">db </span><span style="color:#008040">0Bh
</span><span style="color:gray">BIOSDATA:0656 </span>int19old0B      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:065A                 </span><span style="color:navy">db </span><span style="color:#008040">0Ch
</span><span style="color:gray">BIOSDATA:065B </span>int19old0C      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:065F                 </span><span style="color:navy">db </span><span style="color:#008040">0Dh
</span><span style="color:gray">BIOSDATA:0660 </span>int19old0D      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0664                 </span><span style="color:navy">db </span><span style="color:#008040">0Eh
</span><span style="color:gray">BIOSDATA:0665 </span>int19old0E      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0669                 </span><span style="color:navy">db </span><span style="color:#008040">70h
</span><span style="color:gray">BIOSDATA:066A </span>int19old70      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:066E                 </span><span style="color:navy">db </span><span style="color:#008040">72h
</span><span style="color:gray">BIOSDATA:066F </span>int19old72      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0673                 </span><span style="color:navy">db </span><span style="color:#008040">73h
</span><span style="color:gray">BIOSDATA:0674 </span>int19old73      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0678                 </span><span style="color:navy">db </span><span style="color:#008040">74h
</span><span style="color:gray">BIOSDATA:0679 </span>int19old74      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:067D                 </span><span style="color:navy">db </span><span style="color:#008040">76h
</span><span style="color:gray">BIOSDATA:067E </span>int19old76      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0682                 </span><span style="color:navy">db </span><span style="color:#008040">77h
</span><span style="color:gray">BIOSDATA:0683 </span>int19old77      <span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0687 </span>dskdrvs         <span style="color:navy">dw offset </span>fdrive1       <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0689                 </span><span style="color:navy">dw offset </span>fdrive2
<span style="color:gray">BIOSDATA:068B                 </span><span style="color:navy">dw offset </span>fdrive3
<span style="color:gray">BIOSDATA:068D                 </span><span style="color:navy">dw offset </span>fdrive4
<span style="color:gray">BIOSDATA:068F                 </span><span style="color:navy">dw </span><span style="color:#008040">22 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)            </span>; up to 26 drives for mini disks
<span style="color:gray">BIOSDATA:06BB </span>int6c_ret_addr  <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:06BF </span>bin_date_time   <span style="color:navy">db </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:06BF                                         </span>; century, year, month,   day
<span style="color:gray">BIOSDATA:06C3 </span>month_table     <span style="color:navy">dw </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">31</span><span style="color:navy">, </span><span style="color:#008040">59</span><span style="color:navy">, </span><span style="color:#008040">90</span><span style="color:navy">, </span><span style="color:#008040">120</span><span style="color:navy">, </span><span style="color:#008040">151</span><span style="color:navy">, </span><span style="color:#008040">181</span><span style="color:navy">, </span><span style="color:#008040">212</span><span style="color:navy">, </span><span style="color:#008040">243</span><span style="color:navy">, </span><span style="color:#008040">273</span><span style="color:navy">, </span><span style="color:#008040">304</span><span style="color:navy">, </span><span style="color:#008040">334 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:06DB </span>daycnt2         <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:06DD </span>feb29           <span style="color:navy">db </span><span style="color:#008040">0                    </span>; february 29 in a leap   year flag
<span style="color:gray">BIOSDATA:06DE </span>cdev            <span style="color:navy">dw offset </span>chardev_entry <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:06E0 </span>cdev_2          <span style="color:navy">dw </span><span style="color:#008040">2CCh                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:06E0                                         </span>; BIOSCODE segment
<span style="color:gray">BIOSDATA:06E2 </span>ttticks         <span style="color:navy">dd </span><span style="color:#008040">2CC0396h             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:06E6 </span>bcode_i2f       <span style="color:navy">dd </span><span style="color:#008040">2CC1302h             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:06EA </span>i13x            <span style="color:navy">dd </span><span style="color:#008040">2CC154Bh             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:06EE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:06EE
BIOSDATA:06EE </span>cbreak<span style="color:navy">:                                 </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:06EE                 </span><span style="color:navy">mov     cs:</span>altah<span style="color:navy">, </span><span style="color:#ff8000">3     </span>; indicate break key set
<span style="color:maroon">BIOSDATA:06F4
BIOSDATA:06F4 </span>intret<span style="color:navy">:                                 </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:06F4                 </span><span style="color:navy">iret
</span><span style="color:maroon">BIOSDATA:06F5 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:06F5
BIOSDATA:06F5 </span>strategy<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:06F5                 </span><span style="color:navy">mov     word ptr cs:</span>ptrsav<span style="color:navy">, bx </span>; store es:bx (device driver request packet)
<span style="color:maroon">BIOSDATA:06F5                                         </span>;      away at [ptrsav] for next driver function call
<span style="color:maroon">BIOSDATA:06FA                 </span><span style="color:navy">mov     word ptr cs:</span>ptrsav<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:maroon">BIOSDATA:06FF                 </span><span style="color:navy">retf
</span><span style="color:maroon">BIOSDATA:0700 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:0700
BIOSDATA:0700 </span>con_entry<span style="color:navy">:                              </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:0700                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:0703                 </span><span style="color:navy">in      al, </span><span style="color:green">0           </span>; 2C7h:0E4h = BIOSCODE:0E4h = 70h:2654h
<span style="color:maroon">BIOSDATA:0705
BIOSDATA:0705 </span>prn0_entry<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:0705                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:0708                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSDATA:0708 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">BIOSDATA:0709                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:070A                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">BIOSDATA:070C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:070C
BIOSDATA:070C </span>prn1_entry<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:070C                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:070F                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSDATA:070F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">BIOSDATA:0710                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0711                 </span><span style="color:navy">db </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">1
</span><span style="color:maroon">BIOSDATA:0713 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:0713
BIOSDATA:0713 </span>prn2_entry<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:0713                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:0716                 </span><span style="color:navy">sti                     </span>;  2C7h:0FBh = BIOSCODE:0FBh = 70h:266Bh
<span style="color:maroon">BIOSDATA:0717                 </span><span style="color:navy">add     [bx+di], al
</span><span style="color:maroon">BIOSDATA:0717 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">BIOSDATA:0719                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:maroon">BIOSDATA:071A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:071A
BIOSDATA:071A </span>prn3_entry<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:071A                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:071D                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSDATA:071D </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:071E                 </span><span style="color:navy">dw </span><span style="color:#008040">200h
</span><span style="color:olive">BIOSDATA:0720                 </span><span style="color:navy">db    </span><span style="color:#008040">3
</span><span style="color:maroon">BIOSDATA:0721 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:0721
BIOSDATA:0721 </span>aux0_entry<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:0721                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:0724                 </span><span style="color:navy">xor     [bx+di], al
</span><span style="color:maroon">BIOSDATA:0724 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:0726                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">BIOSDATA:0727 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:0727
BIOSDATA:0727 </span>aux1_entry<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:0727                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:072A                 </span><span style="color:navy">xor     [bx+di], al     </span>; 2C7h:130h = BIOSCODE:130h = 70h:26A0h
<span style="color:maroon">BIOSDATA:072A </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:072C                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:maroon">BIOSDATA:072D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:072D
BIOSDATA:072D </span>aux2_entry<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:072D                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:0730                 </span><span style="color:navy">xor     [bx+di], al
</span><span style="color:maroon">BIOSDATA:0730 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:0732                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:maroon">BIOSDATA:0733 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:0733
BIOSDATA:0733 </span>aux3_entry<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:0733                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:0736                 </span><span style="color:navy">xor     [bx+di], al
</span><span style="color:maroon">BIOSDATA:0736 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:0738                 </span><span style="color:navy">db </span><span style="color:#008040">3
</span><span style="color:maroon">BIOSDATA:0739 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:0739
BIOSDATA:0739 </span>tim_entry<span style="color:navy">:                              </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:0739                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:073C                 </span><span style="color:navy">inc     di              </span>; 2C7h:147h = BIOSCODE:147h = 70h:26B7h
<span style="color:maroon">BIOSDATA:073C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">BIOSDATA:073D                 </span><span style="color:navy">db    </span><span style="color:#008040">1
</span><span style="color:maroon">BIOSDATA:073E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:073E
BIOSDATA:073E </span>dsk_entry<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:073E                 </span><span style="color:navy">call    </span>cdev_entry
<span style="color:maroon">BIOSDATA:073E </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:0741                 </span><span style="color:navy">dw offset </span>DSKTBL        ; 2C7h:4A2h = BIOSCODE:4A2h = 70h:2A12h
<span style="color:black">BIOSDATA:0743
BIOSDATA:0743 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:0743
BIOSDATA:0743
BIOSDATA:0743 </span>cdev_entry      proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:0743                 </span><span style="color:navy">cmp     cs:</span>inHMA<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:0749                 </span><span style="color:navy">jz      short </span><span style="color:gray">ce_enter_codeseg
</span><span style="color:black">BIOSDATA:074B                 </span><span style="color:navy">push    ax              </span>; optimized for DOS in HMA
<span style="color:black">BIOSDATA:074C                 </span><span style="color:navy">mov     ax, cs:</span>DosDataSg
<span style="color:black">BIOSDATA:0750                 </span><span style="color:navy">cmp     word ptr cs:</span>ptrsav<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:black">BIOSDATA:0755                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:0756                 </span><span style="color:navy">jnz     short </span><span style="color:gray">not_from_dos </span>; jump is coded this way to fall thru
<span style="color:black">BIOSDATA:0756                                         </span>; in 99.99% of the cases
<span style="color:black">BIOSDATA:0758
BIOSDATA:0758 </span><span style="color:gray">ce_enter_codeseg</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:0758                 </span><span style="color:navy">jmp     dword ptr cs:</span>cdev
<span style="color:black">BIOSDATA:075D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:075D
BIOSDATA:075D </span><span style="color:gray">not_from_dos</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:075D                 </span><span style="color:navy">call    </span>EnsureA20On
<span style="color:black">BIOSDATA:0760                 </span><span style="color:navy">jmp     short </span><span style="color:gray">ce_enter_codeseg
</span><span style="color:black">BIOSDATA:0760 </span>cdev_entry      endp
<span style="color:black">BIOSDATA:0760
BIOSDATA:0762
BIOSDATA:0762 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:0762
BIOSDATA:0762
BIOSDATA:0762 </span>outchr          proc far                <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSDATA:0762                 </span><span style="color:navy">push    ax              </span>; int 29h handler
<span style="color:black">BIOSDATA:0763                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSDATA:0764                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSDATA:0765                 </span><span style="color:navy">push    bp
</span><span style="color:black">BIOSDATA:0766                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:0767                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0Eh
</span><span style="color:black">BIOSDATA:0769                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">7
</span><span style="color:black">BIOSDATA:076C                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - WRITE CHARACTER AND ADVANCE CURSOR (TTY WRITE)
<span style="color:black">BIOSDATA:076C                                         </span>; AL = character, BH = display page (alpha modes)
<span style="color:black">BIOSDATA:076C                                         </span>; BL = foreground color (graphics modes)
<span style="color:black">BIOSDATA:076E                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:076F                 </span><span style="color:navy">pop     bp
</span><span style="color:black">BIOSDATA:0770                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:0771                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSDATA:0772                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:0773                 </span><span style="color:navy">iret
</span><span style="color:black">BIOSDATA:0773 </span>outchr          endp
<span style="color:black">BIOSDATA:0773
BIOSDATA:0774
BIOSDATA:0774 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:0774
BIOSDATA:0774
BIOSDATA:0774 </span>block13         proc far                <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSDATA:0774                 </span><span style="color:navy">cmp     cs:</span>inHMA<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:077A                 </span><span style="color:navy">jz      short </span>skipa20
<span style="color:black">BIOSDATA:077C                 </span><span style="color:navy">call    </span>IsA20off        ; A20 Off?
<span style="color:black">BIOSDATA:077F                 </span><span style="color:navy">jnz     short </span>skipa20
<span style="color:black">BIOSDATA:0781                 </span><span style="color:navy">call    </span>EnableA20       ; assure a20 enabled
<span style="color:black">BIOSDATA:0784
BIOSDATA:0784 </span>skipa20<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:0784                 </span><span style="color:navy">mov     cs:</span>i13_ds<span style="color:navy">, ds   </span>; save caller&#039;s ds for call-through
<span style="color:black">BIOSDATA:0789                 </span><span style="color:navy">pushf                   </span>; fake interrupt
<span style="color:black">BIOSDATA:078A                 </span><span style="color:navy">call    cs:</span>i13x         ; call through Bios_Code entry table
<span style="color:black">BIOSDATA:078F                 </span><span style="color:navy">mov     ds, cs:</span>i13_ds
<span style="color:black">BIOSDATA:0794                 </span><span style="color:navy">retf    </span><span style="color:green">2
</span><span style="color:black">BIOSDATA:0794 </span>block13         endp
<span style="color:black">BIOSDATA:0794
BIOSDATA:0797
BIOSDATA:0797 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:0797
BIOSDATA:0797
BIOSDATA:0797 </span>call_orig13     proc far
<span style="color:black">BIOSDATA:0797                 </span><span style="color:navy">mov     ds, ds:</span>i13_ds   ; get caller&#039;s ds register
<span style="color:black">BIOSDATA:079B                 </span><span style="color:navy">pushf
</span><span style="color:black">BIOSDATA:079C                 </span><span style="color:navy">call    cs:</span>Orig13
<span style="color:black">BIOSDATA:07A1                 </span><span style="color:navy">mov     cs:</span>i13_ds<span style="color:navy">, ds
</span><span style="color:black">BIOSDATA:07A6                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:07A7                 </span><span style="color:navy">pop     ds              </span>; restore ds -&gt; Bios_Data before return
<span style="color:black">BIOSDATA:07A8                 </span><span style="color:navy">pushf
</span><span style="color:black">BIOSDATA:07A9                 </span><span style="color:navy">cmp     cs:</span>inHMA<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:07AF                 </span><span style="color:navy">jz      short </span><span style="color:gray">c_o13_1
</span><span style="color:black">BIOSDATA:07B1                 </span><span style="color:navy">call    </span>IsA20off
<span style="color:black">BIOSDATA:07B1 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:07B4                 </span><span style="color:navy">dw </span><span style="color:#008040">375h
</span><span style="color:gray">BIOSDATA:07B6                 </span><span style="color:navy">dw </span><span style="color:#008040">10E8h
</span><span style="color:olive">BIOSDATA:07B8                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:black">BIOSDATA:07B9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:07B9
BIOSDATA:07B9 </span><span style="color:gray">c_o13_1</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:07B9                 </span><span style="color:navy">popf
</span><span style="color:black">BIOSDATA:07BA                 </span><span style="color:navy">retf
</span><span style="color:black">BIOSDATA:07BA </span><span style="background:blue"><span style="color:navy">call_orig13     endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">BIOSDATA:07BA
BIOSDATA:07BA </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:07BB </span>HiMem           <span style="color:navy">dd </span><span style="color:#008040">0FFFF0090h           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:07BF </span>LoMem           <span style="color:navy">dd </span><span style="color:#008040">80h                  </span><span style="color:#8080ff">; ...
</span><span style="color:black">BIOSDATA:07C3
BIOSDATA:07C3 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:07C3
BIOSDATA:07C3
BIOSDATA:07C3 </span>EnsureA20On     proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:07C3                 </span><span style="color:navy">call    </span>IsA20off
<span style="color:black">BIOSDATA:07C6                 </span><span style="color:navy">jz      short </span>EnableA20
<span style="color:black">BIOSDATA:07C8                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:07C9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:07C9
BIOSDATA:07C9 </span>EnableA20<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:07C9                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:07CA                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:07CB                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">5           </span>; local enable A20
<span style="color:black">BIOSDATA:07CD                 </span><span style="color:navy">call    cs:</span>xms
<span style="color:black">BIOSDATA:07D2                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:07D3                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:07D4                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:07D4 </span>EnsureA20On     endp
<span style="color:black">BIOSDATA:07D4
BIOSDATA:07D5
BIOSDATA:07D5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:07D5
BIOSDATA:07D5
BIOSDATA:07D5 </span>IsA20off        proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:07D5                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:07D6                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:07D7                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSDATA:07D8                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSDATA:07D9                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSDATA:07DA                 </span><span style="color:navy">lds     si, cs:</span>HiMem
<span style="color:black">BIOSDATA:07DF                 </span><span style="color:navy">les     di, cs:</span>LoMem
<span style="color:black">BIOSDATA:07E4                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">8
</span><span style="color:black">BIOSDATA:07E7                 </span><span style="color:navy">repe cmpsw
</span><span style="color:black">BIOSDATA:07E9                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:07EA                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSDATA:07EB                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSDATA:07EC                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:07ED                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:07EE                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:07EE </span>IsA20off        endp
<span style="color:black">BIOSDATA:07EE
</span><span style="color:maroon">BIOSDATA:07EF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:07EF
BIOSDATA:07EF </span>DisableA20<span style="color:navy">:
</span><span style="color:maroon">BIOSDATA:07EF                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSDATA:07F0                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSDATA:07F1                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">6           </span>; local disable A20
<span style="color:maroon">BIOSDATA:07F3                 </span><span style="color:navy">call    cs:</span>xms          ; call far [cs:xms]
<span style="color:maroon">BIOSDATA:07F8                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSDATA:07F9                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSDATA:07FA                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSDATA:07FB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:07FB
BIOSDATA:07FB </span>int19<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:07FB                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:07FC                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:07FD                 </span><span style="color:navy">mov     es, ds:</span>zeroseg
<span style="color:maroon">BIOSDATA:0801                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:0801                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">5
</span><span style="color:maroon">BIOSDATA:0804                 </span><span style="color:navy">mov     si, offset </span>RomVectors
<span style="color:maroon">BIOSDATA:0807
BIOSDATA:0807 </span>_next_int<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:0807                 </span><span style="color:navy">lodsb                   </span>; get int number
<span style="color:maroon">BIOSDATA:0808                 </span><span style="color:navy">cbw                     </span>; assume &lt; 128
<span style="color:maroon">BIOSDATA:0809                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1
</span><span style="color:maroon">BIOSDATA:080B                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1           </span>; int * 4
<span style="color:maroon">BIOSDATA:080D                 </span><span style="color:navy">mov     di, ax
</span><span style="color:maroon">BIOSDATA:080F                 </span><span style="color:navy">lodsw                   </span>; install the saved vector
<span style="color:maroon">BIOSDATA:0810                 </span><span style="color:navy">stosw
</span><span style="color:maroon">BIOSDATA:0811                 </span><span style="color:navy">lodsw
</span><span style="color:maroon">BIOSDATA:0812                 </span><span style="color:navy">stosw
</span><span style="color:maroon">BIOSDATA:0813                 </span><span style="color:navy">loop    </span>_next_int
<span style="color:maroon">BIOSDATA:0815                 </span><span style="color:navy">cmp     ds:</span>int19sem<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSDATA:081A                 </span><span style="color:navy">jz      short </span>doint19
<span style="color:maroon">BIOSDATA:081C                 </span><span style="color:navy">mov     si, offset </span>i19_lst ; stacks code has changed these hardware interrupt vectors
<span style="color:maroon">BIOSDATA:081C                                         </span>; stkinit in sysinit1 will initialize int19oldxx values
<span style="color:maroon">BIOSDATA:081F                 </span><span style="color:navy">mov     cx, </span><span style="color:green">14
</span><span style="color:maroon">BIOSDATA:0822
BIOSDATA:0822 </span>i19_restore_loop<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:0822                 </span><span style="color:navy">lodsb                   </span>; get interrupt number
<span style="color:maroon">BIOSDATA:0823                 </span><span style="color:navy">cbw                     </span>; assume &lt; 128
<span style="color:maroon">BIOSDATA:0824                 </span><span style="color:navy">mov     di, ax
</span><span style="color:maroon">BIOSDATA:0826                 </span><span style="color:navy">lodsw                   </span>; get original vector offset
<span style="color:maroon">BIOSDATA:0827                 </span><span style="color:navy">mov     bx, ax          </span>; save it
<span style="color:maroon">BIOSDATA:0829                 </span><span style="color:navy">lodsw
</span><span style="color:maroon">BIOSDATA:082A                 </span><span style="color:navy">cmp     bx, </span><span style="color:green">0FFFFh      </span><span style="color:olive">; ...
</span><span style="color:maroon">BIOSDATA:082A                                         </span>; check for 0ffffh (unlikely segment)
<span style="color:maroon">BIOSDATA:082D                 </span><span style="color:navy">jz      short </span>i19_restor_1 ; opt no need to check selector too
<span style="color:maroon">BIOSDATA:082F                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">BIOSDATA:0832                 </span><span style="color:navy">jz      short </span>i19_restor_1
<span style="color:maroon">BIOSDATA:0834                 </span><span style="color:navy">add     di, di
</span><span style="color:maroon">BIOSDATA:0836                 </span><span style="color:navy">add     di, di
</span><span style="color:maroon">BIOSDATA:0838                 </span><span style="color:navy">xchg    ax, bx
</span><span style="color:maroon">BIOSDATA:0839                 </span><span style="color:navy">stosw
</span><span style="color:maroon">BIOSDATA:083A                 </span><span style="color:navy">xchg    ax, bx
</span><span style="color:maroon">BIOSDATA:083B                 </span><span style="color:navy">stosw
</span><span style="color:maroon">BIOSDATA:083C
BIOSDATA:083C </span>i19_restor_1<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:083C                 </span><span style="color:navy">loop    </span>i19_restore_loop
<span style="color:maroon">BIOSDATA:083E
BIOSDATA:083E </span>doint19<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:083E                 </span><span style="color:navy">cmp     ds:</span>inHMA<span style="color:navy">, </span><span style="color:#ff8000">0     </span>; Is dos running from HMA ?
<span style="color:maroon">BIOSDATA:0843                 </span><span style="color:navy">jz      short </span>SkipVDisk ; no
<span style="color:maroon">BIOSDATA:0845                 </span><span style="color:navy">call    </span>EraseVDiskHead  ; Then erase our VDISK header at 1MB boundary
<span style="color:maroon">BIOSDATA:0845                                         </span>; Some m/c&#039;s (AST 386 &amp; HP QS/16 do not clear
<span style="color:maroon">BIOSDATA:0845                                         </span>; the memory above 1MB during a warm boot.
<span style="color:maroon">BIOSDATA:0848
BIOSDATA:0848 </span>SkipVDisk<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:0848                 </span><span style="color:navy">int     </span><span style="color:green">19h             </span>; DISK BOOT
<span style="color:maroon">BIOSDATA:0848                                         </span>; causes reboot of disk system
<span style="color:maroon">BIOSDATA:084A
BIOSDATA:084A </span>Int15<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:084A                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">4F53h       </span>; del keystroke ? (4F00h+DELKEY)
<span style="color:maroon">BIOSDATA:084D                 </span><span style="color:navy">jz      short </span>int15_1
<span style="color:maroon">BIOSDATA:084F                 </span><span style="color:navy">jmp     cs:</span>Old15
<span style="color:maroon">BIOSDATA:0854 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:0854
BIOSDATA:0854 </span>int15_1<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:0854                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSDATA:0855                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSDATA:0856                 </span><span style="color:navy">mov     ax, </span><span style="color:green">40h         </span>; ROMBIOS data segment
<span style="color:maroon">BIOSDATA:0859                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">BIOSDATA:085B                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:085B                 </span><span style="color:navy">mov     al, ds:</span><span style="color:green">17h      </span>; [KBFLAG]
<span style="color:maroon">BIOSDATA:085E                 </span><span style="color:navy">and     al, </span><span style="color:green">0Ch         </span>; (CTRLSTATE | ALTSTATE)
<span style="color:maroon">BIOSDATA:0860                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ch         </span>; (CTRLSTATE | ALTSTATE)
<span style="color:maroon">BIOSDATA:0862                 </span><span style="color:navy">jnz     short </span>int15_2
<span style="color:maroon">BIOSDATA:0864                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:0865                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:0866                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:0866                 </span><span style="color:navy">cmp     ds:</span>inHMA<span style="color:navy">, </span><span style="color:#ff8000">0     </span>; is DOS running from HMA ?
<span style="color:maroon">BIOSDATA:086B                 </span><span style="color:navy">jz      short </span>int15_2   ; no
<span style="color:maroon">BIOSDATA:086D                 </span><span style="color:navy">call    </span>EraseVDiskHead
<span style="color:maroon">BIOSDATA:0870
BIOSDATA:0870 </span>int15_2<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:0870                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSDATA:0871                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:0872                 </span><span style="color:navy">stc
</span><span style="color:maroon">BIOSDATA:0873                 </span><span style="color:navy">jmp     cs:</span>Old15
<span style="color:black">BIOSDATA:0878
BIOSDATA:0878 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:0878
BIOSDATA:0878
BIOSDATA:0878 </span>EraseVDiskHead  proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:0878                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:0879                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSDATA:087A                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSDATA:087B                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:087C                 </span><span style="color:navy">call    </span>EnsureA20On
<span style="color:black">BIOSDATA:087F                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0FFFFh      </span>; HMA seg
<span style="color:black">BIOSDATA:0882                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">BIOSDATA:0884                 </span>assume es:nothing
<span style="color:black">BIOSDATA:0884                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">10h         </span>; point to VDISK header
<span style="color:black">BIOSDATA:0887                 </span><span style="color:navy">mov     cx, </span><span style="color:green">16          </span>; size of vdisk header
<span style="color:black">BIOSDATA:088A                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">BIOSDATA:088C                 </span><span style="color:navy">rep stosw               </span>; clear it
<span style="color:black">BIOSDATA:088E                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:088F                 </span>assume es:nothing
<span style="color:black">BIOSDATA:088F                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:0890                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSDATA:0891                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:0892                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:0892 </span>EraseVDiskHead  endp
<span style="color:black">BIOSDATA:0892
</span><span style="color:maroon">BIOSDATA:0893 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:0893
BIOSDATA:0893 </span>int_2f<span style="color:navy">:                                 </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:0893                 </span><span style="color:navy">jmp     cs:</span>bcode_i2f
<span style="color:maroon">BIOSDATA:0898 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:0898                 </span><span style="color:navy">jmp     </span>dsk_entry
<span style="color:maroon">BIOSDATA:089B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:089B
BIOSDATA:089B </span>re_init<span style="color:navy">:
</span><span style="color:maroon">BIOSDATA:089B                 </span><span style="color:navy">retf
</span><span style="color:maroon">BIOSDATA:089B </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:089C </span>Win386_SI       <span style="color:navy">db </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:089E </span>SI_Next         <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08A2                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:08A6                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:08AA                 </span><span style="color:navy">dw offset </span>Instance_Table
<span style="color:gray">BIOSDATA:08AC                 </span><span style="color:navy">dw </span><span style="color:#008040">70h                  </span>; BIOSDATA segment
<span style="color:gray">BIOSDATA:08AE </span>Instance_Table  <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08B0                 </span><span style="color:navy">dw </span><span style="color:#008040">50h                  </span>; print screen status...
<span style="color:gray">BIOSDATA:08B2                 </span><span style="color:navy">dw </span><span style="color:#008040">2                    </span>; 2 bytes
<span style="color:gray">BIOSDATA:08B4                 </span><span style="color:navy">dw </span><span style="color:#008040">0Eh                  </span>; ROM Basic data
<span style="color:gray">BIOSDATA:08B6                 </span><span style="color:navy">dw </span><span style="color:#008040">50h
</span><span style="color:gray">BIOSDATA:08B8                 </span><span style="color:navy">dw </span><span style="color:#008040">14h
</span><span style="color:gray">BIOSDATA:08BA                 </span><span style="color:navy">dw offset </span>altah         ; a con device buffer
<span style="color:gray">BIOSDATA:08BC                 </span><span style="color:navy">dw </span><span style="color:#008040">70h                  </span>; BIOSDATA segment
<span style="color:gray">BIOSDATA:08BE                 </span><span style="color:navy">dw </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:08C0 </span>NextStack       <span style="color:navy">dw </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08C0                                         </span>; pointer to next stack to be used
<span style="color:gray">BIOSDATA:08C4                 </span><span style="color:navy">dw </span><span style="color:#008040">2                    </span>; 2 bytes
<span style="color:gray">BIOSDATA:08C6 </span>IT_StackLoc     <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08C6                                         </span>; location of hardware stacks
<span style="color:gray">BIOSDATA:08CA </span>IT_StackSize    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08CA                                         </span>; size of hardware stacks
<span style="color:gray">BIOSDATA:08CC                 </span><span style="color:navy">dd </span><span style="color:#008040">0                    </span>; terminate the instance table
<span style="color:gray">BIOSDATA:08D0 </span>IsWin386        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08D0                                         </span>; Flag to indicate whether
<span style="color:gray">BIOSDATA:08D0                                         </span>; Win386 is running or not
<span style="color:black">BIOSDATA:08D1
BIOSDATA:08D1 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:08D1
BIOSDATA:08D1
BIOSDATA:08D1 </span>V86_Crit_SetFocus proc far
<span style="color:black">BIOSDATA:08D1                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSDATA:08D2                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:08D3                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:08D4                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:08D5                 </span><span style="color:navy">xor     di, di
</span><span style="color:black">BIOSDATA:08D7                 </span><span style="color:navy">mov     es, di
</span><span style="color:black">BIOSDATA:08D9                 </span>assume es:nothing
<span style="color:black">BIOSDATA:08D9                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">15h
</span><span style="color:black">BIOSDATA:08DC                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">1684h
</span><span style="color:black">BIOSDATA:08DF                 </span><span style="color:navy">int     </span><span style="color:green">2Fh             </span>; - Multiplex - MS WINDOWS - GET DEVICE API ENTRY POINT
<span style="color:black">BIOSDATA:08DF                                         </span>; BX = virtual device (VxD) ID, ES:DI = 0000h:0000h
<span style="color:black">BIOSDATA:08DF                                         </span>; Return: ES:DI -&gt; VxD API entry point, or 0:0 if the VxD does not support an API
<span style="color:black">BIOSDATA:08E1                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">BIOSDATA:08E3                 </span><span style="color:navy">or      ax, di
</span><span style="color:black">BIOSDATA:08E5                 </span><span style="color:navy">jz      short </span><span style="color:gray">Skip
</span><span style="color:black">BIOSDATA:08E7                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:08E8                 </span><span style="color:navy">mov     ax, offset </span><span style="color:gray">Skip
</span><span style="color:black">BIOSDATA:08EB                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:08EC                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:08ED                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSDATA:08EE                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSDATA:08F1                 </span><span style="color:navy">retf
</span><span style="color:black">BIOSDATA:08F2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:08F2
BIOSDATA:08F2 </span><span style="color:gray">Skip</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:08F2                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:08F3                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:08F4                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:08F5                 </span>assume es:nothing
<span style="color:black">BIOSDATA:08F5                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:08F6                 </span><span style="color:navy">retf
</span><span style="color:black">BIOSDATA:08F6 </span><span style="background:blue"><span style="color:navy">V86_Crit_SetFocus endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">BIOSDATA:08F6
BIOSDATA:08F6 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:08F7 </span>FreeHMAPtr      <span style="color:navy">dw </span><span style="color:#008040">0FFFFh               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08F9 </span>MoveDOSIntoHMA  <span style="color:navy">dw offset </span>FTryToMovDOSHi <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08FB </span>MoveDOSIntoHMA_2 <span style="color:navy">dw </span><span style="color:#008040">473h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08FB                                         </span>; SYSINIT segment
<span style="color:gray">BIOSDATA:08FD </span>SysinitPresent  <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08FE </span>endfloppy       <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:08FF                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0900 </span>nul_vid         <span style="color:navy">db &#039;NO NAME    &#039;,0      </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:090C </span>tmp_vid         <span style="color:navy">db &#039;NO NAME    &#039;,0      </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0918 </span>harddrv         <span style="color:navy">db </span><span style="color:#008040">80h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0919 </span>bdss            <span style="color:navy">dw </span><span style="color:#008040">0FFFFh               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:0919                                         </span>; max_mini_dsk_num equ 23
<span style="color:gray">BIOSDATA:0919                                         </span>; BDS_STRUC (2+max_mini_dsk_num) dup (&lt;&gt;)
<span style="color:gray">BIOSDATA:0919                                         </span>; currently max. 25
<span style="color:gray">BIOSDATA:0919                                         </span>; (MSDOS 6 BDS structure size = 100 bytes)
<span style="color:gray">BIOSDATA:091B                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:091D                 </span><span style="color:navy">db </span><span style="color:#008040">80
</span><span style="color:gray">BIOSDATA:091E                 </span><span style="color:navy">db </span><span style="color:#008040">3
</span><span style="color:gray">BIOSDATA:091F                 </span><span style="color:navy">dw </span><span style="color:#008040">512
</span><span style="color:gray">BIOSDATA:0921                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:0922                 </span><span style="color:navy">dw </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:0924                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:0925                 </span><span style="color:navy">dw </span><span style="color:#008040">16
</span><span style="color:gray">BIOSDATA:0927                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0929                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h
</span><span style="color:gray">BIOSDATA:092A                 </span><span style="color:navy">dw </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:092C                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:092E                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0930                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0934                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0938                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0939                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:093B                 </span><span style="color:navy">db </span><span style="color:#008040">3
</span><span style="color:gray">BIOSDATA:093C                 </span><span style="color:navy">dw </span><span style="color:#008040">20h
</span><span style="color:gray">BIOSDATA:093E                 </span><span style="color:navy">dw </span><span style="color:#008040">40
</span><span style="color:gray">BIOSDATA:0940                 </span><span style="color:navy">db </span><span style="color:#008040">31 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:095F                 </span><span style="color:navy">db </span><span style="color:#008040">255
</span><span style="color:gray">BIOSDATA:0960                 </span><span style="color:navy">dw </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:0962                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0964 </span><span style="color:navy">aNoName_0       db &#039;NO NAME    &#039;,0
</span><span style="color:gray">BIOSDATA:0970                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0974 </span><span style="color:navy">aFat12_0        db &#039;FAT12   &#039;,0
</span><span style="color:gray">BIOSDATA:097D </span>bdss_1          <span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:097F                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:097F                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:097F                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:097F                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:09E1 </span>bdss_2          <span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:09E3                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:09E3                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:09E3                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:09E3                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0A45 </span>bdss_3          <span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0A47                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0A47                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0A47                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0A47                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0AA9 </span>bdss_4          <span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0AAB                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0AAB                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0AAB                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0AAB                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0B0D                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0B0F                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0B0F                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0B0F                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0B0F                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0B71                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0B73                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0B73                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0B73                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0B73                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0BD5                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0BD7                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0BD7                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0BD7                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0BD7                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0C39                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0C3B                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0C3B                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0C3B                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0C3B                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0C9D                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0C9F                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0C9F                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0C9F                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0C9F                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0D01                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0D03                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0D03                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0D03                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0D03                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0D65                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0D67                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0D67                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0D67                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0D67                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0DC9                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0DCB                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0DCB                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0DCB                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0DCB                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0E2D                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0E2F                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0E2F                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0E2F                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0E2F                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0E91                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0E93                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">) </span><span style="color:red">; ...
</span><span style="color:gray">BIOSDATA:0E93                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0E93                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0E93                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0EF5                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0EF7                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0EF7                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0EF7                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0EF7                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0F59                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0F5B                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0F5B                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0F5B                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0F5B                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:0FBD                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:0FBF                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0FBF                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:0FBF                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:0FBF                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:1021                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:1023                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:1023                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:1023                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:1023                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:1085                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:1087                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:1087                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:1087                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:1087                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:10E9                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:10EB                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:10EB                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:10EB                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:10EB                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:114D                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:114F                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:114F                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:114F                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:114F                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:11B1                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:11B3                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:11B3                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:11B3                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:11B3                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:1215                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:1217                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:1217                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:1217                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:1217                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:1279 </span>bdss_24         <span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">BIOSDATA:127B                 </span><span style="color:navy">db </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">50h</span><span style="color:navy">, </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">1</span><span style="color:navy">), </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">10h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:127B                 </span><span style="color:navy">db </span><span style="color:#008040">0F8h</span><span style="color:navy">, </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">10h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">3</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">28h</span><span style="color:navy">, </span><span style="color:#008040">20h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">0FFh
</span><span style="color:gray">BIOSDATA:127B                 </span><span style="color:navy">db </span><span style="color:#008040">1</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">4Fh</span><span style="color:navy">, </span><span style="color:#008040">20h</span><span style="color:navy">, </span><span style="color:#008040">4Eh</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">4Dh</span><span style="color:navy">, </span><span style="color:#008040">45h</span><span style="color:navy">, </span><span style="color:#008040">4 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:127B                 </span><span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">54h</span><span style="color:navy">, </span><span style="color:#008040">31h</span><span style="color:navy">, </span><span style="color:#008040">32h</span><span style="color:navy">, </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">), </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:12DD                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">BIOSDATA:12DE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:12DE
BIOSDATA:12DE </span>ibm_disk_io<span style="color:navy">:                            </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:12DE                 </span><span style="color:navy">cmp     dl, </span><span style="color:green">80h         </span>; main routine, fixes at rom bug
<span style="color:maroon">BIOSDATA:12DE                                         </span>; pass through floppy disk calls
<span style="color:maroon">BIOSDATA:12E1                 </span><span style="color:navy">jb      short </span>atd1
<span style="color:maroon">BIOSDATA:12E3                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">2
</span><span style="color:maroon">BIOSDATA:12E6                 </span><span style="color:navy">jz      short </span>atd2      ; intercept call 02h (read sectors)
<span style="color:maroon">BIOSDATA:12E8                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">0Ah         </span>; and call 0Ah (read long)
<span style="color:maroon">BIOSDATA:12EB                 </span><span style="color:navy">jz      short </span>atd2
<span style="color:maroon">BIOSDATA:12ED
BIOSDATA:12ED </span>atd1<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:12ED                 </span><span style="color:navy">jmp     cs:</span>Old13        ; use rom int 13h handler
<span style="color:maroon">BIOSDATA:12F2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:12F2
BIOSDATA:12F2 </span>atd2<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:12F2                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSDATA:12F3                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSDATA:12F4                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">BIOSDATA:12F5                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSDATA:12F6                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSDATA:12F7                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSDATA:12F8                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSDATA:12F9                 </span><span style="color:navy">mov     ax, </span><span style="color:green">40h         </span>; rombios data segment
<span style="color:maroon">BIOSDATA:12FC                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">BIOSDATA:12FE                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:12FE                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">74h</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; [disk_status1]
<span style="color:maroon">BIOSDATA:12FE                                         </span>; initially no error code
<span style="color:maroon">BIOSDATA:1303                 </span><span style="color:navy">and     dl, </span><span style="color:green">7Fh         </span>; mask to hard disk number
<span style="color:maroon">BIOSDATA:1306                 </span><span style="color:navy">cmp     dl, ds:</span><span style="color:green">75h      </span>; [hf_num] ; 40h:75h
<span style="color:maroon">BIOSDATA:130A                 </span><span style="color:navy">jb      short </span>atd3      ; disk number in ranger
<span style="color:maroon">BIOSDATA:130C                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">74h</span><span style="color:navy">, </span><span style="color:#ff8000">1 </span>; [disk_status1]
<span style="color:maroon">BIOSDATA:1311                 </span><span style="color:navy">jmp     short </span>atd4      ; disk number out of range error, return
<span style="color:maroon">BIOSDATA:1313 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1313
BIOSDATA:1313 </span>atd3<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1313                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSDATA:1314                 </span><span style="color:navy">mov     ax, es
</span><span style="color:maroon">BIOSDATA:1316                 </span><span style="color:navy">shr     bx, </span><span style="color:green">4           </span>; make es:bx to seg:000x form
<span style="color:maroon">BIOSDATA:1319                 </span><span style="color:navy">add     ax, bx
</span><span style="color:maroon">BIOSDATA:131B                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">BIOSDATA:131D                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSDATA:131E                 </span><span style="color:navy">and     bx, </span><span style="color:green">0Fh
</span><span style="color:maroon">BIOSDATA:1321                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:1322                 </span><span style="color:navy">call    </span>check_dma
<span style="color:maroon">BIOSDATA:1325                 </span><span style="color:navy">jb      short </span>atd4      ; abort if dma across segment boundary
<span style="color:maroon">BIOSDATA:1327                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSDATA:1328                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSDATA:1329                 </span><span style="color:navy">call    </span>setcmd          ; set up command block for disk op
<span style="color:maroon">BIOSDATA:132C                 </span><span style="color:navy">mov     dx, </span><span style="color:green">3F6h        </span>; hf_reg_port
<span style="color:maroon">BIOSDATA:132F                 </span><span style="color:navy">out     dx, al          </span>; AT only. Fixed disk register
<span style="color:maroon">BIOSDATA:1330                 </span><span style="color:navy">call    </span>docmd           ; carry out command
<span style="color:maroon">BIOSDATA:1333
BIOSDATA:1333 </span>atd4<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1333                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSDATA:1334                 </span><span style="color:navy">mov     ah, ds:</span><span style="color:green">74h      </span>; [disk_status1]
<span style="color:maroon">BIOSDATA:1338                 </span><span style="color:navy">or      ah, ah
</span><span style="color:maroon">BIOSDATA:133A                 </span><span style="color:navy">jz      short </span>atd5
<span style="color:maroon">BIOSDATA:133C                 </span><span style="color:navy">stc
</span><span style="color:maroon">BIOSDATA:133D
BIOSDATA:133D </span>atd5<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:133D                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:133E                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:133F                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:133F                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSDATA:1340                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSDATA:1341                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSDATA:1342                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSDATA:1343                 </span><span style="color:navy">retf    </span><span style="color:green">2
</span><span style="color:black">BIOSDATA:1346
BIOSDATA:1346 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:1346
BIOSDATA:1346
BIOSDATA:1346 </span>setcmd          proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1346                 </span><span style="color:navy">mov     byte ptr ds:aAux+</span><span style="color:green">4</span><span style="color:navy">, al </span>; [cmd_block+sec_cnt]
<span style="color:black">BIOSDATA:1349                 </span><span style="color:navy">mov     byte ptr ds:</span>prndev2<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">20h
</span><span style="color:black">BIOSDATA:134E                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">2           </span>; cmd_reg = 20h if function 02h (read)
<span style="color:black">BIOSDATA:1351                 </span><span style="color:navy">jz      short </span>setc1
<span style="color:black">BIOSDATA:1353                 </span><span style="color:navy">mov     byte ptr ds:</span>prndev2<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">22h </span>; [cmd_block+cmd_reg]
<span style="color:black">BIOSDATA:1353                                         </span>; cmd_reg = 22h if function 0Ah (read long)
<span style="color:black">BIOSDATA:1358
BIOSDATA:1358 </span>setc1<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1358                 </span><span style="color:navy">mov     al, cl
</span><span style="color:black">BIOSDATA:135A                 </span><span style="color:navy">and     al, </span><span style="color:green">3Fh         </span>; mask sector number
<span style="color:black">BIOSDATA:135C                 </span><span style="color:navy">mov     byte ptr ds:aAux+</span><span style="color:green">5</span><span style="color:navy">, al </span>; [cmd_block+sec_num]
<span style="color:black">BIOSDATA:135F                 </span><span style="color:navy">mov     byte ptr ds:aAux+</span><span style="color:green">6</span><span style="color:navy">, ch </span>; [cmd_block+cyl_low]
<span style="color:black">BIOSDATA:1363                 </span><span style="color:navy">mov     al, cl
</span><span style="color:black">BIOSDATA:1365                 </span><span style="color:navy">shr     al, </span><span style="color:green">6           </span>; get two high bits of cylinder number
<span style="color:black">BIOSDATA:1368                 </span><span style="color:navy">mov     byte ptr ds:aAux+</span><span style="color:green">7</span><span style="color:navy">, al </span>; [cmd_block+cyl_high]
<span style="color:black">BIOSDATA:136B                 </span><span style="color:navy">mov     ax, dx
</span><span style="color:black">BIOSDATA:136D                 </span><span style="color:navy">shl     al, </span><span style="color:green">4           </span>; drive number
<span style="color:black">BIOSDATA:1370                 </span><span style="color:navy">and     ah, </span><span style="color:green">0Fh
</span><span style="color:black">BIOSDATA:1373                 </span><span style="color:navy">or      al, ah          </span>; head number
<span style="color:black">BIOSDATA:1375                 </span><span style="color:navy">or      al, </span><span style="color:green">0A0h        </span>; set ecc and 512 bytes per sector
<span style="color:black">BIOSDATA:1377                 </span><span style="color:navy">mov     byte ptr ds:</span>prndev2<span style="color:navy">, al </span>; [cmd_block+drv_head]
<span style="color:black">BIOSDATA:137A                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:137B                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:137C                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:137D                 </span><span style="color:navy">call    </span>get_vec
<span style="color:black">BIOSDATA:1380                 </span><span style="color:navy">mov     ax, es:[bx+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; [es:bx+fdp_precomp]
<span style="color:black">BIOSDATA:1380                                         </span>; write pre-comp from disk parameters
<span style="color:black">BIOSDATA:1384                 </span><span style="color:navy">shr     ax, </span><span style="color:green">2
</span><span style="color:black">BIOSDATA:1387                 </span><span style="color:navy">mov     byte ptr ds:aAux+</span><span style="color:green">3</span><span style="color:navy">, al </span>; [cmd_block+pre_comp]
<span style="color:black">BIOSDATA:138A                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:#ff8000">8</span><span style="color:navy">]   </span>; [es:bx+fdp_control]
<span style="color:black">BIOSDATA:138A                                         </span>; control byte modifier
<span style="color:black">BIOSDATA:138E                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:138F                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:1390                 </span><span style="color:navy">mov     ah, ds:</span>step_drv ; [control_byte]
<span style="color:black">BIOSDATA:1394                 </span><span style="color:navy">and     ah, </span><span style="color:green">0C0h        </span>; keep disable retry bits
<span style="color:black">BIOSDATA:1397                 </span><span style="color:navy">or      ah, al
</span><span style="color:black">BIOSDATA:1399                 </span><span style="color:navy">mov     ds:</span>step_drv<span style="color:navy">, ah
</span><span style="color:black">BIOSDATA:139D                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:139D </span>setcmd          endp
<span style="color:black">BIOSDATA:139D
BIOSDATA:139E
BIOSDATA:139E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:139E
BIOSDATA:139E
BIOSDATA:139E </span>docmd           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:139E                 </span><span style="color:navy">mov     di, bx
</span><span style="color:black">BIOSDATA:13A0                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:13A1                 </span><span style="color:navy">call    </span>command
<span style="color:black">BIOSDATA:13A4                 </span><span style="color:navy">jnz     short </span><span style="color:gray">doc3
</span><span style="color:black">BIOSDATA:13A6
BIOSDATA:13A6 </span><span style="color:gray">doc1</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:13A6                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:13A7                 </span><span style="color:navy">call    </span>waitt           ; wait for controller to complete read
<span style="color:black">BIOSDATA:13AA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">doc3
</span><span style="color:black">BIOSDATA:13AC                 </span><span style="color:navy">mov     cx, </span><span style="color:green">256
</span><span style="color:black">BIOSDATA:13AF                 </span><span style="color:navy">mov     dx, </span><span style="color:green">1F0h        </span>; hf_port
<span style="color:black">BIOSDATA:13B2                 </span><span style="color:navy">cld
</span><span style="color:black">BIOSDATA:13B3                 </span><span style="color:navy">cli
</span><span style="color:black">BIOSDATA:13B4
BIOSDATA:13B4 </span><span style="color:gray">rsct_loop</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:13B4                 </span><span style="color:navy">insw                    </span>; read in sector
<span style="color:black">BIOSDATA:13B5                 </span><span style="color:navy">loop    </span><span style="color:gray">rsct_loop
</span><span style="color:black">BIOSDATA:13B7                 </span><span style="color:navy">sti
</span><span style="color:black">BIOSDATA:13B8                 </span><span style="color:navy">test    byte ptr ds:</span>prndev2<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">2 </span>; [cmd_block+cmd_reg]
<span style="color:black">BIOSDATA:13BD                 </span><span style="color:navy">jz      short </span><span style="color:gray">doc2
</span><span style="color:black">BIOSDATA:13BF                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:13C0                 </span><span style="color:navy">call    </span>wait_drq
<span style="color:black">BIOSDATA:13C3                 </span><span style="color:navy">jb      short </span><span style="color:gray">doc3
</span><span style="color:black">BIOSDATA:13C5                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">4           </span>; 4 bytes of ecc
<span style="color:black">BIOSDATA:13C8                 </span><span style="color:navy">mov     dx, </span><span style="color:green">1F0h
</span><span style="color:black">BIOSDATA:13CB                 </span><span style="color:navy">cli
</span><span style="color:black">BIOSDATA:13CC                 </span><span style="color:navy">rep insb                </span>; read in ecc
<span style="color:black">BIOSDATA:13CE                 </span><span style="color:navy">sti
</span><span style="color:black">BIOSDATA:13CF
BIOSDATA:13CF </span><span style="color:gray">doc2</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:13CF                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:13D0                 </span><span style="color:navy">call    </span>check_status
<span style="color:black">BIOSDATA:13D3                 </span><span style="color:navy">jnz     short </span><span style="color:gray">doc3
</span><span style="color:black">BIOSDATA:13D5                 </span><span style="color:navy">dec     byte ptr ds:aAux+</span><span style="color:green">4 </span>; [cmd_block+sec_cnt]
<span style="color:black">BIOSDATA:13D9                 </span><span style="color:navy">jnz     short </span><span style="color:gray">doc1
</span><span style="color:black">BIOSDATA:13DB
BIOSDATA:13DB </span><span style="color:gray">doc3</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:13DB                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:13DB </span>docmd           endp
<span style="color:black">BIOSDATA:13DB
BIOSDATA:13DC
BIOSDATA:13DC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:13DC
BIOSDATA:13DC
BIOSDATA:13DC </span>get_vec         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:13DC                 </span><span style="color:navy">push    </span><span style="color:green">0FF65h          </span>; get pointer to hard disk parameters
<span style="color:black">BIOSDATA:13DF                 </span><span style="color:navy">jmp     far ptr </span><span style="background:blue"><span style="color:navy">0F000h:2F8Eh</span></span>
<span style="color:black">BIOSDATA:13DF </span>get_vec         endp
<span style="color:black">BIOSDATA:13DF
BIOSDATA:13E4
BIOSDATA:13E4 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:13E4
BIOSDATA:13E4
BIOSDATA:13E4 </span>command         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:13E4                 </span><span style="color:navy">push    </span><span style="color:green">0FF65h          </span>; send contents of cmd_block to disk controller
<span style="color:black">BIOSDATA:13E7                 </span><span style="color:navy">jmp     far ptr </span><span style="background:blue"><span style="color:navy">0F000h:2E1Eh</span></span>
<span style="color:black">BIOSDATA:13E7 </span>command         endp
<span style="color:black">BIOSDATA:13E7
BIOSDATA:13EC
BIOSDATA:13EC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:13EC
BIOSDATA:13EC
BIOSDATA:13EC </span>waitt           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:13EC                 </span><span style="color:navy">push    </span><span style="color:green">0FF65h          </span>; wait for disk interrupt
<span style="color:black">BIOSDATA:13EF                 </span><span style="color:navy">jmp     far ptr </span><span style="background:blue"><span style="color:navy">0F000h:2E7Fh</span></span>
<span style="color:black">BIOSDATA:13EF </span>waitt           endp
<span style="color:black">BIOSDATA:13EF
BIOSDATA:13F4
BIOSDATA:13F4 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:13F4
BIOSDATA:13F4
BIOSDATA:13F4 </span>wait_drq        proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:13F4                 </span><span style="color:navy">push    </span><span style="color:green">0FF65h          </span>; wait for data request
<span style="color:black">BIOSDATA:13F7                 </span><span style="color:navy">jmp     far ptr </span><span style="background:blue"><span style="color:navy">0F000h:2EE2h</span></span>
<span style="color:black">BIOSDATA:13F7 </span>wait_drq        endp
<span style="color:black">BIOSDATA:13F7
BIOSDATA:13FC
BIOSDATA:13FC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:13FC
BIOSDATA:13FC
BIOSDATA:13FC </span>check_status    proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:13FC                 </span><span style="color:navy">push    </span><span style="color:green">0FF65h          </span>; check hard disk status
<span style="color:black">BIOSDATA:13FF                 </span><span style="color:navy">jmp     far ptr </span><span style="background:blue"><span style="color:navy">0F000h:2EF8h</span></span>
<span style="color:black">BIOSDATA:13FF </span>check_status    endp
<span style="color:black">BIOSDATA:13FF
BIOSDATA:1404
BIOSDATA:1404 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:1404
BIOSDATA:1404
BIOSDATA:1404 </span>check_dma       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1404                 </span><span style="color:navy">push    </span><span style="color:green">0FF65h          </span>; check for dma overrun 64k segment
<span style="color:black">BIOSDATA:1407                 </span><span style="color:navy">jmp     far ptr </span><span style="background:blue"><span style="color:navy">0F000h:2F69h</span></span>
<span style="color:black">BIOSDATA:1407 </span>check_dma       endp
<span style="color:black">BIOSDATA:1407
</span><span style="color:maroon">BIOSDATA:140C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:140C
BIOSDATA:140C </span>endatrom<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:140C                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">15h
</span><span style="color:maroon">BIOSDATA:140F                 </span><span style="color:navy">ja      short </span>mebbe_hookit
<span style="color:maroon">BIOSDATA:1411
BIOSDATA:1411 </span>no_hookit<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1411                 </span><span style="color:navy">jmp     cs:</span>Old13
<span style="color:maroon">BIOSDATA:1416 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1416
BIOSDATA:1416 </span>mebbe_hookit<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1416                 </span><span style="color:navy">cmp     dl, </span><span style="color:green">80h
</span><span style="color:maroon">BIOSDATA:1419                 </span><span style="color:navy">jb      short </span>no_hookit
<span style="color:maroon">BIOSDATA:141B                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSDATA:141C                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSDATA:141D                 </span><span style="color:navy">mov     ax, </span><span style="color:green">40h
</span><span style="color:maroon">BIOSDATA:1420                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">BIOSDATA:1422                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:1422                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSDATA:1423                 </span><span style="color:navy">pushf
</span><span style="color:maroon">BIOSDATA:1424                 </span><span style="color:navy">call    cs:</span>Old13
<span style="color:maroon">BIOSDATA:1429                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:142A                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:142A                 </span><span style="color:navy">retf    </span><span style="color:green">2
</span><span style="color:maroon">BIOSDATA:142A </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:142D </span>end_compaq_i13hook <span style="color:navy">db </span><span style="color:#008040">0                 </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:142E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:142E
BIOSDATA:142E </span>daycnt_to_day<span style="color:navy">:                          </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:142E                 </span><span style="color:navy">push    cs:</span>daycnt       ; entry: [daycnt] = number of days since 1-1-80
<span style="color:maroon">BIOSDATA:142E                                         </span>; return: ch - century in bcd
<span style="color:maroon">BIOSDATA:142E                                         </span>;         cl - year in bcd
<span style="color:maroon">BIOSDATA:142E                                         </span>;         dh - month in bcd
<span style="color:maroon">BIOSDATA:142E                                         </span>;         dl - day in bcd
<span style="color:maroon">BIOSDATA:1433                 </span><span style="color:navy">cmp     cs:</span>daycnt<span style="color:navy">, </span><span style="color:green">7305 </span>; (365*20+(20/4))
<span style="color:maroon">BIOSDATA:1433                                         </span>; # days from 1-1-1980 to 1-1-2000
<span style="color:maroon">BIOSDATA:143A                 </span><span style="color:navy">jnb     short </span>century20
<span style="color:maroon">BIOSDATA:143C                 </span><span style="color:navy">mov     cs:</span>base_century<span style="color:navy">, </span><span style="color:green">19
</span><span style="color:maroon">BIOSDATA:1442                 </span><span style="color:navy">mov     cs:</span>base_year<span style="color:navy">, </span><span style="color:green">80
</span><span style="color:maroon">BIOSDATA:1448                 </span><span style="color:navy">jmp     short </span>years
<span style="color:maroon">BIOSDATA:144A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:144A
BIOSDATA:144A </span>century20<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:144A                 </span><span style="color:navy">mov     cs:</span>base_century<span style="color:navy">, </span><span style="color:green">20
</span><span style="color:maroon">BIOSDATA:1450                 </span><span style="color:navy">mov     cs:</span>base_year<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSDATA:1456                 </span><span style="color:navy">sub     cs:</span>daycnt<span style="color:navy">, </span><span style="color:green">7305 </span>; 365*20+(20/4))
<span style="color:maroon">BIOSDATA:1456                                         </span>; adjust daycnt
<span style="color:maroon">BIOSDATA:145D
BIOSDATA:145D </span>years<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:145D                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:maroon">BIOSDATA:145F                 </span><span style="color:navy">mov     ax, cs:</span>daycnt
<span style="color:maroon">BIOSDATA:1463                 </span><span style="color:navy">mov     bx, </span><span style="color:green">1461        </span>; 366+365*3)
<span style="color:maroon">BIOSDATA:1463                                         </span>; # of days in a Leap year block
<span style="color:maroon">BIOSDATA:1466                 </span><span style="color:navy">div     bx              </span>; ax = # of leap block, dx = daycnt
<span style="color:maroon">BIOSDATA:1468                 </span><span style="color:navy">mov     cs:</span>daycnt<span style="color:navy">, dx   </span>; save daycnt left
<span style="color:maroon">BIOSDATA:146D                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">4
</span><span style="color:maroon">BIOSDATA:146F                 </span><span style="color:navy">mul     bl
</span><span style="color:maroon">BIOSDATA:1471                 </span><span style="color:navy">add     cs:</span>base_year<span style="color:navy">, al </span>; ax = # of years. Less than 100
<span style="color:maroon">BIOSDATA:1476                 </span><span style="color:navy">inc     cs:</span>daycnt
<span style="color:maroon">BIOSDATA:147B                 </span><span style="color:navy">cmp     cs:</span>daycnt<span style="color:navy">, </span><span style="color:green">366  </span>; daycnt = remainder of leap year block
<span style="color:maroon">BIOSDATA:147B                                         </span>; within 366+355+355+355 days
<span style="color:maroon">BIOSDATA:1482                 </span><span style="color:navy">jbe     short </span>leapyear
<span style="color:maroon">BIOSDATA:1484                 </span><span style="color:navy">inc     cs:</span>base_year    ; if daycnt &lt;= 366, then leap year
<span style="color:maroon">BIOSDATA:1484                                         </span>; else daycnt -= 366, base_year++
<span style="color:maroon">BIOSDATA:1489                 </span><span style="color:navy">sub     cs:</span>daycnt<span style="color:navy">, </span><span style="color:green">366
</span><span style="color:maroon">BIOSDATA:1490                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">3           </span>; And next three years are normal
<span style="color:maroon">BIOSDATA:1493
BIOSDATA:1493 </span>regularyear<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1493                 </span><span style="color:navy">cmp     cs:</span>daycnt<span style="color:navy">, </span><span style="color:green">365  </span>; for(i=1; i&gt;3 or daycnt &lt;=365; i++)
<span style="color:maroon">BIOSDATA:149A                 </span><span style="color:navy">jbe     short </span>yeardone  ; {if (daycnt &gt; 365)
<span style="color:maroon">BIOSDATA:149C                 </span><span style="color:navy">inc     cs:</span>base_year    ; { daycnt -= 365
<span style="color:maroon">BIOSDATA:14A1                 </span><span style="color:navy">sub     cs:</span>daycnt<span style="color:navy">, </span><span style="color:green">365  </span>; }
<span style="color:maroon">BIOSDATA:14A8                 </span><span style="color:navy">loop    </span>regularyear     ; }
<span style="color:maroon">BIOSDATA:14A8                                         </span>; should never fall through loop
<span style="color:maroon">BIOSDATA:14AA
BIOSDATA:14AA </span>leapyear<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:14AA                 </span><span style="color:navy">mov     cs:</span>month_tab<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">29 </span>; leap year.
<span style="color:maroon">BIOSDATA:14AA                                         </span>; change month table.
<span style="color:maroon">BIOSDATA:14B0
BIOSDATA:14B0 </span>yeardone<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:14B0                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:maroon">BIOSDATA:14B2                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:maroon">BIOSDATA:14B4                 </span><span style="color:navy">mov     ax, cs:</span>daycnt
<span style="color:maroon">BIOSDATA:14B8                 </span><span style="color:navy">mov     si, offset </span>month_tab
<span style="color:maroon">BIOSDATA:14BB                 </span><span style="color:navy">mov     cx, </span><span style="color:green">12
</span><span style="color:maroon">BIOSDATA:14BE
BIOSDATA:14BE </span>months<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:14BE                 </span><span style="color:navy">inc     bl
</span><span style="color:maroon">BIOSDATA:14C0                 </span><span style="color:navy">mov     dl, [si]
</span><span style="color:maroon">BIOSDATA:14C2                 </span><span style="color:navy">cmp     ax, dx          </span>; cmp daycnt for each month till fit
<span style="color:maroon">BIOSDATA:14C2                                         </span>; dh=0
<span style="color:maroon">BIOSDATA:14C4                 </span><span style="color:navy">jbe     short </span>month_done
<span style="color:maroon">BIOSDATA:14C6                 </span><span style="color:navy">inc     si              </span>; next month
<span style="color:maroon">BIOSDATA:14C7                 </span><span style="color:navy">sub     ax, dx          </span>; adjust daycnt
<span style="color:maroon">BIOSDATA:14C9                 </span><span style="color:navy">loop    </span>months          ;
<span style="color:maroon">BIOSDATA:14C9                                         </span>; should never fall through loop
<span style="color:maroon">BIOSDATA:14CB
BIOSDATA:14CB </span>month_done<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:14CB                 </span><span style="color:navy">mov     cs:</span>month_tab<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">28 </span>; restore month table value
<span style="color:maroon">BIOSDATA:14D1                 </span><span style="color:navy">mov     dl, bl
</span><span style="color:maroon">BIOSDATA:14D3                 </span><span style="color:navy">mov     dh, cs:</span>base_year
<span style="color:maroon">BIOSDATA:14D8                 </span><span style="color:navy">mov     cl, cs:</span>base_century ; al=day,dl=month,dh=year,cl=cntry
<span style="color:maroon">BIOSDATA:14DD                 </span><span style="color:navy">call    cs:</span>bintobcd     ; call far [cs:bintobcd]
<span style="color:maroon">BIOSDATA:14DD                                         </span>; convert &quot;day&quot; to bcd
<span style="color:maroon">BIOSDATA:14DD                                         </span>; dl = bcd day, al = month
<span style="color:maroon">BIOSDATA:14E2                 </span><span style="color:navy">xchg    dl, al
</span><span style="color:maroon">BIOSDATA:14E4                 </span><span style="color:navy">call    cs:</span>bintobcd     ; dh = bcd month, al = year
<span style="color:maroon">BIOSDATA:14E9                 </span><span style="color:navy">xchg    dh, al
</span><span style="color:maroon">BIOSDATA:14EB                 </span><span style="color:navy">call    cs:</span>bintobcd     ; cl = bcd year, al = century
<span style="color:maroon">BIOSDATA:14F0                 </span><span style="color:navy">xchg    cl, al
</span><span style="color:maroon">BIOSDATA:14F2                 </span><span style="color:navy">call    cs:</span>bintobcd     ; ch = bcd century
<span style="color:maroon">BIOSDATA:14F7                 </span><span style="color:navy">mov     ch, al
</span><span style="color:maroon">BIOSDATA:14F9                 </span><span style="color:navy">pop     cs:</span>daycnt       ; restore original value
<span style="color:maroon">BIOSDATA:14FE                 </span><span style="color:navy">retf
</span><span style="color:maroon">BIOSDATA:14FF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:14FF
BIOSDATA:14FF </span>bin_to_bcd<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:14FF                 </span><span style="color:navy">push    cx              </span>; convert a binary input in al
<span style="color:maroon">BIOSDATA:14FF                                         </span>; (less than 63h or 99 decimal)
<span style="color:maroon">BIOSDATA:14FF                                         </span>; into a bcd value in al. ah destroyed
<span style="color:maroon">BIOSDATA:1500                 </span><span style="color:navy">aam                     </span>; AH = AL/10, AL = AL MOD 10
<span style="color:maroon">BIOSDATA:1502                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4
</span><span style="color:maroon">BIOSDATA:1504                 </span><span style="color:navy">shl     ah, cl
</span><span style="color:maroon">BIOSDATA:1506                 </span><span style="color:navy">or      al, ah          </span>; AL = (AH*10h)+AL
<span style="color:maroon">BIOSDATA:1508                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSDATA:1509                 </span><span style="color:navy">retf
</span><span style="color:maroon">BIOSDATA:150A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:150A
BIOSDATA:150A </span>int6c<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:150A                 </span><span style="color:navy">push    cs              </span>; The K09 requires the routines for reading the clock
<span style="color:maroon">BIOSDATA:150A                                         </span>; because of the suspend/resume facility.
<span style="color:maroon">BIOSDATA:150B                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:150C                 </span><span style="color:navy">pop     word ptr ds:</span>int6c_ret_addr
<span style="color:maroon">BIOSDATA:1510                 </span><span style="color:navy">pop     word ptr ds:</span>int6c_ret_addr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:maroon">BIOSDATA:1514                 </span><span style="color:navy">popf
</span><span style="color:maroon">BIOSDATA:1515                 </span><span style="color:navy">call    </span>read_real_date  ; get the date from the clock
<span style="color:maroon">BIOSDATA:1518                 </span><span style="color:navy">cli
</span><span style="color:maroon">BIOSDATA:1519                 </span><span style="color:navy">mov     ds:</span>daycnt<span style="color:navy">, si   </span>; update dos copy of date
<span style="color:maroon">BIOSDATA:151D                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSDATA:151E                 </span><span style="color:navy">call    </span>read_real_time  ; get the time from the   rtc
<span style="color:maroon">BIOSDATA:1521                 </span><span style="color:navy">cli
</span><span style="color:maroon">BIOSDATA:1522                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSDATA:1524                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - SET TIME OF DAY
<span style="color:maroon">BIOSDATA:1524                                         </span>; CX:DX = clock count
<span style="color:maroon">BIOSDATA:1524                                         </span>; Return: time of day set
<span style="color:maroon">BIOSDATA:1526                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSDATA:1527                 </span><span style="color:navy">jmp     ds:</span>int6c_ret_addr ; jmp far [int6c_ret_addr] ; long jump
<span style="color:black">BIOSDATA:152B
BIOSDATA:152B </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:152B
BIOSDATA:152B
BIOSDATA:152B </span>read_real_date  proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:152B                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:152C                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSDATA:152D                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:152E                 </span><span style="color:navy">xor     ah, ah          </span>; throw away clock roll over
<span style="color:black">BIOSDATA:1530                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - GET TIME OF DAY
<span style="color:black">BIOSDATA:1530                                         </span>; Return: CX:DX = clock count
<span style="color:black">BIOSDATA:1530                                         </span>; AL = 00h if clock was read or written (via AH=0,1) since the previous
<span style="color:black">BIOSDATA:1530                                         </span>; midnight
<span style="color:black">BIOSDATA:1530                                         </span>; Otherwise, AL &gt; 0
<span style="color:black">BIOSDATA:1532                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:1533                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSDATA:1534                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:1535                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:1536                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:1537                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSDATA:1538                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:1539                 </span><span style="color:navy">mov     cs:</span>daycnt2<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSDATA:1540                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">4
</span><span style="color:black">BIOSDATA:1542                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - READ DATE FROM REAL TIME CLOCK (AT,XT286,CONV,PS)
<span style="color:black">BIOSDATA:1542                                         </span>; Return: DL = day in BCD
<span style="color:black">BIOSDATA:1542                                         </span>; DH = month in BCD
<span style="color:black">BIOSDATA:1542                                         </span>; CL = year in BCD
<span style="color:black">BIOSDATA:1542                                         </span>; CH = century (19h or 20h)
<span style="color:black">BIOSDATA:1544                 </span><span style="color:navy">jnb     short </span>read_ok
<span style="color:black">BIOSDATA:1546                 </span><span style="color:navy">jmp     </span><span style="color:gray">r_d_ret
</span><span style="color:black">BIOSDATA:1549 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:1549
BIOSDATA:1549 </span>read_ok<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1549                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">, ch
</span><span style="color:black">BIOSDATA:154D                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, cl
</span><span style="color:black">BIOSDATA:1551                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, dh
</span><span style="color:black">BIOSDATA:1555                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">3</span><span style="color:navy">, dl
</span><span style="color:black">BIOSDATA:1559                 </span><span style="color:navy">mov     cs:</span>daycnt2<span style="color:navy">, </span><span style="color:#ff8000">2   </span>; READ OF R-T CLOCK SUCCESSFUL
<span style="color:black">BIOSDATA:1560                 </span><span style="color:navy">call    </span>bcd_verify      ; verify bcd values in range
<span style="color:black">BIOSDATA:1563                 </span><span style="color:navy">jb      short </span><span style="color:gray">r_d_ret   </span>; some value out of range
<span style="color:black">BIOSDATA:1565                 </span><span style="color:navy">mov     cs:</span>daycnt2<span style="color:navy">, </span><span style="color:#ff8000">3
</span><span style="color:black">BIOSDATA:156C                 </span><span style="color:navy">call    </span>date_verify
<span style="color:black">BIOSDATA:156F                 </span><span style="color:navy">jb      short </span><span style="color:gray">r_d_ret
</span><span style="color:black">BIOSDATA:1571                 </span><span style="color:navy">mov     cs:</span>daycnt2<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:1578                 </span><span style="color:navy">call    </span>in_bin
<span style="color:black">BIOSDATA:157B                 </span><span style="color:navy">mov     al, ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">1
</span><span style="color:black">BIOSDATA:157E                 </span><span style="color:navy">cbw
</span><span style="color:black">BIOSDATA:157F                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">, </span><span style="color:green">20 </span>; 20th century?
<span style="color:black">BIOSDATA:1584                 </span><span style="color:navy">jnz     short </span><span style="color:gray">century_19
</span><span style="color:black">BIOSDATA:1586                 </span><span style="color:navy">add     ax, </span><span style="color:green">100         </span>; add in a century
<span style="color:black">BIOSDATA:1589
BIOSDATA:1589 </span><span style="color:gray">century_19</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1589                 </span><span style="color:navy">sub     ax, </span><span style="color:green">80          </span>; subtract off 1-1-80
<span style="color:black">BIOSDATA:158C                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4           </span>; leap year every 4
<span style="color:black">BIOSDATA:158E                 </span><span style="color:navy">div     cl              </span>; al= # leap year blocks, ah= remainder
<span style="color:black">BIOSDATA:1590                 </span><span style="color:navy">mov     bl, ah          </span>; save odd years
<span style="color:black">BIOSDATA:1592                 </span><span style="color:navy">cbw                     </span>; zero ah
<span style="color:black">BIOSDATA:1593                 </span><span style="color:navy">mov     cx, </span><span style="color:green">1461        </span>; 366+(3*365)
<span style="color:black">BIOSDATA:1593                                         </span>; # of days in leap year blocks
<span style="color:black">BIOSDATA:1596                 </span><span style="color:navy">mul     cx
</span><span style="color:black">BIOSDATA:1598                 </span><span style="color:navy">mov     cs:</span>daycnt2<span style="color:navy">, ax  </span>; SAVE COUNT OF DAYS
<span style="color:black">BIOSDATA:159C                 </span><span style="color:navy">mov     al, bl          </span>; get odd years count
<span style="color:black">BIOSDATA:159E                 </span><span style="color:navy">cbw
</span><span style="color:black">BIOSDATA:159F                 </span><span style="color:navy">or      ax, ax
</span><span style="color:black">BIOSDATA:15A1                 </span><span style="color:navy">jz      short </span><span style="color:gray">leap_year
</span><span style="color:black">BIOSDATA:15A3                 </span><span style="color:navy">mov     cx, </span><span style="color:green">365         </span>; days in year
<span style="color:black">BIOSDATA:15A6                 </span><span style="color:navy">mul     cx
</span><span style="color:black">BIOSDATA:15A8                 </span><span style="color:navy">add     cs:</span>daycnt2<span style="color:navy">, ax  </span>; ADD ON DAYS IN ODD YEARS
<span style="color:black">BIOSDATA:15AD                 </span><span style="color:navy">jmp     short </span><span style="color:gray">leap_adjustment </span>; account for leap year
<span style="color:black">BIOSDATA:15AD                                         </span>; possibly account for a leap day
<span style="color:black">BIOSDATA:15AF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:15AF
BIOSDATA:15AF </span><span style="color:gray">leap_year</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:15AF                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, </span><span style="color:#ff8000">2 </span>; is month february?
<span style="color:black">BIOSDATA:15B4                 </span><span style="color:navy">jbe     short </span><span style="color:gray">no_leap_adjustment </span>; jan or feb. no leap day yet
<span style="color:black">BIOSDATA:15B6
BIOSDATA:15B6 </span><span style="color:gray">leap_adjustment</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:15B6                 </span><span style="color:navy">inc     cs:</span>daycnt2      ; account for leap day
<span style="color:black">BIOSDATA:15BB
BIOSDATA:15BB </span><span style="color:gray">no_leap_adjustment</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:15BB                 </span><span style="color:navy">mov     cl, ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">3 </span>; get days of month
<span style="color:black">BIOSDATA:15BF                 </span><span style="color:navy">xor     ch, ch
</span><span style="color:black">BIOSDATA:15C1                 </span><span style="color:navy">dec     cx              </span>; because of offset from day 1, not day 0
<span style="color:black">BIOSDATA:15C2                 </span><span style="color:navy">add     cs:</span>daycnt2<span style="color:navy">, cx  </span>; GET DAYS IN MONTHS PRECEEDING
<span style="color:black">BIOSDATA:15C7                 </span><span style="color:navy">mov     cl, ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">2 </span>; get month
<span style="color:black">BIOSDATA:15CB                 </span><span style="color:navy">xor     ch, ch
</span><span style="color:black">BIOSDATA:15CD                 </span><span style="color:navy">dec     cx              </span>; january starts at offset 0
<span style="color:black">BIOSDATA:15CE                 </span><span style="color:navy">shl     cx, </span><span style="color:green">1           </span>; word offset
<span style="color:black">BIOSDATA:15D0                 </span><span style="color:navy">mov     si, offset </span>month_table
<span style="color:black">BIOSDATA:15D3                 </span><span style="color:navy">add     si, cx
</span><span style="color:black">BIOSDATA:15D5                 </span><span style="color:navy">mov     ax, [si]
</span><span style="color:black">BIOSDATA:15D7                 </span><span style="color:navy">add     cs:</span>daycnt2<span style="color:navy">, ax
</span><span style="color:black">BIOSDATA:15DC
BIOSDATA:15DC </span><span style="color:gray">r_d_ret</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:15DC                 </span><span style="color:navy">mov     si, cs:</span>daycnt2
<span style="color:black">BIOSDATA:15E1                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:15E2                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSDATA:15E3                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:15E4                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:15E5                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:15E5 </span>read_real_date  endp
<span style="color:black">BIOSDATA:15E5
BIOSDATA:15E6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:15E6 </span><span style="color:gray">; START OF FUNCTION CHUNK FOR read_real_time
</span><span style="color:black">BIOSDATA:15E6
BIOSDATA:15E6 </span><span style="color:navy">loc_15E6:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:15E6                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">BIOSDATA:15E8                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:15EA                 </span><span style="color:navy">jmp     short </span>r_t_ret
<span style="color:black">BIOSDATA:15EA </span><span style="color:gray">; END OF FUNCTION CHUNK FOR read_real_time
</span><span style="color:black">BIOSDATA:15EC
BIOSDATA:15EC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:15EC
BIOSDATA:15EC
BIOSDATA:15EC </span>read_real_time  proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:15EC
BIOSDATA:15EC </span><span style="color:gray">; FUNCTION CHUNK AT BIOSDATA:15E6 SIZE 00000006 BYTES
</span><span style="color:black">BIOSDATA:15EC
BIOSDATA:15EC                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:black">BIOSDATA:15EE                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - READ REAL TIME CLOCK (AT,XT286,CONV,PS)
<span style="color:black">BIOSDATA:15EE                                         </span>; Return: CH = hours in BCD
<span style="color:black">BIOSDATA:15EE                                         </span>; CL = minutes in BCD
<span style="color:black">BIOSDATA:15EE                                         </span>; DH = seconds in BCD
<span style="color:black">BIOSDATA:15F0                 </span><span style="color:navy">jb      short loc_15E6
</span><span style="color:black">BIOSDATA:15F2
BIOSDATA:15F2 </span>oktime<span style="color:navy">:
</span><span style="color:black">BIOSDATA:15F2                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">, ch
</span><span style="color:black">BIOSDATA:15F6                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, cl
</span><span style="color:black">BIOSDATA:15FA                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, dh
</span><span style="color:black">BIOSDATA:15FE                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">3</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:1603                 </span><span style="color:navy">call    </span>bcd_verify
<span style="color:black">BIOSDATA:1606                 </span><span style="color:navy">jb      short loc_15E6
</span><span style="color:black">BIOSDATA:1608                 </span><span style="color:navy">call    </span>time_verify
<span style="color:black">BIOSDATA:160B                 </span><span style="color:navy">jb      short loc_15E6
</span><span style="color:black">BIOSDATA:160D                 </span><span style="color:navy">call    </span>in_bin
<span style="color:black">BIOSDATA:1610                 </span><span style="color:navy">mov     ch, ds:</span>bin_date_time
<span style="color:black">BIOSDATA:1614                 </span><span style="color:navy">mov     cl, ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">1
</span><span style="color:black">BIOSDATA:1618                 </span><span style="color:navy">mov     dh, ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:black">BIOSDATA:161C                 </span><span style="color:navy">mov     dl, ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">3
</span><span style="color:black">BIOSDATA:1620                 </span><span style="color:navy">call    ds:</span>ttticks      ; call far [ttticks]
<span style="color:black">BIOSDATA:1620                                         </span>; note: indirect far call
<span style="color:black">BIOSDATA:1620                                         </span>; cx:dx = number of ticks
<span style="color:black">BIOSDATA:1620                                         </span>; (at 18.2 ticks per sec.)
<span style="color:black">BIOSDATA:1624
BIOSDATA:1624 </span>r_t_ret<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1624                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:1624 </span>read_real_time  endp
<span style="color:black">BIOSDATA:1624
BIOSDATA:1625
BIOSDATA:1625 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:1625
BIOSDATA:1625
BIOSDATA:1625 </span>in_bin          proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1625                 </span><span style="color:navy">mov     al, ds:</span>bin_date_time ; century or hours
<span style="color:black">BIOSDATA:1628                 </span><span style="color:navy">call    </span>bcd_to_bin
<span style="color:black">BIOSDATA:162B                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">, al
</span><span style="color:black">BIOSDATA:162E                 </span><span style="color:navy">mov     al, ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">1 </span>; years or minutes
<span style="color:black">BIOSDATA:1631                 </span><span style="color:navy">call    </span>bcd_to_bin
<span style="color:black">BIOSDATA:1634                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, al
</span><span style="color:black">BIOSDATA:1637                 </span><span style="color:navy">mov     al, ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">2 </span>; months or seconds
<span style="color:black">BIOSDATA:163A                 </span><span style="color:navy">call    </span>bcd_to_bin
<span style="color:black">BIOSDATA:163D                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, al
</span><span style="color:black">BIOSDATA:1640                 </span><span style="color:navy">mov     al, ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">3 </span>; days (not used for time)
<span style="color:black">BIOSDATA:1643                 </span><span style="color:navy">call    </span>bcd_to_bin
<span style="color:black">BIOSDATA:1646                 </span><span style="color:navy">mov     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">3</span><span style="color:navy">, al
</span><span style="color:black">BIOSDATA:1649                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:1649 </span>in_bin          endp
<span style="color:black">BIOSDATA:1649
BIOSDATA:164A
BIOSDATA:164A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:164A
BIOSDATA:164A
BIOSDATA:164A </span>bcd_to_bin      proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:164A                 </span><span style="color:navy">mov     ah, al          </span>; bcd_to_bin converts two bcd nibbles in al
<span style="color:black">BIOSDATA:164A                                         </span>; (value &lt;= 99.) to a binary representation in al
<span style="color:black">BIOSDATA:164C                 </span><span style="color:navy">and     al, </span><span style="color:green">0Fh
</span><span style="color:black">BIOSDATA:164E                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4
</span><span style="color:black">BIOSDATA:1650                 </span><span style="color:navy">shr     ah, cl
</span><span style="color:black">BIOSDATA:1652                 </span><span style="color:navy">aad
</span><span style="color:black">BIOSDATA:1654                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:1654 </span>bcd_to_bin      endp
<span style="color:black">BIOSDATA:1654
BIOSDATA:1655
BIOSDATA:1655 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:1655
BIOSDATA:1655
BIOSDATA:1655 </span>date_verify     proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1655                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">, </span><span style="color:green">20h </span>; century check
<span style="color:black">BIOSDATA:165A                 </span><span style="color:navy">ja      short </span><span style="color:gray">date_error
</span><span style="color:black">BIOSDATA:165C                 </span><span style="color:navy">jz      short </span><span style="color:gray">century_20 </span>; jmp in 21th century
<span style="color:black">BIOSDATA:165E                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">, </span><span style="color:green">19h </span>; century check
<span style="color:black">BIOSDATA:1663                 </span><span style="color:navy">jb      short </span><span style="color:gray">date_error
</span><span style="color:black">BIOSDATA:1665                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">80h </span>; year check
<span style="color:black">BIOSDATA:166A                 </span><span style="color:navy">jb      short </span><span style="color:gray">date_error
</span><span style="color:black">BIOSDATA:166C
BIOSDATA:166C </span><span style="color:gray">century_20</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:166C                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">99h </span>; year check
<span style="color:black">BIOSDATA:1671                 </span><span style="color:navy">ja      short </span><span style="color:gray">date_error
</span><span style="color:black">BIOSDATA:1673                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, </span><span style="color:green">12h </span>; month check
<span style="color:black">BIOSDATA:1678                 </span><span style="color:navy">ja      short </span><span style="color:gray">date_error
</span><span style="color:black">BIOSDATA:167A                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:167F                 </span><span style="color:navy">jbe     short </span><span style="color:gray">date_error
</span><span style="color:black">BIOSDATA:1681                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">3</span><span style="color:navy">, </span><span style="color:green">31h </span>; day check
<span style="color:black">BIOSDATA:1686                 </span><span style="color:navy">ja      short </span><span style="color:gray">date_error
</span><span style="color:black">BIOSDATA:1688                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">3</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:168D                 </span><span style="color:navy">jbe     short </span><span style="color:gray">date_error
</span><span style="color:black">BIOSDATA:168F                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSDATA:1690                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:1691 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:1691
BIOSDATA:1691 </span><span style="color:gray">date_error</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1691                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSDATA:1692                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:1692 </span>date_verify     endp
<span style="color:black">BIOSDATA:1692
BIOSDATA:1693
BIOSDATA:1693 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:1693
BIOSDATA:1693
BIOSDATA:1693 </span>time_verify     proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1693                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">, </span><span style="color:green">24h </span>; hour check
<span style="color:black">BIOSDATA:1698                 </span><span style="color:navy">ja      short </span><span style="color:gray">time_error
</span><span style="color:black">BIOSDATA:169A                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">59h </span>; minute check
<span style="color:black">BIOSDATA:169F                 </span><span style="color:navy">ja      short </span><span style="color:gray">time_error
</span><span style="color:black">BIOSDATA:16A1                 </span><span style="color:navy">cmp     ds:</span>bin_date_time<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, </span><span style="color:green">59h </span>; second check
<span style="color:black">BIOSDATA:16A6                 </span><span style="color:navy">ja      short </span><span style="color:gray">time_error
</span><span style="color:black">BIOSDATA:16A8                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSDATA:16A9                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:16AA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:16AA
BIOSDATA:16AA </span><span style="color:gray">time_error</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:16AA                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSDATA:16AB                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:16AB </span>time_verify     endp
<span style="color:black">BIOSDATA:16AB
BIOSDATA:16AC
BIOSDATA:16AC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:16AC
BIOSDATA:16AC
BIOSDATA:16AC </span>bcd_verify      proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:16AC                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">4           </span>; 4 bytes to check
<span style="color:black">BIOSDATA:16AF                 </span><span style="color:navy">mov     bx, offset </span>bin_date_time
<span style="color:black">BIOSDATA:16B2
BIOSDATA:16B2 </span><span style="color:gray">bv_loop</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:16B2                 </span><span style="color:navy">mov     al, [bx]        </span>; get a bcd number (0..99)
<span style="color:black">BIOSDATA:16B4                 </span><span style="color:navy">mov     ah, al
</span><span style="color:black">BIOSDATA:16B6                 </span><span style="color:navy">and     ax, </span><span style="color:green">0F00Fh      </span>; 10&#039;s place in high ah, 1&#039;s in al
<span style="color:black">BIOSDATA:16B6                                         </span>; is 1&#039;s place in range?
<span style="color:black">BIOSDATA:16B9                 </span><span style="color:navy">cmp     al, </span><span style="color:green">10
</span><span style="color:black">BIOSDATA:16BB                 </span><span style="color:navy">ja      short </span><span style="color:gray">bv_error  </span>; jmp out of range
<span style="color:black">BIOSDATA:16BD                 </span><span style="color:navy">shr     ah, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:16BF                 </span><span style="color:navy">shr     ah, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:16C1                 </span><span style="color:navy">shr     ah, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:16C3                 </span><span style="color:navy">shr     ah, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:16C5                 </span><span style="color:navy">and     ah, </span><span style="color:green">0Fh         </span>; get rid of any erroneous bits
<span style="color:black">BIOSDATA:16C8                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">10          </span>; is 10&#039;s place in range
<span style="color:black">BIOSDATA:16CB                 </span><span style="color:navy">ja      short </span><span style="color:gray">bv_error  </span>; jmp out of range
<span style="color:black">BIOSDATA:16CD                 </span><span style="color:navy">inc     bx
</span><span style="color:black">BIOSDATA:16CE                 </span><span style="color:navy">dec     cx
</span><span style="color:black">BIOSDATA:16CF                 </span><span style="color:navy">jnz     short </span><span style="color:gray">bv_loop
</span><span style="color:black">BIOSDATA:16D1                 </span><span style="color:navy">clc                     </span>; set success flag
<span style="color:black">BIOSDATA:16D2                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:16D3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:16D3
BIOSDATA:16D3 </span><span style="color:gray">bv_error</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:16D3                 </span><span style="color:navy">stc                     </span>; set error flag
<span style="color:black">BIOSDATA:16D4                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:16D4 </span>bcd_verify      endp
<span style="color:black">BIOSDATA:16D4
BIOSDATA:16D4 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:16D5                 </span><span style="color:navy">db </span><span style="color:#008040">90h
</span><span style="color:gray">BIOSDATA:16D6 </span>drvfat          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16D8 </span>bios_l          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16DA </span>bios_h          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16DC </span>doscnt          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16DE </span>fbigfat         <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16DF </span>fatloc          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16E1 </span>init_bootseg    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16E3 </span>rom_drv_num     <span style="color:navy">db </span><span style="color:#008040">80h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16E4 </span>md_sectorsize   <span style="color:navy">dw </span><span style="color:#008040">512                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16E6 </span>temp_cluster    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16E8 </span>last_fat_secnum <span style="color:navy">dw </span><span style="color:#008040">65535                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16EA </span>num_heads       <span style="color:navy">db </span><span style="color:#008040">2                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16EB </span>sec_trk         <span style="color:navy">db </span><span style="color:#008040">9                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16EC </span>num_cyln        <span style="color:navy">db </span><span style="color:#008040">40                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16ED </span>fakefloppydrv   <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:16EE </span>disktable       <span style="color:navy">dw </span><span style="color:#008040">512</span><span style="color:navy">, </span><span style="color:#008040">256</span><span style="color:navy">, </span><span style="color:#008040">64</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2048</span><span style="color:navy">, </span><span style="color:#008040">513</span><span style="color:navy">, </span><span style="color:#008040">112</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">8192</span><span style="color:navy">, </span><span style="color:#008040">1026</span><span style="color:navy">, </span><span style="color:#008040">256 </span>;
<span style="color:gray">BIOSDATA:16EE                 </span><span style="color:navy">dw </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">32680</span><span style="color:navy">, </span><span style="color:#008040">2051</span><span style="color:navy">, </span><span style="color:#008040">512</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">65535</span><span style="color:navy">, </span><span style="color:#008040">4100</span><span style="color:navy">, </span><span style="color:#008040">1024</span><span style="color:navy">, </span><span style="color:#008040">0 </span>; warning !!! old values
<span style="color:gray">BIOSDATA:16EE                                         </span>; default disktable under
<span style="color:gray">BIOSDATA:16EE                                         </span>; the assumption of total fat size &lt;= 128 kb,
<span style="color:gray">BIOSDATA:16EE                                         </span>; and the maximum size of fat entry = 16 bit.
<span style="color:gray">BIOSDATA:1716 </span>disktable2      <span style="color:navy">dw </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">32680</span><span style="color:navy">, </span><span style="color:#008040">2051</span><span style="color:navy">, </span><span style="color:#008040">512</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">4</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">1026</span><span style="color:navy">, </span><span style="color:#008040">512</span><span style="color:navy">, </span><span style="color:#008040">64</span><span style="color:navy">, </span><span style="color:#008040">8</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">2051 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:1716                 </span><span style="color:navy">dw </span><span style="color:#008040">512</span><span style="color:navy">, </span><span style="color:#008040">64</span><span style="color:navy">, </span><span style="color:#008040">16</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">4100</span><span style="color:navy">, </span><span style="color:#008040">512</span><span style="color:navy">, </span><span style="color:#008040">64</span><span style="color:navy">, </span><span style="color:#008040">32</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">8197</span><span style="color:navy">, </span><span style="color:#008040">512</span><span style="color:navy">, </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">64</span><span style="color:navy">) </span>; fbig = 64 ; covers upto 134 mb media.
<span style="color:gray">BIOSDATA:1716                 </span><span style="color:navy">dw </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">16390</span><span style="color:navy">, </span><span style="color:#008040">512</span><span style="color:navy">, </span><span style="color:#008040">64</span><span style="color:navy">, </span><span style="color:#008040">128</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">32775</span><span style="color:navy">, </span><span style="color:#008040">512</span><span style="color:navy">, </span><span style="color:#008040">64 </span>; upto 268 mb
<span style="color:gray">BIOSDATA:1716                                         </span>; upto 536 mb
<span style="color:gray">BIOSDATA:1716                                         </span>; upto 1072 mb
<span style="color:gray">BIOSDATA:1716                                         </span>; upto 2144 mb
<span style="color:gray">BIOSDATA:1716                                         </span>; upto 4288 mb...
<span style="color:gray">BIOSDATA:175C </span>rom_minidisk_num <span style="color:navy">db </span><span style="color:#008040">0                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:175C                                         </span>; temp variable for phys unit
<span style="color:gray">BIOSDATA:175D </span>hnum            <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:175D                                         </span>; real number of hardfiles
<span style="color:gray">BIOSDATA:175E </span>last_dskdrv_table <span style="color:navy">dw offset </span>dskdrvs     <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:175E                                         </span>; index into dskdrv table
<span style="color:gray">BIOSDATA:1760 </span>end_of_bdss     <span style="color:navy">dw offset </span>bdss          <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:1760                                         </span>; offset value of the ending address of bds table.
<span style="color:gray">BIOSDATA:1760                                         </span>; needed to figure out the dosdatasg address.
<span style="color:gray">BIOSDATA:1762 </span>mini_hdlim      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:1764 </span>mini_seclim     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:1766 </span>bios_date       <span style="color:navy">db &#039;01/10/84&#039;,0         </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:1766                                         </span>; used for checking at rom bios   date.
<span style="color:gray">BIOSDATA:176F                 </span><span style="color:navy">db </span><span style="color:#008040">90h                  </span>; align 2
<span style="color:gray">BIOSDATA:1770 </span>bpb48t          <span style="color:navy">dw </span><span style="color:#008040">512                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:1770                                         </span>; 48 tpi diskettes ; physical sector size in bytes
<span style="color:gray">BIOSDATA:1772                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:1773                 </span><span style="color:navy">dw </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:1775                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:1776                 </span><span style="color:navy">dw </span><span style="color:#008040">112
</span><span style="color:gray">BIOSDATA:1778                 </span><span style="color:navy">dw </span><span style="color:#008040">720
</span><span style="color:gray">BIOSDATA:177A                 </span><span style="color:navy">db </span><span style="color:#008040">0FDh
</span><span style="color:gray">BIOSDATA:177B                 </span><span style="color:navy">dw </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:177D                 </span><span style="color:navy">dw </span><span style="color:#008040">9
</span><span style="color:gray">BIOSDATA:177F                 </span><span style="color:navy">dw </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:1781                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:1783                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:1785                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:1789                 </span><span style="color:navy">db </span><span style="color:#008040">90h
</span><span style="color:gray">BIOSDATA:178A </span>bpb96t          <span style="color:navy">dw </span><span style="color:#008040">512                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:178A                                         </span>; 96 tpi diskettes ; physical sector size in bytes
<span style="color:gray">BIOSDATA:178C                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:178D                 </span><span style="color:navy">dw </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:178F                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:1790                 </span><span style="color:navy">dw </span><span style="color:#008040">224
</span><span style="color:gray">BIOSDATA:1792                 </span><span style="color:navy">dw </span><span style="color:#008040">2400
</span><span style="color:gray">BIOSDATA:1794                 </span><span style="color:navy">db </span><span style="color:#008040">0F9h
</span><span style="color:gray">BIOSDATA:1795                 </span><span style="color:navy">dw </span><span style="color:#008040">7
</span><span style="color:gray">BIOSDATA:1797                 </span><span style="color:navy">dw </span><span style="color:#008040">15
</span><span style="color:gray">BIOSDATA:1799                 </span><span style="color:navy">dw </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:179B                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:179D                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:179F                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:17A0                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:17A1                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:17A2                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:17A3                 </span><span style="color:navy">db </span><span style="color:#008040">90h
</span><span style="color:gray">BIOSDATA:17A4 </span>bpb35           <span style="color:navy">dw </span><span style="color:#008040">512                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:17A4                                         </span>; 3.5&quot; diskettes ; physical sector size in bytes
<span style="color:gray">BIOSDATA:17A6                 </span><span style="color:navy">db </span><span style="color:#008040">2                    </span>; sectors/allocation unit
<span style="color:gray">BIOSDATA:17A7                 </span><span style="color:navy">dw </span><span style="color:#008040">1                    </span>; reserved sectors for dos
<span style="color:gray">BIOSDATA:17A9                 </span><span style="color:navy">db </span><span style="color:#008040">2                    </span>; number of allocation tables
<span style="color:gray">BIOSDATA:17AA                 </span><span style="color:navy">dw </span><span style="color:#008040">112                  </span>; number of directory entries
<span style="color:gray">BIOSDATA:17AC                 </span><span style="color:navy">dw </span><span style="color:#008040">1440                 </span>; number of sectors (at 512 bytes each)
<span style="color:gray">BIOSDATA:17AE                 </span><span style="color:navy">db </span><span style="color:#008040">0F9h                 </span>; media descriptor
<span style="color:gray">BIOSDATA:17AF                 </span><span style="color:navy">dw </span><span style="color:#008040">3                    </span>; number of fat sectors
<span style="color:gray">BIOSDATA:17B1                 </span><span style="color:navy">dw </span><span style="color:#008040">9                    </span>; sectors per track
<span style="color:gray">BIOSDATA:17B3                 </span><span style="color:navy">dw </span><span style="color:#008040">2                    </span>; heads
<span style="color:gray">BIOSDATA:17B5                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; hidden sector count (low word)
<span style="color:gray">BIOSDATA:17B7                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; hidden sector (high)
<span style="color:gray">BIOSDATA:17B9                 </span><span style="color:navy">dd </span><span style="color:#008040">0                    </span>; number of sectors
<span style="color:gray">BIOSDATA:17BD                 </span><span style="color:navy">db </span><span style="color:#008040">90h
</span><span style="color:gray">BIOSDATA:17BE </span>bpb288          <span style="color:navy">dw </span><span style="color:#008040">512                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:17BE                                         </span>; 3.5&quot; diskettes - 2.88 MB ; physical sector size in bytes
<span style="color:gray">BIOSDATA:17C0                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:17C1                 </span><span style="color:navy">dw </span><span style="color:#008040">1
</span><span style="color:gray">BIOSDATA:17C3                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:17C4                 </span><span style="color:navy">dw </span><span style="color:#008040">240
</span><span style="color:gray">BIOSDATA:17C6                 </span><span style="color:navy">dw </span><span style="color:#008040">5760
</span><span style="color:olive">BIOSDATA:17C8                 </span><span style="color:navy">db </span><span style="color:#008040">0F0h </span><span style="color:gray">; 
BIOSDATA:17C9                 </span><span style="color:navy">dw </span><span style="color:#008040">9
</span><span style="color:gray">BIOSDATA:17CB                 </span><span style="color:navy">dw </span><span style="color:#008040">36
</span><span style="color:gray">BIOSDATA:17CD                 </span><span style="color:navy">dw </span><span style="color:#008040">2
</span><span style="color:gray">BIOSDATA:17CF                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:17D1                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:17D3                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">BIOSDATA:17D7                 </span><span style="color:navy">db </span><span style="color:#008040">90h
</span><span style="color:gray">BIOSDATA:17D8 </span>bpbtable        <span style="color:navy">dw offset </span>bpb48t        <span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:17D8                                         </span>; 48tpi drives
<span style="color:gray">BIOSDATA:17DA                 </span><span style="color:navy">dw offset </span>bpb96t        ; 96tpi drives
<span style="color:gray">BIOSDATA:17DC                 </span><span style="color:navy">dw offset </span>bpb35         ; 3.5&quot; drives
<span style="color:gray">BIOSDATA:17DE                 </span><span style="color:navy">dw offset </span>bpb35         ; unused 8&quot; diskette
<span style="color:gray">BIOSDATA:17E0                 </span><span style="color:navy">dw offset </span>bpb35         ; unused 8&quot; diskette
<span style="color:gray">BIOSDATA:17E2                 </span><span style="color:navy">dw offset </span>bpb35         ; used for hard disk
<span style="color:gray">BIOSDATA:17E4                 </span><span style="color:navy">dw offset </span>bpb35         ; used for tape drive
<span style="color:gray">BIOSDATA:17E6                 </span><span style="color:navy">dw offset </span>bpb35         ; FFOTHER
<span style="color:gray">BIOSDATA:17E8                 </span><span style="color:navy">dw offset </span>bpb35         ; ERIMO
<span style="color:gray">BIOSDATA:17EA                 </span><span style="color:navy">dw offset </span>bpb288        ; 2.88MB drive
<span style="color:gray">BIOSDATA:17EC </span>addr_of_bcretf  <span style="color:navy">dw offset </span>bc_retf       <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSDATA:17EE
BIOSDATA:17EE </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:17EE
BIOSDATA:17EE
BIOSDATA:17EE </span>call_bios_code  proc far                <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:17EE                 </span><span style="color:navy">push    cs:</span>addr_of_bcretf ; set up near return to far return
<span style="color:black">BIOSDATA:17F3                 </span><span style="color:navy">push    cs:</span>cdev_2       ; push Bios_Code segment
<span style="color:black">BIOSDATA:17F8                 </span><span style="color:navy">push    bp              </span>; save offset of utility function
<span style="color:black">BIOSDATA:17F9                 </span><span style="color:navy">retf                    </span>; far jump to (DOS)BIOS code
<span style="color:black">BIOSDATA:17F9 </span><span style="background:blue">call_bios_code  endp</span><span style="background:blue"> ; sp-analysis failed</span>
<span style="color:black">BIOSDATA:17F9
BIOSDATA:17F9 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:17FA </span>flp_drvs        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSDATA:17FB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:17FB
BIOSDATA:17FB </span>init<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:17FB                 </span><span style="color:navy">cli                     </span>; entry from boot sector. the register contents are:
<span style="color:maroon">BIOSDATA:17FB                                         </span>;
<span style="color:maroon">BIOSDATA:17FB                                         </span>; dl = int 13 drive number we booted from
<span style="color:maroon">BIOSDATA:17FB                                         </span>; ch = media byte
<span style="color:maroon">BIOSDATA:17FB                                         </span>; bx = first data sector on disk.
<span style="color:maroon">BIOSDATA:17FB                                         </span>; ax = first data sector (high)
<span style="color:maroon">BIOSDATA:17FB                                         </span>; di = sectors/fat for the boot media.
<span style="color:maroon">BIOSDATA:17FC                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSDATA:17FD                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:maroon">BIOSDATA:17FF                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">BIOSDATA:1801                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSDATA:1802                 </span><span style="color:navy">mov     cs:</span>bios_h<span style="color:navy">, ax
</span><span style="color:maroon">BIOSDATA:1806                 </span><span style="color:navy">mov     cs:</span>bios_l<span style="color:navy">, bx
</span><span style="color:maroon">BIOSDATA:180B                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:180C                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:180D                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:180D                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSDATA:180E                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSDATA:180F                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSDATA:1810                 </span><span style="color:navy">mov     ax, </span><span style="color:green">473h        </span>; SYSINIT segment
<span style="color:maroon">BIOSDATA:1813                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">BIOSDATA:1815                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:1815                 </span><span style="color:navy">mov     si, (offset </span>_$MenuHeader<span style="color:navy">+</span><span style="color:green">19h</span><span style="color:navy">)
</span><span style="color:maroon">BIOSDATA:1818
BIOSDATA:1818 </span>startmsg_nxt_chr<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1818                 </span><span style="color:navy">lodsb
</span><span style="color:maroon">BIOSDATA:1819                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">BIOSDATA:181B                 </span><span style="color:navy">jz      short </span>startmsg_ok
<span style="color:maroon">BIOSDATA:181D                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0Eh
</span><span style="color:maroon">BIOSDATA:181F                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">7
</span><span style="color:maroon">BIOSDATA:1822                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - WRITE CHARACTER AND ADVANCE CURSOR (TTY WRITE)
<span style="color:maroon">BIOSDATA:1822                                         </span>; AL = character, BH = display page (alpha modes)
<span style="color:maroon">BIOSDATA:1822                                         </span>; BL = foreground color (graphics modes)
<span style="color:maroon">BIOSDATA:1824                 </span><span style="color:navy">jmp     short </span>startmsg_nxt_chr
<span style="color:maroon">BIOSDATA:1826 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1826
BIOSDATA:1826 </span>startmsg_ok<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1826                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1827                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:1827                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">5
</span><span style="color:maroon">BIOSDATA:182A                 </span><span style="color:navy">mov     si, offset </span>RomVectors
<span style="color:maroon">BIOSDATA:182D
BIOSDATA:182D </span>next_int<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:182D                 </span><span style="color:navy">lods    byte ptr cs:[si]
</span><span style="color:maroon">BIOSDATA:182F                 </span><span style="color:navy">cbw
</span><span style="color:maroon">BIOSDATA:1830                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1
</span><span style="color:maroon">BIOSDATA:1832                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1
</span><span style="color:maroon">BIOSDATA:1834                 </span><span style="color:navy">mov     di, ax
</span><span style="color:maroon">BIOSDATA:1836                 </span><span style="color:navy">xchg    si, di
</span><span style="color:maroon">BIOSDATA:1838                 </span><span style="color:navy">lodsw
</span><span style="color:maroon">BIOSDATA:1839                 </span><span style="color:navy">stosw
</span><span style="color:maroon">BIOSDATA:183A                 </span><span style="color:navy">lodsw
</span><span style="color:maroon">BIOSDATA:183B                 </span><span style="color:navy">stosw
</span><span style="color:maroon">BIOSDATA:183C                 </span><span style="color:navy">xchg    si, di
</span><span style="color:maroon">BIOSDATA:183E                 </span><span style="color:navy">loop    </span>next_int
<span style="color:maroon">BIOSDATA:1840                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSDATA:1841                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSDATA:1842                 </span><span style="color:navy">mov     ax, word ptr cs:</span>Old13
<span style="color:maroon">BIOSDATA:1846                 </span><span style="color:navy">mov     word ptr cs:</span>Orig13<span style="color:navy">, ax
</span><span style="color:maroon">BIOSDATA:184A                 </span><span style="color:navy">mov     ax, word ptr cs:</span>Old13<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:maroon">BIOSDATA:184E                 </span><span style="color:navy">mov     word ptr cs:</span>Orig13<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:maroon">BIOSDATA:1852                 </span><span style="color:navy">mov     ds:word_4B+</span><span style="color:green">1</span><span style="color:navy">, offset </span>block13 ; Int 13h vector
<span style="color:maroon">BIOSDATA:1858                 </span><span style="color:navy">mov     ds:off_4D+</span><span style="color:green">1</span><span style="color:navy">, cs
</span><span style="color:maroon">BIOSDATA:185C                 </span><span style="color:navy">mov     word ptr ds:aPrn+</span><span style="color:green">3</span><span style="color:navy">, offset </span>Int15 ; Int 15h vector
<span style="color:maroon">BIOSDATA:1862                 </span><span style="color:navy">mov     word ptr ds:aPrn+</span><span style="color:green">5</span><span style="color:navy">, cs
</span><span style="color:maroon">BIOSDATA:1866                 </span><span style="color:navy">mov     word ptr ds:aClock+</span><span style="color:green">1</span><span style="color:navy">, offset </span>int19 ; Int 19h vector
<span style="color:maroon">BIOSDATA:186C                 </span><span style="color:navy">mov     word ptr ds:aClock+</span><span style="color:green">3</span><span style="color:navy">, cs
</span><span style="color:maroon">BIOSDATA:1870                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSDATA:1871                 </span><span style="color:navy">int     </span><span style="color:green">11h             </span>; EQUIPMENT DETERMINATION
<span style="color:maroon">BIOSDATA:1871                                         </span>; Return: AX = equipment flag bits
<span style="color:maroon">BIOSDATA:1873                 </span><span style="color:navy">test    ax, </span><span style="color:green">1           </span>; floppy drives present ?
<span style="color:maroon">BIOSDATA:1876                 </span><span style="color:navy">jnz     short </span>normalfloppydrv ; yes
<span style="color:maroon">BIOSDATA:1878                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSDATA:1879                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSDATA:187A                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSDATA:187B                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">BIOSDATA:187C                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSDATA:187D                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSDATA:187E                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">8
</span><span style="color:maroon">BIOSDATA:1880                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSDATA:1882                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - DISK - GET CURRENT DRIVE PARAMETERS (XT,AT,XT286,CONV,PS)
<span style="color:maroon">BIOSDATA:1882                                         </span>; DL = drive number
<span style="color:maroon">BIOSDATA:1882                                         </span>; Return: CF set on error, AH = status code, BL = drive type
<span style="color:maroon">BIOSDATA:1882                                         </span>; DL = number of consecutive drives
<span style="color:maroon">BIOSDATA:1882                                         </span>; DH = maximum value for head number, ES:DI -&gt; drive parameter
<span style="color:maroon">BIOSDATA:1884                 </span><span style="color:navy">jb      short </span>_gdskp_error
<span style="color:maroon">BIOSDATA:1886                 </span><span style="color:navy">mov     cs:</span>flp_drvs<span style="color:navy">, dl
</span><span style="color:maroon">BIOSDATA:188B
BIOSDATA:188B </span>_gdskp_error<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:188B                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:188C                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:188C                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSDATA:188D                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSDATA:188E                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSDATA:188F                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSDATA:1890                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSDATA:1891                 </span><span style="color:navy">jb      short </span>normalfloppydrv ; if error it is an old ROM BIOS
<span style="color:maroon">BIOSDATA:1891                                         </span>; so, lets assume that ROM BIOS lied
<span style="color:maroon">BIOSDATA:1893                 </span><span style="color:navy">cmp     cs:</span>flp_drvs<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSDATA:1899                 </span><span style="color:navy">jz      short </span>_set_fake_flpdrv
<span style="color:maroon">BIOSDATA:189B                 </span><span style="color:navy">mov     al, cs:</span>flp_drvs
<span style="color:maroon">BIOSDATA:189F                 </span><span style="color:navy">dec     al
</span><span style="color:maroon">BIOSDATA:18A1                 </span><span style="color:navy">jmp     short </span>got_num_flp_drvs
<span style="color:maroon">BIOSDATA:18A3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:18A3
BIOSDATA:18A3 </span>_set_fake_flpdrv<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:18A3                 </span><span style="color:navy">mov     cs:</span>fakefloppydrv<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; we don&#039;t have any floppy drives.
<span style="color:maroon">BIOSDATA:18A9                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSDATA:18AC                 </span><span style="color:navy">jmp     short </span>settwodrive ; well then set it for two drives!
<span style="color:maroon">BIOSDATA:18AE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:18AE
BIOSDATA:18AE </span>normalfloppydrv<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:18AE                 </span><span style="color:navy">rol     al, </span><span style="color:green">1           </span>; there exist floppy drives.
<span style="color:maroon">BIOSDATA:18AE                                         </span>; put bits 6 &amp; 7 into bits 0 &amp; 1
<span style="color:maroon">BIOSDATA:18B0                 </span><span style="color:navy">rol     al, </span><span style="color:green">1
</span><span style="color:maroon">BIOSDATA:18B2
BIOSDATA:18B2 </span>got_num_flp_drvs<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:18B2                 </span><span style="color:navy">and     ax, </span><span style="color:green">3           </span>; only look at bits 0 &amp; 1
<span style="color:maroon">BIOSDATA:18B5                 </span><span style="color:navy">jnz     short </span>notsingle ; zero means single drive system
<span style="color:maroon">BIOSDATA:18B7                 </span><span style="color:navy">inc     ax              </span>; pretend it&#039;s a two drive system
<span style="color:maroon">BIOSDATA:18B7                                         </span>; set this to two fakedrives
<span style="color:maroon">BIOSDATA:18B8
BIOSDATA:18B8 </span>settwodrive<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:18B8                 </span><span style="color:navy">inc     cs:</span>single
<span style="color:maroon">BIOSDATA:18BD
BIOSDATA:18BD </span>notsingle<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:18BD                 </span><span style="color:navy">inc     ax              </span>; ax has number of drives
<span style="color:maroon">BIOSDATA:18BE                 </span><span style="color:navy">mov     cl, al
</span><span style="color:maroon">BIOSDATA:18C0                 </span><span style="color:navy">test    dl, </span><span style="color:green">80h         </span>; determine whether we booted from floppy or hard disk..
<span style="color:maroon">BIOSDATA:18C3                 </span><span style="color:navy">jnz     short </span>gothrd    ; hard disk
<span style="color:maroon">BIOSDATA:18C5                 </span><span style="color:navy">xor     ax, ax          </span>; indicate boot from drive A
<span style="color:maroon">BIOSDATA:18C7
BIOSDATA:18C7 </span>gothrd<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:18C7                 </span><span style="color:navy">xor     dx, dx          </span>; ax = 0-based drive we booted from
<span style="color:maroon">BIOSDATA:18C7                                         </span>; bios_l, bios_h set.
<span style="color:maroon">BIOSDATA:18C7                                         </span>; cl = number of floppies including fake one
<span style="color:maroon">BIOSDATA:18C7                                         </span>; ch = media byte
<span style="color:maroon">BIOSDATA:18C9                 </span><span style="color:navy">cli
</span><span style="color:maroon">BIOSDATA:18CA                 </span><span style="color:navy">mov     ss, dx
</span><span style="color:maroon">BIOSDATA:18CC                 </span><span style="color:navy">mov     sp, </span><span style="color:green">700h
</span><span style="color:maroon">BIOSDATA:18CF                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSDATA:18D0                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSDATA:18D1                 </span><span style="color:navy">mov     ah, ch
</span><span style="color:maroon">BIOSDATA:18D3                 </span><span style="color:navy">push    ax              </span>; save boot drive number and media byte
<span style="color:maroon">BIOSDATA:18D4                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0C0h
</span><span style="color:maroon">BIOSDATA:18D6                 </span><span style="color:navy">int     </span><span style="color:green">15h             </span>; SYSTEM - GET CONFIGURATION (XT after 1/10/86,AT mdl 3x9,CONV,XT286,PS)
<span style="color:maroon">BIOSDATA:18D8                 </span><span style="color:navy">jb      short </span>no_rom_system_conf
<span style="color:maroon">BIOSDATA:18DA                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSDATA:18DD                 </span><span style="color:navy">jnz     short </span>no_rom_system_conf
<span style="color:maroon">BIOSDATA:18DF                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:#ff8000">2</span><span style="color:navy">]   </span>; [es:bx+ROMBIOS_DESC.bios_sd_modelbyte]
<span style="color:maroon">BIOSDATA:18E3                 </span><span style="color:navy">mov     cs:</span>model_byte<span style="color:navy">, al
</span><span style="color:maroon">BIOSDATA:18E7                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:#ff8000">3</span><span style="color:navy">]   </span>; [es:bx+ROMBIOS_DESC.bios_sd_scnd_modelbyte]
<span style="color:maroon">BIOSDATA:18EB                 </span><span style="color:navy">mov     cs:</span>secondary_model_byte<span style="color:navy">, al
</span><span style="color:maroon">BIOSDATA:18EF                 </span><span style="color:navy">jmp     short </span>turn_timer_on
<span style="color:maroon">BIOSDATA:18F1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:18F1
BIOSDATA:18F1 </span>no_rom_system_conf<span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:18F1                 </span><span style="color:navy">mov     si, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">BIOSDATA:18F4                 </span><span style="color:navy">mov     es, si
</span><span style="color:maroon">BIOSDATA:18F6                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:18F6                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">0Eh      </span>; get model byte (from 0FFFFh:0Eh)
<span style="color:maroon">BIOSDATA:18FA                 </span><span style="color:navy">mov     cs:</span>model_byte<span style="color:navy">, al
</span><span style="color:maroon">BIOSDATA:18FE
BIOSDATA:18FE </span>turn_timer_on<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:18FE                 </span><span style="color:navy">mov     al, </span><span style="color:green">20h         </span>; turn on the timer
<span style="color:maroon">BIOSDATA:1900                 </span><span style="color:navy">out     </span><span style="color:green">20h</span><span style="color:navy">, al         </span>; Interrupt controller, 8259A.
<span style="color:maroon">BIOSDATA:1902                 </span><span style="color:navy">cmp     cs:</span>model_byte<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; Olivetti m24 check
<span style="color:maroon">BIOSDATA:1908                 </span><span style="color:navy">jnz     short </span>not_olivetti_m24
<span style="color:maroon">BIOSDATA:190A                 </span><span style="color:navy">in      al, </span><span style="color:green">66h         </span>; inhibit the normal aux port initialization
<span style="color:maroon">BIOSDATA:190C                 </span><span style="color:navy">test    al, </span><span style="color:green">20h
</span><span style="color:maroon">BIOSDATA:190E                 </span><span style="color:navy">jz      short </span>not_olivetti_m24
<span style="color:maroon">BIOSDATA:1910                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0Fh         </span>; double check
<span style="color:maroon">BIOSDATA:1912                 </span><span style="color:navy">out     </span><span style="color:green">50h</span><span style="color:navy">, al
</span><span style="color:maroon">BIOSDATA:1914                 </span><span style="color:navy">in      al, </span><span style="color:green">50h
</span><span style="color:maroon">BIOSDATA:1916                 </span><span style="color:navy">test    al, </span><span style="color:green">1           </span>; this test was copied from olivetti
<span style="color:maroon">BIOSDATA:1918                 </span><span style="color:navy">jz      short </span>skip_aux_port_init ; take this branch if 8530 installed
<span style="color:maroon">BIOSDATA:191A
BIOSDATA:191A </span>not_olivetti_m24<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:191A                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3           </span>; init com4
<span style="color:maroon">BIOSDATA:191C                 </span><span style="color:navy">call    </span>aux_init
<span style="color:maroon">BIOSDATA:191F                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">2           </span>; init com3
<span style="color:maroon">BIOSDATA:1921                 </span><span style="color:navy">call    </span>aux_init
<span style="color:maroon">BIOSDATA:1924                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1           </span>; init com2
<span style="color:maroon">BIOSDATA:1926                 </span><span style="color:navy">call    </span>aux_init
<span style="color:maroon">BIOSDATA:1929                 </span><span style="color:navy">xor     al, al          </span>; init com1
<span style="color:maroon">BIOSDATA:192B                 </span><span style="color:navy">call    </span>aux_init
<span style="color:maroon">BIOSDATA:192E
BIOSDATA:192E </span>skip_aux_port_init<span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:192E                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">2           </span>; init lpt3
<span style="color:maroon">BIOSDATA:1930                 </span><span style="color:navy">call    </span>print_init
<span style="color:maroon">BIOSDATA:1933                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1           </span>; init lpt2
<span style="color:maroon">BIOSDATA:1935                 </span><span style="color:navy">call    </span>print_init
<span style="color:maroon">BIOSDATA:1938                 </span><span style="color:navy">xor     al, al          </span>; init lpt1
<span style="color:maroon">BIOSDATA:193A                 </span><span style="color:navy">call    </span>print_init
<span style="color:maroon">BIOSDATA:193D                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:maroon">BIOSDATA:193F                 </span><span style="color:navy">mov     ds, dx          </span>; to initialize print screen vector
<span style="color:maroon">BIOSDATA:1941                 </span><span style="color:navy">mov     es, dx
</span><span style="color:maroon">BIOSDATA:1943                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:1943                 </span><span style="color:navy">xor     ax, ax          </span>; 0
<span style="color:maroon">BIOSDATA:1945                 </span><span style="color:navy">mov     di, </span><span style="color:green">534h        </span>; INITSPOT
<span style="color:maroon">BIOSDATA:1948                 </span><span style="color:navy">stosw                   </span>; IBM wants 4 zeros here
<span style="color:maroon">BIOSDATA:1949                 </span><span style="color:navy">stosw
</span><span style="color:maroon">BIOSDATA:194A                 </span><span style="color:navy">mov     ax, cs          </span>; fetch segment
<span style="color:maroon">BIOSDATA:194C                 </span><span style="color:navy">mov     ds:</span>dskdev<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, offset </span>cbreak
<span style="color:maroon">BIOSDATA:1952                 </span><span style="color:navy">mov     ds:word_6D+</span><span style="color:green">1</span><span style="color:navy">, ax </span>; [BRKADR]
<span style="color:maroon">BIOSDATA:1955                 </span><span style="color:navy">mov     ds:word_A3+</span><span style="color:green">1</span><span style="color:navy">, offset </span>outchr ; [CHROUT*4]
<span style="color:maroon">BIOSDATA:195B                 </span><span style="color:navy">mov     ds:off_A5+</span><span style="color:green">1</span><span style="color:navy">, ax
</span><span style="color:maroon">BIOSDATA:195E                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">4
</span><span style="color:maroon">BIOSDATA:1961                 </span><span style="color:navy">mov     bx, offset </span>intret
<span style="color:maroon">BIOSDATA:1964                 </span><span style="color:navy">xchg    ax, bx
</span><span style="color:maroon">BIOSDATA:1965                 </span><span style="color:navy">stosw                   </span>; location 4
<span style="color:maroon">BIOSDATA:1966                 </span><span style="color:navy">xchg    ax, bx
</span><span style="color:maroon">BIOSDATA:1967                 </span><span style="color:navy">stosw                   </span>; cs:
<span style="color:maroon">BIOSDATA:1968                 </span><span style="color:navy">add     di, </span><span style="color:#ff8000">4
</span><span style="color:maroon">BIOSDATA:196B                 </span><span style="color:navy">xchg    ax, bx
</span><span style="color:maroon">BIOSDATA:196C                 </span><span style="color:navy">stosw                   </span>; location 12
<span style="color:maroon">BIOSDATA:196D                 </span><span style="color:navy">xchg    ax, bx
</span><span style="color:maroon">BIOSDATA:196E                 </span><span style="color:navy">stosw                   </span>; cs:
<span style="color:maroon">BIOSDATA:196F                 </span><span style="color:navy">xchg    ax, bx
</span><span style="color:maroon">BIOSDATA:1970                 </span><span style="color:navy">stosw                   </span>; location 16
<span style="color:maroon">BIOSDATA:1971                 </span><span style="color:navy">xchg    ax, bx
</span><span style="color:maroon">BIOSDATA:1972                 </span><span style="color:navy">stosw                   </span>; cs:
<span style="color:maroon">BIOSDATA:1973                 </span><span style="color:navy">mov     word ptr ds:</span>month_tab<span style="color:navy">+</span><span style="color:green">0Ah</span><span style="color:navy">, dx </span>; 0  ; Print screen status byte (not active)
<span style="color:maroon">BIOSDATA:1977                 </span><span style="color:navy">mov     word ptr ds:</span>bintobcd<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, dx </span>; 0 ; DOS single diskette mode flag, 0=A:, 1=B:
<span style="color:maroon">BIOSDATA:197B                 </span><span style="color:navy">mov     al, byte ptr ds:</span>start_sec_h<span style="color:navy">+</span><span style="color:green">1 </span>; [SEC9+DISK_PARMS.DISK_MOTOR_STRT]
<span style="color:maroon">BIOSDATA:197E                 </span><span style="color:navy">mov     cs:</span>motorstartup<span style="color:navy">, al
</span><span style="color:maroon">BIOSDATA:1982                 </span><span style="color:navy">cmp     cs:</span>model_byte<span style="color:navy">, </span><span style="color:green">0FDh </span>; is this an old rom?
<span style="color:maroon">BIOSDATA:1988                 </span><span style="color:navy">jb      short </span>no_diddle ; no
<span style="color:maroon">BIOSDATA:198A                 </span><span style="color:navy">mov     ds:</span>start_sec_h<span style="color:navy">, </span><span style="color:green">20Fh </span>; [SEC9+DISK_PARMS.DISK_HEAD_STTL], 0200h+NORMSETTLE
<span style="color:maroon">BIOSDATA:1990                 </span><span style="color:navy">mov     byte ptr ds:</span>vol_no_name<span style="color:navy">+</span><span style="color:green">5</span><span style="color:navy">, </span><span style="color:green">0DFh </span>; [SEC9+DISK_PARMS.DISK_SPECIFY_1]
<span style="color:maroon">BIOSDATA:1990                                         </span>; set 1st specify byte on pc-1 pc-2 pc-xt hal0
<span style="color:maroon">BIOSDATA:1995
BIOSDATA:1995 </span>no_diddle<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1995                 </span><span style="color:navy">int     </span><span style="color:green">12h             </span>; MEMORY SIZE -
<span style="color:maroon">BIOSDATA:1995                                         </span>; Return: AX = number of contiguous 1K blocks of memory
<span style="color:maroon">BIOSDATA:1997                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">6
</span><span style="color:maroon">BIOSDATA:1999                 </span><span style="color:navy">shl     ax, cl          </span>; convert memory size to 16-byte blocks (segment no.)
<span style="color:maroon">BIOSDATA:199B                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSDATA:199C                 </span><span style="color:navy">mov     cs:</span>drvfat<span style="color:navy">, cx
</span><span style="color:maroon">BIOSDATA:19A1                 </span><span style="color:navy">push    ax              </span>; save real top of memory
<span style="color:maroon">BIOSDATA:19A2                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSDATA:19A3                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSDATA:19A4                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:maroon">BIOSDATA:19A6                 </span><span style="color:navy">mov     ds, bx
</span><span style="color:maroon">BIOSDATA:19A8                 </span><span style="color:navy">mov     bx, ds:word_BC  </span>; [2Fh*4]
<span style="color:maroon">BIOSDATA:19AC                 </span><span style="color:navy">mov     ds, ds:off_BE
</span><span style="color:maroon">BIOSDATA:19B0                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:19B0                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">3</span><span style="color:navy">], </span><span style="color:#ff8000">5052h </span>; &#039;RPL&#039;
<span style="color:maroon">BIOSDATA:19B5                 </span><span style="color:navy">jnz     short </span>SkipRPL
<span style="color:maroon">BIOSDATA:19B7                 </span><span style="color:navy">cmp     byte ptr [bx+</span><span style="color:#ff8000">5</span><span style="color:navy">], </span><span style="color:#ff8000">4Ch </span><span style="color:gray">; &#039;L&#039;
</span><span style="color:maroon">BIOSDATA:19BB                 </span><span style="color:navy">jnz     short </span>SkipRPL
<span style="color:maroon">BIOSDATA:19BD                 </span><span style="color:navy">mov     dx, ax          </span>; get TOM into DX
<span style="color:maroon">BIOSDATA:19BF                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4A06h       </span>; (multMULT shl 8) + multMULTRPLTOM
<span style="color:maroon">BIOSDATA:19C2                 </span><span style="color:navy">int     </span><span style="color:green">2Fh             </span>; Get new TOM from any RPL
<span style="color:maroon">BIOSDATA:19C4                 </span><span style="color:navy">mov     ax, dx
</span><span style="color:maroon">BIOSDATA:19C6
BIOSDATA:19C6 </span>SkipRPL<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:19C6                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSDATA:19C7                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:19C8                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:19C8                 </span><span style="color:navy">sub     ax, </span><span style="color:green">40h         </span>; room for fatloc segment. (1 kb buffer)
<span style="color:maroon">BIOSDATA:19CB                 </span><span style="color:navy">mov     cs:</span>fatloc<span style="color:navy">, ax   </span>; location to read fat
<span style="color:maroon">BIOSDATA:19CF                 </span><span style="color:navy">sub     ax, </span><span style="color:green">40h
</span><span style="color:maroon">BIOSDATA:19D2                 </span><span style="color:navy">mov     cs:</span>init_bootseg<span style="color:navy">, ax
</span><span style="color:maroon">BIOSDATA:19D6                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSDATA:19D7                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">473h        </span>; SYSINIT segment
<span style="color:maroon">BIOSDATA:19DA                 </span><span style="color:navy">mov     ds, dx
</span><span style="color:maroon">BIOSDATA:19DC                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:19DC                 </span><span style="color:navy">mov     word ptr ds:</span>DEVICE_LIST<span style="color:navy">, offset </span>res_dev_list
<span style="color:maroon">BIOSDATA:19E2                 </span><span style="color:navy">mov     word ptr ds:</span>DEVICE_LIST<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, cs
</span><span style="color:maroon">BIOSDATA:19E6                 </span><span style="color:navy">mov     ds:</span>MEMORY_SIZE<span style="color:navy">, ax
</span><span style="color:maroon">BIOSDATA:19E9                 </span><span style="color:navy">inc     cl
</span><span style="color:maroon">BIOSDATA:19EB                 </span><span style="color:navy">mov     ds:</span>DEFAULT_DRIVE<span style="color:navy">, cl
</span><span style="color:maroon">BIOSDATA:19EF                 </span><span style="color:navy">mov     ds:</span>CURRENT_DOS_LOCATION<span style="color:navy">, </span><span style="color:#ff8000">0A0Ah </span>; DOSLOADSEG
<span style="color:maroon">BIOSDATA:19F5                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">473h        </span>; SYSINIT segment
<span style="color:maroon">BIOSDATA:19F8                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">BIOSDATA:19FA                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:19FA                 </span><span style="color:navy">xor     ax, ax          </span>; some old ibm hardware generates spurious int 0F&#039;s
<span style="color:maroon">BIOSDATA:19FA                                         </span>; due to bogus printer cards.
<span style="color:maroon">BIOSDATA:19FA                                         </span>; we initialize this value to point to an iret
<span style="color:maroon">BIOSDATA:19FA                                         </span>; only if
<span style="color:maroon">BIOSDATA:19FA                                         </span>;    1) the original segment points to
<span style="color:maroon">BIOSDATA:19FA                                         </span>;       storage inside valid ram.
<span style="color:maroon">BIOSDATA:19FA                                         </span>;    2) the original segment is 0F000:xxxx
<span style="color:maroon">BIOSDATA:19FC                 </span><span style="color:navy">mov     ds, ax          </span>; 0
<span style="color:maroon">BIOSDATA:19FE                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:19FE                 </span><span style="color:navy">mov     ax, ds:off_3D+</span><span style="color:green">1 </span>; segment for INT 0Fh
<span style="color:maroon">BIOSDATA:1A01                 </span><span style="color:navy">cmp     ax, es:</span>MEMORY_SIZE ; es:294h
<span style="color:maroon">BIOSDATA:1A01                                         </span>; (condition 1)
<span style="color:maroon">BIOSDATA:1A06                 </span><span style="color:navy">jbe     short </span>resetintf
<span style="color:maroon">BIOSDATA:1A08                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0F000h      </span>; (condition 2)
<span style="color:maroon">BIOSDATA:1A0B                 </span><span style="color:navy">jnz     short </span>keepintf
<span style="color:maroon">BIOSDATA:1A0D
BIOSDATA:1A0D </span>resetintf<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1A0D                 </span><span style="color:navy">mov     ds:off_3B+</span><span style="color:green">1</span><span style="color:navy">, offset </span>intret ; [0Fh*4]
<span style="color:maroon">BIOSDATA:1A13                 </span><span style="color:navy">mov     ds:off_3D+</span><span style="color:green">1</span><span style="color:navy">, cs
</span><span style="color:maroon">BIOSDATA:1A17
BIOSDATA:1A17 </span>keepintf<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1A17                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:maroon">BIOSDATA:1A19                 </span><span style="color:navy">mov     ds, cx
</span><span style="color:maroon">BIOSDATA:1A1B                 </span><span style="color:navy">mov     cl, ds:</span>fdrive4<span style="color:navy">+</span><span style="color:green">16h </span>; get keyboard flag
<span style="color:maroon">BIOSDATA:1A1F                 </span><span style="color:navy">test    cl, </span><span style="color:green">10h         </span>; extended keyboard ?
<span style="color:maroon">BIOSDATA:1A22                 </span><span style="color:navy">jz      short </span>org_key   ; no, original keyboard
<span style="color:maroon">BIOSDATA:1A22                                         </span>; change for extended keyboard functions
<span style="color:maroon">BIOSDATA:1A24                 </span><span style="color:navy">mov     cs:</span>keyrd_func<span style="color:navy">, </span><span style="color:#ff8000">10h
</span><span style="color:maroon">BIOSDATA:1A2A                 </span><span style="color:navy">mov     cs:</span>keysts_func<span style="color:navy">, </span><span style="color:#ff8000">11h
</span><span style="color:maroon">BIOSDATA:1A30
BIOSDATA:1A30 </span>org_key<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1A30                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:1A31                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1A32                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:1A33                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:1A34                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:1A34                 </span><span style="color:navy">call    </span>cmos_clock_read ; If cmos clock exists,
<span style="color:maroon">BIOSDATA:1A34                                         </span>; then set the system time according to that.
<span style="color:maroon">BIOSDATA:1A34                                         </span>; also, reset the cmos clock rate.
<span style="color:maroon">BIOSDATA:1A37                 </span><span style="color:navy">mov     word ptr ds:</span>BData_start<span style="color:navy">, offset </span>harddrv ; hdrv_pat
<span style="color:maroon">BIOSDATA:1A37                                         </span>; set up pointer to hdrive
<span style="color:maroon">BIOSDATA:1A3D                 </span><span style="color:navy">pop     ax              </span>; number of floppies and FAT ID
<span style="color:maroon">BIOSDATA:1A3E                 </span><span style="color:navy">xor     ah, ah          </span>; chuck fat id byte
<span style="color:maroon">BIOSDATA:1A40                 </span><span style="color:navy">mov     ds:</span>drvmax<span style="color:navy">, al   </span>; remember which drive is hard disk
<span style="color:maroon">BIOSDATA:1A43                 </span><span style="color:navy">mov     ds:</span>dsktnum<span style="color:navy">, al  </span>; and set initial number of drives
<span style="color:maroon">BIOSDATA:1A46                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1
</span><span style="color:maroon">BIOSDATA:1A48                 </span><span style="color:navy">add     ds:</span>last_dskdrv_table<span style="color:navy">, ax
</span><span style="color:maroon">BIOSDATA:1A4C                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSDATA:1A4D                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0F000h      </span>; point to ROM BIOS
<span style="color:maroon">BIOSDATA:1A50                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">BIOSDATA:1A52                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:1A52                 </span><span style="color:navy">cmp     word ptr ds:</span><span style="color:green">0FFEAh</span><span style="color:navy">, </span><span style="color:#ff8000">4F43h </span>; &#039;OC&#039; ; look for COMPAQ
<span style="color:maroon">BIOSDATA:1A58                 </span><span style="color:navy">jnz     short </span>skip_mode2
<span style="color:maroon">BIOSDATA:1A5A                 </span><span style="color:navy">cmp     word ptr ds:</span><span style="color:green">0FFECh</span><span style="color:navy">, </span><span style="color:#ff8000">504Dh </span>; &#039;PM&#039;
<span style="color:maroon">BIOSDATA:1A60                 </span><span style="color:navy">jnz     short </span>skip_mode2
<span style="color:maroon">BIOSDATA:1A62                 </span><span style="color:navy">cmp     word ptr ds:</span><span style="color:green">0FFEEh</span><span style="color:navy">, </span><span style="color:#ff8000">5141h </span>; &#039;QA&#039;
<span style="color:maroon">BIOSDATA:1A68                 </span><span style="color:navy">jnz     short </span>skip_mode2
<span style="color:maroon">BIOSDATA:1A6A                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0E400h
</span><span style="color:maroon">BIOSDATA:1A6D                 </span><span style="color:navy">int     </span><span style="color:green">15h             </span>; OS HOOK - DEVICE OPEN (AT,XT2,XT286,PS)
<span style="color:maroon">BIOSDATA:1A6D                                         </span>; BX = device ID, CX = process type
<span style="color:maroon">BIOSDATA:1A6D                                         </span>; Return: CF set on error, AH = status
<span style="color:maroon">BIOSDATA:1A6D                                         </span>; CF clear if successful, AH = 00h
<span style="color:maroon">BIOSDATA:1A6F                 </span><span style="color:navy">jb      short </span>skip_mode2
<span style="color:maroon">BIOSDATA:1A71                 </span><span style="color:navy">or      bx, </span><span style="color:green">40h         </span>; enable mode 2
<span style="color:maroon">BIOSDATA:1A71                                         </span>; (dual hard disk controllers on Compaq systems)
<span style="color:maroon">BIOSDATA:1A74                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0E480h
</span><span style="color:maroon">BIOSDATA:1A77                 </span><span style="color:navy">int     </span><span style="color:green">15h             </span>; OS HOOK - DEVICE OPEN (AT,XT2,XT286,PS)
<span style="color:maroon">BIOSDATA:1A77                                         </span>; BX = device ID, CX = process type
<span style="color:maroon">BIOSDATA:1A77                                         </span>; Return: CF set on error, AH = status
<span style="color:maroon">BIOSDATA:1A77                                         </span>; CF clear if successful, AH = 00h
<span style="color:maroon">BIOSDATA:1A79
BIOSDATA:1A79 </span>skip_mode2<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1A79                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1A7A                 </span>assume ds:nothing
<span style="color:maroon">BIOSDATA:1A7A                 </span><span style="color:navy">mov     dl, </span><span style="color:green">80h
</span><span style="color:maroon">BIOSDATA:1A7C                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">8
</span><span style="color:maroon">BIOSDATA:1A7E                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - DISK - GET CURRENT DRIVE PARAMETERS (XT,AT,XT286,CONV,PS)
<span style="color:maroon">BIOSDATA:1A7E                                         </span>; DL = drive number
<span style="color:maroon">BIOSDATA:1A7E                                         </span>; Return: CF set on error, AH = status code, BL = drive type
<span style="color:maroon">BIOSDATA:1A7E                                         </span>; DL = number of consecutive drives
<span style="color:maroon">BIOSDATA:1A7E                                         </span>; DH = maximum value for head number, ES:DI -&gt; drive parameter
<span style="color:maroon">BIOSDATA:1A80                 </span><span style="color:navy">jb      short </span>enddrv
<span style="color:maroon">BIOSDATA:1A82                 </span><span style="color:navy">mov     ds:</span>hnum<span style="color:navy">, dl
</span><span style="color:maroon">BIOSDATA:1A86
BIOSDATA:1A86 </span>enddrv<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1A86                 </span><span style="color:navy">xor     dl, dl          </span>; scan the list of drives to determine their type.
<span style="color:maroon">BIOSDATA:1A86                                         </span>; we have three flavors of diskette drives:
<span style="color:maroon">BIOSDATA:1A86                                         </span>;
<span style="color:maroon">BIOSDATA:1A86                                         </span>; 48tpi drives  we do nothing special for them
<span style="color:maroon">BIOSDATA:1A86                                         </span>; 96tpi drives  mark the fact that they have changeline support.
<span style="color:maroon">BIOSDATA:1A86                                         </span>; 3.5&quot;  drives  mark changeline support and small.
<span style="color:maroon">BIOSDATA:1A86                                         </span>;
<span style="color:maroon">BIOSDATA:1A86                                         </span>; the following code uses registers for certain values:
<span style="color:maroon">BIOSDATA:1A86                                         </span>;
<span style="color:maroon">BIOSDATA:1A86                                         </span>;    dl - physical drive
<span style="color:maroon">BIOSDATA:1A86                                         </span>;    ds:di - points to current bds
<span style="color:maroon">BIOSDATA:1A86                                         </span>;    cx - flag bits for bds
<span style="color:maroon">BIOSDATA:1A86                                         </span>;    dh - form factor for the drive
<span style="color:maroon">BIOSDATA:1A86                                         </span>;        (1 - 48tpi, 2 - 96tpi, 3 - 3.5&quot; medium)
<span style="color:maroon">BIOSDATA:1A88                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:1A89                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1A8A                 </span><span style="color:navy">mov     ds:</span>eot<span style="color:navy">, </span><span style="color:#ff8000">9
</span><span style="color:maroon">BIOSDATA:1A8F                 </span><span style="color:navy">mov     di, offset </span>start_bds
<span style="color:maroon">BIOSDATA:1A92                 </span><span style="color:navy">cmp     ds:</span>fakefloppydrv<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSDATA:1A97                 </span><span style="color:navy">jnz     short </span>loop_drive
<span style="color:maroon">BIOSDATA:1A99                 </span><span style="color:navy">mov     di, [di]        </span>; [di+BDS.link] ; di &lt;- first bds link
<span style="color:maroon">BIOSDATA:1A9B                 </span><span style="color:navy">mov     di, [di]        </span>; [di+BDS.link] ; di &lt;- second bds link
<span style="color:maroon">BIOSDATA:1A9D                 </span><span style="color:navy">mov     word ptr [di], </span><span style="color:green">0FFFFh </span>; -1 ; set end of link
<span style="color:maroon">BIOSDATA:1AA1                 </span><span style="color:navy">jmp     </span>dohard          ; allocate/initialise bds for harddrives
<span style="color:maroon">BIOSDATA:1AA4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1AA4
BIOSDATA:1AA4 </span>loop_drive<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1AA4                 </span><span style="color:navy">cmp     dl, ds:</span>drvmax
<span style="color:maroon">BIOSDATA:1AA8                 </span><span style="color:navy">jb      short </span>got_more
<span style="color:maroon">BIOSDATA:1AAA                 </span><span style="color:navy">jmp     </span>done_drives
<span style="color:maroon">BIOSDATA:1AAD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1AAD
BIOSDATA:1AAD </span>got_more<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1AAD                 </span><span style="color:navy">xor     cx, cx          </span>; zero all flags
<span style="color:maroon">BIOSDATA:1AAF                 </span><span style="color:navy">mov     di, [di]        </span>; mov di,[di+BDS.link] ; get next bds
<span style="color:maroon">BIOSDATA:1AB1                 </span><span style="color:navy">mov     dh, </span><span style="color:#ff8000">0           </span>; ff48tpi ; set form factor to 48 tpi
<span style="color:maroon">BIOSDATA:1AB3                 </span><span style="color:navy">mov     ds:</span>num_cyln<span style="color:navy">, </span><span style="color:green">40
</span><span style="color:maroon">BIOSDATA:1AB8                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSDATA:1AB9                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSDATA:1ABA                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">BIOSDATA:1ABB                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSDATA:1ABC                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSDATA:1ABD                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">8
</span><span style="color:maroon">BIOSDATA:1ABF                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - DISK - GET CURRENT DRIVE PARAMETERS (XT,AT,XT286,CONV,PS)
<span style="color:maroon">BIOSDATA:1ABF                                         </span>; DL = drive number
<span style="color:maroon">BIOSDATA:1ABF                                         </span>; Return: CF set on error, AH = status code, BL = drive type
<span style="color:maroon">BIOSDATA:1ABF                                         </span>; DL = number of consecutive drives
<span style="color:maroon">BIOSDATA:1ABF                                         </span>; DH = maximum value for head number, ES:DI -&gt; drive parameter
<span style="color:maroon">BIOSDATA:1AC1                 </span><span style="color:navy">jb      short </span>noparmsfromrom
<span style="color:maroon">BIOSDATA:1AC3                 </span><span style="color:navy">cmp     ch, </span><span style="color:#ff8000">0           </span>; if ch=0, then cl,dh=0 too.
<span style="color:maroon">BIOSDATA:1AC6                 </span><span style="color:navy">jnz     short </span>pfr_ok
<span style="color:maroon">BIOSDATA:1AC8                 </span><span style="color:navy">mov     ch, </span><span style="color:green">39          </span>; rom gave wrong info.
<span style="color:maroon">BIOSDATA:1ACA                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">9           </span>; let&#039;s default to 360k.
<span style="color:maroon">BIOSDATA:1ACC                 </span><span style="color:navy">mov     dh, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSDATA:1ACE
BIOSDATA:1ACE </span>pfr_ok<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1ACE                 </span><span style="color:navy">inc     dh              </span>; make number of heads 1-based
<span style="color:maroon">BIOSDATA:1AD0                 </span><span style="color:navy">inc     ch              </span>; make number of cylinders 1-based
<span style="color:maroon">BIOSDATA:1AD2                 </span><span style="color:navy">mov     ds:</span>num_heads<span style="color:navy">, dh </span>; save parms returned by rom
<span style="color:maroon">BIOSDATA:1AD6                 </span><span style="color:navy">and     cl, </span><span style="color:green">3Fh         </span>; extract sectors/track
<span style="color:maroon">BIOSDATA:1AD9                 </span><span style="color:navy">mov     ds:</span>sec_trk<span style="color:navy">, cl
</span><span style="color:maroon">BIOSDATA:1ADD                 </span><span style="color:navy">mov     ds:</span>num_cyln<span style="color:navy">, ch </span>; assume less than 256 cylinders!!
<span style="color:maroon">BIOSDATA:1AE1                 </span><span style="color:navy">cmp     cl, ds:</span>eot      ; make sure that eot contains the max number of sec/trk
<span style="color:maroon">BIOSDATA:1AE1                                         </span>;  in system of floppies
<span style="color:maroon">BIOSDATA:1AE5                 </span><span style="color:navy">jbe     short </span>eot_ok
<span style="color:maroon">BIOSDATA:1AE7                 </span><span style="color:navy">mov     ds:</span>eot<span style="color:navy">, cl
</span><span style="color:maroon">BIOSDATA:1AEB
BIOSDATA:1AEB </span>eot_ok<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1AEB                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:1AEC                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:1AEC                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSDATA:1AED                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSDATA:1AEE                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSDATA:1AEF                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1AF0                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">15h         </span>; set command to get dasd type
<span style="color:maroon">BIOSDATA:1AF2                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - DISK - GET TYPE (AT,XT2,XT286,CONV,PS)
<span style="color:maroon">BIOSDATA:1AF2                                         </span>; DL = drive ID
<span style="color:maroon">BIOSDATA:1AF2                                         </span>; Return: CF set on error, AH = disk type (3 = hard drive)
<span style="color:maroon">BIOSDATA:1AF2                                         </span>; CX:DX = number of sectors on the media
<span style="color:maroon">BIOSDATA:1AF4                 </span><span style="color:navy">jb      short </span>changeline_done
<span style="color:maroon">BIOSDATA:1AF6                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">2           </span>; check for presence of changeline
<span style="color:maroon">BIOSDATA:1AF9                 </span><span style="color:navy">jnz     short </span>changeline_done
<span style="color:maroon">BIOSDATA:1AFB                 </span><span style="color:navy">or      cl, </span><span style="color:green">2           </span>; fchangeline ; signal type
<span style="color:maroon">BIOSDATA:1AFE                 </span><span style="color:navy">mov     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">1   </span>; remember that we have 96tpi disks
<span style="color:maroon">BIOSDATA:1B03
BIOSDATA:1B03 </span>changeline_done<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1B03                 </span><span style="color:navy">cmp     ds:</span>num_cyln<span style="color:navy">, </span><span style="color:green">40 </span>; we have a &quot;strange&quot; medium
<span style="color:maroon">BIOSDATA:1B08                 </span><span style="color:navy">jnz     short </span>try_80
<span style="color:maroon">BIOSDATA:1B0A                 </span><span style="color:navy">cmp     ds:</span>sec_trk<span style="color:navy">, </span><span style="color:#ff8000">9
</span><span style="color:maroon">BIOSDATA:1B0F                 </span><span style="color:navy">jbe     short </span>nextdrive
<span style="color:maroon">BIOSDATA:1B11
BIOSDATA:1B11 </span>gotother<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1B11                 </span><span style="color:navy">mov     dh, </span><span style="color:#ff8000">7
</span><span style="color:maroon">BIOSDATA:1B13                 </span><span style="color:navy">jmp     short </span>nextdrive ;
<span style="color:maroon">BIOSDATA:1B13                                         </span>; 80 cylinders and 9 sectors/track =&gt; 720 kb device
<span style="color:maroon">BIOSDATA:1B13                                         </span>; 80 cylinders and 15 sec/trk =&gt; 96 tpi medium
<span style="color:maroon">BIOSDATA:1B15 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1B15
BIOSDATA:1B15 </span>try_80<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1B15                 </span><span style="color:navy">cmp     ds:</span>num_cyln<span style="color:navy">, </span><span style="color:green">80
</span><span style="color:maroon">BIOSDATA:1B1A                 </span><span style="color:navy">jnz     short </span>gotother
<span style="color:maroon">BIOSDATA:1B1C                 </span><span style="color:navy">mov     dh, </span><span style="color:#ff8000">9           </span>; ff288 ; assume 2.88 MB drive
<span style="color:maroon">BIOSDATA:1B1E                 </span><span style="color:navy">cmp     ds:</span>sec_trk<span style="color:navy">, </span><span style="color:green">36  </span>; is it ?
<span style="color:maroon">BIOSDATA:1B23                 </span><span style="color:navy">jz      short </span>nextdrive ; yes, go update
<span style="color:maroon">BIOSDATA:1B25                 </span><span style="color:navy">cmp     ds:</span>sec_trk<span style="color:navy">, </span><span style="color:green">15
</span><span style="color:maroon">BIOSDATA:1B2A                 </span><span style="color:navy">jz      short </span>got96
<span style="color:maroon">BIOSDATA:1B2C                 </span><span style="color:navy">cmp     ds:</span>sec_trk<span style="color:navy">, </span><span style="color:#ff8000">9
</span><span style="color:maroon">BIOSDATA:1B31                 </span><span style="color:navy">jnz     short </span>gotother
<span style="color:maroon">BIOSDATA:1B33                 </span><span style="color:navy">mov     dh, </span><span style="color:#ff8000">2           </span>; ffsmall
<span style="color:maroon">BIOSDATA:1B35                 </span><span style="color:navy">jmp     short </span>nextdrive
<span style="color:maroon">BIOSDATA:1B37 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1B37
BIOSDATA:1B37 </span>got96<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1B37                 </span><span style="color:navy">mov     dh, </span><span style="color:#ff8000">1           </span>; ff96tpi
<span style="color:maroon">BIOSDATA:1B39                 </span><span style="color:navy">jmp     short </span>nextdrive
<span style="color:maroon">BIOSDATA:1B3B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1B3B
BIOSDATA:1B3B </span>noparmsfromrom<span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1B3B                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:1B3C                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSDATA:1B3D                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSDATA:1B3E                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSDATA:1B3F                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1B40                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">15h         </span>; set command to get dasd type
<span style="color:maroon">BIOSDATA:1B42                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - DISK - GET TYPE (AT,XT2,XT286,CONV,PS)
<span style="color:maroon">BIOSDATA:1B42                                         </span>; DL = drive ID
<span style="color:maroon">BIOSDATA:1B42                                         </span>; Return: CF set on error, AH = disk type (3 = hard drive)
<span style="color:maroon">BIOSDATA:1B42                                         </span>; CX:DX = number of sectors on the media
<span style="color:maroon">BIOSDATA:1B44                 </span><span style="color:navy">jb      short </span>nextdrive
<span style="color:maroon">BIOSDATA:1B46                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">2           </span>; is there changeline?
<span style="color:maroon">BIOSDATA:1B49                 </span><span style="color:navy">jnz     short </span>nextdrive
<span style="color:maroon">BIOSDATA:1B4B                 </span><span style="color:navy">or      cl, </span><span style="color:green">2
</span><span style="color:maroon">BIOSDATA:1B4E                 </span><span style="color:navy">mov     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">1   </span>; remember that we have 96tpi drives
<span style="color:maroon">BIOSDATA:1B53                 </span><span style="color:navy">mov     ds:</span>num_cyln<span style="color:navy">, </span><span style="color:green">80
</span><span style="color:maroon">BIOSDATA:1B58                 </span><span style="color:navy">mov     dh, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSDATA:1B5A                 </span><span style="color:navy">mov     al, </span><span style="color:green">15          </span>; set eot if necessary
<span style="color:maroon">BIOSDATA:1B5C                 </span><span style="color:navy">cmp     al, ds:</span>eot
<span style="color:maroon">BIOSDATA:1B60                 </span><span style="color:navy">jbe     short </span>nextdrive
<span style="color:maroon">BIOSDATA:1B62                 </span><span style="color:navy">mov     ds:</span>eot<span style="color:navy">, al
</span><span style="color:maroon">BIOSDATA:1B65
BIOSDATA:1B65 </span>nextdrive<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1B65                 </span><span style="color:navy">or      cl, </span><span style="color:green">20h         </span>; fi_own_physical ; set this true for all drives
<span style="color:maroon">BIOSDATA:1B68                 </span><span style="color:navy">mov     bh, dl          </span>; save int 13h drive number
<span style="color:maroon">BIOSDATA:1B6A                 </span><span style="color:navy">cmp     ds:</span>single<span style="color:navy">, </span><span style="color:#ff8000">2
</span><span style="color:maroon">BIOSDATA:1B6F                 </span><span style="color:navy">jnz     short </span>not_special
<span style="color:maroon">BIOSDATA:1B71                 </span><span style="color:navy">dec     bh              </span>; int 13h drive number same for logical drive
<span style="color:maroon">BIOSDATA:1B73                 </span><span style="color:navy">xor     cl, </span><span style="color:green">20h         </span>; fi_own_physical ; reset ownership flag for logical drive
<span style="color:maroon">BIOSDATA:1B76
BIOSDATA:1B76 </span>not_special<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1B76                 </span><span style="color:navy">xor     ax, ax          </span>; fill BDS for drive
<span style="color:maroon">BIOSDATA:1B78                 </span><span style="color:navy">mov     al, ds:</span>num_heads
<span style="color:maroon">BIOSDATA:1B7B                 </span><span style="color:navy">mov     [di+</span><span style="color:green">54</span><span style="color:navy">], ax     </span>; [di+BDS.rheads]
<span style="color:maroon">BIOSDATA:1B7E                 </span><span style="color:navy">mov     al, ds:</span>sec_trk
<span style="color:maroon">BIOSDATA:1B81                 </span><span style="color:navy">mov     [di+</span><span style="color:green">52</span><span style="color:navy">], ax     </span>; [di+BDS.rsecpertrack]
<span style="color:maroon">BIOSDATA:1B84                 </span><span style="color:navy">mov     [di+</span><span style="color:green">35</span><span style="color:navy">], cx     </span>; [di+BDS.flags]
<span style="color:maroon">BIOSDATA:1B87                 </span><span style="color:navy">mov     [di+</span><span style="color:green">34</span><span style="color:navy">], dh     </span>; [di+BDS.formfactor]
<span style="color:maroon">BIOSDATA:1B8A                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">5</span><span style="color:navy">], dl      </span>; [di+BDS.drivelet]
<span style="color:maroon">BIOSDATA:1B8D                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">4</span><span style="color:navy">], bh      </span>; [di+BDS.drivenum]
<span style="color:maroon">BIOSDATA:1B90                 </span><span style="color:navy">mov     bl, ds:</span>num_cyln
<span style="color:maroon">BIOSDATA:1B94                 </span><span style="color:navy">mov     [di+</span><span style="color:green">37</span><span style="color:navy">], bl     </span>; [di+BDS.cylinders]
<span style="color:maroon">BIOSDATA:1B97                 </span><span style="color:navy">cmp     ds:</span>single<span style="color:navy">, </span><span style="color:#ff8000">1    </span>; Special case for single drive system
<span style="color:maroon">BIOSDATA:1B9C                 </span><span style="color:navy">jnz     short </span>no_single
<span style="color:maroon">BIOSDATA:1B9E                 </span><span style="color:navy">mov     ds:</span>single<span style="color:navy">, </span><span style="color:#ff8000">2    </span>; Don&#039;t forget we have single drive system
<span style="color:maroon">BIOSDATA:1BA3                 </span><span style="color:navy">or      cx, </span><span style="color:green">10h         </span>; fi_am_mult
<span style="color:maroon">BIOSDATA:1BA3                                         </span>; set that this is one of several drives
<span style="color:maroon">BIOSDATA:1BA6                 </span><span style="color:navy">or      [di+</span><span style="color:green">35</span><span style="color:navy">], cx     </span>; [di+BDS.flags] ; save flags
<span style="color:maroon">BIOSDATA:1BA9                 </span><span style="color:navy">mov     di, [di]        </span>; [di+BDS.link] ; move to next BDS in list
<span style="color:maroon">BIOSDATA:1BAB                 </span><span style="color:navy">inc     dl              </span>; add a number
<span style="color:maroon">BIOSDATA:1BAD                 </span><span style="color:navy">jmp     short </span>nextdrive ; Use same info for BDS as previous
<span style="color:maroon">BIOSDATA:1BAF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1BAF
BIOSDATA:1BAF </span>no_single<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1BAF                 </span><span style="color:navy">inc     dl
</span><span style="color:maroon">BIOSDATA:1BB1                 </span><span style="color:navy">jmp     </span>loop_drive
<span style="color:maroon">BIOSDATA:1BB4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1BB4
BIOSDATA:1BB4 </span>done_drives<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1BB4                 </span><span style="color:navy">mov     word ptr [di], </span><span style="color:green">0FFFFh </span>; [di+BDS.link],-1 ; set link to null
<span style="color:maroon">BIOSDATA:1BB8
BIOSDATA:1BB8 </span>dohard<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1BB8                 </span><span style="color:navy">mov     dh, ds:</span>hnum
<span style="color:maroon">BIOSDATA:1BBC                 </span><span style="color:navy">or      dh, dh          </span>; done if no hardfiles
<span style="color:maroon">BIOSDATA:1BBE                 </span><span style="color:navy">jz      short </span>static_configure
<span style="color:maroon">BIOSDATA:1BC0                 </span><span style="color:navy">mov     dl, </span><span style="color:green">80h
</span><span style="color:maroon">BIOSDATA:1BC2
BIOSDATA:1BC2 </span>dohard1<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1BC2                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">BIOSDATA:1BC3                 </span><span style="color:navy">mov     di, ds:</span>end_of_bdss
<span style="color:maroon">BIOSDATA:1BC7                 </span><span style="color:navy">mov     bl, ds:</span>drvmax
<span style="color:maroon">BIOSDATA:1BCB                 </span><span style="color:navy">mov     bh, </span><span style="color:#ff8000">0           </span>; first primary partition (or active)
<span style="color:maroon">BIOSDATA:1BCD                 </span><span style="color:navy">call    </span>sethard
<span style="color:maroon">BIOSDATA:1BD0                 </span><span style="color:navy">jb      short </span>hardfile_err
<span style="color:maroon">BIOSDATA:1BD2                 </span><span style="color:navy">call    </span>dmax_check      ; error if already 26 drives
<span style="color:maroon">BIOSDATA:1BD5                 </span><span style="color:navy">jnb     short </span>hardfile_err
<span style="color:maroon">BIOSDATA:1BD7                 </span><span style="color:navy">call    </span>xinstall_bds    ; insert new bds into linked list
<span style="color:maroon">BIOSDATA:1BDA
BIOSDATA:1BDA </span>hardfile_err<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1BDA                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSDATA:1BDB                 </span><span style="color:navy">inc     dl              </span>; next hard drive
<span style="color:maroon">BIOSDATA:1BDD                 </span><span style="color:navy">dec     dh
</span><span style="color:maroon">BIOSDATA:1BDF                 </span><span style="color:navy">jnz     short </span>dohard1   ;
<span style="color:maroon">BIOSDATA:1BDF                                         </span>; end of physical drive   initialization
<span style="color:maroon">BIOSDATA:1BDF                                         </span>;
<span style="color:maroon">BIOSDATA:1BDF                                         </span>; *** do not change the position of the following statement.
<span style="color:maroon">BIOSDATA:1BDF                                         </span>; *** domini routine will use [drvmax] value for the start of the logical
<span style="color:maroon">BIOSDATA:1BDF                                         </span>; *** drive number of mini disk(s).
<span style="color:maroon">BIOSDATA:1BE1                 </span><span style="color:navy">call    </span>domini          ; for setting up mini disks, if found
<span style="color:maroon">BIOSDATA:1BE4                 </span><span style="color:navy">mov     dh, ds:</span>hnum     ; we already know this is &gt;0
<span style="color:maroon">BIOSDATA:1BE8                 </span><span style="color:navy">mov     dl, </span><span style="color:green">80h
</span><span style="color:maroon">BIOSDATA:1BEA
BIOSDATA:1BEA </span>dohardx1<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1BEA                 </span><span style="color:navy">mov     bh, </span><span style="color:#ff8000">1           </span>; do all subsequent primary partitions
<span style="color:maroon">BIOSDATA:1BEC
BIOSDATA:1BEC </span>dohardx2<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1BEC                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">BIOSDATA:1BED                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSDATA:1BEE                 </span><span style="color:navy">mov     di, ds:</span>end_of_bdss
<span style="color:maroon">BIOSDATA:1BF2                 </span><span style="color:navy">mov     bl, ds:</span>drvmax
<span style="color:maroon">BIOSDATA:1BF6                 </span><span style="color:navy">call    </span>sethard
<span style="color:maroon">BIOSDATA:1BF9                 </span><span style="color:navy">jb      short </span>dohardx4  ; move to next hardfile if error
<span style="color:maroon">BIOSDATA:1BFB                 </span><span style="color:navy">call    </span>dmax_check      ; make sure &lt;=26 drives
<span style="color:maroon">BIOSDATA:1BFE                 </span><span style="color:navy">jnb     short </span>dohardx4  ; skip if error
<span style="color:maroon">BIOSDATA:1C00                 </span><span style="color:navy">call    </span>xinstall_bds    ; insert new bds into linked list
<span style="color:maroon">BIOSDATA:1C03                 </span><span style="color:navy">pop     bx              </span>; get partition number
<span style="color:maroon">BIOSDATA:1C04                 </span><span style="color:navy">pop     dx              </span>; restore physical drive counts
<span style="color:maroon">BIOSDATA:1C05                 </span><span style="color:navy">inc     bh
</span><span style="color:maroon">BIOSDATA:1C07                 </span><span style="color:navy">jmp     short </span>dohardx2  ; keep looping until we fail
<span style="color:maroon">BIOSDATA:1C09 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1C09
BIOSDATA:1C09 </span>dohardx4<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1C09                 </span><span style="color:navy">pop     bx              </span>; unjunk partition number from stack
<span style="color:maroon">BIOSDATA:1C0A                 </span><span style="color:navy">pop     dx              </span>; restore physical drive counts
<span style="color:maroon">BIOSDATA:1C0B                 </span><span style="color:navy">inc     dl              </span>; next hard drive
<span style="color:maroon">BIOSDATA:1C0D                 </span><span style="color:navy">dec     dh
</span><span style="color:maroon">BIOSDATA:1C0F                 </span><span style="color:navy">jnz     short </span>dohardx1
<span style="color:maroon">BIOSDATA:1C11                 </span><span style="color:navy">cmp     ds:</span>dsktnum<span style="color:navy">, </span><span style="color:#ff8000">2   </span>; &gt;2 diskette drives
<span style="color:maroon">BIOSDATA:1C16                 </span><span style="color:navy">jbe     short </span>static_configure ; no - no need for remapping
<span style="color:maroon">BIOSDATA:1C18                 </span><span style="color:navy">call    </span>remap           ; remap bds chain to adjust driver letters
<span style="color:maroon">BIOSDATA:1C18                                         </span>; ...
<span style="color:maroon">BIOSDATA:1C18                                         </span>; End of drive initialization.
<span style="color:maroon">BIOSDATA:1C1B
BIOSDATA:1C1B </span>static_configure<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1C1B                 </span><span style="color:navy">mov     di, ds:</span>end_of_bdss
<span style="color:maroon">BIOSDATA:1C1F                 </span><span style="color:navy">cmp     di, offset </span>bdss ; did we allocate any hard drive bdss?
<span style="color:maroon">BIOSDATA:1C23                 </span><span style="color:navy">jnz     short </span>dynamic_configure ; that&#039;s the end, then
<span style="color:maroon">BIOSDATA:1C25                 </span><span style="color:navy">mov     di, offset </span>harddrv ; end96tpi
<span style="color:maroon">BIOSDATA:1C25                                         </span>; keep everything up to end96tpi
<span style="color:maroon">BIOSDATA:1C28                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSDATA:1C2D                 </span><span style="color:navy">jnz     short </span>dynamic_configure
<span style="color:maroon">BIOSDATA:1C2F                 </span><span style="color:navy">mov     di, offset </span>endfloppy
<span style="color:maroon">BIOSDATA:1C32
BIOSDATA:1C32 </span>dynamic_configure<span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1C32                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:1C33                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:1C34                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:1C34                 </span><span style="color:navy">cld                     </span>; clear direction
<span style="color:maroon">BIOSDATA:1C35                 </span><span style="color:navy">cmp     ds:</span>model_byte<span style="color:navy">, </span><span style="color:green">0FCh </span>; AT ?
<span style="color:maroon">BIOSDATA:1C3A                 </span><span style="color:navy">jnz     short </span>checkcompaqbug
<span style="color:maroon">BIOSDATA:1C3C                 </span><span style="color:navy">cmp     ds:</span>hnum<span style="color:navy">, </span><span style="color:#ff8000">0      </span>; No hard file?
<span style="color:maroon">BIOSDATA:1C41                 </span><span style="color:navy">jz      short </span>checkcompaqbug
<span style="color:maroon">BIOSDATA:1C43                 </span><span style="color:navy">xchg    ax, di          </span>; save allocation pointer in ax
<span style="color:maroon">BIOSDATA:1C44                 </span><span style="color:navy">mov     si, </span><span style="color:green">0F000h
</span><span style="color:maroon">BIOSDATA:1C47                 </span><span style="color:navy">mov     es, si          </span>; ES -&gt; ROM BIOS segment
<span style="color:maroon">BIOSDATA:1C49                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:1C49                 </span><span style="color:navy">mov     si, offset </span>bios_date <span style="color:gray">; &quot;01/10/84&quot;
</span><span style="color:maroon">BIOSDATA:1C4C                 </span><span style="color:navy">mov     di, </span><span style="color:green">0FFF5h      </span>; ROM BIOS string is at   F000:FFF5
<span style="color:maroon">BIOSDATA:1C4F                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">9           </span>; bdate_l ; Only patch ROM for bios 01/10/84
<span style="color:maroon">BIOSDATA:1C52                 </span><span style="color:navy">repe cmpsb              </span>; check for date + zero on end
<span style="color:maroon">BIOSDATA:1C54                 </span><span style="color:navy">xchg    ax, di          </span>; restore allocation pointer
<span style="color:maroon">BIOSDATA:1C55                 </span><span style="color:navy">jnz     short </span>checkcompaqbug
<span style="color:maroon">BIOSDATA:1C57                 </span><span style="color:navy">mov     cx, offset </span>endatrom
<span style="color:maroon">BIOSDATA:1C5A                 </span><span style="color:navy">mov     si, offset </span>ibm_disk_io
<span style="color:maroon">BIOSDATA:1C5D                 </span><span style="color:navy">jmp     short </span>install_int13_patch
<span style="color:maroon">BIOSDATA:1C5F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1C5F
BIOSDATA:1C5F </span>checkcompaqbug<span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1C5F                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0F000h
</span><span style="color:maroon">BIOSDATA:1C62                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">BIOSDATA:1C64                 </span><span style="color:navy">cmp     word ptr es:</span><span style="color:green">0FFEAh</span><span style="color:navy">, &#039;</span><span style="color:green">OC&#039; </span>; look for COMPAQ
<span style="color:maroon">BIOSDATA:1C6B                 </span><span style="color:navy">jnz     short </span>not_compaq_patch
<span style="color:maroon">BIOSDATA:1C6D                 </span><span style="color:navy">cmp     word ptr es:</span><span style="color:green">0FFECh</span><span style="color:navy">, &#039;</span><span style="color:green">PM&#039;
</span><span style="color:maroon">BIOSDATA:1C74                 </span><span style="color:navy">jnz     short </span>not_compaq_patch
<span style="color:maroon">BIOSDATA:1C76                 </span><span style="color:navy">cmp     word ptr es:</span><span style="color:green">0FFEEh</span><span style="color:navy">, &#039;</span><span style="color:green">QA&#039;
</span><span style="color:maroon">BIOSDATA:1C7D                 </span><span style="color:navy">jnz     short </span>not_compaq_patch
<span style="color:maroon">BIOSDATA:1C7F                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">0FFFBh   </span>; get year
<span style="color:maroon">BIOSDATA:1C83                 </span><span style="color:navy">xchg    ah, al
</span><span style="color:maroon">BIOSDATA:1C85                 </span><span style="color:navy">cmp     ax, &#039;</span><span style="color:green">86&#039;        </span>; 3836h ; is it 86?
<span style="color:maroon">BIOSDATA:1C88                 </span><span style="color:navy">ja      short </span>not_compaq_patch
<span style="color:maroon">BIOSDATA:1C8A                 </span><span style="color:navy">jb      short </span>do_compaq_patch
<span style="color:maroon">BIOSDATA:1C8C                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">0FFF5h   </span>; get month
<span style="color:maroon">BIOSDATA:1C90                 </span><span style="color:navy">xchg    ah, al
</span><span style="color:maroon">BIOSDATA:1C92                 </span><span style="color:navy">cmp     ax, &#039;</span><span style="color:green">08&#039;        </span>; 3038h ; is it 08?
<span style="color:maroon">BIOSDATA:1C95                 </span><span style="color:navy">ja      short </span>not_compaq_patch
<span style="color:maroon">BIOSDATA:1C97                 </span><span style="color:navy">jb      short </span>do_compaq_patch
<span style="color:maroon">BIOSDATA:1C99                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">0FFF8h   </span>; get day
<span style="color:maroon">BIOSDATA:1C9D                 </span><span style="color:navy">xchg    ah, al
</span><span style="color:maroon">BIOSDATA:1C9F                 </span><span style="color:navy">cmp     ax, &#039;</span><span style="color:green">04&#039;        </span>; 3034h ; is it 04?
<span style="color:maroon">BIOSDATA:1CA2                 </span><span style="color:navy">jnb     short </span>not_compaq_patch
<span style="color:maroon">BIOSDATA:1CA4
BIOSDATA:1CA4 </span>do_compaq_patch<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1CA4                 </span><span style="color:navy">mov     cx, offset </span>end_compaq_i13hook
<span style="color:maroon">BIOSDATA:1CA7                 </span><span style="color:navy">mov     si, offset </span>endatrom
<span style="color:maroon">BIOSDATA:1CAA
BIOSDATA:1CAA </span>install_int13_patch<span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1CAA                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:1CAB                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:1CAC                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:1CAC                 </span><span style="color:navy">mov     word ptr ds:</span>Orig13<span style="color:navy">, di </span>; set new rom bios int 13 vector
<span style="color:maroon">BIOSDATA:1CB0                 </span><span style="color:navy">mov     word ptr ds:</span>Orig13<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, cs
</span><span style="color:maroon">BIOSDATA:1CB4                 </span><span style="color:navy">sub     cx, si          </span>; size of rom fix module
<span style="color:maroon">BIOSDATA:1CB6                 </span><span style="color:navy">rep movsb               </span>; relocate it
<span style="color:maroon">BIOSDATA:1CB8
BIOSDATA:1CB8 </span>not_compaq_patch<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1CB8                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:1CB9                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:1CBA                 </span><span style="color:navy">cmp     ds:</span>havecmoscloc<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; cmos clock exists?
<span style="color:maroon">BIOSDATA:1CBF                 </span><span style="color:navy">jnz     short </span>checkk09  ; no
<span style="color:maroon">BIOSDATA:1CC1                 </span><span style="color:navy">mov     word ptr ds:</span>daycnttoday<span style="color:navy">, di </span>; set the address for mschar
<span style="color:maroon">BIOSDATA:1CC5                 </span><span style="color:navy">mov     cx, </span><span style="color:green">209         </span>; enddaycnttoday - daycnt_to_day
<span style="color:maroon">BIOSDATA:1CC8                 </span><span style="color:navy">mov     si, offset </span>daycnt_to_day
<span style="color:maroon">BIOSDATA:1CCB                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">BIOSDATA:1CCD                 </span><span style="color:navy">mov     word ptr ds:</span>bintobcd<span style="color:navy">, di </span>; set the address for msclock
<span style="color:maroon">BIOSDATA:1CCD                                         </span>; let original segment stay
<span style="color:maroon">BIOSDATA:1CD1                 </span><span style="color:navy">mov     cx, </span><span style="color:green">11          </span>; endcmosclockset - bin_to_bcd
<span style="color:maroon">BIOSDATA:1CD4                 </span><span style="color:navy">mov     si, offset </span>bin_to_bcd
<span style="color:maroon">BIOSDATA:1CD7                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">BIOSDATA:1CD9
BIOSDATA:1CD9 </span>checkk09<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1CD9                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSDATA:1CDA                 </span><span style="color:navy">mov     ax, </span><span style="color:green">4101h       </span>; wait for bh=es:[di]
<span style="color:maroon">BIOSDATA:1CDD                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">1           </span>; wait for 1 clock tick
<span style="color:maroon">BIOSDATA:1CDF                 </span><span style="color:navy">mov     bh, es:[di]
</span><span style="color:maroon">BIOSDATA:1CE2                 </span><span style="color:navy">stc
</span><span style="color:maroon">BIOSDATA:1CE3                 </span><span style="color:navy">int     </span><span style="color:green">15h             </span>; SYSTEM - WAIT ON EXTERNAL EVENT (CONVERTIBLE)
<span style="color:maroon">BIOSDATA:1CE3                                         </span>; AL = condition type, BH = condition compare or mask value
<span style="color:maroon">BIOSDATA:1CE3                                         </span>; BL = timeout value times 55 milliseconds, 00h means no timeout
<span style="color:maroon">BIOSDATA:1CE3                                         </span>; DX = I/O port address if AL bit 4 set
<span style="color:maroon">BIOSDATA:1CE5                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSDATA:1CE6                 </span><span style="color:navy">jb      short </span>configdone
<span style="color:maroon">BIOSDATA:1CE8                 </span><span style="color:navy">mov     ds:</span>fhavek09<span style="color:navy">, </span><span style="color:#ff8000">1  </span>; remember we have a k09 type
<span style="color:maroon">BIOSDATA:1CED                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSDATA:1CEE                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:maroon">BIOSDATA:1CF0                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">BIOSDATA:1CF2                 </span><span style="color:navy">mov     word ptr ds:</span>disksector<span style="color:navy">+</span><span style="color:green">62h</span><span style="color:navy">, di </span>; [6Ch*4]
<span style="color:maroon">BIOSDATA:1CF2                                         </span>; new int 6ch handler
<span style="color:maroon">BIOSDATA:1CF6                 </span><span style="color:navy">mov     word ptr ds:</span>disksector<span style="color:navy">+</span><span style="color:green">64h</span><span style="color:navy">, cs
</span><span style="color:maroon">BIOSDATA:1CFA                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1CFB                 </span><span style="color:navy">mov     si, offset </span>int6c
<span style="color:maroon">BIOSDATA:1CFE                 </span><span style="color:navy">mov     cx, </span><span style="color:green">459         </span>; endk09-int6c (size of k09 routine)
<span style="color:maroon">BIOSDATA:1D01                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">BIOSDATA:1D03
BIOSDATA:1D03 </span>configdone<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1D03                 </span><span style="color:navy">push    cs              </span>; di is final ending address of msbio.
<span style="color:maroon">BIOSDATA:1D04                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1D05                 </span><span style="color:navy">add     di, </span><span style="color:green">15          </span>; round (up) to paragraph
<span style="color:maroon">BIOSDATA:1D08                 </span><span style="color:navy">shr     di, </span><span style="color:green">1
</span><span style="color:maroon">BIOSDATA:1D0A                 </span><span style="color:navy">shr     di, </span><span style="color:green">1
</span><span style="color:maroon">BIOSDATA:1D0C                 </span><span style="color:navy">shr     di, </span><span style="color:green">1
</span><span style="color:maroon">BIOSDATA:1D0E                 </span><span style="color:navy">shr     di, </span><span style="color:green">1
</span><span style="color:maroon">BIOSDATA:1D10                 </span><span style="color:navy">add     di, </span><span style="color:green">70h
</span><span style="color:maroon">BIOSDATA:1D14                 </span><span style="color:navy">mov     ds:</span>DosDataSg<span style="color:navy">, di </span>; where the dos data segment will be
<span style="color:maroon">BIOSDATA:1D18                 </span><span style="color:navy">mov     ax, ds:</span>drvfat   ; get drive and fat id
<span style="color:maroon">BIOSDATA:1D1B                 </span><span style="color:navy">mov     bp, offset </span>SetDrive ; Note: SETDRIVES uses AL (drive number) only
<span style="color:maroon">BIOSDATA:1D1E                 </span><span style="color:navy">push    cs              </span>; simulate far call
<span style="color:maroon">BIOSDATA:1D1F                 </span><span style="color:navy">call    near ptr </span>call_bios_code ; get bds for drive
<span style="color:maroon">BIOSDATA:1D22                 </span><span style="color:navy">mov     bp, offset </span>GetBp ; ensure valid bpb is present
<span style="color:maroon">BIOSDATA:1D25                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSDATA:1D26                 </span><span style="color:navy">call    near ptr </span>call_bios_code
<span style="color:maroon">BIOSDATA:1D29                 </span><span style="color:navy">push    es              </span>; copy bds to ds:di
<span style="color:maroon">BIOSDATA:1D2A                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1D2B                 </span><span style="color:navy">xor     di, di
</span><span style="color:maroon">BIOSDATA:1D2D                 </span><span style="color:navy">mov     al, es:[di]     </span>; get fat id byte
<span style="color:maroon">BIOSDATA:1D30                 </span><span style="color:navy">mov     byte ptr es:</span>drvfat<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, al </span>; save fat byte
<span style="color:maroon">BIOSDATA:1D34                 </span><span style="color:navy">mov     ax, es:</span>drvfat
<span style="color:maroon">BIOSDATA:1D38                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSDATA:1D39                 </span><span style="color:navy">push    ds              </span>; copy bds to es:di
<span style="color:maroon">BIOSDATA:1D3A                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:1D3B                 </span><span style="color:navy">push    cs              </span>; copy Bios_Data to ds
<span style="color:maroon">BIOSDATA:1D3C                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1D3D                 </span><span style="color:navy">mov     bp, offset </span>SetDrive
<span style="color:maroon">BIOSDATA:1D40                 </span><span style="color:navy">push    cs              </span>; simulate far call
<span style="color:maroon">BIOSDATA:1D41                 </span><span style="color:navy">call    near ptr </span>call_bios_code ; get correct bds for this drive
<span style="color:maroon">BIOSDATA:1D44                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSDATA:1D45                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1D46                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSDATA:1D47                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:1D47                 </span><span style="color:navy">mov     bx, [di+</span><span style="color:#ff8000">6</span><span style="color:navy">]      </span>; [di+BDS.BDS_BPB.BPB_BYTESPERSECTOR]
<span style="color:maroon">BIOSDATA:1D4A                 </span><span style="color:navy">mov     cs:</span>md_sectorsize<span style="color:navy">, bx </span>; used by get_fat_sector proc.
<span style="color:maroon">BIOSDATA:1D4F                 </span><span style="color:navy">mov     bl, [di+</span><span style="color:green">31</span><span style="color:navy">]     </span>; [di+BDS.fatsiz]
<span style="color:maroon">BIOSDATA:1D4F                                         </span>; get size of fat on media
<span style="color:maroon">BIOSDATA:1D52                 </span><span style="color:navy">mov     es:</span>fbigfat<span style="color:navy">, bl
</span><span style="color:maroon">BIOSDATA:1D57                 </span><span style="color:navy">mov     cl, [di+</span><span style="color:#ff8000">8</span><span style="color:navy">]
</span><span style="color:maroon">BIOSDATA:1D5A                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">23</span><span style="color:navy">]     </span>; [di+BDS.BDS_BPB.BPB_HIDDENSECTORS]
<span style="color:maroon">BIOSDATA:1D5D                 </span><span style="color:navy">sub     es:</span>bios_l<span style="color:navy">, ax   </span>; subtract hidden sectors since we
<span style="color:maroon">BIOSDATA:1D5D                                         </span>; need a logical sector number that will
<span style="color:maroon">BIOSDATA:1D5D                                         </span>; be used by getclus(diskrd procedure)
<span style="color:maroon">BIOSDATA:1D62                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">25</span><span style="color:navy">]     </span>; [di+BDS.BDS_BPB.BPB_HIDDENSECTORS+2]
<span style="color:maroon">BIOSDATA:1D65                 </span><span style="color:navy">sbb     es:</span>bios_h<span style="color:navy">, ax   </span>; subtract upper 16 bits of sector num
<span style="color:maroon">BIOSDATA:1D6A                 </span><span style="color:navy">xor     ch, ch          </span>; cx = sectors/cluster
<span style="color:maroon">BIOSDATA:1D6C                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSDATA:1D6D                 </span><span style="color:navy">xor     di, di          </span>; 0
<span style="color:maroon">BIOSDATA:1D6F                 </span><span style="color:navy">mov     ds, di
</span><span style="color:maroon">BIOSDATA:1D71                 </span><span style="color:navy">mov     bx, ds:</span>sectorspertrack<span style="color:navy">+</span><span style="color:green">1 </span>; clus=*53Ah
<span style="color:maroon">BIOSDATA:1D71                                         </span>; (First cluster field of 2nd dir entry
<span style="color:maroon">BIOSDATA:1D71                                         </span>; of root directory in the buffer at 500h)
<span style="color:maroon">BIOSDATA:1D75                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSDATA:1D76
BIOSDATA:1D76 </span>loadit<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1D76                 </span><span style="color:navy">mov     ax, </span><span style="color:green">473h        </span>; SYSINIT segment (SYSINITSEG)
<span style="color:maroon">BIOSDATA:1D79                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">BIOSDATA:1D7B                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:1D7B                 </span><span style="color:navy">mov     es, es:</span>CURRENT_DOS_LOCATION
<span style="color:maroon">BIOSDATA:1D80                 </span>assume es:nothing
<span style="color:maroon">BIOSDATA:1D80                 </span><span style="color:navy">call    </span>getclus         ; read cluster at ES:DI (DI is updated)
<span style="color:maroon">BIOSDATA:1D83                 </span><span style="color:navy">test    cs:</span>fbigfat<span style="color:navy">, </span><span style="color:green">40h </span>; fbig
<span style="color:maroon">BIOSDATA:1D89                 </span><span style="color:navy">jnz     short </span>eofbig
<span style="color:maroon">BIOSDATA:1D8B                 </span><span style="color:navy">cmp     bx, </span><span style="color:green">0FF7h
</span><span style="color:maroon">BIOSDATA:1D8F                 </span><span style="color:navy">jmp     short </span>iseofx
<span style="color:maroon">BIOSDATA:1D91 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSDATA:1D91
BIOSDATA:1D91 </span>eofbig<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1D91                 </span><span style="color:navy">cmp     bx, </span><span style="color:green">0FFF7h
</span><span style="color:maroon">BIOSDATA:1D94
BIOSDATA:1D94 </span>iseofx<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSDATA:1D94                 </span><span style="color:navy">jb      short </span>loadit    ; keep loading until cluster = eof
<span style="color:maroon">BIOSDATA:1D96                 </span><span style="color:navy">call    </span>setdrvparms
<span style="color:maroon">BIOSDATA:1D99                 </span><span style="color:navy">jmp     far ptr </span><span style="background:blue"><span style="color:navy">473h:269h</span></span> ; SYSINIT:_SYSINIT
<span style="color:black">BIOSDATA:1D9E
BIOSDATA:1D9E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:1D9E
BIOSDATA:1D9E
BIOSDATA:1D9E </span>remap           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1D9E                 </span><span style="color:navy">mov     di, word ptr cs:</span>start_bds ; get first bds
<span style="color:black">BIOSDATA:1DA3
BIOSDATA:1DA3 </span><span style="color:gray">drive_loop</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1DA3                 </span><span style="color:navy">cmp     byte ptr [di+</span><span style="color:#ff8000">4</span><span style="color:navy">], </span><span style="color:green">80h </span>; [di+BDS.drivenum] ; first hard disk??
<span style="color:black">BIOSDATA:1DA7                 </span><span style="color:navy">jz      short </span><span style="color:gray">fdrv_found </span>; yes, continue
<span style="color:black">BIOSDATA:1DA9                 </span><span style="color:navy">mov     di, [di]        </span>; [di+BDS.link] ; get next bds, assume segment
<span style="color:black">BIOSDATA:1DAB                 </span><span style="color:navy">cmp     di, -</span><span style="color:green">1          </span>; last bds?
<span style="color:black">BIOSDATA:1DAE                 </span><span style="color:navy">jnz     short </span><span style="color:gray">drive_loop </span>; loop if not
<span style="color:black">BIOSDATA:1DB0                 </span><span style="color:navy">jmp     short </span><span style="color:gray">rmap_exit </span>; yes, no hard drive on   system
<span style="color:black">BIOSDATA:1DB2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:1DB2
BIOSDATA:1DB2 </span><span style="color:gray">fdrv_found</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1DB2                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">2           </span>; start with logical drv num=2
<span style="color:black">BIOSDATA:1DB4
BIOSDATA:1DB4 </span><span style="color:gray">fdrv_loop</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1DB4                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">5</span><span style="color:navy">], al      </span>; [di+BDS.drivelet] ; found ??
<span style="color:black">BIOSDATA:1DB7                 </span><span style="color:navy">mov     di, [di]        </span>; [di+BDS.link] ; ds:di--&gt; next bds
<span style="color:black">BIOSDATA:1DB9                 </span><span style="color:navy">inc     al              </span>; set num for next drive
<span style="color:black">BIOSDATA:1DBB                 </span><span style="color:navy">cmp     di, -</span><span style="color:green">1          </span>; last hard drive ??
<span style="color:black">BIOSDATA:1DBE                 </span><span style="color:navy">jnz     short </span><span style="color:gray">fdrv_loop </span>; no - assign more disk   drives
<span style="color:black">BIOSDATA:1DC0                 </span><span style="color:navy">mov     di, word ptr cs:</span>start_bds ; get first bds
<span style="color:black">BIOSDATA:1DC5                 </span><span style="color:navy">mov     di, [di]        </span>; [di+BDS.link] ; ds:di--&gt;bds2
<span style="color:black">BIOSDATA:1DC7                 </span><span style="color:navy">mov     ah, cs:</span>dsktnum  ; get number of floppies to remap
<span style="color:black">BIOSDATA:1DCC                 </span><span style="color:navy">sub     ah, </span><span style="color:#ff8000">2           </span>; adjust for a: &amp; b:
<span style="color:black">BIOSDATA:1DCF
BIOSDATA:1DCF </span><span style="color:gray">remap_loop1</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1DCF                 </span><span style="color:navy">mov     di, [di]        </span>; [di+BDS.link] ; set new num to next floppy
<span style="color:black">BIOSDATA:1DD1                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">5</span><span style="color:navy">], al      </span>; [di+BDS.drivelet]
<span style="color:black">BIOSDATA:1DD4                 </span><span style="color:navy">inc     al              </span>; new number for next floppy
<span style="color:black">BIOSDATA:1DD6                 </span><span style="color:navy">dec     ah              </span>; count down extra floppies
<span style="color:black">BIOSDATA:1DD8                 </span><span style="color:navy">jnz     short </span><span style="color:gray">remap_loop1 </span>;
<span style="color:black">BIOSDATA:1DD8                                         </span>; now we&#039;ve got to adjust the boot drive
<span style="color:black">BIOSDATA:1DD8                                         </span>; if we reassigned it
<span style="color:black">BIOSDATA:1DDA                 </span><span style="color:navy">mov     al, byte ptr cs:</span>drvfat
<span style="color:black">BIOSDATA:1DDE                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2           </span>; is it a: or b: ?
<span style="color:black">BIOSDATA:1DE0                 </span><span style="color:navy">jb      short </span><span style="color:gray">rmap_exit
</span><span style="color:black">BIOSDATA:1DE2                 </span><span style="color:navy">sub     al, cs:</span>dsktnum  ; is it one of the other floppies?
<span style="color:black">BIOSDATA:1DE7                 </span><span style="color:navy">jb      short </span><span style="color:gray">remap_boot_flop </span>; brif so
<span style="color:black">BIOSDATA:1DE9                 </span><span style="color:navy">add     al, </span><span style="color:#ff8000">2           </span>; bootdrv -= (dsktnum-2)
<span style="color:black">BIOSDATA:1DEB                 </span><span style="color:navy">jmp     short </span><span style="color:gray">remap_change_boot_drv
</span><span style="color:black">BIOSDATA:1DED </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:1DED
BIOSDATA:1DED </span><span style="color:gray">remap_boot_flop</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1DED                 </span><span style="color:navy">add     al, cs:</span>drvmax   ; bootdrv += (drvmax-dsktnum)
<span style="color:black">BIOSDATA:1DF2
BIOSDATA:1DF2 </span><span style="color:gray">remap_change_boot_drv</span><span style="color:navy">:                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1DF2                 </span><span style="color:navy">mov     byte ptr cs:</span>drvfat<span style="color:navy">, al </span>; alter msdos.sys load drive
<span style="color:black">BIOSDATA:1DF6                 </span><span style="color:navy">inc     al
</span><span style="color:black">BIOSDATA:1DF8                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:1DF9                 </span><span style="color:navy">mov     di, </span><span style="color:green">473h        </span>; SYSINIT segment
<span style="color:black">BIOSDATA:1DFC                 </span><span style="color:navy">mov     ds, di
</span><span style="color:black">BIOSDATA:1DFE                 </span>assume ds:nothing
<span style="color:black">BIOSDATA:1DFE                 </span><span style="color:navy">mov     ds:</span>DEFAULT_DRIVE<span style="color:navy">, al </span>; [SYSINIT+DEFAULT_DRIVE]
<span style="color:black">BIOSDATA:1DFE                                         </span>; pass it to sysinit as well
<span style="color:black">BIOSDATA:1E01                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:1E02                 </span>assume ds:nothing
<span style="color:black">BIOSDATA:1E02
BIOSDATA:1E02 </span><span style="color:gray">rmap_exit</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1E02                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:1E02 </span>remap           endp
<span style="color:black">BIOSDATA:1E02
BIOSDATA:1E03
BIOSDATA:1E03 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:1E03
BIOSDATA:1E03
BIOSDATA:1E03 </span>getboot         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1E03                 </span><span style="color:navy">mov     ax, cs:</span>init_bootseg
<span style="color:black">BIOSDATA:1E07                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">BIOSDATA:1E09                 </span><span style="color:navy">mov     bx, </span><span style="color:green">200h        </span>; bootbias
<span style="color:black">BIOSDATA:1E09                                         </span>; load BX, ES:BX is where sector goes
<span style="color:black">BIOSDATA:1E0C                 </span><span style="color:navy">mov     ax, </span><span style="color:green">201h
</span><span style="color:black">BIOSDATA:1E0F                 </span><span style="color:navy">xor     dh, dh
</span><span style="color:black">BIOSDATA:1E11                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSDATA:1E14                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - READ SECTORS INTO MEMORY
<span style="color:black">BIOSDATA:1E14                                         </span>; AL = number of sectors to read, CH = track, CL = sector
<span style="color:black">BIOSDATA:1E14                                         </span>; DH = head, DL = drive, ES:BX -&gt; buffer to fill
<span style="color:black">BIOSDATA:1E14                                         </span>; Return: CF set on error, AH = status, AL = number of sectors read
<span style="color:black">BIOSDATA:1E16                 </span><span style="color:navy">jb      short </span><span style="color:gray">erret
</span><span style="color:black">BIOSDATA:1E18                 </span><span style="color:navy">cmp     word ptr es:</span><span style="color:green">3FEh</span><span style="color:navy">, </span><span style="color:green">0AA55h </span>; [es:bootbias+1FEh]
<span style="color:black">BIOSDATA:1E18                                         </span>; Dave Litton magic word?
<span style="color:black">BIOSDATA:1E1F                 </span><span style="color:navy">jz      short </span><span style="color:gray">norm_ret  </span>; yes
<span style="color:black">BIOSDATA:1E21
BIOSDATA:1E21 </span><span style="color:gray">erret</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1E21                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSDATA:1E22
BIOSDATA:1E22 </span><span style="color:gray">norm_ret</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1E22                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:1E22 </span>getboot         endp
<span style="color:black">BIOSDATA:1E22
BIOSDATA:1E23
BIOSDATA:1E23 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:1E23
BIOSDATA:1E23
BIOSDATA:1E23 </span>sethard         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1E23                 </span><span style="color:navy">push    di              </span>; generate bpb for a variable sized hard file
<span style="color:black">BIOSDATA:1E24                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:1E25                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:1E26                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:1E27                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">5</span><span style="color:navy">], bl      </span>; [di+BDS.drivelet]
<span style="color:black">BIOSDATA:1E2A                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">4</span><span style="color:navy">], dl      </span>; [di+BDS.drivenum]
<span style="color:black">BIOSDATA:1E2D                 </span><span style="color:navy">or      byte ptr [di+</span><span style="color:green">35</span><span style="color:navy">], </span><span style="color:green">1 </span>; [di+BDS.flags] ; fnon_removable
<span style="color:black">BIOSDATA:1E31                 </span><span style="color:navy">mov     byte ptr [di+</span><span style="color:green">34</span><span style="color:navy">], </span><span style="color:#ff8000">5 </span>; [di+BDS.formfactor] ; ffHardFile
<span style="color:black">BIOSDATA:1E35                 </span><span style="color:navy">mov     ds:</span>fbigfat<span style="color:navy">, </span><span style="color:#ff8000">0   </span>; assume 12 bit FAT
<span style="color:black">BIOSDATA:1E3A                 </span><span style="color:navy">mov     dh, bh          </span>; partition number
<span style="color:black">BIOSDATA:1E3C                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:1E3D                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">8
</span><span style="color:black">BIOSDATA:1E3F                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - DISK - GET CURRENT DRIVE PARAMETERS (XT,AT,XT286,CONV,PS)
<span style="color:black">BIOSDATA:1E3F                                         </span>; DL = drive number
<span style="color:black">BIOSDATA:1E3F                                         </span>; Return: CF set on error, AH = status code, BL = drive type
<span style="color:black">BIOSDATA:1E3F                                         </span>; DL = number of consecutive drives
<span style="color:black">BIOSDATA:1E3F                                         </span>; DH = maximum value for head number, ES:DI -&gt; drive parameter
<span style="color:black">BIOSDATA:1E41                 </span><span style="color:navy">inc     dh
</span><span style="color:black">BIOSDATA:1E43                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">15h</span><span style="color:navy">], dh    </span>; [di+BDS.heads] ; get number of heads
<span style="color:black">BIOSDATA:1E46                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:1E47                 </span><span style="color:navy">jb      short </span><span style="color:gray">setret    </span>; error   if no hard disk
<span style="color:black">BIOSDATA:1E49                 </span><span style="color:navy">and     cl, </span><span style="color:green">3Fh
</span><span style="color:black">BIOSDATA:1E4C                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">13h</span><span style="color:navy">], cl    </span>; [di+BDS.secpertrack]
<span style="color:black">BIOSDATA:1E4F                 </span><span style="color:navy">push    dx              </span>; save partition number
<span style="color:black">BIOSDATA:1E50                 </span><span style="color:navy">call    </span>getboot
<span style="color:black">BIOSDATA:1E53                 </span><span style="color:navy">pop     dx              </span>; restore partition number
<span style="color:black">BIOSDATA:1E54                 </span><span style="color:navy">jb      short </span><span style="color:gray">setret
</span><span style="color:black">BIOSDATA:1E56                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">3C2h        </span>; 1C2h+bootbias
<span style="color:black">BIOSDATA:1E59
BIOSDATA:1E59 </span><span style="color:gray">act_part</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1E59                 </span><span style="color:navy">test    byte ptr es:[bx-</span><span style="color:green">4</span><span style="color:navy">], </span><span style="color:green">80h </span>; is the partition active?
<span style="color:black">BIOSDATA:1E5E                 </span><span style="color:navy">jz      short </span><span style="color:gray">not_act   </span>; no
<span style="color:black">BIOSDATA:1E60                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">1 </span>; reject if partitiontype != 1, 4 or 6
<span style="color:black">BIOSDATA:1E64                 </span><span style="color:navy">jz      short </span><span style="color:gray">got_good_act
</span><span style="color:black">BIOSDATA:1E66                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">4
</span><span style="color:black">BIOSDATA:1E6A                 </span><span style="color:navy">jz      short </span><span style="color:gray">got_good_act
</span><span style="color:black">BIOSDATA:1E6C                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">6
</span><span style="color:black">BIOSDATA:1E70                 </span><span style="color:navy">jnz     short </span><span style="color:gray">not_act
</span><span style="color:black">BIOSDATA:1E72
BIOSDATA:1E72 </span><span style="color:gray">got_good_act</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1E72                 </span><span style="color:navy">or      dh, dh          </span>; is this our target partition #?
<span style="color:black">BIOSDATA:1E74                 </span><span style="color:navy">jz      short </span>set2      ; WE GOT THE ONE WANTED!
<span style="color:black">BIOSDATA:1E76                 </span><span style="color:navy">dec     dh              </span>; count down
<span style="color:black">BIOSDATA:1E78
BIOSDATA:1E78 </span><span style="color:gray">not_act</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1E78                 </span><span style="color:navy">add     bx, </span><span style="color:green">16
</span><span style="color:black">BIOSDATA:1E7B                 </span><span style="color:navy">cmp     bx, </span><span style="color:green">402h        </span>; 202h+bootbias
<span style="color:black">BIOSDATA:1E7B                                         </span>; last entry done?
<span style="color:black">BIOSDATA:1E7F                 </span><span style="color:navy">jnz     short </span><span style="color:gray">act_part  </span>; no, process next entry
<span style="color:black">BIOSDATA:1E81                 </span><span style="color:navy">mov     bx, </span><span style="color:green">3C2h        </span>; 1C2h+bootbias
<span style="color:black">BIOSDATA:1E81                                         </span>; restore original value of bx
<span style="color:black">BIOSDATA:1E84
BIOSDATA:1E84 </span><span style="color:gray">get_primary</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1E84                 </span><span style="color:navy">test    byte ptr es:[bx-</span><span style="color:green">4</span><span style="color:navy">], </span><span style="color:green">80h </span>; Now scan the non-active partitions
<span style="color:black">BIOSDATA:1E89                 </span><span style="color:navy">jnz     short </span><span style="color:gray">not_prim  </span>; we&#039;ve already scanned the ACTIVE ones
<span style="color:black">BIOSDATA:1E8B                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">1 </span>; see if partitiontype == 1, 4 or 6
<span style="color:black">BIOSDATA:1E8F                 </span><span style="color:navy">jz      short </span><span style="color:gray">got_prim
</span><span style="color:black">BIOSDATA:1E91                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">4
</span><span style="color:black">BIOSDATA:1E95                 </span><span style="color:navy">jz      short </span><span style="color:gray">got_prim
</span><span style="color:black">BIOSDATA:1E97                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">6
</span><span style="color:black">BIOSDATA:1E9B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">not_prim
</span><span style="color:black">BIOSDATA:1E9D
BIOSDATA:1E9D </span><span style="color:gray">got_prim</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1E9D                 </span><span style="color:navy">or      dh, dh          </span>; is this our target partition?
<span style="color:black">BIOSDATA:1E9F                 </span><span style="color:navy">jz      short </span>set2
<span style="color:black">BIOSDATA:1EA1                 </span><span style="color:navy">dec     dh
</span><span style="color:black">BIOSDATA:1EA3
BIOSDATA:1EA3 </span><span style="color:gray">not_prim</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1EA3                 </span><span style="color:navy">add     bx, </span><span style="color:green">16
</span><span style="color:black">BIOSDATA:1EA6                 </span><span style="color:navy">cmp     bx, </span><span style="color:green">402h        </span>; 202h+bootbias
<span style="color:black">BIOSDATA:1EAA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">get_primary </span>; loop till we&#039;ve gone through table
<span style="color:black">BIOSDATA:1EAC
BIOSDATA:1EAC </span><span style="color:gray">setret</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1EAC                 </span><span style="color:navy">stc                     </span>; error return
<span style="color:black">BIOSDATA:1EAD                 </span><span style="color:navy">jmp     </span><span style="color:gray">ret_hard
</span><span style="color:black">BIOSDATA:1EB0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:1EB0
BIOSDATA:1EB0 </span>set2<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1EB0                 </span><span style="color:navy">mov     cs:</span>rom_drv_num<span style="color:navy">, dl </span>; save the rom bios drive number
<span style="color:black">BIOSDATA:1EB5                 </span><span style="color:navy">mov     ax, es:[bx+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; hidden sectors (start sector)
<span style="color:black">BIOSDATA:1EB9                 </span><span style="color:navy">mov     dx, es:[bx+</span><span style="color:#ff8000">6</span><span style="color:navy">]
</span><span style="color:black">BIOSDATA:1EBD                 </span><span style="color:navy">sub     ax, </span><span style="color:#ff8000">1           </span>; decrement the sector count by 1 to make it zero based.
<span style="color:black">BIOSDATA:1EBD                                         </span>; exactly 64k sectors should be allowed
<span style="color:black">BIOSDATA:1EC0                 </span><span style="color:navy">sbb     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:1EC3                 </span><span style="color:navy">add     ax, es:[bx+</span><span style="color:#ff8000">8</span><span style="color:navy">]   </span>; sectors in partition
<span style="color:black">BIOSDATA:1EC7                 </span><span style="color:navy">adc     dx, es:[bx+</span><span style="color:green">10</span><span style="color:navy">]
</span><span style="color:black">BIOSDATA:1ECB                 </span><span style="color:navy">jnb     short </span><span style="color:gray">okdrive
</span><span style="color:black">BIOSDATA:1ECD                 </span><span style="color:navy">or      ds:</span>fbigfat<span style="color:navy">, </span><span style="color:green">80h </span>; ftoobig
<span style="color:black">BIOSDATA:1ED2
BIOSDATA:1ED2 </span><span style="color:gray">okdrive</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1ED2                 </span><span style="color:navy">mov     ax, es:[bx+</span><span style="color:#ff8000">4</span><span style="color:navy">]
</span><span style="color:black">BIOSDATA:1ED6                 </span><span style="color:navy">mov     [di+</span><span style="color:green">23</span><span style="color:navy">], ax     </span>; [di+BDS.hiddensecs]
<span style="color:black">BIOSDATA:1ED6                                         </span>; BPB_HIDDENSECTORS = p-&gt;partitionbegin
<span style="color:black">BIOSDATA:1ED9                 </span><span style="color:navy">mov     ax, es:[bx+</span><span style="color:#ff8000">6</span><span style="color:navy">]
</span><span style="color:black">BIOSDATA:1EDD                 </span><span style="color:navy">mov     [di+</span><span style="color:green">25</span><span style="color:navy">], ax     </span>; [di+BDS.hiddensecs+2]
<span style="color:black">BIOSDATA:1EE0                 </span><span style="color:navy">mov     dx, es:[bx+</span><span style="color:green">10</span><span style="color:navy">]  </span>; # of sectors (high)
<span style="color:black">BIOSDATA:1EE4                 </span><span style="color:navy">mov     ax, es:[bx+</span><span style="color:#ff8000">8</span><span style="color:navy">]   </span>; # of sectors (low)
<span style="color:black">BIOSDATA:1EE8                 </span><span style="color:navy">mov     [di+</span><span style="color:green">29</span><span style="color:navy">], dx     </span>; [di+BDS.totalsecs32+2]
<span style="color:black">BIOSDATA:1EEB                 </span><span style="color:navy">mov     [di+</span><span style="color:green">27</span><span style="color:navy">], ax     </span>; [di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:1EEB                                         </span>; bpb-&gt;maxsec = p-&gt;partitionlength
<span style="color:black">BIOSDATA:1EEE                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:1EF1                 </span><span style="color:navy">ja      short </span><span style="color:gray">okdrive_cont
</span><span style="color:black">BIOSDATA:1EF3                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">64          </span>; if (p-&gt;partitionlength &lt; 64)
<span style="color:black">BIOSDATA:1EF6                 </span><span style="color:navy">jb      short </span><span style="color:gray">setret    </span>; return -1;
<span style="color:black">BIOSDATA:1EF8
BIOSDATA:1EF8 </span><span style="color:gray">okdrive_cont</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1EF8                 </span><span style="color:navy">mov     dx, [di+</span><span style="color:green">25</span><span style="color:navy">]     </span>; [di+BDS.hiddensecs+2]
<span style="color:black">BIOSDATA:1EFB                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">23</span><span style="color:navy">]     </span>; [di+BDS.hiddensecs]
<span style="color:black">BIOSDATA:1EFE                 </span><span style="color:navy">xor     bx, bx          </span>; boot sector number - for mini disk
<span style="color:black">BIOSDATA:1EFE                                         </span>; usually equal to the # of sec/trk.
<span style="color:black">BIOSDATA:1F00                 </span><span style="color:navy">mov     bl, [di+</span><span style="color:green">19</span><span style="color:navy">]     </span>; [di+BDS.secpertrack]
<span style="color:black">BIOSDATA:1F03                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:1F04                 </span><span style="color:navy">mov     ax, dx
</span><span style="color:black">BIOSDATA:1F06                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:1F08                 </span><span style="color:navy">div     bx
</span><span style="color:black">BIOSDATA:1F0A                 </span><span style="color:navy">mov     cs:</span>temp_h<span style="color:navy">, ax
</span><span style="color:black">BIOSDATA:1F0E                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:1F0F                 </span><span style="color:navy">div     bx              </span>; (sectors)dx:ax / (BDS.secpertrack)bx =
<span style="color:black">BIOSDATA:1F0F                                         </span>; (track)temp_h:ax + (sector)dx
<span style="color:black">BIOSDATA:1F11                 </span><span style="color:navy">mov     cl, dl
</span><span style="color:black">BIOSDATA:1F13                 </span><span style="color:navy">inc     cl
</span><span style="color:black">BIOSDATA:1F15                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:black">BIOSDATA:1F17                 </span><span style="color:navy">mov     bl, [di+</span><span style="color:green">21</span><span style="color:navy">]     </span>; [di+BDS.heads]
<span style="color:black">BIOSDATA:1F1A                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:1F1B                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:1F1D                 </span><span style="color:navy">mov     ax, cs:</span>temp_h
<span style="color:black">BIOSDATA:1F21                 </span><span style="color:navy">div     bx              </span>; dl is head, ax is cylinder
<span style="color:black">BIOSDATA:1F23                 </span><span style="color:navy">mov     cs:</span>temp_h<span style="color:navy">, ax
</span><span style="color:black">BIOSDATA:1F27                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:1F28                 </span><span style="color:navy">div     bx
</span><span style="color:black">BIOSDATA:1F2A                 </span><span style="color:navy">cmp     cs:</span>temp_h<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:1F30                 </span><span style="color:navy">ja      short </span><span style="color:gray">setret_brdg </span>; exceeds the limit of int 13h
<span style="color:black">BIOSDATA:1F32                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">1024
</span><span style="color:black">BIOSDATA:1F35                 </span><span style="color:navy">ja      short </span><span style="color:gray">setret_brdg </span>; exceeds the limit of int 13h
<span style="color:black">BIOSDATA:1F35                                         </span>; Retro DOS v3.2 note by Erdogan Tan - 28/07/2019
<span style="color:black">BIOSDATA:1F35                                         </span>; **MSDOS code accepts if ax = 1024 but it is nonsense here
<span style="color:black">BIOSDATA:1F35                                         </span>; (&#039;ja&#039; must be &#039;jnb&#039;)
<span style="color:black">BIOSDATA:1F37                 </span><span style="color:navy">cmp     word ptr [di+</span><span style="color:green">71</span><span style="color:navy">], </span><span style="color:#ff8000">1 </span>; [di+BDS.bdsm_ismini]
<span style="color:black">BIOSDATA:1F37                                         </span>; check for mini disk
<span style="color:black">BIOSDATA:1F3B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">oknotmini </span>; not mini disk.
<span style="color:black">BIOSDATA:1F3D                 </span><span style="color:navy">add     ax, [di+</span><span style="color:green">73</span><span style="color:navy">]     </span>; [di+BDS.bdsm_hidden_trks]
<span style="color:black">BIOSDATA:1F3D                                         </span>; set the physical track number
<span style="color:black">BIOSDATA:1F40
BIOSDATA:1F40 </span><span style="color:gray">oknotmini</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1F40                 </span><span style="color:navy">ror     ah, </span><span style="color:green">1           </span>; move high two bits of cyl to high
<span style="color:black">BIOSDATA:1F42                 </span><span style="color:navy">ror     ah, </span><span style="color:green">1           </span>; two bits of upper byte
<span style="color:black">BIOSDATA:1F44                 </span><span style="color:navy">and     ah, </span><span style="color:green">0C0h        </span>; turn off remainder of bits
<span style="color:black">BIOSDATA:1F47                 </span><span style="color:navy">or      cl, ah          </span>; move two bits to correct spot
<span style="color:black">BIOSDATA:1F49                 </span><span style="color:navy">mov     ch, al          </span>; ch is cylinder (low 8 bits)
<span style="color:black">BIOSDATA:1F49                                         </span>; cl is sector + 2 high bits of cylinder
<span style="color:black">BIOSDATA:1F4B                 </span><span style="color:navy">mov     dh, dl          </span>; dh is head
<span style="color:black">BIOSDATA:1F4D                 </span><span style="color:navy">mov     dl, cs:</span>rom_drv_num ; dl is drive number
<span style="color:black">BIOSDATA:1F52                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:1F53                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:1F54                 </span>assume es:nothing
<span style="color:black">BIOSDATA:1F54                 </span><span style="color:navy">mov     bx, offset </span>disksector
<span style="color:black">BIOSDATA:1F57                 </span><span style="color:navy">mov     ax, </span><span style="color:green">201h
</span><span style="color:black">BIOSDATA:1F5A                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - READ SECTORS INTO MEMORY
<span style="color:black">BIOSDATA:1F5A                                         </span>; AL = number of sectors to read, CH = track, CL = sector
<span style="color:black">BIOSDATA:1F5A                                         </span>; DH = head, DL = drive, ES:BX -&gt; buffer to fill
<span style="color:black">BIOSDATA:1F5A                                         </span>; Return: CF set on error, AH = status, AL = number of sectors read
<span style="color:black">BIOSDATA:1F5C                 </span><span style="color:navy">mov     bx, offset </span>disksector
<span style="color:black">BIOSDATA:1F5F                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:1F60                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:1F61                 </span><span style="color:navy">cmp     byte ptr cs:[bx], </span><span style="color:green">0E9h </span>; is it a near jump?
<span style="color:black">BIOSDATA:1F65                 </span><span style="color:navy">jz      short </span><span style="color:gray">check_1_ok </span>; yes
<span style="color:black">BIOSDATA:1F67                 </span><span style="color:navy">cmp     byte ptr cs:[bx], </span><span style="color:green">0EBh </span>; is it a short jump?
<span style="color:black">BIOSDATA:1F6B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">invalid_boot_record </span>; no
<span style="color:black">BIOSDATA:1F6D                 </span><span style="color:navy">cmp     byte ptr cs:[bx+</span><span style="color:#ff8000">2</span><span style="color:navy">], </span><span style="color:green">90h </span>; yes, is the next one a nop?
<span style="color:black">BIOSDATA:1F72                 </span><span style="color:navy">jnz     short </span><span style="color:gray">invalid_boot_record
</span><span style="color:black">BIOSDATA:1F74
BIOSDATA:1F74 </span><span style="color:gray">check_1_ok</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1F74                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">159h        </span>; disksector+EXT_BOOT.BPB
<span style="color:black">BIOSDATA:1F74                                         </span>; point to the bpb in the boot record
<span style="color:black">BIOSDATA:1F77                 </span><span style="color:navy">mov     al, cs:[bx+</span><span style="color:green">10</span><span style="color:navy">]  </span>; [bx+EBPB.MEDIADESCRIPTOR]
<span style="color:black">BIOSDATA:1F77                                         </span>; get the mediadescriptor byte
<span style="color:black">BIOSDATA:1F7B                 </span><span style="color:navy">and     al, </span><span style="color:green">0F0h        </span>; mask off low nibble
<span style="color:black">BIOSDATA:1F7D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0F0h </span><span style="color:gray">; &#039;&#039;  </span>; is high nibble = 0Fh?
<span style="color:black">BIOSDATA:1F7F                 </span><span style="color:navy">jnz     short </span><span style="color:gray">invalid_boot_record </span>; no, invalid boot record
<span style="color:black">BIOSDATA:1F81                 </span><span style="color:navy">cmp     word ptr cs:[bx], </span><span style="color:green">512 </span>; [bx+EBPB.BYTESPERSECTOR]
<span style="color:black">BIOSDATA:1F86                 </span><span style="color:navy">jnz     short </span><span style="color:gray">invalid_boot_record </span>; invalidate non 512 byte sectors
<span style="color:black">BIOSDATA:1F88
BIOSDATA:1F88 </span>check_2_ok<span style="color:navy">:                             </span>; yes, mediadescriptor ok.
<span style="color:black">BIOSDATA:1F88                 </span><span style="color:navy">mov     al, cs:[bx+</span><span style="color:#ff8000">2</span><span style="color:navy">]   </span>; now make sure that the sectorspercluster is a power of 2
<span style="color:black">BIOSDATA:1F88                                         </span>; [bx+EBPB.SECTORSPERCLUSTER]
<span style="color:black">BIOSDATA:1F88                                         </span>; get the sectorspercluster
<span style="color:black">BIOSDATA:1F8C                 </span><span style="color:navy">or      al, al          </span>; is it zero?
<span style="color:black">BIOSDATA:1F8E                 </span><span style="color:navy">jz      short </span><span style="color:gray">invalid_boot_record </span>; yes, invalid boot record
<span style="color:black">BIOSDATA:1F90
BIOSDATA:1F90 </span><span style="color:gray">ck_power_of_two</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1F90                 </span><span style="color:navy">shr     al, </span><span style="color:green">1           </span>; shift until first bit emerges
<span style="color:black">BIOSDATA:1F92                 </span><span style="color:navy">jnb     short </span><span style="color:gray">ck_power_of_two
</span><span style="color:black">BIOSDATA:1F94                 </span><span style="color:navy">jz      short </span><span style="color:gray">valid_boot_record
</span><span style="color:black">BIOSDATA:1F96
BIOSDATA:1F96 </span><span style="color:gray">invalid_boot_record</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1F96                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:1F97                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:1F98                 </span><span style="color:navy">jmp     </span><span style="color:gray">unknown         </span>; jump to invalid boot record
<span style="color:black">BIOSDATA:1F98                                         </span>; unformatted or illegal media.
<span style="color:black">BIOSDATA:1F9B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:1F9B
BIOSDATA:1F9B </span><span style="color:gray">valid_boot_record</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1F9B                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:1F9C                 </span><span style="color:navy">pop     bx              </span>; Signature found. Now check version.
<span style="color:black">BIOSDATA:1F9D                 </span><span style="color:navy">cmp     word ptr cs:[bx+</span><span style="color:#ff8000">8</span><span style="color:navy">], &#039;</span><span style="color:green">.2&#039; </span>; &#039;2.&#039; (NASM syntax)
<span style="color:black">BIOSDATA:1FA3                 </span><span style="color:navy">jnz     short </span><span style="color:gray">try5
</span><span style="color:black">BIOSDATA:1FA5                 </span><span style="color:navy">cmp     byte ptr cs:[bx+</span><span style="color:green">10</span><span style="color:navy">], &#039;</span><span style="color:green">0&#039;
</span><span style="color:black">BIOSDATA:1FAA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">try5
</span><span style="color:black">BIOSDATA:1FAC                 </span><span style="color:navy">jmp     short </span><span style="color:gray">copybpb
</span><span style="color:black">BIOSDATA:1FAE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:1FAE
BIOSDATA:1FAE </span><span style="color:gray">setret_brdg</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1FAE                 </span><span style="color:navy">jmp     </span><span style="color:gray">setret
</span><span style="color:black">BIOSDATA:1FB1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:1FB1
BIOSDATA:1FB1 </span><span style="color:gray">unknown3_0_j</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1FB1                 </span><span style="color:navy">jmp     </span><span style="color:gray">unknown3_0      </span>; legally formatted media,
<span style="color:black">BIOSDATA:1FB1                                         </span>; although, content might be bad.
<span style="color:black">BIOSDATA:1FB4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:1FB4
BIOSDATA:1FB4 </span><span style="color:gray">try5</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1FB4                 </span><span style="color:navy">call    </span>cover_fdisk_bug
<span style="color:black">BIOSDATA:1FB7                 </span><span style="color:navy">cmp     word ptr cs:[bx+</span><span style="color:#ff8000">8</span><span style="color:navy">], &#039;</span><span style="color:green">.0&#039; </span>; &#039;0.&#039; (NASM syntax)
<span style="color:black">BIOSDATA:1FBD                 </span><span style="color:navy">jnz     short </span><span style="color:gray">no_os2
</span><span style="color:black">BIOSDATA:1FBF                 </span><span style="color:navy">mov     al, cs:[bx+</span><span style="color:#ff8000">7</span><span style="color:navy">]
</span><span style="color:black">BIOSDATA:1FC3                 </span><span style="color:navy">sub     al, &#039;</span><span style="color:green">1&#039;
</span><span style="color:black">BIOSDATA:1FC5                 </span><span style="color:navy">and     al, </span><span style="color:green">0FEh
</span><span style="color:black">BIOSDATA:1FC7                 </span><span style="color:navy">jz      short </span><span style="color:gray">copybpb   </span>; accept either &#039;1&#039; or &#039;2&#039;
<span style="color:black">BIOSDATA:1FC9                 </span><span style="color:navy">jmp     </span><span style="color:gray">unknown
</span><span style="color:black">BIOSDATA:1FCC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:1FCC
BIOSDATA:1FCC </span><span style="color:gray">no_os2</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1FCC                 </span><span style="color:navy">cmp     word ptr cs:[bx+</span><span style="color:#ff8000">8</span><span style="color:navy">], &#039;</span><span style="color:green">.3&#039; </span>; &#039;3.&#039; (NASM syntax)
<span style="color:black">BIOSDATA:1FD2                 </span><span style="color:navy">jb      short </span><span style="color:gray">unknown3_0_j </span>; must be 2.1 boot record.
<span style="color:black">BIOSDATA:1FD2                                         </span>; do not trust it, but still legal.
<span style="color:black">BIOSDATA:1FD4                 </span><span style="color:navy">jnz     short </span><span style="color:gray">copybpb   </span>; honor os2 boot record or dos 4.0 version
<span style="color:black">BIOSDATA:1FD6                 </span><span style="color:navy">cmp     byte ptr cs:[bx+</span><span style="color:green">10</span><span style="color:navy">], &#039;</span><span style="color:green">1&#039; </span>; if version &gt;= 3.1, then o.k.
<span style="color:black">BIOSDATA:1FDB                 </span><span style="color:navy">jb      short </span><span style="color:gray">unknown3_0_j
</span><span style="color:black">BIOSDATA:1FDD
BIOSDATA:1FDD </span><span style="color:gray">copybpb</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:1FDD                 </span><span style="color:navy">cmp     cs:</span>disksector<span style="color:navy">+</span><span style="color:green">26h</span><span style="color:navy">, </span><span style="color:green">29h </span>; [disksector+EXT_BOOT.SIG],EXT_BOOT_SIGNATURE
<span style="color:black">BIOSDATA:1FE3                 </span><span style="color:navy">jnz     short </span><span style="color:gray">copybpb_fat </span>; conventional fat system
<span style="color:black">BIOSDATA:1FE5                 </span><span style="color:navy">cmp     cs:</span>disksector<span style="color:navy">+</span><span style="color:green">10h</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:1FEB                 </span><span style="color:navy">jnz     short </span><span style="color:gray">copybpb_fat </span>; a fat system.
<span style="color:black">BIOSDATA:1FED                 </span><span style="color:navy">push    di              </span>; non fat based media.
<span style="color:black">BIOSDATA:1FEE                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:1FEF                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:1FF0                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:1FF1                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:1FF2                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:1FF3                 </span><span style="color:navy">mov     si, (offset </span>disksector<span style="color:navy">+</span><span style="color:green">0Bh</span><span style="color:navy">) </span>; disksector+EXT_BOOT.BPB
<span style="color:black">BIOSDATA:1FF6                 </span><span style="color:navy">add     di, </span><span style="color:#ff8000">6           </span>; add di,BDS.BPB
<span style="color:black">BIOSDATA:1FF9                 </span><span style="color:navy">cmp     word ptr cs:[si+</span><span style="color:#ff8000">8</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [cs:si+EBPB.TOTALSECTORS]
<span style="color:black">BIOSDATA:1FFE                 </span><span style="color:navy">jnz     short </span><span style="color:gray">already_nonz
</span><span style="color:black">BIOSDATA:2000                 </span><span style="color:navy">cmp     word ptr cs:[si+</span><span style="color:green">21</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [cs:si+EBPB.BIGTOTALSECTORS]
<span style="color:black">BIOSDATA:2005                 </span><span style="color:navy">jnz     short </span><span style="color:gray">already_nonz
</span><span style="color:black">BIOSDATA:2007                 </span><span style="color:navy">cmp     word ptr cs:[si+</span><span style="color:green">23</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [cs:si+EBPB.BIGTOTALSECTORS+2]
<span style="color:black">BIOSDATA:200C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">already_nonz
</span><span style="color:black">BIOSDATA:200E                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:#ff8000">8</span><span style="color:navy">]      </span>; [di+BDS.totalsecs16]
<span style="color:black">BIOSDATA:2011                 </span><span style="color:navy">mov     cs:[si+</span><span style="color:#ff8000">8</span><span style="color:navy">], ax   </span>; [cs:si+EBPB.TOTALSECTORS]
<span style="color:black">BIOSDATA:2015                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">21</span><span style="color:navy">]     </span>; [di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:2018                 </span><span style="color:navy">mov     cs:[si+</span><span style="color:green">21</span><span style="color:navy">], ax  </span>; [cs:si+EBPB.BIGTOTALSECTORS]
<span style="color:black">BIOSDATA:201C                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">23</span><span style="color:navy">]     </span>; [di+BDS.totalsecs32+2]
<span style="color:black">BIOSDATA:201F                 </span><span style="color:navy">mov     cs:[si+</span><span style="color:green">23</span><span style="color:navy">], ax  </span>; [cs:si+EBPB.BIGTOTALSECTORS+2]
<span style="color:black">BIOSDATA:2023
BIOSDATA:2023 </span><span style="color:gray">already_nonz</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2023                 </span><span style="color:navy">mov     cx, </span><span style="color:green">25          </span>; A_BPB.size - 6 ; Use SMALL version!
<span style="color:black">BIOSDATA:2026                 </span><span style="color:navy">rep movsb
</span><span style="color:black">BIOSDATA:2028                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:2029                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:202A                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:202B                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:202C                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:202D                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:202E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:202F                 </span><span style="color:navy">mov     bp, offset </span>mov_media_ids
<span style="color:black">BIOSDATA:2032                 </span><span style="color:navy">push    cs              </span>; simulate far call
<span style="color:black">BIOSDATA:2033                 </span><span style="color:navy">call    near ptr </span>call_bios_code
<span style="color:black">BIOSDATA:2036                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:2037                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:2038                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:2039                 </span>assume es:nothing
<span style="color:black">BIOSDATA:2039                 </span><span style="color:navy">jmp     </span>goodret
<span style="color:black">BIOSDATA:203C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:203C
BIOSDATA:203C </span><span style="color:gray">copybpb_fat</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:203C                 </span><span style="color:navy">mov     si, (offset </span>disksector<span style="color:navy">+</span><span style="color:green">0Bh</span><span style="color:navy">) </span>; disksector+EXT_BOOT.BPB
<span style="color:black">BIOSDATA:203C                                         </span>; cs:si -&gt; bpb in boot
<span style="color:black">BIOSDATA:203F                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:2041                 </span><span style="color:navy">mov     ax, cs:[si+</span><span style="color:#ff8000">8</span><span style="color:navy">]   </span>; [cs:si+EBPB.TOTALSECTORS]
<span style="color:black">BIOSDATA:2041                                         </span>; get totsec from boot sec
<span style="color:black">BIOSDATA:2045                 </span><span style="color:navy">or      ax, ax
</span><span style="color:black">BIOSDATA:2047                 </span><span style="color:navy">jnz     short </span><span style="color:gray">copy_totsec </span>; if non zero, use that
<span style="color:black">BIOSDATA:2049                 </span><span style="color:navy">mov     ax, cs:[si+</span><span style="color:green">21</span><span style="color:navy">]  </span>; [cs:si+EBPB.BIGTOTALSECTORS]
<span style="color:black">BIOSDATA:2049                                         </span>; get the big version (32 bit total sectors)
<span style="color:black">BIOSDATA:204D                 </span><span style="color:navy">mov     dx, cs:[si+</span><span style="color:green">23</span><span style="color:navy">]  </span>; [cs:si+EBPB.BIGTOTALSECTORS+2]
<span style="color:black">BIOSDATA:2051                 </span><span style="color:navy">mov     cx, dx          </span>; see if it is a big zero
<span style="color:black">BIOSDATA:2051                                         </span>; 10/12/2022
<span style="color:black">BIOSDATA:2051                                         </span>; mov bx,ax
<span style="color:black">BIOSDATA:2051                                         </span>; or bx,ax
<span style="color:black">BIOSDATA:2053                 </span><span style="color:navy">or      cx, ax
</span><span style="color:black">BIOSDATA:2055                 </span><span style="color:navy">jz      short </span><span style="color:gray">totsec_already_set
</span><span style="color:black">BIOSDATA:2057
BIOSDATA:2057 </span><span style="color:gray">copy_totsec</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2057                 </span><span style="color:navy">mov     [di+</span><span style="color:green">27</span><span style="color:navy">], ax     </span>; [di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:2057                                         </span>; make DPB match boot sec
<span style="color:black">BIOSDATA:205A                 </span><span style="color:navy">mov     [di+</span><span style="color:green">29</span><span style="color:navy">], dx     </span>; [di+BDS.totalsecs32+2]
<span style="color:black">BIOSDATA:205D
BIOSDATA:205D </span><span style="color:gray">totsec_already_set</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:205D                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">27</span><span style="color:navy">]     </span>; [di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:2060                 </span><span style="color:navy">mov     dx, [di+</span><span style="color:green">29</span><span style="color:navy">]     </span>; [di+BDS.totalsecs32+2]
<span style="color:black">BIOSDATA:2063                 </span><span style="color:navy">mov     bx, cs:[si+</span><span style="color:#ff8000">3</span><span style="color:navy">]   </span>; [cs:si+EBPB.RESERVEDSECTORS]
<span style="color:black">BIOSDATA:2063                                         </span>; get #reserved_sectors from BPB
<span style="color:black">BIOSDATA:2067                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">9</span><span style="color:navy">], bx      </span>; [di+BDS.resectors] ; update BDS field
<span style="color:black">BIOSDATA:206A                 </span><span style="color:navy">sub     ax, bx
</span><span style="color:black">BIOSDATA:206C                 </span><span style="color:navy">sbb     dx, </span><span style="color:#ff8000">0           </span>; update the count
<span style="color:black">BIOSDATA:206F                 </span><span style="color:navy">mov     bx, cs:[si+</span><span style="color:green">11</span><span style="color:navy">]  </span>; [cs:si+EBPB.SECTORSPERFAT] ; bx = sectors/fat
<span style="color:black">BIOSDATA:2073                 </span><span style="color:navy">mov     [di+</span><span style="color:green">17</span><span style="color:navy">], bx     </span>; [di+BDS.fatsecs] ; set in bds bpb
<span style="color:black">BIOSDATA:2076                 </span><span style="color:navy">shl     bx, </span><span style="color:green">1           </span>; always 2 fats (may be 1 fat!?)
<span style="color:black">BIOSDATA:2076                                         </span>; 10/12/2022
<span style="color:black">BIOSDATA:2076                                         </span>; (number of FATs optimization)
<span style="color:black">BIOSDATA:2076                                         </span>; CL = number of FATs (2 or 1)
<span style="color:black">BIOSDATA:2076                                         </span>; dec cx
<span style="color:black">BIOSDATA:2076                                         </span>; shl bx, cl
<span style="color:black">BIOSDATA:2078                 </span><span style="color:navy">sub     ax, bx          </span>; sub # fat sectors
<span style="color:black">BIOSDATA:207A                 </span><span style="color:navy">sbb     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:207D                 </span><span style="color:navy">mov     bx, cs:[si+</span><span style="color:#ff8000">6</span><span style="color:navy">]   </span>; [cs:si+EBPB.ROOTENTRIES]
<span style="color:black">BIOSDATA:207D                                         </span>; # root entries
<span style="color:black">BIOSDATA:2081                 </span><span style="color:navy">mov     [di+</span><span style="color:green">12</span><span style="color:navy">], bx     </span>; [di+BDS.direntries]
<span style="color:black">BIOSDATA:2081                                         </span>; set in bds bpb
<span style="color:black">BIOSDATA:2084                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4
</span><span style="color:black">BIOSDATA:2086                 </span><span style="color:navy">shr     bx, cl          </span>; div by 16 ents/sector
<span style="color:black">BIOSDATA:2088                 </span><span style="color:navy">sub     ax, bx          </span>; sub # dir sectors
<span style="color:black">BIOSDATA:208A                 </span><span style="color:navy">sbb     dx, </span><span style="color:#ff8000">0           </span>; dx:ax now contains the # of data sectors
<span style="color:black">BIOSDATA:208D                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">BIOSDATA:208F                 </span><span style="color:navy">mov     cl, cs:[si+</span><span style="color:#ff8000">2</span><span style="color:navy">]   </span>; [cs:si+EBPB.SECTORSPERCLUSTER]
<span style="color:black">BIOSDATA:208F                                         </span>; sectors per cluster
<span style="color:black">BIOSDATA:2093                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">8</span><span style="color:navy">], cl      </span>; [di+BDS.secperclus]
<span style="color:black">BIOSDATA:2093                                         </span>; set in bios bpb
<span style="color:black">BIOSDATA:2096                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:2097                 </span><span style="color:navy">mov     ax, dx
</span><span style="color:black">BIOSDATA:2099                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:209B                 </span><span style="color:navy">div     cx              </span>; cx = sectors per cluster
<span style="color:black">BIOSDATA:209D                 </span><span style="color:navy">mov     cs:</span>temp_h<span style="color:navy">, ax   </span>; [temp_h]:ax now contains the # clusters.
<span style="color:black">BIOSDATA:20A1                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:20A2                 </span><span style="color:navy">div     cx
</span><span style="color:black">BIOSDATA:20A4                 </span><span style="color:navy">cmp     cs:</span>temp_h<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:20AA                 </span><span style="color:navy">ja      short </span>toobig_ret ; too big cluster number
<span style="color:black">BIOSDATA:20AC                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FF6h       </span>; 4096-10
<span style="color:black">BIOSDATA:20AC                                         </span>; is this 16-bit fat?
<span style="color:black">BIOSDATA:20AF                 </span><span style="color:navy">jb      short </span><span style="color:gray">copymediaid </span>; no, small fat
<span style="color:black">BIOSDATA:20B1                 </span><span style="color:navy">or      ds:</span>fbigfat<span style="color:navy">, </span><span style="color:green">40h </span>; fbig ; 16 bit fat
<span style="color:black">BIOSDATA:20B6
BIOSDATA:20B6 </span><span style="color:gray">copymediaid</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:20B6                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:20B7                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:20B8                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:20B9                 </span>assume es:nothing
<span style="color:black">BIOSDATA:20B9                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:20BA                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:20BB                 </span><span style="color:navy">mov     bp, offset </span>mov_media_ids
<span style="color:black">BIOSDATA:20BE                 </span><span style="color:navy">push    cs              </span>; simulate far call
<span style="color:black">BIOSDATA:20BF                 </span><span style="color:navy">call    near ptr </span>call_bios_code
<span style="color:black">BIOSDATA:20C2                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:20C3                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:20C4                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:20C5                 </span>assume es:nothing
<span style="color:black">BIOSDATA:20C5                 </span><span style="color:navy">jmp     </span><span style="color:gray">massage_bpb     </span>; now final check for bpb info and return.
<span style="color:black">BIOSDATA:20C8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:20C8
BIOSDATA:20C8 </span>toobig_ret<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:20C8                 </span><span style="color:navy">or      cs:</span>fbigfat<span style="color:navy">, </span><span style="color:green">80h
</span><span style="color:black">BIOSDATA:20CE                 </span><span style="color:navy">jmp     </span>goodret         ; still drive letter is   assigned but useless.
<span style="color:black">BIOSDATA:20CE                                         </span>; to big for current pc dos fat file system
<span style="color:black">BIOSDATA:20D1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:20D1
BIOSDATA:20D1 </span><span style="color:gray">unknown</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:20D1                 </span><span style="color:navy">or      word ptr [di+</span><span style="color:green">35</span><span style="color:navy">], </span><span style="color:green">200h </span>; unformatted_media
<span style="color:black">BIOSDATA:20D1                                         </span>; Set unformatted media flag.
<span style="color:black">BIOSDATA:20D6
BIOSDATA:20D6 </span><span style="color:gray">unknown3_0</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:20D6                 </span><span style="color:navy">mov     dx, [di+</span><span style="color:green">29</span><span style="color:navy">]     </span>; skip setting unformatted_media bit
<span style="color:black">BIOSDATA:20D6                                         </span>; [di+BDS.totalsecs32+2]
<span style="color:black">BIOSDATA:20D9                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">27</span><span style="color:navy">]     </span>; [di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:20DC                 </span><span style="color:navy">mov     si, offset </span>disktable2
<span style="color:black">BIOSDATA:20DF
BIOSDATA:20DF </span>scan<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:20DF                 </span><span style="color:navy">cmp     dx, cs:[si]
</span><span style="color:black">BIOSDATA:20E2                 </span><span style="color:navy">jb      short </span>gotparm
<span style="color:black">BIOSDATA:20E4                 </span><span style="color:navy">ja      short </span><span style="color:gray">scan_next
</span><span style="color:black">BIOSDATA:20E6                 </span><span style="color:navy">cmp     ax, cs:[si+</span><span style="color:#ff8000">2</span><span style="color:navy">]
</span><span style="color:black">BIOSDATA:20EA                 </span><span style="color:navy">jbe     short </span>gotparm
<span style="color:black">BIOSDATA:20EC
BIOSDATA:20EC </span><span style="color:gray">scan_next</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:20EC                 </span><span style="color:navy">add     si, </span><span style="color:green">10          </span>; 5*2
<span style="color:black">BIOSDATA:20EF                 </span><span style="color:navy">jmp     short </span>scan      ; covers upto 512 mb media
<span style="color:black">BIOSDATA:20F1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:20F1
BIOSDATA:20F1 </span>gotparm<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:20F1                 </span><span style="color:navy">mov     cl, [si+</span><span style="color:#ff8000">8</span><span style="color:navy">]      </span>; fat size for fbigfat flag
<span style="color:black">BIOSDATA:20F4                 </span><span style="color:navy">or      ds:</span>fbigfat<span style="color:navy">, cl
</span><span style="color:black">BIOSDATA:20F8                 </span><span style="color:navy">mov     cx, cs:[si+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; ch = number of sectors per cluster
<span style="color:black">BIOSDATA:20F8                                         </span>; cl = log base 2 of ch
<span style="color:black">BIOSDATA:20FC                 </span><span style="color:navy">mov     dx, cs:[si+</span><span style="color:#ff8000">6</span><span style="color:navy">]   </span>; dx = number of root dir entries
<span style="color:black">BIOSDATA:2100                 </span><span style="color:navy">mov     [di+</span><span style="color:green">12</span><span style="color:navy">], dx     </span>; [di+BDS.direntries]
<span style="color:black">BIOSDATA:2100                                         </span>; save number of (root) dir entries
<span style="color:black">BIOSDATA:2103                 </span><span style="color:navy">mov     dx, [di+</span><span style="color:green">29</span><span style="color:navy">]     </span>; [di+BDS.totalsecs32+2]
<span style="color:black">BIOSDATA:2106                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">27</span><span style="color:navy">]     </span>; [di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:2109                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">8</span><span style="color:navy">], ch      </span>; [di+BDS.secperclus]
<span style="color:black">BIOSDATA:2109                                         </span>; save sectors per cluster
<span style="color:black">BIOSDATA:210C                 </span><span style="color:navy">test    ds:</span>fbigfat<span style="color:navy">, </span><span style="color:green">40h </span>; fbig
<span style="color:black">BIOSDATA:210C                                         </span>; if (fbigfat)
<span style="color:black">BIOSDATA:2111                 </span><span style="color:navy">jnz     short </span>dobig     ; go to dobig (16 bit fat)
<span style="color:black">BIOSDATA:2113                 </span><span style="color:navy">xor     bx, bx          </span>; (12 bit fat)
<span style="color:black">BIOSDATA:2115                 </span><span style="color:navy">mov     bl, ch
</span><span style="color:black">BIOSDATA:2117                 </span><span style="color:navy">dec     bx
</span><span style="color:black">BIOSDATA:2118                 </span><span style="color:navy">add     bx, ax          </span>; dx=0
<span style="color:black">BIOSDATA:211A                 </span><span style="color:navy">shr     bx, cl          </span>; bx = 1+(bpb-&gt;maxsec+BDS.secperclus-1)/
<span style="color:black">BIOSDATA:211C                 </span><span style="color:navy">inc     bx              </span>; BDS.secperclus
<span style="color:black">BIOSDATA:211D                 </span><span style="color:navy">and     bl, </span><span style="color:green">0FEh        </span>; bx &amp;= ~1; (=number of clusters)
<span style="color:black">BIOSDATA:2120                 </span><span style="color:navy">mov     si, bx
</span><span style="color:black">BIOSDATA:2122                 </span><span style="color:navy">shr     bx, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:2124                 </span><span style="color:navy">add     bx, si
</span><span style="color:black">BIOSDATA:2126                 </span><span style="color:navy">add     bx, </span><span style="color:green">511         </span>; bx += 511 + bx/2
<span style="color:black">BIOSDATA:212A                 </span><span style="color:navy">shr     bh, </span><span style="color:green">1           </span>; bh &gt;&gt;= 1; (=bx/512)
<span style="color:black">BIOSDATA:212C                 </span><span style="color:navy">mov     [di+</span><span style="color:green">17</span><span style="color:navy">], bh     </span>; [di+BDS.fatsecs]
<span style="color:black">BIOSDATA:212C                                         </span>; save number of fat sectors
<span style="color:black">BIOSDATA:212F                 </span><span style="color:navy">jmp     short </span><span style="color:gray">massage_bpb
</span><span style="color:black">BIOSDATA:2131 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:2131
BIOSDATA:2131 </span>dobig<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2131                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4           </span>; 16 (2^4) directory entries per sector
<span style="color:black">BIOSDATA:2133                 </span><span style="color:navy">push    dx              </span>; save total sectors (high)
<span style="color:black">BIOSDATA:2134                 </span><span style="color:navy">mov     dx, [di+</span><span style="color:green">12</span><span style="color:navy">]     </span>; [di+BDS.direntries]
<span style="color:black">BIOSDATA:2137                 </span><span style="color:navy">shr     dx, cl          </span>; root dir sectors = BDS.direntries / 16;
<span style="color:black">BIOSDATA:2139                 </span><span style="color:navy">sub     ax, dx
</span><span style="color:black">BIOSDATA:213B                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:213C                 </span><span style="color:navy">sbb     dx, </span><span style="color:#ff8000">0           </span>; dx:ax = total sectors - root dir sectors
<span style="color:black">BIOSDATA:213F                 </span><span style="color:navy">sub     ax, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSDATA:2142                 </span><span style="color:navy">sbb     dx, </span><span style="color:#ff8000">0           </span>; dx:ax = t - r - d
<span style="color:black">BIOSDATA:2142                                         </span>; total secs - reserved secs - root dir secs
<span style="color:black">BIOSDATA:2145                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">2
</span><span style="color:black">BIOSDATA:2147                 </span><span style="color:navy">mov     bh, [di+</span><span style="color:#ff8000">8</span><span style="color:navy">]      </span>; [di+BDS.secperclus]
<span style="color:black">BIOSDATA:2147                                         </span>; bx = 256 * BDS.secperclus + 2
<span style="color:black">BIOSDATA:214A                 </span><span style="color:navy">add     ax, bx          </span>; ax = t-r-d+256*spc+2
<span style="color:black">BIOSDATA:214C                 </span><span style="color:navy">adc     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:214F                 </span><span style="color:navy">sub     ax, </span><span style="color:#ff8000">1           </span>; ax = t-r-d+256*spc+1
<span style="color:black">BIOSDATA:2152                 </span><span style="color:navy">sbb     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:2155                 </span><span style="color:navy">div     bx              </span>; BDS.fatsecs =
<span style="color:black">BIOSDATA:2155                                         </span>; ceil((total-dir-res)/(256*BDS.secperclus+2))
<span style="color:black">BIOSDATA:2157                 </span><span style="color:navy">mov     [di+</span><span style="color:green">17</span><span style="color:navy">], ax     </span>; [di+BDS.fatsecs]
<span style="color:black">BIOSDATA:2157                                         </span>; number of fat sectors
<span style="color:black">BIOSDATA:215A                 </span><span style="color:navy">mov     bl, ds:</span>fbigfat
<span style="color:black">BIOSDATA:215E                 </span><span style="color:navy">mov     [di+</span><span style="color:green">31</span><span style="color:navy">], bl     </span>; [di+BDS.fatsiz] ; fat size flag
<span style="color:black">BIOSDATA:2161                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:2162                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:2163                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:2164                 </span>assume es:nothing
<span style="color:black">BIOSDATA:2164                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:2165                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:2166                 </span><span style="color:navy">mov     bp, offset </span>clear_ids
<span style="color:black">BIOSDATA:2169                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:216A                 </span><span style="color:navy">call    near ptr </span>call_bios_code
<span style="color:black">BIOSDATA:216D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:216E
BIOSDATA:216E </span><span style="color:gray">massage_bpb</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:216E                 </span><span style="color:navy">mov     dx, [di+</span><span style="color:green">29</span><span style="color:navy">]     </span>; [di+BDS.totalsecs32+2]
<span style="color:black">BIOSDATA:2171                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">27</span><span style="color:navy">]     </span>; [di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:2174                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0           </span>; double word total sectors?
<span style="color:black">BIOSDATA:2177                 </span><span style="color:navy">ja      short </span>goodret   ; don&#039;t have to change it.
<span style="color:black">BIOSDATA:2179                 </span><span style="color:navy">cmp     word ptr [di+</span><span style="color:green">25</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [di+BDS.hiddensecs+2]
<span style="color:black">BIOSDATA:217D                 </span><span style="color:navy">ja      short </span>goodret   ; don&#039;t have to change it.
<span style="color:black">BIOSDATA:217F                 </span><span style="color:navy">add     ax, [di+</span><span style="color:green">23</span><span style="color:navy">]     </span>; [di+BDS.hiddensecs]
<span style="color:black">BIOSDATA:2182                 </span><span style="color:navy">jb      short </span>goodret
<span style="color:black">BIOSDATA:2184                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">27</span><span style="color:navy">]     </span>; [di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:2187                 </span><span style="color:navy">mov     [di+</span><span style="color:green">14</span><span style="color:navy">], ax     </span>; [di+BDS.totalsecs16]
<span style="color:black">BIOSDATA:218A                 </span><span style="color:navy">mov     word ptr [di+</span><span style="color:green">27</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:218F
BIOSDATA:218F </span>goodret<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:218F                 </span><span style="color:navy">mov     bl, ds:</span>fbigfat
<span style="color:black">BIOSDATA:2193                 </span><span style="color:navy">mov     [di+</span><span style="color:green">31</span><span style="color:navy">], bl     </span>; [di+BDS.fatsiz]
<span style="color:black">BIOSDATA:2193                                         </span>; set size of fat on media
<span style="color:black">BIOSDATA:2196                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSDATA:2197
BIOSDATA:2197 </span><span style="color:gray">ret_hard</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2197                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:2198                 </span>assume es:nothing
<span style="color:black">BIOSDATA:2198                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:2199                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:219A                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:219B                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:219B </span>sethard         endp
<span style="color:black">BIOSDATA:219B
BIOSDATA:219C
BIOSDATA:219C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:219C
BIOSDATA:219C
BIOSDATA:219C </span>cover_fdisk_bug proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:219C                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:219D                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:219E                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSDATA:219F                 </span><span style="color:navy">cmp     cs:</span>disksector<span style="color:navy">+</span><span style="color:green">26h</span><span style="color:navy">, </span><span style="color:green">29h </span>; disksector+EXT_BOOT.SIG],EXT_BOOT_SIGNATURE
<span style="color:black">BIOSDATA:21A5                 </span><span style="color:navy">jz      short </span><span style="color:gray">cfb_retit </span>; if extended bpb, then &gt;= pc dos 4.00
<span style="color:black">BIOSDATA:21A7                 </span><span style="color:navy">cmp     word ptr cs:[bx+</span><span style="color:#ff8000">7</span><span style="color:navy">], &#039;</span><span style="color:green">01&#039; </span>; &#039;10&#039; (NASM syntax) ; os2 1.0 = ibm 10.0
<span style="color:black">BIOSDATA:21AD                 </span><span style="color:navy">jnz     short </span><span style="color:gray">cfb_chk_BPB_TOTALSECTORS
</span><span style="color:black">BIOSDATA:21AF                 </span><span style="color:navy">cmp     byte ptr cs:[bx+</span><span style="color:#ff8000">0Ah</span><span style="color:navy">], &#039;</span><span style="color:green">0&#039;
</span><span style="color:black">BIOSDATA:21B4                 </span><span style="color:navy">jnz     short </span><span style="color:gray">cfb_retit
</span><span style="color:black">BIOSDATA:21B6
BIOSDATA:21B6 </span><span style="color:gray">cfb_chk_BPB_TOTALSECTORS</span><span style="color:navy">:               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:21B6                 </span><span style="color:navy">mov     si, (offset </span>disksector<span style="color:navy">+</span><span style="color:green">0Bh</span><span style="color:navy">) </span>; disksector+EXT_BOOT.BPB
<span style="color:black">BIOSDATA:21B9                 </span><span style="color:navy">cmp     word ptr cs:[si+</span><span style="color:#ff8000">8</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [cs:si+EBPB.TOTALSECTORS]
<span style="color:black">BIOSDATA:21B9                                         </span>; just to make sure.
<span style="color:black">BIOSDATA:21BE                 </span><span style="color:navy">jz      short </span><span style="color:gray">cfb_retit
</span><span style="color:black">BIOSDATA:21C0                 </span><span style="color:navy">mov     ax, cs:[si+</span><span style="color:#ff8000">8</span><span style="color:navy">]   </span>; [cs:si+EBPB.TOTALSECTORS]
<span style="color:black">BIOSDATA:21C4                 </span><span style="color:navy">add     ax, cs:[si+</span><span style="color:#ff8000">11h</span><span style="color:navy">] </span>; [cs:si+EBPB.HIDDENSECTORS]
<span style="color:black">BIOSDATA:21C8                 </span><span style="color:navy">jnb     short </span><span style="color:gray">cfb_retit
</span><span style="color:black">BIOSDATA:21CA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">cfb_retit </span>;
<span style="color:black">BIOSDATA:21CA                                         </span>; if carry set and ax=0
<span style="color:black">BIOSDATA:21CC                 </span><span style="color:navy">dec     word ptr cs:[si+</span><span style="color:#ff8000">8</span><span style="color:navy">] </span>; 0 -&gt; 0FFFFh
<span style="color:black">BIOSDATA:21CC                                         </span>; decrease BPB_TOTALSECTORS by 1
<span style="color:black">BIOSDATA:21D0                 </span><span style="color:navy">sub     word ptr [di+</span><span style="color:#ff8000">1Bh</span><span style="color:navy">], </span><span style="color:#ff8000">1 </span>; [di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:21D4                 </span><span style="color:navy">sbb     word ptr [di+</span><span style="color:#ff8000">1Dh</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [di+BDS.totalsecs32+2]
<span style="color:black">BIOSDATA:21D8
BIOSDATA:21D8 </span><span style="color:gray">cfb_retit</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:21D8                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSDATA:21D9                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:21DA                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:21DB                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:21DB </span>cover_fdisk_bug endp
<span style="color:black">BIOSDATA:21DB
BIOSDATA:21DB </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:21DC </span>word2           <span style="color:navy">dw </span><span style="color:#008040">2                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:21DE </span>word3           <span style="color:navy">dw </span><span style="color:#008040">3                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSDATA:21E0 </span>word512         <span style="color:navy">dw </span><span style="color:#008040">512                  </span><span style="color:#8080ff">; ...
</span><span style="color:black">BIOSDATA:21E2
BIOSDATA:21E2 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:21E2
BIOSDATA:21E2
BIOSDATA:21E2 </span>setdrvparms     proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:21E2                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:black">BIOSDATA:21E4                 </span><span style="color:navy">les     di, ds:</span>start_bds ; get first bds in list
<span style="color:black">BIOSDATA:21E8
BIOSDATA:21E8 </span><span style="color:gray">next_bds</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:21E8                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:21E9                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSDATA:21EA                 </span><span style="color:navy">mov     bl, es:[di+</span><span style="color:green">34</span><span style="color:navy">]  </span>; [es:di+BDS.formfactor]
<span style="color:black">BIOSDATA:21EE                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">5           </span>; ffHardFile
<span style="color:black">BIOSDATA:21F1                 </span><span style="color:navy">jnz     short </span><span style="color:gray">nothardff
</span><span style="color:black">BIOSDATA:21F3                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:21F5                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:green">14</span><span style="color:navy">]  </span>; [es:di+BDS.totalsecs16]
<span style="color:black">BIOSDATA:21F9                 </span><span style="color:navy">or      ax, ax
</span><span style="color:black">BIOSDATA:21FB                 </span><span style="color:navy">jnz     short </span><span style="color:gray">get_ccyl
</span><span style="color:black">BIOSDATA:21FD                 </span><span style="color:navy">mov     dx, es:[di+</span><span style="color:green">29</span><span style="color:navy">]  </span>; [es:di+BDS.totalsecs32+2]
<span style="color:black">BIOSDATA:2201                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:green">27</span><span style="color:navy">]  </span>; [es:di+BDS.totalsecs32]
<span style="color:black">BIOSDATA:2205
BIOSDATA:2205 </span><span style="color:gray">get_ccyl</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2205                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:2206                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:2207                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:green">21</span><span style="color:navy">]  </span>; [es:di+BDS.heads]
<span style="color:black">BIOSDATA:220B                 </span><span style="color:navy">mul     word ptr es:[di+</span><span style="color:green">19</span><span style="color:navy">] </span>; [es:di+BDS.secpertrack]
<span style="color:black">BIOSDATA:220B                                         </span>; assume sectors per cyl. &lt; 64k.
<span style="color:black">BIOSDATA:220F                 </span><span style="color:navy">mov     cx, ax          </span>; cx has # sectors per cylinder
<span style="color:black">BIOSDATA:2211                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:2212                 </span><span style="color:navy">pop     dx              </span>; dx:ax = total sectors
<span style="color:black">BIOSDATA:2213                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:2214                 </span><span style="color:navy">mov     ax, dx
</span><span style="color:black">BIOSDATA:2216                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:2218                 </span><span style="color:navy">div     cx
</span><span style="color:black">BIOSDATA:221A                 </span><span style="color:navy">mov     cs:</span>temp_h<span style="color:navy">, ax
</span><span style="color:black">BIOSDATA:221E                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:221F                 </span><span style="color:navy">div     cx              </span>; div #sec by sec/cyl to get # cyl.
<span style="color:black">BIOSDATA:2221                 </span><span style="color:navy">or      dx, dx
</span><span style="color:black">BIOSDATA:2223                 </span><span style="color:navy">jz      short </span><span style="color:gray">no_cyl_rnd </span>; came out even
<span style="color:black">BIOSDATA:2225                 </span><span style="color:navy">inc     ax              </span>; round up
<span style="color:black">BIOSDATA:2226
BIOSDATA:2226 </span><span style="color:gray">no_cyl_rnd</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2226                 </span><span style="color:navy">mov     es:[di+</span><span style="color:green">37</span><span style="color:navy">], ax  </span>; [es:di+BDS.cylinders]
<span style="color:black">BIOSDATA:222A                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:222B                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:222C                 </span>assume ds:nothing
<span style="color:black">BIOSDATA:222C                 </span><span style="color:navy">lea     si, [di+</span><span style="color:#ff8000">6</span><span style="color:navy">]      </span>; [di+BDS.bytespersec]
<span style="color:black">BIOSDATA:222C                                         </span>; ds:si -&gt; bpb for hard file
<span style="color:black">BIOSDATA:222F                 </span><span style="color:navy">jmp     short </span>set_recbpb
<span style="color:black">BIOSDATA:2231 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:2231
BIOSDATA:2231 </span><span style="color:gray">nothardff</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2231                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:2232                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:2233                 </span>assume ds:nothing
<span style="color:black">BIOSDATA:2233                 </span><span style="color:navy">cmp     cs:</span>fakefloppydrv<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSDATA:2239                 </span><span style="color:navy">jz      short </span><span style="color:gray">go_to_next_bds
</span><span style="color:black">BIOSDATA:223B                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">7           </span>; ffother
<span style="color:black">BIOSDATA:223B                                         </span>; special case &quot;other&quot; type of medium
<span style="color:black">BIOSDATA:223E                 </span><span style="color:navy">jnz     short </span><span style="color:gray">not_process_other
</span><span style="color:black">BIOSDATA:2240
BIOSDATA:2240 </span>process_other<span style="color:navy">:
</span><span style="color:black">BIOSDATA:2240                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:2242                 </span><span style="color:navy">mov     ax, [di+</span><span style="color:green">37</span><span style="color:navy">]     </span>; [di+BDS.cylinders]
<span style="color:black">BIOSDATA:2245                 </span><span style="color:navy">mul     word ptr [di+</span><span style="color:green">54</span><span style="color:navy">] </span>; [di+BDS.rheads]
<span style="color:black">BIOSDATA:2248                 </span><span style="color:navy">mul     word ptr [di+</span><span style="color:green">52</span><span style="color:navy">] </span>; [di+BDS.rsecpertrack]
<span style="color:black">BIOSDATA:224B                 </span><span style="color:navy">mov     [di+</span><span style="color:green">47</span><span style="color:navy">], ax     </span>; [di+BDS.rtotalsecs16]
<span style="color:black">BIOSDATA:224B                                         </span>; have the total number of sectors
<span style="color:black">BIOSDATA:224E                 </span><span style="color:navy">dec     ax
</span><span style="color:black">BIOSDATA:224F                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSDATA:2251
BIOSDATA:2251 </span><span style="color:gray">again</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2251                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FF6h       </span>; 4096-10
<span style="color:black">BIOSDATA:2254                 </span><span style="color:navy">jb      short </span>_@@
<span style="color:black">BIOSDATA:2256                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:2258                 </span><span style="color:navy">shl     dl, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:225A                 </span><span style="color:navy">jmp     short </span><span style="color:gray">again
</span><span style="color:black">BIOSDATA:225C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:225C
BIOSDATA:225C </span>_@@<span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:225C                 </span><span style="color:navy">cmp     dl, </span><span style="color:#ff8000">1           </span>; is it a small disk ?
<span style="color:black">BIOSDATA:225F                 </span><span style="color:navy">jz      short </span><span style="color:gray">__@@      </span>; yes, 224 root entries is enuf
<span style="color:black">BIOSDATA:2261                 </span><span style="color:navy">mov     word ptr [di+</span><span style="color:green">45</span><span style="color:navy">], </span><span style="color:green">240 </span>; [di+BDS.rdirentries]
<span style="color:black">BIOSDATA:2266
BIOSDATA:2266 </span><span style="color:gray">__@@</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2266                 </span><span style="color:navy">mov     [di+</span><span style="color:green">41</span><span style="color:navy">], dl     </span>; [di+BDS.rsecperclus]
<span style="color:black">BIOSDATA:2269                 </span><span style="color:navy">mul     cs:</span>word3        ; * 3
<span style="color:black">BIOSDATA:226E                 </span><span style="color:navy">div     cs:</span>word2        ; / 2
<span style="color:black">BIOSDATA:2273                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:2275                 </span><span style="color:navy">div     cs:</span>word512      ; / 512
<span style="color:black">BIOSDATA:227A                 </span><span style="color:navy">inc     ax              </span>; + 1
<span style="color:black">BIOSDATA:227B
BIOSDATA:227B </span>no_round_up<span style="color:navy">:                            </span>; [di+BDS.rfatsecs]
<span style="color:black">BIOSDATA:227B                 </span><span style="color:navy">mov     [di+</span><span style="color:green">50</span><span style="color:navy">], ax
</span><span style="color:black">BIOSDATA:227E                 </span><span style="color:navy">jmp     short </span><span style="color:gray">go_to_next_bds
</span><span style="color:black">BIOSDATA:2280 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:2280
BIOSDATA:2280 </span><span style="color:gray">not_process_other</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2280                 </span><span style="color:navy">shl     bx, </span><span style="color:green">1           </span>; bx is word index into table of bpbs
<span style="color:black">BIOSDATA:2282                 </span><span style="color:navy">mov     si, offset </span>bpbtable
<span style="color:black">BIOSDATA:2285                 </span><span style="color:navy">mov     si, [bx+si]     </span>; get address of bpb
<span style="color:black">BIOSDATA:2287
BIOSDATA:2287 </span>set_recbpb<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2287                 </span><span style="color:navy">lea     di, [di+</span><span style="color:green">39</span><span style="color:navy">]     </span>; [di+BDS.R_BPB]
<span style="color:black">BIOSDATA:2287                                         </span>; es:di -&gt; recbpb
<span style="color:black">BIOSDATA:228A                 </span><span style="color:navy">mov     cx, </span><span style="color:green">25          </span>; bpbx.size
<span style="color:black">BIOSDATA:228D                 </span><span style="color:navy">rep movsb               </span>; move (size bpbx) bytes
<span style="color:black">BIOSDATA:228F
BIOSDATA:228F </span><span style="color:gray">go_to_next_bds</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:228F                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:2290                 </span><span style="color:navy">pop     es              </span>; restore pointer to bds
<span style="color:black">BIOSDATA:2291                 </span><span style="color:navy">les     di, es:[di]     </span>; [es:di+BDS.link]
<span style="color:black">BIOSDATA:2294                 </span><span style="color:navy">cmp     di, -</span><span style="color:green">1          </span>; -1
<span style="color:black">BIOSDATA:2297                 </span><span style="color:navy">jz      short </span><span style="color:gray">got_end_of_bds_chain
</span><span style="color:black">BIOSDATA:2299                 </span><span style="color:navy">jmp     </span><span style="color:gray">next_bds
</span><span style="color:black">BIOSDATA:229C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:229C
BIOSDATA:229C </span><span style="color:gray">got_end_of_bds_chain</span><span style="color:navy">:                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:229C                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:229C </span>setdrvparms     endp
<span style="color:black">BIOSDATA:229C
BIOSDATA:229D
BIOSDATA:229D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:229D
BIOSDATA:229D
BIOSDATA:229D </span>print_init      proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:229D                 </span><span style="color:navy">cbw
</span><span style="color:black">BIOSDATA:229E                 </span><span style="color:navy">mov     dx, ax          </span>; AL = device number
<span style="color:black">BIOSDATA:22A0                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSDATA:22A2                 </span><span style="color:navy">int     </span><span style="color:green">17h             </span>; PRINTER - INITIALIZE
<span style="color:black">BIOSDATA:22A2                                         </span>; DX = printer port (0-3)
<span style="color:black">BIOSDATA:22A2                                         </span>; Return: AH = status
<span style="color:black">BIOSDATA:22A4                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:22A4 </span>print_init      endp
<span style="color:black">BIOSDATA:22A4
BIOSDATA:22A5
BIOSDATA:22A5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:22A5
BIOSDATA:22A5
BIOSDATA:22A5 </span>aux_init        proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:22A5                 </span><span style="color:navy">cbw
</span><span style="color:black">BIOSDATA:22A6                 </span><span style="color:navy">mov     dx, ax
</span><span style="color:black">BIOSDATA:22A8                 </span><span style="color:navy">mov     al, </span><span style="color:green">0A3h        </span>; RSINIT ; 2400,n,1,8 (msequ.inc)
<span style="color:black">BIOSDATA:22AA                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:22AC                 </span><span style="color:navy">int     </span><span style="color:green">14h             </span>; SERIAL I/O - INITIALIZE USART
<span style="color:black">BIOSDATA:22AC                                         </span>; AL = initializing parameters, DX = port number (0-3)
<span style="color:black">BIOSDATA:22AC                                         </span>; Return: AH = RS-232 status code bits, AL = modem status bits
<span style="color:black">BIOSDATA:22AE                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:22AE </span>aux_init        endp
<span style="color:black">BIOSDATA:22AE
BIOSDATA:22AF
BIOSDATA:22AF </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:22AF
BIOSDATA:22AF
BIOSDATA:22AF </span>domini          proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:22AF                 </span><span style="color:navy">mov     dh, ds:</span>hnum     ; get number of hardfiles
<span style="color:black">BIOSDATA:22B3                 </span><span style="color:navy">cmp     dh, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:22B6                 </span><span style="color:navy">jz      short </span>dominiret ; no hard file? then exit.
<span style="color:black">BIOSDATA:22B8                 </span><span style="color:navy">mov     dl, </span><span style="color:green">80h         </span>; start with hardfile 80h
<span style="color:black">BIOSDATA:22BA
BIOSDATA:22BA </span>domini_loop<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:22BA                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:22BB                 </span><span style="color:navy">mov     ds:</span>rom_minidisk_num<span style="color:navy">, dl
</span><span style="color:black">BIOSDATA:22BF                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">8
</span><span style="color:black">BIOSDATA:22C1                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - DISK - GET CURRENT DRIVE PARAMETERS (XT,AT,XT286,CONV,PS)
<span style="color:black">BIOSDATA:22C1                                         </span>; DL = drive number
<span style="color:black">BIOSDATA:22C1                                         </span>; Return: CF set on error, AH = status code, BL = drive type
<span style="color:black">BIOSDATA:22C1                                         </span>; DL = number of consecutive drives
<span style="color:black">BIOSDATA:22C1                                         </span>; DH = maximum value for head number, ES:DI -&gt; drive parameter
<span style="color:black">BIOSDATA:22C3                 </span><span style="color:navy">inc     dh
</span><span style="color:black">BIOSDATA:22C5                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">BIOSDATA:22C7                 </span><span style="color:navy">mov     al, dh
</span><span style="color:black">BIOSDATA:22C9                 </span><span style="color:navy">mov     ds:</span>mini_hdlim<span style="color:navy">, ax </span>; # of heads
<span style="color:black">BIOSDATA:22CC                 </span><span style="color:navy">and     cl, </span><span style="color:green">3Fh
</span><span style="color:black">BIOSDATA:22CF                 </span><span style="color:navy">mov     al, cl
</span><span style="color:black">BIOSDATA:22D1                 </span><span style="color:navy">mov     ds:</span>mini_seclim<span style="color:navy">, ax </span>; # of sectors/track
<span style="color:black">BIOSDATA:22D4                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:22D5                 </span><span style="color:navy">mov     dl, ds:</span>rom_minidisk_num
<span style="color:black">BIOSDATA:22D9                 </span><span style="color:navy">call    </span>getboot         ; read master boot record into
<span style="color:black">BIOSDATA:22D9                                         </span>; initbootsegment:bootbias
<span style="color:black">BIOSDATA:22DC                 </span><span style="color:navy">jb      short </span><span style="color:gray">domininext
</span><span style="color:black">BIOSDATA:22DE                 </span><span style="color:navy">call    </span>find_mini_partition
<span style="color:black">BIOSDATA:22E1
BIOSDATA:22E1 </span><span style="color:gray">domininext</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:22E1                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:22E2                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:22E3                 </span><span style="color:navy">inc     dl              </span>; next hard file
<span style="color:black">BIOSDATA:22E5                 </span><span style="color:navy">dec     dh
</span><span style="color:black">BIOSDATA:22E7                 </span><span style="color:navy">jnz     short </span>domini_loop
<span style="color:black">BIOSDATA:22E9
BIOSDATA:22E9 </span>dominiret<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:22E9                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:22E9 </span>domini          endp
<span style="color:black">BIOSDATA:22E9
BIOSDATA:22EA
BIOSDATA:22EA </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:22EA
BIOSDATA:22EA
BIOSDATA:22EA </span>find_mini_partition proc near           <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:22EA                 </span><span style="color:navy">add     bx, </span><span style="color:green">1C2h        </span>; bx -&gt; file system id
<span style="color:black">BIOSDATA:22EE
BIOSDATA:22EE </span>fmpnext<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:22EE                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">5 </span>; extended partition id. = 5
<span style="color:black">BIOSDATA:22F2                 </span><span style="color:navy">jz      short </span><span style="color:gray">fmpgot
</span><span style="color:black">BIOSDATA:22F4                 </span><span style="color:navy">add     bx, </span><span style="color:green">16
</span><span style="color:black">BIOSDATA:22F7                 </span><span style="color:navy">cmp     bx, </span><span style="color:green">402h        </span>; 202h+bootbias
<span style="color:black">BIOSDATA:22FB                 </span><span style="color:navy">jnz     short </span>fmpnext
<span style="color:black">BIOSDATA:22FD                 </span><span style="color:navy">jmp     short </span><span style="color:gray">fmpret    </span>; extended partition not found
<span style="color:black">BIOSDATA:22FF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:22FF
BIOSDATA:22FF </span><span style="color:gray">fmpgot</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:22FF                 </span><span style="color:navy">call    </span>dmax_check      ; found my partition.
<span style="color:black">BIOSDATA:22FF                                         </span>; check for drvmax already 26
<span style="color:black">BIOSDATA:2302                 </span><span style="color:navy">jnb     short </span><span style="color:gray">fmpret    </span>; done if too many
<span style="color:black">BIOSDATA:2304                 </span><span style="color:navy">mov     di, ds:</span>end_of_bdss ; get next free bds
<span style="color:black">BIOSDATA:2308                 </span><span style="color:navy">mov     word ptr [di+</span><span style="color:green">71</span><span style="color:navy">], </span><span style="color:#ff8000">1 </span>; [di+BDS.bdsm_ismini]
<span style="color:black">BIOSDATA:230D                 </span><span style="color:navy">or      word ptr [di+</span><span style="color:green">35</span><span style="color:navy">], </span><span style="color:green">1 </span>; or byte [di+BDS.flags],fNon_Removable
<span style="color:black">BIOSDATA:2311                 </span><span style="color:navy">mov     byte ptr [di+</span><span style="color:green">34</span><span style="color:navy">], </span><span style="color:#ff8000">5 </span>; mov byte [di+BDS.formfactor],ffHardFile
<span style="color:black">BIOSDATA:2315                 </span><span style="color:navy">mov     ds:</span>fbigfat<span style="color:navy">, </span><span style="color:#ff8000">0   </span>; assume 12 bit fat.
<span style="color:black">BIOSDATA:231A                 </span><span style="color:navy">mov     ax, ds:</span>mini_hdlim
<span style="color:black">BIOSDATA:231D                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">15h</span><span style="color:navy">], ax    </span>; [di+BDS.heads]
<span style="color:black">BIOSDATA:2320                 </span><span style="color:navy">mov     ax, ds:</span>mini_seclim
<span style="color:black">BIOSDATA:2323                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">13h</span><span style="color:navy">], ax    </span>; [di+BDS.secpertrack]
<span style="color:black">BIOSDATA:2326                 </span><span style="color:navy">mov     al, ds:</span>rom_minidisk_num
<span style="color:black">BIOSDATA:2329                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">4</span><span style="color:navy">], al      </span>; [di+BDS.drivenum]
<span style="color:black">BIOSDATA:2329                                         </span>; set physical number
<span style="color:black">BIOSDATA:232C                 </span><span style="color:navy">mov     al, ds:</span>drvmax
<span style="color:black">BIOSDATA:232F                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">5</span><span style="color:navy">], al      </span>; [di+BDS.drivelet]
<span style="color:black">BIOSDATA:232F                                         </span>; set logical number
<span style="color:black">BIOSDATA:2332                 </span><span style="color:navy">cmp     word ptr es:[bx+</span><span style="color:green">10</span><span style="color:navy">], </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:2337                 </span><span style="color:navy">ja      short </span><span style="color:gray">fmpgot_cont
</span><span style="color:black">BIOSDATA:2339                 </span><span style="color:navy">cmp     word ptr es:[bx+</span><span style="color:#ff8000">8</span><span style="color:navy">], </span><span style="color:green">64 </span>; with current bpb,
<span style="color:black">BIOSDATA:2339                                         </span>; only lower word is meaningful.
<span style="color:black">BIOSDATA:233E                 </span><span style="color:navy">jb      short </span><span style="color:gray">fmpret    </span>; should be bigger than 64 sectors at least
<span style="color:black">BIOSDATA:2340
BIOSDATA:2340 </span><span style="color:gray">fmpgot_cont</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2340                 </span><span style="color:navy">sub     bx, </span><span style="color:#ff8000">4           </span>; let bx point to the start of the entry
<span style="color:black">BIOSDATA:2343                 </span><span style="color:navy">mov     dh, es:[bx+</span><span style="color:#ff8000">2</span><span style="color:navy">]   </span>; cylinder
<span style="color:black">BIOSDATA:2347                 </span><span style="color:navy">and     dh, </span><span style="color:green">0C0h        </span>; get higher bits of cyl
<span style="color:black">BIOSDATA:234A                 </span><span style="color:navy">rol     dh, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:234C                 </span><span style="color:navy">rol     dh, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:234E                 </span><span style="color:navy">mov     dl, es:[bx+</span><span style="color:#ff8000">3</span><span style="color:navy">]   </span>; cyl byte
<span style="color:black">BIOSDATA:2352                 </span><span style="color:navy">mov     [di+</span><span style="color:green">73</span><span style="color:navy">], dx     </span>; [di+BDS.bdsm_hidden_trks]
<span style="color:black">BIOSDATA:2352                                         </span>; set hidden trks
<span style="color:black">BIOSDATA:2355                 </span><span style="color:navy">mov     cx, es:[bx+</span><span style="color:#ff8000">2</span><span style="color:navy">]   </span>; cylinder,cylinder/sector
<span style="color:black">BIOSDATA:2359                 </span><span style="color:navy">mov     dh, es:[bx+</span><span style="color:#ff8000">1</span><span style="color:navy">]   </span>; head
<span style="color:black">BIOSDATA:235D                 </span><span style="color:navy">mov     dl, ds:</span>rom_minidisk_num
<span style="color:black">BIOSDATA:2361                 </span><span style="color:navy">mov     bx, </span><span style="color:green">200h        </span>; bootbias
<span style="color:black">BIOSDATA:2364                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">201h
</span><span style="color:black">BIOSDATA:2367                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - READ SECTORS INTO MEMORY
<span style="color:black">BIOSDATA:2367                                         </span>; AL = number of sectors to read, CH = track, CL = sector
<span style="color:black">BIOSDATA:2367                                         </span>; DH = head, DL = drive, ES:BX -&gt; buffer to fill
<span style="color:black">BIOSDATA:2367                                         </span>; Return: CF set on error, AH = status, AL = number of sectors read
<span style="color:black">BIOSDATA:2369                 </span><span style="color:navy">jb      short </span><span style="color:gray">fmpret
</span><span style="color:black">BIOSDATA:236B                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">3C2h        </span>; 1C2h+bootbias
<span style="color:black">BIOSDATA:236E                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:236F                 </span><span style="color:navy">call    </span>setmini         ; install a mini disk.
<span style="color:black">BIOSDATA:236F                                         </span>; bx value saved.
<span style="color:black">BIOSDATA:2372                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:2373                 </span><span style="color:navy">jb      short </span><span style="color:gray">fmpnextchain
</span><span style="color:black">BIOSDATA:2375                 </span><span style="color:navy">call    </span>xinstall_bds    ; -- install the bdsm into table
<span style="color:black">BIOSDATA:2378
BIOSDATA:2378 </span><span style="color:gray">fmpnextchain</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2378                 </span><span style="color:navy">jmp     </span>fmpnext         ; let&#039;s find out if we have any chained partition
<span style="color:black">BIOSDATA:237B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:237B
BIOSDATA:237B </span><span style="color:gray">fmpret</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:237B                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:237B </span>find_mini_partition endp
<span style="color:black">BIOSDATA:237B
BIOSDATA:237C
BIOSDATA:237C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:237C
BIOSDATA:237C
BIOSDATA:237C </span>setmini         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:237C                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSDATA:237D                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:237E                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:237F                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:2380
BIOSDATA:2380 </span><span style="color:gray">setmini_1</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2380                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">1 </span>; FAT12 partition
<span style="color:black">BIOSDATA:2384                 </span><span style="color:navy">jz      short </span><span style="color:gray">setmini_2
</span><span style="color:black">BIOSDATA:2386                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">4 </span>; FAT16 partition
<span style="color:black">BIOSDATA:238A                 </span><span style="color:navy">jz      short </span><span style="color:gray">setmini_2
</span><span style="color:black">BIOSDATA:238C                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">6 </span>; FAT16 BIG partition
<span style="color:black">BIOSDATA:2390                 </span><span style="color:navy">jz      short </span><span style="color:gray">setmini_2
</span><span style="color:black">BIOSDATA:2392                 </span><span style="color:navy">add     bx, </span><span style="color:green">16
</span><span style="color:black">BIOSDATA:2395                 </span><span style="color:navy">cmp     bx, </span><span style="color:green">402h        </span>; 202h+bootbias
<span style="color:black">BIOSDATA:2399                 </span><span style="color:navy">jnz     short </span><span style="color:gray">setmini_1
</span><span style="color:black">BIOSDATA:239B                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSDATA:239C                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:239D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:239E                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:239F                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:23A0                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:23A1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:23A1
BIOSDATA:23A1 </span><span style="color:gray">setmini_2</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:23A1                 </span><span style="color:navy">jmp     </span>set2
<span style="color:black">BIOSDATA:23A1 </span>setmini         endp
<span style="color:black">BIOSDATA:23A1
BIOSDATA:23A4
BIOSDATA:23A4 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:23A4
BIOSDATA:23A4
BIOSDATA:23A4 </span>dmax_check      proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:23A4                 </span><span style="color:navy">cmp     ds:</span>drvmax<span style="color:navy">, </span><span style="color:green">26   </span>; checks for drvmax &lt; 26
<span style="color:black">BIOSDATA:23A9                 </span><span style="color:navy">jb      short </span><span style="color:gray">dmax_ok   </span>; return with carry if okay
<span style="color:black">BIOSDATA:23AB                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:23AC                 </span><span style="color:navy">mov     ax, </span><span style="color:green">473h        </span>; SYSINIT segment (SYSINITSEG)
<span style="color:black">BIOSDATA:23AF                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">BIOSDATA:23B1                 </span>assume es:nothing
<span style="color:black">BIOSDATA:23B1                 </span><span style="color:navy">mov     es:</span>toomanydrivesflag<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; SYSINITSEG:TOOMANYDRIVESFLAG
<span style="color:black">BIOSDATA:23B7                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:23B8                 </span>assume es:nothing
<span style="color:black">BIOSDATA:23B8
BIOSDATA:23B8 </span><span style="color:gray">dmax_ok</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:23B8                 </span><span style="color:navy">retn                    </span>; cf = 0 -&gt; error (too many drives), cf = 1 -&gt; ok
<span style="color:black">BIOSDATA:23B8 </span>dmax_check      endp
<span style="color:black">BIOSDATA:23B8
BIOSDATA:23B9
BIOSDATA:23B9 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:23B9
BIOSDATA:23B9
BIOSDATA:23B9 </span>xinstall_bds    proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:23B9                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSDATA:23BA                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:23BB                 </span><span style="color:navy">mov     si, word ptr ds:</span>start_bds ; get first bds
<span style="color:black">BIOSDATA:23BF
BIOSDATA:23BF </span><span style="color:gray">xinstall_bds_1</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:23BF                 </span><span style="color:navy">cmp     word ptr [si], </span><span style="color:green">0FFFFh </span>; -1 ; is this the last one?
<span style="color:black">BIOSDATA:23C2                 </span><span style="color:navy">jz      short </span><span style="color:gray">xinstall_bds_2 </span>; skip ahead if so
<span style="color:black">BIOSDATA:23C4                 </span><span style="color:navy">mov     si, [si]        </span>; [si+BDS.link] ; chain through list
<span style="color:black">BIOSDATA:23C6                 </span><span style="color:navy">jmp     short </span><span style="color:gray">xinstall_bds_1
</span><span style="color:black">BIOSDATA:23C8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:23C8
BIOSDATA:23C8 </span><span style="color:gray">xinstall_bds_2</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:23C8                 </span><span style="color:navy">mov     [si], di        </span>; [si+BDS.link]
<span style="color:black">BIOSDATA:23CA                 </span><span style="color:navy">mov     word ptr [si+</span><span style="color:#ff8000">2</span><span style="color:navy">], ds </span>; [si+BDS.link+2]
<span style="color:black">BIOSDATA:23CD                 </span><span style="color:navy">mov     word ptr [di], </span><span style="color:green">0FFFFh </span>; [di+BDS.link],-1
<span style="color:black">BIOSDATA:23CD                                         </span>; make sure it is a null ptr.
<span style="color:black">BIOSDATA:23D1                 </span><span style="color:navy">mov     word ptr [di+</span><span style="color:#ff8000">2</span><span style="color:navy">], ds </span>; might as well plug segment
<span style="color:black">BIOSDATA:23D4                 </span><span style="color:navy">lea     bx, [di+</span><span style="color:#ff8000">6</span><span style="color:navy">]
</span><span style="color:black">BIOSDATA:23D7                 </span><span style="color:navy">mov     si, ds:</span>last_dskdrv_table
<span style="color:black">BIOSDATA:23DB                 </span><span style="color:navy">mov     [si], bx
</span><span style="color:black">BIOSDATA:23DD                 </span><span style="color:navy">add     ds:</span>last_dskdrv_table<span style="color:navy">, </span><span style="color:#ff8000">2
</span><span style="color:black">BIOSDATA:23E2                 </span><span style="color:navy">inc     ds:</span>drvmax
<span style="color:black">BIOSDATA:23E6                 </span><span style="color:navy">add     ds:</span>end_of_bdss<span style="color:navy">, </span><span style="color:green">100 </span>; BDS.size = 100
<span style="color:black">BIOSDATA:23EB                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:23EC                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSDATA:23ED                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:23ED </span>xinstall_bds    endp
<span style="color:black">BIOSDATA:23ED
BIOSDATA:23EE
BIOSDATA:23EE </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:23EE
BIOSDATA:23EE
BIOSDATA:23EE </span>cmos_clock_read proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:23EE                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:23EF                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSDATA:23F0                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:23F1                 </span><span style="color:navy">push    bp
</span><span style="color:black">BIOSDATA:23F2                 </span><span style="color:navy">xor     bp, bp
</span><span style="color:black">BIOSDATA:23F4
BIOSDATA:23F4 </span><span style="color:gray">loop_clock</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:23F4                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">BIOSDATA:23F6                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:23F8                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:black">BIOSDATA:23FA                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - READ REAL TIME CLOCK (AT,XT286,CONV,PS)
<span style="color:black">BIOSDATA:23FA                                         </span>; Return: CH = hours in BCD
<span style="color:black">BIOSDATA:23FA                                         </span>; CL = minutes in BCD
<span style="color:black">BIOSDATA:23FA                                         </span>; DH = seconds in BCD
<span style="color:black">BIOSDATA:23FC                 </span><span style="color:navy">cmp     cx, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:23FF                 </span><span style="color:navy">jnz     short </span><span style="color:gray">clock_present
</span><span style="color:black">BIOSDATA:2401                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:2404                 </span><span style="color:navy">jnz     short </span><span style="color:gray">clock_present
</span><span style="color:black">BIOSDATA:2406                 </span><span style="color:navy">cmp     bp, </span><span style="color:#ff8000">1           </span>; read again after a slight delay, in case clock
<span style="color:black">BIOSDATA:2409                 </span><span style="color:navy">jz      short </span><span style="color:gray">no_readdate </span>; was at zero setting.
<span style="color:black">BIOSDATA:240B                 </span><span style="color:navy">inc     bp              </span>; only perform delay once.
<span style="color:black">BIOSDATA:240C                 </span><span style="color:navy">mov     cx, </span><span style="color:green">4000h       </span>; 16384
<span style="color:black">BIOSDATA:240F
BIOSDATA:240F </span><span style="color:gray">delay</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:240F                 </span><span style="color:navy">loop    </span><span style="color:gray">delay
</span><span style="color:black">BIOSDATA:2411                 </span><span style="color:navy">jmp     short </span><span style="color:gray">loop_clock
</span><span style="color:black">BIOSDATA:2413 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:2413
BIOSDATA:2413 </span><span style="color:gray">clock_present</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2413                 </span><span style="color:navy">mov     cs:</span>havecmoscloc<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; set the flag for cmos clock
<span style="color:black">BIOSDATA:2419                 </span><span style="color:navy">call    </span>cmosck          ; reset cmos clock rate that may be
<span style="color:black">BIOSDATA:2419                                         </span>; possibly destroyed by cp dos and
<span style="color:black">BIOSDATA:2419                                         </span>; post routine did not restore that.
<span style="color:black">BIOSDATA:241C                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSDATA:241D                 </span><span style="color:navy">call    </span>read_real_date  ; read real-time clock for date
<span style="color:black">BIOSDATA:2420                 </span><span style="color:navy">cli
</span><span style="color:black">BIOSDATA:2421                 </span><span style="color:navy">mov     ds:</span>daycnt<span style="color:navy">, si   </span>; set system date
<span style="color:black">BIOSDATA:2425                 </span><span style="color:navy">sti
</span><span style="color:black">BIOSDATA:2426                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSDATA:2427
BIOSDATA:2427 </span><span style="color:gray">no_readdate</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2427                 </span><span style="color:navy">pop     bp
</span><span style="color:black">BIOSDATA:2428                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:2429                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSDATA:242A                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:242B                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:242B </span>cmos_clock_read endp
<span style="color:black">BIOSDATA:242B
BIOSDATA:242C
BIOSDATA:242C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:242C
BIOSDATA:242C
BIOSDATA:242C </span>cmosck          proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:242C                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:242D                 </span><span style="color:navy">cmp     cs:</span>model_byte<span style="color:navy">, </span><span style="color:green">0FCh </span>; Exit if not an AT model
<span style="color:black">BIOSDATA:2433                 </span><span style="color:navy">jnz     short </span><span style="color:gray">cmosck9
</span><span style="color:black">BIOSDATA:2435                 </span><span style="color:navy">cmp     cs:</span>secondary_model_byte<span style="color:navy">, </span><span style="color:#ff8000">6 </span>; Is it 06 for the industral AT ?
<span style="color:black">BIOSDATA:243B                 </span><span style="color:navy">jz      short </span><span style="color:gray">cmosck4   </span>; Go reset CMOS periodic rate if 06
<span style="color:black">BIOSDATA:243D                 </span><span style="color:navy">cmp     cs:</span>secondary_model_byte<span style="color:navy">, </span><span style="color:#ff8000">4 </span>; Is it 00, 01, 02, or 03 ?
<span style="color:black">BIOSDATA:2443                 </span><span style="color:navy">jnb     short </span><span style="color:gray">cmosck9   </span>; EXIT if problem fixed by POST
<span style="color:black">BIOSDATA:2443                                         </span>; Also,Secondary_model_byte = 0
<span style="color:black">BIOSDATA:2445
BIOSDATA:2445 </span><span style="color:gray">cmosck4</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2445                 </span><span style="color:navy">mov     al, </span><span style="color:green">8Ah         </span>; cmos_reg_a|nmi
<span style="color:black">BIOSDATA:2445                                         </span>; NMI disabled on return
<span style="color:black">BIOSDATA:2447                 </span><span style="color:navy">mov     ah, </span><span style="color:green">26h         </span>; 00100110b ; Set divider &amp; rate selection
<span style="color:black">BIOSDATA:2449                 </span><span style="color:navy">call    </span>cmos_write
<span style="color:black">BIOSDATA:244C                 </span><span style="color:navy">mov     al, </span><span style="color:green">8Bh         </span>; cmos_reg_b|nmi
<span style="color:black">BIOSDATA:244C                                         </span>; NMI disabled on return
<span style="color:black">BIOSDATA:244E                 </span><span style="color:navy">call    </span>cmos_read
<span style="color:black">BIOSDATA:2451                 </span><span style="color:navy">and     al, </span><span style="color:green">7           </span>; 00000111b ; clear SET,PIE,AIE,UIE,SQWE
<span style="color:black">BIOSDATA:2453                 </span><span style="color:navy">mov     ah, al
</span><span style="color:black">BIOSDATA:2455                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0Bh         </span>; cmos_reg_b ; NMI enabled on return
<span style="color:black">BIOSDATA:2457                 </span><span style="color:navy">call    </span>cmos_write
<span style="color:black">BIOSDATA:245A
BIOSDATA:245A </span><span style="color:gray">cmosck9</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:245A                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:245B                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:245B </span>cmosck          endp
<span style="color:black">BIOSDATA:245B
BIOSDATA:245C
BIOSDATA:245C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:245C
BIOSDATA:245C
BIOSDATA:245C </span>cmos_read       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:245C                 </span><span style="color:navy">pushf
</span><span style="color:black">BIOSDATA:245D                 </span><span style="color:navy">cli
</span><span style="color:black">BIOSDATA:245E                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:245F                 </span><span style="color:navy">push    ax              </span>; AL = cmos table address to be read
<span style="color:black">BIOSDATA:2460                 </span><span style="color:navy">or      al, </span><span style="color:green">80h
</span><span style="color:black">BIOSDATA:2462                 </span><span style="color:navy">out     </span><span style="color:green">70h</span><span style="color:navy">, al         </span>; CMOS Memory/RTC Index Register: RTC Seconds
<span style="color:black">BIOSDATA:2464                 </span><span style="color:navy">nop                     </span>; (undocumented delay needed)
<span style="color:black">BIOSDATA:2465                 </span><span style="color:navy">in      al, </span><span style="color:green">71h         </span>; CMOS Memory/RTC Data Register
<span style="color:black">BIOSDATA:2467                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:black">BIOSDATA:2469                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:246A                 </span><span style="color:navy">and     al, </span><span style="color:green">80h
</span><span style="color:black">BIOSDATA:246C                 </span><span style="color:navy">or      al, </span><span style="color:green">0Fh
</span><span style="color:black">BIOSDATA:246E                 </span><span style="color:navy">out     </span><span style="color:green">70h</span><span style="color:navy">, al         </span>; CMOS Memory/RTC Index Register: RTC Seconds
<span style="color:black">BIOSDATA:2470                 </span><span style="color:navy">nop
</span><span style="color:black">BIOSDATA:2471                 </span><span style="color:navy">in      al, </span><span style="color:green">71h         </span>; CMOS Memory/RTC Data Register
<span style="color:black">BIOSDATA:2473                 </span><span style="color:navy">mov     ax, bx
</span><span style="color:black">BIOSDATA:2475                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:2476                 </span><span style="color:navy">push    cs              </span>; *place code segment in stack and
<span style="color:black">BIOSDATA:2476                                         </span>; *handle popf for b- level 80286
<span style="color:black">BIOSDATA:2477                 </span><span style="color:navy">call    near ptr </span>cmod_popf
<span style="color:black">BIOSDATA:247A                 </span><span style="color:navy">retn                    </span>; return with flags restored
<span style="color:black">BIOSDATA:247A </span>cmos_read       endp
<span style="color:black">BIOSDATA:247A
BIOSDATA:247B
BIOSDATA:247B </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:247B
BIOSDATA:247B
BIOSDATA:247B </span>cmod_popf       proc far                <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:247B                 </span><span style="color:navy">iret                    </span>; popf for level b- parts
<span style="color:black">BIOSDATA:247B </span>cmod_popf       endp                    ; return far and restore flags
<span style="color:black">BIOSDATA:247B
BIOSDATA:247C
BIOSDATA:247C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:247C
BIOSDATA:247C
BIOSDATA:247C </span>cmos_write      proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:247C                 </span><span style="color:navy">pushf                   </span>; write (ah) to location (al)
<span style="color:black">BIOSDATA:247D                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:247E                 </span><span style="color:navy">cli
</span><span style="color:black">BIOSDATA:247F                 </span><span style="color:navy">push    ax              </span>; save user nmi state
<span style="color:black">BIOSDATA:2480                 </span><span style="color:navy">or      al, </span><span style="color:green">80h         </span>; disable nmi for us
<span style="color:black">BIOSDATA:2482                 </span><span style="color:navy">out     </span><span style="color:green">70h</span><span style="color:navy">, al         </span>; CMOS Memory/RTC Index Register: RTC Seconds
<span style="color:black">BIOSDATA:2484                 </span><span style="color:navy">nop
</span><span style="color:black">BIOSDATA:2485                 </span><span style="color:navy">mov     al, ah
</span><span style="color:black">BIOSDATA:2487                 </span><span style="color:navy">out     </span><span style="color:green">71h</span><span style="color:navy">, al         </span>; CMOS Memory/RTC Data Register
<span style="color:black">BIOSDATA:2489                 </span><span style="color:navy">pop     ax              </span>; get user nmi
<span style="color:black">BIOSDATA:248A                 </span><span style="color:navy">and     al, </span><span style="color:green">80h
</span><span style="color:black">BIOSDATA:248C                 </span><span style="color:navy">or      al, </span><span style="color:green">0Fh
</span><span style="color:black">BIOSDATA:248E                 </span><span style="color:navy">out     </span><span style="color:green">70h</span><span style="color:navy">, al         </span>; CMOS Memory/RTC Index Register: RTC Seconds
<span style="color:black">BIOSDATA:2490                 </span><span style="color:navy">nop
</span><span style="color:black">BIOSDATA:2491                 </span><span style="color:navy">in      al, </span><span style="color:green">71h         </span>; CMOS Memory/RTC Data Register
<span style="color:black">BIOSDATA:2493                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:2494                 </span><span style="color:navy">push    cs              </span>; *place code segment in stack and
<span style="color:black">BIOSDATA:2495                 </span><span style="color:navy">call    near ptr </span>cmod_popf ; *handle popf for b- level 80286
<span style="color:black">BIOSDATA:2498                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:2498 </span>cmos_write      endp
<span style="color:black">BIOSDATA:2498
BIOSDATA:2499
BIOSDATA:2499 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:2499
BIOSDATA:2499
BIOSDATA:2499 </span>getclus         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2499                 </span><span style="color:navy">push    cx              </span>; bx = cluster to read
<span style="color:black">BIOSDATA:2499                                         </span>; cx = sectors per cluster
<span style="color:black">BIOSDATA:2499                                         </span>; es:di = load location
<span style="color:black">BIOSDATA:249A                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSDATA:249B                 </span><span style="color:navy">mov     cs:</span>doscnt<span style="color:navy">, cx
</span><span style="color:black">BIOSDATA:24A0                 </span><span style="color:navy">mov     ax, bx
</span><span style="color:black">BIOSDATA:24A2                 </span><span style="color:navy">dec     ax
</span><span style="color:black">BIOSDATA:24A3                 </span><span style="color:navy">dec     ax
</span><span style="color:black">BIOSDATA:24A4                 </span><span style="color:navy">mul     cx              </span>; convert to logical sector
<span style="color:black">BIOSDATA:24A4                                         </span>; dx:ax = matching logical sector number
<span style="color:black">BIOSDATA:24A4                                         </span>; starting from the data sector
<span style="color:black">BIOSDATA:24A6                 </span><span style="color:navy">add     ax, cs:</span>bios_l
<span style="color:black">BIOSDATA:24AB                 </span><span style="color:navy">adc     dx, cs:</span>bios_h   ; dx:ax = first logical sector to read
<span style="color:black">BIOSDATA:24B0
BIOSDATA:24B0 </span><span style="color:gray">unpack</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:24B0                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:24B1                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:24B2                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:24B3                 </span><span style="color:navy">mov     si, cs:</span>fatloc
<span style="color:black">BIOSDATA:24B8                 </span><span style="color:navy">mov     ds, si
</span><span style="color:black">BIOSDATA:24BA                 </span><span style="color:navy">mov     si, bx          </span>; next cluster
<span style="color:black">BIOSDATA:24BC                 </span><span style="color:navy">test    cs:</span>fbigfat<span style="color:navy">, </span><span style="color:green">40h </span>; fbig
<span style="color:black">BIOSDATA:24BC                                         </span>; 16 bit fat?
<span style="color:black">BIOSDATA:24C2                 </span><span style="color:navy">jnz     short </span><span style="color:gray">unpack16  </span>; yes
<span style="color:black">BIOSDATA:24C4
BIOSDATA:24C4 </span>unpack12<span style="color:navy">:
</span><span style="color:black">BIOSDATA:24C4                 </span><span style="color:navy">shr     si, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:24C6                 </span><span style="color:navy">add     si, bx          </span>; 12 bit fat. si=si/2
<span style="color:black">BIOSDATA:24C6                                         </span>; si = clus + clus/2
<span style="color:black">BIOSDATA:24C6                                         </span>; (si = byte offset of the cluster in the FAT)
<span style="color:black">BIOSDATA:24C8                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:24C9                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:24CB                 </span><span style="color:navy">call    </span>get_fat_sector
<span style="color:black">BIOSDATA:24CE                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:24CF                 </span><span style="color:navy">mov     ax, [bx]        </span>; save cluster number into ax
<span style="color:black">BIOSDATA:24D1                 </span><span style="color:navy">jnz     short </span><span style="color:gray">even_odd  </span>; if not a splitted fat, check even-odd
<span style="color:black">BIOSDATA:24D3                 </span><span style="color:navy">mov     al, [bx]        </span>; (not needed!) Erdogan Tan - 2023
<span style="color:black">BIOSDATA:24D5                 </span><span style="color:navy">mov     byte ptr cs:</span>temp_cluster<span style="color:navy">, al </span>; splitted fat
<span style="color:black">BIOSDATA:24D9                 </span><span style="color:navy">inc     si              </span>; (next byte)
<span style="color:black">BIOSDATA:24DA                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:24DB                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSDATA:24DD                 </span><span style="color:navy">call    </span>get_fat_sector
<span style="color:black">BIOSDATA:24E0                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:24E1                 </span><span style="color:navy">mov     al, byte ptr ds:</span>BData_start
<span style="color:black">BIOSDATA:24E4                 </span><span style="color:navy">mov     byte ptr cs:</span>temp_cluster<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, al
</span><span style="color:black">BIOSDATA:24E8                 </span><span style="color:navy">mov     ax, cs:</span>temp_cluster
<span style="color:black">BIOSDATA:24EC
BIOSDATA:24EC </span><span style="color:gray">even_odd</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:24EC                 </span><span style="color:navy">pop     bx              </span>; restore old fat entry value
<span style="color:black">BIOSDATA:24ED                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:24EE                 </span><span style="color:navy">shr     bx, </span><span style="color:green">1           </span>; was it even or odd?
<span style="color:black">BIOSDATA:24F0                 </span><span style="color:navy">jnb     short </span><span style="color:gray">havclus   </span>; it was even
<span style="color:black">BIOSDATA:24F2                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1           </span>; odd. massage fat value and keep
<span style="color:black">BIOSDATA:24F2                                         </span>; the highest 12 bits.
<span style="color:black">BIOSDATA:24F4                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:24F6                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:24F8                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">BIOSDATA:24FA
BIOSDATA:24FA </span><span style="color:gray">havclus</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:24FA                 </span><span style="color:navy">mov     bx, ax          </span>; now bx = new fat entry
<span style="color:black">BIOSDATA:24FC                 </span><span style="color:navy">and     bx, </span><span style="color:green">0FFFh       </span>; keep low 12 bits
<span style="color:black">BIOSDATA:2500                 </span><span style="color:navy">jmp     short </span><span style="color:gray">unpackx
</span><span style="color:black">BIOSDATA:2502 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:2502
BIOSDATA:2502 </span><span style="color:gray">unpack16</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2502                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:2503                 </span><span style="color:navy">xor     dx, dx          </span>; extend to 32 bit offset
<span style="color:black">BIOSDATA:2505                 </span><span style="color:navy">shl     si, </span><span style="color:green">1           </span>; cluster number * 2
<span style="color:black">BIOSDATA:2507                 </span><span style="color:navy">adc     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSDATA:250A                 </span><span style="color:navy">call    </span>get_fat_sector
<span style="color:black">BIOSDATA:250D                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:250E                 </span><span style="color:navy">mov     bx, [bx]        </span>; bx = new fat entry
<span style="color:black">BIOSDATA:2510
BIOSDATA:2510 </span><span style="color:gray">unpackx</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2510                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSDATA:2511                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:2512                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:2513                 </span><span style="color:navy">sub     si, bx          </span>; previous - current (or current - new)
<span style="color:black">BIOSDATA:2515                 </span><span style="color:navy">cmp     si, -</span><span style="color:green">1          </span>; one apart? (current offset = previous+1)
<span style="color:black">BIOSDATA:2518                 </span><span style="color:navy">jnz     short </span><span style="color:gray">getcl2
</span><span style="color:black">BIOSDATA:251A                 </span><span style="color:navy">add     cs:</span>doscnt<span style="color:navy">, cx   </span>; consequental cluster read, +1 cluster sector(s)
<span style="color:black">BIOSDATA:251A                                         </span>; (cx = sectors per cluster)
<span style="color:black">BIOSDATA:251F                 </span><span style="color:navy">jmp     short </span><span style="color:gray">unpack
</span><span style="color:black">BIOSDATA:2521 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSDATA:2521
BIOSDATA:2521 </span><span style="color:gray">getcl2</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:2521                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSDATA:2522                 </span><span style="color:navy">push    dx              </span>; sector to read (high)
<span style="color:black">BIOSDATA:2523                 </span><span style="color:navy">push    ax              </span>; sector to read (low)
<span style="color:black">BIOSDATA:2524                 </span><span style="color:navy">mov     ax, cs:</span>drvfat   ; get drive and fat spec
<span style="color:black">BIOSDATA:2528                 </span><span style="color:navy">mov     cx, cs:</span>doscnt
<span style="color:black">BIOSDATA:252D                 </span><span style="color:navy">pop     dx              </span>; sector to read for diskrd (low)
<span style="color:black">BIOSDATA:252E                 </span><span style="color:navy">pop     cs:</span>start_sec_h  ; sector to read for diskrd (high)
<span style="color:black">BIOSDATA:2533                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:2534                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:2535                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:2536                 </span><span style="color:navy">push    cs              </span>; simulate far call
<span style="color:black">BIOSDATA:2537                 </span><span style="color:navy">mov     bp, offset </span>DISKRD ; BIOSCODE:8E5h ; 2C7h:8E5h
<span style="color:black">BIOSDATA:253A                 </span><span style="color:navy">call    near ptr </span>call_bios_code
<span style="color:black">BIOSDATA:253D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:253E                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSDATA:253F                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:2540                 </span><span style="color:navy">mov     ax, cs:</span>doscnt   ; sector count
<span style="color:black">BIOSDATA:2544                 </span><span style="color:navy">xchg    ah, al
</span><span style="color:black">BIOSDATA:2546                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1           </span>; ax = ax * 512 ; byte count
<span style="color:black">BIOSDATA:2548                 </span><span style="color:navy">add     di, ax          </span>; update load location
<span style="color:black">BIOSDATA:254A                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSDATA:254B                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:254B </span>getclus         endp
<span style="color:black">BIOSDATA:254B
BIOSDATA:254C
BIOSDATA:254C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSDATA:254C
BIOSDATA:254C
BIOSDATA:254C </span>get_fat_sector  proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSDATA:254C                 </span><span style="color:navy">push    ax              </span>; dx:si = offset value (starting from fat entry 0)
<span style="color:black">BIOSDATA:254C                                         </span>;         of fat entry to find
<span style="color:black">BIOSDATA:254D                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSDATA:254E                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSDATA:254F                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSDATA:2550                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:2551                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:2552                 </span><span style="color:navy">mov     ax, si
</span><span style="color:black">BIOSDATA:2554                 </span><span style="color:navy">mov     cx, cs:</span>md_sectorsize ; 512
<span style="color:black">BIOSDATA:2559                 </span><span style="color:navy">div     cx
</span><span style="color:black">BIOSDATA:255B                 </span><span style="color:navy">nop                     </span>; ax = sector number, dx = offset
<span style="color:black">BIOSDATA:255C                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSDATA:255D                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:255E                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSDATA:255F                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSDATA:2560                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:2561                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:2562                 </span><span style="color:navy">mov     ax, cs:</span>drvfat   ; get drive # and FAT id
<span style="color:black">BIOSDATA:2566                 </span><span style="color:navy">mov     bp, offset </span>SetDrive ; BIOSCODE:04D7h
<span style="color:black">BIOSDATA:2569                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:256A                 </span><span style="color:navy">call    near ptr </span>call_bios_code ; get bds for drive
<span style="color:black">BIOSDATA:256D                 </span><span style="color:navy">pop     ax              </span>; (sector number -without reserved and hidden sectors-)
<span style="color:black">BIOSDATA:256E                 </span><span style="color:navy">add     ax, es:[di+</span><span style="color:#ff8000">9</span><span style="color:navy">]   </span>; [es:di+BDS.resectors]
<span style="color:black">BIOSDATA:256E                                         </span>; add #reserved_sectors
<span style="color:black">BIOSDATA:2572                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:2573                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:2574                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:2575                 </span><span style="color:navy">cmp     ax, cs:</span>last_fat_secnum
<span style="color:black">BIOSDATA:257A                 </span><span style="color:navy">jz      short </span><span style="color:gray">gfs_split_chk </span>; don&#039;t need to read it again
<span style="color:black">BIOSDATA:257C                 </span><span style="color:navy">mov     cs:</span>last_fat_secnum<span style="color:navy">, ax </span>; sector number
<span style="color:black">BIOSDATA:257C                                         </span>; (in the partition, without hidden sectors)
<span style="color:black">BIOSDATA:2580                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSDATA:2581                 </span><span style="color:navy">mov     cs:</span>start_sec_h<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; prepare to read the fat sector
<span style="color:black">BIOSDATA:2581                                         </span>; start_sec_h is always 0 for fat sector
<span style="color:black">BIOSDATA:2588                 </span><span style="color:navy">mov     dx, ax
</span><span style="color:black">BIOSDATA:258A                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">1           </span>; 1 sector read
<span style="color:black">BIOSDATA:258D                 </span><span style="color:navy">mov     ax, cs:</span>drvfat
<span style="color:black">BIOSDATA:2591                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:2592                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:2593                 </span>assume es:nothing
<span style="color:black">BIOSDATA:2593                 </span><span style="color:navy">xor     di, di          </span>; es:di -&gt; fatloc segment:0
<span style="color:black">BIOSDATA:2595                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSDATA:2596                 </span><span style="color:navy">push    cs
</span><span style="color:black">BIOSDATA:2597                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:2598                 </span><span style="color:navy">push    cs              </span>; simulate far call
<span style="color:black">BIOSDATA:2599                 </span><span style="color:navy">mov     bp, offset </span>DISKRD ; BIOSCODE:08E5h ; 2C7h:8E5h
<span style="color:black">BIOSDATA:259C                 </span><span style="color:navy">call    near ptr </span>call_bios_code
<span style="color:black">BIOSDATA:259F                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:25A0                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSDATA:25A1                 </span><span style="color:navy">mov     cx, cs:</span>md_sectorsize ; 512
<span style="color:black">BIOSDATA:25A6
BIOSDATA:25A6 </span><span style="color:gray">gfs_split_chk</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSDATA:25A6                 </span><span style="color:navy">dec     cx              </span>; 511
<span style="color:black">BIOSDATA:25A7                 </span><span style="color:navy">cmp     dx, cx          </span>; if offset points to the last byte of this sector,
<span style="color:black">BIOSDATA:25A7                                         </span>; then splitted entry.
<span style="color:black">BIOSDATA:25A9                 </span><span style="color:navy">mov     bx, dx          </span>; offset value from fatloc segment
<span style="color:black">BIOSDATA:25AB                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSDATA:25AC                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSDATA:25AD                 </span>assume es:nothing
<span style="color:black">BIOSDATA:25AD                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSDATA:25AE                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSDATA:25AF                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSDATA:25B0                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSDATA:25B1                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSDATA:25B1 </span>get_fat_sector  endp
<span style="color:black">BIOSDATA:25B1
BIOSDATA:25B1 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSDATA:25B2                 </span><span style="color:navy">db </span><span style="color:#008040">14 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSDATA:25B2 </span>BIOSDATA        ends
<span style="color:gray">BIOSDATA:25B2
BIOSCODE:0000 ; ===========================================================================
BIOSCODE:0000
BIOSCODE:0000 ; Segment type: Regular
BIOSCODE:0000 </span>BIOSCODE        segment byte public &#039;BIOSCODE&#039; use16
<span style="color:gray">BIOSCODE:0000                 </span>assume cs:BIOSCODE
<span style="color:gray">BIOSCODE:0000                 </span>assume es:nothing, ss:nothing, ds:nothing, fs:nothing, gs:nothing
<span style="color:gray">BIOSCODE:0000 </span>BCode_start     <span style="color:navy">db </span><span style="color:#008040">30h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSCODE:0030 </span>Bios_Data_Word  <span style="color:navy">dw </span><span style="color:#008040">70h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSCODE:0030                                         </span>; BIOSDATA segment
<span style="color:maroon">BIOSCODE:0032 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0032
BIOSCODE:0032 </span>_seg_reinit<span style="color:navy">:                            </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0032                 </span><span style="color:navy">mov     es, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:0037                 </span>assume es:nothing
<span style="color:maroon">BIOSCODE:0037                 </span><span style="color:navy">mov     di, offset </span>cdev_2 ; (offset cdev+2)
<span style="color:maroon">BIOSCODE:003A                 </span><span style="color:navy">mov     cx, </span><span style="color:green">4
</span><span style="color:maroon">BIOSCODE:003D
BIOSCODE:003D </span>_seg_reinit_1<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:003D                 </span><span style="color:navy">stosw                   </span>; ax = new code (BIOSCODE) segment value
<span style="color:maroon">BIOSCODE:003E                 </span><span style="color:navy">inc     di
</span><span style="color:maroon">BIOSCODE:003F                 </span><span style="color:navy">inc     di
</span><span style="color:maroon">BIOSCODE:0040
BIOSCODE:0040 </span><span style="color:navy">loc_2600:
</span><span style="color:maroon">BIOSCODE:0040                 </span><span style="color:navy">loop    </span>_seg_reinit_1
<span style="color:maroon">BIOSCODE:0042                 </span><span style="color:navy">retf
</span><span style="color:maroon">BIOSCODE:0043 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0043
BIOSCODE:0043 </span>chardev_entry<span style="color:navy">:                          </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0043                 </span><span style="color:navy">push    si
</span><span style="color:maroon">BIOSCODE:0044                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSCODE:0045                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSCODE:0046                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">BIOSCODE:0047
BIOSCODE:0047 </span><span style="color:navy">loc_2607:
</span><span style="color:maroon">BIOSCODE:0047                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSCODE:0048                 </span><span style="color:navy">push    bp
</span><span style="color:maroon">BIOSCODE:0049                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:004A                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:004B                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:004C                 </span><span style="color:navy">mov     bp, sp
</span><span style="color:maroon">BIOSCODE:004E
BIOSCODE:004E </span><span style="color:navy">loc_260E:                               </span>; get return address (dispatch table)
<span style="color:maroon">BIOSCODE:004E                 </span><span style="color:navy">mov     si, [bp+</span><span style="color:green">18</span><span style="color:navy">]
</span><span style="color:maroon">BIOSCODE:0051                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word ; BIOSDATA segment
<span style="color:maroon">BIOSCODE:0056                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0056                 </span><span style="color:navy">mov     ax, [si+</span><span style="color:green">2</span><span style="color:navy">]      </span>; get the device number if present
<span style="color:maroon">BIOSCODE:0059                 </span><span style="color:navy">mov     byte ptr ds:</span>auxnum<span style="color:navy">, al
</span><span style="color:maroon">BIOSCODE:005C                 </span><span style="color:navy">mov     ds:</span>printdev<span style="color:navy">, ah
</span><span style="color:maroon">BIOSCODE:0060                 </span><span style="color:navy">mov     si, [si]        </span>; point to the device dispatch table
<span style="color:maroon">BIOSCODE:0062                 </span><span style="color:navy">les     bx, ds:</span>ptrsav   ; get pointer to i/o packet
<span style="color:maroon">BIOSCODE:0066                 </span>assume es:nothing
<span style="color:maroon">BIOSCODE:0066                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:green">1</span><span style="color:navy">]   </span>; [es:bx+unit] ; al = unit code
<span style="color:maroon">BIOSCODE:006A                 </span><span style="color:navy">mov     ah, es:[bx+</span><span style="color:green">13</span><span style="color:navy">]  </span>; [es:bx+media] ; ah = media descrip
<span style="color:maroon">BIOSCODE:006E                 </span><span style="color:navy">mov     cx, es:[bx+</span><span style="color:green">18</span><span style="color:navy">]  </span>; [es:bx+count] ; cx = count
<span style="color:maroon">BIOSCODE:0072                 </span><span style="color:navy">mov     dx, es:[bx+</span><span style="color:green">20</span><span style="color:navy">]  </span>; [es:bx+start] ; dx = start sector
<span style="color:maroon">BIOSCODE:0076                 </span><span style="color:navy">cmp     si, offset </span>DSKTBL ; BIOSCODE:4A2h
<span style="color:maroon">BIOSCODE:007A                 </span><span style="color:navy">jnz     short </span>no_sector32_mapping
<span style="color:maroon">BIOSCODE:007C                 </span><span style="color:navy">mov     ds:</span>start_sec_h<span style="color:navy">, </span><span style="color:green">0
</span><span style="color:maroon">BIOSCODE:0082                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">BIOSCODE:0085                 </span><span style="color:navy">jnz     short </span>no_sector32_mapping
<span style="color:maroon">BIOSCODE:0087                 </span><span style="color:navy">mov     dx, es:[bx+</span><span style="color:green">28</span><span style="color:navy">]  </span>; [es:bx+start_h]
<span style="color:maroon">BIOSCODE:0087                                         </span>; 32 bit dsk req
<span style="color:maroon">BIOSCODE:008B                 </span><span style="color:navy">mov     ds:</span>start_sec_h<span style="color:navy">, dx </span>; start_sec_h = packet.start_h
<span style="color:maroon">BIOSCODE:008F                 </span><span style="color:navy">mov     dx, es:[bx+</span><span style="color:green">26</span><span style="color:navy">]  </span>; [es:bx+start_l]
<span style="color:maroon">BIOSCODE:008F                                         </span>; dx = packet.start_l
<span style="color:maroon">BIOSCODE:0093
BIOSCODE:0093 </span>no_sector32_mapping<span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0093                 </span><span style="color:navy">xchg    ax, di
</span><span style="color:maroon">BIOSCODE:0094                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:green">2</span><span style="color:navy">]   </span>; [es:bx+cmd]
<span style="color:maroon">BIOSCODE:0098                 </span><span style="color:navy">cmp     al, cs:[si]
</span><span style="color:maroon">BIOSCODE:009B                 </span><span style="color:navy">jnb     short </span>command_error
<span style="color:maroon">BIOSCODE:009D                 </span><span style="color:navy">cbw                     </span>; note that al &lt;= 15 means ok
<span style="color:maroon">BIOSCODE:009E                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:00A0                 </span><span style="color:navy">add     si, ax
</span><span style="color:maroon">BIOSCODE:00A2                 </span><span style="color:navy">xchg    ax, di
</span><span style="color:maroon">BIOSCODE:00A3                 </span><span style="color:navy">les     di, es:[bx+</span><span style="color:green">14</span><span style="color:navy">]  </span>; [es:bx+trans]
<span style="color:maroon">BIOSCODE:00A7                 </span><span style="color:navy">cld
</span><span style="color:maroon">BIOSCODE:00A8                 </span><span style="color:navy">call    word ptr cs:[si+</span><span style="color:green">1</span><span style="color:navy">]
</span><span style="color:maroon">BIOSCODE:00AC                 </span><span style="color:navy">jb      short </span>already_got_ah_status
<span style="color:maroon">BIOSCODE:00AE                 </span><span style="color:navy">mov     ah, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:00B0
BIOSCODE:00B0 </span>already_got_ah_status<span style="color:navy">:                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:00B0                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:00B5                 </span><span style="color:navy">lds     bx, ds:</span>ptrsav
<span style="color:maroon">BIOSCODE:00B9                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:00B9                 </span><span style="color:navy">mov     [bx+</span><span style="color:green">3</span><span style="color:navy">], ax      </span>; [bx+status]
<span style="color:maroon">BIOSCODE:00B9                                         </span>; mark operation complete
<span style="color:maroon">BIOSCODE:00BC                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:00BD                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:00BE                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:00BF                 </span><span style="color:navy">pop     bp
</span><span style="color:maroon">BIOSCODE:00C0                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSCODE:00C1                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSCODE:00C2                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSCODE:00C3                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSCODE:00C4                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">BIOSCODE:00C5                 </span><span style="color:navy">add     sp, </span><span style="color:green">2           </span>; get rid of fake return address
<span style="color:maroon">BIOSCODE:00C8
BIOSCODE:00C8 </span>bc_retf<span style="color:navy">:                                </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:00C8                 </span><span style="color:navy">retf
</span><span style="color:maroon">BIOSCODE:00C9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:00C9
BIOSCODE:00C9 </span>command_error<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:00C9                 </span><span style="color:navy">call    </span>bc_cmderr
<span style="color:maroon">BIOSCODE:00CC                 </span><span style="color:navy">jmp     short </span>already_got_ah_status
<span style="color:maroon">BIOSCODE:00CC </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSCODE:00CE                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">BIOSCODE:00D0 </span>_offset_D0h     <span style="color:navy">db </span><span style="color:#008040">5 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span>; 5 bytes from 0:C0h will be copied onto here
<span style="color:gray">BIOSCODE:00D0                                         </span>; which is the CP/M call 5 entry point
<span style="color:black">BIOSCODE:00D5
BIOSCODE:00D5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:00D5
BIOSCODE:00D5
BIOSCODE:00D5 </span>bc_cmderr       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:00D5                 </span><span style="color:navy">mov     al, </span><span style="color:green">3           </span>; unknown command error
<span style="color:black">BIOSCODE:00D7
BIOSCODE:00D7 </span>bc_err_cnt<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:00D7                 </span><span style="color:navy">les     bx, ds:</span>ptrsav
<span style="color:black">BIOSCODE:00DB                 </span><span style="color:navy">sub     es:[bx+</span><span style="color:green">18</span><span style="color:navy">], cx
</span><span style="color:black">BIOSCODE:00DF                 </span><span style="color:navy">mov     ah, </span><span style="color:green">81h         </span>; mark error return
<span style="color:black">BIOSCODE:00E1                 </span><span style="color:navy">stc                     </span>; indicate abnormal end
<span style="color:black">BIOSCODE:00E2                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:00E2 </span>bc_cmderr       endp
<span style="color:black">BIOSCODE:00E2
BIOSCODE:00E2 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSCODE:00E3                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSCODE:00E4 </span>con_table       <span style="color:navy">db </span><span style="color:#008040">11                   </span>; ((con_table_end - con_table)-1)/2 = 11
<span style="color:gray">BIOSCODE:00E5                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:00E7                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:00E9                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:00EB                 </span><span style="color:navy">dw offset </span>bc_cmderr
<span style="color:gray">BIOSCODE:00ED                 </span><span style="color:navy">dw offset </span>con_read
<span style="color:gray">BIOSCODE:00EF                 </span><span style="color:navy">dw offset </span>con_rdnd
<span style="color:gray">BIOSCODE:00F1                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:00F3                 </span><span style="color:navy">dw offset </span>con_flush
<span style="color:gray">BIOSCODE:00F5                 </span><span style="color:navy">dw offset </span>con_writ
<span style="color:gray">BIOSCODE:00F7                 </span><span style="color:navy">dw offset </span>con_writ
<span style="color:gray">BIOSCODE:00F9                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:00FB </span>prn_table       <span style="color:navy">db </span><span style="color:#008040">26                   </span>; ((prn_table_end - prn_table)-1)/2 = 26
<span style="color:gray">BIOSCODE:00FC                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:00FE                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0100                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0102                 </span><span style="color:navy">dw offset </span>bc_cmderr
<span style="color:gray">BIOSCODE:0104                 </span><span style="color:navy">dw offset </span>prn_input
<span style="color:gray">BIOSCODE:0106                 </span><span style="color:navy">dw offset </span>z_bus_exit
<span style="color:gray">BIOSCODE:0108                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:010A                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:010C                 </span><span style="color:navy">dw offset </span>prn_writ
<span style="color:gray">BIOSCODE:010E                 </span><span style="color:navy">dw offset </span>prn_writ
<span style="color:gray">BIOSCODE:0110                 </span><span style="color:navy">dw offset </span>prn_stat
<span style="color:gray">BIOSCODE:0112                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0114                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0116                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0118                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:011A                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:011C                 </span><span style="color:navy">dw offset </span>prn_tilbusy
<span style="color:gray">BIOSCODE:011E                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0120                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0122                 </span><span style="color:navy">dw offset </span>prn_genioctl
<span style="color:gray">BIOSCODE:0124                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0126                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0128                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:012A                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:012C                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:012E                 </span><span style="color:navy">dw offset </span>prn_ioctl_query
<span style="color:gray">BIOSCODE:0130 </span>aux_table       <span style="color:navy">db </span><span style="color:#008040">11                   </span>; ((aux_table_end - aux_table)-1)/2 = 11
<span style="color:gray">BIOSCODE:0131                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0133                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0135                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0137                 </span><span style="color:navy">dw offset </span>bc_cmderr
<span style="color:gray">BIOSCODE:0139                 </span><span style="color:navy">dw offset </span>aux_read
<span style="color:gray">BIOSCODE:013B                 </span><span style="color:navy">dw offset </span>aux_rdnd
<span style="color:gray">BIOSCODE:013D                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:013F                 </span><span style="color:navy">dw offset </span>aux_flsh
<span style="color:gray">BIOSCODE:0141                 </span><span style="color:navy">dw offset </span>aux_writ
<span style="color:gray">BIOSCODE:0143                 </span><span style="color:navy">dw offset </span>aux_writ
<span style="color:gray">BIOSCODE:0145                 </span><span style="color:navy">dw offset </span>aux_wrst
<span style="color:gray">BIOSCODE:0147 </span>tim_table       <span style="color:navy">db </span><span style="color:#008040">10                   </span>; ((tim_table_end - tim_table)-1)/2 = 10
<span style="color:gray">BIOSCODE:0148                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:014A                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:014C                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:014E                 </span><span style="color:navy">dw offset </span>bc_cmderr
<span style="color:gray">BIOSCODE:0150                 </span><span style="color:navy">dw offset </span>tim_read
<span style="color:gray">BIOSCODE:0152                 </span><span style="color:navy">dw offset </span>z_bus_exit
<span style="color:gray">BIOSCODE:0154                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0156                 </span><span style="color:navy">dw offset </span>bc_exvec
<span style="color:gray">BIOSCODE:0158                 </span><span style="color:navy">dw offset </span>tim_writ
<span style="color:gray">BIOSCODE:015A                 </span><span style="color:navy">dw offset </span>tim_writ
<span style="color:black">BIOSCODE:015C
BIOSCODE:015C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:015C
BIOSCODE:015C
BIOSCODE:015C </span>con_read        proc near               <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:015C                 </span><span style="color:navy">jcxz    short </span>con_exit  ; read cx bytes from keyboard into buffer
<span style="color:black">BIOSCODE:015E
BIOSCODE:015E </span>con_loop<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:015E                 </span><span style="color:navy">call    </span>chrin           ; get char in al
<span style="color:black">BIOSCODE:0161                 </span><span style="color:navy">stosb                   </span>; store char at es:di
<span style="color:black">BIOSCODE:0162                 </span><span style="color:navy">loop    </span>con_loop
<span style="color:black">BIOSCODE:0164
BIOSCODE:0164 </span>con_exit<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0164                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:0165                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0165 </span>con_read        endp
<span style="color:black">BIOSCODE:0165
BIOSCODE:0166
BIOSCODE:0166 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0166
BIOSCODE:0166
BIOSCODE:0166 </span>chrin           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0166                 </span><span style="color:navy">mov     ah, ds:</span>keyrd_func ; set by msinit. 0 or 10h
<span style="color:black">BIOSCODE:016A                 </span><span style="color:navy">xor     al, al
</span><span style="color:black">BIOSCODE:016C                 </span><span style="color:navy">xchg    al, ds:</span>altah    ; get character &amp; zero altah
<span style="color:black">BIOSCODE:0170                 </span><span style="color:navy">or      al, al
</span><span style="color:black">BIOSCODE:0172                 </span><span style="color:navy">jnz     short </span><span style="color:gray">keyret
</span><span style="color:black">BIOSCODE:0174                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD -
<span style="color:black">BIOSCODE:0176
BIOSCODE:0176 </span>alt10<span style="color:navy">:
</span><span style="color:black">BIOSCODE:0176                 </span><span style="color:navy">or      ax, ax
</span><span style="color:black">BIOSCODE:0178                 </span><span style="color:navy">jz      short </span>chrin
<span style="color:black">BIOSCODE:017A                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">7200h       </span>; check for ctrl-prtsc
<span style="color:black">BIOSCODE:017D                 </span><span style="color:navy">jnz     short </span>alt_ext_chk
<span style="color:black">BIOSCODE:017F                 </span><span style="color:navy">mov     al, </span><span style="color:green">10h
</span><span style="color:black">BIOSCODE:0181                 </span><span style="color:navy">jmp     short </span><span style="color:gray">keyret
</span><span style="color:black">BIOSCODE:0183 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0183
BIOSCODE:0183 </span>alt_ext_chk<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0183                 </span><span style="color:navy">cmp     ds:</span>keyrd_func<span style="color:navy">, </span><span style="color:green">0
</span><span style="color:black">BIOSCODE:0188                 </span><span style="color:navy">jz      short </span><span style="color:gray">not_ext
</span><span style="color:black">BIOSCODE:018A                 </span><span style="color:navy">cmp     al, </span><span style="color:green">0E0h
</span><span style="color:black">BIOSCODE:018C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">not_ext
</span><span style="color:black">BIOSCODE:018E                 </span><span style="color:navy">or      ah, ah
</span><span style="color:black">BIOSCODE:0190                 </span><span style="color:navy">jz      short </span><span style="color:gray">keyret
</span><span style="color:black">BIOSCODE:0192                 </span><span style="color:navy">xor     al, al
</span><span style="color:black">BIOSCODE:0194                 </span><span style="color:navy">jmp     short </span><span style="color:gray">alt_save
</span><span style="color:black">BIOSCODE:0196 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0196
BIOSCODE:0196 </span><span style="color:gray">not_ext</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0196                 </span><span style="color:navy">or      al, al          </span>; special case?
<span style="color:black">BIOSCODE:0198                 </span><span style="color:navy">jnz     short </span><span style="color:gray">keyret
</span><span style="color:black">BIOSCODE:019A
BIOSCODE:019A </span><span style="color:gray">alt_save</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:019A                 </span><span style="color:navy">mov     ds:</span>altah<span style="color:navy">, ah    </span>; store special key
<span style="color:black">BIOSCODE:019E
BIOSCODE:019E </span><span style="color:gray">keyret</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:019E                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:019E </span>chrin           endp
<span style="color:black">BIOSCODE:019E
BIOSCODE:019F
BIOSCODE:019F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:019F
BIOSCODE:019F
BIOSCODE:019F </span>con_rdnd        proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:019F                 </span><span style="color:navy">mov     al, ds:</span>altah    ; keyboard non destructive read, no wait
<span style="color:black">BIOSCODE:01A2                 </span><span style="color:navy">or      al, al
</span><span style="color:black">BIOSCODE:01A4                 </span><span style="color:navy">jnz     short </span>rdexit
<span style="color:black">BIOSCODE:01A6                 </span><span style="color:navy">mov     ah, ds:</span>keysts_func
<span style="color:black">BIOSCODE:01AA                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD -
<span style="color:black">BIOSCODE:01AC                 </span><span style="color:navy">jnz     short </span>gotchr
<span style="color:black">BIOSCODE:01AE                 </span><span style="color:navy">cmp     ds:</span>fhavek09<span style="color:navy">, </span><span style="color:green">0
</span><span style="color:black">BIOSCODE:01B3                 </span><span style="color:navy">jz      short </span>z_bus_exit
<span style="color:black">BIOSCODE:01B5                 </span><span style="color:navy">les     bx, ds:</span>ptrsav
<span style="color:black">BIOSCODE:01B9                 </span><span style="color:navy">test    word ptr es:[bx+</span><span style="color:green">3</span><span style="color:navy">], </span><span style="color:green">400h </span>; [es:bx+status]
<span style="color:black">BIOSCODE:01BF                 </span><span style="color:navy">jz      short </span>z_bus_exit
<span style="color:black">BIOSCODE:01C1                 </span><span style="color:navy">mov     ax, </span><span style="color:green">4100h
</span><span style="color:black">BIOSCODE:01C4                 </span><span style="color:navy">xor     bl, bl
</span><span style="color:black">BIOSCODE:01C6                 </span><span style="color:navy">int     </span><span style="color:green">15h             </span>; SYSTEM - WAIT ON EXTERNAL EVENT (CONVERTIBLE)
<span style="color:black">BIOSCODE:01C6                                         </span>; AL = condition type, BH = condition compare or mask value
<span style="color:black">BIOSCODE:01C6                                         </span>; BL = timeout value times 55 milliseconds, 00h means no timeout
<span style="color:black">BIOSCODE:01C6                                         </span>; DX = I/O port address if AL bit 4 set
<span style="color:black">BIOSCODE:01C8
BIOSCODE:01C8 </span>z_bus_exit<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:01C8                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:01C9                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3           </span>; indicate busy status
<span style="color:black">BIOSCODE:01CB                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:01CC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:01CC
BIOSCODE:01CC </span>gotchr<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:01CC                 </span><span style="color:navy">or      ax, ax
</span><span style="color:black">BIOSCODE:01CE                 </span><span style="color:navy">jnz     short </span>notbrk    ; check for null after break
<span style="color:black">BIOSCODE:01D0                 </span><span style="color:navy">mov     ah, ds:</span>keyrd_func ; issue keyboard read function
<span style="color:black">BIOSCODE:01D4                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD -
<span style="color:black">BIOSCODE:01D6                 </span><span style="color:navy">jmp     short </span>con_rdnd  ; get a real status
<span style="color:black">BIOSCODE:01D8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:01D8
BIOSCODE:01D8 </span>notbrk<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:01D8                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">7200h       </span>; check for ctrl-prtsc
<span style="color:black">BIOSCODE:01DB                 </span><span style="color:navy">jnz     short </span>rd_ext_chk
<span style="color:black">BIOSCODE:01DD                 </span><span style="color:navy">mov     al, </span><span style="color:green">10h         </span>; (&#039;P&#039; &amp; 1Fh) ; return control p
<span style="color:black">BIOSCODE:01DF                 </span><span style="color:navy">jmp     short </span>rdexit
<span style="color:black">BIOSCODE:01E1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:01E1
BIOSCODE:01E1 </span>rd_ext_chk<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:01E1                 </span><span style="color:navy">cmp     ds:</span>keyrd_func<span style="color:navy">, </span><span style="color:green">0 </span>; extended keyboard function?
<span style="color:black">BIOSCODE:01E6                 </span><span style="color:navy">jz      short </span>rdexit
<span style="color:black">BIOSCODE:01E8                 </span><span style="color:navy">cmp     al, </span><span style="color:green">0E0h        </span>; extended key value or greek alpha?
<span style="color:black">BIOSCODE:01EA                 </span><span style="color:navy">jnz     short </span>rdexit
<span style="color:black">BIOSCODE:01EC                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">0           </span>; scan code exist?
<span style="color:black">BIOSCODE:01EF                 </span><span style="color:navy">jz      short </span>rdexit    ; yes. greek alpha char.
<span style="color:black">BIOSCODE:01F1                 </span><span style="color:navy">mov     al, </span><span style="color:green">0           </span>; no. extended key stroke.
<span style="color:black">BIOSCODE:01F1                                         </span>; change it for compatibility
<span style="color:black">BIOSCODE:01F3
BIOSCODE:01F3 </span>rdexit<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:01F3                 </span><span style="color:navy">les     bx, ds:</span>ptrsav
<span style="color:black">BIOSCODE:01F7                 </span><span style="color:navy">mov     es:[bx+</span><span style="color:green">13</span><span style="color:navy">], al  </span>; [es:bx+media]
<span style="color:black">BIOSCODE:01F7                                         </span>;  return keyboard character here
<span style="color:black">BIOSCODE:01FB
BIOSCODE:01FB </span>bc_exvec<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:01FB                 </span><span style="color:navy">clc                     </span>; indicate normal termination
<span style="color:black">BIOSCODE:01FC                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:01FC </span>con_rdnd        endp
<span style="color:black">BIOSCODE:01FC
BIOSCODE:01FD
BIOSCODE:01FD </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:01FD
BIOSCODE:01FD
BIOSCODE:01FD </span>con_writ        proc near               <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:01FD                 </span><span style="color:navy">jcxz    short </span>bc_exvec  ; console write routine
<span style="color:black">BIOSCODE:01FF
BIOSCODE:01FF </span>con_lp<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:01FF                 </span><span style="color:navy">mov     al, es:[di]
</span><span style="color:black">BIOSCODE:0202                 </span><span style="color:navy">inc     di
</span><span style="color:black">BIOSCODE:0203                 </span><span style="color:navy">int     </span><span style="color:green">29h             </span>; DOS 2+ internal - FAST PUTCHAR
<span style="color:black">BIOSCODE:0203                                         </span>; AL = character to display
<span style="color:black">BIOSCODE:0205                 </span><span style="color:navy">loop    </span>con_lp
<span style="color:black">BIOSCODE:0205 </span>con_writ        endp
<span style="color:black">BIOSCODE:0205
BIOSCODE:0207 </span><span style="color:gray">; START OF FUNCTION CHUNK FOR con_flush
</span><span style="color:black">BIOSCODE:0207
BIOSCODE:0207 </span><span style="color:navy">loc_27C7:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0207                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:0208                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0208 </span><span style="color:gray">; END OF FUNCTION CHUNK FOR con_flush
</span><span style="color:black">BIOSCODE:0209
BIOSCODE:0209 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0209
BIOSCODE:0209
BIOSCODE:0209 </span>con_flush       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0209
BIOSCODE:0209 </span><span style="color:gray">; FUNCTION CHUNK AT BIOSCODE:0207 SIZE 00000002 BYTES
</span><span style="color:black">BIOSCODE:0209
BIOSCODE:0209                 </span><span style="color:navy">mov     ds:</span>altah<span style="color:navy">, </span><span style="color:green">0     </span>; flush out keyboard queue
<span style="color:black">BIOSCODE:0209                                         </span>; clear out holding buffer
<span style="color:black">BIOSCODE:020E
BIOSCODE:020E </span><span style="color:gray">flloop</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:020E                 </span><span style="color:navy">mov     ah, </span><span style="color:green">1           </span>; while (charavail()) charread();
<span style="color:black">BIOSCODE:0210                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - CHECK BUFFER, DO NOT CLEAR
<span style="color:black">BIOSCODE:0210                                         </span>; Return: ZF clear if character in buffer
<span style="color:black">BIOSCODE:0210                                         </span>; AH = scan code, AL = character
<span style="color:black">BIOSCODE:0210                                         </span>; ZF set if no character in buffer
<span style="color:black">BIOSCODE:0212                 </span><span style="color:navy">jz      short loc_27C7
</span><span style="color:black">BIOSCODE:0214                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">BIOSCODE:0216                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
<span style="color:black">BIOSCODE:0216                                         </span>; Return: AH = scan code, AL = character
<span style="color:black">BIOSCODE:0218                 </span><span style="color:navy">jmp     short </span><span style="color:gray">flloop
</span><span style="color:black">BIOSCODE:0218 </span>con_flush       endp
<span style="color:black">BIOSCODE:0218
</span><span style="color:maroon">BIOSCODE:021A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:021A
BIOSCODE:021A </span>prn_input<span style="color:navy">:                              </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:021A                 </span><span style="color:navy">call    </span>bc_err_cnt      ; reset count to zero
<span style="color:maroon">BIOSCODE:021A                                         </span>; (sub reqpkt.count,cx)
<span style="color:maroon">BIOSCODE:021D                 </span><span style="color:navy">clc                     </span>; but return with carry   reset for no error
<span style="color:maroon">BIOSCODE:021E                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:021F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:021F
BIOSCODE:021F </span>prn_writ<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:021F                 </span><span style="color:navy">jcxz    short </span>prn_done  ; write cx bytes from es:di to printer device
<span style="color:maroon">BIOSCODE:0221
BIOSCODE:0221 </span>prn_loop<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0221                 </span><span style="color:navy">mov     bx, </span><span style="color:green">2           </span>; retry count
<span style="color:maroon">BIOSCODE:0224
BIOSCODE:0224 </span>prn_out<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0224                 </span><span style="color:navy">call    </span>prnstat         ; get status
<span style="color:maroon">BIOSCODE:0227                 </span><span style="color:navy">jnz     short </span>TestPrnError
<span style="color:maroon">BIOSCODE:0229                 </span><span style="color:navy">mov     al, es:[di]     </span>; get character to print
<span style="color:maroon">BIOSCODE:022C                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:maroon">BIOSCODE:022E                 </span><span style="color:navy">call    </span>prnop           ; print to printer
<span style="color:maroon">BIOSCODE:0231                 </span><span style="color:navy">jz      short </span>prn_con   ; no error - continue
<span style="color:maroon">BIOSCODE:0233                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">0FFh        </span>; MODE_CTRLBRK
<span style="color:maroon">BIOSCODE:0236                 </span><span style="color:navy">jnz     short </span>_prnwf
<span style="color:maroon">BIOSCODE:0238                 </span><span style="color:navy">mov     al, </span><span style="color:green">0Ch         </span>; error_I24_gen_failure
<span style="color:maroon">BIOSCODE:023A                 </span><span style="color:navy">mov     ds:</span>altah<span style="color:navy">, </span><span style="color:green">0
</span><span style="color:maroon">BIOSCODE:023F                 </span><span style="color:navy">jmp     short </span>pmessg
<span style="color:maroon">BIOSCODE:0241 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0241
BIOSCODE:0241 </span>_prnwf<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0241                 </span><span style="color:navy">test    ah, </span><span style="color:green">1           </span>; timeoutstatus
<span style="color:maroon">BIOSCODE:0244                 </span><span style="color:navy">jz      short </span>prn_con
<span style="color:maroon">BIOSCODE:0246
BIOSCODE:0246 </span>TestPrnError<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0246                 </span><span style="color:navy">dec     bx              </span>; retry until count is exhausted
<span style="color:maroon">BIOSCODE:0247                 </span><span style="color:navy">jnz     short </span>prn_out
<span style="color:maroon">BIOSCODE:0249
BIOSCODE:0249 </span>pmessg<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0249                 </span><span style="color:navy">jmp     </span>bc_err_cnt
<span style="color:maroon">BIOSCODE:024C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:024C
BIOSCODE:024C </span>prn_con<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:024C                 </span><span style="color:navy">inc     di              </span>; point to next char and continue
<span style="color:maroon">BIOSCODE:024D                 </span><span style="color:navy">loop    </span>prn_loop
<span style="color:maroon">BIOSCODE:024F
BIOSCODE:024F </span>prn_done<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:024F                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:0250                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0251 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0251
BIOSCODE:0251 </span>prn_stat<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0251                 </span><span style="color:navy">call    </span>prnstat         ; device in dx
<span style="color:maroon">BIOSCODE:0254                 </span><span style="color:navy">jnz     short </span>pmessg
<span style="color:maroon">BIOSCODE:0256                 </span><span style="color:navy">test    ah, </span><span style="color:green">80h         </span>; notbusystatus
<span style="color:maroon">BIOSCODE:0259                 </span><span style="color:navy">jnz     short </span>prn_done
<span style="color:maroon">BIOSCODE:025B                 </span><span style="color:navy">jmp     </span>z_bus_exit
<span style="color:black">BIOSCODE:025E
BIOSCODE:025E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:025E
BIOSCODE:025E
BIOSCODE:025E </span>prnstat         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:025E                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2           </span>; PRINTER - GET STATUS
<span style="color:black">BIOSCODE:025E </span><span style="background:blue">prnstat         endp</span><span style="background:blue"> ; sp-analysis failed</span> ; set command for get status
<span style="color:black">BIOSCODE:025E                                         </span>; DX = printer port (0-3)
<span style="color:black">BIOSCODE:025E                                         </span>; Return: AH = status
<span style="color:black">BIOSCODE:0260
BIOSCODE:0260 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0260
BIOSCODE:0260
BIOSCODE:0260 </span>prnop           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0260                 </span><span style="color:navy">mov     dx, ds:</span>auxnum   ; get printer number
<span style="color:black">BIOSCODE:0264                 </span><span style="color:navy">int     </span><span style="color:green">17h             </span>; PRINTER - GET STATUS
<span style="color:black">BIOSCODE:0264                                         </span>; DX = printer port (0-3)
<span style="color:black">BIOSCODE:0264                                         </span>; Return: AH = status
<span style="color:black">BIOSCODE:0266                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:0267                 </span><span style="color:navy">and     ah, </span><span style="color:green">30h
</span><span style="color:black">BIOSCODE:026A                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">30h         </span>; noprinter error
<span style="color:black">BIOSCODE:026D                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:026E                 </span><span style="color:navy">jnz     short </span>NextTest
<span style="color:black">BIOSCODE:0270                 </span><span style="color:navy">and     ah, </span><span style="color:green">0DFh        </span>; ~nopaperstatus
<span style="color:black">BIOSCODE:0273                 </span><span style="color:navy">or      ah, </span><span style="color:green">8           </span>; ioerrstatus
<span style="color:black">BIOSCODE:0276
BIOSCODE:0276 </span>NextTest<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0276                 </span><span style="color:navy">test    ah, </span><span style="color:green">28h         </span>; (ioerrstatus+nopaperstatus)
<span style="color:black">BIOSCODE:0276                                         </span>; i/o error?
<span style="color:black">BIOSCODE:0279                 </span><span style="color:navy">jz      short </span><span style="color:gray">checknotready </span>; no, try not ready
<span style="color:black">BIOSCODE:027B                 </span><span style="color:navy">mov     al, </span><span style="color:green">9           </span>; error_I24_out_of_paper
<span style="color:black">BIOSCODE:027B                                         </span>; first, assume out of paper
<span style="color:black">BIOSCODE:027D                 </span><span style="color:navy">test    ah, </span><span style="color:green">20h         </span>; out of paper set?
<span style="color:black">BIOSCODE:0280                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ret1      </span>; yes, error is set
<span style="color:black">BIOSCODE:0282                 </span><span style="color:navy">inc     al              </span>; return al=10 (i/o error)
<span style="color:black">BIOSCODE:0284
BIOSCODE:0284 </span><span style="color:gray">ret1</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0284                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0285 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0285
BIOSCODE:0285 </span><span style="color:gray">checknotready</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0285                 </span><span style="color:navy">mov     al, </span><span style="color:green">2           </span>; assume not-ready
<span style="color:black">BIOSCODE:0287                 </span><span style="color:navy">test    ah, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:028A                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:028A </span>prnop           endp
<span style="color:black">BIOSCODE:028A
</span><span style="color:maroon">BIOSCODE:028B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:028B
BIOSCODE:028B </span>prn_tilbusy<span style="color:navy">:                            </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:028B                 </span><span style="color:navy">mov     si, di
</span><span style="color:maroon">BIOSCODE:028D
BIOSCODE:028D </span>prn_tilbloop<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:028D                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSCODE:028E                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:028F                 </span><span style="color:navy">xor     bh, bh
</span><span style="color:maroon">BIOSCODE:0291                 </span><span style="color:navy">mov     bl, ds:</span>printdev
<span style="color:maroon">BIOSCODE:0295                 </span><span style="color:navy">shl     bx, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:0297                 </span><span style="color:navy">mov     cx, ds:</span>wait_count<span style="color:navy">[bx] </span>; wait count times to come ready
<span style="color:maroon">BIOSCODE:029B                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:029C
BIOSCODE:029C </span>prn_getstat<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:029C                 </span><span style="color:navy">call    </span>prnstat         ; get status
<span style="color:maroon">BIOSCODE:029F                 </span><span style="color:navy">jnz     short </span>prn_bperr ; error
<span style="color:maroon">BIOSCODE:02A1                 </span><span style="color:navy">test    ah, </span><span style="color:green">80h         </span>; ready yet?
<span style="color:maroon">BIOSCODE:02A4                 </span><span style="color:navy">loope   </span>prn_getstat     ; no, go for more
<span style="color:maroon">BIOSCODE:02A6                 </span><span style="color:navy">pop     cx              </span>; get original count
<span style="color:maroon">BIOSCODE:02A7                 </span><span style="color:navy">jz      short </span>prn_berr  ; still not ready =&gt; done
<span style="color:maroon">BIOSCODE:02A9                 </span><span style="color:navy">lods    byte ptr es:[si]
</span><span style="color:maroon">BIOSCODE:02AB                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:maroon">BIOSCODE:02AD                 </span><span style="color:navy">call    </span>prnop
<span style="color:maroon">BIOSCODE:02B0                 </span><span style="color:navy">jnz     short </span>prn_berr
<span style="color:maroon">BIOSCODE:02B2                 </span><span style="color:navy">loop    </span>prn_tilbloop
<span style="color:maroon">BIOSCODE:02B4                 </span><span style="color:navy">clc                     </span>; normal no-error return
<span style="color:maroon">BIOSCODE:02B5                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:02B6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:02B6
BIOSCODE:02B6 </span>prn_bperr<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:02B6                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSCODE:02B7
BIOSCODE:02B7 </span>prn_berr<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:02B7                 </span><span style="color:navy">jmp     </span>bc_err_cnt
<span style="color:maroon">BIOSCODE:02BA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:02BA
BIOSCODE:02BA </span>prn_genioctl<span style="color:navy">:                           </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:02BA                 </span><span style="color:navy">les     di, ds:</span>ptrsav
<span style="color:maroon">BIOSCODE:02BE                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:green">13</span><span style="color:navy">], </span><span style="color:green">5 </span>; [es:di+IOCTL_REQ.MAJORFUNCTION]
<span style="color:maroon">BIOSCODE:02BE                                         </span>; ioc_pc
<span style="color:maroon">BIOSCODE:02C3                 </span><span style="color:navy">jz      short </span>prnfunc_ok
<span style="color:maroon">BIOSCODE:02C5
BIOSCODE:02C5 </span>prnfuncerr<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:02C5                 </span><span style="color:navy">jmp     </span>bc_cmderr
<span style="color:maroon">BIOSCODE:02C8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:02C8
BIOSCODE:02C8 </span>prnfunc_ok<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:02C8                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:green">14</span><span style="color:navy">]  </span>; [es:di+IOCTL_REQ.MINORFUNCTION]
<span style="color:maroon">BIOSCODE:02CC                 </span><span style="color:navy">les     di, es:[di+</span><span style="color:green">19</span><span style="color:navy">]  </span>; [es:di+IOCTL_REQ.GENERICIOCTL_PACKET]
<span style="color:maroon">BIOSCODE:02D0                 </span><span style="color:navy">xor     bh, bh
</span><span style="color:maroon">BIOSCODE:02D2                 </span><span style="color:navy">mov     bl, ds:</span>printdev
<span style="color:maroon">BIOSCODE:02D6                 </span><span style="color:navy">shl     bx, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:02D8                 </span><span style="color:navy">mov     cx, ds:</span>wait_count<span style="color:navy">[bx] </span>; pull out retry count for device
<span style="color:maroon">BIOSCODE:02DC                 </span><span style="color:navy">cmp     al, </span><span style="color:green">65h         </span>; get_retry_count
<span style="color:maroon">BIOSCODE:02DE                 </span><span style="color:navy">jz      short </span>prngetcount
<span style="color:maroon">BIOSCODE:02E0                 </span><span style="color:navy">cmp     al, </span><span style="color:green">45h         </span>; set_retry_count
<span style="color:maroon">BIOSCODE:02E2                 </span><span style="color:navy">jnz     short </span>prnfuncerr
<span style="color:maroon">BIOSCODE:02E4                 </span><span style="color:navy">mov     cx, es:[di]
</span><span style="color:maroon">BIOSCODE:02E7
BIOSCODE:02E7 </span>prngetcount<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:02E7                 </span><span style="color:navy">mov     ds:</span>wait_count<span style="color:navy">[bx], cx
</span><span style="color:maroon">BIOSCODE:02EB                 </span><span style="color:navy">mov     es:[di], cx     </span>; [es:di+A_RETRYCOUNT.RC_COUNT]
<span style="color:maroon">BIOSCODE:02EB                                         </span>; return current retry count
<span style="color:maroon">BIOSCODE:02EE                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:02EF                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:02F0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:02F0
BIOSCODE:02F0 </span>prn_ioctl_query<span style="color:navy">:                        </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:02F0                 </span><span style="color:navy">les     di, ds:</span>ptrsav
<span style="color:maroon">BIOSCODE:02F4                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:green">13</span><span style="color:navy">], </span><span style="color:green">5 </span>; [es:di+IOCTL_REQ.MAJORFUNCTION]
<span style="color:maroon">BIOSCODE:02F4                                         </span>; ioc_pc
<span style="color:maroon">BIOSCODE:02F9                 </span><span style="color:navy">jnz     short </span>prn_query_err
<span style="color:maroon">BIOSCODE:02FB                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:green">14</span><span style="color:navy">]  </span>; [es:di+IOCTL_REQ.MINORFUNCTION]
<span style="color:maroon">BIOSCODE:02FF                 </span><span style="color:navy">cmp     al, </span><span style="color:green">65h         </span>; GET_RETRY_COUNT
<span style="color:maroon">BIOSCODE:0301                 </span><span style="color:navy">jz      short </span>IOCtlSupported
<span style="color:maroon">BIOSCODE:0303                 </span><span style="color:navy">cmp     al, </span><span style="color:green">45h         </span>; SET_RETRY_COUNT
<span style="color:maroon">BIOSCODE:0305                 </span><span style="color:navy">jnz     short </span>prn_query_err
<span style="color:maroon">BIOSCODE:0307
BIOSCODE:0307 </span>IOCtlSupported<span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0307                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:0308                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0309 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0309
BIOSCODE:0309 </span>prn_query_err<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0309                 </span><span style="color:navy">stc
</span><span style="color:maroon">BIOSCODE:030A                 </span><span style="color:navy">jmp     </span>bc_cmderr
<span style="color:maroon">BIOSCODE:030D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:030D
BIOSCODE:030D </span>aux_read<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:030D                 </span><span style="color:navy">jcxz    short </span>exvec2
<span style="color:maroon">BIOSCODE:030F                 </span><span style="color:navy">call    </span>getbx           ; put address of auxbuf in bx
<span style="color:maroon">BIOSCODE:0312                 </span><span style="color:navy">xor     al, al
</span><span style="color:maroon">BIOSCODE:0314                 </span><span style="color:navy">xchg    al, [bx]
</span><span style="color:maroon">BIOSCODE:0316                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">BIOSCODE:0318                 </span><span style="color:navy">jnz     short </span>aux2
<span style="color:maroon">BIOSCODE:031A
BIOSCODE:031A </span>aux1<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:031A                 </span><span style="color:navy">call    </span>auxin           ; get character from port
<span style="color:maroon">BIOSCODE:031A                                         </span>; won&#039;t return if error
<span style="color:maroon">BIOSCODE:031D
BIOSCODE:031D </span>aux2<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:031D                 </span><span style="color:navy">stosb
</span><span style="color:maroon">BIOSCODE:031E                 </span><span style="color:navy">loop    </span>aux1            ; if more characters, go around again
<span style="color:maroon">BIOSCODE:0320
BIOSCODE:0320 </span>exvec2<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0320                 </span><span style="color:navy">clc                     </span>; all done, successful exit
<span style="color:maroon">BIOSCODE:0321                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0322
BIOSCODE:0322 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0322
BIOSCODE:0322
BIOSCODE:0322 </span>auxin           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0322                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2
</span><span style="color:black">BIOSCODE:0324                 </span><span style="color:navy">call    </span>auxop
<span style="color:black">BIOSCODE:0327                 </span><span style="color:navy">test    ah, </span><span style="color:green">0Eh         </span>; flag_frame|flag_parity|flag_overrun
<span style="color:black">BIOSCODE:032A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">arbad
</span><span style="color:black">BIOSCODE:032C                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:032D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:032D
BIOSCODE:032D </span><span style="color:gray">arbad</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:032D                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:032E                 </span><span style="color:navy">xor     al, al
</span><span style="color:black">BIOSCODE:0330                 </span><span style="color:navy">or      al, </span><span style="color:green">0B0h        </span>; flag_rec_sig|flag_dsr|flag_cts
<span style="color:black">BIOSCODE:0332                 </span><span style="color:navy">jmp     </span>bc_err_cnt
<span style="color:black">BIOSCODE:0332 </span><span style="background:blue">auxin           endp</span><span style="background:blue"> ; sp-analysis failed</span>
<span style="color:black">BIOSCODE:0332
</span><span style="color:maroon">BIOSCODE:0335 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0335
BIOSCODE:0335 </span>aux_rdnd<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0335                 </span><span style="color:navy">call    </span>getbx           ; non-destructive aux port read
<span style="color:maroon">BIOSCODE:0338                 </span><span style="color:navy">mov     al, [bx]
</span><span style="color:maroon">BIOSCODE:033A                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">BIOSCODE:033C                 </span><span style="color:navy">jnz     short </span>auxrdx    ; if al is non-zero (char in buffer)
<span style="color:maroon">BIOSCODE:033C                                         </span>; then return character
<span style="color:maroon">BIOSCODE:033E                 </span><span style="color:navy">call    </span>auxstat         ; if not, get status of   aux device
<span style="color:maroon">BIOSCODE:0341                 </span><span style="color:navy">test    ah, </span><span style="color:green">1           </span>; flag_data_ready - test data ready
<span style="color:maroon">BIOSCODE:0344                 </span><span style="color:navy">jz      short </span>auxbus    ; then device is busy (not ready)
<span style="color:maroon">BIOSCODE:0346                 </span><span style="color:navy">test    al, </span><span style="color:green">20h         </span>; flag_dsr - test data set ready
<span style="color:maroon">BIOSCODE:0348                 </span><span style="color:navy">jz      short </span>auxbus    ; then device is busy (not ready)
<span style="color:maroon">BIOSCODE:034A                 </span><span style="color:navy">call    </span>auxin           ; else aux is ready, get character
<span style="color:maroon">BIOSCODE:034D                 </span><span style="color:navy">mov     [bx], al
</span><span style="color:maroon">BIOSCODE:034F
BIOSCODE:034F </span>auxrdx<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:034F                 </span><span style="color:navy">jmp     </span>rdexit          ; return busy status
<span style="color:maroon">BIOSCODE:0352 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0352
BIOSCODE:0352 </span>auxbus<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0352                 </span><span style="color:navy">jmp     </span>z_bus_exit
<span style="color:maroon">BIOSCODE:0355 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0355
BIOSCODE:0355 </span>aux_wrst<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0355                 </span><span style="color:navy">call    </span>auxstat         ; return aux port write status
<span style="color:maroon">BIOSCODE:0358                 </span><span style="color:navy">test    al, </span><span style="color:green">20h         </span>; test data set ready
<span style="color:maroon">BIOSCODE:035A                 </span><span style="color:navy">jz      short </span>auxbus    ; then device is busy (not ready)
<span style="color:maroon">BIOSCODE:035C                 </span><span style="color:navy">test    ah, </span><span style="color:green">20h         </span>; flag_tranhol_emp - test transmit hold reg
<span style="color:maroon">BIOSCODE:035F                 </span><span style="color:navy">jz      short </span>auxbus    ; then device is busy (not ready)
<span style="color:maroon">BIOSCODE:0361                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:0362                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0363
BIOSCODE:0363 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0363
BIOSCODE:0363
BIOSCODE:0363 </span>auxstat         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0363                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3           </span>; auxfunc_status
<span style="color:black">BIOSCODE:0363 </span><span style="background:blue">auxstat         endp</span><span style="background:blue"> ; sp-analysis failed</span>
<span style="color:black">BIOSCODE:0363
BIOSCODE:0365
BIOSCODE:0365 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0365
BIOSCODE:0365
BIOSCODE:0365 </span>auxop           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0365                 </span><span style="color:navy">mov     dx, ds:</span>auxnum   ; ah=function code
<span style="color:black">BIOSCODE:0365                                         </span>; 0=init, 1=send, 2=receive, 3=status
<span style="color:black">BIOSCODE:0365                                         </span>; get port number
<span style="color:black">BIOSCODE:0369                 </span><span style="color:navy">int     </span><span style="color:green">14h             </span>; SERIAL I/O - GET USART STATUS
<span style="color:black">BIOSCODE:0369                                         </span>; DX = port number (0-3)
<span style="color:black">BIOSCODE:0369                                         </span>; Return: AX = port status code
<span style="color:black">BIOSCODE:036B                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:036B </span>auxop           endp
<span style="color:black">BIOSCODE:036B
</span><span style="color:maroon">BIOSCODE:036C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:036C
BIOSCODE:036C </span>aux_flsh<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:036C                 </span><span style="color:navy">call    </span>getbx           ; flush aux input buffer
<span style="color:maroon">BIOSCODE:036C                                         </span>; get bx to point to auxbuf
<span style="color:maroon">BIOSCODE:036C                                         </span>; zero out buffer
<span style="color:maroon">BIOSCODE:036C                                         </span>; all done, successful return
<span style="color:maroon">BIOSCODE:036F                 </span><span style="color:navy">mov     byte ptr [bx], </span><span style="color:green">0
</span><span style="color:maroon">BIOSCODE:0372                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:0373                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0374 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0374
BIOSCODE:0374 </span>aux_writ<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0374                 </span><span style="color:navy">jcxz    short </span>exvec2    ; write to aux device (if cx &gt; 0)
<span style="color:maroon">BIOSCODE:0376
BIOSCODE:0376 </span>aux_loop<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0376                 </span><span style="color:navy">mov     al, es:[di]     </span>; get character to be written
<span style="color:maroon">BIOSCODE:0379                 </span><span style="color:navy">inc     di              </span>; move di pointer to next character
<span style="color:maroon">BIOSCODE:037A                 </span><span style="color:navy">mov     ah, </span><span style="color:green">1           </span>; auxfunc_send - indicates a write
<span style="color:maroon">BIOSCODE:037C                 </span><span style="color:navy">call    </span>auxop           ; send character over aux port
<span style="color:maroon">BIOSCODE:037F                 </span><span style="color:navy">test    ah, </span><span style="color:green">80h         </span>; check for error
<span style="color:maroon">BIOSCODE:0382                 </span><span style="color:navy">jz      short </span>awok      ; then no error
<span style="color:maroon">BIOSCODE:0384                 </span><span style="color:navy">mov     al, </span><span style="color:green">10          </span>; else indicate write fault
<span style="color:maroon">BIOSCODE:0386                 </span><span style="color:navy">jmp     </span>bc_err_cnt      ; call error routines
<span style="color:maroon">BIOSCODE:0389 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0389
BIOSCODE:0389 </span>awok<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0389                 </span><span style="color:navy">loop    </span>aux_loop        ; return bx -&gt; single byte input buffer
<span style="color:maroon">BIOSCODE:0389                                         </span>; for selected aux port ([auxnum])
<span style="color:maroon">BIOSCODE:038B                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:038C                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:038D
BIOSCODE:038D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:038D
BIOSCODE:038D
BIOSCODE:038D </span>getbx           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:038D                 </span><span style="color:navy">mov     bx, ds:</span>auxnum
<span style="color:black">BIOSCODE:0391                 </span><span style="color:navy">add     bx, offset </span>auxbuf
<span style="color:black">BIOSCODE:0395                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0395 </span>getbx           endp
<span style="color:black">BIOSCODE:0395
</span><span style="color:maroon">BIOSCODE:0396 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0396
BIOSCODE:0396 </span>time_to_ticks<span style="color:navy">:                          </span>; convert time to ticks
<span style="color:maroon">BIOSCODE:0396                 </span><span style="color:navy">mov     al, </span><span style="color:green">60          </span>; input : time in cx and dx
<span style="color:maroon">BIOSCODE:0396                                         </span>; output: ticks returned in cx:dx
<span style="color:maroon">BIOSCODE:0396                                         </span>;
<span style="color:maroon">BIOSCODE:0396                                         </span>; the clock ticks at the rate of:
<span style="color:maroon">BIOSCODE:0396                                         </span>; 1193180/65536 ticks/second
<span style="color:maroon">BIOSCODE:0396                                         </span>; (about 18.2 ticks per second)
<span style="color:maroon">BIOSCODE:0398                 </span><span style="color:navy">mul     ch              </span>; hours to minutes ///
<span style="color:maroon">BIOSCODE:0398                                         </span>; first convert from hour,min,sec,hund. to
<span style="color:maroon">BIOSCODE:0398                                         </span>; total number of 100th of seconds
<span style="color:maroon">BIOSCODE:039A                 </span><span style="color:navy">mov     ch, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:039C                 </span><span style="color:navy">add     ax, cx          </span>; total minutes
<span style="color:maroon">BIOSCODE:039E                 </span><span style="color:navy">mov     cx, </span><span style="color:green">6000        </span>; 60*100
<span style="color:maroon">BIOSCODE:03A1                 </span><span style="color:navy">mov     bx, dx
</span><span style="color:maroon">BIOSCODE:03A3                 </span><span style="color:navy">mul     cx              </span>; convert to 1/100 sec
<span style="color:maroon">BIOSCODE:03A5                 </span><span style="color:navy">mov     cx, ax
</span><span style="color:maroon">BIOSCODE:03A7                 </span><span style="color:navy">mov     al, </span><span style="color:green">100
</span><span style="color:maroon">BIOSCODE:03A9                 </span><span style="color:navy">mul     bh              </span>; convert seconds to 1/100 sec
<span style="color:maroon">BIOSCODE:03AB                 </span><span style="color:navy">add     cx, ax          </span>; combine seconds with hours and min
<span style="color:maroon">BIOSCODE:03AD                 </span><span style="color:navy">adc     dx, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:03B0                 </span><span style="color:navy">mov     bh, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:03B2                 </span><span style="color:navy">add     cx, bx          </span>; combine 1/100 sec
<span style="color:maroon">BIOSCODE:03B4                 </span><span style="color:navy">adc     dx, </span><span style="color:#ff8000">0           </span>; dx:cx is time in 1/100 sec
<span style="color:maroon">BIOSCODE:03B7                 </span><span style="color:navy">xchg    ax, dx
</span><span style="color:maroon">BIOSCODE:03B8                 </span><span style="color:navy">xchg    ax, cx          </span>; now time is in cx:ax
<span style="color:maroon">BIOSCODE:03B9                 </span><span style="color:navy">mov     bx, </span><span style="color:green">59659
</span><span style="color:maroon">BIOSCODE:03BC                 </span><span style="color:navy">mul     bx              </span>; multiply low half
<span style="color:maroon">BIOSCODE:03BE                 </span><span style="color:navy">xchg    dx, cx
</span><span style="color:maroon">BIOSCODE:03C0                 </span><span style="color:navy">xchg    ax, dx          </span>; cx-&gt;ax, ax-&gt;dx, dx-&gt;cx
<span style="color:maroon">BIOSCODE:03C1                 </span><span style="color:navy">mul     bx              </span>; multiply high half
<span style="color:maroon">BIOSCODE:03C3                 </span><span style="color:navy">add     ax, cx          </span>; combine overlapping products
<span style="color:maroon">BIOSCODE:03C5                 </span><span style="color:navy">adc     dx, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:03C8                 </span><span style="color:navy">xchg    ax, dx          </span>; ax:dx=time*59659
<span style="color:maroon">BIOSCODE:03C9                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">5
</span><span style="color:maroon">BIOSCODE:03CC                 </span><span style="color:navy">div     bl              </span>; divide high half by 5
<span style="color:maroon">BIOSCODE:03CE                 </span><span style="color:navy">mov     cl, al
</span><span style="color:maroon">BIOSCODE:03D0                 </span><span style="color:navy">mov     ch, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:03D2                 </span><span style="color:navy">mov     al, ah          </span>; remainder of divide-by-5
<span style="color:maroon">BIOSCODE:03D4                 </span><span style="color:navy">cbw
</span><span style="color:maroon">BIOSCODE:03D5                 </span><span style="color:navy">xchg    ax, dx          </span>; use it to extend low half
<span style="color:maroon">BIOSCODE:03D6                 </span><span style="color:navy">div     bx              </span>; divide low half by 5
<span style="color:maroon">BIOSCODE:03D8                 </span><span style="color:navy">mov     dx, ax          </span>; cx:dx is now number of ticks in time
<span style="color:maroon">BIOSCODE:03DA                 </span><span style="color:navy">retf
</span><span style="color:maroon">BIOSCODE:03DB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:03DB
BIOSCODE:03DB </span>tim_writ<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:03DB                 </span><span style="color:navy">mov     ax, es:[di]     </span>; sets the current time
<span style="color:maroon">BIOSCODE:03DE                 </span><span style="color:navy">push    ax              </span>; daycnt. we need to set this at the very
<span style="color:maroon">BIOSCODE:03DE                                         </span>; end to avoid tick windows
<span style="color:maroon">BIOSCODE:03DF                 </span><span style="color:navy">cmp     ds:</span>havecmoscloc<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:03E4                 </span><span style="color:navy">jz      short </span>no_cmos_1
<span style="color:maroon">BIOSCODE:03E6                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">3</span><span style="color:navy">]   </span>; get binary hours
<span style="color:maroon">BIOSCODE:03E6                                         </span>; convert to bcd
<span style="color:maroon">BIOSCODE:03EA                 </span><span style="color:navy">call    ds:</span>bintobcd
<span style="color:maroon">BIOSCODE:03EE                 </span><span style="color:navy">mov     ch, al          </span>; ch = bcd hours
<span style="color:maroon">BIOSCODE:03F0                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">2</span><span style="color:navy">]   </span>; get binary minutes
<span style="color:maroon">BIOSCODE:03F4                 </span><span style="color:navy">call    ds:</span>bintobcd
<span style="color:maroon">BIOSCODE:03F8                 </span><span style="color:navy">mov     cl, al          </span>; cl = bcd minutes
<span style="color:maroon">BIOSCODE:03FA                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; get binary seconds
<span style="color:maroon">BIOSCODE:03FE                 </span><span style="color:navy">call    ds:</span>bintobcd
<span style="color:maroon">BIOSCODE:0402                 </span><span style="color:navy">mov     dh, al          </span>; dh = bcd seconds
<span style="color:maroon">BIOSCODE:0404                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">0           </span>; dl = 0 (st) or 1 (dst)
<span style="color:maroon">BIOSCODE:0406                 </span><span style="color:navy">cli
</span><span style="color:maroon">BIOSCODE:0407                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">3
</span><span style="color:maroon">BIOSCODE:0409                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - SET REAL TIME CLOCK (AT,XT286,CONV,PS)
<span style="color:maroon">BIOSCODE:0409                                         </span>; CH = hours in BCD, CL = minutes in BCD
<span style="color:maroon">BIOSCODE:0409                                         </span>;  DH = seconds in BCD,DL = 01h if daylight savings, 00h if standard time
<span style="color:maroon">BIOSCODE:0409                                         </span>; Return: CMOS clock set
<span style="color:maroon">BIOSCODE:040B                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSCODE:040C
BIOSCODE:040C </span>no_cmos_1<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:040C                 </span><span style="color:navy">mov     cx, es:[di+</span><span style="color:#ff8000">2</span><span style="color:navy">]
</span><span style="color:maroon">BIOSCODE:0410                 </span><span style="color:navy">mov     dx, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]
</span><span style="color:maroon">BIOSCODE:0414                 </span><span style="color:navy">call    ds:</span>ttticks      ; convert time to ticks
<span style="color:maroon">BIOSCODE:0414                                         </span>; cx:dx now has time in ticks
<span style="color:maroon">BIOSCODE:0418                 </span><span style="color:navy">cli
</span><span style="color:maroon">BIOSCODE:0419                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:041B                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - SET TIME OF DAY
<span style="color:maroon">BIOSCODE:041B                                         </span>; CX:DX = clock count
<span style="color:maroon">BIOSCODE:041B                                         </span>; Return: time of day set
<span style="color:maroon">BIOSCODE:041D                 </span><span style="color:navy">pop     ds:</span>daycnt
<span style="color:maroon">BIOSCODE:0421                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSCODE:0422                 </span><span style="color:navy">cmp     ds:</span>havecmoscloc<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:0427                 </span><span style="color:navy">jz      short </span>no_cmos_2
<span style="color:maroon">BIOSCODE:0429                 </span><span style="color:navy">call    ds:</span>daycnttoday
<span style="color:maroon">BIOSCODE:042D                 </span><span style="color:navy">cli
</span><span style="color:maroon">BIOSCODE:042E                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">5
</span><span style="color:maroon">BIOSCODE:0430                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - SET DATE IN REAL TIME CLOCK (AT,XT286,CONV,PS)
<span style="color:maroon">BIOSCODE:0430                                         </span>; DL = day in BCD, DH = month in BCD, CL = year in BCD
<span style="color:maroon">BIOSCODE:0430                                         </span>; CH = century (19h or 20h)
<span style="color:maroon">BIOSCODE:0430                                         </span>; Return: CMOS clock set
<span style="color:maroon">BIOSCODE:0432                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSCODE:0433
BIOSCODE:0433 </span>no_cmos_2<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0433                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:0434                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0435 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0435
BIOSCODE:0435 </span>tim_read<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0435                 </span><span style="color:navy">call    </span>GetTickCnt      ; gettime reads date and time
<span style="color:maroon">BIOSCODE:0435                                         </span>;
<span style="color:maroon">BIOSCODE:0435                                         </span>; 65,536 seconds = 1,193,180 ticks
<span style="color:maroon">BIOSCODE:0435                                         </span>;
<span style="color:maroon">BIOSCODE:0435                                         </span>; time in 100th of seconds
<span style="color:maroon">BIOSCODE:0435                                         </span>;    = ticks from clock  * 65,536 * 100 / 1,193,180
<span style="color:maroon">BIOSCODE:0435                                         </span>;    = ticks from clock * 5 * 65,536 / 59,659
<span style="color:maroon">BIOSCODE:0438                 </span><span style="color:navy">mov     si, ds:</span>daycnt
<span style="color:maroon">BIOSCODE:043C                 </span><span style="color:navy">mov     ax, cx
</span><span style="color:maroon">BIOSCODE:043E                 </span><span style="color:navy">mov     bx, dx          </span>; start with ticks in cx:dx
<span style="color:maroon">BIOSCODE:043E                                         </span>; multiply by 5
<span style="color:maroon">BIOSCODE:0440                 </span><span style="color:navy">shl     dx, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:0442                 </span><span style="color:navy">rcl     cx, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:0444                 </span><span style="color:navy">shl     dx, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:0446                 </span><span style="color:navy">rcl     cx, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:0448                 </span><span style="color:navy">add     dx, bx
</span><span style="color:maroon">BIOSCODE:044A                 </span><span style="color:navy">adc     ax, cx
</span><span style="color:maroon">BIOSCODE:044C                 </span><span style="color:navy">xchg    ax, dx
</span><span style="color:maroon">BIOSCODE:044D                 </span><span style="color:navy">mov     cx, </span><span style="color:green">59659       </span>; multiply by 65536 and divide by 59659
<span style="color:maroon">BIOSCODE:0450                 </span><span style="color:navy">div     cx              </span>; dx has remainder
<span style="color:maroon">BIOSCODE:0450                                         </span>; ax has high word of final quotient
<span style="color:maroon">BIOSCODE:0452                 </span><span style="color:navy">mov     bx, ax          </span>; put high word in safe place
<span style="color:maroon">BIOSCODE:0454                 </span><span style="color:navy">xor     ax, ax          </span>; multiply by 65536
<span style="color:maroon">BIOSCODE:0456                 </span><span style="color:navy">div     cx              </span>; bx:ax has time in 100th of seconds
<span style="color:maroon">BIOSCODE:0458                 </span><span style="color:navy">mov     dx, bx
</span><span style="color:maroon">BIOSCODE:045A                 </span><span style="color:navy">mov     cx, </span><span style="color:green">200         </span>; division by 200 is necessary
<span style="color:maroon">BIOSCODE:045A                                         </span>; to ensure no overflow--max result
<span style="color:maroon">BIOSCODE:045A                                         </span>; is number of seconds in a day/2 = 43200.
<span style="color:maroon">BIOSCODE:045D                 </span><span style="color:navy">div     cx
</span><span style="color:maroon">BIOSCODE:045F                 </span><span style="color:navy">cmp     dl, </span><span style="color:green">100         </span>; remainder over 100?
<span style="color:maroon">BIOSCODE:0462                 </span><span style="color:navy">jb      short </span>noadj
<span style="color:maroon">BIOSCODE:0464                 </span><span style="color:navy">sub     dl, </span><span style="color:green">100         </span>; keep 1/100&#039;s less than 100
<span style="color:maroon">BIOSCODE:0467
BIOSCODE:0467 </span>noadj<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0467                 </span><span style="color:navy">cmc                     </span>; if we subtracted 100, carry is now set
<span style="color:maroon">BIOSCODE:0468                 </span><span style="color:navy">mov     bl, dl          </span>; save 1/100&#039;s
<span style="color:maroon">BIOSCODE:046A                 </span><span style="color:navy">rcl     ax, </span><span style="color:green">1           </span>; multiply by two
<span style="color:maroon">BIOSCODE:046C                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:046E                 </span><span style="color:navy">rcl     dx, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:0470                 </span><span style="color:navy">mov     cx, </span><span style="color:green">60          </span>; divide out seconds
<span style="color:maroon">BIOSCODE:0473                 </span><span style="color:navy">div     cx
</span><span style="color:maroon">BIOSCODE:0475                 </span><span style="color:navy">mov     bh, dl          </span>; save the seconds
<span style="color:maroon">BIOSCODE:0477                 </span><span style="color:navy">div     cl              </span>; break into hours and minutes
<span style="color:maroon">BIOSCODE:0479                 </span><span style="color:navy">xchg    al, ah
</span><span style="color:maroon">BIOSCODE:047B                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSCODE:047C                 </span><span style="color:navy">mov     ax, si
</span><span style="color:maroon">BIOSCODE:047E                 </span><span style="color:navy">stosw
</span><span style="color:maroon">BIOSCODE:047F                 </span><span style="color:navy">pop     ax              </span>; al = hours, ah = minutes
<span style="color:maroon">BIOSCODE:0480                 </span><span style="color:navy">stosw
</span><span style="color:maroon">BIOSCODE:0481                 </span><span style="color:navy">mov     ax, bx
</span><span style="color:maroon">BIOSCODE:0483                 </span><span style="color:navy">stosw
</span><span style="color:maroon">BIOSCODE:0484                 </span><span style="color:navy">clc                     </span>; [es:di] = count of days since 1-1-80
<span style="color:maroon">BIOSCODE:0484                                         </span>;    [es:di+2] = hours
<span style="color:maroon">BIOSCODE:0484                                         </span>;    [es:di+3] = minutes
<span style="color:maroon">BIOSCODE:0484                                         </span>;    [es:di+4] = seconds
<span style="color:maroon">BIOSCODE:0484                                         </span>;    [es:di+5] = hundredths of seconds
<span style="color:maroon">BIOSCODE:0485                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0486
BIOSCODE:0486 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0486
BIOSCODE:0486
BIOSCODE:0486 </span>GetTickCnt      proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0486                 </span><span style="color:navy">xor     ah, ah          </span>; Returns the tick count in cx:dx
<span style="color:black">BIOSCODE:0486                                         </span>; Takes care of DayCnt in case of rollover
<span style="color:black">BIOSCODE:0486                                         </span>; if ( rollover ) {
<span style="color:black">BIOSCODE:0486                                         </span>;     if ( t_switch )
<span style="color:black">BIOSCODE:0486                                         </span>;            daycnt++ ;
<span style="color:black">BIOSCODE:0486                                         </span>;     else
<span style="color:black">BIOSCODE:0486                                         </span>;            daycnt += rollover ;
<span style="color:black">BIOSCODE:0486                                         </span>;     }
<span style="color:black">BIOSCODE:0488                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - GET TIME OF DAY
<span style="color:black">BIOSCODE:0488                                         </span>; Return: CX:DX = clock count
<span style="color:black">BIOSCODE:0488                                         </span>; AL = 00h if clock was read or written (via AH=0,1) since the previous
<span style="color:black">BIOSCODE:0488                                         </span>; midnight
<span style="color:black">BIOSCODE:0488                                         </span>; Otherwise, AL &gt; 0
<span style="color:black">BIOSCODE:048A                 </span><span style="color:navy">cmp     ds:</span>t_switch<span style="color:navy">, </span><span style="color:#ff8000">0  </span>; use old method ? (&gt;0 is yes)
<span style="color:black">BIOSCODE:048F                 </span><span style="color:navy">jnz     short </span><span style="color:gray">inc_case  </span>; old method assumes that Int 1Ah returns rollover flag
<span style="color:black">BIOSCODE:0491                 </span><span style="color:navy">xor     ah, ah          </span>; new method assumes that Int 1Ah returns roll over count
<span style="color:black">BIOSCODE:0491                                         </span>; and not flag
<span style="color:black">BIOSCODE:0493                 </span><span style="color:navy">add     ds:</span>daycnt<span style="color:navy">, ax
</span><span style="color:black">BIOSCODE:0497                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0498 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0498
BIOSCODE:0498 </span><span style="color:gray">inc_case</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0498                 </span><span style="color:navy">or      al, al
</span><span style="color:black">BIOSCODE:049A                 </span><span style="color:navy">jz      short </span><span style="color:gray">no_rollover
</span><span style="color:black">BIOSCODE:049C                 </span><span style="color:navy">inc     ds:</span>daycnt
<span style="color:black">BIOSCODE:04A0
BIOSCODE:04A0 </span><span style="color:gray">no_rollover</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:04A0                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:04A0 </span>GetTickCnt      endp
<span style="color:black">BIOSCODE:04A0
BIOSCODE:04A0 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSCODE:04A1                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSCODE:04A2 </span>DSKTBL          <span style="color:navy">db </span><span style="color:#008040">26                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSCODE:04A3                 </span><span style="color:navy">dw offset </span>dsk_init
<span style="color:gray">BIOSCODE:04A5                 </span><span style="color:navy">dw offset </span>media_chk
<span style="color:gray">BIOSCODE:04A7                 </span><span style="color:navy">dw offset </span>get_bpb
<span style="color:gray">BIOSCODE:04A9                 </span><span style="color:navy">dw offset </span>bc_cmderr
<span style="color:gray">BIOSCODE:04AB                 </span><span style="color:navy">dw offset </span>dsk_read
<span style="color:gray">BIOSCODE:04AD                 </span><span style="color:navy">dw offset </span>x_bus_exit
<span style="color:gray">BIOSCODE:04AF                 </span><span style="color:navy">dw offset </span>ret_carry_clear
<span style="color:gray">BIOSCODE:04B1                 </span><span style="color:navy">dw offset </span>ret_carry_clear
<span style="color:gray">BIOSCODE:04B3                 </span><span style="color:navy">dw offset </span>dsk_writ
<span style="color:gray">BIOSCODE:04B5                 </span><span style="color:navy">dw offset </span>dsk_writv
<span style="color:gray">BIOSCODE:04B7                 </span><span style="color:navy">dw offset </span>ret_carry_clear
<span style="color:gray">BIOSCODE:04B9                 </span><span style="color:navy">dw offset </span>ret_carry_clear
<span style="color:gray">BIOSCODE:04BB                 </span><span style="color:navy">dw offset </span>bc_cmderr
<span style="color:gray">BIOSCODE:04BD                 </span><span style="color:navy">dw offset </span>dsk_open
<span style="color:gray">BIOSCODE:04BF                 </span><span style="color:navy">dw offset </span>dsk_close
<span style="color:gray">BIOSCODE:04C1                 </span><span style="color:navy">dw offset </span>dsk_rem
<span style="color:gray">BIOSCODE:04C3                 </span><span style="color:navy">dw offset </span>ret_carry_clear
<span style="color:gray">BIOSCODE:04C5                 </span><span style="color:navy">dw offset </span>ret_carry_clear
<span style="color:gray">BIOSCODE:04C7                 </span><span style="color:navy">dw offset </span>ret_carry_clear
<span style="color:gray">BIOSCODE:04C9                 </span><span style="color:navy">dw offset </span>Do_Generic_IOCtl
<span style="color:gray">BIOSCODE:04CB                 </span><span style="color:navy">dw offset </span>ret_carry_clear
<span style="color:gray">BIOSCODE:04CD                 </span><span style="color:navy">dw offset </span>ret_carry_clear
<span style="color:gray">BIOSCODE:04CF                 </span><span style="color:navy">dw offset </span>ret_carry_clear
<span style="color:gray">BIOSCODE:04D1                 </span><span style="color:navy">dw offset </span>ioctl_getown
<span style="color:gray">BIOSCODE:04D3                 </span><span style="color:navy">dw offset </span>ioctl_setown
<span style="color:gray">BIOSCODE:04D5                 </span><span style="color:navy">dw offset </span>ioctl_support_query
<span style="color:black">BIOSCODE:04D7
BIOSCODE:04D7 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:04D7
BIOSCODE:04D7
BIOSCODE:04D7 </span>SetDrive        proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:04D7                 </span><span style="color:navy">les     di, ds:</span>start_bds ; Point es:di to first bds
<span style="color:black">BIOSCODE:04DB
BIOSCODE:04DB </span>X_Scan_Loop<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:04DB                 </span><span style="color:navy">cmp     es:[di+</span><span style="color:#ff8000">5</span><span style="color:navy">], al   </span>; logical drive number (BDS.drivelet)
<span style="color:black">BIOSCODE:04DF                 </span><span style="color:navy">jz      short </span><span style="color:gray">X_SetDrv
</span><span style="color:black">BIOSCODE:04E1                 </span><span style="color:navy">les     di, es:[di]     </span>; [es:di+BDS.link] ; Go to next bds
<span style="color:black">BIOSCODE:04E4                 </span><span style="color:navy">cmp     di, </span><span style="color:green">0FFFFh
</span><span style="color:black">BIOSCODE:04E7                 </span><span style="color:navy">jnz     short </span>X_Scan_Loop
<span style="color:black">BIOSCODE:04E9                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:04EA
BIOSCODE:04EA </span><span style="color:gray">X_SetDrv</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:04EA                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:04EA </span>SetDrive        endp
<span style="color:black">BIOSCODE:04EA
</span><span style="color:maroon">BIOSCODE:04EB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:04EB
BIOSCODE:04EB </span>media_chk<span style="color:navy">:                              </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:04EB                 </span><span style="color:navy">call    </span>SetDrive
<span style="color:maroon">BIOSCODE:04EE                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:04F1                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">24h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags+1], fchanged_by_format
<span style="color:maroon">BIOSCODE:04F6                 </span><span style="color:navy">jz      short </span>WeAreNotFakingIt
<span style="color:maroon">BIOSCODE:04F8                 </span><span style="color:navy">and     word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">0FEFFh </span>; [es:di+BDS.flags],
<span style="color:maroon">BIOSCODE:04F8                                         </span>; ~fchanged_by_format ; reset flag
<span style="color:maroon">BIOSCODE:04FE                 </span><span style="color:navy">mov     ds:</span>tim_drv<span style="color:navy">, </span><span style="color:#ff8000">0FFh </span>; -1
<span style="color:maroon">BIOSCODE:04FE                                         </span>; Ensure that we ask the rom if media has changed
<span style="color:maroon">BIOSCODE:0503                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:0508                 </span><span style="color:navy">jz      short </span>WeHaveaFloppy
<span style="color:maroon">BIOSCODE:050A                 </span><span style="color:navy">mov     si, </span><span style="color:green">0FFFFh      </span>; -1
<span style="color:maroon">BIOSCODE:050D                 </span><span style="color:navy">jmp     short </span>Media_Done
<span style="color:maroon">BIOSCODE:050F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:050F
BIOSCODE:050F </span>WeAreNotFakingIt<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:050F                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:maroon">BIOSCODE:0514                 </span><span style="color:navy">jnz     short </span>Media_Done
<span style="color:maroon">BIOSCODE:0516
BIOSCODE:0516 </span>WeHaveaFloppy<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0516                 </span><span style="color:navy">xor     si, si          </span>; 0 ; Presume &quot;I don&#039;t know&quot;
<span style="color:maroon">BIOSCODE:0518                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0   </span>; Do we have changeline support?
<span style="color:maroon">BIOSCODE:051D                 </span><span style="color:navy">jz      short </span>mChk_NoChangeLine ; Brif not
<span style="color:maroon">BIOSCODE:051F                 </span><span style="color:navy">call    </span>MediaCheck      ; Call into removable routine
<span style="color:maroon">BIOSCODE:0522                 </span><span style="color:navy">jb      short </span>Err_Exitj
<span style="color:maroon">BIOSCODE:0524                 </span><span style="color:navy">call    </span>HasChange
<span style="color:maroon">BIOSCODE:0527                 </span><span style="color:navy">jnz     short </span>Media_Done
<span style="color:maroon">BIOSCODE:0529
BIOSCODE:0529 </span>mChk_NoChangeLine<span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0529                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">1           </span>; Presume no change
<span style="color:maroon">BIOSCODE:052C                 </span><span style="color:navy">mov     al, ds:</span>tim_drv  ; Last drive accessed
<span style="color:maroon">BIOSCODE:052F                 </span><span style="color:navy">cmp     al, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:di+BDS.drivenum]
<span style="color:maroon">BIOSCODE:052F                                         </span>; Is drive of last access the same?
<span style="color:maroon">BIOSCODE:0533                 </span><span style="color:navy">jnz     short </span>Media_Unk ; No, then &quot;i don&#039;t know&quot;
<span style="color:maroon">BIOSCODE:0535                 </span><span style="color:navy">call    </span>Check_Time_Of_Access
<span style="color:maroon">BIOSCODE:0538                 </span><span style="color:navy">jmp     short </span>Media_Done
<span style="color:maroon">BIOSCODE:053A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:053A
BIOSCODE:053A </span>Media_Unk<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:053A                 </span><span style="color:navy">dec     si              </span>; 0 ; Return &quot;I don&#039;t know&quot;
<span style="color:maroon">BIOSCODE:053B
BIOSCODE:053B </span>Media_Done<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:053B                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:053C                 </span><span style="color:navy">les     bx, ds:</span>ptrsav
<span style="color:maroon">BIOSCODE:0540                 </span><span style="color:navy">mov     es:[bx+</span><span style="color:green">14</span><span style="color:navy">], si  </span>; [es:bx+trans]
<span style="color:maroon">BIOSCODE:0544                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:0545                 </span><span style="color:navy">or      si, si
</span><span style="color:maroon">BIOSCODE:0547                 </span><span style="color:navy">jns     short </span>ret_carry_clear ; volidok
<span style="color:maroon">BIOSCODE:0549                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:054E                 </span><span style="color:navy">jz      short </span>mChk1_NoChangeLine
<span style="color:maroon">BIOSCODE:0550                 </span><span style="color:navy">call    </span>Media_Set_vId
<span style="color:maroon">BIOSCODE:0553
BIOSCODE:0553 </span>mChk1_NoChangeLine<span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0553                 </span><span style="color:navy">mov     ds:</span>tim_drv<span style="color:navy">, -</span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:0558
BIOSCODE:0558 </span>ret_carry_clear<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0558                 </span><span style="color:navy">clc                     </span>; volidok
<span style="color:maroon">BIOSCODE:0559                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:055A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:055A
BIOSCODE:055A </span>Err_Exitj<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:055A                 </span><span style="color:navy">call    </span>maperror        ; guaranteed to set carry
<span style="color:black">BIOSCODE:055D </span><span style="color:gray">; START OF FUNCTION CHUNK FOR get_bpb
</span><span style="color:black">BIOSCODE:055D
BIOSCODE:055D </span>ret81<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:055D                 </span><span style="color:navy">mov     ah, </span><span style="color:green">81h         </span>; return error status
<span style="color:black">BIOSCODE:055F                 </span><span style="color:navy">retn                    </span>; return with carry set
<span style="color:black">BIOSCODE:055F </span><span style="color:gray">; END OF FUNCTION CHUNK FOR get_bpb
</span><span style="color:black">BIOSCODE:0560
BIOSCODE:0560 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0560
BIOSCODE:0560
BIOSCODE:0560 </span>Check_Time_Of_Access proc near          <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0560                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">1           </span>; presume no change
<span style="color:black">BIOSCODE:0563                 </span><span style="color:navy">call    </span>GetTickCnt      ; cx:dx is the elapsed time
<span style="color:black">BIOSCODE:0566                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:#ff8000">47h</span><span style="color:navy">] </span>; [es:di+BDS.tim_lo]
<span style="color:black">BIOSCODE:0566                                         </span>; get stored time
<span style="color:black">BIOSCODE:056A                 </span><span style="color:navy">sub     dx, ax
</span><span style="color:black">BIOSCODE:056C                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:#ff8000">49h</span><span style="color:navy">] </span>; [es:di+BDS.tim_hi]
<span style="color:black">BIOSCODE:0570                 </span><span style="color:navy">sbb     cx, ax
</span><span style="color:black">BIOSCODE:0572                 </span><span style="color:navy">jnz     short </span><span style="color:gray">timecheck_unk </span>; cx&lt;&gt;0 =&gt; &gt;1 hour
<span style="color:black">BIOSCODE:0574                 </span><span style="color:navy">or      dx, dx          </span>; time must pass
<span style="color:black">BIOSCODE:0576                 </span><span style="color:navy">jnz     short </span><span style="color:gray">timepassed </span>; yes, examine max value
<span style="color:black">BIOSCODE:0578                 </span><span style="color:navy">inc     ds:</span>accesscount
<span style="color:black">BIOSCODE:057C                 </span><span style="color:navy">cmp     ds:</span>accesscount<span style="color:navy">, </span><span style="color:#ff8000">5
</span><span style="color:black">BIOSCODE:0581                 </span><span style="color:navy">jb      short </span><span style="color:gray">timecheck_ret </span>; if count is less than threshold, ok
<span style="color:black">BIOSCODE:0583                 </span><span style="color:navy">dec     ds:</span>accesscount
<span style="color:black">BIOSCODE:0587                 </span><span style="color:navy">jmp     short </span><span style="color:gray">timecheck_unk
</span><span style="color:black">BIOSCODE:0589 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0589
BIOSCODE:0589 </span><span style="color:gray">timepassed</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0589                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">36          </span>; 18*2 ; 18.2 tics per second.
<span style="color:black">BIOSCODE:0589                                         </span>; min elapsed time? (2 seconds)
<span style="color:black">BIOSCODE:058C                 </span><span style="color:navy">jbe     short </span><span style="color:gray">timecheck_ret
</span><span style="color:black">BIOSCODE:058E
BIOSCODE:058E </span><span style="color:gray">timecheck_unk</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:058E                 </span><span style="color:navy">dec     si              </span>; presume i don&#039;t know
<span style="color:black">BIOSCODE:058F
BIOSCODE:058F </span><span style="color:gray">timecheck_ret</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:058F                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:058F </span>Check_Time_Of_Access endp
<span style="color:black">BIOSCODE:058F
</span><span style="color:maroon">BIOSCODE:0590 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0590
BIOSCODE:0590 </span>Err_Exitj2<span style="color:navy">:
</span><span style="color:maroon">BIOSCODE:0590                 </span><span style="color:navy">jmp     short </span>Err_Exitj
<span style="color:black">BIOSCODE:0592
BIOSCODE:0592 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0592
BIOSCODE:0592
BIOSCODE:0592 </span>get_bpb         proc near               <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:0592
BIOSCODE:0592 </span><span style="color:gray">; FUNCTION CHUNK AT BIOSCODE:055D SIZE 00000003 BYTES
</span><span style="color:black">BIOSCODE:0592
BIOSCODE:0592                 </span><span style="color:navy">mov     ah, es:[di]     </span>; Build a valid bpb for the disk in the drive.
<span style="color:black">BIOSCODE:0592                                         </span>; get fat id byte read by dos
<span style="color:black">BIOSCODE:0595                 </span><span style="color:navy">call    </span>SetDrive
<span style="color:black">BIOSCODE:0598                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:black">BIOSCODE:059D                 </span><span style="color:navy">jnz     short </span>already_gotbpb ; no need to build for fixed disks
<span style="color:black">BIOSCODE:059F                 </span><span style="color:navy">call    </span>clear_ids
<span style="color:black">BIOSCODE:05A2                 </span><span style="color:navy">mov     ds:</span>set_id_flag<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; indicate to set system id in bds
<span style="color:black">BIOSCODE:05A7                 </span><span style="color:navy">call    </span>GetBp           ; build a bpb if necessary
<span style="color:black">BIOSCODE:05AA                 </span><span style="color:navy">jb      short </span>ret81
<span style="color:black">BIOSCODE:05AC                 </span><span style="color:navy">cmp     ds:</span>set_id_flag<span style="color:navy">, </span><span style="color:#ff8000">2 </span>; already, volume_label set from boot
<span style="color:black">BIOSCODE:05B1                 </span><span style="color:navy">mov     ds:</span>set_id_flag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; record to bds table?
<span style="color:black">BIOSCODE:05B6                 </span><span style="color:navy">jz      short </span>already_gotbpb ; do not set it again from root dir
<span style="color:black">BIOSCODE:05B6                                         </span>; otherwise, conventional boot record
<span style="color:black">BIOSCODE:05B8                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0   </span>; do we have changeline support?
<span style="color:black">BIOSCODE:05BD                 </span><span style="color:navy">jz      short </span>already_gotbpb ; brif not
<span style="color:black">BIOSCODE:05BF                 </span><span style="color:navy">call    </span>set_volume_id
<span style="color:black">BIOSCODE:05C2
BIOSCODE:05C2 </span>already_gotbpb<span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:05C2                 </span><span style="color:navy">add     di, </span><span style="color:green">6           </span>; BDS.BPB (BDS offset 6)
<span style="color:black">BIOSCODE:05C5
BIOSCODE:05C5 </span>SetPtrSav<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:05C5                 </span><span style="color:navy">mov     cx, es          </span>; return point for dsk_init
<span style="color:black">BIOSCODE:05C7                 </span><span style="color:navy">les     bx, ds:</span>ptrsav
<span style="color:black">BIOSCODE:05CB                 </span><span style="color:navy">mov     es:[bx+</span><span style="color:green">13</span><span style="color:navy">], ah  </span>; [es:bx+media]
<span style="color:black">BIOSCODE:05CF                 </span><span style="color:navy">mov     es:[bx+</span><span style="color:green">18</span><span style="color:navy">], di  </span>; [es:bx+count]
<span style="color:black">BIOSCODE:05D3                 </span><span style="color:navy">mov     es:[bx+</span><span style="color:green">20</span><span style="color:navy">], cx  </span>; [es:bx+count+2]
<span style="color:black">BIOSCODE:05D7                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:05D8                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:05D8 </span>get_bpb         endp
<span style="color:black">BIOSCODE:05D8
BIOSCODE:05D9
BIOSCODE:05D9 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:05D9
BIOSCODE:05D9
BIOSCODE:05D9 </span>clear_ids       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:05D9                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:05DA                 </span><span style="color:navy">xor     cx, cx          </span>; 0
<span style="color:black">BIOSCODE:05DC                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">57h</span><span style="color:navy">], cx </span>; [es:di+BDS.vol_serial]
<span style="color:black">BIOSCODE:05E0                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">59h</span><span style="color:navy">], cx </span>; [es:di+BDS.vol_serial+2]
<span style="color:black">BIOSCODE:05E4                 </span><span style="color:navy">mov     cx, </span><span style="color:green">11
</span><span style="color:black">BIOSCODE:05E7                 </span><span style="color:navy">mov     si, offset </span>vol_no_name <span style="color:gray">; &quot;NO NAME    &quot;
</span><span style="color:black">BIOSCODE:05EA                 </span><span style="color:navy">add     di, </span><span style="color:green">75          </span>; BDS.volid
<span style="color:black">BIOSCODE:05ED                 </span><span style="color:navy">rep movsb
</span><span style="color:black">BIOSCODE:05EF                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:green">31</span><span style="color:navy">], </span><span style="color:green">40h </span>; (here, es:di points to the BDS offset +136)
<span style="color:black">BIOSCODE:05EF                                         </span>; [es:di+BDS.fatsiz], fbig
<span style="color:black">BIOSCODE:05EF                                         </span>;
<span style="color:black">BIOSCODE:05EF                                         </span>; ! NOTE - 26/06/2023 - Erdogan Tan
<span style="color:black">BIOSCODE:05EF                                         </span>; Microsoft code has a bug here because the BDS&#039;s
<span style="color:black">BIOSCODE:05EF                                         </span>; .volid and .filesys_id fields will be reset
<span style="color:black">BIOSCODE:05EF                                         </span>; (to their default text) according to &#039;BDS.fatsiz&#039; flags
<span style="color:black">BIOSCODE:05EF                                         </span>; at the BDS offset 31 but current (this) code checks flags
<span style="color:black">BIOSCODE:05EF                                         </span>; at ES:DI+31 while DI points the BDS offset 86!?
<span style="color:black">BIOSCODE:05EF                                         </span>;
<span style="color:black">BIOSCODE:05EF                                         </span>; Correct Code:
<span style="color:black">BIOSCODE:05EF                                         </span>; test byte [ES:DI+31-86],40h or
<span style="color:black">BIOSCODE:05EF                                         </span>; DI_POSITION equ BDS.volid + size_of_EXT_BOOT_VOL_LABEL
<span style="color:black">BIOSCODE:05EF                                         </span>; test byte [ES:DI:BDS.fatsiz-DI_POSITION],40h ; fbig
<span style="color:black">BIOSCODE:05EF                                         </span>;
<span style="color:black">BIOSCODE:05EF                                         </span>; (Why this bug did not affect MSDOS applications:
<span style="color:black">BIOSCODE:05EF                                         </span>; &#039;clear_ids&#039; is used for floppy disks only and the default
<span style="color:black">BIOSCODE:05EF                                         </span>; option of &#039;clear_ids&#039; is FAT12 volid and filesys_id text
<span style="color:black">BIOSCODE:05EF                                         </span>; when the flag bit has wrong value for FAT16/40h.)
<span style="color:black">BIOSCODE:05F4                 </span><span style="color:navy">mov     si, offset </span>fat_16_id <span style="color:gray">; &quot;FAT16   &quot;
</span><span style="color:black">BIOSCODE:05F7                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ci_bigfat
</span><span style="color:black">BIOSCODE:05F9                 </span><span style="color:navy">mov     si, offset </span>fat_12_id <span style="color:gray">; &quot;FAT12   &quot;
</span><span style="color:black">BIOSCODE:05FC
BIOSCODE:05FC </span><span style="color:gray">ci_bigfat</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:05FC                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">8           </span>; size_of_EXT_SYSTEM_ID
<span style="color:black">BIOSCODE:05FF                 </span><span style="color:navy">add     di, </span><span style="color:#ff8000">5           </span>; BDS.filesys_id (BDS offset 91)
<span style="color:black">BIOSCODE:0602                 </span><span style="color:navy">rep movsb
</span><span style="color:black">BIOSCODE:0604                 </span><span style="color:navy">pop     di              </span>; restore bds pointer
<span style="color:black">BIOSCODE:0605
BIOSCODE:0605 </span>getbp_retn<span style="color:navy">:                             </span>; 26/06/2023
<span style="color:black">BIOSCODE:0605                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0605 </span>clear_ids       endp
<span style="color:black">BIOSCODE:0605
BIOSCODE:0606
BIOSCODE:0606 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0606
BIOSCODE:0606
BIOSCODE:0606 </span>GetBp           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0606                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">5 </span>; return_fake_bpb|fnon_removable
<span style="color:black">BIOSCODE:060B                 </span><span style="color:navy">jz      short </span><span style="color:gray">getbp1
</span><span style="color:black">BIOSCODE:060D                 </span><span style="color:navy">jmp     </span><span style="color:gray">getret_exit     </span>; 26/06/2023 - (useless far jump to &#039;retn&#039;!)
<span style="color:black">BIOSCODE:060D                                         </span>;
<span style="color:black">BIOSCODE:060D                                         </span>; Correct code here:
<span style="color:black">BIOSCODE:060D                                         </span>; retn ; (instead of jmp getret_exit)
<span style="color:black">BIOSCODE:060D                                         </span>; ;or
<span style="color:black">BIOSCODE:060D                                         </span>; jnz short getbp_retn ; (short jump to &#039;retn&#039;)
<span style="color:black">BIOSCODE:0610 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0610
BIOSCODE:0610 </span><span style="color:gray">getbp1</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0610                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:0611                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSCODE:0612                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSCODE:0613                 </span><span style="color:navy">call    </span>readbootsec
<span style="color:black">BIOSCODE:0616                 </span><span style="color:navy">jb      short </span><span style="color:gray">getbp_err_ret_brdg
</span><span style="color:black">BIOSCODE:0618                 </span><span style="color:navy">or      bx, bx          </span>; bx is 0 if boot sector is valid
<span style="color:black">BIOSCODE:061A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">dofatbpb
</span><span style="color:black">BIOSCODE:061C                 </span><span style="color:navy">call    </span>movbpb
<span style="color:black">BIOSCODE:061F                 </span><span style="color:navy">jmp     short </span>Has1
<span style="color:black">BIOSCODE:0621 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0621
BIOSCODE:0621 </span><span style="color:gray">getbp_err_ret_brdg</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0621                 </span><span style="color:navy">jmp     </span><span style="color:gray">getbp_err_ret
</span><span style="color:black">BIOSCODE:0624 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0624
BIOSCODE:0624 </span><span style="color:gray">dofatbpb</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0624                 </span><span style="color:navy">call    </span>readfat         ; puts media descriptor byte in ah
<span style="color:black">BIOSCODE:0627                 </span><span style="color:navy">jb      short </span><span style="color:gray">getbp_err_ret_brdg
</span><span style="color:black">BIOSCODE:0629                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0   </span>; changeline support available?
<span style="color:black">BIOSCODE:062E                 </span><span style="color:navy">jz      short </span>bpb_nochangeline ; brif not
<span style="color:black">BIOSCODE:0630                 </span><span style="color:navy">call    </span>hidensity
<span style="color:black">BIOSCODE:0633
BIOSCODE:0633 </span>bpb_nochangeline<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0633                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], </span><span style="color:#ff8000">2 </span>; [es:di+BDS.formfactor], ffSmall
<span style="color:black">BIOSCODE:0638                 </span><span style="color:navy">jnz     short </span><span style="color:gray">is_floppy
</span><span style="color:black">BIOSCODE:063A                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">0F9h        </span>; is it a valid fat id byte for 3.5&quot; ?
<span style="color:black">BIOSCODE:063D                 </span><span style="color:navy">jnz     short </span><span style="color:gray">got_unknown_medium </span>; no
<span style="color:black">BIOSCODE:063F
BIOSCODE:063F </span>Has720K<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:063F                 </span><span style="color:navy">mov     bx, offset </span>sm92 ; pointer to correct bpb
<span style="color:black">BIOSCODE:0642                 </span><span style="color:navy">mov     al, [bx+</span><span style="color:#ff8000">0</span><span style="color:navy">]      </span>; bpbtype.sbf = 3
<span style="color:black">BIOSCODE:0646                 </span><span style="color:navy">mov     cx, [bx+</span><span style="color:#ff8000">3</span><span style="color:navy">]      </span>; bpbtype.csec = 1440
<span style="color:black">BIOSCODE:064A                 </span><span style="color:navy">mov     dx, [bx+</span><span style="color:#ff8000">5</span><span style="color:navy">]      </span>; dl = bpbtype.spau = 2
<span style="color:black">BIOSCODE:064A                                         </span>; dh = bpbtype.chead = 2
<span style="color:black">BIOSCODE:064E                 </span><span style="color:navy">mov     bx, [bx+</span><span style="color:#ff8000">1</span><span style="color:navy">]      </span>; bl = bpbtype.spt = 9
<span style="color:black">BIOSCODE:064E                                         </span>; bh = bpbtype.dire = 112
<span style="color:black">BIOSCODE:0652                 </span><span style="color:navy">jmp     short </span>Has1
<span style="color:black">BIOSCODE:0654 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0654
BIOSCODE:0654 </span><span style="color:gray">is_floppy</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0654                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">0F8h
</span><span style="color:black">BIOSCODE:0657                 </span><span style="color:navy">jb      short </span><span style="color:gray">got_unknown_medium
</span><span style="color:black">BIOSCODE:0659                 </span><span style="color:navy">mov     al, </span><span style="color:green">1           </span>; pbtype.sbf = 1
<span style="color:black">BIOSCODE:065B                 </span><span style="color:navy">mov     bx, </span><span style="color:green">4008h       </span>; bl = bpbtype.spt = 8
<span style="color:black">BIOSCODE:065B                                         </span>; bh = bpbtype.dire = 64
<span style="color:black">BIOSCODE:065E                 </span><span style="color:navy">mov     cx, </span><span style="color:green">320         </span>; bpbtype.csec = 1440
<span style="color:black">BIOSCODE:0661                 </span><span style="color:navy">mov     dx, </span><span style="color:green">101h        </span>; dl = bpbtype.spau = 1
<span style="color:black">BIOSCODE:0661                                         </span>; dh = bpbtype.chead = 1
<span style="color:black">BIOSCODE:0664                 </span><span style="color:navy">test    ah, </span><span style="color:green">2
</span><span style="color:black">BIOSCODE:0667                 </span><span style="color:navy">jnz     short </span><span style="color:gray">has8
</span><span style="color:black">BIOSCODE:0669                 </span><span style="color:navy">inc     al              </span>; bpbtype.sbf = 2
<span style="color:black">BIOSCODE:066B                 </span><span style="color:navy">inc     bl              </span>; bpbtype.spt = 9
<span style="color:black">BIOSCODE:066D                 </span><span style="color:navy">add     cx, </span><span style="color:green">40          </span>; 180K (360 sectors)
<span style="color:black">BIOSCODE:0670
BIOSCODE:0670 </span><span style="color:gray">has8</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0670                 </span><span style="color:navy">test    ah, </span><span style="color:green">1           </span>; bpbtype.sbf = 1
<span style="color:black">BIOSCODE:0673                 </span><span style="color:navy">jz      short </span>Has1
<span style="color:black">BIOSCODE:0675                 </span><span style="color:navy">add     cx, cx
</span><span style="color:black">BIOSCODE:0677                 </span><span style="color:navy">mov     bh, </span><span style="color:green">112         </span>; bh = bpbtype.dire = 112
<span style="color:black">BIOSCODE:0679                 </span><span style="color:navy">inc     dh
</span><span style="color:black">BIOSCODE:067B                 </span><span style="color:navy">inc     dl
</span><span style="color:black">BIOSCODE:067D
BIOSCODE:067D </span>Has1<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:067D                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">8</span><span style="color:navy">], dh   </span>; [es:di+BDS.secperclus]
<span style="color:black">BIOSCODE:0681                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">0Ch</span><span style="color:navy">], bh </span>; [es:di+BDS.direntries]
<span style="color:black">BIOSCODE:0685                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">0Eh</span><span style="color:navy">], cx </span>; [es:di+BDS.totalsecs16]
<span style="color:black">BIOSCODE:0689                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">10h</span><span style="color:navy">], ah </span>; [es:di+BDS.media]
<span style="color:black">BIOSCODE:068D                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">11h</span><span style="color:navy">], al </span>; [es:di+BDS.fatsecs]
<span style="color:black">BIOSCODE:0691                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">13h</span><span style="color:navy">], bl </span>; [es:di+BDS.secpertrack]
<span style="color:black">BIOSCODE:0695                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">15h</span><span style="color:navy">], dl </span>; [es:di+BDS.heads]
<span style="color:black">BIOSCODE:0699                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">19h</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+BDS.hiddensecs+2]
<span style="color:black">BIOSCODE:069F                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">17h</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+BDS.hiddensecs]
<span style="color:black">BIOSCODE:06A5                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">1Dh</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+BDS.totalsecs32+2]
<span style="color:black">BIOSCODE:06AB
BIOSCODE:06AB </span><span style="color:gray">getret</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:06AB                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSCODE:06AC                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSCODE:06AD                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:06AE
BIOSCODE:06AE </span><span style="color:gray">getret_exit</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:06AE                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:06AF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:06AF
BIOSCODE:06AF </span><span style="color:gray">getbp_err_ret</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:06AF                 </span><span style="color:navy">mov     ds:</span>set_id_flag<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:06B4                 </span><span style="color:navy">call    </span>maperror
<span style="color:black">BIOSCODE:06B7                 </span><span style="color:navy">jmp     short </span><span style="color:gray">getret
</span><span style="color:black">BIOSCODE:06B9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:06B9
BIOSCODE:06B9 </span><span style="color:gray">got_unknown_medium</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:06B9                 </span><span style="color:navy">mov     ds:</span>set_id_flag<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:06BE                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">7
</span><span style="color:black">BIOSCODE:06C0                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:06C1                 </span><span style="color:navy">jmp     short </span><span style="color:gray">getret
</span><span style="color:black">BIOSCODE:06C1 </span>GetBp           endp
<span style="color:black">BIOSCODE:06C1
BIOSCODE:06C3
BIOSCODE:06C3 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:06C3
BIOSCODE:06C3
BIOSCODE:06C3 </span>readbootsec     proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:06C3                 </span><span style="color:navy">mov     dh, </span><span style="color:#ff8000">0           </span>; head 0
<span style="color:black">BIOSCODE:06C5                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">1           </span>; cylinder 0, sector 1
<span style="color:black">BIOSCODE:06C8                 </span><span style="color:navy">call    </span>read_sector
<span style="color:black">BIOSCODE:06CB                 </span><span style="color:navy">jb      short </span><span style="color:gray">err_ret
</span><span style="color:black">BIOSCODE:06CD                 </span><span style="color:navy">xor     bx, bx          </span>; bx = 0
<span style="color:black">BIOSCODE:06CF                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">, </span><span style="color:green">69h </span>; is it a direct jump?
<span style="color:black">BIOSCODE:06D4                 </span><span style="color:navy">jz      short </span><span style="color:gray">check_bpb_mediabyte </span>; don&#039;t need to find a nop
<span style="color:black">BIOSCODE:06D6                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">, </span><span style="color:green">0E9h </span>; dos 2.0 jump?
<span style="color:black">BIOSCODE:06DB                 </span><span style="color:navy">jz      short </span><span style="color:gray">check_bpb_mediabyte </span>; no need for nop
<span style="color:black">BIOSCODE:06DD                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">, </span><span style="color:green">0EBh </span>; how about a short jump?
<span style="color:black">BIOSCODE:06E2                 </span><span style="color:navy">jnz     short </span><span style="color:gray">invalidbootsec
</span><span style="color:black">BIOSCODE:06E4                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, </span><span style="color:green">90h </span>; is next one a nop?
<span style="color:black">BIOSCODE:06E9                 </span><span style="color:navy">jnz     short </span><span style="color:gray">invalidbootsec
</span><span style="color:black">BIOSCODE:06EB
BIOSCODE:06EB </span><span style="color:gray">check_bpb_mediabyte</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:06EB                 </span><span style="color:navy">mov     al, ds:</span>disksector<span style="color:navy">+</span><span style="color:green">15h </span>;
<span style="color:black">BIOSCODE:06EB                                         </span>; [disksector+EXT_BOOT.BPB+EBPB.MEDIADESCRIPTOR]
<span style="color:black">BIOSCODE:06EE                 </span><span style="color:navy">and     al, </span><span style="color:green">0F0h
</span><span style="color:black">BIOSCODE:06F0                 </span><span style="color:navy">cmp     al, </span><span style="color:green">0F0h        </span>; allow for strange media
<span style="color:black">BIOSCODE:06F2                 </span><span style="color:navy">jnz     short </span><span style="color:gray">invalidbootsec
</span><span style="color:black">BIOSCODE:06F4
BIOSCODE:06F4 </span>checksinglesided<span style="color:navy">:
</span><span style="color:black">BIOSCODE:06F4                 </span><span style="color:navy">mov     al, ds:</span>disksector<span style="color:navy">+</span><span style="color:green">15h
</span><span style="color:black">BIOSCODE:06F7                 </span><span style="color:navy">cmp     al, </span><span style="color:green">0F0h
</span><span style="color:black">BIOSCODE:06F9                 </span><span style="color:navy">jz      short </span><span style="color:gray">gooddsk
</span><span style="color:black">BIOSCODE:06FB                 </span><span style="color:navy">test    al, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:06FD                 </span><span style="color:navy">jnz     short </span><span style="color:gray">gooddsk
</span><span style="color:black">BIOSCODE:06FF                 </span><span style="color:navy">cmp     word ptr ds:</span>disksector<span style="color:navy">+</span><span style="color:green">8</span><span style="color:navy">, &#039;</span><span style="color:green">.3&#039; </span>; 2E33h ; &#039;3.&#039;
<span style="color:black">BIOSCODE:0705                 </span><span style="color:navy">jnz     short </span><span style="color:gray">mustbeearlier
</span><span style="color:black">BIOSCODE:0707                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">+</span><span style="color:green">0Ah</span><span style="color:navy">, &#039;</span><span style="color:green">2&#039; </span>; 32h
<span style="color:black">BIOSCODE:070C                 </span><span style="color:navy">jnb     short </span><span style="color:gray">gooddsk
</span><span style="color:black">BIOSCODE:070E
BIOSCODE:070E </span><span style="color:gray">mustbeearlier</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:070E                 </span><span style="color:navy">mov     ds:</span>disksector<span style="color:navy">+</span><span style="color:green">0Dh</span><span style="color:navy">, </span><span style="color:#ff8000">1 </span>; we must have a pre-3.20 diskette.
<span style="color:black">BIOSCODE:070E                                         </span>; set the sec/clus field to 1
<span style="color:black">BIOSCODE:070E                                         </span>; [disksector+EXT_BOOT.BPB+EBPB.SECTORSPERCLUSTER]
<span style="color:black">BIOSCODE:0713                 </span><span style="color:navy">jmp     short </span><span style="color:gray">gooddsk
</span><span style="color:black">BIOSCODE:0715 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0715
BIOSCODE:0715 </span><span style="color:gray">invalidbootsec</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0715                 </span><span style="color:navy">inc     bx              </span>; indicate that boot sector invalid (bx = 1)
<span style="color:black">BIOSCODE:0716
BIOSCODE:0716 </span><span style="color:gray">gooddsk</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0716                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:0717                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0718 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0718
BIOSCODE:0718 </span><span style="color:gray">err_ret</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0718                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0718 </span>readbootsec     endp
<span style="color:black">BIOSCODE:0718
BIOSCODE:0719
BIOSCODE:0719 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0719
BIOSCODE:0719
BIOSCODE:0719 </span>movbpb          proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0719                 </span><span style="color:navy">mov     dh, ds:</span>disksector<span style="color:navy">+</span><span style="color:green">0Dh </span>; sectors per unit (cluster)
<span style="color:black">BIOSCODE:071D                 </span><span style="color:navy">mov     bh, ds:</span>disksector<span style="color:navy">+</span><span style="color:green">11h </span>; number of directory entries
<span style="color:black">BIOSCODE:0721                 </span><span style="color:navy">mov     cx, word ptr ds:</span>disksector<span style="color:navy">+</span><span style="color:green">13h </span>; size of drive (volume)
<span style="color:black">BIOSCODE:0725                 </span><span style="color:navy">mov     ah, ds:</span>disksector<span style="color:navy">+</span><span style="color:green">15h </span>; media descriptor
<span style="color:black">BIOSCODE:0729                 </span><span style="color:navy">mov     al, ds:</span>disksector<span style="color:navy">+</span><span style="color:green">16h </span>; number of fat sectors
<span style="color:black">BIOSCODE:072C                 </span><span style="color:navy">mov     bl, ds:</span>disksector<span style="color:navy">+</span><span style="color:green">18h </span>; sectors per track
<span style="color:black">BIOSCODE:0730                 </span><span style="color:navy">mov     dl, ds:</span>disksector<span style="color:navy">+</span><span style="color:green">1Ah </span>; number of heads
<span style="color:black">BIOSCODE:0734                 </span><span style="color:navy">cmp     ds:</span>set_id_flag<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; called by get_bpb?
<span style="color:black">BIOSCODE:0739                 </span><span style="color:navy">jnz     short </span><span style="color:gray">movbpb_ret
</span><span style="color:black">BIOSCODE:073B                 </span><span style="color:navy">call    </span>mov_media_ids
<span style="color:black">BIOSCODE:073E                 </span><span style="color:navy">jb      short </span><span style="color:gray">movbpb_conv </span>; conventional boot record?
<span style="color:black">BIOSCODE:0740                 </span><span style="color:navy">mov     ds:</span>set_id_flag<span style="color:navy">, </span><span style="color:#ff8000">2 </span>; signals that volume id is set
<span style="color:black">BIOSCODE:0745
BIOSCODE:0745 </span><span style="color:gray">movbpb_conv</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0745                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:074A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">movbpb_ret
</span><span style="color:black">BIOSCODE:074C                 </span><span style="color:navy">call    </span>resetchanged    ; reset flags in bds to not fchanged
<span style="color:black">BIOSCODE:074F
BIOSCODE:074F </span><span style="color:gray">movbpb_ret</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:074F                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:0750                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0750 </span>movbpb          endp
<span style="color:black">BIOSCODE:0750
BIOSCODE:0751
BIOSCODE:0751 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0751
BIOSCODE:0751
BIOSCODE:0751 </span>mov_media_ids   proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0751                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">+</span><span style="color:green">26h</span><span style="color:navy">, </span><span style="color:green">29h </span>; [disksector+EXT_BOOT.SIG],
<span style="color:black">BIOSCODE:0751                                         </span>;              EXT_BOOT_SIGNATURE
<span style="color:black">BIOSCODE:0756                 </span><span style="color:navy">jnz     short </span><span style="color:gray">mmi_not_ext
</span><span style="color:black">BIOSCODE:0758                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:0759                 </span><span style="color:navy">mov     cx, word ptr ds:</span>disksector<span style="color:navy">+</span><span style="color:green">27h </span>;
<span style="color:black">BIOSCODE:0759                                         </span>; [disksector+EXT_BOOT.SERIAL]
<span style="color:black">BIOSCODE:075D                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">57h</span><span style="color:navy">], cx
</span><span style="color:black">BIOSCODE:0761                 </span><span style="color:navy">mov     cx, word ptr ds:</span>disksector<span style="color:navy">+</span><span style="color:green">29h </span>;
<span style="color:black">BIOSCODE:0761                                         </span>; [disksector+EXT_BOOT.SERIAL+2]
<span style="color:black">BIOSCODE:0765                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">59h</span><span style="color:navy">], cx </span>; [es:di+BDS.vol_serial+2]
<span style="color:black">BIOSCODE:0769                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:076A                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSCODE:076B                 </span><span style="color:navy">mov     cx, </span><span style="color:green">11          </span>; size_of_EXT_BOOT_VOL_LABEL
<span style="color:black">BIOSCODE:076E                 </span><span style="color:navy">mov     si, (offset </span>disksector<span style="color:navy">+</span><span style="color:green">2Bh</span><span style="color:navy">) </span>;
<span style="color:black">BIOSCODE:076E                                         </span>; disksector+EXT_BOOT.VOL_LABEL
<span style="color:black">BIOSCODE:0771                 </span><span style="color:navy">add     di, </span><span style="color:green">75          </span>; BDS.volid
<span style="color:black">BIOSCODE:0774                 </span><span style="color:navy">rep movsb
</span><span style="color:black">BIOSCODE:0776                 </span><span style="color:navy">mov     cx, </span><span style="color:green">8           </span>; size_of_EXT_SYSTEM_ID
<span style="color:black">BIOSCODE:0779                 </span><span style="color:navy">mov     si, (offset </span>disksector<span style="color:navy">+</span><span style="color:green">36h</span><span style="color:navy">) </span>;
<span style="color:black">BIOSCODE:0779                                         </span>; disksector+EXT_BOOT.SYSTEM_ID
<span style="color:black">BIOSCODE:077C                 </span><span style="color:navy">add     di, </span><span style="color:green">5           </span>;
<span style="color:black">BIOSCODE:077C                                         </span>; (BDS.filesys_id-BDS.volid)-size_of_EXT_BOOT_VOL_LABEL
<span style="color:black">BIOSCODE:077F                 </span><span style="color:navy">rep movsb
</span><span style="color:black">BIOSCODE:0781                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSCODE:0782                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSCODE:0783                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:0784                 </span><span style="color:navy">clc                     </span>; this clc is not required (16/06/2019 - Erdogan Tan)
<span style="color:black">BIOSCODE:0784                                         </span>; (20/09/2022 - 27/06/2023)
<span style="color:black">BIOSCODE:0785                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0786 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0786
BIOSCODE:0786 </span><span style="color:gray">mmi_not_ext</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0786                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:0787                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0787 </span>mov_media_ids   endp
<span style="color:black">BIOSCODE:0787
BIOSCODE:0788
BIOSCODE:0788 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0788
BIOSCODE:0788
BIOSCODE:0788 </span>readfat         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0788                 </span><span style="color:navy">mov     dh, </span><span style="color:#ff8000">0           </span>; head 0
<span style="color:black">BIOSCODE:078A                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">2           </span>; cylinder 0, sector 2
<span style="color:black">BIOSCODE:078D                 </span><span style="color:navy">call    </span>read_sector
<span style="color:black">BIOSCODE:0790                 </span><span style="color:navy">jb      short </span><span style="color:gray">bad_fat_ret
</span><span style="color:black">BIOSCODE:0792                 </span><span style="color:navy">mov     ah, [bx]        </span>; media byte
<span style="color:black">BIOSCODE:0794
BIOSCODE:0794 </span><span style="color:gray">bad_fat_ret</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0794                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0794 </span>readfat         endp
<span style="color:black">BIOSCODE:0794
BIOSCODE:0795
BIOSCODE:0795 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0795
BIOSCODE:0795
BIOSCODE:0795 </span>read_sector     proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0795                 </span><span style="color:navy">push    bp
</span><span style="color:black">BIOSCODE:0796                 </span><span style="color:navy">mov     bp, </span><span style="color:green">3           </span>; make 3 attempts
<span style="color:black">BIOSCODE:0799                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:079D                 </span><span style="color:navy">mov     bx, offset </span>disksector ; BIOSDATA:014Eh
<span style="color:black">BIOSCODE:07A0
BIOSCODE:07A0 </span><span style="color:gray">rd_ret</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:07A0                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:07A1                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:07A2                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:07A3                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">201h
</span><span style="color:black">BIOSCODE:07A6                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - READ SECTORS INTO MEMORY
<span style="color:black">BIOSCODE:07A6                                         </span>; AL = number of sectors to read, CH = track, CL = sector
<span style="color:black">BIOSCODE:07A6                                         </span>; DH = head, DL = drive, ES:BX -&gt; buffer to fill
<span style="color:black">BIOSCODE:07A6                                         </span>; Return: CF set on error, AH = status, AL = number of sectors read
<span style="color:black">BIOSCODE:07A8                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:07A9                 </span><span style="color:navy">jnb     short </span><span style="color:gray">okret2
</span><span style="color:black">BIOSCODE:07AB
BIOSCODE:07AB </span><span style="color:gray">rd_rty</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:07AB                 </span><span style="color:navy">call    </span>again           ; reset disk, decrement bp
<span style="color:black">BIOSCODE:07AE                 </span><span style="color:navy">jz      short </span><span style="color:gray">err_rd_ret
</span><span style="color:black">BIOSCODE:07B0                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:black">BIOSCODE:07B0                                         </span>; (BDS offset 35)
<span style="color:black">BIOSCODE:07B5                 </span><span style="color:navy">jnz     short </span><span style="color:gray">rd_ret
</span><span style="color:black">BIOSCODE:07B7                 </span><span style="color:navy">cmp     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:07BC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">rd_skip1_dpt
</span><span style="color:black">BIOSCODE:07BE                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:07BF                 </span><span style="color:navy">push    ds              </span>; for retry, set the head settle time to 0Fh
<span style="color:black">BIOSCODE:07C0                 </span><span style="color:navy">lds     si, ds:</span>dpt
<span style="color:black">BIOSCODE:07C4                 </span><span style="color:navy">mov     al, [si+</span><span style="color:#ff8000">9</span><span style="color:navy">]      </span>; [si+DISK_PARMS.DISK_HEAD_STTL]
<span style="color:black">BIOSCODE:07C7                 </span><span style="color:navy">mov     byte ptr [si+</span><span style="color:#ff8000">9</span><span style="color:navy">], </span><span style="color:green">15 </span>; NORMSETTLE
<span style="color:black">BIOSCODE:07CB                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSCODE:07CC                 </span><span style="color:navy">mov     ds:</span>save_head_sttl<span style="color:navy">, al
</span><span style="color:black">BIOSCODE:07CF                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:07D0
BIOSCODE:07D0 </span><span style="color:gray">rd_skip1_dpt</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:07D0                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:07D1                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:07D2                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:07D3                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">201h
</span><span style="color:black">BIOSCODE:07D6                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - READ SECTORS INTO MEMORY
<span style="color:black">BIOSCODE:07D6                                         </span>; AL = number of sectors to read, CH = track, CL = sector
<span style="color:black">BIOSCODE:07D6                                         </span>; DH = head, DL = drive, ES:BX -&gt; buffer to fill
<span style="color:black">BIOSCODE:07D6                                         </span>; Return: CF set on error, AH = status, AL = number of sectors read
<span style="color:black">BIOSCODE:07D8                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:07D9                 </span><span style="color:navy">pushf
</span><span style="color:black">BIOSCODE:07DA                 </span><span style="color:navy">cmp     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:07DF                 </span><span style="color:navy">jnz     short </span><span style="color:gray">rd_skip2_dpt
</span><span style="color:black">BIOSCODE:07E1                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:07E2                 </span><span style="color:navy">mov     al, ds:</span>save_head_sttl
<span style="color:black">BIOSCODE:07E5                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:07E6                 </span><span style="color:navy">lds     si, ds:</span>dpt
<span style="color:black">BIOSCODE:07EA                 </span><span style="color:navy">mov     [si+</span><span style="color:#ff8000">9</span><span style="color:navy">], al      </span>; [si+DISK_PARMS.DISK_HEAD_STTL]
<span style="color:black">BIOSCODE:07ED                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSCODE:07EE                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:07EF
BIOSCODE:07EF </span><span style="color:gray">rd_skip2_dpt</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:07EF                 </span><span style="color:navy">popf
</span><span style="color:black">BIOSCODE:07F0                 </span><span style="color:navy">jnb     short </span><span style="color:gray">okret2
</span><span style="color:black">BIOSCODE:07F2                 </span><span style="color:navy">jmp     short </span><span style="color:gray">rd_rty
</span><span style="color:black">BIOSCODE:07F4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:07F4
BIOSCODE:07F4 </span><span style="color:gray">err_rd_ret</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:07F4                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">0FFh
</span><span style="color:black">BIOSCODE:07F6                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:07F7
BIOSCODE:07F7 </span><span style="color:gray">okret2</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:07F7                 </span><span style="color:navy">mov     ds:</span>step_drv<span style="color:navy">, dl
</span><span style="color:black">BIOSCODE:07FB                 </span><span style="color:navy">mov     ds:</span>tim_drv<span style="color:navy">, dl
</span><span style="color:black">BIOSCODE:07FF                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">46h</span><span style="color:navy">], ch </span>; [es:di+BDS.track]
<span style="color:black">BIOSCODE:07FF                                         </span>; (BDS offset 70)
<span style="color:black">BIOSCODE:07FF                                         </span>; save last track accessed on this drive
<span style="color:black">BIOSCODE:0803                 </span><span style="color:navy">pushf
</span><span style="color:black">BIOSCODE:0804                 </span><span style="color:navy">call    </span>set_tim
<span style="color:black">BIOSCODE:0807                 </span><span style="color:navy">popf                    </span>; restore flags
<span style="color:black">BIOSCODE:0808                 </span><span style="color:navy">pop     bp
</span><span style="color:black">BIOSCODE:0809                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0809 </span>read_sector     endp
<span style="color:black">BIOSCODE:0809
BIOSCODE:080A
BIOSCODE:080A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:080A
BIOSCODE:080A
BIOSCODE:080A </span>dsk_open        proc near               <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:080A                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:080F                 </span><span style="color:navy">jz      short </span>dsk_open_exit
<span style="color:black">BIOSCODE:0811                 </span><span style="color:navy">call    </span>SetDrive
<span style="color:black">BIOSCODE:0814                 </span><span style="color:navy">inc     word ptr es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">] </span>; [es:di+BDS.opcnt]
<span style="color:black">BIOSCODE:0814                                         </span>; (BDS offset 32)
<span style="color:black">BIOSCODE:0818
BIOSCODE:0818 </span>dsk_open_exit<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0818                 </span><span style="color:navy">clc                     </span>; CF is already ZERO here - Erdogan Tan
<span style="color:black">BIOSCODE:0819                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0819 </span>dsk_open        endp
<span style="color:black">BIOSCODE:0819
BIOSCODE:081A
BIOSCODE:081A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:081A
BIOSCODE:081A
BIOSCODE:081A </span>dsk_close       proc near               <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:081A                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:081F                 </span><span style="color:navy">jz      short </span>exitjx    ; done if no changeline support
<span style="color:black">BIOSCODE:0821                 </span><span style="color:navy">call    </span>SetDrive        ; get bds for drive
<span style="color:black">BIOSCODE:0824                 </span><span style="color:navy">cmp     word ptr es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+BDS.opcnt]
<span style="color:black">BIOSCODE:0829                 </span><span style="color:navy">jz      short </span>exitjx    ; watch out for wrap
<span style="color:black">BIOSCODE:082B                 </span><span style="color:navy">dec     word ptr es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">]
</span><span style="color:black">BIOSCODE:082F
BIOSCODE:082F </span>exitjx<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:082F                 </span><span style="color:navy">clc                     </span>; CF is already ZERO here - Erdogan Tan
<span style="color:black">BIOSCODE:0830                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0830 </span>dsk_close       endp
<span style="color:black">BIOSCODE:0830
BIOSCODE:0831
BIOSCODE:0831 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0831
BIOSCODE:0831
BIOSCODE:0831 </span>dsk_rem         proc near               <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:0831                 </span><span style="color:navy">call    </span>SetDrive
<span style="color:black">BIOSCODE:0834                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:black">BIOSCODE:0839                 </span><span style="color:navy">jnz     short </span>x_bus_exit
<span style="color:black">BIOSCODE:083B                 </span><span style="color:navy">clc                     </span>; CF is already ZERO here - Erdogan Tan
<span style="color:black">BIOSCODE:083C                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:083D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:083D
BIOSCODE:083D </span>x_bus_exit<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:083D                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">3           </span>; non_rem
<span style="color:black">BIOSCODE:083D                                         </span>; return busy status
<span style="color:black">BIOSCODE:083F                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:0840
BIOSCODE:0840 </span>dsk_ret<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0840                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0840 </span>dsk_rem         endp
<span style="color:black">BIOSCODE:0840
</span><span style="color:maroon">BIOSCODE:0841 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0841
BIOSCODE:0841 </span>dsk_writv<span style="color:navy">:                              </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0841                 </span><span style="color:navy">mov     word ptr ds:</span>rflag<span style="color:navy">, </span><span style="color:green">103h </span>; write and verify
<span style="color:maroon">BIOSCODE:0847                 </span><span style="color:navy">jmp     short </span>dsk_cl
<span style="color:maroon">BIOSCODE:0849 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0849
BIOSCODE:0849 </span>dsk_writ<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0849                 </span><span style="color:navy">mov     word ptr ds:</span>rflag<span style="color:navy">, </span><span style="color:#ff8000">3 </span>; romwrite
<span style="color:maroon">BIOSCODE:084F
BIOSCODE:084F </span>dsk_cl<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:084F                 </span><span style="color:navy">call    </span>diskio          ; prepare for rombios read/write
<span style="color:maroon">BIOSCODE:0852
BIOSCODE:0852 </span>dsk_io<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0852                 </span><span style="color:navy">jnb     short </span>dsk_ret
<span style="color:maroon">BIOSCODE:0854                 </span><span style="color:navy">jmp     </span>bc_err_cnt
<span style="color:maroon">BIOSCODE:0857 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0857
BIOSCODE:0857 </span>dsk_read<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0857                 </span><span style="color:navy">call    </span>DISKRD
<span style="color:maroon">BIOSCODE:085A                 </span><span style="color:navy">jmp     short </span>dsk_io
<span style="color:black">BIOSCODE:085C
BIOSCODE:085C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:085C
BIOSCODE:085C
BIOSCODE:085C </span>checksingle     proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:085C                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:085D                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSCODE:085E                 </span><span style="color:navy">mov     bx, es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">] </span>; [es:di+BDS.flags]
<span style="color:black">BIOSCODE:0862                 </span><span style="color:navy">test    bl, </span><span style="color:green">21h         </span>; fnon_removable|fi_own_physical
<span style="color:black">BIOSCODE:0865                 </span><span style="color:navy">jnz     short </span><span style="color:gray">singleret
</span><span style="color:black">BIOSCODE:0867                 </span><span style="color:navy">test    bl, </span><span style="color:green">10h         </span>; fi_am_mult
<span style="color:black">BIOSCODE:0867                                         </span>; is there a drive sharing this physical drive?
<span style="color:black">BIOSCODE:086A                 </span><span style="color:navy">jz      short </span><span style="color:gray">singleret
</span><span style="color:black">BIOSCODE:086C                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:086C                                         </span>; get physical drive number
<span style="color:black">BIOSCODE:0870                 </span><span style="color:navy">push    es              </span>; preserve pointer to current bds
<span style="color:black">BIOSCODE:0871                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:0872                 </span><span style="color:navy">les     di, ds:</span>start_bds ; get first bds
<span style="color:black">BIOSCODE:0876
BIOSCODE:0876 </span><span style="color:gray">scan_list</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0876                 </span><span style="color:navy">cmp     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], al
</span><span style="color:black">BIOSCODE:087A                 </span><span style="color:navy">jnz     short </span>scan_skip ; Not our drive. Try next bds.
<span style="color:black">BIOSCODE:087C                 </span><span style="color:navy">mov     bl, </span><span style="color:green">20h         </span>; fi_own_physical ; test ownership flag
<span style="color:black">BIOSCODE:087E                 </span><span style="color:navy">test    es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], bl
</span><span style="color:black">BIOSCODE:0882                 </span><span style="color:navy">jz      short </span>scan_skip ; he doesn&#039;t own it either. continue
<span style="color:black">BIOSCODE:0884                 </span><span style="color:navy">xor     es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], bl </span>; reset ownership flag
<span style="color:black">BIOSCODE:0888                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSCODE:0889                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:088A                 </span><span style="color:navy">or      es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], bl
</span><span style="color:black">BIOSCODE:088E                 </span><span style="color:navy">cmp     ds:</span>fsetowner<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:0893                 </span><span style="color:navy">jnz     short </span><span style="color:gray">not_fsetowner
</span><span style="color:black">BIOSCODE:0895                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; are we handling drive number 0 ?
<span style="color:black">BIOSCODE:089A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">singleret
</span><span style="color:black">BIOSCODE:089C                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; [es:di+BDS.drivelet]
<span style="color:black">BIOSCODE:089C                                         </span>; get the DOS drive letter
<span style="color:black">BIOSCODE:08A0                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:08A1                 </span><span style="color:navy">mov     es, ds:</span>zeroseg
<span style="color:black">BIOSCODE:08A5                 </span>assume es:nothing
<span style="color:black">BIOSCODE:08A5                 </span><span style="color:navy">mov     byte ptr es:</span>bintobcd<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, al </span>; [es:LSTDRV]
<span style="color:black">BIOSCODE:08A5                                         </span>; set up sdsb
<span style="color:black">BIOSCODE:08A9                 </span><span style="color:navy">pop     es              </span>; restore bds pointer
<span style="color:black">BIOSCODE:08AA                 </span>assume es:nothing
<span style="color:black">BIOSCODE:08AA                 </span><span style="color:navy">jmp     short </span><span style="color:gray">singleret
</span><span style="color:black">BIOSCODE:08AC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:08AC
BIOSCODE:08AC </span><span style="color:gray">not_fsetowner</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:08AC                 </span><span style="color:navy">cmp     ds:</span>single<span style="color:navy">, </span><span style="color:#ff8000">2    </span>; if (single_drive_system)
<span style="color:black">BIOSCODE:08B1                 </span><span style="color:navy">jnz     short </span>ignore_sdsb
<span style="color:black">BIOSCODE:08B3                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:08B4                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; if (curr_drv == req_drv)
<span style="color:black">BIOSCODE:08B8                 </span><span style="color:navy">mov     ah, al
</span><span style="color:black">BIOSCODE:08BA                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:08BB                 </span><span style="color:navy">mov     es, ds:</span>zeroseg
<span style="color:black">BIOSCODE:08BF                 </span>assume es:nothing
<span style="color:black">BIOSCODE:08BF                 </span><span style="color:navy">xchg    al, byte ptr es:</span>bintobcd<span style="color:navy">+</span><span style="color:green">2 </span>; [es:LSTDRV]
<span style="color:black">BIOSCODE:08BF                                         </span>; then swap(curr_drv,req_drv)
<span style="color:black">BIOSCODE:08C4                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:08C5                 </span>assume es:nothing
<span style="color:black">BIOSCODE:08C5                 </span><span style="color:navy">cmp     ah, al          </span>; else
<span style="color:black">BIOSCODE:08C7                 </span><span style="color:navy">pop     ax              </span>; swap(curr_drv,req_drv)
<span style="color:black">BIOSCODE:08C8                 </span><span style="color:navy">jz      short </span><span style="color:gray">singleret </span>; issue swap_dsk_msg
<span style="color:black">BIOSCODE:08CA
BIOSCODE:08CA </span>ignore_sdsb<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:08CA                 </span><span style="color:navy">call    </span>swpdsk
<span style="color:black">BIOSCODE:08CD                 </span><span style="color:navy">jmp     short </span><span style="color:gray">singleret
</span><span style="color:black">BIOSCODE:08CF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:08CF
BIOSCODE:08CF </span>scan_skip<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:08CF                 </span><span style="color:navy">les     di, es:[di]
</span><span style="color:black">BIOSCODE:08D2                 </span><span style="color:navy">cmp     di, </span><span style="color:green">0FFFFh      </span>; -1 ; end of list?
<span style="color:black">BIOSCODE:08D5                 </span><span style="color:navy">jnz     short </span><span style="color:gray">scan_list </span>; continue until hit end of list
<span style="color:black">BIOSCODE:08D7                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:08D8                 </span><span style="color:navy">pop     di              </span>; restore current bds
<span style="color:black">BIOSCODE:08D9                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:08DA
BIOSCODE:08DA </span><span style="color:gray">singleret</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:08DA                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSCODE:08DB                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:08DC                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:08DC </span>checksingle     endp
<span style="color:black">BIOSCODE:08DC
BIOSCODE:08DD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:08DD </span><span style="color:gray">; START OF FUNCTION CHUNK FOR diskio
</span><span style="color:black">BIOSCODE:08DD
BIOSCODE:08DD </span><span style="color:navy">loc_2E9D:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:08DD                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">8           </span>; sector not found
<span style="color:black">BIOSCODE:08DF                 </span><span style="color:navy">jmp     short loc_2EA3
</span><span style="color:black">BIOSCODE:08E1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:08E1
BIOSCODE:08E1 </span><span style="color:navy">loc_2EA1:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:08E1                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">7           </span>; unknown media
<span style="color:black">BIOSCODE:08E3
BIOSCODE:08E3 </span><span style="color:navy">loc_2EA3:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:08E3                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:08E3 </span><span style="color:gray">; END OF FUNCTION CHUNK FOR diskio
</span><span style="color:black">BIOSCODE:08E4
BIOSCODE:08E4 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:08E4
BIOSCODE:08E4
BIOSCODE:08E4 </span>ioret           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:08E4                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:08E4 </span>ioret           endp
<span style="color:black">BIOSCODE:08E4
BIOSCODE:08E5
BIOSCODE:08E5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:08E5
BIOSCODE:08E5
BIOSCODE:08E5 </span>DISKRD          proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:08E5                 </span><span style="color:navy">mov     ds:</span>rflag<span style="color:navy">, </span><span style="color:#ff8000">2     </span>; romread
<span style="color:black">BIOSCODE:08E5 </span><span style="background:blue">DISKRD          endp</span><span style="background:blue"> ; sp-analysis failed</span>
<span style="color:black">BIOSCODE:08E5
BIOSCODE:08EA
BIOSCODE:08EA </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:08EA
BIOSCODE:08EA
BIOSCODE:08EA </span>diskio          proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:08EA
BIOSCODE:08EA </span><span style="color:gray">; FUNCTION CHUNK AT BIOSCODE:08DD SIZE 00000007 BYTES
</span><span style="color:black">BIOSCODE:08EA
BIOSCODE:08EA                 </span><span style="color:navy">mov     bx, di          </span>; al = drive number
<span style="color:black">BIOSCODE:08EA                                         </span>; cx = sector count
<span style="color:black">BIOSCODE:08EA                                         </span>; dx = first sector (low)
<span style="color:black">BIOSCODE:08EA                                         </span>; [start_sec_h] = first sector (high)
<span style="color:black">BIOSCODE:08EA                                         </span>;
<span style="color:black">BIOSCODE:08EA                                         </span>; es:bx = transfer address
<span style="color:black">BIOSCODE:08EC                 </span><span style="color:navy">mov     ds:</span>xfer_seg<span style="color:navy">, es </span>; save transfer segment
<span style="color:black">BIOSCODE:08F0                 </span><span style="color:navy">call    </span>SetDrive
<span style="color:black">BIOSCODE:08F3                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">10h</span><span style="color:navy">] </span>; [es:di+BDS.media]
<span style="color:black">BIOSCODE:08F7                 </span><span style="color:navy">mov     ds:</span>medbyt<span style="color:navy">, al
</span><span style="color:black">BIOSCODE:08FA                 </span><span style="color:navy">jcxz    short </span>ioret
<span style="color:black">BIOSCODE:08FC                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">24h</span><span style="color:navy">], </span><span style="color:green">2 </span>; [es:di+BDS.flags+1],
<span style="color:black">BIOSCODE:08FC                                         </span>;  unformatted_media
<span style="color:black">BIOSCODE:0901                 </span><span style="color:navy">jnz     short loc_2EA1
</span><span style="color:black">BIOSCODE:0903                 </span><span style="color:navy">mov     ds:</span>seccnt<span style="color:navy">, cx   </span>; save sector count
<span style="color:black">BIOSCODE:0907                 </span><span style="color:navy">mov     ds:</span>spsav<span style="color:navy">, sp    </span>; save sp
<span style="color:black">BIOSCODE:090B                 </span><span style="color:navy">mov     ax, dx
</span><span style="color:black">BIOSCODE:090D                 </span><span style="color:navy">xor     si, si
</span><span style="color:black">BIOSCODE:090F                 </span><span style="color:navy">add     dx, cx
</span><span style="color:black">BIOSCODE:0911                 </span><span style="color:navy">adc     si, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:0914                 </span><span style="color:navy">cmp     word ptr es:[di+</span><span style="color:#ff8000">0Eh</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+BDS.totalsecs16]
<span style="color:black">BIOSCODE:0914                                         </span>; &gt; 32 bit sector ?
<span style="color:black">BIOSCODE:0919                 </span><span style="color:navy">jz      short loc_2EE8
</span><span style="color:black">BIOSCODE:091B                 </span><span style="color:navy">cmp     si, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:091E                 </span><span style="color:navy">jnz     short loc_2E9D
</span><span style="color:black">BIOSCODE:0920                 </span><span style="color:navy">cmp     dx, es:[di+</span><span style="color:#ff8000">0Eh</span><span style="color:navy">] </span>; [es:di+BDS.totalsecs16]
<span style="color:black">BIOSCODE:0924                 </span><span style="color:navy">ja      short loc_2E9D
</span><span style="color:black">BIOSCODE:0926                 </span><span style="color:navy">jmp     short loc_2EFA
</span><span style="color:black">BIOSCODE:0928 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0928
BIOSCODE:0928 </span><span style="color:navy">loc_2EE8:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0928                 </span><span style="color:navy">add     si, ds:</span>start_sec_h
<span style="color:black">BIOSCODE:092C                 </span><span style="color:navy">cmp     si, es:[di+</span><span style="color:#ff8000">1Dh</span><span style="color:navy">] </span>; [es:di+BDS.totalsecs32+2]
<span style="color:black">BIOSCODE:0930                 </span><span style="color:navy">jb      short loc_2EFA
</span><span style="color:black">BIOSCODE:0932                 </span><span style="color:navy">ja      short loc_2E9D
</span><span style="color:black">BIOSCODE:0934                 </span><span style="color:navy">cmp     dx, es:[di+</span><span style="color:#ff8000">1Bh</span><span style="color:navy">] </span>; [es:di+BDS.totalsecs32]
<span style="color:black">BIOSCODE:0938                 </span><span style="color:navy">ja      short loc_2E9D
</span><span style="color:black">BIOSCODE:093A
BIOSCODE:093A </span><span style="color:navy">loc_2EFA:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:093A                 </span><span style="color:navy">mov     dx, ds:</span>start_sec_h
<span style="color:black">BIOSCODE:093E                 </span><span style="color:navy">add     ax, es:[di+</span><span style="color:#ff8000">17h</span><span style="color:navy">] </span>; [es:di+BDS.hiddensecs]
<span style="color:black">BIOSCODE:0942                 </span><span style="color:navy">adc     dx, es:[di+</span><span style="color:#ff8000">19h</span><span style="color:navy">] </span>; [es:di+BDS.hiddensecs+2]
<span style="color:black">BIOSCODE:0946                 </span><span style="color:navy">mov     ds:</span>saved_word<span style="color:navy">, ax </span>; save the sector number (low)
<span style="color:black">BIOSCODE:0949                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:094A                 </span><span style="color:navy">mov     es, ds:</span>zeroseg  ; 0
<span style="color:black">BIOSCODE:094E                 </span>assume es:nothing
<span style="color:black">BIOSCODE:094E                 </span><span style="color:navy">les     si, dword ptr es:</span>single ; [es:DSKADR] ; INT 1Eh vector
<span style="color:black">BIOSCODE:094E                                         </span>; current disk parm table
<span style="color:black">BIOSCODE:0953                 </span>assume es:nothing
<span style="color:black">BIOSCODE:0953                 </span><span style="color:navy">mov     word ptr ds:</span>dpt<span style="color:navy">, si
</span><span style="color:black">BIOSCODE:0957                 </span><span style="color:navy">mov     word ptr ds:</span>dpt<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">BIOSCODE:095B                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:095C                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags],
<span style="color:black">BIOSCODE:095C                                         </span>; fnon_removable
<span style="color:black">BIOSCODE:0961                 </span><span style="color:navy">jnz     short loc_2F33
</span><span style="color:black">BIOSCODE:0963                 </span><span style="color:navy">call    </span>checksingle
<span style="color:black">BIOSCODE:0966                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0   </span>; do we have changeline support?
<span style="color:black">BIOSCODE:096B                 </span><span style="color:navy">jz      short loc_2F30  </span>; brif not
<span style="color:black">BIOSCODE:096D                 </span><span style="color:navy">call    </span>checklatchio    ; will do a sneaky pop stack return
<span style="color:black">BIOSCODE:096D                                         </span>; if a disk error occurs
<span style="color:black">BIOSCODE:0970
BIOSCODE:0970 </span><span style="color:navy">loc_2F30:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0970                 </span><span style="color:navy">call    </span>iosetup         ; set up tables and variables for i/o
<span style="color:black">BIOSCODE:0973
BIOSCODE:0973 </span><span style="color:navy">loc_2F33:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0973                 </span><span style="color:navy">mov     ax, dx
</span><span style="color:black">BIOSCODE:0975                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSCODE:0977                 </span><span style="color:navy">div     word ptr es:[di+</span><span style="color:#ff8000">13h</span><span style="color:navy">] </span>; [es:di+BDS.secpertrack]
<span style="color:black">BIOSCODE:0977                                         </span>; divide by sec per track
<span style="color:black">BIOSCODE:097B                 </span><span style="color:navy">mov     ds:</span>temp_h<span style="color:navy">, ax
</span><span style="color:black">BIOSCODE:097E                 </span><span style="color:navy">mov     ax, ds:</span>saved_word
<span style="color:black">BIOSCODE:0981                 </span><span style="color:navy">div     word ptr es:[di+</span><span style="color:#ff8000">13h</span><span style="color:navy">] </span>; [es:di+BDS.secpertrack]
<span style="color:black">BIOSCODE:0981                                         </span>; now, [temp_h]:ax = track #, dx = sector
<span style="color:black">BIOSCODE:0981                                         </span>; sector number is 1 based.
<span style="color:black">BIOSCODE:0985                 </span><span style="color:navy">inc     dl
</span><span style="color:black">BIOSCODE:0987                 </span><span style="color:navy">mov     ds:</span>cursec<span style="color:navy">, dl   </span>; save current sector
<span style="color:black">BIOSCODE:098B                 </span><span style="color:navy">mov     cx, es:[di+</span><span style="color:#ff8000">15h</span><span style="color:navy">] </span>; [es:di+BDS.heads]
<span style="color:black">BIOSCODE:098B                                         </span>; get number of heads
<span style="color:black">BIOSCODE:098F                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:0990                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSCODE:0992                 </span><span style="color:navy">mov     ax, ds:</span>temp_h   ; divide tracks by heads per cylinder
<span style="color:black">BIOSCODE:0995                 </span><span style="color:navy">div     cx
</span><span style="color:black">BIOSCODE:0997                 </span><span style="color:navy">mov     ds:</span>temp_h<span style="color:navy">, ax
</span><span style="color:black">BIOSCODE:099A                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:099B                 </span><span style="color:navy">div     cx              </span>; now, [temp_h]:ax = cylinder #, dx = head
<span style="color:black">BIOSCODE:099D                 </span><span style="color:navy">cmp     ds:</span>temp_h<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:09A2                 </span><span style="color:navy">ja      short loc_2F7A
</span><span style="color:black">BIOSCODE:09A4                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">1024        </span>; 2^10 currently maxium for track #.
<span style="color:black">BIOSCODE:09A7                 </span><span style="color:navy">ja      short loc_2F7A
</span><span style="color:black">BIOSCODE:09A9                 </span><span style="color:navy">mov     ds:</span>curhd<span style="color:navy">, dl    </span>; save current head
<span style="color:black">BIOSCODE:09AD                 </span><span style="color:navy">mov     ds:</span>curtrk<span style="color:navy">, ax   </span>; save current track
<span style="color:black">BIOSCODE:09B0                 </span><span style="color:navy">mov     ax, ds:</span>seccnt
<span style="color:black">BIOSCODE:09B3                 </span><span style="color:navy">call    </span>block
<span style="color:black">BIOSCODE:09B6                 </span><span style="color:navy">call    </span>done
<span style="color:black">BIOSCODE:09B9                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:09BA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:09BA
BIOSCODE:09BA </span><span style="color:navy">loc_2F7A:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:09BA                 </span><span style="color:navy">jmp     loc_2E9D
</span><span style="color:black">BIOSCODE:09BA </span><span style="background:blue"><span style="color:navy">diskio          endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">BIOSCODE:09BA
BIOSCODE:09BD
BIOSCODE:09BD </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:09BD
BIOSCODE:09BD
BIOSCODE:09BD </span>iosetup         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:09BD                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:green">4</span><span style="color:navy">]   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:09C1                 </span><span style="color:navy">mov     ds:</span>tim_drv<span style="color:navy">, al  </span>; save drive letter
<span style="color:black">BIOSCODE:09C4                 </span><span style="color:navy">cmp     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:green">0
</span><span style="color:black">BIOSCODE:09C9                 </span><span style="color:navy">jnz     short </span><span style="color:gray">skip_dpt_setting
</span><span style="color:black">BIOSCODE:09CB                 </span><span style="color:navy">mov     al, ds:</span>eot      ; fetch up eot before changing ds
<span style="color:black">BIOSCODE:09CE                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:09CF                 </span><span style="color:navy">lds     si, ds:</span>dpt      ; get pointer to disk base table
<span style="color:black">BIOSCODE:09D3                 </span><span style="color:navy">mov     [si+</span><span style="color:green">4</span><span style="color:navy">], al
</span><span style="color:black">BIOSCODE:09D6                 </span><span style="color:navy">mov     al, [si+</span><span style="color:green">10</span><span style="color:navy">]     </span>; [si+DISK_PARMS.DISK_MOTOR_STRT]
<span style="color:black">BIOSCODE:09D9                 </span><span style="color:navy">mov     ah, [si+</span><span style="color:green">4</span><span style="color:navy">]      </span>; [si+DISK_PARMS.DISK_EOT]
<span style="color:black">BIOSCODE:09DC                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSCODE:09DD                 </span><span style="color:navy">mov     ds:</span>motorstartup<span style="color:navy">, al
</span><span style="color:black">BIOSCODE:09E0                 </span><span style="color:navy">mov     ds:</span>save_eot<span style="color:navy">, ah
</span><span style="color:black">BIOSCODE:09E4                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:09E5                 </span><span style="color:navy">lds     si, ds:</span>dpt
<span style="color:black">BIOSCODE:09E9                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:green">34</span><span style="color:navy">], </span><span style="color:green">2 </span>; [es:di+BDS.formfactor], ffSmall
<span style="color:black">BIOSCODE:09EE                 </span><span style="color:navy">jnz     short </span><span style="color:gray">motor_start_ok
</span><span style="color:black">BIOSCODE:09F0                 </span><span style="color:navy">mov     al, </span><span style="color:green">4
</span><span style="color:black">BIOSCODE:09F2                 </span><span style="color:navy">xchg    al, [si+</span><span style="color:green">10</span><span style="color:navy">]     </span>; [si+DISK_PARMS.DISK_MOTOR_STRT]
<span style="color:black">BIOSCODE:09F5
BIOSCODE:09F5 </span><span style="color:gray">motor_start_ok</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:09F5                 </span><span style="color:navy">xor     al, al
</span><span style="color:black">BIOSCODE:09F7                 </span><span style="color:navy">inc     al              </span>; ibm wants fast settle to be 1
<span style="color:black">BIOSCODE:09F9                 </span><span style="color:navy">xchg    al, [si+</span><span style="color:green">9</span><span style="color:navy">]      </span>; [si+DISK_PARMS.DISK_HEAD_STTL]
<span style="color:black">BIOSCODE:09F9                                         </span>; get settle and set up for fast
<span style="color:black">BIOSCODE:09FC                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSCODE:09FD                 </span><span style="color:navy">mov     ds:</span>settlecurrent<span style="color:navy">, al
</span><span style="color:black">BIOSCODE:0A00                 </span><span style="color:navy">mov     al, </span><span style="color:green">15          </span>; NORMSETTLE
<span style="color:black">BIOSCODE:0A00                                         </span>; someone has diddled the settle
<span style="color:black">BIOSCODE:0A02                 </span><span style="color:navy">mov     ds:</span>settleslow<span style="color:navy">, al
</span><span style="color:black">BIOSCODE:0A05
BIOSCODE:0A05 </span><span style="color:gray">skip_dpt_setting</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A05                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0A05 </span>iosetup         endp
<span style="color:black">BIOSCODE:0A05
BIOSCODE:0A06
BIOSCODE:0A06 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0A06
BIOSCODE:0A06
BIOSCODE:0A06 </span>done            proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A06                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:0A0B                 </span><span style="color:navy">jnz     short </span>ddbx      ; do not set for non-removable media
<span style="color:black">BIOSCODE:0A0D                 </span><span style="color:navy">call    </span>set_tim
<span style="color:black">BIOSCODE:0A10
BIOSCODE:0A10 </span>diddle_back<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A10                 </span><span style="color:navy">pushf
</span><span style="color:black">BIOSCODE:0A11                 </span><span style="color:navy">cmp     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:0A16                 </span><span style="color:navy">jnz     short </span><span style="color:gray">nodiddleback
</span><span style="color:black">BIOSCODE:0A18                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:0A19                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:0A1A                 </span><span style="color:navy">les     si, ds:</span>dpt
<span style="color:black">BIOSCODE:0A1E                 </span><span style="color:navy">mov     al, ds:</span>save_eot
<span style="color:black">BIOSCODE:0A21                 </span><span style="color:navy">mov     es:[si+</span><span style="color:#ff8000">4</span><span style="color:navy">], al   </span>; [es:si+DISK_PARMS.DISK_EOT]
<span style="color:black">BIOSCODE:0A25                 </span><span style="color:navy">mov     al, ds:</span>settlecurrent
<span style="color:black">BIOSCODE:0A28                 </span><span style="color:navy">mov     ah, ds:</span>motorstartup
<span style="color:black">BIOSCODE:0A2C                 </span><span style="color:navy">mov     es:[si+</span><span style="color:#ff8000">9</span><span style="color:navy">], al   </span>; [es:si+DISK_PARMS.DISK_HEAD_STTL]
<span style="color:black">BIOSCODE:0A30                 </span><span style="color:navy">mov     byte ptr es:[si+</span><span style="color:#ff8000">3</span><span style="color:navy">], </span><span style="color:#ff8000">2 </span>; [es:si+DISK_PARMS.DISK_SECTOR_SIZ]
<span style="color:black">BIOSCODE:0A35                 </span><span style="color:navy">mov     es:[si+</span><span style="color:#ff8000">0Ah</span><span style="color:navy">], ah </span>; [es:si+DISK_PARMS.DISK_MOTOR_STRT]
<span style="color:black">BIOSCODE:0A39                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:0A3A                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:0A3B
BIOSCODE:0A3B </span><span style="color:gray">nodiddleback</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A3B                 </span><span style="color:navy">popf
</span><span style="color:black">BIOSCODE:0A3C
BIOSCODE:0A3C </span>ddbx<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A3C                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0A3C </span>done            endp
<span style="color:black">BIOSCODE:0A3C
BIOSCODE:0A3D
BIOSCODE:0A3D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0A3D
BIOSCODE:0A3D
BIOSCODE:0A3D </span>block           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A3D                 </span><span style="color:navy">or      ax, ax
</span><span style="color:black">BIOSCODE:0A3F                 </span><span style="color:navy">jz      short </span>ddbx
<span style="color:black">BIOSCODE:0A41                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:black">BIOSCODE:0A46                 </span><span style="color:navy">jz      short </span><span style="color:gray">block_floppy
</span><span style="color:black">BIOSCODE:0A48                 </span><span style="color:navy">test    byte ptr ds:</span>multrk_flag<span style="color:navy">, </span><span style="color:green">80h </span>; multrk_on
<span style="color:black">BIOSCODE:0A4D                 </span><span style="color:navy">jz      short </span><span style="color:gray">block_floppy
</span><span style="color:black">BIOSCODE:0A4F                 </span><span style="color:navy">call    </span>disk
<span style="color:black">BIOSCODE:0A52                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">BIOSCODE:0A54                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0A55 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0A55
BIOSCODE:0A55 </span><span style="color:gray">block_floppy</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A55                 </span><span style="color:navy">mov     cl, es:[di+</span><span style="color:green">19</span><span style="color:navy">]
</span><span style="color:black">BIOSCODE:0A59                 </span><span style="color:navy">inc     cl
</span><span style="color:black">BIOSCODE:0A5B                 </span><span style="color:navy">sub     cl, ds:</span>cursec
<span style="color:black">BIOSCODE:0A5F                 </span><span style="color:navy">xor     ch, ch
</span><span style="color:black">BIOSCODE:0A61                 </span><span style="color:navy">cmp     ax, cx
</span><span style="color:black">BIOSCODE:0A63                 </span><span style="color:navy">jnb     short </span><span style="color:gray">gotmin
</span><span style="color:black">BIOSCODE:0A65                 </span><span style="color:navy">mov     cx, ax
</span><span style="color:black">BIOSCODE:0A67
BIOSCODE:0A67 </span><span style="color:gray">gotmin</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A67                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:0A68                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:0A69                 </span><span style="color:navy">mov     ax, cx
</span><span style="color:black">BIOSCODE:0A6B                 </span><span style="color:navy">call    </span>disk
<span style="color:black">BIOSCODE:0A6E                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:0A6F                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:0A70                 </span><span style="color:navy">sub     ax, cx          </span>; reduce sectors-remaining by last i/o
<span style="color:black">BIOSCODE:0A72                 </span><span style="color:navy">shl     cl, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:0A74                 </span><span style="color:navy">add     bh, cl          </span>; adjust transfer address
<span style="color:black">BIOSCODE:0A76                 </span><span style="color:navy">jmp     short </span>block
<span style="color:black">BIOSCODE:0A76 </span>block           endp
<span style="color:black">BIOSCODE:0A76
BIOSCODE:0A78 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0A78 </span><span style="color:gray">; START OF FUNCTION CHUNK FOR disk
</span><span style="color:black">BIOSCODE:0A78
BIOSCODE:0A78 </span><span style="color:navy">loc_3038:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A78                 </span><span style="color:navy">jmp     </span><span style="color:gray">dskerr
</span><span style="color:black">BIOSCODE:0A78 </span><span style="color:gray">; END OF FUNCTION CHUNK FOR disk
</span><span style="color:black">BIOSCODE:0A7B
BIOSCODE:0A7B </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0A7B
BIOSCODE:0A7B
BIOSCODE:0A7B </span>disk            proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A7B
BIOSCODE:0A7B </span><span style="color:gray">; FUNCTION CHUNK AT BIOSCODE:0A78 SIZE 00000003 BYTES
</span><span style="color:black">BIOSCODE:0A7B
BIOSCODE:0A7B                 </span><span style="color:navy">mov     bp, </span><span style="color:#ff8000">5           </span>; al = number of sectors (1-8, all on one track)
<span style="color:black">BIOSCODE:0A7B                                         </span>; es:di point to drive parameters
<span style="color:black">BIOSCODE:0A7B                                         </span>; xfer_seg:bx = transfer address
<span style="color:black">BIOSCODE:0A7B                                         </span>;      (must not cross a 64k physical boundary)
<span style="color:black">BIOSCODE:0A7B                                         </span>; [rflag] = 2 if read, 3 if write
<span style="color:black">BIOSCODE:0A7B                                         </span>; [verify] = 0 for normal, 1 for verify after write
<span style="color:black">BIOSCODE:0A7B                                         </span>;
<span style="color:black">BIOSCODE:0A7B                                         </span>; bp = MAXERR
<span style="color:black">BIOSCODE:0A7B                                         </span>;      retry_count
<span style="color:black">BIOSCODE:0A7E                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:black">BIOSCODE:0A83                 </span><span style="color:navy">jz      short </span><span style="color:gray">GetRdWrInd
</span><span style="color:black">BIOSCODE:0A85                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">4           </span>; romverify ; Is this a track verify?
<span style="color:black">BIOSCODE:0A88                 </span><span style="color:navy">jz      short </span><span style="color:gray">GetRdWrInd
</span><span style="color:black">BIOSCODE:0A8A                 </span><span style="color:navy">mov     bp, </span><span style="color:#ff8000">2           </span>; This is not verify so only 1 retry
<span style="color:black">BIOSCODE:0A8D
BIOSCODE:0A8D </span><span style="color:gray">GetRdWrInd</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A8D                 </span><span style="color:navy">mov     ds:</span>vretry_cnt<span style="color:navy">, bp </span>; verify op. retry cnt for write-verify
<span style="color:black">BIOSCODE:0A91                 </span><span style="color:navy">mov     ds:</span>soft_ecc_cnt<span style="color:navy">, bp </span>; soft ecc error retry count
<span style="color:black">BIOSCODE:0A95                 </span><span style="color:navy">mov     ah, ds:</span>rflag    ; get read/write indicator
<span style="color:black">BIOSCODE:0A99
BIOSCODE:0A99 </span><span style="color:gray">_retry</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0A99                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:0A9A                 </span><span style="color:navy">mov     dx, ds:</span>curtrk
<span style="color:black">BIOSCODE:0A9E                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.bdsm_ismini]
<span style="color:black">BIOSCODE:0A9E                                         </span>; is this a mini disk? ((logical dos partition))
<span style="color:black">BIOSCODE:0AA3                 </span><span style="color:navy">jz      short </span><span style="color:gray">disk_not_mini </span>; no. continue to next
<span style="color:black">BIOSCODE:0AA5                 </span><span style="color:navy">cmp     word ptr es:[di+</span><span style="color:#ff8000">47h</span><span style="color:navy">], </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:0AAA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">disk_not_mini
</span><span style="color:black">BIOSCODE:0AAC                 </span><span style="color:navy">add     dx, es:[di+</span><span style="color:#ff8000">49h</span><span style="color:navy">] </span>; [es:di+BDS.bdsm_hidden_trks]
<span style="color:black">BIOSCODE:0AAC                                         </span>; add hidden tracks
<span style="color:black">BIOSCODE:0AB0
BIOSCODE:0AB0 </span><span style="color:gray">disk_not_mini</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0AB0                 </span><span style="color:navy">ror     dh, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:0AB2                 </span><span style="color:navy">ror     dh, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:0AB4                 </span><span style="color:navy">or      dh, ds:</span>cursec
<span style="color:black">BIOSCODE:0AB8                 </span><span style="color:navy">mov     cx, dx
</span><span style="color:black">BIOSCODE:0ABA                 </span><span style="color:navy">xchg    ch, cl          </span>; cl = sector, ch = cylinder
<span style="color:black">BIOSCODE:0ABC                 </span><span style="color:navy">mov     dh, ds:</span>curhd    ; load current head number and
<span style="color:black">BIOSCODE:0AC0                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; physical drive number
<span style="color:black">BIOSCODE:0AC0                                         </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:0AC4                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], </span><span style="color:#ff8000">5 </span>; [es:di+BDS.formfactor], ffHardFile
<span style="color:black">BIOSCODE:0AC9                 </span><span style="color:navy">jz      short </span><span style="color:gray">do_fast   </span>; hard files use fast speed
<span style="color:black">BIOSCODE:0ACB                 </span><span style="color:navy">cmp     ds:</span>step_drv<span style="color:navy">, </span><span style="color:green">0FFh </span>; -1
<span style="color:black">BIOSCODE:0AD0                 </span><span style="color:navy">jz      short </span><span style="color:gray">do_writej
</span><span style="color:black">BIOSCODE:0AD2                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">2           </span>; romread
<span style="color:black">BIOSCODE:0AD5                 </span><span style="color:navy">jz      short </span><span style="color:gray">do_fast
</span><span style="color:black">BIOSCODE:0AD7                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">4           </span>; romverify
<span style="color:black">BIOSCODE:0ADA                 </span><span style="color:navy">jz      short </span><span style="color:gray">do_fast
</span><span style="color:black">BIOSCODE:0ADC
BIOSCODE:0ADC </span><span style="color:gray">do_writej</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0ADC                 </span><span style="color:navy">jmp     short </span><span style="color:gray">do_write
</span><span style="color:black">BIOSCODE:0ADE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0ADE
BIOSCODE:0ADE </span><span style="color:gray">do_fast</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0ADE                 </span><span style="color:navy">call    </span>fastspeed       ; change settle mode
<span style="color:black">BIOSCODE:0AE1
BIOSCODE:0AE1 </span><span style="color:gray">testerr</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0AE1                 </span><span style="color:navy">jb      short loc_3038
</span><span style="color:black">BIOSCODE:0AE3                 </span><span style="color:navy">mov     ds:</span>step_drv<span style="color:navy">, dl
</span><span style="color:black">BIOSCODE:0AE7                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">46h</span><span style="color:navy">], ch </span>; [es:di+BDS.track]
<span style="color:black">BIOSCODE:0AEB                 </span><span style="color:navy">cmp     word ptr ds:</span>rflag<span style="color:navy">, </span><span style="color:#ff8000">103h
</span><span style="color:black">BIOSCODE:0AF1                 </span><span style="color:navy">jz      short </span><span style="color:gray">doverify
</span><span style="color:black">BIOSCODE:0AF3
BIOSCODE:0AF3 </span><span style="color:gray">noverify</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0AF3                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:0AF4                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:black">BIOSCODE:0AF9                 </span><span style="color:navy">jz      short </span><span style="color:gray">its_removable
</span><span style="color:black">BIOSCODE:0AFB                 </span><span style="color:navy">test    byte ptr ds:</span>multrk_flag<span style="color:navy">, </span><span style="color:green">80h </span>; multrk_on
<span style="color:black">BIOSCODE:0B00                 </span><span style="color:navy">jnz     short </span><span style="color:gray">disk_ret
</span><span style="color:black">BIOSCODE:0B02
BIOSCODE:0B02 </span><span style="color:gray">its_removable</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B02                 </span><span style="color:navy">and     cl, </span><span style="color:green">3Fh         </span>; eliminate cylinder bits from sector
<span style="color:black">BIOSCODE:0B05                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">BIOSCODE:0B07                 </span><span style="color:navy">sub     ds:</span>seccnt<span style="color:navy">, ax   </span>; reduce count of sectors to go next sector
<span style="color:black">BIOSCODE:0B0B                 </span><span style="color:navy">add     cl, al
</span><span style="color:black">BIOSCODE:0B0D                 </span><span style="color:navy">mov     ds:</span>cursec<span style="color:navy">, cl
</span><span style="color:black">BIOSCODE:0B11                 </span><span style="color:navy">cmp     cl, es:[di+</span><span style="color:#ff8000">13h</span><span style="color:navy">] </span>; [es:di+BDS.secpertrack]
<span style="color:black">BIOSCODE:0B11                                         </span>; see if sector/track limit reached
<span style="color:black">BIOSCODE:0B15                 </span><span style="color:navy">jbe     short </span><span style="color:gray">disk_ret
</span><span style="color:black">BIOSCODE:0B17                 </span><span style="color:navy">mov     ds:</span>cursec<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:0B1C                 </span><span style="color:navy">mov     dh, ds:</span>curhd
<span style="color:black">BIOSCODE:0B20                 </span><span style="color:navy">inc     dh
</span><span style="color:black">BIOSCODE:0B22                 </span><span style="color:navy">cmp     dh, es:[di+</span><span style="color:#ff8000">15h</span><span style="color:navy">]
</span><span style="color:black">BIOSCODE:0B26                 </span><span style="color:navy">jb      short </span><span style="color:gray">noxor
</span><span style="color:black">BIOSCODE:0B28                 </span><span style="color:navy">xor     dh, dh          </span>; head 0
<span style="color:black">BIOSCODE:0B2A                 </span><span style="color:navy">inc     ds:</span>curtrk       ; next track
<span style="color:black">BIOSCODE:0B2E
BIOSCODE:0B2E </span><span style="color:gray">noxor</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B2E                 </span><span style="color:navy">mov     ds:</span>curhd<span style="color:navy">, dh
</span><span style="color:black">BIOSCODE:0B32
BIOSCODE:0B32 </span><span style="color:gray">disk_ret</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B32                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:0B33                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0B34 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0B34
BIOSCODE:0B34 </span><span style="color:gray">do_write</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B34                 </span><span style="color:navy">cmp     dl, ds:</span>step_drv
<span style="color:black">BIOSCODE:0B38                 </span><span style="color:navy">jnz     short </span>do_norm
<span style="color:black">BIOSCODE:0B3A                 </span><span style="color:navy">cmp     ch, es:[di+</span><span style="color:#ff8000">46h</span><span style="color:navy">]
</span><span style="color:black">BIOSCODE:0B3E                 </span><span style="color:navy">jz      short </span><span style="color:gray">do_fast
</span><span style="color:black">BIOSCODE:0B40
BIOSCODE:0B40 </span>do_norm<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B40                 </span><span style="color:navy">call    </span>normspeed
<span style="color:black">BIOSCODE:0B43                 </span><span style="color:navy">jmp     short </span><span style="color:gray">testerr
</span><span style="color:black">BIOSCODE:0B45 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0B45
BIOSCODE:0B45 </span><span style="color:gray">doverify</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B45                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:0B46                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:0B47                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">4
</span><span style="color:black">BIOSCODE:0B49                 </span><span style="color:navy">call    </span>fastspeed
<span style="color:black">BIOSCODE:0B4C                 </span><span style="color:navy">jnb     short </span><span style="color:gray">noverify
</span><span style="color:black">BIOSCODE:0B4E                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">11h         </span>; soft ecc error ?
<span style="color:black">BIOSCODE:0B51                 </span><span style="color:navy">jnz     short </span><span style="color:gray">not_softecc_err
</span><span style="color:black">BIOSCODE:0B53                 </span><span style="color:navy">dec     ds:</span>soft_ecc_cnt
<span style="color:black">BIOSCODE:0B57                 </span><span style="color:navy">jz      short </span><span style="color:gray">noverify  </span>; no more retry
<span style="color:black">BIOSCODE:0B59                 </span><span style="color:navy">call    </span>resetdisk
<span style="color:black">BIOSCODE:0B5C                 </span><span style="color:navy">jmp     short </span><span style="color:gray">dskerr1   </span>; retry
<span style="color:black">BIOSCODE:0B5E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0B5E
BIOSCODE:0B5E </span><span style="color:gray">not_softecc_err</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B5E                 </span><span style="color:navy">call    </span>resetdisk
<span style="color:black">BIOSCODE:0B61                 </span><span style="color:navy">dec     ds:</span>vretry_cnt
<span style="color:black">BIOSCODE:0B65                 </span><span style="color:navy">jmp     short </span><span style="color:gray">dskerr0
</span><span style="color:black">BIOSCODE:0B67 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0B67
BIOSCODE:0B67 </span><span style="color:navy">loc_3127:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B67 </span><span style="color:gray">dskerr</span><span style="color:navy">:                                 </span>; do we have changeline support?
<span style="color:black">BIOSCODE:0B67                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:0B6C                 </span><span style="color:navy">jz      short </span><span style="color:gray">dskerr_nochangeline </span>; brif not
<span style="color:black">BIOSCODE:0B6E                 </span><span style="color:navy">call    </span>checkio
<span style="color:black">BIOSCODE:0B71
BIOSCODE:0B71 </span><span style="color:gray">dskerr_nochangeline</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B71                 </span><span style="color:navy">cmp     ds:</span>multitrk_format_flag<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; multi trk format request?
<span style="color:black">BIOSCODE:0B76                 </span><span style="color:navy">jnz     short </span><span style="color:gray">dochkagain </span>; no more retry
<span style="color:black">BIOSCODE:0B78                 </span><span style="color:navy">mov     bp, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:0B7B                 </span><span style="color:navy">mov     ds:</span>multitrk_format_flag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; clear the flag
<span style="color:black">BIOSCODE:0B80
BIOSCODE:0B80 </span><span style="color:gray">dochkagain</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B80                 </span><span style="color:navy">call    </span>again
<span style="color:black">BIOSCODE:0B83
BIOSCODE:0B83 </span><span style="color:gray">dskerr0</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B83                 </span><span style="color:navy">jz      short </span>harderr
<span style="color:black">BIOSCODE:0B85                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:black">BIOSCODE:0B8A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">skip_timeout_chk
</span><span style="color:black">BIOSCODE:0B8C                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">80h         </span>; timeout?
<span style="color:black">BIOSCODE:0B8F                 </span><span style="color:navy">jz      short </span>harderr
<span style="color:black">BIOSCODE:0B91
BIOSCODE:0B91 </span><span style="color:gray">skip_timeout_chk</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B91                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">0CCh        </span>; write fault error?
<span style="color:black">BIOSCODE:0B94                 </span><span style="color:navy">jz      short </span><span style="color:gray">write_fault_err </span>; then, don&#039;t retry.
<span style="color:black">BIOSCODE:0B96                 </span><span style="color:navy">mov     ds:</span>soft_ecc_cnt<span style="color:navy">, </span><span style="color:#ff8000">5 </span>; MAXERR
<span style="color:black">BIOSCODE:0B96                                         </span>; set soft_ecc_cnt back   to maxerr
<span style="color:black">BIOSCODE:0B9C
BIOSCODE:0B9C </span><span style="color:gray">dskerr1</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0B9C                 </span><span style="color:navy">pop     ax              </span>; estore sector count
<span style="color:black">BIOSCODE:0B9D                 </span><span style="color:navy">jmp     </span><span style="color:gray">_retry
</span><span style="color:black">BIOSCODE:0BA0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0BA0
BIOSCODE:0BA0 </span><span style="color:gray">write_fault_err</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0BA0                 </span><span style="color:navy">mov     bp, </span><span style="color:#ff8000">1           </span>; just retry only once
<span style="color:black">BIOSCODE:0BA0                                         </span>; for write fault error
<span style="color:black">BIOSCODE:0BA3                 </span><span style="color:navy">jmp     short </span><span style="color:gray">dskerr1
</span><span style="color:black">BIOSCODE:0BA5 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0BA5
BIOSCODE:0BA5 </span>harderr<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0BA5                 </span><span style="color:navy">call    </span>maperror
<span style="color:black">BIOSCODE:0BA8
BIOSCODE:0BA8 </span>harderr2<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0BA8                 </span><span style="color:navy">mov     ds:</span>tim_drv<span style="color:navy">, </span><span style="color:green">0FFh </span>; force a media check through rom
<span style="color:black">BIOSCODE:0BAD                 </span><span style="color:navy">mov     cx, ds:</span>seccnt   ; get count of sectors to go
<span style="color:black">BIOSCODE:0BB1                 </span><span style="color:navy">mov     sp, ds:</span>spsav    ; recover entry stack pointer
<span style="color:black">BIOSCODE:0BB5                 </span><span style="color:navy">jmp     </span>diddle_back
<span style="color:black">BIOSCODE:0BB5 </span>disk            endp
<span style="color:black">BIOSCODE:0BB5
BIOSCODE:0BB8
BIOSCODE:0BB8 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0BB8
BIOSCODE:0BB8
BIOSCODE:0BB8 </span>normspeed       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0BB8                 </span><span style="color:navy">cmp     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:0BBD                 </span><span style="color:navy">jnz     short </span>fastspeed
<span style="color:black">BIOSCODE:0BBF                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:0BC0                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:0BC1                 </span><span style="color:navy">mov     al, ds:</span>settleslow
<span style="color:black">BIOSCODE:0BC4                 </span><span style="color:navy">les     si, ds:</span>dpt      ; current disk parm table
<span style="color:black">BIOSCODE:0BC8                 </span><span style="color:navy">mov     es:[si+</span><span style="color:#ff8000">9</span><span style="color:navy">], al   </span>; [es:si+DISK_PARMS.DISK_HEAD_STTL]
<span style="color:black">BIOSCODE:0BCC                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:0BCD                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:0BCE                 </span><span style="color:navy">call    </span>fastspeed
<span style="color:black">BIOSCODE:0BD1                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:0BD2                 </span><span style="color:navy">les     si, ds:</span>dpt
<span style="color:black">BIOSCODE:0BD6                 </span><span style="color:navy">mov     byte ptr es:[si+</span><span style="color:#ff8000">9</span><span style="color:navy">], </span><span style="color:#ff8000">1 </span>; [es:si+DISK_PARMS.DISK_HEAD_STTL]
<span style="color:black">BIOSCODE:0BD6                                         </span>; 1 is fast settle value
<span style="color:black">BIOSCODE:0BDB                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:0BDC                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0BDC </span>normspeed       endp
<span style="color:black">BIOSCODE:0BDC
BIOSCODE:0BDD
BIOSCODE:0BDD </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0BDD
BIOSCODE:0BDD
BIOSCODE:0BDD </span>fastspeed       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0BDD                 </span><span style="color:navy">test    byte ptr es:[di+</span><span style="color:green">1Fh</span><span style="color:navy">], </span><span style="color:green">80h </span>; [es:di+BDS.fatsiz], ftoobig
<span style="color:black">BIOSCODE:0BE2                 </span><span style="color:navy">jnz     short </span><span style="color:gray">notready
</span><span style="color:black">BIOSCODE:0BE4                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:0BE5                 </span><span style="color:navy">mov     es, ds:</span>xfer_seg
<span style="color:black">BIOSCODE:0BE9                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK -
<span style="color:black">BIOSCODE:0BEB                 </span><span style="color:navy">mov     ds:</span>xfer_seg<span style="color:navy">, es
</span><span style="color:black">BIOSCODE:0BEF                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:0BF0                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0BF1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0BF1
BIOSCODE:0BF1 </span><span style="color:gray">notready</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0BF1                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:0BF2                 </span><span style="color:navy">mov     ah, </span><span style="color:green">80h
</span><span style="color:black">BIOSCODE:0BF4                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0BF4 </span>fastspeed       endp
<span style="color:black">BIOSCODE:0BF4
BIOSCODE:0BF5
BIOSCODE:0BF5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0BF5
BIOSCODE:0BF5
BIOSCODE:0BF5 </span>maperror        proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0BF5                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:0BF6                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:0BF7                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:0BF8                 </span><span style="color:navy">pop     es              </span>; set es=Bios_Data
<span style="color:black">BIOSCODE:0BF9                 </span><span style="color:navy">mov     al, ah
</span><span style="color:black">BIOSCODE:0BFB                 </span><span style="color:navy">mov     ds:</span>lsterr<span style="color:navy">, al   </span>; terminate list with error code
<span style="color:black">BIOSCODE:0BFE                 </span><span style="color:navy">mov     cx, </span><span style="color:green">9           </span>; numerr (= errout-errin)
<span style="color:black">BIOSCODE:0BFE                                         </span>; number of possible error conditions
<span style="color:black">BIOSCODE:0C01                 </span><span style="color:navy">mov     di, offset </span>errin
<span style="color:black">BIOSCODE:0C04                 </span><span style="color:navy">repne scasb
</span><span style="color:black">BIOSCODE:0C06                 </span><span style="color:navy">mov     al, [di+</span><span style="color:green">8</span><span style="color:navy">]      </span>; [di+numerr-1]
<span style="color:black">BIOSCODE:0C06                                         </span>; get translation
<span style="color:black">BIOSCODE:0C0A                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:0C0B                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:0C0C                 </span><span style="color:navy">stc                     </span>; flag error condition
<span style="color:black">BIOSCODE:0C0D                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0C0D </span>maperror        endp
<span style="color:black">BIOSCODE:0C0D
BIOSCODE:0C0E
BIOSCODE:0C0E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0C0E
BIOSCODE:0C0E
BIOSCODE:0C0E </span>set_tim         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0C0E                 </span><span style="color:navy">push    ax              </span>; set the time of last access for this drive.
<span style="color:black">BIOSCODE:0C0E                                         </span>; this is done only for removable media.
<span style="color:black">BIOSCODE:0C0E                                         </span>; es:di -&gt; bds
<span style="color:black">BIOSCODE:0C0F                 </span><span style="color:navy">call    </span>GetTickCnt      ; Does INT 1A ah=0 &amp; updates daycnt
<span style="color:black">BIOSCODE:0C12                 </span><span style="color:navy">cmp     dx, es:[di+</span><span style="color:#ff8000">47h</span><span style="color:navy">] </span>; [es:di+BDS.tim_lo]
<span style="color:black">BIOSCODE:0C16                 </span><span style="color:navy">jnz     short </span><span style="color:gray">setaccess
</span><span style="color:black">BIOSCODE:0C18                 </span><span style="color:navy">cmp     cx, es:[di+</span><span style="color:#ff8000">49h</span><span style="color:navy">]
</span><span style="color:black">BIOSCODE:0C1C                 </span><span style="color:navy">jz      short </span><span style="color:gray">done_set
</span><span style="color:black">BIOSCODE:0C1E
BIOSCODE:0C1E </span><span style="color:gray">setaccess</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0C1E                 </span><span style="color:navy">mov     ds:</span>accesscount<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; the time has passed
<span style="color:black">BIOSCODE:0C1E                                         </span>; reset the threshold counter
<span style="color:black">BIOSCODE:0C23                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">47h</span><span style="color:navy">], dx
</span><span style="color:black">BIOSCODE:0C27                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">49h</span><span style="color:navy">], cx
</span><span style="color:black">BIOSCODE:0C2B
BIOSCODE:0C2B </span><span style="color:gray">done_set</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0C2B                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:0C2C                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:0C2D                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0C2D </span>set_tim         endp
<span style="color:black">BIOSCODE:0C2D
BIOSCODE:0C2E
BIOSCODE:0C2E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0C2E
BIOSCODE:0C2E
BIOSCODE:0C2E </span>again           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0C2E                 </span><span style="color:navy">call    </span>resetdisk
<span style="color:black">BIOSCODE:0C31                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">6           </span>; If it is a media change error
<span style="color:black">BIOSCODE:0C31                                         </span>; do not decrement retry count
<span style="color:black">BIOSCODE:0C34                 </span><span style="color:navy">jz      short </span><span style="color:gray">dont_dec_retry_count
</span><span style="color:black">BIOSCODE:0C36                 </span><span style="color:navy">dec     bp              </span>; decrement retry count
<span style="color:black">BIOSCODE:0C37                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0C38 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0C38
BIOSCODE:0C38 </span><span style="color:gray">dont_dec_retry_count</span><span style="color:navy">:                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0C38                 </span><span style="color:navy">or      ah, ah
</span><span style="color:black">BIOSCODE:0C3A                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0C3A </span>again           endp
<span style="color:black">BIOSCODE:0C3A
BIOSCODE:0C3A </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSCODE:0C3B                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">BIOSCODE:0C3C </span>IoReadJumpTable <span style="color:navy">db </span><span style="color:#008040">8                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSCODE:0C3D                 </span><span style="color:navy">dw offset </span>GetDeviceParameters ; 60h
<span style="color:gray">BIOSCODE:0C3F                 </span><span style="color:navy">dw offset </span>ReadTrack     ; 61h
<span style="color:gray">BIOSCODE:0C41                 </span><span style="color:navy">dw offset </span>VerifyTrack   ; 62h
<span style="color:gray">BIOSCODE:0C43                 </span><span style="color:navy">dw offset </span>Cmd_Error_Proc ; 63h
<span style="color:gray">BIOSCODE:0C45                 </span><span style="color:navy">dw offset </span>Cmd_Error_Proc ; 64h
<span style="color:gray">BIOSCODE:0C47                 </span><span style="color:navy">dw offset </span>Cmd_Error_Proc ; 65h
<span style="color:gray">BIOSCODE:0C49                 </span><span style="color:navy">dw offset </span>GetMediaId    ; 66h
<span style="color:gray">BIOSCODE:0C4B                 </span><span style="color:navy">dw offset </span>GetAccessFlag ; 67h
<span style="color:gray">BIOSCODE:0C4D                 </span><span style="color:navy">dw offset </span>SenseMediaType ; 68h
<span style="color:gray">BIOSCODE:0C4F </span>IoWriteJumpTable <span style="color:navy">db </span><span style="color:#008040">7                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSCODE:0C50                 </span><span style="color:navy">dw offset </span>SetDeviceParameters ; 40h
<span style="color:gray">BIOSCODE:0C52                 </span><span style="color:navy">dw offset </span>WriteTrack    ; 41h
<span style="color:gray">BIOSCODE:0C54                 </span><span style="color:navy">dw offset </span>FormatTrack   ; 42h
<span style="color:gray">BIOSCODE:0C56                 </span><span style="color:navy">dw offset </span>Cmd_Error_Proc ; 43h
<span style="color:gray">BIOSCODE:0C58                 </span><span style="color:navy">dw offset </span>Cmd_Error_Proc ; 44h
<span style="color:gray">BIOSCODE:0C5A                 </span><span style="color:navy">dw offset </span>Cmd_Error_Proc ; 45h
<span style="color:gray">BIOSCODE:0C5C                 </span><span style="color:navy">dw offset </span>SetMediaId    ; 46h
<span style="color:gray">BIOSCODE:0C5E                 </span><span style="color:navy">dw offset </span>SetAccessFlag ; 47h
<span style="color:gray">BIOSCODE:0C60 </span>IOC_DC_Table    <span style="color:navy">db </span><span style="color:#008040">60h</span><span style="color:navy">, </span><span style="color:#008040">40h</span><span style="color:navy">, </span><span style="color:#008040">61h</span><span style="color:navy">, </span><span style="color:#008040">41h</span><span style="color:navy">, </span><span style="color:#008040">62h</span><span style="color:navy">, </span><span style="color:#008040">42h</span><span style="color:navy">, </span><span style="color:#008040">66h</span><span style="color:navy">, </span><span style="color:#008040">46h</span><span style="color:navy">, </span><span style="color:#008040">67h</span><span style="color:navy">, </span><span style="color:#008040">47h</span><span style="color:navy">, </span><span style="color:#008040">68h </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0C6B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0C6B
BIOSCODE:0C6B </span>Do_Generic_IOCtl<span style="color:navy">:                       </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0C6B                 </span><span style="color:navy">call    </span>SetDrive        ; es:di points to bds for drive
<span style="color:maroon">BIOSCODE:0C6E                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:0C6F                 </span><span style="color:navy">les     bx, ds:</span><span style="color:green">18       </span>; es:bx points to request header
<span style="color:maroon">BIOSCODE:0C73                 </span><span style="color:navy">cmp     byte ptr es:[bx+</span><span style="color:#ff8000">0Dh</span><span style="color:navy">], </span><span style="color:#ff8000">8 </span>; [es:bx+IOCTL_REQ.MAJORFUNCTION],
<span style="color:maroon">BIOSCODE:0C73                                         </span>; RAWIO
<span style="color:maroon">BIOSCODE:0C78                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:#ff8000">0Eh</span><span style="color:navy">]
</span><span style="color:maroon">BIOSCODE:0C7C                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:0C7D                 </span><span style="color:navy">jnz     short </span>IoctlFuncErr
<span style="color:maroon">BIOSCODE:0C7F                 </span><span style="color:navy">mov     si, offset </span>IoReadJumpTable
<span style="color:maroon">BIOSCODE:0C82                 </span><span style="color:navy">test    al, </span><span style="color:green">20h         </span>; GEN_IOCTL_FN_TST ; test of req. function
<span style="color:maroon">BIOSCODE:0C84                 </span><span style="color:navy">jnz     short </span>NotGenericWrite
<span style="color:maroon">BIOSCODE:0C86                 </span><span style="color:navy">mov     si, offset </span>IoWriteJumpTable
<span style="color:maroon">BIOSCODE:0C89
BIOSCODE:0C89 </span>NotGenericWrite<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0C89                 </span><span style="color:navy">and     al, </span><span style="color:green">0DFh        </span>; ~GEN_IOCTL_FN_TST ; get rid of read/write bit
<span style="color:maroon">BIOSCODE:0C8B                 </span><span style="color:navy">sub     al, </span><span style="color:green">40h         </span>; offset for base function
<span style="color:maroon">BIOSCODE:0C8D                 </span><span style="color:navy">cmp     al, cs:[si]
</span><span style="color:maroon">BIOSCODE:0C90                 </span><span style="color:navy">ja      short </span>IoctlFuncErr
<span style="color:maroon">BIOSCODE:0C92                 </span><span style="color:navy">cbw
</span><span style="color:maroon">BIOSCODE:0C93                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:0C95                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">BIOSCODE:0C96                 </span><span style="color:navy">add     si, ax
</span><span style="color:maroon">BIOSCODE:0C98                 </span><span style="color:navy">call    word ptr cs:[si]
</span><span style="color:maroon">BIOSCODE:0C9B                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:0CA0                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0CA0                 </span><span style="color:navy">mov     ah, </span><span style="color:green">81h         </span>; Return this status in case of carry
<span style="color:maroon">BIOSCODE:0CA2                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0CA3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0CA3
BIOSCODE:0CA3 </span>Cmd_Error_Proc<span style="color:navy">:                         </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0CA3                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSCODE:0CA4
BIOSCODE:0CA4 </span>IoctlFuncErr<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0CA4                 </span><span style="color:navy">jmp     </span>bc_cmderr
<span style="color:maroon">BIOSCODE:0CA7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0CA7
BIOSCODE:0CA7 </span>GetDeviceParameters<span style="color:navy">:                    </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0CA7                 </span><span style="color:navy">lds     bx, ds:</span>ptrsav   ; ds:bx points to request header
<span style="color:maroon">BIOSCODE:0CAB                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0CAB                 </span><span style="color:navy">lds     bx, [bx+</span><span style="color:#ff8000">13h</span><span style="color:navy">]    </span>; [bx+IOCTL_REQ.GENERICIOCTL_PACKET]
<span style="color:maroon">BIOSCODE:0CAB                                         </span>; (ds:bx) = return buffer
<span style="color:maroon">BIOSCODE:0CAE                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">] </span>; [es:di+BDS.formfactor]
<span style="color:maroon">BIOSCODE:0CB2                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">1</span><span style="color:navy">], al      </span>; [bx+A_DEVICEPARAMETERS.DP_DEVICETYPE]
<span style="color:maroon">BIOSCODE:0CB5                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">] </span>; [es:di+BDS.flags]
<span style="color:maroon">BIOSCODE:0CB9                 </span><span style="color:navy">and     ax, </span><span style="color:green">3           </span>; fnon_removable+fchangeline
<span style="color:maroon">BIOSCODE:0CB9                                         </span>; Mask off other bits
<span style="color:maroon">BIOSCODE:0CBC                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">2</span><span style="color:navy">], ax      </span>; [bx+A_DEVICEPARAMETERS.DP_DEVICEATTRIBUTES]
<span style="color:maroon">BIOSCODE:0CBF                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:#ff8000">25h</span><span style="color:navy">] </span>; [es:di+BDS.cylinders]
<span style="color:maroon">BIOSCODE:0CC3                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">4</span><span style="color:navy">], ax      </span>; [bx+A_DEVICEPARAMETERS.DP_CYLINDERS]
<span style="color:maroon">BIOSCODE:0CC6                 </span><span style="color:navy">xor     al, al          </span>; Set media type to default
<span style="color:maroon">BIOSCODE:0CC8                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], al      </span>; [bx+A_DEVICEPARAMETERS.DP_MEDIATYPE]
<span style="color:maroon">BIOSCODE:0CCB                 </span><span style="color:navy">lea     si, [di+</span><span style="color:#ff8000">27h</span><span style="color:navy">]    </span>; [di+BDS.rbytespersec] = [di+BDS.R_BPB]
<span style="color:maroon">BIOSCODE:0CCB                                         </span>; (copy recommended bpb)
<span style="color:maroon">BIOSCODE:0CCE                 </span><span style="color:navy">test    byte ptr [bx], </span><span style="color:green">1 </span>; [bx+A_DEVICEPARAMETERS.DP_SPECIALFUNCTIONS],
<span style="color:maroon">BIOSCODE:0CCE                                         </span>; BUILD_DEVICE_BPB
<span style="color:maroon">BIOSCODE:0CD1                 </span><span style="color:navy">jz      short </span>UseBpbPresent ; Point back to BIOSDATA
<span style="color:maroon">BIOSCODE:0CD3                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:0CD4                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word ; Point back to BIOSDATA
<span style="color:maroon">BIOSCODE:0CD9                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0CD9                 </span><span style="color:navy">call    </span>checksingle
<span style="color:maroon">BIOSCODE:0CDC                 </span><span style="color:navy">call    </span>GetBp           ; Build the bpb from scratch
<span style="color:maroon">BIOSCODE:0CDF                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:0CE0                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0CE0                 </span><span style="color:navy">jb      short </span>GetParmRet
<span style="color:maroon">BIOSCODE:0CE2                 </span><span style="color:navy">lea     si, [di+</span><span style="color:#ff8000">6</span><span style="color:navy">]      </span>; [di+BDS.bytespersec] = [di+BSD.DP_BPB]
<span style="color:maroon">BIOSCODE:0CE2                                         </span>; Use this subfield of bds instead
<span style="color:maroon">BIOSCODE:0CE5
BIOSCODE:0CE5 </span>UseBpbPresent<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0CE5                 </span><span style="color:navy">lea     di, [bx+</span><span style="color:#ff8000">7</span><span style="color:navy">]      </span>; [bx+A_DEVICEPARAMETERS.DP_BPB]
<span style="color:maroon">BIOSCODE:0CE5                                         </span>; This is where the result goes
<span style="color:maroon">BIOSCODE:0CE8                 </span><span style="color:navy">mov     cx, </span><span style="color:green">25          </span>; A_BPB.size - 6
<span style="color:maroon">BIOSCODE:0CE8                                         </span>; For now use &#039;small&#039; bpb
<span style="color:maroon">BIOSCODE:0CEB                 </span><span style="color:navy">push    ds              </span>; reverse segments for copy
<span style="color:maroon">BIOSCODE:0CEC                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:0CED                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:0CEE                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:0CEF                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">BIOSCODE:0CF1                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:0CF2
BIOSCODE:0CF2 </span>GetParmRet<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0CF2                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0CF3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0CF3
BIOSCODE:0CF3 </span>SetDeviceParameters<span style="color:navy">:                    </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0CF3                 </span><span style="color:navy">lds     bx, ds:</span>ptrsav   ; ds:bx points to request header
<span style="color:maroon">BIOSCODE:0CF7                 </span><span style="color:navy">lds     bx, [bx+</span><span style="color:#ff8000">13h</span><span style="color:navy">]    </span>; [bx+IOCTL_REQ.GENERICIOCTL_PACKET]
<span style="color:maroon">BIOSCODE:0CFA                 </span><span style="color:navy">or      word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">140h </span>; [es:di+BDS.flags],
<span style="color:maroon">BIOSCODE:0CFA                                         </span>;  fchanged_by_format|fchanged
<span style="color:maroon">BIOSCODE:0D00                 </span><span style="color:navy">test    byte ptr [bx], </span><span style="color:green">2 </span>; [bx+A_DEVICEPARAMETERS.DP_SPECIALFUNCTIONS],
<span style="color:maroon">BIOSCODE:0D00                                         </span>;  ONLY_SET_TRACKLAYOUT
<span style="color:maroon">BIOSCODE:0D03                 </span><span style="color:navy">jnz     short </span>setTrackTable
<span style="color:maroon">BIOSCODE:0D05                 </span><span style="color:navy">mov     al, [bx+</span><span style="color:#ff8000">1</span><span style="color:navy">]      </span>; [bx+A_DEVICEPARAMETERS.DP_DEVICETYPE]
<span style="color:maroon">BIOSCODE:0D08                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], al </span>; [es:di+BDS.formfactor]
<span style="color:maroon">BIOSCODE:0D0C                 </span><span style="color:navy">mov     ax, [bx+</span><span style="color:#ff8000">4</span><span style="color:navy">]      </span>; [bx+A_DEVICEPARAMETERS.DP_CYLINDERS]
<span style="color:maroon">BIOSCODE:0D0F                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">25h</span><span style="color:navy">], ax </span>; [es:di+BDS.cylinders]
<span style="color:maroon">BIOSCODE:0D13                 </span><span style="color:navy">mov     ax, [bx+</span><span style="color:#ff8000">2</span><span style="color:navy">]      </span>; [bx+A_DEVICEPARAMETERS.DP_DEVICEATTRIBUTES]
<span style="color:maroon">BIOSCODE:0D16                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:0D17                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word ; BIOSDATA segment
<span style="color:maroon">BIOSCODE:0D1C                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0D1C                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:0D21                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:0D22                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0D22                 </span><span style="color:navy">jnz     short </span>HaveChange ; we have changeline support
<span style="color:maroon">BIOSCODE:0D24                 </span><span style="color:navy">and     ax, </span><span style="color:green">0FFFDh
</span><span style="color:maroon">BIOSCODE:0D27
BIOSCODE:0D27 </span>HaveChange<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0D27                 </span><span style="color:navy">and     ax, </span><span style="color:green">3           </span>; Ignore all bits except non_removable and changeline
<span style="color:maroon">BIOSCODE:0D27                                         </span>; fnon_removable|fchangeline
<span style="color:maroon">BIOSCODE:0D2A                 </span><span style="color:navy">mov     cx, es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">] </span>; [es:di+BDS.flags]
<span style="color:maroon">BIOSCODE:0D2E                 </span><span style="color:navy">and     cx, </span><span style="color:green">0FDF4h      </span>; ~(fnon_removable|fchangeline|good_tracklayout|unformatted_media)
<span style="color:maroon">BIOSCODE:0D32                 </span><span style="color:navy">or      ax, cx
</span><span style="color:maroon">BIOSCODE:0D34                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], ax </span>; [es:di+BDS.flags]
<span style="color:maroon">BIOSCODE:0D38                 </span><span style="color:navy">mov     al, [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">]      </span>; [bx+A_DEVICEPARAMETERS.DP_MEDIATYPE]
<span style="color:maroon">BIOSCODE:0D38                                         </span>; Set media type
<span style="color:maroon">BIOSCODE:0D3B                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:0D3C                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:0D41                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0D41                 </span><span style="color:navy">mov     ds:</span>mediatype<span style="color:navy">, al
</span><span style="color:maroon">BIOSCODE:0D44                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:0D45                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0D45                 </span><span style="color:navy">or      word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">80h </span>; [es:di+BDS.flags]
<span style="color:maroon">BIOSCODE:0D45                                         </span>; set_dasd_true (the next time we format a track)
<span style="color:maroon">BIOSCODE:0D4B                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSCODE:0D4C                 </span><span style="color:navy">test    byte ptr [bx], </span><span style="color:green">1 </span>; [bx+A_DEVICEPARAMETERS.DP_SPECIALFUNCTIONS],
<span style="color:maroon">BIOSCODE:0D4C                                         </span>;  INSTALL_FAKE_BPB
<span style="color:maroon">BIOSCODE:0D4F                 </span><span style="color:navy">jnz     short </span>InstallFakeBpb
<span style="color:maroon">BIOSCODE:0D51                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">4 </span>; [es:di+BDS.flags], return_fake_bpb
<span style="color:maroon">BIOSCODE:0D51                                         </span>; were we returning a fake bpb when asked to build a bpb?
<span style="color:maroon">BIOSCODE:0D57                 </span><span style="color:navy">jz      short </span>InstallRecommendedBpb
<span style="color:maroon">BIOSCODE:0D59                 </span><span style="color:navy">and     word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">0FFFBh </span>; [es:di+BDS.flags], ~return_fake_bpb
<span style="color:maroon">BIOSCODE:0D59                                         </span>; we were returning a fake bpb but we can stop now
<span style="color:maroon">BIOSCODE:0D5E
BIOSCODE:0D5E </span>InstallRecommendedBpb<span style="color:navy">:                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0D5E                 </span><span style="color:navy">mov     cx, </span><span style="color:green">31          </span>; A_BPB.size
<span style="color:maroon">BIOSCODE:0D61                 </span><span style="color:navy">lea     di, [di+</span><span style="color:#ff8000">27h</span><span style="color:navy">]    </span>; [di+BDS.R_BPB] = [di+BDS.rbytespersec]
<span style="color:maroon">BIOSCODE:0D64                 </span><span style="color:navy">jmp     short </span>CopyTheBpb
<span style="color:maroon">BIOSCODE:0D66 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0D66
BIOSCODE:0D66 </span>InstallFakeBpb<span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0D66                 </span><span style="color:navy">or      word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">4
</span><span style="color:maroon">BIOSCODE:0D6B                 </span><span style="color:navy">mov     cx, </span><span style="color:green">25          </span>; A_BPB.size - 6
<span style="color:maroon">BIOSCODE:0D6E                 </span><span style="color:navy">lea     di, [di+</span><span style="color:#ff8000">6</span><span style="color:navy">]      </span>; [es:di+BDS.BPB] = [es:di+BDS.bytespersec]
<span style="color:maroon">BIOSCODE:0D71
BIOSCODE:0D71 </span>CopyTheBpb<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0D71                 </span><span style="color:navy">lea     si, [bx+</span><span style="color:#ff8000">7</span><span style="color:navy">]      </span>; [bx+A_DEVICEPARAMETERS.DP_BPB]
<span style="color:maroon">BIOSCODE:0D74                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">BIOSCODE:0D76                 </span><span style="color:navy">push    ds              </span>; Save packet segment
<span style="color:maroon">BIOSCODE:0D77                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word ; BIOSDATA segment
<span style="color:maroon">BIOSCODE:0D7C                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0D7C                 </span><span style="color:navy">call    </span>RestoreOldDpt
<span style="color:maroon">BIOSCODE:0D7F                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:0D80                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0D80                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSCODE:0D81
BIOSCODE:0D81 </span>setTrackTable<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0D81                 </span><span style="color:navy">mov     cx, [bx+</span><span style="color:#ff8000">26h</span><span style="color:navy">]    </span>; [bx+A_DEVICEPARAMETERS.DP_TRACKTABLEENTRIES]
<span style="color:maroon">BIOSCODE:0D81                                         </span>; offset 31+7 (A_BPB.size+7)
<span style="color:maroon">BIOSCODE:0D84                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:0D85                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:0D8A                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0D8A                 </span><span style="color:navy">mov     ds:</span>sectorspertrack<span style="color:navy">, cx
</span><span style="color:maroon">BIOSCODE:0D8E                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:0D8F                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0D8F                 </span><span style="color:navy">and     word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">0FFF7h </span>; [es:di+BDS.flags], ~good_tracklayout
<span style="color:maroon">BIOSCODE:0D94                 </span><span style="color:navy">test    byte ptr [bx], </span><span style="color:green">4 </span>; [bx+A_DEVICEPARAMETERS.DP_SPECIALFUNCTIONS],
<span style="color:maroon">BIOSCODE:0D94                                         </span>;  TRACKLAYOUT_IS_GOOD
<span style="color:maroon">BIOSCODE:0D97                 </span><span style="color:navy">jz      short </span>UglyTrackLayOut
<span style="color:maroon">BIOSCODE:0D99                 </span><span style="color:navy">or      word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">8 </span>; [es:di+BDS.flags], good_tracklayout
<span style="color:maroon">BIOSCODE:0D9E
BIOSCODE:0D9E </span>UglyTrackLayOut<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0D9E                 </span><span style="color:navy">cmp     cx, </span><span style="color:green">63          </span>; MAX_SECTORS_IN_TRACK
<span style="color:maroon">BIOSCODE:0DA1                 </span><span style="color:navy">ja      short </span>TooManyPerTrack
<span style="color:maroon">BIOSCODE:0DA3                 </span><span style="color:navy">jcxz    short </span>SectorInfoSaved
<span style="color:maroon">BIOSCODE:0DA5                 </span><span style="color:navy">mov     di, offset </span>tracktable
<span style="color:maroon">BIOSCODE:0DA8                 </span><span style="color:navy">lea     si, [bx+</span><span style="color:#ff8000">28h</span><span style="color:navy">]    </span>; [bx+A_DEVICEPARAMETERS.DP_SECTORTABLE]
<span style="color:maroon">BIOSCODE:0DA8                                         </span>; offset 31+9 (A_BPB.size+9)
<span style="color:maroon">BIOSCODE:0DAB                 </span><span style="color:navy">mov     es, cs:</span>Bios_Data_Word ; BIOSDATA segment
<span style="color:maroon">BIOSCODE:0DAB                                         </span>; Trash our bds pointer
<span style="color:maroon">BIOSCODE:0DB0                 </span>assume es:nothing
<span style="color:maroon">BIOSCODE:0DB0
BIOSCODE:0DB0 </span>StoreSectorInfo<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0DB0                 </span><span style="color:navy">inc     di
</span><span style="color:maroon">BIOSCODE:0DB1                 </span><span style="color:navy">inc     di              </span>; Skip over cylinder and head
<span style="color:maroon">BIOSCODE:0DB2                 </span><span style="color:navy">lodsw                   </span>; Get sector id
<span style="color:maroon">BIOSCODE:0DB3                 </span><span style="color:navy">stosb                   </span>; Copy it
<span style="color:maroon">BIOSCODE:0DB4                 </span><span style="color:navy">lodsw                   </span>; Get sector size
<span style="color:maroon">BIOSCODE:0DB5                 </span><span style="color:navy">call    </span>SectSizeToSectIndex ; SectSizeToSectIndex:
<span style="color:maroon">BIOSCODE:0DB5                                         </span>;      Input:  ax contains sector size in bytes
<span style="color:maroon">BIOSCODE:0DB5                                         </span>;      Output: al contains index
<span style="color:maroon">BIOSCODE:0DB8                 </span><span style="color:navy">stosb
</span><span style="color:maroon">BIOSCODE:0DB9                 </span><span style="color:navy">loop    </span>StoreSectorInfo
<span style="color:maroon">BIOSCODE:0DBB
BIOSCODE:0DBB </span>SectorInfoSaved<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0DBB                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:0DBC                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0DBD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0DBD
BIOSCODE:0DBD </span>TooManyPerTrack<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0DBD                 </span><span style="color:navy">mov     al, </span><span style="color:green">0Ch
</span><span style="color:maroon">BIOSCODE:0DBF                 </span><span style="color:navy">stc
</span><span style="color:maroon">BIOSCODE:0DC0                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0DC1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0DC1
BIOSCODE:0DC1 </span>FormatTrack<span style="color:navy">:                            </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0DC1                 </span><span style="color:navy">lds     bx, ds:</span>ptrsav
<span style="color:maroon">BIOSCODE:0DC5                 </span><span style="color:navy">lds     bx, [bx+</span><span style="color:#ff8000">13h</span><span style="color:navy">]    </span>; [bx+IOCTL_REQ.GENERICIOCTL_PACKET]
<span style="color:maroon">BIOSCODE:0DC8                 </span><span style="color:navy">test    byte ptr [bx], </span><span style="color:green">1 </span>; bx+A_DEVICEPARAMETERS.DP_SPECIALFUNCTIONS],
<span style="color:maroon">BIOSCODE:0DC8                                         </span>;  STATUS_FOR_FORMAT
<span style="color:maroon">BIOSCODE:0DCB                 </span><span style="color:navy">jz      short </span>DoFormatTrack
<span style="color:maroon">BIOSCODE:0DCD                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:0DCE                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:0DD3                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0DD3                 </span><span style="color:navy">call    </span>SetMediaForFormat ; Also moves current Dpt to TempDpt
<span style="color:maroon">BIOSCODE:0DD6                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:0DD7                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0DD7                 </span><span style="color:navy">mov     [bx], al        </span>; [bx+A_DEVICEPARAMETERS.DP_SPECIALFUNCTIONS]
<span style="color:maroon">BIOSCODE:0DD9                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:0DDA                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0DDB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0DDB
BIOSCODE:0DDB </span>DoFormatTrack<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0DDB                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], </span><span style="color:#ff8000">5 </span>; [es:di+BDS.formfactor], DEV_HARDDISK
<span style="color:maroon">BIOSCODE:0DE0                 </span><span style="color:navy">jnz     short </span>DoFormatDiskette
<span style="color:maroon">BIOSCODE:0DE2                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:0DE7                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0DE7                 </span><span style="color:navy">jmp     </span>VerifyTrack
<span style="color:maroon">BIOSCODE:0DEA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0DEA
BIOSCODE:0DEA </span>DoFormatDiskette<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0DEA                 </span><span style="color:navy">mov     cx, [bx+</span><span style="color:#ff8000">1</span><span style="color:navy">]      </span>; [bx+A_FORMATPACKET.FP_HEAD]
<span style="color:maroon">BIOSCODE:0DED                 </span><span style="color:navy">mov     dx, [bx+</span><span style="color:#ff8000">3</span><span style="color:navy">]      </span>; [bx+A_FORMATPACKET.FP_CYLINDER]
<span style="color:maroon">BIOSCODE:0DF0                 </span><span style="color:navy">test    byte ptr [bx], </span><span style="color:green">2 </span>; [bx+A_FORMATPACKET.FP_SPECIALFUNCTIONS]
<span style="color:maroon">BIOSCODE:0DF0                                         </span>;     FP_TRACKCOUNT is only meaningful
<span style="color:maroon">BIOSCODE:0DF0                                         </span>;     when FP_SPECIALFUNCTIONS bit 1 = 1
<span style="color:maroon">BIOSCODE:0DF3                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:0DF8                 </span><span style="color:navy">jz      short </span>DoFormatDiskette_1
<span style="color:maroon">BIOSCODE:0DFA                 </span><span style="color:navy">jmp     </span>VerifyTrack_Err
<span style="color:maroon">BIOSCODE:0DFD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0DFD
BIOSCODE:0DFD </span>DoFormatDiskette_1<span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0DFD                 </span><span style="color:navy">call    </span>SetMediaForFormat ; Also moves current Dpt to TempDpt
<span style="color:maroon">BIOSCODE:0E00                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:0E02                 </span><span style="color:navy">jz      short </span>NeedToSetDasd ; Old rom
<span style="color:maroon">BIOSCODE:0E04                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3           </span>; Time out error?
<span style="color:maroon">BIOSCODE:0E06                 </span><span style="color:navy">jnz     short </span>NoSetDasd ; No,fine. (at this point, don&#039;t care
<span style="color:maroon">BIOSCODE:0E06                                         </span>; about the illegal combination)
<span style="color:maroon">BIOSCODE:0E08                 </span><span style="color:navy">jmp     short </span>FormatFailed
<span style="color:maroon">BIOSCODE:0E0A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0E0A
BIOSCODE:0E0A </span>NeedToSetDasd<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0E0A                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">BIOSCODE:0E0B                 </span><span style="color:navy">call    </span>SetDasd         ; INT 13h, ah=17h
<span style="color:maroon">BIOSCODE:0E0E                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSCODE:0E0F
BIOSCODE:0E0F </span>NoSetDasd<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0E0F                 </span><span style="color:navy">call    </span>checksingle     ; Do any needed diskette swapping
<span style="color:maroon">BIOSCODE:0E12                 </span><span style="color:navy">mov     ax, dx          </span>; Get track from packet
<span style="color:maroon">BIOSCODE:0E14                 </span><span style="color:navy">mov     ds:</span>trknum<span style="color:navy">, ax
</span><span style="color:maroon">BIOSCODE:0E17                 </span><span style="color:navy">mov     ds:</span>hdnum<span style="color:navy">, cl
</span><span style="color:maroon">BIOSCODE:0E1B                 </span><span style="color:navy">mov     ah, cl
</span><span style="color:maroon">BIOSCODE:0E1D                 </span><span style="color:navy">mov     bx, offset </span>tracktable
<span style="color:maroon">BIOSCODE:0E20                 </span><span style="color:navy">mov     cx, ds:</span>sectorspertrack
<span style="color:maroon">BIOSCODE:0E24
BIOSCODE:0E24 </span>StoreCylinderHead<span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0E24                 </span><span style="color:navy">mov     [bx], ax        </span>; Store into TrackTable
<span style="color:maroon">BIOSCODE:0E26                 </span><span style="color:navy">add     bx, </span><span style="color:#ff8000">4           </span>; Skip to next sector field
<span style="color:maroon">BIOSCODE:0E29                 </span><span style="color:navy">loop    </span>StoreCylinderHead
<span style="color:maroon">BIOSCODE:0E2B                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">5           </span>; MAXERR - Set up retry count
<span style="color:maroon">BIOSCODE:0E2E
BIOSCODE:0E2E </span>FormatRetry<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0E2E                 </span><span style="color:navy">push    cx              </span>; Now verify the sectors just formatted.
<span style="color:maroon">BIOSCODE:0E2E                                         </span>; NOTE: because of bug in some BIOSes
<span style="color:maroon">BIOSCODE:0E2E                                         </span>;       we have to set ES:BX to 00:00
<span style="color:maroon">BIOSCODE:0E2F                 </span><span style="color:navy">mov     bx, offset </span>tracktable
<span style="color:maroon">BIOSCODE:0E32                 </span><span style="color:navy">mov     al, byte ptr ds:</span>sectorspertrack
<span style="color:maroon">BIOSCODE:0E35                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">5
</span><span style="color:maroon">BIOSCODE:0E37                 </span><span style="color:navy">mov     ds:</span>xfer_seg<span style="color:navy">, ds
</span><span style="color:maroon">BIOSCODE:0E3B                 </span><span style="color:navy">call    </span>ToRom
<span style="color:maroon">BIOSCODE:0E3E                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSCODE:0E3F                 </span><span style="color:navy">jb      short </span>FormatError
<span style="color:maroon">BIOSCODE:0E41                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSCODE:0E42                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:0E43                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:maroon">BIOSCODE:0E45                 </span><span style="color:navy">mov     ds:</span>xfer_seg<span style="color:navy">, bx
</span><span style="color:maroon">BIOSCODE:0E49                 </span><span style="color:navy">mov     al, byte ptr ds:</span>sectorspertrack
<span style="color:maroon">BIOSCODE:0E4C                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">4
</span><span style="color:maroon">BIOSCODE:0E4E                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:0E50                 </span><span style="color:navy">call    </span>ToRom
<span style="color:maroon">BIOSCODE:0E53                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:0E54                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSCODE:0E55                 </span><span style="color:navy">jnb     short </span>FormatOk
<span style="color:maroon">BIOSCODE:0E57
BIOSCODE:0E57 </span>FormatError<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0E57                 </span><span style="color:navy">call    </span>resetdisk
<span style="color:maroon">BIOSCODE:0E5A                 </span><span style="color:navy">mov     ds:</span>had_format_error<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:0E5F                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSCODE:0E60                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSCODE:0E61                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">BIOSCODE:0E62                 </span><span style="color:navy">call    </span>SetMediaForFormat
<span style="color:maroon">BIOSCODE:0E65                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:0E67                 </span><span style="color:navy">jnz     short </span>WhileErr
<span style="color:maroon">BIOSCODE:0E69                 </span><span style="color:navy">call    </span>SetDasd
<span style="color:maroon">BIOSCODE:0E6C
BIOSCODE:0E6C </span>WhileErr<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0E6C                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSCODE:0E6D                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSCODE:0E6E                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSCODE:0E6F                 </span><span style="color:navy">loop    </span>FormatRetry
<span style="color:maroon">BIOSCODE:0E71
BIOSCODE:0E71 </span>FormatFailed<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0E71                 </span><span style="color:navy">mov     ds:</span>had_format_error<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:0E76                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">6           </span>; DSK_CHANGELINE_ERR
<span style="color:maroon">BIOSCODE:0E76                                         </span>; convert change line error to time out error
<span style="color:maroon">BIOSCODE:0E79                 </span><span style="color:navy">jnz     short </span>DoMapIt
<span style="color:maroon">BIOSCODE:0E7B                 </span><span style="color:navy">mov     ah, </span><span style="color:green">80h         </span>; DSK_TIMEOUT_ERR
<span style="color:maroon">BIOSCODE:0E7D
BIOSCODE:0E7D </span>DoMapIt<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0E7D                 </span><span style="color:navy">jmp     </span>maperror
<span style="color:maroon">BIOSCODE:0E80 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0E80
BIOSCODE:0E80 </span>FormatOk<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0E80                 </span><span style="color:navy">mov     ds:</span>had_format_error<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; reset the format error flag
<span style="color:maroon">BIOSCODE:0E85                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0E86 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0E86
BIOSCODE:0E86 </span>VerifyTrack<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0E86                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:0E87                 </span><span style="color:navy">lds     bx, ds:</span>ptrsav   ; ds:bx points to request header.
<span style="color:maroon">BIOSCODE:0E8B                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:0E8B                 </span><span style="color:navy">lds     bx, [bx+</span><span style="color:#ff8000">13h</span><span style="color:navy">]    </span>; [bx+IOCTL_REQ.GENERICIOCTL_PACKET]
<span style="color:maroon">BIOSCODE:0E8E                 </span><span style="color:navy">mov     cx, [bx+</span><span style="color:#ff8000">3</span><span style="color:navy">]      </span>; [bx+A_VERIFYPACKET.VP_CYLINDER]
<span style="color:maroon">BIOSCODE:0E91                 </span><span style="color:navy">mov     ax, [bx+</span><span style="color:#ff8000">1</span><span style="color:navy">]      </span>; [bx+A_VERIFYPACKET.VP_HEAD]
<span style="color:maroon">BIOSCODE:0E94                 </span><span style="color:navy">mov     dx, [bx+</span><span style="color:#ff8000">5</span><span style="color:navy">]      </span>; [bx+A_FORMATPACKET.FP_TRACKCOUNT]
<span style="color:maroon">BIOSCODE:0E97                 </span><span style="color:navy">mov     bl, [bx]        </span>; [bx+A_FORMATPACKET.FP_SPECIALFUNCTIONS]
<span style="color:maroon">BIOSCODE:0E99                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:0E9A                 </span><span style="color:navy">mov     ds:</span>rflag<span style="color:navy">, </span><span style="color:#ff8000">4     </span>; romverify
<span style="color:maroon">BIOSCODE:0E9F                 </span><span style="color:navy">mov     ds:</span>curtrk<span style="color:navy">, cx
</span><span style="color:maroon">BIOSCODE:0EA3                 </span><span style="color:navy">mov     ds:</span>curhd<span style="color:navy">, al    </span>; assume heads &lt; 256
<span style="color:maroon">BIOSCODE:0EA6                 </span><span style="color:navy">mov     cx, ds:</span>sectorspertrack
<span style="color:maroon">BIOSCODE:0EAA                 </span><span style="color:navy">test    bl, </span><span style="color:green">2           </span>; DO_FAST_FORMAT
<span style="color:maroon">BIOSCODE:0EAD                 </span><span style="color:navy">jz      short </span>NormVerifyTrack
<span style="color:maroon">BIOSCODE:0EAF                 </span><span style="color:navy">mov     ax, dx          </span>; Get ax = number of trks to verify
<span style="color:maroon">BIOSCODE:0EB1                 </span><span style="color:navy">or      ah, ah
</span><span style="color:maroon">BIOSCODE:0EB3                 </span><span style="color:navy">jnz     short </span>VerifyTrack_Err ; #tracks &gt; 255
<span style="color:maroon">BIOSCODE:0EB5                 </span><span style="color:navy">mul     cl
</span><span style="color:maroon">BIOSCODE:0EB7                 </span><span style="color:navy">or      ah, ah
</span><span style="color:maroon">BIOSCODE:0EB9                 </span><span style="color:navy">jnz     short </span>VerifyTrack_Err
<span style="color:maroon">BIOSCODE:0EBB                 </span><span style="color:navy">mov     cx, ax
</span><span style="color:maroon">BIOSCODE:0EBD                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:maroon">BIOSCODE:0EC3                 </span><span style="color:navy">jz      short </span>NormVerifyTrack
<span style="color:maroon">BIOSCODE:0EC5                 </span><span style="color:navy">test    ds:</span>multrk_flag<span style="color:navy">, </span><span style="color:green">80h </span>; MULTI_TRK_ON
<span style="color:maroon">BIOSCODE:0ECB                 </span><span style="color:navy">jz      short </span>NormVerifyTrack
<span style="color:maroon">BIOSCODE:0ECD                 </span><span style="color:navy">mov     ds:</span>multitrk_format_flag<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:0ED2
BIOSCODE:0ED2 </span>NormVerifyTrack<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0ED2                 </span><span style="color:navy">xor     ax, ax          </span>; 1st sector
<span style="color:maroon">BIOSCODE:0ED4                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:maroon">BIOSCODE:0ED6                 </span><span style="color:navy">mov     ds:</span>xfer_seg<span style="color:navy">, bx </span>; Use 0:0 as the transfer address for verify
<span style="color:maroon">BIOSCODE:0EDA                 </span><span style="color:navy">call    </span>TrackIo
<span style="color:maroon">BIOSCODE:0EDD                 </span><span style="color:navy">mov     ds:</span>multitrk_format_flag<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:0EE2                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:0EE3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0EE3
BIOSCODE:0EE3 </span>VerifyTrack_Err<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0EE3                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:0EE5                 </span><span style="color:navy">jmp     </span>maperror
<span style="color:maroon">BIOSCODE:0EE8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0EE8
BIOSCODE:0EE8 </span>ReadTrack<span style="color:navy">:                              </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0EE8                 </span><span style="color:navy">mov     ds:</span>rflag<span style="color:navy">, </span><span style="color:#ff8000">2     </span>; romread
<span style="color:maroon">BIOSCODE:0EED                 </span><span style="color:navy">jmp     short </span>ReadWriteTrack
<span style="color:maroon">BIOSCODE:0EEF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:0EEF
BIOSCODE:0EEF </span>WriteTrack<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:0EEF                 </span><span style="color:navy">mov     ds:</span>rflag<span style="color:navy">, </span><span style="color:#ff8000">3
</span><span style="color:maroon">BIOSCODE:0EF4
BIOSCODE:0EF4 </span>ReadWriteTrack<span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:0EF4                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:0EF5                 </span><span style="color:navy">les     bx, ds:</span>ptrsav   ; es:bx -&gt; to request header
<span style="color:maroon">BIOSCODE:0EF9                 </span>assume es:nothing
<span style="color:maroon">BIOSCODE:0EF9                 </span><span style="color:navy">les     bx, es:[bx+</span><span style="color:#ff8000">13h</span><span style="color:navy">] </span>; [es:bx+IOCTL_REQ.GENERICIOCTL_PACKET]
<span style="color:maroon">BIOSCODE:0EFD                 </span><span style="color:navy">mov     ax, es:[bx+</span><span style="color:#ff8000">3</span><span style="color:navy">]   </span>; [es:bx+A_TRACKREADWRITEPACKET.TRWP_CYLINDER]
<span style="color:maroon">BIOSCODE:0F01                 </span><span style="color:navy">mov     ds:</span>curtrk<span style="color:navy">, ax
</span><span style="color:maroon">BIOSCODE:0F04                 </span><span style="color:navy">mov     ax, es:[bx+</span><span style="color:#ff8000">1</span><span style="color:navy">]   </span>; [es:bx+A_TRACKREADWRITEPACKET.TRWP_HEAD]
<span style="color:maroon">BIOSCODE:0F08                 </span><span style="color:navy">mov     ds:</span>curhd<span style="color:navy">, al    </span>; Assume heads &lt; 256 !
<span style="color:maroon">BIOSCODE:0F0B                 </span><span style="color:navy">mov     ax, es:[bx+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; [es:bx+A_TRACKREADWRITEPACKET.TRWP_FIRSTSECTOR]
<span style="color:maroon">BIOSCODE:0F0F                 </span><span style="color:navy">mov     cx, es:[bx+</span><span style="color:#ff8000">7</span><span style="color:navy">]   </span>; [es:bx+A_TRACKREADWRITEPACKET.TRWP_SECTORSTOREADWRITE]
<span style="color:maroon">BIOSCODE:0F13                 </span><span style="color:navy">les     bx, es:[bx+</span><span style="color:#ff8000">9</span><span style="color:navy">]   </span>; [es:bx+A_TRACKREADWRITEPACKET.TRWP_TRANSFERADDRESS]
<span style="color:maroon">BIOSCODE:0F13                                         </span>; Get transfer address
<span style="color:maroon">BIOSCODE:0F17                 </span><span style="color:navy">mov     ds:</span>xfer_seg<span style="color:navy">, es </span>; Pass transfer segment
<span style="color:maroon">BIOSCODE:0F1B                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:0F1C
BIOSCODE:0F1C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0F1C
BIOSCODE:0F1C
BIOSCODE:0F1C </span>TrackIo         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0F1C                 </span><span style="color:navy">mov     ds:</span>spsav<span style="color:navy">, sp    </span>; performs track read/write/verify
<span style="color:black">BIOSCODE:0F1C                                         </span>;
<span style="color:black">BIOSCODE:0F1C                                         </span>;  input:
<span style="color:black">BIOSCODE:0F1C                                         </span>;   rFlag - 2 = read
<span style="color:black">BIOSCODE:0F1C                                         </span>;           3 = write
<span style="color:black">BIOSCODE:0F1C                                         </span>;           4 = verify
<span style="color:black">BIOSCODE:0F1C                                         </span>;   ax - Index into track table of first sector to io
<span style="color:black">BIOSCODE:0F1C                                         </span>;   cx - Number of sectors to io
<span style="color:black">BIOSCODE:0F1C                                         </span>;   Xfer_Seg:bx - Transfer address
<span style="color:black">BIOSCODE:0F1C                                         </span>;   es:di - Pointer to bds
<span style="color:black">BIOSCODE:0F1C                                         </span>;   CurTrk - Current cylinder
<span style="color:black">BIOSCODE:0F1C                                         </span>;   CurHd - Current head
<span style="color:black">BIOSCODE:0F20                 </span><span style="color:navy">call    </span>checksingle
<span style="color:black">BIOSCODE:0F23                 </span><span style="color:navy">cmp     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; See if we have already set disk
<span style="color:black">BIOSCODE:0F28                 </span><span style="color:navy">jz      short </span><span style="color:gray">Dptalreadyset
</span><span style="color:black">BIOSCODE:0F2A                 </span><span style="color:navy">push    ax              </span>; set up tables and variables for i/o
<span style="color:black">BIOSCODE:0F2B                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:0F2C                 </span><span style="color:navy">call    </span>iosetup
<span style="color:black">BIOSCODE:0F2F                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:0F30                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:0F31
BIOSCODE:0F31 </span><span style="color:gray">Dptalreadyset</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0F31                 </span><span style="color:navy">mov     si, offset </span>tracktable ; Point si at the table entry of the
<span style="color:black">BIOSCODE:0F31                                         </span>; first sector to be io&#039;d
<span style="color:black">BIOSCODE:0F34                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:0F36                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:0F38                 </span><span style="color:navy">add     si, ax
</span><span style="color:black">BIOSCODE:0F3A                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:0F3D                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">8 </span>; [es:di+BDS.flags], good_tracklayout
<span style="color:black">BIOSCODE:0F43                 </span><span style="color:navy">jz      short </span><span style="color:gray">IoNextSector
</span><span style="color:black">BIOSCODE:0F45                 </span><span style="color:navy">xchg    dx, cx          </span>; We can read all secs in one blow
<span style="color:black">BIOSCODE:0F47
BIOSCODE:0F47 </span><span style="color:gray">IoNextSector</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0F47                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:0F48                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSCODE:0F49                 </span><span style="color:navy">inc     si
</span><span style="color:black">BIOSCODE:0F4A                 </span><span style="color:navy">inc     si              </span>; Skip over the cylinder and head in
<span style="color:black">BIOSCODE:0F4A                                         </span>; the track table
<span style="color:black">BIOSCODE:0F4B                 </span><span style="color:navy">lodsb                   </span>; Get sector ID from track table
<span style="color:black">BIOSCODE:0F4C                 </span><span style="color:navy">mov     ds:</span>cursec<span style="color:navy">, al
</span><span style="color:black">BIOSCODE:0F4F                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:black">BIOSCODE:0F4F                                         </span>; Fixed disk?
<span style="color:black">BIOSCODE:0F55                 </span><span style="color:navy">jz      short </span><span style="color:gray">IoRemovable </span>; No
<span style="color:black">BIOSCODE:0F57                 </span><span style="color:navy">test    ds:</span>multrk_flag<span style="color:navy">, </span><span style="color:green">80h </span>; MULTI_TRK_ON
<span style="color:black">BIOSCODE:0F5D                 </span><span style="color:navy">jz      short </span><span style="color:gray">IoRemovable </span>; No,don&#039;t do that.
<span style="color:black">BIOSCODE:0F5F                 </span><span style="color:navy">mov     ds:</span>seccnt<span style="color:navy">, dx
</span><span style="color:black">BIOSCODE:0F63                 </span><span style="color:navy">mov     ax, dx
</span><span style="color:black">BIOSCODE:0F65                 </span><span style="color:navy">call    </span>disk
<span style="color:black">BIOSCODE:0F68                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSCODE:0F69                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:0F6A                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:0F6B                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0F6C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0F6C
BIOSCODE:0F6C </span><span style="color:gray">IoRemovable</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0F6C                 </span><span style="color:navy">lodsb                   </span>; Get sector size index from track
<span style="color:black">BIOSCODE:0F6C                                         </span>; table and save it
<span style="color:black">BIOSCODE:0F6D                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:0F6E                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSCODE:0F6F                 </span><span style="color:navy">push    ds              </span>; Save BIOSDATA
<span style="color:black">BIOSCODE:0F70                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:0F71                 </span><span style="color:navy">mov     ah, ds:</span>eot      ; Preserve whatever might be in ah
<span style="color:black">BIOSCODE:0F71                                         </span>; Fetch EOT while ds-&gt; BIOSDATA
<span style="color:black">BIOSCODE:0F75                 </span><span style="color:navy">lds     si, ds:</span>dpt
<span style="color:black">BIOSCODE:0F79                 </span><span style="color:navy">mov     [si+</span><span style="color:#ff8000">3</span><span style="color:navy">], al      </span>; [si+DISK_PARMS.DISK_SECTOR_SIZ]
<span style="color:black">BIOSCODE:0F7C                 </span><span style="color:navy">mov     [si+</span><span style="color:#ff8000">4</span><span style="color:navy">], ah      </span>; [si+DISK_PARMS.DISK_EOT]
<span style="color:black">BIOSCODE:0F7F                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:0F80                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSCODE:0F81                 </span><span style="color:navy">mov     al, dl
</span><span style="color:black">BIOSCODE:0F83                 </span><span style="color:navy">mov     ds:</span>seccnt<span style="color:navy">, ax
</span><span style="color:black">BIOSCODE:0F86                 </span><span style="color:navy">call    </span>disk
<span style="color:black">BIOSCODE:0F89                 </span><span style="color:navy">pop     si              </span>; Advance buffer pointer by adding
<span style="color:black">BIOSCODE:0F89                                         </span>; sector size
<span style="color:black">BIOSCODE:0F8A                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:0F8B                 </span><span style="color:navy">call    </span>SectorSizeIndexToSectorSize
<span style="color:black">BIOSCODE:0F8E                 </span><span style="color:navy">add     bx, ax
</span><span style="color:black">BIOSCODE:0F90                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSCODE:0F91                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:0F92                 </span><span style="color:navy">loop    </span><span style="color:gray">IoNextSector
</span><span style="color:black">BIOSCODE:0F94                 </span><span style="color:navy">cmp     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:0F99                 </span><span style="color:navy">jz      short </span><span style="color:gray">NoNeedDone
</span><span style="color:black">BIOSCODE:0F9B                 </span><span style="color:navy">call    </span>done
<span style="color:black">BIOSCODE:0F9E
BIOSCODE:0F9E </span><span style="color:gray">NoNeedDone</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0F9E                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:0F9F                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0F9F </span>TrackIo         endp
<span style="color:black">BIOSCODE:0F9F
BIOSCODE:0FA0
BIOSCODE:0FA0 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0FA0
BIOSCODE:0FA0
BIOSCODE:0FA0 </span>SectSizeToSectIndex proc near           <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0FA0                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">2           </span>; (0=&gt;128,1=&gt;256,2=&gt;512,3=&gt;1024)
<span style="color:black">BIOSCODE:0FA0                                         </span>;  examine upper byte only
<span style="color:black">BIOSCODE:0FA3                 </span><span style="color:navy">ja      short </span><span style="color:gray">OneK
</span><span style="color:black">BIOSCODE:0FA5                 </span><span style="color:navy">mov     al, ah          </span>; value in ah is the index!
<span style="color:black">BIOSCODE:0FA7                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0FA8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0FA8
BIOSCODE:0FA8 </span><span style="color:gray">OneK</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0FA8                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3
</span><span style="color:black">BIOSCODE:0FAA                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0FAA </span>SectSizeToSectIndex endp
<span style="color:black">BIOSCODE:0FAA
BIOSCODE:0FAB
BIOSCODE:0FAB </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0FAB
BIOSCODE:0FAB
BIOSCODE:0FAB </span>SectorSizeIndexToSectorSize proc near   <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0FAB                 </span><span style="color:navy">mov     cl, al
</span><span style="color:black">BIOSCODE:0FAD                 </span><span style="color:navy">mov     ax, </span><span style="color:green">80h
</span><span style="color:black">BIOSCODE:0FB0                 </span><span style="color:navy">shl     ax, cl
</span><span style="color:black">BIOSCODE:0FB2                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:0FB2 </span>SectorSizeIndexToSectorSize endp
<span style="color:black">BIOSCODE:0FB2
BIOSCODE:0FB3
BIOSCODE:0FB3 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:0FB3
BIOSCODE:0FB3
BIOSCODE:0FB3 </span>SetDasd         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0FB3                 </span><span style="color:navy">cmp     ds:</span>had_format_error<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; See if we&#039;ve previously set dasd type
<span style="color:black">BIOSCODE:0FB8                 </span><span style="color:navy">jz      short </span><span style="color:gray">DoSetDasd
</span><span style="color:black">BIOSCODE:0FBA                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">80h </span>; [es:di+BDS.flags], set_dasd_true
<span style="color:black">BIOSCODE:0FC0                 </span><span style="color:navy">jz      short </span><span style="color:gray">DasdHasBeenSet
</span><span style="color:black">BIOSCODE:0FC2                 </span><span style="color:navy">and     word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">0FF7Fh </span>; [es:di+BDS.flags], ~set_dasd_true
<span style="color:black">BIOSCODE:0FC8
BIOSCODE:0FC8 </span><span style="color:gray">DoSetDasd</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0FC8                 </span><span style="color:navy">mov     ds:</span>had_format_error<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; Reset it
<span style="color:black">BIOSCODE:0FCD                 </span><span style="color:navy">mov     ds:</span>gap_patch<span style="color:navy">, </span><span style="color:green">50h </span>; Format gap for 48tpi disks
<span style="color:black">BIOSCODE:0FD2                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">4
</span><span style="color:black">BIOSCODE:0FD4                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], </span><span style="color:#ff8000">2 </span>; [es:di+BDS.formfactor], DEV_3INCH720KB
<span style="color:black">BIOSCODE:0FD9                 </span><span style="color:navy">jz      short </span><span style="color:gray">DoSet
</span><span style="color:black">BIOSCODE:0FDB                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], </span><span style="color:#ff8000">1 </span>; [es:di+BDS.formfactor], DEV_5INCH96TPI
<span style="color:black">BIOSCODE:0FE0                 </span><span style="color:navy">jz      short </span><span style="color:gray">GotBig
</span><span style="color:black">BIOSCODE:0FE2                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:0FE4                 </span><span style="color:navy">jmp     short </span><span style="color:gray">DoSet
</span><span style="color:black">BIOSCODE:0FE6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:0FE6
BIOSCODE:0FE6 </span><span style="color:gray">GotBig</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0FE6                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">2           </span>; 160/320k in a 1.2 meg drive
<span style="color:black">BIOSCODE:0FE8                 </span><span style="color:navy">cmp     ds:</span>mediatype<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">BIOSCODE:0FED                 </span><span style="color:navy">jnz     short </span><span style="color:gray">DoSet
</span><span style="color:black">BIOSCODE:0FEF                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3           </span>; 1.2meg in a 1.2meg drive
<span style="color:black">BIOSCODE:0FF1                 </span><span style="color:navy">mov     ds:</span>gap_patch<span style="color:navy">, </span><span style="color:green">54h </span>; Format gap for 96 tpi, 1.2MB diskette
<span style="color:black">BIOSCODE:0FF6
BIOSCODE:0FF6 </span><span style="color:gray">DoSet</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:0FF6                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:0FF7                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSCODE:0FF8                 </span><span style="color:navy">mov     ds, ds:</span>zeroseg
<span style="color:black">BIOSCODE:0FFC                 </span>assume ds:nothing
<span style="color:black">BIOSCODE:0FFC                 </span><span style="color:navy">lds     si, dword ptr ds:</span>single ; [DSKADR] (Int 1Eh)
<span style="color:black">BIOSCODE:1000                 </span>assume ds:nothing
<span style="color:black">BIOSCODE:1000                 </span><span style="color:navy">mov     byte ptr [si+</span><span style="color:#ff8000">9</span><span style="color:navy">], </span><span style="color:green">0Fh </span>; [si+DISK_PARMS.DISK_HEAD_STTL]
<span style="color:black">BIOSCODE:1004                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSCODE:1005                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSCODE:1006                 </span><span style="color:navy">mov     ah, </span><span style="color:green">17h
</span><span style="color:black">BIOSCODE:1008                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]
</span><span style="color:black">BIOSCODE:100C                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - SET TYPE (AT,XT2,XT286,CONV,PS
<span style="color:black">BIOSCODE:100C                                         </span>; AL = disk type
<span style="color:black">BIOSCODE:100E
BIOSCODE:100E </span><span style="color:gray">DasdHasBeenSet</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:100E                 </span><span style="color:navy">mov     ah, es:[di+</span><span style="color:#ff8000">13h</span><span style="color:navy">] </span>; [es:di+BDS.secpertrack]
<span style="color:black">BIOSCODE:1012                 </span><span style="color:navy">mov     ds:</span>formt_eot<span style="color:navy">, ah
</span><span style="color:black">BIOSCODE:1016                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1016 </span>SetDasd         endp
<span style="color:black">BIOSCODE:1016
BIOSCODE:1017
BIOSCODE:1017 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1017
BIOSCODE:1017
BIOSCODE:1017 </span>SetMediaForFormat proc near             <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1017                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:1018                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSCODE:1019                 </span><span style="color:navy">cmp     ds:</span>had_format_error<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:101E                 </span><span style="color:navy">jz      short </span><span style="color:gray">SkipSaveDskAdr
</span><span style="color:black">BIOSCODE:1020                 </span><span style="color:navy">xor     al, al          </span>; If already done return 0
<span style="color:black">BIOSCODE:1022                 </span><span style="color:navy">cmp     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:1027                 </span><span style="color:navy">jnz     short </span><span style="color:gray">DoSetMediaForFormat
</span><span style="color:black">BIOSCODE:1029                 </span><span style="color:navy">jmp     </span><span style="color:gray">SetMediaRet     </span>; Media already set
<span style="color:black">BIOSCODE:102C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:102C
BIOSCODE:102C </span><span style="color:gray">DoSetMediaForFormat</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:102C                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:102D                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSCODE:102E                 </span><span style="color:navy">mov     es, ds:</span>zeroseg  ; 0 ; Point to interrupt vectors
<span style="color:black">BIOSCODE:1032                 </span>assume es:nothing
<span style="color:black">BIOSCODE:1032                 </span><span style="color:navy">les     si, dword ptr es:</span>single ; [es:DSKADR]
<span style="color:black">BIOSCODE:1032                                         </span>; Get pointer to disk base table
<span style="color:black">BIOSCODE:1037                 </span>assume es:nothing
<span style="color:black">BIOSCODE:1037                 </span><span style="color:navy">mov     word ptr ds:</span>dpt<span style="color:navy">, si
</span><span style="color:black">BIOSCODE:103B                 </span><span style="color:navy">mov     word ptr ds:</span>dpt<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">BIOSCODE:103F                 </span><span style="color:navy">mov     byte ptr es:[si+</span><span style="color:#ff8000">9</span><span style="color:navy">], </span><span style="color:#ff8000">0Fh </span>; [es:si+DISK_PARMS.DISK_HEAD_STTL]
<span style="color:black">BIOSCODE:1044                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSCODE:1045                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:1046
BIOSCODE:1046 </span><span style="color:gray">SkipSaveDskAdr</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1046                 </span><span style="color:navy">mov     cx, es:[di+</span><span style="color:#ff8000">25h</span><span style="color:navy">] </span>; [es:di+BDS.cylinders]
<span style="color:black">BIOSCODE:104A                 </span><span style="color:navy">dec     cx
</span><span style="color:black">BIOSCODE:104B                 </span><span style="color:navy">and     ch, </span><span style="color:green">3
</span><span style="color:black">BIOSCODE:104E                 </span><span style="color:navy">ror     ch, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:1050                 </span><span style="color:navy">ror     ch, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:1052                 </span><span style="color:navy">xchg    ch, cl
</span><span style="color:black">BIOSCODE:1054                 </span><span style="color:navy">or      cl, es:[di+</span><span style="color:#ff8000">13h</span><span style="color:navy">] </span>; [es:di+BDS.secpertrack]
<span style="color:black">BIOSCODE:1058                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:105C                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:105D                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:105E                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSCODE:105F                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:1060                 </span><span style="color:navy">mov     ah, </span><span style="color:green">18h
</span><span style="color:black">BIOSCODE:1062                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - SET MEDIA TYPE FOR FORMAT (AT model 3x9,XT2,XT286,PS)
<span style="color:black">BIOSCODE:1062                                         </span>; DL = drive number, CH = lower 8 bits of number of tracks,
<span style="color:black">BIOSCODE:1062                                         </span>; CL = sectors per track
<span style="color:black">BIOSCODE:1064                 </span><span style="color:navy">jb      short </span><span style="color:gray">FormaStatErr
</span><span style="color:black">BIOSCODE:1066                 </span><span style="color:navy">cmp     ds:</span>had_format_error<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:106B                 </span><span style="color:navy">jz      short </span><span style="color:gray">skip_disk_base_setting
</span><span style="color:black">BIOSCODE:106D                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:106E                 </span><span style="color:navy">mov     es, ds:</span>zeroseg  ; 0
<span style="color:black">BIOSCODE:1072                 </span>assume es:nothing
<span style="color:black">BIOSCODE:1072                 </span><span style="color:navy">les     si, dword ptr es:</span>single ; [es:DSKADR] (Int 1Eh)
<span style="color:black">BIOSCODE:1072                                         </span>; Get current disk base table
<span style="color:black">BIOSCODE:1077                 </span>assume es:nothing
<span style="color:black">BIOSCODE:1077                 </span><span style="color:navy">mov     word ptr ds:</span>tempdpt<span style="color:navy">, si
</span><span style="color:black">BIOSCODE:107B                 </span><span style="color:navy">mov     word ptr ds:</span>tempdpt<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es </span>; Save it
<span style="color:black">BIOSCODE:107F                 </span><span style="color:navy">mov     es, ds:</span>zeroseg  ; 0
<span style="color:black">BIOSCODE:1083                 </span>assume es:nothing
<span style="color:black">BIOSCODE:1083                 </span><span style="color:navy">mov     word ptr es:</span>single<span style="color:navy">, di
</span><span style="color:black">BIOSCODE:1088                 </span><span style="color:navy">pop     word ptr es:</span>fsetowner
<span style="color:black">BIOSCODE:108D                 </span><span style="color:navy">mov     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:1092
BIOSCODE:1092 </span><span style="color:gray">skip_disk_base_setting</span><span style="color:navy">:                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1092                 </span><span style="color:navy">xor     al, al          </span>; Legal combination + rom support code
<span style="color:black">BIOSCODE:1094                 </span><span style="color:navy">mov     ds:</span>had_format_error<span style="color:navy">, al </span>; Reset the flag
<span style="color:black">BIOSCODE:1097                 </span><span style="color:navy">jmp     short </span><span style="color:gray">PopStatRet
</span><span style="color:black">BIOSCODE:1099 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:1099
BIOSCODE:1099 </span><span style="color:gray">FormaStatErr</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1099                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">0Ch         </span>; DSK_ILLEGAL_COMBINATION
<span style="color:black">BIOSCODE:1099                                         </span>; Illegal combination = 0Ch
<span style="color:black">BIOSCODE:109C                 </span><span style="color:navy">jz      short </span><span style="color:gray">FormatStatIllegalComb
</span><span style="color:black">BIOSCODE:109E                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">80h         </span>; DSK_TIMEOUT_ERR
<span style="color:black">BIOSCODE:10A1                 </span><span style="color:navy">jz      short </span><span style="color:gray">FormatStatTimeOut
</span><span style="color:black">BIOSCODE:10A3                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1           </span>; Function not supported.
<span style="color:black">BIOSCODE:10A5                 </span><span style="color:navy">jmp     short </span><span style="color:gray">PopStatRet
</span><span style="color:black">BIOSCODE:10A7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:10A7
BIOSCODE:10A7 </span><span style="color:gray">FormatStatIllegalComb</span><span style="color:navy">:                  </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:10A7                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">2           </span>; Function supported, but
<span style="color:black">BIOSCODE:10A7                                         </span>; Illegal sect/trk,trk combination.
<span style="color:black">BIOSCODE:10A9                 </span><span style="color:navy">jmp     short </span><span style="color:gray">PopStatRet
</span><span style="color:black">BIOSCODE:10AB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:10AB
BIOSCODE:10AB </span><span style="color:gray">FormatStatTimeOut</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:10AB                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3           </span>; Function supported, but
<span style="color:black">BIOSCODE:10AB                                         </span>; Media not present
<span style="color:black">BIOSCODE:10AD
BIOSCODE:10AD </span><span style="color:gray">PopStatRet</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:10AD                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSCODE:10AE                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSCODE:10AF                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSCODE:10B0                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:10B1                 </span>assume es:nothing
<span style="color:black">BIOSCODE:10B1
BIOSCODE:10B1 </span><span style="color:gray">SetMediaRet</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:10B1                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSCODE:10B2                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:10B3                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:10B3 </span>SetMediaForFormat endp
<span style="color:black">BIOSCODE:10B3
BIOSCODE:10B4
BIOSCODE:10B4 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:10B4
BIOSCODE:10B4
BIOSCODE:10B4 </span>resetdisk       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:10B4                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:10B5                 </span><span style="color:navy">cmp     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; Reset while formatting?
<span style="color:black">BIOSCODE:10BA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ResetDisk_cont
</span><span style="color:black">BIOSCODE:10BC                 </span><span style="color:navy">mov     ds:</span>had_format_error<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; Then verify operation in &quot;fmt &amp; vrfy&quot;
<span style="color:black">BIOSCODE:10BC                                         </span>; Might have failed.
<span style="color:black">BIOSCODE:10BC                                         </span>; So signals that we had a format error.
<span style="color:black">BIOSCODE:10C1
BIOSCODE:10C1 </span><span style="color:gray">ResetDisk_cont</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:10C1                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">BIOSCODE:10C3                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - RESET DISK SYSTEM
<span style="color:black">BIOSCODE:10C3                                         </span>; DL = drive (if bit 7 is set both hard disks and floppy disks reset)
<span style="color:black">BIOSCODE:10C5                 </span><span style="color:navy">mov     ds:</span>step_drv<span style="color:navy">, </span><span style="color:#ff8000">0FFh </span>; -1
<span style="color:black">BIOSCODE:10C5                                         </span>; Zap up the speed
<span style="color:black">BIOSCODE:10CA                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:10CB                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:10CB </span>resetdisk       endp
<span style="color:black">BIOSCODE:10CB
BIOSCODE:10CC
BIOSCODE:10CC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:10CC
BIOSCODE:10CC
BIOSCODE:10CC </span>ToRom           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:10CC                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSCODE:10CD                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSCODE:10CE                 </span><span style="color:navy">test    ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:10D3                 </span><span style="color:navy">jnz     short </span><span style="color:gray">GotValidDpt
</span><span style="color:black">BIOSCODE:10D5                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:10D6                 </span><span style="color:navy">push    es              </span>; Save bds segment
<span style="color:black">BIOSCODE:10D7                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], </span><span style="color:#ff8000">2 </span>; [es:di+BDS.formfactor], ffSmall
<span style="color:black">BIOSCODE:10D7                                         </span>; is it a 3.5&quot; drive?
<span style="color:black">BIOSCODE:10DC                 </span><span style="color:navy">pushf
</span><span style="color:black">BIOSCODE:10DD                 </span><span style="color:navy">mov     es, ds:</span>zeroseg  ; 0
<span style="color:black">BIOSCODE:10E1                 </span>assume es:nothing
<span style="color:black">BIOSCODE:10E1                 </span><span style="color:navy">les     si, dword ptr es:</span>single ; Get pointer to disk base table
<span style="color:black">BIOSCODE:10E6                 </span>assume es:nothing
<span style="color:black">BIOSCODE:10E6                 </span><span style="color:navy">mov     word ptr ds:</span>dpt<span style="color:navy">, si </span>; Save pointer to table
<span style="color:black">BIOSCODE:10EA                 </span><span style="color:navy">mov     word ptr ds:</span>dpt<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">BIOSCODE:10EE                 </span><span style="color:navy">mov     al, ds:</span>formt_eot
<span style="color:black">BIOSCODE:10F1                 </span><span style="color:navy">mov     es:[si+</span><span style="color:#ff8000">4</span><span style="color:navy">], al   </span>; [es:si+DISK_PARMS.DISK_EOT]
<span style="color:black">BIOSCODE:10F5                 </span><span style="color:navy">mov     al, ds:</span>gap_patch
<span style="color:black">BIOSCODE:10F8                 </span><span style="color:navy">mov     es:[si+</span><span style="color:#ff8000">7</span><span style="color:navy">], al   </span>; [es:si+DISK_PARMS.DISK_FORMT_GAP]
<span style="color:black">BIOSCODE:10F8                                         </span>; Important for format
<span style="color:black">BIOSCODE:10FC                 </span><span style="color:navy">mov     byte ptr es:[si+</span><span style="color:#ff8000">9</span><span style="color:navy">], </span><span style="color:green">0Fh </span>; [es:si+DISK_PARMS.DISK_HEAD_STTL]
<span style="color:black">BIOSCODE:10FC                                         </span>; Assume we are doing a seek operation
<span style="color:black">BIOSCODE:10FC                                         </span>; Setup motor start correctly for 3.5&quot; drives
<span style="color:black">BIOSCODE:1101                 </span><span style="color:navy">popf
</span><span style="color:black">BIOSCODE:1102                 </span><span style="color:navy">jnz     short </span><span style="color:gray">MotorStrtOK
</span><span style="color:black">BIOSCODE:1104                 </span><span style="color:navy">mov     byte ptr es:[si+</span><span style="color:#ff8000">0Ah</span><span style="color:navy">], </span><span style="color:#ff8000">4 </span>; [es:si+DISK_PARMS.DISK_MOTOR_STRT]
<span style="color:black">BIOSCODE:1109
BIOSCODE:1109 </span><span style="color:gray">MotorStrtOK</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1109                 </span><span style="color:navy">pop     es              </span>; Restore bds segment
<span style="color:black">BIOSCODE:110A                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:110B
BIOSCODE:110B </span><span style="color:gray">GotValidDpt</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:110B                 </span><span style="color:navy">mov     dx, ds:</span>trknum   ; Set track number
<span style="color:black">BIOSCODE:110F                 </span><span style="color:navy">mov     ch, dl          </span>; Set low 8 bits in ch
<span style="color:black">BIOSCODE:1111                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; Set drive number
<span style="color:black">BIOSCODE:1115                 </span><span style="color:navy">mov     dh, ds:</span>hdnum    ; Set head number
<span style="color:black">BIOSCODE:1119                 </span><span style="color:navy">push    es              </span>; Save bds segment
<span style="color:black">BIOSCODE:111A                 </span><span style="color:navy">mov     es, word ptr ds:</span><span style="color:green">537h
</span><span style="color:black">BIOSCODE:111E                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK -
<span style="color:black">BIOSCODE:1120                 </span><span style="color:navy">pop     es              </span>; Restore bds segment
<span style="color:black">BIOSCODE:1121                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSCODE:1122                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSCODE:1123                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1123 </span>ToRom           endp
<span style="color:black">BIOSCODE:1123
BIOSCODE:1124
BIOSCODE:1124 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1124
BIOSCODE:1124
BIOSCODE:1124 </span>ioctl_getown    proc near               <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:1124                 </span><span style="color:navy">call    </span>SetDrive
<span style="color:black">BIOSCODE:1127                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:1127                                         </span>; Get physical drive number
<span style="color:black">BIOSCODE:112B                 </span><span style="color:navy">les     di, ds:</span>start_bds ; Get start of bds chain
<span style="color:black">BIOSCODE:112F
BIOSCODE:112F </span>OwnLoop<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:112F                 </span><span style="color:navy">cmp     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], al   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:1133                 </span><span style="color:navy">jnz     short </span>getnextBDS
<span style="color:black">BIOSCODE:1135                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">20h </span>; [es:di+BDS.flags], fi_own_physical
<span style="color:black">BIOSCODE:113B                 </span><span style="color:navy">jnz     short </span>ExitOwn
<span style="color:black">BIOSCODE:113D
BIOSCODE:113D </span>getnextBDS<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:113D                 </span><span style="color:navy">les     di, es:[di]     </span>; [es:di+BDS.link]
<span style="color:black">BIOSCODE:1140                 </span><span style="color:navy">jmp     short </span>OwnLoop
<span style="color:black">BIOSCODE:1142 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:1142
BIOSCODE:1142 </span>ioctl_setown<span style="color:navy">:                           </span><span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:1142                 </span><span style="color:navy">call    </span>SetDrive
<span style="color:black">BIOSCODE:1145                 </span><span style="color:navy">mov     ds:</span>fsetowner<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; set flag for CheckSingle to look at.
<span style="color:black">BIOSCODE:114A                 </span><span style="color:navy">call    </span>checksingle
<span style="color:black">BIOSCODE:114D                 </span><span style="color:navy">mov     ds:</span>fsetowner<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; set ownership of drive reset flag
<span style="color:black">BIOSCODE:1152
BIOSCODE:1152 </span>ExitOwn<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1152                 </span><span style="color:navy">xor     cl, cl
</span><span style="color:black">BIOSCODE:1154                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">10h </span>; [es:di+BDS.flags], fi_am_mult
<span style="color:black">BIOSCODE:115A                 </span><span style="color:navy">jz      short </span>ExitNoMult
<span style="color:black">BIOSCODE:115C                 </span><span style="color:navy">mov     cl, es:[di+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; [es:di+BDS.drivelet]
<span style="color:black">BIOSCODE:115C                                         </span>; Get logical drive number
<span style="color:black">BIOSCODE:1160                 </span><span style="color:navy">inc     cl              </span>; Get it 1-based
<span style="color:black">BIOSCODE:1162
BIOSCODE:1162 </span>ExitNoMult<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1162                 </span><span style="color:navy">lds     bx, ds:</span>ptrsav
<span style="color:black">BIOSCODE:1166                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">1</span><span style="color:navy">], cl      </span>; [bx+unit]
<span style="color:black">BIOSCODE:1166                                         </span>; Exit normal termination
<span style="color:black">BIOSCODE:1169                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:116A                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:116A </span>ioctl_getown    endp
<span style="color:black">BIOSCODE:116A
BIOSCODE:116B
BIOSCODE:116B </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:116B
BIOSCODE:116B
BIOSCODE:116B </span>RestoreOldDpt   proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:116B                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:116C                 </span><span style="color:navy">xor     al, al
</span><span style="color:black">BIOSCODE:116E                 </span><span style="color:navy">mov     ds:</span>had_format_error<span style="color:navy">, al </span>; Reset flag and
<span style="color:black">BIOSCODE:1171                 </span><span style="color:navy">xchg    al, ds:</span>media_set_for_format ; get current flag setting
<span style="color:black">BIOSCODE:1175                 </span><span style="color:navy">or      al, al
</span><span style="color:black">BIOSCODE:1177                 </span><span style="color:navy">jz      short </span><span style="color:gray">DontRestore
</span><span style="color:black">BIOSCODE:1179                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSCODE:117A                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:117B                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:117C                 </span><span style="color:navy">lds     si, ds:</span>tempdpt
<span style="color:black">BIOSCODE:1180                 </span><span style="color:navy">mov     es, cs:</span>Bios_Data_Word
<span style="color:black">BIOSCODE:1185                 </span>assume es:nothing
<span style="color:black">BIOSCODE:1185                 </span><span style="color:navy">mov     es, es:</span>zeroseg  ; es = 0
<span style="color:black">BIOSCODE:118A                 </span>assume es:nothing
<span style="color:black">BIOSCODE:118A                 </span><span style="color:navy">mov     word ptr es:</span>single<span style="color:navy">, si </span>; [es:DSKADR] (Int 1Eh)
<span style="color:black">BIOSCODE:118F                 </span><span style="color:navy">mov     word ptr es:</span>fsetowner<span style="color:navy">, ds </span>; [es:DSKADR+2]
<span style="color:black">BIOSCODE:1194                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:1195                 </span>assume es:nothing
<span style="color:black">BIOSCODE:1195                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSCODE:1196                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSCODE:1197
BIOSCODE:1197 </span><span style="color:gray">DontRestore</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1197                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:1198                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:1199                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1199 </span>RestoreOldDpt   endp
<span style="color:black">BIOSCODE:1199
BIOSCODE:119A
BIOSCODE:119A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:119A
BIOSCODE:119A
BIOSCODE:119A </span>GetMediaId      proc near               <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:119A                 </span><span style="color:navy">call    </span>ChangeLineChk
<span style="color:black">BIOSCODE:119D                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; [es:di+BDS.drivelet] ; Logical drive number
<span style="color:black">BIOSCODE:11A1                 </span><span style="color:navy">mov     ds:</span>rflag<span style="color:navy">, </span><span style="color:#ff8000">2     </span>; Read operation
<span style="color:black">BIOSCODE:11A6                 </span><span style="color:navy">call    </span>BootIo          ; Read boot sector into DiskSector
<span style="color:black">BIOSCODE:11A9                 </span><span style="color:navy">jb      short </span>IOCtl_If1
<span style="color:black">BIOSCODE:11AB                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">+</span><span style="color:green">15h</span><span style="color:navy">, </span><span style="color:green">0F0h </span>; Valid? (0F0h-0FFh?)
<span style="color:black">BIOSCODE:11B0                 </span><span style="color:navy">jb      short </span>IOCtl_If2 ; brif not valid (0F0h - 0FFh)
<span style="color:black">BIOSCODE:11B2                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">+</span><span style="color:green">26h</span><span style="color:navy">, </span><span style="color:green">29h </span>; disksector+EXT_BOOT.SIG
<span style="color:black">BIOSCODE:11B2                                         </span>; BS_BootSig
<span style="color:black">BIOSCODE:11B7                 </span><span style="color:navy">jnz     short </span>IOCtl_If2
<span style="color:black">BIOSCODE:11B9                 </span><span style="color:navy">les     di, ds:</span>ptrsav
<span style="color:black">BIOSCODE:11BD                 </span><span style="color:navy">les     di, es:[bx+</span><span style="color:green">19</span><span style="color:navy">]  </span>; [es:bx+IOCTL_REQ.GENERICIOCTL_PACKET]
<span style="color:black">BIOSCODE:11C1                 </span><span style="color:navy">mov     si, (offset </span>disksector<span style="color:navy">+</span><span style="color:green">27h</span><span style="color:navy">) </span>; BS_VolID
<span style="color:black">BIOSCODE:11C4                 </span><span style="color:navy">add     di, </span><span style="color:#ff8000">2           </span>; A_MEDIA_ID_INFO.MI_SERIAL
<span style="color:black">BIOSCODE:11C7                 </span><span style="color:navy">mov     cx, </span><span style="color:green">23          </span>; +size_of_EXT_BOOT_VOL_LABEL
<span style="color:black">BIOSCODE:11C7                                         </span>; +size_of_EXT_SYSTEM_ID
<span style="color:black">BIOSCODE:11CA                 </span><span style="color:navy">rep movsb
</span><span style="color:black">BIOSCODE:11CC                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:11CD                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:11CE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:11CE
BIOSCODE:11CE </span>IOCtl_If2<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:11CE                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">7
</span><span style="color:black">BIOSCODE:11D0                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:11D1
BIOSCODE:11D1 </span>IOCtl_If1<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:11D1                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:11D1 </span>GetMediaId      endp
<span style="color:black">BIOSCODE:11D1
</span><span style="color:maroon">BIOSCODE:11D2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:11D2
BIOSCODE:11D2 </span>SetMediaId<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:11D2                 </span><span style="color:navy">call    </span>ChangeLineChk
<span style="color:maroon">BIOSCODE:11D5                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; [es:di+BDS.drivelet]
<span style="color:maroon">BIOSCODE:11D5                                         </span>; Logical drive number
<span style="color:maroon">BIOSCODE:11D9                 </span><span style="color:navy">mov     dl, al
</span><span style="color:maroon">BIOSCODE:11DB                 </span><span style="color:navy">mov     ds:</span>rflag<span style="color:navy">, </span><span style="color:#ff8000">2     </span>; romread
<span style="color:maroon">BIOSCODE:11E0                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">BIOSCODE:11E1                 </span><span style="color:navy">call    </span>BootIo          ; Read boot sector to BIOSDATA:DiskSector
<span style="color:maroon">BIOSCODE:11E4                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSCODE:11E5                 </span><span style="color:navy">jb      short </span>IOCtl_If6
<span style="color:maroon">BIOSCODE:11E7                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">+</span><span style="color:green">15h</span><span style="color:navy">, </span><span style="color:green">0F0h </span>; Valid? (0F0h-0FFh?)
<span style="color:maroon">BIOSCODE:11E7                                         </span>; [disksector+EXT_BOOT.BPB+EBPB.MEDIADESCRIPTOR]
<span style="color:maroon">BIOSCODE:11EC                 </span><span style="color:navy">jb      short </span>IOCtl_If7
<span style="color:maroon">BIOSCODE:11EE                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">+</span><span style="color:green">26h</span><span style="color:navy">, </span><span style="color:green">29h
</span><span style="color:maroon">BIOSCODE:11F3                 </span><span style="color:navy">jnz     short </span>IOCtl_If7
<span style="color:maroon">BIOSCODE:11F5                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:11F6                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSCODE:11F7                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:11F8                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:11F9                 </span><span style="color:navy">mov     di, (offset </span>disksector<span style="color:navy">+</span><span style="color:green">27h</span><span style="color:navy">) </span>; disksector+EXT_BOOT.SERIAL
<span style="color:maroon">BIOSCODE:11FC                 </span><span style="color:navy">lds     si, ds:</span>ptrsav
<span style="color:maroon">BIOSCODE:1200                 </span><span style="color:navy">lds     si, [si+</span><span style="color:#ff8000">13h</span><span style="color:navy">]
</span><span style="color:maroon">BIOSCODE:1203                 </span><span style="color:navy">add     si, </span><span style="color:#ff8000">2
</span><span style="color:maroon">BIOSCODE:1206                 </span><span style="color:navy">mov     cx, </span><span style="color:green">23          </span>; copy volume serial, label and system id
<span style="color:maroon">BIOSCODE:1206                                         </span>; cx = 23 = size_of_EXT_BOOT_SERIAL
<span style="color:maroon">BIOSCODE:1206                                         </span>;         + size_of_EXT_BOOT_VOL_LABEL
<span style="color:maroon">BIOSCODE:1206                                         </span>;         + size_of_EXT_SYSTEM_ID
<span style="color:maroon">BIOSCODE:1209                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">BIOSCODE:120B                 </span><span style="color:navy">push    es              </span>; point ds back to BIOSDATA
<span style="color:maroon">BIOSCODE:120C                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:120D                 </span><span style="color:navy">pop     di              </span>; restore bds pointer
<span style="color:maroon">BIOSCODE:120E                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:120F                 </span><span style="color:navy">call    </span>mov_media_ids   ; update the bds media id info.
<span style="color:maroon">BIOSCODE:1212                 </span><span style="color:navy">mov     al, dl
</span><span style="color:maroon">BIOSCODE:1214                 </span><span style="color:navy">mov     ds:</span>rflag<span style="color:navy">, </span><span style="color:#ff8000">3     </span>; romwrite
<span style="color:maroon">BIOSCODE:1219                 </span><span style="color:navy">call    </span>BootIo          ; write it back
<span style="color:maroon">BIOSCODE:121C                 </span><span style="color:navy">mov     ds:</span>tim_drv<span style="color:navy">, </span><span style="color:green">0FFh </span>; make sure chk_media check the driver
<span style="color:maroon">BIOSCODE:121C                                         </span>; return with error code from BootIo
<span style="color:maroon">BIOSCODE:1221                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:1222 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1222
BIOSCODE:1222 </span>IOCtl_If7<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1222                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">7           </span>; error_unknown_media
<span style="color:maroon">BIOSCODE:1224                 </span><span style="color:navy">stc
</span><span style="color:maroon">BIOSCODE:1225
BIOSCODE:1225 </span>IOCtl_If6<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1225                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1226
BIOSCODE:1226 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1226
BIOSCODE:1226
BIOSCODE:1226 </span>BootIo          proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1226                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:1227                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:1228                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSCODE:1229                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:122A                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:122B                 </span><span style="color:navy">mov     di, offset </span>disksector ; es:di -&gt; transfer address
<span style="color:black">BIOSCODE:122E                 </span><span style="color:navy">xor     dx, dx          </span>; First sector (h) -&gt; 0
<span style="color:black">BIOSCODE:1230                 </span><span style="color:navy">mov     ds:</span>start_sec_h<span style="color:navy">, dx </span>; Start sector (h) -&gt; 0
<span style="color:black">BIOSCODE:1234                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:1237                 </span><span style="color:navy">call    </span>diskio
<span style="color:black">BIOSCODE:123A                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSCODE:123B                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSCODE:123C                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:123D                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:123D </span>BootIo          endp
<span style="color:black">BIOSCODE:123D
BIOSCODE:123E
BIOSCODE:123E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:123E
BIOSCODE:123E
BIOSCODE:123E </span>ChangeLineChk   proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:123E                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:1242                 </span><span style="color:navy">or      dl, dl          </span>; Fixed disk?
<span style="color:black">BIOSCODE:1244                 </span><span style="color:navy">js      short </span><span style="color:gray">ChangeLnChkRet
</span><span style="color:black">BIOSCODE:1246                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">4 </span>; [es:di+BDS.flags], return_fake_bpb
<span style="color:black">BIOSCODE:124C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ChangeLnChkRet
</span><span style="color:black">BIOSCODE:124E                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">1   </span>; This rom support change line?
<span style="color:black">BIOSCODE:1253                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ChangeLnChkRet </span>; no
<span style="color:black">BIOSCODE:1255                 </span><span style="color:navy">call    </span>HasChange       ; This drive support change line?
<span style="color:black">BIOSCODE:1258                 </span><span style="color:navy">jz      short </span><span style="color:gray">ChangeLnChkRet </span>; Do nothing
<span style="color:black">BIOSCODE:125A                 </span><span style="color:navy">mov     ah, </span><span style="color:green">16h
</span><span style="color:black">BIOSCODE:125C                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK -
<span style="color:black">BIOSCODE:125E                 </span><span style="color:navy">jnb     short </span><span style="color:gray">ChangeLnChkRet
</span><span style="color:black">BIOSCODE:1260                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSCODE:1261                 </span><span style="color:navy">mov     bx, </span><span style="color:green">40h         </span>; fchanged
<span style="color:black">BIOSCODE:1261                                         </span>; Update flag in BDS for this physical drive
<span style="color:black">BIOSCODE:1264                 </span><span style="color:navy">call    </span>Set_Changed_DL
<span style="color:black">BIOSCODE:1267                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSCODE:1268
BIOSCODE:1268 </span><span style="color:gray">ChangeLnChkRet</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1268                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1268 </span>ChangeLineChk   endp
<span style="color:black">BIOSCODE:1268
</span><span style="color:maroon">BIOSCODE:1269 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1269
BIOSCODE:1269 </span>GetAccessFlag<span style="color:navy">:                          </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:1269                 </span><span style="color:navy">lds     bx, ds:</span>ptrsav   ; ds:bx points to request header
<span style="color:maroon">BIOSCODE:126D                 </span><span style="color:navy">lds     bx, [bx+</span><span style="color:#ff8000">13h</span><span style="color:navy">]    </span>; [bx+IOCTL_REQ.GENERICIOCTL_PACKET]
<span style="color:maroon">BIOSCODE:1270                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0           </span>; Assume result is unformatted
<span style="color:maroon">BIOSCODE:1272                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">200h </span>; [es:di+BDS.flags], unformatted_media
<span style="color:maroon">BIOSCODE:1278                 </span><span style="color:navy">jnz     short </span>GafDone   ; Done if unformatted
<span style="color:maroon">BIOSCODE:127A                 </span><span style="color:navy">inc     al              </span>; Return true for formatted
<span style="color:maroon">BIOSCODE:127C
BIOSCODE:127C </span>GafDone<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:127C                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">1</span><span style="color:navy">], al      </span>; [bx+A_DISKACCESS_CONTROL.DAC_ACCESS_FLAG]
<span style="color:maroon">BIOSCODE:127F                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:1280 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1280
BIOSCODE:1280 </span>SetAccessFlag<span style="color:navy">:                          </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:1280                 </span><span style="color:navy">lds     bx, ds:</span><span style="color:green">12h      </span>; ds:bx points to request header
<span style="color:maroon">BIOSCODE:1284                 </span><span style="color:navy">lds     bx, [bx+</span><span style="color:#ff8000">13h</span><span style="color:navy">]    </span>; [bx+IOCTL_REQ.GENERICIOCTL_PACKET]
<span style="color:maroon">BIOSCODE:1287                 </span><span style="color:navy">and     word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">0FDFFh </span>; [es:di+BDS.flags], ~unformatted_media
<span style="color:maroon">BIOSCODE:128D                 </span><span style="color:navy">cmp     byte ptr [bx+</span><span style="color:#ff8000">1</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [bx+A_DISKACCESS_CONTROL.DAC_ACCESS_FLAG]
<span style="color:maroon">BIOSCODE:1291                 </span><span style="color:navy">jnz     short </span>saf_Done
<span style="color:maroon">BIOSCODE:1293                 </span><span style="color:navy">or      word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">200h </span>; [es:di+BDS.flags], unformatted_media
<span style="color:maroon">BIOSCODE:1299
BIOSCODE:1299 </span>saf_Done<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1299                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:129A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:129A
BIOSCODE:129A </span>ioctl_support_query<span style="color:navy">:                    </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:129A                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:129B                 </span><span style="color:navy">les     bx, ds:</span>ptrsav   ; es:bx points to request header.
<span style="color:maroon">BIOSCODE:129F                 </span><span style="color:navy">mov     ax, es:[bx+</span><span style="color:#ff8000">0Dh</span><span style="color:navy">] </span>; [es:bx+IOCTL_REQ.MAJORFUNCTION]
<span style="color:maroon">BIOSCODE:129F                                         </span>; al == Major, ah == Minor
<span style="color:maroon">BIOSCODE:12A3                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">8           </span>; IOC_DC
<span style="color:maroon">BIOSCODE:12A5                 </span><span style="color:navy">jnz     short </span>NoSupport
<span style="color:maroon">BIOSCODE:12A7                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">BIOSCODE:12A8                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:12A9                 </span>assume es:BIOSCODE
<span style="color:maroon">BIOSCODE:12A9                 </span><span style="color:navy">mov     cx, </span><span style="color:green">11          </span>; IOC_DC_TABLE_LEN
<span style="color:maroon">BIOSCODE:12AC                 </span><span style="color:navy">mov     di, offset </span>IOC_DC_Table
<span style="color:maroon">BIOSCODE:12AF                 </span><span style="color:navy">xchg    al, ah
</span><span style="color:maroon">BIOSCODE:12B1                 </span><span style="color:navy">repne scasb
</span><span style="color:maroon">BIOSCODE:12B3                 </span><span style="color:navy">jnz     short </span>NoSupport
<span style="color:maroon">BIOSCODE:12B5                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">100h
</span><span style="color:maroon">BIOSCODE:12B8                 </span><span style="color:navy">jmp     short $+</span><span style="color:green">2
</span><span style="color:maroon">BIOSCODE:12BA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:12BA
BIOSCODE:12BA </span>ioctl_support<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:12BA                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:12BB                 </span>assume es:nothing
<span style="color:maroon">BIOSCODE:12BB                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:12BC                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:12BD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:12BD
BIOSCODE:12BD </span>NoSupport<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:12BD                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:12BE                 </span><span style="color:navy">jmp     </span>bc_cmderr
<span style="color:maroon">BIOSCODE:12C1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:12C1
BIOSCODE:12C1 </span>SenseMediaType<span style="color:navy">:                         </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">BIOSCODE:12C1                 </span><span style="color:navy">lds     bx, ds:</span>ptrsav   ; s:bx points to request header.
<span style="color:maroon">BIOSCODE:12C5                 </span><span style="color:navy">lds     bx, [bx+</span><span style="color:#ff8000">13h</span><span style="color:navy">]    </span>; [bx+IOCTL_REQ.GENERICIOCTL_PACKET]
<span style="color:maroon">BIOSCODE:12C8                 </span><span style="color:navy">mov     word ptr [bx], </span><span style="color:#ff8000">0 </span>; 0 ; Initialize the 2 packet bytes
<span style="color:maroon">BIOSCODE:12C8                                         </span>; invalidate drive type (byte 1)
<span style="color:maroon">BIOSCODE:12C8                                         </span>; and default type flag (byte 0)
<span style="color:maroon">BIOSCODE:12CC                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:di+BDS.drivenum]
<span style="color:maroon">BIOSCODE:12D0                 </span><span style="color:navy">xor     dh, dh
</span><span style="color:maroon">BIOSCODE:12D2                 </span><span style="color:navy">mov     ah, </span><span style="color:green">20h
</span><span style="color:maroon">BIOSCODE:12D4                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; Compaq, ATAPI Removable Media Device
<span style="color:maroon">BIOSCODE:12D4                                         </span>; GET CURRENT MEDIA FORMAT
<span style="color:maroon">BIOSCODE:12D4                                         </span>;   AH = 20h
<span style="color:maroon">BIOSCODE:12D4                                         </span>;   DL = drive number (00h,01h)
<span style="color:maroon">BIOSCODE:12D4                                         </span>; Return: CF clear if successful
<span style="color:maroon">BIOSCODE:12D4                                         </span>;   AL = media type
<span style="color:maroon">BIOSCODE:12D4                                         </span>;   AH = 00h
<span style="color:maroon">BIOSCODE:12D4                                         </span>;   CF set on error
<span style="color:maroon">BIOSCODE:12D4                                         </span>;      AH = error code
<span style="color:maroon">BIOSCODE:12D4                                         </span>;
<span style="color:maroon">BIOSCODE:12D4                                         </span>; (Ref: Ralf Interrupt List, INTERRUP.B)
<span style="color:maroon">BIOSCODE:12D6                 </span><span style="color:navy">jb      short </span>MediaSenseErr
<span style="color:maroon">BIOSCODE:12D8                 </span><span style="color:navy">inc     byte ptr [bx]   </span>; [bx+A_MEDIA_SENSE.MS_ISDEFAULT]
<span style="color:maroon">BIOSCODE:12D8                                         </span>; 1 = default media type
<span style="color:maroon">BIOSCODE:12DA
BIOSCODE:12DA </span>DetermineMediaType<span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:12DA                 </span><span style="color:navy">dec     al              </span>; 3 -&gt; 2, 4 -&gt; 3, 6 -&gt; 5
<span style="color:maroon">BIOSCODE:12DC                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2           </span>; 3.5 inch, 720 KB
<span style="color:maroon">BIOSCODE:12DE                 </span><span style="color:navy">jz      short </span>GotMediaType
<span style="color:maroon">BIOSCODE:12E0                 </span><span style="color:navy">add     al, </span><span style="color:#ff8000">4           </span>; 3 -&gt; 6, 4 -&gt; 7, 6 -&gt; 9
<span style="color:maroon">BIOSCODE:12E2                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">7           </span>; 3.5 inch, 1.44 MB
<span style="color:maroon">BIOSCODE:12E4                 </span><span style="color:navy">jz      short </span>GotMediaType
<span style="color:maroon">BIOSCODE:12E6                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">9           </span>; 3.5 inch, 2.88 MB
<span style="color:maroon">BIOSCODE:12E8                 </span><span style="color:navy">jnz     short </span>UnknownMediaType ; Just didn&#039;t recognize media type
<span style="color:maroon">BIOSCODE:12EA
BIOSCODE:12EA </span>GotMediaType<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:12EA                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">1</span><span style="color:navy">], al      </span>; [bx+A_MEDIA_SENSE.MS_DEVICETYPE]
<span style="color:maroon">BIOSCODE:12ED                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:12EE                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:12EF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:12EF
BIOSCODE:12EF </span>MediaSenseErr<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:12EF                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">32h         </span>; non-default media /
<span style="color:maroon">BIOSCODE:12EF                                         </span>; drive does not support media type
<span style="color:maroon">BIOSCODE:12F2                 </span><span style="color:navy">jz      short </span>DetermineMediaType
<span style="color:maroon">BIOSCODE:12F4                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">2           </span>; function supported but, drive not ready
<span style="color:maroon">BIOSCODE:12F6                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">31h         </span>; no such drive / media not present
<span style="color:maroon">BIOSCODE:12F9                 </span><span style="color:navy">jz      short </span>SenseErrExit
<span style="color:maroon">BIOSCODE:12FB
BIOSCODE:12FB </span>UnknownMediaType<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:12FB                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">7           </span>; error_unknown_media
<span style="color:maroon">BIOSCODE:12FD
BIOSCODE:12FD </span>SenseErrExit<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:12FD                 </span><span style="color:navy">mov     ah, </span><span style="color:green">81h         </span>; Return this status in case of carry
<span style="color:maroon">BIOSCODE:12FF                 </span><span style="color:navy">stc
</span><span style="color:maroon">BIOSCODE:1300                 </span><span style="color:navy">retn
</span><span style="color:maroon">BIOSCODE:1300 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">BIOSCODE:1301                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:maroon">BIOSCODE:1302 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1302
BIOSCODE:1302 </span>i2f_handler<span style="color:navy">:
</span><span style="color:maroon">BIOSCODE:1302                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">13h
</span><span style="color:maroon">BIOSCODE:1305                 </span><span style="color:navy">jz      short </span>int2f_replace_int13
<span style="color:maroon">BIOSCODE:1307                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">8
</span><span style="color:maroon">BIOSCODE:130A                 </span><span style="color:navy">jz      short </span>mine
<span style="color:maroon">BIOSCODE:130C                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">16h
</span><span style="color:maroon">BIOSCODE:130F                 </span><span style="color:navy">jz      short </span>win386call
<span style="color:maroon">BIOSCODE:1311                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">4Ah
</span><span style="color:maroon">BIOSCODE:1314                 </span><span style="color:navy">jnz     short </span>i2f_handler_iret
<span style="color:maroon">BIOSCODE:1316                 </span><span style="color:navy">jmp     </span>handle_multmult
<span style="color:maroon">BIOSCODE:1319 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1319
BIOSCODE:1319 </span>i2f_handler_iret<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1319                 </span><span style="color:navy">iret
</span><span style="color:maroon">BIOSCODE:131A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:131A
BIOSCODE:131A </span>int2f_replace_int13<span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:131A                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSCODE:131B                 </span><span style="color:navy">mov     ax, ds
</span><span style="color:maroon">BIOSCODE:131D                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:1322                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:1322                 </span><span style="color:navy">push    word ptr ds:</span>Orig13
<span style="color:maroon">BIOSCODE:1326                 </span><span style="color:navy">push    word ptr ds:</span>Orig13<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:maroon">BIOSCODE:132A                 </span><span style="color:navy">push    word ptr ds:</span>Old13
<span style="color:maroon">BIOSCODE:132E                 </span><span style="color:navy">push    word ptr ds:</span>Old13<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:maroon">BIOSCODE:1332                 </span><span style="color:navy">mov     word ptr ds:</span>Orig13<span style="color:navy">, dx
</span><span style="color:maroon">BIOSCODE:1336                 </span><span style="color:navy">mov     word ptr ds:</span>Orig13<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:maroon">BIOSCODE:1339                 </span><span style="color:navy">mov     word ptr ds:</span>Old13<span style="color:navy">, bx
</span><span style="color:maroon">BIOSCODE:133D                 </span><span style="color:navy">mov     word ptr ds:</span>Old13<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:maroon">BIOSCODE:1341                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:1342                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:1343                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:1344                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:1344                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSCODE:1345                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSCODE:1346
BIOSCODE:1346 </span>i2f_iret<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1346                 </span><span style="color:navy">iret
</span><span style="color:maroon">BIOSCODE:1347 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1347
BIOSCODE:1347 </span>mine<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1347                 </span><span style="color:navy">cmp     al, </span><span style="color:green">0F8h        </span>; iret on reserved functions
<span style="color:maroon">BIOSCODE:1349                 </span><span style="color:navy">jnb     short </span>i2f_iret
<span style="color:maroon">BIOSCODE:134B                 </span><span style="color:navy">or      al, al          </span>; a get installed state request?
<span style="color:maroon">BIOSCODE:134D                 </span><span style="color:navy">jnz     short </span>disp_func
<span style="color:maroon">BIOSCODE:134F                 </span><span style="color:navy">mov     al, </span><span style="color:green">0FFh
</span><span style="color:maroon">BIOSCODE:1351                 </span><span style="color:navy">jmp     short </span>i2f_iret
<span style="color:maroon">BIOSCODE:1353 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1353
BIOSCODE:1353 </span>disp_func<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1353                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1           </span>; request for installing bds?
<span style="color:maroon">BIOSCODE:1355                 </span><span style="color:navy">jz      short </span>do_subfun_01
<span style="color:maroon">BIOSCODE:1357                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3           </span>; get bds vector?
<span style="color:maroon">BIOSCODE:1359                 </span><span style="color:navy">jz      short </span>do_get_bds_vector
<span style="color:maroon">BIOSCODE:135B                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:135C                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:1361                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:1361                 </span><span style="color:navy">mov     word ptr ds:</span>ptrsav<span style="color:navy">, bx
</span><span style="color:maroon">BIOSCODE:1365                 </span><span style="color:navy">mov     word ptr ds:</span>ptrsav<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:maroon">BIOSCODE:1369                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:136A                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:136A                 </span><span style="color:navy">jmp     far ptr </span><span style="background:blue"><span style="color:navy">70h:898h</span></span> ; BIOSDATA:dsk_entry
<span style="color:maroon">BIOSCODE:136A                                         </span>;
<span style="color:maroon">BIOSCODE:136A                                         </span>; NOTE: jump to a FAR function, not an
<span style="color:maroon">BIOSCODE:136A                                         </span>; IRET type function. Callers of
<span style="color:maroon">BIOSCODE:136A                                         </span>; this int2f subfunction will have
<span style="color:maroon">BIOSCODE:136A                                         </span>; to be careful to do a popf
<span style="color:maroon">BIOSCODE:136F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:136F
BIOSCODE:136F </span>do_subfun_01<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:136F                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:1370                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:1371                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:1372                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:1373                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word ; BIOSDATA segment
<span style="color:maroon">BIOSCODE:1378                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:1378                 </span><span style="color:navy">call    </span>install_bds
<span style="color:maroon">BIOSCODE:137B                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:137C                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:137C                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:137D                 </span><span style="color:navy">jmp     short </span>i2f_iret
<span style="color:maroon">BIOSCODE:137F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:137F
BIOSCODE:137F </span>do_get_bds_vector<span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:137F                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:1384                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:1384                 </span><span style="color:navy">lds     di, ds:</span>start_bds
<span style="color:maroon">BIOSCODE:1388                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:1388
BIOSCODE:1388 </span>ii2f_iret<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1388                 </span><span style="color:navy">jmp     short </span>i2f_iret
<span style="color:maroon">BIOSCODE:138A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:138A
BIOSCODE:138A </span>win386call<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:138A                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:138B                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word ; BIOSDATA segment
<span style="color:maroon">BIOSCODE:1390                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:1390                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5           </span>; Win386_Init
<span style="color:maroon">BIOSCODE:1390                                         </span>; is it win386 initializing?
<span style="color:maroon">BIOSCODE:1392                 </span><span style="color:navy">jz      short </span>Win386Init
<span style="color:maroon">BIOSCODE:1394                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">6           </span>; Win386_Exit
<span style="color:maroon">BIOSCODE:1394                                         </span>; is it win386 exiting?
<span style="color:maroon">BIOSCODE:1396                 </span><span style="color:navy">jnz     short </span>win_iret
<span style="color:maroon">BIOSCODE:1398                 </span><span style="color:navy">test    dx, </span><span style="color:green">1           </span>; is it win386 or win286 dos extender?
<span style="color:maroon">BIOSCODE:139C                 </span><span style="color:navy">jnz     short </span>win_iret  ; if not win386, then continue
<span style="color:maroon">BIOSCODE:139E                 </span><span style="color:navy">and     ds:</span>IsWin386<span style="color:navy">, </span><span style="color:green">0  </span>; indicate that win386 is not present
<span style="color:maroon">BIOSCODE:13A3                 </span><span style="color:navy">jmp     short </span>win_iret
<span style="color:maroon">BIOSCODE:13A5 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:13A5
BIOSCODE:13A5 </span>Win386Init<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:13A5                 </span><span style="color:navy">test    dx, </span><span style="color:green">1           </span>; is it win386 or win286 dos extender?
<span style="color:maroon">BIOSCODE:13A9                 </span><span style="color:navy">jnz     short </span>win_iret  ; if not win386, then continue
<span style="color:maroon">BIOSCODE:13AB                 </span><span style="color:navy">or      ds:</span>IsWin386<span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:13B0                 </span><span style="color:navy">mov     word ptr ds:</span>SI_Next<span style="color:navy">, bx
</span><span style="color:maroon">BIOSCODE:13B4                 </span><span style="color:navy">mov     word ptr ds:</span>SI_Next<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es </span>; Hook our structure into chain
<span style="color:maroon">BIOSCODE:13B8                 </span><span style="color:navy">mov     bx, offset </span>Win386_SI ; point es:bx to Win386_SI
<span style="color:maroon">BIOSCODE:13BB                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:13BC                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:13BD                 </span>assume es:nothing
<span style="color:maroon">BIOSCODE:13BD
BIOSCODE:13BD </span>win_iret<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:13BD                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:13BE                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:13BE                 </span><span style="color:navy">jmp     short </span>i2f_iret  ; return back up the chain
<span style="color:maroon">BIOSCODE:13C0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:13C0
BIOSCODE:13C0 </span>handle_multmult<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:13C0                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:13C2                 </span><span style="color:navy">jnz     short </span>try_2
<span style="color:maroon">BIOSCODE:13C4                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:13C5                 </span><span style="color:navy">call    </span>HMAPtr          ; get offset of free HMA
<span style="color:maroon">BIOSCODE:13C8                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">BIOSCODE:13CB                 </span><span style="color:navy">mov     es, bx          </span>; seg of HMA
<span style="color:maroon">BIOSCODE:13CD                 </span>assume es:nothing
<span style="color:maroon">BIOSCODE:13CD                 </span><span style="color:navy">mov     bx, di
</span><span style="color:maroon">BIOSCODE:13CF                 </span><span style="color:navy">not     bx
</span><span style="color:maroon">BIOSCODE:13D1                 </span><span style="color:navy">or      bx, bx
</span><span style="color:maroon">BIOSCODE:13D3                 </span><span style="color:navy">jz      short </span>try_1
<span style="color:maroon">BIOSCODE:13D5                 </span><span style="color:navy">inc     bx
</span><span style="color:maroon">BIOSCODE:13D6
BIOSCODE:13D6 </span>try_1<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:13D6                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:13D7                 </span><span style="color:navy">jmp     short </span>ii2f_iret
<span style="color:maroon">BIOSCODE:13D9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:13D9
BIOSCODE:13D9 </span>try_2<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:13D9                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2           </span>; multMULTALLOCHMA
<span style="color:maroon">BIOSCODE:13DB                 </span><span style="color:navy">jnz     short </span>try_3
<span style="color:maroon">BIOSCODE:13DD                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:13DE                 </span><span style="color:navy">mov     di, </span><span style="color:green">0FFFFh      </span>; assume not enough space
<span style="color:maroon">BIOSCODE:13E1                 </span><span style="color:navy">mov     es, di
</span><span style="color:maroon">BIOSCODE:13E3                 </span><span style="color:navy">call    </span>HMAPtr          ; get offset of free HMA
<span style="color:maroon">BIOSCODE:13E6                 </span><span style="color:navy">cmp     di, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">BIOSCODE:13E9                 </span><span style="color:navy">jz      short </span>InsuffHMA
<span style="color:maroon">BIOSCODE:13EB                 </span><span style="color:navy">neg     di              </span>; free space in HMA
<span style="color:maroon">BIOSCODE:13ED                 </span><span style="color:navy">cmp     bx, di
</span><span style="color:maroon">BIOSCODE:13EF                 </span><span style="color:navy">jbe     short </span>try_4
<span style="color:maroon">BIOSCODE:13F1                 </span><span style="color:navy">mov     di, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">BIOSCODE:13F4                 </span><span style="color:navy">jmp     short </span>InsuffHMA
<span style="color:maroon">BIOSCODE:13F6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:13F6
BIOSCODE:13F6 </span>try_4<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:13F6                 </span><span style="color:navy">mov     di, ds:</span>FreeHMAPtr
<span style="color:maroon">BIOSCODE:13FA                 </span><span style="color:navy">add     bx, </span><span style="color:green">15
</span><span style="color:maroon">BIOSCODE:13FD                 </span><span style="color:navy">and     bx, </span><span style="color:green">0FFF0h
</span><span style="color:maroon">BIOSCODE:1400                 </span><span style="color:navy">add     ds:</span>FreeHMAPtr<span style="color:navy">, bx </span>; update the free pointer
<span style="color:maroon">BIOSCODE:1404                 </span><span style="color:navy">jnz     short </span>InsuffHMA
<span style="color:maroon">BIOSCODE:1406                 </span><span style="color:navy">mov     ds:</span>FreeHMAPtr<span style="color:navy">, </span><span style="color:green">0FFFFh </span>; -1
<span style="color:maroon">BIOSCODE:1406                                         </span>; no more HMA if we have wrapped
<span style="color:maroon">BIOSCODE:140C
BIOSCODE:140C </span>InsuffHMA<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:140C                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:140D                 </span><span style="color:navy">jmp     </span>ii2f_iret
<span style="color:maroon">BIOSCODE:1410 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1410
BIOSCODE:1410 </span>try_3<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1410                 </span><span style="color:navy">jmp     </span>ii2f_iret
<span style="color:black">BIOSCODE:1413
BIOSCODE:1413 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1413
BIOSCODE:1413
BIOSCODE:1413 </span>HMAPtr          proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1413                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:black">BIOSCODE:1418                 </span>assume ds:nothing
<span style="color:black">BIOSCODE:1418                 </span><span style="color:navy">mov     di, ds:</span>FreeHMAPtr
<span style="color:black">BIOSCODE:141C                 </span><span style="color:navy">cmp     di, </span><span style="color:green">0FFFFh
</span><span style="color:black">BIOSCODE:141F                 </span><span style="color:navy">jnz     short </span><span style="color:gray">HMAPtr_retn_
</span><span style="color:black">BIOSCODE:1421                 </span><span style="color:navy">cmp     ds:</span>SysinitPresent<span style="color:navy">, </span><span style="color:green">0
</span><span style="color:black">BIOSCODE:1426                 </span><span style="color:navy">jz      short </span><span style="color:gray">HMAPtr_retn_
</span><span style="color:black">BIOSCODE:1428                 </span><span style="color:navy">call    dword ptr ds:</span>MoveDOSIntoHMA ; call far [MoveDOSIntoHMA]
<span style="color:black">BIOSCODE:142C                 </span><span style="color:navy">mov     di, ds:</span>FreeHMAPtr
<span style="color:black">BIOSCODE:1430
BIOSCODE:1430 </span><span style="color:gray">HMAPtr_retn_</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1430                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1430 </span>HMAPtr          endp
<span style="color:black">BIOSCODE:1430
BIOSCODE:1431
BIOSCODE:1431 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1431
BIOSCODE:1431
BIOSCODE:1431 </span>move_sector     proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1431                 </span><span style="color:navy">cld
</span><span style="color:black">BIOSCODE:1432                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:1433                 </span><span style="color:navy">mov     cx, </span><span style="color:green">256
</span><span style="color:black">BIOSCODE:1436                 </span><span style="color:navy">cmp     si, </span><span style="color:green">0FE00h
</span><span style="color:black">BIOSCODE:143A                 </span><span style="color:navy">ja      short </span><span style="color:gray">movsec_bytes
</span><span style="color:black">BIOSCODE:143C                 </span><span style="color:navy">cmp     di, </span><span style="color:green">0FE00h
</span><span style="color:black">BIOSCODE:1440                 </span><span style="color:navy">ja      short </span><span style="color:gray">movsec_bytes
</span><span style="color:black">BIOSCODE:1442                 </span><span style="color:navy">rep movsw
</span><span style="color:black">BIOSCODE:1444                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:1445                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1446 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:1446
BIOSCODE:1446 </span><span style="color:gray">movsec_bytes</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1446                 </span><span style="color:navy">shl     cx, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:1448                 </span><span style="color:navy">rep movsb
</span><span style="color:black">BIOSCODE:144A                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:144B                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:144B </span>move_sector     endp
<span style="color:black">BIOSCODE:144B
BIOSCODE:144C
BIOSCODE:144C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:144C
BIOSCODE:144C
BIOSCODE:144C </span>check_wrap      proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:144C                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:144D                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSCODE:144E                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:144F                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:1450                 </span><span style="color:navy">call    </span>find_bds        ; get pointer to bds for drive in dl
<span style="color:black">BIOSCODE:1453                 </span><span style="color:navy">jb      short </span><span style="color:gray">no_wrap   </span>; finished if DOS doesn&#039;t use it
<span style="color:black">BIOSCODE:1455                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags],fnon_removable
<span style="color:black">BIOSCODE:145B                 </span><span style="color:navy">jz      short </span><span style="color:gray">no_wrap   </span>; no wrapping for removable media
<span style="color:black">BIOSCODE:145D                 </span><span style="color:navy">mov     bx, es:[di+</span><span style="color:#ff8000">13h</span><span style="color:navy">] </span>; [es:di+BDS.secpertrack]
<span style="color:black">BIOSCODE:1461                 </span><span style="color:navy">mov     ax, cx
</span><span style="color:black">BIOSCODE:1463                 </span><span style="color:navy">and     ax, </span><span style="color:green">3Fh         </span>; extract sector number
<span style="color:black">BIOSCODE:1466                 </span><span style="color:navy">cmp     ax, bx          </span>; are we going to wrap?
<span style="color:black">BIOSCODE:1468                 </span><span style="color:navy">jbe     short </span><span style="color:gray">no_wrap
</span><span style="color:black">BIOSCODE:146A                 </span><span style="color:navy">div     bl              </span>; ah=new sector #, al=# of head wraps
<span style="color:black">BIOSCODE:146C                 </span><span style="color:navy">or      ah, ah
</span><span style="color:black">BIOSCODE:146E                 </span><span style="color:navy">jnz     short </span><span style="color:gray">not_on_bound
</span><span style="color:black">BIOSCODE:1470                 </span><span style="color:navy">mov     ah, bl          </span>; set sector=BDS_BPB.BPB_SECTORSPERTRACK
<span style="color:black">BIOSCODE:1472                 </span><span style="color:navy">dec     al              </span>; if on boundary
<span style="color:black">BIOSCODE:1472                                         </span>; also decrement # of head wrap
<span style="color:black">BIOSCODE:1474
BIOSCODE:1474 </span><span style="color:gray">not_on_bound</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1474                 </span><span style="color:navy">and     cl, </span><span style="color:green">0C0h        </span>; zero out sector #
<span style="color:black">BIOSCODE:1477                 </span><span style="color:navy">or      cl, ah          </span>; or in new sector #
<span style="color:black">BIOSCODE:1479                 </span><span style="color:navy">xor     ah, ah          </span>; ax = # of head wraps
<span style="color:black">BIOSCODE:147B                 </span><span style="color:navy">inc     ax
</span><span style="color:black">BIOSCODE:147C                 </span><span style="color:navy">add     al, dh          </span>; add in starting head #
<span style="color:black">BIOSCODE:147E                 </span><span style="color:navy">adc     ah, </span><span style="color:#ff8000">0           </span>; catch any carry
<span style="color:black">BIOSCODE:1481                 </span><span style="color:navy">cmp     ax, es:[di+</span><span style="color:#ff8000">15h</span><span style="color:navy">] </span>; [es:di+BDS.heads]
<span style="color:black">BIOSCODE:1481                                         </span>; are we going to wrap around a head?
<span style="color:black">BIOSCODE:1485                 </span><span style="color:navy">jbe     short </span><span style="color:gray">no_wrap_head
</span><span style="color:black">BIOSCODE:1487                 </span><span style="color:navy">push    dx              </span>; preserve drive number and head number
<span style="color:black">BIOSCODE:1488                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSCODE:148A                 </span><span style="color:navy">mov     bx, es:[di+</span><span style="color:#ff8000">15h</span><span style="color:navy">] </span>; [es:di+BDS.heads]
<span style="color:black">BIOSCODE:148A                                         </span>; dx = new head #, ax = # of cylinder wraps
<span style="color:black">BIOSCODE:148E                 </span><span style="color:navy">div     bx
</span><span style="color:black">BIOSCODE:1490                 </span><span style="color:navy">or      dx, dx          </span>; if new head # is 0, then we are on the last head
<span style="color:black">BIOSCODE:1492                 </span><span style="color:navy">jnz     short </span><span style="color:gray">no_head_bound
</span><span style="color:black">BIOSCODE:1494                 </span><span style="color:navy">mov     dx, bx          </span>; on boundary. set to BDS_BPB.BPB_HEADS
<span style="color:black">BIOSCODE:1496                 </span><span style="color:navy">or      ax, ax          </span>; if we had some cylinder wraps,
<span style="color:black">BIOSCODE:1496                                         </span>; we need to reduce them by on
<span style="color:black">BIOSCODE:1498                 </span><span style="color:navy">jz      short </span><span style="color:gray">no_head_bound
</span><span style="color:black">BIOSCODE:149A                 </span><span style="color:navy">dec     ax              </span>; reduce number of cylinder wraps
<span style="color:black">BIOSCODE:149B
BIOSCODE:149B </span><span style="color:gray">no_head_bound</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:149B                 </span><span style="color:navy">mov     bh, dl          </span>; bh has new head number
<span style="color:black">BIOSCODE:149D                 </span><span style="color:navy">pop     dx              </span>; restore drive number and head number
<span style="color:black">BIOSCODE:149E                 </span><span style="color:navy">dec     bh
</span><span style="color:black">BIOSCODE:14A0                 </span><span style="color:navy">mov     dh, bh
</span><span style="color:black">BIOSCODE:14A2                 </span><span style="color:navy">mov     bh, cl
</span><span style="color:black">BIOSCODE:14A4                 </span><span style="color:navy">and     bh, </span><span style="color:green">3Fh         </span>; preserve sector number
<span style="color:black">BIOSCODE:14A7                 </span><span style="color:navy">mov     bl, </span><span style="color:green">6
</span><span style="color:black">BIOSCODE:14A9                 </span><span style="color:navy">xchg    cl, bl
</span><span style="color:black">BIOSCODE:14AB                 </span><span style="color:navy">shr     bl, cl          </span>; get ms cylinder bits to ls end
<span style="color:black">BIOSCODE:14AD                 </span><span style="color:navy">add     ch, al          </span>; add in cylinder wrap
<span style="color:black">BIOSCODE:14AF                 </span><span style="color:navy">adc     bl, ah          </span>; add in high byte
<span style="color:black">BIOSCODE:14B1                 </span><span style="color:navy">shl     bl, cl          </span>; move up to ms end
<span style="color:black">BIOSCODE:14B3                 </span><span style="color:navy">xchg    bl, cl          </span>; restore cylinder bits into cl
<span style="color:black">BIOSCODE:14B5                 </span><span style="color:navy">or      cl, bh          </span>; or in sector number
<span style="color:black">BIOSCODE:14B7
BIOSCODE:14B7 </span><span style="color:gray">no_wrap</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:14B7                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:14B8                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSCODE:14B9                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:14BA                 </span>assume es:nothing
<span style="color:black">BIOSCODE:14BA                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSCODE:14BB                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:14BC                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:14BD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:14BD
BIOSCODE:14BD </span><span style="color:gray">no_wrap_head</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:14BD                 </span><span style="color:navy">mov     dh, al          </span>; do not lose new head number
<span style="color:black">BIOSCODE:14BF                 </span><span style="color:navy">dec     dh              </span>; get it 0-based
<span style="color:black">BIOSCODE:14C1                 </span><span style="color:navy">jmp     short </span><span style="color:gray">no_wrap
</span><span style="color:black">BIOSCODE:14C1 </span>check_wrap      endp
<span style="color:black">BIOSCODE:14C1
BIOSCODE:14C3
BIOSCODE:14C3 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:14C3
BIOSCODE:14C3
BIOSCODE:14C3 </span>find_bds        proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:14C3                 </span><span style="color:navy">les     di, ds:</span>start_bds ; point es:di to first bds
<span style="color:black">BIOSCODE:14C7
BIOSCODE:14C7 </span><span style="color:gray">fbds_1</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:14C7                 </span><span style="color:navy">cmp     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], dl   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:14CB                 </span><span style="color:navy">jz      short </span><span style="color:gray">fbds_2
</span><span style="color:black">BIOSCODE:14CD                 </span><span style="color:navy">les     di, es:[di]     </span>; [es:di+BDS.link]
<span style="color:black">BIOSCODE:14CD                                         </span>; go to next bds
<span style="color:black">BIOSCODE:14D0                 </span><span style="color:navy">cmp     di, </span><span style="color:green">0FFFFh
</span><span style="color:black">BIOSCODE:14D3                 </span><span style="color:navy">jnz     short </span><span style="color:gray">fbds_1
</span><span style="color:black">BIOSCODE:14D5                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:14D6
BIOSCODE:14D6 </span><span style="color:gray">fbds_2</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:14D6                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:14D6 </span>find_bds        endp
<span style="color:black">BIOSCODE:14D6
BIOSCODE:14D7
BIOSCODE:14D7 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:14D7
BIOSCODE:14D7
BIOSCODE:14D7 </span>doint           proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:14D7                 </span><span style="color:navy">mov     dl, [bp+</span><span style="color:#ff8000">8</span><span style="color:navy">]      </span>; [bp+INT13FRAME.olddx]
<span style="color:black">BIOSCODE:14D7                                         </span>; get physical drive number
<span style="color:black">BIOSCODE:14DB                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">BIOSCODE:14DD                 </span><span style="color:navy">or      al, al
</span><span style="color:black">BIOSCODE:14DF                 </span><span style="color:navy">jz      short </span><span style="color:gray">dointdone </span>; if zero sectors, return ax=0
<span style="color:black">BIOSCODE:14E1                 </span><span style="color:navy">mov     ah, [bp+</span><span style="color:#ff8000">3</span><span style="color:navy">]      </span>; [bp+INT13FRAME.oldax+1]
<span style="color:black">BIOSCODE:14E1                                         </span>; get request code
<span style="color:black">BIOSCODE:14E5                 </span><span style="color:navy">push    word ptr [bp+</span><span style="color:#ff8000">10h</span><span style="color:navy">] </span>; [bp+INT13FRAME.oldf]
<span style="color:black">BIOSCODE:14E9                 </span><span style="color:navy">popf
</span><span style="color:black">BIOSCODE:14EA                 </span><span style="color:navy">call    far ptr </span><span style="background:blue"><span style="color:navy">70h:797h</span></span> ; call BIOSDATA:call_orig13
<span style="color:black">BIOSCODE:14EA                                         </span>; call DOSBIOSSEG:call_orig13
<span style="color:black">BIOSCODE:14EF                 </span><span style="color:navy">pushf
</span><span style="color:black">BIOSCODE:14F0                 </span><span style="color:navy">pop     word ptr [bp+</span><span style="color:#ff8000">10h</span><span style="color:navy">] </span>; [bp+INT13FRAME.oldf]
<span style="color:black">BIOSCODE:14F4
BIOSCODE:14F4 </span><span style="color:gray">dointdone</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:14F4                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:14F4 </span>doint           endp
<span style="color:black">BIOSCODE:14F4
BIOSCODE:14F4 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSCODE:14F5 </span>dtype_array     <span style="color:navy">dd </span><span style="color:#008040">400090h              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSCODE:14F5                                         </span>; 40h:90h is drive type array
<span style="color:maroon">BIOSCODE:14F9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:14F9
BIOSCODE:14F9 </span>format_special_stuff<span style="color:navy">:                   </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:14F9                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0   </span>; do we have changeline support?
<span style="color:maroon">BIOSCODE:14FE                 </span><span style="color:navy">jz      short </span>format_special_stuff_done ; brif not
<span style="color:maroon">BIOSCODE:1500                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:1501                 </span><span style="color:navy">mov     bx, </span><span style="color:green">140h        </span>; fchanged_by_format+fchanged
<span style="color:maroon">BIOSCODE:1504                 </span><span style="color:navy">call    </span>Set_Changed_DL  ; indicate that media changed by format
<span style="color:maroon">BIOSCODE:1507                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:1508                 </span><span style="color:navy">jmp     short </span>format_special_stuff_done
<span style="color:maroon">BIOSCODE:150A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:150A
BIOSCODE:150A </span>ec35_special_stuff<span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:150A                 </span><span style="color:navy">test    dl, dl          </span>; floppy or hard disk?
<span style="color:maroon">BIOSCODE:150C                 </span><span style="color:navy">js      short </span>ec35_special_stuff_done ; if hard drive, we&#039;re done
<span style="color:maroon">BIOSCODE:150E                 </span><span style="color:navy">push    ax              </span>; see if this PARTICULAR drive is ec35
<span style="color:maroon">BIOSCODE:150F                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSCODE:1510                 </span><span style="color:navy">mov     cl, dl          </span>; turn drive number into bit map
<span style="color:maroon">BIOSCODE:1512                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1           </span>; assume drive 0
<span style="color:maroon">BIOSCODE:1514                 </span><span style="color:navy">shl     al, cl          </span>; shift over correct number of times
<span style="color:maroon">BIOSCODE:1516                 </span><span style="color:navy">test    ds:</span>ec35_flag<span style="color:navy">, al </span>; electrically compatible 3.5 incher?
<span style="color:maroon">BIOSCODE:151A                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSCODE:151B                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSCODE:151C                 </span><span style="color:navy">jz      short </span>ec35_special_stuff_done ; done if this floppy is not an ec35
<span style="color:maroon">BIOSCODE:151E                 </span><span style="color:navy">push    bx              </span>; free up a far pointer (es:bx)
<span style="color:maroon">BIOSCODE:151F                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:1520                 </span><span style="color:navy">les     bx, cs:</span>dtype_array
<span style="color:maroon">BIOSCODE:1525                 </span><span style="color:navy">add     bl, dl
</span><span style="color:maroon">BIOSCODE:1527                 </span><span style="color:navy">adc     bh, </span><span style="color:#ff8000">0           </span>; find entry for this drive
<span style="color:maroon">BIOSCODE:152A                 </span><span style="color:navy">mov     byte ptr es:[bx], </span><span style="color:green">93h </span>; establish drive type as:
<span style="color:maroon">BIOSCODE:152A                                         </span>; (360k disk in 360k drive,
<span style="color:maroon">BIOSCODE:152A                                         </span>; no double-stepping, 250 kbs transfer rate)
<span style="color:maroon">BIOSCODE:152E                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:152F                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:1530                 </span><span style="color:navy">jmp     short </span>ec35_special_stuff_done
<span style="color:maroon">BIOSCODE:1532 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1532
BIOSCODE:1532 </span>ps2_special_stuff<span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1532                 </span><span style="color:navy">cmp     ds:</span>prevoper<span style="color:navy">, </span><span style="color:#ff8000">8  </span>; (ps2_30)
<span style="color:maroon">BIOSCODE:1532                                         </span>; read driver parm?
<span style="color:maroon">BIOSCODE:1537                 </span><span style="color:navy">jz      short </span>ps2_30_problem
<span style="color:maroon">BIOSCODE:1539                 </span><span style="color:navy">cmp     ds:</span>prevoper<span style="color:navy">, </span><span style="color:#ff8000">15h </span>; apparently function 15h fails, too
<span style="color:maroon">BIOSCODE:153E                 </span><span style="color:navy">jnz     short </span>ps2_special_stuff_done
<span style="color:maroon">BIOSCODE:1540
BIOSCODE:1540 </span>ps2_30_problem<span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1540                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSCODE:1541                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:1543                 </span><span style="color:navy">call    far ptr </span><span style="background:blue"><span style="color:navy">70h:797h</span></span> ; call BIOSDATA:call_orig13
<span style="color:maroon">BIOSCODE:1548                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSCODE:1549                 </span><span style="color:navy">jmp     short </span>ps2_special_stuff_done
<span style="color:maroon">BIOSCODE:154B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:154B
BIOSCODE:154B </span>i13z<span style="color:navy">:
</span><span style="color:maroon">BIOSCODE:154B                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:154C                 </span><span style="color:navy">mov     ds, cs:</span>Bios_Data_Word
<span style="color:maroon">BIOSCODE:1551                 </span><span style="color:navy">mov     ds:</span>prevoper<span style="color:navy">, ax </span>; save request
<span style="color:maroon">BIOSCODE:1554                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">5           </span>; romformat
<span style="color:maroon">BIOSCODE:1557                 </span><span style="color:navy">jz      short </span>format_special_stuff
<span style="color:maroon">BIOSCODE:1559
BIOSCODE:1559 </span>format_special_stuff_done<span style="color:navy">:              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1559                 </span><span style="color:navy">cmp     ds:</span>ec35_flag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; any electrically compat 3.5 inchers?
<span style="color:maroon">BIOSCODE:155E                 </span><span style="color:navy">jnz     short </span>ec35_special_stuff ; go handle it out of line if so
<span style="color:maroon">BIOSCODE:1560
BIOSCODE:1560 </span>ec35_special_stuff_done<span style="color:navy">:                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1560                 </span><span style="color:navy">call    far ptr </span><span style="background:blue"><span style="color:navy">70h:797h</span></span> ; call BIOSDATA:call_orig13
<span style="color:maroon">BIOSCODE:1565                 </span><span style="color:navy">pushf
</span><span style="color:maroon">BIOSCODE:1566                 </span><span style="color:navy">cmp     ds:</span>model_byte<span style="color:navy">, </span><span style="color:green">0FAh </span>; is this a ps2/30?
<span style="color:maroon">BIOSCODE:1566                                         </span>; mdl_ps2_30
<span style="color:maroon">BIOSCODE:156B                 </span><span style="color:navy">jz      short </span>ps2_special_stuff ; exit mainline to address special
<span style="color:maroon">BIOSCODE:156D
BIOSCODE:156D </span>ps2_special_stuff_done<span style="color:navy">:                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:156D                 </span><span style="color:navy">popf
</span><span style="color:maroon">BIOSCODE:156E                 </span><span style="color:navy">jb      short </span>goterr13  ; error on original orig13 call-thru?
<span style="color:maroon">BIOSCODE:1570
BIOSCODE:1570 </span>ret_from_i13<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1570                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:1571                 </span>assume ds:nothing
<span style="color:maroon">BIOSCODE:1571                 </span><span style="color:navy">retf    </span><span style="color:green">2               </span>; restore ds &amp; iret w/flags
<span style="color:maroon">BIOSCODE:1574 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1574
BIOSCODE:1574 </span>i13ret_ck_chglinerr<span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1574                 </span><span style="color:navy">jnb     short </span>ret_from_i13 ; done if not an error termination
<span style="color:maroon">BIOSCODE:1576
BIOSCODE:1576 </span>i13_ret_error<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1576                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">6           </span>; did i see a change event?
<span style="color:maroon">BIOSCODE:1579                 </span><span style="color:navy">jnz     short </span>int13b    ; skip if wrong error
<span style="color:maroon">BIOSCODE:157B                 </span><span style="color:navy">or      dl, dl          </span>; is this for the hard disk?
<span style="color:maroon">BIOSCODE:157D                 </span><span style="color:navy">js      short </span>int13b    ; yes, ignore
<span style="color:maroon">BIOSCODE:157F                 </span><span style="color:navy">cmp     ds:</span>fhave96<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">BIOSCODE:1584                 </span><span style="color:navy">jz      short </span>int13b    ; just in case ROM returned this
<span style="color:maroon">BIOSCODE:1584                                         </span>; error even though it told us it
<span style="color:maroon">BIOSCODE:1584                                         </span>; never would
<span style="color:maroon">BIOSCODE:1586                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:1587                 </span><span style="color:navy">mov     bx, </span><span style="color:green">40h         </span>; fchanged
<span style="color:maroon">BIOSCODE:158A                 </span><span style="color:navy">call    </span>Set_Changed_DL
<span style="color:maroon">BIOSCODE:158D                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:158E
BIOSCODE:158E </span>int13b<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:158E                 </span><span style="color:navy">stc                     </span>; now return the error
<span style="color:maroon">BIOSCODE:158F                 </span><span style="color:navy">jmp     short </span>ret_from_i13
<span style="color:maroon">BIOSCODE:1591 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1591
BIOSCODE:1591 </span>goterr13<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1591                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">9           </span>; dma error?
<span style="color:maroon">BIOSCODE:1594                 </span><span style="color:navy">jz      short </span>gotdmaerr
<span style="color:maroon">BIOSCODE:1596
BIOSCODE:1596 </span>goterr13_xxxx<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1596                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">11h         </span>; ecc error?
<span style="color:maroon">BIOSCODE:1599                 </span><span style="color:navy">jnz     short </span>i13_ret_error ; other error. just return back.
<span style="color:maroon">BIOSCODE:159B                 </span><span style="color:navy">cmp     ds:</span>media_set_for_format<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; formatting?
<span style="color:maroon">BIOSCODE:15A0                 </span><span style="color:navy">jz      short </span>i13_ret_error
<span style="color:maroon">BIOSCODE:15A2                 </span><span style="color:navy">cmp     byte ptr ds:</span>prevoper<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">2 </span>; ecc-corrected error
<span style="color:maroon">BIOSCODE:15A2                                         </span>; (2 = romread)
<span style="color:maroon">BIOSCODE:15A2                                         </span>; ECC correction only applies to reads
<span style="color:maroon">BIOSCODE:15A7                 </span><span style="color:navy">jnz     short </span>i13_ret_error
<span style="color:maroon">BIOSCODE:15A9                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:maroon">BIOSCODE:15AB                 </span><span style="color:navy">call    far ptr </span><span style="background:blue"><span style="color:navy">70h:797h</span></span> ; call BIOSDATA:call_orig13
<span style="color:maroon">BIOSCODE:15AB                                         </span>; call DOSBIOSSEG:call_orig13
<span style="color:maroon">BIOSCODE:15B0                 </span><span style="color:navy">mov     ax, ds:</span>prevoper
<span style="color:maroon">BIOSCODE:15B3                 </span><span style="color:navy">xor     ah, ah          </span>; return code = no error
<span style="color:maroon">BIOSCODE:15B5                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1           </span>; if request for one sector, assume ok
<span style="color:maroon">BIOSCODE:15B7                 </span><span style="color:navy">jz      short </span>ret_from_i13 ; return with carry clear
<span style="color:maroon">BIOSCODE:15B9                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:15BA                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSCODE:15BB                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">BIOSCODE:15BC                 </span><span style="color:navy">mov     ds:</span>number_of_sec<span style="color:navy">, al
</span><span style="color:maroon">BIOSCODE:15BF
BIOSCODE:15BF </span>loop_ecc<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:15BF                 </span><span style="color:navy">mov     ax, </span><span style="color:green">201h        </span>; read one sector
<span style="color:maroon">BIOSCODE:15C2                 </span><span style="color:navy">call    </span>check_wrap      ; get correct parameters for int 13
<span style="color:maroon">BIOSCODE:15C5                 </span><span style="color:navy">call    far ptr </span><span style="background:blue"><span style="color:navy">70h:797h</span></span> ; call BIOSDATA:call_orig13
<span style="color:maroon">BIOSCODE:15C5                                         </span>; call DOSBIOSSEG:call_orig13
<span style="color:maroon">BIOSCODE:15CA                 </span><span style="color:navy">jnb     short </span>ok11_op
<span style="color:maroon">BIOSCODE:15CC                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">9           </span>; DMA error during ECC read?
<span style="color:maroon">BIOSCODE:15CF                 </span><span style="color:navy">jz      short </span>handle_dma_during_ecc
<span style="color:maroon">BIOSCODE:15D1                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">11h         </span>; only allow ecc errors
<span style="color:maroon">BIOSCODE:15D4                 </span><span style="color:navy">jnz     short </span>ok11_exit_err
<span style="color:maroon">BIOSCODE:15D6                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0
</span><span style="color:maroon">BIOSCODE:15D8                 </span><span style="color:navy">xor     ax, ax          </span>; ecc error. reset the system again.
<span style="color:maroon">BIOSCODE:15D8                                         </span>; clear the error code so that if this
<span style="color:maroon">BIOSCODE:15D8                                         </span>; was the last sector, no error code
<span style="color:maroon">BIOSCODE:15D8                                         </span>; will be returned for the corrected read.
<span style="color:maroon">BIOSCODE:15D8                                         </span>; (clear carry too.)
<span style="color:maroon">BIOSCODE:15DA
BIOSCODE:15DA </span>ok11_op<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:15DA                 </span><span style="color:navy">dec     ds:</span>number_of_sec
<span style="color:maroon">BIOSCODE:15DE                 </span><span style="color:navy">jz      short </span>ok11_exit ; all done?
<span style="color:maroon">BIOSCODE:15E0                 </span><span style="color:navy">inc     cl              </span>; advance sector number
<span style="color:maroon">BIOSCODE:15E0                                         </span>; add 200h to address
<span style="color:maroon">BIOSCODE:15E2                 </span><span style="color:navy">inc     bh
</span><span style="color:maroon">BIOSCODE:15E4                 </span><span style="color:navy">inc     bh
</span><span style="color:maroon">BIOSCODE:15E6                 </span><span style="color:navy">jmp     short </span>loop_ecc
<span style="color:maroon">BIOSCODE:15E8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:15E8
BIOSCODE:15E8 </span>ok11_exit_err<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:15E8                 </span><span style="color:navy">stc                     </span>; set carry bit again.
<span style="color:maroon">BIOSCODE:15E9
BIOSCODE:15E9 </span>ok11_exit<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:15E9                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSCODE:15EA                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSCODE:15EB                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:15EC                 </span><span style="color:navy">jmp     short </span>i13ret_ck_chglinerr
<span style="color:maroon">BIOSCODE:15EE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:15EE
BIOSCODE:15EE </span>handle_dma_during_ecc<span style="color:navy">:                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:15EE                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:15EF                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:15F0                 </span><span style="color:navy">mov     bx, offset </span>disksector ; BIOSDATA:014Eh
<span style="color:maroon">BIOSCODE:15F3                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:15F4                 </span><span style="color:navy">pop     es              </span>; point es:bx to buffer
<span style="color:maroon">BIOSCODE:15F5                 </span><span style="color:navy">mov     ax, </span><span style="color:green">201h        </span>; read one sector
<span style="color:maroon">BIOSCODE:15F8                 </span><span style="color:navy">call    far ptr </span><span style="background:blue"><span style="color:navy">70h:797h</span></span> ; call BIOSDATA:call_orig13
<span style="color:maroon">BIOSCODE:15FD                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:15FE                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:15FF                 </span><span style="color:navy">jnb     short </span>handle_dma_during_ecc_noerr
<span style="color:maroon">BIOSCODE:1601                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">11h
</span><span style="color:maroon">BIOSCODE:1604                 </span><span style="color:navy">jnz     short </span>ok11_exit_err
<span style="color:maroon">BIOSCODE:1606
BIOSCODE:1606 </span>handle_dma_during_ecc_noerr<span style="color:navy">:            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1606                 </span><span style="color:navy">push    si
</span><span style="color:maroon">BIOSCODE:1607                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSCODE:1608                 </span><span style="color:navy">mov     di, bx
</span><span style="color:maroon">BIOSCODE:160A                 </span><span style="color:navy">mov     si, offset </span>disksector
<span style="color:maroon">BIOSCODE:160D                 </span><span style="color:navy">call    </span>move_sector
<span style="color:maroon">BIOSCODE:1610                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSCODE:1611                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">BIOSCODE:1612                 </span><span style="color:navy">jmp     short </span>ok11_op
<span style="color:maroon">BIOSCODE:1614 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1614
BIOSCODE:1614 </span>gotdmaerr<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1614                 </span><span style="color:navy">mov     ax, ds:</span>prevoper
<span style="color:maroon">BIOSCODE:1617                 </span><span style="color:navy">sti
</span><span style="color:maroon">BIOSCODE:1618                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">2           </span>; romread
<span style="color:maroon">BIOSCODE:161B                 </span><span style="color:navy">jb      short </span>i13_done_dmaerr
<span style="color:maroon">BIOSCODE:161D                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">4           </span>; romverify
<span style="color:maroon">BIOSCODE:1620                 </span><span style="color:navy">jz      short </span>intverify
<span style="color:maroon">BIOSCODE:1622                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">5           </span>; romformat
<span style="color:maroon">BIOSCODE:1625                 </span><span style="color:navy">jz      short </span>intformat
<span style="color:maroon">BIOSCODE:1627                 </span><span style="color:navy">ja      short </span>i13_done_dmaerr
<span style="color:maroon">BIOSCODE:1629                 </span><span style="color:navy">push    dx              </span>; set up stack frame here!
<span style="color:maroon">BIOSCODE:162A                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSCODE:162B                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:162C                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSCODE:162D                 </span><span style="color:navy">push    bp
</span><span style="color:maroon">BIOSCODE:162E                 </span><span style="color:navy">mov     bp, sp
</span><span style="color:maroon">BIOSCODE:1630                 </span><span style="color:navy">mov     dx, es          </span>; check for 64k boundary error
<span style="color:maroon">BIOSCODE:1632                 </span><span style="color:navy">shl     dx, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:1634                 </span><span style="color:navy">shl     dx, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:1636                 </span><span style="color:navy">shl     dx, </span><span style="color:green">1
</span><span style="color:maroon">BIOSCODE:1638                 </span><span style="color:navy">shl     dx, </span><span style="color:green">1           </span>; dx = dx*16
<span style="color:maroon">BIOSCODE:163A                 </span><span style="color:navy">add     dx, bx
</span><span style="color:maroon">BIOSCODE:163C                 </span><span style="color:navy">add     dx, </span><span style="color:green">511
</span><span style="color:maroon">BIOSCODE:1640                 </span><span style="color:navy">jnb     short </span>no_skip_first
<span style="color:maroon">BIOSCODE:1642                 </span><span style="color:navy">jmp     </span>bufferx         ; restore dh=head &amp; do buffer
<span style="color:maroon">BIOSCODE:1645 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1645
BIOSCODE:1645 </span>no_skip_first<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1645                 </span><span style="color:navy">shr     dh, </span><span style="color:green">1           </span>; dh = number of sectors before address
<span style="color:maroon">BIOSCODE:1647                 </span><span style="color:navy">mov     ah, </span><span style="color:green">128         </span>; ah = max number of sectors in segment
<span style="color:maroon">BIOSCODE:1649                 </span><span style="color:navy">sub     ah, dh
</span><span style="color:maroon">BIOSCODE:164B                 </span><span style="color:navy">cmp     ah, al          </span>; can we fit it in?
<span style="color:maroon">BIOSCODE:164D                 </span><span style="color:navy">jb      short </span>doblock   ; no, perform blocking.
<span style="color:maroon">BIOSCODE:164D                                         </span>; yes, the request fits. let it happe
<span style="color:maroon">BIOSCODE:164F                 </span><span style="color:navy">mov     dh, [bp+</span><span style="color:#ff8000">9</span><span style="color:navy">]      </span>; [bp+INT13FRAME.olddx+1]
<span style="color:maroon">BIOSCODE:164F                                         </span>; set up head number
<span style="color:maroon">BIOSCODE:1652                 </span><span style="color:navy">call    </span>doint
<span style="color:maroon">BIOSCODE:1655                 </span><span style="color:navy">jmp     </span>bad13           ; and return from this place
<span style="color:maroon">BIOSCODE:1658 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1658
BIOSCODE:1658 </span>i13_done_dmaerr<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1658                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">9           </span>; pass dma error thru to caller
<span style="color:maroon">BIOSCODE:165A                 </span><span style="color:navy">stc
</span><span style="color:maroon">BIOSCODE:165B                 </span><span style="color:navy">jmp     </span>ret_from_i13    ; return with error,
<span style="color:maroon">BIOSCODE:165B                                         </span>; we know it&#039;s not a changeline error
<span style="color:maroon">BIOSCODE:165E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:165E
BIOSCODE:165E </span>intverify<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:165E                 </span><span style="color:navy">push    es              </span>; save caller&#039;s dma address
<span style="color:maroon">BIOSCODE:165F                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:1660                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:1661                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:1662
BIOSCODE:1662 </span>dosimple<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1662                 </span><span style="color:navy">mov     bx, offset </span>disksector ; es:bx -&gt; BIOSDATA:disksector
<span style="color:maroon">BIOSCODE:1665                 </span><span style="color:navy">call    far ptr </span><span style="background:blue"><span style="color:navy">70h:797h</span></span> ; call DOSBIOSSEG:call_orig13
<span style="color:maroon">BIOSCODE:1665                                         </span>; call BIOSDATA:call_orig13
<span style="color:maroon">BIOSCODE:166A                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:166B                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:166C                 </span><span style="color:navy">jmp     </span>i13ret_ck_chglinerr
<span style="color:maroon">BIOSCODE:166F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:166F
BIOSCODE:166F </span>intformat<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:166F                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:1670                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:1671                 </span><span style="color:navy">push    si
</span><span style="color:maroon">BIOSCODE:1672                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSCODE:1673                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:1674                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:1675                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:1676                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:1677                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:1678                 </span><span style="color:navy">mov     si, bx
</span><span style="color:maroon">BIOSCODE:167A                 </span><span style="color:navy">mov     di, offset </span>disksector ; user&#039;s data into BIOSDATA:disksector
<span style="color:maroon">BIOSCODE:167D                 </span><span style="color:navy">call    </span>move_sector
<span style="color:maroon">BIOSCODE:1680                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:1681                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSCODE:1682                 </span><span style="color:navy">pop     si              </span>; do the i/o from
<span style="color:maroon">BIOSCODE:1683                 </span><span style="color:navy">jmp     short </span>dosimple  ; BIOSDATA:disksector
<span style="color:maroon">BIOSCODE:1685 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:1685
BIOSCODE:1685 </span>doblock<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1685                 </span><span style="color:navy">mov     dx, [bp+</span><span style="color:#ff8000">8</span><span style="color:navy">]      </span>; [bp+INT13FRAME.olddx]
<span style="color:maroon">BIOSCODE:1685                                         </span>; get head #, drive #
<span style="color:maroon">BIOSCODE:1688                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">BIOSCODE:1689                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:168A                 </span><span style="color:navy">push    di              </span>; ah - # of sectors before dma boundary
<span style="color:maroon">BIOSCODE:168A                                         </span>; al - requested # of sectors for i/o.
<span style="color:maroon">BIOSCODE:168B                 </span><span style="color:navy">call    </span>find_bds
<span style="color:maroon">BIOSCODE:168E                 </span><span style="color:navy">mov     cx, es:[di+</span><span style="color:#ff8000">13h</span><span style="color:navy">] </span>; [es:di+BDS.secpertrack]
<span style="color:maroon">BIOSCODE:1692                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:di+BDS.flags], fnon_removable
<span style="color:maroon">BIOSCODE:1698                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSCODE:1699                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:169A                 </span><span style="color:navy">mov     al, ah          </span>; set al=ah for floppies
<span style="color:maroon">BIOSCODE:169C                 </span><span style="color:navy">jz      short </span>doblockflop ; they are track by track operation
<span style="color:maroon">BIOSCODE:169E                 </span><span style="color:navy">mov     ah, </span><span style="color:green">63          </span>; ah = 63-secpt (# safe sectors??)
<span style="color:maroon">BIOSCODE:16A0                 </span><span style="color:navy">sub     ah, cl          </span>; al - # of sectors before dma boundary
<span style="color:maroon">BIOSCODE:16A2
BIOSCODE:16A2 </span>doblockflop<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:16A2                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSCODE:16A3
BIOSCODE:16A3 </span>doblockcontinue<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:16A3                 </span><span style="color:navy">cmp     ah, al          </span>; if safe_# &gt;= #_of_sectors_to_go_before dma,
<span style="color:maroon">BIOSCODE:16A5                 </span><span style="color:navy">jnb     short </span>doblocklast ; then #_of_sectors_to_go as it is for doint.
<span style="color:maroon">BIOSCODE:16A7                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSCODE:16A8                 </span><span style="color:navy">mov     al, ah          </span>; otherwise, set al to ah to operate.
<span style="color:maroon">BIOSCODE:16AA                 </span><span style="color:navy">jmp     short </span>doblockdoint
<span style="color:maroon">BIOSCODE:16AC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:16AC
BIOSCODE:16AC </span>doblocklast<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:16AC                 </span><span style="color:navy">mov     ah, al
</span><span style="color:maroon">BIOSCODE:16AE                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">BIOSCODE:16AF
BIOSCODE:16AF </span>doblockdoint<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:16AF                 </span><span style="color:navy">call    </span>doint
<span style="color:maroon">BIOSCODE:16B2                 </span><span style="color:navy">jb      short </span>bad13
<span style="color:maroon">BIOSCODE:16B4                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">BIOSCODE:16B5                 </span><span style="color:navy">sub     [bp+</span><span style="color:#ff8000">2</span><span style="color:navy">], ah
</span><span style="color:maroon">BIOSCODE:16B8                 </span><span style="color:navy">add     cl, ah
</span><span style="color:maroon">BIOSCODE:16BA                 </span><span style="color:navy">add     bh, ah
</span><span style="color:maroon">BIOSCODE:16BC                 </span><span style="color:navy">add     bh, ah
</span><span style="color:maroon">BIOSCODE:16BE                 </span><span style="color:navy">cmp     ah, al
</span><span style="color:maroon">BIOSCODE:16C0                 </span><span style="color:navy">jz      short </span>buffer
<span style="color:maroon">BIOSCODE:16C2                 </span><span style="color:navy">sub     al, ah
</span><span style="color:maroon">BIOSCODE:16C4                 </span><span style="color:navy">call    </span>check_wrap
<span style="color:maroon">BIOSCODE:16C7                 </span><span style="color:navy">jmp     short </span>doblockcontinue
<span style="color:maroon">BIOSCODE:16C9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:16C9
BIOSCODE:16C9 </span>bufferx<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:16C9                 </span><span style="color:navy">mov     dh, [bp+</span><span style="color:#ff8000">9</span><span style="color:navy">]      </span>; [bp+INT13FRAME.olddx+1]
<span style="color:maroon">BIOSCODE:16C9                                         </span>; set up head number
<span style="color:maroon">BIOSCODE:16CC
BIOSCODE:16CC </span>buffer<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:16CC                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:16CD                 </span><span style="color:navy">mov     ah, [bp+</span><span style="color:#ff8000">3</span><span style="color:navy">]      </span>; [bp+INT13FRAME.oldax+1]
<span style="color:maroon">BIOSCODE:16D0                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">3           </span>; romwrite
<span style="color:maroon">BIOSCODE:16D3                 </span><span style="color:navy">jnz     short </span>doread
<span style="color:maroon">BIOSCODE:16D5                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:16D6                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:16D7                 </span><span style="color:navy">push    si
</span><span style="color:maroon">BIOSCODE:16D8                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSCODE:16D9                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:16DA                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:16DB                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">BIOSCODE:16DC                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:16DD                 </span><span style="color:navy">mov     di, offset </span>disksector ; where to move
<span style="color:maroon">BIOSCODE:16E0                 </span><span style="color:navy">push    di              </span>; save it
<span style="color:maroon">BIOSCODE:16E1                 </span><span style="color:navy">mov     si, bx          </span>; source
<span style="color:maroon">BIOSCODE:16E3                 </span><span style="color:navy">call    </span>move_sector     ; move sector into local buffer
<span style="color:maroon">BIOSCODE:16E6                 </span><span style="color:navy">pop     bx              </span>; new transfer address
<span style="color:maroon">BIOSCODE:16E6                                         </span>; (es:bx = BIOSDATA:disksector)
<span style="color:maroon">BIOSCODE:16E7                 </span><span style="color:navy">pop     di              </span>; restore caller&#039;s di &amp; si
<span style="color:maroon">BIOSCODE:16E8                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">BIOSCODE:16E9                 </span><span style="color:navy">pop     ds              </span>; restore BIOSDATA
<span style="color:maroon">BIOSCODE:16EA                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:16EC                 </span><span style="color:navy">mov     dl, [bp+</span><span style="color:#ff8000">8</span><span style="color:navy">]      </span>; [bp+INT13FRAME.olddx]
<span style="color:maroon">BIOSCODE:16EC                                         </span>; get drive number
<span style="color:maroon">BIOSCODE:16EF                 </span><span style="color:navy">call    </span>check_wrap      ; sets up registers if wrap-around
<span style="color:maroon">BIOSCODE:16EF                                         </span>;
<span style="color:maroon">BIOSCODE:16EF                                         </span>; ah is function
<span style="color:maroon">BIOSCODE:16EF                                         </span>; al is 1 for single sector transfer
<span style="color:maroon">BIOSCODE:16EF                                         </span>; es:bx is local transfer addres
<span style="color:maroon">BIOSCODE:16EF                                         </span>; cx is track/sector number
<span style="color:maroon">BIOSCODE:16EF                                         </span>; dx is head/drive number
<span style="color:maroon">BIOSCODE:16EF                                         </span>; si, di unchanged
<span style="color:maroon">BIOSCODE:16F2                 </span><span style="color:navy">call    </span>doint
<span style="color:maroon">BIOSCODE:16F5                 </span><span style="color:navy">pop     es              </span>; restore caller&#039;s dma segment
<span style="color:maroon">BIOSCODE:16F6                 </span><span style="color:navy">jb      short </span>bad13     ; go clean up
<span style="color:maroon">BIOSCODE:16F8                 </span><span style="color:navy">jmp     short </span>dotail
<span style="color:maroon">BIOSCODE:16FA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:16FA
BIOSCODE:16FA </span>doread<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:16FA                 </span><span style="color:navy">push    es
</span><span style="color:maroon">BIOSCODE:16FB                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">BIOSCODE:16FC                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">BIOSCODE:16FD                 </span><span style="color:navy">pop     es              </span>; es = BIOSCODE segment
<span style="color:maroon">BIOSCODE:16FE                 </span><span style="color:navy">mov     bx, offset </span>disksector
<span style="color:maroon">BIOSCODE:1701                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1
</span><span style="color:maroon">BIOSCODE:1703                 </span><span style="color:navy">mov     dl, [bp+</span><span style="color:#ff8000">8</span><span style="color:navy">]      </span>; [bp+INT13FRAME.olddx]
<span style="color:maroon">BIOSCODE:1703                                         </span>; get drive number
<span style="color:maroon">BIOSCODE:1706                 </span><span style="color:navy">call    </span>check_wrap      ; ah = function
<span style="color:maroon">BIOSCODE:1706                                         </span>; al = 1 for single sector
<span style="color:maroon">BIOSCODE:1706                                         </span>; es:bx points to local   buffer
<span style="color:maroon">BIOSCODE:1706                                         </span>; cx, dx are track/sector, head/drive
<span style="color:maroon">BIOSCODE:1709                 </span><span style="color:navy">call    </span>doint
<span style="color:maroon">BIOSCODE:170C                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:170D                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">BIOSCODE:170E                 </span><span style="color:navy">jb      short </span>bad13
<span style="color:maroon">BIOSCODE:1710                 </span><span style="color:navy">push    si
</span><span style="color:maroon">BIOSCODE:1711                 </span><span style="color:navy">push    di
</span><span style="color:maroon">BIOSCODE:1712                 </span><span style="color:navy">mov     di, bx
</span><span style="color:maroon">BIOSCODE:1714                 </span><span style="color:navy">mov     si, offset </span>disksector
<span style="color:maroon">BIOSCODE:1717                 </span><span style="color:navy">call    </span>move_sector
<span style="color:maroon">BIOSCODE:171A                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">BIOSCODE:171B                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">BIOSCODE:171C
BIOSCODE:171C </span>dotail<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:171C                 </span><span style="color:navy">pop     bx              </span>; retrieve new dma area
<span style="color:maroon">BIOSCODE:171D                 </span><span style="color:navy">add     bh, </span><span style="color:#ff8000">2           </span>; advance over sector
<span style="color:maroon">BIOSCODE:1720                 </span><span style="color:navy">inc     cx
</span><span style="color:maroon">BIOSCODE:1721                 </span><span style="color:navy">mov     al, [bp+</span><span style="color:#ff8000">2</span><span style="color:navy">]      </span>; [bp+INT13FRAME.oldax]
<span style="color:maroon">BIOSCODE:1724                 </span><span style="color:navy">clc
</span><span style="color:maroon">BIOSCODE:1725                 </span><span style="color:navy">dec     al
</span><span style="color:maroon">BIOSCODE:1727                 </span><span style="color:navy">jz      short </span>bad13     ; no more i/o
<span style="color:maroon">BIOSCODE:1729                 </span><span style="color:navy">mov     dl, [bp+</span><span style="color:#ff8000">8</span><span style="color:navy">]      </span>; [bp+INT13FRAME.olddx]
<span style="color:maroon">BIOSCODE:172C                 </span><span style="color:navy">call    </span>check_wrap
<span style="color:maroon">BIOSCODE:172F                 </span><span style="color:navy">call    </span>doint
<span style="color:maroon">BIOSCODE:1732
BIOSCODE:1732 </span>bad13<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:1732                 </span><span style="color:navy">mov     sp, bp
</span><span style="color:maroon">BIOSCODE:1734                 </span><span style="color:navy">pop     bp
</span><span style="color:maroon">BIOSCODE:1735                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:1736                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">BIOSCODE:1737                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">BIOSCODE:1738                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">BIOSCODE:1739                 </span><span style="color:navy">jb      short </span>xgoterr13_xxxx ; go handle ECC errors
<span style="color:maroon">BIOSCODE:173B                 </span><span style="color:navy">jmp     </span>ret_from_i13    ; non-error exit
<span style="color:maroon">BIOSCODE:173E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">BIOSCODE:173E
BIOSCODE:173E </span>xgoterr13_xxxx<span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:maroon">BIOSCODE:173E                 </span><span style="color:navy">jmp     </span>goterr13_xxxx
<span style="color:maroon">BIOSCODE:173E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">BIOSCODE:1741                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:black">BIOSCODE:1742
BIOSCODE:1742 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1742
BIOSCODE:1742
BIOSCODE:1742 </span>dsk_init        proc near               <span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:1742                 </span><span style="color:navy">mov     ah, ds:</span>drvmax
<span style="color:black">BIOSCODE:1746                 </span><span style="color:navy">mov     di, offset </span>dskdrvs ; pass result in es:di
<span style="color:black">BIOSCODE:1749                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:174A                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:174B                 </span><span style="color:navy">jmp     </span>SetPtrSav
<span style="color:black">BIOSCODE:174B </span>dsk_init        endp
<span style="color:black">BIOSCODE:174B
BIOSCODE:174E
BIOSCODE:174E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:174E
BIOSCODE:174E
BIOSCODE:174E </span>install_bds     proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:174E                 </span><span style="color:navy">push    ds              </span>; save Bios_Data (BIOSDATA) segment
<span style="color:black">BIOSCODE:174F                 </span><span style="color:navy">mov     si, offset </span>start_bds ; beginning of chain
<span style="color:black">BIOSCODE:1752
BIOSCODE:1752 </span><span style="color:gray">loop_next_bds</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1752                 </span><span style="color:navy">lds     si, [si]        </span>; [si+BDS.link]
<span style="color:black">BIOSCODE:1752                                         </span>; fetch next bds
<span style="color:black">BIOSCODE:1754                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:1758                 </span><span style="color:navy">cmp     [si+</span><span style="color:#ff8000">4</span><span style="color:navy">], al      </span>; does this one share a physical
<span style="color:black">BIOSCODE:1758                                         </span>; drive with new one?
<span style="color:black">BIOSCODE:175B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">next_bds
</span><span style="color:black">BIOSCODE:175D                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">10h         </span>; fi_am_mult
<span style="color:black">BIOSCODE:175F                 </span><span style="color:navy">or      es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], bl </span>; [es:di+BDS.flags]
<span style="color:black">BIOSCODE:175F                                         </span>; set both of them to i_am_mult if so
<span style="color:black">BIOSCODE:1763                 </span><span style="color:navy">or      [si+</span><span style="color:#ff8000">23h</span><span style="color:navy">], bl    </span>; [si+BDS.flags]
<span style="color:black">BIOSCODE:1766                 </span><span style="color:navy">and     byte ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">0DFh </span>; [es:di+BDS.flags],~fi_own_physical
<span style="color:black">BIOSCODE:1766                                         </span>; we don&#039;t own it
<span style="color:black">BIOSCODE:176B                 </span><span style="color:navy">mov     bl, [si+</span><span style="color:#ff8000">23h</span><span style="color:navy">]    </span>; [si+BDS.flags]
<span style="color:black">BIOSCODE:176B                                         </span>; determine if changeline available
<span style="color:black">BIOSCODE:176E                 </span><span style="color:navy">and     bl, </span><span style="color:green">2           </span>; fchangeline
<span style="color:black">BIOSCODE:1771                 </span><span style="color:navy">or      es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], bl </span>; [es:di+BDS.flags]
<span style="color:black">BIOSCODE:1775
BIOSCODE:1775 </span><span style="color:gray">next_bds</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1775                 </span><span style="color:navy">cmp     word ptr [si], </span><span style="color:green">0FFFFh </span>; [si+BDS.link],-1
<span style="color:black">BIOSCODE:1775                                         </span>; are we at end of list?
<span style="color:black">BIOSCODE:1778                 </span><span style="color:navy">jnz     short </span><span style="color:gray">loop_next_bds
</span><span style="color:black">BIOSCODE:177A                 </span><span style="color:navy">mov     word ptr [si+</span><span style="color:#ff8000">2</span><span style="color:navy">], es </span>; [si+BDS.link+2], es
<span style="color:black">BIOSCODE:177A                                         </span>; install bds
<span style="color:black">BIOSCODE:177D                 </span><span style="color:navy">mov     [si], di
</span><span style="color:black">BIOSCODE:177F                 </span><span style="color:navy">mov     word ptr es:[di], </span><span style="color:green">0FFFFh </span>; [es:di+BDS.link],-1
<span style="color:black">BIOSCODE:177F                                         </span>; set next pointer to null
<span style="color:black">BIOSCODE:1784                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSCODE:1785                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">34h</span><span style="color:navy">] </span>; [es:di+BDS.rsecpertrack]
<span style="color:black">BIOSCODE:1789                 </span><span style="color:navy">cmp     al, ds:</span>eot
<span style="color:black">BIOSCODE:178D                 </span><span style="color:navy">jbe     short </span><span style="color:gray">_eot_ok
</span><span style="color:black">BIOSCODE:178F                 </span><span style="color:navy">mov     ds:</span>eot<span style="color:navy">, al
</span><span style="color:black">BIOSCODE:1792
BIOSCODE:1792 </span><span style="color:gray">_eot_ok</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1792                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1792 </span>install_bds     endp
<span style="color:black">BIOSCODE:1792
BIOSCODE:1793
BIOSCODE:1793 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1793
BIOSCODE:1793
BIOSCODE:1793 </span>swpdsk          proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1793                 </span><span style="color:navy">test    ds:</span>IsWin386<span style="color:navy">, </span><span style="color:green">1  </span>; Is win386 present?
<span style="color:black">BIOSCODE:1798                 </span><span style="color:navy">jz      short </span><span style="color:gray">no_win386 </span>; no, skip SetFocus
<span style="color:black">BIOSCODE:179A                 </span><span style="color:navy">call    far ptr </span><span style="background:blue"><span style="color:navy">70h:8D1h</span></span> ; call DOSBIOSSEG:V86_Crit_SetFocus
<span style="color:black">BIOSCODE:179A                                         </span>; call BIOSDATA:V86_Crit_SetFocus
<span style="color:black">BIOSCODE:179F
BIOSCODE:179F </span><span style="color:gray">no_win386</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:179F                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:17A0                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSCODE:17A1                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; [es:di+BDS.drivelet]
<span style="color:black">BIOSCODE:17A1                                         </span>; get the drive letter
<span style="color:black">BIOSCODE:17A5                 </span><span style="color:navy">mov     dh, dl
</span><span style="color:black">BIOSCODE:17A7                 </span><span style="color:navy">xor     dh, </span><span style="color:green">1
</span><span style="color:black">BIOSCODE:17AA                 </span><span style="color:navy">sub     cx, cx          </span>; nobody has handled swap disk
<span style="color:black">BIOSCODE:17AC                 </span><span style="color:navy">mov     ax, </span><span style="color:green">4A00h       </span>; multMULT&lt;&lt;8)|multMULTSWPDSK
<span style="color:black">BIOSCODE:17AC                                         </span>; broadcast code for swap disk
<span style="color:black">BIOSCODE:17AC                                         </span>; Broadcast it
<span style="color:black">BIOSCODE:17AF                 </span><span style="color:navy">int     </span><span style="color:green">2Fh
</span><span style="color:black">BIOSCODE:17B1                 </span><span style="color:navy">inc     cx
</span><span style="color:black">BIOSCODE:17B2                 </span><span style="color:navy">jz      short </span><span style="color:gray">swpdsk9
</span><span style="color:black">BIOSCODE:17B4                 </span><span style="color:navy">add     dl, &#039;</span><span style="color:green">A&#039;
</span><span style="color:black">BIOSCODE:17B7                 </span><span style="color:navy">mov     byte ptr cs:</span>drvlet<span style="color:navy">, dl </span><span style="color:gray">; &quot;A: and press any key when ready\r\n\n&quot;
</span><span style="color:black">BIOSCODE:17BC                 </span><span style="color:navy">mov     si, offset </span>sngmsg <span style="color:gray">; &quot;\r\nInsert diskette for drive &quot;
</span><span style="color:black">BIOSCODE:17BF                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSCODE:17C0                 </span><span style="color:navy">lods    byte ptr cs:[si] </span>; get the next character of the message
<span style="color:black">BIOSCODE:17C2
BIOSCODE:17C2 </span><span style="color:gray">wrmsg_loop</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:17C2                 </span><span style="color:navy">int     </span><span style="color:green">29h             </span>; DOS 2+ internal - FAST PUTCHAR
<span style="color:black">BIOSCODE:17C2                                         </span>; AL = character to display
<span style="color:black">BIOSCODE:17C4                 </span><span style="color:navy">lods    byte ptr cs:[si] </span>; get the next character of the message
<span style="color:black">BIOSCODE:17C6                 </span><span style="color:navy">or      al, al
</span><span style="color:black">BIOSCODE:17C8                 </span><span style="color:navy">jnz     short </span><span style="color:gray">wrmsg_loop
</span><span style="color:black">BIOSCODE:17CA                 </span><span style="color:navy">call    </span>con_flush       ; flush out keyboard queue
<span style="color:black">BIOSCODE:17CA                                         </span>; call rom-bios
<span style="color:black">BIOSCODE:17CD                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">BIOSCODE:17CF                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
<span style="color:black">BIOSCODE:17CF                                         </span>; Return: AH = scan code, AL = character
<span style="color:black">BIOSCODE:17D1                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSCODE:17D2
BIOSCODE:17D2 </span><span style="color:gray">swpdsk9</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:17D2                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSCODE:17D3                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:17D4                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:17D4 </span>swpdsk          endp
<span style="color:black">BIOSCODE:17D4
BIOSCODE:17D4 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSCODE:17D5 </span>sngmsg          <span style="color:navy">db </span><span style="color:green">0Dh</span><span style="color:navy">,</span><span style="color:green">0Ah              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSCODE:17D5                 </span><span style="color:navy">db &#039;Insert diskette for drive &#039;
</span><span style="color:gray">BIOSCODE:17F1 </span>drvlet          <span style="color:navy">db &#039;A: and press any key when ready&#039;,0Dh,0Ah </span><span style="color:#8080ff">; ...
</span><span style="color:gray">BIOSCODE:17F1                 </span><span style="color:navy">db </span><span style="color:green">0Ah</span><span style="color:navy">,</span><span style="color:green">0
</span><span style="color:black">BIOSCODE:1814
BIOSCODE:1814 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1814
BIOSCODE:1814
BIOSCODE:1814 </span>chkopcnt        proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1814                 </span><span style="color:navy">cmp     word ptr es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+BDS.opcnt]
<span style="color:black">BIOSCODE:1819                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1819 </span>chkopcnt        endp
<span style="color:black">BIOSCODE:1819
BIOSCODE:181A
BIOSCODE:181A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:181A
BIOSCODE:181A
BIOSCODE:181A </span>MediaCheck      proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:181A                 </span><span style="color:navy">call    </span>checksingle     ; make sure correct disk is in place
<span style="color:black">BIOSCODE:181D                 </span><span style="color:navy">xor     si, si
</span><span style="color:black">BIOSCODE:181F                 </span><span style="color:navy">call    </span>HasChange
<span style="color:black">BIOSCODE:1822                 </span><span style="color:navy">jz      short </span><span style="color:gray">mediaret
</span><span style="color:black">BIOSCODE:1824                 </span><span style="color:navy">call    </span>checkromchange  ; [es:di+BDS.flags], fchanged ; 40h
<span style="color:black">BIOSCODE:1824                                         </span>; (BDS offset 63)
<span style="color:black">BIOSCODE:1827                 </span><span style="color:navy">jnz     short </span><span style="color:gray">mediadovolid
</span><span style="color:black">BIOSCODE:1829                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:182A                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSCODE:182B                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:182F                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">16h
</span><span style="color:black">BIOSCODE:1831                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - FLOPPY DISK - CHANGE OF DISK STATUS (AT,XT2,XT286,CONV,PS)
<span style="color:black">BIOSCODE:1831                                         </span>; DL = drive to check
<span style="color:black">BIOSCODE:1831                                         </span>; Return: AH = disk change status
<span style="color:black">BIOSCODE:1833                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSCODE:1834                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:1835                 </span><span style="color:navy">jb      short </span><span style="color:gray">mediadovolid
</span><span style="color:black">BIOSCODE:1837                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">1
</span><span style="color:black">BIOSCODE:183A                 </span><span style="color:navy">mov     bl, ds:</span>tim_drv  ; get last drive accessed
<span style="color:black">BIOSCODE:183E                 </span><span style="color:navy">cmp     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], bl   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:183E                                         </span>; (If the last drive accessed is not current drive
<span style="color:black">BIOSCODE:183E                                         </span>; media change status may be incorrect. So,
<span style="color:black">BIOSCODE:183E                                         </span>; &quot;I don&#039;t now&quot; will be returned even if it is indicated
<span style="color:black">BIOSCODE:183E                                         </span>; as media is not changed.)
<span style="color:black">BIOSCODE:1842                 </span><span style="color:navy">jz      short </span><span style="color:gray">mediaret  </span>; (same drive, media changeline indication is reliable)
<span style="color:black">BIOSCODE:1844                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:1845                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:1846                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSCODE:1847                 </span><span style="color:navy">call    </span>Check_Time_Of_Access
<span style="color:black">BIOSCODE:184A                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSCODE:184B                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:184C                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:184D                 </span><span style="color:navy">or      si, si
</span><span style="color:black">BIOSCODE:184F                 </span><span style="color:navy">jz      short </span><span style="color:gray">mediadovolid </span>; check_time says &quot;&gt;= 2 secs passed&quot;
<span style="color:black">BIOSCODE:184F                                         </span>; (volume id will be checked)
<span style="color:black">BIOSCODE:1851                 </span><span style="color:navy">xor     si, si          </span>; return &quot;i don&#039;t know&quot;
<span style="color:black">BIOSCODE:1853
BIOSCODE:1853 </span><span style="color:gray">mediaret</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1853                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1854 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:1854
BIOSCODE:1854 </span><span style="color:gray">mediadovolid</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1854                 </span><span style="color:navy">call    </span>GetBp           ; build a new bpb in current bds
<span style="color:black">BIOSCODE:1857                 </span><span style="color:navy">jb      short </span><span style="color:gray">mediaret
</span><span style="color:black">BIOSCODE:1859                 </span><span style="color:navy">call    </span>check_vid
<span style="color:black">BIOSCODE:185C                 </span><span style="color:navy">jnb     short </span><span style="color:gray">mediaret
</span><span style="color:black">BIOSCODE:185E                 </span><span style="color:navy">jmp     </span>maperror        ; fix up al for return to dos
<span style="color:black">BIOSCODE:185E </span>MediaCheck      endp
<span style="color:black">BIOSCODE:185E
BIOSCODE:1861
BIOSCODE:1861 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1861
BIOSCODE:1861
BIOSCODE:1861 </span>checklatchio    proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1861                 </span><span style="color:navy">call    </span>chkopcnt        ;  [es:di+BDS.opcnt] &gt; 0
<span style="color:black">BIOSCODE:1864                 </span><span style="color:navy">jz      short </span>checkret  ; done if zero
<span style="color:black">BIOSCODE:1866                 </span><span style="color:navy">call    </span>checkromchange  ; test [es:di+BDS.flags], fchanged ; 40h
<span style="color:black">BIOSCODE:1869                 </span><span style="color:navy">jz      short </span>checkret  ; not changed
<span style="color:black">BIOSCODE:186B                 </span><span style="color:navy">call    </span>GetBp
<span style="color:black">BIOSCODE:186E                 </span><span style="color:navy">jb      short </span><span style="color:gray">ret_no_error_map
</span><span style="color:black">BIOSCODE:1870                 </span><span style="color:navy">call    </span>check_vid
<span style="color:black">BIOSCODE:1873                 </span><span style="color:navy">jb      short </span><span style="color:gray">checklatchret
</span><span style="color:black">BIOSCODE:1875                 </span><span style="color:navy">or      si, si          </span>; is changed for sure?
<span style="color:black">BIOSCODE:1877                 </span><span style="color:navy">jns     short </span>checkret  ; no
<span style="color:black">BIOSCODE:1879                 </span><span style="color:navy">call    </span>returnvid       ; yes
<span style="color:black">BIOSCODE:187C
BIOSCODE:187C </span><span style="color:gray">checklatchret</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:187C                 </span><span style="color:navy">call    </span>maperror        ; fix up al for return to dos
<span style="color:black">BIOSCODE:187F
BIOSCODE:187F </span><span style="color:gray">ret_no_error_map</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:187F                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:1880                 </span><span style="color:navy">pop     si              </span>; pop off return address
<span style="color:black">BIOSCODE:1881
BIOSCODE:1881 </span>checkret<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1881                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1881 </span><span style="background:blue"><span style="color:navy">checklatchio    endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">BIOSCODE:1881
BIOSCODE:1882
BIOSCODE:1882 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1882
BIOSCODE:1882
BIOSCODE:1882 </span>checkfatvid     proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1882                 </span><span style="color:navy">call    </span>fat_check       ; check the fat and the vid
<span style="color:black">BIOSCODE:1885                 </span><span style="color:navy">or      si, si
</span><span style="color:black">BIOSCODE:1887                 </span><span style="color:navy">js      short </span>changed_drv ; fall into check_vid
<span style="color:black">BIOSCODE:1887 </span><span style="background:blue">checkfatvid     endp</span><span style="background:blue"> ; sp-analysis failed</span>
<span style="color:black">BIOSCODE:1887
BIOSCODE:1889
BIOSCODE:1889 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1889
BIOSCODE:1889
BIOSCODE:1889 </span>check_vid       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1889                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">+</span><span style="color:green">26h</span><span style="color:navy">, </span><span style="color:green">29h </span>; BS_FAT_BootSig ; BS_BootSig
<span style="color:black">BIOSCODE:1889                                         </span>; [disksector+EXT_BOOT.SIG],EXT_BOOT_SIGNATURE
<span style="color:black">BIOSCODE:188E                 </span><span style="color:navy">jz      short </span><span style="color:gray">do_ext_check_id
</span><span style="color:black">BIOSCODE:1890                 </span><span style="color:navy">call    </span>HasChange
<span style="color:black">BIOSCODE:1893                 </span><span style="color:navy">jz      short </span>checkret
<span style="color:black">BIOSCODE:1895                 </span><span style="color:navy">xor     si, si
</span><span style="color:black">BIOSCODE:1897                 </span><span style="color:navy">cmp     ds:</span>disksector<span style="color:navy">+</span><span style="color:green">10h</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; BPB_NumFATs
<span style="color:black">BIOSCODE:1897                                         </span>; [disksector+EXT_BOOT.BPB+EBPB.NUMBEROFFATS]
<span style="color:black">BIOSCODE:189C                 </span><span style="color:navy">jz      short </span>checkfatret ; don&#039;t read vol id if not fat system
<span style="color:black">BIOSCODE:189E                 </span><span style="color:navy">call    </span>read_volume_id
<span style="color:black">BIOSCODE:18A1                 </span><span style="color:navy">jb      short </span>checkfatret
<span style="color:black">BIOSCODE:18A3                 </span><span style="color:navy">call    </span>check_volume_id
<span style="color:black">BIOSCODE:18A6                 </span><span style="color:navy">mov     si, </span><span style="color:green">0FFFFh      </span>; -1
<span style="color:black">BIOSCODE:18A6                                         </span>; definitely changed
<span style="color:black">BIOSCODE:18A9                 </span><span style="color:navy">jnz     short </span>changed_drv
<span style="color:black">BIOSCODE:18AB                 </span><span style="color:navy">inc     si
</span><span style="color:black">BIOSCODE:18AC
BIOSCODE:18AC </span><span style="color:gray">vid_no_changed</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:18AC                 </span><span style="color:navy">call    </span>resetchanged
<span style="color:black">BIOSCODE:18AF                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:18B0
BIOSCODE:18B0 </span>checkfatret<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:18B0                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:18B1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:18B1
BIOSCODE:18B1 </span>changed_drv<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:18B1                 </span><span style="color:navy">clc                     </span>; cas -- return no error
<span style="color:black">BIOSCODE:18B2                 </span><span style="color:navy">mov     ds:</span>tim_drv<span style="color:navy">, </span><span style="color:green">0FFh </span>; ensure that we ask rom for media
<span style="color:black">BIOSCODE:18B2                                         </span>;  check next time round
<span style="color:black">BIOSCODE:18B7                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:18B8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:18B8
BIOSCODE:18B8 </span><span style="color:gray">do_ext_check_id</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:18B8                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:18B9                 </span><span style="color:navy">mov     ax, word ptr ds:</span>disksector<span style="color:navy">+</span><span style="color:green">27h </span>; [DiskSector+EXT_BOOT.SERIAL]
<span style="color:black">BIOSCODE:18BC                 </span><span style="color:navy">cmp     ax, es:[di+</span><span style="color:#ff8000">57h</span><span style="color:navy">] </span>; [DiskSector+EXT_BOOT.SERIAL] = [di+BDS.vol_serial] ?
<span style="color:black">BIOSCODE:18C0                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ext_changed </span>; no
<span style="color:black">BIOSCODE:18C2                 </span><span style="color:navy">mov     ax, word ptr ds:</span>disksector<span style="color:navy">+</span><span style="color:green">29h
</span><span style="color:black">BIOSCODE:18C5                 </span><span style="color:navy">cmp     ax, es:[di+</span><span style="color:#ff8000">59h</span><span style="color:navy">] </span>; [DiskSector+EXT_BOOT.SERIAL+2] = [di+BDS.vol_serial+2] ?
<span style="color:black">BIOSCODE:18C9                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ext_changed </span>; no
<span style="color:black">BIOSCODE:18CB                 </span><span style="color:navy">xor     si, si          </span>; don&#039;t know
<span style="color:black">BIOSCODE:18CD                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:18CE                 </span><span style="color:navy">jmp     short </span><span style="color:gray">vid_no_changed </span>; reset the flag
<span style="color:black">BIOSCODE:18D0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:18D0
BIOSCODE:18D0 </span><span style="color:gray">ext_changed</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:18D0                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:18D1                 </span><span style="color:navy">mov     si, </span><span style="color:green">0FFFFh      </span>; -1
<span style="color:black">BIOSCODE:18D1                                         </span>; disk changed!
<span style="color:black">BIOSCODE:18D4                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:18D5                 </span><span style="color:navy">jmp     short </span>changed_drv
<span style="color:black">BIOSCODE:18D5 </span>check_vid       endp
<span style="color:black">BIOSCODE:18D5
BIOSCODE:18D7
BIOSCODE:18D7 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:18D7
BIOSCODE:18D7
BIOSCODE:18D7 </span>checkio         proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:18D7                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">6
</span><span style="color:black">BIOSCODE:18DA                 </span><span style="color:navy">jnz     short </span>checkfatret
<span style="color:black">BIOSCODE:18DC                 </span><span style="color:navy">call    </span>chkopcnt        ; [es:di+BDS.opcnt] &gt; 0 ?
<span style="color:black">BIOSCODE:18DF                 </span><span style="color:navy">jz      short </span>checkfatret ; no
<span style="color:black">BIOSCODE:18E1                 </span><span style="color:navy">call    </span>GetBp
<span style="color:black">BIOSCODE:18E4                 </span><span style="color:navy">jb      short </span><span style="color:gray">no_error_map
</span><span style="color:black">BIOSCODE:18E6                 </span><span style="color:navy">call    </span>checkfatvid
<span style="color:black">BIOSCODE:18E9                 </span><span style="color:navy">jb      short </span><span style="color:gray">checkioret </span>; disk error trying to read in.
<span style="color:black">BIOSCODE:18EB                 </span><span style="color:navy">or      si, si          </span>; is changed for sure?
<span style="color:black">BIOSCODE:18ED                 </span><span style="color:navy">js      short </span><span style="color:gray">checkioerr </span>; yes changed
<span style="color:black">BIOSCODE:18EF                 </span><span style="color:navy">inc     bp              </span>; allow a retry
<span style="color:black">BIOSCODE:18F0                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:18F1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:18F1
BIOSCODE:18F1 </span><span style="color:gray">checkioerr</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:18F1                 </span><span style="color:navy">call    </span>returnvid
<span style="color:black">BIOSCODE:18F4
BIOSCODE:18F4 </span><span style="color:gray">checkioret</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:18F4                 </span><span style="color:navy">stc                     </span>; make sure carry gets passed through
<span style="color:black">BIOSCODE:18F5                 </span><span style="color:navy">jmp     </span>harderr
<span style="color:black">BIOSCODE:18F8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:18F8
BIOSCODE:18F8 </span><span style="color:gray">no_error_map</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:18F8                 </span><span style="color:navy">jmp     </span>harderr2
<span style="color:black">BIOSCODE:18F8 </span>checkio         endp
<span style="color:black">BIOSCODE:18F8
BIOSCODE:18FB
BIOSCODE:18FB </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:18FB
BIOSCODE:18FB
BIOSCODE:18FB </span>returnvid       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:18FB                 </span><span style="color:navy">mov     si, </span><span style="color:green">22          </span>; trans+8
<span style="color:black">BIOSCODE:18FB                                         </span>; offset into pointer to return value
<span style="color:black">BIOSCODE:18FE                 </span><span style="color:navy">call    </span>vid_into_packet
<span style="color:black">BIOSCODE:1901                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">6
</span><span style="color:black">BIOSCODE:1903                 </span><span style="color:navy">stc
</span><span style="color:black">BIOSCODE:1904                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1904 </span>returnvid       endp
<span style="color:black">BIOSCODE:1904
BIOSCODE:1905
BIOSCODE:1905 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1905
BIOSCODE:1905
BIOSCODE:1905 </span>Media_Set_vId   proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1905                 </span><span style="color:navy">mov     si, </span><span style="color:green">15          </span>; trans+1
<span style="color:black">BIOSCODE:1908
BIOSCODE:1908 </span>vid_into_packet<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1908                 </span><span style="color:navy">push    ds
</span><span style="color:black">BIOSCODE:1909                 </span><span style="color:navy">lds     bx, ds:</span>ptrsav
<span style="color:black">BIOSCODE:190D                 </span><span style="color:navy">add     di, </span><span style="color:green">75          </span>; BDS.volid (BDS offset 75)
<span style="color:black">BIOSCODE:1910                 </span><span style="color:navy">mov     [bx+si], di
</span><span style="color:black">BIOSCODE:1912                 </span><span style="color:navy">sub     di, </span><span style="color:green">75          </span>; BDS start (BDS offset 0)
<span style="color:black">BIOSCODE:1915                 </span><span style="color:navy">mov     word ptr [bx+si+</span><span style="color:#ff8000">2</span><span style="color:navy">], es
</span><span style="color:black">BIOSCODE:1918                 </span><span style="color:navy">pop     ds
</span><span style="color:black">BIOSCODE:1919                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1919 </span>Media_Set_vId   endp
<span style="color:black">BIOSCODE:1919
BIOSCODE:191A
BIOSCODE:191A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:191A
BIOSCODE:191A
BIOSCODE:191A </span>hidensity       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:191A                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">2 </span>; check for correct drive
<span style="color:black">BIOSCODE:191A                                         </span>; is it special?
<span style="color:black">BIOSCODE:191A                                         </span>; [es:di+BDS.flags], fchangeline
<span style="color:black">BIOSCODE:1920                 </span><span style="color:navy">jz      short </span><span style="color:gray">dofloppy  </span>; no, do normal floppy test
<span style="color:black">BIOSCODE:1922                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], </span><span style="color:#ff8000">2 </span>; is it single-media?
<span style="color:black">BIOSCODE:1927                 </span><span style="color:navy">jz      short </span><span style="color:gray">dofloppy  </span>; [es:di+BDS.formfactor], ffSmall
<span style="color:black">BIOSCODE:1927                                         </span>; yes, use fatid.
<span style="color:black">BIOSCODE:1929                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">0F9h
</span><span style="color:black">BIOSCODE:192C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">dofloppy
</span><span style="color:black">BIOSCODE:192E                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], </span><span style="color:#ff8000">7 </span>; [es:di+BDS.formfactor], ffOther
<span style="color:black">BIOSCODE:1933                 </span><span style="color:navy">jz      short </span><span style="color:gray">Is720K
</span><span style="color:black">BIOSCODE:1935                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], </span><span style="color:#ff8000">9 </span>; [es:di+BDS.formfactor], ff288
<span style="color:black">BIOSCODE:193A                 </span><span style="color:navy">jz      short </span><span style="color:gray">Is720K
</span><span style="color:black">BIOSCODE:193C                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">7           </span>; seven sectors / fat
<span style="color:black">BIOSCODE:193E                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0E00Fh      </span>; 224*256+0Fh (57359)
<span style="color:black">BIOSCODE:193E                                         </span>; 224 root dir entries &amp; 0Fh sector max
<span style="color:black">BIOSCODE:1941                 </span><span style="color:navy">mov     cx, </span><span style="color:green">2400        </span>; 80*15*2
<span style="color:black">BIOSCODE:1941                                         </span>; 80 tracks, 15 sectors/track, 2 sides
<span style="color:black">BIOSCODE:1944                 </span><span style="color:navy">mov     dx, </span><span style="color:green">258         </span>; 1*256+2
<span style="color:black">BIOSCODE:1944                                         </span>; sectors/allocation unit &amp; head max
<span style="color:black">BIOSCODE:1947                 </span><span style="color:navy">add     sp, </span><span style="color:green">2           </span>; pop off return address
<span style="color:black">BIOSCODE:194A                 </span><span style="color:navy">jmp     </span>Has1            ; return to tail of getbp
<span style="color:black">BIOSCODE:194D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:194D
BIOSCODE:194D </span><span style="color:gray">Is720K</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:194D                 </span><span style="color:navy">add     sp, </span><span style="color:green">2           </span>; pop off return address
<span style="color:black">BIOSCODE:1950                 </span><span style="color:navy">jmp     </span>Has720K         ; return to 720K code
<span style="color:black">BIOSCODE:1953 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:1953
BIOSCODE:1953 </span><span style="color:gray">dofloppy</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1953                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1953 </span><span style="background:blue"><span style="color:navy">hidensity       endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">BIOSCODE:1953
BIOSCODE:1954
BIOSCODE:1954 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1954
BIOSCODE:1954
BIOSCODE:1954 </span>Set_Changed_DL  proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1954                 </span><span style="color:navy">push    es
</span><span style="color:black">BIOSCODE:1955                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:1956                 </span><span style="color:navy">les     di, ds:</span>start_bds
<span style="color:black">BIOSCODE:195A
BIOSCODE:195A </span><span style="color:gray">scan_bds</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:195A                 </span><span style="color:navy">cmp     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], dl   </span>; [es:di+BDS.drivenum]
<span style="color:black">BIOSCODE:195E                 </span><span style="color:navy">jnz     short </span><span style="color:gray">get_next_bds
</span><span style="color:black">BIOSCODE:1960                 </span><span style="color:navy">or      es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], bx </span>; [es:di+BDS.flags]
<span style="color:black">BIOSCODE:1960                                         </span>; signal change on other drive
<span style="color:black">BIOSCODE:1964
BIOSCODE:1964 </span><span style="color:gray">get_next_bds</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1964                 </span><span style="color:navy">les     di, es:[di]     </span>; [es:di+BDS.link]
<span style="color:black">BIOSCODE:1964                                         </span>; go to next bds
<span style="color:black">BIOSCODE:1967                 </span><span style="color:navy">cmp     di, </span><span style="color:green">0FFFFh      </span>; loop unless end of chain
<span style="color:black">BIOSCODE:196A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">scan_bds
</span><span style="color:black">BIOSCODE:196C                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSCODE:196D                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:196E                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:196E </span>Set_Changed_DL  endp
<span style="color:black">BIOSCODE:196E
BIOSCODE:196F
BIOSCODE:196F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:196F
BIOSCODE:196F
BIOSCODE:196F </span>checkromchange  proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:196F                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">40h </span>; [es:di+BDS.flags], fchanged
<span style="color:black">BIOSCODE:1975                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1975 </span>checkromchange  endp
<span style="color:black">BIOSCODE:1975
BIOSCODE:1976
BIOSCODE:1976 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1976
BIOSCODE:1976
BIOSCODE:1976 </span>resetchanged    proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1976                 </span><span style="color:navy">and     word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">0FFBFh </span>; [es:di+BDS.flags], ~fchanged
<span style="color:black">BIOSCODE:197B                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:197B </span>resetchanged    endp
<span style="color:black">BIOSCODE:197B
BIOSCODE:197C
BIOSCODE:197C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:197C
BIOSCODE:197C
BIOSCODE:197C </span>HasChange       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:197C                 </span><span style="color:navy">test    word ptr es:[di+</span><span style="color:#ff8000">23h</span><span style="color:navy">], </span><span style="color:green">2 </span>; [es:di+BDS.flags], fchangeline
<span style="color:black">BIOSCODE:1982                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1982 </span>HasChange       endp
<span style="color:black">BIOSCODE:1982
BIOSCODE:1983
BIOSCODE:1983 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1983
BIOSCODE:1983
BIOSCODE:1983 </span>set_volume_id   proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1983                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSCODE:1984                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:1985                 </span><span style="color:navy">call    </span>HasChange       ; does drive have changeline support?
<span style="color:black">BIOSCODE:1988                 </span><span style="color:navy">jz      short </span><span style="color:gray">setvret   </span>; no, get out
<span style="color:black">BIOSCODE:198A                 </span><span style="color:navy">call    </span>read_volume_id
<span style="color:black">BIOSCODE:198D                 </span><span style="color:navy">jb      short </span><span style="color:gray">seterr
</span><span style="color:black">BIOSCODE:198F                 </span><span style="color:navy">call    </span>transfer_volume_id ; copy the volume id to special drive
<span style="color:black">BIOSCODE:1992                 </span><span style="color:navy">call    </span>resetchanged
<span style="color:black">BIOSCODE:1995
BIOSCODE:1995 </span><span style="color:gray">setvret</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1995                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:1996                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:1997                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSCODE:1998                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1999 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:1999
BIOSCODE:1999 </span><span style="color:gray">seterr</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1999                 </span><span style="color:navy">pop     dx              </span>; pop stack but don&#039;t overwrite ax
<span style="color:black">BIOSCODE:199A                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSCODE:199B                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:199B </span>set_volume_id   endp
<span style="color:black">BIOSCODE:199B
BIOSCODE:199B </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSCODE:199C </span>root_sec        <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:199E
BIOSCODE:199E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:199E
BIOSCODE:199E
BIOSCODE:199E </span>read_volume_id  proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:199E                 </span><span style="color:navy">push    dx
</span><span style="color:black">BIOSCODE:199F                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:19A0                 </span><span style="color:navy">push    bx
</span><span style="color:black">BIOSCODE:19A1                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:19A2                 </span><span style="color:navy">push    es              </span>; stack the bds last
<span style="color:black">BIOSCODE:19A3                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:19A4                 </span><span style="color:navy">push    ds              </span>; point es to Bios_Data (BIOSDATA)
<span style="color:black">BIOSCODE:19A5                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:19A6
BIOSCODE:19A6 </span><span style="color:navy">loc_3F66:                               </span><span style="color:#8080ff">; ...
</span><span style="color:black">BIOSCODE:19A6                 </span><span style="color:navy">mov     di, offset </span>tmp_vid <span style="color:gray">; &quot;NO NAME    &quot;
</span><span style="color:black">BIOSCODE:19A9                 </span><span style="color:navy">mov     si, offset </span>nul_vid <span style="color:gray">; &quot;NO NAME    &quot;
</span><span style="color:black">BIOSCODE:19AC                 </span><span style="color:navy">mov     cx, </span><span style="color:green">12          </span>; initialize tmp_vid to null vi_id
<span style="color:black">BIOSCODE:19AF                 </span><span style="color:navy">rep movsb
</span><span style="color:black">BIOSCODE:19B1                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSCODE:19B2                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:19B3                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">0Bh</span><span style="color:navy">] </span>; [es:di+BDS.fats]
<span style="color:black">BIOSCODE:19B3                                         </span>; # of fats
<span style="color:black">BIOSCODE:19B7                 </span><span style="color:navy">mov     cx, es:[di+</span><span style="color:#ff8000">11h</span><span style="color:navy">] </span>; [es:di+BDS.fatsecs]
<span style="color:black">BIOSCODE:19B7                                         </span>; sectors / fat
<span style="color:black">BIOSCODE:19BB                 </span><span style="color:navy">mul     cl
</span><span style="color:black">BIOSCODE:19BD                 </span><span style="color:navy">add     ax, es:[di+</span><span style="color:#ff8000">9</span><span style="color:navy">]   </span>; [es:di+BDS.resectors]
<span style="color:black">BIOSCODE:19BD                                         </span>; add on reserved sectors
<span style="color:black">BIOSCODE:19BD                                         </span>; now, ax is sector # (0 based)
<span style="color:black">BIOSCODE:19C1                 </span><span style="color:navy">mov     cs:</span>root_sec<span style="color:navy">, ax
</span><span style="color:black">BIOSCODE:19C5                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:#ff8000">0Ch</span><span style="color:navy">] </span>; [es:di+BDS.direntries]
<span style="color:black">BIOSCODE:19C5                                         </span>; # root dir entries
<span style="color:black">BIOSCODE:19C9                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4           </span>; 16 entries/sector
<span style="color:black">BIOSCODE:19CB                 </span><span style="color:navy">shr     ax, cl          </span>; divide by 16
<span style="color:black">BIOSCODE:19CD                 </span><span style="color:navy">mov     cx, ax          </span>; cx is # of sectors to scan
<span style="color:black">BIOSCODE:19CF
BIOSCODE:19CF </span><span style="color:gray">next_sec</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:19CF                 </span><span style="color:navy">push    cx              </span>; save outer loop counter
<span style="color:black">BIOSCODE:19D0                 </span><span style="color:navy">mov     ax, cs:</span>root_sec ; get sector #
<span style="color:black">BIOSCODE:19D4                 </span><span style="color:navy">mov     cx, es:[di+</span><span style="color:#ff8000">13h</span><span style="color:navy">] </span>; [es:di+BDS.secpertrack]
<span style="color:black">BIOSCODE:19D4                                         </span>; sectors / track
<span style="color:black">BIOSCODE:19D8                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSCODE:19DA                 </span><span style="color:navy">div     cx
</span><span style="color:black">BIOSCODE:19DC                 </span><span style="color:navy">inc     dx              </span>; dx = sectors into track
<span style="color:black">BIOSCODE:19DC                                         </span>; ax = track count from 0
<span style="color:black">BIOSCODE:19DD                 </span><span style="color:navy">mov     cl, dl          </span>; sector to read
<span style="color:black">BIOSCODE:19DF                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">BIOSCODE:19E1                 </span><span style="color:navy">div     word ptr es:[di+</span><span style="color:#ff8000">15h</span><span style="color:navy">] </span>; [es:di+BDS.heads]
<span style="color:black">BIOSCODE:19E1                                         </span>; # heads on this disc
<span style="color:black">BIOSCODE:19E5                 </span><span style="color:navy">mov     dh, dl          </span>; head number
<span style="color:black">BIOSCODE:19E7                 </span><span style="color:navy">mov     ch, al          </span>; track #
<span style="color:black">BIOSCODE:19E9                 </span><span style="color:navy">call    </span>read_sector     ; get first sector of the root directory,
<span style="color:black">BIOSCODE:19E9                                         </span>; ds:bx -&gt; directory sector
<span style="color:black">BIOSCODE:19EC                 </span><span style="color:navy">jb      short </span><span style="color:gray">readviderr
</span><span style="color:black">BIOSCODE:19EE                 </span><span style="color:navy">mov     cx, </span><span style="color:green">16          </span>; # of dir entries in a block of root
<span style="color:black">BIOSCODE:19F1                 </span><span style="color:navy">mov     al, </span><span style="color:green">8           </span>; volume label bit
<span style="color:black">BIOSCODE:19F3
BIOSCODE:19F3 </span><span style="color:gray">fvid_loop</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:19F3                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:#ff8000">0 </span>; end of dir?
<span style="color:black">BIOSCODE:19F6                 </span><span style="color:navy">jz      short </span><span style="color:gray">no_vid    </span>; yes, no vol id
<span style="color:black">BIOSCODE:19F8                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0E5h </span>; empty entry?
<span style="color:black">BIOSCODE:19FB                 </span><span style="color:navy">jz      short </span><span style="color:gray">ent_loop  </span>; yes, skip
<span style="color:black">BIOSCODE:19FD                 </span><span style="color:navy">test    [bx+</span><span style="color:green">11</span><span style="color:navy">], al     </span>; is volume label bit set in fcb?
<span style="color:black">BIOSCODE:1A00                 </span><span style="color:navy">jnz     short </span><span style="color:gray">found_vid </span>; yes
<span style="color:black">BIOSCODE:1A02
BIOSCODE:1A02 </span><span style="color:gray">ent_loop</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A02                 </span><span style="color:navy">add     bx, </span><span style="color:green">32          </span>; add length of directory entry
<span style="color:black">BIOSCODE:1A05                 </span><span style="color:navy">loop    </span><span style="color:gray">fvid_loop
</span><span style="color:black">BIOSCODE:1A07                 </span><span style="color:navy">pop     cx              </span>; outer loop
<span style="color:black">BIOSCODE:1A08                 </span><span style="color:navy">inc     cs:</span>root_sec     ; inc word [root_sec]
<span style="color:black">BIOSCODE:1A08                                         </span>; next sector
<span style="color:black">BIOSCODE:1A0D                 </span><span style="color:navy">loop    </span><span style="color:gray">next_sec        </span>; continue
<span style="color:black">BIOSCODE:1A0F
BIOSCODE:1A0F </span><span style="color:gray">notfound</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A0F                 </span><span style="color:navy">xor     si, si
</span><span style="color:black">BIOSCODE:1A11                 </span><span style="color:navy">jmp     short </span><span style="color:gray">fvid_ret
</span><span style="color:black">BIOSCODE:1A13 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:1A13
BIOSCODE:1A13 </span><span style="color:gray">found_vid</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A13                 </span><span style="color:navy">pop     cx              </span>; clean stack of outer loop counter
<span style="color:black">BIOSCODE:1A14                 </span><span style="color:navy">mov     si, bx          </span>; point to volume_id
<span style="color:black">BIOSCODE:1A16                 </span><span style="color:navy">push    es              </span>; preserve current bds
<span style="color:black">BIOSCODE:1A17                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:1A18                 </span><span style="color:navy">push    ds              </span>; point es to Bios_Data (BIOSDATA)
<span style="color:black">BIOSCODE:1A19                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:1A1A                 </span><span style="color:navy">mov     di, offset </span>tmp_vid <span style="color:gray">; &quot;NO NAME    &quot;
</span><span style="color:black">BIOSCODE:1A1D                 </span><span style="color:navy">mov     cx, </span><span style="color:green">11          </span>; VOLID_SIZ-1
<span style="color:black">BIOSCODE:1A1D                                         </span>; length of string minus nul
<span style="color:black">BIOSCODE:1A20                 </span><span style="color:navy">rep movsb
</span><span style="color:black">BIOSCODE:1A22                 </span><span style="color:navy">xor     al, al
</span><span style="color:black">BIOSCODE:1A24                 </span><span style="color:navy">stosb                   </span>; null terminate
<span style="color:black">BIOSCODE:1A25                 </span><span style="color:navy">xor     si, si
</span><span style="color:black">BIOSCODE:1A27                 </span><span style="color:navy">pop     di              </span>; restore current bds
<span style="color:black">BIOSCODE:1A28                 </span><span style="color:navy">pop     es
</span><span style="color:black">BIOSCODE:1A29
BIOSCODE:1A29 </span><span style="color:gray">fvid_ret</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A29                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:1A2A                 </span><span style="color:navy">clc
</span><span style="color:black">BIOSCODE:1A2B
BIOSCODE:1A2B </span><span style="color:gray">rvidret</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A2B                 </span><span style="color:navy">pop     bx
</span><span style="color:black">BIOSCODE:1A2C                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:1A2D                 </span><span style="color:navy">pop     dx
</span><span style="color:black">BIOSCODE:1A2E                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1A2F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:1A2F
BIOSCODE:1A2F </span><span style="color:gray">no_vid</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A2F                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:1A30                 </span><span style="color:navy">jmp     short </span><span style="color:gray">notfound
</span><span style="color:black">BIOSCODE:1A32 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">BIOSCODE:1A32
BIOSCODE:1A32 </span><span style="color:gray">readviderr</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A32                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSCODE:1A33                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSCODE:1A34                 </span><span style="color:navy">jmp     short </span><span style="color:gray">rvidret
</span><span style="color:black">BIOSCODE:1A34 </span>read_volume_id  endp
<span style="color:black">BIOSCODE:1A34
BIOSCODE:1A36
BIOSCODE:1A36 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1A36
BIOSCODE:1A36
BIOSCODE:1A36 </span>transfer_volume_id proc near            <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A36                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:1A37                 </span><span style="color:navy">push    si
</span><span style="color:black">BIOSCODE:1A38                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:1A39                 </span><span style="color:navy">mov     si, offset </span>tmp_vid <span style="color:gray">; &quot;NO NAME    &quot;
</span><span style="color:black">BIOSCODE:1A3C                 </span><span style="color:navy">add     di, </span><span style="color:green">75          </span>; BDS.volid
<span style="color:black">BIOSCODE:1A3F                 </span><span style="color:navy">mov     cx, </span><span style="color:green">12          </span>; VOLID_SIZ
<span style="color:black">BIOSCODE:1A42                 </span><span style="color:navy">cld
</span><span style="color:black">BIOSCODE:1A43                 </span><span style="color:navy">rep movsb
</span><span style="color:black">BIOSCODE:1A45                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:1A46                 </span><span style="color:navy">pop     si
</span><span style="color:black">BIOSCODE:1A47                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSCODE:1A48                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1A48 </span>transfer_volume_id endp
<span style="color:black">BIOSCODE:1A48
BIOSCODE:1A49
BIOSCODE:1A49 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1A49
BIOSCODE:1A49
BIOSCODE:1A49 </span>check_volume_id proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A49                 </span><span style="color:navy">push    di
</span><span style="color:black">BIOSCODE:1A4A                 </span><span style="color:navy">push    cx
</span><span style="color:black">BIOSCODE:1A4B                 </span><span style="color:navy">mov     si, offset </span>tmp_vid <span style="color:gray">; &quot;NO NAME    &quot;
</span><span style="color:black">BIOSCODE:1A4E                 </span><span style="color:navy">add     di, </span><span style="color:green">75          </span>; BDS.volid
<span style="color:black">BIOSCODE:1A51                 </span><span style="color:navy">mov     cx, </span><span style="color:green">12          </span>; VOLID_SIZ
<span style="color:black">BIOSCODE:1A54                 </span><span style="color:navy">cld
</span><span style="color:black">BIOSCODE:1A55                 </span><span style="color:navy">repe cmpsb
</span><span style="color:black">BIOSCODE:1A57                 </span><span style="color:navy">pop     cx
</span><span style="color:black">BIOSCODE:1A58                 </span><span style="color:navy">pop     di
</span><span style="color:black">BIOSCODE:1A59                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1A59 </span>check_volume_id endp
<span style="color:black">BIOSCODE:1A59
BIOSCODE:1A5A
BIOSCODE:1A5A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">BIOSCODE:1A5A
BIOSCODE:1A5A
BIOSCODE:1A5A </span>fat_check       proc near               <span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A5A                 </span><span style="color:navy">push    ax
</span><span style="color:black">BIOSCODE:1A5B                 </span><span style="color:navy">xor     si, si          </span>; say fat id&#039;s are same.
<span style="color:black">BIOSCODE:1A5D                 </span><span style="color:navy">mov     al, ds:</span>medbyt
<span style="color:black">BIOSCODE:1A60                 </span><span style="color:navy">cmp     al, es:[di+</span><span style="color:green">10h</span><span style="color:navy">] </span>; [es:di+BDS.media]
<span style="color:black">BIOSCODE:1A60                                         </span>; compare it with the bds medbyte
<span style="color:black">BIOSCODE:1A64                 </span><span style="color:navy">jz      short </span><span style="color:gray">okret1
</span><span style="color:black">BIOSCODE:1A66                 </span><span style="color:navy">dec     si
</span><span style="color:black">BIOSCODE:1A67
BIOSCODE:1A67 </span><span style="color:gray">okret1</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">BIOSCODE:1A67                 </span><span style="color:navy">pop     ax
</span><span style="color:black">BIOSCODE:1A68                 </span><span style="color:navy">retn
</span><span style="color:black">BIOSCODE:1A68 </span>fat_check       endp
<span style="color:black">BIOSCODE:1A68
BIOSCODE:1A68 </span><span style="color:gray">; ---------------------------------------------------------------------------
BIOSCODE:1A69                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">BIOSCODE:1A69 </span>BIOSCODE        ends
<span style="color:gray">BIOSCODE:1A69
SYSINIT:0000 ; ===========================================================================
SYSINIT:0000
SYSINIT:0000 ; Segment type: Regular
SYSINIT:0000 </span>SYSINIT         segment byte public &#039;SYSINIT&#039; use16
<span style="color:gray">SYSINIT:0000                 </span>assume cs:SYSINIT
<span style="color:gray">SYSINIT:0000                 </span>assume es:nothing, ss:nothing, ds:nothing, fs:nothing, gs:nothing
<span style="color:gray">SYSINIT:0000 </span>SYSINIT$        <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0002 </span>stackcount      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0004 </span>stackat         <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0006 </span>stacksize       <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0008 </span>stacks          <span style="color:navy">dw </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:000C </span>firstentry      <span style="color:navy">dw offset </span>stacks        <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:000C                                         </span>; stacks+(defaultcount*entrysize)-entrysize
<span style="color:gray">SYSINIT:000E </span>lastentry       <span style="color:navy">dw </span><span style="color:#008040">48h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:000E                                         </span>; stacks+(defaultcount*entrysize)-entrysize
<span style="color:gray">SYSINIT:0010 </span>nextentry       <span style="color:navy">dw </span><span style="color:#008040">48h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0012 </span>old02           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0016 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0016
SYSINIT:0016 </span>int02<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0016                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:0017                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:0018                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0F000h
</span><span style="color:maroon">SYSINIT:001B                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:001D                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:001D
SYSINIT:001D </span><span style="color:navy">loc_404D:                               </span>; mdl_convert ; check if convertible
<span style="color:maroon">SYSINIT:001D                 </span><span style="color:navy">cmp     byte ptr es:</span><span style="color:green">0FFFEh</span><span style="color:navy">, </span><span style="color:green">0F9h
</span><span style="color:maroon">SYSINIT:0023                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:0024                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:0024
SYSINIT:0024 </span><span style="color:navy">loc_4054:
</span><span style="color:maroon">SYSINIT:0024                 </span><span style="color:navy">jnz     short </span>normal02
<span style="color:maroon">SYSINIT:0026                 </span><span style="color:navy">in      al, </span><span style="color:green">62h         </span>; PC/XT PPI port C. Bits:
<span style="color:maroon">SYSINIT:0026                                         </span>; 0-3: values of DIP switches
<span style="color:maroon">SYSINIT:0026                                         </span>; 5: 1=Timer 2 channel out
<span style="color:maroon">SYSINIT:0026                                         </span>; 6: 1=I/O channel check
<span style="color:maroon">SYSINIT:0026                                         </span>; 7: 1=RAM parity check error occurred.
<span style="color:maroon">SYSINIT:0028                 </span><span style="color:navy">test    al, </span><span style="color:green">80h
</span><span style="color:maroon">SYSINIT:002A                 </span><span style="color:navy">jz      short </span>normal02
<span style="color:maroon">SYSINIT:002C                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:002D                 </span><span style="color:navy">jmp     cs:</span>old02
<span style="color:maroon">SYSINIT:0032 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0032
SYSINIT:0032 </span>normal02<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0032                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:0033                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:0036                 </span><span style="color:navy">adc     al, [bx+si]
</span><span style="color:maroon">SYSINIT:0036 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0038 </span>old08           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:003C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:003C
SYSINIT:003C </span>int08<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:003C                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:003F                 </span><span style="color:navy">cmp     [bx+si], al
</span><span style="color:maroon">SYSINIT:003F </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0041 </span>old09           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0045 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0045
SYSINIT:0045 </span>int09<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0045                 </span><span style="color:navy">jmp     short </span>keyboard_lbl
<span style="color:maroon">SYSINIT:0047 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0047
SYSINIT:0047 </span><span style="color:navy">loc_4077:
</span><span style="color:maroon">SYSINIT:0047                 </span><span style="color:navy">nop
</span><span style="color:maroon">SYSINIT:0047 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0048                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:0049 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0049
SYSINIT:0049 </span>keyboard_lbl<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0049                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:004C                 </span><span style="color:navy">inc     cx
</span><span style="color:maroon">SYSINIT:004C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">SYSINIT:004D                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:004E </span>old70           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0052 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0052
SYSINIT:0052 </span>int70<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0052                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:0055                 </span><span style="color:navy">dec     si
</span><span style="color:maroon">SYSINIT:0055 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">SYSINIT:0056                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:0057 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0057
SYSINIT:0057 </span>int0A<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0057                 </span><span style="color:navy">jmp     short </span>entry_int0A_stk
<span style="color:maroon">SYSINIT:0057 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0059 </span>old0A           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:005D                 </span><span style="color:navy">dw </span><span style="color:#008040">424Bh
</span><span style="color:gray">SYSINIT:005F </span>firstflag0A     <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:0060 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0060                 </span><span style="color:navy">jmp     short </span>intret_0A
<span style="color:maroon">SYSINIT:0060 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0062 </span><span style="color:navy">byte_4092       db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0069 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0069
SYSINIT:0069 </span>entry_int0A_stk<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0069                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:006C                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:006C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">SYSINIT:006D                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:006E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:006E
SYSINIT:006E </span>intret_0A<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:006E                 </span><span style="color:navy">iret
</span><span style="color:maroon">SYSINIT:006F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:006F
SYSINIT:006F </span>int0B<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:006F                 </span><span style="color:navy">jmp     short </span>entry_int0B_stk
<span style="color:maroon">SYSINIT:006F </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0071 </span>old0B           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0075                 </span><span style="color:navy">dw </span><span style="color:#008040">424Bh
</span><span style="color:gray">SYSINIT:0077                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:0078 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0078                 </span><span style="color:navy">jmp     short </span>intret_0B
<span style="color:maroon">SYSINIT:0078 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:007A                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:0081 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0081
SYSINIT:0081 </span>entry_int0B_stk<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0081                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:0084                 </span><span style="color:navy">jno     short $+</span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:0086
SYSINIT:0086 </span>intret_0B<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0086                 </span><span style="color:navy">iret
</span><span style="color:maroon">SYSINIT:0087 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0087
SYSINIT:0087 </span>int0C<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0087                 </span><span style="color:navy">jmp     short </span>entry_int0C_stk
<span style="color:maroon">SYSINIT:0087 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0089 </span>old0C           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:008D                 </span><span style="color:navy">dw </span><span style="color:#008040">424Bh
</span><span style="color:gray">SYSINIT:008F </span>firstflag0C     <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:0090 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0090                 </span><span style="color:navy">jmp     short </span>intret_0C
<span style="color:maroon">SYSINIT:0090 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0092                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:0099 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0099
SYSINIT:0099 </span>entry_int0C_stk<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0099                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:009C                 </span><span style="color:navy">mov     [bx+si], ax
</span><span style="color:maroon">SYSINIT:009E
SYSINIT:009E </span>intret_0C<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:009E                 </span><span style="color:navy">iret
</span><span style="color:maroon">SYSINIT:009F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:009F
SYSINIT:009F </span>int0D<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:009F                 </span><span style="color:navy">jmp     short </span>int0D_stk
<span style="color:maroon">SYSINIT:009F </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00A1 </span>old0D           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:00A5                 </span><span style="color:navy">dw </span><span style="color:#008040">424Bh
</span><span style="color:gray">SYSINIT:00A7 </span>firstflag0D     <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:00A8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00A8                 </span><span style="color:navy">jmp     short </span>intret_0D
<span style="color:maroon">SYSINIT:00A8 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00AA                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:00B1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00B1
SYSINIT:00B1 </span>int0D_stk<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:00B1                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:00B1 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00B4                 </span><span style="color:navy">dw offset </span>old0D
<span style="color:maroon">SYSINIT:00B6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00B6
SYSINIT:00B6 </span>intret_0D<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:00B6                 </span><span style="color:navy">iret
</span><span style="color:maroon">SYSINIT:00B7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00B7
SYSINIT:00B7 </span>int0Eh<span style="color:navy">:                                 </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:00B7                 </span><span style="color:navy">jmp     short </span>entry_int0E_stk
<span style="color:maroon">SYSINIT:00B7 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00B9 </span>old0E           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:00BD                 </span><span style="color:navy">dw </span><span style="color:#008040">424Bh
</span><span style="color:gray">SYSINIT:00BF </span>firstflag0E     <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:00C0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00C0                 </span><span style="color:navy">jmp     short </span>intret_0E
<span style="color:maroon">SYSINIT:00C0 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00C2                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:00C9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00C9
SYSINIT:00C9 </span>entry_int0E_stk<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:00C9                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:00C9 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00CC                 </span><span style="color:navy">dw offset </span>old0E
<span style="color:maroon">SYSINIT:00CE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00CE
SYSINIT:00CE </span>intret_0E<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:00CE                 </span><span style="color:navy">iret
</span><span style="color:maroon">SYSINIT:00CF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00CF
SYSINIT:00CF </span>int72<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:00CF                 </span><span style="color:navy">jmp     short </span>entry_int72_stk
<span style="color:maroon">SYSINIT:00CF </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00D1 </span>old72           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:00D5                 </span><span style="color:navy">dw </span><span style="color:#008040">424Bh
</span><span style="color:gray">SYSINIT:00D7 </span>firstflag72     <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:00D8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00D8                 </span><span style="color:navy">jmp     short </span>intret_72
<span style="color:maroon">SYSINIT:00D8 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00DA                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:00E1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00E1
SYSINIT:00E1 </span>entry_int72_stk<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:00E1                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:00E4                 </span><span style="color:navy">rol     word ptr [bx+si], </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:00E6
SYSINIT:00E6 </span>intret_72<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:00E6                 </span><span style="color:navy">iret
</span><span style="color:maroon">SYSINIT:00E7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00E7
SYSINIT:00E7 </span>int73<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:00E7                 </span><span style="color:navy">jmp     short </span>entry_int73_stk
<span style="color:maroon">SYSINIT:00E7 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00E9 </span>old73           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:00ED                 </span><span style="color:navy">dw </span><span style="color:#008040">424Bh
</span><span style="color:gray">SYSINIT:00EF </span>firstflag73     <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:00F0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00F0                 </span><span style="color:navy">jmp     short </span>intret_73
<span style="color:maroon">SYSINIT:00F0 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00F2                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:00F9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00F9
SYSINIT:00F9 </span>entry_int73_stk<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:00F9                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:00F9 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:00FC                 </span><span style="color:navy">dw offset </span>old73
<span style="color:maroon">SYSINIT:00FE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00FE
SYSINIT:00FE </span>intret_73<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:00FE                 </span><span style="color:navy">iret
</span><span style="color:maroon">SYSINIT:00FF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:00FF
SYSINIT:00FF </span>int74<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:00FF                 </span><span style="color:navy">jmp     short </span>entry_int74_stk
<span style="color:maroon">SYSINIT:00FF </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0101 </span>old74           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0105                 </span><span style="color:navy">dw </span><span style="color:#008040">424Bh
</span><span style="color:gray">SYSINIT:0107 </span>firstflag74     <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:0108 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0108                 </span><span style="color:navy">jmp     short </span>intret_74
<span style="color:maroon">SYSINIT:0108 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:010A                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:0111 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0111
SYSINIT:0111 </span>entry_int74_stk<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0111                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:0114                 </span><span style="color:navy">add     [bx+di], ax
</span><span style="color:maroon">SYSINIT:0116
SYSINIT:0116 </span>intret_74<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0116                 </span><span style="color:navy">iret
</span><span style="color:maroon">SYSINIT:0117 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0117
SYSINIT:0117 </span>int76<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0117                 </span><span style="color:navy">jmp     short </span>entry_int76_stk
<span style="color:maroon">SYSINIT:0117 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0119 </span>old76           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:011D                 </span><span style="color:navy">dw </span><span style="color:#008040">424Bh
</span><span style="color:gray">SYSINIT:011F </span>firstflag76     <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:0120 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0120                 </span><span style="color:navy">jmp     short </span>intret_76
<span style="color:maroon">SYSINIT:0120 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0122                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:0129 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0129
SYSINIT:0129 </span>entry_int76_stk<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0129                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:012C                 </span><span style="color:navy">sbb     [bx+di], ax
</span><span style="color:maroon">SYSINIT:012E
SYSINIT:012E </span>intret_76<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:012E                 </span><span style="color:navy">iret
</span><span style="color:maroon">SYSINIT:012F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:012F
SYSINIT:012F </span>int77<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:012F                 </span><span style="color:navy">jmp     short </span>entry_int77_stk
<span style="color:maroon">SYSINIT:012F </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0131 </span>old77           <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0135                 </span><span style="color:navy">dw </span><span style="color:#008040">424Bh
</span><span style="color:gray">SYSINIT:0137 </span>firstflag77     <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:0138 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0138                 </span><span style="color:navy">jmp     short </span>intret_77
<span style="color:maroon">SYSINIT:0138 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:013A                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:0141 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0141
SYSINIT:0141 </span>entry_int77_stk<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0141                 </span><span style="color:navy">call    near ptr </span>do_int_stacks
<span style="color:maroon">SYSINIT:0144                 </span><span style="color:navy">xor     [bx+di], ax
</span><span style="color:maroon">SYSINIT:0146
SYSINIT:0146 </span>intret_77<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0146                 </span><span style="color:navy">iret
</span><span style="color:black">SYSINIT:0147
SYSINIT:0147 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0147
SYSINIT:0147
SYSINIT:0147 </span>do_int_stacks   proc far                <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0147                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:0148                 </span><span style="color:navy">push    bp
</span><span style="color:black">SYSINIT:0149                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:014A                 </span><span style="color:navy">mov     es, cs:</span>stacks<span style="color:navy">+</span><span style="color:green">2 </span>; Get segment of stacks
<span style="color:black">SYSINIT:014F                 </span><span style="color:navy">mov     bp, cs:</span>nextentry ; get most likely candidate
<span style="color:black">SYSINIT:0154                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1           </span>; allocated
<span style="color:black">SYSINIT:0156                 </span><span style="color:navy">xchg    al, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; grab the entry
<span style="color:black">SYSINIT:015A                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0           </span>; free ; still avail?
<span style="color:black">SYSINIT:015C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">notfree02
</span><span style="color:black">SYSINIT:015E                 </span><span style="color:navy">sub     cs:</span>nextentry<span style="color:navy">, </span><span style="color:#ff8000">8 </span>; entrysize ; set for next interrupt
<span style="color:black">SYSINIT:0164
SYSINIT:0164 </span><span style="color:gray">found02</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0164                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">2</span><span style="color:navy">], sp   </span>; [es:bp+savedsp],sp ; save sp value
<span style="color:black">SYSINIT:0168                 </span><span style="color:navy">mov     word ptr es:[bp+</span><span style="color:#ff8000">4</span><span style="color:navy">], ss </span>; [es:bp+savedss],ss ; save ss also
<span style="color:black">SYSINIT:016C                 </span><span style="color:navy">mov     ax, bp          </span>; temp save of table offset
<span style="color:black">SYSINIT:016E                 </span><span style="color:navy">mov     bp, es:[bp+</span><span style="color:#ff8000">6</span><span style="color:navy">]   </span>; [es:bp+newsp] ; get new SP value
<span style="color:black">SYSINIT:0172                 </span><span style="color:navy">cmp     es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], ax   </span>; check for offset into table
<span style="color:black">SYSINIT:0176                 </span><span style="color:navy">jnz     short </span><span style="color:gray">foundbad02
</span><span style="color:black">SYSINIT:0178                 </span><span style="color:navy">mov     ax, es          </span>; point ss,sp to the new stack
<span style="color:black">SYSINIT:017A                 </span><span style="color:navy">mov     es, bp
</span><span style="color:black">SYSINIT:017C                 </span><span style="color:navy">mov     bp, sp
</span><span style="color:black">SYSINIT:017E                 </span><span style="color:navy">mov     bp, [bp+</span><span style="color:#ff8000">6</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:0181                 </span><span style="color:navy">mov     ss, ax
</span><span style="color:black">SYSINIT:0183                 </span><span style="color:navy">mov     sp, es
</span><span style="color:black">SYSINIT:0185                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:0187                 </span><span style="color:navy">mov     bp, cs:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:018B                 </span><span style="color:navy">pushf                   </span>; go execute the real interrupt handler
<span style="color:black">SYSINIT:018C                 </span><span style="color:navy">call    dword ptr cs:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">] </span>; which will iret back to here
<span style="color:black">SYSINIT:018C                                         </span>; call far [cs:bp]
<span style="color:black">SYSINIT:0190                 </span><span style="color:navy">mov     bp, sp          </span>; retrieve the table offset for us
<span style="color:black">SYSINIT:0192                 </span><span style="color:navy">mov     bp, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; but leave it on the stack
<span style="color:black">SYSINIT:0196                 </span><span style="color:navy">mov     ss, word ptr es:[bp+</span><span style="color:#ff8000">4</span><span style="color:navy">] </span>; [es:bp+savedss] ; get old stack back
<span style="color:black">SYSINIT:019A                 </span><span style="color:navy">mov     sp, es:[bp+</span><span style="color:#ff8000">2</span><span style="color:navy">]   </span>; [es:bp+savedsp]
<span style="color:black">SYSINIT:019E                 </span><span style="color:navy">mov     byte ptr es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:bp+allocbyte],free ; free the entry
<span style="color:black">SYSINIT:01A3                 </span><span style="color:navy">mov     cs:</span>nextentry<span style="color:navy">, bp </span>; setup to use next time
<span style="color:black">SYSINIT:01A8                 </span><span style="color:navy">pop     es              </span>; saved on entry
<span style="color:black">SYSINIT:01A9                 </span><span style="color:navy">pop     bp              </span>; saved on entry
<span style="color:black">SYSINIT:01AA                 </span><span style="color:navy">pop     ax              </span>; saved on entry
<span style="color:black">SYSINIT:01AB                 </span><span style="color:navy">add     sp, </span><span style="color:green">2           </span>; (skip near call return addr)
<span style="color:black">SYSINIT:01AE                 </span><span style="color:navy">iret                    </span>; done with this interrupt
<span style="color:black">SYSINIT:01AF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:01AF
SYSINIT:01AF </span><span style="color:gray">notfree02</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:01AF                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1           </span>; allocated ; error flag
<span style="color:black">SYSINIT:01B1                 </span><span style="color:navy">jz      short </span><span style="color:gray">findnext02 </span>; no, continue
<span style="color:black">SYSINIT:01B3                 </span><span style="color:navy">xchg    al, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; [es:bp+allocbyte] ; yes, restore error value
<span style="color:black">SYSINIT:01B7
SYSINIT:01B7 </span><span style="color:gray">findnext02</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:01B7                 </span><span style="color:navy">call    </span>longpath
<span style="color:black">SYSINIT:01BA                 </span><span style="color:navy">jmp     short </span><span style="color:gray">found02
</span><span style="color:black">SYSINIT:01BC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:01BC
SYSINIT:01BC </span><span style="color:gray">foundbad02</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:01BC                 </span><span style="color:navy">cmp     bp, cs:</span>firstentry
<span style="color:black">SYSINIT:01C1                 </span><span style="color:navy">jb      short </span><span style="color:gray">findnext02
</span><span style="color:black">SYSINIT:01C3                 </span><span style="color:navy">mov     bp, ax          </span>; flag this entry
<span style="color:black">SYSINIT:01C5                 </span><span style="color:navy">mov     byte ptr es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], </span><span style="color:#ff8000">3 </span>; clobbered
<span style="color:black">SYSINIT:01CA                 </span><span style="color:navy">jmp     short </span><span style="color:gray">findnext02 </span>; keep looking
<span style="color:black">SYSINIT:01CA </span>do_int_stacks   endp
<span style="color:black">SYSINIT:01CA
SYSINIT:01CC
SYSINIT:01CC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:01CC
SYSINIT:01CC
SYSINIT:01CC </span>longpath        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:01CC                 </span><span style="color:navy">mov     bp, cs:</span>lastentry
<span style="color:black">SYSINIT:01D1
SYSINIT:01D1 </span><span style="color:gray">lploopp</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:01D1                 </span><span style="color:navy">cmp     byte ptr es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; free ?
<span style="color:black">SYSINIT:01D6                 </span><span style="color:navy">jnz     short </span><span style="color:gray">inuse     </span>; no, try next one
<span style="color:black">SYSINIT:01D8                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:01DA                 </span><span style="color:navy">xchg    al, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; [es:bp+allocbyte] ; allocate entry
<span style="color:black">SYSINIT:01DE                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0           </span>; is it still free?
<span style="color:black">SYSINIT:01E0                 </span><span style="color:navy">jz      short </span><span style="color:gray">found     </span>; yes, go use it
<span style="color:black">SYSINIT:01E2                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1           </span>; allocated ?
<span style="color:black">SYSINIT:01E2                                         </span>; is it other than Allocated or Free?
<span style="color:black">SYSINIT:01E4                 </span><span style="color:navy">jz      short </span><span style="color:gray">inuse     </span>; no, check the next one
<span style="color:black">SYSINIT:01E6                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], al   </span>; yes, put back the error state
<span style="color:black">SYSINIT:01EA
SYSINIT:01EA </span><span style="color:gray">inuse</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:01EA                 </span><span style="color:navy">cmp     bp, cs:</span>firstentry
<span style="color:black">SYSINIT:01EF                 </span><span style="color:navy">jz      short </span><span style="color:gray">fatal
</span><span style="color:black">SYSINIT:01F1                 </span><span style="color:navy">sub     bp, </span><span style="color:#ff8000">8
</span><span style="color:black">SYSINIT:01F4                 </span><span style="color:navy">jmp     short </span><span style="color:gray">lploopp
</span><span style="color:black">SYSINIT:01F6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:01F6
SYSINIT:01F6 </span><span style="color:gray">found</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:01F6                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:01F7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:01F7
SYSINIT:01F7 </span><span style="color:gray">fatal</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:01F7                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:01F8                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0F000h      </span>; look at the model byte
<span style="color:black">SYSINIT:01FB                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:01FD                 </span>assume ds:nothing
<span style="color:black">SYSINIT:01FD                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">0FFFEh</span><span style="color:navy">, </span><span style="color:green">0F9h </span>; mdl_convert ; convertible?
<span style="color:black">SYSINIT:0202                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0203                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0203                 </span><span style="color:navy">jnz     short </span><span style="color:gray">skip_nmis
</span><span style="color:black">SYSINIT:0205                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">7           </span>; disable pc convertible nmis
<span style="color:black">SYSINIT:0207                 </span><span style="color:navy">out     </span><span style="color:green">72h</span><span style="color:navy">, al         </span>; CMOS Memory/RTC Index Register (Extended RAM)
<span style="color:black">SYSINIT:0209
SYSINIT:0209 </span><span style="color:gray">skip_nmis</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0209                 </span><span style="color:navy">cli                     </span>; disable and mask
<span style="color:black">SYSINIT:020A                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0FFh        </span>; all other ints
<span style="color:black">SYSINIT:020C                 </span><span style="color:navy">out     </span><span style="color:green">21h</span><span style="color:navy">, al         </span>; Interrupt controller, 8259A.
<span style="color:black">SYSINIT:020E                 </span><span style="color:navy">out     </span><span style="color:green">0A1h</span><span style="color:navy">, al        </span>; Interrupt Controller #2, 8259A
<span style="color:black">SYSINIT:0210                 </span><span style="color:navy">mov     si, cs
</span><span style="color:black">SYSINIT:0212                 </span><span style="color:navy">mov     ds, si
</span><span style="color:black">SYSINIT:0214                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:0214                 </span><span style="color:navy">mov     si, offset </span>fatal_msg ; &#039;Internal stack overflow&#039;
<span style="color:black">SYSINIT:0214                                         </span>;      &#039;System halted
<span style="color:black">SYSINIT:0217                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:0218                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:0219                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h         </span>; DOSBIODATASEG (BIOSDATA segment)
<span style="color:black">SYSINIT:021C                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:021E                 </span>assume ds:nothing
<span style="color:black">SYSINIT:021E                 </span><span style="color:navy">test    ds:</span>IsWin386<span style="color:navy">, </span><span style="color:green">1  </span>; BIOSDATA:08D0h
<span style="color:black">SYSINIT:0223                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0224                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0224                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:0225                 </span><span style="color:navy">jz      short </span><span style="color:gray">fatal_loop
</span><span style="color:black">SYSINIT:0227                 </span><span style="color:navy">call    far ptr </span><span style="background:blue"><span style="color:navy">70h:8D1h</span></span> ; call DOSBIODATASEG:V86_Crit_SetFocus
<span style="color:black">SYSINIT:022C
SYSINIT:022C </span><span style="color:gray">fatal_loop</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:022C                 </span><span style="color:navy">lodsb
</span><span style="color:black">SYSINIT:022D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">24h </span><span style="color:gray">; &#039;$&#039;
</span><span style="color:black">SYSINIT:022F                 </span><span style="color:navy">jz      short </span><span style="color:gray">fatal_done
</span><span style="color:black">SYSINIT:0231                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">7
</span><span style="color:black">SYSINIT:0233                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0Eh
</span><span style="color:black">SYSINIT:0235                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; (whoops, this enables ints)
<span style="color:black">SYSINIT:0235                                         </span>; - VIDEO - WRITE CHARACTER AND ADVANCE CURSOR (TTY WRITE)
<span style="color:black">SYSINIT:0235                                         </span>; AL = character, BH = display page (alpha modes)
<span style="color:black">SYSINIT:0235                                         </span>; BL = foreground color (graphics modes)
<span style="color:black">SYSINIT:0237                 </span><span style="color:navy">jmp     short </span><span style="color:gray">fatal_loop
</span><span style="color:black">SYSINIT:0239 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0239
SYSINIT:0239 </span><span style="color:gray">fatal_done</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0239                 </span><span style="color:navy">jmp     short </span><span style="color:gray">fatal_done
</span><span style="color:black">SYSINIT:0239 </span>longpath        endp
<span style="color:black">SYSINIT:0239
SYSINIT:0239 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:023B </span>fatal_msg       <span style="color:navy">db </span><span style="color:#008040">0Dh                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:023C                 </span><span style="color:navy">db </span><span style="color:#008040">0Ah
</span><span style="color:gray">SYSINIT:023D </span><span style="color:navy">aInternalStackO db </span><span style="color:green">7</span><span style="color:navy">,</span><span style="color:green">0Dh</span><span style="color:navy">,</span><span style="color:green">0Ah
</span><span style="color:gray">SYSINIT:023D                 </span><span style="color:navy">db &#039;Internal stack overflow&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:023D                 </span><span style="color:navy">db &#039;System halted&#039;,0Dh,0Ah,&#039;$&#039;
</span><span style="color:maroon">SYSINIT:0269 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0269
SYSINIT:0269 </span>_SYSINIT<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0269                 </span><span style="color:navy">jmp     </span>goinit
<span style="color:maroon">SYSINIT:0269 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:026C </span>runhigh         <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:026D </span>DOSINFO         <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:026D                                         </span>; address of the DOS Sysini Variables
<span style="color:gray">SYSINIT:0271 </span>dosinit         <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0273 </span>CURRENT_DOS_LOCATION <span style="color:navy">dw </span><span style="color:#008040">0               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0275 </span>DEVICE_LIST     <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0279 </span>sysi_country    <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0279                                         </span>; pointer to country table in dos
<span style="color:gray">SYSINIT:027D </span>dos_segreinit   <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:027D                                         </span>; room for dword
<span style="color:gray">SYSINIT:0281 </span>lo_doscod_size  <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0281                                         </span>; dos code size when in low mem
<span style="color:gray">SYSINIT:0283 </span>hi_doscod_size  <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0283                                         </span>; dos code size when in HMA
<span style="color:gray">SYSINIT:0285 </span>def_php         <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0287 </span>_seg_reinit_ptr <span style="color:navy">dw offset </span>_seg_reinit   <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0287                                         </span>; BIOSCODE:0032h
<span style="color:gray">SYSINIT:0289 </span>temp_bcode_seg  <span style="color:navy">dw </span><span style="color:#008040">2CCh                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0289                                         </span>; DOSBIOCODESEG (BIOSCODE)
<span style="color:gray">SYSINIT:028B </span>fake_floppy_drv <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:028B                                         </span>; set to 1 if this machine
<span style="color:gray">SYSINIT:028B                                         </span>; does not have any floppies!!!
<span style="color:gray">SYSINIT:028C </span>stack_count     <span style="color:navy">dw </span><span style="color:#008040">9                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:028C                                         </span>; defaultcount ; 9
<span style="color:gray">SYSINIT:028E </span>stack_size      <span style="color:navy">dw </span><span style="color:#008040">128                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:028E                                         </span>; defaultsize  ; 128
<span style="color:gray">SYSINIT:0290 </span>stack_addr      <span style="color:navy">dw </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0294 </span>MEMORY_SIZE     <span style="color:navy">dw </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0296 </span>RPLMemTop       <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0298 </span>DEFAULT_DRIVE   <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0298                                         </span>; initialized by ibminit
<span style="color:gray">SYSINIT:0299 </span>buffers         <span style="color:navy">dw </span><span style="color:#008040">0FFFFh               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0299                                         </span>; initialized during buffer allocation
<span style="color:gray">SYSINIT:029B </span>h_buffers       <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:029B                                         </span>; # of the heuristic buffers. initially 0.
<span style="color:gray">SYSINIT:029D </span>singlebuffersize <span style="color:navy">dw </span><span style="color:#008040">0                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:029D                                         </span>; maximum sector size + buffer head
<span style="color:gray">SYSINIT:029F </span>FILES           <span style="color:navy">db </span><span style="color:#008040">8                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:029F                                         </span>; enough files for pipe
<span style="color:gray">SYSINIT:02A0 </span>FCBS            <span style="color:navy">db </span><span style="color:#008040">4                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02A0                                         </span>; performance for recycling
<span style="color:gray">SYSINIT:02A1 </span>KEEP            <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02A1                                         </span>; keep original set
<span style="color:gray">SYSINIT:02A2 </span>NUM_CDS         <span style="color:navy">db </span><span style="color:#008040">5                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02A2                                         </span>; 5 net drives
<span style="color:gray">SYSINIT:02A3 </span>CONFBOT         <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02A5 </span>ALLOCLIM        <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02A7 </span>top_of_cdss     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02A9 </span>DirStrng        <span style="color:navy">db &#039;A:\&#039;,0              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02A9                                         </span>; string for the root directory of a drive
<span style="color:gray">SYSINIT:02AD </span>ZERO            <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02AE </span>sepchr          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02AF </span>linecount       <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02AF                                         </span>; line count in config.sys
<span style="color:gray">SYSINIT:02B1 </span>showcount       <span style="color:navy">db &#039;     &#039;,0Dh,0Ah,&#039;$&#039;  </span><span style="color:olive">; ...
</span><span style="color:gray">SYSINIT:02B1                                         </span>; used to convert linecount to ascii.
<span style="color:gray">SYSINIT:02B9 </span>buffer_linenum  <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02BB </span>sys_model_byte  <span style="color:navy">db </span><span style="color:#008040">0FFh                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02BB                                         </span>; model byte used in sysinit
<span style="color:gray">SYSINIT:02BC </span>sys_scnd_model_byte <span style="color:navy">db </span><span style="color:#008040">0                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02BC                                         </span>; secondary model byte used in sysinit
<span style="color:gray">SYSINIT:02BD </span>buf_prev_off    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02BF </span>EXEC0_ENVIRON   <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02BF                                         </span>; COMEXE ; seg addr of environment
<span style="color:gray">SYSINIT:02C1 </span>EXEC0_COM_LINE  <span style="color:navy">dw offset </span>bMaxBlock     ; pointer to asciz command line
<span style="color:gray">SYSINIT:02C3                 </span><span style="color:navy">dw </span><span style="color:#008040">473h                 </span>; SYSINIT segment
<span style="color:gray">SYSINIT:02C5 </span>EXEC0_5C_FCB    <span style="color:navy">dw offset </span>DEFAULT_DRIVE
<span style="color:gray">SYSINIT:02C7                 </span><span style="color:navy">dw </span><span style="color:#008040">473h                 </span>; SYSINIT segment
<span style="color:gray">SYSINIT:02C9 </span>EXEC0_6C_FCB    <span style="color:navy">dw offset </span>ZERO
<span style="color:gray">SYSINIT:02CB                 </span><span style="color:navy">dw </span><span style="color:#008040">473h                 </span>; SYSINIT segment
<span style="color:gray">SYSINIT:02CD </span>multi_pass_id   <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02CD                                         </span>; parameter passed to multi_pass
<span style="color:gray">SYSINIT:02CD                                         </span>; indicating the pass number
<span style="color:gray">SYSINIT:02CD                                         </span>;  0 - do scan for DOS=HIGH/LOW
<span style="color:gray">SYSINIT:02CD                                         </span>;  1 - load device drivers
<span style="color:gray">SYSINIT:02CD                                         </span>;  2 - was to load IFS
<span style="color:gray">SYSINIT:02CD                                         </span>;      now it is unused
<span style="color:gray">SYSINIT:02CD                                         </span>;  3 - do install=
<span style="color:gray">SYSINIT:02CD                                         </span>; &gt;3 - nop
<span style="color:gray">SYSINIT:02CE </span>install_flag    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02CE                                         </span>; bit 0 - config.sys has install= commands
<span style="color:gray">SYSINIT:02CE                                         </span>; bit 1 - sysinit_base installed
<span style="color:gray">SYSINIT:02D0 </span>config_size     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02D0                                         </span>; size of config.sys file
<span style="color:gray">SYSINIT:02D2 </span>sysinit_base_ptr <span style="color:navy">dd </span><span style="color:#008040">0                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02D2                                         </span>; pointer to sysinit_base
<span style="color:gray">SYSINIT:02D6 </span>sysinit_ptr     <span style="color:navy">dw </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02D6                                         </span>; returning address from sysinit_base
<span style="color:gray">SYSINIT:02DA </span>checksum        <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02DC </span>ldexec_fcb      <span style="color:navy">db </span><span style="color:#008040">14h </span><span style="color:navy">dup(</span><span style="color:#008040">20h</span><span style="color:navy">)         </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02DC                                         </span>; db 20 dup (&#039; &#039;) ; big enough
<span style="color:gray">SYSINIT:02F0 </span>ldexec_line     <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02F0                                         </span>; # of parm characters
<span style="color:gray">SYSINIT:02F1 </span>ldexec_start    <span style="color:navy">db &#039; &#039;                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02F2 </span>ldexec_parm     <span style="color:navy">db </span><span style="color:#008040">80 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)            </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:02F2                                         </span>; times 80 db 0
<span style="color:gray">SYSINIT:0342 </span>iexec_environ   <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0342                                         </span>; instexe ; seg addr of environment
<span style="color:gray">SYSINIT:0344 </span>iexec_ldexec_line <span style="color:navy">dw offset </span>ldexec_line ; pointer to asciiz command line
<span style="color:gray">SYSINIT:0346 </span>iexec_ldexec_line_seg <span style="color:navy">dw </span><span style="color:#008040">473h           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0348 </span>iexec_ldexec_5c_fcb <span style="color:navy">dw offset </span>ldexec_fcb ; default fcb at 5Ch
<span style="color:gray">SYSINIT:034A </span>iexec_ldexec_5c_fcb_seg <span style="color:navy">dw </span><span style="color:#008040">473h         </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:034C </span>iexec_ldexec_6c_fcb <span style="color:navy">dw offset </span>ldexec_fcb ; default fcb at 6Ch
<span style="color:gray">SYSINIT:034E </span>iexec_ldexec_6c_fcb_seg <span style="color:navy">dw </span><span style="color:#008040">473h         </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0350 </span>com_level       <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0350                                         </span>; level of &quot; &quot; in command line
<span style="color:gray">SYSINIT:0351 </span>cmmt            <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0351                                         </span>; length of comment string token
<span style="color:gray">SYSINIT:0352 </span>cmmt1           <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0352                                         </span>; token
<span style="color:gray">SYSINIT:0353 </span>cmmt2           <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0353                                         </span>; token
<span style="color:gray">SYSINIT:0354 </span>cmd_indicator   <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0355 </span>donotshownum    <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0356 </span>count           <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0358 </span>org_count       <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:035A </span>chrptr          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:035C </span>cntryfilehandle <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:035E </span>old_area        <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0360 </span>impossible_owner_size <span style="color:navy">dw </span><span style="color:#008040">0              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0360                                         </span>; paragraph
<span style="color:gray">SYSINIT:0362 </span>memlo           <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0362                                         </span>; bufptr, bucketptr (dword)
<span style="color:gray">SYSINIT:0364 </span>memhi           <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0364                                         </span>; prmblk (word)
<span style="color:gray">SYSINIT:0366 </span>ldoff           <span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:0368 </span>area            <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:036A </span>packet          <span style="color:navy">db </span><span style="color:#008040">24                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:036A                                         </span>; was 22
<span style="color:gray">SYSINIT:036B                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:036C                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; initialize code
<span style="color:gray">SYSINIT:036D                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:036F                 </span><span style="color:navy">db </span><span style="color:#008040">8 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">SYSINIT:0377 </span>unitcount       <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0378 </span>break_addr      <span style="color:navy">dw </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:037C </span>bpb_addr        <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0380 </span>devdrivenum     <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0381 </span>configmsgflag   <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0381                                         </span>; used to control &quot;error in config.sys line #&quot; message
<span style="color:gray">SYSINIT:0381                                         </span>; (configmsgflag is the last word of the 25 byte packet)
<span style="color:gray">SYSINIT:0381                                         </span>; ((default value is 0, device driver init may change? it))
<span style="color:gray">SYSINIT:0383 </span>drivenumber     <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0384 </span>toomanydrivesflag <span style="color:navy">db </span><span style="color:#008040">0                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0384                                         </span>; &gt;24 fixed disk partitions flag
<span style="color:gray">SYSINIT:0385 </span>BCodeSeg        <span style="color:navy">dw </span><span style="color:#008040">2CCh                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0385                                         </span>; DOSBIOCODESEG (BIOSCODE segment)
<span style="color:gray">SYSINIT:0387 </span>Magicbackdoor   <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:038B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:038B
SYSINIT:038B </span>NullBackdoor<span style="color:navy">:                           </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:038B                 </span><span style="color:navy">retf
</span><span style="color:maroon">SYSINIT:038B </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:038C </span>_timer_lw_      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:038E </span>BiosComBlock    <span style="color:navy">dd </span><span style="color:#008040">7008FDh              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:038E                                         </span>; BIOSDATA:08FDh
<span style="color:gray">SYSINIT:0392 </span>tempstack       <span style="color:navy">db </span><span style="color:#008040">128 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:0412 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0412
SYSINIT:0412 </span>goinit<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0412                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0C0h
</span><span style="color:maroon">SYSINIT:0414                 </span><span style="color:navy">int     </span><span style="color:green">15h             </span>; SYSTEM - GET CONFIGURATION (XT after 1/10/86,AT mdl 3x9,CONV,XT286,PS)
<span style="color:maroon">SYSINIT:0416
SYSINIT:0416 </span><span style="color:navy">loc_4446:                               </span><span style="color:olive">; ...
</span><span style="color:maroon">SYSINIT:0416                 </span><span style="color:navy">jb      short </span>no_rom_config
<span style="color:maroon">SYSINIT:0418                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:041B                 </span><span style="color:navy">jnz     short </span>no_rom_config
<span style="color:maroon">SYSINIT:041D                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:#ff8000">2</span><span style="color:navy">]   </span>; [es:bx+ROMBIOS_DESC.bios_sd_modelbyte]
<span style="color:maroon">SYSINIT:0421                 </span><span style="color:navy">mov     cs:</span>sys_model_byte<span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:0425                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:#ff8000">3</span><span style="color:navy">]   </span>; [es:bx+ROMBIOS_DESC.bios_sd_scnd_modelbyte]
<span style="color:maroon">SYSINIT:0429                 </span><span style="color:navy">mov     cs:</span>sys_scnd_model_byte<span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:042D                 </span><span style="color:navy">jmp     short </span>move_myself
<span style="color:maroon">SYSINIT:042F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:042F
SYSINIT:042F </span>no_rom_config<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:042F                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0F000h
</span><span style="color:maroon">SYSINIT:0432                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">SYSINIT:0434                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:0434                 </span><span style="color:navy">mov     al, ds:</span><span style="color:green">0FFFEh
</span><span style="color:maroon">SYSINIT:0437                 </span><span style="color:navy">mov     cs:</span>sys_model_byte<span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:043B                 </span><span style="color:navy">int     </span><span style="color:green">11h             </span>; EQUIPMENT DETERMINATION
<span style="color:maroon">SYSINIT:043B                                         </span>; Return: AX = equipment flag bits
<span style="color:maroon">SYSINIT:043D                 </span><span style="color:navy">test    ax, </span><span style="color:green">1           </span>; have any floppies?
<span style="color:maroon">SYSINIT:0440                 </span><span style="color:navy">jnz     short </span>move_myself ; yes,normal system
<span style="color:maroon">SYSINIT:0442                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:0443                 </span><span style="color:navy">xor     cl, cl
</span><span style="color:maroon">SYSINIT:0445                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">8           </span>; get disk parameters
<span style="color:maroon">SYSINIT:0447                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:0449                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - DISK - GET CURRENT DRIVE PARAMETERS (XT,AT,XT286,CONV,PS)
<span style="color:maroon">SYSINIT:0449                                         </span>; DL = drive number
<span style="color:maroon">SYSINIT:0449                                         </span>; Return: CF set on error, AH = status code, BL = drive type
<span style="color:maroon">SYSINIT:0449                                         </span>; DL = number of consecutive drives
<span style="color:maroon">SYSINIT:0449                                         </span>; DH = maximum value for head number, ES:DI -&gt; drive parameter
<span style="color:maroon">SYSINIT:044B                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:044C                 </span><span style="color:navy">jb      short </span>move_myself ; if error lets assume that the ROM BIOS lied
<span style="color:maroon">SYSINIT:044E                 </span><span style="color:navy">cmp     cl, </span><span style="color:#ff8000">0           </span>; double check (max sec no cannot be 0)
<span style="color:maroon">SYSINIT:0451                 </span><span style="color:navy">jz      short </span>move_myself
<span style="color:maroon">SYSINIT:0453                 </span><span style="color:navy">or      dl, dl          </span>; number of flp drvs == 0?
<span style="color:maroon">SYSINIT:0455                 </span><span style="color:navy">jnz     short </span>move_myself
<span style="color:maroon">SYSINIT:0457                 </span><span style="color:navy">mov     cs:</span>fake_floppy_drv<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; set fake flag
<span style="color:maroon">SYSINIT:045D
SYSINIT:045D </span>move_myself<span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:045D                 </span><span style="color:navy">cld                     </span>; set up move
<span style="color:maroon">SYSINIT:045E                 </span><span style="color:navy">xor     si, si
</span><span style="color:maroon">SYSINIT:0460                 </span><span style="color:navy">mov     di, si
</span><span style="color:maroon">SYSINIT:0462                 </span><span style="color:navy">mov     cx, cs:</span>MEMORY_SIZE
<span style="color:maroon">SYSINIT:0467                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:0468                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:0469                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:0469                 </span><span style="color:navy">dec     cx
</span><span style="color:maroon">SYSINIT:046A                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:maroon">SYSINIT:046C
SYSINIT:046C </span><span style="color:navy">loc_449C:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:046C                 </span><span style="color:navy">mov     es, bx          </span>; 0
<span style="color:maroon">SYSINIT:046E                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:046E                 </span><span style="color:navy">mov     bx, es:word_BC  </span>; Int 2Fh vector (4*2Fh)
<span style="color:maroon">SYSINIT:0473                 </span><span style="color:navy">mov     es, es:off_BE
</span><span style="color:maroon">SYSINIT:0478                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:0478                 </span><span style="color:navy">cmp     word ptr es:[bx+</span><span style="color:#ff8000">3</span><span style="color:navy">], </span><span style="color:green">5052h </span>; &#039;RP&#039;
<span style="color:maroon">SYSINIT:047E                 </span><span style="color:navy">jnz     short </span>NoRPL
<span style="color:maroon">SYSINIT:0480                 </span><span style="color:navy">cmp     byte ptr es:[bx+</span><span style="color:#ff8000">5</span><span style="color:navy">], </span><span style="color:green">4Ch </span>; &#039;L&#039;
<span style="color:maroon">SYSINIT:0485                 </span><span style="color:navy">jnz     short </span>NoRPL
<span style="color:maroon">SYSINIT:0487                 </span><span style="color:navy">mov     dx, cx          </span>; get TOM into DX
<span style="color:maroon">SYSINIT:0489                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">SYSINIT:048A                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4A06h       </span>; (multMULT&lt;&lt;8)+multMULTRPLTOM
<span style="color:maroon">SYSINIT:048D                 </span><span style="color:navy">int     </span><span style="color:green">2Fh             </span>; Get new TOM from any RPL
<span style="color:maroon">SYSINIT:048F                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:0490                 </span><span style="color:navy">mov     cx, dx
</span><span style="color:maroon">SYSINIT:0492                 </span><span style="color:navy">cmp     dx, ax
</span><span style="color:maroon">SYSINIT:0494                 </span><span style="color:navy">jz      short </span>NoRPL
<span style="color:maroon">SYSINIT:0496                 </span><span style="color:navy">mov     cs:</span>RPLMemTop<span style="color:navy">, dx
</span><span style="color:maroon">SYSINIT:049B                 </span><span style="color:navy">dec     cx
</span><span style="color:maroon">SYSINIT:049C
SYSINIT:049C </span>NoRPL<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:049C                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">5970h       </span>; SI_end ; need this much room for sysinit
<span style="color:maroon">SYSINIT:049C                                         </span>; (SI_end == sysinit code size)
<span style="color:maroon">SYSINIT:049F                 </span><span style="color:navy">call    </span>_off_to_para
<span style="color:maroon">SYSINIT:04A2                 </span><span style="color:navy">sub     cx, ax
</span><span style="color:maroon">SYSINIT:04A4                 </span><span style="color:navy">sub     cx, </span><span style="color:#ff8000">0A00h       </span>; DOSSIZE/16 (2560)
<span style="color:maroon">SYSINIT:04A4                                         </span>; leave this much room for DOS
<span style="color:maroon">SYSINIT:04A8                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">1A70h       </span>; BCODE_END
<span style="color:maroon">SYSINIT:04AB                 </span><span style="color:navy">call    </span>_off_to_para    ; leave this much room for BIOS code
<span style="color:maroon">SYSINIT:04AE                 </span><span style="color:navy">sub     cx, ax
</span><span style="color:maroon">SYSINIT:04B0                 </span><span style="color:navy">mov     es, cx          </span>; offset where sysinit will be located
<span style="color:maroon">SYSINIT:04B2                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:04B2                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">5970h       </span>; SI_end ; (sysinit code size)
<span style="color:maroon">SYSINIT:04B5                 </span><span style="color:navy">shr     cx, </span><span style="color:green">1           </span>; divide by 2 to get words
<span style="color:maroon">SYSINIT:04B7                 </span><span style="color:navy">rep movsw               </span>; relocate sysinit
<span style="color:maroon">SYSINIT:04B9                 </span><span style="color:navy">push    es              </span>; push relocated segment
<span style="color:maroon">SYSINIT:04BA                 </span><span style="color:navy">mov     ax, offset </span>SYSIN ; SYSINIT:048Fh
<span style="color:maroon">SYSINIT:04BD                 </span><span style="color:navy">push    ax              </span>; push relocated entry point
<span style="color:maroon">SYSINIT:04BE                 </span><span style="color:navy">retf                    </span>; far jump to relocated sysinit
<span style="color:maroon">SYSINIT:04BF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:04BF
SYSINIT:04BF </span>SYSIN<span style="color:navy">:                                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:04BF                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h
</span><span style="color:maroon">SYSINIT:04C2                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">SYSINIT:04C4                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:04C4                 </span><span style="color:navy">mov     ds:</span>MoveDOSIntoHMA_2<span style="color:navy">, cs </span>; set seg of routine to move DOS
<span style="color:maroon">SYSINIT:04C4                                         </span>; update SYSINITSEG field
<span style="color:maroon">SYSINIT:04C4                                         </span>; MoveDOSIntoHMA+2
<span style="color:maroon">SYSINIT:04C8                 </span><span style="color:navy">mov     ds:</span>SysinitPresent<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; flag that MoveDOSIntoHMA can be called
<span style="color:maroon">SYSINIT:04CD                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">5970h       </span>; SI_end ; how big is sysinitseg?
<span style="color:maroon">SYSINIT:04D0                 </span><span style="color:navy">call    </span>_off_to_para
<span style="color:maroon">SYSINIT:04D3                 </span><span style="color:navy">mov     cx, cs          </span>; pick a buffer for msdos above us
<span style="color:maroon">SYSINIT:04D5                 </span><span style="color:navy">add     ax, cx
</span><span style="color:maroon">SYSINIT:04D7                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:04D9                 </span><span style="color:navy">xor     si, si
</span><span style="color:maroon">SYSINIT:04DB                 </span><span style="color:navy">mov     di, si
</span><span style="color:maroon">SYSINIT:04DD                 </span><span style="color:navy">mov     ds, cs:</span>CURRENT_DOS_LOCATION ; where it is (set by msinit)
<span style="color:maroon">SYSINIT:04E2                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:04E2                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">5000h       </span>; DOSSIZE/2 (20480)
<span style="color:maroon">SYSINIT:04E5                 </span><span style="color:navy">rep movsw
</span><span style="color:maroon">SYSINIT:04E7                 </span><span style="color:navy">mov     cs:</span>CURRENT_DOS_LOCATION<span style="color:navy">, es
</span><span style="color:maroon">SYSINIT:04EC                 </span><span style="color:navy">mov     ax, ds:</span><span style="color:green">3        </span>; get offset of dos
<span style="color:maroon">SYSINIT:04EC                                         </span>; ax = 3DE0h for MSDOS 6.21 kernel
<span style="color:maroon">SYSINIT:04EC                                         </span>;  (MSDOS.SYS, offset 3)
<span style="color:maroon">SYSINIT:04EF                 </span><span style="color:navy">mov     cs:</span>dosinit<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:04F3                 </span><span style="color:navy">call    </span>_off_to_para    ; subtract this much from segment
<span style="color:maroon">SYSINIT:04F6                 </span><span style="color:navy">sub     cs:</span>CURRENT_DOS_LOCATION<span style="color:navy">, ax </span>; FINAL_DOS_LOCATION
<span style="color:maroon">SYSINIT:04FB                 </span><span style="color:navy">mov     ax, es
</span><span style="color:maroon">SYSINIT:04FD                 </span><span style="color:navy">add     ax, </span><span style="color:#ff8000">0A00h       </span>; DOSSIZE/16 ; DOSSIZE = 0A000h = 40960
<span style="color:maroon">SYSINIT:0500                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:0502                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:0502                 </span><span style="color:navy">xchg    ax, cs:</span>temp_bcode_seg ; swap with original home of Bios_Code
<span style="color:maroon">SYSINIT:0507                 </span><span style="color:navy">mov     ds, ax          </span>; point to loaded image of Bios_Code
<span style="color:maroon">SYSINIT:0509                 </span><span style="color:navy">mov     si, offset </span>Bios_Data_Word ; BCODESTART (= BiosDataWord)
<span style="color:maroon">SYSINIT:0509                                         </span>; BIOSCODE:BCODESTART (BIOSCODE:0030h)
<span style="color:maroon">SYSINIT:050C                 </span><span style="color:navy">mov     di, si
</span><span style="color:maroon">SYSINIT:050E                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">1A70h       </span>; BCODE_END = (SYSINITSEG-DOSBIOCODESEG)*16
<span style="color:maroon">SYSINIT:050E                                         </span>; (473h-2CCh)*10h = 1A70h (for MSDOS 6.21 IO.SYS)
<span style="color:maroon">SYSINIT:0511                 </span><span style="color:navy">sub     cx, si
</span><span style="color:maroon">SYSINIT:0513                 </span><span style="color:navy">shr     cx, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:0515                 </span><span style="color:navy">rep movsw               </span>; move Bios_Code into place
<span style="color:maroon">SYSINIT:0517                 </span><span style="color:navy">mov     ax, es          </span>; tell it what segment it&#039;s in
<span style="color:maroon">SYSINIT:0519                 </span><span style="color:navy">call    dword ptr cs:</span>_seg_reinit_ptr
<span style="color:maroon">SYSINIT:051E                 </span><span style="color:navy">les     di, cs:</span>BiosComBlock
<span style="color:maroon">SYSINIT:0523                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:0523                 </span><span style="color:navy">lds     si, cs:</span>DEVICE_LIST
<span style="color:maroon">SYSINIT:0528                 </span><span style="color:navy">mov     dx, cs:</span>MEMORY_SIZE
<span style="color:maroon">SYSINIT:052D                 </span><span style="color:navy">cli
</span><span style="color:maroon">SYSINIT:052E                 </span><span style="color:navy">mov     ax, cs
</span><span style="color:maroon">SYSINIT:0530                 </span><span style="color:navy">mov     ss, ax
</span><span style="color:maroon">SYSINIT:0532                 </span>assume ss:SYSINIT
<span style="color:maroon">SYSINIT:0532
SYSINIT:0532 </span>locstack<span style="color:navy">:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0532                 </span><span style="color:navy">mov     sp, offset </span>locstack ; set stack
<span style="color:maroon">SYSINIT:0532                                         </span>; mov sp, 532h ; mov sp, locstack
<span style="color:maroon">SYSINIT:0532                                         </span>; %define locstack ($ - SYSINIT$) &amp; 0FFFEh
<span style="color:maroon">SYSINIT:0532                                         </span>; locstack = $ &amp; 0FFFEh (SYSINIT:SYSINIT=473h:0)
<span style="color:maroon">SYSINIT:0535                 </span><span style="color:navy">sti
</span><span style="color:maroon">SYSINIT:0536                 </span><span style="color:navy">call    dword ptr cs:</span>dosinit ; call dosinit
<span style="color:maroon">SYSINIT:0536                                         </span>; es:di -&gt; sysinitvars_ext
<span style="color:maroon">SYSINIT:053B                 </span><span style="color:navy">mov     cs:</span>def_php<span style="color:navy">, ds  </span>; save pointer to PSP
<span style="color:maroon">SYSINIT:0540                 </span><span style="color:navy">mov     cs:</span>hi_doscod_size<span style="color:navy">, ax </span>; size of doscode (including exepatch)
<span style="color:maroon">SYSINIT:0544                 </span><span style="color:navy">mov     cs:</span>lo_doscod_size<span style="color:navy">, cx </span>; (as exepatch excluded)
<span style="color:maroon">SYSINIT:0549                 </span><span style="color:navy">mov     word ptr cs:</span>dos_segreinit<span style="color:navy">, dx </span>; save offset of segreinit
<span style="color:maroon">SYSINIT:054E                 </span><span style="color:navy">mov     ax, es:[di]     </span>; [es:di+SysInitVars_Ext.SYSI_InitVars]
<span style="color:maroon">SYSINIT:0551                 </span><span style="color:navy">mov     word ptr cs:</span>DOSINFO<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:0555                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:#ff8000">2</span><span style="color:navy">]   </span>; [es:di+SysInitVars_Ext.SYSI_InitVars+2]
<span style="color:maroon">SYSINIT:0559                 </span><span style="color:navy">mov     word ptr cs:</span>DOSINFO<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:055D                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:di+SysInitVars_Ext.SYSI_Country_Tab]
<span style="color:maroon">SYSINIT:0561                 </span><span style="color:navy">mov     word ptr cs:</span>sysi_country<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:0565                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:#ff8000">6</span><span style="color:navy">]   </span>; [es:di+SysInitVars_Ext.SYSI_Country_Tab+2]
<span style="color:maroon">SYSINIT:0569                 </span><span style="color:navy">mov     word ptr cs:</span>sysi_country<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:056D                 </span><span style="color:navy">mov     es, cs:</span>CURRENT_DOS_LOCATION ; = [FINAL_DOS_LOCATION]
<span style="color:maroon">SYSINIT:0572                 </span><span style="color:navy">mov     word ptr cs:</span>dos_segreinit<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:maroon">SYSINIT:0577                 </span><span style="color:navy">cmp     cs:</span>RPLMemTop<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:057D                 </span><span style="color:navy">jz      short </span>NoRPLArena
<span style="color:maroon">SYSINIT:057F                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">SYSINIT:0582                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:maroon">SYSINIT:0584                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:maroon">SYSINIT:0584                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:maroon">SYSINIT:0586                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:maroon">SYSINIT:0588                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:maroon">SYSINIT:0588                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:maroon">SYSINIT:058A                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:058C                 </span><span style="color:navy">push    es              </span>; resize upto RPL mem
<span style="color:maroon">SYSINIT:058D                 </span><span style="color:navy">sub     ax, cs:</span>RPLMemTop
<span style="color:maroon">SYSINIT:0592                 </span><span style="color:navy">neg     ax
</span><span style="color:maroon">SYSINIT:0594                 </span><span style="color:navy">dec     ax
</span><span style="color:maroon">SYSINIT:0595                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:maroon">SYSINIT:0597                 </span><span style="color:navy">mov     ah, </span><span style="color:green">4Ah
</span><span style="color:maroon">SYSINIT:0599                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ADJUST MEMORY BLOCK SIZE (SETBLOCK)
<span style="color:maroon">SYSINIT:0599                                         </span>; ES = segment address of block to change
<span style="color:maroon">SYSINIT:0599                                         </span>; BX = new size in paragraphs
<span style="color:maroon">SYSINIT:059B                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">SYSINIT:059E                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:maroon">SYSINIT:05A0                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:maroon">SYSINIT:05A0                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:maroon">SYSINIT:05A2                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:maroon">SYSINIT:05A4                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:maroon">SYSINIT:05A4                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:maroon">SYSINIT:05A6                 </span><span style="color:navy">dec     ax
</span><span style="color:maroon">SYSINIT:05A7                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:05A9                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:arena_owner]
<span style="color:maroon">SYSINIT:05B0                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:green">5052h </span>; [es:arena_name],&#039;RP&#039;
<span style="color:maroon">SYSINIT:05B7                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">0Ah</span><span style="color:navy">, </span><span style="color:green">4Ch </span>; [es:arena_name+2],&#039;L&#039;
<span style="color:maroon">SYSINIT:05BE                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">0Ch</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; [es:arena_name+4]
<span style="color:maroon">SYSINIT:05C5                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">0Eh</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; [es:arena_name+6]
<span style="color:maroon">SYSINIT:05CC                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:05CD                 </span><span style="color:navy">mov     ah, </span><span style="color:green">49h
</span><span style="color:maroon">SYSINIT:05CF                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - FREE MEMORY
<span style="color:maroon">SYSINIT:05CF                                         </span>; ES = segment address of area to be freed
<span style="color:maroon">SYSINIT:05D1
SYSINIT:05D1 </span>NoRPLArena<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:05D1                 </span><span style="color:navy">les     di, cs:</span>DOSINFO
<span style="color:maroon">SYSINIT:05D6                 </span><span style="color:navy">clc
</span><span style="color:maroon">SYSINIT:05D7                 </span><span style="color:navy">mov     ah, </span><span style="color:green">88h
</span><span style="color:maroon">SYSINIT:05D9                 </span><span style="color:navy">int     </span><span style="color:green">15h             </span>; EXTENDED MEMORY - GET MEMORY SIZE (AT,XT286,PS)
<span style="color:maroon">SYSINIT:05D9                                         </span>; Return: AX = memory size in K
<span style="color:maroon">SYSINIT:05DB                 </span><span style="color:navy">jb      short </span>no_ext_memory
<span style="color:maroon">SYSINIT:05DD                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">45h</span><span style="color:navy">], ax </span>; [es:di+SYSI_EXT_MEM],ax
<span style="color:maroon">SYSINIT:05DD                                         </span>; save extended memory size
<span style="color:maroon">SYSINIT:05E1                 </span><span style="color:navy">or      ax, ax
</span><span style="color:maroon">SYSINIT:05E3                 </span><span style="color:navy">jz      short </span>no_ext_memory
<span style="color:maroon">SYSINIT:05E5                 </span><span style="color:navy">call    </span>ClrVDISKHeader
<span style="color:maroon">SYSINIT:05E8
SYSINIT:05E8 </span>no_ext_memory<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:05E8                 </span><span style="color:navy">mov     ax, es:[di+</span><span style="color:#ff8000">10h</span><span style="color:navy">] </span>; [es:di+SYSI_MAXSEC] ; get the sector size
<span style="color:maroon">SYSINIT:05EC                 </span><span style="color:navy">add     ax, </span><span style="color:green">20          </span>; bufinsiz ; size of buffer header
<span style="color:maroon">SYSINIT:05EF                 </span><span style="color:navy">mov     cs:</span>singlebuffersize<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:05F3                 </span><span style="color:navy">mov     al, cs:</span>DEFAULT_DRIVE
<span style="color:maroon">SYSINIT:05F7                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">43h</span><span style="color:navy">], al </span>; [es:di+SYSI_BOOT_DRIVE]
<span style="color:maroon">SYSINIT:05FB
SYSINIT:05FB </span>_get_cpu_type_<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:05FB                 </span><span style="color:navy">pushf
</span><span style="color:maroon">SYSINIT:05FC                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">SYSINIT:05FD                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:maroon">SYSINIT:05FF                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:maroon">SYSINIT:0601                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:0602                 </span><span style="color:navy">popf
</span><span style="color:maroon">SYSINIT:0603                 </span><span style="color:navy">pushf
</span><span style="color:maroon">SYSINIT:0604                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:0605                 </span><span style="color:navy">and     ax, </span><span style="color:green">0F000h
</span><span style="color:maroon">SYSINIT:0608                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0F000h
</span><span style="color:maroon">SYSINIT:060B                 </span><span style="color:navy">jz      short </span>_cpu_8086
<span style="color:maroon">SYSINIT:060D                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0F000h
</span><span style="color:maroon">SYSINIT:0610                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:0611                 </span><span style="color:navy">popf
</span><span style="color:maroon">SYSINIT:0612                 </span><span style="color:navy">pushf
</span><span style="color:maroon">SYSINIT:0613                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:0614                 </span><span style="color:navy">and     ax, </span><span style="color:green">0F000h
</span><span style="color:maroon">SYSINIT:0617                 </span><span style="color:navy">jz      short </span>_cpu_286
<span style="color:maroon">SYSINIT:0619
SYSINIT:0619 </span>_cpu_386<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:0619                 </span><span style="color:navy">inc     bx
</span><span style="color:maroon">SYSINIT:061A
SYSINIT:061A </span>_cpu_286<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:061A                 </span><span style="color:navy">inc     bx
</span><span style="color:maroon">SYSINIT:061B
SYSINIT:061B </span>_cpu_8086<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:061B                 </span><span style="color:navy">mov     ax, bx
</span><span style="color:maroon">SYSINIT:061D                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">SYSINIT:061E                 </span><span style="color:navy">popf
</span><span style="color:maroon">SYSINIT:061F                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">2
</span><span style="color:maroon">SYSINIT:0622                 </span><span style="color:navy">jnz     short </span>_not_386_cpu
<span style="color:maroon">SYSINIT:0624                 </span><span style="color:navy">mov     byte ptr es:[di+</span><span style="color:#ff8000">44h</span><span style="color:navy">], </span><span style="color:#ff8000">1 </span>; [es:di+SYSI_DWMOVE],1
<span style="color:maroon">SYSINIT:0624                                         </span>; set doubleword moving flag
<span style="color:maroon">SYSINIT:0629
SYSINIT:0629 </span>_not_386_cpu<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0629                 </span><span style="color:navy">mov     al, es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">] </span>; [es:di+SYSI_NUMIO]
<span style="color:maroon">SYSINIT:062D                 </span><span style="color:navy">mov     cs:</span>drivenumber<span style="color:navy">, al </span>; save start of installable block drvs
<span style="color:maroon">SYSINIT:0631                 </span><span style="color:navy">mov     ax, cs
</span><span style="color:maroon">SYSINIT:0633                 </span><span style="color:navy">sub     ax, </span><span style="color:#ff8000">11h         </span>; room for PSP we will copy shortly
<span style="color:maroon">SYSINIT:0636
SYSINIT:0636 </span><span style="color:navy">loc_4666:                               </span>; temporary single buffer area
<span style="color:maroon">SYSINIT:0636                 </span><span style="color:navy">mov     cx, cs:</span>singlebuffersize
<span style="color:maroon">SYSINIT:063B                 </span><span style="color:navy">shr     cx, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:063D                 </span><span style="color:navy">shr     cx, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:063F                 </span><span style="color:navy">shr     cx, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:0641                 </span><span style="color:navy">shr     cx, </span><span style="color:green">1           </span>; divide size by 16..
<span style="color:maroon">SYSINIT:0641                                         </span>; ...to get paragraphs...
<span style="color:maroon">SYSINIT:0643                 </span><span style="color:navy">inc     cx              </span>; ... and round up
<span style="color:maroon">SYSINIT:0644                 </span><span style="color:navy">sub     ax, cx
</span><span style="color:maroon">SYSINIT:0646                 </span><span style="color:navy">mov     cs:</span>top_of_cdss<span style="color:navy">, ax </span>; temp &quot;unsafe&quot; location
<span style="color:maroon">SYSINIT:064A                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:064B                 </span><span style="color:navy">push    di
</span><span style="color:maroon">SYSINIT:064C                 </span><span style="color:navy">mov     cx, ax          </span>; save pointer for buffer
<span style="color:maroon">SYSINIT:064E                 </span><span style="color:navy">sub     ax, </span><span style="color:green">143         </span>; sub ax,((26 *(curdirlen))+15)/16
<span style="color:maroon">SYSINIT:064E                                         </span>; (curdirlen=88)
<span style="color:maroon">SYSINIT:0651                 </span><span style="color:navy">mov     cs:</span>ALLOCLIM<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:0655                 </span><span style="color:navy">mov     cs:</span>CONFBOT<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:0659                 </span><span style="color:navy">les     di, es:[di+</span><span style="color:#ff8000">12h</span><span style="color:navy">] </span>; [es:di+SYSI_BUF]
<span style="color:maroon">SYSINIT:065D                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+BUFFINF.Dirty_Buff_Count]
<span style="color:maroon">SYSINIT:0663                 </span><span style="color:navy">mov     word ptr es:[di], </span><span style="color:#ff8000">0 </span>; [es:di+BUFFINF.Buff_Queue]
<span style="color:maroon">SYSINIT:0668                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">2</span><span style="color:navy">], cx   </span>; [es:di+BUFFINF.Buff_Queue+2]
<span style="color:maroon">SYSINIT:0668                                         </span>; cx = [top_of_cdss]
<span style="color:maroon">SYSINIT:066C                 </span><span style="color:navy">mov     es, cx
</span><span style="color:maroon">SYSINIT:066E                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:maroon">SYSINIT:0670                 </span><span style="color:navy">mov     di, ax
</span><span style="color:maroon">SYSINIT:0672                 </span><span style="color:navy">mov     es:[di], ax     </span>; [es:di+buffinfo.buf_next],0
<span style="color:maroon">SYSINIT:0675                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">2</span><span style="color:navy">], ax   </span>; [es:di+buffinfo.buf_prev],0
<span style="color:maroon">SYSINIT:0679                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], </span><span style="color:#ff8000">0FFh </span>; [es:di+buffinfo.buf_ID],00FFh
<span style="color:maroon">SYSINIT:0679                                         </span>; free buffer,clear flag
<span style="color:maroon">SYSINIT:067F                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+buffinfo.buf_sector]
<span style="color:maroon">SYSINIT:0685                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">8</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+buffinfo.buf_sector+2]
<span style="color:maroon">SYSINIT:068B                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">SYSINIT:068C                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:068D                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:068E                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:068F                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:068F                 </span><span style="color:navy">call    </span>TempCDS         ; set up cdss so re_init and sysinit
<span style="color:maroon">SYSINIT:068F                                         </span>; can make disk system calls
<span style="color:maroon">SYSINIT:068F                                         </span>; tempcds trashes ds
<span style="color:maroon">SYSINIT:0692                 </span><span style="color:navy">mov     ds, cs:</span>def_php  ; retrieve pointer to PSP returned by DOSINIT
<span style="color:maroon">SYSINIT:0697                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:0697                 </span><span style="color:navy">call    far ptr </span><span style="background:blue"><span style="color:navy">70h:89Bh</span></span> ; call DOSBIODATASEG:re_init
<span style="color:maroon">SYSINIT:069C                 </span><span style="color:navy">sti
</span><span style="color:maroon">SYSINIT:069D                 </span><span style="color:navy">cld
</span><span style="color:maroon">SYSINIT:069E                 </span><span style="color:navy">mov     bx, cs
</span><span style="color:maroon">SYSINIT:06A0                 </span><span style="color:navy">sub     bx, </span><span style="color:#ff8000">10h
</span><span style="color:maroon">SYSINIT:06A3                 </span><span style="color:navy">mov     es, bx
</span><span style="color:maroon">SYSINIT:06A5                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:06A5                 </span><span style="color:navy">xor     si, si
</span><span style="color:maroon">SYSINIT:06A7                 </span><span style="color:navy">mov     di, si
</span><span style="color:maroon">SYSINIT:06A9                 </span><span style="color:navy">mov     cx, </span><span style="color:green">128
</span><span style="color:maroon">SYSINIT:06AC                 </span><span style="color:navy">rep movsw
</span><span style="color:maroon">SYSINIT:06AE                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">36h</span><span style="color:navy">, es </span>; [es:PDB.JFN_POINTER+2],es ; Relocate
<span style="color:maroon">SYSINIT:06B3                 </span><span style="color:navy">mov     ah, </span><span style="color:green">50h
</span><span style="color:maroon">SYSINIT:06B5                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ internal - SET PSP SEGMENT
<span style="color:maroon">SYSINIT:06B5                                         </span>; BX = segment address of new PSP
<span style="color:maroon">SYSINIT:06B7                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:06B8                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:06B9                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:06BA                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:06BA                 </span><span style="color:navy">mov     dx, offset loc_909C </span>; set up int 24h handler
<span style="color:maroon">SYSINIT:06BD                 </span><span style="color:navy">mov     ax, </span><span style="color:green">2524h
</span><span style="color:maroon">SYSINIT:06C0                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - SET INTERRUPT VECTOR
<span style="color:maroon">SYSINIT:06C0                                         </span>; AL = interrupt number
<span style="color:maroon">SYSINIT:06C0                                         </span>; DS:DX = new vector to be used for specified interrupt
<span style="color:maroon">SYSINIT:06C2                 </span><span style="color:navy">cmp     </span>toomanydrivesflag<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:06C2 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:06C7                 </span><span style="color:navy">db </span><span style="color:#008040">74h
</span><span style="color:olive">SYSINIT:06C8                 </span><span style="color:navy">db    </span><span style="color:#008040">6
</span><span style="color:maroon">SYSINIT:06C9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:06C9                 </span><span style="color:navy">mov     dx, offset asc_993C </span><span style="color:gray">; &quot;WARNING! Logical drives past Z: exist a&quot;...
</span><span style="color:maroon">SYSINIT:06CC                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:06CF
SYSINIT:06CF </span>no_err<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:06CF                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:06D0                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:06D0                 </span><span style="color:navy">mov     dl, cs:</span>DEFAULT_DRIVE
<span style="color:maroon">SYSINIT:06D5                 </span><span style="color:navy">or      dl, dl
</span><span style="color:maroon">SYSINIT:06D7                 </span><span style="color:navy">jz      short </span>nodrvset
<span style="color:maroon">SYSINIT:06D9                 </span><span style="color:navy">dec     dl
</span><span style="color:maroon">SYSINIT:06DB                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0Eh
</span><span style="color:maroon">SYSINIT:06DD                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - SELECT DISK
<span style="color:maroon">SYSINIT:06DD                                         </span>; DL = new default drive number (0 = A, 1 = B, etc.)
<span style="color:maroon">SYSINIT:06DD                                         </span>; Return: AL = number of logical drives
<span style="color:maroon">SYSINIT:06DF
SYSINIT:06DF </span>nodrvset<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:06DF                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:06E0                 </span><span style="color:navy">sub     ax, ax
</span><span style="color:maroon">SYSINIT:06E2                 </span><span style="color:navy">mov     ds, ax          </span>; 0 ; ROMBIOS data area
<span style="color:maroon">SYSINIT:06E4                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:06E4                 </span><span style="color:navy">mov     ax, word ptr ds:</span>fdrive3<span style="color:navy">+</span><span style="color:green">50h </span>; Counter for Interrupt 1Ah
<span style="color:maroon">SYSINIT:06E4                                         </span>; timer tick count (18.2 ticks per second)
<span style="color:maroon">SYSINIT:06E7                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:06E8                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:06E8                 </span><span style="color:navy">mov     cs:</span>_timer_lw_<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:06EC                 </span><span style="color:navy">mov     word ptr cs:</span>Magicbackdoor<span style="color:navy">, offset </span>NullBackdoor
<span style="color:maroon">SYSINIT:06F3                 </span><span style="color:navy">mov     word ptr cs:</span>Magicbackdoor<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, cs
</span><span style="color:maroon">SYSINIT:06F8                 </span><span style="color:navy">call    </span>AllocFreeMem    ; get the largest free block from DOS
<span style="color:maroon">SYSINIT:06FB                 </span><span style="color:navy">call    loc_7BDA        </span>; **** PRE-LOAD MAGICDRV!!! ****
<span style="color:maroon">SYSINIT:06FE                 </span><span style="color:navy">or      ax, ax
</span><span style="color:maroon">SYSINIT:0700                 </span><span style="color:navy">jnz     short </span>PreloadFailed
<span style="color:maroon">SYSINIT:0702                 </span><span style="color:navy">mov     es, cs:</span>area
<span style="color:maroon">SYSINIT:0707                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:0707                 </span><span style="color:navy">mov     bx, cs:</span>memhi
<span style="color:maroon">SYSINIT:070C                 </span><span style="color:navy">sub     bx, cs:</span>area
<span style="color:maroon">SYSINIT:0711                 </span><span style="color:navy">mov     ah, </span><span style="color:green">4Ah
</span><span style="color:maroon">SYSINIT:0713                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ADJUST MEMORY BLOCK SIZE (SETBLOCK)
<span style="color:maroon">SYSINIT:0713                                         </span>; ES = segment address of block to change
<span style="color:maroon">SYSINIT:0713                                         </span>; BX = new size in paragraphs
<span style="color:maroon">SYSINIT:0715                 </span><span style="color:navy">mov     ax, es
</span><span style="color:maroon">SYSINIT:0717                 </span><span style="color:navy">dec     ax
</span><span style="color:maroon">SYSINIT:0718                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:071A                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:071A                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:arena_owner], 8 ; set impossible owner
<span style="color:maroon">SYSINIT:0721                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">4453h </span>; [es:arena_name],&#039;SD&#039; ; System Data
<span style="color:maroon">SYSINIT:0728                 </span><span style="color:navy">mov     ax, es          </span>; get Magicdrv arena
<span style="color:maroon">SYSINIT:072A                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; get MCB length
<span style="color:maroon">SYSINIT:072F                 </span><span style="color:navy">inc     ax              </span>; get addr of next MCB
<span style="color:maroon">SYSINIT:0730                 </span><span style="color:navy">les     si, cs:</span>DOSINFO  ; get to arena header
<span style="color:maroon">SYSINIT:0735                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:0735                 </span><span style="color:navy">mov     es:[si-</span><span style="color:green">2</span><span style="color:navy">], ax   </span>; store that
<span style="color:maroon">SYSINIT:0739                 </span><span style="color:navy">jmp     short </span>ProcessConfig
<span style="color:maroon">SYSINIT:073B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:073B
SYSINIT:073B </span>PreloadFailed<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:073B                 </span><span style="color:navy">mov     ah, </span><span style="color:green">49h         </span>; Dealloc ; free the block if no load
<span style="color:maroon">SYSINIT:073D                 </span><span style="color:navy">mov     es, cs:</span>area
<span style="color:maroon">SYSINIT:0742                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - FREE MEMORY
<span style="color:maroon">SYSINIT:0742                                         </span>; ES = segment address of area to be freed
<span style="color:maroon">SYSINIT:0744
SYSINIT:0744 </span>ProcessConfig<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0744                 </span><span style="color:navy">call    </span>doconf
<span style="color:maroon">SYSINIT:0747                 </span><span style="color:navy">cmp     cs:</span>runhigh<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:074D                 </span><span style="color:navy">jz      short </span>dont_install_stub
<span style="color:maroon">SYSINIT:074F                 </span><span style="color:navy">mov     es, cs:</span>CURRENT_DOS_LOCATION
<span style="color:maroon">SYSINIT:0754                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:maroon">SYSINIT:0756                 </span><span style="color:navy">call    cs:</span>dos_segreinit
<span style="color:maroon">SYSINIT:075B                 </span><span style="color:navy">jmp     short </span>do_multi_pass
<span style="color:maroon">SYSINIT:075D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:075D
SYSINIT:075D </span>dont_install_stub<span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:075D                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:maroon">SYSINIT:075F                 </span><span style="color:navy">call    </span>MovDOSLo
<span style="color:maroon">SYSINIT:0762                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:0765                 </span><span style="color:navy">mov     es, cs:</span>CURRENT_DOS_LOCATION
<span style="color:maroon">SYSINIT:076A                 </span><span style="color:navy">call    cs:</span>dos_segreinit
<span style="color:maroon">SYSINIT:076F
SYSINIT:076F </span>do_multi_pass<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:076F                 </span><span style="color:navy">call    </span>AllocFreeMem
<span style="color:maroon">SYSINIT:0772                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">0           </span>; magic backdoor to place int hooks
<span style="color:maroon">SYSINIT:0775                 </span><span style="color:navy">call    cs:</span>Magicbackdoor
<span style="color:maroon">SYSINIT:077A                 </span><span style="color:navy">inc     cs:</span>multi_pass_id
<span style="color:maroon">SYSINIT:077F                 </span><span style="color:navy">call    </span>multi_pass
<span style="color:maroon">SYSINIT:0782                 </span><span style="color:navy">call    </span>ShrinkUMB
<span style="color:maroon">SYSINIT:0785                 </span><span style="color:navy">call    </span>UnlinkUMB
<span style="color:maroon">SYSINIT:0788                 </span><span style="color:navy">inc     cs:</span>multi_pass_id
<span style="color:maroon">SYSINIT:078D                 </span><span style="color:navy">call    </span>multi_pass
<span style="color:maroon">SYSINIT:0790                 </span><span style="color:navy">call    loc_7E97
</span><span style="color:maroon">SYSINIT:0793                 </span><span style="color:navy">call    </span>endfile
<span style="color:maroon">SYSINIT:0796                 </span><span style="color:navy">call    loc_7F1B
</span><span style="color:maroon">SYSINIT:0799                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h
</span><span style="color:maroon">SYSINIT:079C                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:079E                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:079E                 </span><span style="color:navy">mov     es:</span>SysinitPresent<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:07A4                 </span><span style="color:navy">test    cs:</span>install_flag<span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:07AB                 </span><span style="color:navy">jz      short </span>dolast
<span style="color:maroon">SYSINIT:07AD                 </span><span style="color:navy">inc     cs:</span>multi_pass_id
<span style="color:maroon">SYSINIT:07B2                 </span><span style="color:navy">call    </span>multi_pass
<span style="color:maroon">SYSINIT:07B5
SYSINIT:07B5 </span>dolast<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:07B5                 </span><span style="color:navy">cmp     cs:</span>runhigh<span style="color:navy">, </span><span style="color:#ff8000">0FFh
</span><span style="color:maroon">SYSINIT:07BB                 </span><span style="color:navy">jnz     short </span>_@@_
<span style="color:maroon">SYSINIT:07BD                 </span><span style="color:navy">call    </span>LoadDOSHiOrLo
<span style="color:maroon">SYSINIT:07C0
SYSINIT:07C0 </span>_@@_<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:07C0                 </span><span style="color:navy">cmp     cs:</span>runhigh<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:07C6                 </span><span style="color:navy">jz      short </span>ConfigDone
<span style="color:maroon">SYSINIT:07C8                 </span><span style="color:navy">call    </span>CPMHack
<span style="color:maroon">SYSINIT:07CB
SYSINIT:07CB </span>ConfigDone<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:07CB                 </span><span style="color:navy">mov     cs:</span>donotshownum<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:07D1                 </span><span style="color:navy">mov     es, cs:</span>area
<span style="color:maroon">SYSINIT:07D6                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:07D6                 </span><span style="color:navy">mov     ah, </span><span style="color:green">49h         </span>; DEALLOC ; free allocated memory for command.com
<span style="color:maroon">SYSINIT:07D8                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - FREE MEMORY
<span style="color:maroon">SYSINIT:07D8                                         </span>; ES = segment address of area to be freed
<span style="color:maroon">SYSINIT:07DA                 </span><span style="color:navy">test    cs:</span>install_flag<span style="color:navy">, </span><span style="color:green">2 </span>; has_installed
<span style="color:maroon">SYSINIT:07E1                 </span><span style="color:navy">jz      short </span>skip_free_sysinitbase ; no
<span style="color:maroon">SYSINIT:07E3                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:07E4                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">SYSINIT:07E5                 </span><span style="color:navy">mov     es, cs:</span>old_area
<span style="color:maroon">SYSINIT:07EA                 </span><span style="color:navy">mov     bx, cs:</span>impossible_owner_size
<span style="color:maroon">SYSINIT:07EF                 </span><span style="color:navy">mov     ah, </span><span style="color:green">4Ah
</span><span style="color:maroon">SYSINIT:07F1                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ADJUST MEMORY BLOCK SIZE (SETBLOCK)
<span style="color:maroon">SYSINIT:07F1                                         </span>; ES = segment address of block to change
<span style="color:maroon">SYSINIT:07F1                                         </span>; BX = new size in paragraphs
<span style="color:maroon">SYSINIT:07F3                 </span><span style="color:navy">mov     ax, es
</span><span style="color:maroon">SYSINIT:07F5                 </span><span style="color:navy">dec     ax
</span><span style="color:maroon">SYSINIT:07F6                 </span><span style="color:navy">mov     es, ax          </span>; point to arena
<span style="color:maroon">SYSINIT:07F8                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:07F8                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:ARENA.OWNER],8 ; set impossible owner
<span style="color:maroon">SYSINIT:07FF                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">4453h </span>; [es:ARENA.NAME],&#039;SD&#039; ; System Data
<span style="color:maroon">SYSINIT:0806                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">SYSINIT:0807                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:0808                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:0808
SYSINIT:0808 </span>skip_free_sysinitbase<span style="color:navy">:                  </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0808                 </span><span style="color:navy">cmp     cs:</span>runhigh<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:080E                 </span><span style="color:navy">jz      short </span>_@@@_
<span style="color:maroon">SYSINIT:0810                 </span><span style="color:navy">call    </span>InstVDiskHeader ; Install VDISK header (allocates some mem from DOS)
<span style="color:maroon">SYSINIT:0813
SYSINIT:0813 </span>_@@@_<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0813                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:0814                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:0815                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:0815                 </span><span style="color:navy">mov     </span>config_cmd<span style="color:navy">, </span><span style="color:#ff8000">0   </span>; set special code for query_user
<span style="color:maroon">SYSINIT:081A                 </span><span style="color:navy">call    loc_8BE1        </span>; to issue the AUTOEXEC prompt
<span style="color:maroon">SYSINIT:081D                 </span><span style="color:navy">jnb     short </span>process_autoexec ; we should process autoexec normally
<span style="color:maroon">SYSINIT:081F                 </span><span style="color:navy">or      </span>aSubmenu<span style="color:navy">, </span><span style="color:green">4     </span>; set &quot;skip all&quot; flag
<span style="color:maroon">SYSINIT:0824                 </span><span style="color:navy">call    loc_8CDE        </span>; no, we should disable it
<span style="color:maroon">SYSINIT:0827
SYSINIT:0827 </span>process_autoexec<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0827                 </span><span style="color:navy">call    loc_8D29
</span><span style="color:maroon">SYSINIT:082A                 </span><span style="color:navy">mov     cl, </span>bMaxBlock
<span style="color:maroon">SYSINIT:082E                 </span><span style="color:navy">mov     ch, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:0830                 </span><span style="color:navy">inc     cx
</span><span style="color:maroon">SYSINIT:0831                 </span><span style="color:navy">mov     si, offset </span>bMaxBlock
<span style="color:maroon">SYSINIT:0831 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">SYSINIT:0834                 </span><span style="color:navy">db    </span><span style="color:#008040">3
</span><span style="color:gray">SYSINIT:0835 </span><span style="color:navy">byte_4865       db </span><span style="color:#008040">0F1h                 </span><span style="color:#8080ff">; ...
</span><span style="color:olive">SYSINIT:0836                 </span><span style="color:navy">db </span><span style="color:#008040">0C6h </span><span style="color:gray">;              </span>; cr-terminate command line
<span style="color:olive">SYSINIT:0837                 </span><span style="color:navy">db    </span><span style="color:#008040">4
</span><span style="color:gray">SYSINIT:0838 </span><span style="color:navy">byte_4868       db </span><span style="color:#008040">0Dh                  </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0839 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0839
SYSINIT:0839 </span>retry<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0839                 </span><span style="color:navy">mov     dx, offset aCommand_com </span><span style="color:gray">; &quot;\\COMMAND.COM&quot;
</span><span style="color:maroon">SYSINIT:083C                 </span><span style="color:navy">push    dx              </span>; save pointer to file name
<span style="color:maroon">SYSINIT:083D                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh      </span>; get biggest piece (second time gets it)
<span style="color:maroon">SYSINIT:0840                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:maroon">SYSINIT:0842                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:maroon">SYSINIT:0842                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:maroon">SYSINIT:0844                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:maroon">SYSINIT:0846                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:maroon">SYSINIT:0846                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:maroon">SYSINIT:0848                 </span><span style="color:navy">jb      short </span>memerrjx  ; oooops!
<span style="color:maroon">SYSINIT:084A                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:084C                 </span><span style="color:navy">mov     ah, </span><span style="color:green">49h
</span><span style="color:maroon">SYSINIT:084E                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - FREE MEMORY
<span style="color:maroon">SYSINIT:084E                                         </span>; ES = segment address of area to be freed
<span style="color:maroon">SYSINIT:0850                 </span><span style="color:navy">mov     bp, bx
</span><span style="color:maroon">SYSINIT:0852                 </span><span style="color:navy">mov     bx, </span>MEMORY_SIZE ; get location of end of memory
<span style="color:maroon">SYSINIT:0856                 </span><span style="color:navy">mov     ax, cs          </span>; get location of beginning of sysinit
<span style="color:maroon">SYSINIT:0858                 </span><span style="color:navy">mov     cx, </span>config_envlen
<span style="color:maroon">SYSINIT:085C                 </span><span style="color:navy">jcxz    short </span>no_env    ; use config_wrkseg only if there&#039;s env data
<span style="color:maroon">SYSINIT:085E                 </span><span style="color:navy">mov     ax, </span>config_wrkseg
<span style="color:maroon">SYSINIT:0861
SYSINIT:0861 </span>no_env<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0861                 </span><span style="color:navy">sub     bx, ax
</span><span style="color:maroon">SYSINIT:0863                 </span><span style="color:navy">add     bx, </span><span style="color:#ff8000">11h         </span>; add the sysinit php
<span style="color:maroon">SYSINIT:0866                 </span><span style="color:navy">sub     bp, bx          </span>; sub sysinit size from amount of free memory
<span style="color:maroon">SYSINIT:0868                 </span><span style="color:navy">jb      short </span>memerrjx  ; if there isn&#039;t even this much memory, give up
<span style="color:maroon">SYSINIT:086A                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">3D00h
</span><span style="color:maroon">SYSINIT:086D                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:086E                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - OPEN DISK FILE WITH HANDLE
<span style="color:maroon">SYSINIT:086E                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:maroon">SYSINIT:086E                                         </span>; AL = access mode
<span style="color:maroon">SYSINIT:086E                                         </span>; 0 - read
<span style="color:maroon">SYSINIT:0870                 </span><span style="color:navy">jb      short </span>comerr
<span style="color:maroon">SYSINIT:0872                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:maroon">SYSINIT:0874                 </span><span style="color:navy">cmp     byte_917D, </span><span style="color:#ff8000">0    </span>; was a new shell selected?
<span style="color:maroon">SYSINIT:0879                 </span><span style="color:navy">jnz     short </span>skip_validation ; yes
<span style="color:maroon">SYSINIT:087B                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">835h        </span>; SYSINIT:0835h
<span style="color:maroon">SYSINIT:087E                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">4
</span><span style="color:maroon">SYSINIT:0881                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Fh
</span><span style="color:maroon">SYSINIT:0883                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - READ FROM FILE WITH HANDLE
<span style="color:maroon">SYSINIT:0883                                         </span>; BX = file handle, CX = number of bytes to read
<span style="color:maroon">SYSINIT:0883                                         </span>; DS:DX -&gt; buffer
<span style="color:maroon">SYSINIT:0885                 </span><span style="color:navy">cmp     byte_4865, </span><span style="color:green">0E9h
</span><span style="color:maroon">SYSINIT:088A                 </span><span style="color:navy">jnz     short </span>comerr
<span style="color:maroon">SYSINIT:088C                 </span><span style="color:navy">cmp     byte_4868, </span><span style="color:green">66h  </span>; COMMAND.COM Version 6.20  (not 6.21!)
<span style="color:maroon">SYSINIT:088C                                         </span>; ((MAJOR_VERSION&amp;0Fh)&lt;&lt;4)|(MINOR_VERSION&amp;0Fh)
<span style="color:maroon">SYSINIT:0891                 </span><span style="color:navy">jnz     short </span>comerr
<span style="color:maroon">SYSINIT:0893
SYSINIT:0893 </span>skip_validation<span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0893                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:maroon">SYSINIT:0895                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:maroon">SYSINIT:0897                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4202h
</span><span style="color:maroon">SYSINIT:089A                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:089B                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
<span style="color:maroon">SYSINIT:089B                                         </span>; AL = method: offset from end of file
<span style="color:maroon">SYSINIT:089D                 </span><span style="color:navy">jb      short </span>comerr
<span style="color:maroon">SYSINIT:089F                 </span><span style="color:navy">add     ax, </span><span style="color:#ff8000">0Fh         </span>; convert size in dx:ax to para in ax
<span style="color:maroon">SYSINIT:08A2                 </span><span style="color:navy">adc     dx, </span><span style="color:#ff8000">0           </span>; round up size for conversion to para
<span style="color:maroon">SYSINIT:08A5                 </span><span style="color:navy">call    </span>_off_to_para
<span style="color:maroon">SYSINIT:08A8                 </span><span style="color:navy">mov     cl, </span><span style="color:green">12
</span><span style="color:maroon">SYSINIT:08AA                 </span><span style="color:navy">shl     dx, cl          </span>; low nibble of dx to high nibble
<span style="color:maroon">SYSINIT:08AC                 </span><span style="color:navy">or      ax, dx          </span>; ax is now # of para for file
<span style="color:maroon">SYSINIT:08AE                 </span><span style="color:navy">add     ax, </span><span style="color:#ff8000">10h         </span>; 100h byte php
<span style="color:maroon">SYSINIT:08B1                 </span><span style="color:navy">cmp     ax, bp          </span>; will command fit in available mem?
<span style="color:maroon">SYSINIT:08B3                 </span><span style="color:navy">jb      short </span>okld      ; jump if yes.
<span style="color:maroon">SYSINIT:08B5
SYSINIT:08B5 </span>memerrjx<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:08B5                 </span><span style="color:navy">mov     dx, (offset </span>_$PauseMsg<span style="color:navy">+</span><span style="color:green">12h</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:08B8                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:08BB                 </span><span style="color:navy">jmp     short </span>continue
<span style="color:maroon">SYSINIT:08BD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:08BD
SYSINIT:08BD </span>okld<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:08BD                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:maroon">SYSINIT:08BF                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CLOSE A FILE WITH HANDLE
<span style="color:maroon">SYSINIT:08BF                                         </span>; BX = file handle
<span style="color:maroon">SYSINIT:08C1                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:08C2                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:08C3                 </span>assume es:SYSINIT
<span style="color:maroon">SYSINIT:08C3                 </span><span style="color:navy">mov     bx, offset </span>EXEC0_ENVIRON ; offset COMEXE
<span style="color:maroon">SYSINIT:08C3                                         </span>; point to exec block
<span style="color:maroon">SYSINIT:08C6                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">SYSINIT:08C7                 </span><span style="color:navy">mov     cx, </span>config_envlen
<span style="color:maroon">SYSINIT:08CB                 </span><span style="color:navy">jcxz    short </span>no_envdata
<span style="color:maroon">SYSINIT:08CD                 </span><span style="color:navy">mov     cx, </span>config_wrkseg
<span style="color:maroon">SYSINIT:08D1
SYSINIT:08D1 </span>no_envdata<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:08D1                 </span><span style="color:navy">mov     [bx], cx        </span>; set segments
<span style="color:maroon">SYSINIT:08D1                                         </span>; [bx+EXEC0.ENVIRON],cx
<span style="color:maroon">SYSINIT:08D3                 </span><span style="color:navy">mov     word ptr [bx+</span><span style="color:#ff8000">4</span><span style="color:navy">], cs </span>; [bx+EXEC0.COM_LINE+2],cs
<span style="color:maroon">SYSINIT:08D6                 </span><span style="color:navy">mov     word ptr [bx+</span><span style="color:#ff8000">8</span><span style="color:navy">], cs </span>; [bx+EXEC0.5C_FCB+2],cs
<span style="color:maroon">SYSINIT:08D9                 </span><span style="color:navy">mov     word ptr [bx+</span><span style="color:#ff8000">0Ch</span><span style="color:navy">], cs </span>; [bx+EXEC0.6C_FCB+2],cs
<span style="color:maroon">SYSINIT:08DC                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4B00h       </span>; (EXEC&lt;&lt;8)
<span style="color:maroon">SYSINIT:08DF                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:08E0                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - LOAD OR EXECUTE (EXEC)
<span style="color:maroon">SYSINIT:08E0                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:maroon">SYSINIT:08E0                                         </span>; ES:BX -&gt; parameter block
<span style="color:maroon">SYSINIT:08E0                                         </span>; AL = subfunc: load &amp; execute program
<span style="color:maroon">SYSINIT:08E2                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:08E3                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:08E4                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">SYSINIT:08E5
SYSINIT:08E5 </span>comerr<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:08E5                 </span><span style="color:navy">cmp     byte ptr aDosCommand_com, </span><span style="color:#ff8000">0 </span><span style="color:gray">; &quot;\\DOS\\COMMAND.COM&quot;
</span><span style="color:maroon">SYSINIT:08EA                 </span><span style="color:navy">jz      short </span>comerr2   ; all defaults exhausted, print err msg
<span style="color:maroon">SYSINIT:08EC                 </span><span style="color:navy">cmp     byte_917D, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:08F1                 </span><span style="color:navy">jz      short </span>continue  ; don&#039;t print err msg for defaults just yet
<span style="color:maroon">SYSINIT:08F3
SYSINIT:08F3 </span>comerr2<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:08F3                 </span><span style="color:navy">mov     dx, (offset </span>badstack<span style="color:navy">+</span><span style="color:green">6</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:08F6                 </span><span style="color:navy">call    loc_9044
</span><span style="color:maroon">SYSINIT:08F9
SYSINIT:08F9 </span>continue<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:08F9                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">SYSINIT:08FA                 </span><span style="color:navy">mov     ah, </span><span style="color:green">19h
</span><span style="color:maroon">SYSINIT:08FC                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - GET DEFAULT DISK NUMBER
<span style="color:maroon">SYSINIT:08FE                 </span><span style="color:navy">add     al, &#039;</span><span style="color:green">A&#039;
</span><span style="color:maroon">SYSINIT:0900                 </span><span style="color:navy">mov     dl, al          </span>; dl == default drive letter
<span style="color:maroon">SYSINIT:0902                 </span><span style="color:navy">mov     si, offset </span>command_line_126 <span style="color:gray">; &quot;\\COMMAND.COM&quot;
</span><span style="color:maroon">SYSINIT:0905                 </span><span style="color:navy">cmp     byte_917D, </span><span style="color:#ff8000">0    </span>; if a SHELL= was given
<span style="color:maroon">SYSINIT:090A                 </span><span style="color:navy">jnz     short </span>do_def2   ; then try the 2nd alternate;
<span style="color:maroon">SYSINIT:090C                 </span><span style="color:navy">mov     byte ptr [si], </span><span style="color:#ff8000">0 </span>; otherwise, the default SHELL= was tried,
<span style="color:maroon">SYSINIT:090F                 </span><span style="color:navy">jmp     short </span>do_def3   ; which is the same as our 2nd alt, so skip it
<span style="color:maroon">SYSINIT:0911 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0911
SYSINIT:0911 </span>do_def2<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0911                 </span><span style="color:navy">cmp     byte ptr [si], </span><span style="color:#ff8000">0 </span>; has 2nd alternate been tried?
<span style="color:maroon">SYSINIT:0914                 </span><span style="color:navy">jnz     short </span>do_alt    ; no
<span style="color:maroon">SYSINIT:0916
SYSINIT:0916 </span>do_def3<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0916                 </span><span style="color:navy">mov     si, offset aMsdosCommand_c </span><span style="color:gray">; &quot;\\MSDOS\\COMMAND.COM&quot;
</span><span style="color:maroon">SYSINIT:0919                 </span><span style="color:navy">cmp     byte ptr [si], </span><span style="color:#ff8000">0 </span>; has 3rd alternate been tried?
<span style="color:maroon">SYSINIT:091C                 </span><span style="color:navy">jnz     short </span>do_alt    ; no
<span style="color:maroon">SYSINIT:091E                 </span><span style="color:navy">mov     si, offset aDosCommand_com </span><span style="color:gray">; &quot;\\DOS\\COMMAND.COM&quot;
</span><span style="color:maroon">SYSINIT:0921                 </span><span style="color:navy">cmp     byte ptr [si], </span><span style="color:#ff8000">0 </span>; has 4th alternate been tried?
<span style="color:maroon">SYSINIT:0924                 </span><span style="color:navy">jnz     short </span>do_alt    ; no
<span style="color:maroon">SYSINIT:0926                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">SYSINIT:0927                 </span><span style="color:navy">mov     dx, offset asc_98DF </span><span style="color:gray">; &quot;Enter correct name of Command Interpret&quot;...
</span><span style="color:maroon">SYSINIT:092A                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:092D                 </span><span style="color:navy">pop     dx              </span>; recover default drive letter in dl
<span style="color:maroon">SYSINIT:092E
SYSINIT:092E </span>request_input<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:092E                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2           </span>; STD_CON_OUTPUT
<span style="color:maroon">SYSINIT:0930                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - DISPLAY OUTPUT
<span style="color:maroon">SYSINIT:0930                                         </span>; DL = character to send to standard output
<span style="color:maroon">SYSINIT:0932                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">SYSINIT:0933                 </span><span style="color:navy">mov     dl, &#039;&gt;&#039;         </span>; 3Eh
<span style="color:maroon">SYSINIT:0935                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - DISPLAY OUTPUT
<span style="color:maroon">SYSINIT:0935                                         </span>; DL = character to send to standard output
<span style="color:maroon">SYSINIT:0937                 </span><span style="color:navy">mov     bl, byte_917F   </span>; [tmplate] = max. chars buffer can hold = 64
<span style="color:maroon">SYSINIT:093B                 </span><span style="color:navy">mov     bh, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:093D                 </span><span style="color:navy">mov     byte ptr aCommand_com[bx], </span><span style="color:#ff8000">0Dh </span><span style="color:gray">; &quot;\\COMMAND.COM&quot;
</span><span style="color:maroon">SYSINIT:0942                 </span><span style="color:navy">mov     dx, offset byte_917E
</span><span style="color:maroon">SYSINIT:0945                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0Ah         </span>; STD_CON_STRING_INPUT
<span style="color:maroon">SYSINIT:0947                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - BUFFERED KEYBOARD INPUT
<span style="color:maroon">SYSINIT:0947                                         </span>; DS:DX -&gt; buffer
<span style="color:maroon">SYSINIT:0949                 </span><span style="color:navy">mov     dx, (offset </span>insufmemory<span style="color:navy">+</span><span style="color:green">20h</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:094C                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:094F                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">SYSINIT:0950                 </span><span style="color:navy">mov     bl, byte_917F
</span><span style="color:maroon">SYSINIT:0954                 </span><span style="color:navy">or      bl, bl          </span>; was anything typed?
<span style="color:maroon">SYSINIT:0956                 </span><span style="color:navy">jz      short </span>request_input
<span style="color:maroon">SYSINIT:0958                 </span><span style="color:navy">mov     byte_917D, </span><span style="color:#ff8000">1    </span>; disable validation for user-specified binaries
<span style="color:maroon">SYSINIT:095D                 </span><span style="color:navy">mov     byte ptr aCommand_com[bx], </span><span style="color:#ff8000">0 </span>; NULL-terminate it before execing it
<span style="color:maroon">SYSINIT:0962                 </span><span style="color:navy">mov     word ptr </span>bMaxBlock<span style="color:navy">, </span><span style="color:#ff8000">0D00h
</span><span style="color:maroon">SYSINIT:0968                 </span><span style="color:navy">jmp     short </span>do_exec   <span style="color:red">; ...
</span><span style="color:maroon">SYSINIT:096A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:096A
SYSINIT:096A </span>do_alt<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:096A                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:096B                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:096C                 </span><span style="color:navy">mov     byte_917D, </span><span style="color:#ff8000">0    </span>; force validation for alternate binaries
<span style="color:maroon">SYSINIT:0971                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">5150h
</span><span style="color:maroon">SYSINIT:0974
SYSINIT:0974 </span><span style="color:navy">loc_49A4:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0974                 </span><span style="color:navy">lodsb
</span><span style="color:maroon">SYSINIT:0975                 </span><span style="color:navy">mov     byte ptr [si-</span><span style="color:green">1</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; so that we know it&#039;s been tried
<span style="color:maroon">SYSINIT:0979                 </span><span style="color:navy">stosb
</span><span style="color:maroon">SYSINIT:097A                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:097C                 </span><span style="color:navy">jnz     short loc_49A4
</span><span style="color:maroon">SYSINIT:097E                 </span><span style="color:navy">mov     di, offset </span>bMaxBlock
<span style="color:maroon">SYSINIT:0981                 </span><span style="color:navy">cmp     byte ptr [si+</span><span style="color:#ff8000">2</span><span style="color:navy">], &#039;</span><span style="color:green">:&#039;
</span><span style="color:maroon">SYSINIT:0985                 </span><span style="color:navy">jnz     short </span>do_alt2
<span style="color:maroon">SYSINIT:0987                 </span><span style="color:navy">mov     [si+</span><span style="color:#ff8000">1</span><span style="color:navy">], dl      </span>; stuff default drive into alt. command line
<span style="color:maroon">SYSINIT:098A
SYSINIT:098A </span>do_alt2<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:098A                 </span><span style="color:navy">lodsb
</span><span style="color:maroon">SYSINIT:098B                 </span><span style="color:navy">stosb
</span><span style="color:maroon">SYSINIT:098C                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:098E                 </span><span style="color:navy">jnz     short </span>do_alt2
<span style="color:maroon">SYSINIT:0990                 </span><span style="color:navy">mov     byte ptr [di-</span><span style="color:green">1</span><span style="color:navy">], </span><span style="color:#ff8000">0Dh </span>; cr
<span style="color:maroon">SYSINIT:0994                 </span><span style="color:navy">mov     byte ptr word_92CE, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:0999                 </span><span style="color:navy">call    loc_8CDE
</span><span style="color:maroon">SYSINIT:099C                 </span><span style="color:navy">call    loc_8D29
</span><span style="color:maroon">SYSINIT:099F
SYSINIT:099F </span>do_exec<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:099F                 </span><span style="color:navy">jmp     </span>retry
<span style="color:black">SYSINIT:09A2
SYSINIT:09A2 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:09A2
SYSINIT:09A2
SYSINIT:09A2 </span>AllocFreeMem    proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:09A2                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:09A5                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:black">SYSINIT:09A7                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:black">SYSINIT:09A7                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:black">SYSINIT:09A9                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:black">SYSINIT:09AB                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:black">SYSINIT:09AB                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:black">SYSINIT:09AD                 </span><span style="color:navy">mov     cs:</span>area<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:09B1                 </span><span style="color:navy">mov     cs:</span>memhi<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:09B5                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:09B5 </span>AllocFreeMem    endp
<span style="color:black">SYSINIT:09B5
SYSINIT:09B5 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:09B6 </span>DOSLOMSG        <span style="color:navy">db &#039;HMA not available: Loading DOS low&#039;,0Dh,0Ah,&#039;$&#039; </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:09DB </span>FEmsg           <span style="color:navy">db &#039;Fatal Error: Cannot allocate Memory for DOS&#039;,0Dh,0Ah,&#039;$&#039; </span><span style="color:#8080ff">; ...
</span><span style="color:black">SYSINIT:0A09
SYSINIT:0A09 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0A09
SYSINIT:0A09
SYSINIT:0A09 </span>LoadDOSHiOrLo   proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0A09                 </span><span style="color:navy">call    </span>TryToMovDOSHi   ; Try moving it into HMA
<span style="color:black">SYSINIT:0A0C                 </span><span style="color:navy">jb      short </span><span style="color:gray">LdngLo    </span>; If that don&#039;t work...
<span style="color:black">SYSINIT:0A0E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0A0F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0A0F
SYSINIT:0A0F </span><span style="color:gray">LdngLo</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0A0F                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:0A10                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0A11                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">9
</span><span style="color:black">SYSINIT:0A13                 </span><span style="color:navy">mov     dx, offset </span>DOSLOMSG <span style="color:gray">; &quot;HMA not available: Loading DOS low\r\n$&quot;
</span><span style="color:black">SYSINIT:0A16                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - PRINT STRING
<span style="color:black">SYSINIT:0A16                                         </span>; DS:DX -&gt; string terminated by &quot;$&quot;
<span style="color:black">SYSINIT:0A18                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">1           </span>; use int 21 alloc for mem
<span style="color:black">SYSINIT:0A1B                 </span><span style="color:navy">call    </span>MovDOSLo
<span style="color:black">SYSINIT:0A1E                 </span><span style="color:navy">mov     es, cs:</span>CURRENT_DOS_LOCATION ; give dos its temporary loc.
<span style="color:black">SYSINIT:0A23                 </span>assume es:nothing
<span style="color:black">SYSINIT:0A23                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">SYSINIT:0A25                 </span><span style="color:navy">call    cs:</span>dos_segreinit
<span style="color:black">SYSINIT:0A2A                 </span><span style="color:navy">mov     cs:</span>runhigh<span style="color:navy">, </span><span style="color:#ff8000">0   </span>; mark that we are running lo
<span style="color:black">SYSINIT:0A30                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0A30 </span>LoadDOSHiOrLo   endp
<span style="color:black">SYSINIT:0A30
SYSINIT:0A31
SYSINIT:0A31 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0A31
SYSINIT:0A31
SYSINIT:0A31 </span>TryToMovDOSHi   proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0A31                 </span><span style="color:navy">call    </span>MovDOSHi
<span style="color:black">SYSINIT:0A34                 </span><span style="color:navy">jb      short </span><span style="color:gray">ttldhx
</span><span style="color:black">SYSINIT:0A36                 </span><span style="color:navy">mov     es, cs:</span>CURRENT_DOS_LOCATION ; give dos its temporary loc.
<span style="color:black">SYSINIT:0A3B                 </span><span style="color:navy">xor     ax, ax          </span>; ax = 0 --&gt; install stub
<span style="color:black">SYSINIT:0A3D                 </span><span style="color:navy">call    cs:</span>dos_segreinit
<span style="color:black">SYSINIT:0A42                 </span><span style="color:navy">mov     cs:</span>runhigh<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:0A48                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:0A49
SYSINIT:0A49 </span><span style="color:gray">ttldhx</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0A49                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0A49 </span>TryToMovDOSHi   endp
<span style="color:black">SYSINIT:0A49
SYSINIT:0A4A
SYSINIT:0A4A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0A4A
SYSINIT:0A4A
SYSINIT:0A4A </span>MovDOSHi        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0A4A                 </span><span style="color:navy">call    </span>AllocHMA        ; did we get HMA?
<span style="color:black">SYSINIT:0A4D                 </span><span style="color:navy">jb      short </span><span style="color:gray">mdhx      </span>; no
<span style="color:black">SYSINIT:0A4F                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0FFFFh      </span>; yes, HMA seg = 0ffffh
<span style="color:black">SYSINIT:0A52                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:0A54                 </span>assume es:nothing
<span style="color:black">SYSINIT:0A54                 </span><span style="color:navy">call    </span>MovBIOS         ; First move BIOS into HMA
<span style="color:black">SYSINIT:0A57                 </span><span style="color:navy">mov     cx, cs:</span>hi_doscod_size ; when it is in HMA
<span style="color:black">SYSINIT:0A5C                 </span><span style="color:navy">call    </span>MovDOS          ; and move it
<span style="color:black">SYSINIT:0A5F                 </span><span style="color:navy">call    </span>SaveFreeHMAPtr
<span style="color:black">SYSINIT:0A62                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:0A63
SYSINIT:0A63 </span><span style="color:gray">mdhx</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0A63                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0A63 </span>MovDOSHi        endp
<span style="color:black">SYSINIT:0A63
SYSINIT:0A64
SYSINIT:0A64 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0A64
SYSINIT:0A64
SYSINIT:0A64 </span>MovDOSLo        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0A64                 </span><span style="color:navy">call    </span>AllocMemForDOS  ; incestuosly!
<span style="color:black">SYSINIT:0A67                 </span><span style="color:navy">mov     es, ax          </span>; pass the segment to MovBIOS
<span style="color:black">SYSINIT:0A69                 </span>assume es:nothing
<span style="color:black">SYSINIT:0A69                 </span><span style="color:navy">call    </span>MovBIOS
<span style="color:black">SYSINIT:0A6C                 </span><span style="color:navy">mov     cx, cs:</span>lo_doscod_size ; DOS code size when loaded
<span style="color:black">SYSINIT:0A71                 </span><span style="color:navy">call    </span>MovDOS
<span style="color:black">SYSINIT:0A74                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0A74 </span>MovDOSLo        endp
<span style="color:black">SYSINIT:0A74
SYSINIT:0A75
SYSINIT:0A75 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0A75
SYSINIT:0A75
SYSINIT:0A75 </span>MovBIOS         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0A75                 </span><span style="color:navy">mov     ds, cs:</span>temp_bcode_seg
<span style="color:black">SYSINIT:0A7A                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0A7A                 </span><span style="color:navy">mov     si, </span><span style="color:green">30h         </span>; BCODE_START
<span style="color:black">SYSINIT:0A7D                 </span><span style="color:navy">mov     di, si
</span><span style="color:black">SYSINIT:0A7F                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">1A70h       </span>; BCODE_END
<span style="color:black">SYSINIT:0A82                 </span><span style="color:navy">sub     cx, si          </span>; size of BIOS
<span style="color:black">SYSINIT:0A84                 </span><span style="color:navy">shr     cx, </span><span style="color:green">1           </span>; Both the labels are para aligned
<span style="color:black">SYSINIT:0A86                 </span><span style="color:navy">rep movsw
</span><span style="color:black">SYSINIT:0A88                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:0A89                 </span><span style="color:navy">push    di              </span>; save end of BIOS
<span style="color:black">SYSINIT:0A8A                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:0A8C                 </span><span style="color:navy">mov     cs:</span>BCodeSeg<span style="color:navy">, ax </span>; save it for later use
<span style="color:black">SYSINIT:0A90                 </span><span style="color:navy">call    dword ptr cs:</span>_seg_reinit_ptr ; far call to seg_reinit
<span style="color:black">SYSINIT:0A90                                         </span>; call far [cs:seg_reinit_ptr]
<span style="color:black">SYSINIT:0A95                 </span><span style="color:navy">pop     di              </span>; get back end of BIOS
<span style="color:black">SYSINIT:0A96                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:0A97                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0A97 </span>MovBIOS         endp
<span style="color:black">SYSINIT:0A97
SYSINIT:0A98
SYSINIT:0A98 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0A98
SYSINIT:0A98
SYSINIT:0A98 </span>MovDOS          proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0A98                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:0A99                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:0A9A                 </span><span style="color:navy">lds     si, dword ptr cs:</span>dosinit
<span style="color:black">SYSINIT:0A9F                 </span><span style="color:navy">rep movsb
</span><span style="color:black">SYSINIT:0AA1                 </span><span style="color:navy">pop     bx              </span>; get back offset into which DOS was moved
<span style="color:black">SYSINIT:0AA2                 </span><span style="color:navy">mov     ax, cs:</span>dosinit  ; get the offset at which DOS wants to run
<span style="color:black">SYSINIT:0AA6                 </span><span style="color:navy">sub     ax, bx
</span><span style="color:black">SYSINIT:0AA8                 </span><span style="color:navy">call    </span>_off_to_para
<span style="color:black">SYSINIT:0AAB                 </span><span style="color:navy">pop     bx              </span>; get the segment at which we moved DOS into
<span style="color:black">SYSINIT:0AAC                 </span><span style="color:navy">sub     bx, ax          </span>; Adjust segment
<span style="color:black">SYSINIT:0AAE                 </span><span style="color:navy">mov     cs:</span>CURRENT_DOS_LOCATION<span style="color:navy">, bx </span>; and save it
<span style="color:black">SYSINIT:0AB3                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0AB3 </span>MovDOS          endp
<span style="color:black">SYSINIT:0AB3
SYSINIT:0AB4
SYSINIT:0AB4 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0AB4
SYSINIT:0AB4
SYSINIT:0AB4 </span>AllocMemForDOS  proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0AB4
SYSINIT:0AB4 </span><span style="color:gray">; FUNCTION CHUNK AT SYSINIT:12BD SIZE 00000001 BYTES
</span><span style="color:black">SYSINIT:0AB4
SYSINIT:0AB4                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">1A70h       </span>; BCODE_END
<span style="color:black">SYSINIT:0AB7                 </span><span style="color:navy">sub     ax, </span><span style="color:green">30h         </span>; BCODE_START
<span style="color:black">SYSINIT:0AB7                                         </span>; BCODE_END-BCODE_START = BIOS code size
<span style="color:black">SYSINIT:0ABA                 </span><span style="color:navy">add     ax, cs:</span>lo_doscod_size
<span style="color:black">SYSINIT:0ABF                 </span><span style="color:navy">add     ax, </span><span style="color:#ff8000">0Fh
</span><span style="color:black">SYSINIT:0AC2                 </span><span style="color:navy">call    </span>_off_to_para    ; convert to para
<span style="color:black">SYSINIT:0AC5                 </span><span style="color:navy">or      bx, bx          </span>; can we use int 21h for alloc ?
<span style="color:black">SYSINIT:0AC7                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:black">SYSINIT:0AC9                 </span><span style="color:navy">jz      short </span><span style="color:gray">update_arena </span>; no
<span style="color:black">SYSINIT:0ACB                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:black">SYSINIT:0ACD                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:black">SYSINIT:0ACD                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:black">SYSINIT:0ACF                 </span><span style="color:navy">jb      short </span><span style="color:gray">FatalErr
</span><span style="color:black">SYSINIT:0AD1                 </span><span style="color:navy">sub     ax, </span><span style="color:#ff8000">3           </span>; Take care ORG 30h of BIOS code
<span style="color:black">SYSINIT:0AD4                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:0AD6                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">21h</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:20h+ARENA.OWNER],08h
<span style="color:black">SYSINIT:0ADD                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">28h</span><span style="color:navy">, </span><span style="color:#ff8000">4353h </span>; &#039;SC&#039; ; mark it as system code area
<span style="color:black">SYSINIT:0AE4                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0AE5 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0AE5
SYSINIT:0AE5 </span><span style="color:gray">update_arena</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0AE5                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:0AE6                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:0AE7                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:0AE8                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:0AE9                 </span><span style="color:navy">lds     di, cs:</span>DOSINFO  ; get ptr to DOS var
<span style="color:black">SYSINIT:0AEE                 </span><span style="color:navy">dec     di
</span><span style="color:black">SYSINIT:0AEF                 </span><span style="color:navy">dec     di              </span>; Arena head is immediately before sysvar
<span style="color:black">SYSINIT:0AF0                 </span><span style="color:navy">mov     es, word ptr [di] </span>; es = arena head
<span style="color:black">SYSINIT:0AF2                 </span><span style="color:navy">mov     cx, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE] ; total low mem size
<span style="color:black">SYSINIT:0AF7                 </span><span style="color:navy">cmp     cx, bx          </span>; is it sufficient ?
<span style="color:black">SYSINIT:0AF9                 </span><span style="color:navy">jb      short </span><span style="color:gray">FatalErr  </span>; no, fatal error
<span style="color:black">SYSINIT:0AFB                 </span><span style="color:navy">mov     dl, es:</span><span style="color:green">0        </span>; [es:ARENA.SIGNATURE]
<span style="color:black">SYSINIT:0B00                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:0B02                 </span><span style="color:navy">add     ax, bx          </span>; ax = new arena head
<span style="color:black">SYSINIT:0B04                 </span><span style="color:navy">mov     [di], ax        </span>; store it in DOS data area
<span style="color:black">SYSINIT:0B06                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:0B08                 </span><span style="color:navy">mov     ds:</span><span style="color:green">0</span><span style="color:navy">, dl        </span>; [ARENA.SIGNATURE] ; type of arena
<span style="color:black">SYSINIT:0B0C                 </span><span style="color:navy">mov     word ptr ds:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; [ARENA.OWNER],0 ; free
<span style="color:black">SYSINIT:0B12                 </span><span style="color:navy">sub     cx, bx          </span>; size of the new block
<span style="color:black">SYSINIT:0B14                 </span><span style="color:navy">mov     ds:</span><span style="color:green">3</span><span style="color:navy">, cx        </span>; [ARENA.SIZE],cx ; store it in the arena
<span style="color:black">SYSINIT:0B18                 </span><span style="color:navy">mov     ax, es          </span>; return seg to the caller
<span style="color:black">SYSINIT:0B1A                 </span><span style="color:navy">sub     ax, </span><span style="color:#ff8000">3           </span>; Take care ORG 30h of BIOS code
<span style="color:black">SYSINIT:0B1D                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:0B1E                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:0B1F                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:0B20                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0B21                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0B22 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0B22
SYSINIT:0B22 </span><span style="color:gray">FatalErr</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0B22                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:0B23                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0B24                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:0B24                 </span><span style="color:navy">mov     dx, offset </span>FEmsg <span style="color:gray">; &quot;Fatal Error: Cannot allocate Memory for&quot;...
</span><span style="color:black">SYSINIT:0B27                 </span><span style="color:navy">mov     ah, </span><span style="color:green">9
</span><span style="color:black">SYSINIT:0B29                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - PRINT STRING
<span style="color:black">SYSINIT:0B29                                         </span>; DS:DX -&gt; string terminated by &quot;$&quot;
<span style="color:black">SYSINIT:0B2B                 </span><span style="color:navy">jmp     </span>stall
<span style="color:black">SYSINIT:0B2B </span><span style="background:blue">AllocMemForDOS  endp</span><span style="background:blue"> ; sp-analysis failed</span>
<span style="color:black">SYSINIT:0B2B
SYSINIT:0B2E
SYSINIT:0B2E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0B2E
SYSINIT:0B2E
SYSINIT:0B2E </span>AllocHMA        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0B2E                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:0B2F                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h         </span>; DOSBIODATASEG ; BIOSDATA segment
<span style="color:black">SYSINIT:0B32                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:0B34                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0B34                 </span><span style="color:navy">call    </span>IsXMSLoaded
<span style="color:black">SYSINIT:0B37                 </span><span style="color:navy">jnz     short </span><span style="color:gray">grabhma_error
</span><span style="color:black">SYSINIT:0B39                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4310h
</span><span style="color:black">SYSINIT:0B3C                 </span><span style="color:navy">int     </span><span style="color:green">2Fh             </span>; - Multiplex - XMS - GET DRIVER ADDRESS
<span style="color:black">SYSINIT:0B3C                                         </span>; Return: ES:BX -&gt; driver entry point
<span style="color:black">SYSINIT:0B3E                 </span><span style="color:navy">mov     word ptr ds:</span>xms<span style="color:navy">, bx
</span><span style="color:black">SYSINIT:0B42                 </span><span style="color:navy">mov     word ptr ds:</span>xms<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">SYSINIT:0B46                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">1           </span>; request HMA
<span style="color:black">SYSINIT:0B48                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:0B4B                 </span><span style="color:navy">call    ds:</span>xms          ; call far [xms]
<span style="color:black">SYSINIT:0B4F                 </span><span style="color:navy">dec     ax
</span><span style="color:black">SYSINIT:0B50                 </span><span style="color:navy">jz      short </span><span style="color:gray">allocHMA_1 </span>; error if not able to allocate HMA
<span style="color:black">SYSINIT:0B52                 </span><span style="color:navy">mov     ah, </span><span style="color:green">88h
</span><span style="color:black">SYSINIT:0B54                 </span><span style="color:navy">int     </span><span style="color:green">15h             </span>; Get Extended Memory Size
<span style="color:black">SYSINIT:0B54                                         </span>; Return: CF clear on success
<span style="color:black">SYSINIT:0B54                                         </span>; AX = size of memory above 1M in K
<span style="color:black">SYSINIT:0B56                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">64          </span>; less than 64 K of hma ?
<span style="color:black">SYSINIT:0B59                 </span><span style="color:navy">jb      short </span><span style="color:gray">grabhma_error
</span><span style="color:black">SYSINIT:0B5B
SYSINIT:0B5B </span><span style="color:gray">allocHMA_1</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0B5B                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">5           </span>; localenableA20
<span style="color:black">SYSINIT:0B5D                 </span><span style="color:navy">call    ds:</span>xms
<span style="color:black">SYSINIT:0B61                 </span><span style="color:navy">dec     ax
</span><span style="color:black">SYSINIT:0B62                 </span><span style="color:navy">jnz     short </span><span style="color:gray">grabhma_error </span>; error if couldn&#039;t enable A20
<span style="color:black">SYSINIT:0B64                 </span><span style="color:navy">call    </span>IsVDiskInstalled
<span style="color:black">SYSINIT:0B67                 </span><span style="color:navy">jz      short </span><span style="color:gray">grabhma_error </span>; yes, we cant use HMA
<span style="color:black">SYSINIT:0B69                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:0B6C                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:0B6E                 </span>assume es:nothing
<span style="color:black">SYSINIT:0B6E                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">10h</span><span style="color:navy">, </span><span style="color:#ff8000">1234h </span>; see if we can really read/write there
<span style="color:black">SYSINIT:0B75                 </span><span style="color:navy">cmp     word ptr es:</span><span style="color:green">10h</span><span style="color:navy">, </span><span style="color:#ff8000">1234h
</span><span style="color:black">SYSINIT:0B7C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">grabhma_error </span>; don&#039;t try to load there if XMS lied
<span style="color:black">SYSINIT:0B7E                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:0B7F                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0B80                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0B80                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0B81 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0B81
SYSINIT:0B81 </span><span style="color:gray">grabhma_error</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0B81                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:0B82                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0B83                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0B83 </span>AllocHMA        endp
<span style="color:black">SYSINIT:0B83
SYSINIT:0B84
SYSINIT:0B84 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0B84
SYSINIT:0B84
SYSINIT:0B84 </span>IsXMSLoaded     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0B84                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4300h
</span><span style="color:black">SYSINIT:0B87                 </span><span style="color:navy">int     </span><span style="color:green">2Fh             </span>; - Multiplex - XMS - INSTALLATION CHECK
<span style="color:black">SYSINIT:0B87                                         </span>; Return: AL = 80h XMS driver installed
<span style="color:black">SYSINIT:0B87                                         </span>; AL &lt;&gt; 80h no driver
<span style="color:black">SYSINIT:0B89                 </span><span style="color:navy">cmp     al, </span><span style="color:green">80h         </span>; XMS installed?
<span style="color:black">SYSINIT:0B8B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0B8B </span>IsXMSLoaded     endp
<span style="color:black">SYSINIT:0B8B
</span><span style="color:maroon">SYSINIT:0B8C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:0B8C
SYSINIT:0B8C </span>FTryToMovDOSHi<span style="color:navy">:                         </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:0B8C                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:0B8D                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">SYSINIT:0B8E                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:0B8F                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">SYSINIT:0B90                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:0B91                 </span><span style="color:navy">push    di
</span><span style="color:maroon">SYSINIT:0B92                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:0B93                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:0B94                 </span><span style="color:navy">cmp     cs:</span>runhigh<span style="color:navy">, </span><span style="color:green">0FFh
</span><span style="color:maroon">SYSINIT:0B9A                 </span><span style="color:navy">jnz     short </span>_ftymdh_1
<span style="color:maroon">SYSINIT:0B9C                 </span><span style="color:navy">call    </span>TryToMovDOSHi
<span style="color:maroon">SYSINIT:0B9F
SYSINIT:0B9F </span>_ftymdh_1<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:0B9F                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:0BA0                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:0BA0                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:0BA1                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">SYSINIT:0BA2                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:0BA3                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">SYSINIT:0BA4                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:0BA5                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">SYSINIT:0BA6                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:0BA7                 </span><span style="color:navy">retf
</span><span style="color:maroon">SYSINIT:0BA7 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0BA8 </span>StartVDHead     <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0BA8                                         </span>; link to next device driver
<span style="color:gray">SYSINIT:0BAC                 </span><span style="color:navy">dw </span><span style="color:#008040">8000h                </span>; device attribute
<span style="color:gray">SYSINIT:0BAE                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; strategy routine offset
<span style="color:gray">SYSINIT:0BB0                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; interrupt routine offset
<span style="color:gray">SYSINIT:0BB2                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; number of units
<span style="color:gray">SYSINIT:0BB3                 </span><span style="color:navy">db </span><span style="color:#008040">7 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span>; reserved area
<span style="color:gray">SYSINIT:0BBA </span>VDiskSig1       <span style="color:navy">db &#039;VDISK&#039;              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0BBF </span><span style="color:navy">aV3_3           db &#039;  V3.3&#039;             </span>; vdisk label ; VLEN1 equ ($-VDiskSig1)
<span style="color:gray">SYSINIT:0BC5                 </span><span style="color:navy">db </span><span style="color:#008040">15 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)            </span>; pad
<span style="color:gray">SYSINIT:0BD4                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; bits 0-15 of free HMA
<span style="color:gray">SYSINIT:0BD6                 </span><span style="color:navy">db </span><span style="color:#008040">11h                  </span>; bits 16-23 of free HMA (1M + 64K)
<span style="color:gray">SYSINIT:0BD7 </span>VDInt19         <span style="color:navy">db </span><span style="color:#008040">0EAh                 </span>; jmp to old vector
<span style="color:gray">SYSINIT:0BD8 </span>OldVDInt19      <span style="color:navy">dw </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0BDC </span>VDiskHMAHead    <span style="color:navy">db </span><span style="color:#008040">3 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0BDC                                         </span>; EndVDHead
<span style="color:gray">SYSINIT:0BDC                                         </span>; non-bootable disk
<span style="color:gray">SYSINIT:0BDF </span>VDiskSig2       <span style="color:navy">db &#039;VDISK&#039;              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0BE4 </span><span style="color:navy">a3_3            db &#039;3.3&#039;                </span>; VLEN2 equ ($-VDiskSig2)
<span style="color:gray">SYSINIT:0BE4                                         </span>; OEM - signature
<span style="color:gray">SYSINIT:0BE7                 </span><span style="color:navy">dw </span><span style="color:#008040">128                  </span>; number of bytes/sector
<span style="color:gray">SYSINIT:0BE9                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; sectors/cluster
<span style="color:gray">SYSINIT:0BEA                 </span><span style="color:navy">dw </span><span style="color:#008040">1                    </span>; reserved sectors
<span style="color:gray">SYSINIT:0BEC                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; number of FAT copies
<span style="color:gray">SYSINIT:0BED                 </span><span style="color:navy">dw </span><span style="color:#008040">64                   </span>; number of root dir entries
<span style="color:gray">SYSINIT:0BEF                 </span><span style="color:navy">dw </span><span style="color:#008040">512                  </span>; number of sectors
<span style="color:gray">SYSINIT:0BF1                 </span><span style="color:navy">db </span><span style="color:#008040">0FEh                 </span>; media descriptor
<span style="color:gray">SYSINIT:0BF2                 </span><span style="color:navy">dw </span><span style="color:#008040">6                    </span>; number of sectors/FAT
<span style="color:gray">SYSINIT:0BF4                 </span><span style="color:navy">dw </span><span style="color:#008040">8                    </span>; sectors per track
<span style="color:gray">SYSINIT:0BF6                 </span><span style="color:navy">dw </span><span style="color:#008040">1                    </span>; number of heads
<span style="color:gray">SYSINIT:0BF8                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; number of hidden sectors
<span style="color:gray">SYSINIT:0BFA                 </span><span style="color:navy">dw </span><span style="color:#008040">440h                 </span>; Start of free HMA in K (1M+64K)
<span style="color:black">SYSINIT:0BFC
SYSINIT:0BFC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0BFC
SYSINIT:0BFC
SYSINIT:0BFC </span>InstVDiskHeader proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0BFC                 </span><span style="color:navy">xor     ax, ax          </span>; EndVDiskHMAHead (SYSINIT:0BFCh)
<span style="color:black">SYSINIT:0BFE                 </span><span style="color:navy">mov     ds, ax          </span>; seg of int vect table
<span style="color:black">SYSINIT:0C00                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0C00                 </span><span style="color:navy">mov     ax, word ptr ds:aClock+</span><span style="color:green">1 </span>; [19h*4]
<span style="color:black">SYSINIT:0C03                 </span><span style="color:navy">mov     cs:</span>OldVDInt19<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:0C07                 </span><span style="color:navy">mov     ax, word ptr ds:aClock+</span><span style="color:green">3 </span>; [19h*4+2]
<span style="color:black">SYSINIT:0C0A                 </span><span style="color:navy">mov     cs:</span>OldVDInt19<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:0C0E                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:black">SYSINIT:0C10                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">4
</span><span style="color:black">SYSINIT:0C13                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:black">SYSINIT:0C13                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:black">SYSINIT:0C15                 </span><span style="color:navy">dec     ax
</span><span style="color:black">SYSINIT:0C16                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:0C18                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:ARENA.OWNER],8 ; owner = System
<span style="color:black">SYSINIT:0C1F                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">4353h </span>; [es:ARENA.NAME],&#039;SC&#039; ; System Code
<span style="color:black">SYSINIT:0C26                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:0C27                 </span><span style="color:navy">mov     es, ax          </span>; get back to allocated memory
<span style="color:black">SYSINIT:0C29                 </span><span style="color:navy">cli                     </span>; no reboots at this time
<span style="color:black">SYSINIT:0C29                                         </span>; install new int 19 vector
<span style="color:black">SYSINIT:0C2A                 </span><span style="color:navy">mov     word ptr ds:aClock+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">47 </span>; (VDInt19-StartVDHead)
<span style="color:black">SYSINIT:0C2A                                         </span>; 0BD7h-0BA8h = 2Fh = 47
<span style="color:black">SYSINIT:0C30                 </span><span style="color:navy">mov     word ptr ds:aClock+</span><span style="color:green">3</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:0C33                 </span><span style="color:navy">mov     cx, </span><span style="color:green">52          </span>; (EndVDHead-StartVDHead)
<span style="color:black">SYSINIT:0C36                 </span><span style="color:navy">mov     si, offset </span>StartVDHead ; SYSINIT:0BA8h
<span style="color:black">SYSINIT:0C39                 </span><span style="color:navy">xor     di, di
</span><span style="color:black">SYSINIT:0C3B                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:0C3C                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0C3D                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:0C3D                 </span><span style="color:navy">cld
</span><span style="color:black">SYSINIT:0C3E                 </span><span style="color:navy">rep movsb
</span><span style="color:black">SYSINIT:0C40                 </span><span style="color:navy">sti                     </span>; mov the HMA VDisk head into HMA
<span style="color:black">SYSINIT:0C41                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:0C42                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:0C43                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:0C46                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:0C48                 </span>assume es:nothing
<span style="color:black">SYSINIT:0C48                 </span><span style="color:navy">mov     di, </span><span style="color:green">10h
</span><span style="color:black">SYSINIT:0C4B                 </span><span style="color:navy">mov     cx, </span><span style="color:green">32          </span>; (EndVDiskHMAHead-VDiskHMAHead)
<span style="color:black">SYSINIT:0C4E                 </span><span style="color:navy">mov     si, offset </span>VDiskHMAHead ; SYSINIT:0BDCh
<span style="color:black">SYSINIT:0C51                 </span><span style="color:navy">rep movsb
</span><span style="color:black">SYSINIT:0C53                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:0C54                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:0C55                 </span>assume es:nothing
<span style="color:black">SYSINIT:0C55                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0C55 </span>InstVDiskHeader endp
<span style="color:black">SYSINIT:0C55
SYSINIT:0C55 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:0C56 </span>dummy           <span style="color:navy">db </span><span style="color:#008040">8 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0C56                                         </span>; bmove
<span style="color:gray">SYSINIT:0C5E </span>gdt             <span style="color:navy">db </span><span style="color:#008040">8 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span>; times desc.size db 0
<span style="color:gray">SYSINIT:0C66 </span>src_desc        <span style="color:navy">dw </span><span style="color:#008040">0FFFFh               </span>; des &lt;0ffffh,0,0,93h,0&gt;
<span style="color:gray">SYSINIT:0C68 </span>desc_lo_word    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0C6A </span>desc_hi_byte    <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:0C6B                 </span><span style="color:navy">db </span><span style="color:#008040">93h
</span><span style="color:gray">SYSINIT:0C6C                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:0C6E </span>tgt_desc        <span style="color:navy">dw </span><span style="color:#008040">0FFFFh               </span>; desc &lt;0ffffh,0,10h,93h,0&gt;  ; 1MB
<span style="color:gray">SYSINIT:0C6E                                         </span>; desc.seg_lim
<span style="color:gray">SYSINIT:0C70                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; desc.lo_word
<span style="color:gray">SYSINIT:0C72                 </span><span style="color:navy">db </span><span style="color:#008040">10h                  </span>; desc.hi_byte
<span style="color:gray">SYSINIT:0C73                 </span><span style="color:navy">db </span><span style="color:#008040">93h                  </span>; desc.acc_rights
<span style="color:gray">SYSINIT:0C74                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; desc.reserved
<span style="color:gray">SYSINIT:0C76 </span>rombios_code    <span style="color:navy">db </span><span style="color:#008040">8 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span>; times desc.size db 0
<span style="color:gray">SYSINIT:0C7E </span>temp_stack      <span style="color:navy">db </span><span style="color:#008040">8 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span>; times desc.size db 0
<span style="color:gray">SYSINIT:0C86 </span>ClrdVDISKHead   <span style="color:navy">db </span><span style="color:#008040">32 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)            </span><span style="color:#8080ff">; ...
</span><span style="color:black">SYSINIT:0CA6
SYSINIT:0CA6 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0CA6
SYSINIT:0CA6
SYSINIT:0CA6 </span>ClrVDISKHeader  proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0CA6                 </span><span style="color:navy">in      al, </span><span style="color:green">64h         </span>; 8042 keyboard controller status register
<span style="color:black">SYSINIT:0CA6                                         </span>; 7:  PERR    1=parity error in data received from keyboard
<span style="color:black">SYSINIT:0CA6                                         </span>;    +----------- AT Mode ----------+------------ PS/2 Mode ------------+
<span style="color:black">SYSINIT:0CA6                                         </span>; 6: |RxTO    receive (Rx) timeout  | TO      general timeout (Rx or Tx)|
<span style="color:black">SYSINIT:0CA6                                         </span>; 5: |TxTO    transmit (Tx) timeout | MOBF    mouse output buffer full  |
<span style="color:black">SYSINIT:0CA6                                         </span>;    +------------------------------+-----------------------------------+
<span style="color:black">SYSINIT:0CA6                                         </span>; 4:  INH     0=keyboard communications inhibited
<span style="color:black">SYSINIT:0CA6                                         </span>; 3:  A2      0=60h was the port last written to, 1=64h was last
<span style="color:black">SYSINIT:0CA6                                         </span>; 2:  SYS     distinguishes reset types: 0=cold reboot, 1=warm reboot
<span style="color:black">SYSINIT:0CA6                                         </span>; 1:  IBF     1=input buffer full (keyboard can&#039;t accept data)
<span style="color:black">SYSINIT:0CA6                                         </span>; 0:  OBF     1=output buffer full (data from keyboard is available)
<span style="color:black">SYSINIT:0CA8                 </span><span style="color:navy">test    al, </span><span style="color:green">10h         </span>; test bit 4 - Is keyboard inhibited?
<span style="color:black">SYSINIT:0CAA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ClrVDISKok </span>; no, go do block move
<span style="color:black">SYSINIT:0CAC                 </span><span style="color:navy">cmp     word ptr cs:</span>sys_model_byte<span style="color:navy">, </span><span style="color:#ff8000">19F8h </span>; check for TORTUGA models
<span style="color:black">SYSINIT:0CB3                 </span><span style="color:navy">jz      short </span><span style="color:gray">ClrVDISKno </span>; do not use INT 15h block move code
<span style="color:black">SYSINIT:0CB3                                         </span>; (while 8042 is disabled)
<span style="color:black">SYSINIT:0CB5                 </span><span style="color:navy">cmp     word ptr cs:</span>sys_model_byte<span style="color:navy">, </span><span style="color:#ff8000">9FCh </span>; Check for PS/2 30-286 model
<span style="color:black">SYSINIT:0CBC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ClrVDISKok
</span><span style="color:black">SYSINIT:0CBE
SYSINIT:0CBE </span><span style="color:gray">ClrVDISKno</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0CBE                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0CBF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0CBF
SYSINIT:0CBF </span><span style="color:gray">ClrVDISKok</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0CBF                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:0CC0                 </span><span style="color:navy">mov     ax, cs
</span><span style="color:black">SYSINIT:0CC2                 </span><span style="color:navy">mov     dx, ax
</span><span style="color:black">SYSINIT:0CC4                 </span><span style="color:navy">mov     cl, </span><span style="color:green">12
</span><span style="color:black">SYSINIT:0CC6                 </span><span style="color:navy">shr     dx, cl          </span>; dx = higher 4 bits of the segment number
<span style="color:black">SYSINIT:0CC6                                         </span>;    = segment number / 4096 (= byte address / 65536)
<span style="color:black">SYSINIT:0CC8                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4
</span><span style="color:black">SYSINIT:0CCA                 </span><span style="color:navy">shl     ax, cl          </span>; ax = (lower 12 bits of the segment number)*16
<span style="color:black">SYSINIT:0CCC                 </span><span style="color:navy">add     ax, offset </span>ClrdVDISKHead
<span style="color:black">SYSINIT:0CCF                 </span><span style="color:navy">adc     dl, </span><span style="color:#ff8000">0           </span>; dl:ax = 24 bit linear address
<span style="color:black">SYSINIT:0CD2                 </span><span style="color:navy">mov     cs:</span>desc_lo_word<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:0CD6                 </span><span style="color:navy">mov     cs:</span>desc_hi_byte<span style="color:navy">, dl
</span><span style="color:black">SYSINIT:0CDB                 </span><span style="color:navy">mov     cx, </span><span style="color:green">16          </span>; 16 words
<span style="color:black">SYSINIT:0CDE                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:0CDF                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:0CE0                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:0CE0                 </span><span style="color:navy">mov     si, offset </span>dummy ; offset bmove
<span style="color:black">SYSINIT:0CE3                 </span><span style="color:navy">mov     ah, </span><span style="color:green">87h
</span><span style="color:black">SYSINIT:0CE5                 </span><span style="color:navy">int     </span><span style="color:green">15h             </span>; EXTENDED MEMORY - BLOCK MOVE (AT,XT286,PS)
<span style="color:black">SYSINIT:0CE5                                         </span>; CX = number of words to move, ES:SI -&gt; global descriptor table
<span style="color:black">SYSINIT:0CE5                                         </span>; Return: CF set on error, AH = status
<span style="color:black">SYSINIT:0CE7                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:0CE8                 </span>assume es:nothing
<span style="color:black">SYSINIT:0CE8                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0CE8 </span>ClrVDISKHeader  endp
<span style="color:black">SYSINIT:0CE8
SYSINIT:0CE9
SYSINIT:0CE9 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0CE9
SYSINIT:0CE9
SYSINIT:0CE9 </span>SaveFreeHMAPtr  proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0CE9                 </span><span style="color:navy">mov     bx, es
</span><span style="color:black">SYSINIT:0CEB                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0FFFFh      </span>; HMA segment
<span style="color:black">SYSINIT:0CEE                 </span><span style="color:navy">sub     ax, bx
</span><span style="color:black">SYSINIT:0CF0                 </span><span style="color:navy">add     di, </span><span style="color:green">15          </span>; para round
<span style="color:black">SYSINIT:0CF3                 </span><span style="color:navy">and     di, </span><span style="color:green">0FFF0h
</span><span style="color:black">SYSINIT:0CF6                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4
</span><span style="color:black">SYSINIT:0CF8                 </span><span style="color:navy">shl     ax, cl
</span><span style="color:black">SYSINIT:0CFA                 </span><span style="color:navy">sub     di, ax
</span><span style="color:black">SYSINIT:0CFC                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:0CFD                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h         </span>; DOSBIODATASEG ; BIOSDATA segment
<span style="color:black">SYSINIT:0D00                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:0D02                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0D02                 </span><span style="color:navy">mov     ds:</span>FreeHMAPtr<span style="color:navy">, di </span>; BIOSDATA:08F7h
<span style="color:black">SYSINIT:0D06                 </span><span style="color:navy">mov     ds:</span>inHMA<span style="color:navy">, </span><span style="color:#ff8000">0FFh  </span>; BIOSDATA:000Dh
<span style="color:black">SYSINIT:0D0B                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0D0C                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0D0C                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0D0C </span>SaveFreeHMAPtr  endp
<span style="color:black">SYSINIT:0D0C
SYSINIT:0D0D
SYSINIT:0D0D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0D0D
SYSINIT:0D0D
SYSINIT:0D0D </span>IsVDiskInstalled proc near              <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0D0D                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">SYSINIT:0D0F                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:0D11                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0D11                 </span><span style="color:navy">mov     ds, ds:off_4D+</span><span style="color:green">1 </span>; [13h*4+2]
<span style="color:black">SYSINIT:0D15                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0D15                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">12h         </span>; VDiskSig1-StartVDHead
<span style="color:black">SYSINIT:0D18                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">5           </span>; VLEN1
<span style="color:black">SYSINIT:0D1B                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:0D1C                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:0D1D                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:0D1D                 </span><span style="color:navy">mov     di, offset </span>VDiskSig1 <span style="color:gray">; &quot;VDISK&quot;
</span><span style="color:black">SYSINIT:0D20                 </span><span style="color:navy">repe cmpsb
</span><span style="color:black">SYSINIT:0D22                 </span><span style="color:navy">jz      short </span><span style="color:gray">ivdins_retn
</span><span style="color:black">SYSINIT:0D24                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:0D27                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:0D29                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0D29                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">13h         </span>; 10h+(VDiskSig2-VDiskHMAHead)
<span style="color:black">SYSINIT:0D2C                 </span><span style="color:navy">mov     di, offset </span>VDiskSig2 <span style="color:gray">; &quot;VDISK&quot;
</span><span style="color:black">SYSINIT:0D2F                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">5
</span><span style="color:black">SYSINIT:0D32                 </span><span style="color:navy">repe cmpsb
</span><span style="color:black">SYSINIT:0D34
SYSINIT:0D34 </span><span style="color:gray">ivdins_retn</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0D34                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0D34 </span>IsVDiskInstalled endp
<span style="color:black">SYSINIT:0D34
SYSINIT:0D35
SYSINIT:0D35 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0D35
SYSINIT:0D35
SYSINIT:0D35 </span>CPMHack         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0D35                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:0D36                 </span><span style="color:navy">mov     cx, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:0D39                 </span><span style="color:navy">mov     es, cx
</span><span style="color:black">SYSINIT:0D3B                 </span>assume es:nothing
<span style="color:black">SYSINIT:0D3B                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:0D3D                 </span><span style="color:navy">mov     ds, cx
</span><span style="color:black">SYSINIT:0D3F                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0D3F                 </span><span style="color:navy">mov     si, </span><span style="color:green">0C0h
</span><span style="color:black">SYSINIT:0D42                 </span><span style="color:navy">mov     di, </span><span style="color:green">0D0h
</span><span style="color:black">SYSINIT:0D45                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">5           </span><span style="color:red">; ...
</span><span style="color:black">SYSINIT:0D48                 </span><span style="color:navy">cld
</span><span style="color:black">SYSINIT:0D49                 </span><span style="color:navy">rep movsb               </span>; move 5 bytes from 0:C0h to FFFFh:D0h
<span style="color:black">SYSINIT:0D4B                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0D4C                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0D4C                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0D4C </span>CPMHack         endp
<span style="color:black">SYSINIT:0D4C
SYSINIT:0D4D
SYSINIT:0D4D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0D4D
SYSINIT:0D4D
SYSINIT:0D4D </span>_off_to_para    proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0D4D                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:0D4F                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:0D51                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:0D53                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:0D55                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0D55 </span>_off_to_para    endp
<span style="color:black">SYSINIT:0D55
SYSINIT:0D56
SYSINIT:0D56 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0D56
SYSINIT:0D56
SYSINIT:0D56 </span>TempCDS         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0D56                 </span><span style="color:navy">les     di, ds:</span>DOSINFO
<span style="color:black">SYSINIT:0D5A                 </span>assume es:nothing
<span style="color:black">SYSINIT:0D5A                 </span><span style="color:navy">mov     cl, es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">] </span>; [es:di+SYSI_NUMIO]
<span style="color:black">SYSINIT:0D5E                 </span><span style="color:navy">xor     ch, ch          </span>; (cx) = # of block devices
<span style="color:black">SYSINIT:0D60                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">21h</span><span style="color:navy">], cl </span>; [es:di+SYSI_NCDS] ; one CDS per device
<span style="color:black">SYSINIT:0D64                 </span><span style="color:navy">mov     al, cl
</span><span style="color:black">SYSINIT:0D66                 </span><span style="color:navy">mov     ah, </span><span style="color:green">88          </span>; curdirlen ; curdir_list.size
<span style="color:black">SYSINIT:0D68                 </span><span style="color:navy">mul     ah
</span><span style="color:black">SYSINIT:0D6A                 </span><span style="color:navy">call    </span>ParaRound
<span style="color:black">SYSINIT:0D6D                 </span><span style="color:navy">mov     si, ds:</span>top_of_cdss
<span style="color:black">SYSINIT:0D71                 </span><span style="color:navy">sub     si, ax
</span><span style="color:black">SYSINIT:0D73                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">18h</span><span style="color:navy">], si </span>; [es:di+SYSI_CDS+2]
<span style="color:black">SYSINIT:0D77                 </span><span style="color:navy">mov     ax, si
</span><span style="color:black">SYSINIT:0D79                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">16h</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+SYSI_CDS]
<span style="color:black">SYSINIT:0D79                                         </span>; set address of CDS list
<span style="color:black">SYSINIT:0D7F                 </span><span style="color:navy">lds     si, es:[di]     </span>; lds si,[es:di+SYSI_DPB]
<span style="color:black">SYSINIT:0D7F                                         </span>; (ds:si) = address of first DPB
<span style="color:black">SYSINIT:0D82                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:0D84                 </span><span style="color:navy">xor     di, di          </span>; (es:di) = address of 1st CDS
<span style="color:black">SYSINIT:0D84 </span><span style="background:blue">TempCDS         endp</span><span style="background:blue"> ; sp-analysis failed</span>
<span style="color:black">SYSINIT:0D84
SYSINIT:0D86
SYSINIT:0D86 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0D86
SYSINIT:0D86
SYSINIT:0D86 </span>fooset          proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0D86                 </span><span style="color:navy">mov     ax, word ptr cs:</span>DirStrng ; &quot;A:\&quot;
<span style="color:black">SYSINIT:0D8A                 </span><span style="color:navy">stosw                   </span>; setup the root as the curdir
<span style="color:black">SYSINIT:0D8B                 </span><span style="color:navy">call    </span>get_dpb_for_drive_al ; get dpb for drive in dpb
<span style="color:black">SYSINIT:0D8B                                         </span>; (ds:si) = address of DPB
<span style="color:black">SYSINIT:0D8B                                         </span>;    (si) = -1 if no drive
<span style="color:black">SYSINIT:0D8E                 </span><span style="color:navy">mov     ax, word ptr cs:</span>DirStrng<span style="color:navy">+</span><span style="color:green">2 </span>; &quot;\&quot;,0
<span style="color:black">SYSINIT:0D92                 </span><span style="color:navy">stosw
</span><span style="color:black">SYSINIT:0D93                 </span><span style="color:navy">inc     byte ptr cs:</span>DirStrng ; &quot;A:\&quot;
<span style="color:black">SYSINIT:0D98                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">SYSINIT:0D9A                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:0D9B                 </span><span style="color:navy">mov     cx, </span><span style="color:green">63          </span>; curdir_list.cdir_flags - 4
<span style="color:black">SYSINIT:0D9E                 </span><span style="color:navy">rep stosb               </span>; zero out rest of CURDIR_TEXTs
<span style="color:black">SYSINIT:0D9E                                         </span>; (ax) = 0
<span style="color:black">SYSINIT:0D9E                                         </span>; (es:di) = CURDIR_FLAGS in the CDS records
<span style="color:black">SYSINIT:0D9E                                         </span>; (ds:si) = Next DPB (-1 if none)
<span style="color:black">SYSINIT:0DA0                 </span><span style="color:navy">cmp     si, </span><span style="color:green">0FFFFh      </span>; -1
<span style="color:black">SYSINIT:0DA3                 </span><span style="color:navy">jz      short loc_4DE9  </span>; don&#039;t have any physical drive.
<span style="color:black">SYSINIT:0DA5                 </span><span style="color:navy">cmp     cs:</span>fake_floppy_drv<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:0DAB                 </span><span style="color:navy">jnz     short loc_4DF0  </span>; machine has floppy drives
<span style="color:black">SYSINIT:0DAD                 </span><span style="color:navy">cmp     byte ptr [si], </span><span style="color:#ff8000">1 </span>; cmp [si+DPB.drive],1
<span style="color:black">SYSINIT:0DAD                                         </span>; if dpb_drive = 0 (A) or 1 (B).
<span style="color:black">SYSINIT:0DB0                 </span><span style="color:navy">ja      short loc_4DF0
</span><span style="color:black">SYSINIT:0DB2                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">3           </span>; the next dbp pointer
<span style="color:black">SYSINIT:0DB4                 </span><span style="color:navy">rep stosw               </span>; ax should be zero here
<span style="color:black">SYSINIT:0DB6                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:0DB7                 </span><span style="color:navy">jmp     short loc_4E01
</span><span style="color:black">SYSINIT:0DB9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0DB9
SYSINIT:0DB9 </span><span style="color:navy">loc_4DE9:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0DB9                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">3
</span><span style="color:black">SYSINIT:0DBB                 </span><span style="color:navy">rep stosw
</span><span style="color:black">SYSINIT:0DBD                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:0DBE                 </span><span style="color:navy">jmp     short loc_4E01  </span>; jmp short fincds
<span style="color:black">SYSINIT:0DC0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0DC0
SYSINIT:0DC0 </span><span style="color:navy">loc_4DF0:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0DC0                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:0DC1                 </span><span style="color:navy">cmp     byte ptr [si+</span><span style="color:#ff8000">8</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [si+DPB.FAT_COUNT] ; non fat system?
<span style="color:black">SYSINIT:0DC5                 </span><span style="color:navy">jz      short loc_4DFA  </span>; yes. set curdir_flags to 0. ax = 0 now.
<span style="color:black">SYSINIT:0DC7                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4000h       </span>; curdir_inuse ; else,fat system.
<span style="color:black">SYSINIT:0DC7                                         </span>; set the flag to curdir_inuse.
<span style="color:black">SYSINIT:0DCA
SYSINIT:0DCA </span><span style="color:navy">loc_4DFA:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0DCA                 </span><span style="color:navy">stosw                   </span>; curdir_flags
<span style="color:black">SYSINIT:0DCB                 </span><span style="color:navy">mov     ax, si
</span><span style="color:black">SYSINIT:0DCD                 </span><span style="color:navy">stosw                   </span>; curdir_devptr
<span style="color:black">SYSINIT:0DCE                 </span><span style="color:navy">mov     ax, ds
</span><span style="color:black">SYSINIT:0DD0                 </span><span style="color:navy">stosw
</span><span style="color:black">SYSINIT:0DD1
SYSINIT:0DD1 </span><span style="color:navy">loc_4E01:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0DD1                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0FFFFh      </span>; entry point for fake_fooset_zero
<span style="color:black">SYSINIT:0DD1                                         </span>; mov ax,-1
<span style="color:black">SYSINIT:0DD4                 </span><span style="color:navy">stosw                   </span>; curdir_id
<span style="color:black">SYSINIT:0DD5                 </span><span style="color:navy">stosw                   </span>; curdir_id
<span style="color:black">SYSINIT:0DD6                 </span><span style="color:navy">stosw                   </span>; curdir_user_word
<span style="color:black">SYSINIT:0DD7                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">2           </span>; curdir_end
<span style="color:black">SYSINIT:0DDA                 </span><span style="color:navy">stosw
</span><span style="color:black">SYSINIT:0DDB                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0           </span>; clear out 7 bytes (curdir_type,
<span style="color:black">SYSINIT:0DDD                 </span><span style="color:navy">stosb
</span><span style="color:black">SYSINIT:0DDE                 </span><span style="color:navy">stosw                   </span>; curdir_ifs_hdr,curdir_fsda)
<span style="color:black">SYSINIT:0DDF                 </span><span style="color:navy">stosw
</span><span style="color:black">SYSINIT:0DE0                 </span><span style="color:navy">stosw
</span><span style="color:black">SYSINIT:0DE1                 </span><span style="color:navy">loop    </span>fooset
<span style="color:black">SYSINIT:0DE3                 </span><span style="color:navy">mov     byte ptr cs:</span>DirStrng<span style="color:navy">, &#039;</span><span style="color:green">A&#039; </span>; &quot;A:\&quot;,0
<span style="color:black">SYSINIT:0DE9                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0DE9 </span>fooset          endp
<span style="color:black">SYSINIT:0DE9
SYSINIT:0DEA
SYSINIT:0DEA </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0DEA
SYSINIT:0DEA
SYSINIT:0DEA </span>get_dpb_for_drive_al proc near          <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0DEA                 </span><span style="color:navy">lds     si, cs:</span>DOSINFO  ; point to first DPB
<span style="color:black">SYSINIT:0DEF                 </span><span style="color:navy">lds     si, [si]        </span>; (ds:si) = address of first DPB
<span style="color:black">SYSINIT:0DF1                 </span><span style="color:navy">sub     al, &#039;</span><span style="color:green">A&#039;
</span><span style="color:black">SYSINIT:0DF3
SYSINIT:0DF3 </span><span style="color:gray">get_dpb_for_drive_1</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0DF3                 </span><span style="color:navy">cmp     al, [si]        </span>; cmp al,[si+DPB.DRIVE] ; match?
<span style="color:black">SYSINIT:0DF5                 </span><span style="color:navy">jz      short </span><span style="color:gray">got_dpb_for_drive
</span><span style="color:black">SYSINIT:0DF7                 </span><span style="color:navy">lds     si, [si+</span><span style="color:#ff8000">19h</span><span style="color:navy">]    </span>; lds si,[si+DPB.NEXT_DPB]
<span style="color:black">SYSINIT:0DFA                 </span><span style="color:navy">cmp     si, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:0DFD                 </span><span style="color:navy">jnz     short </span><span style="color:gray">get_dpb_for_drive_1 </span>; loop until hit end of DPBs
<span style="color:black">SYSINIT:0DFF
SYSINIT:0DFF </span><span style="color:gray">got_dpb_for_drive</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0DFF                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:0DFF </span>get_dpb_for_drive_al endp
<span style="color:black">SYSINIT:0DFF
SYSINIT:0E00
SYSINIT:0E00 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:0E00
SYSINIT:0E00
SYSINIT:0E00 </span>endfile         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:0E00                 </span><span style="color:navy">push    ds              </span>; Build DOS structures
<span style="color:black">SYSINIT:0E01                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h         </span>; DOSBIODATASEG
<span style="color:black">SYSINIT:0E04                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:0E06                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0E06                 </span><span style="color:navy">cmp     ds:</span>multrk_flag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; multrk_off1
<span style="color:black">SYSINIT:0E06                                         </span>; multrack= command entered?
<span style="color:black">SYSINIT:0E0B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">multrk_flag_done
</span><span style="color:black">SYSINIT:0E0D                 </span><span style="color:navy">or      ds:</span>multrk_flag<span style="color:navy">, </span><span style="color:green">80h </span>; or [multrk_flag],multrk_on
<span style="color:black">SYSINIT:0E13
SYSINIT:0E13 </span><span style="color:gray">multrk_flag_done</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0E13                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0E14                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0E14                 </span><span style="color:navy">mov     ax, cs:</span>CONFBOT
<span style="color:black">SYSINIT:0E18                 </span><span style="color:navy">mov     cs:</span>ALLOCLIM<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:0E1C                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:0E1D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0E1E                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:0E1E                 </span><span style="color:navy">call    loc_8DA6
</span><span style="color:black">SYSINIT:0E21                 </span><span style="color:navy">mov     al, cs:</span>FILES
<span style="color:black">SYSINIT:0E25                 </span><span style="color:navy">sub     al, </span><span style="color:#ff8000">5
</span><span style="color:black">SYSINIT:0E27                 </span><span style="color:navy">jbe     short </span><span style="color:gray">dofcbs
</span><span style="color:black">SYSINIT:0E29                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:0E2A                 </span><span style="color:navy">mov     al, &#039;</span><span style="color:green">F&#039;         </span>; devmark_files
<span style="color:black">SYSINIT:0E2C                 </span><span style="color:navy">call    </span>setdevmark      ; set devmark for sfts (files)
<span style="color:black">SYSINIT:0E2F                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:0E30                 </span><span style="color:navy">xor     ah, ah          </span>; do not use cbw instruction!
<span style="color:black">SYSINIT:0E30                                         </span>; it does sign extend.
<span style="color:black">SYSINIT:0E32                 </span><span style="color:navy">mov     bx, cs:</span>memlo
<span style="color:black">SYSINIT:0E37                 </span><span style="color:navy">mov     dx, cs:</span>memhi
<span style="color:black">SYSINIT:0E3C                 </span><span style="color:navy">lds     di, cs:</span>DOSINFO  ; get pointer to dos data
<span style="color:black">SYSINIT:0E41                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0E41                 </span><span style="color:navy">lds     di, [di+</span><span style="color:#ff8000">4</span><span style="color:navy">]      </span>; lds di,[di+SYSI_SFT] ; ds:di points to sft
<span style="color:black">SYSINIT:0E44                 </span><span style="color:navy">mov     [di], bx        </span>; [di+SF.SFLink],bx
<span style="color:black">SYSINIT:0E46                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">2</span><span style="color:navy">], dx      </span>; [di+SF.SFLink+2],dx ; set pointer to new sft
<span style="color:black">SYSINIT:0E49                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:0E4A                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0E4B                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:0E4B                 </span><span style="color:navy">les     di, dword ptr cs:</span>memlo ; point to new sft
<span style="color:black">SYSINIT:0E50                 </span><span style="color:navy">mov     word ptr es:[di], </span><span style="color:green">0FFFFh </span>; mov word [es:di+SF.SFLink],-1
<span style="color:black">SYSINIT:0E55                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], ax   </span>; mov [es:di+SF.SFCount],ax
<span style="color:black">SYSINIT:0E59                 </span><span style="color:navy">mov     bl, </span><span style="color:green">59          </span>; SF_ENTRY.size
<span style="color:black">SYSINIT:0E5B                 </span><span style="color:navy">mul     bl
</span><span style="color:black">SYSINIT:0E5D                 </span><span style="color:navy">mov     cx, ax          </span>; ax = number of bytes to clear
<span style="color:black">SYSINIT:0E5F                 </span><span style="color:navy">add     cs:</span>memlo<span style="color:navy">, ax    </span>; allocate memory
<span style="color:black">SYSINIT:0E64                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">6
</span><span style="color:black">SYSINIT:0E67                 </span><span style="color:navy">add     cs:</span>memlo<span style="color:navy">, ax    </span>; remember the header too
<span style="color:black">SYSINIT:0E6C                 </span><span style="color:navy">or      cs:</span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">2 </span>; for_devmark
<span style="color:black">SYSINIT:0E72                 </span><span style="color:navy">call    loc_8DA6        </span>; check for mem error before the stosb
<span style="color:black">SYSINIT:0E75                 </span><span style="color:navy">add     di, ax          </span>; ax = 6
<span style="color:black">SYSINIT:0E77                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">SYSINIT:0E79                 </span><span style="color:navy">rep stosb               </span>; clean out the stuff
<span style="color:black">SYSINIT:0E7B
SYSINIT:0E7B </span><span style="color:gray">dofcbs</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0E7B                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:0E7C                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0E7D                 </span><span style="color:navy">call    loc_8DA6
</span><span style="color:black">SYSINIT:0E80                 </span><span style="color:navy">mov     al, &#039;</span><span style="color:green">X&#039;         </span>; devmark_fcbs
<span style="color:black">SYSINIT:0E82                 </span><span style="color:navy">call    </span>setdevmark
<span style="color:black">SYSINIT:0E85                 </span><span style="color:navy">mov     al, cs:</span>FCBS
<span style="color:black">SYSINIT:0E89                 </span><span style="color:navy">xor     ah, ah          </span>; do not use cbw instruction!
<span style="color:black">SYSINIT:0E89                                         </span>; it does sign extend.
<span style="color:black">SYSINIT:0E8B                 </span><span style="color:navy">mov     bx, cs:</span>memlo
<span style="color:black">SYSINIT:0E90                 </span><span style="color:navy">mov     dx, cs:</span>memhi
<span style="color:black">SYSINIT:0E95                 </span><span style="color:navy">lds     di, cs:</span>DOSINFO  ; get pointer to dos data
<span style="color:black">SYSINIT:0E9A                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0E9A                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">1Ah</span><span style="color:navy">], bx    </span>; [di+SYSI_FCB]
<span style="color:black">SYSINIT:0E9D                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">1Ch</span><span style="color:navy">], dx    </span>; [di+SYSI_FCB+2] ; set pointer to new table
<span style="color:black">SYSINIT:0EA0                 </span><span style="color:navy">mov     bl, cs:</span>KEEP
<span style="color:black">SYSINIT:0EA5                 </span><span style="color:navy">xor     bh, bh
</span><span style="color:black">SYSINIT:0EA7                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">1Eh</span><span style="color:navy">], bx    </span>; [di+SYSI_KEEP]
<span style="color:black">SYSINIT:0EAA                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:0EAB                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0EAC                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:0EAC                 </span><span style="color:navy">les     di, dword ptr </span>memlo ; point to new table
<span style="color:black">SYSINIT:0EB0                 </span><span style="color:navy">mov     word ptr es:[di], </span><span style="color:green">0FFFFh </span>; [es:di+SF.SFLink],-1
<span style="color:black">SYSINIT:0EB5                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], ax   </span>; [es:di+SF.SFCount]
<span style="color:black">SYSINIT:0EB9                 </span><span style="color:navy">mov     bl, </span><span style="color:green">59          </span>; SF_ENTRY.size
<span style="color:black">SYSINIT:0EBB                 </span><span style="color:navy">mov     cx, ax
</span><span style="color:black">SYSINIT:0EBD                 </span><span style="color:navy">mul     bl
</span><span style="color:black">SYSINIT:0EBF                 </span><span style="color:navy">add     </span>memlo<span style="color:navy">, ax       </span>; ax = number of bytes to clear
<span style="color:black">SYSINIT:0EC3                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">6           </span>; SF.size-2
<span style="color:black">SYSINIT:0EC6                 </span><span style="color:navy">add     </span>memlo<span style="color:navy">, ax       </span>; remember the header too
<span style="color:black">SYSINIT:0ECA                 </span><span style="color:navy">or      </span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">2 </span>; for_devmark
<span style="color:black">SYSINIT:0ECF                 </span><span style="color:navy">call    loc_8DA6        </span>; check for mem error before the stosb
<span style="color:black">SYSINIT:0ED2                 </span><span style="color:navy">add     di, ax          </span>; skip over header
<span style="color:black">SYSINIT:0ED4                 </span><span style="color:navy">mov     al, &#039;</span><span style="color:green">A&#039;
</span><span style="color:black">SYSINIT:0ED6
SYSINIT:0ED6 </span><span style="color:gray">fillloop</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0ED6                 </span><span style="color:navy">push    cx              </span>; save count
<span style="color:black">SYSINIT:0ED7                 </span><span style="color:navy">mov     cx, </span><span style="color:green">59          </span>; number of bytes to fill
<span style="color:black">SYSINIT:0EDA                 </span><span style="color:navy">cld
</span><span style="color:black">SYSINIT:0EDB                 </span><span style="color:navy">rep stosb               </span>; filled
<span style="color:black">SYSINIT:0EDD                 </span><span style="color:navy">mov     word ptr es:[di-</span><span style="color:green">3Bh</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di-(SF_ENTRY.size)+SF_ENTRY.sf_ref_count]
<span style="color:black">SYSINIT:0EE3                 </span><span style="color:navy">mov     word ptr es:[di-</span><span style="color:green">26h</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di-(SF_ENTRY.size)+SF_ENTRY.sf_position]
<span style="color:black">SYSINIT:0EE9                 </span><span style="color:navy">mov     word ptr es:[di-</span><span style="color:green">24h</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di-(SF_ENTRY.size)+SF_ENTRY.sf_position+2]
<span style="color:black">SYSINIT:0EEF                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:0EF0                 </span><span style="color:navy">loop    </span><span style="color:gray">fillloop
</span><span style="color:black">SYSINIT:0EF2                 </span><span style="color:navy">cmp     </span>buffers<span style="color:navy">, </span><span style="color:green">0FFFFh </span>; -1 ; has buffers been already set?
<span style="color:black">SYSINIT:0EF7                 </span><span style="color:navy">jz      short </span><span style="color:gray">dodefaultbuff
</span><span style="color:black">SYSINIT:0EF9                 </span><span style="color:navy">jmp     </span><span style="color:gray">dobuff          </span>; the user entered the buffers=.
<span style="color:black">SYSINIT:0EFC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0EFC
SYSINIT:0EFC </span><span style="color:gray">dodefaultbuff</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0EFC                 </span><span style="color:navy">mov     </span>h_buffers<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; default is no heuristic buffers.
<span style="color:black">SYSINIT:0F02                 </span><span style="color:navy">mov     </span>buffers<span style="color:navy">, </span><span style="color:#ff8000">2      </span>; default to 2 buffers
<span style="color:black">SYSINIT:0F08                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:0F09                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:0F0A                 </span><span style="color:navy">les     bp, cs:</span>DOSINFO  ; search through the dpb&#039;s
<span style="color:black">SYSINIT:0F0F                 </span><span style="color:navy">les     bp, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; [es:bp+SYSI_DPB] ; get first dpb
<span style="color:black">SYSINIT:0F13                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:0F14                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0F15
SYSINIT:0F15 </span><span style="color:gray">nextdpb</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0F15                 </span><span style="color:navy">mov     bl, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; [es:bp+DPB.drive]
<span style="color:black">SYSINIT:0F19                 </span><span style="color:navy">inc     bl
</span><span style="color:black">SYSINIT:0F1B                 </span><span style="color:navy">mov     ax, </span><span style="color:green">4408h       </span>; (IOCTL&lt;&lt;8)|8
<span style="color:black">SYSINIT:0F1E                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - IOCTL -
<span style="color:black">SYSINIT:0F20                 </span><span style="color:navy">or      ax, ax          </span>; 0 = removable disk, 1 = fixed disk
<span style="color:black">SYSINIT:0F22                 </span><span style="color:navy">jnz     short </span><span style="color:gray">nosetbuf  </span>; ax is nonzero if disk is nonremoveable
<span style="color:black">SYSINIT:0F24                 </span><span style="color:navy">xor     bx, bx          </span>; get parameters of (removable) drive
<span style="color:black">SYSINIT:0F26                 </span><span style="color:navy">mov     bl, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; [es:bp+DPB.drive]
<span style="color:black">SYSINIT:0F2A                 </span><span style="color:navy">inc     bl
</span><span style="color:black">SYSINIT:0F2C                 </span><span style="color:navy">mov     dx, offset byte_9408
</span><span style="color:black">SYSINIT:0F2F                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">440Dh       </span>; (IOCTL&lt;&lt;8)|GENERIC_IOCTL
<span style="color:black">SYSINIT:0F32                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">860h        </span>; (RAWIO&lt;&lt;8)|GET_DEVICE_PARAMETERS
<span style="color:black">SYSINIT:0F35                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - IOCTL -
<span style="color:black">SYSINIT:0F37                 </span><span style="color:navy">jb      short </span><span style="color:gray">nosetbuf  </span>; get next dpb if driver doesn&#039;t support
<span style="color:black">SYSINIT:0F37                                         </span>; generic ioctl
<span style="color:black">SYSINIT:0F39                 </span><span style="color:navy">mov     bx, word ptr byte_940D+</span><span style="color:green">0Ah </span>; [deviceparameters+15]
<span style="color:black">SYSINIT:0F39                                         </span>; [deviceparameters+A_DEVICEPARAMETERS.DP_BPB+A_BPB.BPB_TOTALSECTORS]
<span style="color:black">SYSINIT:0F3D                 </span><span style="color:navy">mov     ax, word ptr byte_940D+</span><span style="color:green">2 </span>; [deviceparameters+7]
<span style="color:black">SYSINIT:0F3D                                         </span>; [deviceparameters+A_DEVICEPARAMETERS.DP_BPB+A_BPB.BPB_BYTESPERSECTOR]
<span style="color:black">SYSINIT:0F40                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">SYSINIT:0F42                 </span><span style="color:navy">mov     cx, </span><span style="color:green">512         </span>; scale sector size in factor of 512 bytes
<span style="color:black">SYSINIT:0F45                 </span><span style="color:navy">div     cx
</span><span style="color:black">SYSINIT:0F47                 </span><span style="color:navy">mul     bx              </span>; ax = #sectors * size factor
<span style="color:black">SYSINIT:0F49                 </span><span style="color:navy">or      dx, dx          </span>; just in case of large floppies
<span style="color:black">SYSINIT:0F4B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">setbuf
</span><span style="color:black">SYSINIT:0F4D                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">720         </span>; 720 sectors * size factor of 1
<span style="color:black">SYSINIT:0F50                 </span><span style="color:navy">jbe     short </span><span style="color:gray">nosetbuf
</span><span style="color:black">SYSINIT:0F52
SYSINIT:0F52 </span><span style="color:gray">setbuf</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0F52                 </span><span style="color:navy">mov     </span>buffers<span style="color:navy">, </span><span style="color:#ff8000">3
</span><span style="color:black">SYSINIT:0F58                 </span><span style="color:navy">jmp     short </span><span style="color:gray">chk_memsize_for_buffers </span>; now check the memory size
<span style="color:black">SYSINIT:0F58                                         </span>; for default buffer count
<span style="color:black">SYSINIT:0F5A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0F5A
SYSINIT:0F5A </span><span style="color:gray">nosetbuf</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0F5A                 </span><span style="color:navy">cmp     word ptr es:[bp+</span><span style="color:#ff8000">19h</span><span style="color:navy">], </span><span style="color:green">0FFFFh </span>; [es:bp+DPB.NEXT_DPB],-1
<span style="color:black">SYSINIT:0F5F                 </span><span style="color:navy">jz      short </span><span style="color:gray">chk_memsize_for_buffers
</span><span style="color:black">SYSINIT:0F61                 </span><span style="color:navy">les     bp, es:[bp+</span><span style="color:#ff8000">19h</span><span style="color:navy">] </span>; les bp,[es:bp+DPB.NEXT_DPB]
<span style="color:black">SYSINIT:0F65                 </span><span style="color:navy">jmp     short </span><span style="color:gray">nextdpb
</span><span style="color:black">SYSINIT:0F67 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:0F67
SYSINIT:0F67 </span><span style="color:gray">chk_memsize_for_buffers</span><span style="color:navy">:                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0F67                 </span><span style="color:navy">cmp     </span>MEMORY_SIZE<span style="color:navy">, </span><span style="color:#ff8000">2000h </span>; 128kb
<span style="color:black">SYSINIT:0F6D                 </span><span style="color:navy">jbe     short </span><span style="color:gray">bufset
</span><span style="color:black">SYSINIT:0F6F                 </span><span style="color:navy">mov     </span>buffers<span style="color:navy">, </span><span style="color:#ff8000">5
</span><span style="color:black">SYSINIT:0F75                 </span><span style="color:navy">cmp     </span>MEMORY_SIZE<span style="color:navy">, </span><span style="color:#ff8000">4000h </span>; 256kb
<span style="color:black">SYSINIT:0F7B                 </span><span style="color:navy">jbe     short </span><span style="color:gray">bufset
</span><span style="color:black">SYSINIT:0F7D                 </span><span style="color:navy">mov     </span>buffers<span style="color:navy">, </span><span style="color:green">10
</span><span style="color:black">SYSINIT:0F83                 </span><span style="color:navy">cmp     </span>MEMORY_SIZE<span style="color:navy">, </span><span style="color:green">8000h </span>; 512kb
<span style="color:black">SYSINIT:0F89                 </span><span style="color:navy">jbe     short </span><span style="color:gray">bufset
</span><span style="color:black">SYSINIT:0F8B                 </span><span style="color:navy">mov     </span>buffers<span style="color:navy">, </span><span style="color:green">15
</span><span style="color:black">SYSINIT:0F91
SYSINIT:0F91 </span><span style="color:gray">bufset</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0F91                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0F92                 </span>assume ds:nothing
<span style="color:black">SYSINIT:0F92                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:0F93
SYSINIT:0F93 </span><span style="color:gray">dobuff</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0F93                 </span><span style="color:navy">lds     bx, cs:</span>DOSINFO  ; ds:bx -&gt; sysinitvar
<span style="color:black">SYSINIT:0F98                 </span><span style="color:navy">mov     ax, cs:</span>buffers
<span style="color:black">SYSINIT:0F9C                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">3Fh</span><span style="color:navy">], ax    </span>; [bx+SYSI_BUFFERS] ; set sysi_buffers
<span style="color:black">SYSINIT:0F9F                 </span><span style="color:navy">mov     ax, cs:</span>h_buffers
<span style="color:black">SYSINIT:0FA3                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">41h</span><span style="color:navy">], ax    </span>; [bx+SYSI_BUFFERS+2]
<span style="color:black">SYSINIT:0FA6                 </span><span style="color:navy">lds     bx, [bx+</span><span style="color:#ff8000">12h</span><span style="color:navy">]    </span>; [bx+SYSI_BUF] ; now, ds:bx -&gt; buffinfo
<span style="color:black">SYSINIT:0FA9                 </span><span style="color:navy">call    loc_8DA6        </span>; get [memhi]:[memlo]
<span style="color:black">SYSINIT:0FAC                 </span><span style="color:navy">mov     al, &#039;</span><span style="color:green">B&#039;         </span>; devmark_buf
<span style="color:black">SYSINIT:0FAE                 </span><span style="color:navy">call    </span>setdevmark
<span style="color:black">SYSINIT:0FB1                 </span><span style="color:navy">push    ds              </span>; save buffer info. ptr.
<span style="color:black">SYSINIT:0FB2                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:0FB3                 </span><span style="color:navy">call    </span>set_buffer
<span style="color:black">SYSINIT:0FB6                 </span><span style="color:navy">pop     bx              </span>; restore buffer info. ptr.
<span style="color:black">SYSINIT:0FB7                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:0FB8                 </span><span style="color:navy">cmp     cs:</span>h_buffers<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; set the secondary buffer if specified
<span style="color:black">SYSINIT:0FBE                 </span><span style="color:navy">jz      short </span><span style="color:gray">xif16
</span><span style="color:black">SYSINIT:0FC0                 </span><span style="color:navy">call    loc_8DA6
</span><span style="color:black">SYSINIT:0FC3                 </span><span style="color:navy">mov     cx, cs:</span>memlo
<span style="color:black">SYSINIT:0FC8                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], cx      </span>; [bx+BUFFINF.Cache_ptr]
<span style="color:black">SYSINIT:0FCB                 </span><span style="color:navy">mov     cx, cs:</span>memhi
<span style="color:black">SYSINIT:0FD0                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">8</span><span style="color:navy">], cx      </span>; [bx+BUFFINF.Cache_ptr+2]
<span style="color:black">SYSINIT:0FD3                 </span><span style="color:navy">mov     cx, cs:</span>h_buffers
<span style="color:black">SYSINIT:0FD8                 </span><span style="color:navy">mov     [bx+</span><span style="color:green">10</span><span style="color:navy">], cx     </span>; [bx+BUFFINF.Cache_count]
<span style="color:black">SYSINIT:0FDB                 </span><span style="color:navy">mov     ax, </span><span style="color:green">512         </span>; 512 bytes
<span style="color:black">SYSINIT:0FDE                 </span><span style="color:navy">mul     cx
</span><span style="color:black">SYSINIT:0FE0                 </span><span style="color:navy">mov     cs:</span>memlo<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:0FE4                 </span><span style="color:navy">or      cs:</span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">2 </span>; for_devmark
<span style="color:black">SYSINIT:0FEA                 </span><span style="color:navy">call    loc_8DA6
</span><span style="color:black">SYSINIT:0FED
SYSINIT:0FED </span><span style="color:gray">xif16</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:0FED                 </span><span style="color:navy">call    loc_8DA6        </span>; buf1
<span style="color:black">SYSINIT:0FF0                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:0FF1                 </span><span style="color:navy">mov     ax, &#039;</span><span style="color:green">L&#039;         </span>; devmark_cds
<span style="color:black">SYSINIT:0FF4                 </span><span style="color:navy">call    </span>setdevmark
<span style="color:black">SYSINIT:0FF7                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:0FF8                 </span><span style="color:navy">les     di, cs:</span>DOSINFO
<span style="color:black">SYSINIT:0FFD                 </span><span style="color:navy">mov     cl, es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">] </span>; [es:di+SYSI_NUMIO]
<span style="color:black">SYSINIT:1001                 </span><span style="color:navy">cmp     cl, cs:</span>NUM_CDS
<span style="color:black">SYSINIT:1006                 </span><span style="color:navy">jnb     short </span><span style="color:gray">gotncds   </span>; user setting must be at least numio
<span style="color:black">SYSINIT:1008                 </span><span style="color:navy">mov     cl, cs:</span>NUM_CDS
<span style="color:black">SYSINIT:100D
SYSINIT:100D </span><span style="color:gray">gotncds</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:100D                 </span><span style="color:navy">xor     ch, ch
</span><span style="color:black">SYSINIT:100F                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">21h</span><span style="color:navy">], cl </span>; [es:di+SYSI_NCDS]
<span style="color:black">SYSINIT:1013                 </span><span style="color:navy">mov     ax, cs:</span>memhi
<span style="color:black">SYSINIT:1017                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">18h</span><span style="color:navy">], ax </span>; [es:di+SYSI_CDS+2]
<span style="color:black">SYSINIT:101B                 </span><span style="color:navy">mov     ax, cs:</span>memlo
<span style="color:black">SYSINIT:101F                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">16h</span><span style="color:navy">], ax </span>; [es:di+SYSI_CDS]
<span style="color:black">SYSINIT:1023                 </span><span style="color:navy">mov     al, cl
</span><span style="color:black">SYSINIT:1025                 </span><span style="color:navy">mov     ah, </span><span style="color:green">88          </span>; curdirlen ; curdir_list.size
<span style="color:black">SYSINIT:1027                 </span><span style="color:navy">mul     ah
</span><span style="color:black">SYSINIT:1029                 </span><span style="color:navy">call    </span>ParaRound
<span style="color:black">SYSINIT:102C                 </span><span style="color:navy">add     cs:</span>memhi<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:1031                 </span><span style="color:navy">or      cs:</span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">2 </span>; for_devmark
<span style="color:black">SYSINIT:1037                 </span><span style="color:navy">call    loc_8DA6        </span>; check for mem error before initializing
<span style="color:black">SYSINIT:103A                 </span><span style="color:navy">lds     si, es:[di]     </span>; lds si,[es:di+SYSI_DPB] ; [es:di+0]
<span style="color:black">SYSINIT:103D                 </span><span style="color:navy">les     di, es:[di+</span><span style="color:#ff8000">16h</span><span style="color:navy">] </span>; les di,[es:di+SYSI_CDS] ; [es:di+22]
<span style="color:black">SYSINIT:1041                 </span><span style="color:navy">call    </span>fooset
<span style="color:black">SYSINIT:1044                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:1045                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:1046                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:1046                 </span><span style="color:navy">cmp     </span>stack_addr<span style="color:navy">, </span><span style="color:green">0FFFFh </span>; -1 ; has the user entered &quot;stacks=&quot; command?
<span style="color:black">SYSINIT:104B                 </span><span style="color:navy">jz      short </span><span style="color:gray">doinstallstack </span>; then install as specified by the user
<span style="color:black">SYSINIT:104D                 </span><span style="color:navy">cmp     </span>sys_scnd_model_byte<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; pc1,xt has the secondary model byte = 0
<span style="color:black">SYSINIT:1052                 </span><span style="color:navy">jnz     short </span><span style="color:gray">doinstallstack </span>; other model should have default stack of 9,128
<span style="color:black">SYSINIT:1054                 </span><span style="color:navy">cmp     </span>sys_model_byte<span style="color:navy">, </span><span style="color:green">0FEh </span>; pc1, pc/xt or pc portable ?
<span style="color:black">SYSINIT:1059                 </span><span style="color:navy">jnb     short </span><span style="color:gray">skipstack
</span><span style="color:black">SYSINIT:105B
SYSINIT:105B </span><span style="color:gray">doinstallstack</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:105B                 </span><span style="color:navy">mov     ax, </span>stack_count ; stack_count = 0?
<span style="color:black">SYSINIT:105E                 </span><span style="color:navy">or      ax, ax          </span>; then, stack size must be 0 too.
<span style="color:black">SYSINIT:1060                 </span><span style="color:navy">jz      short </span><span style="color:gray">skipstack </span>; don&#039;t install stack.
<span style="color:black">SYSINIT:1062                 </span><span style="color:navy">call    loc_8DA6        </span>; dynamic relocation of stack code.
<span style="color:black">SYSINIT:1062                                         </span>; [memhi] = seg. for stack code
<span style="color:black">SYSINIT:1062                                         </span>; [memlo] = 0
<span style="color:black">SYSINIT:1065                 </span><span style="color:navy">mov     al, &#039;</span><span style="color:green">S&#039;         </span>; devmark_stk
<span style="color:black">SYSINIT:1067                 </span><span style="color:navy">call    </span>setdevmark
<span style="color:black">SYSINIT:106A                 </span><span style="color:navy">mov     ax, </span>memhi
<span style="color:black">SYSINIT:106D                 </span><span style="color:navy">mov     es, ax          </span>; es -&gt; seg. the stack code is going to move.
<span style="color:black">SYSINIT:106F                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:1070                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:1071                 </span><span style="color:navy">xor     si, si          </span>; ! we know that stack code is at the beginning of sysinit.
<span style="color:black">SYSINIT:1073                 </span><span style="color:navy">xor     di, di
</span><span style="color:black">SYSINIT:1075                 </span><span style="color:navy">mov     cx, offset </span>_SYSINIT ; offset endstackcode = offset _SYSINIT
<span style="color:black">SYSINIT:1075                                         </span>; SYSINIT:0269h
<span style="color:black">SYSINIT:1078                 </span><span style="color:navy">mov     </span>memlo<span style="color:navy">, cx
</span><span style="color:black">SYSINIT:107C                 </span><span style="color:navy">call    loc_8DA6        </span>; have enough space for relocation?
<span style="color:black">SYSINIT:107F                 </span><span style="color:navy">rep movsb
</span><span style="color:black">SYSINIT:1081                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1082                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h         </span>; DOSBIODATASEG
<span style="color:black">SYSINIT:1085                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:1087                 </span>assume ds:nothing
<span style="color:black">SYSINIT:1087                 </span><span style="color:navy">mov     ds:</span>NextStack<span style="color:navy">, offset </span>nextentry ; [BIOSDATA:NextStack],
<span style="color:black">SYSINIT:1087                                         </span>;  offset SYSINIT:nextentry (SYSINIT:0010h)
<span style="color:black">SYSINIT:108D                 </span><span style="color:navy">mov     ds:</span>NextStack<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">SYSINIT:1091                 </span><span style="color:navy">mov     ax, cs:</span>memlo
<span style="color:black">SYSINIT:1095                 </span><span style="color:navy">mov     cs:</span>stack_addr<span style="color:navy">, ax </span>; set for stack area initialization
<span style="color:black">SYSINIT:1099                 </span><span style="color:navy">mov     word ptr ds:</span>IT_StackLoc<span style="color:navy">, ax </span>; pass it as Instance Data, too
<span style="color:black">SYSINIT:109C                 </span><span style="color:navy">mov     ax, cs:</span>memhi    ; this will be used by stack_init routine.
<span style="color:black">SYSINIT:10A0                 </span><span style="color:navy">mov     cs:</span>stack_addr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:10A4                 </span><span style="color:navy">mov     word ptr ds:</span>IT_StackLoc<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:10A7                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">8           </span>; entrysize
<span style="color:black">SYSINIT:10AA                 </span><span style="color:navy">add     ax, cs:</span>stack_size
<span style="color:black">SYSINIT:10AF                 </span><span style="color:navy">mul     cs:</span>stack_count
<span style="color:black">SYSINIT:10B4                 </span><span style="color:navy">mov     ds:</span>IT_StackSize<span style="color:navy">, ax </span>; pass through to Instance Table
<span style="color:black">SYSINIT:10B7                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:10B8                 </span>assume ds:nothing
<span style="color:black">SYSINIT:10B8                 </span><span style="color:navy">call    </span>ParaRound
<span style="color:black">SYSINIT:10BB                 </span><span style="color:navy">add     cs:</span>memhi<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:10C0                 </span><span style="color:navy">or      cs:</span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">2 </span>; for_devmark
<span style="color:black">SYSINIT:10C0                                         </span>; to set the devmark_size for stack by round routine.
<span style="color:black">SYSINIT:10C6                 </span><span style="color:navy">call    loc_8DA6        </span>; check for memory error before continuing
<span style="color:black">SYSINIT:10C9                 </span><span style="color:navy">call    </span>stackinit       ; initialize hardware stack.
<span style="color:black">SYSINIT:10C9                                         </span>; cs=ds=sysinitseg,es=relocated stack code &amp; data
<span style="color:black">SYSINIT:10CC
SYSINIT:10CC </span><span style="color:gray">skipstack</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:10CC                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:10CD                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:10CE                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:10CE                 </span><span style="color:navy">mov     al, </span>FILES
<span style="color:black">SYSINIT:10D1                 </span><span style="color:navy">xor     ah, ah          </span>; do not use cbw instruction!
<span style="color:black">SYSINIT:10D1                                         </span>; it does sign extend.
<span style="color:black">SYSINIT:10D3                 </span><span style="color:navy">mov     cx, ax
</span><span style="color:black">SYSINIT:10D5                 </span><span style="color:navy">xor     bx, bx          </span>; close standard input
<span style="color:black">SYSINIT:10D7                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:black">SYSINIT:10D9                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CLOSE A FILE WITH HANDLE
<span style="color:black">SYSINIT:10D9                                         </span>; BX = file handle
<span style="color:black">SYSINIT:10DB                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">2           </span>; close everybody but standard output
<span style="color:black">SYSINIT:10DB                                         </span>; need output so we can print message
<span style="color:black">SYSINIT:10DB                                         </span>;  in case we can&#039;t get new one open.
<span style="color:black">SYSINIT:10DE
SYSINIT:10DE </span><span style="color:gray">rcclloop</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:10DE                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:black">SYSINIT:10E0                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CLOSE A FILE WITH HANDLE
<span style="color:black">SYSINIT:10E0                                         </span>; BX = file handle
<span style="color:black">SYSINIT:10E2                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:10E3                 </span><span style="color:navy">loop    </span><span style="color:gray">rcclloop
</span><span style="color:black">SYSINIT:10E5                 </span><span style="color:navy">mov     dx, offset aCon_0 </span><span style="color:gray">; &quot;CON&quot;
</span><span style="color:black">SYSINIT:10E8                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:10EA                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Dh         </span>; open con for read/write
<span style="color:black">SYSINIT:10EC                 </span><span style="color:navy">stc                     </span>; set for possible int 24
<span style="color:black">SYSINIT:10ED                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - OPEN DISK FILE WITH HANDLE
<span style="color:black">SYSINIT:10ED                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:black">SYSINIT:10ED                                         </span>; AL = access mode
<span style="color:black">SYSINIT:10ED                                         </span>; 2 - read &amp; write
<span style="color:black">SYSINIT:10EF                 </span><span style="color:navy">jnb     short </span><span style="color:gray">goaux
</span><span style="color:black">SYSINIT:10F1                 </span><span style="color:navy">call    loc_9044
</span><span style="color:black">SYSINIT:10F4                 </span><span style="color:navy">jmp     short </span><span style="color:gray">goaux2
</span><span style="color:black">SYSINIT:10F6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:10F6
SYSINIT:10F6 </span><span style="color:gray">goaux</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:10F6                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:10F7                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">1           </span>; close standard output
<span style="color:black">SYSINIT:10FA                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:black">SYSINIT:10FC                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CLOSE A FILE WITH HANDLE
<span style="color:black">SYSINIT:10FC                                         </span>; BX = file handle
<span style="color:black">SYSINIT:10FE                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:10FF                 </span><span style="color:navy">mov     bx, ax          </span>; new device handle
<span style="color:black">SYSINIT:1101                 </span><span style="color:navy">mov     ah, </span><span style="color:green">45h         </span>; XDUP ; dup to 1, stdout
<span style="color:black">SYSINIT:1103                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CREATE DUPLICATE HANDLE (DUP)
<span style="color:black">SYSINIT:1103                                         </span>; BX = file handle to duplicate
<span style="color:black">SYSINIT:1105                 </span><span style="color:navy">mov     ah, </span><span style="color:green">45h         </span>; XDUP ; dup to 2, stderr
<span style="color:black">SYSINIT:1107                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CREATE DUPLICATE HANDLE (DUP)
<span style="color:black">SYSINIT:1107                                         </span>; BX = file handle to duplicate
<span style="color:black">SYSINIT:1109
SYSINIT:1109 </span><span style="color:gray">goaux2</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1109                 </span><span style="color:navy">mov     dx, offset aAux_0 </span><span style="color:gray">; &quot;AUX&quot;
</span><span style="color:black">SYSINIT:110C                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">2           </span>; read/write access
<span style="color:black">SYSINIT:110E                 </span><span style="color:navy">call    loc_9077
</span><span style="color:black">SYSINIT:1111                 </span><span style="color:navy">mov     dx, offset aPrn_0 </span><span style="color:gray">; &quot;PRN&quot;
</span><span style="color:black">SYSINIT:1114                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1           </span>; write only
<span style="color:black">SYSINIT:1116                 </span><span style="color:navy">call    loc_9077
</span><span style="color:black">SYSINIT:1119                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:111A                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:111B                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:111C                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:111D                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0FFh        </span>; reset h/w by writing to port
<span style="color:black">SYSINIT:111F                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">2F2h        </span>; get starting address
<span style="color:black">SYSINIT:1122                 </span><span style="color:navy">out     dx, al          </span>; out 02f2h,0ffh
<span style="color:black">SYSINIT:1123                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:1124                 </span><span style="color:navy">out     dx, al
</span><span style="color:black">SYSINIT:1125                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:1126                 </span><span style="color:navy">out     dx, al
</span><span style="color:black">SYSINIT:1127                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:1128                 </span><span style="color:navy">out     dx, al
</span><span style="color:black">SYSINIT:1129                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:112A                 </span><span style="color:navy">out     dx, al
</span><span style="color:black">SYSINIT:112B                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:112C                 </span><span style="color:navy">out     dx, al          </span>; out 02f7h,0ffh
<span style="color:black">SYSINIT:112D                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0F000h      </span>; get machine type
<span style="color:black">SYSINIT:1130                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:1132                 </span>assume es:nothing
<span style="color:black">SYSINIT:1132                 </span><span style="color:navy">cmp     byte ptr es:</span><span style="color:green">0FFFEh</span><span style="color:navy">, </span><span style="color:green">0FCh </span>; is it a at type machine
<span style="color:black">SYSINIT:1138                 </span><span style="color:navy">jz      short </span><span style="color:gray">startrearm </span>; *if AT no need to check
<span style="color:black">SYSINIT:113A                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0C0h
</span><span style="color:black">SYSINIT:113C                 </span><span style="color:navy">int     </span><span style="color:green">15h             </span>; SYSTEM - GET CONFIGURATION
<span style="color:black">SYSINIT:113C                                         </span>; (XT after 1/10/86,AT mdl 3x9,CONV,XT286,PS)
<span style="color:black">SYSINIT:113E                 </span><span style="color:navy">jb      short </span><span style="color:gray">finishrearm </span>; *jmp if old rom
<span style="color:black">SYSINIT:1140                 </span><span style="color:navy">test    byte ptr es:[bx+</span><span style="color:#ff8000">5</span><span style="color:navy">], </span><span style="color:green">40h </span>; [es:bx+ROMBIOS_DESC.bios_sd_featurebyte1],
<span style="color:black">SYSINIT:1140                                         </span>; ScndIntController
<span style="color:black">SYSINIT:1145                 </span><span style="color:navy">jz      short </span><span style="color:gray">finishrearm
</span><span style="color:black">SYSINIT:1147
SYSINIT:1147 </span><span style="color:gray">startrearm</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1147                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0FFh        </span>; write any pattern to port
<span style="color:black">SYSINIT:1149                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">6F2h        </span>; get starting address
<span style="color:black">SYSINIT:114C                 </span><span style="color:navy">out     dx, al
</span><span style="color:black">SYSINIT:114D                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:114E                 </span><span style="color:navy">out     dx, al          </span>; out 06f3h,0ffh
<span style="color:black">SYSINIT:114F                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:1150                 </span><span style="color:navy">out     dx, al          </span>; out 06f4h,0ffh
<span style="color:black">SYSINIT:1151                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:1152                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:1153                 </span><span style="color:navy">out     dx, al          </span>; out 06f6h,0ffh
<span style="color:black">SYSINIT:1154                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:1155                 </span><span style="color:navy">out     dx, al          </span>; out 06f7h,0ffh
<span style="color:black">SYSINIT:1156
SYSINIT:1156 </span><span style="color:gray">finishrearm</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1156                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:1157                 </span>assume es:nothing
<span style="color:black">SYSINIT:1157                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1158                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1159                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:115A
SYSINIT:115A </span>set_sysinit_base<span style="color:navy">:                       </span>; sysinit_base will be established
<span style="color:black">SYSINIT:115A                 </span><span style="color:navy">push    ax              </span>; in the secure area of lower memory
<span style="color:black">SYSINIT:115A                                         </span>; when it handles the first install= command.
<span style="color:black">SYSINIT:115A                                         </span>; if sysinit module (in high memory) has been broken,
<span style="color:black">SYSINIT:115A                                         </span>; then &quot;memory error...&quot; message is displayed
<span style="color:black">SYSINIT:115A                                         </span>; by sysinit_base
<span style="color:black">SYSINIT:115B                 </span><span style="color:navy">mov     ax, </span>memhi
<span style="color:black">SYSINIT:115E                 </span><span style="color:navy">sub     ax, </span>area
<span style="color:black">SYSINIT:1162                 </span><span style="color:navy">mov     </span>impossible_owner_size<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:1165                 </span><span style="color:navy">mov     al, &#039;</span><span style="color:green">T&#039;
</span><span style="color:black">SYSINIT:1167                 </span><span style="color:navy">call    </span>setdevmark
<span style="color:black">SYSINIT:116A                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:116B                 </span><span style="color:navy">mov     di, </span>memhi
<span style="color:black">SYSINIT:116F                 </span><span style="color:navy">mov     es, di
</span><span style="color:black">SYSINIT:1171                 </span><span style="color:navy">mov     word ptr </span>sysinit_base_ptr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, di </span>; save this entry for the next use.
<span style="color:black">SYSINIT:1175                 </span><span style="color:navy">xor     di, di
</span><span style="color:black">SYSINIT:1177                 </span><span style="color:navy">mov     word ptr </span>sysinit_base_ptr<span style="color:navy">, di </span>; es:di -&gt; destination.
<span style="color:black">SYSINIT:117B                 </span><span style="color:navy">mov     si, offset </span>sysinit_base ; ds:si -&gt; source code to be relocated.
<span style="color:black">SYSINIT:117E                 </span><span style="color:navy">mov     cx, </span><span style="color:green">129         </span>; end_sysinit_base-sysinit_base ; 129
<span style="color:black">SYSINIT:1181                 </span><span style="color:navy">add     </span>memlo<span style="color:navy">, cx
</span><span style="color:black">SYSINIT:1185                 </span><span style="color:navy">or      cs:</span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">2 </span>; for_devmark
<span style="color:black">SYSINIT:118B                 </span><span style="color:navy">call    loc_8DA6
</span><span style="color:black">SYSINIT:118E                 </span><span style="color:navy">rep movsb
</span><span style="color:black">SYSINIT:1190                 </span><span style="color:navy">mov     </span>sysinit_ptr<span style="color:navy">, offset </span>sysinitptr ; returning address from
<span style="color:black">SYSINIT:1190                                         </span>; sysinit_base back to sysinit
<span style="color:black">SYSINIT:1196                 </span><span style="color:navy">mov     </span>sysinit_ptr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, cs
</span><span style="color:black">SYSINIT:119A                 </span><span style="color:navy">or      </span>install_flag<span style="color:navy">, </span><span style="color:green">2 </span>; for_devmark
<span style="color:black">SYSINIT:119F                 </span><span style="color:navy">call    loc_8DA6
</span><span style="color:black">SYSINIT:11A2                 </span><span style="color:navy">mov     bx, </span>memhi
<span style="color:black">SYSINIT:11A6                 </span><span style="color:navy">mov     ax, </span>area
<span style="color:black">SYSINIT:11A9                 </span><span style="color:navy">mov     </span>old_area<span style="color:navy">, ax    </span>; save [area]
<span style="color:black">SYSINIT:11AC                 </span><span style="color:navy">mov     es, ax          </span>; calc what we needed
<span style="color:black">SYSINIT:11AE                 </span><span style="color:navy">sub     bx, ax
</span><span style="color:black">SYSINIT:11B0                 </span><span style="color:navy">mov     ah, </span><span style="color:green">4Ah         </span>; SETBLOCK
<span style="color:black">SYSINIT:11B2                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ADJUST MEMORY BLOCK SIZE (SETBLOCK)
<span style="color:black">SYSINIT:11B2                                         </span>; ES = segment address of block to change
<span style="color:black">SYSINIT:11B2                                         </span>; BX = new size in paragraphs
<span style="color:black">SYSINIT:11B4                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:11B5                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:11B7                 </span><span style="color:navy">dec     ax
</span><span style="color:black">SYSINIT:11B8                 </span><span style="color:navy">mov     es, ax          </span>; point to arena
<span style="color:black">SYSINIT:11BA                 </span>assume es:nothing
<span style="color:black">SYSINIT:11BA                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:ARENA.OWNER],8 ; set impossible owner
<span style="color:black">SYSINIT:11C1                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">4453h </span>; [es:ARENA.NAME],&#039;SD&#039; ; System Data
<span style="color:black">SYSINIT:11C8                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:11C9                 </span>assume es:nothing
<span style="color:black">SYSINIT:11C9                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:11CC                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:black">SYSINIT:11CE                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:black">SYSINIT:11CE                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:black">SYSINIT:11D0                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h         </span>; allocate the rest of the memory
<span style="color:black">SYSINIT:11D2                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:black">SYSINIT:11D2                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:black">SYSINIT:11D4                 </span><span style="color:navy">mov     </span>memhi<span style="color:navy">, ax       </span>; start of the allocated memory
<span style="color:black">SYSINIT:11D7                 </span><span style="color:navy">mov     </span>memlo<span style="color:navy">, </span><span style="color:#ff8000">0        </span>; to be used next.
<span style="color:black">SYSINIT:11DD                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:11DF                 </span>assume es:nothing
<span style="color:black">SYSINIT:11DF                 </span><span style="color:navy">mov     bx, </span>CONFBOT
<span style="color:black">SYSINIT:11E3                 </span><span style="color:navy">sub     bx, ax          </span>; confbot - memhi
<span style="color:black">SYSINIT:11E5                 </span><span style="color:navy">dec     bx              </span>; make a room for the memory block id.
<span style="color:black">SYSINIT:11E6                 </span><span style="color:navy">dec     bx              </span>; make sure!
<span style="color:black">SYSINIT:11E7                 </span><span style="color:navy">mov     ah, </span><span style="color:green">4Ah         </span>; this will free (confbot to top of memory)
<span style="color:black">SYSINIT:11E9                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ADJUST MEMORY BLOCK SIZE (SETBLOCK)
<span style="color:black">SYSINIT:11E9                                         </span>; ES = segment address of block to change
<span style="color:black">SYSINIT:11E9                                         </span>; BX = new size in paragraphs
<span style="color:black">SYSINIT:11EB                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:11EE                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h
</span><span style="color:black">SYSINIT:11F0                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:black">SYSINIT:11F0                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:black">SYSINIT:11F2                 </span><span style="color:navy">mov     ah, </span><span style="color:green">48h         </span>; allocate (confbot to top of memory)
<span style="color:black">SYSINIT:11F4                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:black">SYSINIT:11F4                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:black">SYSINIT:11F6                 </span><span style="color:navy">mov     </span>area<span style="color:navy">, ax        </span>; save allocated memory segment.
<span style="color:black">SYSINIT:11F6                                         </span>; need this to free this area for command.com.
<span style="color:black">SYSINIT:11F9                 </span><span style="color:navy">mov     es, </span>memhi
<span style="color:black">SYSINIT:11FD                 </span>assume es:nothing
<span style="color:black">SYSINIT:11FD                 </span><span style="color:navy">mov     ah, </span><span style="color:green">49h         </span>; free allocated memory
<span style="color:black">SYSINIT:11FD                                         </span>; free (memhi to confbot(=area))
<span style="color:black">SYSINIT:11FF                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - FREE MEMORY
<span style="color:black">SYSINIT:11FF                                         </span>; ES = segment address of area to be freed
<span style="color:black">SYSINIT:1201                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1201 </span>endfile         endp
<span style="color:black">SYSINIT:1201
SYSINIT:1202
SYSINIT:1202 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1202
SYSINIT:1202
SYSINIT:1202 </span>do_install_exec proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1202                 </span><span style="color:navy">push    si              </span>; EXEC a program being loaded via the
<span style="color:black">SYSINIT:1202                                         </span>; &quot;install=&quot; mechanism in config.sys
<span style="color:black">SYSINIT:1203                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:1204                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1205                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:1206                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:1206                 </span><span style="color:navy">pop     ds              </span>; es-&gt;sysinitseg,ds-&gt;confbot seg
<span style="color:black">SYSINIT:1207                 </span>assume ds:nothing
<span style="color:black">SYSINIT:1207                 </span><span style="color:navy">mov     dx, si          </span>; ds:dx-&gt;file name,0 in config.sys image.
<span style="color:black">SYSINIT:1209                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:120B                 </span><span style="color:navy">cld
</span><span style="color:black">SYSINIT:120C                 </span><span style="color:navy">mov     cs:</span>ldexec_start<span style="color:navy">, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039; </span>; clear out the parm area
<span style="color:black">SYSINIT:1212                 </span><span style="color:navy">mov     di, offset </span>ldexec_parm
<span style="color:black">SYSINIT:1215
SYSINIT:1215 </span><span style="color:gray">installfilename</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1215                 </span><span style="color:navy">lodsb                   </span>; skip the file name
<span style="color:black">SYSINIT:1215                                         </span>; al = ds:si; si++
<span style="color:black">SYSINIT:1216                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:1218                 </span><span style="color:navy">jz      short </span><span style="color:gray">got_installparm
</span><span style="color:black">SYSINIT:121A                 </span><span style="color:navy">jmp     short </span><span style="color:gray">installfilename
</span><span style="color:black">SYSINIT:121C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:121C
SYSINIT:121C </span><span style="color:gray">got_installparm</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:121C                 </span><span style="color:navy">lodsb                   </span>; copy the parameters to ldexec_parm
<span style="color:black">SYSINIT:121D                 </span><span style="color:navy">mov     es:[di], al
</span><span style="color:black">SYSINIT:1220                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah         </span>; lf ; line feed?
<span style="color:black">SYSINIT:1222                 </span><span style="color:navy">jz      short </span><span style="color:gray">done_installparm
</span><span style="color:black">SYSINIT:1224                 </span><span style="color:navy">inc     cl              </span>; # of char. in the parm.
<span style="color:black">SYSINIT:1226                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:1227                 </span><span style="color:navy">jmp     short </span><span style="color:gray">got_installparm
</span><span style="color:black">SYSINIT:1229 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1229
SYSINIT:1229 </span><span style="color:gray">done_installparm</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1229                 </span><span style="color:navy">mov     cs:</span>ldexec_line<span style="color:navy">, cl </span>; length of the parm.
<span style="color:black">SYSINIT:122E                 </span><span style="color:navy">cmp     cl, </span><span style="color:#ff8000">0           </span>; if no parm,then
<span style="color:black">SYSINIT:1231                 </span><span style="color:navy">jnz     short </span><span style="color:gray">install_seg_set </span>; let the parm area
<span style="color:black">SYSINIT:1233                 </span><span style="color:navy">mov     cs:</span>ldexec_start<span style="color:navy">, </span><span style="color:#ff8000">0Dh </span>; cr ; starts with cr.
<span style="color:black">SYSINIT:1239
SYSINIT:1239 </span><span style="color:gray">install_seg_set</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1239                 </span><span style="color:navy">mov     cs:</span>SYSINIT$<span style="color:navy">, </span><span style="color:#ff8000">0  </span>; make a null environment segment
<span style="color:black">SYSINIT:1240                 </span><span style="color:navy">mov     ax, cs          </span>; by overlap jmp instruction of sysinitseg.
<span style="color:black">SYSINIT:1242                 </span><span style="color:navy">mov     cx, ax
</span><span style="color:black">SYSINIT:1244                 </span><span style="color:navy">cmp     cs:</span>config_envlen<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:124A                 </span><span style="color:navy">jz      short </span><span style="color:gray">no_envdata2
</span><span style="color:black">SYSINIT:124C                 </span><span style="color:navy">mov     cx, cs:</span>config_wrkseg
<span style="color:black">SYSINIT:1251
SYSINIT:1251 </span><span style="color:gray">no_envdata2</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1251                 </span><span style="color:navy">mov     cs:</span>iexec_environ<span style="color:navy">, cx </span>; [cs:instexe.exec0_environ]
<span style="color:black">SYSINIT:1251                                         </span>; set the environment seg.
<span style="color:black">SYSINIT:1256                 </span><span style="color:navy">mov     cs:</span>iexec_ldexec_line_seg<span style="color:navy">, ax </span>; [cs:instexe.exec0_com_line+2]
<span style="color:black">SYSINIT:1256                                         </span>; set the seg.
<span style="color:black">SYSINIT:125A                 </span><span style="color:navy">mov     cs:</span>iexec_ldexec_5c_fcb_seg<span style="color:navy">, ax </span>; [cs:instexe.exec0_5c_fcb+2]
<span style="color:black">SYSINIT:125E                 </span><span style="color:navy">mov     cs:</span>iexec_ldexec_6c_fcb_seg<span style="color:navy">, ax </span>; [cs:instexe.exec0_6c_fcb+2]
<span style="color:black">SYSINIT:1262                 </span><span style="color:navy">call    </span>sum_up
<span style="color:black">SYSINIT:1265                 </span><span style="color:navy">mov     es:</span>checksum<span style="color:navy">, ax </span>; save the value of the sum
<span style="color:black">SYSINIT:1269                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">SYSINIT:126B                 </span><span style="color:navy">mov     ah, </span><span style="color:green">4Bh         </span>; EXEC ; load/exec
<span style="color:black">SYSINIT:126D                 </span><span style="color:navy">mov     bx, offset </span>iexec_environ ; instexe ; es:bx -&gt; parm block.
<span style="color:black">SYSINIT:1270                 </span><span style="color:navy">push    es              </span>; save es,ds for load/exec
<span style="color:black">SYSINIT:1271                 </span><span style="color:navy">push    ds              </span>; these registers will be restored in sysinit_base.
<span style="color:black">SYSINIT:1272                 </span><span style="color:navy">jmp     cs:</span>sysinit_base_ptr ; jmp to sysinit_base to execute
<span style="color:black">SYSINIT:1272 </span>do_install_exec endp                    ; load/exec function and check sum.
<span style="color:black">SYSINIT:1272
</span><span style="color:maroon">SYSINIT:1277 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:1277
SYSINIT:1277 </span>sysinitptr<span style="color:navy">:                             </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:1277                 </span><span style="color:navy">pop     si              </span>; returning far address from sysinit_base
<span style="color:maroon">SYSINIT:1277                                         </span>; restore si for config.sys file.
<span style="color:maroon">SYSINIT:1278                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:1279                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:127A                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:127B                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:127B                 </span><span style="color:navy">pop     ds              </span>; now ds - sysinitseg, es - confbot
<span style="color:maroon">SYSINIT:127C                 </span><span style="color:navy">jnb     short </span>install_exit_ret
<span style="color:maroon">SYSINIT:127E                 </span><span style="color:navy">push    si              </span>; error in loading the file for install=.
<span style="color:maroon">SYSINIT:127F                 </span><span style="color:navy">call    </span>nuldev          ; es:si-&gt; path,filename,0.
<span style="color:maroon">SYSINIT:1282                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:1283
SYSINIT:1283 </span>install_exit_ret<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:1283                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1284
SYSINIT:1284 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1284
SYSINIT:1284
SYSINIT:1284 </span>ParaRound       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1284                 </span><span style="color:navy">add     ax, </span><span style="color:green">15          </span>; round up length in paragraphs
<span style="color:black">SYSINIT:1284                                         </span>; 0Fh
<span style="color:black">SYSINIT:1287                 </span><span style="color:navy">rcr     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:1289                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:128B                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:128D                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:128F                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:128F </span>ParaRound       endp
<span style="color:black">SYSINIT:128F
</span><span style="color:maroon">SYSINIT:1290 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:1290
SYSINIT:1290 </span>sysinit_base<span style="color:navy">:                           </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:1290                 </span><span style="color:navy">mov     word ptr cs:byte_4092, ss </span>; sysinit_base module
<span style="color:maroon">SYSINIT:1295                 </span><span style="color:navy">mov     word ptr cs:byte_4092+</span><span style="color:green">2</span><span style="color:navy">, sp
</span><span style="color:maroon">SYSINIT:129A                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; load/exec dos call
<span style="color:maroon">SYSINIT:129C                 </span><span style="color:navy">mov     ss, word ptr cs:byte_4092
</span><span style="color:maroon">SYSINIT:12A1                 </span>assume ss:nothing
<span style="color:maroon">SYSINIT:12A1                 </span><span style="color:navy">mov     sp, word ptr cs:byte_4092+</span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:12A6                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:12A7                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:12A8                 </span><span style="color:navy">jb      short </span>sysinit_base_end
<span style="color:maroon">SYSINIT:12AA                 </span><span style="color:navy">call    </span>sum_up
<span style="color:maroon">SYSINIT:12AD                 </span><span style="color:navy">cmp     es:</span>checksum<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:12B2                 </span><span style="color:navy">jz      short </span>sysinit_base_end
<span style="color:maroon">SYSINIT:12B4                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">9           </span>; memory broken.
<span style="color:maroon">SYSINIT:12B4                                         </span>; show &quot;memory allocation error&quot; message and stall.
<span style="color:maroon">SYSINIT:12B6                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:12B7                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:12B8                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:12B8                 </span><span style="color:navy">mov     dx, </span><span style="color:green">102         </span>; mem_alloc_err_msgx-sysinit_base ; 66h
<span style="color:maroon">SYSINIT:12BB                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - PRINT STRING
<span style="color:maroon">SYSINIT:12BB                                         </span>; DS:DX -&gt; string terminated by &quot;$&quot;
<span style="color:black">SYSINIT:12BD </span><span style="color:gray">; START OF FUNCTION CHUNK FOR AllocMemForDOS
</span><span style="color:black">SYSINIT:12BD
SYSINIT:12BD </span>stall<span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:12BD                 </span><span style="color:navy">hlt                     </span>; use HLT to minimize energy consumption
<span style="color:black">SYSINIT:12BD </span><span style="color:gray">; END OF FUNCTION CHUNK FOR AllocMemForDOS
</span><span style="color:maroon">SYSINIT:12BE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:12BE                 </span><span style="color:navy">jmp     short </span>stall
<span style="color:maroon">SYSINIT:12C0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:12C0
SYSINIT:12C0 </span>sysinit_base_end<span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:12C0                 </span><span style="color:navy">jmp     dword ptr es:</span>sysinit_ptr ; return back to sysinit module
<span style="color:black">SYSINIT:12C5
SYSINIT:12C5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:12C5
SYSINIT:12C5
SYSINIT:12C5 </span>sum_up          proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:12C5                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:12C6                 </span><span style="color:navy">mov     ax, es:</span>CONFBOT
<span style="color:black">SYSINIT:12CA                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:12CC                 </span>assume ds:nothing
<span style="color:black">SYSINIT:12CC                 </span><span style="color:navy">xor     si, si
</span><span style="color:black">SYSINIT:12CE                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">SYSINIT:12D0                 </span><span style="color:navy">mov     cx, es:</span>config_size ; if config_size has been broken, then this
<span style="color:black">SYSINIT:12D0                                         </span>; whole test better fail.
<span style="color:black">SYSINIT:12D5                 </span><span style="color:navy">shr     cx, </span><span style="color:green">1           </span>; make it a word count
<span style="color:black">SYSINIT:12D7                 </span><span style="color:navy">jz      short </span><span style="color:gray">sum_sys_code </span>; when config.sys file not exist.
<span style="color:black">SYSINIT:12D9
SYSINIT:12D9 </span><span style="color:gray">sum1</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:12D9                 </span><span style="color:navy">add     ax, [si]
</span><span style="color:black">SYSINIT:12DB                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:12DC                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:12DD                 </span><span style="color:navy">loop    </span><span style="color:gray">sum1
</span><span style="color:black">SYSINIT:12DF
SYSINIT:12DF </span><span style="color:gray">sum_sys_code</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:12DF                 </span><span style="color:navy">mov     si, offset </span>locstack ; 532h
<span style="color:black">SYSINIT:12DF                                         </span>; starting after the stack.
<span style="color:black">SYSINIT:12DF                                         </span>; this does not cover the possible stack code!
<span style="color:black">SYSINIT:12E2                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">5970h       </span>; SI_end (22688)
<span style="color:black">SYSINIT:12E2                                         </span>; SI_end is the label at the end of sysinit
<span style="color:black">SYSINIT:12E2                                         </span>; from after_checksum to SI_end
<span style="color:black">SYSINIT:12E5                 </span><span style="color:navy">sub     cx, si
</span><span style="color:black">SYSINIT:12E7                 </span><span style="color:navy">shr     cx, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:12E9
SYSINIT:12E9 </span><span style="color:gray">sum2</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:12E9                 </span><span style="color:navy">add     ax, es:[si]
</span><span style="color:black">SYSINIT:12EC                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:12ED                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:12EE                 </span><span style="color:navy">loop    </span><span style="color:gray">sum2
</span><span style="color:black">SYSINIT:12F0                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:12F1                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:12F1 </span>sum_up          endp
<span style="color:black">SYSINIT:12F1
SYSINIT:12F1 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:12F2 </span>sysinit_base_ssx <span style="color:navy">dw </span><span style="color:#008040">0                   </span>; sysinit_base_ss equ $-sysinit_base ; 62
<span style="color:gray">SYSINIT:12F4 </span>sysinit_base_spx <span style="color:navy">dw </span><span style="color:#008040">0                   </span>; sysinit_base_sp equ $-sysinit_base ; 64
<span style="color:gray">SYSINIT:12F6 </span>mem_alloc_err_msgx <span style="color:navy">db </span><span style="color:green">0Dh</span><span style="color:navy">,</span><span style="color:green">0Ah
</span><span style="color:gray">SYSINIT:12F6                 </span><span style="color:navy">db &#039;Memory allocation error $&#039;
</span><span style="color:black">SYSINIT:1311
SYSINIT:1311 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1311
SYSINIT:1311
SYSINIT:1311 </span>set_buffer      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1311                 </span><span style="color:navy">xor     dl, dl          </span>; input:
<span style="color:black">SYSINIT:1311                                         </span>;   ds:bx -&gt; buffinfo.
<span style="color:black">SYSINIT:1311                                         </span>;   [memhi]:[memlo=0] = available space for the hash bucket.
<span style="color:black">SYSINIT:1311                                         </span>;   singlebuffersize = buff header size + sector size
<span style="color:black">SYSINIT:1311                                         </span>; output:
<span style="color:black">SYSINIT:1311                                         </span>;   buffers Queue established.
<span style="color:black">SYSINIT:1311                                         </span>;   [memhi]:[memlo] = addr of the next available free space.
<span style="color:black">SYSINIT:1311                                         </span>;
<span style="color:black">SYSINIT:1311                                         </span>; assume buffers not in HMA
<span style="color:black">SYSINIT:1313                 </span><span style="color:navy">call    </span>GetBufferAddr
<span style="color:black">SYSINIT:1316                 </span><span style="color:navy">jz      short </span><span style="color:gray">set_buff_1
</span><span style="color:black">SYSINIT:1318                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">1           </span>; buffers in HMA
<span style="color:black">SYSINIT:131A
SYSINIT:131A </span><span style="color:gray">set_buff_1</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:131A                 </span><span style="color:navy">mov     [bx], di        </span>; [bx+BUFFINF.Buff_Queue] ; head of Buff Q
<span style="color:black">SYSINIT:131C                 </span><span style="color:navy">mov     word ptr [bx+</span><span style="color:#ff8000">2</span><span style="color:navy">], es </span>; [bx+BUFFINF.Buff_Queue+2]
<span style="color:black">SYSINIT:131F                 </span><span style="color:navy">mov     word ptr [bx+</span><span style="color:#ff8000">4</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [bx+BUFFINF.Dirty_Buff_Count] ; set dirty_count to 0.
<span style="color:black">SYSINIT:1324                 </span><span style="color:navy">mov     ax, di
</span><span style="color:black">SYSINIT:1326                 </span><span style="color:navy">mov     cx, cs:</span>buffers
<span style="color:black">SYSINIT:132B                 </span><span style="color:navy">push    di              </span>; remember first buffer
<span style="color:black">SYSINIT:132C
SYSINIT:132C </span><span style="color:gray">nxt_buff</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:132C                 </span><span style="color:navy">call    </span>set_buffer_info ; set buf_link,buf_id...
<span style="color:black">SYSINIT:132F                 </span><span style="color:navy">mov     di, ax
</span><span style="color:black">SYSINIT:1331                 </span><span style="color:navy">loop    </span><span style="color:gray">nxt_buff
</span><span style="color:black">SYSINIT:1333                 </span><span style="color:navy">sub     di, cs:</span>singlebuffersize ; point to last buffer
<span style="color:black">SYSINIT:1338                 </span><span style="color:navy">pop     cx              </span>; get first buffer
<span style="color:black">SYSINIT:1339                 </span><span style="color:navy">mov     es:[di], cx     </span>; [es:di+buffinfo.buf_next] ; last-&gt;next = first
<span style="color:black">SYSINIT:133C                 </span><span style="color:navy">xchg    cx, di
</span><span style="color:black">SYSINIT:133E                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">2</span><span style="color:navy">], cx   </span>; [es:di+buffinfo.buf_prev] ; first-&gt;prev = last
<span style="color:black">SYSINIT:1342                 </span><span style="color:navy">or      dl, dl          </span>; In HMa ?
<span style="color:black">SYSINIT:1344                 </span><span style="color:navy">jz      short </span><span style="color:gray">set_buff_2 </span>; no
<span style="color:black">SYSINIT:1346                 </span><span style="color:navy">mov     byte ptr [bx+</span><span style="color:#ff8000">0Ch</span><span style="color:navy">], </span><span style="color:#ff8000">1 </span>; mov byte [bx+BUFFINF.Buff_In_HMA],1
<span style="color:black">SYSINIT:134A                 </span><span style="color:navy">mov     ax, cs:</span>memhi    ; seg of scratch buff
<span style="color:black">SYSINIT:134E                 </span><span style="color:navy">mov     word ptr [bx+</span><span style="color:#ff8000">0Dh</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [bx+BUFFINF.Lo_Mem_Buff] ; offset of scratch buff is 0
<span style="color:black">SYSINIT:1353                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">0Fh</span><span style="color:navy">], ax    </span>; mov [bx+BUFFINF.Lo_Mem_Buff+2],ax
<span style="color:black">SYSINIT:1356                 </span><span style="color:navy">mov     ax, cs:</span>singlebuffersize ; size of scratch buff
<span style="color:black">SYSINIT:135A                 </span><span style="color:navy">sub     ax, </span><span style="color:green">20          </span>; bufinsiz ; buffer head not required
<span style="color:black">SYSINIT:135D
SYSINIT:135D </span><span style="color:gray">set_buff_2</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:135D                 </span><span style="color:navy">add     cs:</span>memlo<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:1362                 </span><span style="color:navy">or      cs:</span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">2
</span><span style="color:black">SYSINIT:1368                 </span><span style="color:navy">call    loc_8DA6
</span><span style="color:black">SYSINIT:136B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:136B </span>set_buffer      endp
<span style="color:black">SYSINIT:136B
SYSINIT:136C
SYSINIT:136C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:136C
SYSINIT:136C
SYSINIT:136C </span>GetBufferAddr   proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:136C                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:136D                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:136E                 </span><span style="color:navy">mov     ax, cs:</span>singlebuffersize
<span style="color:black">SYSINIT:1372                 </span><span style="color:navy">mul     cs:</span>buffers
<span style="color:black">SYSINIT:1377                 </span><span style="color:navy">add     ax, </span><span style="color:#ff8000">0Fh         </span>; 15
<span style="color:black">SYSINIT:137A                 </span><span style="color:navy">and     ax, </span><span style="color:green">0FFF0h      </span>; ~15 ; not 0Fh
<span style="color:black">SYSINIT:137D                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:black">SYSINIT:137F                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4A02h       </span>; ((multMULT&lt;&lt;8)+multMULTALLOCHMA)
<span style="color:black">SYSINIT:1382                 </span><span style="color:navy">int     </span><span style="color:green">2Fh             </span>; DOS 5+ - ALLOCATE HMA SPACE
<span style="color:black">SYSINIT:1382                                         </span>;     AX = 4A02h
<span style="color:black">SYSINIT:1382                                         </span>;     BX = number of bytes
<span style="color:black">SYSINIT:1382                                         </span>; Return:
<span style="color:black">SYSINIT:1382                                         </span>;     ES:DI -&gt; start of allocated HMA block or FFFFh:FFFFh
<span style="color:black">SYSINIT:1382                                         </span>;     BX = number of bytes actually allocated (rounded up to next
<span style="color:black">SYSINIT:1382                                         </span>;          paragraph for DOS 5.0 and 6.0)
<span style="color:black">SYSINIT:1382                                         </span>; Notes:
<span style="color:black">SYSINIT:1382                                         </span>;     this call is not valid unless DOS is loaded in the HMA (DOS=HIGH)
<span style="color:black">SYSINIT:1382                                         </span>;
<span style="color:black">SYSINIT:1382                                         </span>;     called by Windows 3.1 DOSX.EXE
<span style="color:black">SYSINIT:1382                                         </span>;     supported by Novell DOS 7
<span style="color:black">SYSINIT:1384                 </span><span style="color:navy">cmp     di, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:1387                 </span><span style="color:navy">jnz     short </span><span style="color:gray">got_hma
</span><span style="color:black">SYSINIT:1389                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">0           </span>; dont xor di,di Z flag needed
<span style="color:black">SYSINIT:138C                 </span><span style="color:navy">mov     es, cs:</span>memhi
<span style="color:black">SYSINIT:1391
SYSINIT:1391 </span><span style="color:gray">got_hma</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1391                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1392                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1393                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1393 </span>GetBufferAddr   endp
<span style="color:black">SYSINIT:1393
SYSINIT:1394
SYSINIT:1394 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1394
SYSINIT:1394
SYSINIT:1394 </span>set_buffer_info proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1394                 </span><span style="color:navy">push    cs:</span>buf_prev_off ; es:di -&gt; buffer header to be set.
<span style="color:black">SYSINIT:1394                                         </span>; ax = di
<span style="color:black">SYSINIT:1399                 </span><span style="color:navy">pop     word ptr es:[di+</span><span style="color:#ff8000">2</span><span style="color:navy">] </span>; [es:di+buffinfo.buf_prev]
<span style="color:black">SYSINIT:139D                 </span><span style="color:navy">mov     cs:</span>buf_prev_off<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:13A1                 </span><span style="color:navy">add     ax, cs:</span>singlebuffersize ; adjust ax
<span style="color:black">SYSINIT:13A6                 </span><span style="color:navy">mov     es:[di], ax     </span>; [es:di+buffinfo.buf_next]
<span style="color:black">SYSINIT:13A9                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], </span><span style="color:#ff8000">0FFh </span>; [es:di+buffinfo.buf_ID]
<span style="color:black">SYSINIT:13A9                                         </span>; new buffer free
<span style="color:black">SYSINIT:13AF                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+buffinfo.buf_sector]
<span style="color:black">SYSINIT:13B5                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">8</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:di+buffinfo.buf_sector+2]
<span style="color:black">SYSINIT:13BB                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:13BB </span>set_buffer_info endp
<span style="color:black">SYSINIT:13BB
SYSINIT:13BC
SYSINIT:13BC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:13BC
SYSINIT:13BC
SYSINIT:13BC </span>stackinit       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:13BC                 </span><span style="color:navy">push    ax              </span>; ibmstack initialization routine
<span style="color:black">SYSINIT:13BC                                         </span>; in - cs, ds -&gt; sysinitseg,
<span style="color:black">SYSINIT:13BC                                         </span>;      es -&gt; relocated stack code &amp; data.
<span style="color:black">SYSINIT:13BD                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:13BE                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:13BF                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:13C0                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:13C1                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:13C2                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:13C3                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:13C4                 </span><span style="color:navy">push    bp
</span><span style="color:black">SYSINIT:13C5                 </span><span style="color:navy">mov     ax, cs:</span>stack_count
<span style="color:black">SYSINIT:13C9                 </span><span style="color:navy">mov     es:</span>stackcount<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:13CD                 </span><span style="color:navy">mov     ax, ds:</span>stack_size
<span style="color:black">SYSINIT:13D0                 </span><span style="color:navy">mov     es:</span>stacksize<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:13D4                 </span><span style="color:navy">mov     ax, cs:</span>stack_addr ; offset
<span style="color:black">SYSINIT:13D8                 </span><span style="color:navy">mov     es:</span>stacks<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:13DC                 </span><span style="color:navy">mov     ax, cs:</span>stack_addr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:black">SYSINIT:13E0                 </span><span style="color:navy">mov     es:</span>stacks<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax </span>; segment
<span style="color:black">SYSINIT:13E4                 </span><span style="color:navy">mov     bp, es:</span>stacks   ; &quot;firstentry&quot; will always be at stacks
<span style="color:black">SYSINIT:13E4                                         </span>; the stacks will always immediately follow the table entries
<span style="color:black">SYSINIT:13E9                 </span><span style="color:navy">mov     es:</span>firstentry<span style="color:navy">, bp
</span><span style="color:black">SYSINIT:13EE                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">8           </span>; entrysize
<span style="color:black">SYSINIT:13F1                 </span><span style="color:navy">mov     cx, es:</span>stackcount
<span style="color:black">SYSINIT:13F6                 </span><span style="color:navy">mul     cx
</span><span style="color:black">SYSINIT:13F8                 </span><span style="color:navy">add     ax, bp
</span><span style="color:black">SYSINIT:13FA                 </span><span style="color:navy">mov     es:</span>stackat<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:13FE                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:black">SYSINIT:1400                 </span><span style="color:navy">sub     bx, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:1403                 </span><span style="color:navy">mov     di, es:</span>stackat  ; zero the entire stack area to start with
<span style="color:black">SYSINIT:1408                 </span><span style="color:navy">mov     ax, es:</span>stacksize
<span style="color:black">SYSINIT:140C                 </span><span style="color:navy">mul     cx
</span><span style="color:black">SYSINIT:140E                 </span><span style="color:navy">mov     cx, ax
</span><span style="color:black">SYSINIT:1410                 </span><span style="color:navy">xor     ax, ax          </span>; 0
<span style="color:black">SYSINIT:1412                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:1413                 </span><span style="color:navy">pop     ds              </span>; ds = relocated stack code seg.
<span style="color:black">SYSINIT:1414                 </span><span style="color:navy">mov     es, ds:</span>stacks<span style="color:navy">+</span><span style="color:green">2 </span>; get segment of stack area.
<span style="color:black">SYSINIT:1418                 </span><span style="color:navy">cld
</span><span style="color:black">SYSINIT:1419                 </span><span style="color:navy">rep stosb
</span><span style="color:black">SYSINIT:141B                 </span><span style="color:navy">mov     cx, ds:</span>stackcount ; loop for &quot;count&quot; times, building a table entry
<span style="color:black">SYSINIT:141B                                         </span>; cs = sysinitseg, ds = relocated stack code seg,
<span style="color:black">SYSINIT:141B                                         </span>; es = segment of stack space
<span style="color:black">SYSINIT:141B                                         </span>; cx = number of entries
<span style="color:black">SYSINIT:141B                                         </span>; es:bp =&gt; base of stacks - 2
<span style="color:black">SYSINIT:141B                                         </span>; es:bx =&gt; first table entry
<span style="color:black">SYSINIT:141F
SYSINIT:141F </span><span style="color:gray">buildloop</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:141F                 </span><span style="color:navy">mov     byte ptr es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; [es:bp+allocbyte],free
<span style="color:black">SYSINIT:1424                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">1</span><span style="color:navy">], al   </span>; [es:bp+intlevel]
<span style="color:black">SYSINIT:1424                                         </span>; ax = 0
<span style="color:black">SYSINIT:1428                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">2</span><span style="color:navy">], ax   </span>; [es:bp+savedsp]
<span style="color:black">SYSINIT:142C                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">4</span><span style="color:navy">], ax   </span>; [es:bp+savedss]
<span style="color:black">SYSINIT:1430                 </span><span style="color:navy">add     bx, ds:</span>stacksize
<span style="color:black">SYSINIT:1434                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">6</span><span style="color:navy">], bx   </span>; [es:bp+newsp]
<span style="color:black">SYSINIT:1438                 </span><span style="color:navy">mov     es:[bx], bp
</span><span style="color:black">SYSINIT:143B                 </span><span style="color:navy">add     bp, </span><span style="color:#ff8000">8           </span>; entrysize
<span style="color:black">SYSINIT:143E                 </span><span style="color:navy">loop    </span><span style="color:gray">buildloop
</span><span style="color:black">SYSINIT:1440                 </span><span style="color:navy">sub     bp, </span><span style="color:#ff8000">8           </span>; entrysize
<span style="color:black">SYSINIT:1443                 </span><span style="color:navy">mov     ds:</span>lastentry<span style="color:navy">, bp
</span><span style="color:black">SYSINIT:1447                 </span><span style="color:navy">mov     ds:</span>nextentry<span style="color:navy">, bp
</span><span style="color:black">SYSINIT:144B                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:144C                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0F000h      </span>; look at the model byte
<span style="color:black">SYSINIT:144F                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:1451                 </span>assume ds:nothing
<span style="color:black">SYSINIT:1451                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">0FFFEh</span><span style="color:navy">, </span><span style="color:green">0F9h </span>; mdl_convert ; convertible?
<span style="color:black">SYSINIT:1456                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:1457                 </span>assume ds:nothing
<span style="color:black">SYSINIT:1457                 </span><span style="color:navy">jnz     short </span><span style="color:gray">skip_disablenmis
</span><span style="color:black">SYSINIT:1459                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">7           </span>; disable convertible nmis
<span style="color:black">SYSINIT:145B                 </span><span style="color:navy">out     </span><span style="color:green">72h</span><span style="color:navy">, al         </span>; CMOS Memory/RTC Index Register (Extended RAM)
<span style="color:black">SYSINIT:145D
SYSINIT:145D </span><span style="color:gray">skip_disablenmis</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:145D                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">SYSINIT:145F                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:1461                 </span>assume es:nothing
<span style="color:black">SYSINIT:1461                 </span><span style="color:navy">cli
</span><span style="color:black">SYSINIT:1462
SYSINIT:1462 </span>stkinit_02<span style="color:navy">:                             </span>; Int 02h vector table offset
<span style="color:black">SYSINIT:1462                 </span><span style="color:navy">mov     si, </span><span style="color:green">8
</span><span style="color:black">SYSINIT:1465                 </span><span style="color:navy">mov     di, offset </span>int19old02
<span style="color:black">SYSINIT:1468                 </span><span style="color:navy">mov     bx, offset </span>old02
<span style="color:black">SYSINIT:146B                 </span><span style="color:navy">mov     dx, offset </span>int02
<span style="color:black">SYSINIT:146E                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:1471
SYSINIT:1471 </span>stkinit_08<span style="color:navy">:                             </span>; Int 08h vector table offset
<span style="color:black">SYSINIT:1471                 </span><span style="color:navy">mov     si, </span><span style="color:green">20h
</span><span style="color:black">SYSINIT:1474                 </span><span style="color:navy">mov     di, offset </span>int19old08
<span style="color:black">SYSINIT:1477                 </span><span style="color:navy">mov     bx, offset </span>old08
<span style="color:black">SYSINIT:147A                 </span><span style="color:navy">mov     dx, offset </span>int08
<span style="color:black">SYSINIT:147D                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:1480
SYSINIT:1480 </span>stkinit_09<span style="color:navy">:                             </span>; Int 09h vector table offset
<span style="color:black">SYSINIT:1480                 </span><span style="color:navy">mov     si, </span><span style="color:green">24h
</span><span style="color:black">SYSINIT:1483                 </span><span style="color:navy">mov     di, offset </span>int19old09
<span style="color:black">SYSINIT:1486                 </span><span style="color:navy">mov     bx, offset </span>old09
<span style="color:black">SYSINIT:1489                 </span><span style="color:navy">mov     dx, offset </span>int09
<span style="color:black">SYSINIT:148C                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:148F
SYSINIT:148F </span>stkinit_70<span style="color:navy">:                             </span>; Int 70h vector table offset
<span style="color:black">SYSINIT:148F                 </span><span style="color:navy">mov     si, </span><span style="color:green">1C0h
</span><span style="color:black">SYSINIT:1492                 </span><span style="color:navy">mov     di, offset </span>int19old70
<span style="color:black">SYSINIT:1495                 </span><span style="color:navy">mov     bx, offset </span>old70
<span style="color:black">SYSINIT:1498                 </span><span style="color:navy">mov     dx, offset </span>int70
<span style="color:black">SYSINIT:149B                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:149E
SYSINIT:149E </span>stkinit_0A<span style="color:navy">:                             </span>; 0Ah*4 ; 40
<span style="color:black">SYSINIT:149E                 </span><span style="color:navy">mov     si, </span><span style="color:green">28h         </span>; Int 0Ah vector table offset
<span style="color:black">SYSINIT:14A1                 </span><span style="color:navy">push    ds              </span>; save relocated stack code segment
<span style="color:black">SYSINIT:14A2                 </span><span style="color:navy">lds     bx, es:[si]     </span>; ds:bx -&gt; original interrupt handler
<span style="color:black">SYSINIT:14A5                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:14A6                 </span><span style="color:navy">pop     dx              </span>; dx = segment value
<span style="color:black">SYSINIT:14A7                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:14AA                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0A_first
</span><span style="color:black">SYSINIT:14AC                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0CFh </span>; does vector point to an iret?
<span style="color:black">SYSINIT:14AF                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0A_first
</span><span style="color:black">SYSINIT:14B1                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:green">424Bh </span>; magic offset (see int&amp;aa, msstack.inc)
<span style="color:black">SYSINIT:14B6                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0A_not_first
</span><span style="color:black">SYSINIT:14B8                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0F000h      </span>; rom bios segment
<span style="color:black">SYSINIT:14BC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">int_0A_not_first
</span><span style="color:black">SYSINIT:14BE                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:14BF                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:14C0                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:14C3                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:14C5                 </span>assume es:nothing
<span style="color:black">SYSINIT:14C5                 </span><span style="color:navy">cmp     bx, es:</span><span style="color:green">0FF01h
</span><span style="color:black">SYSINIT:14CA                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:14CB                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:14CC                 </span>assume es:nothing
<span style="color:black">SYSINIT:14CC                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0A_first
</span><span style="color:black">SYSINIT:14CE
SYSINIT:14CE </span><span style="color:gray">int_0A_not_first</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:14CE                 </span><span style="color:navy">pop     ds              </span>; not the first. we are going to hook vector.
<span style="color:black">SYSINIT:14CF                 </span><span style="color:navy">mov     di, offset </span>int19old0A ; we have to set old&amp;aa for int19 handler too.
<span style="color:black">SYSINIT:14D2                 </span><span style="color:navy">mov     bx, offset </span>old0A ; pass where to save original owner pointer
<span style="color:black">SYSINIT:14D5                 </span><span style="color:navy">mov     dx, offset </span>int0A ; pass where new handler is
<span style="color:black">SYSINIT:14D8                 </span><span style="color:navy">call    </span>new_init_loop   ; adjust the vector to new handler,
<span style="color:black">SYSINIT:14D8                                         </span>; saving pointer to original owner.
<span style="color:black">SYSINIT:14DB                 </span><span style="color:navy">jmp     short </span><span style="color:gray">stkinit_0B
</span><span style="color:black">SYSINIT:14DD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:14DD
SYSINIT:14DD </span><span style="color:gray">int_0A_first</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:14DD                 </span><span style="color:navy">pop     ds              </span>; the first. don&#039;t have to hook stack code.
<span style="color:black">SYSINIT:14DE
SYSINIT:14DE </span><span style="color:gray">stkinit_0B</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:14DE                 </span><span style="color:navy">mov     si, </span><span style="color:green">2Ch         </span>; Int 0Bh vector table offset
<span style="color:black">SYSINIT:14E1                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:14E2                 </span><span style="color:navy">lds     bx, es:[si]
</span><span style="color:black">SYSINIT:14E5                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:14E6                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:14E7                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:14EA                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0B_first
</span><span style="color:black">SYSINIT:14EC                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0CFh
</span><span style="color:black">SYSINIT:14EF                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0B_first
</span><span style="color:black">SYSINIT:14F1                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:green">424Bh
</span><span style="color:black">SYSINIT:14F6                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0B_not_first
</span><span style="color:black">SYSINIT:14F8                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:14FC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">int_0B_not_first
</span><span style="color:black">SYSINIT:14FE                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:14FF                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1500                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:1503                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:1505                 </span>assume es:nothing
<span style="color:black">SYSINIT:1505                 </span><span style="color:navy">cmp     bx, es:</span><span style="color:green">0FF01h
</span><span style="color:black">SYSINIT:150A                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:150B                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:150C                 </span>assume es:nothing
<span style="color:black">SYSINIT:150C                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0B_first
</span><span style="color:black">SYSINIT:150E
SYSINIT:150E </span><span style="color:gray">int_0B_not_first</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:150E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:150F                 </span><span style="color:navy">mov     di, offset </span>int19old0B
<span style="color:black">SYSINIT:1512                 </span><span style="color:navy">mov     bx, offset </span>old0B
<span style="color:black">SYSINIT:1515                 </span><span style="color:navy">mov     dx, offset </span>int0B
<span style="color:black">SYSINIT:1518                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:151B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">stkinit_0C
</span><span style="color:black">SYSINIT:151D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:151D
SYSINIT:151D </span><span style="color:gray">int_0B_first</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:151D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:151E
SYSINIT:151E </span><span style="color:gray">stkinit_0C</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:151E                 </span><span style="color:navy">mov     si, </span><span style="color:green">30h         </span>; Int 0Ch vector table offset
<span style="color:black">SYSINIT:1521                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1522                 </span><span style="color:navy">lds     bx, es:[si]
</span><span style="color:black">SYSINIT:1525                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1526                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1527                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:152A                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0C_first
</span><span style="color:black">SYSINIT:152C                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0CFh
</span><span style="color:black">SYSINIT:152F                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0C_first
</span><span style="color:black">SYSINIT:1531                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:green">424Bh
</span><span style="color:black">SYSINIT:1536                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0C_not_first
</span><span style="color:black">SYSINIT:1538                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:153C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">int_0C_not_first
</span><span style="color:black">SYSINIT:153E                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:153F                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1540                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:1543                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:1545                 </span>assume es:nothing
<span style="color:black">SYSINIT:1545                 </span><span style="color:navy">cmp     bx, es:</span><span style="color:green">0FF01h
</span><span style="color:black">SYSINIT:154A                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:154B                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:154C                 </span>assume es:nothing
<span style="color:black">SYSINIT:154C                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0C_first
</span><span style="color:black">SYSINIT:154E
SYSINIT:154E </span><span style="color:gray">int_0C_not_first</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:154E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:154F                 </span><span style="color:navy">mov     di, offset </span>int19old0C
<span style="color:black">SYSINIT:1552                 </span><span style="color:navy">mov     bx, offset </span>old0C
<span style="color:black">SYSINIT:1555                 </span><span style="color:navy">mov     dx, offset </span>int0C
<span style="color:black">SYSINIT:1558                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:155B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">stkinit_0D
</span><span style="color:black">SYSINIT:155D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:155D
SYSINIT:155D </span><span style="color:gray">int_0C_first</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:155D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:155E
SYSINIT:155E </span><span style="color:gray">stkinit_0D</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:155E                 </span><span style="color:navy">mov     si, </span><span style="color:green">34h         </span>; Int 0Dh vector table offset
<span style="color:black">SYSINIT:1561                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1562                 </span><span style="color:navy">lds     bx, es:[si]
</span><span style="color:black">SYSINIT:1565                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1566                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1567                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:156A                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0D_first
</span><span style="color:black">SYSINIT:156C                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0CFh
</span><span style="color:black">SYSINIT:156F                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0D_first
</span><span style="color:black">SYSINIT:1571                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:green">424Bh
</span><span style="color:black">SYSINIT:1576                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0D_not_first
</span><span style="color:black">SYSINIT:1578                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:157C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">int_0D_not_first
</span><span style="color:black">SYSINIT:157E                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:157F                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1580                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:1583                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:1585                 </span>assume es:nothing
<span style="color:black">SYSINIT:1585                 </span><span style="color:navy">cmp     bx, es:</span><span style="color:green">0FF01h
</span><span style="color:black">SYSINIT:158A                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:158B                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:158C                 </span>assume es:nothing
<span style="color:black">SYSINIT:158C                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0D_first
</span><span style="color:black">SYSINIT:158E
SYSINIT:158E </span><span style="color:gray">int_0D_not_first</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:158E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:158F                 </span><span style="color:navy">mov     di, offset </span>int19old0D
<span style="color:black">SYSINIT:1592                 </span><span style="color:navy">mov     bx, offset </span>old0D
<span style="color:black">SYSINIT:1595                 </span><span style="color:navy">mov     dx, offset </span>int0D
<span style="color:black">SYSINIT:1598                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:159B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">stkinit_0E
</span><span style="color:black">SYSINIT:159D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:159D
SYSINIT:159D </span><span style="color:gray">int_0D_first</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:159D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:159E
SYSINIT:159E </span><span style="color:gray">stkinit_0E</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:159E                 </span><span style="color:navy">mov     si, </span><span style="color:green">38h         </span>; 0Eh*4 ; Int 0Eh vector table offset
<span style="color:black">SYSINIT:15A1                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:15A2                 </span><span style="color:navy">lds     bx, es:[si]
</span><span style="color:black">SYSINIT:15A5                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:15A6                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:15A7                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:15AA                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0E_first
</span><span style="color:black">SYSINIT:15AC                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0CFh
</span><span style="color:black">SYSINIT:15AF                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0E_first
</span><span style="color:black">SYSINIT:15B1                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:green">424Bh
</span><span style="color:black">SYSINIT:15B6                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0E_not_first
</span><span style="color:black">SYSINIT:15B8                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:15BC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">int_0E_not_first
</span><span style="color:black">SYSINIT:15BE                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:15BF                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:15C0                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:15C3                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:15C5                 </span>assume es:nothing
<span style="color:black">SYSINIT:15C5                 </span><span style="color:navy">cmp     bx, es:</span><span style="color:green">0FF01h
</span><span style="color:black">SYSINIT:15CA                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:15CB                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:15CC                 </span>assume es:nothing
<span style="color:black">SYSINIT:15CC                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_0E_first
</span><span style="color:black">SYSINIT:15CE
SYSINIT:15CE </span><span style="color:gray">int_0E_not_first</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:15CE                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:15CF                 </span><span style="color:navy">mov     di, offset </span>int19old0E
<span style="color:black">SYSINIT:15D2                 </span><span style="color:navy">mov     bx, offset </span>old0E
<span style="color:black">SYSINIT:15D5                 </span><span style="color:navy">mov     dx, offset </span>int0Eh
<span style="color:black">SYSINIT:15D8                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:15DB                 </span><span style="color:navy">jmp     short </span><span style="color:gray">stkinit_72
</span><span style="color:black">SYSINIT:15DD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:15DD
SYSINIT:15DD </span><span style="color:gray">int_0E_first</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:15DD                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:15DE
SYSINIT:15DE </span><span style="color:gray">stkinit_72</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:15DE                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">1C8h        </span>; 72h*4 ; 456
<span style="color:black">SYSINIT:15DE                                         </span>; Int 72h vector table offset
<span style="color:black">SYSINIT:15E1                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:15E2                 </span><span style="color:navy">lds     bx, es:[si]
</span><span style="color:black">SYSINIT:15E5                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:15E6                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:15E7                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:15EA                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_72_first
</span><span style="color:black">SYSINIT:15EC                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0CFh
</span><span style="color:black">SYSINIT:15EF                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_72_first
</span><span style="color:black">SYSINIT:15F1                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:green">424Bh
</span><span style="color:black">SYSINIT:15F6                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_72_not_first
</span><span style="color:black">SYSINIT:15F8                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:15FC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">int_72_not_first
</span><span style="color:black">SYSINIT:15FE                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:15FF                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1600                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:1603                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:1605                 </span>assume es:nothing
<span style="color:black">SYSINIT:1605                 </span><span style="color:navy">cmp     bx, es:</span><span style="color:green">0FF01h
</span><span style="color:black">SYSINIT:160A                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:160B                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:160C                 </span>assume es:nothing
<span style="color:black">SYSINIT:160C                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_72_first
</span><span style="color:black">SYSINIT:160E
SYSINIT:160E </span><span style="color:gray">int_72_not_first</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:160E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:160F                 </span><span style="color:navy">mov     di, offset </span>int19old72
<span style="color:black">SYSINIT:1612                 </span><span style="color:navy">mov     bx, offset </span>old72
<span style="color:black">SYSINIT:1615                 </span><span style="color:navy">mov     dx, offset </span>int72
<span style="color:black">SYSINIT:1618                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:161B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">stkinit_73
</span><span style="color:black">SYSINIT:161D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:161D
SYSINIT:161D </span><span style="color:gray">int_72_first</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:161D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:161E
SYSINIT:161E </span><span style="color:gray">stkinit_73</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:161E                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">1CCh        </span>; 73h*4 ; 460
<span style="color:black">SYSINIT:1621                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1622                 </span><span style="color:navy">lds     bx, es:[si]
</span><span style="color:black">SYSINIT:1625                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1626                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1627                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:162A                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_73_first
</span><span style="color:black">SYSINIT:162C                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0CFh
</span><span style="color:black">SYSINIT:162F                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_73_first
</span><span style="color:black">SYSINIT:1631                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:green">424Bh
</span><span style="color:black">SYSINIT:1636                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_73_not_first
</span><span style="color:black">SYSINIT:1638                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:163C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">int_73_not_first
</span><span style="color:black">SYSINIT:163E                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:163F                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1640                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:1643                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:1645                 </span>assume es:nothing
<span style="color:black">SYSINIT:1645                 </span><span style="color:navy">cmp     bx, es:</span><span style="color:green">0FF01h
</span><span style="color:black">SYSINIT:164A                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:164B                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:164C                 </span>assume es:nothing
<span style="color:black">SYSINIT:164C                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_73_first
</span><span style="color:black">SYSINIT:164E
SYSINIT:164E </span><span style="color:gray">int_73_not_first</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:164E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:164F                 </span><span style="color:navy">mov     di, offset </span>int19old73
<span style="color:black">SYSINIT:1652                 </span><span style="color:navy">mov     bx, offset </span>old73
<span style="color:black">SYSINIT:1655                 </span><span style="color:navy">mov     dx, offset </span>int73
<span style="color:black">SYSINIT:1658                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:165B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">stkinit_74
</span><span style="color:black">SYSINIT:165D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:165D
SYSINIT:165D </span><span style="color:gray">int_73_first</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:165D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:165E
SYSINIT:165E </span><span style="color:gray">stkinit_74</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:165E                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">1D0h        </span>; 74h*4 ; 464
<span style="color:black">SYSINIT:1661                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1662                 </span><span style="color:navy">lds     bx, es:[si]
</span><span style="color:black">SYSINIT:1665                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1666                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1667                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:166A                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_74_first
</span><span style="color:black">SYSINIT:166C                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0CFh
</span><span style="color:black">SYSINIT:166F                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_74_first
</span><span style="color:black">SYSINIT:1671                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:green">424Bh
</span><span style="color:black">SYSINIT:1676                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_74_not_first
</span><span style="color:black">SYSINIT:1678                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:167C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">int_74_not_first
</span><span style="color:black">SYSINIT:167E                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:167F                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1680                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:1683                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:1685                 </span>assume es:nothing
<span style="color:black">SYSINIT:1685                 </span><span style="color:navy">cmp     bx, es:</span><span style="color:green">0FF01h
</span><span style="color:black">SYSINIT:168A                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:168A </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:168B                 </span><span style="color:navy">db </span><span style="color:#008040">7
</span><span style="color:olive">SYSINIT:168C                 </span>assume es:nothing
<span style="color:olive">SYSINIT:168C                 </span><span style="color:navy">db  </span><span style="color:#008040">74h </span><span style="color:gray">; t
</span><span style="color:olive">SYSINIT:168D                 </span><span style="color:navy">db  </span><span style="color:#008040">0Fh
</span><span style="color:black">SYSINIT:168E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:168E
SYSINIT:168E </span><span style="color:gray">int_74_not_first</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:168E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:168F                 </span><span style="color:navy">mov     di, offset </span>int19old74
<span style="color:black">SYSINIT:1692                 </span><span style="color:navy">mov     bx, offset </span>old74
<span style="color:black">SYSINIT:1695                 </span><span style="color:navy">mov     dx, offset </span>int74
<span style="color:black">SYSINIT:1698                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:169B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">stkinit_76
</span><span style="color:black">SYSINIT:169D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:169D
SYSINIT:169D </span><span style="color:gray">int_74_first</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:169D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:169E
SYSINIT:169E </span><span style="color:gray">stkinit_76</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:169E                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">1D8h        </span>; 76h*4 ; 472
<span style="color:black">SYSINIT:16A1                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:16A2                 </span><span style="color:navy">lds     bx, es:[si]
</span><span style="color:black">SYSINIT:16A5                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:16A6                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:16A7                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:16AA                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_76_first
</span><span style="color:black">SYSINIT:16AC                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0CFh
</span><span style="color:black">SYSINIT:16AF                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_76_first
</span><span style="color:black">SYSINIT:16B1                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:green">424Bh
</span><span style="color:black">SYSINIT:16B6                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_76_not_first
</span><span style="color:black">SYSINIT:16B8                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:16BC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">int_76_not_first
</span><span style="color:black">SYSINIT:16BE                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:16BF                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:16C0                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:16C3                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:16C5                 </span>assume es:nothing
<span style="color:black">SYSINIT:16C5                 </span><span style="color:navy">cmp     bx, es:</span><span style="color:green">0FF01h
</span><span style="color:black">SYSINIT:16CA                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:16CB                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:16CC                 </span>assume es:nothing
<span style="color:black">SYSINIT:16CC                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_76_first
</span><span style="color:black">SYSINIT:16CE
SYSINIT:16CE </span><span style="color:gray">int_76_not_first</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:16CE                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:16CF                 </span><span style="color:navy">mov     di, offset </span>int19old76
<span style="color:black">SYSINIT:16D2                 </span><span style="color:navy">mov     bx, offset </span>old76
<span style="color:black">SYSINIT:16D5                 </span><span style="color:navy">mov     dx, offset </span>int76
<span style="color:black">SYSINIT:16D8                 </span><span style="color:navy">call    </span>new_init_loop
<span style="color:black">SYSINIT:16DB                 </span><span style="color:navy">jmp     short </span><span style="color:gray">stkinit_77
</span><span style="color:black">SYSINIT:16DD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:16DD
SYSINIT:16DD </span><span style="color:gray">int_76_first</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:16DD                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:16DE
SYSINIT:16DE </span><span style="color:gray">stkinit_77</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:16DE                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">1DCh        </span>; mov si,77h*4 ; 476
<span style="color:black">SYSINIT:16DE                                         </span>; Int 77h vector table offset
<span style="color:black">SYSINIT:16E1                 </span><span style="color:navy">push    ds              </span>; save relocated stack code segment
<span style="color:black">SYSINIT:16E2                 </span><span style="color:navy">lds     bx, es:[si]     </span>; ds:bx -&gt; original interrupt handler
<span style="color:black">SYSINIT:16E5                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:16E6                 </span><span style="color:navy">pop     dx              </span>; dx = segment value
<span style="color:black">SYSINIT:16E7                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:16EA                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_77_first
</span><span style="color:black">SYSINIT:16EC                 </span><span style="color:navy">cmp     byte ptr [bx], </span><span style="color:green">0CFh </span>; does vector point to an iret?
<span style="color:black">SYSINIT:16EF                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_77_first
</span><span style="color:black">SYSINIT:16F1                 </span><span style="color:navy">cmp     word ptr [bx+</span><span style="color:#ff8000">6</span><span style="color:navy">], </span><span style="color:green">424Bh </span>; magic offset (see int&amp;aa, msstack.inc)
<span style="color:black">SYSINIT:16F6                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_77_not_first
</span><span style="color:black">SYSINIT:16F8                 </span><span style="color:navy">cmp     dx, </span><span style="color:green">0F000h      </span>; rom bios segment
<span style="color:black">SYSINIT:16FC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">int_77_not_first
</span><span style="color:black">SYSINIT:16FE                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:16FF                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1700                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:1703                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:1705                 </span>assume es:nothing
<span style="color:black">SYSINIT:1705                 </span><span style="color:navy">cmp     bx, es:</span><span style="color:green">0FF01h
</span><span style="color:black">SYSINIT:170A                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:170B                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:170C                 </span>assume es:nothing
<span style="color:black">SYSINIT:170C                 </span><span style="color:navy">jz      short </span><span style="color:gray">int_77_first
</span><span style="color:black">SYSINIT:170E
SYSINIT:170E </span><span style="color:gray">int_77_not_first</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:170E                 </span><span style="color:navy">pop     ds              </span>; not the first. we are going to hook vector.
<span style="color:black">SYSINIT:170F                 </span><span style="color:navy">mov     di, offset </span>int19old77 ; we have to set old&amp;aa for int19 handler too.
<span style="color:black">SYSINIT:1712                 </span><span style="color:navy">mov     bx, offset </span>old77 ; pass where to save original owner pointer
<span style="color:black">SYSINIT:1715                 </span><span style="color:navy">mov     dx, offset </span>int77 ; pass where new handler is
<span style="color:black">SYSINIT:1718                 </span><span style="color:navy">call    </span>new_init_loop   ; adjust the vector to new handler,
<span style="color:black">SYSINIT:1718                                         </span>; saving pointer to original owner.
<span style="color:black">SYSINIT:171B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">int_77_end
</span><span style="color:black">SYSINIT:171D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:171D
SYSINIT:171D </span><span style="color:gray">int_77_first</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:171D                 </span><span style="color:navy">pop     ds              </span>; the first. don&#039;t have to hook stack code.
<span style="color:black">SYSINIT:171E
SYSINIT:171E </span><span style="color:gray">int_77_end</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:171E                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:171F                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0F000h
</span><span style="color:black">SYSINIT:1722                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:1724                 </span>assume ds:nothing
<span style="color:black">SYSINIT:1724                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">0FFFEh</span><span style="color:navy">, </span><span style="color:green">0F9h </span>; mdl_convert ; pc convertible?
<span style="color:black">SYSINIT:1729                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:172A                 </span>assume ds:nothing
<span style="color:black">SYSINIT:172A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">skip_enablenmis
</span><span style="color:black">SYSINIT:172C                 </span><span style="color:navy">mov     al, </span><span style="color:green">27h         </span>; enable convertible nmis
<span style="color:black">SYSINIT:172E                 </span><span style="color:navy">out     </span><span style="color:green">72h</span><span style="color:navy">, al         </span>; CMOS Memory/RTC Index Register (Extended RAM)
<span style="color:black">SYSINIT:1730
SYSINIT:1730 </span><span style="color:gray">skip_enablenmis</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1730                 </span><span style="color:navy">sti
</span><span style="color:black">SYSINIT:1731                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h         </span>; DOSBIODATASEG
<span style="color:black">SYSINIT:1734                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:1736                 </span>assume ds:nothing
<span style="color:black">SYSINIT:1736                 </span><span style="color:navy">mov     ds:</span>int19sem<span style="color:navy">, </span><span style="color:#ff8000">1  </span>; indicate that int 19h
<span style="color:black">SYSINIT:1736                                         </span>; initialization is complete
<span style="color:black">SYSINIT:173B                 </span><span style="color:navy">pop     bp
</span><span style="color:black">SYSINIT:173C                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:173D                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:173E                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:173F                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:1740                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1741                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:1742                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:1743                 </span>assume ds:nothing
<span style="color:black">SYSINIT:1743                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1744                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1744 </span><span style="background:blue"><span style="color:navy">stackinit       endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:1744
SYSINIT:1745
SYSINIT:1745 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1745
SYSINIT:1745
SYSINIT:1745 </span>new_init_loop   proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1745                 </span><span style="color:navy">mov     ax, es:[si]     </span>; new stack initialization
<span style="color:black">SYSINIT:1745                                         </span>; (dx = new handler offset,
<span style="color:black">SYSINIT:1745                                         </span>;  bx = original handler saving addr,
<span style="color:black">SYSINIT:1745                                         </span>;  si = int vector table offset
<span style="color:black">SYSINIT:1745                                         </span>;  di = int19old?? field offset
<span style="color:black">SYSINIT:1745                                         </span>;                 -in DOSBIOSDATASEG-
<span style="color:black">SYSINIT:1745                                         </span>;  es = zero, segid of vector table
<span style="color:black">SYSINIT:1745                                         </span>;  ds = relocated stack code segment)
<span style="color:black">SYSINIT:1748                 </span><span style="color:navy">mov     [bx], ax
</span><span style="color:black">SYSINIT:174A                 </span><span style="color:navy">mov     ax, es:[si+</span><span style="color:#ff8000">2</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:174E                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">2</span><span style="color:navy">], ax
</span><span style="color:black">SYSINIT:1751                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:1752                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h         </span>; DOSBIODATASEG
<span style="color:black">SYSINIT:1755                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:1757                 </span>assume ds:nothing
<span style="color:black">SYSINIT:1757                 </span><span style="color:navy">mov     ax, es:[si]
</span><span style="color:black">SYSINIT:175A                 </span><span style="color:navy">mov     [di], ax
</span><span style="color:black">SYSINIT:175C                 </span><span style="color:navy">mov     ax, es:[si+</span><span style="color:#ff8000">2</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:1760                 </span><span style="color:navy">mov     [di+</span><span style="color:#ff8000">2</span><span style="color:navy">], ax
</span><span style="color:black">SYSINIT:1763                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:1764                 </span>assume ds:nothing
<span style="color:black">SYSINIT:1764                 </span><span style="color:navy">mov     es:[si], dx
</span><span style="color:black">SYSINIT:1767                 </span><span style="color:navy">mov     word ptr es:[si+</span><span style="color:#ff8000">2</span><span style="color:navy">], ds
</span><span style="color:black">SYSINIT:176B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:176B </span>new_init_loop   endp
<span style="color:black">SYSINIT:176B
SYSINIT:176C
SYSINIT:176C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:176C
SYSINIT:176C
SYSINIT:176C </span>setdevmark      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:176C                 </span><span style="color:navy">push    es              </span>; set the devmark for mem command.
<span style="color:black">SYSINIT:176C                                         </span>; in:
<span style="color:black">SYSINIT:176C                                         </span>;   [memhi] - the address to place devmark
<span style="color:black">SYSINIT:176C                                         </span>;   [memlo] = 0
<span style="color:black">SYSINIT:176C                                         </span>;   al = id for devmark_id
<span style="color:black">SYSINIT:176C                                         </span>; out:
<span style="color:black">SYSINIT:176C                                         </span>;   devmark established.
<span style="color:black">SYSINIT:176C                                         </span>;   the address saved in cs:[devmark_addr]
<span style="color:black">SYSINIT:176C                                         </span>;   [memhi] increase by 1.
<span style="color:black">SYSINIT:176D                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:176E                 </span><span style="color:navy">mov     cx, cs:</span>memhi
<span style="color:black">SYSINIT:1773                 </span><span style="color:navy">mov     cs:</span>devmark_addr<span style="color:navy">, cx
</span><span style="color:black">SYSINIT:1778                 </span><span style="color:navy">mov     es, cx
</span><span style="color:black">SYSINIT:177A                 </span><span style="color:navy">mov     es:</span><span style="color:green">0</span><span style="color:navy">, al
</span><span style="color:black">SYSINIT:177E                 </span><span style="color:navy">inc     cx
</span><span style="color:black">SYSINIT:177F                 </span><span style="color:navy">mov     es:</span><span style="color:green">1</span><span style="color:navy">, cx
</span><span style="color:black">SYSINIT:1784                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:1785                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:1786                 </span><span style="color:navy">inc     cs:</span>memhi
<span style="color:black">SYSINIT:178B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:178B </span>setdevmark      endp
<span style="color:black">SYSINIT:178B
SYSINIT:178B </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:178C </span>config_envlen   <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:178C                                         </span>; when config_wrkseg is being used as
<span style="color:gray">SYSINIT:178C                                         </span>; a scratch env, this is its length
<span style="color:gray">SYSINIT:178E </span>config_wrkseg   <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:178E                                         </span>; config work area (above confbot)
<span style="color:gray">SYSINIT:178E                                         </span>; segment of work area
<span style="color:gray">SYSINIT:1790 </span>config_cmd      <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:1790                                         </span>; current config cmd
<span style="color:gray">SYSINIT:1790                                         </span>; (with CONFIG_OPTION_QUERY bit intact)
<span style="color:gray">SYSINIT:1791 </span>config_multi    <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:1791                                         </span>; non-zero if multi-config config.sys
<span style="color:gray">SYSINIT:1792 </span>multdeviceflag  <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:1793 </span>devmark_addr    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:1793                                         </span>; segment address for devmark.
<span style="color:gray">SYSINIT:1795 </span>setdevmarkflag  <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:1795                                         </span>; flag used for devmark
<span style="color:gray">SYSINIT:1796 </span>driver_units    <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:1796                                         </span>; total unitcount for driver
<span style="color:gray">SYSINIT:1797 </span>ems_stub_installed <span style="color:navy">db </span><span style="color:#008040">0                 </span>; (not used)
<span style="color:gray">SYSINIT:1798 </span>badparm_ptr     <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:1798                                         </span>; badparm_off equ badparm_ptr
<span style="color:gray">SYSINIT:1798                                         </span>; badparm_seg equ badparm_ptr+2
<span style="color:gray">SYSINIT:179C </span>_$P_ORDINAL     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:179C                                         </span>; Operand ordinal save area
<span style="color:gray">SYSINIT:179E </span>_$P_RC          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:179E                                         </span>; Return code from parser
<span style="color:gray">SYSINIT:17A0 </span>_$P_SI_Save     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17A0                                         </span>; Pointer of command buffer
<span style="color:gray">SYSINIT:17A2 </span>_$P_DX          <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17A2                                         </span>; Return result buffer address
<span style="color:gray">SYSINIT:17A4 </span>_$P_Terminator  <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17A4                                         </span>; Terminator code (ASCII)
<span style="color:gray">SYSINIT:17A5 </span>_$P_DBCSEV_OFF  <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17A5                                         </span>; Offset of DBCS EV
<span style="color:gray">SYSINIT:17A7 </span>_$P_DBCSEV_SEG  <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17A7                                         </span>; Segment of DBCS EV
<span style="color:gray">SYSINIT:17A9 </span>_$P_Flags       <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17A9                                         </span>; Parser internal flags
<span style="color:gray">SYSINIT:17A9                                         </span>; %define _$P_Flags1 _$P_Flags
<span style="color:gray">SYSINIT:17A9                                         </span>;         to reference 1st byte flags
<span style="color:gray">SYSINIT:17A9                                         </span>; %define _$P_Flags2 _$P_Flags+1
<span style="color:gray">SYSINIT:17A9                                         </span>;         to reference 2nd byte flags only
<span style="color:gray">SYSINIT:17AA </span>_$P_Flags2      <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17AB </span>_$P_SaveSI_Cmpx <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17AB                                         </span>; save si for later use by complex
<span style="color:gray">SYSINIT:17AD </span>_$P_KEYorSW_Ptr <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17AD                                         </span>; points next to &quot;=&quot; or &quot;:&quot; code
<span style="color:gray">SYSINIT:17AF </span>_$P_Save_EOB    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17AF                                         </span>; save pointer to EOB
<span style="color:gray">SYSINIT:17B1 </span>_$P_Found_SYNONYM <span style="color:navy">dw </span><span style="color:#008040">0                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17B1                                         </span>; es:@ points to found synonym
<span style="color:gray">SYSINIT:17B3 </span>_$P_STRING_BUF  <span style="color:navy">db </span><span style="color:#008040">128 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:17B3                                         </span>; Pick a operand from command line
<span style="color:gray">SYSINIT:1833 </span>_$P_Char_CAP_Ptr <span style="color:navy">db </span><span style="color:#008040">0FFh                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:1833                                         </span>; info id
<span style="color:gray">SYSINIT:1834                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; offset of char case map table
<span style="color:gray">SYSINIT:1836                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; segment of char case map table
<span style="color:gray">SYSINIT:1838 </span>_$P_FileSp_Char <span style="color:navy">db &#039;[]|&lt;&gt;+=;&quot;&#039;          </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:1838                                         </span>; delimitters of file spec
<span style="color:gray">SYSINIT:1838                                         </span>; _$P_FileSp_Len equ $-_$P_FileSp_Char
<span style="color:gray">SYSINIT:1841 </span>_$P_err_flag    <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:1841                                         </span>; flag set if filespec parsing error
<span style="color:gray">SYSINIT:1841                                         </span>; was detected
<span style="color:black">SYSINIT:1842
SYSINIT:1842 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1842
SYSINIT:1842
SYSINIT:1842 </span>SysParse        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1842                 </span><span style="color:navy">mov     word ptr cs:</span>_$P_Flags<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; Clear all internal flags
<span style="color:black">SYSINIT:1849                 </span><span style="color:navy">cld                     </span>; confirm forward direction
<span style="color:black">SYSINIT:184A                 </span><span style="color:navy">mov     cs:</span>_$P_ORDINAL<span style="color:navy">, cx </span>; save operand ordinal
<span style="color:black">SYSINIT:184F                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; _$P_No_Error ; assume no error
<span style="color:black">SYSINIT:1856                 </span><span style="color:navy">mov     cs:</span>_$P_Found_SYNONYM<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; initalize synonym pointer
<span style="color:black">SYSINIT:185D                 </span><span style="color:navy">mov     cs:</span>_$P_DX<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; The table of special chars _$P_FileSp_Char
<span style="color:black">SYSINIT:185D                                         </span>; should be initialized on every entry to SysParse
<span style="color:black">SYSINIT:1864                 </span><span style="color:navy">mov     word ptr cs:</span>_$P_FileSp_Char<span style="color:navy">, </span><span style="color:#ff8000">5D5Bh </span><span style="color:gray">; &quot;[]|&lt;&gt;+=;\&quot;&quot;
</span><span style="color:black">SYSINIT:186B                 </span><span style="color:navy">mov     word ptr cs:</span>_$P_FileSp_Char<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, </span><span style="color:#ff8000">3C7Ch
</span><span style="color:black">SYSINIT:1872                 </span><span style="color:navy">mov     word ptr cs:</span>_$P_FileSp_Char<span style="color:navy">+</span><span style="color:green">4</span><span style="color:navy">, </span><span style="color:#ff8000">2B3Eh
</span><span style="color:black">SYSINIT:1879                 </span><span style="color:navy">mov     word ptr cs:</span>_$P_FileSp_Char<span style="color:navy">+</span><span style="color:green">6</span><span style="color:navy">, </span><span style="color:#ff8000">3B3Dh
</span><span style="color:black">SYSINIT:1880                 </span><span style="color:navy">call    </span>_$P_Skip_Delim  ; Move si to 1st non white space
<span style="color:black">SYSINIT:1883                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_Start </span>; If EOL is not encountered, do parse
<span style="color:black">SYSINIT:1885                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL  ; set exit code to -1
<span style="color:black">SYSINIT:1888                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:1889                 </span><span style="color:navy">mov     bx, es:[di]     </span>; [es:di+_$P_PARMS_Blk.PARMSX_Address]
<span style="color:black">SYSINIT:1889                                         </span>; Get the PARMSX address to
<span style="color:black">SYSINIT:188C                 </span><span style="color:navy">cmp     cl, es:[bx]     </span>; [es:bx+_$P_PARMSX_Blk.MinP]
<span style="color:black">SYSINIT:188C                                         </span>; check ORDINAL to see if the minimum
<span style="color:black">SYSINIT:188F                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_Fin   </span>; positional found.
<span style="color:black">SYSINIT:1891                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">2           </span>; $P_Op_Missing ; If no, set exit code to missing operand
<span style="color:black">SYSINIT:1894
SYSINIT:1894 </span><span style="color:gray">_$P_Fin</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1894                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1895                 </span><span style="color:navy">jmp     </span><span style="color:gray">_$P_Single_Exit </span>; return to the caller
<span style="color:black">SYSINIT:1898 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1898
SYSINIT:1898 </span><span style="color:gray">_$P_Start</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1898                 </span><span style="color:navy">mov     cs:</span>_$P_SaveSI_Cmpx<span style="color:navy">, si </span>; save ptr to command line for later use
<span style="color:black">SYSINIT:1898                                         </span>; by complex quoted string or file spec.
<span style="color:black">SYSINIT:189D                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:189E                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:189F                 </span><span style="color:navy">push    bp
</span><span style="color:black">SYSINIT:18A0                 </span><span style="color:navy">lea     bx, </span>_$P_STRING_BUF ; set buffer to copy from command string
<span style="color:black">SYSINIT:18A4                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">20h </span>; _$P_Extra ; 3/9 extra delimiter encountered ?
<span style="color:black">SYSINIT:18AA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Pack_End </span>; 3/9 if yes, no need to copy
<span style="color:black">SYSINIT:18AC
SYSINIT:18AC </span><span style="color:gray">_$P_Pack_Loop</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:18AC                 </span><span style="color:navy">lodsb                   </span>; Pick a operand from buffer
<span style="color:black">SYSINIT:18AD                 </span><span style="color:navy">call    </span>_$P_Chk_Switch  ; Check switch character
<span style="color:black">SYSINIT:18B0                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Pack_End_BY_EOL </span>; if carry set found delimiter type slash,
<span style="color:black">SYSINIT:18B0                                         </span>; need backup si, else continue
<span style="color:black">SYSINIT:18B2                 </span><span style="color:navy">call    </span>_$P_Chk_EOL     ; Check EOL character
<span style="color:black">SYSINIT:18B5                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Pack_End_BY_EOL </span>; need backup si
<span style="color:black">SYSINIT:18B7                 </span><span style="color:navy">call    </span>_$P_Chk_Delim   ; Check delimiter
<span style="color:black">SYSINIT:18BA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_PL01  </span>; If no, process next byte
<span style="color:black">SYSINIT:18BC                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">20h </span>; _$P_Extra ; 3/9 If yes and white spec,
<span style="color:black">SYSINIT:18C2                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Pack_End_backup_si </span>; 3/9 then
<span style="color:black">SYSINIT:18C4                 </span><span style="color:navy">call    </span>_$P_Skip_Delim  ; skip subsequent white space,too
<span style="color:black">SYSINIT:18C7                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Pack_End </span>; finish copy by placing NUL at end
<span style="color:black">SYSINIT:18C9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:18C9
SYSINIT:18C9 </span><span style="color:gray">_$P_Pack_End_backup_si</span><span style="color:navy">:                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:18C9                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">41h </span>; _$P_SW+_$P_equ
<span style="color:black">SYSINIT:18CF                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Pack_End
</span><span style="color:black">SYSINIT:18D1                 </span><span style="color:navy">dec     si
</span><span style="color:black">SYSINIT:18D2                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Pack_End
</span><span style="color:black">SYSINIT:18D4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:18D4
SYSINIT:18D4 </span><span style="color:gray">_$P_PL01</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:18D4                 </span><span style="color:navy">mov     cs:[bx], al     </span>; move byte to STRING_BUF
<span style="color:black">SYSINIT:18D7                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Dh </span><span style="color:gray">; &#039;=&#039;   </span>; _$P_Keyword ; if it is equal character,
<span style="color:black">SYSINIT:18D9                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_PL00  </span>; then
<span style="color:black">SYSINIT:18DB                 </span><span style="color:navy">or      cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">1 </span>; _$P_equ ; remember it in flag
<span style="color:black">SYSINIT:18E1
SYSINIT:18E1 </span><span style="color:gray">_$P_PL00</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:18E1                 </span><span style="color:navy">inc     bx              </span>; ready to see next byte
<span style="color:black">SYSINIT:18E2                 </span><span style="color:navy">call    </span>_$P_Chk_DBCS    ; was it 1st byte of DBCS ?
<span style="color:black">SYSINIT:18E5                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_Pack_Loop </span>; if no, process to next byte
<span style="color:black">SYSINIT:18E7                 </span><span style="color:navy">lodsb
</span><span style="color:black">SYSINIT:18E8                 </span><span style="color:navy">mov     cs:[bx], al     </span>; if yes, store 2nd byte of DBCS
<span style="color:black">SYSINIT:18EB                 </span><span style="color:navy">inc     bx              </span>; update pointer
<span style="color:black">SYSINIT:18EC                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Pack_Loop </span>; process to next byte
<span style="color:black">SYSINIT:18EE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:18EE
SYSINIT:18EE </span><span style="color:gray">_$P_Pack_End_BY_EOL</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:18EE                 </span><span style="color:navy">dec     si              </span>; backup si pointer
<span style="color:black">SYSINIT:18EF
SYSINIT:18EF </span><span style="color:gray">_$P_Pack_End</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:18EF                 </span><span style="color:navy">mov     cs:</span>_$P_SI_Save<span style="color:navy">, si </span>; save next pointer, SI
<span style="color:black">SYSINIT:18F4                 </span><span style="color:navy">mov     byte ptr cs:[bx], </span><span style="color:#ff8000">0 </span>; _$P_NULL ; put NULL at the end
<span style="color:black">SYSINIT:18F8                 </span><span style="color:navy">mov     cs:</span>_$P_Save_EOB<span style="color:navy">, bx </span>; keep the address for later use of complex
<span style="color:black">SYSINIT:18FD                 </span><span style="color:navy">mov     bx, es:[di]     </span>; [es:di+_$P_PARMS_Blk.PARMSX_Address]
<span style="color:black">SYSINIT:18FD                                         </span>; get PARMSX address
<span style="color:black">SYSINIT:1900                 </span><span style="color:navy">lea     si, </span>_$P_STRING_BUF
<span style="color:black">SYSINIT:1904                 </span><span style="color:navy">cmp     byte ptr cs:[si], </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039; </span>; the operand begins w/ switch char ?
<span style="color:black">SYSINIT:1904                                         </span>; _$P_Switch
<span style="color:black">SYSINIT:1908                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_SW_Manager </span>; if yes, process as switch
<span style="color:black">SYSINIT:190A                 </span><span style="color:navy">cmp     byte ptr cs:[si], </span><span style="color:#ff8000">22h </span><span style="color:gray">; &#039;&quot;&#039; </span>; _$P_DQuote  ; is it a string?
<span style="color:black">SYSINIT:190E                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Positional_Manager </span>; if so, process as one!
<span style="color:black">SYSINIT:1910                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">1 </span>; $P_equ ; the operand includes equal
<span style="color:black">SYSINIT:1916                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Key_Manager </span>; if yes, process as keyword
<span style="color:black">SYSINIT:1918
SYSINIT:1918 </span><span style="color:gray">_$P_Positional_Manager</span><span style="color:navy">:                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1918                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:#ff8000">1</span><span style="color:navy">]   </span>; else process as positional
<span style="color:black">SYSINIT:1918                                         </span>; get maxp
<span style="color:black">SYSINIT:191C                 </span><span style="color:navy">xor     ah, ah          </span>; ax = maxp
<span style="color:black">SYSINIT:191E                 </span><span style="color:navy">cmp     cs:</span>_$P_ORDINAL<span style="color:navy">, ax </span>; too many positional ?
<span style="color:black">SYSINIT:1923                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_Too_Many_Error </span>; if yes, set exit code to too many
<span style="color:black">SYSINIT:1925                 </span><span style="color:navy">mov     ax, cs:</span>_$P_ORDINAL ; see what the current ordinal
<span style="color:black">SYSINIT:1929                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1           </span>; ax = ax*2
<span style="color:black">SYSINIT:192B                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:192C                 </span><span style="color:navy">inc     bx              </span>; add &#039;2&#039; to bx reg
<span style="color:black">SYSINIT:192C                                         </span>; now bx points to 1st CONTROL
<span style="color:black">SYSINIT:192D                 </span><span style="color:navy">add     bx, ax          </span>; now bx points to specified CONTROL address
<span style="color:black">SYSINIT:192F                 </span><span style="color:navy">mov     bx, es:[bx]     </span>; now bx points to specified CONTROL itself
<span style="color:black">SYSINIT:1932                 </span><span style="color:navy">call    </span>_$P_Chk_Pos_Control ; Do process for positional
<span style="color:black">SYSINIT:1935                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Return_to_Caller </span>; and return to the caller
<span style="color:black">SYSINIT:1937 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1937
SYSINIT:1937 </span><span style="color:gray">_$P_Too_Many_Error</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1937                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">1    </span>; set exit code
<span style="color:black">SYSINIT:193E                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Return_to_Caller </span>; and return to the caller
<span style="color:black">SYSINIT:1940 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1940
SYSINIT:1940 </span><span style="color:gray">_$P_SW_Manager</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1940                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:#ff8000">1</span><span style="color:navy">]   </span>; [es:bx+_$P_PARMSX_Blk.MaxP] ; get maxp
<span style="color:black">SYSINIT:1944                 </span><span style="color:navy">xor     ah, ah          </span>; ax = maxp
<span style="color:black">SYSINIT:1946                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:1947                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1           </span>; ax = (ax+1)*2
<span style="color:black">SYSINIT:1949                 </span><span style="color:navy">add     bx, ax          </span>; now bx points to maxs
<span style="color:black">SYSINIT:194B                 </span><span style="color:navy">mov     cl, es:[bx]
</span><span style="color:black">SYSINIT:194E                 </span><span style="color:navy">xor     ch, ch          </span>; cx = maxs
<span style="color:black">SYSINIT:1950                 </span><span style="color:navy">or      cx, cx          </span>; at least one switch ?
<span style="color:black">SYSINIT:1952                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_SW_Not_Found </span>; no
<span style="color:black">SYSINIT:1954                 </span><span style="color:navy">inc     bx              </span>; now bx points to 1st CONTROL address
<span style="color:black">SYSINIT:1955
SYSINIT:1955 </span><span style="color:gray">_$P_SW_Mgr_Loop</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1955                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:1956                 </span><span style="color:navy">mov     bx, es:[bx]     </span>; bx points to Switch CONTROL itself
<span style="color:black">SYSINIT:1959                 </span><span style="color:navy">call    </span>_$P_Chk_SW_Control ; do process for switch
<span style="color:black">SYSINIT:195C                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:195D                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_Return_to_Caller </span>;
<span style="color:black">SYSINIT:195D                                         </span>; if the CONTROL is for the switch, exit
<span style="color:black">SYSINIT:195F                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:1960                 </span><span style="color:navy">inc     bx              </span>;    add &#039;2&#039; to bx reg
<span style="color:black">SYSINIT:1960                                         </span>; else bx points to the next CONTROL
<span style="color:black">SYSINIT:1961                 </span><span style="color:navy">loop    </span><span style="color:gray">_$P_SW_Mgr_Loop </span>; and loop
<span style="color:black">SYSINIT:1963
SYSINIT:1963 </span><span style="color:gray">_$P_SW_Not_Found</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1963                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">3    </span>; _$P_Not_In_SW
<span style="color:black">SYSINIT:1963                                         </span>; here no CONTROL for the switch has
<span style="color:black">SYSINIT:196A                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Return_to_Caller
</span><span style="color:black">SYSINIT:196C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:196C
SYSINIT:196C </span><span style="color:gray">_$P_Key_Manager</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:196C                 </span><span style="color:navy">mov     al, es:[bx+</span><span style="color:#ff8000">1</span><span style="color:navy">]   </span>; [es:bx+_$P_PARMSX_Blk.MaxP] ; get maxp
<span style="color:black">SYSINIT:1970                 </span><span style="color:navy">xor     ah, ah          </span>; ax = maxp
<span style="color:black">SYSINIT:1972                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:1973                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1           </span>; ax = (ax+1)*2
<span style="color:black">SYSINIT:1975                 </span><span style="color:navy">add     bx, ax          </span>; now bx points to maxs
<span style="color:black">SYSINIT:1977                 </span><span style="color:navy">mov     al, es:[bx]
</span><span style="color:black">SYSINIT:197A                 </span><span style="color:navy">xor     ah, ah          </span>; ax = maxs
<span style="color:black">SYSINIT:197C                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:197E                 </span><span style="color:navy">inc     ax              </span>; ax = ax*2+1
<span style="color:black">SYSINIT:197F                 </span><span style="color:navy">add     bx, ax          </span>; now bx points to maxk
<span style="color:black">SYSINIT:1981                 </span><span style="color:navy">mov     cl, es:[bx]
</span><span style="color:black">SYSINIT:1984                 </span><span style="color:navy">xor     ch, ch          </span>; cx = maxk
<span style="color:black">SYSINIT:1986                 </span><span style="color:navy">or      cx, cx          </span>; at least one keyword ?
<span style="color:black">SYSINIT:1988                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Key_Not_Found </span>; no
<span style="color:black">SYSINIT:198A                 </span><span style="color:navy">inc     bx              </span>; now bx points to 1st CONTROL
<span style="color:black">SYSINIT:198B
SYSINIT:198B </span><span style="color:gray">_$P_Key_Mgr_Loop</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:198B                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:198C                 </span><span style="color:navy">mov     bx, es:[bx]     </span>; bx points to keyword CONTROL itself
<span style="color:black">SYSINIT:198F                 </span><span style="color:navy">call    </span>_$P_Chk_Key_Control ; do process for keyword
<span style="color:black">SYSINIT:1992                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1993                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_Return_to_Caller </span>;
<span style="color:black">SYSINIT:1993                                         </span>; if the CONTROL is for the keyword, exit
<span style="color:black">SYSINIT:1995                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:1996                 </span><span style="color:navy">inc     bx              </span>;    add &#039;2&#039; to bx reg
<span style="color:black">SYSINIT:1996                                         </span>; else bx points to the next CONTROL
<span style="color:black">SYSINIT:1997                 </span><span style="color:navy">loop    </span><span style="color:gray">_$P_Key_Mgr_Loop </span>; and loop
<span style="color:black">SYSINIT:1999
SYSINIT:1999 </span><span style="color:gray">_$P_Key_Not_Found</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1999                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">4    </span>; _$P_Not_In_Key
<span style="color:black">SYSINIT:1999                                         </span>; here no CONTROL for the keyword has
<span style="color:black">SYSINIT:19A0
SYSINIT:19A0 </span><span style="color:gray">_$P_Return_to_Caller</span><span style="color:navy">:                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:19A0                 </span><span style="color:navy">pop     bp
</span><span style="color:black">SYSINIT:19A1                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:19A2                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:19A3                 </span><span style="color:navy">mov     cx, cs:</span>_$P_ORDINAL ; return next ordinal
<span style="color:black">SYSINIT:19A8                 </span><span style="color:navy">mov     ax, cs:</span>_$P_RC   ; return exit code
<span style="color:black">SYSINIT:19AC                 </span><span style="color:navy">mov     si, cs:</span>_$P_SI_Save ; return next operand pointer
<span style="color:black">SYSINIT:19B1                 </span><span style="color:navy">mov     dx, cs:</span>_$P_DX   ; return result buffer address
<span style="color:black">SYSINIT:19B6                 </span><span style="color:navy">mov     bl, cs:</span>_$P_Terminator ; return delimiter code found
<span style="color:black">SYSINIT:19BB
SYSINIT:19BB </span><span style="color:gray">_$P_Single_Exit</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:19BB                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:19BC                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:19BC </span>SysParse        endp
<span style="color:black">SYSINIT:19BC
SYSINIT:19BD
SYSINIT:19BD </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:19BD
SYSINIT:19BD
SYSINIT:19BD </span>_$P_Chk_Pos_Control proc near           <span style="color:green">; ...
</span><span style="color:black">SYSINIT:19BD                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:19BE                 </span><span style="color:navy">mov     ax, es:[bx]     </span>; [es:bx+_$P_Control_Blk.Match_Flag]
<span style="color:black">SYSINIT:19C1                 </span><span style="color:navy">test    ax, </span><span style="color:green">2           </span>; $P_Repeat ; repeat allowed ?
<span style="color:black">SYSINIT:19C4                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_CPC00 </span>; then do not increment ORDINAL
<span style="color:black">SYSINIT:19C6                 </span><span style="color:navy">inc     cs:</span>_$P_ORDINAL  ; update the ordinal
<span style="color:black">SYSINIT:19CB
SYSINIT:19CB </span><span style="color:gray">_$P_CPC00</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:19CB                 </span><span style="color:navy">cmp     byte ptr cs:[si], </span><span style="color:#ff8000">0 </span>; _$P_NULL ; no data ?
<span style="color:black">SYSINIT:19CF                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_CPC01
</span><span style="color:black">SYSINIT:19D1                 </span><span style="color:navy">test    ax, </span><span style="color:green">1           </span>; _$P_Optional ; yes, then is it optional ?
<span style="color:black">SYSINIT:19D4                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_CPC02
</span><span style="color:black">SYSINIT:19D6                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">2    </span>; _$P_Op_Missing ; no, then error
<span style="color:black">SYSINIT:19DD                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_CPC_Exit
</span><span style="color:black">SYSINIT:19DF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:19DF
SYSINIT:19DF </span><span style="color:gray">_$P_CPC02</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:19DF                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:19E0                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3           </span>; _$P_String
<span style="color:black">SYSINIT:19E2                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$P_No_Tag
<span style="color:black">SYSINIT:19E2                                         </span>; if it is optional return NULL
<span style="color:black">SYSINIT:19E2                                         </span>; no item tag indication
<span style="color:black">SYSINIT:19E4                 </span><span style="color:navy">call    </span>_$P_Fill_Result
<span style="color:black">SYSINIT:19E7                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:19E8                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_CPC_Exit
</span><span style="color:black">SYSINIT:19EA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:19EA
SYSINIT:19EA </span><span style="color:gray">_$P_CPC01</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:19EA                 </span><span style="color:navy">call    </span>_$P_Check_Match_Flags
<span style="color:black">SYSINIT:19ED
SYSINIT:19ED </span><span style="color:gray">_$P_CPC_Exit</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:19ED                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:19EE                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:19EE </span>_$P_Chk_Pos_Control endp
<span style="color:black">SYSINIT:19EE
SYSINIT:19EF
SYSINIT:19EF </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:19EF
SYSINIT:19EF
SYSINIT:19EF </span>_$P_Chk_Key_Control proc near           <span style="color:green">; ...
</span><span style="color:black">SYSINIT:19EF                 </span><span style="color:navy">stc                     </span>; this logic works
<span style="color:black">SYSINIT:19EF                                         </span>; when the KeySW is reset.
<span style="color:black">SYSINIT:19F0                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:19F0 </span>_$P_Chk_Key_Control endp
<span style="color:black">SYSINIT:19F0
SYSINIT:19F1
SYSINIT:19F1 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:19F1
SYSINIT:19F1
SYSINIT:19F1 </span>_$P_Search_KEYorSW proc near            <span style="color:green">; ...
</span><span style="color:black">SYSINIT:19F1                 </span><span style="color:navy">push    bp
</span><span style="color:black">SYSINIT:19F2                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:19F3                 </span><span style="color:navy">mov     cl, es:[bx+</span><span style="color:#ff8000">8</span><span style="color:navy">]   </span>; [es:bx+_$P_Control_Blk.nid] ; Get synonym count
<span style="color:black">SYSINIT:19F7                 </span><span style="color:navy">xor     ch, ch          </span>; and set it to cx
<span style="color:black">SYSINIT:19F9                 </span><span style="color:navy">or      cx, cx          </span>; No synonyms specified ?
<span style="color:black">SYSINIT:19FB                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_KEYorSW_Not_Found </span>; then indicate not found by CY
<span style="color:black">SYSINIT:19FD                 </span><span style="color:navy">lea     bp, [bx+</span><span style="color:#ff8000">9</span><span style="color:navy">]      </span>; [bx+_$P_Control_Blk.KEYorSW]
<span style="color:black">SYSINIT:1A00
SYSINIT:1A00 </span><span style="color:gray">_$P_KEYorSW_Loop</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A00                 </span><span style="color:navy">call    </span>_$P_String_Comp ; compare string in buffer w/ the synonym
<span style="color:black">SYSINIT:1A03                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_KEYorSW_Found </span>; If match, set it to synonym pointer
<span style="color:black">SYSINIT:1A05                 </span><span style="color:navy">call    </span>_$P_MoveBP_NUL  ; else, bp points to the next string
<span style="color:black">SYSINIT:1A08                 </span><span style="color:navy">loop    </span><span style="color:gray">_$P_KEYorSW_Loop </span>; loop nid times
<span style="color:black">SYSINIT:1A0A
SYSINIT:1A0A </span><span style="color:gray">_$P_KEYorSW_Not_Found</span><span style="color:navy">:                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A0A                 </span><span style="color:navy">stc                     </span>; indicate not found in synonym list
<span style="color:black">SYSINIT:1A0B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_KEYorSW_Exit </span>; and exit
<span style="color:black">SYSINIT:1A0D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1A0D
SYSINIT:1A0D </span><span style="color:gray">_$P_KEYorSW_Found</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A0D                 </span><span style="color:navy">mov     cs:</span>_$P_Found_SYNONYM<span style="color:navy">, bp </span>; set synonym pointer
<span style="color:black">SYSINIT:1A12                 </span><span style="color:navy">clc                     </span>; indicate found
<span style="color:black">SYSINIT:1A13
SYSINIT:1A13 </span><span style="color:gray">_$P_KEYorSW_Exit</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A13                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:1A14                 </span><span style="color:navy">pop     bp
</span><span style="color:black">SYSINIT:1A15                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1A15 </span>_$P_Search_KEYorSW endp
<span style="color:black">SYSINIT:1A15
SYSINIT:1A16
SYSINIT:1A16 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1A16
SYSINIT:1A16
SYSINIT:1A16 </span>_$P_MoveBP_NUL  proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A16                 </span><span style="color:navy">cmp     byte ptr es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; _$P_NULL
<span style="color:black">SYSINIT:1A16                                         </span>; Increment BP that points
<span style="color:black">SYSINIT:1A1B                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_MBP_Exit </span>; to the synomym list
<span style="color:black">SYSINIT:1A1D                 </span><span style="color:navy">inc     bp              </span>; until
<span style="color:black">SYSINIT:1A1E                 </span><span style="color:navy">jmp     short </span>_$P_MoveBP_NUL ; NULL encountered.
<span style="color:black">SYSINIT:1A1E                                         </span>; _$P_MBP_Loop
<span style="color:black">SYSINIT:1A20 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1A20
SYSINIT:1A20 </span><span style="color:gray">_$P_MBP_Exit</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A20                 </span><span style="color:navy">inc     bp              </span>; bp points to next to NULL
<span style="color:black">SYSINIT:1A21                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1A21 </span>_$P_MoveBP_NUL  endp
<span style="color:black">SYSINIT:1A21
SYSINIT:1A22
SYSINIT:1A22 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1A22
SYSINIT:1A22
SYSINIT:1A22 </span>_$P_Chk_SW_Control proc near            <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A22                 </span><span style="color:navy">or      cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">10h </span>; (Check if switch is supported)
<span style="color:black">SYSINIT:1A22                                         </span>; _$P_SW_Cmp
<span style="color:black">SYSINIT:1A22                                         </span>; Indicate switch for later string comparison
<span style="color:black">SYSINIT:1A28                 </span><span style="color:navy">call    </span>_$P_Search_KEYorSW ; Search the switch in the CONTROL block
<span style="color:black">SYSINIT:1A2B                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Chk_SW_Err0 </span>; not found, then try next CONTROL
<span style="color:black">SYSINIT:1A2D                 </span><span style="color:navy">and     cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">0EFh </span>; and byte [cs:_$P_Flags2],0FFh-_$P_SW_Cmp
<span style="color:black">SYSINIT:1A2D                                         </span>; reset the indicator previously set /switch
<span style="color:black">SYSINIT:1A33                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1A34                 </span><span style="color:navy">mov     ax, cs:</span>_$P_KEYorSW_Ptr
<span style="color:black">SYSINIT:1A38                 </span><span style="color:navy">sub     ax, si          </span>; [si] = KEY or SW
<span style="color:black">SYSINIT:1A3A                 </span><span style="color:navy">add     cs:</span>_$P_SaveSI_Cmpx<span style="color:navy">, ax </span>; update for complex list
<span style="color:black">SYSINIT:1A3F                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1A40                 </span><span style="color:navy">mov     si, cs:</span>_$P_KEYorSW_Ptr ; set si at the end or colon
<span style="color:black">SYSINIT:1A45                 </span><span style="color:navy">cmp     byte ptr cs:[si], </span><span style="color:#ff8000">0 </span>; _$P_NULL ; any data after colon ?
<span style="color:black">SYSINIT:1A49                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_CSW00 </span>; if yes, process match flags
<span style="color:black">SYSINIT:1A4B                 </span><span style="color:navy">cmp     byte ptr cs:[si-</span><span style="color:green">1</span><span style="color:navy">], &#039;</span><span style="color:green">:&#039; </span>; _$P_Colon
<span style="color:black">SYSINIT:1A4B                                         </span>; if no, the switch terminated by colon ?
<span style="color:black">SYSINIT:1A50                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Chk_if_data_required </span>;
<span style="color:black">SYSINIT:1A50                                         </span>; if yes,
<span style="color:black">SYSINIT:1A52                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">9    </span>; _$P_Syntax ; return syntax error
<span style="color:black">SYSINIT:1A59                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Chk_SW_Exit
</span><span style="color:black">SYSINIT:1A5B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1A5B
SYSINIT:1A5B </span><span style="color:gray">_$P_Chk_if_data_required</span><span style="color:navy">:               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A5B                 </span><span style="color:navy">cmp     word ptr es:[bx], </span><span style="color:#ff8000">0 </span>; [es:bx+_$P_Control_Blk.Match_Flag]
<span style="color:black">SYSINIT:1A5B                                         </span>; should have data?
<span style="color:black">SYSINIT:1A5B                                         </span>; zero match flag means switch followed by nothing is OK
<span style="color:black">SYSINIT:1A5F                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_SW_Exit </span>; match flags not zero so
<span style="color:black">SYSINIT:1A5F                                         </span>; should have something if optional bit is not on
<span style="color:black">SYSINIT:1A61                 </span><span style="color:navy">test    word ptr es:[bx], </span><span style="color:green">1 </span>; _$P_Optional ; see if no value is valid
<span style="color:black">SYSINIT:1A66                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Chk_SW_Exit </span>; if so, then leave, else yell
<span style="color:black">SYSINIT:1A68                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">2    </span>; _$P_Op_Missing
<span style="color:black">SYSINIT:1A68                                         </span>; return required operand missing
<span style="color:black">SYSINIT:1A6F                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Chk_SW_Exit
</span><span style="color:black">SYSINIT:1A71 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1A71
SYSINIT:1A71 </span><span style="color:gray">_$P_CSW00</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A71                 </span><span style="color:navy">call    </span>_$P_Check_Match_Flags ; process match flag
<span style="color:black">SYSINIT:1A74                 </span><span style="color:navy">clc                     </span>; indicate match
<span style="color:black">SYSINIT:1A75                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Chk_SW_Single_Exit
</span><span style="color:black">SYSINIT:1A77 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1A77
SYSINIT:1A77 </span><span style="color:gray">_$P_Chk_SW_Err0</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A77                 </span><span style="color:navy">stc                     </span>; not found in switch synonym list
<span style="color:black">SYSINIT:1A78                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Chk_SW_Single_Exit
</span><span style="color:black">SYSINIT:1A7A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1A7A
SYSINIT:1A7A </span><span style="color:gray">_$P_Chk_SW_Exit</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A7A                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1A7B                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3           </span>; _$P_String
<span style="color:black">SYSINIT:1A7D                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$ P_No_Tag
<span style="color:black">SYSINIT:1A7F                 </span><span style="color:navy">call    </span>_$P_Fill_Result ; set result buffer
<span style="color:black">SYSINIT:1A82                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1A83                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:1A84
SYSINIT:1A84 </span><span style="color:gray">_$P_Chk_SW_Single_Exit</span><span style="color:navy">:                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A84                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1A84 </span>_$P_Chk_SW_Control endp
<span style="color:black">SYSINIT:1A84
SYSINIT:1A85
SYSINIT:1A85 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1A85
SYSINIT:1A85
SYSINIT:1A85 </span>_$P_Fill_Result proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1A85                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:1A86                 </span><span style="color:navy">mov     di, es:[bx+</span><span style="color:#ff8000">4</span><span style="color:navy">]   </span>; [es:bx+_$P_Control_Blk.Result_Buf]
<span style="color:black">SYSINIT:1A86                                         </span>; di points to result buffer
<span style="color:black">SYSINIT:1A8A                 </span><span style="color:navy">mov     cs:</span>_$P_DX<span style="color:navy">, di   </span>; set returned result address
<span style="color:black">SYSINIT:1A8F                 </span><span style="color:navy">mov     es:[di], al     </span>; [es:di+_$P_Result_Blk.Type] ; store type
<span style="color:black">SYSINIT:1A92                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">1</span><span style="color:navy">], ah   </span>; [es:di+_$P_Result_Blk.Item_Tag] ; store item tag
<span style="color:black">SYSINIT:1A96                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1A97                 </span><span style="color:navy">mov     ax, cs:</span>_$P_Found_SYNONYM
<span style="color:black">SYSINIT:1A9B                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">2</span><span style="color:navy">], ax   </span>; [es:di+_$P_Result_Blk.SYNONYM_Ptr]
<span style="color:black">SYSINIT:1A9F                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1AA0
SYSINIT:1AA0 </span>_$P_RLT04<span style="color:navy">:                              </span>;
<span style="color:black">SYSINIT:1AA0                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1           </span>; _$P_Number ; if number
<span style="color:black">SYSINIT:1AA2                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_RLT00 </span>;
<span style="color:black">SYSINIT:1AA2                                         </span>; then store 32 bit
<span style="color:black">SYSINIT:1AA4
SYSINIT:1AA4 </span><span style="color:gray">_$P_RLT02</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1AA4                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], dx   </span>; [es:di+_$P_Result_Blk.Picked_Val]
<span style="color:black">SYSINIT:1AA8                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">6</span><span style="color:navy">], cx   </span>; [es:di+_$P_Result_Blk.Picked_Val+2]
<span style="color:black">SYSINIT:1AAC                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_RLT_Exit
</span><span style="color:black">SYSINIT:1AAE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1AAE
SYSINIT:1AAE </span><span style="color:gray">_$P_RLT00</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1AAE                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2           </span>; _$P_List_Idx ; if list index
<span style="color:black">SYSINIT:1AB0                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_RLT01 </span>;
<span style="color:black">SYSINIT:1AB0                                         </span>; then store list index
<span style="color:black">SYSINIT:1AB2                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], dx   </span>; [es:di+_$P_Result_Blk.Picked_Val]
<span style="color:black">SYSINIT:1AB6                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_RLT_Exit
</span><span style="color:black">SYSINIT:1AB8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1AB8
SYSINIT:1AB8 </span><span style="color:gray">_$P_RLT01</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1AB8                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">7           </span>; _$P_Date_F ; Date format ?
<span style="color:black">SYSINIT:1ABA                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_RLT02
</span><span style="color:black">SYSINIT:1ABC                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">8           </span>; _$P_Time_F ; Time format ?
<span style="color:black">SYSINIT:1ABE                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_RLT02
</span><span style="color:black">SYSINIT:1AC0                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">6           </span>; _$P_Drive ; drive format ?
<span style="color:black">SYSINIT:1AC2                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_RLT03
</span><span style="color:black">SYSINIT:1AC4                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], dl   </span>; [es:di+_$P_Result_Blk.Picked_Val]
<span style="color:black">SYSINIT:1AC4                                         </span>; store drive number
<span style="color:black">SYSINIT:1AC8                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_RLT_Exit
</span><span style="color:black">SYSINIT:1ACA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1ACA
SYSINIT:1ACA </span><span style="color:gray">_$P_RLT03</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1ACA                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">4           </span>; _$P_Complex ; complex format ?
<span style="color:black">SYSINIT:1ACC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_RLT05
</span><span style="color:black">SYSINIT:1ACE                 </span><span style="color:navy">mov     ax, cs:</span>_$P_SaveSI_Cmpx ;
<span style="color:black">SYSINIT:1ACE                                         </span>; then get pointer in command buffer
<span style="color:black">SYSINIT:1AD2                 </span><span style="color:navy">inc     ax              </span>; skip left Parentheses
<span style="color:black">SYSINIT:1AD3                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], ax   </span>; [es:di+_$P_Result_Blk.Picked_Val]
<span style="color:black">SYSINIT:1AD3                                         </span>; store offset
<span style="color:black">SYSINIT:1AD7                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">6</span><span style="color:navy">], ds </span>; [es:di+_$P_Result_Blk.Picked_Val+2]
<span style="color:black">SYSINIT:1AD7                                         </span>; store segment
<span style="color:black">SYSINIT:1ADB                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_RLT_Exit
</span><span style="color:black">SYSINIT:1ADD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1ADD
SYSINIT:1ADD </span><span style="color:gray">_$P_RLT05</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1ADD                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">4</span><span style="color:navy">], si   </span>; AL = 3, 5, or 9
<span style="color:black">SYSINIT:1ADD                                         </span>; [es:di+_$P_Result_Blk.Picked_Val]
<span style="color:black">SYSINIT:1ADD                                         </span>; store offset of STRING_BUF
<span style="color:black">SYSINIT:1AE1                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">6</span><span style="color:navy">], cs </span>; [es:di+_$P_Result_Blk.Picked_Val+2]
<span style="color:black">SYSINIT:1AE1                                         </span>; store segment of STRING_BUF
<span style="color:black">SYSINIT:1AE5                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1AE6                 </span><span style="color:navy">test    byte ptr es:[bx+</span><span style="color:#ff8000">2</span><span style="color:navy">], </span><span style="color:green">1 </span>; [es:bx+_$P_Control_Blk.Function_Flag],
<span style="color:black">SYSINIT:1AE6                                         </span>; _$P_CAP_File
<span style="color:black">SYSINIT:1AE6                                         </span>; need CAPS by file table?
<span style="color:black">SYSINIT:1AEB                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_RLT_CAP00
</span><span style="color:black">SYSINIT:1AED                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">4           </span>; _$P_DOSTBL_File ; use file upper case table
<span style="color:black">SYSINIT:1AEF                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_RLT_CAP02
</span><span style="color:black">SYSINIT:1AF1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1AF1
SYSINIT:1AF1 </span><span style="color:gray">_$P_RLT_CAP00</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1AF1                 </span><span style="color:navy">test    byte ptr es:[bx+</span><span style="color:#ff8000">2</span><span style="color:navy">], </span><span style="color:green">2 </span>; [es:bx+_$P_Control_Blk.Function_Flag],
<span style="color:black">SYSINIT:1AF1                                         </span>; _$P_CAP_Char
<span style="color:black">SYSINIT:1AF1                                         </span>; need CAPS by char table
<span style="color:black">SYSINIT:1AF6                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_RLT_CAP01
</span><span style="color:black">SYSINIT:1AF8                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">2           </span>; _$P_DOSTBL_Char
<span style="color:black">SYSINIT:1AF8                                         </span>; use character upper case table
<span style="color:black">SYSINIT:1AFA
SYSINIT:1AFA </span><span style="color:gray">_$P_RLT_CAP02</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1AFA                 </span><span style="color:navy">call    </span>_$P_Do_CAPS_String ; process CAPS along the table
<span style="color:black">SYSINIT:1AFD
SYSINIT:1AFD </span><span style="color:gray">_$P_RLT_CAP01</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1AFD                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1AFE                 </span><span style="color:navy">test    byte ptr es:[bx+</span><span style="color:#ff8000">2</span><span style="color:navy">], </span><span style="color:green">10h </span>; [es:bx+_$P_Control_Blk.Function_Flag],
<span style="color:black">SYSINIT:1AFE                                         </span>; _$P_Rm_Colon
<span style="color:black">SYSINIT:1AFE                                         </span>; removing colon at end ?
<span style="color:black">SYSINIT:1B03                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_RLT_Exit
</span><span style="color:black">SYSINIT:1B05                 </span><span style="color:navy">call    </span>_$P_Remove_Colon ; then process it.
<span style="color:black">SYSINIT:1B08
SYSINIT:1B08 </span><span style="color:gray">_$P_RLT_Exit</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1B08                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:1B09                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1B09 </span>_$P_Fill_Result endp
<span style="color:black">SYSINIT:1B09
SYSINIT:1B0A
SYSINIT:1B0A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1B0A
SYSINIT:1B0A
SYSINIT:1B0A </span>_$P_Check_Match_Flags proc near         <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1B0A                 </span><span style="color:navy">mov     cs:</span>_$P_err_flag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; _$P_NULL ; clear filespec error flag.
<span style="color:black">SYSINIT:1B10                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1B11                 </span><span style="color:navy">mov     ax, es:[bx]     </span>; [es:bx+_$P_Control_Blk.Match_Flag]
<span style="color:black">SYSINIT:1B11                                         </span>; load match flag (16bit) to ax
<span style="color:black">SYSINIT:1B14                 </span><span style="color:navy">or      ax, ax          </span>; test ax for zero
<span style="color:black">SYSINIT:1B16                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Mat
</span><span style="color:black">SYSINIT:1B18                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1B19                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:1B1A                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1B1B                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:1B1C                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">9    </span>; _$P_Syntax
<span style="color:black">SYSINIT:1B23                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$P_No_Tag
<span style="color:black">SYSINIT:1B25                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3           </span>; _$P_String
<span style="color:black">SYSINIT:1B27                 </span><span style="color:navy">call    </span>_$P_Fill_Result
<span style="color:black">SYSINIT:1B2A                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:1B2B                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1B2C                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1B2D                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1B2E                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Bridge
</span><span style="color:black">SYSINIT:1B30 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1B30
SYSINIT:1B30 </span><span style="color:gray">_$P_Mat</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1B30                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Match03
</span><span style="color:black">SYSINIT:1B32 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1B32
SYSINIT:1B32 </span><span style="color:gray">_$P_Bridge</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1B32                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Match_Exit
</span><span style="color:black">SYSINIT:1B34 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1B34                 </span><span style="color:navy">nop                     </span>; 90h
<span style="color:black">SYSINIT:1B35
SYSINIT:1B35 </span><span style="color:gray">_$P_Match03</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1B35                 </span><span style="color:navy">test    ax, </span><span style="color:green">8000h       </span>; _$P_Num_Val ; Numeric value
<span style="color:black">SYSINIT:1B38                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Match04
</span><span style="color:black">SYSINIT:1B3A                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; _$P_No_Error ; assume no error
<span style="color:black">SYSINIT:1B41                 </span><span style="color:navy">call    </span>_$P_Value       ; do process
<span style="color:black">SYSINIT:1B44                 </span><span style="color:navy">cmp     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">9    </span>; _$P_Syntax ; if error, examine the next type
<span style="color:black">SYSINIT:1B4A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Match_Exit
</span><span style="color:black">SYSINIT:1B4C
SYSINIT:1B4C </span><span style="color:gray">_$P_Match04</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1B4C                 </span><span style="color:navy">test    ax, </span><span style="color:green">4000h       </span>; _$P_SNum_Val ; Signed numeric value
<span style="color:black">SYSINIT:1B4F                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Match05
</span><span style="color:black">SYSINIT:1B51                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; _$P_No_Error ; assume no error
<span style="color:black">SYSINIT:1B58                 </span><span style="color:navy">call    </span>_$P_SValue      ; do process
<span style="color:black">SYSINIT:1B5B                 </span><span style="color:navy">cmp     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">9    </span>; _$P_Syntax ; if error, examine the next type
<span style="color:black">SYSINIT:1B61                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Match_Exit
</span><span style="color:black">SYSINIT:1B63
SYSINIT:1B63 </span><span style="color:gray">_$P_Match05</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1B63                 </span><span style="color:navy">test    ax, </span><span style="color:green">100h        </span>; _$P_Drv_Only ; Drive only
<span style="color:black">SYSINIT:1B66                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Match06
</span><span style="color:black">SYSINIT:1B68                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; _$P_No_Error ; assume no error
<span style="color:black">SYSINIT:1B6F                 </span><span style="color:navy">call    </span>_$P_File_Format ; 1st, call file format
<span style="color:black">SYSINIT:1B72                 </span><span style="color:navy">call    </span>_$P_Drive_Format ; check drive format, next
<span style="color:black">SYSINIT:1B75                 </span><span style="color:navy">cmp     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">9    </span>; _$P_Syntax ; if error, examine the next type
<span style="color:black">SYSINIT:1B7B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Match_Exit
</span><span style="color:black">SYSINIT:1B7D
SYSINIT:1B7D </span><span style="color:gray">_$P_Match06</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1B7D                 </span><span style="color:navy">test    ax, </span><span style="color:green">200h        </span>; _$P_File_Spc ; File spec
<span style="color:black">SYSINIT:1B80                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Match07
</span><span style="color:black">SYSINIT:1B82                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; _$P_No_Error ; assume no error
<span style="color:black">SYSINIT:1B89                 </span><span style="color:navy">call    </span>_$P_File_Format ; do process
<span style="color:black">SYSINIT:1B8C                 </span><span style="color:navy">cmp     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">9    </span>; _$P_Syntax ; if error, examine the next type
<span style="color:black">SYSINIT:1B92                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Match_Exit
</span><span style="color:black">SYSINIT:1B94
SYSINIT:1B94 </span><span style="color:gray">_$P_Match07</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1B94                 </span><span style="color:navy">test    ax, </span><span style="color:green">2000h       </span>; _$P_Simple_S ; Simple string
<span style="color:black">SYSINIT:1B97                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Match_Exit
</span><span style="color:black">SYSINIT:1B99                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; _$P_No_Error ; assume no error
<span style="color:black">SYSINIT:1BA0                 </span><span style="color:navy">call    </span>_$P_Simple_String ; do process
<span style="color:black">SYSINIT:1BA3
SYSINIT:1BA3 </span><span style="color:gray">_$P_Match_Exit</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BA3                 </span><span style="color:navy">cmp     cs:</span>_$P_err_flag<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; _$P_error_filespec ; bad filespec ?
<span style="color:black">SYSINIT:1BA9                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Match2_Exit </span>; no, continue
<span style="color:black">SYSINIT:1BAB                 </span><span style="color:navy">cmp     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; _$P_No_Error ; check for other errors ?
<span style="color:black">SYSINIT:1BB1                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Match2_Exit </span>; no, continue
<span style="color:black">SYSINIT:1BB3                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">9    </span>; _$P_Syntax ; set error flag
<span style="color:black">SYSINIT:1BBA
SYSINIT:1BBA </span><span style="color:gray">_$P_Match2_Exit</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BBA                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1BBB                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1BBB </span>_$P_Check_Match_Flags endp
<span style="color:black">SYSINIT:1BBB
SYSINIT:1BBC
SYSINIT:1BBC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1BBC
SYSINIT:1BBC
SYSINIT:1BBC </span>_$P_Remove_Colon proc near              <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BBC                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1BBD                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:1BBE
SYSINIT:1BBE </span><span style="color:gray">_$P_RCOL_Loop</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BBE                 </span><span style="color:navy">mov     al, cs:[si]     </span>; get character
<span style="color:black">SYSINIT:1BC1                 </span><span style="color:navy">or      al, al          </span>; end of string ?
<span style="color:black">SYSINIT:1BC3                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_RCOL_Exit </span>; if yes, just exit
<span style="color:black">SYSINIT:1BC5                 </span><span style="color:navy">cmp     al, &#039;</span><span style="color:green">:&#039;         </span>; _$P_Colon ; is it colon ?
<span style="color:black">SYSINIT:1BC7                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_RCOL00
</span><span style="color:black">SYSINIT:1BC9                 </span><span style="color:navy">cmp     byte ptr cs:[si+</span><span style="color:#ff8000">1</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; _$P_NULL
<span style="color:black">SYSINIT:1BC9                                         </span>; if so, next is NULL ?
<span style="color:black">SYSINIT:1BCE                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_RCOL00
</span><span style="color:black">SYSINIT:1BD0                 </span><span style="color:navy">mov     byte ptr cs:[si], </span><span style="color:#ff8000">0 </span>; _$P_NULL ; yes, remove colon
<span style="color:black">SYSINIT:1BD4                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_RCOL_Exit </span>; and exit.
<span style="color:black">SYSINIT:1BD6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1BD6
SYSINIT:1BD6 </span><span style="color:gray">_$P_RCOL00</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BD6                 </span><span style="color:navy">call    </span>_$P_Chk_DBCS    ; if not colon, then check if
<span style="color:black">SYSINIT:1BD6                                         </span>; DBCS leading byte.
<span style="color:black">SYSINIT:1BD9                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_RCOL01
</span><span style="color:black">SYSINIT:1BDB                 </span><span style="color:navy">inc     si              </span>; if yes, skip trailing byte
<span style="color:black">SYSINIT:1BDC
SYSINIT:1BDC </span><span style="color:gray">_$P_RCOL01</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BDC                 </span><span style="color:navy">inc     si              </span>; si points to next byte
<span style="color:black">SYSINIT:1BDD                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_RCOL_Loop </span>; loop until NULL encountered
<span style="color:black">SYSINIT:1BDF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1BDF
SYSINIT:1BDF </span><span style="color:gray">_$P_RCOL_Exit</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BDF                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:1BE0                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1BE1                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1BE1 </span>_$P_Remove_Colon endp
<span style="color:black">SYSINIT:1BE1
SYSINIT:1BE2
SYSINIT:1BE2 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1BE2
SYSINIT:1BE2
SYSINIT:1BE2 </span>_$P_Do_CAPS_String proc near            <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BE2                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:1BE3                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1BE4                 </span><span style="color:navy">mov     dl, al          </span>; save info id
<span style="color:black">SYSINIT:1BE6
SYSINIT:1BE6 </span><span style="color:gray">_$P_DCS_Loop</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BE6                 </span><span style="color:navy">mov     al, cs:[si]     </span>; load charater and
<span style="color:black">SYSINIT:1BE9                 </span><span style="color:navy">call    </span>_$P_Chk_DBCS    ; check if DBCS leading byte
<span style="color:black">SYSINIT:1BEC                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_DCS00 </span>; if yes, do not need CAPS
<span style="color:black">SYSINIT:1BEE                 </span><span style="color:navy">or      al, al          </span>; end of string ?
<span style="color:black">SYSINIT:1BF0                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_DCS_Exit </span>; then exit.
<span style="color:black">SYSINIT:1BF2                 </span><span style="color:navy">call    </span>_$P_Do_CAPS_Char ; Here a SBCS char need to be CAPS
<span style="color:black">SYSINIT:1BF5                 </span><span style="color:navy">mov     cs:[si], al     </span>; stored upper case char to buffer
<span style="color:black">SYSINIT:1BF8                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_DCS01 </span>; process next
<span style="color:black">SYSINIT:1BFA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1BFA
SYSINIT:1BFA </span><span style="color:gray">_$P_DCS00</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BFA                 </span><span style="color:navy">inc     si              </span>; skip DBCS leading and trailing byte
<span style="color:black">SYSINIT:1BFB
SYSINIT:1BFB </span><span style="color:gray">_$P_DCS01</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BFB                 </span><span style="color:navy">inc     si              </span>; si points to next byte
<span style="color:black">SYSINIT:1BFC                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_DCS_Loop </span>; loop until NULL encountered
<span style="color:black">SYSINIT:1BFE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1BFE
SYSINIT:1BFE </span><span style="color:gray">_$P_DCS_Exit</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1BFE                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1BFF                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:1C00                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1C00 </span>_$P_Do_CAPS_String endp
<span style="color:black">SYSINIT:1C00
SYSINIT:1C01
SYSINIT:1C01 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1C01
SYSINIT:1C01
SYSINIT:1C01 </span>_$P_Do_CAPS_Char proc near              <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1C01                 </span><span style="color:navy">cmp     al, </span><span style="color:green">80h         </span>; _$P_ASCII80 ; need upper case table ?
<span style="color:black">SYSINIT:1C03                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_DCC_Go </span>; no
<span style="color:black">SYSINIT:1C05                 </span><span style="color:navy">cmp     al, &#039;</span><span style="color:green">a&#039;         </span>; check if  &quot;a&quot; &lt;= AL &lt;= &quot;z&quot;
<span style="color:black">SYSINIT:1C07                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_CAPS_Ret
</span><span style="color:black">SYSINIT:1C09                 </span><span style="color:navy">cmp     al, &#039;</span><span style="color:green">z&#039;
</span><span style="color:black">SYSINIT:1C0B                 </span><span style="color:navy">ja      short </span><span style="color:gray">_$P_CAPS_Ret
</span><span style="color:black">SYSINIT:1C0D                 </span><span style="color:navy">and     al, </span><span style="color:green">0DFh        </span>; _$P_Make_Upper ; make CAPS
<span style="color:black">SYSINIT:1C0F                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_CAPS_Ret
</span><span style="color:black">SYSINIT:1C11 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1C11
SYSINIT:1C11 </span><span style="color:gray">_$P_DCC_Go</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1C11                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:1C12                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:1C13                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:1C14                 </span><span style="color:navy">lea     di, </span>_$P_Char_CAP_Ptr ; or use char CAPS table ?
<span style="color:black">SYSINIT:1C18                 </span><span style="color:navy">cmp     cs:[di], dl     </span>; already got table address ?
<span style="color:black">SYSINIT:1C1B                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_DCC01 </span>; no
<span style="color:black">SYSINIT:1C1D                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1C1E                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:1C1F                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1C20                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:1C21                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:1C22                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:1C22                 </span><span style="color:navy">mov     ah, </span><span style="color:green">65h         </span>; _$P_DOS_Get_TBL
<span style="color:black">SYSINIT:1C24                 </span><span style="color:navy">mov     al, dl          </span>; function
<span style="color:black">SYSINIT:1C26                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh      </span>; _$P_DOSTBL_Def = -1
<span style="color:black">SYSINIT:1C29                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">5           </span>; _$P_DOSTBL_BL
<span style="color:black">SYSINIT:1C2C                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0FFFFh      </span>; _$P_DOSTBL_Def
<span style="color:black">SYSINIT:1C2F                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 4.x internal
<span style="color:black">SYSINIT:1C2F                                         </span>; COUNTRY-DEPENDENT FILENAME CAPITALIZATION
<span style="color:black">SYSINIT:1C2F                                         </span>; AL = function -
<span style="color:black">SYSINIT:1C2F                                         </span>;
<span style="color:black">SYSINIT:1C2F                                         </span>; DI already set to point to buffer
<span style="color:black">SYSINIT:1C31                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1C32                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:1C33                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1C34
SYSINIT:1C34 </span><span style="color:gray">_$P_DCC01</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1C34                 </span><span style="color:navy">mov     bx, cs:[di+</span><span style="color:#ff8000">1</span><span style="color:navy">]   </span>; [cs:di+_$P_DOS_TBL.Off]
<span style="color:black">SYSINIT:1C34                                         </span>; get offset of table
<span style="color:black">SYSINIT:1C38                 </span><span style="color:navy">mov     es, word ptr cs:[di+</span><span style="color:#ff8000">3</span><span style="color:navy">] </span>; [cs:di+_$P_DOS_TBL.Seg]
<span style="color:black">SYSINIT:1C38                                         </span>; get segment of table
<span style="color:black">SYSINIT:1C3C                 </span>assume es:nothing
<span style="color:black">SYSINIT:1C3C                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:1C3D                 </span><span style="color:navy">inc     bx              </span>; add 2 to bx reg
<span style="color:black">SYSINIT:1C3E                 </span><span style="color:navy">sub     al, </span><span style="color:green">80h         </span>; _$P_ASCII80 ; make char to index
<span style="color:black">SYSINIT:1C40                 </span><span style="color:navy">xlat    byte ptr es:[bx] </span>; perform case map
<span style="color:black">SYSINIT:1C42                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:1C43                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:1C44                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1C45
SYSINIT:1C45 </span><span style="color:gray">_$P_CAPS_Ret</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1C45                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1C45 </span>_$P_Do_CAPS_Char endp
<span style="color:black">SYSINIT:1C45
SYSINIT:1C46
SYSINIT:1C46 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1C46
SYSINIT:1C46
SYSINIT:1C46 </span>_$P_SValue      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1C46                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1C47                 </span><span style="color:navy">or      cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">80h </span>; _$P_Signed ; indicate a signed numeric
<span style="color:black">SYSINIT:1C4D                 </span><span style="color:navy">and     cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">0FDh </span>; 0FFh-_$P_Neg ; assume positive value
<span style="color:black">SYSINIT:1C4D                                         </span>; and byte [cs:$_Flags2],~_$P_Neg ; ~2
<span style="color:black">SYSINIT:1C53                 </span><span style="color:navy">mov     al, cs:[si]     </span>; get sign
<span style="color:black">SYSINIT:1C56                 </span><span style="color:navy">cmp     al, &#039;</span><span style="color:green">+&#039;         </span>; _$P_Plus
<span style="color:black">SYSINIT:1C58                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_SVal00
</span><span style="color:black">SYSINIT:1C5A                 </span><span style="color:navy">cmp     al, &#039;</span><span style="color:green">-&#039;         </span>; _$P_Minus
<span style="color:black">SYSINIT:1C5C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Sval01
</span><span style="color:black">SYSINIT:1C5E                 </span><span style="color:navy">or      cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">2 </span>; _$P_Neg
<span style="color:black">SYSINIT:1C5E                                         </span>; set this is negative value
<span style="color:black">SYSINIT:1C64
SYSINIT:1C64 </span><span style="color:gray">_$P_SVal00</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1C64                 </span><span style="color:navy">inc     si              </span>; skip sign char
<span style="color:black">SYSINIT:1C65
SYSINIT:1C65 </span><span style="color:gray">_$P_Sval01</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1C65                 </span><span style="color:navy">call    </span>_$P_Value       ; and process value
<span style="color:black">SYSINIT:1C68                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1C69                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1C69 </span>_$P_SValue      endp
<span style="color:black">SYSINIT:1C69
SYSINIT:1C6A
SYSINIT:1C6A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1C6A
SYSINIT:1C6A
SYSINIT:1C6A </span>_$P_Value       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1C6A                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1C6B                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:1C6C                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1C6D                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:1C6E                 </span><span style="color:navy">xor     cx, cx          </span>; cx = higher 16 bits
<span style="color:black">SYSINIT:1C70                 </span><span style="color:navy">xor     dx, dx          </span>; dx = lower 16 bits
<span style="color:black">SYSINIT:1C72                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:1C73
SYSINIT:1C73 </span><span style="color:gray">_$P_Value_Loop</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1C73                 </span><span style="color:navy">mov     al, cs:[si]     </span>; get character
<span style="color:black">SYSINIT:1C76                 </span><span style="color:navy">or      al, al          </span>; end of line ?
<span style="color:black">SYSINIT:1C78                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Value00
</span><span style="color:black">SYSINIT:1C7A                 </span><span style="color:navy">call    </span>_$P_0099        ; make asc(0..9) to bin(0..9)
<span style="color:black">SYSINIT:1C7D                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Value_Err0 </span>; then error, exit
<span style="color:black">SYSINIT:1C7F                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">SYSINIT:1C81                 </span><span style="color:navy">mov     bp, ax          </span>; save binary number
<span style="color:black">SYSINIT:1C83                 </span><span style="color:navy">shl     dx, </span><span style="color:green">1           </span>; to have 2*x
<span style="color:black">SYSINIT:1C85                 </span><span style="color:navy">rcl     cx, </span><span style="color:green">1           </span>; shift left w/ carry
<span style="color:black">SYSINIT:1C87                 </span><span style="color:navy">call    </span>_$P_Check_OVF   ; Overflow occurred ?
<span style="color:black">SYSINIT:1C8A                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Value_Err0 </span>; then error, exit
<span style="color:black">SYSINIT:1C8C                 </span><span style="color:navy">mov     bx, dx          </span>; save low(2*x)
<span style="color:black">SYSINIT:1C8E                 </span><span style="color:navy">mov     ax, cx          </span>; save high(2*x)
<span style="color:black">SYSINIT:1C90                 </span><span style="color:navy">shl     dx, </span><span style="color:green">1           </span>; to have 4*x
<span style="color:black">SYSINIT:1C92                 </span><span style="color:navy">rcl     cx, </span><span style="color:green">1           </span>; shift left w/ carry
<span style="color:black">SYSINIT:1C94                 </span><span style="color:navy">call    </span>_$P_Check_OVF   ; Overflow occurred ?
<span style="color:black">SYSINIT:1C97                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Value_Err0 </span>; then error, exit
<span style="color:black">SYSINIT:1C99                 </span><span style="color:navy">shl     dx, </span><span style="color:green">1           </span>; to have 8*x
<span style="color:black">SYSINIT:1C9B                 </span><span style="color:navy">rcl     cx, </span><span style="color:green">1           </span>; shift left w/ carry
<span style="color:black">SYSINIT:1C9D                 </span><span style="color:navy">call    </span>_$P_Check_OVF
<span style="color:black">SYSINIT:1CA0                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Value_Err0
</span><span style="color:black">SYSINIT:1CA2                 </span><span style="color:navy">add     dx, bx          </span>; now have 10*x
<span style="color:black">SYSINIT:1CA4                 </span><span style="color:navy">adc     cx, ax          </span>; 32bit ADD
<span style="color:black">SYSINIT:1CA6                 </span><span style="color:navy">call    </span>_$P_Check_OVF   ; Overflow occurred ?
<span style="color:black">SYSINIT:1CA9                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Value_Err0 </span>; then error, exit
<span style="color:black">SYSINIT:1CAB                 </span><span style="color:navy">add     dx, bp          </span>; Add the current one degree decimal
<span style="color:black">SYSINIT:1CAD                 </span><span style="color:navy">adc     cx, </span><span style="color:#ff8000">0           </span>; if carry, add 1 to high 16bit
<span style="color:black">SYSINIT:1CB0                 </span><span style="color:navy">call    </span>_$P_Check_OVF   ; Overflow occurred ?
<span style="color:black">SYSINIT:1CB3                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Value_Err0 </span>; then error, exit
<span style="color:black">SYSINIT:1CB5                 </span><span style="color:navy">inc     si              </span>; update pointer
<span style="color:black">SYSINIT:1CB6                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Value_Loop </span>; loop until NULL encountered
<span style="color:black">SYSINIT:1CB8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1CB8
SYSINIT:1CB8 </span><span style="color:gray">_$P_Value_Err0</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1CB8                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1CB9                 </span><span style="color:navy">jmp     </span><span style="color:gray">_$P_Value_Err   </span>; bridge
<span style="color:black">SYSINIT:1CBC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1CBC
SYSINIT:1CBC </span><span style="color:gray">_$P_Value00</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1CBC                 </span><span style="color:navy">pop     bx              </span>; restore control pointer
<span style="color:black">SYSINIT:1CBC                                         </span>; here cx,dx = 32bit value
<span style="color:black">SYSINIT:1CBD                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">2 </span>; _$P_Neg ; was it negative ?
<span style="color:black">SYSINIT:1CC3                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Value01
</span><span style="color:black">SYSINIT:1CC5                 </span><span style="color:navy">not     cx              </span>; | Make 2&#039;s complement
<span style="color:black">SYSINIT:1CC7                 </span><span style="color:navy">not     dx              </span>; |
<span style="color:black">SYSINIT:1CC9                 </span><span style="color:navy">add     dx, </span><span style="color:#ff8000">1           </span>; |
<span style="color:black">SYSINIT:1CCC                 </span><span style="color:navy">adc     cx, </span><span style="color:#ff8000">0           </span>; |
<span style="color:black">SYSINIT:1CCF
SYSINIT:1CCF </span><span style="color:gray">_$P_Value01</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1CCF                 </span><span style="color:navy">mov     si, es:[bx+</span><span style="color:#ff8000">6</span><span style="color:navy">]   </span>; [es:bx+_$P_Control_Blk.Value_List]
<span style="color:black">SYSINIT:1CCF                                         </span>; si points to value list
<span style="color:black">SYSINIT:1CD3                 </span><span style="color:navy">mov     al, es:[si]     </span>; get nval
<span style="color:black">SYSINIT:1CD6                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0           </span>; _$P_nval_None ; no value list ?
<span style="color:black">SYSINIT:1CD8                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Value02
</span><span style="color:black">SYSINIT:1CDA                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1           </span>; _$P_Number ; Set type
<span style="color:black">SYSINIT:1CDC                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$P_No_Tag ; No ITEM_TAG set
<span style="color:black">SYSINIT:1CDE                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Value_Exit
</span><span style="color:black">SYSINIT:1CE0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1CE0                 </span><span style="color:navy">nop                     </span>; 90h
<span style="color:black">SYSINIT:1CE1
SYSINIT:1CE1 </span><span style="color:gray">_$P_Value02</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1CE1                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:1CE2                 </span><span style="color:navy">mov     al, es:[si]     </span>; al = number of range
<span style="color:black">SYSINIT:1CE5                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0           </span>; _$P_No_nrng
<span style="color:black">SYSINIT:1CE7                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Value_Err </span>; _$P_Value03
<span style="color:black">SYSINIT:1CE9                 </span><span style="color:navy">inc     si              </span>; si points to 1st item_tag
<span style="color:black">SYSINIT:1CEA
SYSINIT:1CEA </span><span style="color:gray">_$P_Val02_Loop</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1CEA                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">80h </span>; _$P_Signed
<span style="color:black">SYSINIT:1CF0                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Val02_Sign
</span><span style="color:black">SYSINIT:1CF2                 </span><span style="color:navy">cmp     cx, es:[si+</span><span style="color:#ff8000">3</span><span style="color:navy">]   </span>; [es:si+_$P_Val_List.Val_XH]
<span style="color:black">SYSINIT:1CF2                                         </span>; comp cx with XH
<span style="color:black">SYSINIT:1CF6                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Val02_Next
</span><span style="color:black">SYSINIT:1CF8                 </span><span style="color:navy">ja      short </span><span style="color:gray">_$P_Val_In
</span><span style="color:black">SYSINIT:1CFA                 </span><span style="color:navy">cmp     dx, es:[si+</span><span style="color:#ff8000">1</span><span style="color:navy">]   </span>; [es:si+_$P_Val_List.Val_XL]
<span style="color:black">SYSINIT:1CFA                                         </span>; comp dx with XL
<span style="color:black">SYSINIT:1CFE                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Val02_Next
</span><span style="color:black">SYSINIT:1D00
SYSINIT:1D00 </span><span style="color:gray">_$P_Val_In</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D00                 </span><span style="color:navy">cmp     cx, es:[si+</span><span style="color:#ff8000">7</span><span style="color:navy">]   </span>; [es:si+_$P_Val_List.Val_YH]
<span style="color:black">SYSINIT:1D00                                         </span>; comp cx with YH
<span style="color:black">SYSINIT:1D04                 </span><span style="color:navy">ja      short </span><span style="color:gray">_$P_Val02_Next
</span><span style="color:black">SYSINIT:1D06                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Val_Found
</span><span style="color:black">SYSINIT:1D08                 </span><span style="color:navy">cmp     dx, es:[si+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; [es:si+_$P_Val_List.Val_YL]
<span style="color:black">SYSINIT:1D08                                         </span>; comp dx with YL
<span style="color:black">SYSINIT:1D0C                 </span><span style="color:navy">ja      short </span><span style="color:gray">_$P_Val02_Next
</span><span style="color:black">SYSINIT:1D0E                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Val_Found
</span><span style="color:black">SYSINIT:1D10 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1D10
SYSINIT:1D10 </span><span style="color:gray">_$P_Val02_Sign</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D10                 </span><span style="color:navy">cmp     cx, es:[si+</span><span style="color:#ff8000">3</span><span style="color:navy">]   </span>; [es:si+_$P_Val_List.Val_XH]
<span style="color:black">SYSINIT:1D10                                         </span>; comp cx with XH
<span style="color:black">SYSINIT:1D14                 </span><span style="color:navy">jl      short </span><span style="color:gray">_$P_Val02_Next
</span><span style="color:black">SYSINIT:1D16                 </span><span style="color:navy">jg      short </span><span style="color:gray">_$P_SVal_In
</span><span style="color:black">SYSINIT:1D18                 </span><span style="color:navy">cmp     dx, es:[si+</span><span style="color:#ff8000">1</span><span style="color:navy">]   </span>; [es:si+_$P_Val_List.Val_XL]
<span style="color:black">SYSINIT:1D18                                         </span>; comp dx with XL
<span style="color:black">SYSINIT:1D1C                 </span><span style="color:navy">jl      short </span><span style="color:gray">_$P_Val02_Next
</span><span style="color:black">SYSINIT:1D1E
SYSINIT:1D1E </span><span style="color:gray">_$P_SVal_In</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D1E                 </span><span style="color:navy">cmp     cx, es:[si+</span><span style="color:#ff8000">7</span><span style="color:navy">]   </span>; [es:si+_$P_Val_List.Val_YH]
<span style="color:black">SYSINIT:1D1E                                         </span>; comp cx with YH
<span style="color:black">SYSINIT:1D22                 </span><span style="color:navy">jg      short </span><span style="color:gray">_$P_Val02_Next
</span><span style="color:black">SYSINIT:1D24                 </span><span style="color:navy">jl      short </span><span style="color:gray">_$P_Val_Found
</span><span style="color:black">SYSINIT:1D26                 </span><span style="color:navy">cmp     dx, es:[si+</span><span style="color:#ff8000">5</span><span style="color:navy">]   </span>; [es:si+_$P_Val_List.Val_YL]
<span style="color:black">SYSINIT:1D26                                         </span>; comp dx with YL
<span style="color:black">SYSINIT:1D2A                 </span><span style="color:navy">jg      short </span><span style="color:gray">_$P_Val02_Next
</span><span style="color:black">SYSINIT:1D2C                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Val_Found
</span><span style="color:black">SYSINIT:1D2E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1D2E
SYSINIT:1D2E </span><span style="color:gray">_$P_Val02_Next</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D2E                 </span><span style="color:navy">add     si, </span><span style="color:#ff8000">9           </span>; _$P_Len_Range
<span style="color:black">SYSINIT:1D31                 </span><span style="color:navy">dec     al              </span>; loop nrng times in AL
<span style="color:black">SYSINIT:1D33                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Val02_Loop
</span><span style="color:black">SYSINIT:1D35                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">6    </span>; _$P_Out_Of_Range
<span style="color:black">SYSINIT:1D3C                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1           </span>; _$P_Number
<span style="color:black">SYSINIT:1D3E                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$P_No_Tag
<span style="color:black">SYSINIT:1D40                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Value_Exit
</span><span style="color:black">SYSINIT:1D42 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1D42
SYSINIT:1D42 </span><span style="color:gray">_$P_Val_Found</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D42                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1           </span>; _$P_Number
<span style="color:black">SYSINIT:1D44                 </span><span style="color:navy">mov     ah, es:[si]     </span>; found ITEM_TAG set
<span style="color:black">SYSINIT:1D47                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Value_Exit
</span><span style="color:black">SYSINIT:1D49 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1D49
SYSINIT:1D49 </span><span style="color:gray">_$P_Value_Err</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D49                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">9    </span>; _$P_Syntax
<span style="color:black">SYSINIT:1D50                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3           </span>; _$P_String ; Set type
<span style="color:black">SYSINIT:1D52                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$P_No_Tag ; No ITEM_TAG set
<span style="color:black">SYSINIT:1D54
SYSINIT:1D54 </span><span style="color:gray">_$P_Value_Exit</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D54                 </span><span style="color:navy">call    </span>_$P_Fill_Result
<span style="color:black">SYSINIT:1D57                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:1D58                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1D59                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:1D5A                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1D5B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1D5B </span>_$P_Value       endp
<span style="color:black">SYSINIT:1D5B
SYSINIT:1D5C
SYSINIT:1D5C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1D5C
SYSINIT:1D5C
SYSINIT:1D5C </span>_$P_Check_OVF   proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D5C                 </span><span style="color:navy">pushf
</span><span style="color:black">SYSINIT:1D5D                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">2 </span>; _$P_Neg ; is it negative value ?
<span style="color:black">SYSINIT:1D63                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_COVF
</span><span style="color:black">SYSINIT:1D65                 </span><span style="color:navy">popf                    </span>; if no, check overflow by the CY bit
<span style="color:black">SYSINIT:1D66                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1D67 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1D67
SYSINIT:1D67 </span><span style="color:gray">_$P_COVF</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D67                 </span><span style="color:navy">popf                    </span>; else, check overflow by the OF
<span style="color:black">SYSINIT:1D68                 </span><span style="color:navy">jo      short </span><span style="color:gray">_$P_COVF00
</span><span style="color:black">SYSINIT:1D6A                 </span><span style="color:navy">clc                     </span>; indicate it with CY bit
<span style="color:black">SYSINIT:1D6A                                         </span>; CY=0 means no overflow
<span style="color:black">SYSINIT:1D6B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1D6C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1D6C
SYSINIT:1D6C </span><span style="color:gray">_$P_COVF00</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D6C                 </span><span style="color:navy">stc                     </span>; and CY=1 means overflow
<span style="color:black">SYSINIT:1D6D                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1D6D </span>_$P_Check_OVF   endp
<span style="color:black">SYSINIT:1D6D
SYSINIT:1D6E
SYSINIT:1D6E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1D6E
SYSINIT:1D6E
SYSINIT:1D6E </span>_$P_0099        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D6E                 </span><span style="color:navy">cmp     al, &#039;</span><span style="color:green">0&#039;         </span>; must be 0 =&lt; al =&lt; 9
<span style="color:black">SYSINIT:1D70                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_0099Err
</span><span style="color:black">SYSINIT:1D72                 </span><span style="color:navy">cmp     al, &#039;</span><span style="color:green">9&#039;
</span><span style="color:black">SYSINIT:1D74                 </span><span style="color:navy">ja      short </span><span style="color:gray">_$P_0099Err
</span><span style="color:black">SYSINIT:1D76                 </span><span style="color:navy">sub     al, &#039;</span><span style="color:green">0&#039;         </span>; sub al,30h ; make char -&gt; bin
<span style="color:black">SYSINIT:1D78                 </span><span style="color:navy">clc                     </span>; indicate no error
<span style="color:black">SYSINIT:1D78                                         </span>; (clc is not required here, cf=0)
<span style="color:black">SYSINIT:1D79                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1D7A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1D7A
SYSINIT:1D7A </span><span style="color:gray">_$P_0099Err</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D7A                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:1D7B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1D7B </span>_$P_0099        endp
<span style="color:black">SYSINIT:1D7B
SYSINIT:1D7C
SYSINIT:1D7C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1D7C
SYSINIT:1D7C
SYSINIT:1D7C </span>_$P_Simple_String proc near             <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D7C                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1D7D                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:1D7E                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1D7F                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:1D80                 </span><span style="color:navy">mov     di, es:[bx+</span><span style="color:#ff8000">6</span><span style="color:navy">]   </span>; [es:bx+_$P_Control_Blk.Value_List]
<span style="color:black">SYSINIT:1D80                                         </span>; di points to value list
<span style="color:black">SYSINIT:1D84                 </span><span style="color:navy">mov     al, es:[di]     </span>; get nval
<span style="color:black">SYSINIT:1D87                 </span><span style="color:navy">or      al, al          </span>; no value list ?
<span style="color:black">SYSINIT:1D89                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Sim00
</span><span style="color:black">SYSINIT:1D8B                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$P_No_Tag ; then, No ITEM_TAG set
<span style="color:black">SYSINIT:1D8D                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Sim_Exit </span>; and set result buffer
<span style="color:black">SYSINIT:1D8F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1D8F
SYSINIT:1D8F </span><span style="color:gray">_$P_Sim00</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1D8F                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3           </span>; Check if keyword or value list id #3 is supported
<span style="color:black">SYSINIT:1D8F                                         </span>; _$P_nval_String ; String choice list provided ?
<span style="color:black">SYSINIT:1D91                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Sim01 </span>; if no, syntax error
<span style="color:black">SYSINIT:1D93                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:1D94                 </span><span style="color:navy">mov     al, es:[di]     </span>; al = nrng
<span style="color:black">SYSINIT:1D97                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">9           </span>; _$P_Len_Range
<span style="color:black">SYSINIT:1D99                 </span><span style="color:navy">mul     ah              </span>; Skip nrng field
<span style="color:black">SYSINIT:1D9B                 </span><span style="color:navy">inc     ax              </span>; ax = (nrng*9)+1
<span style="color:black">SYSINIT:1D9C                 </span><span style="color:navy">add     di, ax          </span>; di points to nnval
<span style="color:black">SYSINIT:1D9E                 </span><span style="color:navy">mov     al, es:[di]     </span>; get nnval
<span style="color:black">SYSINIT:1DA1                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">5           </span>; _$P_Len_Value
<span style="color:black">SYSINIT:1DA3                 </span><span style="color:navy">mul     ah              </span>; skip nnval field
<span style="color:black">SYSINIT:1DA5                 </span><span style="color:navy">inc     ax              </span>; ax = (nnval*5)+1
<span style="color:black">SYSINIT:1DA6                 </span><span style="color:navy">add     di, ax          </span>; di points to nstrval
<span style="color:black">SYSINIT:1DA8                 </span><span style="color:navy">mov     al, es:[di]     </span>; get nstrval c
<span style="color:black">SYSINIT:1DAB                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:1DAC                 </span><span style="color:navy">inc     di              </span>; add &#039;2&#039; to di reg
<span style="color:black">SYSINIT:1DAC                                         </span>; di points to 1st string in list
<span style="color:black">SYSINIT:1DAD
SYSINIT:1DAD </span><span style="color:gray">_$P_Sim_Loop</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1DAD                 </span><span style="color:navy">mov     bp, es:[di]     </span>; get string pointer
<span style="color:black">SYSINIT:1DB0                 </span><span style="color:navy">call    </span>_$P_String_Comp ; compare it with operand
<span style="color:black">SYSINIT:1DB3                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_Sim_Found </span>; found on list
<span style="color:black">SYSINIT:1DB5                 </span><span style="color:navy">add     di, </span><span style="color:#ff8000">3           </span>; _$P_Len_String ; if no, point to next choice
<span style="color:black">SYSINIT:1DB8                 </span><span style="color:navy">dec     al              </span>; loop nstval times in AL
<span style="color:black">SYSINIT:1DBA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Sim_Loop
</span><span style="color:black">SYSINIT:1DBC                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">8    </span>; / Not found ; _$P_Not_In_Str
<span style="color:black">SYSINIT:1DC3                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$P_No_Tag  ; No ITEM_TAG set
<span style="color:black">SYSINIT:1DC5                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Sim_Exit
</span><span style="color:black">SYSINIT:1DC7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1DC7
SYSINIT:1DC7 </span><span style="color:gray">_$P_Sim_Found</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1DC7                 </span><span style="color:navy">mov     ah, es:[di-</span><span style="color:green">1</span><span style="color:navy">]   </span>; set item_tag
<span style="color:black">SYSINIT:1DCB                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">2           </span>; _$P_List_Idx
<span style="color:black">SYSINIT:1DCD                 </span><span style="color:navy">mov     dx, es:[di]     </span>; get address of STRING
<span style="color:black">SYSINIT:1DD0                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Sim_Exit0
</span><span style="color:black">SYSINIT:1DD2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1DD2
SYSINIT:1DD2 </span><span style="color:gray">_$P_Sim01</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1DD2                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">9    </span>; _$P_Syntax
<span style="color:black">SYSINIT:1DD9                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$P_No_Tag
<span style="color:black">SYSINIT:1DDB
SYSINIT:1DDB </span><span style="color:gray">_$P_Sim_Exit</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1DDB                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3           </span>; _$P_String ; Set type
<span style="color:black">SYSINIT:1DDD
SYSINIT:1DDD </span><span style="color:gray">_$P_Sim_Exit0</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1DDD                 </span><span style="color:navy">call    </span>_$P_Fill_Result
<span style="color:black">SYSINIT:1DE0                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:1DE1                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1DE2                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1DE3                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1DE4                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1DE4 </span>_$P_Simple_String endp
<span style="color:black">SYSINIT:1DE4
SYSINIT:1DE5
SYSINIT:1DE5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1DE5
SYSINIT:1DE5
SYSINIT:1DE5 </span>_$P_String_Comp proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1DE5                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1DE6                 </span><span style="color:navy">push    bp
</span><span style="color:black">SYSINIT:1DE7                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1DE8                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:1DE9                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">2           </span>; _$P_DOSTBL_Char ; use character case map table
<span style="color:black">SYSINIT:1DEB
SYSINIT:1DEB </span><span style="color:gray">_$P_SCOM_Loop</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1DEB                 </span><span style="color:navy">mov     al, cs:[si]     </span>; get command character
<span style="color:black">SYSINIT:1DEE                 </span><span style="color:navy">call    </span>_$P_Chk_DBCS    ; DBCS ?
<span style="color:black">SYSINIT:1DF1                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_SCOM00 </span>; yes
<span style="color:black">SYSINIT:1DF3                 </span><span style="color:navy">call    </span>_$P_Do_CAPS_Char ; else, upper case map before comparison
<span style="color:black">SYSINIT:1DF6                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">8 </span>; Check if keyword or switch is supported
<span style="color:black">SYSINIT:1DF6                                         </span>; _$P_Key_Cmp ; keyword search ?
<span style="color:black">SYSINIT:1DFC                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_SCOM04
</span><span style="color:black">SYSINIT:1DFE                 </span><span style="color:navy">cmp     al, &#039;</span><span style="color:green">=&#039;         </span>; _$P_Keyword  ; &quot;=&quot; is delimiter
<span style="color:black">SYSINIT:1E00                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_SCOM03 </span>; IF &quot;=&quot; on command line AND
<span style="color:black">SYSINIT:1E00                                         </span>; (bp+1=&gt; char after the &quot;=&quot; in synonym list)
<span style="color:black">SYSINIT:1E02                 </span><span style="color:navy">cmp     byte ptr es:[bp+</span><span style="color:#ff8000">1</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; _$P_NULL ; at end of keyword string
<span style="color:black">SYSINIT:1E02                                         </span>;                  in the control block THEN
<span style="color:black">SYSINIT:1E07                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_SCOM_Differ
</span><span style="color:black">SYSINIT:1E09                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_SCOM05 </span>; keyword found in synonym list
<span style="color:black">SYSINIT:1E0B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1E0B
SYSINIT:1E0B </span><span style="color:gray">_$P_SCOM04</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E0B                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">10h </span>; _$P_SW_Cmp ; switch search ?
<span style="color:black">SYSINIT:1E11                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_SCOM03
</span><span style="color:black">SYSINIT:1E13                 </span><span style="color:navy">cmp     al, &#039;</span><span style="color:green">:&#039;         </span>; _$P_Colon ; &quot;:&quot; is delimiter,
<span style="color:black">SYSINIT:1E13                                         </span>;            at end of switch on command line
<span style="color:black">SYSINIT:1E15                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_SCOM03
</span><span style="color:black">SYSINIT:1E17                 </span><span style="color:navy">cmp     byte ptr es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; _$P_NULL
<span style="color:black">SYSINIT:1E17                                         </span>; IF at end of switch on command AND
<span style="color:black">SYSINIT:1E1C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_SCOM_Differ </span>;
<span style="color:black">SYSINIT:1E1C                                         </span>; at end of switch string
<span style="color:black">SYSINIT:1E1C                                         </span>; in the control block THEN
<span style="color:black">SYSINIT:1E1E
SYSINIT:1E1E </span><span style="color:gray">_$P_SCOM05</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E1E                 </span><span style="color:navy">inc     si              </span>; found a match
<span style="color:black">SYSINIT:1E1E                                         </span>; si points to just after &quot;=&quot; or &quot;:&quot;
<span style="color:black">SYSINIT:1E1F                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_SCOM_Same </span>; exit
<span style="color:black">SYSINIT:1E21 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1E21
SYSINIT:1E21 </span><span style="color:gray">_$P_SCOM03</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E21                 </span><span style="color:navy">cmp     al, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; compare operand w/ a synonym
<span style="color:black">SYSINIT:1E25                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_SCOM_Differ0 </span>; if different,
<span style="color:black">SYSINIT:1E25                                         </span>; check ignore colon option
<span style="color:black">SYSINIT:1E27                 </span><span style="color:navy">or      al, al          </span>; end of line ?
<span style="color:black">SYSINIT:1E29                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_SCOM_Same </span>; if so, exit
<span style="color:black">SYSINIT:1E2B                 </span><span style="color:navy">inc     si              </span>; update operand pointer
<span style="color:black">SYSINIT:1E2C                 </span><span style="color:navy">inc     bp              </span>; and synonym pointer
<span style="color:black">SYSINIT:1E2D                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_SCOM01 </span>; loop until NULL or &quot;=&quot; or &quot;:&quot;
<span style="color:black">SYSINIT:1E2D                                         </span>;  found in case
<span style="color:black">SYSINIT:1E2F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1E2F
SYSINIT:1E2F </span><span style="color:gray">_$P_SCOM00</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E2F                 </span><span style="color:navy">cmp     al, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; Here al is DBCS leading byte
<span style="color:black">SYSINIT:1E2F                                         </span>; compare leading byte
<span style="color:black">SYSINIT:1E33                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_SCOM_Differ </span>; if not match, say different
<span style="color:black">SYSINIT:1E35                 </span><span style="color:navy">inc     si              </span>; else, load next byte
<span style="color:black">SYSINIT:1E36                 </span><span style="color:navy">mov     al, cs:[si]
</span><span style="color:black">SYSINIT:1E39                 </span><span style="color:navy">inc     bp
</span><span style="color:black">SYSINIT:1E3A                 </span><span style="color:navy">cmp     al, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; and compare 2nd byte
<span style="color:black">SYSINIT:1E3E                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_SCOM_Differ </span>; if not match, say different, too
<span style="color:black">SYSINIT:1E40                 </span><span style="color:navy">inc     si              </span>; else update operand pointer
<span style="color:black">SYSINIT:1E41                 </span><span style="color:navy">inc     bp              </span>; and synonym pointer
<span style="color:black">SYSINIT:1E42
SYSINIT:1E42 </span><span style="color:gray">_$P_SCOM01</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E42                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_SCOM_Loop </span>; loop until NULL or &quot;=&quot;
<span style="color:black">SYSINIT:1E42                                         </span>; or &quot;/&quot; found in case
<span style="color:black">SYSINIT:1E44 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1E44
SYSINIT:1E44 </span><span style="color:gray">_$P_SCOM_Differ0</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E44                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">40h </span>; _$P_SW
<span style="color:black">SYSINIT:1E4A                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_not_applicable
</span><span style="color:black">SYSINIT:1E4C                 </span><span style="color:navy">test    word ptr es:[bx+</span><span style="color:#ff8000">2</span><span style="color:navy">], </span><span style="color:green">20h </span>; [es:bx+_$P_Control_Blk.Function_Flag],
<span style="color:black">SYSINIT:1E4C                                         </span>; _$P_colon_is_not_necessary
<span style="color:black">SYSINIT:1E52                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_not_applicable
</span><span style="color:black">SYSINIT:1E54                 </span><span style="color:navy">cmp     byte ptr es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; _$P_NULL
<span style="color:black">SYSINIT:1E59                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_SCOM_Same
</span><span style="color:black">SYSINIT:1E5B
SYSINIT:1E5B </span><span style="color:gray">_$P_not_applicable</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E5B                 </span><span style="color:navy">test    word ptr es:[bx], </span><span style="color:green">10h </span>; [es:bx+_$P_Control_Blk.Match_Flag],
<span style="color:black">SYSINIT:1E5B                                         </span>; _$P_Ig_Colon
<span style="color:black">SYSINIT:1E5B                                         </span>; ignore colon option specified ?
<span style="color:black">SYSINIT:1E60                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_SCOM_Differ
</span><span style="color:black">SYSINIT:1E62                 </span><span style="color:navy">cmp     al, &#039;</span><span style="color:green">:&#039;         </span>; _$P_Colon ; End up with &quot;:&quot; and subseqently
<span style="color:black">SYSINIT:1E64                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_SCOM02
</span><span style="color:black">SYSINIT:1E66                 </span><span style="color:navy">cmp     byte ptr es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; _$P_NULL ; null ?
<span style="color:black">SYSINIT:1E6B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_SCOM_Differ </span>; if no, say different
<span style="color:black">SYSINIT:1E6D                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_SCOM_Same </span>; else, say same
<span style="color:black">SYSINIT:1E6F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1E6F
SYSINIT:1E6F </span><span style="color:gray">_$P_SCOM02</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E6F                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0           </span>; _$P_NULL ; end up NULL and :
<span style="color:black">SYSINIT:1E71                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_SCOM_Differ
</span><span style="color:black">SYSINIT:1E73                 </span><span style="color:navy">cmp     byte ptr es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], &#039;</span><span style="color:green">:&#039; </span>; $P_Colon ; if no, say different
<span style="color:black">SYSINIT:1E78                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_SCOM_Same </span>; else, say same
<span style="color:black">SYSINIT:1E7A
SYSINIT:1E7A </span><span style="color:gray">_$P_SCOM_Differ</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E7A                 </span><span style="color:navy">stc                     </span>; indicate not found
<span style="color:black">SYSINIT:1E7B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_SCOM_Exit
</span><span style="color:black">SYSINIT:1E7D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1E7D
SYSINIT:1E7D </span><span style="color:gray">_$P_SCOM_Same</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E7D                 </span><span style="color:navy">mov     cs:</span>_$P_KEYorSW_Ptr<span style="color:navy">, si </span>; for later use by keyword or switch
<span style="color:black">SYSINIT:1E82                 </span><span style="color:navy">clc                     </span>; indicate found
<span style="color:black">SYSINIT:1E82                                         </span>; (cf is already 0 here.. clc is not needed)
<span style="color:black">SYSINIT:1E83
SYSINIT:1E83 </span><span style="color:gray">_$P_SCOM_Exit</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E83                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:1E84                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1E85                 </span><span style="color:navy">pop     bp
</span><span style="color:black">SYSINIT:1E86                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1E87                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1E87 </span>_$P_String_Comp endp
<span style="color:black">SYSINIT:1E87
SYSINIT:1E88
SYSINIT:1E88 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1E88
SYSINIT:1E88
SYSINIT:1E88 </span>_$P_File_Format proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1E88                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1E89                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:1E8A                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:1E8B                 </span><span style="color:navy">mov     di, cs:</span>_$P_SaveSI_Cmpx ; get user buffer address
<span style="color:black">SYSINIT:1E90
SYSINIT:1E90 </span>_$P_FileF_Loop0<span style="color:navy">:                        </span>; / skip special characters
<span style="color:black">SYSINIT:1E90                 </span><span style="color:navy">mov     al, cs:[si]     </span>; load character
<span style="color:black">SYSINIT:1E93                 </span><span style="color:navy">or      al, al          </span>; end of line ?
<span style="color:black">SYSINIT:1E95                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_FileF_Err </span>; if yes, error exit
<span style="color:black">SYSINIT:1E97                 </span><span style="color:navy">call    </span>_$P_FileSp_Chk  ; else, check if file special character
<span style="color:black">SYSINIT:1E9A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_FileF03
</span><span style="color:black">SYSINIT:1E9C                 </span><span style="color:navy">mov     cs:</span>_$P_err_flag<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; $P_error_filespec
<span style="color:black">SYSINIT:1E9C                                         </span>; set error flag - bad char.
<span style="color:black">SYSINIT:1EA2                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:1EA3                 </span><span style="color:navy">mov     byte ptr cs:[si], </span><span style="color:#ff8000">0 </span>; _$P_NULL
<span style="color:black">SYSINIT:1EA7                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:1EA8                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_FileF02
</span><span style="color:black">SYSINIT:1EAA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1EAA
SYSINIT:1EAA </span><span style="color:gray">_$P_FileF_Err</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1EAA                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:1EAB                 </span><span style="color:navy">mov     byte ptr cs:[si], </span><span style="color:#ff8000">0 </span>; _$P_NULL
<span style="color:black">SYSINIT:1EAF                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:1EB0                 </span><span style="color:navy">test    word ptr es:[bx], </span><span style="color:green">1 </span>; [es:bx+_$P_Control_Blk.Match_Flag],
<span style="color:black">SYSINIT:1EB0                                         </span>; _$P_Optional
<span style="color:black">SYSINIT:1EB5                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_FileF02
</span><span style="color:black">SYSINIT:1EB7                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">2    </span>; _$P_Op_Missing
<span style="color:black">SYSINIT:1EBE                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_FileF02
</span><span style="color:black">SYSINIT:1EC0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1EC0
SYSINIT:1EC0 </span><span style="color:gray">_$P_FileF03</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1EC0                 </span><span style="color:navy">pop     ax              </span>; discard si on top of stack
<span style="color:black">SYSINIT:1EC1                 </span><span style="color:navy">push    si              </span>; save new si
<span style="color:black">SYSINIT:1EC2
SYSINIT:1EC2 </span><span style="color:gray">_$P_FileF_Loop1</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1EC2                 </span><span style="color:navy">mov     al, cs:[si]     </span>; load character (not special char)
<span style="color:black">SYSINIT:1EC5                 </span><span style="color:navy">or      al, al          </span>; end of line ?
<span style="color:black">SYSINIT:1EC7                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_FileF_RLT
</span><span style="color:black">SYSINIT:1EC9                 </span><span style="color:navy">call    </span>_$P_FileSp_Chk  ; File special character ?
<span style="color:black">SYSINIT:1ECC                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_FileF00
</span><span style="color:black">SYSINIT:1ECE                 </span><span style="color:navy">call    </span>_$P_Chk_DBCS    ; no, then DBCS ?
<span style="color:black">SYSINIT:1ED1                 </span><span style="color:navy">jnb     short </span><span style="color:gray">_$P_FileF01
</span><span style="color:black">SYSINIT:1ED3                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:1ED4                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:1ED5
SYSINIT:1ED5 </span><span style="color:gray">_$P_FileF01</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1ED5                 </span><span style="color:navy">inc     di              </span>; if yes, skip next byte
<span style="color:black">SYSINIT:1ED6                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:1ED7                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_FileF_Loop1
</span><span style="color:black">SYSINIT:1ED9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1ED9
SYSINIT:1ED9 </span><span style="color:gray">_$P_FileF00</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1ED9                 </span><span style="color:navy">mov     cs:</span>_$P_Terminator<span style="color:navy">, al
</span><span style="color:black">SYSINIT:1EDD                 </span><span style="color:navy">mov     byte ptr cs:[si], </span><span style="color:#ff8000">0 </span>; _$P_NULL ; update end of string
<span style="color:black">SYSINIT:1EE1                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:1EE2                 </span><span style="color:navy">mov     cs:</span>_$P_SI_Save<span style="color:navy">, di </span>; update next pointer in command line
<span style="color:black">SYSINIT:1EE7
SYSINIT:1EE7 </span><span style="color:gray">_$P_FileF_RLT</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1EE7                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:1EE8                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:1EE9
SYSINIT:1EE9 </span><span style="color:gray">_$P_FileF02</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1EE9                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1EEA                 </span><span style="color:navy">test    ax, </span><span style="color:green">200h        </span>; _$P_File_Spc
<span style="color:black">SYSINIT:1EED                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Drv_Only_Exit
</span><span style="color:black">SYSINIT:1EEF                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1EF0                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$P_No_Tag
<span style="color:black">SYSINIT:1EF2                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">5           </span>; _$P_File_Spec
<span style="color:black">SYSINIT:1EF4                 </span><span style="color:navy">call    </span>_$P_Fill_Result ; set result buffer to file spec
<span style="color:black">SYSINIT:1EF7                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1EF8
SYSINIT:1EF8 </span><span style="color:gray">_$P_Drv_Only_Exit</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1EF8                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1EF8 </span>_$P_File_Format endp
<span style="color:black">SYSINIT:1EF8
SYSINIT:1EF9
SYSINIT:1EF9 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1EF9
SYSINIT:1EF9
SYSINIT:1EF9 </span>_$P_FileSp_Chk  proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1EF9                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:1EFA                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:1EFB                 </span><span style="color:navy">lea     bx, </span>_$P_FileSp_Char <span style="color:gray">; &quot;[]|&lt;&gt;+=;\&quot;&quot;
</span><span style="color:black">SYSINIT:1EFF                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">9           </span>; _$P_FileSp_Len
<span style="color:black">SYSINIT:1EFF                                         </span>; load length of special character table
<span style="color:black">SYSINIT:1EFF                                         </span>; at SYSINIT:1838h (for MSDOS 6.21 IO.SYS)
<span style="color:black">SYSINIT:1F02
SYSINIT:1F02 </span><span style="color:gray">_$P_FileSp_Loop</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F02                 </span><span style="color:navy">cmp     al, cs:[bx]     </span>; is it one of special character ?
<span style="color:black">SYSINIT:1F05                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_FileSp_Exit
</span><span style="color:black">SYSINIT:1F07                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:1F08                 </span><span style="color:navy">loop    </span><span style="color:gray">_$P_FileSp_Loop
</span><span style="color:black">SYSINIT:1F0A                 </span><span style="color:navy">inc     cx              </span>; reset ZF
<span style="color:black">SYSINIT:1F0B
SYSINIT:1F0B </span><span style="color:gray">_$P_FileSp_Exit</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F0B                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:1F0C                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1F0D                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1F0D </span>_$P_FileSp_Chk  endp
<span style="color:black">SYSINIT:1F0D
SYSINIT:1F0E
SYSINIT:1F0E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1F0E
SYSINIT:1F0E
SYSINIT:1F0E </span>_$P_Drive_Format proc near              <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F0E                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:1F0F                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:1F10                 </span><span style="color:navy">mov     al, cs:[si]
</span><span style="color:black">SYSINIT:1F13                 </span><span style="color:navy">or      al, al          </span>; if null string
<span style="color:black">SYSINIT:1F15                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Drv_Exit </span>; do nothing
<span style="color:black">SYSINIT:1F17                 </span><span style="color:navy">call    </span>_$P_Chk_DBCS    ; is it leading byte ?
<span style="color:black">SYSINIT:1F1A                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Drv_Err </span>; yes, error
<span style="color:black">SYSINIT:1F1C                 </span><span style="color:navy">cmp     word ptr cs:[si+</span><span style="color:#ff8000">1</span><span style="color:navy">], </span><span style="color:#ff8000">3Ah </span><span style="color:gray">; &#039;:&#039; </span>; _$P_Colon
<span style="color:black">SYSINIT:1F1C                                         </span>; &quot;d&quot;, &quot;:&quot;, 0 ?
<span style="color:black">SYSINIT:1F21                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_DrvF00
</span><span style="color:black">SYSINIT:1F23                 </span><span style="color:navy">test    word ptr es:[bx], </span><span style="color:green">10h </span>; [es:bx+_$P_Control_Blk.Match_Flag],
<span style="color:black">SYSINIT:1F23                                         </span>; _$P_Ig_Colon
<span style="color:black">SYSINIT:1F23                                         </span>; colon can be ignored?
<span style="color:black">SYSINIT:1F28                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Drv_Err
</span><span style="color:black">SYSINIT:1F2A                 </span><span style="color:navy">cmp     byte ptr cs:[si+</span><span style="color:#ff8000">1</span><span style="color:navy">], </span><span style="color:#ff8000">0 </span>; _$P_NULL ; &quot;d&quot;, 0 ?
<span style="color:black">SYSINIT:1F2F                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Drv_Err
</span><span style="color:black">SYSINIT:1F31
SYSINIT:1F31 </span><span style="color:gray">_$P_DrvF00</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F31                 </span><span style="color:navy">or      al, </span><span style="color:green">20h         </span>; _$P_Make_Lower ; lower case
<span style="color:black">SYSINIT:1F33                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">61h </span><span style="color:gray">; &#039;a&#039;   </span>; drive letter must
<span style="color:black">SYSINIT:1F35                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Drv_Err </span>; in range of
<span style="color:black">SYSINIT:1F37                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">7Ah </span><span style="color:gray">; &#039;z&#039;   </span>; &quot;a&quot;-&quot;z&quot;
<span style="color:black">SYSINIT:1F39                 </span><span style="color:navy">ja      short </span><span style="color:gray">_$P_Drv_Err </span>; if no, error
<span style="color:black">SYSINIT:1F3B                 </span><span style="color:navy">sub     al, </span><span style="color:green">60h         </span>; &quot;a&quot;-1 ; make text drive to binary drive
<span style="color:black">SYSINIT:1F3D                 </span><span style="color:navy">mov     dl, al
</span><span style="color:black">SYSINIT:1F3F                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0FFh        </span>; _$P_No_Tag
<span style="color:black">SYSINIT:1F41                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">6           </span>; _$P_Drive
<span style="color:black">SYSINIT:1F43                 </span><span style="color:navy">call    </span>_$P_Fill_Result ; set result buffer to drive
<span style="color:black">SYSINIT:1F46                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Drv_Exit
</span><span style="color:black">SYSINIT:1F48 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1F48
SYSINIT:1F48 </span><span style="color:gray">_$P_Drv_Err</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F48                 </span><span style="color:navy">mov     cs:</span>_$P_RC<span style="color:navy">, </span><span style="color:#ff8000">9    </span>; _$P_Syntax
<span style="color:black">SYSINIT:1F4F
SYSINIT:1F4F </span><span style="color:gray">_$P_Drv_Exit</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F4F                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:1F50                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:1F51                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1F51 </span>_$P_Drive_Format endp
<span style="color:black">SYSINIT:1F51
SYSINIT:1F52
SYSINIT:1F52 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1F52
SYSINIT:1F52
SYSINIT:1F52 </span>_$P_Skip_Delim  proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F52                 </span><span style="color:navy">lodsb
</span><span style="color:black">SYSINIT:1F53                 </span><span style="color:navy">call    </span>_$P_Chk_EOL     ; is it EOL character ?
<span style="color:black">SYSINIT:1F56                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Skip_Delim_CY </span>; if yes, exit w/ CY on
<span style="color:black">SYSINIT:1F58                 </span><span style="color:navy">call    </span>_$P_Chk_Delim   ; is it one of delimiters ?
<span style="color:black">SYSINIT:1F5B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_Skip_Delim_NCY </span>; if no, exit w/ CY off
<span style="color:black">SYSINIT:1F5D                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">20h </span>; _$P_Extra ; extra delim or comma found
<span style="color:black">SYSINIT:1F63                 </span><span style="color:navy">jz      short </span>_$P_Skip_Delim ; _$P_Skip_Delim_Loop
<span style="color:black">SYSINIT:1F63                                         </span>; if no, loop
<span style="color:black">SYSINIT:1F65                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">41h </span>; _$P_SW+_$P_equ ; /x , or xxx=zzz ,
<span style="color:black">SYSINIT:1F6B                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Exit_At_Extra </span>; no switch, no keyword
<span style="color:black">SYSINIT:1F6D                 </span><span style="color:navy">dec     si
</span><span style="color:black">SYSINIT:1F6E                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Exit_At_Extra
</span><span style="color:black">SYSINIT:1F70 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1F70
SYSINIT:1F70 </span><span style="color:gray">_$P_Skip_Delim_CY</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F70                 </span><span style="color:navy">stc                     </span>; indicate EOL
<span style="color:black">SYSINIT:1F71                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Skip_Delim_Exit
</span><span style="color:black">SYSINIT:1F73 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1F73
SYSINIT:1F73 </span><span style="color:gray">_$P_Skip_Delim_NCY</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F73                 </span><span style="color:navy">clc                     </span>; indicate non delim
<span style="color:black">SYSINIT:1F74
SYSINIT:1F74 </span><span style="color:gray">_$P_Skip_Delim_Exit</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F74                 </span><span style="color:navy">dec     si              </span>; in this case, need backup index pointer
<span style="color:black">SYSINIT:1F75                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1F76 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1F76
SYSINIT:1F76 </span><span style="color:gray">_$P_Exit_At_Extra</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F76                 </span><span style="color:navy">clc                     </span>; indicate extra delim
<span style="color:black">SYSINIT:1F77                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1F77 </span>_$P_Skip_Delim  endp
<span style="color:black">SYSINIT:1F77
SYSINIT:1F78
SYSINIT:1F78 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1F78
SYSINIT:1F78
SYSINIT:1F78 </span>_$P_Chk_EOL     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1F78                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:1F79                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:1F7A                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh         </span>; _$P_CR ; Carriage return ?
<span style="color:black">SYSINIT:1F7C                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_EOL_Exit
</span><span style="color:black">SYSINIT:1F7E                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0           </span>; _$P_NULL ; zero ?
<span style="color:black">SYSINIT:1F80                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_EOL_Exit
</span><span style="color:black">SYSINIT:1F82                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah         </span>; _$P_LF ; Line feed ?
<span style="color:black">SYSINIT:1F84                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_EOL_Exit
</span><span style="color:black">SYSINIT:1F86                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">2</span><span style="color:navy">], </span><span style="color:#ff8000">2 </span>; [es:di+_$P_PARMS_Blk.Num_Extra],
<span style="color:black">SYSINIT:1F86                                         </span>; _$P_I_Have_EOL
<span style="color:black">SYSINIT:1F8B                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Chk_EOL_Exit
</span><span style="color:black">SYSINIT:1F8D                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:black">SYSINIT:1F8F                 </span><span style="color:navy">mov     bl, es:[di+</span><span style="color:#ff8000">3</span><span style="color:navy">]   </span>; [es:di+_$P_PARMS_Blk.Len_Extra_Delim]
<span style="color:black">SYSINIT:1F8F                                         </span>; get length of delimiter list
<span style="color:black">SYSINIT:1F93                 </span><span style="color:navy">add     bx, </span><span style="color:#ff8000">4           </span>; _$P_Len_PARMS ; skip it
<span style="color:black">SYSINIT:1F96                 </span><span style="color:navy">cmp     byte ptr es:[bx+di], </span><span style="color:#ff8000">0 </span>; _$P_I_Use_Default
<span style="color:black">SYSINIT:1F96                                         </span>; No extra EOL character ?
<span style="color:black">SYSINIT:1F9A                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_EOL_NZ
</span><span style="color:black">SYSINIT:1F9C                 </span><span style="color:navy">xor     cx, cx          </span>; Get number of extra character
<span style="color:black">SYSINIT:1F9E                 </span><span style="color:navy">mov     cl, es:[bx+di]
</span><span style="color:black">SYSINIT:1FA1
SYSINIT:1FA1 </span><span style="color:gray">_$P_Chk_EOL_Loop</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1FA1                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:1FA2                 </span><span style="color:navy">cmp     al, es:[bx+di]  </span>; Check extra EOL character
<span style="color:black">SYSINIT:1FA5                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_EOL_Exit
</span><span style="color:black">SYSINIT:1FA7                 </span><span style="color:navy">loop    </span><span style="color:gray">_$P_Chk_EOL_Loop
</span><span style="color:black">SYSINIT:1FA9
SYSINIT:1FA9 </span><span style="color:gray">_$P_Chk_EOL_NZ</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1FA9                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh         </span>; _$P_CR ; reset ZF
<span style="color:black">SYSINIT:1FAB
SYSINIT:1FAB </span><span style="color:gray">_$P_Chk_EOL_Exit</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1FAB                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:1FAC                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1FAD                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1FAD </span>_$P_Chk_EOL     endp
<span style="color:black">SYSINIT:1FAD
SYSINIT:1FAE
SYSINIT:1FAE </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:1FAE
SYSINIT:1FAE
SYSINIT:1FAE </span>_$P_Chk_Delim   proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:1FAE                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:1FAF                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:1FB0                 </span><span style="color:navy">mov     cs:</span>_$P_Terminator<span style="color:navy">, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039; </span>; _$P_Space
<span style="color:black">SYSINIT:1FB0                                         </span>; assume terminated by space
<span style="color:black">SYSINIT:1FB6                 </span><span style="color:navy">and     cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">0DFh </span>; 0FFh-_$P_Extra ; ~$P_Extra ; ~20h
<span style="color:black">SYSINIT:1FBC                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;   </span>; _$P_Space ; Space ?
<span style="color:black">SYSINIT:1FBE                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_Delim_Exit
</span><span style="color:black">SYSINIT:1FC0                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">9           </span>; _$P_TAB ; TAB ?
<span style="color:black">SYSINIT:1FC2                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_Delim_Exit
</span><span style="color:black">SYSINIT:1FC4                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Ch </span><span style="color:gray">; &#039;,&#039;   </span>; _$P_Comma ; Comma ?
<span style="color:black">SYSINIT:1FC6                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_Delim_Exit0
</span><span style="color:black">SYSINIT:1FC8
SYSINIT:1FC8 </span>_$P_Chk_Delim00<span style="color:navy">:                        </span>; Note: _$P_Chk_Delim00 part of code is nonsense
<span style="color:black">SYSINIT:1FC8                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;   </span>;       here because _$P_Space = _$P_DBSP1 = 20h
<span style="color:black">SYSINIT:1FC8                                         </span>;       Erdogan Tan - 08/07/2023
<span style="color:black">SYSINIT:1FC8                                         </span>;
<span style="color:black">SYSINIT:1FC8                                         </span>; _$P_DBSP1 ; 1st byte of DBCS Space ?
<span style="color:black">SYSINIT:1FCA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">$P_Chk_Delim01
</span><span style="color:black">SYSINIT:1FCC                 </span><span style="color:navy">cmp     byte ptr [si], </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039; </span>; _$P_DBSP2 ; 2nd byte of DBCS Space ?
<span style="color:black">SYSINIT:1FCF                 </span><span style="color:navy">jnz     short </span><span style="color:gray">$P_Chk_Delim01
</span><span style="color:black">SYSINIT:1FD1                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;   </span>; _$P_Space
<span style="color:black">SYSINIT:1FD3                 </span><span style="color:navy">inc     si              </span>; make si point to next character
<span style="color:black">SYSINIT:1FD4                 </span><span style="color:navy">cmp     al, al          </span>; Set ZF
<span style="color:black">SYSINIT:1FD6                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Chk_Delim_Exit
</span><span style="color:black">SYSINIT:1FD8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1FD8
SYSINIT:1FD8 </span><span style="color:gray">$P_Chk_Delim01</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1FD8                 </span><span style="color:navy">cmp     byte ptr es:[di+</span><span style="color:#ff8000">2</span><span style="color:navy">], </span><span style="color:#ff8000">1 </span>; [es:di-_$P_PARMS_Blk.Num_Extra],
<span style="color:black">SYSINIT:1FD8                                         </span>; _$P_I_Have_Delim
<span style="color:black">SYSINIT:1FD8                                         </span>; delimiter character specified ?
<span style="color:black">SYSINIT:1FDD                 </span><span style="color:navy">jb      short </span><span style="color:gray">_$P_Chk_Delim_Exit </span>; no
<span style="color:black">SYSINIT:1FDF                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:1FE1                 </span><span style="color:navy">mov     cl, es:[di+</span><span style="color:#ff8000">3</span><span style="color:navy">]   </span>; [es:di+_$P_PARMS_Blk.Len_Extra_Delim]
<span style="color:black">SYSINIT:1FE1                                         </span>; get length of delimiter list
<span style="color:black">SYSINIT:1FE5                 </span><span style="color:navy">or      cx, cx
</span><span style="color:black">SYSINIT:1FE7                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_Delim_NZ </span>; no extra delim character
<span style="color:black">SYSINIT:1FE9                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">3           </span>; _$P_Len_PARMS-1
<span style="color:black">SYSINIT:1FE9                                         </span>; set bx to 1st extra delimiter
<span style="color:black">SYSINIT:1FEC
SYSINIT:1FEC </span><span style="color:gray">_$P_Chk_Delim_Loop</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1FEC                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:1FED                 </span><span style="color:navy">cmp     al, es:[bx+di]  </span>; check extra delim character
<span style="color:black">SYSINIT:1FF0                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_Chk_Delim_Exit0
</span><span style="color:black">SYSINIT:1FF2                 </span><span style="color:navy">loop    </span><span style="color:gray">_$P_Chk_Delim_Loop </span>; examine all extra delimiter
<span style="color:black">SYSINIT:1FF4
SYSINIT:1FF4 </span><span style="color:gray">_$P_Chk_Delim_NZ</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1FF4                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;   </span>; _$P_Space ; reset ZF
<span style="color:black">SYSINIT:1FF6
SYSINIT:1FF6 </span><span style="color:gray">_$P_Chk_Delim_Exit</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1FF6                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:1FF7                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:1FF8                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:1FF9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:1FF9
SYSINIT:1FF9 </span><span style="color:gray">_$P_Chk_Delim_Exit0</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:1FF9                 </span><span style="color:navy">mov     cs:</span>_$P_Terminator<span style="color:navy">, al </span>; keep terminated delimiter
<span style="color:black">SYSINIT:1FFD                 </span><span style="color:navy">test    cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">1 </span>; _$P_equ ; if terminating a key=
<span style="color:black">SYSINIT:2003                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_No_Set_Extra </span>; then do not set the EXTRA bit
<span style="color:black">SYSINIT:2005                 </span><span style="color:navy">or      cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">20h </span>; _$P_Extra
<span style="color:black">SYSINIT:2005                                         </span>; flag terminated extra delim or comma
<span style="color:black">SYSINIT:200B
SYSINIT:200B </span><span style="color:gray">_$P_No_Set_Extra</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:200B                 </span><span style="color:navy">cmp     al, al          </span>; set ZF
<span style="color:black">SYSINIT:200D                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_Chk_Delim_Exit
</span><span style="color:black">SYSINIT:200D </span>_$P_Chk_Delim   endp
<span style="color:black">SYSINIT:200D
SYSINIT:200F
SYSINIT:200F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:200F
SYSINIT:200F
SYSINIT:200F </span>_$P_Chk_Switch  proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:200F                 </span><span style="color:navy">lea     bp, </span>_$P_STRING_BUF ; BP = Offset of _$P_String_Buf
<span style="color:black">SYSINIT:200F                                         </span>; (mov bp, offset _$P_STRING_BUF)
<span style="color:black">SYSINIT:2013                 </span><span style="color:navy">cmp     bx, bp          </span>; IF not first char THEN
<span style="color:black">SYSINIT:2015                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_STRUC_L2
</span><span style="color:black">SYSINIT:2017                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;   </span>; _$P_Switch ; see if a slash
<span style="color:black">SYSINIT:2019                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_STRUC_L5
</span><span style="color:black">SYSINIT:201B                 </span><span style="color:navy">stc                     </span>; not in first position and is slash
<span style="color:black">SYSINIT:201C                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_STRUC_L1
</span><span style="color:black">SYSINIT:201E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:201E
SYSINIT:201E </span><span style="color:gray">_$P_STRUC_L5</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:201E                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:201F                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_STRUC_L1
</span><span style="color:black">SYSINIT:2021 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2021
SYSINIT:2021 </span><span style="color:gray">_$P_STRUC_L2</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2021                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;   </span>; _$P_Switch
<span style="color:black">SYSINIT:2023                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_STRUC_L12 </span>; not a slash
<span style="color:black">SYSINIT:2025                 </span><span style="color:navy">or      cs:</span>_$P_Flags2<span style="color:navy">, </span><span style="color:green">40h </span>; _$P_SW
<span style="color:black">SYSINIT:2025                                         </span>; could be valid switch,
<span style="color:black">SYSINIT:2025                                         </span>; first char and is slash
<span style="color:black">SYSINIT:202B
SYSINIT:202B </span><span style="color:gray">_$P_STRUC_L12</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:202B                 </span><span style="color:navy">clc                     </span>; is first char in the buffer, ZF=0
<span style="color:black">SYSINIT:202B                                         </span>; (CF=0 indicating first char)
<span style="color:black">SYSINIT:202C
SYSINIT:202C </span><span style="color:gray">_$P_STRUC_L1</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:202C                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:202C </span>_$P_Chk_Switch  endp
<span style="color:black">SYSINIT:202C
SYSINIT:202D
SYSINIT:202D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:202D
SYSINIT:202D
SYSINIT:202D </span>_$P_Chk_DBCS    proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:202D                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:202E                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:202F                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:2030                 </span><span style="color:navy">cmp     cs:</span>_$P_DBCSEV_SEG<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; already set ?
<span style="color:black">SYSINIT:2036                 </span><span style="color:navy">jnz     short </span><span style="color:gray">_$P_DBCS00 </span>; yes
<span style="color:black">SYSINIT:2038                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:2039                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:203A                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:203B                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:203C                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:203D                 </span><span style="color:navy">push    bp
</span><span style="color:black">SYSINIT:203E                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:203F                 </span><span style="color:navy">xor     si, si
</span><span style="color:black">SYSINIT:2041                 </span><span style="color:navy">mov     ds, si
</span><span style="color:black">SYSINIT:2043                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2043                 </span><span style="color:navy">mov     ax, </span><span style="color:green">6300h       </span>; _$P_DOS_GetEV ; GET DBCS EV CALL
<span style="color:black">SYSINIT:2046                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3.2+ only
<span style="color:black">SYSINIT:2046                                         </span>; GET DOUBLE BYTE CHARACTER SET LEAD TABLE
<span style="color:black">SYSINIT:2048                 </span><span style="color:navy">mov     bx, ds
</span><span style="color:black">SYSINIT:204A                 </span><span style="color:navy">or      bx, bx
</span><span style="color:black">SYSINIT:204C                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:204D                 </span><span style="color:navy">pop     bp
</span><span style="color:black">SYSINIT:204E                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:204F                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:2050                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:2051                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2052                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2052                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:2053                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_NON_DBCS
</span><span style="color:black">SYSINIT:2055
SYSINIT:2055 </span><span style="color:navy">loc_6085:                               </span>; save EV offset
<span style="color:black">SYSINIT:2055                 </span><span style="color:navy">mov     cs:</span>_$P_DBCSEV_OFF<span style="color:navy">, si
</span><span style="color:black">SYSINIT:205A                 </span><span style="color:navy">mov     cs:</span>_$P_DBCSEV_SEG<span style="color:navy">, bx </span>; save EV segment
<span style="color:black">SYSINIT:205F
SYSINIT:205F </span><span style="color:gray">_$P_DBCS00</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:205F                 </span><span style="color:navy">mov     si, cs:</span>_$P_DBCSEV_OFF ; load EV offset and segment
<span style="color:black">SYSINIT:2064                 </span><span style="color:navy">mov     ds, cs:</span>_$P_DBCSEV_SEG
<span style="color:black">SYSINIT:2069
SYSINIT:2069 </span><span style="color:gray">_$P_DBCS_LOOP</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2069                 </span><span style="color:navy">cmp     word ptr [si], </span><span style="color:#ff8000">0 </span>; zero vector ?
<span style="color:black">SYSINIT:206C                 </span><span style="color:navy">jz      short </span><span style="color:gray">_$P_NON_DBCS </span>; then exit
<span style="color:black">SYSINIT:206E                 </span><span style="color:navy">cmp     al, [si]        </span>; Check if AL is in range of the vector
<span style="color:black">SYSINIT:2070                 </span><span style="color:navy">jb      short </span><span style="color:gray">$P_DBCS01
</span><span style="color:black">SYSINIT:2072                 </span><span style="color:navy">cmp     al, [si+</span><span style="color:#ff8000">1</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:2075                 </span><span style="color:navy">ja      short </span><span style="color:gray">$P_DBCS01
</span><span style="color:black">SYSINIT:2077                 </span><span style="color:navy">stc                     </span>; if yes, indicate DBCS and exit
<span style="color:black">SYSINIT:2078                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_DBCS_EXIT
</span><span style="color:black">SYSINIT:207A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:207A
SYSINIT:207A </span><span style="color:gray">$P_DBCS01</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:207A                 </span><span style="color:navy">inc     si              </span>; add 2 to si reg
<span style="color:black">SYSINIT:207B                 </span><span style="color:navy">inc     si              </span>; get next vector
<span style="color:black">SYSINIT:207C                 </span><span style="color:navy">jmp     short </span><span style="color:gray">_$P_DBCS_LOOP </span>; loop until zero vector found
<span style="color:black">SYSINIT:207E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:207E
SYSINIT:207E </span><span style="color:gray">_$P_NON_DBCS</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:207E                 </span><span style="color:navy">clc                     </span>; indicate SBCS
<span style="color:black">SYSINIT:207E                                         </span>; (note: cf is already 0 here)
<span style="color:black">SYSINIT:207F
SYSINIT:207F </span><span style="color:gray">_$P_DBCS_EXIT</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:207F                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:2080                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:2081                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2082                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2082 </span>_$P_Chk_DBCS    endp
<span style="color:black">SYSINIT:2082
SYSINIT:2082 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:2083 </span>buf_parms       <span style="color:navy">dw offset </span>buf_parmsx    <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2083                                         </span>; buffer = [n | n,m] {/e}
<span style="color:gray">SYSINIT:2085                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; an extra delimiter list
<span style="color:gray">SYSINIT:2086                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; length is 1
<span style="color:gray">SYSINIT:2087                 </span><span style="color:navy">db &#039;</span><span style="color:green">;&#039;                  </span>; delimiter
<span style="color:gray">SYSINIT:2088 </span>buf_parmsx      <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2089                 </span><span style="color:navy">db </span><span style="color:#008040">2                    </span>; min 1, max 2 positionals
<span style="color:gray">SYSINIT:208A                 </span><span style="color:navy">dw offset </span>buf_pos1
<span style="color:gray">SYSINIT:208C                 </span><span style="color:navy">dw offset </span>buf_pos2
<span style="color:gray">SYSINIT:208E                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; one switch
<span style="color:gray">SYSINIT:208F                 </span><span style="color:navy">dw offset </span>sw_x_ctrl
<span style="color:gray">SYSINIT:2091                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no keywords
<span style="color:gray">SYSINIT:2091                                         </span>;
<span style="color:gray">SYSINIT:2091                                         </span>; buf_pos1 p_pos &lt;8000h,0,result_val,buf_range_1&gt;
<span style="color:gray">SYSINIT:2091                                         </span>; numeric
<span style="color:gray">SYSINIT:2092 </span>buf_pos1        <span style="color:navy">dw </span><span style="color:#008040">8000h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2092                                         </span>; match_flags - numeric value
<span style="color:gray">SYSINIT:2094                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; function flags
<span style="color:gray">SYSINIT:2096                 </span><span style="color:navy">dw offset </span>result_val    ; result value buffer
<span style="color:gray">SYSINIT:2098                 </span><span style="color:navy">dw offset </span>buf_range_1   ; value list
<span style="color:gray">SYSINIT:209A                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no switches/keywords
<span style="color:gray">SYSINIT:209B </span>buf_range_1     <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:209B                                         </span>; range definition
<span style="color:gray">SYSINIT:209C                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; 1 definition of range
<span style="color:gray">SYSINIT:209D                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; item tag for this range
<span style="color:gray">SYSINIT:209E                 </span><span style="color:navy">dd </span><span style="color:#008040">1                    </span>; numeric min
<span style="color:gray">SYSINIT:20A2                 </span><span style="color:navy">dd </span><span style="color:#008040">99                   </span>; numeric max
<span style="color:gray">SYSINIT:20A2                                         </span>;
<span style="color:gray">SYSINIT:20A2                                         </span>; buf_pos2 p_pos &lt;8001h,0,result_val,buf_range_2&gt;
<span style="color:gray">SYSINIT:20A2                                         </span>; optional num.
<span style="color:gray">SYSINIT:20A6 </span>buf_pos2        <span style="color:navy">dw </span><span style="color:#008040">8001h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20A8                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:20AA                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:20AC                 </span><span style="color:navy">dw offset </span>buf_range_2
<span style="color:gray">SYSINIT:20AE                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>;
<span style="color:gray">SYSINIT:20AE                                         </span>; buf_range_2 p_range &lt;,,,0,8&gt;
<span style="color:gray">SYSINIT:20AF </span>buf_range_2     <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20B0                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:20B1                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:20B2                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:20B6                 </span><span style="color:navy">dd </span><span style="color:#008040">8                    </span>;
<span style="color:gray">SYSINIT:20B6                                         </span>; sw_x_ctrl p_pos &lt;0,0,result_val,noval,1&gt;
<span style="color:gray">SYSINIT:20B6                                         </span>; followed by one switch
<span style="color:gray">SYSINIT:20BA </span>sw_x_ctrl       <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20BC                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:20BE                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:20C0                 </span><span style="color:navy">dw offset </span>noval
<span style="color:gray">SYSINIT:20C2                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; 1 switch
<span style="color:gray">SYSINIT:20C3 </span>switch_x        <span style="color:navy">db &#039;/X&#039;,0               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20C6 </span>p_buffers       <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20C8 </span>p_h_buffers     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20CA </span>p_buffer_slash_x <span style="color:navy">db </span><span style="color:#008040">0                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20CA                                         </span>;
<span style="color:gray">SYSINIT:20CA                                         </span>; common definitions
<span style="color:gray">SYSINIT:20CB </span>noval           <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20CC </span>result_val      <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20CC                                         </span>; type returned
<span style="color:gray">SYSINIT:20CD </span>result_val_itag <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20CD                                         </span>; item tag returned
<span style="color:gray">SYSINIT:20CE </span>result_val_swoff <span style="color:navy">dw </span><span style="color:#008040">0                   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20CE                                         </span>; es:offset of the switch defined
<span style="color:gray">SYSINIT:20D0 </span>rv_dword        <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20D0                                         </span>; rv_byte
<span style="color:gray">SYSINIT:20D0                                         </span>; value if number, or seg:offset to string.
<span style="color:gray">SYSINIT:20D0                                         </span>; ;;
<span style="color:gray">SYSINIT:20D4 </span>brk_parms       <span style="color:navy">dw offset </span>brk_parmsx    <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20D4                                         </span>; break = [ on | off ]
<span style="color:gray">SYSINIT:20D6                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; an extra delimiter list
<span style="color:gray">SYSINIT:20D7                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; length is 1
<span style="color:gray">SYSINIT:20D8                 </span><span style="color:navy">db &#039;</span><span style="color:green">;&#039;                  </span>; delimiter
<span style="color:gray">SYSINIT:20D9 </span>brk_parmsx      <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20DA                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; min,max = 1 positional
<span style="color:gray">SYSINIT:20DB                 </span><span style="color:navy">dw offset </span>brk_pos
<span style="color:gray">SYSINIT:20DD                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no switches
<span style="color:gray">SYSINIT:20DE                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no keywords
<span style="color:gray">SYSINIT:20DE                                         </span>;
<span style="color:gray">SYSINIT:20DE                                         </span>; brk_pos p_pos &lt;2000h,0,result_val,on_off_string&gt;
<span style="color:gray">SYSINIT:20DE                                         </span>; simple string
<span style="color:gray">SYSINIT:20DF </span>brk_pos         <span style="color:navy">dw </span><span style="color:#008040">2000h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20E1                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:20E3                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:20E5                 </span><span style="color:navy">dw offset </span>on_off_string
<span style="color:gray">SYSINIT:20E7                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:20E8 </span>on_off_string   <span style="color:navy">db </span><span style="color:#008040">3                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20E8                                         </span>; signals that there is a string choice
<span style="color:gray">SYSINIT:20E9                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no range definition
<span style="color:gray">SYSINIT:20EA                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no numeric values choice
<span style="color:gray">SYSINIT:20EB                 </span><span style="color:navy">db </span><span style="color:#008040">2                    </span>; 2 strings for choice
<span style="color:gray">SYSINIT:20EC                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; the 1st string tag
<span style="color:gray">SYSINIT:20ED                 </span><span style="color:navy">dw offset </span>_on_string    <span style="color:gray">; &quot;ON&quot;
SYSINIT:20EF                 </span><span style="color:navy">db </span><span style="color:#008040">2                    </span>; the 2nd string tag
<span style="color:gray">SYSINIT:20F0                 </span><span style="color:navy">dw offset </span>_off_string   <span style="color:gray">; &quot;OFF&quot;
SYSINIT:20F2 </span>_on_string      <span style="color:navy">db &#039;ON&#039;,0               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20F5 </span>_off_string     <span style="color:navy">db &#039;OFF&#039;,0              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20F9 </span>p_ctrl_break    <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20F9                                         </span>; local variable
<span style="color:gray">SYSINIT:20F9                                         </span>; ;;
<span style="color:gray">SYSINIT:20FA </span>cntry_parms     <span style="color:navy">dw offset </span>cntry_parmsx  <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20FA                                         </span>; country = n {m {path}}
<span style="color:gray">SYSINIT:20FA                                         </span>; or country = n,,path
<span style="color:gray">SYSINIT:20FC                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:20FD                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:20FE                 </span><span style="color:navy">db &#039;</span><span style="color:green">;&#039;
</span><span style="color:gray">SYSINIT:20FF </span>cntry_parmsx    <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:20FF                                         </span>; min 1, max 3 pos.
<span style="color:gray">SYSINIT:2100                 </span><span style="color:navy">db </span><span style="color:#008040">3
</span><span style="color:gray">SYSINIT:2101                 </span><span style="color:navy">dw offset </span>cntry_pos1
<span style="color:gray">SYSINIT:2103                 </span><span style="color:navy">dw offset </span>cntry_pos2
<span style="color:gray">SYSINIT:2105                 </span><span style="color:navy">dw offset </span>cntry_pos3
<span style="color:gray">SYSINIT:2107                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no switches
<span style="color:gray">SYSINIT:2108                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no keywords
<span style="color:gray">SYSINIT:2109 </span>cntry_pos1      <span style="color:navy">dw </span><span style="color:#008040">8000h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2109                                         </span>; cntry_pos1 p_pos &lt;8000h,0,result_val,cc_range&gt;
<span style="color:gray">SYSINIT:2109                                         </span>; numeric value
<span style="color:gray">SYSINIT:210B                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:210D                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:210F                 </span><span style="color:navy">dw offset </span>cc_range
<span style="color:gray">SYSINIT:2111                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2112 </span>cc_range        <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2112                                         </span>; cc_range p_range &lt;,,,1,999&gt;
<span style="color:gray">SYSINIT:2113                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2114                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2115                 </span><span style="color:navy">dd </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2119                 </span><span style="color:navy">dd </span><span style="color:#008040">999
</span><span style="color:gray">SYSINIT:211D </span>cntry_pos2      <span style="color:navy">dw </span><span style="color:#008040">8001h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:211D                                         </span>; cntry_pos2 p_pos &lt;8001h,0,result_val,cc_range&gt;
<span style="color:gray">SYSINIT:211D                                         </span>; optional num.
<span style="color:gray">SYSINIT:211F                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2121                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:2123                 </span><span style="color:navy">dw offset </span>cc_range
<span style="color:gray">SYSINIT:2125                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2126 </span>cntry_pos3      <span style="color:navy">dw </span><span style="color:#008040">201h                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2126                                         </span>; cntry_pos3 p_pos &lt;201h,0,result_val,noval&gt;
<span style="color:gray">SYSINIT:2126                                         </span>; optional filespec
<span style="color:gray">SYSINIT:2128                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:212A                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:212C                 </span><span style="color:navy">dw offset </span>noval
<span style="color:gray">SYSINIT:212E                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:212F </span>p_cntry_code    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:212F                                         </span>; local variable
<span style="color:gray">SYSINIT:2131 </span>p_code_page     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2131                                         </span>; local variable
<span style="color:gray">SYSINIT:2131                                         </span>; ;;
<span style="color:gray">SYSINIT:2133 </span>files_parms     <span style="color:navy">dw offset </span>files_parmsx  <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2133                                         </span>; files = n
<span style="color:gray">SYSINIT:2135                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2136                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2137                 </span><span style="color:navy">db &#039;</span><span style="color:green">;&#039;
</span><span style="color:gray">SYSINIT:2138 </span>files_parmsx    <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2139                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; min,max 1 positional
<span style="color:gray">SYSINIT:213A                 </span><span style="color:navy">dw offset </span>files_pos
<span style="color:gray">SYSINIT:213C                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no switches
<span style="color:gray">SYSINIT:213D                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no keywords
<span style="color:gray">SYSINIT:213E </span>files_pos       <span style="color:navy">dw </span><span style="color:#008040">8000h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:213E                                         </span>; files_pos p_pos &lt;8000h,0,result_val,files_range,0&gt;
<span style="color:gray">SYSINIT:213E                                         </span>; numeric value
<span style="color:gray">SYSINIT:2140                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2142                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:2144                 </span><span style="color:navy">dw offset </span>files_range
<span style="color:gray">SYSINIT:2146                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2147 </span>files_range     <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2147                                         </span>; files_range p_range &lt;,,,8,255&gt;
<span style="color:gray">SYSINIT:2148                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2149                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:214A                 </span><span style="color:navy">dd </span><span style="color:#008040">8
</span><span style="color:gray">SYSINIT:214E                 </span><span style="color:navy">dd </span><span style="color:#008040">255
</span><span style="color:gray">SYSINIT:2152 </span>p_files         <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2152                                         </span>; local variable
<span style="color:gray">SYSINIT:2152                                         </span>; ;;
<span style="color:gray">SYSINIT:2153 </span>fcbs_parms      <span style="color:navy">dw offset </span>fcbs_parmsx   ; fcbs = n,m
<span style="color:gray">SYSINIT:2155                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2156                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2157                 </span><span style="color:navy">db &#039;</span><span style="color:green">;&#039;
</span><span style="color:gray">SYSINIT:2158 </span>fcbs_parmsx     <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2159                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">SYSINIT:215A                 </span><span style="color:navy">dw offset </span>fcbs_pos_1
<span style="color:gray">SYSINIT:215C                 </span><span style="color:navy">dw offset </span>fcbs_pos_2
<span style="color:gray">SYSINIT:215E                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no switches
<span style="color:gray">SYSINIT:215F                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no keywords
<span style="color:gray">SYSINIT:2160 </span>fcbs_pos_1      <span style="color:navy">dw </span><span style="color:#008040">8000h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2160                                         </span>; fcbs_pos_1 p_pos &lt;8000h,0,result_val,fcbs_range&gt;
<span style="color:gray">SYSINIT:2160                                         </span>; numeric value
<span style="color:gray">SYSINIT:2162                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2164                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:2166                 </span><span style="color:navy">dw offset </span>fcbs_range
<span style="color:gray">SYSINIT:2168                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2169 </span>fcbs_range      <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2169                                         </span>; fcbs_range p_range &lt;,,,1,255&gt;
<span style="color:gray">SYSINIT:216A                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:216B                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:216C                 </span><span style="color:navy">dd </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2170                 </span><span style="color:navy">dd </span><span style="color:#008040">255
</span><span style="color:gray">SYSINIT:2174 </span>fcbs_pos_2      <span style="color:navy">dw </span><span style="color:#008040">8000h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2174                                         </span>; fcbs_pos_2 p_pos &lt;8000h,0,result_val,fcbs_keep_range&gt;
<span style="color:gray">SYSINIT:2174                                         </span>; numeric value
<span style="color:gray">SYSINIT:2176                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2178                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:217A                 </span><span style="color:navy">dw offset </span>fcbs_keep_range
<span style="color:gray">SYSINIT:217C                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:217D </span>fcbs_keep_range <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:217D                                         </span>; fcbs_keep_range p_range &lt;,,,0,255&gt;
<span style="color:gray">SYSINIT:217E                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:217F                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2180                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2184                 </span><span style="color:navy">dd </span><span style="color:#008040">255
</span><span style="color:gray">SYSINIT:2188 </span>p_fcbs          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2188                                         </span>; local variable
<span style="color:gray">SYSINIT:2189 </span>p_keep          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2189                                         </span>; local variable
<span style="color:gray">SYSINIT:2189                                         </span>; ;;
<span style="color:gray">SYSINIT:218A </span>ldrv_parms      <span style="color:navy">dw offset </span>ldrv_parmsx   <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:218A                                         </span>; lastdrive = x
<span style="color:gray">SYSINIT:218C                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:218D                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:218E                 </span><span style="color:navy">db &#039;</span><span style="color:green">;&#039;
</span><span style="color:gray">SYSINIT:218F </span>ldrv_parmsx     <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2190                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; min,max = 1 positional
<span style="color:gray">SYSINIT:2191                 </span><span style="color:navy">dw offset </span>ldrv_pos
<span style="color:gray">SYSINIT:2193                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no switches
<span style="color:gray">SYSINIT:2194                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no keywords
<span style="color:gray">SYSINIT:2195 </span>ldrv_pos        <span style="color:navy">dw </span><span style="color:#008040">110h                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2195                                         </span>; ldrv_pos p_pos &lt;110h,10h,result_val,noval&gt;
<span style="color:gray">SYSINIT:2195                                         </span>; drive only, ignore colon at end
<span style="color:gray">SYSINIT:2197                 </span><span style="color:navy">dw </span><span style="color:#008040">10h
</span><span style="color:gray">SYSINIT:2199                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:219B                 </span><span style="color:navy">dw offset </span>noval
<span style="color:gray">SYSINIT:219D                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:219E </span>p_ldrv          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:219E                                         </span>; local variable
<span style="color:gray">SYSINIT:219E                                         </span>; ;;
<span style="color:gray">SYSINIT:219F </span>stks_parms      <span style="color:navy">dw offset </span>stks_parmsx   <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:219F                                         </span>; stacks = n,m
<span style="color:gray">SYSINIT:21A1                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21A2                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21A3                 </span><span style="color:navy">db &#039;</span><span style="color:green">;&#039;
</span><span style="color:gray">SYSINIT:21A4 </span>stks_parmsx     <span style="color:navy">db </span><span style="color:#008040">2                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21A5                 </span><span style="color:navy">db </span><span style="color:#008040">2                    </span>; min,max = 2 positionals
<span style="color:gray">SYSINIT:21A6                 </span><span style="color:navy">dw offset </span>stks_pos_1
<span style="color:gray">SYSINIT:21A8                 </span><span style="color:navy">dw offset </span>stks_pos_2
<span style="color:gray">SYSINIT:21AA                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no switches
<span style="color:gray">SYSINIT:21AB                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no keywords
<span style="color:gray">SYSINIT:21AC </span>stks_pos_1      <span style="color:navy">dw </span><span style="color:#008040">8000h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21AC                                         </span>; stks_pos_1 p_pos &lt;8000h,0,result_val,stks_range&gt;
<span style="color:gray">SYSINIT:21AC                                         </span>; numeric value
<span style="color:gray">SYSINIT:21AE                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:21B0                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:21B2                 </span><span style="color:navy">dw offset </span>stks_range
<span style="color:gray">SYSINIT:21B4                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:21B5 </span>stks_range      <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21B5                                         </span>; stks_range p_range &lt;,,,0,64&gt;
<span style="color:gray">SYSINIT:21B6                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21B7                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21B8                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:21BC                 </span><span style="color:navy">dd </span><span style="color:#008040">64
</span><span style="color:gray">SYSINIT:21C0 </span>stks_pos_2      <span style="color:navy">dw </span><span style="color:#008040">8000h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21C0                                         </span>; stks_pos_2 p_pos &lt;8000h,0,result_val,stk_size_range&gt;
<span style="color:gray">SYSINIT:21C0                                         </span>; numeric value
<span style="color:gray">SYSINIT:21C2                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:21C4                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:21C6                 </span><span style="color:navy">dw offset </span>stk_size_range
<span style="color:gray">SYSINIT:21C8                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:21C9 </span>stk_size_range  <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21C9                                         </span>; stk_size_range p_range &lt;,,,0,512&gt;
<span style="color:gray">SYSINIT:21CA                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21CB                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21CC                 </span><span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:21D0                 </span><span style="color:navy">dd </span><span style="color:#008040">512
</span><span style="color:gray">SYSINIT:21D4 </span>p_stack_count   <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21D4                                         </span>; local variable
<span style="color:gray">SYSINIT:21D6 </span>p_stack_size    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21D6                                         </span>; local variable
<span style="color:gray">SYSINIT:21D6                                         </span>; ;;
<span style="color:gray">SYSINIT:21D8 </span>mtrk_parms      <span style="color:navy">dw offset </span>mtrk_parmsx   <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21D8                                         </span>; multitrack = [ on | off ]
<span style="color:gray">SYSINIT:21DA                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21DB                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21DC                 </span><span style="color:navy">db &#039;</span><span style="color:green">;&#039;
</span><span style="color:gray">SYSINIT:21DD </span>mtrk_parmsx     <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21DD                                         </span>; min,max = 1 positional
<span style="color:gray">SYSINIT:21DE                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21DF                 </span><span style="color:navy">dw offset </span>mtrk_pos
<span style="color:gray">SYSINIT:21E1                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no switches
<span style="color:gray">SYSINIT:21E2                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no keywords
<span style="color:gray">SYSINIT:21E3 </span>mtrk_pos        <span style="color:navy">dw </span><span style="color:#008040">2000h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21E3                                         </span>; mtrk_pos p_pos &lt;2000h,0,result_val,on_off_string&gt;
<span style="color:gray">SYSINIT:21E3                                         </span>; simple string
<span style="color:gray">SYSINIT:21E5                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:21E7                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:21E9                 </span><span style="color:navy">dw offset </span>on_off_string
<span style="color:gray">SYSINIT:21EB                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:21EC </span>p_mtrk          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21EC                                         </span>; local variable
<span style="color:gray">SYSINIT:21EC                                         </span>; ;;
<span style="color:gray">SYSINIT:21ED </span>swit_parms      <span style="color:navy">dw offset </span>swit_parmsx   <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21ED                                         </span>; switches=/k
<span style="color:gray">SYSINIT:21EF                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21F0                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:21F1                 </span><span style="color:navy">db &#039;</span><span style="color:green">;&#039;
</span><span style="color:gray">SYSINIT:21F2 </span>swit_parmsx     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:21F2                                         </span>; no positionals
<span style="color:gray">SYSINIT:21F4                 </span><span style="color:navy">db </span><span style="color:#008040">5                    </span>; # of switches
<span style="color:gray">SYSINIT:21F5                 </span><span style="color:navy">dw offset </span>swit_k_ctrl   ; /k control
<span style="color:gray">SYSINIT:21F7                 </span><span style="color:navy">dw offset </span>swit_n_ctrl   ; /n control (for MULTI_CONFIG only)
<span style="color:gray">SYSINIT:21F9                 </span><span style="color:navy">dw offset </span>swit_f_ctrl   ; /f control (for MULTI_CONFIG only)
<span style="color:gray">SYSINIT:21FB                 </span><span style="color:navy">dw offset </span>swit_t_ctrl   ; /t control
<span style="color:gray">SYSINIT:21FD                 </span><span style="color:navy">dw offset </span>swit_w_ctrl   ; /w control
<span style="color:gray">SYSINIT:21FF                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no keywords
<span style="color:gray">SYSINIT:2200 </span>swit_k_ctrl     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2200                                         </span>; swit_k_ctrl p_pos &lt;0,0,result_val,noval,1&gt;
<span style="color:gray">SYSINIT:2200                                         </span>; switch string follows
<span style="color:gray">SYSINIT:2202                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2204                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:2206                 </span><span style="color:navy">dw offset </span>noval
<span style="color:gray">SYSINIT:2208                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2209 </span>swit_k          <span style="color:navy">db &#039;/K&#039;,0               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:220C </span>swit_n_ctrl     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:220C                                         </span>; swit_n_ctrl p_pos &lt;0,0,result_val,noval,1&gt;
<span style="color:gray">SYSINIT:220C                                         </span>; switch string follows
<span style="color:gray">SYSINIT:220E                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2210                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:2212                 </span><span style="color:navy">dw offset </span>noval
<span style="color:gray">SYSINIT:2214                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2215 </span>swit_n          <span style="color:navy">db &#039;/N&#039;,0
</span><span style="color:gray">SYSINIT:2218 </span>swit_f_ctrl     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2218                                         </span>; swit_f_ctrl p_pos &lt;0,0,result_val,noval,1&gt;
<span style="color:gray">SYSINIT:2218                                         </span>; switch string follows
<span style="color:gray">SYSINIT:221A                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:221C                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:221E                 </span><span style="color:navy">dw offset </span>noval
<span style="color:gray">SYSINIT:2220                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2221 </span>swit_f          <span style="color:navy">db &#039;/F&#039;,0
</span><span style="color:gray">SYSINIT:2224 </span>swit_t_ctrl     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2224                                         </span>; swit_t_ctrl p_pos &lt;0,0,result_val,noval,1&gt;
<span style="color:gray">SYSINIT:2224                                         </span>; switch string follows
<span style="color:gray">SYSINIT:2226                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2228                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:222A                 </span><span style="color:navy">dw offset </span>noval
<span style="color:gray">SYSINIT:222C                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:222D </span>swit_t          <span style="color:navy">db &#039;/T&#039;,0               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2230 </span>swit_w_ctrl     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2230                                         </span>; swit_w_ctrl p_pos &lt;0,0,result_val,noval,1&gt;
<span style="color:gray">SYSINIT:2230                                         </span>; switch string follows
<span style="color:gray">SYSINIT:2232                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2234                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:2236                 </span><span style="color:navy">dw offset </span>noval
<span style="color:gray">SYSINIT:2238                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2239 </span>swit_w          <span style="color:navy">db &#039;/W&#039;,0               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:223C </span>p_swit_k        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:223C                                         </span>; local variable
<span style="color:gray">SYSINIT:223D </span>p_swit_t        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:223D                                         </span>; local variable
<span style="color:gray">SYSINIT:223E </span>p_swit_w        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:223E                                         </span>; local variable
<span style="color:gray">SYSINIT:223E                                         </span>; ;;
<span style="color:gray">SYSINIT:223F </span>dos_parms       <span style="color:navy">dw offset </span>dos_parmsx    <span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:223F                                         </span>; DOS = [ high | low ]
<span style="color:gray">SYSINIT:223F                                         </span>; DOS = HIGH|LOW[,UMB|,NOUMB]
<span style="color:gray">SYSINIT:2241                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2242                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:2243                 </span><span style="color:navy">db &#039;</span><span style="color:green">;&#039;
</span><span style="color:gray">SYSINIT:2244 </span>dos_parmsx      <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2244                                         </span>; min parameters
<span style="color:gray">SYSINIT:2245                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">SYSINIT:2246                 </span><span style="color:navy">dw offset </span>dos_pos
<span style="color:gray">SYSINIT:2248                 </span><span style="color:navy">dw offset </span>dos_pos
<span style="color:olive">SYSINIT:224A                 </span><span style="color:navy">db    </span><span style="color:#008040">0                 </span>; no switches
<span style="color:olive">SYSINIT:224B                 </span><span style="color:navy">db    </span><span style="color:#008040">0                 </span>; no keywords
<span style="color:gray">SYSINIT:224C </span>dos_pos         <span style="color:navy">dw </span><span style="color:#008040">2000h                </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:224C                                         </span>; dos_pos p_pos &lt;2000h,0,result_val,dos_strings&gt;
<span style="color:gray">SYSINIT:224C                                         </span>; simple string
<span style="color:gray">SYSINIT:224E                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2250                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:2252                 </span><span style="color:navy">dw offset </span>dos_strings
<span style="color:gray">SYSINIT:2254                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2255 </span>dos_pos2        <span style="color:navy">dw </span><span style="color:#008040">2000h                </span>; dos_pos p_pos &lt;2000h,0,result_val,dos_strings&gt;
<span style="color:gray">SYSINIT:2255                                         </span>; simple string
<span style="color:gray">SYSINIT:2255                                         </span>; (this is not needed) - E.TAN - 08/07/2023
<span style="color:gray">SYSINIT:2257                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:2259                 </span><span style="color:navy">dw offset </span>result_val
<span style="color:gray">SYSINIT:225B                 </span><span style="color:navy">dw offset </span>dos_strings
<span style="color:gray">SYSINIT:225D                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:225E </span>dos_strings     <span style="color:navy">db </span><span style="color:#008040">3                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:225E                                         </span>; signals that there is a string choice
<span style="color:gray">SYSINIT:225F                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no range definition
<span style="color:gray">SYSINIT:2260                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; no numeric values choice
<span style="color:gray">SYSINIT:2261                 </span><span style="color:navy">db </span><span style="color:#008040">4                    </span>; 4 strings for choice
<span style="color:gray">SYSINIT:2262                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; the 1st string tag
<span style="color:gray">SYSINIT:2263                 </span><span style="color:navy">dw offset </span>hi_string     <span style="color:gray">; &quot;HIGH&quot;
SYSINIT:2265                 </span><span style="color:navy">db </span><span style="color:#008040">2                    </span>; the 2nd string tag
<span style="color:gray">SYSINIT:2266                 </span><span style="color:navy">dw offset </span>lo_string     <span style="color:gray">; &quot;LOW&quot;
SYSINIT:2268                 </span><span style="color:navy">db </span><span style="color:#008040">3
</span><span style="color:gray">SYSINIT:2269                 </span><span style="color:navy">dw offset </span>umb_string    <span style="color:gray">; &quot;UMB&quot;
SYSINIT:226B                 </span><span style="color:navy">db </span><span style="color:#008040">4
</span><span style="color:gray">SYSINIT:226C                 </span><span style="color:navy">dw offset </span>noumb_string  <span style="color:gray">; &quot;NOUMB&quot;
SYSINIT:226E </span>hi_string       <span style="color:navy">db &#039;HIGH&#039;,0             </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2273 </span>lo_string       <span style="color:navy">db &#039;LOW&#039;,0              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2277 </span>umb_string      <span style="color:navy">db &#039;UMB&#039;,0              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:227B </span>noumb_string    <span style="color:navy">db &#039;NOUMB&#039;,0            </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2281 </span>p_dos_hi        <span style="color:navy">db </span><span style="color:#008040">0                    </span>; local variable (parser does not use this)
<span style="color:gray">SYSINIT:2281                                         </span>;
<span style="color:gray">SYSINIT:2281                                         </span>; for LoadHigh and DeviceHigh:
<span style="color:gray">SYSINIT:2281                                         </span>;    fInHigh  - Is set to 1 during HideUMBs(), and back to zero in
<span style="color:gray">SYSINIT:2281                                         </span>;               UnHideUMBs().
<span style="color:gray">SYSINIT:2281                                         </span>;    fUmbTiny - Is set to 1 iff the user has specified /S on the
<span style="color:gray">SYSINIT:2281                                         </span>;               command line.
<span style="color:gray">SYSINIT:2281                                         </span>;    SegLoad  - Segment address for first UMB specified; set
<span style="color:gray">SYSINIT:2281                                         </span>;               automatically.
<span style="color:gray">SYSINIT:2281                                         </span>;    UmbLoad  - The load UMB number; for example, this is 3 if the
<span style="color:gray">SYSINIT:2281                                         </span>;               user has given a command-line like &quot;/L:3,500;4&quot;
<span style="color:gray">SYSINIT:2281                                         </span>;    fm_umb   - Set to the old UMB link-state (0x80 or 0x00)
<span style="color:gray">SYSINIT:2281                                         </span>;    fm_strat - Set to the old memory-allocation strategy (0$00000???)
<span style="color:gray">SYSINIT:2281                                         </span>;    fm_argc  - Number of arguments received by ParseVar()
<span style="color:gray">SYSINIT:2282 </span>fInHigh         <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2283 </span>fUmbTiny        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2284 </span>SegLoad         <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2286 </span>UmbLoad         <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2286                                         </span>; UmbUsed - An array of characters, each of which is 1 if the UMB
<span style="color:gray">SYSINIT:2286                                         </span>;           matching its index number was specified on the
<span style="color:gray">SYSINIT:2286                                         </span>;           command line;
<span style="color:gray">SYSINIT:2286                                         </span>;        for example, after &quot;/L:3,500;4;7&quot;, UmbUsed[3],[4] &amp; [7]
<span style="color:gray">SYSINIT:2286                                         </span>;        will be set to 1. All others will be set to 0.
<span style="color:gray">SYSINIT:2286                                         </span>; UmbSize - An array of words, each of which is interpereted as a
<span style="color:gray">SYSINIT:2286                                         </span>;           size specified by the user for a UMB (in the above
<span style="color:gray">SYSINIT:2286                                         </span>;           example, all elements would be zero save UmbSize[3],
<span style="color:gray">SYSINIT:2286                                         </span>;           which would be 500.
<span style="color:gray">SYSINIT:2287 </span>UmbUsed         <span style="color:navy">db </span><span style="color:#008040">16 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)            </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2287                                         </span>; times MAXUMB db 0
<span style="color:gray">SYSINIT:2297 </span>UmbSize         <span style="color:navy">dw </span><span style="color:#008040">16 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)            </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:2297                                         </span>; times MAXUMB dw 0
<span style="color:gray">SYSINIT:22B7 </span>fm_umb          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22B8 </span>fm_strat        <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:22B9 </span>fm_argc         <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22BA </span>DevSize         <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22BA                                         </span>; size of the device driver being loaded (paras)
<span style="color:gray">SYSINIT:22BC </span>DevLoadAddr     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22BC                                         </span>; Mem addr where the device driver is 2 b loaded
<span style="color:gray">SYSINIT:22BE </span>DevLoadEnd      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22BE                                         </span>; MaxAddr to which device can be loaded
<span style="color:gray">SYSINIT:22C0 </span>DevEntry        <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22C0                                         </span>; Entry point to the device driver
<span style="color:gray">SYSINIT:22C4 </span>DevBrkAddr      <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22C4                                         </span>; Break address of the device driver
<span style="color:gray">SYSINIT:22C8 </span>ConvLoad        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22C8                                         </span>; Use conventional (dos 5 style) InitDevLoad?
<span style="color:gray">SYSINIT:22C9 </span>DevUMB          <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22C9                                         </span>; byte indicating whether to load DDs in UMBs
<span style="color:gray">SYSINIT:22CA </span>DevUMBAddr      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22CA                                         </span>; current UMB used for loading devices (paras)
<span style="color:gray">SYSINIT:22CC </span>DevUMBSize      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22CC                                         </span>; Size of the current UMB being used (paras)
<span style="color:gray">SYSINIT:22CE </span>DevUMBFree      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22CE                                         </span>; Start of free mem blk in the current UMB (paras)
<span style="color:gray">SYSINIT:22D0 </span>DevXMSAddr      <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22D4 </span>DevExecAddr     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22D4                                         </span>; Device load address parameter to Exec call
<span style="color:gray">SYSINIT:22D6 </span>DevExecReloc    <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22D6                                         </span>; Device load relocation factor
<span style="color:gray">SYSINIT:22D8 </span>DeviceHi        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22D8                                         </span>; Flag indicating whether the current device
<span style="color:gray">SYSINIT:22D8                                         </span>; is being loaded into UMB
<span style="color:gray">SYSINIT:22D9 </span>DevSizeOption   <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22D9                                         </span>; SIZE= option
<span style="color:gray">SYSINIT:22DB </span>Int12Lied       <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22DB                                         </span>; did we trap int 12h ?
<span style="color:gray">SYSINIT:22DC </span>OldInt12Mem     <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22DC                                         </span>; value in 40:13h (int 12h ram)
<span style="color:gray">SYSINIT:22DE </span>ThreeComName    <span style="color:navy">db &#039;PROTMAN$&#039;           </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22DE                                         </span>; 3Com Device name
<span style="color:gray">SYSINIT:22E6 </span>FirstUMBLinked  <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22E7 </span>DevDOSData      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22E7                                         </span>; segment of DOS Data
<span style="color:gray">SYSINIT:22E9 </span>DevCmdLine      <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22E9                                         </span>; Current Command line
<span style="color:gray">SYSINIT:22ED </span>DevSavedDelim   <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22ED                                         </span>; The delimiter which was replaced with null
<span style="color:gray">SYSINIT:22ED                                         </span>; to use the file name in the command line
<span style="color:gray">SYSINIT:22EE </span>MagicHomeFlag   <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:22EE                                         </span>; set non-zero when MagicDrv is final placed
<span style="color:black">SYSINIT:22EF
SYSINIT:22EF </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:22EF
SYSINIT:22EF
SYSINIT:22EF </span>doconf          proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:22EF                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:22F0                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:22F1                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:22F1                 </span><span style="color:navy">mov     ax, </span><span style="color:green">3700h
</span><span style="color:black">SYSINIT:22F4                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ internal - GET SWITCHAR/AVAILDEV
<span style="color:black">SYSINIT:22F4                                         </span>; Return: AL = FFh unsupported subfunction
<span style="color:black">SYSINIT:22F4                                         </span>; DL = current switch character
<span style="color:black">SYSINIT:22F6                 </span><span style="color:navy">mov     byte ptr </span>offDefBlock<span style="color:navy">, dl </span><span style="color:gray">; &quot;/P&quot;
</span><span style="color:black">SYSINIT:22FA                 </span><span style="color:navy">mov     </span>bDefBlock<span style="color:navy">, dl   </span>; save default switchchar
<span style="color:black">SYSINIT:22FE                 </span><span style="color:navy">mov     dx, offset aConfig_sys </span><span style="color:gray">; &quot;\\CONFIG.SYS&quot;
</span><span style="color:black">SYSINIT:2301                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">3D00h       </span>; OPEN&lt;&lt;8
<span style="color:black">SYSINIT:2304                 </span><span style="color:navy">stc                     </span>; (in case of int 24h)
<span style="color:black">SYSINIT:2305                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - OPEN DISK FILE WITH HANDLE
<span style="color:black">SYSINIT:2305                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:black">SYSINIT:2305                                         </span>; AL = access mode
<span style="color:black">SYSINIT:2305                                         </span>; 0 - read
<span style="color:black">SYSINIT:2307                 </span><span style="color:navy">jnb     short </span><span style="color:gray">noprob    </span>; brif opened okay
<span style="color:black">SYSINIT:2307                                         </span>;
<span style="color:black">SYSINIT:2307                                         </span>; config.sys file open error
<span style="color:black">SYSINIT:2309                 </span><span style="color:navy">call    loc_83C4        </span>; we still want to give the guy
<span style="color:black">SYSINIT:2309                                         </span>; a chance to select clean boot!
<span style="color:black">SYSINIT:2309                                         </span>; (ie, no autoexec.bat processing)
<span style="color:black">SYSINIT:230C                 </span><span style="color:navy">mov     </span>multi_pass_id<span style="color:navy">, </span><span style="color:green">11 </span>; set it to unreasonable number
<span style="color:black">SYSINIT:2311                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2312 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2312
SYSINIT:2312 </span><span style="color:gray">noprob</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2312                 </span><span style="color:navy">mov     bx, ax          </span>; get file size (note &lt; 64k!!)
<span style="color:black">SYSINIT:2312                                         </span>; File handle
<span style="color:black">SYSINIT:2314                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:2316                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">SYSINIT:2318                 </span><span style="color:navy">mov     ax, </span><span style="color:green">4202h
</span><span style="color:black">SYSINIT:231B                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
<span style="color:black">SYSINIT:231B                                         </span>; AL = method: offset from end of file
<span style="color:black">SYSINIT:231D                 </span><span style="color:navy">mov     </span>count<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:2320                 </span><span style="color:navy">xor     dx, dx          </span>; reset pointer to beginning of file
<span style="color:black">SYSINIT:2322                 </span><span style="color:navy">mov     ax, </span><span style="color:green">4200h
</span><span style="color:black">SYSINIT:2325                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
<span style="color:black">SYSINIT:2325                                         </span>; AL = method: offset from beginning of file
<span style="color:black">SYSINIT:2327                 </span><span style="color:navy">mov     dx, </span>ALLOCLIM    ; use current alloclim value
<span style="color:black">SYSINIT:232B                 </span><span style="color:navy">mov     ax, </span>count
<span style="color:black">SYSINIT:232E                 </span><span style="color:navy">mov     </span>config_size<span style="color:navy">, ax </span>; save the size of config.sys file.
<span style="color:black">SYSINIT:2331                 </span><span style="color:navy">call    </span>ParaRound
<span style="color:black">SYSINIT:2334                 </span><span style="color:navy">sub     dx, ax
</span><span style="color:black">SYSINIT:2336                 </span><span style="color:navy">dec     dx              </span>; reserve 1 additional paragraph
<span style="color:black">SYSINIT:2337                 </span><span style="color:navy">mov     </span>config_wrkseg<span style="color:navy">, dx </span>; this is the segment to be used for
<span style="color:black">SYSINIT:233B                 </span><span style="color:navy">sub     dx, ax          </span>; rebuilding the config.sys memory image
<span style="color:black">SYSINIT:233D                 </span><span style="color:navy">sub     dx, </span><span style="color:#ff8000">11h         </span>; room for header
<span style="color:black">SYSINIT:2340                 </span><span style="color:navy">mov     </span>ALLOCLIM<span style="color:navy">, dx    </span>; config starts here. new alloclim value.
<span style="color:black">SYSINIT:2344                 </span><span style="color:navy">mov     </span>CONFBOT<span style="color:navy">, dx
</span><span style="color:black">SYSINIT:2348                 </span><span style="color:navy">mov     ds, dx
</span><span style="color:black">SYSINIT:234A                 </span>assume ds:nothing
<span style="color:black">SYSINIT:234A                 </span><span style="color:navy">mov     es, dx
</span><span style="color:black">SYSINIT:234C                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">SYSINIT:234E                 </span><span style="color:navy">mov     cx, cs:</span>count
<span style="color:black">SYSINIT:2353                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Fh
</span><span style="color:black">SYSINIT:2355                 </span><span style="color:navy">stc                     </span>; (in case of int 24h)
<span style="color:black">SYSINIT:2356                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - READ FROM FILE WITH HANDLE
<span style="color:black">SYSINIT:2356                                         </span>; BX = file handle, CX = number of bytes to read
<span style="color:black">SYSINIT:2356                                         </span>; DS:DX -&gt; buffer
<span style="color:black">SYSINIT:2358                 </span><span style="color:navy">pushf
</span><span style="color:black">SYSINIT:2359                 </span><span style="color:navy">push    ax              </span>; find the eof mark in the file.
<span style="color:black">SYSINIT:2359                                         </span>; if present,then trim length.
<span style="color:black">SYSINIT:235A                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:235B                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:235C                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1Ah         </span>; eof mark
<span style="color:black">SYSINIT:235E                 </span><span style="color:navy">mov     di, dx          </span>; point to buffer
<span style="color:black">SYSINIT:2360                 </span><span style="color:navy">jcxz    short </span><span style="color:gray">puteol    </span>; no chars
<span style="color:black">SYSINIT:2362                 </span><span style="color:navy">repne scasb             </span>; find end
<span style="color:black">SYSINIT:2364                 </span><span style="color:navy">jnz     short </span><span style="color:gray">puteol    </span>; none found and count exhausted
<span style="color:black">SYSINIT:2366                 </span><span style="color:navy">dec     di              </span>; backup past 1Ah
<span style="color:black">SYSINIT:2367
SYSINIT:2367 </span><span style="color:gray">puteol</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2367                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0Dh         </span>; cr,lf
<span style="color:black">SYSINIT:2369                 </span><span style="color:navy">stosb
</span><span style="color:black">SYSINIT:236A                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:236C                 </span><span style="color:navy">stosb
</span><span style="color:black">SYSINIT:236D                 </span><span style="color:navy">sub     di, dx          </span>; difference moved
<span style="color:black">SYSINIT:236F                 </span><span style="color:navy">mov     cs:</span>count<span style="color:navy">, di    </span>; new count
<span style="color:black">SYSINIT:2374                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:2375                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:2376                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:2377                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2378                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2379                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:2379                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:237A                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:black">SYSINIT:237C                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CLOSE A FILE WITH HANDLE
<span style="color:black">SYSINIT:237C                                         </span>; BX = file handle
<span style="color:black">SYSINIT:237E                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:237F                 </span><span style="color:navy">popf
</span><span style="color:black">SYSINIT:2380                 </span><span style="color:navy">jb      short </span><span style="color:gray">conferr   </span>; we&#039;ve got a problem
<span style="color:black">SYSINIT:2382                 </span><span style="color:navy">cmp     cx, ax
</span><span style="color:black">SYSINIT:2384                 </span><span style="color:navy">jz      short </span>getcom    ; if ax &lt;(&gt;) cx
<span style="color:black">SYSINIT:2384                                         </span>; couldn&#039;t read the file
<span style="color:black">SYSINIT:2386
SYSINIT:2386 </span><span style="color:gray">conferr</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2386                 </span><span style="color:navy">mov     dx, offset aConfig_sys </span><span style="color:gray">; &quot;\\CONFIG.SYS&quot;
</span><span style="color:black">SYSINIT:2389                 </span><span style="color:navy">call    loc_9044
</span><span style="color:black">SYSINIT:238C
SYSINIT:238C </span>endconv<span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:238C                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:238C </span>doconf          endp
<span style="color:black">SYSINIT:238C
SYSINIT:238D
SYSINIT:238D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:238D
SYSINIT:238D
SYSINIT:238D </span>multi_pass      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:238D
SYSINIT:238D </span><span style="color:gray">; FUNCTION CHUNK AT SYSINIT:2968 SIZE 0000012A BYTES
</span><span style="color:black">SYSINIT:238D </span><span style="color:gray">; FUNCTION CHUNK AT SYSINIT:2AA6 SIZE 000002B7 BYTES
</span><span style="color:black">SYSINIT:238D </span><span style="color:gray">; FUNCTION CHUNK AT SYSINIT:2DAB SIZE 0000000C BYTES
</span><span style="color:black">SYSINIT:238D
SYSINIT:238D                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:238E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:238F                 </span><span style="color:navy">cmp     </span>multi_pass_id<span style="color:navy">, </span><span style="color:green">10 </span>; do nothing. just return.
<span style="color:black">SYSINIT:2394
SYSINIT:2394 </span><span style="color:gray">jae_endconv</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2394                 </span><span style="color:navy">jnb     short </span>endconv
<span style="color:black">SYSINIT:2396                 </span><span style="color:navy">push    </span>CONFBOT
<span style="color:black">SYSINIT:239A                 </span><span style="color:navy">pop     es              </span>; es = [confbot] (CONFIG.SYS image seg)
<span style="color:black">SYSINIT:239B                 </span><span style="color:navy">mov     si, </span>org_count   ; set count
<span style="color:black">SYSINIT:239F                 </span><span style="color:navy">mov     </span>count<span style="color:navy">, si
</span><span style="color:black">SYSINIT:23A3                 </span><span style="color:navy">xor     si, si          </span>; 0
<span style="color:black">SYSINIT:23A5                 </span><span style="color:navy">mov     </span>chrptr<span style="color:navy">, si      </span>; reset chrptr
<span style="color:black">SYSINIT:23A9                 </span><span style="color:navy">mov     </span>linecount<span style="color:navy">, si   </span>; reset linecount
<span style="color:black">SYSINIT:23AD                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:23B0                 </span><span style="color:navy">jmp     short </span>conflp
<span style="color:black">SYSINIT:23B2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:23B2
SYSINIT:23B2 </span>getcom<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:23B2                 </span><span style="color:navy">call    </span>org3            ; organize the file
<span style="color:black">SYSINIT:23B5                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:23B8
SYSINIT:23B8 </span>conflp<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:23B8                 </span><span style="color:navy">jb      short </span>endconv
<span style="color:black">SYSINIT:23BA                 </span><span style="color:navy">inc     </span>linecount       ; increase linecount
<span style="color:black">SYSINIT:23BE                 </span><span style="color:navy">mov     </span>multdeviceflag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; reset multdeviceflag.
<span style="color:black">SYSINIT:23C3                 </span><span style="color:navy">mov     </span>setdevmarkflag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; reset setdevmarkflag.
<span style="color:black">SYSINIT:23C8                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah         </span>; lf ; linefeed?
<span style="color:black">SYSINIT:23CA                 </span><span style="color:navy">jz      short </span><span style="color:gray">blank_line </span>; then ignore this line.
<span style="color:black">SYSINIT:23CA                                         </span>;
<span style="color:black">SYSINIT:23CA                                         </span>; If this is a genuine CONFIG.SYS command,
<span style="color:black">SYSINIT:23CA                                         </span>; then there should be a line number
<span style="color:black">SYSINIT:23CA                                         </span>; immediately following it
<span style="color:black">SYSINIT:23CC                 </span><span style="color:navy">mov     </span>config_cmd<span style="color:navy">, al  </span>; save original command code
<span style="color:black">SYSINIT:23CF                 </span><span style="color:navy">and     al, </span><span style="color:green">7Fh         </span>; ~CONFIG_OPTION_QUERY
<span style="color:black">SYSINIT:23D1                 </span><span style="color:navy">cmp     </span>config_multi<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; is this a multi-config config.sys?
<span style="color:black">SYSINIT:23D6                 </span><span style="color:navy">jz      short </span><span style="color:gray">not_final </span>; no, line number is not embedded
<span style="color:black">SYSINIT:23D8                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:23D9                 </span><span style="color:navy">call    </span>getchr          ; ignore end-of-image errors
<span style="color:black">SYSINIT:23DC                 </span><span style="color:navy">mov     ah, al          </span>; because if there&#039;s an error
<span style="color:black">SYSINIT:23DE                 </span><span style="color:navy">call    </span>getchr          ; fetching the line number that&#039;s
<span style="color:black">SYSINIT:23E1                 </span><span style="color:navy">xchg    al, ah          </span>; supposed to be there, the next
<span style="color:black">SYSINIT:23E3                 </span><span style="color:navy">mov     </span>linecount<span style="color:navy">, ax   </span>; getchr call will get the same error
<span style="color:black">SYSINIT:23E6                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:23E7                 </span><span style="color:navy">cmp     </span>multi_pass_id<span style="color:navy">, </span><span style="color:#ff8000">2 </span>; final pass?
<span style="color:black">SYSINIT:23EC                 </span><span style="color:navy">jb      short </span><span style="color:gray">not_final </span>; no
<span style="color:black">SYSINIT:23EE                 </span><span style="color:navy">test    </span>install_flag<span style="color:navy">, </span><span style="color:green">1 </span>; have_install_cmd
<span style="color:black">SYSINIT:23EE                                         </span>; are there install commands?
<span style="color:black">SYSINIT:23F4                 </span><span style="color:navy">jz      short </span><span style="color:gray">final     </span>; no install cmds, yes it is
<span style="color:black">SYSINIT:23F6                 </span><span style="color:navy">cmp     </span>multi_pass_id<span style="color:navy">, </span><span style="color:#ff8000">3 </span>; final pass?
<span style="color:black">SYSINIT:23FB                 </span><span style="color:navy">jb      short </span><span style="color:gray">not_final </span>; no
<span style="color:black">SYSINIT:23FD
SYSINIT:23FD </span><span style="color:gray">final</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:23FD                 </span><span style="color:navy">mov     es:[si], al     </span>; save backward-compatible command code
<span style="color:black">SYSINIT:2400
SYSINIT:2400 </span><span style="color:gray">not_final</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2400                 </span><span style="color:navy">mov     ah, al
</span><span style="color:black">SYSINIT:2402                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:2405                 </span><span style="color:navy">jnb     short </span><span style="color:gray">tryi
</span><span style="color:black">SYSINIT:2407                 </span><span style="color:navy">cmp     </span>multi_pass_id<span style="color:navy">, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:240C                 </span><span style="color:navy">jnb     short </span><span style="color:gray">jae_endconv </span>; it would be &#039;jnb short endconv&#039;
<span style="color:black">SYSINIT:240C                                         </span>; (E.TAN - 09/07/2023)
<span style="color:black">SYSINIT:240C                                         </span>; do not show badop again for multi_pass.
<span style="color:black">SYSINIT:240E                 </span><span style="color:navy">jmp     loc_6DDB
</span><span style="color:black">SYSINIT:2411 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2411
SYSINIT:2411 </span>coff<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2411                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2412                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2413                 </span><span style="color:navy">call    loc_8D6D
</span><span style="color:black">SYSINIT:2416                 </span><span style="color:navy">jmp     short </span>conflp
<span style="color:black">SYSINIT:2418 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2418
SYSINIT:2418 </span><span style="color:gray">blank_line</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2418                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:241B                 </span><span style="color:navy">jmp     short </span>conflp
<span style="color:black">SYSINIT:241D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:241D                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:241E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:241F
SYSINIT:241F </span><span style="color:gray">tryi</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:241F                 </span><span style="color:navy">cmp     </span>multi_pass_id<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; the initial pass for DOS=HI
<span style="color:black">SYSINIT:2424                 </span><span style="color:navy">jnz     short </span><span style="color:gray">not_init_pass
</span><span style="color:black">SYSINIT:2426                 </span><span style="color:navy">jmp     </span><span style="color:gray">multi_try_doshi
</span><span style="color:black">SYSINIT:2429 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2429
SYSINIT:2429 </span><span style="color:gray">not_init_pass</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2429                 </span><span style="color:navy">cmp     </span>multi_pass_id<span style="color:navy">, </span><span style="color:#ff8000">2 </span>; the second pass was for ifs=
<span style="color:black">SYSINIT:242E                 </span><span style="color:navy">jz      short </span><span style="color:gray">multi_pass_coff2 </span>; now it is NOPs
<span style="color:black">SYSINIT:242E                                         </span>;
<span style="color:black">SYSINIT:242E                                         </span>; This pass can be made use of if
<span style="color:black">SYSINIT:242E                                         </span>; we want do some config.sys process
<span style="color:black">SYSINIT:242E                                         </span>; after device drivers are loaded and
<span style="color:black">SYSINIT:242E                                         </span>; before install= commands are processed
<span style="color:black">SYSINIT:2430                 </span><span style="color:navy">cmp     </span>multi_pass_id<span style="color:navy">, </span><span style="color:#ff8000">3 </span>; the third pass for install= ?
<span style="color:black">SYSINIT:2435                 </span><span style="color:navy">jz      short </span><span style="color:gray">multi_try_i
</span><span style="color:black">SYSINIT:2437                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">48h </span><span style="color:gray">; &#039;H&#039;   </span>; CONFIG_DOS
<span style="color:black">SYSINIT:243A                 </span><span style="color:navy">jz      short </span><span style="color:gray">multi_pass_coff2
</span><span style="color:black">SYSINIT:243C                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">49h </span><span style="color:gray">; &#039;I&#039;   </span>; CONFIG_INSTALL ; install= command?
<span style="color:black">SYSINIT:243F                 </span><span style="color:navy">jnz     short </span><span style="color:gray">precheck_installhigh </span>;
<span style="color:black">SYSINIT:243F                                         </span>; the first pass is for normal operation.
<span style="color:black">SYSINIT:2441                 </span><span style="color:navy">or      </span>install_flag<span style="color:navy">, </span><span style="color:green">1 </span>; have_install_cmd ; set the flag
<span style="color:black">SYSINIT:2446
SYSINIT:2446 </span><span style="color:gray">multi_pass_coff2</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2446                 </span><span style="color:navy">jmp     short </span>coff      ; and handles the next command
<span style="color:black">SYSINIT:2448 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2448
SYSINIT:2448 </span><span style="color:gray">precheck_installhigh</span><span style="color:navy">:                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2448                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">57h </span><span style="color:gray">; &#039;W&#039;   </span>; CONFIG_INSTALLHIGH ; signifier for INSTALLHIGH
<span style="color:black">SYSINIT:244B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">tryb      </span>; carry on with normal processing
<span style="color:black">SYSINIT:244D                 </span><span style="color:navy">or      </span>install_flag<span style="color:navy">, </span><span style="color:green">1 </span>; have_install_cmd
<span style="color:black">SYSINIT:2452                 </span><span style="color:navy">jmp     short </span>coff
<span style="color:black">SYSINIT:2454 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2454
SYSINIT:2454 </span><span style="color:gray">multi_try_i</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2454                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">49h </span><span style="color:gray">; &#039;I&#039;   </span>; CONFIG_INSTALL ; install= command?
<span style="color:black">SYSINIT:2457                 </span><span style="color:navy">jnz     short </span><span style="color:gray">multi_try_n </span>; no, check for installhigh
<span style="color:black">SYSINIT:2459                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:245C                 </span><span style="color:navy">jb      short </span><span style="color:gray">multi_pass_filter </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:245E                 </span><span style="color:navy">call    </span>do_install_exec ; install it.
<span style="color:black">SYSINIT:2461                 </span><span style="color:navy">jmp     short </span>coff      ; to handle next install= command.
<span style="color:black">SYSINIT:2463 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2463
SYSINIT:2463 </span><span style="color:gray">multi_try_n</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2463                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">57h </span><span style="color:gray">; &#039;W&#039;   </span>; CONFIG_INSTALLHIGH ; installhigh= command?
<span style="color:black">SYSINIT:2466                 </span><span style="color:navy">jnz     short </span><span style="color:gray">multi_pass_filter
</span><span style="color:black">SYSINIT:2468                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:246B                 </span><span style="color:navy">jb      short </span><span style="color:gray">multi_pass_filter </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:246D                 </span><span style="color:navy">mov     ax, </span><span style="color:green">5800h
</span><span style="color:black">SYSINIT:2470                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:2470                                         </span>; AL = function code: get allocation strategy
<span style="color:black">SYSINIT:2472                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:black">SYSINIT:2474                 </span><span style="color:navy">push    bx              </span>; save for the return
<span style="color:black">SYSINIT:2475                 </span><span style="color:navy">or      bx, </span><span style="color:green">80h         </span>; HIGH_FIRST ; set alloc to HighFirst
<span style="color:black">SYSINIT:2479                 </span><span style="color:navy">mov     ax, </span><span style="color:green">5801h       </span>; (ALLOCOPER&lt;&lt;8)|1
<span style="color:black">SYSINIT:247C                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:247C                                         </span>; AL = function code: set allocation strategy
<span style="color:black">SYSINIT:247E                 </span><span style="color:navy">mov     ax, </span><span style="color:green">5802h
</span><span style="color:black">SYSINIT:2481                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:2481                                         </span>; AL = function code: (DOS 5beta) get UMB link state
<span style="color:black">SYSINIT:2483                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">SYSINIT:2485                 </span><span style="color:navy">push    ax              </span>; save for the return
<span style="color:black">SYSINIT:2486                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">5803h       </span>; (ALLOCOPER&lt;&lt;8)|3
<span style="color:black">SYSINIT:2489                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">1           </span>; link in UMBs
<span style="color:black">SYSINIT:248C                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:248C                                         </span>; AL = function code: (DOS 5beta) set UMB link state
<span style="color:black">SYSINIT:248E                 </span><span style="color:navy">call    </span>do_install_exec ; install it.
<span style="color:black">SYSINIT:2491                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">5803h
</span><span style="color:black">SYSINIT:2494                 </span><span style="color:navy">pop     bx              </span>; recover original link state
<span style="color:black">SYSINIT:2495                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:2495                                         </span>; AL = function code: (DOS 5beta) set UMB link state
<span style="color:black">SYSINIT:2497                 </span><span style="color:navy">pop     bx              </span>; recover original alloc strategy
<span style="color:black">SYSINIT:2498                 </span><span style="color:navy">mov     ax, </span><span style="color:green">5801h
</span><span style="color:black">SYSINIT:249B                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:249B                                         </span>; AL = function code: set allocation strategy
<span style="color:black">SYSINIT:249D                 </span><span style="color:navy">jmp     </span>coff            ; to handle next install= commands.
<span style="color:black">SYSINIT:24A0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:24A0
SYSINIT:24A0 </span><span style="color:gray">multi_pass_filter</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:24A0                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">59h </span><span style="color:gray">; &#039;Y&#039;   </span>; CONFIG_COMMENT ; comment?
<span style="color:black">SYSINIT:24A3                 </span><span style="color:navy">jz      short </span><span style="color:gray">multi_pass_adjust
</span><span style="color:black">SYSINIT:24A5                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;   </span>; CONFIG_UNKNOWN ; bad command?
<span style="color:black">SYSINIT:24A8                 </span><span style="color:navy">jz      short </span><span style="color:gray">multi_pass_adjust
</span><span style="color:black">SYSINIT:24AA                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;   </span>; CONFIG_REM ; rem?
<span style="color:black">SYSINIT:24AD                 </span><span style="color:navy">jnz     short </span><span style="color:gray">multi_pass_coff </span>; ignore the rest of the commands.
<span style="color:black">SYSINIT:24AF
SYSINIT:24AF </span><span style="color:gray">multi_pass_adjust</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:24AF                 </span><span style="color:navy">dec     </span>chrptr          ; these commands need to
<span style="color:black">SYSINIT:24AF                                         </span>; adjust chrptr,count
<span style="color:black">SYSINIT:24B3                 </span><span style="color:navy">inc     </span>count           ; for newline proc.
<span style="color:black">SYSINIT:24B7
SYSINIT:24B7 </span><span style="color:gray">multi_pass_coff</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:24B7                 </span><span style="color:navy">jmp     </span>coff            ; to handle next install= commands.
<span style="color:black">SYSINIT:24BA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:24BA
SYSINIT:24BA </span><span style="color:gray">tryb</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:24BA                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">42h </span><span style="color:gray">; &#039;B&#039;   </span>; CONFIG_BUFFERS
<span style="color:black">SYSINIT:24BD                 </span><span style="color:navy">jnz     short </span><span style="color:gray">tryc
</span><span style="color:black">SYSINIT:24BF                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:24BF                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:24C2                 </span><span style="color:navy">jb      short </span><span style="color:gray">tryc
</span><span style="color:black">SYSINIT:24C4                 </span><span style="color:navy">mov     </span>p_buffer_slash_x<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:24C9                 </span><span style="color:navy">mov     di, offset </span>buf_parms
<span style="color:black">SYSINIT:24CC                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:24CE                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:24D0
SYSINIT:24D0 </span><span style="color:gray">do7</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:24D0                 </span><span style="color:navy">call    </span>sysinit_parse
<span style="color:black">SYSINIT:24D3                 </span><span style="color:navy">jnb     short </span><span style="color:gray">if7       </span>;
<span style="color:black">SYSINIT:24D3                                         </span>; parse error,
<span style="color:black">SYSINIT:24D3                                         </span>; and show messages and end the search
<span style="color:black">SYSINIT:24D5                 </span><span style="color:navy">call    </span>badparm_p
<span style="color:black">SYSINIT:24D8                 </span><span style="color:navy">jmp     short </span><span style="color:gray">sr7
</span><span style="color:black">SYSINIT:24DA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:24DA
SYSINIT:24DA </span><span style="color:gray">if7</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:24DA                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:24DD                 </span><span style="color:navy">jz      short </span><span style="color:gray">en7       </span>; then jmp to $endloop for semantic check
<span style="color:black">SYSINIT:24DF                 </span><span style="color:navy">cmp     </span>result_val_swoff<span style="color:navy">, offset </span>switch_x ; (/X switch)
<span style="color:black">SYSINIT:24DF                                         </span>; [result_val+_$P_Result_Blk.SYNONYM_Ptr]
<span style="color:black">SYSINIT:24E5                 </span><span style="color:navy">jnz     short </span><span style="color:gray">if11
</span><span style="color:black">SYSINIT:24E7                 </span><span style="color:navy">jmp     short </span><span style="color:gray">en11
</span><span style="color:black">SYSINIT:24E9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:24E9
SYSINIT:24E9 </span><span style="color:gray">if11</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:24E9                 </span><span style="color:navy">mov     ax, word ptr </span>rv_dword ; [result_val+_$P_Result_Blk.Picked_Val]
<span style="color:black">SYSINIT:24EC                 </span><span style="color:navy">cmp     cx, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:24EF                 </span><span style="color:navy">jnz     short </span><span style="color:gray">if13
</span><span style="color:black">SYSINIT:24F1                 </span><span style="color:navy">mov     </span>p_buffers<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:24F4                 </span><span style="color:navy">jmp     short </span><span style="color:gray">en11
</span><span style="color:black">SYSINIT:24F6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:24F6
SYSINIT:24F6 </span><span style="color:gray">if13</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:24F6                 </span><span style="color:navy">mov     </span>p_h_buffers<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:24F9
SYSINIT:24F9 </span><span style="color:gray">en11</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:24F9                 </span><span style="color:navy">jmp     short </span><span style="color:gray">do7
</span><span style="color:black">SYSINIT:24FB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:24FB
SYSINIT:24FB </span><span style="color:gray">en7</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:24FB                 </span><span style="color:navy">cmp     </span>p_buffers<span style="color:navy">, </span><span style="color:green">99
</span><span style="color:black">SYSINIT:2500                 </span><span style="color:navy">jbe     short </span><span style="color:gray">if18
</span><span style="color:black">SYSINIT:2502                 </span><span style="color:navy">call    </span>badparm_p
<span style="color:black">SYSINIT:2505                 </span><span style="color:navy">mov     </span>p_h_buffers<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:250B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">sr7
</span><span style="color:black">SYSINIT:250D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:250D
SYSINIT:250D </span><span style="color:gray">if18</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:250D                 </span><span style="color:navy">mov     ax, </span>p_buffers   ; we don&#039;t have any problem.
<span style="color:black">SYSINIT:2510                 </span><span style="color:navy">mov     </span>buffers<span style="color:navy">, ax     </span>; now,let&#039;s set it really.
<span style="color:black">SYSINIT:2513                 </span><span style="color:navy">mov     ax, </span>p_h_buffers
<span style="color:black">SYSINIT:2516                 </span><span style="color:navy">mov     </span>h_buffers<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:2519                 </span><span style="color:navy">mov     ax, </span>linecount
<span style="color:black">SYSINIT:251C                 </span><span style="color:navy">mov     </span>buffer_linenum<span style="color:navy">, ax </span>; save the line number
<span style="color:black">SYSINIT:251C                                         </span>; for the future use
<span style="color:black">SYSINIT:251F
SYSINIT:251F </span><span style="color:gray">sr7</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:251F                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2522 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2522
SYSINIT:2522 </span><span style="color:gray">tryc</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2522                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">43h </span><span style="color:gray">; &#039;C&#039;   </span>; CONFIG_BREAK
<span style="color:black">SYSINIT:2525                 </span><span style="color:navy">jnz     short </span><span style="color:gray">trym
</span><span style="color:black">SYSINIT:2527                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2527                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:252A                 </span><span style="color:navy">jb      short </span><span style="color:gray">trym
</span><span style="color:black">SYSINIT:252C                 </span><span style="color:navy">mov     di, offset </span>brk_parms
<span style="color:black">SYSINIT:252F                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:2531                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:2533
SYSINIT:2533 </span><span style="color:gray">do22</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2533                 </span><span style="color:navy">call    </span>sysinit_parse
<span style="color:black">SYSINIT:2536                 </span><span style="color:navy">jnb     short </span><span style="color:gray">if22      </span>;
<span style="color:black">SYSINIT:2536                                         </span>; parse error
<span style="color:black">SYSINIT:2538                 </span><span style="color:navy">call    </span>badparm_p
<span style="color:black">SYSINIT:253B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">sr22
</span><span style="color:black">SYSINIT:253D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:253D
SYSINIT:253D </span><span style="color:gray">if22</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:253D                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:2540                 </span><span style="color:navy">jz      short </span><span style="color:gray">en22      </span>; then end the $endloop
<span style="color:black">SYSINIT:2542                 </span><span style="color:navy">cmp     </span>result_val_itag<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; [result_val+_$P_Result_Blk.Item_Tag]
<span style="color:black">SYSINIT:2547                 </span><span style="color:navy">jnz     short </span><span style="color:gray">if26
</span><span style="color:black">SYSINIT:2549                 </span><span style="color:navy">mov     </span>p_ctrl_break<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; turn it on
<span style="color:black">SYSINIT:254E                 </span><span style="color:navy">jmp     short </span><span style="color:gray">en26
</span><span style="color:black">SYSINIT:2550 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2550
SYSINIT:2550 </span><span style="color:gray">if26</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2550                 </span><span style="color:navy">mov     </span>p_ctrl_break<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; turn it off
<span style="color:black">SYSINIT:2555
SYSINIT:2555 </span><span style="color:gray">en26</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2555                 </span><span style="color:navy">jmp     short </span><span style="color:gray">do22      </span>; we actually set the ctrl break
<span style="color:black">SYSINIT:2557 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2557
SYSINIT:2557 </span><span style="color:gray">en22</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2557                 </span><span style="color:navy">mov     ah, </span><span style="color:green">33h         </span>; SET_CTRL_C_TRAPPING
<span style="color:black">SYSINIT:2557                                         </span>; if we don&#039;t have any parse error.
<span style="color:black">SYSINIT:2559                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:255B                 </span><span style="color:navy">mov     dl, </span>p_ctrl_break
<span style="color:black">SYSINIT:255F                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - EXTENDED CONTROL-BREAK CHECKING
<span style="color:black">SYSINIT:255F                                         </span>; AL = 00h get state / 01h set state / 02h set AND get
<span style="color:black">SYSINIT:255F                                         </span>; DL = 00h for OFF or 01h for ON
<span style="color:black">SYSINIT:2561
SYSINIT:2561 </span><span style="color:gray">sr22</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2561                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2564 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2564
SYSINIT:2564 </span><span style="color:gray">trym</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2564                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">4Dh </span><span style="color:gray">; &#039;M&#039;   </span>; CONFIG_MULTITRACK
<span style="color:black">SYSINIT:2567                 </span><span style="color:navy">jnz     short </span><span style="color:gray">tryu
</span><span style="color:black">SYSINIT:2569                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2569                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:256C                 </span><span style="color:navy">jb      short </span><span style="color:gray">tryu
</span><span style="color:black">SYSINIT:256E                 </span><span style="color:navy">mov     di, offset </span>mtrk_parms
<span style="color:black">SYSINIT:2571                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:2573                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:2575
SYSINIT:2575 </span><span style="color:gray">do31</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2575                 </span><span style="color:navy">call    </span>sysinit_parse
<span style="color:black">SYSINIT:2578                 </span><span style="color:navy">jnb     short </span><span style="color:gray">if31      </span>;
<span style="color:black">SYSINIT:2578                                         </span>; parse_error
<span style="color:black">SYSINIT:257A                 </span><span style="color:navy">call    </span>badparm_p       ; show message and end the search loop.
<span style="color:black">SYSINIT:257D                 </span><span style="color:navy">jmp     short </span><span style="color:gray">sr31
</span><span style="color:black">SYSINIT:257F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:257F
SYSINIT:257F </span><span style="color:gray">if31</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:257F                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:2582                 </span><span style="color:navy">jz      short </span><span style="color:gray">en31
</span><span style="color:black">SYSINIT:2584                 </span><span style="color:navy">cmp     </span>result_val_itag<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; [result_val+_$P_Result_Blk.Item_Tag]
<span style="color:black">SYSINIT:2589                 </span><span style="color:navy">jnz     short </span><span style="color:gray">if35
</span><span style="color:black">SYSINIT:258B                 </span><span style="color:navy">mov     </span>p_mtrk<span style="color:navy">, </span><span style="color:#ff8000">1       </span>; turn it on temporarily.
<span style="color:black">SYSINIT:2590                 </span><span style="color:navy">jmp     short </span><span style="color:gray">en35
</span><span style="color:black">SYSINIT:2592 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2592
SYSINIT:2592 </span><span style="color:gray">if35</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2592                 </span><span style="color:navy">mov     </span>p_mtrk<span style="color:navy">, </span><span style="color:#ff8000">0       </span>; turn it off temporarily.
<span style="color:black">SYSINIT:2597
SYSINIT:2597 </span><span style="color:gray">en35</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2597                 </span><span style="color:navy">jmp     short </span><span style="color:gray">do31      </span>; we actually set the multrk_flag here
<span style="color:black">SYSINIT:2599 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2599
SYSINIT:2599 </span><span style="color:gray">en31</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2599                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:259A                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h         </span>; DOSBIODATASEG ; BIOSDATA segment
<span style="color:black">SYSINIT:259D                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:259F                 </span>assume ds:nothing
<span style="color:black">SYSINIT:259F                 </span><span style="color:navy">cmp     cs:</span>p_mtrk<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:25A5                 </span><span style="color:navy">jnz     short </span><span style="color:gray">if39
</span><span style="color:black">SYSINIT:25A7                 </span><span style="color:navy">mov     ds:</span>multrk_flag<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; multrk_off2
<span style="color:black">SYSINIT:25AD                 </span><span style="color:navy">jmp     short </span><span style="color:gray">en39
</span><span style="color:black">SYSINIT:25AF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:25AF
SYSINIT:25AF </span><span style="color:gray">if39</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:25AF                 </span><span style="color:navy">mov     ds:</span>multrk_flag<span style="color:navy">, </span><span style="color:green">80h </span>; multrk_on
<span style="color:black">SYSINIT:25B5
SYSINIT:25B5 </span><span style="color:gray">en39</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:25B5                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:25B6                 </span>assume ds:nothing
<span style="color:black">SYSINIT:25B6
SYSINIT:25B6 </span><span style="color:gray">sr31</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:25B6                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:25B9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:25B9
SYSINIT:25B9 </span><span style="color:gray">multi_try_doshi</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:25B9                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">48h </span><span style="color:gray">; &#039;H&#039;   </span>; CONFIG_DOS
<span style="color:black">SYSINIT:25BC                 </span><span style="color:navy">jz      short </span><span style="color:gray">it_is_h
</span><span style="color:black">SYSINIT:25BE
SYSINIT:25BE </span><span style="color:gray">skip_it</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:25BE                 </span><span style="color:navy">jmp     </span><span style="color:gray">multi_pass_filter
</span><span style="color:black">SYSINIT:25C1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:25C1
SYSINIT:25C1 </span><span style="color:gray">it_is_h</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:25C1                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:25C1                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:25C4                 </span><span style="color:navy">jb      short </span><span style="color:gray">skip_it
</span><span style="color:black">SYSINIT:25C6                 </span><span style="color:navy">mov     di, offset </span>dos_parms
<span style="color:black">SYSINIT:25C9                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:25CB                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:25CD
SYSINIT:25CD </span><span style="color:gray">h_do_parse</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:25CD                 </span><span style="color:navy">call    </span>sysinit_parse
<span style="color:black">SYSINIT:25D0                 </span><span style="color:navy">jnb     short </span><span style="color:gray">h_parse_ok
</span><span style="color:black">SYSINIT:25D2
SYSINIT:25D2 </span>h_badparm<span style="color:navy">:                              </span>; parse error
<span style="color:black">SYSINIT:25D2                 </span><span style="color:navy">call    </span>badparm_p       ; show message and end the search loop.
<span style="color:black">SYSINIT:25D5                 </span><span style="color:navy">jmp     short </span><span style="color:gray">h_end
</span><span style="color:black">SYSINIT:25D7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:25D7
SYSINIT:25D7 </span><span style="color:gray">h_parse_ok</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:25D7                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:25DA                 </span><span style="color:navy">jz      short </span><span style="color:gray">h_end     </span>; then end the $endloop
<span style="color:black">SYSINIT:25DC                 </span><span style="color:navy">call    </span>ProcDOS
<span style="color:black">SYSINIT:25DF                 </span><span style="color:navy">jmp     short </span><span style="color:gray">h_do_parse
</span><span style="color:black">SYSINIT:25E1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:25E1
SYSINIT:25E1 </span><span style="color:gray">h_end</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:25E1                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:25E4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:25E4
SYSINIT:25E4 </span><span style="color:gray">tryu</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:25E4                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">55h </span><span style="color:gray">; &#039;U&#039;   </span>; CONFIG_DEVICEHIGH
<span style="color:black">SYSINIT:25E7                 </span><span style="color:navy">jnz     short </span><span style="color:gray">tryd
</span><span style="color:black">SYSINIT:25E9                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:25E9                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:25EC                 </span><span style="color:navy">jb      short </span><span style="color:gray">tryd
</span><span style="color:black">SYSINIT:25EE                 </span><span style="color:navy">call    </span>InitVar
<span style="color:black">SYSINIT:25F1                 </span><span style="color:navy">call    </span>ParseSize       ; process the size= option
<span style="color:black">SYSINIT:25F4                 </span><span style="color:navy">jnb     short </span><span style="color:gray">tryu_1    </span>;
<span style="color:black">SYSINIT:25F4                                         </span>; stash it there in case of an error
<span style="color:black">SYSINIT:25F6                 </span><span style="color:navy">mov     word ptr cs:</span>badparm_ptr<span style="color:navy">, si
</span><span style="color:black">SYSINIT:25FB                 </span><span style="color:navy">mov     word ptr cs:</span>badparm_ptr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">SYSINIT:2600                 </span><span style="color:navy">call    </span>badparm_p
<span style="color:black">SYSINIT:2603                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2606 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2606
SYSINIT:2606 </span><span style="color:gray">tryu_1</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2606                 </span><span style="color:navy">mov     ax, cs:</span>DevSizeOption
<span style="color:black">SYSINIT:260A                 </span><span style="color:navy">or      ax, ax
</span><span style="color:black">SYSINIT:260C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">tryu_2
</span><span style="color:black">SYSINIT:260E                 </span><span style="color:navy">call    </span>ParseVar
<span style="color:black">SYSINIT:2611                 </span><span style="color:navy">jnb     short </span><span style="color:gray">tryu_2
</span><span style="color:black">SYSINIT:2613                 </span><span style="color:navy">mov     word ptr cs:</span>badparm_ptr<span style="color:navy">, si </span>;
<span style="color:black">SYSINIT:2613                                         </span>; If ParseVar up there failed, then
<span style="color:black">SYSINIT:2613                                         </span>; ES:SI points to its problem area..
<span style="color:black">SYSINIT:2618                 </span><span style="color:navy">mov     word ptr cs:</span>badparm_ptr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">SYSINIT:261D                 </span><span style="color:navy">call    </span>badparm_p       ; so all we have to do is choke and
<span style="color:black">SYSINIT:261D                                         </span>; die, rather verbosely.
<span style="color:black">SYSINIT:2620                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2623 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2623
SYSINIT:2623 </span><span style="color:gray">tryu_2</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2623                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:2624                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:2625
SYSINIT:2625 </span><span style="color:gray">tryu_3</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2625                 </span><span style="color:navy">mov     al, es:[si]
</span><span style="color:black">SYSINIT:2628                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh         </span>; cr
<span style="color:black">SYSINIT:262A                 </span><span style="color:navy">jz      short </span><span style="color:gray">tryu_4
</span><span style="color:black">SYSINIT:262C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah         </span>; lf
<span style="color:black">SYSINIT:262E                 </span><span style="color:navy">jz      short </span><span style="color:gray">tryu_4
</span><span style="color:black">SYSINIT:2630                 </span><span style="color:navy">call    loc_8D51
</span><span style="color:black">SYSINIT:2633                 </span><span style="color:navy">jz      short </span><span style="color:gray">tryu_4
</span><span style="color:black">SYSINIT:2635                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:2636                 </span><span style="color:navy">jmp     short </span><span style="color:gray">tryu_3
</span><span style="color:black">SYSINIT:2638 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2638
SYSINIT:2638 </span><span style="color:gray">tryu_4</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2638                 </span><span style="color:navy">mov     cs:</span>DevSavedDelim<span style="color:navy">, al </span>; Save the delimiter
<span style="color:black">SYSINIT:2638                                         </span>; before replacing it with null
<span style="color:black">SYSINIT:263C                 </span><span style="color:navy">mov     byte ptr es:[si], </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2640                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2641                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:2642                 </span><span style="color:navy">call    </span>UmbTest         ; See if UMBs are around...
<span style="color:black">SYSINIT:2645                 </span><span style="color:navy">jnb     short </span><span style="color:gray">NrmTst    </span>; yep. So do that normal thang.
<span style="color:black">SYSINIT:2647                 </span><span style="color:navy">mov     cs:</span>DeviceHi<span style="color:navy">, </span><span style="color:#ff8000">0  </span>; nope... so load low.
<span style="color:black">SYSINIT:264D                 </span><span style="color:navy">jmp     short </span><span style="color:gray">LoadDevice
</span><span style="color:black">SYSINIT:264F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:264F
SYSINIT:264F </span><span style="color:gray">NrmTst</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:264F                 </span><span style="color:navy">mov     cs:</span>DeviceHi<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2655                 </span><span style="color:navy">cmp     cs:</span>DevUMB<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; do we support UMBs ?
<span style="color:black">SYSINIT:265B                 </span><span style="color:navy">jz      short </span><span style="color:gray">LoadDevice </span>; no, we don&#039;t
<span style="color:black">SYSINIT:265D                 </span><span style="color:navy">mov     cs:</span>DeviceHi<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:2663                 </span><span style="color:navy">jmp     short </span><span style="color:gray">LoadDevice
</span><span style="color:black">SYSINIT:2665 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2665
SYSINIT:2665 </span><span style="color:gray">tryd</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2665                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">44h </span><span style="color:gray">; &#039;D&#039;   </span>; CONFIG_DEVICE
<span style="color:black">SYSINIT:2668                 </span><span style="color:navy">jz      short </span><span style="color:gray">gotd
</span><span style="color:black">SYSINIT:266A
SYSINIT:266A </span><span style="color:gray">skip_it2</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:266A                 </span><span style="color:navy">jmp     loc_69A6
</span><span style="color:black">SYSINIT:266D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:266D
SYSINIT:266D </span><span style="color:gray">gotd</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:266D                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:266D                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2670                 </span><span style="color:navy">jb      short </span><span style="color:gray">skip_it2
</span><span style="color:black">SYSINIT:2672                 </span><span style="color:navy">mov     cs:</span>DeviceHi<span style="color:navy">, </span><span style="color:#ff8000">0  </span>; not to be loaded in UMB
<span style="color:black">SYSINIT:2678                 </span><span style="color:navy">mov     cs:</span>DevSizeOption<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:267F                 </span><span style="color:navy">mov     cs:</span>DevSavedDelim<span style="color:navy">, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039; </span>; In case of DEVICE=
<span style="color:black">SYSINIT:267F                                         </span>; the null has to be replaced with a &#039; &#039;
<span style="color:black">SYSINIT:2685
SYSINIT:2685 </span><span style="color:gray">LoadDevice</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2685                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2686                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2687                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:2687                 </span><span style="color:navy">mov     word ptr </span>bpb_addr<span style="color:navy">, si </span>;
<span style="color:black">SYSINIT:2687                                         </span>; pass the command line to the device
<span style="color:black">SYSINIT:268B                 </span><span style="color:navy">mov     word ptr </span>bpb_addr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">SYSINIT:268F                 </span><span style="color:navy">mov     word ptr </span>DevCmdLine<span style="color:navy">, si </span>; save it for ourself
<span style="color:black">SYSINIT:2693                 </span><span style="color:navy">mov     word ptr </span>DevCmdLine<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">SYSINIT:2697                 </span><span style="color:navy">mov     </span>driver_units<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; clear total block units for driver
<span style="color:black">SYSINIT:269C                 </span><span style="color:navy">call    loc_8DA6
</span><span style="color:black">SYSINIT:269F                 </span><span style="color:navy">call    </span>SizeDevice
<span style="color:black">SYSINIT:26A2                 </span><span style="color:navy">jb      short </span><span style="color:gray">BadFile
</span><span style="color:black">SYSINIT:26A4                 </span><span style="color:navy">mov     </span>ConvLoad<span style="color:navy">, </span><span style="color:#ff8000">1     </span>; Doesn&#039;t matter if DeviceHi==0
<span style="color:black">SYSINIT:26A9                 </span><span style="color:navy">mov     al, </span>DeviceHi    ; If not using upper memory,
<span style="color:black">SYSINIT:26A9                                         </span>; (&#039;mov al, [DeviceHi]&#039; is not needed here
<span style="color:black">SYSINIT:26A9                                         </span>;  because al value is not used after here)
<span style="color:black">SYSINIT:26AC                 </span><span style="color:navy">or      </span>DeviceHi<span style="color:navy">, </span><span style="color:green">0     </span>; (or al, al) - Erdogan Tan - 10/07/2023
<span style="color:black">SYSINIT:26B1                 </span><span style="color:navy">jz      short </span><span style="color:gray">DevConvLoad </span>; Skip all this and go on
<span style="color:black">SYSINIT:26B1                                         </span>; to the actual load.
<span style="color:black">SYSINIT:26B3                 </span><span style="color:navy">call    </span>GetLoadUMB      ; (&#039;mov al, [UmbLoad]&#039; would be better here)
<span style="color:black">SYSINIT:26B6                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0FFh        </span>; -1 ; If umb0 not specified, it&#039;s old style
<span style="color:black">SYSINIT:26B8                 </span><span style="color:navy">jz      short </span><span style="color:gray">DevConvLoad </span>; so load high even if SIZE= is smaller
<span style="color:black">SYSINIT:26BA                 </span><span style="color:navy">dec     </span>ConvLoad        ; 0 ; They specified /L, so use new loader
<span style="color:black">SYSINIT:26BE                 </span><span style="color:navy">call    </span>GetLoadSize     ; Returns size of first UMB specified
<span style="color:black">SYSINIT:26C1                 </span><span style="color:navy">or      ax, ax
</span><span style="color:black">SYSINIT:26C3                 </span><span style="color:navy">jz      short </span><span style="color:gray">tryd_1    </span>; If size is not specified..
<span style="color:black">SYSINIT:26C5                 </span><span style="color:navy">cmp     ax, </span>DevSize     ; /L:...,Size &lt; DevSize?
<span style="color:black">SYSINIT:26C9                 </span><span style="color:navy">jge     short </span><span style="color:gray">DevConvLoad
</span><span style="color:black">SYSINIT:26CB
SYSINIT:26CB </span><span style="color:gray">tryd_1</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:26CB                 </span><span style="color:navy">mov     ax, </span>DevSize     ; Size &lt; DevSize, so write DevSize as
<span style="color:black">SYSINIT:26CE                 </span><span style="color:navy">call    </span>StoLoadSize     ; minsize for load UMB.
<span style="color:black">SYSINIT:26D1
SYSINIT:26D1 </span><span style="color:gray">DevConvLoad</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:26D1                 </span><span style="color:navy">call    </span>InitDevLoad
<span style="color:black">SYSINIT:26D4                 </span><span style="color:navy">mov     ax, </span>DevLoadAddr
<span style="color:black">SYSINIT:26D7                 </span><span style="color:navy">add     ax, </span>DevSize
<span style="color:black">SYSINIT:26DB                 </span><span style="color:navy">jb      short </span><span style="color:gray">NoMem
</span><span style="color:black">SYSINIT:26DD                 </span><span style="color:navy">cmp     </span>DevLoadEnd<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:26E1                 </span><span style="color:navy">jnb     short </span><span style="color:gray">LoadDev
</span><span style="color:black">SYSINIT:26E3
SYSINIT:26E3 </span><span style="color:gray">NoMem</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:26E3                 </span><span style="color:navy">jmp     loc_8DE8
</span><span style="color:black">SYSINIT:26E6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:26E6
SYSINIT:26E6 </span><span style="color:gray">BadFile</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:26E6                 </span><span style="color:navy">call    </span>RetFromUM       ; Does nothing if didn&#039;t call HideUMBs
<span style="color:black">SYSINIT:26E9                 </span><span style="color:navy">cmp     byte ptr es:[si], </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039; </span>; blank/space
<span style="color:black">SYSINIT:26ED                 </span><span style="color:navy">jnb     short </span><span style="color:gray">tryd_2
</span><span style="color:black">SYSINIT:26EF                 </span><span style="color:navy">jmp     loc_6DDB
</span><span style="color:black">SYSINIT:26F2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:26F2
SYSINIT:26F2 </span><span style="color:gray">tryd_2</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:26F2                 </span><span style="color:navy">call    </span>nuldev
<span style="color:black">SYSINIT:26F5                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:26F8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:26F8
SYSINIT:26F8 </span><span style="color:gray">LoadDev</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:26F8                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:26F9                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:26FA                 </span>assume ds:nothing
<span style="color:black">SYSINIT:26FA                 </span><span style="color:navy">mov     dx, si          </span>; ds:dx points to file name
<span style="color:black">SYSINIT:26FC                 </span><span style="color:navy">call    </span>ExecDev         ; load device driver using exec call
<span style="color:black">SYSINIT:26FF                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2700                 </span><span style="color:navy">pop     es              </span>; es:si back to config.sys
<span style="color:black">SYSINIT:2701                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2702                 </span><span style="color:navy">pop     ds              </span>; ds back to sysinit
<span style="color:black">SYSINIT:2703                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:2703                 </span><span style="color:navy">jb      short </span><span style="color:gray">BadFile
</span><span style="color:black">SYSINIT:2705
SYSINIT:2705 </span><span style="color:gray">goodld</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2705                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:2706                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:2707                 </span><span style="color:navy">call    </span>RemoveNull
<span style="color:black">SYSINIT:270A                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:270B                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:270C                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:270D                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:270E                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:270E                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:270F                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:2710                 </span><span style="color:navy">lds     si, cs:</span>DevEntry
<span style="color:black">SYSINIT:2715                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2715                 </span><span style="color:navy">test    word ptr [si+</span><span style="color:#ff8000">4</span><span style="color:navy">], </span><span style="color:green">8000h </span>; [si+SYSDEV.ATT],DEVTYP
<span style="color:black">SYSINIT:2715                                         </span>; block device driver?
<span style="color:black">SYSINIT:271A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">got_device_com_cont </span>; no.
<span style="color:black">SYSINIT:271C                 </span><span style="color:navy">lds     si, cs:</span>DOSINFO  ; ds:si -&gt; sys_var
<span style="color:black">SYSINIT:2721                 </span><span style="color:navy">cmp     byte ptr [si+</span><span style="color:#ff8000">20h</span><span style="color:navy">], </span><span style="color:green">26 </span>; [si+SYSI_NUMIO]
<span style="color:black">SYSINIT:2721                                         </span>; no more than 26 drive number
<span style="color:black">SYSINIT:2725                 </span><span style="color:navy">jb      short </span><span style="color:gray">got_device_com_cont
</span><span style="color:black">SYSINIT:2727                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:2728                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2729                 </span><span style="color:navy">pop     si              </span>; clear the stack
<span style="color:black">SYSINIT:272A                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:272B                 </span>assume es:nothing
<span style="color:black">SYSINIT:272B                 </span><span style="color:navy">call    </span>RetFromUM       ; Do this before we leave
<span style="color:black">SYSINIT:272E                 </span><span style="color:navy">jmp     </span><span style="color:gray">badnumblock
</span><span style="color:black">SYSINIT:2731 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2731
SYSINIT:2731 </span><span style="color:gray">got_device_com_cont</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2731                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:2732                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2733                 </span><span style="color:navy">call    </span>LieInt12Mem
<span style="color:black">SYSINIT:2736                 </span><span style="color:navy">call    </span>UpdatePDB       ; update the PSP:2 value
<span style="color:black">SYSINIT:2739                 </span><span style="color:navy">cmp     cs:</span>multdeviceflag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; Pass limit only for
<span style="color:black">SYSINIT:2739                                         </span>; the 1st device driver in the file
<span style="color:black">SYSINIT:273F                 </span><span style="color:navy">jnz     short </span><span style="color:gray">skip_pass_limit
</span><span style="color:black">SYSINIT:2741                 </span><span style="color:navy">mov     cs:</span>break_addr<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; pass the limit to the DD
<span style="color:black">SYSINIT:2748                 </span><span style="color:navy">mov     bx, cs:</span>DevLoadEnd
<span style="color:black">SYSINIT:274D                 </span><span style="color:navy">mov     cs:</span>break_addr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, bx
</span><span style="color:black">SYSINIT:2752
SYSINIT:2752 </span><span style="color:gray">skip_pass_limit</span><span style="color:navy">:                        </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2752                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2753                 </span><span style="color:navy">lds     bx, cs:</span>DOSINFO  ; ds:bx -&gt; sys_var
<span style="color:black">SYSINIT:2758                 </span><span style="color:navy">mov     al, cs:</span>drivenumber ; temporarily use this next drv value
<span style="color:black">SYSINIT:275C                 </span><span style="color:navy">mov     cs:</span>devdrivenum<span style="color:navy">, al </span>; pass drive number in packet to driver
<span style="color:black">SYSINIT:2760                 </span><span style="color:navy">mov     ah, al
</span><span style="color:black">SYSINIT:2762                 </span><span style="color:navy">xchg    ax, [bx+</span><span style="color:#ff8000">20h</span><span style="color:navy">]    </span>; [bx+SYSI_NUMIO]
<span style="color:black">SYSINIT:2762                                         </span>; swap with existing values
<span style="color:black">SYSINIT:2765                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2766                 </span><span style="color:navy">push    ax              </span>; save real sysi_numio/ncds in ax
<span style="color:black">SYSINIT:2766                                         </span>;
<span style="color:black">SYSINIT:2766                                         </span>; mov word ptr cs:configmsgflag, 0
<span style="color:black">SYSINIT:2766                                         </span>; PCDOS 7.1 IBMBIO.COM - SYSINIT:2C5Fh
<span style="color:black">SYSINIT:2766                                         </span>; (disable &quot;error in config.sys line #&quot; msg)
<span style="color:black">SYSINIT:2766                                         </span>; ((before loading -next- device driver))
<span style="color:black">SYSINIT:2766                                         </span>; E.TAN - 10/07/2023
<span style="color:black">SYSINIT:2766                                         </span>; ;
<span style="color:black">SYSINIT:2767                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">6           </span>; SYSDEV.STRAT
<span style="color:black">SYSINIT:276A                 </span><span style="color:navy">call    loc_8DF3        </span>; calldev (sdevstrat);
<span style="color:black">SYSINIT:276D                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">8           </span>; SYSDEV.INT
<span style="color:black">SYSINIT:2770                 </span><span style="color:navy">call    loc_8DF3        </span>; calldev (sdevint);
<span style="color:black">SYSINIT:2773                 </span><span style="color:navy">pop     ax              </span>; get real sysi_numio value
<span style="color:black">SYSINIT:2774                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2775                 </span><span style="color:navy">lds     bx, cs:</span>DOSINFO  ; ds:bx -&gt; sys_var
<span style="color:black">SYSINIT:277A                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">20h</span><span style="color:navy">], ax    </span>; [bx+SYSI_NUMIO]
<span style="color:black">SYSINIT:277A                                         </span>; restore previous/real value
<span style="color:black">SYSINIT:277D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:277E                 </span><span style="color:navy">call    </span>TrueInt12Mem
<span style="color:black">SYSINIT:2781                 </span><span style="color:navy">mov     ax, cs:</span>break_addr ; move break addr from the req packet
<span style="color:black">SYSINIT:2785                 </span><span style="color:navy">mov     word ptr cs:</span>DevBrkAddr<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:2789                 </span><span style="color:navy">mov     ax, cs:</span>break_addr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:black">SYSINIT:278D                 </span><span style="color:navy">mov     word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:2791                 </span><span style="color:navy">call    </span>RetFromUM       ; There we go... all done.
<span style="color:black">SYSINIT:2794                 </span><span style="color:navy">cmp     cs:</span>DevUMB<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:279A                 </span><span style="color:navy">jz      short </span><span style="color:gray">tryd_3
</span><span style="color:black">SYSINIT:279C                 </span><span style="color:navy">call    </span>AllocUMB
<span style="color:black">SYSINIT:279F
SYSINIT:279F </span><span style="color:gray">tryd_3</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:279F                 </span><span style="color:navy">cmp     cs:</span>runhigh<span style="color:navy">, </span><span style="color:#ff8000">0FFh
</span><span style="color:black">SYSINIT:27A5                 </span><span style="color:navy">jnz     short </span><span style="color:gray">tryd_4
</span><span style="color:black">SYSINIT:27A7                 </span><span style="color:navy">call    </span>TryToMovDOSHi   ; move DOS into HMA if requsted
<span style="color:black">SYSINIT:27AA
SYSINIT:27AA </span><span style="color:gray">tryd_4</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:27AA                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:27AB                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:27AC                 </span><span style="color:navy">mov     byte ptr [si], </span><span style="color:#ff8000">0 </span>; *p = 0;
<span style="color:black">SYSINIT:27AF                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:27B0                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:27B1                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:27B1                 </span><span style="color:navy">jmp     short </span><span style="color:gray">was_device_com
</span><span style="color:black">SYSINIT:27B3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:27B3
SYSINIT:27B3 </span><span style="color:gray">badnumblock</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:27B3                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:27B4                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:27B5                 </span><span style="color:navy">mov     dx, (offset </span>_$CleanMsg<span style="color:navy">+</span><span style="color:green">17h</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:27B8                 </span><span style="color:navy">call    sub_9072
</span><span style="color:black">SYSINIT:27BB
SYSINIT:27BB </span><span style="color:gray">erase_dev_do</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:27BB                 </span><span style="color:navy">call    </span>CheckDoubleSpace ; (Note: &#039;call CheckDoubleSpace&#039;
<span style="color:black">SYSINIT:27BB                                         </span>; has been removed at &#039;erase_dev_do:&#039; pos
<span style="color:black">SYSINIT:27BB                                         </span>; in PCDOS 7.1 IBMBIO.COM - SYSINIT:2CBAh)
<span style="color:black">SYSINIT:27BB                                         </span>; Erdogan Tan - 10/07/2023
<span style="color:black">SYSINIT:27BE                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:27BF                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:27C0                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:27C1                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:27C2                 </span><span style="color:navy">cmp     cs:</span>configmsgflag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; is error_line msg disabled ?
<span style="color:black">SYSINIT:27C8                 </span><span style="color:navy">jz      short </span><span style="color:gray">no_error_line_msg </span>; yes
<span style="color:black">SYSINIT:27CA                 </span><span style="color:navy">call    </span>error_line      ; show &quot;error in config.sys ...&quot; message.
<span style="color:black">SYSINIT:27CD                 </span><span style="color:navy">mov     cs:</span>configmsgflag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; set the default value again.
<span style="color:black">SYSINIT:27D4
SYSINIT:27D4 </span><span style="color:gray">no_error_line_msg</span><span style="color:navy">:                      </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:27D4                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:27D7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:27D7
SYSINIT:27D7 </span><span style="color:gray">was_device_com</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:27D7                 </span><span style="color:navy">mov     ax, word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:black">SYSINIT:27DB                 </span><span style="color:navy">cmp     ax, cs:</span>DevLoadEnd
<span style="color:black">SYSINIT:27E0                 </span><span style="color:navy">jbe     short </span><span style="color:gray">breakok
</span><span style="color:black">SYSINIT:27E2                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:27E3                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:27E4                 </span><span style="color:navy">jmp     </span><span style="color:gray">BadFile
</span><span style="color:black">SYSINIT:27E7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:27E7
SYSINIT:27E7 </span><span style="color:gray">breakok</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:27E7                 </span><span style="color:navy">lds     dx, cs:</span>DevEntry ; set ds:dx to header
<span style="color:black">SYSINIT:27EC                 </span>assume ds:nothing
<span style="color:black">SYSINIT:27EC                 </span><span style="color:navy">mov     si, dx
</span><span style="color:black">SYSINIT:27EE                 </span><span style="color:navy">les     di, cs:</span>DOSINFO  ; es:di point to dos info
<span style="color:black">SYSINIT:27F3                 </span><span style="color:navy">mov     ax, [si+</span><span style="color:#ff8000">4</span><span style="color:navy">]      </span>; [si+SYSDEV.ATT] ; get attributes
<span style="color:black">SYSINIT:27F6                 </span><span style="color:navy">test    ax, </span><span style="color:green">8000h       </span>; DEVTYP ; test if block dev
<span style="color:black">SYSINIT:27F9                 </span><span style="color:navy">jz      short </span><span style="color:gray">isblock
</span><span style="color:black">SYSINIT:27FB                 </span><span style="color:navy">or      cs:</span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">2 </span>; for_devmark
<span style="color:black">SYSINIT:2801                 </span><span style="color:navy">call    </span>DevSetBreak     ; go ahead and alloc mem for device
<span style="color:black">SYSINIT:2804
SYSINIT:2804 </span><span style="color:gray">jc_edd</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2804                 </span><span style="color:navy">jb      short </span><span style="color:gray">erase_dev_do </span>; device driver&#039;s init routine failed.
<span style="color:black">SYSINIT:2806                 </span><span style="color:navy">test    ax, </span><span style="color:green">1           </span>; ISCIN ; is it a console in?
<span style="color:black">SYSINIT:2809                 </span><span style="color:navy">jz      short </span><span style="color:gray">tryclk
</span><span style="color:black">SYSINIT:280B                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">0Ch</span><span style="color:navy">], dx </span>; [es:di+SYSI_CON]
<span style="color:black">SYSINIT:280F                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">0Eh</span><span style="color:navy">], ds </span>; [es:di+SYSI_CON+2]
<span style="color:black">SYSINIT:2813
SYSINIT:2813 </span><span style="color:gray">tryclk</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2813                 </span><span style="color:navy">test    ax, </span><span style="color:green">8           </span>; ISCLOCK ; is it a clock device?
<span style="color:black">SYSINIT:2816                 </span><span style="color:navy">jz      short </span><span style="color:gray">golink
</span><span style="color:black">SYSINIT:2818                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">8</span><span style="color:navy">], dx   </span>; [es:di+SYSI_CLOCK]
<span style="color:black">SYSINIT:281C                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">0Ah</span><span style="color:navy">], ds </span>; [es:di+SYSI_CLOCK]
<span style="color:black">SYSINIT:2820
SYSINIT:2820 </span><span style="color:gray">golink</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2820                 </span><span style="color:navy">jmp     </span><span style="color:gray">linkit
</span><span style="color:black">SYSINIT:2823 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2823
SYSINIT:2823 </span><span style="color:gray">isblock</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2823                 </span><span style="color:navy">mov     al, cs:</span>unitcount
<span style="color:black">SYSINIT:2827                 </span><span style="color:navy">or      al, al          </span>; if no units found, erase the device
<span style="color:black">SYSINIT:2829                 </span><span style="color:navy">jz      short </span><span style="color:gray">erase_dev_do
</span><span style="color:black">SYSINIT:282B                 </span><span style="color:navy">mov     [si+</span><span style="color:#ff8000">0Ah</span><span style="color:navy">], al    </span>; [si+SYSDEV.NAME]
<span style="color:black">SYSINIT:282B                                         </span>; number of units in name field
<span style="color:black">SYSINIT:282E                 </span><span style="color:navy">add     cs:</span>driver_units<span style="color:navy">, al </span>; keep total for all drivers in file
<span style="color:black">SYSINIT:2833
SYSINIT:2833 </span>perdrv<span style="color:navy">:                                 </span>; warning no device &gt; 127 units
<span style="color:black">SYSINIT:2833                 </span><span style="color:navy">cbw
</span><span style="color:black">SYSINIT:2834                 </span><span style="color:navy">mov     cx, ax
</span><span style="color:black">SYSINIT:2836                 </span><span style="color:navy">mov     dh, ah
</span><span style="color:black">SYSINIT:2838                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">] </span>; [es:di+SYSI_NUMIO]
<span style="color:black">SYSINIT:2838                                         </span>; get number of devices
<span style="color:black">SYSINIT:283C                 </span><span style="color:navy">mov     ah, dl
</span><span style="color:black">SYSINIT:283E                 </span><span style="color:navy">add     ah, al          </span>; check for too many devices
<span style="color:black">SYSINIT:2840                 </span><span style="color:navy">cmp     ah, </span><span style="color:green">26          </span>; &#039;A&#039; - &#039;Z&#039; is 26 devices
<span style="color:black">SYSINIT:2843                 </span><span style="color:navy">jbe     short </span><span style="color:gray">ok_block
</span><span style="color:black">SYSINIT:2845                 </span><span style="color:navy">jmp     </span><span style="color:gray">badnumblock
</span><span style="color:black">SYSINIT:2848 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2848
SYSINIT:2848 </span><span style="color:gray">ok_block</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2848                 </span><span style="color:navy">or      cs:</span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">2 </span>; for_devmark
<span style="color:black">SYSINIT:284E                 </span><span style="color:navy">call    </span>DevSetBreak     ; alloc the device
<span style="color:black">SYSINIT:2851                 </span><span style="color:navy">jb      short </span><span style="color:gray">jc_edd
</span><span style="color:black">SYSINIT:2853                 </span><span style="color:navy">add     es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">], al </span>; [es:di+SYSI_NUMIO]
<span style="color:black">SYSINIT:2853                                         </span>; update the amount
<span style="color:black">SYSINIT:2857                 </span><span style="color:navy">add     cs:</span>drivenumber<span style="color:navy">, al </span>; remember amount for next device
<span style="color:black">SYSINIT:285C                 </span><span style="color:navy">lds     bx, cs:</span>bpb_addr ; point to bpb array
<span style="color:black">SYSINIT:2861
SYSINIT:2861 </span><span style="color:gray">perunit</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2861                 </span><span style="color:navy">les     bp, cs:</span>DOSINFO
<span style="color:black">SYSINIT:2866                 </span><span style="color:navy">les     bp, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]   </span>; [es:bp+SYSI_DPB] ; get first dpb
<span style="color:black">SYSINIT:286A
SYSINIT:286A </span><span style="color:gray">scandpb</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:286A                 </span><span style="color:navy">cmp     word ptr es:[bp+</span><span style="color:#ff8000">19h</span><span style="color:navy">], </span><span style="color:green">0FFFFh </span>; [es:bp+DPB.NEXT_DPB],-1
<span style="color:black">SYSINIT:286F                 </span><span style="color:navy">jz      short </span><span style="color:gray">founddpb
</span><span style="color:black">SYSINIT:2871                 </span><span style="color:navy">les     bp, es:[bp+</span><span style="color:#ff8000">19h</span><span style="color:navy">] </span>; [es:bp+DPB.NEXT_DPB] ; [es:bp+25]
<span style="color:black">SYSINIT:2875                 </span><span style="color:navy">jmp     short </span><span style="color:gray">scandpb
</span><span style="color:black">SYSINIT:2877 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2877
SYSINIT:2877 </span><span style="color:gray">founddpb</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2877                 </span><span style="color:navy">mov     ax, word ptr cs:</span>DevBrkAddr
<span style="color:black">SYSINIT:287B                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">19h</span><span style="color:navy">], ax </span>; [es:bp+DPB.NEXT_DPB]
<span style="color:black">SYSINIT:287F                 </span><span style="color:navy">mov     ax, word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:black">SYSINIT:2883                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">1Bh</span><span style="color:navy">], ax </span>; [es:bp+DPB.NEXT_DPB+2]
<span style="color:black">SYSINIT:2887                 </span><span style="color:navy">les     bp, cs:</span>DevBrkAddr
<span style="color:black">SYSINIT:288C                 </span><span style="color:navy">add     word ptr cs:</span>DevBrkAddr<span style="color:navy">, </span><span style="color:green">33 </span>; DPBSIZ = 33
<span style="color:black">SYSINIT:288C                                         </span>; (61 in PCDOS 7.1 IBMBIO.COM)
<span style="color:black">SYSINIT:2892                 </span><span style="color:navy">call    </span>RoundBreakAddr
<span style="color:black">SYSINIT:2895                 </span><span style="color:navy">mov     word ptr es:[bp+</span><span style="color:#ff8000">19h</span><span style="color:navy">], </span><span style="color:green">0FFFFh </span>; [es:bp+DPB.NEXT_DPB],-1
<span style="color:black">SYSINIT:289B                 </span><span style="color:navy">mov     byte ptr es:[bp+</span><span style="color:#ff8000">18h</span><span style="color:navy">], </span><span style="color:#ff8000">0FFh </span>; [es:bp+DPB.FIRST_ACCESS],-1 ; byte
<span style="color:black">SYSINIT:28A0                 </span><span style="color:navy">mov     si, [bx]        </span>; ds:si points to bpb
<span style="color:black">SYSINIT:28A2                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:28A3                 </span><span style="color:navy">inc     bx              </span>; point to next bpb
<span style="color:black">SYSINIT:28A4                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], dx   </span>; [es:bp+DPB.DRIVE]
<span style="color:black">SYSINIT:28A8                 </span><span style="color:navy">mov     ah, </span><span style="color:green">53h         </span>; SETDPB ; hidden system call
<span style="color:black">SYSINIT:28AA                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ internal - TRANSLATE BIOS PARAMETER BLOCK
<span style="color:black">SYSINIT:28AA                                         </span>; DS:SI -&gt; BPB (BIOS Parameter Block)
<span style="color:black">SYSINIT:28AA                                         </span>; ES:BP -&gt; buffer for DOS Drive Parameter Block
<span style="color:black">SYSINIT:28AC                 </span><span style="color:navy">mov     ax, es:[bp+</span><span style="color:#ff8000">2</span><span style="color:navy">]   </span>; [es:bp+DPB.SECTOR_SIZE]
<span style="color:black">SYSINIT:28B0                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:28B1                 </span><span style="color:navy">les     di, cs:</span>DOSINFO  ; es:di point to dos info
<span style="color:black">SYSINIT:28B6                 </span><span style="color:navy">cmp     ax, es:[di+</span><span style="color:#ff8000">10h</span><span style="color:navy">] </span>; [es:di+SYSI_MAXSEC]
<span style="color:black">SYSINIT:28BA                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:28BB                 </span><span style="color:navy">jbe     short </span><span style="color:gray">iblk_1
</span><span style="color:black">SYSINIT:28BD                 </span><span style="color:navy">jmp     loc_6998
</span><span style="color:black">SYSINIT:28C0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:28C0
SYSINIT:28C0 </span><span style="color:gray">iblk_1</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:28C0                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:28C1                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:28C2                 </span><span style="color:navy">lds     dx, cs:</span>DevEntry
<span style="color:black">SYSINIT:28C7                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">13h</span><span style="color:navy">], dx </span>; [es:bp+DPB.DRIVER_ADDR]
<span style="color:black">SYSINIT:28CB                 </span><span style="color:navy">mov     word ptr es:[bp+</span><span style="color:#ff8000">15h</span><span style="color:navy">], ds </span>; [es:bp+DPB.DRIVER_ADDR+2]
<span style="color:black">SYSINIT:28CF                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:28D0                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:28D1                 </span><span style="color:navy">inc     dx
</span><span style="color:black">SYSINIT:28D2                 </span><span style="color:navy">inc     dh
</span><span style="color:black">SYSINIT:28D4                 </span><span style="color:navy">loop    </span><span style="color:gray">perunit         </span>; cx = cx - 1
<span style="color:black">SYSINIT:28D4                                         </span>; cx = remain count from [cs:unitcount]
<span style="color:black">SYSINIT:28D4                                         </span>; loop until cx is 0
<span style="color:black">SYSINIT:28D6                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:28D7                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:28D8                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:28D8                 </span><span style="color:navy">call    </span>TempCDS
<span style="color:black">SYSINIT:28DB
SYSINIT:28DB </span><span style="color:gray">linkit</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:28DB                 </span><span style="color:navy">les     di, cs:</span>DOSINFO  ; es:di = dos table
<span style="color:black">SYSINIT:28E0                 </span><span style="color:navy">mov     cx, es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">] </span>; [es:di+SYSI_DEV] ; dx:cx = head of list
<span style="color:black">SYSINIT:28E4                 </span><span style="color:navy">mov     dx, es:[di+</span><span style="color:#ff8000">24h</span><span style="color:navy">] </span>; [es:di+SYSI_DEV+2]
<span style="color:black">SYSINIT:28E8                 </span><span style="color:navy">lds     si, cs:</span>DevEntry ; ds:si = device location
<span style="color:black">SYSINIT:28ED                 </span>assume ds:nothing
<span style="color:black">SYSINIT:28ED                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], si </span>; set head of list in dos
<span style="color:black">SYSINIT:28ED                                         </span>; [es:di+SYSI_DEV]
<span style="color:black">SYSINIT:28F1                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">24h</span><span style="color:navy">], ds </span>; [es:di+SYSI_DEV+2]
<span style="color:black">SYSINIT:28F5                 </span><span style="color:navy">mov     ax, [si]        </span>; get pointer to next device
<span style="color:black">SYSINIT:28F7                 </span><span style="color:navy">mov     word ptr cs:</span>DevEntry<span style="color:navy">, ax </span>; and save it
<span style="color:black">SYSINIT:28FB                 </span><span style="color:navy">mov     [si], cx        </span>; link in the driver
<span style="color:black">SYSINIT:28FD                 </span><span style="color:navy">mov     [si+</span><span style="color:#ff8000">2</span><span style="color:navy">], dx
</span><span style="color:black">SYSINIT:2900                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:2901                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2902                 </span><span style="color:navy">inc     ax              </span>; ax = 0FFFFh (no more devs if yes)?
<span style="color:black">SYSINIT:2903                 </span><span style="color:navy">jz      short </span><span style="color:gray">coffj3
</span><span style="color:black">SYSINIT:2905                 </span><span style="color:navy">inc     cs:</span>multdeviceflag ; possibly multiple device driver.
<span style="color:black">SYSINIT:290A                 </span><span style="color:navy">call    </span>DevBreak
<span style="color:black">SYSINIT:290D                 </span><span style="color:navy">jmp     </span><span style="color:gray">goodld          </span>; otherwise pretend we loaded it in
<span style="color:black">SYSINIT:2910 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2910
SYSINIT:2910 </span><span style="color:gray">coffj3</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2910                 </span><span style="color:navy">mov     cs:</span>multdeviceflag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; reset the flag
<span style="color:black">SYSINIT:2916                 </span><span style="color:navy">call    </span>DevBreak
<span style="color:black">SYSINIT:2919                 </span><span style="color:navy">call    </span>CheckProtmanArena ; adjust alloclim if Protman$ just
<span style="color:black">SYSINIT:2919                                         </span>; created a bogus arena to try
<span style="color:black">SYSINIT:2919                                         </span>; to protect some of its resident-
<span style="color:black">SYSINIT:2919                                         </span>; init code.
<span style="color:black">SYSINIT:291C                 </span><span style="color:navy">call    </span>CheckDoubleSpace ;
<span style="color:black">SYSINIT:291C                                         </span>; inquire of MagicDrv whether it is present,
<span style="color:black">SYSINIT:291C                                         </span>; and final located
<span style="color:black">SYSINIT:291F                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:291F </span>multi_pass      endp
<span style="color:black">SYSINIT:291F
SYSINIT:2922
SYSINIT:2922 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2922
SYSINIT:2922
SYSINIT:2922 </span>CheckDoubleSpace proc near              <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2922                 </span><span style="color:navy">cmp     cs:</span>MagicHomeFlag<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; already home?
<span style="color:black">SYSINIT:2928                 </span><span style="color:navy">jnz     short </span><span style="color:gray">no_more_magic_calls </span>; nothing more to do if so
<span style="color:black">SYSINIT:292A                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4A11h       </span>; multMagicdrv
<span style="color:black">SYSINIT:292D                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">0           </span>; MD_VERSION
<span style="color:black">SYSINIT:2930                 </span><span style="color:navy">int     </span><span style="color:green">2Fh             </span>;  ch = number of MagicDrv drive letters
<span style="color:black">SYSINIT:2932                 </span><span style="color:navy">or      ax, ax          </span>; is it there?
<span style="color:black">SYSINIT:2934                 </span><span style="color:navy">jnz     short </span><span style="color:gray">no_more_magic_calls </span>; done if not
<span style="color:black">SYSINIT:2936                 </span><span style="color:navy">test    dx, </span><span style="color:green">8000h       </span>; is it final placed?
<span style="color:black">SYSINIT:293A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">magic_not_yet_home </span>; skip if not
<span style="color:black">SYSINIT:293C                 </span><span style="color:navy">mov     cs:</span>MagicHomeFlag<span style="color:navy">, </span><span style="color:#ff8000">0FFh </span>; set the flag!
<span style="color:black">SYSINIT:2942                 </span><span style="color:navy">add     cs:</span>drivenumber<span style="color:navy">, ch </span>; add number of MagicDrv volumes to
<span style="color:black">SYSINIT:2942                                         </span>; the drive number we&#039;ll pass to the
<span style="color:black">SYSINIT:2942                                         </span>; next loadable block device.
<span style="color:black">SYSINIT:2947                 </span><span style="color:navy">jmp     short </span><span style="color:gray">no_more_magic_calls </span>; and finished.
<span style="color:black">SYSINIT:2947                                         </span>; (retn)
<span style="color:black">SYSINIT:2949 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2949
SYSINIT:2949 </span><span style="color:gray">magic_not_yet_home</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2949                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:294A                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:294B                 </span><span style="color:navy">mov     cx, cs:</span>memhi    ; pass it a work buffer
<span style="color:black">SYSINIT:2950                 </span><span style="color:navy">mov     dx, cs:</span>ALLOCLIM ; address in cx (segment)
<span style="color:black">SYSINIT:2955                 </span><span style="color:navy">sub     dx, cx          </span>; for len dx (paragraphs)
<span style="color:black">SYSINIT:2957                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:295A                 </span><span style="color:navy">mov     al, cs:</span>driver_units ; shuffle magicdrives and new drives
<span style="color:black">SYSINIT:295A                                         </span>; by this many units
<span style="color:black">SYSINIT:295E                 </span><span style="color:navy">mov     ah, </span><span style="color:green">55h         </span>; backdoor won&#039;t shuffle unless it
<span style="color:black">SYSINIT:295E                                         </span>; sees this, to prevent bad things
<span style="color:black">SYSINIT:295E                                         </span>; from happening if people run the
<span style="color:black">SYSINIT:295E                                         </span>; new driver with an old (dos) BIOS
<span style="color:black">SYSINIT:2960                 </span><span style="color:navy">call    cs:</span>Magicbackdoor
<span style="color:black">SYSINIT:2965                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:2966                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2967
SYSINIT:2967 </span><span style="color:gray">no_more_magic_calls</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2967                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2967 </span>CheckDoubleSpace endp
<span style="color:black">SYSINIT:2967
SYSINIT:2968 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2968 </span><span style="color:gray">; START OF FUNCTION CHUNK FOR multi_pass
</span><span style="color:black">SYSINIT:2968
SYSINIT:2968 </span><span style="color:navy">loc_6998:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2968                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:2969                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:296A                 </span><span style="color:navy">mov     dx, (offset </span>badmem<span style="color:navy">+</span><span style="color:green">15h</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:296D                 </span><span style="color:navy">mov     bx, (offset </span>insufmemory<span style="color:navy">+</span><span style="color:green">20h</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:2970                 </span><span style="color:navy">call    loc_904E
</span><span style="color:black">SYSINIT:2973                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2976 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2976
SYSINIT:2976 </span><span style="color:navy">loc_69A6:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2976                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">51h </span><span style="color:gray">; &#039;Q&#039;   </span>; CONFIG_COUNTRY
<span style="color:black">SYSINIT:2979                 </span><span style="color:navy">jz      short loc_69AE
</span><span style="color:black">SYSINIT:297B
SYSINIT:297B </span><span style="color:navy">loc_69AB:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:297B                 </span><span style="color:navy">jmp     loc_6AD6
</span><span style="color:black">SYSINIT:297E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:297E
SYSINIT:297E </span><span style="color:navy">loc_69AE:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:297E                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:297E                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2981                 </span><span style="color:navy">jb      short loc_69AB
</span><span style="color:black">SYSINIT:2983                 </span><span style="color:navy">mov     byte ptr cs:aACountry_sys, </span><span style="color:#ff8000">0 </span>;
<span style="color:black">SYSINIT:2983                                         </span>; reset the drive,path to default value.
<span style="color:black">SYSINIT:2989                 </span><span style="color:navy">mov     cs:</span>p_code_page<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2990                 </span><span style="color:navy">mov     di, offset </span>cntry_parms
<span style="color:black">SYSINIT:2993                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:2995                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:2997
SYSINIT:2997 </span><span style="color:navy">loc_69C7:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2997                 </span><span style="color:navy">call    </span>sysinit_parse
<span style="color:black">SYSINIT:299A                 </span><span style="color:navy">jnb     short loc_69D8  </span>; parse error,check error code and
<span style="color:black">SYSINIT:299C                 </span><span style="color:navy">call    </span>cntry_error     ; show message and end the search loop.
<span style="color:black">SYSINIT:299F                 </span><span style="color:navy">mov     cs:</span>p_cntry_code<span style="color:navy">, </span><span style="color:green">0FFFFh </span>; -1 ; signals that parse error.
<span style="color:black">SYSINIT:29A6                 </span><span style="color:navy">jmp     short loc_6A11
</span><span style="color:black">SYSINIT:29A8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:29A8
SYSINIT:29A8 </span><span style="color:navy">loc_69D8:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:29A8                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:29AB                 </span><span style="color:navy">jz      short loc_6A11
</span><span style="color:black">SYSINIT:29AD                 </span><span style="color:navy">cmp     cs:</span>result_val<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; _$P_Number
<span style="color:black">SYSINIT:29B3                 </span><span style="color:navy">jnz     short loc_69FA
</span><span style="color:black">SYSINIT:29B5                 </span><span style="color:navy">mov     ax, word ptr cs:</span>rv_dword ;
<span style="color:black">SYSINIT:29B5                                         </span>; [cs:result_val+_$P_Result_Blk.Picked_Val]
<span style="color:black">SYSINIT:29B9                 </span><span style="color:navy">cmp     cx, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:29BC                 </span><span style="color:navy">jnz     short loc_69F4
</span><span style="color:black">SYSINIT:29BE                 </span><span style="color:navy">mov     cs:</span>p_cntry_code<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:29C2                 </span><span style="color:navy">jmp     short loc_69F8
</span><span style="color:black">SYSINIT:29C4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:29C4
SYSINIT:29C4 </span><span style="color:navy">loc_69F4:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:29C4                 </span><span style="color:navy">mov     cs:</span>p_code_page<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:29C8
SYSINIT:29C8 </span><span style="color:navy">loc_69F8:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:29C8                 </span><span style="color:navy">jmp     short loc_6A0F  </span>; path entered
<span style="color:black">SYSINIT:29CA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:29CA
SYSINIT:29CA </span><span style="color:navy">loc_69FA:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:29CA                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:29CB                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:29CC                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:29CD                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:29CE                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:29CF                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:29D0                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:29D0                 </span><span style="color:navy">lds     si, cs:</span>rv_dword ; move the path to known place.
<span style="color:black">SYSINIT:29D5                 </span><span style="color:navy">mov     di, offset aACountry_sys </span><span style="color:gray">; &quot;A:\\COUNTRY.SYS&quot;
</span><span style="color:black">SYSINIT:29D8                 </span><span style="color:navy">call    sub_903C
</span><span style="color:black">SYSINIT:29DB                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:29DC                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:29DD                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:29DE                 </span>assume es:nothing
<span style="color:black">SYSINIT:29DE                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:29DF
SYSINIT:29DF </span><span style="color:navy">loc_6A0F:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:29DF                 </span><span style="color:navy">jmp     short loc_69C7
</span><span style="color:black">SYSINIT:29E1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:29E1
SYSINIT:29E1 </span><span style="color:navy">loc_6A11:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:29E1                 </span><span style="color:navy">cmp     cs:</span>p_cntry_code<span style="color:navy">, </span><span style="color:green">0FFFFh </span>; -1 ; had a parse error?
<span style="color:black">SYSINIT:29E7                 </span><span style="color:navy">jnz     short loc_6A23
</span><span style="color:black">SYSINIT:29E9                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:29EC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:29EC
SYSINIT:29EC </span><span style="color:navy">loc_6A1C:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:29EC                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:29ED                 </span><span style="color:navy">mov     dx, (offset </span>badstack<span style="color:navy">+</span><span style="color:green">1Ah</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:29F0                 </span><span style="color:navy">jmp     loc_6AA5
</span><span style="color:black">SYSINIT:29F3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:29F3
SYSINIT:29F3 </span><span style="color:navy">loc_6A23:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:29F3                 </span><span style="color:navy">cmp     byte ptr cs:aACountry_sys, </span><span style="color:#ff8000">0 </span><span style="color:gray">; &quot;A:\\COUNTRY.SYS&quot;
</span><span style="color:black">SYSINIT:29F9                 </span><span style="color:navy">jz      short loc_6A30
</span><span style="color:black">SYSINIT:29FB                 </span><span style="color:navy">mov     dx, offset aACountry_sys </span><span style="color:gray">; &quot;A:\\COUNTRY.SYS&quot;
</span><span style="color:black">SYSINIT:29FE                 </span><span style="color:navy">jmp     short loc_6A33
</span><span style="color:black">SYSINIT:2A00 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2A00
SYSINIT:2A00 </span><span style="color:navy">loc_6A30:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A00                 </span><span style="color:navy">mov     dx, (offset aACountry_sys+</span><span style="color:green">2</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:2A03
SYSINIT:2A03 </span><span style="color:navy">loc_6A33:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A03                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">3D00h       </span>; open a file
<span style="color:black">SYSINIT:2A06                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:2A07                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - OPEN DISK FILE WITH HANDLE
<span style="color:black">SYSINIT:2A07                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:black">SYSINIT:2A07                                         </span>; AL = access mode
<span style="color:black">SYSINIT:2A07                                         </span>; 0 - read
<span style="color:black">SYSINIT:2A09                 </span><span style="color:navy">jb      short loc_6A84
</span><span style="color:black">SYSINIT:2A0B                 </span><span style="color:navy">mov     cs:</span>cntryfilehandle<span style="color:navy">, ax </span>; save file handle
<span style="color:black">SYSINIT:2A0F                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:black">SYSINIT:2A11                 </span><span style="color:navy">mov     ax, cs:</span>p_cntry_code
<span style="color:black">SYSINIT:2A15                 </span><span style="color:navy">mov     dx, cs:</span>p_code_page ; ax=country id, bx=filehandle
<span style="color:black">SYSINIT:2A1A                 </span><span style="color:navy">mov     cx, cs:</span>memhi
<span style="color:black">SYSINIT:2A1F                 </span><span style="color:navy">add     cx, </span><span style="color:green">384         </span>; need 6k buffer to handle country.sys
<span style="color:black">SYSINIT:2A1F                                         </span>; (384*16 bytes)
<span style="color:black">SYSINIT:2A23                 </span><span style="color:navy">cmp     cx, cs:</span>ALLOCLIM
<span style="color:black">SYSINIT:2A28                 </span><span style="color:navy">ja      short loc_6AA2  </span>; cannot allocate the buffer for country.sys
<span style="color:black">SYSINIT:2A2A                 </span><span style="color:navy">mov     si, offset aACountry_sys </span><span style="color:gray">; &quot;A:\\COUNTRY.SYS&quot;
</span><span style="color:black">SYSINIT:2A2D                 </span><span style="color:navy">cmp     byte ptr [si], </span><span style="color:#ff8000">0 </span>; default path?
<span style="color:black">SYSINIT:2A30                 </span><span style="color:navy">jnz     short loc_6A64  </span>; no
<span style="color:black">SYSINIT:2A32                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:2A33                 </span><span style="color:navy">inc     si              </span>; ds:si -&gt; cntry_root
<span style="color:black">SYSINIT:2A34
SYSINIT:2A34 </span><span style="color:navy">loc_6A64:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A34                 </span><span style="color:navy">les     di, cs:</span>sysi_country ; es:di -&gt; country info tab in dos
<span style="color:black">SYSINIT:2A39                 </span><span style="color:navy">push    di              </span>; save di
<span style="color:black">SYSINIT:2A3A                 </span><span style="color:navy">add     di, </span><span style="color:#ff8000">8           </span>; country_cdpg_info.ccPath_CountrySys
<span style="color:black">SYSINIT:2A3D                 </span><span style="color:navy">call    sub_903C        </span>; set the path to country.sys in dos.
<span style="color:black">SYSINIT:2A40                 </span><span style="color:navy">pop     di              </span>; es:di -&gt; country info tab again.
<span style="color:black">SYSINIT:2A41                 </span><span style="color:navy">mov     cx, cs:</span>memhi
<span style="color:black">SYSINIT:2A46                 </span><span style="color:navy">mov     ds, cx
</span><span style="color:black">SYSINIT:2A48                 </span><span style="color:navy">xor     si, si          </span>; ds:si -&gt; 2k buffer to be used.
<span style="color:black">SYSINIT:2A4A                 </span><span style="color:navy">call    loc_8E7F        </span>; now do the job!
<span style="color:black">SYSINIT:2A4D                 </span><span style="color:navy">jnb     short loc_6AA5  </span>; read error or could not find country,
<span style="color:black">SYSINIT:2A4D                                         </span>; code page combination
<span style="color:black">SYSINIT:2A4F                 </span><span style="color:navy">cmp     cx, </span><span style="color:green">0FFFFh      </span>; -1
<span style="color:black">SYSINIT:2A4F                                         </span>; could not find matching country_id, code page?
<span style="color:black">SYSINIT:2A52                 </span><span style="color:navy">jz      short loc_6A1C  </span>; then &quot;invalid country code or code page&quot;
<span style="color:black">SYSINIT:2A54
SYSINIT:2A54 </span><span style="color:navy">loc_6A84:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A54                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2A55                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2A56                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:2A56                 </span><span style="color:navy">cmp     byte ptr cs:aACountry_sys, </span><span style="color:#ff8000">0 </span>; is the default file used?
<span style="color:black">SYSINIT:2A5C                 </span><span style="color:navy">jz      short loc_6A93
</span><span style="color:black">SYSINIT:2A5E                 </span><span style="color:navy">mov     si, offset aACountry_sys </span><span style="color:gray">; &quot;A:\\COUNTRY.SYS&quot;
</span><span style="color:black">SYSINIT:2A61                 </span><span style="color:navy">jmp     short loc_6A96
</span><span style="color:black">SYSINIT:2A63 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2A63
SYSINIT:2A63 </span><span style="color:navy">loc_6A93:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A63                 </span><span style="color:navy">mov     si, (offset aACountry_sys+</span><span style="color:green">2</span><span style="color:navy">) </span>; default file has been used.
<span style="color:black">SYSINIT:2A63                                         </span>; es:si -&gt; \country.sys in sysinit_seg
<span style="color:black">SYSINIT:2A66
SYSINIT:2A66 </span><span style="color:navy">loc_6A96:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A66                 </span><span style="color:navy">call    </span>nuldev
<span style="color:black">SYSINIT:2A69                 </span><span style="color:navy">mov     cx, cs:</span>CONFBOT
<span style="color:black">SYSINIT:2A6E                 </span><span style="color:navy">mov     es, cx          </span>; restore es -&gt; confbot.
<span style="color:black">SYSINIT:2A70                 </span>assume es:nothing
<span style="color:black">SYSINIT:2A70                 </span><span style="color:navy">jmp     short loc_6AB6
</span><span style="color:black">SYSINIT:2A72 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2A72
SYSINIT:2A72 </span><span style="color:navy">loc_6AA2:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A72                 </span><span style="color:navy">mov     dx, offset </span>OnOff <span style="color:gray">; &quot;\r\n&quot;
</span><span style="color:black">SYSINIT:2A75
SYSINIT:2A75 </span><span style="color:navy">loc_6AA5:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A75                 </span><span style="color:navy">mov     cx, cs:</span>CONFBOT
<span style="color:black">SYSINIT:2A7A                 </span><span style="color:navy">mov     es, cx          </span>; restore es -&gt; confbot seg
<span style="color:black">SYSINIT:2A7C                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2A7D                 </span><span style="color:navy">pop     ds              </span>; restore ds to sysinit_seg
<span style="color:black">SYSINIT:2A7E                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:2A7E                 </span><span style="color:navy">jnb     short loc_6AB6  </span>; if no error,then exit
<span style="color:black">SYSINIT:2A80                 </span><span style="color:navy">call    sub_9072        </span>; else show error message
<span style="color:black">SYSINIT:2A83                 </span><span style="color:navy">call    </span>error_line
<span style="color:black">SYSINIT:2A86
SYSINIT:2A86 </span><span style="color:navy">loc_6AB6:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A86                 </span><span style="color:navy">mov     bx, cs:</span>cntryfilehandle ; close a file.
<span style="color:black">SYSINIT:2A86                                         </span>; don&#039;t care even if it fails.
<span style="color:black">SYSINIT:2A8B                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:black">SYSINIT:2A8D                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CLOSE A FILE WITH HANDLE
<span style="color:black">SYSINIT:2A8D                                         </span>; BX = file handle
<span style="color:black">SYSINIT:2A8F                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2A8F </span><span style="color:gray">; END OF FUNCTION CHUNK FOR multi_pass
</span><span style="color:black">SYSINIT:2A92
SYSINIT:2A92 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2A92
SYSINIT:2A92
SYSINIT:2A92 </span>cntry_error     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A92                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">6           </span>; _$P_Out_Of_Range
<span style="color:black">SYSINIT:2A95                 </span><span style="color:navy">jnz     short </span><span style="color:gray">if64
</span><span style="color:black">SYSINIT:2A97                 </span><span style="color:navy">mov     dx, (offset </span>badstack<span style="color:navy">+</span><span style="color:green">1Ah</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:2A9A                 </span><span style="color:navy">jmp     short </span><span style="color:gray">en64
</span><span style="color:black">SYSINIT:2A9C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2A9C
SYSINIT:2A9C </span><span style="color:gray">if64</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A9C                 </span><span style="color:navy">mov     dx, (offset </span>badorder<span style="color:navy">+</span><span style="color:green">23h</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:2A9F
SYSINIT:2A9F </span><span style="color:gray">en64</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2A9F                 </span><span style="color:navy">call    sub_9072
</span><span style="color:black">SYSINIT:2AA2                 </span><span style="color:navy">call    </span>error_line
<span style="color:black">SYSINIT:2AA5                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2AA5 </span>cntry_error     endp
<span style="color:black">SYSINIT:2AA5
SYSINIT:2AA6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2AA6 </span><span style="color:gray">; START OF FUNCTION CHUNK FOR multi_pass
</span><span style="color:black">SYSINIT:2AA6
SYSINIT:2AA6 </span><span style="color:navy">loc_6AD6:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2AA6                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">46h </span><span style="color:gray">; &#039;F&#039;   </span>; CONFIG_FILES
<span style="color:black">SYSINIT:2AA9                 </span><span style="color:navy">jnz     short loc_6B0B
</span><span style="color:black">SYSINIT:2AAB                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2AAB                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2AAE                 </span><span style="color:navy">jb      short loc_6B0B
</span><span style="color:black">SYSINIT:2AB0                 </span><span style="color:navy">mov     di, offset </span>files_parms
<span style="color:black">SYSINIT:2AB3                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:2AB5                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:2AB7
SYSINIT:2AB7 </span><span style="color:navy">loc_6AE7:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2AB7                 </span><span style="color:navy">call    </span>sysinit_parse
<span style="color:black">SYSINIT:2ABA                 </span><span style="color:navy">jnb     short loc_6AF1  </span>;
<span style="color:black">SYSINIT:2ABA                                         </span>; parse error
<span style="color:black">SYSINIT:2ABA                                         </span>; show messages and end the search loop.
<span style="color:black">SYSINIT:2ABC                 </span><span style="color:navy">call    </span>badparm_p
<span style="color:black">SYSINIT:2ABF                 </span><span style="color:navy">jmp     short loc_6B08
</span><span style="color:black">SYSINIT:2AC1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2AC1
SYSINIT:2AC1 </span><span style="color:navy">loc_6AF1:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2AC1                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:2AC4                 </span><span style="color:navy">jz      short loc_6B00  </span>; then end the $endloop
<span style="color:black">SYSINIT:2AC6                 </span><span style="color:navy">mov     al, byte ptr cs:</span>rv_dword ;
<span style="color:black">SYSINIT:2AC6                                         </span>; [result_val+_$P_Result_Blk.Picked_Val]
<span style="color:black">SYSINIT:2ACA                 </span><span style="color:navy">mov     cs:</span>p_files<span style="color:navy">, al  </span>; save it temporarily
<span style="color:black">SYSINIT:2ACE                 </span><span style="color:navy">jmp     short loc_6AE7
</span><span style="color:black">SYSINIT:2AD0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2AD0
SYSINIT:2AD0 </span><span style="color:navy">loc_6B00:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2AD0                 </span><span style="color:navy">mov     al, cs:</span>p_files
<span style="color:black">SYSINIT:2AD4                 </span><span style="color:navy">mov     cs:</span>FILES<span style="color:navy">, al    </span>; no error. really set the value now.
<span style="color:black">SYSINIT:2AD8
SYSINIT:2AD8 </span><span style="color:navy">loc_6B08:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2AD8                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2ADB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2ADB
SYSINIT:2ADB </span><span style="color:navy">loc_6B0B:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2ADB                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">4Ch </span><span style="color:gray">; &#039;L&#039;   </span>; CONFIG_LASTDRIVE
<span style="color:black">SYSINIT:2ADE                 </span><span style="color:navy">jnz     short loc_6B40
</span><span style="color:black">SYSINIT:2AE0                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2AE0                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2AE3                 </span><span style="color:navy">jb      short loc_6B40
</span><span style="color:black">SYSINIT:2AE5                 </span><span style="color:navy">mov     di, offset </span>ldrv_parms
<span style="color:black">SYSINIT:2AE8                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:2AEA                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:2AEC
SYSINIT:2AEC </span><span style="color:navy">loc_6B1C:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2AEC                 </span><span style="color:navy">call    </span>sysinit_parse
<span style="color:black">SYSINIT:2AEF                 </span><span style="color:navy">jnb     short loc_6B26  </span>;
<span style="color:black">SYSINIT:2AEF                                         </span>; parse error
<span style="color:black">SYSINIT:2AEF                                         </span>; show messages and end the search loop.
<span style="color:black">SYSINIT:2AF1                 </span><span style="color:navy">call    </span>badparm_p
<span style="color:black">SYSINIT:2AF4                 </span><span style="color:navy">jmp     short loc_6B3D
</span><span style="color:black">SYSINIT:2AF6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2AF6
SYSINIT:2AF6 </span><span style="color:navy">loc_6B26:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2AF6                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:2AF9                 </span><span style="color:navy">jz      short loc_6B35  </span>; then end the $endloop
<span style="color:black">SYSINIT:2AFB                 </span><span style="color:navy">mov     al, byte ptr cs:</span>rv_dword ; [rv_byte]
<span style="color:black">SYSINIT:2AFB                                         </span>; pick up the drive number
<span style="color:black">SYSINIT:2AFF                 </span><span style="color:navy">mov     cs:</span>p_ldrv<span style="color:navy">, al   </span>; save it temporarily
<span style="color:black">SYSINIT:2B03                 </span><span style="color:navy">jmp     short loc_6B1C
</span><span style="color:black">SYSINIT:2B05 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2B05
SYSINIT:2B05 </span><span style="color:navy">loc_6B35:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B05                 </span><span style="color:navy">mov     al, cs:</span>p_ldrv
<span style="color:black">SYSINIT:2B09                 </span><span style="color:navy">mov     cs:</span>NUM_CDS<span style="color:navy">, al  </span>; no error.
<span style="color:black">SYSINIT:2B09                                         </span>; really set the value now.
<span style="color:black">SYSINIT:2B0D
SYSINIT:2B0D </span><span style="color:navy">loc_6B3D:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B0D                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2B10 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2B10
SYSINIT:2B10 </span><span style="color:navy">loc_6B40:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B10                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">50h </span><span style="color:gray">; &#039;P&#039;   </span>; CONFIG_DRIVPARM
<span style="color:black">SYSINIT:2B13                 </span><span style="color:navy">jnz     short loc_6B5B
</span><span style="color:black">SYSINIT:2B15                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2B15                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2B18                 </span><span style="color:navy">jb      short loc_6B5B
</span><span style="color:black">SYSINIT:2B1A                 </span><span style="color:navy">call    loc_7FDB
</span><span style="color:black">SYSINIT:2B1D                 </span><span style="color:navy">jb      short loc_6B58
</span><span style="color:black">SYSINIT:2B1F                 </span><span style="color:navy">call    loc_7F75
</span><span style="color:black">SYSINIT:2B22                 </span><span style="color:navy">call    loc_7FBF
</span><span style="color:black">SYSINIT:2B25                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2B28 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2B28
SYSINIT:2B28 </span><span style="color:navy">loc_6B58:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B28                 </span><span style="color:navy">jmp     loc_6DDB
</span><span style="color:black">SYSINIT:2B2B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2B2B
SYSINIT:2B2B </span><span style="color:navy">loc_6B5B:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B2B                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">4Bh </span><span style="color:gray">; &#039;K&#039;   </span>; CONFIG_STACKS
<span style="color:black">SYSINIT:2B2E                 </span><span style="color:navy">jz      short loc_6B63
</span><span style="color:black">SYSINIT:2B30
SYSINIT:2B30 </span><span style="color:navy">loc_6B60:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B30                 </span><span style="color:navy">jmp     loc_6C0C
</span><span style="color:black">SYSINIT:2B33 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2B33
SYSINIT:2B33 </span><span style="color:navy">loc_6B63:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B33                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2B33                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2B36                 </span><span style="color:navy">jb      short loc_6B60
</span><span style="color:black">SYSINIT:2B38                 </span><span style="color:navy">mov     di, offset </span>stks_parms
<span style="color:black">SYSINIT:2B3B                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:2B3D                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:2B3F
SYSINIT:2B3F </span><span style="color:navy">loc_6B6F:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B3F                 </span><span style="color:navy">call    </span>sysinit_parse
<span style="color:black">SYSINIT:2B42                 </span><span style="color:navy">jnb     short loc_6B80  </span>; parse error
<span style="color:black">SYSINIT:2B44                 </span><span style="color:navy">mov     dx, (offset </span>_$CleanMsg<span style="color:navy">+</span><span style="color:green">32h</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:2B47                 </span><span style="color:navy">call    sub_9072        </span>; show messages and end the search loop.
<span style="color:black">SYSINIT:2B4A                 </span><span style="color:navy">call    </span>error_line
<span style="color:black">SYSINIT:2B4D                 </span><span style="color:navy">jmp     loc_6C09        </span>; (jmp coff)
<span style="color:black">SYSINIT:2B50 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2B50
SYSINIT:2B50 </span><span style="color:navy">loc_6B80:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B50                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:2B53                 </span><span style="color:navy">jz      short loc_6B9A  </span>; then end the $endloop
<span style="color:black">SYSINIT:2B55                 </span><span style="color:navy">mov     ax, word ptr cs:</span>rv_dword ;
<span style="color:black">SYSINIT:2B55                                         </span>; [cs:result_val+_$P_Result_Blk.Picked_Val]
<span style="color:black">SYSINIT:2B59                 </span><span style="color:navy">cmp     cx, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:2B5C                 </span><span style="color:navy">jnz     short loc_6B94
</span><span style="color:black">SYSINIT:2B5E                 </span><span style="color:navy">mov     cs:</span>p_stack_count<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:2B62                 </span><span style="color:navy">jmp     short loc_6B98
</span><span style="color:black">SYSINIT:2B64 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2B64
SYSINIT:2B64 </span><span style="color:navy">loc_6B94:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B64                 </span><span style="color:navy">mov     cs:</span>p_stack_size<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:2B68
SYSINIT:2B68 </span><span style="color:navy">loc_6B98:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B68                 </span><span style="color:navy">jmp     short loc_6B6F
</span><span style="color:black">SYSINIT:2B6A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2B6A
SYSINIT:2B6A </span><span style="color:navy">loc_6B9A:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B6A                 </span><span style="color:navy">cmp     cs:</span>p_stack_count<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2B70                 </span><span style="color:navy">jz      short loc_6BBB
</span><span style="color:black">SYSINIT:2B72                 </span><span style="color:navy">cmp     cs:</span>p_stack_count<span style="color:navy">, </span><span style="color:green">8 </span>; mincount
<span style="color:black">SYSINIT:2B78                 </span><span style="color:navy">jb      short loc_6BB2
</span><span style="color:black">SYSINIT:2B7A                 </span><span style="color:navy">cmp     cs:</span>p_stack_size<span style="color:navy">, </span><span style="color:green">32 </span>; minsize
<span style="color:black">SYSINIT:2B80                 </span><span style="color:navy">jnb     short loc_6BB9
</span><span style="color:black">SYSINIT:2B82
SYSINIT:2B82 </span><span style="color:navy">loc_6BB2:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B82                 </span><span style="color:navy">mov     cs:</span>p_stack_count<span style="color:navy">, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:2B89
SYSINIT:2B89 </span><span style="color:navy">loc_6BB9:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B89                 </span><span style="color:navy">jmp     short loc_6BCA
</span><span style="color:black">SYSINIT:2B8B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2B8B
SYSINIT:2B8B </span><span style="color:navy">loc_6BBB:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B8B                 </span><span style="color:navy">cmp     cs:</span>p_stack_size<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2B91                 </span><span style="color:navy">jz      short loc_6BCA
</span><span style="color:black">SYSINIT:2B93                 </span><span style="color:navy">mov     cs:</span>p_stack_count<span style="color:navy">, </span><span style="color:green">0FFFFh </span>; -1 ; invalid
<span style="color:black">SYSINIT:2B9A
SYSINIT:2B9A </span><span style="color:navy">loc_6BCA:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2B9A                 </span><span style="color:navy">cmp     cs:</span>p_stack_count<span style="color:navy">, </span><span style="color:green">0FFFFh </span>; -1 ; invalid?
<span style="color:black">SYSINIT:2BA0                 </span><span style="color:navy">jnz     short loc_6BF2
</span><span style="color:black">SYSINIT:2BA2                 </span><span style="color:navy">mov     cs:</span>stack_count<span style="color:navy">, </span><span style="color:#ff8000">9 </span>; defaultcount
<span style="color:black">SYSINIT:2BA2                                         </span>; reset to default value.
<span style="color:black">SYSINIT:2BA9                 </span><span style="color:navy">mov     cs:</span>stack_size<span style="color:navy">, </span><span style="color:green">128 </span>; defaultsize
<span style="color:black">SYSINIT:2BB0                 </span><span style="color:navy">mov     cs:</span>stack_addr<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; stacks= been accepted.
<span style="color:black">SYSINIT:2BB7                 </span><span style="color:navy">mov     dx, (offset </span>_$CleanMsg<span style="color:navy">+</span><span style="color:green">32h</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:2BBA                 </span><span style="color:navy">call    sub_9072
</span><span style="color:black">SYSINIT:2BBD                 </span><span style="color:navy">call    </span>error_line
<span style="color:black">SYSINIT:2BC0                 </span><span style="color:navy">jmp     short loc_6C09
</span><span style="color:black">SYSINIT:2BC2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2BC2
SYSINIT:2BC2 </span><span style="color:navy">loc_6BF2:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2BC2                 </span><span style="color:navy">mov     ax, cs:</span>p_stack_count
<span style="color:black">SYSINIT:2BC6                 </span><span style="color:navy">mov     cs:</span>stack_count<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:2BCA                 </span><span style="color:navy">mov     ax, cs:</span>p_stack_size
<span style="color:black">SYSINIT:2BCE                 </span><span style="color:navy">mov     cs:</span>stack_size<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:2BD2                 </span><span style="color:navy">mov     cs:</span>stack_addr<span style="color:navy">, </span><span style="color:green">0FFFFh </span>; -1 ; stacks= been accepted.
<span style="color:black">SYSINIT:2BD9
SYSINIT:2BD9 </span><span style="color:navy">loc_6C09:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2BD9                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2BDC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2BDC
SYSINIT:2BDC </span><span style="color:navy">loc_6C0C:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2BDC                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">53h </span><span style="color:gray">; &#039;S&#039;   </span>; CONFIG_SHELL
<span style="color:black">SYSINIT:2BDF                 </span><span style="color:navy">jnz     short loc_6C6F
</span><span style="color:black">SYSINIT:2BE1                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2BE1                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2BE4                 </span><span style="color:navy">jb      short loc_6C6F
</span><span style="color:black">SYSINIT:2BE6                 </span><span style="color:navy">mov     cs:byte_917D, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:2BEC                 </span><span style="color:navy">mov     word ptr cs:</span>bMaxBlock<span style="color:navy">, </span><span style="color:#ff8000">0 </span>;
<span style="color:black">SYSINIT:2BEC                                         </span>; zap length,first byte of command-line
<span style="color:black">SYSINIT:2BF3                 </span><span style="color:navy">mov     di, (offset aCommand_com+</span><span style="color:green">1</span><span style="color:navy">) </span>; we already have the first char
<span style="color:black">SYSINIT:2BF6                 </span><span style="color:navy">mov     [di-</span><span style="color:green">1</span><span style="color:navy">], al      </span>; of the new shell in AL, save it now
<span style="color:black">SYSINIT:2BF9
SYSINIT:2BF9 </span><span style="color:navy">loc_6C29:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2BF9                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:2BFC                 </span><span style="color:navy">or      al, al          </span>; this is the normal case: &quot;organize&quot;
<span style="color:black">SYSINIT:2BFE                 </span><span style="color:navy">jz      short loc_6C3F  </span>; put a ZERO right after the filename
<span style="color:black">SYSINIT:2C00                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;   </span>; this may happen if there are no args
<span style="color:black">SYSINIT:2C02                 </span><span style="color:navy">jb      short loc_6C60  </span>; I suppose...
<span style="color:black">SYSINIT:2C04                 </span><span style="color:navy">mov     [di], al
</span><span style="color:black">SYSINIT:2C06                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:2C07                 </span><span style="color:navy">cmp     di, (offset byte_918D+</span><span style="color:green">32h</span><span style="color:navy">) </span>; commnd+63
<span style="color:black">SYSINIT:2C07                                         </span>; this makes sure we don&#039;t overflow
<span style="color:black">SYSINIT:2C07                                         </span>; commnd (the filename)
<span style="color:black">SYSINIT:2C0B                 </span><span style="color:navy">jb      short loc_6C29
</span><span style="color:black">SYSINIT:2C0D                 </span><span style="color:navy">jmp     short loc_6C60
</span><span style="color:black">SYSINIT:2C0F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2C0F
SYSINIT:2C0F </span><span style="color:navy">loc_6C3F:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C0F                 </span><span style="color:navy">mov     byte ptr [di], </span><span style="color:#ff8000">0 </span>; zero-terminate the filename
<span style="color:black">SYSINIT:2C12                 </span><span style="color:navy">mov     di, offset </span>offDefBlock ;
<span style="color:black">SYSINIT:2C12                                         </span>; prepare to process the command-line
<span style="color:black">SYSINIT:2C15
SYSINIT:2C15 </span><span style="color:navy">loc_6C45:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C15                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:2C18                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:black">SYSINIT:2C1A                 </span><span style="color:navy">jb      short loc_6C55
</span><span style="color:black">SYSINIT:2C1C                 </span><span style="color:navy">mov     [di], al
</span><span style="color:black">SYSINIT:2C1E                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:2C1F                 </span><span style="color:navy">cmp     di, (offset </span>secElapsed<span style="color:navy">+</span><span style="color:green">7Ah</span><span style="color:navy">) </span>; command_line+126
<span style="color:black">SYSINIT:2C23                 </span><span style="color:navy">jb      short loc_6C45
</span><span style="color:black">SYSINIT:2C25
SYSINIT:2C25 </span><span style="color:navy">loc_6C55:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C25                 </span><span style="color:navy">mov     cx, di
</span><span style="color:black">SYSINIT:2C27                 </span><span style="color:navy">sub     cx, offset </span>offDefBlock <span style="color:gray">; &quot;/P&quot;
</span><span style="color:black">SYSINIT:2C2B                 </span><span style="color:navy">mov     cs:</span>bMaxBlock<span style="color:navy">, cl
</span><span style="color:black">SYSINIT:2C30
SYSINIT:2C30 </span><span style="color:navy">loc_6C60:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C30                 </span><span style="color:navy">mov     byte ptr [di], </span><span style="color:#ff8000">0 </span>; zero-terminate the filename
<span style="color:black">SYSINIT:2C30                                         </span>; (or the command-line as the case may be)
<span style="color:black">SYSINIT:2C33
SYSINIT:2C33 </span><span style="color:navy">loc_6C63:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C33                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah         </span>; lf ; the safest way to eat the rest of
<span style="color:black">SYSINIT:2C35                 </span><span style="color:navy">jz      short loc_6C6C  </span>; the line: watch for ever-present LF
<span style="color:black">SYSINIT:2C37                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:2C3A                 </span><span style="color:navy">jnb     short loc_6C63
</span><span style="color:black">SYSINIT:2C3C
SYSINIT:2C3C </span><span style="color:navy">loc_6C6C:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C3C                 </span><span style="color:navy">jmp     </span>conflp
<span style="color:black">SYSINIT:2C3F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2C3F
SYSINIT:2C3F </span><span style="color:navy">loc_6C6F:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C3F                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">58h </span><span style="color:gray">; &#039;X&#039;   </span>; CONFIG_FCBS
<span style="color:black">SYSINIT:2C42                 </span><span style="color:navy">jnz     short loc_6CB5
</span><span style="color:black">SYSINIT:2C44                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2C44                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2C47                 </span><span style="color:navy">jb      short loc_6CB5
</span><span style="color:black">SYSINIT:2C49                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">2153h
</span><span style="color:black">SYSINIT:2C4C                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:2C4E                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:2C50
SYSINIT:2C50 </span><span style="color:navy">loc_6C80:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C50                 </span><span style="color:navy">call    </span>sysinit_parse
<span style="color:black">SYSINIT:2C53                 </span><span style="color:navy">jnb     short loc_6C8A
</span><span style="color:black">SYSINIT:2C55                 </span><span style="color:navy">call    </span>badparm_p       ; parse error
<span style="color:black">SYSINIT:2C55                                         </span>; show messages and end the search loop.
<span style="color:black">SYSINIT:2C58                 </span><span style="color:navy">jmp     short loc_6CB2
</span><span style="color:black">SYSINIT:2C5A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2C5A
SYSINIT:2C5A </span><span style="color:navy">loc_6C8A:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C5A                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:2C5D                 </span><span style="color:navy">jz      short loc_6CA4  </span>; then end the $endloop
<span style="color:black">SYSINIT:2C5F                 </span><span style="color:navy">mov     al, byte ptr cs:</span>rv_dword ;
<span style="color:black">SYSINIT:2C5F                                         </span>; [cs:result_val+_$P_Result_Blk.Picked_Val]
<span style="color:black">SYSINIT:2C63                 </span><span style="color:navy">cmp     cx, </span><span style="color:#ff8000">1           </span>; the first positional?
<span style="color:black">SYSINIT:2C66                 </span><span style="color:navy">jnz     short loc_6C9E
</span><span style="color:black">SYSINIT:2C68                 </span><span style="color:navy">mov     cs:</span>p_fcbs<span style="color:navy">, al
</span><span style="color:black">SYSINIT:2C6C                 </span><span style="color:navy">jmp     short loc_6CA2
</span><span style="color:black">SYSINIT:2C6E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2C6E
SYSINIT:2C6E </span><span style="color:navy">loc_6C9E:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C6E                 </span><span style="color:navy">mov     cs:</span>p_keep<span style="color:navy">, al
</span><span style="color:black">SYSINIT:2C72
SYSINIT:2C72 </span><span style="color:navy">loc_6CA2:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C72                 </span><span style="color:navy">jmp     short loc_6C80
</span><span style="color:black">SYSINIT:2C74 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2C74
SYSINIT:2C74 </span><span style="color:navy">loc_6CA4:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C74                 </span><span style="color:navy">mov     al, cs:</span>p_fcbs
<span style="color:black">SYSINIT:2C78                 </span><span style="color:navy">mov     cs:</span>FCBS<span style="color:navy">, al
</span><span style="color:black">SYSINIT:2C7C                 </span><span style="color:navy">mov     cs:</span>KEEP<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2C82
SYSINIT:2C82 </span><span style="color:navy">loc_6CB2:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C82                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2C85 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2C85
SYSINIT:2C85 </span><span style="color:navy">loc_6CB5:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C85                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">31h </span><span style="color:gray">; &#039;1&#039;   </span>; CONFIG_SWITCHES
<span style="color:black">SYSINIT:2C85                                         </span>; switches= command entered?
<span style="color:black">SYSINIT:2C88                 </span><span style="color:navy">jz      short loc_6CBD  </span>; yes
<span style="color:black">SYSINIT:2C8A
SYSINIT:2C8A </span><span style="color:navy">loc_6CBA:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C8A                 </span><span style="color:navy">jmp     loc_6D44
</span><span style="color:black">SYSINIT:2C8D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2C8D
SYSINIT:2C8D </span><span style="color:navy">loc_6CBD:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C8D                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2C8D                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2C90                 </span><span style="color:navy">jb      short loc_6CBA
</span><span style="color:black">SYSINIT:2C92                 </span><span style="color:navy">mov     di, offset </span>swit_parms
<span style="color:black">SYSINIT:2C95                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:2C97                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:2C99
SYSINIT:2C99 </span><span style="color:navy">loc_6CC9:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2C99                 </span><span style="color:navy">call    </span>sysinit_parse
<span style="color:black">SYSINIT:2C9C                 </span><span style="color:navy">jnb     short loc_6CD3  </span>;
<span style="color:black">SYSINIT:2C9C                                         </span>; parse error
<span style="color:black">SYSINIT:2C9C                                         </span>; show messages and end the search loop.
<span style="color:black">SYSINIT:2C9E                 </span><span style="color:navy">call    </span>badparm_p
<span style="color:black">SYSINIT:2CA1                 </span><span style="color:navy">jmp     short loc_6D41
</span><span style="color:black">SYSINIT:2CA3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2CA3
SYSINIT:2CA3 </span><span style="color:navy">loc_6CD3:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2CA3                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:2CA6                 </span><span style="color:navy">jz      short loc_6D0B  </span>; then jmp to $endloop for semantic check
<span style="color:black">SYSINIT:2CA8                 </span><span style="color:navy">cmp     cs:</span>result_val_swoff<span style="color:navy">, offset </span>swit_k ; offset &quot;/K&quot;
<span style="color:black">SYSINIT:2CA8                                         </span>; [cs:result_val+_$P_Result_Blk.SYNONYM_Ptr]
<span style="color:black">SYSINIT:2CAF                 </span><span style="color:navy">jnz     short loc_6CE9
</span><span style="color:black">SYSINIT:2CB1                 </span><span style="color:navy">mov     cs:</span>p_swit_k<span style="color:navy">, </span><span style="color:#ff8000">1  </span>; set the flag
<span style="color:black">SYSINIT:2CB7                 </span><span style="color:navy">jmp     short loc_6CC9
</span><span style="color:black">SYSINIT:2CB9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2CB9
SYSINIT:2CB9 </span><span style="color:navy">loc_6CE9:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2CB9                 </span><span style="color:navy">cmp     cs:</span>result_val_swoff<span style="color:navy">, offset </span>swit_t ; offset &quot;/T&quot;
<span style="color:black">SYSINIT:2CB9                                         </span>; [cs:result_val+_$P_Result_Blk.SYNONYM_Ptr]
<span style="color:black">SYSINIT:2CC0                 </span><span style="color:navy">jnz     short loc_6CFA
</span><span style="color:black">SYSINIT:2CC2                 </span><span style="color:navy">mov     cs:</span>p_swit_t<span style="color:navy">, </span><span style="color:#ff8000">1  </span>; set the flag
<span style="color:black">SYSINIT:2CC8                 </span><span style="color:navy">jmp     short loc_6CC9
</span><span style="color:black">SYSINIT:2CCA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2CCA
SYSINIT:2CCA </span><span style="color:navy">loc_6CFA:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2CCA                 </span><span style="color:navy">cmp     cs:</span>result_val_swoff<span style="color:navy">, offset </span>swit_w <span style="color:gray">; &quot;/W&quot;
</span><span style="color:black">SYSINIT:2CD1                 </span><span style="color:navy">jnz     short loc_6CC9
</span><span style="color:black">SYSINIT:2CD3                 </span><span style="color:navy">mov     cs:</span>p_swit_w<span style="color:navy">, </span><span style="color:#ff8000">1  </span>; set the flag
<span style="color:black">SYSINIT:2CD9                 </span><span style="color:navy">jmp     short loc_6CC9
</span><span style="color:black">SYSINIT:2CDB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2CDB
SYSINIT:2CDB </span><span style="color:navy">loc_6D0B:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2CDB                 </span><span style="color:navy">cmp     cs:</span>p_swit_k<span style="color:navy">, </span><span style="color:#ff8000">1  </span>; if /k entered,
<span style="color:black">SYSINIT:2CE1                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2CE2                 </span><span style="color:navy">mov     ax, </span><span style="color:green">70h         </span>; DOSBIODATASEG ; BIOSDATA segment
<span style="color:black">SYSINIT:2CE5                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:2CE7                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2CE7                 </span><span style="color:navy">jnz     short loc_6D23
</span><span style="color:black">SYSINIT:2CE9                 </span><span style="color:navy">mov     ds:</span>keyrd_func<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; BIOSDATA:04E5h
<span style="color:black">SYSINIT:2CE9                                         </span>; use the conventional keyboard functions
<span style="color:black">SYSINIT:2CEE                 </span><span style="color:navy">mov     ds:</span>keysts_func<span style="color:navy">, </span><span style="color:#ff8000">1 </span>; BIOSDATA:04E6h
<span style="color:black">SYSINIT:2CF3
SYSINIT:2CF3 </span><span style="color:navy">loc_6D23:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2CF3                 </span><span style="color:navy">mov     al, cs:</span>p_swit_t
<span style="color:black">SYSINIT:2CF7                 </span><span style="color:navy">mov     ds:</span>t_switch<span style="color:navy">, al
</span><span style="color:black">SYSINIT:2CFA                 </span><span style="color:navy">cmp     cs:</span>p_swit_w<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2D00                 </span><span style="color:navy">jz      short loc_6D40
</span><span style="color:black">SYSINIT:2D02                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:2D03                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:2D04                 </span><span style="color:navy">mov     ah, </span><span style="color:green">52h         </span>; GET_IN_VARS
<span style="color:black">SYSINIT:2D06                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ internal - GET LIST OF LISTS
<span style="color:black">SYSINIT:2D06                                         </span>; Return: ES:BX -&gt; DOS list of lists
<span style="color:black">SYSINIT:2D08                 </span><span style="color:navy">or      byte ptr es:</span><span style="color:green">86h</span><span style="color:navy">, </span><span style="color:green">2 </span>; [es:DOS_FLAG_OFFSET], SUPPRESS_WINA20
<span style="color:black">SYSINIT:2D0E                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:2D0F                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2D10
SYSINIT:2D10 </span><span style="color:navy">loc_6D40:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D10                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2D11                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2D11
SYSINIT:2D11 </span><span style="color:navy">loc_6D41:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D11                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2D14 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2D14
SYSINIT:2D14 </span><span style="color:navy">loc_6D44:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D14                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">56h </span><span style="color:gray">; &#039;V&#039;   </span>; CONFIG_SET ; set var=value&lt;cr/lf&gt;
<span style="color:black">SYSINIT:2D17                 </span><span style="color:navy">jnz     short loc_6D58
</span><span style="color:black">SYSINIT:2D19                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2D19                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2D1C                 </span><span style="color:navy">jb      short loc_6D58
</span><span style="color:black">SYSINIT:2D1E                 </span><span style="color:navy">call    loc_87D0        </span>; copy var at ES:SI to &quot;config_wrkseg&quot;
<span style="color:black">SYSINIT:2D21                 </span><span style="color:navy">jnb     short loc_6D41  </span>; no error
<span style="color:black">SYSINIT:2D23
SYSINIT:2D23 </span><span style="color:navy">loc_6D53:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D23                 </span><span style="color:navy">call    </span>error_line      ; whoops, display error in line XXX
<span style="color:black">SYSINIT:2D26                 </span><span style="color:navy">jmp     short loc_6D41  </span>; jump to coff (to skip to next line)
<span style="color:black">SYSINIT:2D28 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2D28
SYSINIT:2D28 </span><span style="color:navy">loc_6D58:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D28                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">4Eh </span><span style="color:gray">; &#039;N&#039;   </span>; CONFIG_NUMLOCK ; numlock=on|off
<span style="color:black">SYSINIT:2D2B                 </span><span style="color:navy">jnz     short loc_6D69
</span><span style="color:black">SYSINIT:2D2D                 </span><span style="color:navy">call    loc_8BE1        </span>; query the user if config_cmd
<span style="color:black">SYSINIT:2D2D                                         </span>; has the CONFIG_OPTION_QUERY bit set
<span style="color:black">SYSINIT:2D30                 </span><span style="color:navy">jb      short loc_6D69
</span><span style="color:black">SYSINIT:2D32                 </span><span style="color:navy">call    loc_844D
</span><span style="color:black">SYSINIT:2D35                 </span><span style="color:navy">jb      short loc_6D53
</span><span style="color:black">SYSINIT:2D37                 </span><span style="color:navy">jmp     short loc_6D41  </span>; all done
<span style="color:black">SYSINIT:2D39 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2D39
SYSINIT:2D39 </span><span style="color:navy">loc_6D69:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D39                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">59h </span><span style="color:gray">; &#039;Y&#039;   </span>; CONFIG_COMMENT
<span style="color:black">SYSINIT:2D39                                         </span>; (do nothing with this line.)
<span style="color:black">SYSINIT:2D3C                 </span><span style="color:navy">jnz     short loc_6D79
</span><span style="color:black">SYSINIT:2D3E
SYSINIT:2D3E </span><span style="color:navy">loc_6D6E:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D3E                 </span><span style="color:navy">dec     ds:</span>chrptr
<span style="color:black">SYSINIT:2D42                 </span><span style="color:navy">inc     ds:</span>count
<span style="color:black">SYSINIT:2D46                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2D49 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2D49
SYSINIT:2D49 </span><span style="color:navy">loc_6D79:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D49                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;   </span>; CONFIG_REM
<span style="color:black">SYSINIT:2D49                                         </span>; (do nothing with this line.)
<span style="color:black">SYSINIT:2D4C                 </span><span style="color:navy">jz      short loc_6D6E
</span><span style="color:black">SYSINIT:2D4E                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">0FFh        </span>; null/bogus command?
<span style="color:black">SYSINIT:2D51                 </span><span style="color:navy">jz      short loc_6D6E
</span><span style="color:black">SYSINIT:2D53                 </span><span style="color:navy">dec     ds:</span>chrptr
<span style="color:black">SYSINIT:2D57                 </span><span style="color:navy">inc     ds:</span>count
<span style="color:black">SYSINIT:2D5B                 </span><span style="color:navy">jmp     short loc_6DDB
</span><span style="color:black">SYSINIT:2D5B </span><span style="color:gray">; END OF FUNCTION CHUNK FOR multi_pass
</span><span style="color:black">SYSINIT:2D5D
SYSINIT:2D5D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2D5D
SYSINIT:2D5D
SYSINIT:2D5D </span>CheckProtmanArena proc near             <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D5D                 </span><span style="color:navy">push    es              </span>; adjusts alloclim if Protman$
<span style="color:black">SYSINIT:2D5D                                         </span>; reduced our arena through a manual hack
<span style="color:black">SYSINIT:2D5E                 </span><span style="color:navy">mov     ax, cs:</span>area     ; get our arena header
<span style="color:black">SYSINIT:2D62                 </span><span style="color:navy">dec     ax
</span><span style="color:black">SYSINIT:2D63                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:2D65                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE] ; find end of arena
<span style="color:black">SYSINIT:2D6A                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:2D6B                 </span><span style="color:navy">cmp     ax, cs:</span>ALLOCLIM ; is it less than alloclim?
<span style="color:black">SYSINIT:2D70                 </span><span style="color:navy">ja      short </span><span style="color:gray">CheckProtmanDone
</span><span style="color:black">SYSINIT:2D72                 </span><span style="color:navy">mov     cs:</span>ALLOCLIM<span style="color:navy">, ax </span>; reduce alloclim then
<span style="color:black">SYSINIT:2D76
SYSINIT:2D76 </span><span style="color:gray">CheckProtmanDone</span><span style="color:navy">:                       </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D76                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2D77                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2D77 </span>CheckProtmanArena endp
<span style="color:black">SYSINIT:2D77
SYSINIT:2D78
SYSINIT:2D78 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2D78
SYSINIT:2D78
SYSINIT:2D78 </span>sysinit_parse   proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D78                 </span><span style="color:navy">push    es              </span>; set up registers for sysparse
<span style="color:black">SYSINIT:2D78                                         </span>; in:
<span style="color:black">SYSINIT:2D78                                         </span>;    es:si -&gt; command line in confbot
<span style="color:black">SYSINIT:2D78                                         </span>;       di -&gt; offset of the parse control definition.
<span style="color:black">SYSINIT:2D78                                         </span>; out:
<span style="color:black">SYSINIT:2D78                                         </span>;    calls sysparse.
<span style="color:black">SYSINIT:2D78                                         </span>;    carry will set if parse error.
<span style="color:black">SYSINIT:2D78                                         </span>;    *** the caller should check the eol condition by looking at ax
<span style="color:black">SYSINIT:2D78                                         </span>;    *** after each call.
<span style="color:black">SYSINIT:2D78                                         </span>;    *** if no parameters are found,then ax will contain a error code.
<span style="color:black">SYSINIT:2D78                                         </span>;    *** if the caller needs to look at the synomym@ of the result,
<span style="color:black">SYSINIT:2D78                                         </span>;    *** the caller should use cs:@ instead of es:@.
<span style="color:black">SYSINIT:2D78                                         </span>;    cx should be set to 0 at the 1st time the caller calls this proc.
<span style="color:black">SYSINIT:2D78                                         </span>;    ax - exit code
<span style="color:black">SYSINIT:2D78                                         </span>;    bl - terminated delimeter code
<span style="color:black">SYSINIT:2D78                                         </span>;    cx - new positional ordinal
<span style="color:black">SYSINIT:2D78                                         </span>;    si - set to pase scanned operand
<span style="color:black">SYSINIT:2D78                                         </span>;    dx - selected result buffer
<span style="color:black">SYSINIT:2D79                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2D7A                 </span><span style="color:navy">push    es              </span>; now ds:si -&gt; command line
<span style="color:black">SYSINIT:2D7B                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2D7C                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2D7D                 </span><span style="color:navy">pop     es              </span>; now es:di -&gt; control definition
<span style="color:black">SYSINIT:2D7E                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:2D7E                 </span><span style="color:navy">mov     word ptr cs:</span>badparm_ptr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ds </span>; save the pointer to the parm
<span style="color:black">SYSINIT:2D83                 </span><span style="color:navy">mov     word ptr cs:</span>badparm_ptr<span style="color:navy">, si </span>; we are about to parse for badparm msg.
<span style="color:black">SYSINIT:2D88                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2D8B                 </span><span style="color:navy">call    </span>SysParse
<span style="color:black">SYSINIT:2D8E                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">0           </span>; _$P_No_Error ; no error
<span style="color:black">SYSINIT:2D91                 </span><span style="color:navy">jz      short </span><span style="color:gray">ll4       </span>; cf=0
<span style="color:black">SYSINIT:2D93                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh      </span>; _$P_RC_EOL ; end of line?
<span style="color:black">SYSINIT:2D96                 </span><span style="color:navy">jnz     short </span><span style="color:gray">if4       </span>; or the end of line?
<span style="color:black">SYSINIT:2D98
SYSINIT:2D98 </span><span style="color:gray">ll4</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D98                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:2D99                 </span><span style="color:navy">jmp     short </span><span style="color:gray">en4
</span><span style="color:black">SYSINIT:2D9B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2D9B
SYSINIT:2D9B </span><span style="color:gray">if4</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D9B                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:2D9C
SYSINIT:2D9C </span><span style="color:gray">en4</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2D9C                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2D9D                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2D9E                 </span>assume es:nothing
<span style="color:black">SYSINIT:2D9E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2D9E </span>sysinit_parse   endp
<span style="color:black">SYSINIT:2D9E
</span><span style="color:maroon">SYSINIT:2D9F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:2D9F
SYSINIT:2D9F </span>badop_p<span style="color:navy">:                                </span>; &#039;badop_p&#039; is not used in
<span style="color:maroon">SYSINIT:2D9F                 </span><span style="color:navy">push    cs              </span>; MSDOS 6.21 IO.SYS and PCDOS 7.1 IBMBIO.COM
<span style="color:maroon">SYSINIT:2D9F                                         </span>; (but it was/is not removed)
<span style="color:maroon">SYSINIT:2D9F                                         </span>; Erdogan Tan - 11/07/2023
<span style="color:maroon">SYSINIT:2DA0                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:2DA1                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:2DA1                 </span><span style="color:navy">mov     dx, offset unk_95CE
</span><span style="color:maroon">SYSINIT:2DA4                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:2DA7                 </span><span style="color:navy">call    </span>error_line
<span style="color:maroon">SYSINIT:2DAA                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2DAB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2DAB </span><span style="color:gray">; START OF FUNCTION CHUNK FOR multi_pass
</span><span style="color:black">SYSINIT:2DAB
SYSINIT:2DAB </span><span style="color:navy">loc_6DDB:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2DAB                 </span><span style="color:navy">mov     dx, offset unk_95CE
</span><span style="color:black">SYSINIT:2DAE                 </span><span style="color:navy">call    sub_9072
</span><span style="color:black">SYSINIT:2DB1                 </span><span style="color:navy">call    </span>error_line
<span style="color:black">SYSINIT:2DB4                 </span><span style="color:navy">jmp     </span>coff
<span style="color:black">SYSINIT:2DB4 </span><span style="color:gray">; END OF FUNCTION CHUNK FOR multi_pass
</span><span style="color:black">SYSINIT:2DB7
SYSINIT:2DB7 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2DB7
SYSINIT:2DB7
SYSINIT:2DB7 </span>badparm_p       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2DB7                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2DB8                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:2DB9                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:2DBA                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2DBB                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2DBC                 </span><span style="color:navy">mov     dx, (offset </span>insufmemory<span style="color:navy">+</span><span style="color:green">23h</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:2DBF                 </span><span style="color:navy">call    sub_9072
</span><span style="color:black">SYSINIT:2DC2                 </span><span style="color:navy">lds     si, </span>badparm_ptr
<span style="color:black">SYSINIT:2DC6                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2DC6
SYSINIT:2DC6 </span><span style="color:gray">do1</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2DC6                 </span><span style="color:navy">mov     dl, [si]        </span>; print &quot;xxxx&quot; until cr.
<span style="color:black">SYSINIT:2DC8                 </span><span style="color:navy">cmp     dl, </span><span style="color:#ff8000">0Dh         </span>; cr ?
<span style="color:black">SYSINIT:2DCB                 </span><span style="color:navy">jz      short </span><span style="color:gray">en1       </span>; yes
<span style="color:black">SYSINIT:2DCD                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2           </span>; display character
<span style="color:black">SYSINIT:2DCF                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - DISPLAY OUTPUT
<span style="color:black">SYSINIT:2DCF                                         </span>; DL = character to send to standard output
<span style="color:black">SYSINIT:2DD1                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:2DD2                 </span><span style="color:navy">jmp     short </span><span style="color:gray">do1
</span><span style="color:black">SYSINIT:2DD4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2DD4
SYSINIT:2DD4 </span><span style="color:gray">en1</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2DD4                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2DD5                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2DD6                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:2DD6                 </span><span style="color:navy">mov     dx, (offset </span>insufmemory<span style="color:navy">+</span><span style="color:green">20h</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:2DD9                 </span><span style="color:navy">call    sub_9072
</span><span style="color:black">SYSINIT:2DDC                 </span><span style="color:navy">call    </span>error_line
<span style="color:black">SYSINIT:2DDF                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:2DE0                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:2DE1                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2DE2                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2DE2                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2DE2 </span>badparm_p       endp
<span style="color:black">SYSINIT:2DE2
SYSINIT:2DE3
SYSINIT:2DE3 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2DE3
SYSINIT:2DE3
SYSINIT:2DE3 </span>getchr          proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2DE3                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:2DE4                 </span><span style="color:navy">mov     cx, ds:</span>count
<span style="color:black">SYSINIT:2DE8                 </span><span style="color:navy">jcxz    short </span><span style="color:gray">nochar
</span><span style="color:black">SYSINIT:2DEA                 </span><span style="color:navy">mov     si, ds:</span>chrptr
<span style="color:black">SYSINIT:2DEE                 </span><span style="color:navy">mov     al, es:[si]
</span><span style="color:black">SYSINIT:2DF1                 </span><span style="color:navy">dec     ds:</span>count
<span style="color:black">SYSINIT:2DF5                 </span><span style="color:navy">inc     ds:</span>chrptr
<span style="color:black">SYSINIT:2DF9                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:2DFA
SYSINIT:2DFA </span><span style="color:gray">get_ret</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2DFA                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:2DFB                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2DFC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2DFC
SYSINIT:2DFC </span><span style="color:gray">nochar</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2DFC                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:2DFD                 </span><span style="color:navy">jmp     short </span><span style="color:gray">get_ret
</span><span style="color:black">SYSINIT:2DFD </span>getchr          endp
<span style="color:black">SYSINIT:2DFD
</span><span style="color:maroon">SYSINIT:2DFF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:2DFF
SYSINIT:2DFF </span>incorrect_order<span style="color:navy">:                        </span>; &#039;incorrect_order&#039; is not used in
<span style="color:maroon">SYSINIT:2DFF                 </span><span style="color:navy">mov     dx, (offset </span>_$InterMsg<span style="color:navy">+</span><span style="color:green">11h</span><span style="color:navy">) </span>; MSDOS 6.21 IO.SYS and PCDOS 7.1 IBMBIO.COM
<span style="color:maroon">SYSINIT:2DFF                                         </span>; (but it was/is not removed)
<span style="color:maroon">SYSINIT:2DFF                                         </span>; Erdogan Tan - 11/07/2023
<span style="color:maroon">SYSINIT:2E02                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:2E05                 </span><span style="color:navy">call    </span>showlinenum
<span style="color:maroon">SYSINIT:2E08                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2E09
SYSINIT:2E09 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2E09
SYSINIT:2E09
SYSINIT:2E09 </span>error_line      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E09                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2E0A                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2E0B                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:2E0B                 </span><span style="color:navy">mov     dx, (offset </span>_$InterMsg<span style="color:navy">+</span><span style="color:green">37h</span><span style="color:navy">)
</span><span style="color:black">SYSINIT:2E0E                 </span><span style="color:navy">call    sub_9072
</span><span style="color:black">SYSINIT:2E11                 </span><span style="color:navy">call    </span>showlinenum
<span style="color:black">SYSINIT:2E14                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2E14 </span>error_line      endp
<span style="color:black">SYSINIT:2E14
SYSINIT:2E15
SYSINIT:2E15 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2E15
SYSINIT:2E15
SYSINIT:2E15 </span>showlinenum     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E15                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:2E16                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2E17                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:2E18                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2E19                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2E1A                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:2E1A                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2E1B                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2E1C                 </span><span style="color:navy">mov     di, (offset </span>showcount<span style="color:navy">+</span><span style="color:green">4</span><span style="color:navy">) </span>;
<span style="color:black">SYSINIT:2E1C                                         </span>; di -&gt; the least significant decimal field.
<span style="color:black">SYSINIT:2E1F                 </span><span style="color:navy">mov     cx, </span><span style="color:green">10
</span><span style="color:black">SYSINIT:2E22                 </span><span style="color:navy">mov     ax, cs:</span>linecount
<span style="color:black">SYSINIT:2E26
SYSINIT:2E26 </span><span style="color:gray">sln_loop</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E26                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">10          </span>; &lt; 10 ?
<span style="color:black">SYSINIT:2E29                 </span><span style="color:navy">jb      short </span><span style="color:gray">sln_last  </span>; yes
<span style="color:black">SYSINIT:2E2B                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">SYSINIT:2E2D                 </span><span style="color:navy">div     cx              </span>; cx = 10
<span style="color:black">SYSINIT:2E2F                 </span><span style="color:navy">or      dl, </span><span style="color:green">30h         </span>; convert to ascii numeric char (&quot;0&quot; to &quot;9&quot;)
<span style="color:black">SYSINIT:2E32                 </span><span style="color:navy">mov     [di], dl
</span><span style="color:black">SYSINIT:2E34                 </span><span style="color:navy">dec     di
</span><span style="color:black">SYSINIT:2E35                 </span><span style="color:navy">jmp     short </span><span style="color:gray">sln_loop
</span><span style="color:black">SYSINIT:2E37 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2E37
SYSINIT:2E37 </span><span style="color:gray">sln_last</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E37                 </span><span style="color:navy">or      al, </span><span style="color:green">30h         </span>; convert to ascii numeric char (&quot;0&quot; to &quot;9&quot;)
<span style="color:black">SYSINIT:2E39                 </span><span style="color:navy">mov     [di], al
</span><span style="color:black">SYSINIT:2E3B                 </span><span style="color:navy">mov     dx, di
</span><span style="color:black">SYSINIT:2E3D                 </span><span style="color:navy">call    sub_9072        </span>; show it
<span style="color:black">SYSINIT:2E40                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:2E41                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2E42                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2E42                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2E43                 </span>assume es:nothing
<span style="color:black">SYSINIT:2E43                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2E43 </span>showlinenum     endp
<span style="color:black">SYSINIT:2E43
SYSINIT:2E44
SYSINIT:2E44 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2E44
SYSINIT:2E44
SYSINIT:2E44 </span>ProcDOS         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E44                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">SYSINIT:2E46                 </span><span style="color:navy">mov     al, cs:</span>result_val_itag ;
<span style="color:black">SYSINIT:2E46                                         </span>; [cs:result_val+_$P_Result_Blk.Item_Tag]
<span style="color:black">SYSINIT:2E46                                         </span>;
<span style="color:black">SYSINIT:2E46                                         </span>; result_val._$P_item_tag
<span style="color:black">SYSINIT:2E46                                         </span>;          = 1 for DOS=HIGH
<span style="color:black">SYSINIT:2E46                                         </span>;          = 2 for DOS=LOW
<span style="color:black">SYSINIT:2E46                                         </span>;          = 3 for DOS=UMB
<span style="color:black">SYSINIT:2E46                                         </span>;          = 4 for DOS=NOUMB
<span style="color:black">SYSINIT:2E4A                 </span><span style="color:navy">dec     ax
</span><span style="color:black">SYSINIT:2E4B                 </span><span style="color:navy">jz      short </span><span style="color:gray">pd_hi
</span><span style="color:black">SYSINIT:2E4D                 </span><span style="color:navy">dec     ax
</span><span style="color:black">SYSINIT:2E4E                 </span><span style="color:navy">jz      short </span><span style="color:gray">pd_lo
</span><span style="color:black">SYSINIT:2E50                 </span><span style="color:navy">dec     ax
</span><span style="color:black">SYSINIT:2E51                 </span><span style="color:navy">jz      short </span><span style="color:gray">pd_umb
</span><span style="color:black">SYSINIT:2E53                 </span><span style="color:navy">mov     cs:</span>DevUMB<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2E59                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2E5A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2E5A
SYSINIT:2E5A </span><span style="color:gray">pd_umb</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E5A                 </span><span style="color:navy">mov     cs:</span>DevUMB<span style="color:navy">, </span><span style="color:#ff8000">0FFh
</span><span style="color:black">SYSINIT:2E60                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2E61 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2E61
SYSINIT:2E61 </span><span style="color:gray">pd_lo</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E61                 </span><span style="color:navy">mov     cs:</span>runhigh<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2E67                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2E68 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2E68
SYSINIT:2E68 </span><span style="color:gray">pd_hi</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E68                 </span><span style="color:navy">mov     cs:</span>runhigh<span style="color:navy">, </span><span style="color:#ff8000">0FFh
</span><span style="color:black">SYSINIT:2E6E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2E6E </span>ProcDOS         endp
<span style="color:black">SYSINIT:2E6E
SYSINIT:2E6F
SYSINIT:2E6F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2E6F
SYSINIT:2E6F
SYSINIT:2E6F </span>LieInt12Mem     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E6F                 </span><span style="color:navy">mov     ax, cs:</span>ALLOCLIM ; lie INT 12h as alloclim
<span style="color:black">SYSINIT:2E6F                                         </span>; assuming that it is 3Com
<span style="color:black">SYSINIT:2E73                 </span><span style="color:navy">call    </span>IsIt3Com        ; Is it 3Com driver?
<span style="color:black">SYSINIT:2E76                 </span><span style="color:navy">jz      short </span><span style="color:gray">lim_set   </span>; yes, lie to him differently
<span style="color:black">SYSINIT:2E78                 </span><span style="color:navy">cmp     cs:</span>DeviceHi<span style="color:navy">, </span><span style="color:#ff8000">0  </span>; Is the DD being loaded in UMB
<span style="color:black">SYSINIT:2E7E                 </span><span style="color:navy">jz      short </span><span style="color:gray">limx      </span>; no, don&#039;t lie
<span style="color:black">SYSINIT:2E80                 </span><span style="color:navy">mov     ax, cs:</span>DevLoadEnd ; lie INT 12h as end of UMB
<span style="color:black">SYSINIT:2E84
SYSINIT:2E84 </span><span style="color:gray">lim_set</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E84                 </span><span style="color:navy">call    </span>SetInt12Mem
<span style="color:black">SYSINIT:2E87
SYSINIT:2E87 </span><span style="color:gray">limx</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E87                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2E87 </span>LieInt12Mem     endp
<span style="color:black">SYSINIT:2E87
SYSINIT:2E88
SYSINIT:2E88 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2E88
SYSINIT:2E88
SYSINIT:2E88 </span>SetInt12Mem     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2E88                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2E89                 </span><span style="color:navy">mov     bx, </span><span style="color:green">40h         </span>; ROMBIOS data area segment
<span style="color:black">SYSINIT:2E8C                 </span><span style="color:navy">mov     ds, bx
</span><span style="color:black">SYSINIT:2E8E                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2E8E                 </span><span style="color:navy">mov     bx, ds:</span><span style="color:green">13h      </span>; memory size (KB)
<span style="color:black">SYSINIT:2E92                 </span><span style="color:navy">mov     cs:</span>OldInt12Mem<span style="color:navy">, bx
</span><span style="color:black">SYSINIT:2E97                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">6           </span>; 16*64 = 1024
<span style="color:black">SYSINIT:2E99                 </span><span style="color:navy">shr     ax, cl          </span>; convert paragraphs to kilobyte
<span style="color:black">SYSINIT:2E9B                 </span><span style="color:navy">mov     ds:</span><span style="color:green">13h</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:2E9E                 </span><span style="color:navy">mov     cs:</span>Int12Lied<span style="color:navy">, </span><span style="color:#ff8000">0FFh </span>; mark that we are lying
<span style="color:black">SYSINIT:2EA4                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2EA5                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2EA5                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2EA5 </span>SetInt12Mem     endp
<span style="color:black">SYSINIT:2EA5
SYSINIT:2EA6
SYSINIT:2EA6 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2EA6
SYSINIT:2EA6
SYSINIT:2EA6 </span>TrueInt12Mem    proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2EA6                 </span><span style="color:navy">cmp     cs:</span>Int12Lied<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; were we lying so far?
<span style="color:black">SYSINIT:2EAC                 </span><span style="color:navy">mov     cs:</span>Int12Lied<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:2EB2                 </span><span style="color:navy">jz      short </span><span style="color:gray">timx      </span>; yes
<span style="color:black">SYSINIT:2EB2                                         </span>; no, we weren&#039;t
<span style="color:black">SYSINIT:2EB4                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2EB5                 </span><span style="color:navy">mov     ax, </span><span style="color:green">40h
</span><span style="color:black">SYSINIT:2EB8                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:2EBA                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2EBA                 </span><span style="color:navy">mov     ax, cs:</span>OldInt12Mem
<span style="color:black">SYSINIT:2EBE                 </span><span style="color:navy">mov     ds:</span><span style="color:green">13h</span><span style="color:navy">, ax      </span>; restore INT 12h memory
<span style="color:black">SYSINIT:2EC1                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2EC2                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2EC2
SYSINIT:2EC2 </span><span style="color:gray">timx</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2EC2                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2EC2 </span>TrueInt12Mem    endp
<span style="color:black">SYSINIT:2EC2
SYSINIT:2EC3
SYSINIT:2EC3 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2EC3
SYSINIT:2EC3
SYSINIT:2EC3 </span>IsIt3Com        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2EC3                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2EC4                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:2EC5                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:2EC6                 </span><span style="color:navy">lds     si, cs:</span>DevEntry ; ptr to device header
<span style="color:black">SYSINIT:2ECB                 </span><span style="color:navy">add     si, </span><span style="color:green">10          </span>; SYSDEV.NAME ; ptr device name
<span style="color:black">SYSINIT:2ECE                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2ECF                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2ED0                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:2ED0                 </span><span style="color:navy">mov     di, offset </span>ThreeComName <span style="color:gray">; &quot;PROTMAN$&quot;
</span><span style="color:black">SYSINIT:2ED3                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">8           </span>; name length
<span style="color:black">SYSINIT:2ED6                 </span><span style="color:navy">repe cmpsb
</span><span style="color:black">SYSINIT:2ED8                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:2ED9                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2EDA                 </span>assume es:nothing
<span style="color:black">SYSINIT:2EDA                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2EDB                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2EDB </span>IsIt3Com        endp
<span style="color:black">SYSINIT:2EDB
SYSINIT:2EDC
SYSINIT:2EDC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2EDC
SYSINIT:2EDC
SYSINIT:2EDC </span>UpdatePDB       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2EDC                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2EDD                 </span><span style="color:navy">mov     ah, </span><span style="color:green">62h
</span><span style="color:black">SYSINIT:2EDF                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET PSP ADDRESS
<span style="color:black">SYSINIT:2EE1                 </span><span style="color:navy">mov     ds, bx
</span><span style="color:black">SYSINIT:2EE3                 </span><span style="color:navy">mov     bx, cs:</span>ALLOCLIM
<span style="color:black">SYSINIT:2EE8                 </span><span style="color:navy">mov     ds:</span><span style="color:green">2</span><span style="color:navy">, bx        </span>; [PDB.BLOCK_LEN]
<span style="color:black">SYSINIT:2EEC                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2EED                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2EED </span>UpdatePDB       endp
<span style="color:black">SYSINIT:2EED
SYSINIT:2EEE
SYSINIT:2EEE </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2EEE
SYSINIT:2EEE
SYSINIT:2EEE </span>InitVar         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2EEE                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:2EEF                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:2EF0                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:2EF1                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:2EF2                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2EF3                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2EF4                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:2EF4                 </span><span style="color:navy">xor     ax, ax          </span>; 0
<span style="color:black">SYSINIT:2EF6                 </span><span style="color:navy">mov     es:</span>fUmbTiny<span style="color:navy">, al </span>; Shrink UMBs? (made 1 if /S given)
<span style="color:black">SYSINIT:2EFA                 </span><span style="color:navy">mov     es:</span>fInHigh<span style="color:navy">, al  </span>; Set to 1 when DH/LH has been called
<span style="color:black">SYSINIT:2EFE                 </span><span style="color:navy">mov     es:</span>SegLoad<span style="color:navy">, ax  </span>; Load Address (seg), used for DH only
<span style="color:black">SYSINIT:2F02                 </span><span style="color:navy">mov     es:</span>UmbLoad<span style="color:navy">, </span><span style="color:#ff8000">0FFh </span>; UNSPECIFIED
<span style="color:black">SYSINIT:2F02                                         </span>; Later is the # of the 1st spec&#039;d UMB
<span style="color:black">SYSINIT:2F08                 </span><span style="color:navy">mov     es:</span>fm_argc<span style="color:navy">, al  </span>; Start with zero args having been read
<span style="color:black">SYSINIT:2F0C                 </span><span style="color:navy">cld
</span><span style="color:black">SYSINIT:2F0D                 </span><span style="color:navy">mov     cx, </span><span style="color:green">16          </span>; MAXUMB
<span style="color:black">SYSINIT:2F10                 </span><span style="color:navy">mov     di, offset </span>UmbUsed ;
<span style="color:black">SYSINIT:2F10                                         </span>; For each entry on the UmbUsed array,
<span style="color:black">SYSINIT:2F13                 </span><span style="color:navy">rep stosb               </span>; Store 0
<span style="color:black">SYSINIT:2F15                 </span><span style="color:navy">mov     cx, </span><span style="color:green">16          </span>; MAXUMB
<span style="color:black">SYSINIT:2F18                 </span><span style="color:navy">mov     di, offset </span>UmbSize ; Okay...
<span style="color:black">SYSINIT:2F18                                         </span>; for each entry on the UmbSize array,
<span style="color:black">SYSINIT:2F1B                 </span><span style="color:navy">rep stosw               </span>; Store 0
<span style="color:black">SYSINIT:2F1D                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2F1E                 </span>assume es:nothing
<span style="color:black">SYSINIT:2F1E                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:2F1F                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:2F20                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:2F21                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2F21 </span>InitVar         endp
<span style="color:black">SYSINIT:2F21
SYSINIT:2F22
SYSINIT:2F22 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2F22
SYSINIT:2F22
SYSINIT:2F22 </span>FixMem          proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2F22                 </span><span style="color:navy">push    ax              </span>; scans the upper memory chain
<span style="color:black">SYSINIT:2F22                                         </span>; and concatenates adjacent free MCBs
<span style="color:black">SYSINIT:2F23                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:2F24                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:2F25                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:2F26                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:2F27                 </span><span style="color:navy">call    </span>fm_link         ; Link in UMBs
<span style="color:black">SYSINIT:2F2A                 </span><span style="color:navy">call    </span>UmbHead         ; Get first upper-memory MCB address (0x9FFF)
<span style="color:black">SYSINIT:2F2D                 </span><span style="color:navy">jb      short </span><span style="color:gray">fmX       </span>; (if couldn&#039;t get it, leave now).
<span style="color:black">SYSINIT:2F2F                 </span><span style="color:navy">mov     es, ax          </span>; It returns in AX, so move it to ES.
<span style="color:black">SYSINIT:2F31                 </span><span style="color:navy">xor     dx, dx          </span>; We&#039;re keeping the address of the last MCB
<span style="color:black">SYSINIT:2F33                 </span><span style="color:navy">mov     cx, dx          </span>; in CX... and the last owner
<span style="color:black">SYSINIT:2F35                 </span><span style="color:navy">inc     dx              </span>; in dx as we go through the loop
<span style="color:black">SYSINIT:2F36
SYSINIT:2F36 </span><span style="color:gray">fm10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2F36                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">0        </span>; [es:ARENA.SIGNATURE]
<span style="color:black">SYSINIT:2F36                                         </span>; if &#039;Z&#039;, don&#039;t repeat loop
<span style="color:black">SYSINIT:2F3A                 </span><span style="color:navy">mov     bx, es:</span><span style="color:green">1        </span>; [es:ARENA.OWNER] ; if not zero, do nothing
<span style="color:black">SYSINIT:2F3F                 </span><span style="color:navy">or      bx, dx          </span>; dx was owner of previous MCB
<span style="color:black">SYSINIT:2F41                 </span><span style="color:navy">jnz     short </span><span style="color:gray">fm30      </span>; If not both zero, don&#039;t cat.
<span style="color:black">SYSINIT:2F43
SYSINIT:2F43 </span>fm20<span style="color:navy">:                                   </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:2F43                 </span><span style="color:navy">mov     bx, es:</span><span style="color:green">3        </span>; Grab this block&#039;s Size,
<span style="color:black">SYSINIT:2F48                 </span><span style="color:navy">mov     es, cx          </span>; Go back to prev MCB&#039;s address
<span style="color:black">SYSINIT:2F4A                 </span>assume es:nothing
<span style="color:black">SYSINIT:2F4A                 </span><span style="color:navy">mov     byte ptr es:</span>BData_start<span style="color:navy">, al </span>; [es:ARENA.SIGNATURE]
<span style="color:black">SYSINIT:2F4A                                         </span>; &amp; move the SECOND sig here
<span style="color:black">SYSINIT:2F4E                 </span><span style="color:navy">add     bx, es:</span>DosDataSg ; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:2F4E                                         </span>; Size += first MCB&#039;s size
<span style="color:black">SYSINIT:2F53                 </span><span style="color:navy">add     bx, </span><span style="color:#ff8000">1           </span>; And add one for the header
<span style="color:black">SYSINIT:2F56                 </span><span style="color:navy">mov     es:</span>DosDataSg<span style="color:navy">, bx </span>; [es:ARENA.SIZE] ; Write the size
<span style="color:black">SYSINIT:2F5B
SYSINIT:2F5B </span><span style="color:gray">fm30</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2F5B                 </span><span style="color:navy">mov     cx, es          </span>; Save MCB address
<span style="color:black">SYSINIT:2F5D                 </span><span style="color:navy">mov     dx, word ptr es:</span>BData_start<span style="color:navy">+</span><span style="color:green">1 </span>; [es:ARENA.OWNER] ; And remember its owner
<span style="color:black">SYSINIT:2F62                 </span><span style="color:navy">mov     bx, es          </span>; Move to the next MCB
<span style="color:black">SYSINIT:2F64                 </span><span style="color:navy">add     bx, es:</span>DosDataSg ; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:2F69                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:2F6A                 </span><span style="color:navy">mov     es, bx
</span><span style="color:black">SYSINIT:2F6C                 </span>assume es:nothing
<span style="color:black">SYSINIT:2F6C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;   </span>; arena_signature_end
<span style="color:black">SYSINIT:2F6E                 </span><span style="color:navy">jnz     short </span><span style="color:gray">fm10      </span>; If signature != &#039;Z&#039;, there are more.
<span style="color:black">SYSINIT:2F70
SYSINIT:2F70 </span><span style="color:gray">fmX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2F70                 </span><span style="color:navy">call    </span>fm_unlink       ; Unlink UMBs
<span style="color:black">SYSINIT:2F73                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2F74                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:2F75                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:2F76                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:2F77                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:2F78                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2F78 </span>FixMem          endp
<span style="color:black">SYSINIT:2F78
SYSINIT:2F79
SYSINIT:2F79 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2F79
SYSINIT:2F79
SYSINIT:2F79 </span>fm_link         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2F79                 </span><span style="color:navy">mov     ax, </span><span style="color:green">5802h       </span>; DOS_CHECK_UMBLINK
<span style="color:black">SYSINIT:2F7C                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:2F7C                                         </span>; AL = function code: (DOS 5beta) get UMB link state
<span style="color:black">SYSINIT:2F7E                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:2F7F                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2F80                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2F81                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:2F81                 </span><span style="color:navy">mov     es:</span>fm_umb<span style="color:navy">, al   </span>; store current link-state (to use/set later)
<span style="color:black">SYSINIT:2F85                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2F86                 </span>assume es:nothing
<span style="color:black">SYSINIT:2F86                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">5803h
</span><span style="color:black">SYSINIT:2F89                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:2F8C                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:2F8C                                         </span>; AL = function code: (DOS 5beta) set UMB link state
<span style="color:black">SYSINIT:2F8E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2F8E </span>fm_link         endp
<span style="color:black">SYSINIT:2F8E
SYSINIT:2F8F
SYSINIT:2F8F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2F8F
SYSINIT:2F8F
SYSINIT:2F8F </span>fm_unlink       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2F8F                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:black">SYSINIT:2F91                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2F92                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2F93                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2F94                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:2F94                 </span><span style="color:navy">mov     bl, </span>fm_umb      ; old link-state (to set again)
<span style="color:black">SYSINIT:2F98                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2F99                 </span>assume ds:nothing
<span style="color:black">SYSINIT:2F99                 </span><span style="color:navy">mov     ax, </span><span style="color:green">5803h       </span>; DOS_SET_UMBLINK
<span style="color:black">SYSINIT:2F9C                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:2F9C                                         </span>; AL = function code: (DOS 5beta) set UMB link state
<span style="color:black">SYSINIT:2F9E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2F9E </span>fm_unlink       endp
<span style="color:black">SYSINIT:2F9E
SYSINIT:2F9F
SYSINIT:2F9F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2F9F
SYSINIT:2F9F
SYSINIT:2F9F </span>ParseVar        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2F9F                 </span><span style="color:navy">push    di              </span>; parses [/S][/L:umb[,size][;umb[,size]]*]
<span style="color:black">SYSINIT:2F9F                                         </span>;   and builds the table laid out in highvar.inc
<span style="color:black">SYSINIT:2F9F                                         </span>; ENTRY:
<span style="color:black">SYSINIT:2F9F                                         </span>;   ES:SI points to command tail of LoadHigh/DeviceHigh
<span style="color:black">SYSINIT:2F9F                                         </span>;       (whitespace ok)
<span style="color:black">SYSINIT:2F9F                                         </span>; EXIT:
<span style="color:black">SYSINIT:2F9F                                         </span>;   ES:SI points to first character in child program name
<span style="color:black">SYSINIT:2FA0                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:2FA1                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:2FA2                 </span><span style="color:navy">push    es              </span>; Make DS:SI point to it, as well as ES:SI
<span style="color:black">SYSINIT:2FA3                 </span><span style="color:navy">pop     ds              </span>; (regardless if we&#039;re in devhigh or loadhigh)
<span style="color:black">SYSINIT:2FA4                 </span><span style="color:navy">cld
</span><span style="color:black">SYSINIT:2FA5
SYSINIT:2FA5 </span><span style="color:gray">pv10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2FA5                 </span><span style="color:navy">lodsb                   </span>; here, ES:SI==&quot;  /L...&quot;--must eat whitespace
<span style="color:black">SYSINIT:2FA6                 </span><span style="color:navy">call    </span>isWhite
<span style="color:black">SYSINIT:2FA9                 </span><span style="color:navy">jz      short </span><span style="color:gray">pv10      </span>; ES:SI==&quot; /L...&quot;--keep eating.
<span style="color:black">SYSINIT:2FAB                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;   </span>; SWTCH ; ES:SI==&quot;/L...&quot;--go process a switch
<span style="color:black">SYSINIT:2FAD                 </span><span style="color:navy">jz      short </span><span style="color:gray">pv20
</span><span style="color:black">SYSINIT:2FAF                 </span><span style="color:navy">dec     si              </span>; Backup--it&#039;s now &quot;odule options&quot;, and we need
<span style="color:black">SYSINIT:2FB0                 </span><span style="color:navy">clc                     </span>; that &quot;m&quot; we just read (or whatever it is).
<span style="color:black">SYSINIT:2FB1                 </span><span style="color:navy">jmp     short </span><span style="color:gray">pvX       </span>; Then return with carry clear == we&#039;re done.
<span style="color:black">SYSINIT:2FB3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2FB3
SYSINIT:2FB3 </span><span style="color:gray">pv20</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2FB3                 </span><span style="color:navy">lodsb                   </span>; Just read &#039;S&#039; or &#039;L&#039;, hopefully
<span style="color:black">SYSINIT:2FB4                 </span><span style="color:navy">and     al, </span><span style="color:green">0DFh        </span>; So we make it upper-case, and...
<span style="color:black">SYSINIT:2FB6                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">53h </span><span style="color:gray">; &#039;S&#039;   </span>; just read &#039;S&#039;?
<span style="color:black">SYSINIT:2FB8                 </span><span style="color:navy">jnz     short </span><span style="color:gray">pv30
</span><span style="color:black">SYSINIT:2FBA                 </span><span style="color:navy">call    </span>incArgc         ; If it&#039;s /S, it&#039;s another arg for LH to skip.
<span style="color:black">SYSINIT:2FBA                                         </span>;
<span style="color:black">SYSINIT:2FBA                                         </span>; Note: &#039;inc byte [cs:fm_argc]&#039; would be enough here
<span style="color:black">SYSINIT:2FBA                                         </span>; Erdogan Tan - 19/04/2019 (Retro DOS v4) - 11/07/2023
<span style="color:black">SYSINIT:2FBD                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:2FBE                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:2FBF                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2FC0                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:2FC0                 </span><span style="color:navy">mov     es:</span>fUmbTiny<span style="color:navy">, </span><span style="color:#ff8000">1  </span>; /S, so ES:SI==&quot;  /L...&quot; or &quot; module opts&quot;, or
<span style="color:black">SYSINIT:2FC6                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2FC7                 </span>assume es:nothing
<span style="color:black">SYSINIT:2FC7                 </span><span style="color:navy">jmp     short </span><span style="color:gray">pv10      </span>; possibly even &quot;/L...&quot;.
<span style="color:black">SYSINIT:2FC9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2FC9
SYSINIT:2FC9 </span><span style="color:gray">pv30</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2FC9                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">4Ch </span><span style="color:gray">; &#039;L&#039;   </span>; If it&#039;s not &#039;L&#039; either, then it&#039;s a bad switch!
<span style="color:black">SYSINIT:2FCB                 </span><span style="color:navy">jnz     short </span><span style="color:gray">pvE1
</span><span style="color:black">SYSINIT:2FCD                 </span><span style="color:navy">call    </span>incArgc
<span style="color:black">SYSINIT:2FD0                 </span><span style="color:navy">call    </span>parseL          ; If no carry, go back and look for more
<span style="color:black">SYSINIT:2FD3                 </span><span style="color:navy">jnb     short </span><span style="color:gray">pv10
</span><span style="color:black">SYSINIT:2FD5                 </span><span style="color:navy">dec     si              </span>; Else, back up and exit.
<span style="color:black">SYSINIT:2FD6                 </span><span style="color:navy">jmp     short </span><span style="color:gray">pvErr     </span>; AX has already been set by parseL
<span style="color:black">SYSINIT:2FD8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:2FD8
SYSINIT:2FD8 </span><span style="color:gray">pvE1</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2FD8                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">3           </span>; PV_InvSwt ; Unrecognized switch passed
<span style="color:black">SYSINIT:2FDB
SYSINIT:2FDB </span><span style="color:gray">pvErr</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2FDB                 </span><span style="color:navy">dec     si
</span><span style="color:black">SYSINIT:2FDC                 </span><span style="color:navy">dec     si
</span><span style="color:black">SYSINIT:2FDD                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:2FDE
SYSINIT:2FDE </span><span style="color:gray">pvX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2FDE                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:2FDF                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:2FE0                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:2FE1                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:2FE1 </span>ParseVar        endp
<span style="color:black">SYSINIT:2FE1
SYSINIT:2FE2
SYSINIT:2FE2 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:2FE2
SYSINIT:2FE2
SYSINIT:2FE2 </span>parseL          proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:2FE2                 </span><span style="color:navy">lodsb
</span><span style="color:black">SYSINIT:2FE3                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Ah </span><span style="color:gray">; &#039;:&#039;   </span>; Make sure they did /L:
<span style="color:black">SYSINIT:2FE5                 </span><span style="color:navy">jnz     short </span><span style="color:gray">plE1      </span>; If they didn&#039;t, return with carry set.
<span style="color:black">SYSINIT:2FE7
SYSINIT:2FE7 </span><span style="color:gray">pl10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:2FE7                 </span><span style="color:navy">call    </span>GetXNum         ; After this, it&#039;s &quot;,size&quot; or &quot;;umb&quot; or &quot; mod&quot;
<span style="color:black">SYSINIT:2FEA                 </span><span style="color:navy">jb      short </span><span style="color:gray">plE2      </span>; And error if it&#039;s a bad number.
<span style="color:black">SYSINIT:2FEC                 </span><span style="color:navy">call    </span>convUMB         ; Convert any address to a UMB number
<span style="color:black">SYSINIT:2FEF                 </span><span style="color:navy">mov     cl, al          </span>; Remember the UMB number
<span style="color:black">SYSINIT:2FF1                 </span><span style="color:navy">call    </span>stowUMB         ; Mark this UMB # as used;
<span style="color:black">SYSINIT:2FF4                 </span><span style="color:navy">jb      short </span><span style="color:gray">plE2      </span>; If it was already marked, it&#039;ll error
<span style="color:black">SYSINIT:2FF6                 </span><span style="color:navy">call    </span>incArgc         ; Each UMB number is another arg for LH to skip
<span style="color:black">SYSINIT:2FF6                                         </span>; (&#039;inc byte [cs:fm_argc]&#039; would be enough)
<span style="color:black">SYSINIT:2FF6                                         </span>; Erdogan Tan - 08/04/2019 (Retro DOS v4) - 11/07/2023
<span style="color:black">SYSINIT:2FF9                 </span><span style="color:navy">lodsb
</span><span style="color:black">SYSINIT:2FFA                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Bh </span><span style="color:gray">; &#039;;&#039;   </span>; Did &quot;umb;&quot; ?
<span style="color:black">SYSINIT:2FFC                 </span><span style="color:navy">jz      short </span><span style="color:gray">pl10      </span>; Yep: go back and get another UMB.
<span style="color:black">SYSINIT:2FFE                 </span><span style="color:navy">call    </span>isWhite         ; Did &quot;umb &quot; ?
<span style="color:black">SYSINIT:3001                 </span><span style="color:navy">jz      short </span><span style="color:gray">plX       </span>; Yep: return (it&#039;ll go back to whitespace)
<span style="color:black">SYSINIT:3003                 </span><span style="color:navy">call    </span>isEOL           ; Did &quot;umb&quot; ?
<span style="color:black">SYSINIT:3006                 </span><span style="color:navy">jz      short </span><span style="color:gray">plSwX     </span>; If so, backup and exit like everything&#039;s ok
<span style="color:black">SYSINIT:3008                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;   </span>; Did &quot;umb/&quot; ? (as in, &quot;/L:1,100;2/S&quot;)
<span style="color:black">SYSINIT:300A                 </span><span style="color:navy">jz      short </span><span style="color:gray">plSwX     </span>; If so, back up ES:SI one character and return
<span style="color:black">SYSINIT:300C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Ch </span><span style="color:gray">; &#039;,&#039;   </span>; Did &quot;umb,&quot; ?
<span style="color:black">SYSINIT:300E                 </span><span style="color:navy">jnz     short </span><span style="color:gray">plE1      </span>; Just what the heck DID they do? Return error.
<span style="color:black">SYSINIT:3010                 </span><span style="color:navy">call    </span>GetXNum         ; Stop on &quot;size;&quot; or &quot;size &quot; or anything else
<span style="color:black">SYSINIT:3013                 </span><span style="color:navy">jb      short </span><span style="color:gray">plE1      </span>; And error if it&#039;s a bad size.
<span style="color:black">SYSINIT:3015                 </span><span style="color:navy">call    </span>toPara          ; Convert from bytes to paragraphs
<span style="color:black">SYSINIT:3018                 </span><span style="color:navy">call    </span>stowSiz         ; CL still has the UMB number for this routine
<span style="color:black">SYSINIT:301B                 </span><span style="color:navy">call    </span>incArgc         ; Each UMB size is another arg for LH to skip
<span style="color:black">SYSINIT:301B                                         </span>; (&#039;inc byte [cs:fm_argc]&#039;)
<span style="color:black">SYSINIT:301E                 </span><span style="color:navy">lodsb
</span><span style="color:black">SYSINIT:301F                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Bh </span><span style="color:gray">; &#039;;&#039;   </span>; They did &quot;umb,size;&quot;, so get another UMB.
<span style="color:black">SYSINIT:3021                 </span><span style="color:navy">jz      short </span><span style="color:gray">pl10
</span><span style="color:black">SYSINIT:3023                 </span><span style="color:navy">call    </span>isWhite         ; Did it end with whitespace?
<span style="color:black">SYSINIT:3026                 </span><span style="color:navy">jz      short </span><span style="color:gray">plX       </span>; If so, we&#039;re done here--go back.
<span style="color:black">SYSINIT:3028                 </span><span style="color:navy">call    </span>isEOL           ; Did they do &quot;umb,size&quot; and end??? (stupid)
<span style="color:black">SYSINIT:302B                 </span><span style="color:navy">jz      short </span><span style="color:gray">plSwX     </span>; If so, backup and exit like everything&#039;s ok
<span style="color:black">SYSINIT:302D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;   </span>; SWTCH ; Did they do &quot;umb,size/&quot; ?
<span style="color:black">SYSINIT:302F                 </span><span style="color:navy">jz      short </span><span style="color:gray">plSwX     </span>; If so, again, we&#039;re done here.
<span style="color:black">SYSINIT:3031
SYSINIT:3031 </span><span style="color:gray">plE1</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3031                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">1           </span>; PV_InvArg ; If not, we don&#039;t know WHAT they did.
<span style="color:black">SYSINIT:3034                 </span><span style="color:navy">dec     si
</span><span style="color:black">SYSINIT:3035                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3036                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3037 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3037
SYSINIT:3037 </span><span style="color:gray">plE2</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3037                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">2           </span>; In this case, they&#039;ve specified a UMB twice
<span style="color:black">SYSINIT:303A                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:303B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:303C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:303C
SYSINIT:303C </span><span style="color:gray">plSwX</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:303C                 </span><span style="color:navy">dec     si              </span>; If we hit a &#039;/&#039; character, back up one char
<span style="color:black">SYSINIT:303C                                         </span>; so the whitespace checker will see it too.
<span style="color:black">SYSINIT:303D
SYSINIT:303D </span><span style="color:gray">plX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:303D                 </span><span style="color:navy">clc                     </span>; Then just return with carry clear, so
<span style="color:black">SYSINIT:303D                                         </span>; ParseVar will go about its business.
<span style="color:black">SYSINIT:303E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:303E </span>parseL          endp
<span style="color:black">SYSINIT:303E
SYSINIT:303F
SYSINIT:303F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:303F
SYSINIT:303F
SYSINIT:303F </span>incArgc         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:303F                 </span><span style="color:navy">push    ax              </span>; increments fm_argc,
<span style="color:black">SYSINIT:303F                                         </span>; for use with LoadHigh command-line parsing
<span style="color:black">SYSINIT:303F                                         </span>; ***
<span style="color:black">SYSINIT:303F                                         </span>; (&#039;inc byte [cs:fm_argc]&#039; would be enough)
<span style="color:black">SYSINIT:303F                                         </span>; Erdogan Tan - 11/07/2023
<span style="color:black">SYSINIT:3040                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:3041                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:3042                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3043                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:3043                 </span><span style="color:navy">mov     al, </span>fm_argc     ; Obtain previous value of fm_argc,
<span style="color:black">SYSINIT:3046                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3047                 </span>assume ds:nothing
<span style="color:black">SYSINIT:3047                 </span><span style="color:navy">inc     al              </span>; Increment it,
<span style="color:black">SYSINIT:3049                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:304A                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:304B                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:304C                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:304C                 </span><span style="color:navy">mov     es:</span>fm_argc<span style="color:navy">, al  </span>; And store it right back.
<span style="color:black">SYSINIT:3050                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3051                 </span>assume es:nothing
<span style="color:black">SYSINIT:3051                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:3052                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3052 </span>incArgc         endp
<span style="color:black">SYSINIT:3052
SYSINIT:3053
SYSINIT:3053 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3053
SYSINIT:3053
SYSINIT:3053 </span>isEOL           proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3053                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0           </span>; Null-terminator
<span style="color:black">SYSINIT:3055                 </span><span style="color:navy">jz      short </span><span style="color:gray">ieX
</span><span style="color:black">SYSINIT:3057                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh         </span>; CR ; Carriage Return
<span style="color:black">SYSINIT:3059                 </span><span style="color:navy">jz      short </span><span style="color:gray">ieX
</span><span style="color:black">SYSINIT:305B                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah         </span>; LF ; LineFeed
<span style="color:black">SYSINIT:305D
SYSINIT:305D </span><span style="color:gray">ieX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:305D                 </span><span style="color:navy">retn                    </span>; zf=1 if AL contains EOL character
<span style="color:black">SYSINIT:305D </span>isEOL           endp
<span style="color:black">SYSINIT:305D
SYSINIT:305E
SYSINIT:305E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:305E
SYSINIT:305E
SYSINIT:305E </span>isWhite         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:305E                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;   </span>; Space
<span style="color:black">SYSINIT:3060                 </span><span style="color:navy">jz      short </span><span style="color:gray">iwX
</span><span style="color:black">SYSINIT:3062                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Dh </span><span style="color:gray">; &#039;=&#039;   </span>; Equals (treat as whitespace)
<span style="color:black">SYSINIT:3064                 </span><span style="color:navy">jz      short </span><span style="color:gray">iwX
</span><span style="color:black">SYSINIT:3066                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">9           </span>; Tab
<span style="color:black">SYSINIT:3068
SYSINIT:3068 </span><span style="color:gray">iwX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3068                 </span><span style="color:navy">retn                    </span>; zf=1 if AL contains space,
<span style="color:black">SYSINIT:3068 </span>isWhite         endp                    ;         tab or equals character
<span style="color:black">SYSINIT:3068
SYSINIT:3069
SYSINIT:3069 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3069
SYSINIT:3069
SYSINIT:3069 </span>unMarkUMB       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3069                 </span><span style="color:navy">push    ax              </span>; marks a given UMB as unused
<span style="color:black">SYSINIT:3069                                         </span>; AL contains UMB number
<span style="color:black">SYSINIT:306A                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:306B                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:306C                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:306D                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:306E                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:306F                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:306F                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">SYSINIT:3071                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:black">SYSINIT:3073                 </span><span style="color:navy">mov     es:</span>UmbUsed<span style="color:navy">[bx], </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:3079                 </span><span style="color:navy">cmp     es:</span>UmbLoad<span style="color:navy">, al
</span><span style="color:black">SYSINIT:307E                 </span><span style="color:navy">jnz     short </span><span style="color:gray">umu10     </span>; If unmarked the load UMB,
<span style="color:black">SYSINIT:307E                                         </span>; load into convent.
<span style="color:black">SYSINIT:3080                 </span><span style="color:navy">mov     es:</span>UmbLoad<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:3086
SYSINIT:3086 </span><span style="color:gray">umu10</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3086                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3087                 </span>assume es:nothing
<span style="color:black">SYSINIT:3087                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:3088                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:3089                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:308A                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:308A </span>unMarkUMB       endp
<span style="color:black">SYSINIT:308A
SYSINIT:308B
SYSINIT:308B </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:308B
SYSINIT:308B
SYSINIT:308B </span>stowUMB         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:308B                 </span><span style="color:navy">cmp     al, </span><span style="color:green">16          </span>; MAXUMB
<span style="color:black">SYSINIT:308D                 </span><span style="color:navy">jb      short </span><span style="color:gray">su10
</span><span style="color:black">SYSINIT:308F                 </span><span style="color:navy">stc                     </span>; Ooops-- UMB # &gt;= MAXUMB
<span style="color:black">SYSINIT:3090                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3091 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3091
SYSINIT:3091 </span><span style="color:gray">su10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3091                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:3092                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:3093                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:3094                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:3095                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3096                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:3097                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3098                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:3098                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:3099                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:309A                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:309A                 </span><span style="color:navy">cmp     </span>UmbLoad<span style="color:navy">, </span><span style="color:#ff8000">0FFh   </span>; UNSPECIFIED
<span style="color:black">SYSINIT:309A                                         </span>; If this, we haven&#039;t been here before
<span style="color:black">SYSINIT:309F                 </span><span style="color:navy">jnz     short </span><span style="color:gray">su20
</span><span style="color:black">SYSINIT:30A1                 </span><span style="color:navy">mov     </span>UmbLoad<span style="color:navy">, al     </span>; So remember this UMB as the load UMB slot.
<span style="color:black">SYSINIT:30A4
SYSINIT:30A4 </span><span style="color:gray">su20</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:30A4                 </span><span style="color:navy">or      al, al          </span>; If they gave UMB 0, there&#039;s really nothing
<span style="color:black">SYSINIT:30A6                 </span><span style="color:navy">jz      short </span><span style="color:gray">su30      </span>; that we should do here.
<span style="color:black">SYSINIT:30A8                 </span><span style="color:navy">mov     bl, al
</span><span style="color:black">SYSINIT:30AA                 </span><span style="color:navy">xor     bh, bh
</span><span style="color:black">SYSINIT:30AC                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">1           </span>; Now, AX = 1, and BX = UMB Number
<span style="color:black">SYSINIT:30AF                 </span><span style="color:navy">xchg    al, es:</span>UmbUsed<span style="color:navy">[bx]
</span><span style="color:black">SYSINIT:30B4                 </span><span style="color:navy">or      al, al          </span>; If it was already 1,
<span style="color:black">SYSINIT:30B4                                         </span>; then al==1... and that means an error.
<span style="color:black">SYSINIT:30B6                 </span><span style="color:navy">jz      short </span><span style="color:gray">su30
</span><span style="color:black">SYSINIT:30B8                 </span><span style="color:navy">stc                     </span>; OOOPS! This one&#039;s been used before. :(
<span style="color:black">SYSINIT:30B9
SYSINIT:30B9 </span><span style="color:gray">su30</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:30B9                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:30BA                 </span>assume es:nothing
<span style="color:black">SYSINIT:30BA                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:30BB                 </span>assume ds:nothing
<span style="color:black">SYSINIT:30BB                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:30BC                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:30BD                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:30BE                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:30BE </span>stowUMB         endp
<span style="color:black">SYSINIT:30BE
SYSINIT:30BF
SYSINIT:30BF </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:30BF
SYSINIT:30BF
SYSINIT:30BF </span>stowSiz         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:30BF                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:30C0                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:30C1                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:30C2                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:30C3                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:30C4                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:30C4                 </span><span style="color:navy">mov     bl, cl          </span>; Now bl==UMB number, AX==size
<span style="color:black">SYSINIT:30C6                 </span><span style="color:navy">mov     bh, </span><span style="color:#ff8000">0           </span>; bx==UMB number, AX==size
<span style="color:black">SYSINIT:30C8                 </span><span style="color:navy">shl     bl, </span><span style="color:green">1           </span>; bx==offset into array, AX=size
<span style="color:black">SYSINIT:30CA                 </span><span style="color:navy">mov     es:</span>UmbSize<span style="color:navy">[bx], ax </span>; Store the size
<span style="color:black">SYSINIT:30CF                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:30D0                 </span>assume es:nothing
<span style="color:black">SYSINIT:30D0                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:30D1                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:30D2                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:30D2 </span>stowSiz         endp
<span style="color:black">SYSINIT:30D2
SYSINIT:30D2 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:30D3 </span>gnradix         <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:30D3                                         </span>; Must be a word--16x16 multiplication
<span style="color:black">SYSINIT:30D5
SYSINIT:30D5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:30D5
SYSINIT:30D5
SYSINIT:30D5 </span>toDigit         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:30D5                 </span><span style="color:navy">cmp     cs:</span>gnradix<span style="color:navy">, </span><span style="color:#ff8000">10h
</span><span style="color:black">SYSINIT:30DB                 </span><span style="color:navy">jnz     short </span><span style="color:gray">td10      </span>; Don&#039;t check hex digits if radix isn&#039;t 16
<span style="color:black">SYSINIT:30DD                 </span><span style="color:navy">cmp     cl, </span><span style="color:#ff8000">61h </span><span style="color:gray">; &#039;a&#039;
</span><span style="color:black">SYSINIT:30E0                 </span><span style="color:navy">jb      short </span><span style="color:gray">td20
</span><span style="color:black">SYSINIT:30E2                 </span><span style="color:navy">cmp     cl, </span><span style="color:#ff8000">66h </span><span style="color:gray">; &#039;f&#039;
</span><span style="color:black">SYSINIT:30E5                 </span><span style="color:navy">ja      short </span><span style="color:gray">tdE       </span>; Nothing valid above &#039;f&#039; at all...
<span style="color:black">SYSINIT:30E7                 </span><span style="color:navy">sub     cl, </span><span style="color:green">57h         </span>; &#039;a&#039;-10 ; 87 ; Make &#039;a&#039;==10 and return.
<span style="color:black">SYSINIT:30EA                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:30EB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:30EB
SYSINIT:30EB </span><span style="color:gray">td20</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:30EB                 </span><span style="color:navy">cmp     cl, </span><span style="color:#ff8000">41h </span><span style="color:gray">; &#039;A&#039;   </span>; Below &#039;A&#039;? Not a letter...
<span style="color:black">SYSINIT:30EE                 </span><span style="color:navy">jb      short </span><span style="color:gray">td10
</span><span style="color:black">SYSINIT:30F0                 </span><span style="color:navy">cmp     cl, </span><span style="color:#ff8000">46h </span><span style="color:gray">; &#039;F&#039;   </span>; Above &#039;F&#039;? Not a digit.
<span style="color:black">SYSINIT:30F3                 </span><span style="color:navy">ja      short </span><span style="color:gray">tdE
</span><span style="color:black">SYSINIT:30F5                 </span><span style="color:navy">sub     cl, </span><span style="color:green">37h         </span>; &#039;A&#039;-10 ; 55 ; Make &#039;A&#039;==10 and return.
<span style="color:black">SYSINIT:30F8                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:30F9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:30F9
SYSINIT:30F9 </span><span style="color:gray">td10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:30F9                 </span><span style="color:navy">cmp     cl, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;   </span>; If less than zero,
<span style="color:black">SYSINIT:30FC                 </span><span style="color:navy">jb      short </span><span style="color:gray">tdE       </span>; Done.
<span style="color:black">SYSINIT:30FE                 </span><span style="color:navy">cmp     cl, </span><span style="color:#ff8000">39h </span><span style="color:gray">; &#039;9&#039;   </span>; Or, if greater than nine,
<span style="color:black">SYSINIT:3101                 </span><span style="color:navy">ja      short </span><span style="color:gray">tdE       </span>; Done.
<span style="color:black">SYSINIT:3103                 </span><span style="color:navy">sub     cl, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;   </span>; Okay--make &#039;0&#039;==0 and return.
<span style="color:black">SYSINIT:3106                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3107 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3107
SYSINIT:3107 </span><span style="color:gray">tdE</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3107                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3108                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3108 </span>toDigit         endp
<span style="color:black">SYSINIT:3108
SYSINIT:3109
SYSINIT:3109 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3109
SYSINIT:3109
SYSINIT:3109 </span>GetXNum         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3109                 </span><span style="color:navy">push    bx              </span>; reads a 32-bit ASCII number at ES:SI
<span style="color:black">SYSINIT:3109                                         </span>; and returns it in DX:AX
<span style="color:black">SYSINIT:310A                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:310B                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:310C                 </span><span style="color:navy">cld
</span><span style="color:black">SYSINIT:310D                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:black">SYSINIT:310F                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:black">SYSINIT:3111                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:3113                 </span><span style="color:navy">xor     dx, dx          </span>; Start with 0 (makes sense)
<span style="color:black">SYSINIT:3115                 </span><span style="color:navy">mov     cs:</span>gnradix<span style="color:navy">, </span><span style="color:#ff8000">0Ah </span>; And default to a radix of 10 (dec)
<span style="color:black">SYSINIT:311C                 </span><span style="color:navy">mov     cl, es:[si]
</span><span style="color:black">SYSINIT:311F                 </span><span style="color:navy">call    </span>toDigit
<span style="color:black">SYSINIT:3122                 </span><span style="color:navy">jb      short </span><span style="color:gray">gxnE      </span>; If it&#039;s not a digit, leave now.
<span style="color:black">SYSINIT:3124                 </span><span style="color:navy">or      cl, cl
</span><span style="color:black">SYSINIT:3126                 </span><span style="color:navy">jnz     short </span><span style="color:gray">gxn20     </span>; Doesn&#039;t have &#039;0x&#039;
<span style="color:black">SYSINIT:3128                 </span><span style="color:navy">mov     cl, es:[si+</span><span style="color:#ff8000">1</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:312C                 </span><span style="color:navy">cmp     cl, &#039;</span><span style="color:green">x&#039;         </span>; Either &#039;x&#039;...
<span style="color:black">SYSINIT:312F                 </span><span style="color:navy">jz      short </span><span style="color:gray">gxn10
</span><span style="color:black">SYSINIT:3131                 </span><span style="color:navy">cmp     cl, &#039;</span><span style="color:green">X&#039;
</span><span style="color:black">SYSINIT:3134                 </span><span style="color:navy">jnz     short </span><span style="color:gray">gxn20
</span><span style="color:black">SYSINIT:3136
SYSINIT:3136 </span><span style="color:gray">gxn10</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3136                 </span><span style="color:navy">mov     cs:</span>gnradix<span style="color:navy">, </span><span style="color:green">16
</span><span style="color:black">SYSINIT:313D                 </span><span style="color:navy">inc     si              </span>; Since we read &quot;0x&quot;, march over it.
<span style="color:black">SYSINIT:313E                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:313F
SYSINIT:313F </span><span style="color:gray">gxn20</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:313F                 </span><span style="color:navy">mov     cl, es:[si]     </span>; Now DX:AX=current total, CH=0/CL=char
<span style="color:black">SYSINIT:3142                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:3143                 </span><span style="color:navy">call    </span>toDigit         ;  Accepts only valid digits, A-F -&gt; 10-16
<span style="color:black">SYSINIT:3146                 </span><span style="color:navy">jb      short </span><span style="color:gray">gxnQ      </span>; &lt;- Ah... wasn&#039;t a digit. Stop.
<span style="color:black">SYSINIT:3148                 </span><span style="color:navy">call    </span>mul32
<span style="color:black">SYSINIT:314B                 </span><span style="color:navy">jb      short </span><span style="color:gray">gxnX
</span><span style="color:black">SYSINIT:314D                 </span><span style="color:navy">add     ax, cx
</span><span style="color:black">SYSINIT:314F                 </span><span style="color:navy">adc     dx, bx
</span><span style="color:black">SYSINIT:3151                 </span><span style="color:navy">jb      short </span><span style="color:gray">gxnX
</span><span style="color:black">SYSINIT:3153                 </span><span style="color:navy">jmp     short </span><span style="color:gray">gxn20
</span><span style="color:black">SYSINIT:3155 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3155
SYSINIT:3155 </span><span style="color:gray">gxnE</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3155                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3156                 </span><span style="color:navy">jmp     short </span><span style="color:gray">gxnX
</span><span style="color:black">SYSINIT:3158 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3158
SYSINIT:3158 </span><span style="color:gray">gxnQ</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3158                 </span><span style="color:navy">dec     si
</span><span style="color:black">SYSINIT:3159                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:315A
SYSINIT:315A </span><span style="color:gray">gxnX</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:315A                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:315B                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:315C                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:315D                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:315D </span>GetXNum         endp
<span style="color:black">SYSINIT:315D
SYSINIT:315E
SYSINIT:315E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:315E
SYSINIT:315E
SYSINIT:315E </span>mul32           proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:315E                 </span><span style="color:navy">push    ax              </span>; multiplies the number in DX:AX by gnradix
<span style="color:black">SYSINIT:315E                                         </span>; DX=old:hi, AX=old:lo, TOS=old:lo, BX=0
<span style="color:black">SYSINIT:315F                 </span><span style="color:navy">mov     ax, dx
</span><span style="color:black">SYSINIT:3161                 </span><span style="color:navy">mul     cs:</span>gnradix      ; DX=?, AX=new:hi, TOS=old:lo, BX=0
<span style="color:black">SYSINIT:3166                 </span><span style="color:navy">jb      short </span><span style="color:gray">m32E      </span>; Too big?
<span style="color:black">SYSINIT:3168                 </span><span style="color:navy">mov     dx, ax          </span>; DX=new:hi, AX=new:hi, TOS=old:lo, BX=0
<span style="color:black">SYSINIT:316A                 </span><span style="color:navy">pop     ax              </span>; DX=new:hi, AX=old:lo, TOS=orig, BX=0
<span style="color:black">SYSINIT:316B                 </span><span style="color:navy">xchg    dx, bx          </span>; DX=0, AX=old:lo, TOS=orig, BX=new:hi
<span style="color:black">SYSINIT:316D                 </span><span style="color:navy">mul     cs:</span>gnradix      ; DX=carry, AX=new:lo, TOS=orig, BX=new:hi
<span style="color:black">SYSINIT:3172                 </span><span style="color:navy">xchg    dx, bx
</span><span style="color:black">SYSINIT:3174                 </span><span style="color:navy">add     dx, bx          </span>; DX=new:hi, AX=new:lo, TOS=orig, BX=carry
<span style="color:black">SYSINIT:3176                 </span><span style="color:navy">xor     bx, bx          </span>; BX=0
<span style="color:black">SYSINIT:3178                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3179 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3179
SYSINIT:3179 </span><span style="color:gray">m32E</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3179                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:317A                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:317A </span>mul32           endp
<span style="color:black">SYSINIT:317A
SYSINIT:317B
SYSINIT:317B </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:317B
SYSINIT:317B
SYSINIT:317B </span>toPara          proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:317B                 </span><span style="color:navy">push    cx              </span>; divides DX:AX by 16; result in AX only
<span style="color:black">SYSINIT:317C                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4           </span>; DX:AX=HHHH hhhh hhhh hhhh:LLLL llll llll llll
<span style="color:black">SYSINIT:317E                 </span><span style="color:navy">shr     ax, cl          </span>; DX:AX=HHHH hhhh hhhh hhhh:0000 LLLL llll llll
<span style="color:black">SYSINIT:3180                 </span><span style="color:navy">xchg    ax, dx          </span>; DX:AX=0000 LLLL llll llll:HHHH hhhh hhhh hhhh
<span style="color:black">SYSINIT:3181                 </span><span style="color:navy">mov     cl, </span><span style="color:green">12
</span><span style="color:black">SYSINIT:3183                 </span><span style="color:navy">shl     ax, cl          </span>; DX:AX=0000 LLLL llll llll:hhhh 0000 0000 0000
<span style="color:black">SYSINIT:3185                 </span><span style="color:navy">or      ax, dx          </span>; AX=hhhh LLLL llll llll
<span style="color:black">SYSINIT:3187                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:3188                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3188 </span>toPara          endp
<span style="color:black">SYSINIT:3188
SYSINIT:3189
SYSINIT:3189 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3189
SYSINIT:3189
SYSINIT:3189 </span>UmbHead         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3189                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:318A                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:318B                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:318C                 </span><span style="color:navy">mov     ah, </span><span style="color:green">52h         </span>; GET_IN_VARS
<span style="color:black">SYSINIT:318E                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ internal - GET LIST OF LISTS
<span style="color:black">SYSINIT:318E                                         </span>; Return: ES:BX -&gt; DOS list of lists
<span style="color:black">SYSINIT:3190                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">8Ch      </span>; [es:DOS_UMB_HEAD]
<span style="color:black">SYSINIT:3194                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:3197                 </span><span style="color:navy">jz      short </span><span style="color:gray">uhE
</span><span style="color:black">SYSINIT:3199                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:319A                 </span><span style="color:navy">jmp     short </span><span style="color:gray">uhX
</span><span style="color:black">SYSINIT:319C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:319C
SYSINIT:319C </span><span style="color:gray">uhE</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:319C                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:319D
SYSINIT:319D </span><span style="color:gray">uhX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:319D                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:319E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:319F                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:31A0                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:31A0 </span>UmbHead         endp
<span style="color:black">SYSINIT:31A0
SYSINIT:31A1
SYSINIT:31A1 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:31A1
SYSINIT:31A1
SYSINIT:31A1 </span>isSysMCB        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:31A1                 </span><span style="color:navy">push    ax              </span>; sets ZF if ES points to an MCB owned by &quot;SC&quot;
<span style="color:black">SYSINIT:31A2                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">1        </span>; [es:ARENA.OWNER]
<span style="color:black">SYSINIT:31A6                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">8           </span>; SystemPSPOwner ; 8 (for US or Japan) is valid
<span style="color:black">SYSINIT:31A9                 </span><span style="color:navy">jz      short </span><span style="color:gray">ism10
</span><span style="color:black">SYSINIT:31AB                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">9           </span>; JapanPSPOwner ; 9 (for Japan) is valid
<span style="color:black">SYSINIT:31AE                 </span><span style="color:navy">jz      short </span><span style="color:gray">ism10
</span><span style="color:black">SYSINIT:31B0                 </span><span style="color:navy">jmp     short </span><span style="color:gray">ismX
</span><span style="color:black">SYSINIT:31B2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:31B2
SYSINIT:31B2 </span><span style="color:gray">ism10</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:31B2                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">8        </span>; [es:ARENA.NAME]
<span style="color:black">SYSINIT:31B6                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">4353h       </span>; &#039;SC&#039;
<span style="color:black">SYSINIT:31B9
SYSINIT:31B9 </span><span style="color:gray">ismX</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:31B9                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:31BA                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:31BA </span>isSysMCB        endp
<span style="color:black">SYSINIT:31BA
SYSINIT:31BB
SYSINIT:31BB </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:31BB
SYSINIT:31BB
SYSINIT:31BB </span>AddrToUmb       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:31BB                 </span><span style="color:navy">push    cx              </span>; converts a segment address in AX
<span style="color:black">SYSINIT:31BB                                         </span>; to its appropriate UMB number
<span style="color:black">SYSINIT:31BC                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:31BD                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:31BE                 </span><span style="color:navy">mov     dx, ax          </span>; DX = address to search for
<span style="color:black">SYSINIT:31C0                 </span><span style="color:navy">call    </span>UmbHead         ; AX = first segment
<span style="color:black">SYSINIT:31C3                 </span><span style="color:navy">jb      short </span><span style="color:gray">atuE      </span>; If it couldn&#039;t get it, error out
<span style="color:black">SYSINIT:31C5                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:31C7                 </span><span style="color:navy">xor     cx, cx          </span>; 0
<span style="color:black">SYSINIT:31C9
SYSINIT:31C9 </span><span style="color:gray">atu10</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:31C9                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:31CB                 </span><span style="color:navy">cmp     ax, dx          </span>; Present segment &gt;= given segment?
<span style="color:black">SYSINIT:31CD                 </span><span style="color:navy">jnb     short </span><span style="color:gray">atuX      </span>; yes, done.
<span style="color:black">SYSINIT:31CF                 </span><span style="color:navy">call    </span>isSysMCB        ; Returns with ZF set if this is a system MCB
<span style="color:black">SYSINIT:31D2                 </span><span style="color:navy">jnz     short </span><span style="color:gray">atu20
</span><span style="color:black">SYSINIT:31D4                 </span><span style="color:navy">inc     cx              </span>; If it _was_ a system MCB, we&#039;re in a new UMB.
<span style="color:black">SYSINIT:31D5
SYSINIT:31D5 </span><span style="color:gray">atu20</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:31D5                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">0        </span>; [es:ARENA.SIGNATURE]
<span style="color:black">SYSINIT:31D9                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;
</span><span style="color:black">SYSINIT:31DB                 </span><span style="color:navy">jz      short </span><span style="color:gray">atu30     </span>; &#039;Z&#039; means this was the last MCB... that&#039;s it.
<span style="color:black">SYSINIT:31DD                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:31DF                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:31E4                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:31E5                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:31E7                 </span><span style="color:navy">jmp     short </span><span style="color:gray">atu10
</span><span style="color:black">SYSINIT:31E9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:31E9
SYSINIT:31E9 </span><span style="color:gray">atu30</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:31E9                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:31EB                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:31F0                 </span><span style="color:navy">cmp     ax, dx          </span>; Present &gt;= given?
<span style="color:black">SYSINIT:31F2                 </span><span style="color:navy">jnb     short </span><span style="color:gray">atuX      </span>; Yep! It _was_ inside.
<span style="color:black">SYSINIT:31F4
SYSINIT:31F4 </span><span style="color:gray">atuE</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:31F4                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:31F6                 </span><span style="color:navy">dec     cx              </span>; Address is above UM Range,
<span style="color:black">SYSINIT:31F6                                         </span>; AX will return as 0FFFFh.
<span style="color:black">SYSINIT:31F7
SYSINIT:31F7 </span><span style="color:gray">atuX</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:31F7                 </span><span style="color:navy">mov     ax, cx          </span>; Return the UMB number in AX (0==conv)
<span style="color:black">SYSINIT:31F9                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:31FA                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:31FB                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:31FC                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:31FC </span>AddrToUmb       endp
<span style="color:black">SYSINIT:31FC
SYSINIT:31FD
SYSINIT:31FD </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:31FD
SYSINIT:31FD
SYSINIT:31FD </span>convUMB         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:31FD                 </span><span style="color:navy">cmp     cs:</span>gnradix<span style="color:navy">, </span><span style="color:#ff8000">10h </span>; convert address to UMB number after GetXNum
<span style="color:black">SYSINIT:31FD                                         </span>; (GetXNum has read a hex number)
<span style="color:black">SYSINIT:3203                 </span><span style="color:navy">jnz     short </span><span style="color:gray">cu10      </span>; GetXNum didn&#039;t read in hex, it is not an addr
<span style="color:black">SYSINIT:3205                 </span><span style="color:navy">call    </span>AddrToUmb       ; convert the address to a UMB number
<span style="color:black">SYSINIT:3208                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:320B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">cu10
</span><span style="color:black">SYSINIT:320D                 </span><span style="color:navy">inc     ax              </span>; If too high, ignore it (make it conventional)
<span style="color:black">SYSINIT:320E
SYSINIT:320E </span><span style="color:gray">cu10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:320E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:320E </span>convUMB         endp
<span style="color:black">SYSINIT:320E
SYSINIT:320F
SYSINIT:320F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:320F
SYSINIT:320F
SYSINIT:320F </span>setUMBs         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:320F                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:3210                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:3211                 </span><span style="color:navy">call    </span>fm_link
<span style="color:black">SYSINIT:3214                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:3215                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:3216                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3216 </span>setUMBs         endp
<span style="color:black">SYSINIT:3216
</span><span style="color:maroon">SYSINIT:3217 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3217
SYSINIT:3217 </span>loadLow<span style="color:navy">:                                </span>; loadLow subroutine is not used
<span style="color:maroon">SYSINIT:3217                 </span><span style="color:navy">push    ds              </span>; anywhere of MSDOS 6.21 (&amp; 5.0) IO.SYS
<span style="color:maroon">SYSINIT:3217                                         </span>; Erdogan Tan - 18/07/2023
<span style="color:maroon">SYSINIT:3218                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:3219                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:321A                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:321A                 </span><span style="color:navy">mov     al, </span>UmbLoad
<span style="color:maroon">SYSINIT:321D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0FFh        </span>; UNSPECIFIED ; -1
<span style="color:maroon">SYSINIT:321F                 </span><span style="color:navy">jnz     short </span>ll10
<span style="color:maroon">SYSINIT:3221                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:3223                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:3224                 </span><span style="color:navy">jmp     short </span>llx
<span style="color:maroon">SYSINIT:3226 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3226
SYSINIT:3226 </span>ll10<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3226                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:3228                 </span><span style="color:navy">jz      short </span>llx
<span style="color:maroon">SYSINIT:322A                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:322C                 </span><span style="color:navy">clc
</span><span style="color:maroon">SYSINIT:322D
SYSINIT:322D </span>llx<span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:322D                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:322E                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:322E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:322F
SYSINIT:322F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:322F
SYSINIT:322F
SYSINIT:322F </span>HideUMBs        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:322F                 </span><span style="color:navy">push    ax              </span>; links UMBs and hides upper-memory as appropriate
<span style="color:black">SYSINIT:3230                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:3231                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:3232                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3233                 </span><span style="color:navy">call    </span>UmbTest         ; cf=0 if UMBs are available
<span style="color:black">SYSINIT:3236                 </span><span style="color:navy">jb      short </span><span style="color:gray">husX      </span>; there is nothing to do.
<span style="color:black">SYSINIT:3238                 </span><span style="color:navy">call    </span>FixMem          ; Concatenate adjacent free MCBs in upper mem
<span style="color:black">SYSINIT:323B                 </span><span style="color:navy">call    </span>setUMBs         ; Link UMBs and set memory-allocation strategy
<span style="color:black">SYSINIT:323E                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:323F                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:3240                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3241                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:3241                 </span><span style="color:navy">mov     es:</span>fInHigh<span style="color:navy">, </span><span style="color:#ff8000">1   </span>; Remember that we&#039;re now running high
<span style="color:black">SYSINIT:3247                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3248                 </span>assume es:nothing
<span style="color:black">SYSINIT:3248                 </span><span style="color:navy">call    </span>GetLoadUMB      ; See if they gave us a list to leave free
<span style="color:black">SYSINIT:324B                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0FFh        </span>; UNSPECIFIED ; If they didn&#039;t,
<span style="color:black">SYSINIT:324D                 </span><span style="color:navy">jz      short </span><span style="color:gray">husX
</span><span style="color:black">SYSINIT:324F                 </span><span style="color:navy">xor     cx, cx          </span>; 0
<span style="color:black">SYSINIT:3251
SYSINIT:3251 </span><span style="color:gray">hus10</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3251                 </span><span style="color:navy">inc     cx              </span>; +1 for each UMB
<span style="color:black">SYSINIT:3252                 </span><span style="color:navy">cmp     cx, </span><span style="color:green">16          </span>; MAXUMB
<span style="color:black">SYSINIT:3255                 </span><span style="color:navy">jnb     short </span><span style="color:gray">hus20
</span><span style="color:black">SYSINIT:3257                 </span><span style="color:navy">mov     al, cl
</span><span style="color:black">SYSINIT:3259                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:325A                 </span><span style="color:navy">call    </span>findUMB         ; ES:0 points to first MCB in UMB
<span style="color:black">SYSINIT:325A                                         </span>; Carry set if couldn&#039;t reach UMB
<span style="color:black">SYSINIT:325D                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:325E                 </span><span style="color:navy">jb      short </span><span style="color:gray">hus20     </span>; outside of the valid range of UMBs
<span style="color:black">SYSINIT:3260                 </span><span style="color:navy">call    </span>_hideUMB_       ; hide what we need to hide.
<span style="color:black">SYSINIT:3263                 </span><span style="color:navy">jmp     short </span><span style="color:gray">hus10
</span><span style="color:black">SYSINIT:3265 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3265
SYSINIT:3265 </span><span style="color:gray">hus20</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3265                 </span><span style="color:navy">call    </span>GetLoadUMB      ; mov al,[cs:UmbLoad]
<span style="color:black">SYSINIT:3268                 </span><span style="color:navy">or      al, al          </span>; or byte [cs:UmbLoad],0
<span style="color:black">SYSINIT:3268                                         </span>; Is the load UMB 0? (-1==unspecified)
<span style="color:black">SYSINIT:326A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">husX      </span>; no, done.
<span style="color:black">SYSINIT:326C                 </span><span style="color:navy">call    </span>hl_unlink       ; fix UMBs and strategy.
<span style="color:black">SYSINIT:326F
SYSINIT:326F </span><span style="color:gray">husX</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:326F                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3270                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3271                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:3272                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:3273                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3273 </span>HideUMBs        endp
<span style="color:black">SYSINIT:3273
SYSINIT:3274
SYSINIT:3274 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3274
SYSINIT:3274
SYSINIT:3274 </span>GetLoadUMB      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3274                 </span><span style="color:navy">push    ds              </span>; Instead of calling this subroutine
<span style="color:black">SYSINIT:3274                                         </span>; &quot;or byte [cs:UmbLoad],0&quot; then &quot;jz/jnz ..&quot;
<span style="color:black">SYSINIT:3274                                         </span>; would be enough. Erdogan Tan - 18/07/2023
<span style="color:black">SYSINIT:3275                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:3276                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3277                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:3277                 </span><span style="color:navy">mov     al, </span>UmbLoad
<span style="color:black">SYSINIT:327A                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:327B                 </span>assume ds:nothing
<span style="color:black">SYSINIT:327B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:327B </span>GetLoadUMB      endp
<span style="color:black">SYSINIT:327B
SYSINIT:327C
SYSINIT:327C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:327C
SYSINIT:327C
SYSINIT:327C </span>GetLoadSize     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:327C                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:327D                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:327E                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:327F                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:3280                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3281                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:3281                 </span><span style="color:navy">mov     al, </span>UmbLoad
<span style="color:black">SYSINIT:3284                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">SYSINIT:3286                 </span><span style="color:navy">mov     bx, offset </span>UmbSize ; array
<span style="color:black">SYSINIT:3289                 </span><span style="color:navy">shl     al, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:328B                 </span><span style="color:navy">add     ax, bx
</span><span style="color:black">SYSINIT:328D                 </span><span style="color:navy">mov     si, ax
</span><span style="color:black">SYSINIT:328F                 </span><span style="color:navy">lodsw                   </span>; ax==size
<span style="color:black">SYSINIT:3290                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3291                 </span>assume ds:nothing
<span style="color:black">SYSINIT:3291                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:3292                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:3293                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3293 </span>GetLoadSize     endp
<span style="color:black">SYSINIT:3293
SYSINIT:3294
SYSINIT:3294 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3294
SYSINIT:3294
SYSINIT:3294 </span>GetSize         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3294                 </span><span style="color:navy">push    bx              </span>; Returns the UMB in AL&#039;s minimum size
<span style="color:black">SYSINIT:3294                                         </span>;  (0 if not specified)
<span style="color:black">SYSINIT:3295                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:3296                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:3297                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:3298                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3299                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:3299                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">SYSINIT:329B                 </span><span style="color:navy">mov     bx, offset </span>UmbSize ; array
<span style="color:black">SYSINIT:329E                 </span><span style="color:navy">shl     al, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:32A0                 </span><span style="color:navy">add     ax, bx
</span><span style="color:black">SYSINIT:32A2                 </span><span style="color:navy">mov     si, ax
</span><span style="color:black">SYSINIT:32A4                 </span><span style="color:navy">lodsw                   </span>; ax==size
<span style="color:black">SYSINIT:32A5                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:32A6                 </span>assume ds:nothing
<span style="color:black">SYSINIT:32A6                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:32A7                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:32A8                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:32A8 </span>GetSize         endp
<span style="color:black">SYSINIT:32A8
</span><span style="color:maroon">SYSINIT:32A9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:32A9
SYSINIT:32A9 </span>StoLoadUMB<span style="color:navy">:                             </span>; StoLoadUMB subroutine is not used
<span style="color:maroon">SYSINIT:32A9                 </span><span style="color:navy">push    es              </span>; anywhere of MSDOS 6.21 (&amp; 5.0) IO.SYS
<span style="color:maroon">SYSINIT:32A9                                         </span>; Erdogan Tan - 18/07/2023
<span style="color:maroon">SYSINIT:32AA                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:32AB                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:32AC                 </span>assume es:SYSINIT
<span style="color:maroon">SYSINIT:32AC                 </span><span style="color:navy">mov     es:</span>UmbLoad<span style="color:navy">, al  </span>; Overrides the load UMB number with what&#039;s in AL
<span style="color:maroon">SYSINIT:32B0                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:32B1                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:32B1                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:32B2
SYSINIT:32B2 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:32B2
SYSINIT:32B2
SYSINIT:32B2 </span>StoLoadSize     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:32B2                 </span><span style="color:navy">push    dx              </span>; Overrides the load UMB min. size with what&#039;s in AX
<span style="color:black">SYSINIT:32B3                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:32B4                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:32B5                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:32B6                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:32B6                 </span><span style="color:navy">mov     dl, </span>UmbLoad     ; Put UMB# in DL
<span style="color:black">SYSINIT:32B6                                         </span>;
<span style="color:black">SYSINIT:32B6                                         </span>; BUG ! CL would be used here instead of DL (*)
<span style="color:black">SYSINIT:32B6                                         </span>; 18/07/2023
<span style="color:black">SYSINIT:32BA                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:32BB                 </span>assume ds:nothing
<span style="color:black">SYSINIT:32BB                 </span><span style="color:navy">cmp     dl, </span><span style="color:#ff8000">0FFh        </span>; UNSPECIFIED
<span style="color:black">SYSINIT:32BE                 </span><span style="color:navy">jz      short </span><span style="color:gray">sls10
</span><span style="color:black">SYSINIT:32C0                 </span><span style="color:navy">call    </span>stowSiz         ; We&#039;ve got a function to do just this
<span style="color:black">SYSINIT:32C0                                         </span>;
<span style="color:black">SYSINIT:32C0                                         </span>; BUG ! stowSiz uses CL instead of DL !
<span style="color:black">SYSINIT:32C0                                         </span>; (CL is set in ParseL which calls stowSiz)
<span style="color:black">SYSINIT:32C0                                         </span>; (This BUG existing in PCDOS 7.1 IBMBIO.COM also)
<span style="color:black">SYSINIT:32C0                                         </span>; Erdogan Tan - 18/07/2023
<span style="color:black">SYSINIT:32C3
SYSINIT:32C3 </span><span style="color:gray">sls10</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:32C3                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:32C4                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:32C4 </span>StoLoadSize     endp
<span style="color:black">SYSINIT:32C4
SYSINIT:32C5
SYSINIT:32C5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:32C5
SYSINIT:32C5
SYSINIT:32C5 </span>hideUMB         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:32C5                 </span><span style="color:navy">push    ax              </span>; marks as HIDDEN all FREE elements in UMB passed as AL
<span style="color:black">SYSINIT:32C6                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:32C7                 </span><span style="color:navy">call    </span>findUMB         ; Returns with carry if err, else ES == MCB
<span style="color:black">SYSINIT:32CA                 </span><span style="color:navy">jb      short </span><span style="color:gray">huX
</span><span style="color:black">SYSINIT:32CC
SYSINIT:32CC </span><span style="color:gray">hu10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:32CC                 </span><span style="color:navy">call    </span>isSysMCB        ; Returns with ZF set if owner is SYSTEM
<span style="color:black">SYSINIT:32CF                 </span><span style="color:navy">jz      short </span><span style="color:gray">huX
</span><span style="color:black">SYSINIT:32D1                 </span><span style="color:navy">call    </span>isFreeMCB       ; or word [es:ARENA.OWNER],0
<span style="color:black">SYSINIT:32D4                 </span><span style="color:navy">jnz     short </span><span style="color:gray">hu20
</span><span style="color:black">SYSINIT:32D6                 </span><span style="color:navy">call    </span>hideMCB
<span style="color:black">SYSINIT:32D9
SYSINIT:32D9 </span><span style="color:gray">hu20</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:32D9                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">0        </span>; [es:ARENA.SIGNATURE]
<span style="color:black">SYSINIT:32DD                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;   </span>; cmp byte [es:ARENA.SIGNATURE],arena_signature_end
<span style="color:black">SYSINIT:32DF                 </span><span style="color:navy">jz      short </span><span style="color:gray">huX
</span><span style="color:black">SYSINIT:32E1                 </span><span style="color:navy">mov     ax, es          </span>; Go on forward.
<span style="color:black">SYSINIT:32E3                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:32E8                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:32E9                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:32EB                 </span><span style="color:navy">jmp     short </span><span style="color:gray">hu10
</span><span style="color:black">SYSINIT:32ED </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:32ED
SYSINIT:32ED </span><span style="color:gray">huX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:32ED                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:32EE                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:32EF                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:32EF </span>hideUMB         endp
<span style="color:black">SYSINIT:32EF
SYSINIT:32F0
SYSINIT:32F0 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:32F0
SYSINIT:32F0
SYSINIT:32F0 </span>isTiny          proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:32F0                 </span><span style="color:navy">push    ax              </span>; returns with ZF set if user didn&#039;t specify /S
<span style="color:black">SYSINIT:32F1                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:32F2                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:32F3                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:32F4                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:32F4                 </span><span style="color:navy">mov     al, </span>fUmbTiny
<span style="color:black">SYSINIT:32F7                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:32F8                 </span>assume ds:nothing
<span style="color:black">SYSINIT:32F8                 </span><span style="color:navy">or      al, al
</span><span style="color:black">SYSINIT:32FA                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:32FB                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:32FB </span>isTiny          endp
<span style="color:black">SYSINIT:32FB
SYSINIT:32FC
SYSINIT:32FC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:32FC
SYSINIT:32FC
SYSINIT:32FC </span>isFreeMCB       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:32FC                 </span><span style="color:navy">or      word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">0 </span>; or word [es:ARENA.OWNER],0
<span style="color:black">SYSINIT:3302                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3302 </span>isFreeMCB       endp
<span style="color:black">SYSINIT:3302
SYSINIT:3303
SYSINIT:3303 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3303
SYSINIT:3303
SYSINIT:3303 </span>hideMCB         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3303                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; marks as HIDDEN the MCB at ES:0
<span style="color:black">SYSINIT:330A                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">4948h </span>; &#039;HI&#039;
<span style="color:black">SYSINIT:3311                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">0Ah</span><span style="color:navy">, </span><span style="color:#ff8000">4444h </span>; &#039;DD&#039;
<span style="color:black">SYSINIT:3318                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">0Ch</span><span style="color:navy">, </span><span style="color:#ff8000">4E45h </span>; &#039;EN&#039;
<span style="color:black">SYSINIT:331F                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">0Eh</span><span style="color:navy">, </span><span style="color:#ff8000">2020h </span>; &#039;  &#039;
<span style="color:black">SYSINIT:3326                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3326 </span>hideMCB         endp
<span style="color:black">SYSINIT:3326
SYSINIT:3327
SYSINIT:3327 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3327
SYSINIT:3327
SYSINIT:3327 </span>unHideMCB       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3327                 </span><span style="color:navy">push    ax              </span>; marks as FREE the MCB at ES:0
<span style="color:black">SYSINIT:3328                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; [es:ARENA.OWNER],FreePSPOwner
<span style="color:black">SYSINIT:332F                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">2020h       </span>; &#039;  &#039;
<span style="color:black">SYSINIT:3332                 </span><span style="color:navy">mov     es:</span><span style="color:green">8</span><span style="color:navy">, ax        </span>; [es:ARENA.NAME+0]
<span style="color:black">SYSINIT:3336                 </span><span style="color:navy">mov     es:</span><span style="color:green">0Ah</span><span style="color:navy">, ax      </span>; [es:ARENA.NAME+2]
<span style="color:black">SYSINIT:333A                 </span><span style="color:navy">mov     es:</span><span style="color:green">0Ch</span><span style="color:navy">, ax      </span>; [es:ARENA.NAME+4]
<span style="color:black">SYSINIT:333E                 </span><span style="color:navy">mov     es:</span><span style="color:green">0Eh</span><span style="color:navy">, ax      </span>; [es:ARENA.NAME+6]
<span style="color:black">SYSINIT:3342                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:3343                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3343 </span>unHideMCB       endp
<span style="color:black">SYSINIT:3343
SYSINIT:3344
SYSINIT:3344 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3344
SYSINIT:3344
SYSINIT:3344 </span>findUMB         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3344                 </span><span style="color:navy">push    ax              </span>; makes ES:0 point to the first MCB in UMB given as AL
<span style="color:black">SYSINIT:3345                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:3346                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:3347                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:black">SYSINIT:3349                 </span><span style="color:navy">mov     dx, ax          </span>; Store the to-be-found UMB number in DX
<span style="color:black">SYSINIT:334B                 </span><span style="color:navy">call    </span>UmbHead         ; Returns first UMB segment in AX
<span style="color:black">SYSINIT:334E                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:3350                 </span><span style="color:navy">xor     cx, cx          </span>; Pretend we&#039;re on UMB 0 for now...
<span style="color:black">SYSINIT:3352
SYSINIT:3352 </span><span style="color:gray">fu10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3352                 </span><span style="color:navy">cmp     cx, dx          </span>; If CX==DX, the UMB is found
<span style="color:black">SYSINIT:3354                 </span><span style="color:navy">jz      short </span><span style="color:gray">fuX
</span><span style="color:black">SYSINIT:3356                 </span><span style="color:navy">call    </span>isSysMCB        ; Returns with ZF set if owner is SYSTEM
<span style="color:black">SYSINIT:3359                 </span><span style="color:navy">jnz     short </span><span style="color:gray">fu20
</span><span style="color:black">SYSINIT:335B                 </span><span style="color:navy">inc     cx
</span><span style="color:black">SYSINIT:335C
SYSINIT:335C </span><span style="color:gray">fu20</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:335C                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">0
</span><span style="color:black">SYSINIT:3360                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;   </span>; cmp byte [es:ARENA.SIGNATURE],arena_signature_end
<span style="color:black">SYSINIT:3362                 </span><span style="color:navy">jz      short </span><span style="color:gray">fuE       </span>; &#039;Z&#039; means this was the last MCB
<span style="color:black">SYSINIT:3364                 </span><span style="color:navy">mov     ax, es          </span>; Go on forward.
<span style="color:black">SYSINIT:3366                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:336B                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:336C                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:336E                 </span><span style="color:navy">jmp     short </span><span style="color:gray">fu10
</span><span style="color:black">SYSINIT:3370 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3370
SYSINIT:3370 </span><span style="color:gray">fuE</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3370                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3371
SYSINIT:3371 </span><span style="color:gray">fuX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3371                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:3372                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:3373                 </span><span style="color:navy">pop     ax              </span>; The address is already in ES.
<span style="color:black">SYSINIT:3374                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3374 </span>findUMB         endp
<span style="color:black">SYSINIT:3374
SYSINIT:3375
SYSINIT:3375 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3375
SYSINIT:3375
SYSINIT:3375 </span>BigFree         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3375                 </span><span style="color:navy">push    bx              </span>; makes ES:0 point to the largest free MCB
<span style="color:black">SYSINIT:3375                                         </span>; in UMB given as AL
<span style="color:black">SYSINIT:3376                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:3377                 </span><span style="color:navy">call    </span>findUMB         ; Returns with CF if err, else ES==MCB
<span style="color:black">SYSINIT:337A                 </span><span style="color:navy">jb      short </span><span style="color:gray">bfX
</span><span style="color:black">SYSINIT:337C                 </span><span style="color:navy">xor     bx, bx          </span>; Segment address of largest free MCB
<span style="color:black">SYSINIT:337E                 </span><span style="color:navy">xor     cx, cx          </span>; Size of largest free MCB
<span style="color:black">SYSINIT:3380
SYSINIT:3380 </span><span style="color:gray">bf10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3380                 </span><span style="color:navy">call    </span>isSysMCB        ; If we&#039;ve left the MCB, we&#039;re done.
<span style="color:black">SYSINIT:3383                 </span><span style="color:navy">jz      short </span><span style="color:gray">bf30
</span><span style="color:black">SYSINIT:3385                 </span><span style="color:navy">call    </span>isFreeMCB       ; or word [es:ARENA.OWNER],0
<span style="color:black">SYSINIT:3388                 </span><span style="color:navy">jnz     short </span><span style="color:gray">bf20
</span><span style="color:black">SYSINIT:338A                 </span><span style="color:navy">cmp     cx, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE] ; Compare sizes..
<span style="color:black">SYSINIT:338F                 </span><span style="color:navy">jg      short </span><span style="color:gray">bf20
</span><span style="color:black">SYSINIT:3391                 </span><span style="color:navy">mov     bx, es          </span>; Unless we&#039;re bigger,
<span style="color:black">SYSINIT:3393                 </span><span style="color:navy">mov     cx, es:</span><span style="color:green">3        </span>; Store this new element&#039;s addr and size.
<span style="color:black">SYSINIT:3398
SYSINIT:3398 </span><span style="color:gray">bf20</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3398                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">0
</span><span style="color:black">SYSINIT:339C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;   </span>; [es:ARENA.SIGNATURE],arena_signature_end
<span style="color:black">SYSINIT:339E                 </span><span style="color:navy">jz      short </span><span style="color:gray">bf30
</span><span style="color:black">SYSINIT:33A0                 </span><span style="color:navy">mov     ax, es          </span>; NextMCB es,ax ; (macro) ; Go on forward.
<span style="color:black">SYSINIT:33A2                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; es:ARENA.SIZE]
<span style="color:black">SYSINIT:33A7                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:33A8                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:33AA                 </span><span style="color:navy">jmp     short </span><span style="color:gray">bf10
</span><span style="color:black">SYSINIT:33AC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:33AC
SYSINIT:33AC </span><span style="color:gray">bf30</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:33AC                 </span><span style="color:navy">mov     es, bx          </span>; Return the address
<span style="color:black">SYSINIT:33AE                 </span><span style="color:navy">mov     ax, cx          </span>; Return the size
<span style="color:black">SYSINIT:33B0                 </span><span style="color:navy">or      bx, bx
</span><span style="color:black">SYSINIT:33B2                 </span><span style="color:navy">jnz     short </span><span style="color:gray">bfX
</span><span style="color:black">SYSINIT:33B4                 </span><span style="color:navy">stc                     </span>; (if size==0, there&#039;s nothing free)
<span style="color:black">SYSINIT:33B5
SYSINIT:33B5 </span><span style="color:gray">bfX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:33B5                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:33B6                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:33B7                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:33B7 </span>BigFree         endp
<span style="color:black">SYSINIT:33B7
SYSINIT:33B8
SYSINIT:33B8 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:33B8
SYSINIT:33B8
SYSINIT:33B8 </span>isSpecified     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:33B8                 </span><span style="color:navy">push    ax              </span>; sets ZF if UMB in AL wasn&#039;t specified in DH/LH line.
<span style="color:black">SYSINIT:33B9                 </span><span style="color:navy">xor     bh, bh
</span><span style="color:black">SYSINIT:33BB                 </span><span style="color:navy">mov     bl, al
</span><span style="color:black">SYSINIT:33BD                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:33BE                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:33BF                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:33C0                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:33C0                 </span><span style="color:navy">mov     al, </span>UmbUsed<span style="color:navy">[bx]
</span><span style="color:black">SYSINIT:33C4                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:33C5                 </span>assume ds:nothing
<span style="color:black">SYSINIT:33C5                 </span><span style="color:navy">or      al, al          </span>; ets ZF if al==0 (ie, if unspecified)
<span style="color:black">SYSINIT:33C7                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:33C8                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:33C8 </span>isSpecified     endp
<span style="color:black">SYSINIT:33C8
SYSINIT:33C9
SYSINIT:33C9 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:33C9
SYSINIT:33C9
SYSINIT:33C9 </span>shrinkMCB       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:33C9                 </span><span style="color:navy">push    bx              </span>; breaks an MCB into two pieces, the lowest one&#039;s size==AX
<span style="color:black">SYSINIT:33C9                                         </span>; AX == new size, ES:0 == current MCB
<span style="color:black">SYSINIT:33CA                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:33CB                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:33CC                 </span><span style="color:navy">mov     bx, ax          </span>; requested size (lowest one)
<span style="color:black">SYSINIT:33CE                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:33D0                 </span><span style="color:navy">mov     cx, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:33D5                 </span><span style="color:navy">sub     cx, </span><span style="color:green">32          </span>; MIN_SPLIT_SIZE = 32
<span style="color:black">SYSINIT:33D8                 </span><span style="color:navy">cmp     bx, cx          </span>; {New size} vs {Current Size-20h}
<span style="color:black">SYSINIT:33DA                 </span><span style="color:navy">ja      short </span><span style="color:gray">smE       </span>; if wanted_size &gt; cur-20h, abort.
<span style="color:black">SYSINIT:33DC                 </span><span style="color:navy">mov     dl, es:</span><span style="color:green">0        </span>; [es:ARENA.SIGNATURE]
<span style="color:black">SYSINIT:33E1                 </span><span style="color:navy">mov     cx, es:</span><span style="color:green">3
</span><span style="color:black">SYSINIT:33E6                 </span><span style="color:navy">mov     es:</span><span style="color:green">3</span><span style="color:navy">, bx        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:33EB                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">4Dh </span><span style="color:gray">; &#039;M&#039; </span>; [es:ARENA.SIGNATURE],&#039;M&#039;
<span style="color:black">SYSINIT:33F1                 </span><span style="color:navy">add     ax, bx
</span><span style="color:black">SYSINIT:33F3                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:33F4                 </span><span style="color:navy">mov     es, ax          </span>; Move to new arena area
<span style="color:black">SYSINIT:33F6                 </span><span style="color:navy">mov     ax, cx
</span><span style="color:black">SYSINIT:33F8                 </span><span style="color:navy">sub     ax, bx
</span><span style="color:black">SYSINIT:33FA                 </span><span style="color:navy">dec     ax              </span>; And prepare the new size
<span style="color:black">SYSINIT:33FB                 </span><span style="color:navy">mov     es:</span><span style="color:green">0</span><span style="color:navy">, dl        </span>; [es:ARENA.SIGNATURE],dl
<span style="color:black">SYSINIT:3400                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; [es:ARENA.OWNER]
<span style="color:black">SYSINIT:3407                 </span><span style="color:navy">mov     es:</span><span style="color:green">3</span><span style="color:navy">, ax        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:340B                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">2020h       </span>; &#039;  &#039;
<span style="color:black">SYSINIT:340E                 </span><span style="color:navy">mov     es:</span><span style="color:green">8</span><span style="color:navy">, ax        </span>; [es:ARENA.NAME+0]
<span style="color:black">SYSINIT:3412                 </span><span style="color:navy">mov     es:</span><span style="color:green">0Ah</span><span style="color:navy">, ax      </span>; [es:ARENA.NAME+2]
<span style="color:black">SYSINIT:3416                 </span><span style="color:navy">mov     es:</span><span style="color:green">0Ch</span><span style="color:navy">, ax      </span>; [es:ARENA.NAME+4]
<span style="color:black">SYSINIT:341A                 </span><span style="color:navy">mov     es:</span><span style="color:green">0Eh</span><span style="color:navy">, ax      </span>; [es:ARENA.NAME+6]
<span style="color:black">SYSINIT:341E                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:341F                 </span><span style="color:navy">jmp     short </span><span style="color:gray">smX
</span><span style="color:black">SYSINIT:3421 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3421
SYSINIT:3421 </span><span style="color:gray">smE</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3421                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3422
SYSINIT:3422 </span><span style="color:gray">smX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3422                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3423                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:3424                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:3425                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3425 </span>shrinkMCB       endp
<span style="color:black">SYSINIT:3425
SYSINIT:3426
SYSINIT:3426 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3426
SYSINIT:3426
SYSINIT:3426 </span>_hideUMB_       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3426                 </span><span style="color:navy">push    bx              </span>; hides as appropriate the UMB in CL
<span style="color:black">SYSINIT:3427                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:3428                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3429                 </span><span style="color:navy">mov     al, cl
</span><span style="color:black">SYSINIT:342B                 </span><span style="color:navy">call    </span>isSpecified     ; Returns ZF set if al&#039;s umb was NOT specified
<span style="color:black">SYSINIT:342E                 </span><span style="color:navy">jz      short </span><span style="color:gray">hu_20
</span><span style="color:black">SYSINIT:3430                 </span><span style="color:navy">mov     al, cl
</span><span style="color:black">SYSINIT:3432                 </span><span style="color:navy">call    </span>BigFree         ; Retrieve the size of the largest free element
<span style="color:black">SYSINIT:3432                                         </span>; in AX, put its address in ES.
<span style="color:black">SYSINIT:3435                 </span><span style="color:navy">jb      short </span><span style="color:gray">hu_20
</span><span style="color:black">SYSINIT:3437                 </span><span style="color:navy">push    ax              </span>; TOS==size of BigFree in UMB
<span style="color:black">SYSINIT:3438                 </span><span style="color:navy">mov     al, cl          </span>; Retrieve the user&#039;s specified
<span style="color:black">SYSINIT:343A                 </span><span style="color:navy">call    </span>GetSize         ; minimum size for this umb (into AX)
<span style="color:black">SYSINIT:343D                 </span><span style="color:navy">pop     bx              </span>; BX==BigFree, AX==Specified Size
<span style="color:black">SYSINIT:343E                 </span><span style="color:navy">or      ax, ax          </span>; If they didn&#039;t specify one,
<span style="color:black">SYSINIT:343E                                         </span>; skip over all this.
<span style="color:black">SYSINIT:3440                 </span><span style="color:navy">jz      short </span><span style="color:gray">hu_20
</span><span style="color:black">SYSINIT:3442                 </span><span style="color:navy">cmp     ax, bx          </span>; if (specified &gt; max free)
<span style="color:black">SYSINIT:3444                 </span><span style="color:navy">jbe     short </span><span style="color:gray">hu_10
</span><span style="color:black">SYSINIT:3446                 </span><span style="color:navy">mov     al, cl          </span>; then mark that UMB as unused.
<span style="color:black">SYSINIT:3448                 </span><span style="color:navy">call    </span>unMarkUMB
<span style="color:black">SYSINIT:344B                 </span><span style="color:navy">jmp     short </span><span style="color:gray">hu_20
</span><span style="color:black">SYSINIT:344D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:344D
SYSINIT:344D </span><span style="color:gray">hu_10</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:344D                 </span><span style="color:navy">call    </span>isTiny          ; or byte [cs:fUmbTiny],0
<span style="color:black">SYSINIT:3450                 </span><span style="color:navy">jz      short </span><span style="color:gray">hu_20
</span><span style="color:black">SYSINIT:3452                 </span><span style="color:navy">call    </span>shrinkMCB       ; They specified /S, so shrink the MCB to AX
<span style="color:black">SYSINIT:3455                 </span><span style="color:navy">jb      short </span><span style="color:gray">hu_20
</span><span style="color:black">SYSINIT:3457                 </span><span style="color:navy">mov     dx, es
</span><span style="color:black">SYSINIT:3459                 </span><span style="color:navy">jmp     short </span><span style="color:gray">hu_30     </span>; Skip the spec check.. we wanna hide this one.
<span style="color:black">SYSINIT:345B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:345B
SYSINIT:345B </span><span style="color:gray">hu_20</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:345B                 </span><span style="color:navy">mov     ax, cx
</span><span style="color:black">SYSINIT:345D                 </span><span style="color:navy">call    </span>isSpecified     ; If they specified this UMB, we&#039;re done.
<span style="color:black">SYSINIT:3460                 </span><span style="color:navy">jnz     short </span><span style="color:gray">hu_X      </span>; so leave.
<span style="color:black">SYSINIT:3462                 </span><span style="color:navy">xor     dx, dx          </span>; 0
<span style="color:black">SYSINIT:3464
SYSINIT:3464 </span><span style="color:gray">hu_30</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3464                 </span><span style="color:navy">mov     al, cl
</span><span style="color:black">SYSINIT:3466                 </span><span style="color:navy">call    </span>hideUMB         ; Hides everything in UMB #al
<span style="color:black">SYSINIT:3469                 </span><span style="color:navy">or      dx, dx          </span>; Did we shrink a UMB? If not, DX==0,
<span style="color:black">SYSINIT:346B                 </span><span style="color:navy">jz      short </span><span style="color:gray">hu_X      </span>; So we should leave.
<span style="color:black">SYSINIT:346D                 </span><span style="color:navy">mov     es, dx          </span>; Ah, but if it isn&#039;t, DX==the MCB&#039;s address;
<span style="color:black">SYSINIT:346F                 </span><span style="color:navy">call    </span>unHideMCB       ; Un-hides the lower portion of that MCB.
<span style="color:black">SYSINIT:3472
SYSINIT:3472 </span><span style="color:gray">hu_X</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3472                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3473                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:3474                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:3475                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3475 </span>_hideUMB_       endp
<span style="color:black">SYSINIT:3475
SYSINIT:3476
SYSINIT:3476 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3476
SYSINIT:3476
SYSINIT:3476 </span>UnFreeze        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3476                 </span><span style="color:navy">push    ax              </span>; Marks FROZEN elements as FREE
<span style="color:black">SYSINIT:3477                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3478                 </span><span style="color:navy">call    </span>UmbHead         ; Returns with carry if err, else ES == MCB
<span style="color:black">SYSINIT:347B                 </span><span style="color:navy">jb      short </span><span style="color:gray">ufX
</span><span style="color:black">SYSINIT:347D                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:347F
SYSINIT:347F </span><span style="color:gray">uf10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:347F                 </span><span style="color:navy">call    </span>isFrozMCB       ; Returns with ZF set if MCB is FROZEN
<span style="color:black">SYSINIT:3482                 </span><span style="color:navy">jnz     short </span><span style="color:gray">uf20
</span><span style="color:black">SYSINIT:3484                 </span><span style="color:navy">call    </span>unHideMCB
<span style="color:black">SYSINIT:3487
SYSINIT:3487 </span><span style="color:gray">uf20</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3487                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">0
</span><span style="color:black">SYSINIT:348B                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;
</span><span style="color:black">SYSINIT:348D                 </span><span style="color:navy">jz      short </span><span style="color:gray">ufX
</span><span style="color:black">SYSINIT:348F                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:3491                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:3496                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:3497                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:3499                 </span><span style="color:navy">jmp     short </span><span style="color:gray">uf10
</span><span style="color:black">SYSINIT:349B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:349B
SYSINIT:349B </span><span style="color:gray">ufX</span><span style="color:navy">:                                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:349B                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:349C                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:349D                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:349D </span>UnFreeze        endp
<span style="color:black">SYSINIT:349D
SYSINIT:349E
SYSINIT:349E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:349E
SYSINIT:349E
SYSINIT:349E </span>isFrozMCB       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:349E                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:349F                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">1        </span>; [es:ARENA.OWNER] ; Check the owner..
<span style="color:black">SYSINIT:34A3                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">8           </span>; 8 (for US OR Japan) is valid
<span style="color:black">SYSINIT:34A6                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ifmX
</span><span style="color:black">SYSINIT:34A8                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">8        </span>; [es:ARENA.NAME+0]
<span style="color:black">SYSINIT:34AC                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">5246h       </span>; &#039;FR&#039;
<span style="color:black">SYSINIT:34AF                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ifmX
</span><span style="color:black">SYSINIT:34B1                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">0Ah      </span>; [es:ARENA.NAME+2]
<span style="color:black">SYSINIT:34B5                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">5A4Fh       </span>; &#039;OZ&#039;
<span style="color:black">SYSINIT:34B8                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ifmX
</span><span style="color:black">SYSINIT:34BA                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">0Ch      </span>; [es:ARENA.NAME+4]
<span style="color:black">SYSINIT:34BE                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">4E45h       </span>; &#039;EN&#039;
<span style="color:black">SYSINIT:34C1                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ifmX
</span><span style="color:black">SYSINIT:34C3                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">0Eh      </span>; [es:ARENA.NAME+6]
<span style="color:black">SYSINIT:34C7                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">2020h       </span>; &#039;  &#039;
<span style="color:black">SYSINIT:34CA
SYSINIT:34CA </span><span style="color:gray">ifmX</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:34CA                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:34CB                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:34CB </span>isFrozMCB       endp
<span style="color:black">SYSINIT:34CB
SYSINIT:34CC
SYSINIT:34CC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:34CC
SYSINIT:34CC
SYSINIT:34CC </span>frezMCB         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:34CC                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; marks as 8+FROZEN the MCB at ES:0
<span style="color:black">SYSINIT:34CC                                         </span>; mov word [es:ARENA.OWNER],SystemPSPOwner
<span style="color:black">SYSINIT:34D3                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">5246h </span>; [es:ARENA.NAME+0],&#039;FR&#039;
<span style="color:black">SYSINIT:34DA                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">0Ah</span><span style="color:navy">, </span><span style="color:#ff8000">5A4Fh </span>; [es:ARENA.NAME+2],&#039;OZ&#039;
<span style="color:black">SYSINIT:34E1                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">0Ch</span><span style="color:navy">, </span><span style="color:#ff8000">4E45h </span>; [es:ARENA.NAME+4],&#039;EN&#039;
<span style="color:black">SYSINIT:34E8                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">0Eh</span><span style="color:navy">, </span><span style="color:#ff8000">2020h </span>; [es:ARENA.NAME+6],&#039;  &#039;
<span style="color:black">SYSINIT:34EF                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:34EF </span>frezMCB         endp
<span style="color:black">SYSINIT:34EF
SYSINIT:34F0
SYSINIT:34F0 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:34F0
SYSINIT:34F0
SYSINIT:34F0 </span>FreezeUM        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:34F0                 </span><span style="color:navy">push    ax              </span>; Marks FROZEN all UM elements now FREE,
<span style="color:black">SYSINIT:34F0                                         </span>; save those in load UMB
<span style="color:black">SYSINIT:34F1                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:34F2                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:34F3                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:34F4                 </span><span style="color:navy">call    </span>GetLoadUMB      ; mov al,[cs:UmbLoad]
<span style="color:black">SYSINIT:34F7                 </span><span style="color:navy">xor     ah, ah          </span>; 0
<span style="color:black">SYSINIT:34F9                 </span><span style="color:navy">mov     dx, ax          </span>; Store the load UMB in DX, so we can skip it
<span style="color:black">SYSINIT:34FB                 </span><span style="color:navy">call    </span>UmbHead         ; Returns first UMB segment in AX
<span style="color:black">SYSINIT:34FE                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:3500                 </span><span style="color:navy">xor     cx, cx          </span>; Pretend we&#039;re on UMB 0 for now..
<span style="color:black">SYSINIT:3502
SYSINIT:3502 </span><span style="color:gray">fum10</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3502                 </span><span style="color:navy">call    </span>isSysMCB        ; Returns with ZF set if owner is SYSTEM
<span style="color:black">SYSINIT:3505                 </span><span style="color:navy">jnz     short </span><span style="color:gray">fum20
</span><span style="color:black">SYSINIT:3507                 </span><span style="color:navy">inc     cx              </span>; If it _was_ SYSTEM, we&#039;re in a new UMB.
<span style="color:black">SYSINIT:3508
SYSINIT:3508 </span><span style="color:gray">fum20</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3508                 </span><span style="color:navy">cmp     cx, dx          </span>; DX - UMB number to skip (load UMB)
<span style="color:black">SYSINIT:3508                                         </span>;
<span style="color:black">SYSINIT:3508                                         </span>; If this is the load UMB, we don&#039;t want to
<span style="color:black">SYSINIT:3508                                         </span>; freeze anything.. so skip that section.
<span style="color:black">SYSINIT:350A                 </span><span style="color:navy">jz      short </span><span style="color:gray">fum30
</span><span style="color:black">SYSINIT:350C                 </span><span style="color:navy">call    </span>isFreeMCB       ; or word [es:ARENA.OWNER],0
<span style="color:black">SYSINIT:350C                                         </span>; If it&#039;s not free, we can&#039;t freeze it
<span style="color:black">SYSINIT:350F                 </span><span style="color:navy">jnz     short </span><span style="color:gray">fum30
</span><span style="color:black">SYSINIT:3511                 </span><span style="color:navy">call    </span>frezMCB
<span style="color:black">SYSINIT:3514
SYSINIT:3514 </span><span style="color:gray">fum30</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3514                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">0
</span><span style="color:black">SYSINIT:3518                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;   </span>; cmp byte [es:ARENA.SIGNATURE],arena_signature_end
<span style="color:black">SYSINIT:351A                 </span><span style="color:navy">jz      short </span><span style="color:gray">fumX
</span><span style="color:black">SYSINIT:351C                 </span><span style="color:navy">mov     ax, es          </span>; NextMCB es, ax (macro) ; Go on forward.
<span style="color:black">SYSINIT:351E                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:3523                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:3524                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:3526                 </span><span style="color:navy">jmp     short </span><span style="color:gray">fum10
</span><span style="color:black">SYSINIT:3528 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3528
SYSINIT:3528 </span><span style="color:gray">fumX</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3528                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3529                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:352A                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:352B                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:352C                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:352C </span>FreezeUM        endp
<span style="color:black">SYSINIT:352C
SYSINIT:352D
SYSINIT:352D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:352D
SYSINIT:352D
SYSINIT:352D </span>UmbTest         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:352D                 </span><span style="color:navy">push    ax              </span>; returns with carry set if UMBs are not available,
<span style="color:black">SYSINIT:352D                                         </span>;  else CF==false
<span style="color:black">SYSINIT:352E                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:352F                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:3530                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3531                 </span><span style="color:navy">call    </span>fm_link         ; Link in UMBs (if not already linked)
<span style="color:black">SYSINIT:3534                 </span><span style="color:navy">call    </span>WalkMem         ; Check to see if they&#039;re really linked
<span style="color:black">SYSINIT:3537                 </span><span style="color:navy">pushf                   </span>; And remember what we found out
<span style="color:black">SYSINIT:3538                 </span><span style="color:navy">call    </span>fm_unlink       ; Unlink UMBs (if we have linked &#039;em)
<span style="color:black">SYSINIT:353B                 </span><span style="color:navy">popf                    </span>; And restore what we found out.
<span style="color:black">SYSINIT:353C                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:353D                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:353E                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:353F                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:3540                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3540 </span>UmbTest         endp
<span style="color:black">SYSINIT:3540
SYSINIT:3541
SYSINIT:3541 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3541
SYSINIT:3541
SYSINIT:3541 </span>WalkMem         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3541                 </span><span style="color:navy">push    ax              </span>; WalkMem - travels memory chain and
<span style="color:black">SYSINIT:3541                                         </span>; returns carry clear if UMBs are linked
<span style="color:black">SYSINIT:3542                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:3543                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3544                 </span><span style="color:navy">mov     ah, </span><span style="color:green">52h
</span><span style="color:black">SYSINIT:3546                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ internal - GET LIST OF LISTS
<span style="color:black">SYSINIT:3546                                         </span>; Return: ES:BX -&gt; DOS list of lists
<span style="color:black">SYSINIT:3548                 </span><span style="color:navy">mov     ax, es:[bx-</span><span style="color:green">2</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:354C                 </span><span style="color:navy">mov     es, ax          </span>; ES = Current MCB pointer
<span style="color:black">SYSINIT:354E
SYSINIT:354E </span><span style="color:gray">um10</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:354E                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">0
</span><span style="color:black">SYSINIT:3552                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;   </span>; cmp byte [es:ARENA.SIGNATURE],arena_signature_end ; &#039;Z&#039;
<span style="color:black">SYSINIT:3554                 </span><span style="color:navy">jz      short </span><span style="color:gray">um20
</span><span style="color:black">SYSINIT:3556                 </span><span style="color:navy">mov     bx, es          </span>; Move to the next MCB
<span style="color:black">SYSINIT:3558                 </span><span style="color:navy">add     bx, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:355D                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:355E                 </span><span style="color:navy">mov     es, bx
</span><span style="color:black">SYSINIT:3560                 </span><span style="color:navy">jmp     short </span><span style="color:gray">um10
</span><span style="color:black">SYSINIT:3562 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3562
SYSINIT:3562 </span><span style="color:gray">um20</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3562                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:3564                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">9FFFh       </span>; This sets CF if ax &lt; 9FFFh.
<span style="color:black">SYSINIT:3567                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3568                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:3569                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:356A                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:356A </span>WalkMem         endp
<span style="color:black">SYSINIT:356A
SYSINIT:356B
SYSINIT:356B </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:356B
SYSINIT:356B
SYSINIT:356B </span>hl_unlink       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:356B                 </span><span style="color:navy">xor     bh, bh          </span>; unlinks UMBs if fm_umb is set to 0;
<span style="color:black">SYSINIT:356B                                         </span>;  restores strategy too
<span style="color:black">SYSINIT:356D                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:356E                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:356F                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3570                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:3570                 </span><span style="color:navy">mov     bl, </span>fm_umb
<span style="color:black">SYSINIT:3574                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3575                 </span>assume ds:nothing
<span style="color:black">SYSINIT:3575                 </span><span style="color:navy">mov     ax, </span><span style="color:green">5803h       </span>; DOS_SET_UMBLINK
<span style="color:black">SYSINIT:3578                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:3578                                         </span>; AL = function code: (DOS 5beta) set UMB link state
<span style="color:black">SYSINIT:357A                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:357A </span>hl_unlink       endp
<span style="color:black">SYSINIT:357A
SYSINIT:357B
SYSINIT:357B </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:357B
SYSINIT:357B
SYSINIT:357B </span>UnHideUMBs      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:357B                 </span><span style="color:navy">push    ax              </span>; Marks HIDDEN elements as FREE
<span style="color:black">SYSINIT:357C                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:357D                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:357E                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:357F                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:357F                 </span><span style="color:navy">mov     al, </span>fInHigh     ; mov al,[cs:fInHigh]
<span style="color:black">SYSINIT:3582                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3583                 </span>assume ds:nothing
<span style="color:black">SYSINIT:3583                 </span><span style="color:navy">or      al, al
</span><span style="color:black">SYSINIT:3585                 </span><span style="color:navy">jnz     short </span><span style="color:gray">uhu10     </span>; If didn&#039;t call loadhigh/devicehigh earlier,
<span style="color:black">SYSINIT:3587                 </span><span style="color:navy">pop     ax              </span>; then there&#039;s nothing to do here.
<span style="color:black">SYSINIT:3588                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3589                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:358A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:358A
SYSINIT:358A </span><span style="color:gray">uhu10</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:358A                 </span><span style="color:navy">call    </span>linkumb         ; Make sure UMBs are linked in.
<span style="color:black">SYSINIT:358D                 </span><span style="color:navy">call    </span>FreeUMBs
<span style="color:black">SYSINIT:3590                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3591                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:3592                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3593                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:3593                 </span><span style="color:navy">mov     es:</span>fInHigh<span style="color:navy">, </span><span style="color:#ff8000">0   </span>; We&#039;re leaving, so update fInHigh.
<span style="color:black">SYSINIT:3599                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:359A                 </span>assume es:nothing
<span style="color:black">SYSINIT:359A                 </span><span style="color:navy">call    </span>he_unlink       ; Unlink UMBs
<span style="color:black">SYSINIT:359D                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:359E                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:359F                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:359F </span>UnHideUMBs      endp
<span style="color:black">SYSINIT:359F
SYSINIT:35A0
SYSINIT:35A0 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:35A0
SYSINIT:35A0
SYSINIT:35A0 </span>he_unlink       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:35A0                 </span><span style="color:navy">xor     bh, bh          </span>; unlinks UMBs if fm_umb is set to 0
<span style="color:black">SYSINIT:35A2                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:35A3                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:35A4                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:35A5                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:35A5                 </span><span style="color:navy">mov     bl, </span>fm_umb
<span style="color:black">SYSINIT:35A9                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:35AA                 </span>assume ds:nothing
<span style="color:black">SYSINIT:35AA                 </span><span style="color:navy">mov     ax, </span><span style="color:green">5803h
</span><span style="color:black">SYSINIT:35AD                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:35AD                                         </span>; AL = function code: (DOS 5beta) set UMB link state
<span style="color:black">SYSINIT:35AF                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:35AF </span>he_unlink       endp
<span style="color:black">SYSINIT:35AF
SYSINIT:35B0
SYSINIT:35B0 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:35B0
SYSINIT:35B0
SYSINIT:35B0 </span>FreeUMBs        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:35B0                 </span><span style="color:navy">push    ax              </span>; frees all HIDDEN memory elements in upper-memory
<span style="color:black">SYSINIT:35B1                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:35B2                 </span><span style="color:navy">call    </span>HeadUmb         ; Returns with carry if err, else ES == MCB
<span style="color:black">SYSINIT:35B5                 </span><span style="color:navy">jb      short </span><span style="color:gray">fusX
</span><span style="color:black">SYSINIT:35B7                 </span><span style="color:navy">mov     es, ax          </span>; Prepare for the loop; ES = current MCB addr.
<span style="color:black">SYSINIT:35B9
SYSINIT:35B9 </span><span style="color:gray">fus10</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:35B9                 </span><span style="color:navy">call    </span>isHideMCB       ; Returns with ZF set if owner is 0
<span style="color:black">SYSINIT:35BC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">fus20
</span><span style="color:black">SYSINIT:35BE                 </span><span style="color:navy">call    </span>freeMCB
<span style="color:black">SYSINIT:35C1
SYSINIT:35C1 </span><span style="color:gray">fus20</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:35C1                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">0
</span><span style="color:black">SYSINIT:35C5                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;   </span>; cmp byte [es:ARENA.SIGNATURE],arena_signature_end
<span style="color:black">SYSINIT:35C7                 </span><span style="color:navy">jz      short </span><span style="color:gray">fusX
</span><span style="color:black">SYSINIT:35C9                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:35CB                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:35D0                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:35D1                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:35D3                 </span><span style="color:navy">jmp     short </span><span style="color:gray">fus10     </span>; Go on forward.
<span style="color:black">SYSINIT:35D5 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:35D5
SYSINIT:35D5 </span><span style="color:gray">fusX</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:35D5                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:35D6                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:35D7                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:35D7 </span>FreeUMBs        endp
<span style="color:black">SYSINIT:35D7
SYSINIT:35D8
SYSINIT:35D8 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:35D8
SYSINIT:35D8
SYSINIT:35D8 </span>isHideMCB       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:35D8                 </span><span style="color:navy">push    ax              </span>; returns with ZF set if current MCB (ES:0) is HIDDEN
<span style="color:black">SYSINIT:35D9                 </span><span style="color:navy">cmp     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:ARENA.OWNER],SystemPSPOwner
<span style="color:black">SYSINIT:35D9                                         </span>; If the owner&#039;s SYSTEM then check for HIDDEN
<span style="color:black">SYSINIT:35DF                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ihm_x
</span><span style="color:black">SYSINIT:35E1                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">8
</span><span style="color:black">SYSINIT:35E5                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">4948h       </span>; cmp word [es:ARENA.NAME+0],&#039;HI&#039;
<span style="color:black">SYSINIT:35E8                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ihm_x
</span><span style="color:black">SYSINIT:35EA                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">0Ah
</span><span style="color:black">SYSINIT:35EE                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">4444h       </span>; cmp word [es:ARENA.NAME+2],&#039;DD&#039;
<span style="color:black">SYSINIT:35F1                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ihm_x
</span><span style="color:black">SYSINIT:35F3                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">0Ch
</span><span style="color:black">SYSINIT:35F7                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">4E45h       </span>; cmp word [es:ARENA.NAME+4],&#039;EN&#039;
<span style="color:black">SYSINIT:35FA                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ihm_x
</span><span style="color:black">SYSINIT:35FC                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">0Eh
</span><span style="color:black">SYSINIT:3600                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">2020h       </span>; [es:ARENA.NAME+4],&#039;  &#039;
<span style="color:black">SYSINIT:3603
SYSINIT:3603 </span><span style="color:gray">ihm_x</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3603                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:3604                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3604 </span>isHideMCB       endp
<span style="color:black">SYSINIT:3604
SYSINIT:3605
SYSINIT:3605 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3605
SYSINIT:3605
SYSINIT:3605 </span>freeMCB         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3605                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; marks as free the MCB at ES:0
<span style="color:black">SYSINIT:360C                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">2020h       </span>; &#039;  &#039;
<span style="color:black">SYSINIT:360F                 </span><span style="color:navy">mov     es:</span><span style="color:green">8</span><span style="color:navy">, ax        </span>; mov word [es:ARENA.NAME+0],&#039;  &#039;
<span style="color:black">SYSINIT:3613                 </span><span style="color:navy">mov     es:</span><span style="color:green">0Ah</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:3617                 </span><span style="color:navy">mov     es:</span><span style="color:green">0Ch</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:361B                 </span><span style="color:navy">mov     es:</span><span style="color:green">0Eh</span><span style="color:navy">, ax      </span>; [es:ARENA.NAME+6]
<span style="color:black">SYSINIT:361F                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:361F </span>freeMCB         endp
<span style="color:black">SYSINIT:361F
SYSINIT:3620
SYSINIT:3620 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3620
SYSINIT:3620
SYSINIT:3620 </span>HeadUmb         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3620                 </span><span style="color:navy">push    si              </span>; returns in AX the addr of the 1st UMB block (0x9FFF)
<span style="color:black">SYSINIT:3621                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:3622                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3623                 </span><span style="color:navy">mov     ah, </span><span style="color:green">52h
</span><span style="color:black">SYSINIT:3625                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ internal - GET LIST OF LISTS
<span style="color:black">SYSINIT:3625                                         </span>; Return: ES:BX -&gt; DOS list of lists
<span style="color:black">SYSINIT:3627                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">8Ch      </span>; [es:UMB_HeadIdx]
<span style="color:black">SYSINIT:362B                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:362E                 </span><span style="color:navy">jz      short </span><span style="color:gray">xhu_e     </span>; If it&#039;s 0xFFFF, it&#039;s an error...
<span style="color:black">SYSINIT:3630                 </span><span style="color:navy">clc                     </span>; AX contains 0x9FFF for most systems
<span style="color:black">SYSINIT:3631                 </span><span style="color:navy">jmp     short </span><span style="color:gray">xhu_x
</span><span style="color:black">SYSINIT:3633 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3633
SYSINIT:3633 </span><span style="color:gray">xhu_e</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3633                 </span><span style="color:navy">stc                     </span>; error
<span style="color:black">SYSINIT:3634
SYSINIT:3634 </span><span style="color:gray">xhu_x</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3634                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3635                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3636                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:3637                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3637 </span>HeadUmb         endp
<span style="color:black">SYSINIT:3637
SYSINIT:3638
SYSINIT:3638 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3638
SYSINIT:3638
SYSINIT:3638 </span>linkumb         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3638                 </span><span style="color:navy">mov     ax, </span><span style="color:green">5802h
</span><span style="color:black">SYSINIT:363B                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:363B                                         </span>; AL = function code: (DOS 5beta) get UMB link state
<span style="color:black">SYSINIT:363D                 </span><span style="color:navy">or      al, al
</span><span style="color:black">SYSINIT:363F                 </span><span style="color:navy">jnz     short </span><span style="color:gray">lumbX
</span><span style="color:black">SYSINIT:3641                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">5803h
</span><span style="color:black">SYSINIT:3644                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:3647                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 3+ - GET/SET MEMORY ALLOCATION STRATEGY
<span style="color:black">SYSINIT:3647                                         </span>; AL = function code: (DOS 5beta) set UMB link state
<span style="color:black">SYSINIT:3649
SYSINIT:3649 </span><span style="color:gray">lumbX</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3649                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3649 </span>linkumb         endp
<span style="color:black">SYSINIT:3649
SYSINIT:364A
SYSINIT:364A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:364A
SYSINIT:364A
SYSINIT:364A </span>InitDevLoad     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:364A                 </span><span style="color:navy">cmp     cs:</span>DeviceHi<span style="color:navy">, </span><span style="color:#ff8000">0  </span>; Are we loading in UMB ?
<span style="color:black">SYSINIT:3650                 </span><span style="color:navy">jz      short </span><span style="color:gray">InitForLo </span>; no, init for lo mem
<span style="color:black">SYSINIT:3652                 </span><span style="color:navy">cmp     cs:</span>ConvLoad<span style="color:navy">, </span><span style="color:#ff8000">1  </span>; Are we loading as per Dos 5?
<span style="color:black">SYSINIT:3658                 </span><span style="color:navy">jz      short </span><span style="color:gray">InitForConv
</span><span style="color:black">SYSINIT:365A                 </span><span style="color:navy">call    </span>ShrinkUMB       ; Stop using the old device arena
<span style="color:black">SYSINIT:365D                 </span><span style="color:navy">call    </span>HideUMBs        ; Mark up the UM area as we see fit
<span style="color:black">SYSINIT:3660                 </span><span style="color:navy">call    </span>FreezeUM        ; Hide everything BUT the load area
<span style="color:black">SYSINIT:3663                 </span><span style="color:navy">call    </span>GetUMBForDev    ; And grab that load area as needed
<span style="color:black">SYSINIT:3666                 </span><span style="color:navy">pushf
</span><span style="color:black">SYSINIT:3667                 </span><span style="color:navy">call    </span>UnFreeze        ; Then unhide everything frozen
<span style="color:black">SYSINIT:366A                 </span><span style="color:navy">popf
</span><span style="color:black">SYSINIT:366B                 </span><span style="color:navy">jb      short </span><span style="color:gray">InitForLo </span>; (if carry, it&#039;s loading low)
<span style="color:black">SYSINIT:366D                 </span><span style="color:navy">jmp     short </span><span style="color:gray">InitForHi
</span><span style="color:black">SYSINIT:366F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:366F
SYSINIT:366F </span><span style="color:gray">InitForConv</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:366F                 </span><span style="color:navy">call    </span>SpaceInUMB      ; Do we have space left in the current UMB ?
<span style="color:black">SYSINIT:3672                 </span><span style="color:navy">jnb     short </span><span style="color:gray">InitForHi </span>; yes, we have
<span style="color:black">SYSINIT:3674                 </span><span style="color:navy">call    </span>ShrinkUMB       ; shrink the current UMB in use
<span style="color:black">SYSINIT:3677                 </span><span style="color:navy">call    </span>GetUMBForDev    ; else try to allocate new UMB
<span style="color:black">SYSINIT:367A                 </span><span style="color:navy">jb      short </span><span style="color:gray">InitForLo </span>; we didn&#039;t succeed, so load in low memory
<span style="color:black">SYSINIT:367C
SYSINIT:367C </span><span style="color:gray">InitForHi</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:367C                 </span><span style="color:navy">mov     ax, cs:</span>DevUMBFree ; get Para addr of free mem
<span style="color:black">SYSINIT:3680                 </span><span style="color:navy">mov     dx, cs:</span>DevUMBAddr ; UMB start addr
<span style="color:black">SYSINIT:3685                 </span><span style="color:navy">add     dx, cs:</span>DevUMBSize ; dx = UMB End addr
<span style="color:black">SYSINIT:368A                 </span><span style="color:navy">jmp     short </span><span style="color:gray">idl1
</span><span style="color:black">SYSINIT:368C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:368C
SYSINIT:368C </span><span style="color:gray">InitForLo</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:368C                 </span><span style="color:navy">mov     cs:</span>DeviceHi<span style="color:navy">, </span><span style="color:#ff8000">0  </span>; in case we failed to load into UMB
<span style="color:black">SYSINIT:368C                                         </span>; indicate that we are loading low
<span style="color:black">SYSINIT:3692                 </span><span style="color:navy">mov     ax, cs:</span>memhi    ; start of Low memory
<span style="color:black">SYSINIT:3696                 </span><span style="color:navy">mov     dx, cs:</span>ALLOCLIM ; end of Low memory
<span style="color:black">SYSINIT:369B
SYSINIT:369B </span><span style="color:gray">idl1</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:369B                 </span><span style="color:navy">call    </span>DevSetMark      ; setup a sub-arena for DD
<span style="color:black">SYSINIT:369E                 </span><span style="color:navy">mov     cs:</span>DevLoadAddr<span style="color:navy">, ax </span>; init the Device load address
<span style="color:black">SYSINIT:36A2                 </span><span style="color:navy">mov     cs:</span>DevLoadEnd<span style="color:navy">, dx </span>; init the limit of the block
<span style="color:black">SYSINIT:36A7                 </span><span style="color:navy">mov     word ptr cs:</span>DevEntry<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; init Entry point to DD
<span style="color:black">SYSINIT:36AE                 </span><span style="color:navy">mov     word ptr cs:</span>DevEntry<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:36B2                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:36B2 </span>InitDevLoad     endp
<span style="color:black">SYSINIT:36B2
SYSINIT:36B3
SYSINIT:36B3 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:36B3
SYSINIT:36B3
SYSINIT:36B3 </span>SpaceInUMB      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:36B3                 </span><span style="color:navy">mov     ax, cs:</span>DevUMBSize
<span style="color:black">SYSINIT:36B7                 </span><span style="color:navy">add     ax, cs:</span>DevUMBAddr ; End of UMB
<span style="color:black">SYSINIT:36BC                 </span><span style="color:navy">sub     ax, cs:</span>DevUMBFree ; - Free = Remaining space
<span style="color:black">SYSINIT:36C1                 </span><span style="color:navy">or      ax, ax          </span>; Nospace ?
<span style="color:black">SYSINIT:36C3                 </span><span style="color:navy">jnz     short </span><span style="color:gray">spcinumb1
</span><span style="color:black">SYSINIT:36C5                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:36C6                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:36C7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:36C7
SYSINIT:36C7 </span><span style="color:gray">spcinumb1</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:36C7                 </span><span style="color:navy">dec     ax              </span>; space for sub-arena
<span style="color:black">SYSINIT:36C8                 </span><span style="color:navy">cmp     ax, cs:</span>DevSize  ; do we have space ?
<span style="color:black">SYSINIT:36CD                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:36CD </span>SpaceInUMB      endp
<span style="color:black">SYSINIT:36CD
SYSINIT:36CE
SYSINIT:36CE </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:36CE
SYSINIT:36CE
SYSINIT:36CE </span>PrepareMark     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:36CE                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:36CF                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:36D1                 </span><span style="color:navy">mov     word ptr ds:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [ARENA.OWNER]
<span style="color:black">SYSINIT:36D7                 </span><span style="color:navy">mov     word ptr ds:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">4453h </span>; [ARENA.NAME],&#039;SD&#039;
<span style="color:black">SYSINIT:36DD                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:36DE                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:36DF                 </span><span style="color:navy">mov     cs:</span>DevUMBAddr<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:36E3                 </span><span style="color:navy">mov     cs:</span>DevUMBFree<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:36E7                 </span><span style="color:navy">mov     cs:</span>DevUMBSize<span style="color:navy">, bx </span>; update the UMB Variables
<span style="color:black">SYSINIT:36EC                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:36EC </span>PrepareMark     endp
<span style="color:black">SYSINIT:36EC
SYSINIT:36ED
SYSINIT:36ED </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:36ED
SYSINIT:36ED
SYSINIT:36ED </span>GetUMBForDev    proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:36ED                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:36F0                 </span><span style="color:navy">mov     ax, </span><span style="color:green">4800h
</span><span style="color:black">SYSINIT:36F3                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:black">SYSINIT:36F3                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:black">SYSINIT:36F5                 </span><span style="color:navy">or      bx, bx
</span><span style="color:black">SYSINIT:36F7                 </span><span style="color:navy">jz      short </span><span style="color:gray">gufd_err
</span><span style="color:black">SYSINIT:36F9                 </span><span style="color:navy">dec     bx
</span><span style="color:black">SYSINIT:36FA                 </span><span style="color:navy">cmp     cs:</span>DevSize<span style="color:navy">, bx
</span><span style="color:black">SYSINIT:36FF                 </span><span style="color:navy">ja      short </span><span style="color:gray">gufd_err
</span><span style="color:black">SYSINIT:3701                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:3702                 </span><span style="color:navy">mov     ax, </span><span style="color:green">4800h
</span><span style="color:black">SYSINIT:3705                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ALLOCATE MEMORY
<span style="color:black">SYSINIT:3705                                         </span>; BX = number of 16-byte paragraphs desired
<span style="color:black">SYSINIT:3707                 </span><span style="color:navy">jb      short </span><span style="color:gray">gufd_err
</span><span style="color:black">SYSINIT:3709                 </span><span style="color:navy">dec     ax
</span><span style="color:black">SYSINIT:370A                 </span><span style="color:navy">call    </span>PrepareMark
<span style="color:black">SYSINIT:370D                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:370E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:370F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:370F
SYSINIT:370F </span><span style="color:gray">gufd_err</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:370F                 </span><span style="color:navy">xor     ax, ax          </span>; 0
<span style="color:black">SYSINIT:3711                 </span><span style="color:navy">mov     cs:</span>DevUMBSize<span style="color:navy">, ax </span>; erase the previous values
<span style="color:black">SYSINIT:3715                 </span><span style="color:navy">mov     cs:</span>DevUMBAddr<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:3719                 </span><span style="color:navy">mov     cs:</span>DevUMBFree<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:371D                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:371E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:371E </span>GetUMBForDev    endp
<span style="color:black">SYSINIT:371E
SYSINIT:371F
SYSINIT:371F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:371F
SYSINIT:371F
SYSINIT:371F </span>DevSetMark      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:371F                 </span><span style="color:navy">push    es              </span>; Input :
<span style="color:black">SYSINIT:371F                                         </span>; AX - Free segment were device is going to be loaded
<span style="color:black">SYSINIT:371F                                         </span>; Output :
<span style="color:black">SYSINIT:371F                                         </span>; AX - Segment at which device can be loaded (AX=AX+1)
<span style="color:black">SYSINIT:371F                                         </span>;
<span style="color:black">SYSINIT:371F                                         </span>; Creates a sub-arena for the device driver
<span style="color:black">SYSINIT:371F                                         </span>; puts &#039;D&#039; marker in the sub-arena
<span style="color:black">SYSINIT:3720                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:3721                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:3722                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:3723                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:3725                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">44h </span><span style="color:gray">; &#039;D&#039; </span>; [es:devmark.id],devmark_device ; &#039;D&#039;
<span style="color:black">SYSINIT:372B                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:372C                 </span><span style="color:navy">mov     es:</span><span style="color:green">1</span><span style="color:navy">, ax        </span>; [es:devmark.seg]
<span style="color:black">SYSINIT:3730                 </span><span style="color:navy">push    ax              </span>; save load address
<span style="color:black">SYSINIT:3731                 </span><span style="color:navy">lds     si, cs:</span>bpb_addr ; command line is still there
<span style="color:black">SYSINIT:3736                 </span><span style="color:navy">mov     di, si
</span><span style="color:black">SYSINIT:3738                 </span><span style="color:navy">cld
</span><span style="color:black">SYSINIT:3739
SYSINIT:3739 </span><span style="color:gray">dsm_again</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3739                 </span><span style="color:navy">lodsb
</span><span style="color:black">SYSINIT:373A                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Ah </span><span style="color:gray">; &#039;:&#039;
</span><span style="color:black">SYSINIT:373C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">isit_slash
</span><span style="color:black">SYSINIT:373E                 </span><span style="color:navy">mov     di, si
</span><span style="color:black">SYSINIT:3740                 </span><span style="color:navy">jmp     short </span><span style="color:gray">dsm_again
</span><span style="color:black">SYSINIT:3742 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3742
SYSINIT:3742 </span><span style="color:gray">isit_slash</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3742                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ch </span><span style="color:gray">; &#039;\&#039;
</span><span style="color:black">SYSINIT:3744                 </span><span style="color:navy">jnz     short </span><span style="color:gray">isit_null
</span><span style="color:black">SYSINIT:3746                 </span><span style="color:navy">mov     di, si
</span><span style="color:black">SYSINIT:3748                 </span><span style="color:navy">jmp     short </span><span style="color:gray">dsm_again
</span><span style="color:black">SYSINIT:374A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:374A
SYSINIT:374A </span><span style="color:gray">isit_null</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:374A                 </span><span style="color:navy">or      al, al
</span><span style="color:black">SYSINIT:374C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">dsm_again
</span><span style="color:black">SYSINIT:374E                 </span><span style="color:navy">mov     si, di
</span><span style="color:black">SYSINIT:3750                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">8           </span>; devmark.filename ; 8
<span style="color:black">SYSINIT:3753                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">8           </span>; maximum 8 characters
<span style="color:black">SYSINIT:3756
SYSINIT:3756 </span><span style="color:gray">dsm_next_char</span><span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3756                 </span><span style="color:navy">lodsb
</span><span style="color:black">SYSINIT:3757                 </span><span style="color:navy">or      al, al
</span><span style="color:black">SYSINIT:3759                 </span><span style="color:navy">jz      short </span><span style="color:gray">blankout
</span><span style="color:black">SYSINIT:375B                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Eh </span><span style="color:gray">; &#039;.&#039;
</span><span style="color:black">SYSINIT:375D                 </span><span style="color:navy">jz      short </span><span style="color:gray">blankout
</span><span style="color:black">SYSINIT:375F                 </span><span style="color:navy">stosb
</span><span style="color:black">SYSINIT:3760                 </span><span style="color:navy">loop    </span><span style="color:gray">dsm_next_char
</span><span style="color:black">SYSINIT:3762
SYSINIT:3762 </span><span style="color:gray">blankout</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3762                 </span><span style="color:navy">jcxz    short </span><span style="color:gray">dsm_exit
</span><span style="color:black">SYSINIT:3764                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:black">SYSINIT:3766                 </span><span style="color:navy">rep stosb               </span>; blank out the rest
<span style="color:black">SYSINIT:3768
SYSINIT:3768 </span><span style="color:gray">dsm_exit</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3768                 </span><span style="color:navy">pop     ax              </span>; restore load address
<span style="color:black">SYSINIT:3769                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:376A                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:376B                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:376C                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:376D                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:376D </span>DevSetMark      endp
<span style="color:black">SYSINIT:376D
SYSINIT:376E
SYSINIT:376E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:376E
SYSINIT:376E
SYSINIT:376E </span>SizeDevice      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:376E                 </span><span style="color:navy">push    ds              </span>; Calculates the size of the device file in paras
<span style="color:black">SYSINIT:376E                                         </span>; and stores it in DevSize
<span style="color:black">SYSINIT:376F                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3770                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3771                 </span><span style="color:navy">mov     dx, si
</span><span style="color:black">SYSINIT:3773                 </span><span style="color:navy">mov     ax, </span><span style="color:green">3D00h
</span><span style="color:black">SYSINIT:3776                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - OPEN DISK FILE WITH HANDLE
<span style="color:black">SYSINIT:3776                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:black">SYSINIT:3776                                         </span>; AL = access mode
<span style="color:black">SYSINIT:3776                                         </span>; 0 - read
<span style="color:black">SYSINIT:3778                 </span><span style="color:navy">jb      short </span><span style="color:gray">sd_err
</span><span style="color:black">SYSINIT:377A                 </span><span style="color:navy">mov     bx, ax          </span>; BX - file handle
<span style="color:black">SYSINIT:377C                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4202h
</span><span style="color:black">SYSINIT:377F                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:black">SYSINIT:3781                 </span><span style="color:navy">mov     dx, cx
</span><span style="color:black">SYSINIT:3783                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
<span style="color:black">SYSINIT:3783                                         </span>; AL = method: offset from end of file
<span style="color:black">SYSINIT:3785                 </span><span style="color:navy">jb      short </span><span style="color:gray">sd_close
</span><span style="color:black">SYSINIT:3787                 </span><span style="color:navy">add     ax, </span><span style="color:#ff8000">0Fh
</span><span style="color:black">SYSINIT:378A                 </span><span style="color:navy">adc     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:378D                 </span><span style="color:navy">test    dx, </span><span style="color:green">0FFF0h      </span>; size &gt; 0ffffh paras ?
<span style="color:black">SYSINIT:3791                 </span><span style="color:navy">jz      short </span><span style="color:gray">szdev1    </span>; no
<span style="color:black">SYSINIT:3793                 </span><span style="color:navy">mov     cs:</span>DevSize<span style="color:navy">, </span><span style="color:green">0FFFFh </span>; invalid device size
<span style="color:black">SYSINIT:3793                                         </span>;  assuming that we fail later
<span style="color:black">SYSINIT:379A                 </span><span style="color:navy">jmp     short </span><span style="color:gray">sd_close
</span><span style="color:black">SYSINIT:379C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:379C
SYSINIT:379C </span><span style="color:gray">szdev1</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:379C                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4           </span>; convert it to paras
<span style="color:black">SYSINIT:379E                 </span><span style="color:navy">shr     ax, cl
</span><span style="color:black">SYSINIT:37A0                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">0Ch
</span><span style="color:black">SYSINIT:37A2                 </span><span style="color:navy">shl     dx, cl
</span><span style="color:black">SYSINIT:37A4                 </span><span style="color:navy">or      ax, dx
</span><span style="color:black">SYSINIT:37A6                 </span><span style="color:navy">mov     cs:</span>DevSize<span style="color:navy">, ax  </span>; save file size (in paragraphs)
<span style="color:black">SYSINIT:37AA                 </span><span style="color:navy">clc                     </span>; CLC is not needed here
<span style="color:black">SYSINIT:37AA                                         </span>; (OR instruction clears CF) - E.TAN 22/07/2023
<span style="color:black">SYSINIT:37AB
SYSINIT:37AB </span><span style="color:gray">sd_close</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:37AB                 </span><span style="color:navy">pushf                   </span>; save carry flag
<span style="color:black">SYSINIT:37AC                 </span><span style="color:navy">mov     ax, </span><span style="color:green">3E00h
</span><span style="color:black">SYSINIT:37AF                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CLOSE A FILE WITH HANDLE
<span style="color:black">SYSINIT:37AF                                         </span>; BX = file handle
<span style="color:black">SYSINIT:37B1                 </span><span style="color:navy">popf                    </span>; restore carry flag
<span style="color:black">SYSINIT:37B1                                         </span>; (we are not checking for &#039;close file&#039; err)
<span style="color:black">SYSINIT:37B2
SYSINIT:37B2 </span><span style="color:gray">sd_err</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:37B2                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:37B3                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:37B3 </span>SizeDevice      endp
<span style="color:black">SYSINIT:37B3
SYSINIT:37B4
SYSINIT:37B4 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:37B4
SYSINIT:37B4
SYSINIT:37B4 </span>ExecDev         proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:37B4                 </span><span style="color:navy">mov     bx, cs:</span>DevLoadAddr
<span style="color:black">SYSINIT:37B9                 </span><span style="color:navy">mov     cs:</span>DevExecAddr<span style="color:navy">, bx </span>; Load the parameter block
<span style="color:black">SYSINIT:37BE                 </span><span style="color:navy">mov     cs:</span>DevExecReloc<span style="color:navy">, bx </span>; block for exec with  load address
<span style="color:black">SYSINIT:37C3                 </span><span style="color:navy">mov     bx, cs
</span><span style="color:black">SYSINIT:37C5                 </span><span style="color:navy">mov     es, bx
</span><span style="color:black">SYSINIT:37C7                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:37C7                 </span><span style="color:navy">mov     bx, offset </span>DevExecAddr ; es:bx points to parameters
<span style="color:black">SYSINIT:37CA                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3           </span>; (load program only)
<span style="color:black">SYSINIT:37CC                 </span><span style="color:navy">mov     ah, </span><span style="color:green">4Bh         </span>; load in the device driver
<span style="color:black">SYSINIT:37CE                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - LOAD OR EXECUTE (EXEC)
<span style="color:black">SYSINIT:37CE                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:black">SYSINIT:37CE                                         </span>; ES:BX -&gt; parameter block
<span style="color:black">SYSINIT:37CE                                         </span>; AL = subfunc: called by MSC spawn(P_NOWAIT,...) when running DOS 4.x.
<span style="color:black">SYSINIT:37D0                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:37D0 </span>ExecDev         endp
<span style="color:black">SYSINIT:37D0
SYSINIT:37D1
SYSINIT:37D1 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:37D1
SYSINIT:37D1
SYSINIT:37D1 </span>RetFromUM       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:37D1                 </span><span style="color:navy">pushf
</span><span style="color:black">SYSINIT:37D2                 </span><span style="color:navy">mov     cs:</span>ConvLoad<span style="color:navy">, </span><span style="color:#ff8000">1  </span>; ConvLoad set if didn&#039;t previously call HideUMBs
<span style="color:black">SYSINIT:37D8                 </span><span style="color:navy">call    </span>UnHideUMBs
<span style="color:black">SYSINIT:37DB                 </span><span style="color:navy">jb      short </span><span style="color:gray">rfUM1
</span><span style="color:black">SYSINIT:37DD                 </span><span style="color:navy">mov     cs:</span>ConvLoad<span style="color:navy">, </span><span style="color:#ff8000">0  </span>; ConvLoad clear if did.
<span style="color:black">SYSINIT:37E3
SYSINIT:37E3 </span><span style="color:gray">rfUM1</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:37E3                 </span><span style="color:navy">popf
</span><span style="color:black">SYSINIT:37E4                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:37E4 </span>RetFromUM       endp
<span style="color:black">SYSINIT:37E4
SYSINIT:37E5
SYSINIT:37E5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:37E5
SYSINIT:37E5
SYSINIT:37E5 </span>RemoveNull      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:37E5                 </span><span style="color:navy">mov     bl, es:[si]
</span><span style="color:black">SYSINIT:37E8                 </span><span style="color:navy">or      bl, bl          </span>; null ?
<span style="color:black">SYSINIT:37EA                 </span><span style="color:navy">jz      short </span><span style="color:gray">rn_gotnull
</span><span style="color:black">SYSINIT:37EC                 </span><span style="color:navy">inc     si              </span>; advance the pointer
<span style="color:black">SYSINIT:37ED                 </span><span style="color:navy">jmp     short </span>RemoveNull
<span style="color:black">SYSINIT:37EF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:37EF
SYSINIT:37EF </span><span style="color:gray">rn_gotnull</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:37EF                 </span><span style="color:navy">mov     bl, cs:</span>DevSavedDelim
<span style="color:black">SYSINIT:37F4                 </span><span style="color:navy">mov     es:[si], bl     </span>; replace null with blank
<span style="color:black">SYSINIT:37F7                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:37F7 </span>RemoveNull      endp
<span style="color:black">SYSINIT:37F7
SYSINIT:37F8
SYSINIT:37F8 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:37F8
SYSINIT:37F8
SYSINIT:37F8 </span>RoundBreakAddr  proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:37F8                 </span><span style="color:navy">mov     ax, word ptr cs:</span>DevBrkAddr ; Rounds DevBrkAddr to a para addr
<span style="color:black">SYSINIT:37F8                                         </span>; so that it is of the form xxxx:0
<span style="color:black">SYSINIT:37FC                 </span><span style="color:navy">call    </span>ParaRound
<span style="color:black">SYSINIT:37FF                 </span><span style="color:navy">add     word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:3804                 </span><span style="color:navy">mov     word ptr cs:</span>DevBrkAddr<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:380B                 </span><span style="color:navy">mov     ax, cs:</span>DevLoadEnd
<span style="color:black">SYSINIT:380F                 </span><span style="color:navy">cmp     word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:black">SYSINIT:3814                 </span><span style="color:navy">jbe     short </span><span style="color:gray">rba_ok
</span><span style="color:black">SYSINIT:3816                 </span><span style="color:navy">jmp     loc_8DE8
</span><span style="color:black">SYSINIT:3819 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3819
SYSINIT:3819 </span><span style="color:gray">rba_ok</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3819                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3819 </span>RoundBreakAddr  endp
<span style="color:black">SYSINIT:3819
SYSINIT:381A
SYSINIT:381A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:381A
SYSINIT:381A
SYSINIT:381A </span>DevSetBreak     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:381A                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:381B                 </span><span style="color:navy">mov     ax, word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2 </span>; remove the init code
<span style="color:black">SYSINIT:381F                 </span><span style="color:navy">cmp     cs:</span>multdeviceflag<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:3825                 </span><span style="color:navy">jnz     short </span><span style="color:gray">set_break_continue </span>; do not check it.
<span style="color:black">SYSINIT:3827                 </span><span style="color:navy">cmp     ax, cs:</span>DevLoadAddr
<span style="color:black">SYSINIT:382C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">set_break_continue </span>; if not same, then o.k.
<span style="color:black">SYSINIT:382E                 </span><span style="color:navy">cmp     word ptr cs:</span>DevBrkAddr<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:3834                 </span><span style="color:navy">jz      short </span><span style="color:gray">break_failed </span>; [DevBrkAddr+2]=[memhi] &amp; [DevBrkAddr]=0
<span style="color:black">SYSINIT:3836
SYSINIT:3836 </span><span style="color:gray">set_break_continue</span><span style="color:navy">:                     </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3836                 </span><span style="color:navy">call    </span>RoundBreakAddr
<span style="color:black">SYSINIT:3839                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:383A                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:383B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:383C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:383C
SYSINIT:383C </span><span style="color:gray">break_failed</span><span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:383C                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:383D                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:383E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:383E </span>DevSetBreak     endp
<span style="color:black">SYSINIT:383E
SYSINIT:383F
SYSINIT:383F </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:383F
SYSINIT:383F
SYSINIT:383F </span>DevBreak        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:383F                 </span><span style="color:navy">push    ds              </span>; Marks a succesful install of a device driver
<span style="color:black">SYSINIT:383F                                         </span>; Sets device size field in sub-arena &amp;
<span style="color:black">SYSINIT:383F                                         </span>; Updates Free ptr in UMB or adjusts memhi
<span style="color:black">SYSINIT:3840                 </span><span style="color:navy">mov     ax, cs:</span>DevLoadAddr
<span style="color:black">SYSINIT:3844                 </span><span style="color:navy">mov     bx, word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:black">SYSINIT:3849                 </span><span style="color:navy">dec     ax              </span>; seg of sub-arena
<span style="color:black">SYSINIT:384A                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:384C                 </span><span style="color:navy">inc     ax              </span>; Back to Device segment
<span style="color:black">SYSINIT:384D                 </span><span style="color:navy">sub     ax, bx
</span><span style="color:black">SYSINIT:384F                 </span><span style="color:navy">neg     ax              </span>; size of device in paras
<span style="color:black">SYSINIT:3851                 </span><span style="color:navy">mov     ds:</span><span style="color:green">3</span><span style="color:navy">, ax        </span>; [devmark.size]
<span style="color:black">SYSINIT:3851                                         </span>; store it in sub-arena
<span style="color:black">SYSINIT:3854                 </span><span style="color:navy">cmp     cs:</span>DeviceHi<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:385A                 </span><span style="color:navy">jz      short </span><span style="color:gray">db_lo
</span><span style="color:black">SYSINIT:385C                 </span><span style="color:navy">mov     cs:</span>DevUMBFree<span style="color:navy">, bx </span>; update Free ptr in UMB
<span style="color:black">SYSINIT:3861                 </span><span style="color:navy">jmp     short </span><span style="color:gray">db_exit
</span><span style="color:black">SYSINIT:3863 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3863
SYSINIT:3863 </span><span style="color:gray">db_lo</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3863                 </span><span style="color:navy">mov     cs:</span>memhi<span style="color:navy">, bx
</span><span style="color:black">SYSINIT:3868                 </span><span style="color:navy">mov     cs:</span>memlo<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:386F
SYSINIT:386F </span><span style="color:gray">db_exit</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:386F                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3870                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3870 </span>DevBreak        endp
<span style="color:black">SYSINIT:3870
SYSINIT:3871
SYSINIT:3871 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3871
SYSINIT:3871
SYSINIT:3871 </span>ParseSize       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3871                 </span><span style="color:navy">push    bx              </span>; Parses the command line for SIZE= command
<span style="color:black">SYSINIT:3872                 </span><span style="color:navy">mov     bx, si
</span><span style="color:black">SYSINIT:3874                 </span><span style="color:navy">mov     cs:</span>DevSizeOption<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; init the value
<span style="color:black">SYSINIT:387B                 </span><span style="color:navy">mov     word ptr cs:</span>DevCmdLine<span style="color:navy">, si
</span><span style="color:black">SYSINIT:3880                 </span><span style="color:navy">mov     word ptr cs:</span>DevCmdLine<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">SYSINIT:3885                 </span><span style="color:navy">call    </span>SkipDelim
<span style="color:black">SYSINIT:3888                 </span><span style="color:navy">cmp     word ptr es:[si], </span><span style="color:#ff8000">4953h </span>; &#039;SI&#039;
<span style="color:black">SYSINIT:388D                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ps_no_size
</span><span style="color:black">SYSINIT:388F                 </span><span style="color:navy">cmp     word ptr es:[si+</span><span style="color:#ff8000">2</span><span style="color:navy">], </span><span style="color:#ff8000">455Ah </span>; &#039;ZE&#039;
<span style="color:black">SYSINIT:3895                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ps_no_size
</span><span style="color:black">SYSINIT:3897                 </span><span style="color:navy">mov     al, es:[si+</span><span style="color:#ff8000">4</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:389B                 </span><span style="color:navy">call    loc_8D51
</span><span style="color:black">SYSINIT:389E                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ps_no_size </span>; cf=0 here
<span style="color:black">SYSINIT:38A0                 </span><span style="color:navy">add     si, </span><span style="color:#ff8000">5
</span><span style="color:black">SYSINIT:38A3                 </span><span style="color:navy">call    </span>GetHexNum
<span style="color:black">SYSINIT:38A6                 </span><span style="color:navy">jb      short </span><span style="color:gray">ps_err
</span><span style="color:black">SYSINIT:38A8                 </span><span style="color:navy">mov     cs:</span>DevSizeOption<span style="color:navy">, ax
</span><span style="color:black">SYSINIT:38AC                 </span><span style="color:navy">call    </span>SkipDelim
<span style="color:black">SYSINIT:38AF                 </span><span style="color:navy">mov     bx, si          </span>; cf=0 here
<span style="color:black">SYSINIT:38B1
SYSINIT:38B1 </span><span style="color:gray">ps_no_size</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:38B1                 </span><span style="color:navy">mov     si, bx
</span><span style="color:black">SYSINIT:38B3                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:38B4                 </span><span style="color:navy">clc                     </span>; cf=0 here (clc is not needed)
<span style="color:black">SYSINIT:38B4                                         </span>; 22/07/2023 - Erdogan Tan
<span style="color:black">SYSINIT:38B5                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:38B6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:38B6
SYSINIT:38B6 </span><span style="color:gray">ps_err</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:38B6                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:38B7                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:38B8                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:38B8 </span>ParseSize       endp
<span style="color:black">SYSINIT:38B8
SYSINIT:38B9
SYSINIT:38B9 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:38B9
SYSINIT:38B9
SYSINIT:38B9 </span>SkipDelim       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:38B9                 </span><span style="color:navy">mov     al, es:[si]     </span>; Skips delimiters in the string pointed to by ES:SI
<span style="color:black">SYSINIT:38B9                                         </span>; Returns ptr to first non-delimiter character in ES:SI
<span style="color:black">SYSINIT:38BC                 </span><span style="color:navy">call    loc_8D51
</span><span style="color:black">SYSINIT:38BF                 </span><span style="color:navy">jnz     short </span><span style="color:gray">sd_ret
</span><span style="color:black">SYSINIT:38C1                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:38C2                 </span><span style="color:navy">jmp     short </span>SkipDelim
<span style="color:black">SYSINIT:38C4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:38C4
SYSINIT:38C4 </span><span style="color:gray">sd_ret</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:38C4                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:38C4 </span>SkipDelim       endp
<span style="color:black">SYSINIT:38C4
SYSINIT:38C5
SYSINIT:38C5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:38C5
SYSINIT:38C5
SYSINIT:38C5 </span>GetHexNum       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:38C5                 </span><span style="color:navy">xor     ax, ax          </span>; Converts an ascii string
<span style="color:black">SYSINIT:38C5                                         </span>; terminated by a delimiter into binary.
<span style="color:black">SYSINIT:38C5                                         </span>; Assumes that the ES:SI
<span style="color:black">SYSINIT:38C5                                         </span>; points to a Hexadecimal string
<span style="color:black">SYSINIT:38C7                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">SYSINIT:38C9
SYSINIT:38C9 </span><span style="color:gray">ghn_next</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:38C9                 </span><span style="color:navy">mov     bl, es:[si]
</span><span style="color:black">SYSINIT:38CC                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">0Dh         </span>; cr
<span style="color:black">SYSINIT:38CF                 </span><span style="color:navy">jz      short </span><span style="color:gray">ghn_err
</span><span style="color:black">SYSINIT:38D1                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">0Ah         </span>; lf
<span style="color:black">SYSINIT:38D4                 </span><span style="color:navy">jz      short </span><span style="color:gray">ghn_err
</span><span style="color:black">SYSINIT:38D6                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:38D7                 </span><span style="color:navy">mov     al, bl
</span><span style="color:black">SYSINIT:38D9                 </span><span style="color:navy">call    loc_8D51
</span><span style="color:black">SYSINIT:38DC                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:38DD                 </span><span style="color:navy">jz      short </span><span style="color:gray">ghn_into_paras
</span><span style="color:black">SYSINIT:38DF                 </span><span style="color:navy">call    </span>GetNibble
<span style="color:black">SYSINIT:38E2                 </span><span style="color:navy">jb      short </span><span style="color:gray">ghn_err
</span><span style="color:black">SYSINIT:38E4                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">4
</span><span style="color:black">SYSINIT:38E7
SYSINIT:38E7 </span><span style="color:gray">ghn_shift1</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:38E7                 </span><span style="color:navy">shl     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:38E9                 </span><span style="color:navy">rcl     dx, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:38EB                 </span><span style="color:navy">loop    </span><span style="color:gray">ghn_shift1
</span><span style="color:black">SYSINIT:38ED                 </span><span style="color:navy">or      al, bl
</span><span style="color:black">SYSINIT:38EF                 </span><span style="color:navy">inc     si
</span><span style="color:black">SYSINIT:38F0                 </span><span style="color:navy">jmp     short </span><span style="color:gray">ghn_next
</span><span style="color:black">SYSINIT:38F2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:38F2
SYSINIT:38F2 </span><span style="color:gray">ghn_into_paras</span><span style="color:navy">:                         </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:38F2                 </span><span style="color:navy">add     ax, </span><span style="color:green">15
</span><span style="color:black">SYSINIT:38F5                 </span><span style="color:navy">adc     dx, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:38F8                 </span><span style="color:navy">test    dx, </span><span style="color:green">0FFF0h
</span><span style="color:black">SYSINIT:38FC                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ghn_err
</span><span style="color:black">SYSINIT:38FE                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">4
</span><span style="color:black">SYSINIT:3901
SYSINIT:3901 </span><span style="color:gray">ghn_shift2</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3901                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:3902                 </span><span style="color:navy">rcr     dx, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:3904                 </span><span style="color:navy">rcr     ax, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:3906                 </span><span style="color:navy">loop    </span><span style="color:gray">ghn_shift2
</span><span style="color:black">SYSINIT:3908                 </span><span style="color:navy">clc                     </span>; AX = number of paras equivalent to the
<span style="color:black">SYSINIT:3908                                         </span>; hex number of bytes specified
<span style="color:black">SYSINIT:3908                                         </span>; by the hexadecimal string.
<span style="color:black">SYSINIT:3909                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:390A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:390A
SYSINIT:390A </span><span style="color:gray">ghn_err</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:390A                 </span><span style="color:navy">stc                     </span>; encountered a non-hex character or crlf
<span style="color:black">SYSINIT:390B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:390B </span>GetHexNum       endp
<span style="color:black">SYSINIT:390B
SYSINIT:390C
SYSINIT:390C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:390C
SYSINIT:390C
SYSINIT:390C </span>GetNibble       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:390C                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;   </span>; Convert one nibble (hex digit) in BL into binary
<span style="color:black">SYSINIT:390F                 </span><span style="color:navy">jb      short </span><span style="color:gray">gnib_err
</span><span style="color:black">SYSINIT:3911                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">39h </span><span style="color:gray">; &#039;9&#039;
</span><span style="color:black">SYSINIT:3914                 </span><span style="color:navy">ja      short </span><span style="color:gray">is_it_hex
</span><span style="color:black">SYSINIT:3916                 </span><span style="color:navy">sub     bl, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:black">SYSINIT:3919                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:391A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:391A
SYSINIT:391A </span><span style="color:gray">is_it_hex</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:391A                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">41h </span><span style="color:gray">; &#039;A&#039;
</span><span style="color:black">SYSINIT:391D                 </span><span style="color:navy">jb      short </span><span style="color:gray">gnib_err
</span><span style="color:black">SYSINIT:391F                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">46h </span><span style="color:gray">; &#039;F&#039;
</span><span style="color:black">SYSINIT:3922                 </span><span style="color:navy">ja      short </span><span style="color:gray">gnib_err
</span><span style="color:black">SYSINIT:3924                 </span><span style="color:navy">sub     bl, </span><span style="color:#ff8000">37h </span><span style="color:gray">; &#039;7&#039;
</span><span style="color:black">SYSINIT:3927                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3928 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3928
SYSINIT:3928 </span><span style="color:gray">gnib_err</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3928                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3929                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3929 </span>GetNibble       endp
<span style="color:black">SYSINIT:3929
SYSINIT:392A
SYSINIT:392A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:392A
SYSINIT:392A
SYSINIT:392A </span>AllocUMB        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:392A                 </span><span style="color:navy">call    </span>InitAllocUMB    ; Allocate all UMBs and link it to DOS arena chain
<span style="color:black">SYSINIT:392A                                         </span>; link in the first UMB
<span style="color:black">SYSINIT:392D                 </span><span style="color:navy">jb      short </span><span style="color:gray">au_exit   </span>; quit on error
<span style="color:black">SYSINIT:392F
SYSINIT:392F </span><span style="color:gray">au_next</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:392F                 </span><span style="color:navy">call    </span>umb_allocate    ; allocate
<span style="color:black">SYSINIT:3932                 </span><span style="color:navy">jb      short </span><span style="color:gray">au_coalesce
</span><span style="color:black">SYSINIT:3934                 </span><span style="color:navy">call    </span>umb_insert      ; &amp; insert till no UMBs
<span style="color:black">SYSINIT:3937                 </span><span style="color:navy">jmp     short </span><span style="color:gray">au_next
</span><span style="color:black">SYSINIT:3939 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3939
SYSINIT:3939 </span><span style="color:gray">au_coalesce</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3939                 </span><span style="color:navy">call    </span>umb_coalesce    ; coalesce all UMBs
<span style="color:black">SYSINIT:393C
SYSINIT:393C </span><span style="color:gray">au_exit</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:393C                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:393C </span>AllocUMB        endp
<span style="color:black">SYSINIT:393C
SYSINIT:393D
SYSINIT:393D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:393D
SYSINIT:393D
SYSINIT:393D </span>InitAllocUMB    proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:393D                 </span><span style="color:navy">call    </span>IsXMSLoaded
<span style="color:black">SYSINIT:3940                 </span><span style="color:navy">jnz     short </span><span style="color:gray">iau_err   </span>; quit on no XMS driver
<span style="color:black">SYSINIT:3942                 </span><span style="color:navy">mov     ah, </span><span style="color:green">52h
</span><span style="color:black">SYSINIT:3944                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ internal - GET LIST OF LISTS
<span style="color:black">SYSINIT:3944                                         </span>; Return: ES:BX -&gt; DOS list of lists
<span style="color:black">SYSINIT:3946                 </span><span style="color:navy">mov     cs:</span>DevDOSData<span style="color:navy">, es </span>; save dos data segment
<span style="color:black">SYSINIT:394B                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4310h
</span><span style="color:black">SYSINIT:394E                 </span><span style="color:navy">int     </span><span style="color:green">2Fh             </span>; - Multiplex - XMS - GET DRIVER ADDRESS
<span style="color:black">SYSINIT:394E                                         </span>; Return: ES:BX -&gt; driver entry point
<span style="color:black">SYSINIT:3950                 </span><span style="color:navy">mov     word ptr cs:</span>DevXMSAddr<span style="color:navy">, bx </span>; get XMS driver address
<span style="color:black">SYSINIT:3955                 </span><span style="color:navy">mov     word ptr cs:</span>DevXMSAddr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:black">SYSINIT:395A                 </span><span style="color:navy">cmp     cs:</span>FirstUMBLinked<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; have we already linked a UMB?
<span style="color:black">SYSINIT:3960                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ia_1      </span>; quit if we already did it
<span style="color:black">SYSINIT:3962                 </span><span style="color:navy">call    </span>LinkFirstUMB    ; else link the first UMB
<span style="color:black">SYSINIT:3965                 </span><span style="color:navy">jb      short </span><span style="color:gray">iau_err
</span><span style="color:black">SYSINIT:3967                 </span><span style="color:navy">mov     cs:</span>FirstUMBLinked<span style="color:navy">, </span><span style="color:#ff8000">0FFh </span>; mark that 1st UMB linked
<span style="color:black">SYSINIT:396D
SYSINIT:396D </span><span style="color:gray">ia_1</span><span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:396D                 </span><span style="color:navy">clc                     </span>; (cf is already zero here)
<span style="color:black">SYSINIT:396D                                         </span>; Erdogan tan - 27/07/2023
<span style="color:black">SYSINIT:396E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:396F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:396F
SYSINIT:396F </span><span style="color:gray">iau_err</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:396F                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3970                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3970 </span>InitAllocUMB    endp
<span style="color:black">SYSINIT:3970
SYSINIT:3971
SYSINIT:3971 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3971
SYSINIT:3971
SYSINIT:3971 </span>umb_allocate    proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3971                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:3972                 </span><span style="color:navy">mov     ah, </span><span style="color:green">16          </span>; XMM_REQUEST_UMB
<span style="color:black">SYSINIT:3974                 </span><span style="color:navy">mov     dx, </span><span style="color:green">0FFFFh      </span>; try to allocate largest possible
<span style="color:black">SYSINIT:3977                 </span><span style="color:navy">call    cs:</span>DevXMSAddr
<span style="color:black">SYSINIT:397C                 </span><span style="color:navy">or      dx, dx
</span><span style="color:black">SYSINIT:397E                 </span><span style="color:navy">jz      short </span><span style="color:gray">ua_err
</span><span style="color:black">SYSINIT:3980                 </span><span style="color:navy">mov     ah, </span><span style="color:green">16
</span><span style="color:black">SYSINIT:3982                 </span><span style="color:navy">call    cs:</span>DevXMSAddr
<span style="color:black">SYSINIT:3987                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">1           </span>; Q: was the reqst successful
<span style="color:black">SYSINIT:398A                 </span><span style="color:navy">jnz     short </span><span style="color:gray">ua_err    </span>; N: error
<span style="color:black">SYSINIT:398C                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:398D
SYSINIT:398D </span><span style="color:gray">ua_done</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:398D                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:398E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:398F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:398F
SYSINIT:398F </span><span style="color:gray">ua_err</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:398F                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3990                 </span><span style="color:navy">jmp     short </span><span style="color:gray">ua_done
</span><span style="color:black">SYSINIT:3990 </span>umb_allocate    endp
<span style="color:black">SYSINIT:3990
SYSINIT:3992
SYSINIT:3992 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3992
SYSINIT:3992
SYSINIT:3992 </span>umb_insert      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3992                 </span><span style="color:navy">push    ds              </span>; links the UMB into the arena chain
<span style="color:black">SYSINIT:3993                 </span><span style="color:navy">mov     ds, cs:</span>DevDOSData
<span style="color:black">SYSINIT:3998                 </span><span style="color:navy">mov     ds, word ptr ds:</span><span style="color:green">8Ch </span>; [UMB_ARENA]  ; ds = UMB_HEAD
<span style="color:black">SYSINIT:399C                 </span><span style="color:navy">mov     ax, ds
</span><span style="color:black">SYSINIT:399E                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:39A0                 </span>assume es:nothing
<span style="color:black">SYSINIT:39A0
SYSINIT:39A0 </span><span style="color:gray">ui_next</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:39A0                 </span><span style="color:navy">cmp     ax, bx          </span>; BX = seg address of UMB to be linked in
<span style="color:black">SYSINIT:39A2                 </span><span style="color:navy">ja      short </span><span style="color:gray">ui_insert </span>; current block above new block, insert it
<span style="color:black">SYSINIT:39A4                 </span><span style="color:navy">cmp     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039; </span>; [es:ARENA.SIGNATURE],arena_signature_end
<span style="color:black">SYSINIT:39AA                 </span><span style="color:navy">jz      short </span><span style="color:gray">ui_append </span>; if current block is the last,
<span style="color:black">SYSINIT:39AA                                         </span>; append new block to chain
<span style="color:black">SYSINIT:39AC                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:39AE                 </span><span style="color:navy">call    </span>get_next
<span style="color:black">SYSINIT:39B1                 </span><span style="color:navy">jmp     short </span><span style="color:gray">ui_next   </span>; ax = es = next block
<span style="color:black">SYSINIT:39B3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:39B3
SYSINIT:39B3 </span><span style="color:gray">ui_insert</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:39B3                 </span><span style="color:navy">mov     cx, ds          </span>; ds = previous arena
<span style="color:black">SYSINIT:39B5                 </span><span style="color:navy">inc     cx              </span>; top of previous block
<span style="color:black">SYSINIT:39B6                 </span><span style="color:navy">sub     cx, bx
</span><span style="color:black">SYSINIT:39B8                 </span><span style="color:navy">neg     cx              </span>; cx = size of used block
<span style="color:black">SYSINIT:39BA                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">4Dh </span><span style="color:gray">; &#039;M&#039; </span>; [ARENA.SIGNATURE],arena_signature_normal
<span style="color:black">SYSINIT:39BF                 </span><span style="color:navy">mov     word ptr ds:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [ARENA.OWNER],8 ; mark as system owned
<span style="color:black">SYSINIT:39C5                 </span><span style="color:navy">mov     ds:</span><span style="color:green">3</span><span style="color:navy">, cx        </span>; [ARENA.SIZE],cx
<span style="color:black">SYSINIT:39C9                 </span><span style="color:navy">mov     word ptr ds:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">4353h </span>; [ARENA.NAME],&#039;SC&#039;
<span style="color:black">SYSINIT:39CF                 </span><span style="color:navy">mov     es, bx          </span>; prepare the arena at start of new block
<span style="color:black">SYSINIT:39D1                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">4Dh </span><span style="color:gray">; &#039;M&#039; </span>; [es:ARENA.SIGNATURE],arena_signature_normal
<span style="color:black">SYSINIT:39D7                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; [es:ARENA.OWNER],arena_owner_system ; mark as free
<span style="color:black">SYSINIT:39DE                 </span><span style="color:navy">sub     dx, </span><span style="color:#ff8000">2           </span>; DX = size of UMB to be linked in paras
<span style="color:black">SYSINIT:39DE                                         </span>; make room for arena at start &amp; end of new block
<span style="color:black">SYSINIT:39E1                 </span><span style="color:navy">mov     es:</span><span style="color:green">3</span><span style="color:navy">, dx        </span>; [es:ARENA.SIZE],dx
<span style="color:black">SYSINIT:39E6                 </span><span style="color:navy">add     bx, dx          </span>; prepare arena at end of new block
<span style="color:black">SYSINIT:39E8                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:39E9                 </span><span style="color:navy">mov     es, bx          </span>; es = arena at top of new block
<span style="color:black">SYSINIT:39EB                 </span><span style="color:navy">inc     bx              </span>; bx = top of new block
<span style="color:black">SYSINIT:39EC                 </span><span style="color:navy">sub     ax, bx          </span>; ax contains arena just above this block
<span style="color:black">SYSINIT:39EC                                         </span>; result: ax = size of used block
<span style="color:black">SYSINIT:39EE                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">4Dh </span><span style="color:gray">; &#039;M&#039; </span>; [es:ARENA.SIGNATURE],arena_signature_normal
<span style="color:black">SYSINIT:39F4                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:ARENA.OWNER],8 ; mark as system owned
<span style="color:black">SYSINIT:39FB                 </span><span style="color:navy">mov     es:</span><span style="color:green">3</span><span style="color:navy">, ax        </span>; [es:ARENA.SIZE],ax
<span style="color:black">SYSINIT:39FF                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">4353h </span>; [es:ARENA.NAME],&#039;SC&#039;
<span style="color:black">SYSINIT:3A06                 </span><span style="color:navy">jmp     short </span><span style="color:gray">ui_done
</span><span style="color:black">SYSINIT:3A08 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3A08
SYSINIT:3A08 </span><span style="color:gray">ui_append</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3A08                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; es = arena of last block
<span style="color:black">SYSINIT:3A08                                         </span>; [es:ARENA.SIZE] ; ax=top of last block-1 para
<span style="color:black">SYSINIT:3A0D                 </span><span style="color:navy">sub     word ptr es:</span><span style="color:green">3</span><span style="color:navy">, </span><span style="color:#ff8000">1 </span>; reserve space on top of this
<span style="color:black">SYSINIT:3A0D                                         </span>; block for the next arena.
<span style="color:black">SYSINIT:3A13                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">4Dh </span><span style="color:gray">; &#039;M&#039; </span>; [es:ARENA.SIGNATURE],arena_signature_normal
<span style="color:black">SYSINIT:3A19                 </span><span style="color:navy">mov     cx, ax          </span>; cx = top of prev block-1
<span style="color:black">SYSINIT:3A1B                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:3A1C                 </span><span style="color:navy">sub     ax, bx          </span>; ax = top of prev block - seg. addr of new block
<span style="color:black">SYSINIT:3A1E                 </span><span style="color:navy">neg     ax
</span><span style="color:black">SYSINIT:3A20                 </span><span style="color:navy">mov     es, cx          </span>; ds = arena of unused block
<span style="color:black">SYSINIT:3A22                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">4Dh </span><span style="color:gray">; &#039;M&#039; </span>; [es:ARENA.SIGNATURE],arena_signature_normal
<span style="color:black">SYSINIT:3A28                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:ARENA.OWNER],8 ; mark as system owned
<span style="color:black">SYSINIT:3A2F                 </span><span style="color:navy">mov     es:</span><span style="color:green">3</span><span style="color:navy">, ax        </span>; mov [es:ARENA.SIZE],ax
<span style="color:black">SYSINIT:3A33                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">4353h </span>; mov word [es:ARENA.NAME],&#039;SC&#039;
<span style="color:black">SYSINIT:3A3A                 </span><span style="color:navy">mov     es, bx          </span>; prepare the arena at start of new block
<span style="color:black">SYSINIT:3A3C                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039; </span>; [es:ARENA.SIGNATURE],arena_signature_end
<span style="color:black">SYSINIT:3A42                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; [es:ARENA.OWNER],arena_owner_system
<span style="color:black">SYSINIT:3A42                                         </span>; mark as free
<span style="color:black">SYSINIT:3A49                 </span><span style="color:navy">dec     dx              </span>; make room for arena
<span style="color:black">SYSINIT:3A4A                 </span><span style="color:navy">mov     es:</span><span style="color:green">3</span><span style="color:navy">, dx        </span>; mov [es:ARENA.SIZE],dx
<span style="color:black">SYSINIT:3A4F
SYSINIT:3A4F </span><span style="color:gray">ui_done</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3A4F                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3A50                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3A50 </span>umb_insert      endp
<span style="color:black">SYSINIT:3A50
SYSINIT:3A51
SYSINIT:3A51 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3A51
SYSINIT:3A51
SYSINIT:3A51 </span>umb_coalesce    proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3A51                 </span><span style="color:navy">xor     di, di          </span>; Combine free blocks ahead with current block
<span style="color:black">SYSINIT:3A53                 </span><span style="color:navy">mov     es, cs:</span>DevDOSData
<span style="color:black">SYSINIT:3A58                 </span><span style="color:navy">mov     es, word ptr es:</span><span style="color:green">8Ch </span>; [es:UMB_ARENA] ; es = UMB_HEAD
<span style="color:black">SYSINIT:3A5D
SYSINIT:3A5D </span><span style="color:gray">uc_nextfree</span><span style="color:navy">:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3A5D                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:3A5F                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:3A61                 </span><span style="color:navy">cmp     es:</span><span style="color:green">1</span><span style="color:navy">, di        </span>; [es:ARENA.OWNER],di
<span style="color:black">SYSINIT:3A61                                         </span>; Q: is current arena free
<span style="color:black">SYSINIT:3A66                 </span><span style="color:navy">jz      short </span><span style="color:gray">uc_again  </span>; Y: try to coalesce with next block
<span style="color:black">SYSINIT:3A66                                         </span>; N: get next arena
<span style="color:black">SYSINIT:3A68                 </span><span style="color:navy">call    </span>get_next        ; es, ax = next arena
<span style="color:black">SYSINIT:3A6B                 </span><span style="color:navy">jb      short </span><span style="color:gray">uc_done
</span><span style="color:black">SYSINIT:3A6D                 </span><span style="color:navy">jmp     short </span><span style="color:gray">uc_nextfree
</span><span style="color:black">SYSINIT:3A6F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3A6F
SYSINIT:3A6F </span><span style="color:gray">uc_again</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3A6F                 </span><span style="color:navy">call    </span>get_next        ; es, ax = next arena
<span style="color:black">SYSINIT:3A72                 </span><span style="color:navy">jb      short </span><span style="color:gray">uc_done
</span><span style="color:black">SYSINIT:3A74                 </span><span style="color:navy">cmp     es:</span><span style="color:green">1</span><span style="color:navy">, di        </span>; [es:ARENA.OWNER],di
<span style="color:black">SYSINIT:3A74                                         </span>; Q: is arena free
<span style="color:black">SYSINIT:3A79                 </span><span style="color:navy">jnz     short </span><span style="color:gray">uc_nextfree </span>; N: get next free arena
<span style="color:black">SYSINIT:3A79                                         </span>; Y: coalesce
<span style="color:black">SYSINIT:3A7B                 </span><span style="color:navy">mov     cx, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:3A7B                                         </span>; cx = next block size
<span style="color:black">SYSINIT:3A80                 </span><span style="color:navy">inc     cx              </span>; cx = cx + 1 (for header size)
<span style="color:black">SYSINIT:3A81                 </span><span style="color:navy">add     ds:</span><span style="color:green">3</span><span style="color:navy">, cx        </span>; [ARENA.SIZE],cx
<span style="color:black">SYSINIT:3A81                                         </span>; current size = current size + cx
<span style="color:black">SYSINIT:3A85                 </span><span style="color:navy">mov     cl, es:[di]     </span>; move up signature
<span style="color:black">SYSINIT:3A88                 </span><span style="color:navy">mov     [di], cl
</span><span style="color:black">SYSINIT:3A8A                 </span><span style="color:navy">jmp     short </span><span style="color:gray">uc_again  </span>; try again
<span style="color:black">SYSINIT:3A8C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3A8C
SYSINIT:3A8C </span><span style="color:gray">uc_done</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3A8C                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3A8C </span>umb_coalesce    endp
<span style="color:black">SYSINIT:3A8C
SYSINIT:3A8D
SYSINIT:3A8D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3A8D
SYSINIT:3A8D
SYSINIT:3A8D </span>get_next        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3A8D                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039; </span>; Find Next item in Arena
<span style="color:black">SYSINIT:3A8D                                         </span>; cmp byte [ARENA.SIGNATURE],arena_signature_end
<span style="color:black">SYSINIT:3A92                 </span><span style="color:navy">jz      short </span><span style="color:gray">gn_err
</span><span style="color:black">SYSINIT:3A94                 </span><span style="color:navy">mov     ax, ds          </span>; ax = current block
<span style="color:black">SYSINIT:3A96                 </span><span style="color:navy">add     ax, ds:</span><span style="color:green">3        </span>; add ax,[ARENA.SIZE]
<span style="color:black">SYSINIT:3A96                                         </span>; ax = ax + current block length
<span style="color:black">SYSINIT:3A9A                 </span><span style="color:navy">inc     ax              </span>; remember that header!
<span style="color:black">SYSINIT:3A9B                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:3A9D                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:3A9E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3A9F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3A9F
SYSINIT:3A9F </span><span style="color:gray">gn_err</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3A9F                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3AA0                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3AA0 </span>get_next        endp
<span style="color:black">SYSINIT:3AA0
SYSINIT:3AA1
SYSINIT:3AA1 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3AA1
SYSINIT:3AA1
SYSINIT:3AA1 </span>LinkFirstUMB    proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3AA1                 </span><span style="color:navy">call    </span>umb_allocate
<span style="color:black">SYSINIT:3AA4                 </span><span style="color:navy">jb      short </span><span style="color:gray">lfu_er
</span><span style="color:black">SYSINIT:3AA6                 </span><span style="color:navy">int     </span><span style="color:green">12h             </span>; MEMORY SIZE -
<span style="color:black">SYSINIT:3AA6                                         </span>; Return: AX = number of contiguous 1K blocks of memory
<span style="color:black">SYSINIT:3AA8                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">6
</span><span style="color:black">SYSINIT:3AAA                 </span><span style="color:navy">shl     ax, cl          </span>; ax = size in paragraphs
<span style="color:black">SYSINIT:3AAC                 </span><span style="color:navy">mov     cx, ax
</span><span style="color:black">SYSINIT:3AAE                 </span><span style="color:navy">sub     ax, bx          </span>; bx = segment of allocated UMB
<span style="color:black">SYSINIT:3AAE                                         </span>; ax = - size of unused block
<span style="color:black">SYSINIT:3AB0                 </span><span style="color:navy">neg     ax
</span><span style="color:black">SYSINIT:3AB2                 </span><span style="color:navy">sub     cx, </span><span style="color:#ff8000">1           </span>; cx = first umb_arena
<span style="color:black">SYSINIT:3AB5                 </span><span style="color:navy">mov     es, cx          </span>; es = first umb_arena
<span style="color:black">SYSINIT:3AB7                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">4Dh </span><span style="color:gray">; &#039;M&#039; </span>; [es:ARENA.SIGNATURE],arena_signature_normal
<span style="color:black">SYSINIT:3ABD                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:ARENA.OWNER],8 ; mark as system owned
<span style="color:black">SYSINIT:3AC4                 </span><span style="color:navy">mov     es:</span><span style="color:green">3</span><span style="color:navy">, ax        </span>; mov [es:ARENA.SIZE],ax
<span style="color:black">SYSINIT:3AC8                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">8</span><span style="color:navy">, </span><span style="color:#ff8000">4353h </span>; [es:ARENA.NAME],&#039;SC&#039;
<span style="color:black">SYSINIT:3ACF                 </span><span style="color:navy">mov     es, bx          </span>; put in the arena for the first UMB
<span style="color:black">SYSINIT:3ACF                                         </span>; es has first free umb seg
<span style="color:black">SYSINIT:3AD1                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039; </span>; [es:ARENA.SIGNATURE],arena_signature_end
<span style="color:black">SYSINIT:3AD7                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; es:ARENA.OWNER],arena_owner_system
<span style="color:black">SYSINIT:3AD7                                         </span>; mark as free
<span style="color:black">SYSINIT:3ADE                 </span><span style="color:navy">dec     dx              </span>; dx = size of UMB
<span style="color:black">SYSINIT:3ADE                                         </span>; make room for arena
<span style="color:black">SYSINIT:3ADF                 </span><span style="color:navy">mov     es:</span><span style="color:green">3</span><span style="color:navy">, dx        </span>; [es:ARENA.SIZE],dx
<span style="color:black">SYSINIT:3AE4                 </span><span style="color:navy">mov     es, cs:</span>DevDOSData
<span style="color:black">SYSINIT:3AE9                 </span><span style="color:navy">mov     di, </span><span style="color:green">8Ch         </span>; UMB_ARENA
<span style="color:black">SYSINIT:3AEC                 </span><span style="color:navy">mov     es:[di], cx     </span>; initialize umb_head in DOS data segment
<span style="color:black">SYSINIT:3AEC                                         </span>; with the arena just below Top of Memory
<span style="color:black">SYSINIT:3AEC                                         </span>;
<span style="color:black">SYSINIT:3AEC                                         </span>; we must now scan the arena chain and
<span style="color:black">SYSINIT:3AEC                                         </span>; update the size of the last arena
<span style="color:black">SYSINIT:3AEF                 </span><span style="color:navy">mov     di, </span><span style="color:green">24h         </span>; DOS_ARENA
<span style="color:black">SYSINIT:3AF2                 </span><span style="color:navy">mov     es, word ptr es:[di] </span>; es = start arena
<span style="color:black">SYSINIT:3AF5                 </span><span style="color:navy">xor     di, di
</span><span style="color:black">SYSINIT:3AF7
SYSINIT:3AF7 </span><span style="color:gray">scannext</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3AF7                 </span><span style="color:navy">cmp     byte ptr es:[di], </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039; </span>; arena_signature_end
<span style="color:black">SYSINIT:3AFB                 </span><span style="color:navy">jz      short </span><span style="color:gray">got_last
</span><span style="color:black">SYSINIT:3AFD                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:3AFF                 </span><span style="color:navy">add     ax, es:</span><span style="color:green">3        </span>; [es:ARENA.SIZE]
<span style="color:black">SYSINIT:3B04                 </span><span style="color:navy">inc     ax
</span><span style="color:black">SYSINIT:3B05                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:3B07                 </span><span style="color:navy">jmp     short </span><span style="color:gray">scannext
</span><span style="color:black">SYSINIT:3B09 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3B09
SYSINIT:3B09 </span><span style="color:gray">got_last</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3B09                 </span><span style="color:navy">sub     word ptr es:</span><span style="color:green">3</span><span style="color:navy">, </span><span style="color:#ff8000">1 </span>; sub word [es:ARENA.SIZE],1
<span style="color:black">SYSINIT:3B0F                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">4Dh </span><span style="color:gray">; &#039;M&#039; </span>; [es:ARENA.SIGNATURE],arena_signature_normal
<span style="color:black">SYSINIT:3B15                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:3B16                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3B17 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3B17
SYSINIT:3B17 </span><span style="color:gray">lfu_er</span><span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3B17                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3B18                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3B18 </span>LinkFirstUMB    endp
<span style="color:black">SYSINIT:3B18
SYSINIT:3B19
SYSINIT:3B19 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3B19
SYSINIT:3B19
SYSINIT:3B19 </span>ShrinkUMB       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3B19                 </span><span style="color:navy">cmp     cs:</span>DevUMBAddr<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; Shrinks the current UMB in use,
<span style="color:black">SYSINIT:3B19                                         </span>; so that the unused portions of the UMB
<span style="color:black">SYSINIT:3B19                                         </span>; is given back to the DOS free mem pool
<span style="color:black">SYSINIT:3B1F                 </span><span style="color:navy">jz      short </span><span style="color:gray">su_exit
</span><span style="color:black">SYSINIT:3B21                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3B22                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:3B23                 </span><span style="color:navy">mov     bx, cs:</span>DevUMBFree
<span style="color:black">SYSINIT:3B28                 </span><span style="color:navy">sub     bx, cs:</span>DevUMBAddr
<span style="color:black">SYSINIT:3B2D                 </span><span style="color:navy">mov     es, cs:</span>DevUMBAddr
<span style="color:black">SYSINIT:3B32                 </span><span style="color:navy">mov     ax, </span><span style="color:green">4A00h
</span><span style="color:black">SYSINIT:3B35                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - ADJUST MEMORY BLOCK SIZE (SETBLOCK)
<span style="color:black">SYSINIT:3B35                                         </span>; ES = segment address of block to change
<span style="color:black">SYSINIT:3B35                                         </span>; BX = new size in paragraphs
<span style="color:black">SYSINIT:3B37                 </span><span style="color:navy">mov     ax, es
</span><span style="color:black">SYSINIT:3B39                 </span><span style="color:navy">dec     ax
</span><span style="color:black">SYSINIT:3B3A                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">SYSINIT:3B3C                 </span>assume es:nothing
<span style="color:black">SYSINIT:3B3C                 </span><span style="color:navy">mov     word ptr es:</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; [es:ARENA.OWNER]
<span style="color:black">SYSINIT:3B43                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:3B44                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3B45                 </span>assume es:nothing
<span style="color:black">SYSINIT:3B45
SYSINIT:3B45 </span><span style="color:gray">su_exit</span><span style="color:navy">:                                </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3B45                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3B45 </span>ShrinkUMB       endp
<span style="color:black">SYSINIT:3B45
SYSINIT:3B46
SYSINIT:3B46 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3B46
SYSINIT:3B46
SYSINIT:3B46 </span>UnlinkUMB       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3B46                 </span><span style="color:navy">push    ds              </span>; Unlinks the UMBs from the DOS arena chain
<span style="color:black">SYSINIT:3B47                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:3B48                 </span><span style="color:navy">cmp     cs:</span>FirstUMBLinked<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:3B4E                 </span><span style="color:navy">jz      short </span><span style="color:gray">ulu_x     </span>; nothing to unlink
<span style="color:black">SYSINIT:3B50                 </span><span style="color:navy">mov     es, cs:</span>DevDOSData ; get DOS data seg
<span style="color:black">SYSINIT:3B55                 </span><span style="color:navy">mov     ds, word ptr es:</span><span style="color:green">24h </span>; [es:DOS_ARENA]
<span style="color:black">SYSINIT:3B5A                 </span><span style="color:navy">mov     di, es:</span><span style="color:green">8Ch      </span>; [es:UMB_ARENA]
<span style="color:black">SYSINIT:3B5F
SYSINIT:3B5F </span><span style="color:gray">ulu_next</span><span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3B5F                 </span><span style="color:navy">call    </span>get_next
<span style="color:black">SYSINIT:3B62                 </span><span style="color:navy">jb      short </span><span style="color:gray">ulu_x
</span><span style="color:black">SYSINIT:3B64                 </span><span style="color:navy">cmp     di, ax          </span>; is the next one UMB ?
<span style="color:black">SYSINIT:3B66                 </span><span style="color:navy">jz      short </span><span style="color:gray">ulu_found
</span><span style="color:black">SYSINIT:3B68                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">SYSINIT:3B6A                 </span><span style="color:navy">jmp     short </span><span style="color:gray">ulu_next
</span><span style="color:black">SYSINIT:3B6C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3B6C
SYSINIT:3B6C </span><span style="color:gray">ulu_found</span><span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3B6C                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039; </span>; [ARENA.SIGNATURE],arena_signature_end
<span style="color:black">SYSINIT:3B71
SYSINIT:3B71 </span><span style="color:gray">ulu_x</span><span style="color:navy">:                                  </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3B71                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:3B72                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3B73                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3B73 </span>UnlinkUMB       endp
<span style="color:black">SYSINIT:3B73
SYSINIT:3B73 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:3B74 </span>MagicDDName     <span style="color:navy">db &#039;C:\DBLSPACE.BIN&#039;,0  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:3B84 </span>MagicDRVName    <span style="color:navy">db &#039;C:\DRVSPACE.BIN&#039;,0  </span><span style="color:olive">; ...
</span><span style="color:gray">SYSINIT:3B94 </span>MagicDRVini     <span style="color:navy">db &#039;C:\DRVSPACE.INI&#039;,0  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:3B94                                         </span>; pass the command line to the device
<span style="color:gray">SYSINIT:3BA4 </span><span style="color:navy">word_7BD4       dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:3BA6 </span><span style="color:navy">word_7BD6       dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:3BA8 </span><span style="color:navy">word_7BD8       dw </span><span style="color:#008040">0Ah                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:3BA8                                         </span>; normalize memhi:memlo (first free memory)
<span style="color:maroon">SYSINIT:3BAA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3BAA
SYSINIT:3BAA </span><span style="color:navy">loc_7BDA:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3BAA                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">SYSINIT:3BAB                 </span><span style="color:navy">mov     cs:</span>DeviceHi<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:3BB1                 </span><span style="color:navy">mov     cs:</span>DevSizeOption<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:3BB8                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:3BB9                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:3BBA                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">3B86h
</span><span style="color:maroon">SYSINIT:3BBD                 </span><span style="color:navy">mov     ax, </span><span style="color:green">3D00h
</span><span style="color:maroon">SYSINIT:3BC0                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - OPEN DISK FILE WITH HANDLE
<span style="color:maroon">SYSINIT:3BC0                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:maroon">SYSINIT:3BC0                                         </span>; AL = access mode
<span style="color:maroon">SYSINIT:3BC0                                         </span>; 0 - read
<span style="color:maroon">SYSINIT:3BC2                 </span><span style="color:navy">jb      short loc_7C53  </span>; calculate seg after DD load
<span style="color:maroon">SYSINIT:3BC4                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:maroon">SYSINIT:3BC6                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:maroon">SYSINIT:3BC8                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CLOSE A FILE WITH HANDLE
<span style="color:maroon">SYSINIT:3BC8                                         </span>; BX = file handle
<span style="color:maroon">SYSINIT:3BCA                 </span><span style="color:navy">mov     dx, (offset </span>MagicDRVini<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:3BCD                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">3D00h
</span><span style="color:maroon">SYSINIT:3BD0                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; SYSPRE_MEMORY_ERROR
<span style="color:maroon">SYSINIT:3BD2                 </span><span style="color:navy">jb      short loc_7C0F
</span><span style="color:maroon">SYSINIT:3BD4                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:maroon">SYSINIT:3BD6                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh         </span>; get the load file name
<span style="color:maroon">SYSINIT:3BD8                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS -
<span style="color:maroon">SYSINIT:3BDA                 </span><span style="color:navy">mov     si, (offset </span>MagicDRVName<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:3BDD                 </span><span style="color:navy">jmp     short loc_7C56
</span><span style="color:maroon">SYSINIT:3BDF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3BDF
SYSINIT:3BDF </span><span style="color:navy">loc_7C0F:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3BDF                 </span><span style="color:navy">mov     dx, offset </span>MagicDRVini <span style="color:gray">; &quot;C:\\DRVSPACE.INI&quot;
</span><span style="color:maroon">SYSINIT:3BE2                 </span><span style="color:navy">mov     ax, </span><span style="color:green">3D00h
</span><span style="color:maroon">SYSINIT:3BE5                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - OPEN DISK FILE WITH HANDLE
<span style="color:maroon">SYSINIT:3BE5                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:maroon">SYSINIT:3BE5                                         </span>; AL = access mode
<span style="color:maroon">SYSINIT:3BE5                                         </span>; 0 - read
<span style="color:maroon">SYSINIT:3BE7                 </span><span style="color:navy">jb      short loc_7C24
</span><span style="color:maroon">SYSINIT:3BE9                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:maroon">SYSINIT:3BEB                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:maroon">SYSINIT:3BED                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CLOSE A FILE WITH HANDLE
<span style="color:maroon">SYSINIT:3BED                                         </span>; BX = file handle
<span style="color:maroon">SYSINIT:3BEF                 </span><span style="color:navy">mov     si, (offset </span>MagicDRVName<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:3BF2                 </span><span style="color:navy">jmp     short loc_7C56  </span>; point to the Magic DD header
<span style="color:maroon">SYSINIT:3BF4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3BF4
SYSINIT:3BF4 </span><span style="color:navy">loc_7C24:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3BF4                 </span><span style="color:navy">mov     dx, (offset </span>MagicDDName<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:3BF7                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:3BF7                 </span><span style="color:navy">mov     ax, </span><span style="color:green">3D00h       </span>; &#039;.,&#039; ; is it our stamp?
<span style="color:maroon">SYSINIT:3BF7                                         </span>; (&#039;,.&#039; in NASM syntax)
<span style="color:maroon">SYSINIT:3BFA                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - OPEN DISK FILE WITH HANDLE
<span style="color:maroon">SYSINIT:3BFA                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:maroon">SYSINIT:3BFA                                         </span>; AL = access mode
<span style="color:maroon">SYSINIT:3BFA                                         </span>; 0 - read
<span style="color:maroon">SYSINIT:3BFC                 </span><span style="color:navy">jb      short loc_7C39
</span><span style="color:maroon">SYSINIT:3BFE                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:maroon">SYSINIT:3C00                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:maroon">SYSINIT:3C02                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; save the backdoor entry
<span style="color:maroon">SYSINIT:3C04                 </span><span style="color:navy">mov     si, (offset </span>MagicDDName<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:3C07                 </span><span style="color:navy">jmp     short loc_7C56
</span><span style="color:maroon">SYSINIT:3C09 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3C09
SYSINIT:3C09 </span><span style="color:navy">loc_7C39:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3C09                 </span><span style="color:navy">mov     dx, offset </span>MagicDDName <span style="color:gray">; &quot;C:\\DBLSPACE.BIN&quot;
</span><span style="color:maroon">SYSINIT:3C0C                 </span><span style="color:navy">mov     ax, </span><span style="color:green">3D00h
</span><span style="color:maroon">SYSINIT:3C0F                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - OPEN DISK FILE WITH HANDLE
<span style="color:maroon">SYSINIT:3C0F                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:maroon">SYSINIT:3C0F                                         </span>; AL = access mode
<span style="color:maroon">SYSINIT:3C0F                                         </span>; 0 - read
<span style="color:maroon">SYSINIT:3C11                 </span><span style="color:navy">jb      short loc_7C4E
</span><span style="color:maroon">SYSINIT:3C13                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:maroon">SYSINIT:3C15                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:maroon">SYSINIT:3C17                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; calldev needs packet segment in es
<span style="color:maroon">SYSINIT:3C19                 </span><span style="color:navy">mov     si, offset </span>MagicDDName <span style="color:gray">; &quot;C:\\DBLSPACE.BIN&quot;
</span><span style="color:maroon">SYSINIT:3C1C                 </span><span style="color:navy">jmp     short loc_7C56
</span><span style="color:maroon">SYSINIT:3C1E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3C1E
SYSINIT:3C1E </span><span style="color:navy">loc_7C4E:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3C1E                 </span><span style="color:navy">mov     si, offset word_7BD4 </span>; first time call is init entry point
<span style="color:maroon">SYSINIT:3C1E                                         </span>; with a standard device driver
<span style="color:maroon">SYSINIT:3C1E                                         </span>; init packet at es:bx
<span style="color:maroon">SYSINIT:3C21                 </span><span style="color:navy">jmp     short loc_7C56
</span><span style="color:maroon">SYSINIT:3C23 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3C23
SYSINIT:3C23 </span><span style="color:navy">loc_7C53:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3C23                 </span><span style="color:navy">mov     si, offset </span>MagicDDName <span style="color:gray">; &quot;C:\\DBLSPACE.BIN&quot;
</span><span style="color:maroon">SYSINIT:3C26
SYSINIT:3C26 </span><span style="color:navy">loc_7C56:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3C26                 </span><span style="color:navy">mov     cs:word_7BD6, si
</span><span style="color:maroon">SYSINIT:3C2B                 </span><span style="color:navy">mov     word ptr cs:</span>bpb_addr<span style="color:navy">, si
</span><span style="color:maroon">SYSINIT:3C30                 </span><span style="color:navy">mov     word ptr cs:</span>bpb_addr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, cs </span>; error code returned?
<span style="color:maroon">SYSINIT:3C35                 </span><span style="color:navy">mov     word ptr cs:</span>DevCmdLine<span style="color:navy">, si
</span><span style="color:maroon">SYSINIT:3C3A                 </span><span style="color:navy">mov     word ptr cs:</span>DevCmdLine<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, cs
</span><span style="color:maroon">SYSINIT:3C3F                 </span><span style="color:navy">call    loc_8DA6
</span><span style="color:maroon">SYSINIT:3C42                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:3C43                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:3C44                 </span><span style="color:navy">call    </span>SizeDevice
<span style="color:maroon">SYSINIT:3C47                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">40h </span><span style="color:gray">; &#039;@&#039;
</span><span style="color:maroon">SYSINIT:3C4A                 </span><span style="color:navy">jb      short loc_7C9A
</span><span style="color:maroon">SYSINIT:3C4C                 </span><span style="color:navy">mov     cs:</span>ConvLoad<span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:3C52                 </span><span style="color:navy">call    </span>InitDevLoad     ; convert to paragraphs
<span style="color:maroon">SYSINIT:3C55                 </span><span style="color:navy">mov     ax, cs:</span>DevLoadAddr
<span style="color:maroon">SYSINIT:3C59                 </span><span style="color:navy">add     ax, cs:</span>DevSize
<span style="color:maroon">SYSINIT:3C5E                 </span><span style="color:navy">jb      short loc_7C97
</span><span style="color:maroon">SYSINIT:3C60                 </span><span style="color:navy">cmp     cs:</span>DevLoadEnd<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:3C65                 </span><span style="color:navy">jnb     short loc_7C9D
</span><span style="color:maroon">SYSINIT:3C67
SYSINIT:3C67 </span><span style="color:navy">loc_7C97:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3C67                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">42h </span><span style="color:gray">; &#039;B&#039;
</span><span style="color:maroon">SYSINIT:3C6A
SYSINIT:3C6A </span><span style="color:navy">loc_7C9A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3C6A                 </span><span style="color:navy">jmp     loc_7E93
</span><span style="color:maroon">SYSINIT:3C6D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3C6D
SYSINIT:3C6D </span><span style="color:navy">loc_7C9D:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3C6D                 </span><span style="color:navy">lds     dx, cs:</span>DevCmdLine
<span style="color:maroon">SYSINIT:3C72                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:3C72                 </span><span style="color:navy">call    </span>ExecDev
<span style="color:maroon">SYSINIT:3C75                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">41h </span><span style="color:gray">; &#039;A&#039;
</span><span style="color:maroon">SYSINIT:3C78                 </span><span style="color:navy">jb      short loc_7C9A  </span>; if not, just leave it low
<span style="color:maroon">SYSINIT:3C7A                 </span><span style="color:navy">mov     cs:</span>break_addr<span style="color:navy">, </span><span style="color:#ff8000">0 </span>; allocate space!
<span style="color:maroon">SYSINIT:3C81                 </span><span style="color:navy">mov     ax, cs:</span>DevLoadEnd
<span style="color:maroon">SYSINIT:3C85                 </span><span style="color:navy">mov     cs:</span>break_addr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:3C89                 </span><span style="color:navy">les     bx, cs:</span>DevEntry
<span style="color:maroon">SYSINIT:3C8E                 </span><span style="color:navy">cmp     word ptr es:[bx+</span><span style="color:#ff8000">12h</span><span style="color:navy">], </span><span style="color:#ff8000">2E2Ch
</span><span style="color:maroon">SYSINIT:3C94                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">46h </span><span style="color:gray">; &#039;F&#039;   </span>; terminate size TOO big?
<span style="color:maroon">SYSINIT:3C97                 </span><span style="color:navy">jnz     short loc_7D3B
</span><span style="color:maroon">SYSINIT:3C99                 </span><span style="color:navy">mov     word ptr cs:</span>Magicbackdoor<span style="color:navy">, </span><span style="color:green">14h </span>; SYSPRE_MEMORY_ERROR
<span style="color:maroon">SYSINIT:3CA0                 </span><span style="color:navy">mov     word ptr cs:</span>Magicbackdoor<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, es
</span><span style="color:maroon">SYSINIT:3CA5                 </span><span style="color:navy">mov     al, cs:</span>drivenumber
<span style="color:maroon">SYSINIT:3CA9                 </span><span style="color:navy">mov     cs:</span>devdrivenum<span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:3CAD                 </span><span style="color:navy">add     bx, </span><span style="color:#ff8000">14h
</span><span style="color:maroon">SYSINIT:3CB0                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">0E9h </span><span style="color:gray">; &#039;&#039; </span>; if no units found, erase the device
<span style="color:maroon">SYSINIT:3CB4                 </span><span style="color:navy">jnz     short loc_7D0D
</span><span style="color:maroon">SYSINIT:3CB6                 </span><span style="color:navy">add     bx, es:[bx+</span><span style="color:#ff8000">1</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:3CBA                 </span><span style="color:navy">add     bx, </span><span style="color:#ff8000">3
</span><span style="color:maroon">SYSINIT:3CBD                 </span><span style="color:navy">cmp     byte ptr es:[bx], </span><span style="color:#ff8000">2Eh </span><span style="color:gray">; &#039;.&#039;
</span><span style="color:maroon">SYSINIT:3CC1                 </span><span style="color:navy">jnz     short loc_7D0D  </span>; [es:di+SYSI_NUMIO]
<span style="color:maroon">SYSINIT:3CC1                                         </span>; get number of devices
<span style="color:maroon">SYSINIT:3CC3                 </span><span style="color:navy">cmp     word ptr es:[bx+</span><span style="color:#ff8000">1</span><span style="color:navy">], </span><span style="color:#ff8000">63Bh
</span><span style="color:maroon">SYSINIT:3CC9                 </span><span style="color:navy">jnz     short loc_7D0D  </span>; &#039;A&#039; - &#039;Z&#039; is 26 devices
<span style="color:maroon">SYSINIT:3CCB                 </span><span style="color:navy">mov     si, es:[bx+</span><span style="color:#ff8000">3</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:3CCF                 </span><span style="color:navy">mov     ax, es:[si]
</span><span style="color:maroon">SYSINIT:3CD2                 </span><span style="color:navy">cmp     ax, cs:word_7BD8
</span><span style="color:maroon">SYSINIT:3CD7                 </span><span style="color:navy">ja      short loc_7D0D  </span>; point to bpb array (*)
<span style="color:maroon">SYSINIT:3CD9                 </span><span style="color:navy">mov     cs:word_7BD8, ax
</span><span style="color:maroon">SYSINIT:3CDD
SYSINIT:3CDD </span><span style="color:navy">loc_7D0D:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3CDD                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:3CDE                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:3CDF                 </span>assume es:SYSINIT
<span style="color:maroon">SYSINIT:3CDF                 </span><span style="color:navy">mov     bx, offset </span>packet
<span style="color:maroon">SYSINIT:3CE2                 </span><span style="color:navy">mov     ax, cs:word_7BD8
</span><span style="color:maroon">SYSINIT:3CE6                 </span><span style="color:navy">call    cs:</span>Magicbackdoor
<span style="color:maroon">SYSINIT:3CEB                 </span><span style="color:navy">jnb     short loc_7D28
</span><span style="color:maroon">SYSINIT:3CED                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:3CEE                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:3CEF                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:3CEF                 </span><span style="color:navy">mov     dx, offset asc_9978 </span><span style="color:gray">; &quot;Wrong DBLSPACE.BIN version\r\n$&quot;
</span><span style="color:maroon">SYSINIT:3CF2                 </span><span style="color:navy">mov     ah, </span><span style="color:green">9           </span>; SYSPRE_TOO_MANY_UNITS_ERROR
<span style="color:maroon">SYSINIT:3CF4                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS -
<span style="color:maroon">SYSINIT:3CF6                 </span><span style="color:navy">jmp     short loc_7D2C
</span><span style="color:maroon">SYSINIT:3CF8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3CF8
SYSINIT:3CF8 </span><span style="color:navy">loc_7D28:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3CF8                 </span><span style="color:navy">or      ax, ax
</span><span style="color:maroon">SYSINIT:3CFA                 </span><span style="color:navy">jz      short loc_7D3D
</span><span style="color:maroon">SYSINIT:3CFC
SYSINIT:3CFC </span><span style="color:navy">loc_7D2C:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3CFC                 </span><span style="color:navy">mov     word ptr cs:</span>Magicbackdoor<span style="color:navy">, </span><span style="color:#ff8000">38Bh
</span><span style="color:maroon">SYSINIT:3D03                 </span><span style="color:navy">mov     word ptr cs:</span>Magicbackdoor<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, cs
</span><span style="color:maroon">SYSINIT:3D08                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">47h </span><span style="color:gray">; &#039;G&#039;
</span><span style="color:maroon">SYSINIT:3D0B
SYSINIT:3D0B </span><span style="color:navy">loc_7D3B:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3D0B                 </span><span style="color:navy">jmp     short loc_7DA5
</span><span style="color:maroon">SYSINIT:3D0D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3D0D
SYSINIT:3D0D </span><span style="color:navy">loc_7D3D:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3D0D                 </span><span style="color:navy">mov     ax, cs:</span>break_addr
<span style="color:maroon">SYSINIT:3D11                 </span><span style="color:navy">add     ax, </span><span style="color:#ff8000">0Fh
</span><span style="color:maroon">SYSINIT:3D14                 </span><span style="color:navy">rcr     ax, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:3D16                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:3D18                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:3D1A                 </span><span style="color:navy">shr     ax, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:3D1C                 </span><span style="color:navy">add     ax, cs:</span>break_addr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:3D21                 </span><span style="color:navy">mov     word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax </span>; es:[bp.dpb_first_access],-1
<span style="color:maroon">SYSINIT:3D21                                         </span>; DPB.FIRST_ACCESS
<span style="color:maroon">SYSINIT:3D25                 </span><span style="color:navy">mov     word ptr cs:</span>DevBrkAddr<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:3D2C                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">4
</span><span style="color:maroon">SYSINIT:3D2F                 </span><span style="color:navy">call    cs:</span>Magicbackdoor
<span style="color:maroon">SYSINIT:3D34                 </span><span style="color:navy">mov     bx, cs:</span>ALLOCLIM
<span style="color:maroon">SYSINIT:3D39                 </span><span style="color:navy">sub     bx, ax
</span><span style="color:maroon">SYSINIT:3D3B                 </span><span style="color:navy">cmp     bx, word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:3D40                 </span><span style="color:navy">jb      short loc_7D88
</span><span style="color:maroon">SYSINIT:3D42                 </span><span style="color:navy">sub     cs:</span>ALLOCLIM<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:3D47                 </span><span style="color:navy">mov     es, cs:</span>ALLOCLIM
<span style="color:maroon">SYSINIT:3D4C                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:3D4C                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">6           </span>; [es:bp+DPB.DRIVER_ADDR]
<span style="color:maroon">SYSINIT:3D4F                 </span><span style="color:navy">call    cs:</span>Magicbackdoor
<span style="color:maroon">SYSINIT:3D54                 </span><span style="color:navy">mov     word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:3D58
SYSINIT:3D58 </span><span style="color:navy">loc_7D88:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3D58                 </span><span style="color:navy">mov     ax, word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:3D5C                 </span><span style="color:navy">cmp     ax, cs:</span>DevLoadEnd
<span style="color:maroon">SYSINIT:3D61                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">42h </span><span style="color:gray">; &#039;B&#039;
</span><span style="color:maroon">SYSINIT:3D64                 </span><span style="color:navy">ja      short loc_7DF2
</span><span style="color:maroon">SYSINIT:3D66                 </span><span style="color:navy">lds     si, cs:</span>DevEntry
<span style="color:maroon">SYSINIT:3D6B                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:3D6B                 </span><span style="color:navy">les     di, cs:</span>DOSINFO
<span style="color:maroon">SYSINIT:3D70                 </span><span style="color:navy">jmp     short loc_7DA8
</span><span style="color:maroon">SYSINIT:3D72 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3D72
SYSINIT:3D72 </span><span style="color:navy">loc_7DA2:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3D72                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">42h </span><span style="color:gray">; &#039;B&#039;   </span>; [es:di+SYSI_DEV] ; set head of list in dos
<span style="color:maroon">SYSINIT:3D75
SYSINIT:3D75 </span><span style="color:navy">loc_7DA5:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3D75                 </span><span style="color:navy">jmp     loc_7E93
</span><span style="color:maroon">SYSINIT:3D78 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3D78
SYSINIT:3D78 </span><span style="color:navy">loc_7DA8:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3D78                 </span><span style="color:navy">mov     al, cs:</span>unitcount
<span style="color:maroon">SYSINIT:3D7C                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:3D7E                 </span><span style="color:navy">jz      short loc_7DEF
</span><span style="color:maroon">SYSINIT:3D80                 </span><span style="color:navy">mov     [si+</span><span style="color:#ff8000">0Ah</span><span style="color:navy">], al
</span><span style="color:maroon">SYSINIT:3D83                 </span><span style="color:navy">xor     ah, ah
</span><span style="color:maroon">SYSINIT:3D85                 </span><span style="color:navy">mov     cx, ax
</span><span style="color:maroon">SYSINIT:3D87                 </span><span style="color:navy">mov     dh, ah          </span>; address in cx (segment)
<span style="color:maroon">SYSINIT:3D89                 </span><span style="color:navy">mov     dl, es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:3D8D                 </span><span style="color:navy">mov     ah, dl
</span><span style="color:maroon">SYSINIT:3D8F                 </span><span style="color:navy">add     ah, al
</span><span style="color:maroon">SYSINIT:3D91                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">1Ah         </span>; switch what we can now
<span style="color:maroon">SYSINIT:3D94                 </span><span style="color:navy">ja      short loc_7DEA
</span><span style="color:maroon">SYSINIT:3D96                 </span><span style="color:navy">call    </span>DevSetBreak
<span style="color:maroon">SYSINIT:3D99                 </span><span style="color:navy">jb      short loc_7DA2  </span>; no errors!
<span style="color:maroon">SYSINIT:3D99                                         </span>; zf=1
<span style="color:maroon">SYSINIT:3D9B                 </span><span style="color:navy">add     es:[di+</span><span style="color:#ff8000">20h</span><span style="color:navy">], al </span>; reset zero flag if error
<span style="color:maroon">SYSINIT:3D9F                 </span><span style="color:navy">lds     bx, cs:</span>bpb_addr
<span style="color:maroon">SYSINIT:3DA4
SYSINIT:3DA4 </span><span style="color:navy">loc_7DD4:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3DA4                 </span><span style="color:navy">les     bp, cs:</span>DOSINFO
<span style="color:maroon">SYSINIT:3DA9                 </span><span style="color:navy">les     bp, es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:3DAD
SYSINIT:3DAD </span><span style="color:navy">loc_7DDD:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3DAD                 </span><span style="color:navy">cmp     word ptr es:[bp+</span><span style="color:#ff8000">19h</span><span style="color:navy">], </span><span style="color:green">0FFFFh
</span><span style="color:maroon">SYSINIT:3DB2                 </span><span style="color:navy">jz      short loc_7DF5
</span><span style="color:maroon">SYSINIT:3DB4                 </span><span style="color:navy">les     bp, es:[bp+</span><span style="color:#ff8000">19h</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:3DB8                 </span><span style="color:navy">jmp     short loc_7DDD  </span>; extra 2 paragraphs for the stub
<span style="color:maroon">SYSINIT:3DB8                                         </span>; add ax,((tiny_stub_end-tiny_stub_start)+15)/16
<span style="color:maroon">SYSINIT:3DB8                                         </span>; (18+15)/16 = 2
<span style="color:maroon">SYSINIT:3DBA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3DBA
SYSINIT:3DBA </span><span style="color:navy">loc_7DEA:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3DBA                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">44h </span><span style="color:gray">; &#039;D&#039;
</span><span style="color:maroon">SYSINIT:3DBD                 </span><span style="color:navy">jmp     short loc_7DF2
</span><span style="color:maroon">SYSINIT:3DBF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3DBF
SYSINIT:3DBF </span><span style="color:navy">loc_7DEF:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3DBF                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">43h </span><span style="color:gray">; &#039;C&#039;   </span>; not to be loaded in UMB
<span style="color:maroon">SYSINIT:3DC2
SYSINIT:3DC2 </span><span style="color:navy">loc_7DF2:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3DC2                 </span><span style="color:navy">jmp     loc_7E93
</span><span style="color:maroon">SYSINIT:3DC5 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3DC5
SYSINIT:3DC5 </span><span style="color:navy">loc_7DF5:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3DC5                 </span><span style="color:navy">mov     ax, word ptr cs:</span>DevBrkAddr
<span style="color:maroon">SYSINIT:3DC9                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">19h</span><span style="color:navy">], ax
</span><span style="color:maroon">SYSINIT:3DCD                 </span><span style="color:navy">mov     ax, word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:3DD1                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">1Bh</span><span style="color:navy">], ax
</span><span style="color:maroon">SYSINIT:3DD5                 </span><span style="color:navy">les     bp, cs:</span>DevBrkAddr
<span style="color:maroon">SYSINIT:3DDA                 </span><span style="color:navy">add     word ptr cs:</span>DevBrkAddr<span style="color:navy">, </span><span style="color:#ff8000">21h </span><span style="color:gray">; &#039;!&#039;
</span><span style="color:maroon">SYSINIT:3DE0                 </span><span style="color:navy">call    </span>RoundBreakAddr  ; normalize memhi:memlo
<span style="color:maroon">SYSINIT:3DE3                 </span><span style="color:navy">mov     word ptr es:[bp+</span><span style="color:#ff8000">19h</span><span style="color:navy">], </span><span style="color:green">0FFFFh </span>; set up sub-arena, DevLoadAddr,
<span style="color:maroon">SYSINIT:3DE3                                         </span>; DevLoadEnd, and DevEntry
<span style="color:maroon">SYSINIT:3DE3                                         </span>; gets arena name from bpb_addr
<span style="color:maroon">SYSINIT:3DE9                 </span><span style="color:navy">mov     byte ptr es:[bp+</span><span style="color:#ff8000">18h</span><span style="color:navy">], </span><span style="color:#ff8000">0FFh
</span><span style="color:maroon">SYSINIT:3DEE                 </span><span style="color:navy">mov     si, [bx]
</span><span style="color:maroon">SYSINIT:3DF0                 </span><span style="color:navy">inc     bx
</span><span style="color:maroon">SYSINIT:3DF1                 </span><span style="color:navy">inc     bx
</span><span style="color:maroon">SYSINIT:3DF2                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">0</span><span style="color:navy">], dx
</span><span style="color:maroon">SYSINIT:3DF6                 </span><span style="color:navy">mov     ah, </span><span style="color:green">53h
</span><span style="color:maroon">SYSINIT:3DF8                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ internal - TRANSLATE BIOS PARAMETER BLOCK
<span style="color:maroon">SYSINIT:3DF8                                         </span>; DS:SI -&gt; BPB (BIOS Parameter Block)
<span style="color:maroon">SYSINIT:3DF8                                         </span>; ES:BP -&gt; buffer for DOS Drive Parameter Block
<span style="color:maroon">SYSINIT:3DFA                 </span><span style="color:navy">mov     ax, es:[bp+</span><span style="color:#ff8000">2</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:3DFE                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:3DFF                 </span><span style="color:navy">les     di, cs:</span>DOSINFO
<span style="color:maroon">SYSINIT:3E04                 </span><span style="color:navy">cmp     ax, es:[di+</span><span style="color:green">16</span><span style="color:navy">]  </span>; (tiny_stub_end-tiny_stub_start)
<span style="color:maroon">SYSINIT:3E08                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:3E09                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">45h </span><span style="color:gray">; &#039;E&#039;   </span>; advance es appropriately
<span style="color:maroon">SYSINIT:3E0C                 </span><span style="color:navy">ja      short loc_7E93
</span><span style="color:maroon">SYSINIT:3E0E                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:3E0F                 </span><span style="color:navy">lds     ax, cs:</span>DevEntry
<span style="color:maroon">SYSINIT:3E14                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:3E14                 </span><span style="color:navy">mov     es:[bp+</span><span style="color:#ff8000">13h</span><span style="color:navy">], ax
</span><span style="color:maroon">SYSINIT:3E18                 </span><span style="color:navy">mov     word ptr es:[bp+</span><span style="color:#ff8000">15h</span><span style="color:navy">], ds </span>; go ahead and alloc mem for device
<span style="color:maroon">SYSINIT:3E1C                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:3E1D                 </span><span style="color:navy">inc     dl
</span><span style="color:maroon">SYSINIT:3E1F
SYSINIT:3E1F </span>MagicSetCdss<span style="color:navy">:                           </span>; multMagicdrv
<span style="color:maroon">SYSINIT:3E1F                 </span><span style="color:navy">inc     dh              </span>; DBLSPACE.BIN - &quot;GetVersion&quot; -
<span style="color:maroon">SYSINIT:3E1F                                         </span>;               INSTALLATION CHECK
<span style="color:maroon">SYSINIT:3E1F                                         </span>; (BX = 0)
<span style="color:maroon">SYSINIT:3E21                 </span><span style="color:navy">loop    loc_7DD4
</span><span style="color:maroon">SYSINIT:3E23                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:3E24                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:3E25                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:3E25                 </span><span style="color:navy">call    </span>TempCDS
<span style="color:maroon">SYSINIT:3E28                 </span><span style="color:navy">les     di, cs:</span>DOSINFO
<span style="color:maroon">SYSINIT:3E2D                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:3E2D                 </span><span style="color:navy">mov     cx, es:[di+&#039;&quot;&#039;] </span>; make it zero based.
<span style="color:maroon">SYSINIT:3E31                 </span><span style="color:navy">mov     dx, es:[di+</span><span style="color:#ff8000">24h</span><span style="color:navy">] </span>; point to DOS data area (SysInitVars)
<span style="color:maroon">SYSINIT:3E35                 </span><span style="color:navy">lds     si, cs:</span>DevEntry
<span style="color:maroon">SYSINIT:3E3A                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:3E3A                 </span><span style="color:navy">mov     es:[di+</span><span style="color:#ff8000">22h</span><span style="color:navy">], si </span>; curdirLen
<span style="color:maroon">SYSINIT:3E3E                 </span><span style="color:navy">mov     word ptr es:[di+</span><span style="color:#ff8000">24h</span><span style="color:navy">], ds </span>; cds pointer
<span style="color:maroon">SYSINIT:3E42                 </span><span style="color:navy">mov     [si], cx
</span><span style="color:maroon">SYSINIT:3E44                 </span><span style="color:navy">mov     [si+</span><span style="color:#ff8000">2</span><span style="color:navy">], dx
</span><span style="color:maroon">SYSINIT:3E47                 </span><span style="color:navy">call    </span>DevBreak
<span style="color:maroon">SYSINIT:3E4A                 </span><span style="color:navy">mov     cx, word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:3E4F                 </span><span style="color:navy">mov     dx, cs:</span>ALLOCLIM
<span style="color:maroon">SYSINIT:3E54                 </span><span style="color:navy">sub     dx, cx          </span>; if mapped to itself, it is vacant
<span style="color:maroon">SYSINIT:3E56                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">5500h       </span>; skip if used
<span style="color:maroon">SYSINIT:3E59                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">2
</span><span style="color:maroon">SYSINIT:3E5C                 </span><span style="color:navy">call    cs:</span>Magicbackdoor
<span style="color:maroon">SYSINIT:3E61                 </span><span style="color:navy">xor     ax, ax          </span>; next drive
<span style="color:maroon">SYSINIT:3E63
SYSINIT:3E63 </span><span style="color:navy">loc_7E93:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3E63                 </span><span style="color:navy">or      ax, ax
</span><span style="color:maroon">SYSINIT:3E65                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">SYSINIT:3E66
SYSINIT:3E66 </span>tiny_stub_start<span style="color:navy">:                        </span>; phony device driver link
<span style="color:maroon">SYSINIT:3E66                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:3E67 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3E67
SYSINIT:3E67 </span><span style="color:navy">loc_7E97:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3E67                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4A11h
</span><span style="color:maroon">SYSINIT:3E6A                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">0           </span>; mark as character device for MEM display
<span style="color:maroon">SYSINIT:3E6D                 </span><span style="color:navy">int     </span><span style="color:green">2Fh
</span><span style="color:maroon">SYSINIT:3E6F                 </span><span style="color:navy">or      ax, ax
</span><span style="color:maroon">SYSINIT:3E71                 </span><span style="color:navy">jnz     short locret_7F1A
</span><span style="color:maroon">SYSINIT:3E73                 </span><span style="color:navy">test    dx, </span><span style="color:green">8000h
</span><span style="color:maroon">SYSINIT:3E77                 </span><span style="color:navy">jz      short locret_7F1A
</span><span style="color:maroon">SYSINIT:3E79
SYSINIT:3E79 </span>setparms<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:3E79                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">SYSINIT:3E7C                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4A11h
</span><span style="color:maroon">SYSINIT:3E7F                 </span><span style="color:navy">int     </span><span style="color:green">2Fh
</span><span style="color:maroon">SYSINIT:3E81                 </span><span style="color:navy">add     ax, </span><span style="color:#ff8000">2
</span><span style="color:maroon">SYSINIT:3E84                 </span><span style="color:navy">mov     cs:</span>DevSize<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:3E88                 </span><span style="color:navy">mov     cs:</span>DeviceHi<span style="color:navy">, offset </span>SYSINIT$ ; offset deviceparameters
<span style="color:maroon">SYSINIT:3E8E                 </span><span style="color:navy">mov     cs:</span>DevSizeOption<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:3E95                 </span><span style="color:navy">mov     cs:</span>ConvLoad<span style="color:navy">, </span><span style="color:green">1  </span>; DOSBIODATASEG ; BIOSDATA segment
<span style="color:maroon">SYSINIT:3E9B                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:3E9C                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:3E9D                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:3E9D                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:3E9E                 </span><span style="color:navy">mov     ax, cs:word_7BD6
</span><span style="color:maroon">SYSINIT:3EA2                 </span><span style="color:navy">mov     word ptr cs:</span>bpb_addr<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:3EA6                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:3EA7                 </span><span style="color:navy">mov     word ptr cs:</span>bpb_addr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, cs
</span><span style="color:maroon">SYSINIT:3EAC                 </span><span style="color:navy">call    loc_8DA6        </span>; set the bit in the permanent flags
<span style="color:maroon">SYSINIT:3EAF                 </span><span style="color:navy">call    </span>InitDevLoad
<span style="color:maroon">SYSINIT:3EB2                 </span><span style="color:navy">mov     ax, cs:</span>DevLoadAddr
<span style="color:maroon">SYSINIT:3EB6                 </span><span style="color:navy">add     ax, cs:</span>DevSize
<span style="color:maroon">SYSINIT:3EBB                 </span><span style="color:navy">mov     word ptr cs:</span>DevBrkAddr<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:3EBF                 </span><span style="color:navy">mov     word ptr cs:</span>DevBrkAddr<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:3EC6                 </span><span style="color:navy">mov     es, cs:</span>DevLoadAddr ; [deviceparameters+4],80
<span style="color:maroon">SYSINIT:3EC6                                         </span>; [deviceparameters+A_DEVICEPARAMETERS.DP_CYLINDERS],80
<span style="color:maroon">SYSINIT:3ECB                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">3F32h
</span><span style="color:maroon">SYSINIT:3ECE                 </span><span style="color:navy">xor     di, di
</span><span style="color:maroon">SYSINIT:3ED0                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">12h
</span><span style="color:maroon">SYSINIT:3ED3                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">SYSINIT:3ED5                 </span><span style="color:navy">mov     ax, es
</span><span style="color:maroon">SYSINIT:3ED7                 </span><span style="color:navy">add     ax, </span><span style="color:#ff8000">2           </span>; zero all switches
<span style="color:maroon">SYSINIT:3EDA                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:3EDC                 </span>assume es:BIOSDATA
<span style="color:maroon">SYSINIT:3EDC                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4A11h
</span><span style="color:maroon">SYSINIT:3EDF
SYSINIT:3EDF </span>parseline<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:3EDF                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFEh
</span><span style="color:maroon">SYSINIT:3EE2                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:3EE2                 </span><span style="color:navy">int     </span><span style="color:green">2Fh             </span>; al contains the first character in command line.
<span style="color:maroon">SYSINIT:3EE4                 </span><span style="color:navy">call    </span>DevSetBreak     ; cr
<span style="color:maroon">SYSINIT:3EE7                 </span><span style="color:navy">call    </span>DevBreak
<span style="color:maroon">SYSINIT:3EEA
SYSINIT:3EEA </span><span style="color:navy">locret_7F1A:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3EEA                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:3EEB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3EEB
SYSINIT:3EEB </span><span style="color:navy">loc_7F1B:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3EEB                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4A11h
</span><span style="color:maroon">SYSINIT:3EEE                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:3EF1                 </span><span style="color:navy">int     </span><span style="color:green">2Fh
</span><span style="color:maroon">SYSINIT:3EF3                 </span><span style="color:navy">or      ax, ax
</span><span style="color:maroon">SYSINIT:3EF5                 </span><span style="color:navy">jnz     short </span>check_switch
<span style="color:maroon">SYSINIT:3EF7                 </span><span style="color:navy">mov     al, cl
</span><span style="color:maroon">SYSINIT:3EF9                 </span><span style="color:navy">sub     al, </span><span style="color:#ff8000">41h </span><span style="color:gray">; &#039;A&#039;
</span><span style="color:maroon">SYSINIT:3EFB                 </span><span style="color:navy">mov     dl, al
</span><span style="color:maroon">SYSINIT:3EFD                 </span><span style="color:navy">les     si, cs:</span>DOSINFO
<span style="color:maroon">SYSINIT:3F02                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:3F02                 </span><span style="color:navy">les     si, es:[si+</span><span style="color:#ff8000">16h</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:3F06                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">58h </span><span style="color:gray">; &#039;X&#039;
</span><span style="color:maroon">SYSINIT:3F08                 </span><span style="color:navy">mul     ah
</span><span style="color:maroon">SYSINIT:3F0A                 </span><span style="color:navy">add     si, ax
</span><span style="color:maroon">SYSINIT:3F0C                 </span><span style="color:navy">mov     cl, ch
</span><span style="color:maroon">SYSINIT:3F0E                 </span><span style="color:navy">xor     ch, ch
</span><span style="color:maroon">SYSINIT:3F10
SYSINIT:3F10 </span><span style="color:navy">loc_7F40:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3F10                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:3F11                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:3F12                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:3F13                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">SYSINIT:3F14                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4A11h
</span><span style="color:maroon">SYSINIT:3F17                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:3F1A                 </span><span style="color:navy">int     </span><span style="color:green">2Fh
</span><span style="color:maroon">SYSINIT:3F1C                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">SYSINIT:3F1D                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:3F1E                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:3F1F                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:3F20                 </span><span style="color:navy">cmp     bl, dl
</span><span style="color:maroon">SYSINIT:3F22                 </span><span style="color:navy">jnz     short loc_7F5A
</span><span style="color:maroon">SYSINIT:3F24                 </span><span style="color:navy">and     word ptr es:[si+</span><span style="color:#ff8000">43h</span><span style="color:navy">], </span><span style="color:green">0BFFFh
</span><span style="color:maroon">SYSINIT:3F2A
SYSINIT:3F2A </span><span style="color:navy">loc_7F5A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3F2A                 </span><span style="color:navy">add     si, </span><span style="color:#ff8000">58h </span><span style="color:gray">; &#039;X&#039;
</span><span style="color:maroon">SYSINIT:3F2D                 </span><span style="color:navy">inc     dl
</span><span style="color:maroon">SYSINIT:3F2F                 </span><span style="color:navy">loop    loc_7F40
</span><span style="color:maroon">SYSINIT:3F31
SYSINIT:3F31 </span>check_switch<span style="color:navy">:                           </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3F31                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:3F31 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:3F32                 </span><span style="color:navy">dd </span><span style="color:#008040">0FFFFFFFFh
</span><span style="color:maroon">SYSINIT:3F36 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3F36                 </span><span style="color:navy">add     [bx+si+</span><span style="color:#ff8000">0</span><span style="color:navy">], al   </span>; convert it to upper case
<span style="color:maroon">SYSINIT:3F36 </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:3F3A                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:3F3C </span><span style="color:navy">aDblsbin        db &#039;DBLSBIN&#039;
</span><span style="color:maroon">SYSINIT:3F43 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3F43                 </span>assume es:SYSINIT
<span style="color:maroon">SYSINIT:3F43
SYSINIT:3F43 </span><span style="color:navy">loc_7F73:                               </span><span style="color:olive">; ...
</span><span style="color:maroon">SYSINIT:3F43                 </span><span style="color:navy">and     al, offset </span>SYSINIT$ ; get number of valid switches
<span style="color:maroon">SYSINIT:3F45
SYSINIT:3F45 </span><span style="color:navy">loc_7F75:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3F45                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:3F46                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:3F47                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">SYSINIT:3F48                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:3F49                 </span><span style="color:navy">push    dx              </span>; point to string of valid switches
<span style="color:maroon">SYSINIT:3F4A                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:3F4B                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:3F4C                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:3F4C                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:maroon">SYSINIT:3F4E                 </span><span style="color:navy">mov     bl, byte ptr unk_9530
</span><span style="color:maroon">SYSINIT:3F52                 </span><span style="color:navy">inc     bl
</span><span style="color:maroon">SYSINIT:3F54                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">53D8h       </span>; set bit to indicate switch
<span style="color:maroon">SYSINIT:3F57                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">44h </span><span style="color:gray">; &#039;D&#039;
</span><span style="color:maroon">SYSINIT:3F59                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:3F5B                 </span><span style="color:navy">mov     ch, </span><span style="color:#ff8000">8
</span><span style="color:maroon">SYSINIT:3F5D                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">40h </span><span style="color:gray">; &#039;@&#039;
</span><span style="color:maroon">SYSINIT:3F5F                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - IOCTL -
<span style="color:maroon">SYSINIT:3F61                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">70h </span><span style="color:gray">; &#039;p&#039;
</span><span style="color:maroon">SYSINIT:3F64                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">SYSINIT:3F66                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:3F66                 </span><span style="color:navy">test    word ptr cs:unk_9531, </span><span style="color:green">4
</span><span style="color:maroon">SYSINIT:3F6D                 </span><span style="color:navy">jz      short loc_7FAC
</span><span style="color:maroon">SYSINIT:3F6F                 </span><span style="color:navy">mov     cl, byte ptr cs:unk_9530 </span>; preserve switches
<span style="color:maroon">SYSINIT:3F74                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:3F76                 </span><span style="color:navy">shl     al, cl
</span><span style="color:maroon">SYSINIT:3F78                 </span><span style="color:navy">or      ds:</span><span style="color:green">531h</span><span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:3F7C
SYSINIT:3F7C </span><span style="color:navy">loc_7FAC:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3F7C                 </span><span style="color:navy">mov     al, cs:byte_940D+</span><span style="color:green">0Fh
</span><span style="color:maroon">SYSINIT:3F80                 </span><span style="color:navy">cmp     al, ds:</span><span style="color:green">12Ch
</span><span style="color:maroon">SYSINIT:3F84                 </span><span style="color:navy">jbe     short </span>process_num
<span style="color:maroon">SYSINIT:3F86                 </span><span style="color:navy">mov     ds:</span><span style="color:green">12Ch</span><span style="color:navy">, al
</span><span style="color:black">SYSINIT:3F89
SYSINIT:3F89 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3F89
SYSINIT:3F89
SYSINIT:3F89 </span>process_num     proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:3F89                 </span><span style="color:navy">pop     dx              </span>; if this switch has been done before,
<span style="color:black">SYSINIT:3F8A                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:3F8B                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:3F8C                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:3F8D                 </span><span style="color:navy">pop     ds              </span>; ignore this one.
<span style="color:black">SYSINIT:3F8E                 </span>assume ds:nothing
<span style="color:black">SYSINIT:3F8E                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3F8F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3F8F
SYSINIT:3F8F </span><span style="color:navy">loc_7FBF:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3F8F                 </span><span style="color:navy">push    ds              </span>; flagdrive
<span style="color:black">SYSINIT:3F90                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:3F91                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3F92                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:3F92                 </span><span style="color:navy">mov     word ptr byte_940C, </span><span style="color:#ff8000">50h </span><span style="color:gray">; &#039;P&#039;
</span><span style="color:black">SYSINIT:3F98                 </span><span style="color:navy">mov     byte_9409, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:3F9D                 </span><span style="color:navy">mov     word ptr byte_940A, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:3FA3                 </span><span style="color:navy">mov     word ptr unk_9531, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:3FA9                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3FAA                 </span>assume ds:nothing
<span style="color:black">SYSINIT:3FAA                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3FAB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3FAB
SYSINIT:3FAB </span><span style="color:navy">loc_7FDB:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3FAB                 </span><span style="color:navy">push    ds
</span><span style="color:black">SYSINIT:3FAC                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:3FAD                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3FAE                 </span>assume ds:SYSINIT
<span style="color:black">SYSINIT:3FAE
SYSINIT:3FAE </span><span style="color:navy">loc_7FDE:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3FAE                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:black">SYSINIT:3FB0                 </span><span style="color:navy">jz      short loc_8003
</span><span style="color:black">SYSINIT:3FB2                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:3FB4
SYSINIT:3FB4 </span><span style="color:gray">try_s</span><span style="color:navy">:                                  </span>; flagseclim
<span style="color:black">SYSINIT:3FB4                 </span><span style="color:navy">jz      short loc_8023
</span><span style="color:black">SYSINIT:3FB6                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:black">SYSINIT:3FB8                 </span><span style="color:navy">jbe     short loc_7FFA  </span>; must be for number of heads
<span style="color:black">SYSINIT:3FBA                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;
</span><span style="color:black">SYSINIT:3FBC                 </span><span style="color:navy">jz      short loc_7FF1
</span><span style="color:black">SYSINIT:3FBE                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3FBF
SYSINIT:3FBF </span><span style="color:gray">try_h</span><span style="color:navy">:
</span><span style="color:black">SYSINIT:3FBF                 </span><span style="color:navy">jmp     short loc_8021
</span><span style="color:black">SYSINIT:3FBF </span><span style="background:blue"><span style="color:navy">process_num     endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:3FBF
</span><span style="color:maroon">SYSINIT:3FC1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:3FC1
SYSINIT:3FC1 </span><span style="color:navy">loc_7FF1:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:3FC1                 </span><span style="color:navy">call    loc_802D
</span><span style="color:black">SYSINIT:3FC4
SYSINIT:3FC4 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:3FC4
SYSINIT:3FC4
SYSINIT:3FC4 </span>setdeviceparameters proc near
<span style="color:black">SYSINIT:3FC4                 </span><span style="color:navy">mov     word ptr unk_9531, bx
</span><span style="color:black">SYSINIT:3FC4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">SYSINIT:3FC8                 </span><span style="color:navy">db  </span><span style="color:#008040">72h </span><span style="color:gray">; r
</span><span style="color:black">SYSINIT:3FC9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3FC9                 </span><span style="color:navy">pop     es              </span>; [deviceparameters+A_DEVICEPARAMETERS.DP_DEVICETYPE]
<span style="color:black">SYSINIT:3FCA                 </span>assume es:nothing
<span style="color:black">SYSINIT:3FCA
SYSINIT:3FCA </span><span style="color:navy">loc_7FFA:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3FCA                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:3FCD                 </span><span style="color:navy">jb      short loc_8003  </span>; DEV_5INCH
<span style="color:black">SYSINIT:3FCF                 </span><span style="color:navy">jmp     short loc_7FDE
</span><span style="color:black">SYSINIT:3FD1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3FD1                 </span><span style="color:navy">jmp     short loc_8021
</span><span style="color:black">SYSINIT:3FD3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3FD3
SYSINIT:3FD3 </span><span style="color:navy">loc_8003:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3FD3                 </span><span style="color:navy">test    word ptr unk_9531, </span><span style="color:green">8
</span><span style="color:black">SYSINIT:3FD9                 </span><span style="color:navy">jnz     short loc_800E
</span><span style="color:black">SYSINIT:3FDB                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:3FDC                 </span><span style="color:navy">jmp     short loc_8021
</span><span style="color:black">SYSINIT:3FDE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3FDE
SYSINIT:3FDE </span><span style="color:navy">loc_800E:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3FDE                 </span><span style="color:navy">mov     ax, word ptr unk_9531 </span>; deviceparameters+7
<span style="color:black">SYSINIT:3FDE                                         </span>; deviceparameters+A_DEVICEPARAMETERS.DP_BPB
<span style="color:black">SYSINIT:3FDE                                         </span>; es:di -&gt; bpb
<span style="color:black">SYSINIT:3FE1                 </span><span style="color:navy">and     ax, </span><span style="color:green">3           </span>; A_BPB.size
<span style="color:black">SYSINIT:3FE4                 </span><span style="color:navy">mov     word ptr byte_940A, ax
</span><span style="color:black">SYSINIT:3FE7                 </span><span style="color:navy">mov     word ptr byte_940D+</span><span style="color:green">21h</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:3FED                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:3FEE                 </span><span style="color:navy">call    loc_80C0
</span><span style="color:black">SYSINIT:3FF1
SYSINIT:3FF1 </span><span style="color:navy">loc_8021:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3FF1                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:3FF2                 </span>assume ds:nothing
<span style="color:black">SYSINIT:3FF2                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:3FF3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3FF3
SYSINIT:3FF3 </span><span style="color:navy">loc_8023:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3FF3                 </span><span style="color:navy">inc     ds:</span>count        ; [deviceparameters+20]
<span style="color:black">SYSINIT:3FF3                                         </span>; [deviceparameters+A_DEVICEPARAMETERS.DP_BPB
<span style="color:black">SYSINIT:3FF3                                         </span>;  +A_BPB.BPB_SECTORSPERTRACK]
<span style="color:black">SYSINIT:3FF7                 </span><span style="color:navy">dec     word ptr ds:</span><span style="color:green">35Ah
</span><span style="color:black">SYSINIT:3FFB                 </span><span style="color:navy">jmp     short loc_8003
</span><span style="color:black">SYSINIT:3FFD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:3FFD
SYSINIT:3FFD </span><span style="color:navy">loc_802D:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:3FFD                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:4000                 </span><span style="color:navy">jb      short </span><span style="color:gray">got_correct_mediaid
</span><span style="color:black">SYSINIT:4002                 </span><span style="color:navy">and     al, </span><span style="color:green">0DFh
</span><span style="color:black">SYSINIT:4004
SYSINIT:4004 </span><span style="color:gray">heads_not_altered</span><span style="color:navy">:                      </span>; [deviceparameters+9],2
<span style="color:black">SYSINIT:4004                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">41h </span><span style="color:gray">; &#039;A&#039;   </span>; [deviceparameters+A_DEVICEPARAMETERS.DP_BPB
<span style="color:black">SYSINIT:4004                                         </span>;  +A_BPB.BPB_SECTORSPERCLUSTER]
<span style="color:black">SYSINIT:4006                 </span><span style="color:navy">jb      short </span><span style="color:gray">got_correct_mediaid
</span><span style="color:black">SYSINIT:4008                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;
</span><span style="color:black">SYSINIT:400A                 </span><span style="color:navy">ja      short </span><span style="color:gray">got_correct_mediaid
</span><span style="color:black">SYSINIT:400C                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:400D                 </span><span style="color:navy">push    cs
</span><span style="color:black">SYSINIT:400E                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:400F                 </span>assume es:SYSINIT
<span style="color:black">SYSINIT:400F                 </span><span style="color:navy">mov     cl, ds:</span><span style="color:green">5594h
</span><span style="color:black">SYSINIT:4013                 </span><span style="color:navy">mov     ch, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:4015                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">5595h
</span><span style="color:black">SYSINIT:4018                 </span><span style="color:navy">repne scasb
</span><span style="color:black">SYSINIT:401A                 </span><span style="color:navy">pop     es              </span>; [deviceparameters+A_DEVICEPARAMETERS.DP_BPB
<span style="color:black">SYSINIT:401A                                         </span>;  +A_BPB.BPB_SECTORSPERTRACK]
<span style="color:black">SYSINIT:401B                 </span>assume es:nothing
<span style="color:black">SYSINIT:401B                 </span><span style="color:navy">jnz     short </span><span style="color:gray">got_correct_mediaid
</span><span style="color:black">SYSINIT:401D                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:4020                 </span><span style="color:navy">shl     ax, cl
</span><span style="color:black">SYSINIT:4022                 </span><span style="color:navy">mov     bx, ds:</span><span style="color:green">5501h
</span><span style="color:black">SYSINIT:4026                 </span><span style="color:navy">or      bx, ax
</span><span style="color:black">SYSINIT:4028                 </span><span style="color:navy">mov     cx, ax          </span>; cyl=80, heads=2, secpertrack=18.
<span style="color:black">SYSINIT:4028                                         </span>;  Set cluster size to 1.
<span style="color:black">SYSINIT:402A
SYSINIT:402A </span><span style="color:gray">not_144m</span><span style="color:navy">:
</span><span style="color:black">SYSINIT:402A                 </span><span style="color:navy">test    ax, </span><span style="color:green">248
</span><span style="color:black">SYSINIT:402D                 </span><span style="color:navy">jz      short loc_807F
</span><span style="color:black">SYSINIT:402F                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:4032                 </span><span style="color:navy">jb      short loc_8081
</span><span style="color:black">SYSINIT:4034                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Ah </span><span style="color:gray">; &#039;:&#039;
</span><span style="color:black">SYSINIT:4036                 </span><span style="color:navy">jnz     short loc_8081
</span><span style="color:black">SYSINIT:4038                 </span><span style="color:navy">call    </span>getchr
<span style="color:black">SYSINIT:403B                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:403C
SYSINIT:403C </span><span style="color:gray">only_one_head</span><span style="color:navy">:                          </span>; [deviceparameters+A_DEVICEPARAMETERS.DP_DEVICETYPE],DEV_5INCH
<span style="color:black">SYSINIT:403C                 </span><span style="color:navy">mov     cs:</span>sepchr<span style="color:navy">, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:black">SYSINIT:4042                 </span><span style="color:navy">call    loc_8E22
</span><span style="color:black">SYSINIT:4045                 </span><span style="color:navy">mov     cs:</span>sepchr<span style="color:navy">, </span><span style="color:#ff8000">0    </span>; [deviceparameters+A_DEVICEPARAMETERS.DP_BPB
<span style="color:black">SYSINIT:4045                                         </span>;  +A_BPB.BPB_SECTORSPERTRACK],8
<span style="color:black">SYSINIT:404B                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:404C                 </span><span style="color:navy">call    loc_8085        </span>; 160K mediaid
<span style="color:black">SYSINIT:404F
SYSINIT:404F </span><span style="color:navy">loc_807F:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:404F                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:4050                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4051 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4051
SYSINIT:4051 </span><span style="color:navy">loc_8081:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4051                 </span><span style="color:navy">xor     bx, cx
</span><span style="color:black">SYSINIT:4053
SYSINIT:4053 </span><span style="color:gray">got_correct_mediaid</span><span style="color:navy">:                    </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4053                 </span><span style="color:navy">stc                     </span>; [deviceparameters+A_DEVICEPARAMETERS.DP_BPB
<span style="color:black">SYSINIT:4053                                         </span>;  +A_BPB.BPB_MEDIADESCRIPTOR],bl
<span style="color:black">SYSINIT:4054                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4055 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4055
SYSINIT:4055 </span><span style="color:navy">loc_8085:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4055                 </span><span style="color:navy">test    ds:</span><span style="color:green">5501h</span><span style="color:navy">, cx
</span><span style="color:black">SYSINIT:4059                 </span><span style="color:navy">jnz     short loc_80BE
</span><span style="color:black">SYSINIT:405B                 </span><span style="color:navy">test    cx, </span><span style="color:green">8
</span><span style="color:black">SYSINIT:405F                 </span><span style="color:navy">jz      short loc_8096
</span><span style="color:black">SYSINIT:4061                 </span><span style="color:navy">mov     ds:</span><span style="color:green">5500h</span><span style="color:navy">, al
</span><span style="color:black">SYSINIT:4061 </span><span style="background:blue"><span style="color:navy">setdeviceparameters endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:4061
</span><span style="color:maroon">SYSINIT:4064                 </span><span style="color:navy">jmp     short loc_80BE
</span><span style="color:maroon">SYSINIT:4066 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4066
SYSINIT:4066 </span><span style="color:navy">loc_8096:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4066                 </span><span style="color:navy">test    cx, </span><span style="color:green">80h
</span><span style="color:maroon">SYSINIT:406A                 </span><span style="color:navy">jz      short loc_80A1
</span><span style="color:maroon">SYSINIT:406C                 </span><span style="color:navy">mov     ds:</span><span style="color:green">53D9h</span><span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:406F                 </span><span style="color:navy">jmp     short loc_80BE
</span><span style="color:maroon">SYSINIT:4071 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4071
SYSINIT:4071 </span><span style="color:navy">loc_80A1:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4071                 </span><span style="color:navy">or      ax, ax
</span><span style="color:maroon">SYSINIT:4073                 </span><span style="color:navy">jz      short loc_80BE
</span><span style="color:maroon">SYSINIT:4075                 </span><span style="color:navy">test    cx, </span><span style="color:green">10h
</span><span style="color:maroon">SYSINIT:4079                 </span><span style="color:navy">jz      short loc_80B0
</span><span style="color:maroon">SYSINIT:407B                 </span><span style="color:navy">mov     ds:</span><span style="color:green">53DCh</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:407E                 </span><span style="color:navy">jmp     short loc_80BE
</span><span style="color:maroon">SYSINIT:4080 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4080
SYSINIT:4080 </span><span style="color:navy">loc_80B0:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4080                 </span><span style="color:navy">test    cx, </span><span style="color:green">20h
</span><span style="color:maroon">SYSINIT:4084                 </span><span style="color:navy">jz      short loc_80BB  </span>; starts with a blank line.
<span style="color:maroon">SYSINIT:4086                 </span><span style="color:navy">mov     ds:</span><span style="color:green">54FEh</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:4089                 </span><span style="color:navy">jmp     short loc_80BE
</span><span style="color:maroon">SYSINIT:408B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:408B
SYSINIT:408B </span><span style="color:navy">loc_80BB:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:408B                 </span><span style="color:navy">mov     ds:</span><span style="color:green">54FCh</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:408E
SYSINIT:408E </span><span style="color:navy">loc_80BE:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:408E                 </span><span style="color:navy">clc
</span><span style="color:maroon">SYSINIT:408F                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4090 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4090
SYSINIT:4090 </span><span style="color:navy">loc_80C0:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4090                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:4091                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:4092                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:4093                 </span>assume es:SYSINIT
<span style="color:maroon">SYSINIT:4093                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:maroon">SYSINIT:4095                 </span><span style="color:navy">mov     bl, ds:</span><span style="color:green">53D9h
</span><span style="color:maroon">SYSINIT:4099                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:409C                 </span><span style="color:navy">jnz     short loc_80D4
</span><span style="color:maroon">SYSINIT:409E                 </span><span style="color:navy">mov     word ptr ds:</span><span style="color:green">53DCh</span><span style="color:navy">, </span><span style="color:#ff8000">28h </span><span style="color:gray">; &#039;(&#039;
</span><span style="color:maroon">SYSINIT:40A4
SYSINIT:40A4 </span><span style="color:navy">loc_80D4:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:40A4                 </span><span style="color:navy">shl     bx, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:40A6                 </span><span style="color:navy">mov     si, [bx+</span><span style="color:#ff8000">5580h</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:40AA                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">53DFh
</span><span style="color:maroon">SYSINIT:40AD                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">1Fh
</span><span style="color:maroon">SYSINIT:40B0                 </span><span style="color:navy">cld
</span><span style="color:maroon">SYSINIT:40B1                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">SYSINIT:40B3                 </span><span style="color:navy">pop     es              </span>; ~20h ; force upper case
<span style="color:maroon">SYSINIT:40B4                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:40B4                 </span><span style="color:navy">test    word ptr ds:</span><span style="color:green">5501h</span><span style="color:navy">, </span><span style="color:green">20h
</span><span style="color:maroon">SYSINIT:40BA                 </span><span style="color:navy">jz      short loc_80F2
</span><span style="color:maroon">SYSINIT:40BC                 </span><span style="color:navy">mov     ax, ds:</span><span style="color:green">54FEh    </span>; bump to next position without affecting flags
<span style="color:maroon">SYSINIT:40BF                 </span><span style="color:navy">mov     ds:</span><span style="color:green">53ECh</span><span style="color:navy">, ax    </span>; get indicator letter
<span style="color:maroon">SYSINIT:40C2
SYSINIT:40C2 </span><span style="color:navy">loc_80F2:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:40C2                 </span><span style="color:navy">test    word ptr ds:</span><span style="color:green">5501h</span><span style="color:navy">, </span><span style="color:green">40h </span>; the next char might be cr,lf
<span style="color:maroon">SYSINIT:40C8                 </span><span style="color:navy">jz      short loc_8100  </span>; such as in &quot;rem&quot;,cr,lf case.
<span style="color:maroon">SYSINIT:40CA                 </span><span style="color:navy">mov     ax, ds:</span><span style="color:green">54FCh
</span><span style="color:maroon">SYSINIT:40CD                 </span><span style="color:navy">mov     ds:</span><span style="color:green">53EEh</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:40D0
SYSINIT:40D0 </span><span style="color:navy">loc_8100:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:40D0                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">53E1h</span><span style="color:navy">, </span><span style="color:#ff8000">2
</span><span style="color:maroon">SYSINIT:40D5                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">0F0h </span><span style="color:gray">; &#039;&#039;
</span><span style="color:maroon">SYSINIT:40D7                 </span><span style="color:navy">mov     bh, ds:</span><span style="color:green">53E9h
</span><span style="color:maroon">SYSINIT:40DB                 </span><span style="color:navy">cmp     word ptr ds:</span><span style="color:green">53EEh</span><span style="color:navy">, </span><span style="color:green">2 </span>; CONFIG_OPTION_QUERY ; and set the QUERY bit
<span style="color:maroon">SYSINIT:40E0                 </span><span style="color:navy">ja      short loc_814F
</span><span style="color:maroon">SYSINIT:40E2                 </span><span style="color:navy">jnz     short loc_8138
</span><span style="color:maroon">SYSINIT:40E4                 </span><span style="color:navy">mov     bl, bh
</span><span style="color:maroon">SYSINIT:40E6                 </span><span style="color:navy">cmp     word ptr ds:</span><span style="color:green">53ECh</span><span style="color:navy">, </span><span style="color:#ff8000">12h
</span><span style="color:maroon">SYSINIT:40EB                 </span><span style="color:navy">jnz     short loc_8126
</span><span style="color:maroon">SYSINIT:40ED                 </span><span style="color:navy">cmp     word ptr ds:</span><span style="color:green">53DCh</span><span style="color:navy">, </span><span style="color:#ff8000">50h </span><span style="color:gray">; &#039;P&#039;
</span><span style="color:maroon">SYSINIT:40F2                 </span><span style="color:navy">jnz     short loc_8126
</span><span style="color:maroon">SYSINIT:40F4                 </span><span style="color:navy">jmp     short loc_814A
</span><span style="color:maroon">SYSINIT:40F6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:40F6
SYSINIT:40F6 </span><span style="color:navy">loc_8126:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:40F6                 </span><span style="color:navy">cmp     word ptr ds:</span><span style="color:green">53DCh</span><span style="color:navy">, </span><span style="color:#ff8000">28h </span><span style="color:gray">; &#039;(&#039;
</span><span style="color:maroon">SYSINIT:40FB                 </span><span style="color:navy">jnz     short loc_814F
</span><span style="color:maroon">SYSINIT:40FD                 </span><span style="color:navy">cmp     word ptr ds:</span><span style="color:green">53ECh</span><span style="color:navy">, </span><span style="color:#ff8000">8 </span>; save indicator char in buffer
<span style="color:maroon">SYSINIT:4102                 </span><span style="color:navy">jnz     short loc_814F
</span><span style="color:maroon">SYSINIT:4104                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">0FCh </span><span style="color:gray">; &#039;&#039;  </span>; CONFIG_BEGIN
<span style="color:maroon">SYSINIT:4106                 </span><span style="color:navy">jmp     short loc_814F
</span><span style="color:maroon">SYSINIT:4108 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4108
SYSINIT:4108 </span><span style="color:navy">loc_8138:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4108                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">53D9h</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; CONFIG_SUBMENU
<span style="color:maroon">SYSINIT:410D                 </span><span style="color:navy">jnz     short loc_814A
</span><span style="color:maroon">SYSINIT:410F                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">0FCh </span><span style="color:gray">; &#039;&#039;
</span><span style="color:maroon">SYSINIT:4111                 </span><span style="color:navy">cmp     word ptr ds:</span><span style="color:green">53ECh</span><span style="color:navy">, </span><span style="color:#ff8000">8
</span><span style="color:maroon">SYSINIT:4116                 </span><span style="color:navy">jnz     short loc_814A
</span><span style="color:maroon">SYSINIT:4118                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">0FEh </span><span style="color:gray">; &#039;&#039;  </span>; map case of rest of line to UPPER
<span style="color:maroon">SYSINIT:411A
SYSINIT:411A </span><span style="color:navy">loc_814A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:411A                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">53E1h</span><span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:411F
SYSINIT:411F </span><span style="color:navy">loc_814F:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:411F                 </span><span style="color:navy">mov     ds:</span><span style="color:green">53E9h</span><span style="color:navy">, bl
</span><span style="color:maroon">SYSINIT:4123                 </span><span style="color:navy">mov     ax, ds:</span><span style="color:green">53DCh
</span><span style="color:maroon">SYSINIT:4126                 </span><span style="color:navy">mul     word ptr ds:</span><span style="color:green">53EEh </span>; Added to allow DEVHIGH/L:...
<span style="color:maroon">SYSINIT:412A                 </span><span style="color:navy">mul     word ptr ds:</span><span style="color:green">53ECh
</span><span style="color:maroon">SYSINIT:412E                 </span><span style="color:navy">mov     ds:</span><span style="color:green">53E7h</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:4131                 </span><span style="color:navy">clc                     </span>; if cr or lf then
<span style="color:maroon">SYSINIT:4132                 </span><span style="color:navy">retn                    </span>; undo si, cx register and continue
<span style="color:maroon">SYSINIT:4133 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4133
SYSINIT:4133 </span>org3<span style="color:navy">:                                   </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4133                 </span><span style="color:navy">mov     cx, cs:</span>count    ; CONFIG_COMMENT
<span style="color:maroon">SYSINIT:4138                 </span><span style="color:navy">jcxz    short loc_8191
</span><span style="color:maroon">SYSINIT:413A                 </span><span style="color:navy">xor     si, si
</span><span style="color:maroon">SYSINIT:413C                 </span><span style="color:navy">mov     di, si
</span><span style="color:maroon">SYSINIT:413E                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:maroon">SYSINIT:4140                 </span><span style="color:navy">mov     cs:</span>com_level<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4146
SYSINIT:4146 </span><span style="color:navy">loc_8176:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4146                 </span><span style="color:navy">call    loc_8389
</span><span style="color:maroon">SYSINIT:4149                 </span><span style="color:navy">jz      short loc_8188
</span><span style="color:maroon">SYSINIT:414B                 </span><span style="color:navy">call    loc_836C        </span>; CONFIG_INSTALLHIGH
<span style="color:maroon">SYSINIT:414E                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:4150                 </span><span style="color:navy">jz      short loc_8188
</span><span style="color:maroon">SYSINIT:4152                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:4154                 </span><span style="color:navy">jbe     short loc_8176
</span><span style="color:maroon">SYSINIT:4156                 </span><span style="color:navy">jmp     short loc_8193
</span><span style="color:maroon">SYSINIT:4158 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4158
SYSINIT:4158 </span><span style="color:navy">loc_8188:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4158                 </span><span style="color:navy">stosb
</span><span style="color:maroon">SYSINIT:4159                 </span><span style="color:navy">mov     cs:</span>com_level<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:415F                 </span><span style="color:navy">jmp     short loc_8176
</span><span style="color:maroon">SYSINIT:4161 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4161
SYSINIT:4161 </span><span style="color:navy">loc_8191:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4161                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:4162                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4163 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4163
SYSINIT:4163 </span><span style="color:navy">loc_8193:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4163                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:4164                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:4165                 </span><span style="color:navy">push    di
</span><span style="color:maroon">SYSINIT:4166                 </span><span style="color:navy">mov     bp, si
</span><span style="color:maroon">SYSINIT:4168                 </span><span style="color:navy">dec     bp
</span><span style="color:maroon">SYSINIT:4169                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">52F5h
</span><span style="color:maroon">SYSINIT:416C                 </span><span style="color:navy">mov     ch, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:416E
SYSINIT:416E </span><span style="color:navy">loc_819E:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:416E                 </span><span style="color:navy">mov     di, bp
</span><span style="color:maroon">SYSINIT:4170                 </span><span style="color:navy">mov     cl, [si]
</span><span style="color:maroon">SYSINIT:4172                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4173                 </span><span style="color:navy">jcxz    short loc_81EA
</span><span style="color:maroon">SYSINIT:4175                 </span><span style="color:navy">cmp     byte ptr es:[di], </span><span style="color:#ff8000">3Bh </span><span style="color:gray">; &#039;;&#039;
</span><span style="color:maroon">SYSINIT:4179                 </span><span style="color:navy">jz      short loc_81DB
</span><span style="color:maroon">SYSINIT:417B
SYSINIT:417B </span><span style="color:navy">loc_81AB:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:417B                 </span><span style="color:navy">mov     al, es:[di]
</span><span style="color:maroon">SYSINIT:417E                 </span><span style="color:navy">inc     di
</span><span style="color:maroon">SYSINIT:417F                 </span><span style="color:navy">and     al, </span><span style="color:green">0DFh
</span><span style="color:maroon">SYSINIT:4181                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4182                 </span><span style="color:navy">cmp     al, [si-</span><span style="color:green">1</span><span style="color:navy">]      </span>; skip the possible delimiters
<span style="color:maroon">SYSINIT:4185                 </span><span style="color:navy">loope   loc_81AB        </span>; comment char in the filename?
<span style="color:maroon">SYSINIT:4187                 </span><span style="color:navy">lahf
</span><span style="color:maroon">SYSINIT:4188                 </span><span style="color:navy">add     si, cx          </span>; then stop copying filename at that point
<span style="color:maroon">SYSINIT:418A                 </span><span style="color:navy">sahf
</span><span style="color:maroon">SYSINIT:418B                 </span><span style="color:navy">lodsb
</span><span style="color:maroon">SYSINIT:418C                 </span><span style="color:navy">jnz     short loc_819E
</span><span style="color:maroon">SYSINIT:418E                 </span><span style="color:navy">cmp     byte ptr es:[di], </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:4192                 </span><span style="color:navy">jz      short loc_81E5
</span><span style="color:maroon">SYSINIT:4194                 </span><span style="color:navy">cmp     byte ptr es:[di], </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:4198                 </span><span style="color:navy">jz      short loc_81E5
</span><span style="color:maroon">SYSINIT:419A                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Bh </span><span style="color:gray">; &#039;[&#039;
</span><span style="color:maroon">SYSINIT:419C                 </span><span style="color:navy">jz      short loc_81E5
</span><span style="color:maroon">SYSINIT:419E                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:419F                 </span><span style="color:navy">mov     al, es:[di]
</span><span style="color:maroon">SYSINIT:41A2                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Fh </span><span style="color:gray">; &#039;?&#039;   </span>; (we are allowing the other special
<span style="color:maroon">SYSINIT:41A4                 </span><span style="color:navy">jnz     short loc_81DF  </span>; characters can used for comment id.
<span style="color:maroon">SYSINIT:41A6                 </span><span style="color:navy">pop     ax              </span>; character.)
<span style="color:maroon">SYSINIT:41A7                 </span><span style="color:navy">or      al, </span><span style="color:green">80h
</span><span style="color:maroon">SYSINIT:41A9                 </span><span style="color:navy">jmp     short loc_81E5
</span><span style="color:maroon">SYSINIT:41AB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:41AB
SYSINIT:41AB </span><span style="color:navy">loc_81DB:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:41AB                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:maroon">SYSINIT:41AD                 </span><span style="color:navy">jmp     short loc_81E5
</span><span style="color:maroon">SYSINIT:41AF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:41AF
SYSINIT:41AF </span><span style="color:navy">loc_81DF:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:41AF                 </span><span style="color:navy">call    loc_8D51
</span><span style="color:maroon">SYSINIT:41B2                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:41B3                 </span><span style="color:navy">jnz     short loc_819E
</span><span style="color:maroon">SYSINIT:41B5
SYSINIT:41B5 </span><span style="color:navy">loc_81E5:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:41B5                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">SYSINIT:41B6                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:41B7                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:41B8                 </span><span style="color:navy">jmp     short loc_81F9  </span>; 1 char. so far.
<span style="color:maroon">SYSINIT:41BA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:41BA
SYSINIT:41BA </span><span style="color:navy">loc_81EA:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:41BA                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">SYSINIT:41BB                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:41BC                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:41BD                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;
</span><span style="color:maroon">SYSINIT:41BF                 </span><span style="color:navy">stosb
</span><span style="color:maroon">SYSINIT:41C0
SYSINIT:41C0 </span><span style="color:navy">loc_81F0:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:41C0                 </span><span style="color:navy">call    loc_836C
</span><span style="color:maroon">SYSINIT:41C3                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:41C5                 </span><span style="color:navy">jnz     short loc_81F0  </span>; tab
<span style="color:maroon">SYSINIT:41C7                 </span><span style="color:navy">jmp     short loc_8188
</span><span style="color:maroon">SYSINIT:41C9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:41C9
SYSINIT:41C9 </span><span style="color:navy">loc_81F9:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:41C9                 </span><span style="color:navy">stosb                   </span>; cr
<span style="color:maroon">SYSINIT:41CA                 </span><span style="color:navy">and     al, </span><span style="color:green">7Fh
</span><span style="color:maroon">SYSINIT:41CC                 </span><span style="color:navy">mov     cs:</span>cmd_indicator<span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:41D0                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Bh </span><span style="color:gray">; &#039;[&#039;
</span><span style="color:maroon">SYSINIT:41D2                 </span><span style="color:navy">jz      short loc_825F
</span><span style="color:maroon">SYSINIT:41D4                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">4Fh </span><span style="color:gray">; &#039;O&#039;
</span><span style="color:maroon">SYSINIT:41D6                 </span><span style="color:navy">jz      short loc_8217
</span><span style="color:maroon">SYSINIT:41D8                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">45h </span><span style="color:gray">; &#039;E&#039;
</span><span style="color:maroon">SYSINIT:41DA                 </span><span style="color:navy">jz      short loc_8217
</span><span style="color:maroon">SYSINIT:41DC                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">41h </span><span style="color:gray">; &#039;A&#039;
</span><span style="color:maroon">SYSINIT:41DE                 </span><span style="color:navy">jz      short loc_8217
</span><span style="color:maroon">SYSINIT:41E0                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">4Ah </span><span style="color:gray">; &#039;J&#039;
</span><span style="color:maroon">SYSINIT:41E2                 </span><span style="color:navy">jz      short loc_8217
</span><span style="color:maroon">SYSINIT:41E4                 </span><span style="color:navy">call    loc_8D7A        </span>; make the filename in front of
<span style="color:maroon">SYSINIT:41E4                                         </span>; the comment string to be an asciiz.
<span style="color:maroon">SYSINIT:41E7
SYSINIT:41E7 </span><span style="color:navy">loc_8217:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:41E7                 </span><span style="color:navy">call    loc_836C
</span><span style="color:maroon">SYSINIT:41EA                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:41EC                 </span><span style="color:navy">jz      short loc_822D  </span>; al = &quot;/&quot; option char.
<span style="color:maroon">SYSINIT:41EC                                         </span>; make a filename an asciiz
<span style="color:maroon">SYSINIT:41EE                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:41F0                 </span><span style="color:navy">jz      short loc_822D  </span>; and
<span style="color:maroon">SYSINIT:41F2                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;   </span>; continue with the rest of the line
<span style="color:maroon">SYSINIT:41F4                 </span><span style="color:navy">jz      short loc_822D  </span>; make it an asciiz and handle the next char.
<span style="color:maroon">SYSINIT:41F6                 </span><span style="color:navy">call    loc_8D51
</span><span style="color:maroon">SYSINIT:41F9                 </span><span style="color:navy">jnz     short loc_8217  </span>; lf
<span style="color:maroon">SYSINIT:41FB                 </span><span style="color:navy">jmp     short loc_822F
</span><span style="color:maroon">SYSINIT:41FD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:41FD
SYSINIT:41FD </span><span style="color:navy">loc_822D:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:41FD                 </span><span style="color:navy">dec     si
</span><span style="color:maroon">SYSINIT:41FE                 </span><span style="color:navy">inc     cx
</span><span style="color:maroon">SYSINIT:41FF
SYSINIT:41FF </span><span style="color:navy">loc_822F:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:41FF                 </span><span style="color:navy">cmp     cs:</span>cmd_indicator<span style="color:navy">, </span><span style="color:#ff8000">59h </span><span style="color:gray">; &#039;Y&#039; </span>; org4 skips all delimiters
<span style="color:maroon">SYSINIT:41FF                                         </span>; after the command name except for &#039;/&#039;
<span style="color:maroon">SYSINIT:4205                 </span><span style="color:navy">jz      short </span>up_level
<span style="color:maroon">SYSINIT:4207                 </span><span style="color:navy">cmp     cs:</span>cmd_indicator<span style="color:navy">, </span><span style="color:#ff8000">44h </span><span style="color:gray">; &#039;D&#039; </span>; skip delimiters except &#039;/&#039;
<span style="color:maroon">SYSINIT:420D                 </span><span style="color:navy">jz      short loc_8273
</span><span style="color:maroon">SYSINIT:420F                 </span><span style="color:navy">cmp     cs:</span>cmd_indicator<span style="color:navy">, </span><span style="color:#ff8000">49h </span><span style="color:gray">; &#039;I&#039;
</span><span style="color:maroon">SYSINIT:4215                 </span><span style="color:navy">jz      short loc_8273
</span><span style="color:maroon">SYSINIT:4217                 </span><span style="color:navy">cmp     cs:</span>cmd_indicator<span style="color:navy">, </span><span style="color:#ff8000">57h </span><span style="color:gray">; &#039;W&#039; </span>; a quote ?
<span style="color:maroon">SYSINIT:421D                 </span><span style="color:navy">jz      short loc_8273
</span><span style="color:maroon">SYSINIT:421F                 </span><span style="color:navy">cmp     cs:</span>cmd_indicator<span style="color:navy">, &#039;</span><span style="color:green">S&#039; </span>; CONFIG_DEVICEHIGH
<span style="color:maroon">SYSINIT:421F                                         </span>; Q: is this devicehigh
<span style="color:maroon">SYSINIT:4225                 </span><span style="color:navy">jz      short loc_8273  </span>; N:
<span style="color:maroon">SYSINIT:4227                 </span><span style="color:navy">cmp     cs:</span>cmd_indicator<span style="color:navy">, </span><span style="color:#ff8000">31h </span><span style="color:gray">; &#039;1&#039; </span>; Q: is this line feed
<span style="color:maroon">SYSINIT:422D                 </span><span style="color:navy">jz      short loc_8262  </span>; N:
<span style="color:maroon">SYSINIT:422F
SYSINIT:422F </span><span style="color:navy">loc_825F:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:422F                 </span><span style="color:navy">jmp     loc_82FB        </span>; overwrite cr with blank
<span style="color:maroon">SYSINIT:4232 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4232
SYSINIT:4232 </span><span style="color:navy">loc_8262:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4232                 </span><span style="color:navy">call    loc_8389
</span><span style="color:maroon">SYSINIT:4235                 </span><span style="color:navy">jz      short loc_82DD  </span>; indicate that blank has been inserted
<span style="color:maroon">SYSINIT:4237                 </span><span style="color:navy">call    loc_836C
</span><span style="color:maroon">SYSINIT:423A                 </span><span style="color:navy">call    loc_8D59
</span><span style="color:maroon">SYSINIT:423D                 </span><span style="color:navy">jz      short loc_8262
</span><span style="color:maroon">SYSINIT:423F                 </span><span style="color:navy">stosb
</span><span style="color:maroon">SYSINIT:4240                 </span><span style="color:navy">jmp     loc_830A        </span>; handles next char in this line.
<span style="color:maroon">SYSINIT:4243 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4243
SYSINIT:4243 </span><span style="color:navy">loc_8273:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4243                 </span><span style="color:navy">call    loc_8389
</span><span style="color:maroon">SYSINIT:4246                 </span><span style="color:navy">jz      short loc_82E0
</span><span style="color:maroon">SYSINIT:4248                 </span><span style="color:navy">call    loc_836C        </span>; Y:
<span style="color:maroon">SYSINIT:424B                 </span><span style="color:navy">call    loc_8D51
</span><span style="color:maroon">SYSINIT:424E                 </span><span style="color:navy">jz      short loc_8273
</span><span style="color:maroon">SYSINIT:4250                 </span><span style="color:navy">stosb                   </span>; clear blank indicator for devicehigh
<span style="color:maroon">SYSINIT:4251
SYSINIT:4251 </span><span style="color:navy">loc_8281:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4251                 </span><span style="color:navy">call    loc_8389
</span><span style="color:maroon">SYSINIT:4254                 </span><span style="color:navy">jz      short loc_82E0
</span><span style="color:maroon">SYSINIT:4256                 </span><span style="color:navy">call    loc_836C
</span><span style="color:maroon">SYSINIT:4259                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;
</span><span style="color:maroon">SYSINIT:425B                 </span><span style="color:navy">jz      short loc_82E8
</span><span style="color:maroon">SYSINIT:425D                 </span><span style="color:navy">stosb
</span><span style="color:maroon">SYSINIT:425E                 </span><span style="color:navy">call    loc_8D51
</span><span style="color:maroon">SYSINIT:4261                 </span><span style="color:navy">jz      short loc_82F0  </span>; reset it
<span style="color:maroon">SYSINIT:4263                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:4265                 </span><span style="color:navy">ja      short loc_8281
</span><span style="color:maroon">SYSINIT:4267                 </span><span style="color:navy">jmp     short loc_82F0
</span><span style="color:maroon">SYSINIT:4269 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4269
SYSINIT:4269 </span>up_level<span style="color:navy">:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4269                 </span><span style="color:navy">call    loc_836C        </span>; set it
<span style="color:maroon">SYSINIT:426C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:426E                 </span><span style="color:navy">jz      short </span>up_level
<span style="color:maroon">SYSINIT:4270
SYSINIT:4270 </span>get2<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:4270                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">9
</span><span style="color:maroon">SYSINIT:4272                 </span><span style="color:navy">jz      short </span>up_level
<span style="color:maroon">SYSINIT:4274                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Dh </span><span style="color:gray">; &#039;=&#039;
</span><span style="color:maroon">SYSINIT:4276
SYSINIT:4276 </span>noget<span style="color:navy">:                                  </span>; This was the rather kludgy way
<span style="color:maroon">SYSINIT:4276                 </span><span style="color:navy">jz      short </span>up_level  ; out of procedure &quot;organize&quot;,
<span style="color:maroon">SYSINIT:4276                                         </span>; but instead of returning to doconf,
<span style="color:maroon">SYSINIT:4276                                         </span>; we now want to check config.sys BEGIN/END blocks
<span style="color:maroon">SYSINIT:4276                                         </span>; and the new boot menu stuff
<span style="color:maroon">SYSINIT:4278                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:427A                 </span><span style="color:navy">jz      short loc_82D6
</span><span style="color:maroon">SYSINIT:427C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:427E                 </span><span style="color:navy">jz      short loc_82D6
</span><span style="color:maroon">SYSINIT:4280                 </span><span style="color:navy">mov     cs:</span>cmmt1<span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:4284                 </span><span style="color:navy">mov     cs:</span>cmmt<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:428A                 </span><span style="color:navy">call    loc_836C
</span><span style="color:black">SYSINIT:428D
SYSINIT:428D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:428D
SYSINIT:428D
SYSINIT:428D </span>skip_comment    proc near
<span style="color:black">SYSINIT:428D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;   </span>; get out of the organize routine.
<span style="color:black">SYSINIT:428D                                         </span>; ...
<span style="color:black">SYSINIT:428D                                         </span>; skip the commented string until lf,
<span style="color:black">SYSINIT:428D                                         </span>; if current es:si-&gt; a comment string.
<span style="color:black">SYSINIT:428D                                         </span>; ...
<span style="color:black">SYSINIT:428F                 </span><span style="color:navy">jz      short loc_82D6  </span>; only check it if parameter level is 0.
<span style="color:black">SYSINIT:4291                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">9
</span><span style="color:black">SYSINIT:4293                 </span><span style="color:navy">jz      short loc_82D6
</span><span style="color:black">SYSINIT:4295                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh         </span>; (not inside quotations)
<span style="color:black">SYSINIT:4297                 </span><span style="color:navy">jz      short loc_82D6
</span><span style="color:black">SYSINIT:4299                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:429B                 </span><span style="color:navy">jz      short loc_82DD
</span><span style="color:black">SYSINIT:429D                 </span><span style="color:navy">mov     cs:</span>cmmt2<span style="color:navy">, al
</span><span style="color:black">SYSINIT:42A1                 </span><span style="color:navy">inc     cs:</span>cmmt
<span style="color:black">SYSINIT:42A6
SYSINIT:42A6 </span><span style="color:navy">loc_82D6:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:42A6                 </span><span style="color:navy">call    loc_836C
</span><span style="color:black">SYSINIT:42A9                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:42AB                 </span><span style="color:navy">jnz     short loc_82D6
</span><span style="color:black">SYSINIT:42AD
SYSINIT:42AD </span><span style="color:navy">loc_82DD:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:42AD                 </span><span style="color:navy">jmp     loc_8188
</span><span style="color:black">SYSINIT:42B0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:42B0
SYSINIT:42B0 </span><span style="color:navy">loc_82E0:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:42B0                 </span><span style="color:navy">mov     byte ptr es:[di], </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:42B4                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:42B5                 </span><span style="color:navy">jmp     loc_8188
</span><span style="color:black">SYSINIT:42B8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:42B8
SYSINIT:42B8 </span><span style="color:navy">loc_82E8:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:42B8                 </span><span style="color:navy">mov     byte ptr es:[di], </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:42BC
SYSINIT:42BC </span><span style="color:gray">skip_cmmt</span><span style="color:navy">:                              </span>; get out of organize routine.
<span style="color:black">SYSINIT:42BC                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:42BD                 </span><span style="color:navy">stosb
</span><span style="color:black">SYSINIT:42BE                 </span><span style="color:navy">jmp     short loc_830A
</span><span style="color:black">SYSINIT:42C0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:42C0
SYSINIT:42C0 </span><span style="color:navy">loc_82F0:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:42C0                 </span><span style="color:navy">mov     byte ptr es:[di-</span><span style="color:green">1</span><span style="color:navy">], </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:42C5                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:42C7
SYSINIT:42C7 </span><span style="color:gray">no_commt</span><span style="color:navy">:
</span><span style="color:black">SYSINIT:42C7                 </span><span style="color:navy">jz      short loc_82DD
</span><span style="color:black">SYSINIT:42C7 </span>skip_comment    endp
<span style="color:black">SYSINIT:42C7
</span><span style="color:maroon">SYSINIT:42C9                 </span><span style="color:navy">jmp     short loc_830A
</span><span style="color:maroon">SYSINIT:42CB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:42CB
SYSINIT:42CB </span><span style="color:navy">loc_82FB:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:42CB                 </span><span style="color:navy">call    loc_8389
</span><span style="color:maroon">SYSINIT:42CE                 </span><span style="color:navy">jz      short loc_82DD
</span><span style="color:maroon">SYSINIT:42D0                 </span><span style="color:navy">call    loc_836C
</span><span style="color:maroon">SYSINIT:42D3                 </span><span style="color:navy">call    loc_8D59
</span><span style="color:maroon">SYSINIT:42D6                 </span><span style="color:navy">jz      short loc_82FB  </span>; KEYBOARD - CHECK BUFFER, DO NOT CLEAR
<span style="color:maroon">SYSINIT:42D6                                         </span>; Return: ZF clear if character in buffer
<span style="color:maroon">SYSINIT:42D6                                         </span>; AH = scan code, AL = character
<span style="color:maroon">SYSINIT:42D6                                         </span>; ZF set if no character in buffer
<span style="color:maroon">SYSINIT:42D8                 </span><span style="color:navy">jmp     short loc_8312
</span><span style="color:maroon">SYSINIT:42DA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:42DA
SYSINIT:42DA </span><span style="color:navy">loc_830A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:42DA                 </span><span style="color:navy">call    loc_8389
</span><span style="color:maroon">SYSINIT:42DD                 </span><span style="color:navy">jz      short loc_82DD
</span><span style="color:maroon">SYSINIT:42DF                 </span><span style="color:navy">call    loc_836C
</span><span style="color:maroon">SYSINIT:42E2
SYSINIT:42E2 </span><span style="color:navy">loc_8312:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:42E2                 </span><span style="color:navy">stosb                   </span>; system timer, lw
<span style="color:maroon">SYSINIT:42E3                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">22h </span><span style="color:gray">; &#039;&quot;&#039;
</span><span style="color:maroon">SYSINIT:42E5                 </span><span style="color:navy">jz      short loc_8355  </span>; get difference
<span style="color:maroon">SYSINIT:42E7                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:42E9                 </span><span style="color:navy">ja      short loc_830A
</span><span style="color:maroon">SYSINIT:42EB                 </span><span style="color:navy">cmp     cs:</span>cmd_indicator<span style="color:navy">, </span><span style="color:#ff8000">55h </span><span style="color:gray">; &#039;U&#039;
</span><span style="color:maroon">SYSINIT:42F1                 </span><span style="color:navy">jnz     short loc_8338
</span><span style="color:maroon">SYSINIT:42F3                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:42F5                 </span><span style="color:navy">jz      short loc_833E
</span><span style="color:maroon">SYSINIT:42F7                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:42F9                 </span><span style="color:navy">jnz     short loc_830A
</span><span style="color:maroon">SYSINIT:42FB                 </span><span style="color:navy">mov     byte ptr es:[di-</span><span style="color:green">1</span><span style="color:navy">], </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:4300                 </span><span style="color:navy">stosb
</span><span style="color:maroon">SYSINIT:4301                 </span><span style="color:navy">inc     byte ptr cs:loc_7F73+</span><span style="color:green">1 </span>; peek the keyboard
<span style="color:maroon">SYSINIT:4306                 </span><span style="color:navy">jmp     short loc_830A
</span><span style="color:maroon">SYSINIT:4308 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4308
SYSINIT:4308 </span><span style="color:navy">loc_8338:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4308                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:430A                 </span><span style="color:navy">jz      short loc_834C
</span><span style="color:maroon">SYSINIT:430C                 </span><span style="color:navy">jmp     short loc_830A
</span><span style="color:maroon">SYSINIT:430E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:430E
SYSINIT:430E </span><span style="color:navy">loc_833E:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:430E                 </span><span style="color:navy">cmp     byte ptr cs:loc_7F73+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:4314                 </span><span style="color:navy">jz      short loc_834C
</span><span style="color:maroon">SYSINIT:4316                 </span><span style="color:navy">mov     byte ptr es:[di-</span><span style="color:green">1</span><span style="color:navy">], </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:431B                 </span><span style="color:navy">stosb
</span><span style="color:maroon">SYSINIT:431C
SYSINIT:431C </span><span style="color:navy">loc_834C:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:431C                 </span><span style="color:navy">mov     byte ptr cs:loc_7F73+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4322                 </span><span style="color:navy">jmp     loc_8176        </span>; CTRL F8
<span style="color:maroon">SYSINIT:4325 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4325
SYSINIT:4325 </span><span style="color:navy">loc_8355:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4325                 </span><span style="color:navy">cmp     cs:</span>com_level<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:432B                 </span><span style="color:navy">jz      short loc_8365
</span><span style="color:maroon">SYSINIT:432D                 </span><span style="color:navy">mov     cs:</span>com_level<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4333                 </span><span style="color:navy">jmp     short loc_830A
</span><span style="color:maroon">SYSINIT:4335 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4335
SYSINIT:4335 </span><span style="color:navy">loc_8365:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4335                 </span><span style="color:navy">inc     cs:</span>com_level
<span style="color:maroon">SYSINIT:433A                 </span><span style="color:navy">jmp     short loc_830A  </span>; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
<span style="color:maroon">SYSINIT:433A                                         </span>; Return: AH = scan code, AL = character
<span style="color:maroon">SYSINIT:433C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:433C
SYSINIT:433C </span><span style="color:navy">loc_836C:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:433C                 </span><span style="color:navy">jcxz    short loc_8372  </span>; -1
<span style="color:maroon">SYSINIT:433E                 </span><span style="color:navy">lods    byte ptr es:[si]
</span><span style="color:maroon">SYSINIT:4340                 </span><span style="color:navy">dec     cx
</span><span style="color:maroon">SYSINIT:4341                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4342 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4342
SYSINIT:4342 </span><span style="color:navy">loc_8372:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4342                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:4343                 </span><span style="color:navy">mov     cs:</span>count<span style="color:navy">, di
</span><span style="color:maroon">SYSINIT:4348                 </span><span style="color:navy">mov     cs:</span>org_count<span style="color:navy">, di
</span><span style="color:maroon">SYSINIT:434D                 </span><span style="color:navy">xor     si, si          </span>; set carry to indicate abort
<span style="color:maroon">SYSINIT:434F                 </span><span style="color:navy">mov     cs:</span>chrptr<span style="color:navy">, si   </span>; clear carry to indicate success
<span style="color:maroon">SYSINIT:4354                 </span><span style="color:navy">mov     cx, di
</span><span style="color:maroon">SYSINIT:4356                 </span><span style="color:navy">jmp     loc_8474
</span><span style="color:maroon">SYSINIT:4359 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4359
SYSINIT:4359 </span><span style="color:navy">loc_8389:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4359                 </span><span style="color:navy">jcxz    short loc_8372
</span><span style="color:maroon">SYSINIT:435B                 </span><span style="color:navy">cmp     cs:</span>com_level<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4361                 </span><span style="color:navy">jnz     short locret_83C3 </span>; ~20h ; turn it off
<span style="color:maroon">SYSINIT:4363                 </span><span style="color:navy">cmp     cs:</span>cmmt<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:4369                 </span><span style="color:navy">jb      short locret_83C3
</span><span style="color:maroon">SYSINIT:436B                 </span><span style="color:navy">mov     al, es:[si]
</span><span style="color:maroon">SYSINIT:436E                 </span><span style="color:navy">cmp     cs:</span>cmmt1<span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:4373                 </span><span style="color:navy">jnz     short locret_83C3
</span><span style="color:maroon">SYSINIT:4375                 </span><span style="color:navy">cmp     cs:</span>cmmt<span style="color:navy">, </span><span style="color:#ff8000">2
</span><span style="color:maroon">SYSINIT:437B                 </span><span style="color:navy">jnz     short loc_83B8
</span><span style="color:maroon">SYSINIT:437D                 </span><span style="color:navy">mov     al, es:[si+</span><span style="color:#ff8000">1</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4381                 </span><span style="color:navy">cmp     cs:</span>cmmt2<span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:4386                 </span><span style="color:navy">jnz     short locret_83C3
</span><span style="color:maroon">SYSINIT:4388
SYSINIT:4388 </span><span style="color:navy">loc_83B8:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4388                 </span><span style="color:navy">jcxz    short loc_8372  </span>; CONFIG_NUMLOCK
<span style="color:maroon">SYSINIT:438A                 </span><span style="color:navy">mov     al, es:[si]
</span><span style="color:maroon">SYSINIT:438D                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:438E                 </span><span style="color:navy">dec     cx              </span>; before the first block
<span style="color:maroon">SYSINIT:438F                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:4391                 </span><span style="color:navy">jnz     short loc_83B8
</span><span style="color:maroon">SYSINIT:4393
SYSINIT:4393 </span><span style="color:navy">locret_83C3:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4393                 </span><span style="color:navy">retn                    </span>; CONFIG_REM
<span style="color:maroon">SYSINIT:4394 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4394
SYSINIT:4394 </span><span style="color:navy">loc_83C4:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4394                 </span><span style="color:navy">test    byte ptr ds:</span><span style="color:green">52A4h</span><span style="color:navy">, </span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:4399                 </span><span style="color:navy">jnz     short loc_83EC
</span><span style="color:maroon">SYSINIT:439B                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:439C                 </span><span style="color:navy">sub     ax, ax
</span><span style="color:maroon">SYSINIT:439E                 </span><span style="color:navy">mov     ds, ax          </span>; look for /N or /F
<span style="color:maroon">SYSINIT:43A0
SYSINIT:43A0 </span><span style="color:navy">loc_83D0:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:43A0                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:43A2                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - CHECK BUFFER, DO NOT CLEAR
<span style="color:maroon">SYSINIT:43A2                                         </span>; Return: ZF clear if character in buffer
<span style="color:maroon">SYSINIT:43A2                                         </span>; AH = scan code, AL = character
<span style="color:maroon">SYSINIT:43A2                                         </span>; ZF set if no character in buffer
<span style="color:maroon">SYSINIT:43A4                 </span><span style="color:navy">jnz     short loc_83EB
</span><span style="color:maroon">SYSINIT:43A6                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:maroon">SYSINIT:43A8                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - GET SHIFT STATUS
<span style="color:maroon">SYSINIT:43A8                                         </span>; AL = shift status bits
<span style="color:maroon">SYSINIT:43AA                 </span><span style="color:navy">test    al, </span><span style="color:green">3
</span><span style="color:maroon">SYSINIT:43AC                 </span><span style="color:navy">jnz     short loc_83EB  </span>; ~20h ; convert to upper case
<span style="color:maroon">SYSINIT:43AE                 </span><span style="color:navy">mov     ax, word ptr ds:loc_449C
</span><span style="color:maroon">SYSINIT:43B1                 </span><span style="color:navy">sub     ax, cs:</span>_timer_lw_
<span style="color:maroon">SYSINIT:43B6                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">25h </span><span style="color:gray">; &#039;%&#039;
</span><span style="color:maroon">SYSINIT:43B9                 </span><span style="color:navy">jb      short loc_83D0  </span>; continue looking for switches of interest
<span style="color:maroon">SYSINIT:43BB
SYSINIT:43BB </span><span style="color:navy">loc_83EB:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:43BB                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:43BC
SYSINIT:43BC </span><span style="color:navy">loc_83EC:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:43BC                 </span><span style="color:navy">sub     bx, bx
</span><span style="color:maroon">SYSINIT:43BE                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:maroon">SYSINIT:43C0                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD -
<span style="color:maroon">SYSINIT:43C2                 </span><span style="color:navy">test    al, </span><span style="color:green">3
</span><span style="color:maroon">SYSINIT:43C4                 </span><span style="color:navy">jz      short loc_83FD
</span><span style="color:maroon">SYSINIT:43C6                 </span><span style="color:navy">inc     bx              </span>; continue looking for switches of interest
<span style="color:maroon">SYSINIT:43C7                 </span><span style="color:navy">inc     bx
</span><span style="color:maroon">SYSINIT:43C8                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">4
</span><span style="color:maroon">SYSINIT:43CD
SYSINIT:43CD </span><span style="color:navy">loc_83FD:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:43CD                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:43CF                 </span><span style="color:navy">int     offset </span>int02    ; KEYBOARD - CHECK BUFFER, DO NOT CLEAR
<span style="color:maroon">SYSINIT:43CF                                         </span>; Return: ZF clear if character in buffer
<span style="color:maroon">SYSINIT:43CF                                         </span>; AH = scan code, AL = character
<span style="color:maroon">SYSINIT:43CF                                         </span>; ZF set if no character in buffer
<span style="color:maroon">SYSINIT:43D1                 </span><span style="color:navy">jz      short loc_8441
</span><span style="color:maroon">SYSINIT:43D3                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:43D5                 </span><span style="color:navy">jnz     short loc_8441
</span><span style="color:maroon">SYSINIT:43D7                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">62h </span><span style="color:gray">; &#039;b&#039;
</span><span style="color:maroon">SYSINIT:43DA                 </span><span style="color:navy">jz      short loc_8411
</span><span style="color:maroon">SYSINIT:43DC                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">3Fh </span><span style="color:gray">; &#039;?&#039;
</span><span style="color:maroon">SYSINIT:43DF                 </span><span style="color:navy">jnz     short loc_841E
</span><span style="color:maroon">SYSINIT:43E1
SYSINIT:43E1 </span><span style="color:navy">loc_8411:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:43E1                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">5777h
</span><span style="color:maroon">SYSINIT:43E4                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:43E7                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">4
</span><span style="color:maroon">SYSINIT:43EC                 </span><span style="color:navy">jmp     short loc_8434
</span><span style="color:maroon">SYSINIT:43EE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:43EE
SYSINIT:43EE </span><span style="color:navy">loc_841E:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:43EE                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">65h </span><span style="color:gray">; &#039;e&#039;
</span><span style="color:maroon">SYSINIT:43F1                 </span><span style="color:navy">jz      short loc_8428
</span><span style="color:maroon">SYSINIT:43F3                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">42h </span><span style="color:gray">; &#039;B&#039;
</span><span style="color:maroon">SYSINIT:43F6                 </span><span style="color:navy">jnz     short loc_844B
</span><span style="color:maroon">SYSINIT:43F8
SYSINIT:43F8 </span><span style="color:navy">loc_8428:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:43F8                 </span><span style="color:navy">mov     dx, </span><span style="color:green">57B5h       </span>; first # is foreground color (for low nibble)
<span style="color:maroon">SYSINIT:43FB                 </span><span style="color:navy">call    sub_9072        </span>; save it in CH
<span style="color:maroon">SYSINIT:43FE                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:4400                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52A8h</span><span style="color:navy">, bl
</span><span style="color:maroon">SYSINIT:4404
SYSINIT:4404 </span><span style="color:navy">loc_8434:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4404                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4406                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
<span style="color:maroon">SYSINIT:4406                                         </span>; Return: AH = scan code, AL = character
<span style="color:maroon">SYSINIT:4408                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">52AEh</span><span style="color:navy">, </span><span style="color:#ff8000">0FFh
</span><span style="color:maroon">SYSINIT:440D                 </span><span style="color:navy">or      bx, bx          </span>; save it in DH
<span style="color:maroon">SYSINIT:440F                 </span><span style="color:navy">jz      short loc_8446
</span><span style="color:maroon">SYSINIT:4411
SYSINIT:4411 </span><span style="color:navy">loc_8441:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4411                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">2
</span><span style="color:maroon">SYSINIT:4414                 </span><span style="color:navy">jb      short loc_844B
</span><span style="color:maroon">SYSINIT:4416
SYSINIT:4416 </span><span style="color:navy">loc_8446:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4416                 </span><span style="color:navy">call    loc_8CDE
</span><span style="color:maroon">SYSINIT:4419                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:441A                 </span><span style="color:navy">retn                    </span>; no
<span style="color:maroon">SYSINIT:441B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:441B
SYSINIT:441B </span><span style="color:navy">loc_844B:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:441B                 </span><span style="color:navy">clc
</span><span style="color:maroon">SYSINIT:441C                 </span><span style="color:navy">retn                    </span>; yes, so modify the fgnd intensity
<span style="color:maroon">SYSINIT:441D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:441D
SYSINIT:441D </span><span style="color:navy">loc_844D:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:441D                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:441E                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:441F                 </span><span style="color:navy">sub     ax, ax
</span><span style="color:maroon">SYSINIT:4421                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">SYSINIT:4423                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:4423                 </span><span style="color:navy">mov     ax, es:[si]
</span><span style="color:maroon">SYSINIT:4426                 </span><span style="color:navy">cmp     ax, word ptr cs:</span>_$MenuHeader<span style="color:navy">+</span><span style="color:green">16h
</span><span style="color:maroon">SYSINIT:442B                 </span><span style="color:navy">jnz     short loc_8464
</span><span style="color:maroon">SYSINIT:442D                 </span><span style="color:navy">and     byte ptr ds:loc_4446+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">0DFh
</span><span style="color:maroon">SYSINIT:4432                 </span><span style="color:navy">jmp     short loc_8471
</span><span style="color:maroon">SYSINIT:4434 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4434
SYSINIT:4434 </span><span style="color:navy">loc_8464:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4434                 </span><span style="color:navy">cmp     ax, word ptr cs:</span>_$MenuHeader<span style="color:navy">+</span><span style="color:green">14h
</span><span style="color:maroon">SYSINIT:4439                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:443A                 </span><span style="color:navy">jnz     short loc_8471
</span><span style="color:maroon">SYSINIT:443C                 </span><span style="color:navy">or      byte ptr ds:</span>bds3<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">, </span><span style="color:green">20h
</span><span style="color:maroon">SYSINIT:4441
SYSINIT:4441 </span><span style="color:navy">loc_8471:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4441                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4442                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:4442                 </span><span style="color:navy">pop     ax              </span>; get first char of current line
<span style="color:maroon">SYSINIT:4443                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4444 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4444
SYSINIT:4444 </span><span style="color:navy">loc_8474:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4444                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:4445                 </span><span style="color:navy">push    si              </span>; could happen if menu block at end (rare)
<span style="color:maroon">SYSINIT:4446                 </span><span style="color:navy">sub     bx, bx
</span><span style="color:maroon">SYSINIT:4448
SYSINIT:4448 </span><span style="color:navy">loc_8478:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4448                 </span><span style="color:navy">call    near ptr unk_8BD3
</span><span style="color:maroon">SYSINIT:444B                 </span><span style="color:navy">jb      short loc_84C9  </span>; BEGIN implies END
<span style="color:maroon">SYSINIT:444D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Bh </span><span style="color:gray">; &#039;[&#039;   </span>; CONFIG_SUBMENU
<span style="color:maroon">SYSINIT:444F                 </span><span style="color:navy">jnz     short loc_8484  </span>; go process sub-menu
<span style="color:maroon">SYSINIT:4451                 </span><span style="color:navy">inc     bx              </span>; CONFIG_MENUITEM
<span style="color:maroon">SYSINIT:4452                 </span><span style="color:navy">jmp     short loc_84C4
</span><span style="color:maroon">SYSINIT:4454 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4454
SYSINIT:4454 </span><span style="color:navy">loc_8484:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4454                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">4Eh </span><span style="color:gray">; &#039;N&#039;
</span><span style="color:maroon">SYSINIT:4456                 </span><span style="color:navy">jnz     short loc_8496
</span><span style="color:maroon">SYSINIT:4458                 </span><span style="color:navy">or      bx, bx
</span><span style="color:maroon">SYSINIT:445A                 </span><span style="color:navy">jnz     short loc_84C4
</span><span style="color:maroon">SYSINIT:445C                 </span><span style="color:navy">call    loc_844D
</span><span style="color:maroon">SYSINIT:445F                 </span><span style="color:navy">mov     byte ptr es:[si-</span><span style="color:green">1</span><span style="color:navy">], </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:maroon">SYSINIT:4464                 </span><span style="color:navy">jmp     short loc_84C4
</span><span style="color:maroon">SYSINIT:4466 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4466
SYSINIT:4466 </span><span style="color:navy">loc_8496:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4466                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">31h </span><span style="color:gray">; &#039;1&#039;
</span><span style="color:maroon">SYSINIT:4468                 </span><span style="color:navy">jnz     short loc_84C4
</span><span style="color:maroon">SYSINIT:446A
SYSINIT:446A </span><span style="color:navy">loc_849A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:446A                 </span><span style="color:navy">call    near ptr unk_8BD3
</span><span style="color:maroon">SYSINIT:446D
SYSINIT:446D </span><span style="color:navy">loc_849D:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:446D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:446F                 </span><span style="color:navy">jz      short loc_84C4
</span><span style="color:maroon">SYSINIT:4471                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;
</span><span style="color:maroon">SYSINIT:4473                 </span><span style="color:navy">jnz     short loc_849A
</span><span style="color:maroon">SYSINIT:4475                 </span><span style="color:navy">call    near ptr unk_8BD3
</span><span style="color:maroon">SYSINIT:4478                 </span><span style="color:navy">and     al, </span><span style="color:green">0DFh
</span><span style="color:maroon">SYSINIT:447A                 </span><span style="color:navy">cmp     al, ds:</span><span style="color:green">2216h
</span><span style="color:maroon">SYSINIT:447E                 </span><span style="color:navy">jnz     short loc_84B7
</span><span style="color:maroon">SYSINIT:4480                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">52A4h</span><span style="color:navy">, </span><span style="color:green">1 </span>; secElapsed is only zero for the FIRST menu,
<span style="color:maroon">SYSINIT:4485                 </span><span style="color:navy">jmp     short loc_849A  </span>; secElapsed becomes -1 forever as soon as
<span style="color:maroon">SYSINIT:4487 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4487
SYSINIT:4487 </span><span style="color:navy">loc_84B7:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4487                 </span><span style="color:navy">cmp     al, ds:</span><span style="color:green">2222h    </span>; something is typed
<span style="color:maroon">SYSINIT:448B                 </span><span style="color:navy">jnz     short loc_849D
</span><span style="color:maroon">SYSINIT:448D                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">52A4h</span><span style="color:navy">, </span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:4492                 </span><span style="color:navy">jmp     short loc_849A
</span><span style="color:maroon">SYSINIT:4494 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4494
SYSINIT:4494 </span><span style="color:navy">loc_84C4:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4494                 </span><span style="color:navy">call    loc_8BA3        </span>; (besides, 99 is the largest # my simple
<span style="color:maroon">SYSINIT:4497                 </span><span style="color:navy">jmp     short loc_8478
</span><span style="color:maroon">SYSINIT:4499 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4499
SYSINIT:4499 </span><span style="color:navy">loc_84C9:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4499                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:449A                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:449B                 </span><span style="color:navy">test    byte ptr ds:</span><span style="color:green">52A4h</span><span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:44A0                 </span><span style="color:navy">jnz     short loc_84DA
</span><span style="color:maroon">SYSINIT:44A2                 </span><span style="color:navy">call    loc_83C4
</span><span style="color:maroon">SYSINIT:44A5                 </span><span style="color:navy">jnb     short loc_84DA
</span><span style="color:maroon">SYSINIT:44A7                 </span><span style="color:navy">jmp     loc_86D3
</span><span style="color:maroon">SYSINIT:44AA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:44AA
SYSINIT:44AA </span><span style="color:navy">loc_84DA:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:44AA                 </span><span style="color:navy">sub     bx, bx
</span><span style="color:maroon">SYSINIT:44AC                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">52E9h
</span><span style="color:maroon">SYSINIT:44AF                 </span><span style="color:navy">call    loc_88FF
</span><span style="color:maroon">SYSINIT:44B2                 </span><span style="color:navy">jnb     short loc_8524
</span><span style="color:maroon">SYSINIT:44B4                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">52E1h</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:44B9                 </span><span style="color:navy">jmp     loc_8703        </span>;
<span style="color:maroon">SYSINIT:44B9                                         </span>; There should be a description immediately following
<span style="color:maroon">SYSINIT:44B9                                         </span>; the block name on MENUITEM line; failing that,
<span style="color:maroon">SYSINIT:44B9                                         </span>; we&#039;ll just use the block name as the description...
<span style="color:maroon">SYSINIT:44BC </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:44BC
SYSINIT:44BC </span><span style="color:navy">loc_84EC:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:44BC                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:44BD                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">SYSINIT:44BE                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">7
</span><span style="color:maroon">SYSINIT:44C1                 </span><span style="color:navy">call    loc_8BB1        </span>; skip_delim modifies BX, so stash it in DI
<span style="color:maroon">SYSINIT:44C4                 </span><span style="color:navy">and     bl, </span><span style="color:green">0Fh
</span><span style="color:maroon">SYSINIT:44C7                 </span><span style="color:navy">mov     ch, bl
</span><span style="color:maroon">SYSINIT:44C9                 </span><span style="color:navy">and     dl, </span><span style="color:green">0F0h
</span><span style="color:maroon">SYSINIT:44CC                 </span><span style="color:navy">or      dl, bl
</span><span style="color:maroon">SYSINIT:44CE                 </span><span style="color:navy">call    loc_8D51
</span><span style="color:maroon">SYSINIT:44D1                 </span><span style="color:navy">jnz     short loc_8514
</span><span style="color:maroon">SYSINIT:44D3                 </span><span style="color:navy">call    loc_8BB1
</span><span style="color:maroon">SYSINIT:44D6                 </span><span style="color:navy">and     bl, </span><span style="color:green">0Fh         </span>; go back for more lines
<span style="color:maroon">SYSINIT:44D9                 </span><span style="color:navy">mov     dh, bl          </span>; Display menu items now,
<span style="color:maroon">SYSINIT:44D9                                         </span>; after determining which one is default
<span style="color:maroon">SYSINIT:44D9                                         </span>;
<span style="color:maroon">SYSINIT:44D9                                         </span>; where there any valid blocks at all?
<span style="color:maroon">SYSINIT:44DB                 </span><span style="color:navy">and     dl, </span><span style="color:green">0Fh         </span>; yes
<span style="color:maroon">SYSINIT:44DE                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4
</span><span style="color:maroon">SYSINIT:44E0                 </span><span style="color:navy">shl     bl, cl
</span><span style="color:maroon">SYSINIT:44E2                 </span><span style="color:navy">or      dl, bl
</span><span style="color:maroon">SYSINIT:44E4
SYSINIT:44E4 </span><span style="color:navy">loc_8514:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:44E4                 </span><span style="color:navy">cmp     ch, dh          </span>; first, record how many blocks we found
<span style="color:maroon">SYSINIT:44E6                 </span><span style="color:navy">jnz     short loc_851B
</span><span style="color:maroon">SYSINIT:44E8                 </span><span style="color:navy">xor     dl, offset </span>stacks
<span style="color:maroon">SYSINIT:44EB
SYSINIT:44EB </span><span style="color:navy">loc_851B:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:44EB                 </span><span style="color:navy">mov     ds:</span><span style="color:green">529Fh</span><span style="color:navy">, dl
</span><span style="color:maroon">SYSINIT:44EF                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">SYSINIT:44F0                 </span><span style="color:navy">pop     cx              </span>; yes, walk name table, looking for default
<span style="color:maroon">SYSINIT:44F1                 </span><span style="color:navy">jmp     loc_85CF
</span><span style="color:maroon">SYSINIT:44F4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:44F4
SYSINIT:44F4 </span><span style="color:navy">loc_8524:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:44F4                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">52A9h</span><span style="color:navy">, (offset </span>SYSINIT$<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">)
</span><span style="color:maroon">SYSINIT:44F9                 </span><span style="color:navy">mov     word ptr ds:</span><span style="color:green">52ABh</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:44FF                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">52ADh</span><span style="color:navy">, </span><span style="color:#ff8000">0FFh
</span><span style="color:maroon">SYSINIT:4504                 </span><span style="color:navy">and     byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">0FDh
</span><span style="color:maroon">SYSINIT:4509                 </span><span style="color:navy">call    loc_8BA3
</span><span style="color:maroon">SYSINIT:450C                 </span><span style="color:navy">sub     dx, dx          </span>; if no default, force default to #1
<span style="color:maroon">SYSINIT:450E
SYSINIT:450E </span><span style="color:navy">loc_853E:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:450E                 </span><span style="color:navy">call    near ptr unk_8BD3 </span>; yes, this will be the initial current block
<span style="color:maroon">SYSINIT:450E                                         </span>;
<span style="color:maroon">SYSINIT:450E                                         </span>; If the timeout was explicitly set to 0 (or technically,
<span style="color:maroon">SYSINIT:450E                                         </span>; anything that failed to resolve to a number, like &quot;NONE&quot;
<span style="color:maroon">SYSINIT:450E                                         </span>; or &quot;EAT POTATOES&quot;), then we&#039;re supposed to skip menu display
<span style="color:maroon">SYSINIT:450E                                         </span>; and run with the specified default block; however,
<span style="color:maroon">SYSINIT:450E                                         </span>; if the user hit Enter prior to boot, thereby requesting fully
<span style="color:maroon">SYSINIT:450E                                         </span>; INTERACTIVE boot, then we shall display the menu block anyway
<span style="color:maroon">SYSINIT:450E                                         </span>; (though still with no timeout)
<span style="color:maroon">SYSINIT:4511                 </span><span style="color:navy">jb      short loc_8571
</span><span style="color:maroon">SYSINIT:4513                 </span><span style="color:navy">and     al, </span><span style="color:green">7Fh
</span><span style="color:maroon">SYSINIT:4515                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Bh </span><span style="color:gray">; &#039;[&#039;
</span><span style="color:maroon">SYSINIT:4517                 </span><span style="color:navy">jz      short loc_8571  </span>; no
<span style="color:maroon">SYSINIT:4519                 </span><span style="color:navy">cmp     al, </span><span style="color:green">4Fh         </span>; yes, but was INTERACTIVE requested?
<span style="color:maroon">SYSINIT:451B                 </span><span style="color:navy">jz      short loc_859A
</span><span style="color:maroon">SYSINIT:451D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">45h </span><span style="color:gray">; &#039;E&#039;
</span><span style="color:maroon">SYSINIT:451F                 </span><span style="color:navy">jz      short loc_859A
</span><span style="color:maroon">SYSINIT:4521                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">41h </span><span style="color:gray">; &#039;A&#039;
</span><span style="color:maroon">SYSINIT:4523                 </span><span style="color:navy">jz      short loc_8573  </span>; Reset the mode,
<span style="color:maroon">SYSINIT:4523                                         </span>; so that we know screen is clean and cursor is home
<span style="color:maroon">SYSINIT:4523                                         </span>; ;
<span style="color:maroon">SYSINIT:4525                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">52h </span><span style="color:gray">; &#039;R&#039;   </span>; - VIDEO - GET CURRENT VIDEO MODE
<span style="color:maroon">SYSINIT:4525                                         </span>; Return: AH = number of columns on screen
<span style="color:maroon">SYSINIT:4525                                         </span>; AL = current video mode
<span style="color:maroon">SYSINIT:4525                                         </span>; BH = current active display page
<span style="color:maroon">SYSINIT:4527                 </span><span style="color:navy">jz      short loc_84EC
</span><span style="color:maroon">SYSINIT:4529                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">4Eh </span><span style="color:gray">; &#039;N&#039;   </span>; - VIDEO - SET VIDEO MODE
<span style="color:maroon">SYSINIT:4529                                         </span>; AL = mode
<span style="color:maroon">SYSINIT:452B                 </span><span style="color:navy">jz      short loc_856C
</span><span style="color:maroon">SYSINIT:452D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:maroon">SYSINIT:452F                 </span><span style="color:navy">jz      short loc_85CF  </span>; and save the current (default) video page
<span style="color:maroon">SYSINIT:4531                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:4531                 </span><span style="color:navy">call    loc_8D41        </span>; start address and page #, in case the
<span style="color:maroon">SYSINIT:4534                 </span><span style="color:navy">jz      short loc_85CF
</span><span style="color:maroon">SYSINIT:4536                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:4537                 </span><span style="color:navy">call    loc_8CAA
</span><span style="color:maroon">SYSINIT:453A                 </span><span style="color:navy">jmp     short loc_85CF
</span><span style="color:maroon">SYSINIT:453C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:453C
SYSINIT:453C </span><span style="color:navy">loc_856C:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:453C                 </span><span style="color:navy">call    loc_844D
</span><span style="color:maroon">SYSINIT:453F                 </span><span style="color:navy">jmp     short loc_85CF  </span>; select new page for menu
<span style="color:maroon">SYSINIT:4541 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4541
SYSINIT:4541 </span><span style="color:navy">loc_8571:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4541                 </span><span style="color:navy">jmp     short loc_85D5
</span><span style="color:maroon">SYSINIT:4543 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4543
SYSINIT:4543 </span><span style="color:navy">loc_8573:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4543                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52ABh</span><span style="color:navy">, si
</span><span style="color:maroon">SYSINIT:4547                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">52AEh</span><span style="color:navy">, offset </span>SYSINIT$ ; using this color
<span style="color:maroon">SYSINIT:454C                 </span><span style="color:navy">jnz     short loc_8598
</span><span style="color:maroon">SYSINIT:454E                 </span><span style="color:navy">call    loc_8B7D
</span><span style="color:maroon">SYSINIT:4551                 </span><span style="color:navy">jb      short loc_85CF
</span><span style="color:maroon">SYSINIT:4553                 </span><span style="color:navy">call    </span>input_loop
<span style="color:maroon">SYSINIT:4556                 </span><span style="color:navy">jb      short loc_85CF
</span><span style="color:maroon">SYSINIT:4558                 </span><span style="color:navy">mov     si, bx
</span><span style="color:maroon">SYSINIT:455A                 </span><span style="color:navy">call    loc_8BB1
</span><span style="color:maroon">SYSINIT:455D                 </span><span style="color:navy">cmp     bl, (offset </span>old0A<span style="color:navy">+</span><span style="color:green">1</span><span style="color:navy">) </span>; no, use a default
<span style="color:maroon">SYSINIT:4560                 </span><span style="color:navy">jb      short loc_8594
</span><span style="color:maroon">SYSINIT:4562                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;
</span><span style="color:maroon">SYSINIT:4564                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:4564
SYSINIT:4564 </span><span style="color:navy">loc_8594:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4564                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52ADh</span><span style="color:navy">, bl
</span><span style="color:maroon">SYSINIT:4568
SYSINIT:4568 </span><span style="color:navy">loc_8598:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4568                 </span><span style="color:navy">jmp     short loc_85CF
</span><span style="color:maroon">SYSINIT:456A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:456A
SYSINIT:456A </span><span style="color:navy">loc_859A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:456A                 </span><span style="color:navy">cmp     dl, </span><span style="color:#ff8000">9
</span><span style="color:maroon">SYSINIT:456D                 </span><span style="color:navy">jnb     short loc_85CF
</span><span style="color:maroon">SYSINIT:456F                 </span><span style="color:navy">mov     di, si
</span><span style="color:maroon">SYSINIT:4571                 </span><span style="color:navy">call    loc_88E6
</span><span style="color:maroon">SYSINIT:4574                 </span><span style="color:navy">jz      short loc_85AC
</span><span style="color:maroon">SYSINIT:4576                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:4577                 </span><span style="color:navy">call    loc_8CAA
</span><span style="color:maroon">SYSINIT:457A                 </span><span style="color:navy">jmp     short loc_85CF
</span><span style="color:maroon">SYSINIT:457C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:457C
SYSINIT:457C </span><span style="color:navy">loc_85AC:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:457C                 </span><span style="color:navy">inc     dx
</span><span style="color:maroon">SYSINIT:457D                 </span><span style="color:navy">mov     bx, dx          </span>; print the status line on row DH, col 0
<span style="color:maroon">SYSINIT:457F                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">52AFh</span><span style="color:navy">], al  </span>; now that we can trash the cursor position
<span style="color:maroon">SYSINIT:4583                 </span><span style="color:navy">add     bx, bx
</span><span style="color:maroon">SYSINIT:4585                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">52B9h</span><span style="color:navy">], si
</span><span style="color:maroon">SYSINIT:4589                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">52CDh</span><span style="color:navy">], si  </span>; get cursor position
<span style="color:maroon">SYSINIT:458D                 </span><span style="color:navy">mov     di, bx
</span><span style="color:maroon">SYSINIT:458F                 </span><span style="color:navy">call    loc_8B7D
</span><span style="color:maroon">SYSINIT:4592                 </span><span style="color:navy">jb      short loc_85CF
</span><span style="color:maroon">SYSINIT:4594                 </span><span style="color:navy">call    </span>input_loop      ; now prepare to display all the menu items
<span style="color:maroon">SYSINIT:4597                 </span><span style="color:navy">jb      short loc_85CF  </span>; print item #BL
<span style="color:maroon">SYSINIT:4599                 </span><span style="color:navy">xchg    bx, di
</span><span style="color:maroon">SYSINIT:459B                 </span><span style="color:navy">mov     [bx+</span><span style="color:#ff8000">52CDh</span><span style="color:navy">], di  </span>; all done?
<span style="color:maroon">SYSINIT:459F
SYSINIT:459F </span><span style="color:navy">loc_85CF:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:459F                 </span><span style="color:navy">call    loc_8BA3        </span>; not yet
<span style="color:maroon">SYSINIT:45A2                 </span><span style="color:navy">jmp     loc_853E
</span><span style="color:maroon">SYSINIT:45A5 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:45A5
SYSINIT:45A5 </span><span style="color:navy">loc_85D5:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:45A5                 </span><span style="color:navy">or      dl, dl          </span>; select row below menu
<span style="color:maroon">SYSINIT:45A7                 </span><span style="color:navy">jnz     short loc_85DE
</span><span style="color:maroon">SYSINIT:45A9                 </span><span style="color:navy">sub     bx, bx
</span><span style="color:maroon">SYSINIT:45AB                 </span><span style="color:navy">jmp     loc_86CB
</span><span style="color:maroon">SYSINIT:45AE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:45AE
SYSINIT:45AE </span><span style="color:navy">loc_85DE:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:45AE                 </span><span style="color:navy">sub     bx, bx          </span>; - VIDEO - SET CURSOR POSITION
<span style="color:maroon">SYSINIT:45AE                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:maroon">SYSINIT:45AE                                         </span>; BH = page number
<span style="color:maroon">SYSINIT:45B0                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52AAh</span><span style="color:navy">, dl
</span><span style="color:maroon">SYSINIT:45B4                 </span><span style="color:navy">mov     di, ds:</span><span style="color:green">52ABh
</span><span style="color:maroon">SYSINIT:45B8                 </span><span style="color:navy">or      di, di
</span><span style="color:maroon">SYSINIT:45BA                 </span><span style="color:navy">jz      short loc_8608
</span><span style="color:maroon">SYSINIT:45BC                 </span><span style="color:navy">inc     bx
</span><span style="color:maroon">SYSINIT:45BD
SYSINIT:45BD </span><span style="color:navy">loc_85ED:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:45BD                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">SYSINIT:45BE                 </span><span style="color:navy">add     bx, bx
</span><span style="color:maroon">SYSINIT:45C0                 </span><span style="color:navy">mov     si, [bx+</span><span style="color:#ff8000">52B9h</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:45C4                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">80h </span><span style="color:gray">; &#039;&#039;
</span><span style="color:maroon">SYSINIT:45C7                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:45C8                 </span><span style="color:navy">push    es              </span>; clear the status line now
<span style="color:maroon">SYSINIT:45C9                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:45CA                 </span><span style="color:navy">call    loc_8927
</span><span style="color:maroon">SYSINIT:45CD                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:45CE                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">SYSINIT:45CF                 </span><span style="color:navy">jz      short loc_860A  </span>; -1 ; clean boot requested?
<span style="color:maroon">SYSINIT:45D1                 </span><span style="color:navy">inc     bx
</span><span style="color:maroon">SYSINIT:45D2                 </span><span style="color:navy">cmp     bl, ds:</span><span style="color:green">52AAh
</span><span style="color:maroon">SYSINIT:45D6                 </span><span style="color:navy">jbe     short loc_85ED
</span><span style="color:maroon">SYSINIT:45D8
SYSINIT:45D8 </span><span style="color:navy">loc_8608:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:45D8                 </span><span style="color:navy">mov     bl, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:45DA
SYSINIT:45DA </span><span style="color:navy">loc_860A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:45DA                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52A9h</span><span style="color:navy">, bl
</span><span style="color:maroon">SYSINIT:45DE                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">52ADh</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:45E3                 </span><span style="color:navy">jnz     short loc_861F
</span><span style="color:maroon">SYSINIT:45E5                 </span><span style="color:navy">test    byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:45EA                 </span><span style="color:navy">jnz     short loc_861F  </span>; CONFIG_SUBMENU
<span style="color:maroon">SYSINIT:45EC                 </span><span style="color:navy">jmp     loc_86E6
</span><span style="color:maroon">SYSINIT:45EF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:45EF
SYSINIT:45EF </span><span style="color:navy">loc_861F:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:45EF                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0Fh
</span><span style="color:maroon">SYSINIT:45F1                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - GET CURRENT VIDEO MODE
<span style="color:maroon">SYSINIT:45F1                                         </span>; Return: AH = number of columns on screen
<span style="color:maroon">SYSINIT:45F1                                         </span>; AL = current video mode
<span style="color:maroon">SYSINIT:45F1                                         </span>; BH = current active display page
<span style="color:maroon">SYSINIT:45F3                 </span><span style="color:navy">mov     ah, offset </span>SYSINIT$
<span style="color:maroon">SYSINIT:45F5                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - GET CURRENT VIDEO MODE
<span style="color:maroon">SYSINIT:45F5                                         </span>; Return: AH = number of columns on screen
<span style="color:maroon">SYSINIT:45F5                                         </span>; AL = current video mode
<span style="color:maroon">SYSINIT:45F5                                         </span>; BH = current active display page
<span style="color:maroon">SYSINIT:45F7                 </span><span style="color:navy">push    es              </span>; THIS CANNOT FAIL!
<span style="color:maroon">SYSINIT:45F8                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">40h </span><span style="color:gray">; &#039;@&#039;
</span><span style="color:maroon">SYSINIT:45FB                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:45FD                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:45FD                 </span><span style="color:navy">mov     ax, es:</span><span style="color:green">4Eh
</span><span style="color:maroon">SYSINIT:4601                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52A6h</span><span style="color:navy">, ax    </span>; get BX -&gt; name of selected block
<span style="color:maroon">SYSINIT:4604                 </span><span style="color:navy">mov     al, es:</span><span style="color:green">62h
</span><span style="color:maroon">SYSINIT:4608                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52A5h</span><span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:460B                 </span><span style="color:navy">mov     ax, ds:word_92D0 </span>; reset ES:SI and CX for reprocessing
<span style="color:maroon">SYSINIT:460E                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SELECT DISPLAY PAGE
<span style="color:maroon">SYSINIT:460E                                         </span>; AL = display page, 0-7  for modes 0 &amp; 1, 0-3  for modes 2 &amp; 3
<span style="color:maroon">SYSINIT:4610                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">600h
</span><span style="color:maroon">SYSINIT:4613                 </span><span style="color:navy">mov     bh, ds:</span><span style="color:green">529Fh
</span><span style="color:maroon">SYSINIT:4617                 </span><span style="color:navy">sub     cx, cx
</span><span style="color:maroon">SYSINIT:4619                 </span><span style="color:navy">mov     dl, es:</span><span style="color:green">4Ah
</span><span style="color:maroon">SYSINIT:461E                 </span><span style="color:navy">dec     dl
</span><span style="color:maroon">SYSINIT:4620                 </span><span style="color:navy">mov     dh, es:</span><span style="color:green">84h
</span><span style="color:maroon">SYSINIT:4625                 </span><span style="color:navy">or      dh, dh
</span><span style="color:maroon">SYSINIT:4627                 </span><span style="color:navy">jnz     short loc_865D
</span><span style="color:maroon">SYSINIT:4629                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:4629                 </span><span style="color:navy">mov     dh, byte ptr word_92D3
</span><span style="color:maroon">SYSINIT:462D                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:462D
SYSINIT:462D </span><span style="color:navy">loc_865D:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:462D                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SELECT DISPLAY PAGE
<span style="color:maroon">SYSINIT:462D                                         </span>; AL = display page, 0-7  for modes 0 &amp; 1, 0-3  for modes 2 &amp; 3
<span style="color:maroon">SYSINIT:462F                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:4630                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:4630                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52A3h</span><span style="color:navy">, dh
</span><span style="color:maroon">SYSINIT:4634                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">57F2h
</span><span style="color:maroon">SYSINIT:4637                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:463A                 </span><span style="color:navy">test    byte ptr ds:</span><span style="color:green">52A4h</span><span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:463F                 </span><span style="color:navy">jnz     short loc_8690
</span><span style="color:maroon">SYSINIT:4641                 </span><span style="color:navy">mov     bh, ds:</span><span style="color:green">52A0h
</span><span style="color:maroon">SYSINIT:4645                 </span><span style="color:navy">mov     dh, ds:</span><span style="color:green">52A3h
</span><span style="color:maroon">SYSINIT:4649                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:464B                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2           </span>; this ain&#039;t the block we wanted, so skip it
<span style="color:maroon">SYSINIT:464D                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO -
<span style="color:maroon">SYSINIT:464F                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">583Eh
</span><span style="color:maroon">SYSINIT:4652                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:4655                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">3           </span>; CONFIG_BEGIN
<span style="color:maroon">SYSINIT:4657                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - READ CURSOR POSITION
<span style="color:maroon">SYSINIT:4657                                         </span>; BH = page number
<span style="color:maroon">SYSINIT:4657                                         </span>; Return: DH,DL = row,column, CH = cursor start line, CL = cursor end line
<span style="color:maroon">SYSINIT:4659                 </span><span style="color:navy">sub     dl, </span><span style="color:#ff8000">2           </span>; anything else is just skipped
<span style="color:maroon">SYSINIT:465C                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52A2h</span><span style="color:navy">, dl
</span><span style="color:maroon">SYSINIT:4660
SYSINIT:4660 </span><span style="color:navy">loc_8690:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4660                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:4663
SYSINIT:4663 </span><span style="color:navy">loc_8693:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4663                 </span><span style="color:navy">call    sub_8956
</span><span style="color:maroon">SYSINIT:4666                 </span><span style="color:navy">inc     bx
</span><span style="color:maroon">SYSINIT:4667                 </span><span style="color:navy">cmp     bl, ds:</span><span style="color:green">52AAh
</span><span style="color:maroon">SYSINIT:466B                 </span><span style="color:navy">jbe     short loc_8693
</span><span style="color:maroon">SYSINIT:466D                 </span><span style="color:navy">mov     dl, </span><span style="color:green">0           </span>; 128-7 ; put an upper limit on the name, to be safe
<span style="color:maroon">SYSINIT:466F                 </span><span style="color:navy">mov     dh, bl
</span><span style="color:maroon">SYSINIT:4671                 </span><span style="color:navy">add     dh, </span><span style="color:#ff8000">4
</span><span style="color:maroon">SYSINIT:4674                 </span><span style="color:navy">mov     bh, ds:</span><span style="color:green">52A0h
</span><span style="color:maroon">SYSINIT:4678                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:maroon">SYSINIT:467A                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO -
<span style="color:maroon">SYSINIT:467C                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">582Bh
</span><span style="color:maroon">SYSINIT:467F                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:4682                 </span><span style="color:navy">call    loc_89EE
</span><span style="color:maroon">SYSINIT:4685                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">55C2h
</span><span style="color:maroon">SYSINIT:4688                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:468B                 </span><span style="color:navy">push    word ptr ds:</span><span style="color:green">52A4h
</span><span style="color:maroon">SYSINIT:468F                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">52A4h</span><span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:4694                 </span><span style="color:navy">call    loc_8B3E
</span><span style="color:maroon">SYSINIT:4697                 </span><span style="color:navy">pop     word ptr ds:</span><span style="color:green">52A4h
</span><span style="color:maroon">SYSINIT:469B
SYSINIT:469B </span><span style="color:navy">loc_86CB:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:469B                 </span><span style="color:navy">cmp     bx, </span><span style="color:green">0FFFFh      </span>; moved!
<span style="color:maroon">SYSINIT:469E                 </span><span style="color:navy">jnz     short loc_86D8
</span><span style="color:maroon">SYSINIT:46A0                 </span><span style="color:navy">call    loc_8CDE        </span>; Now that the config_wrkseg is available once again,
<span style="color:maroon">SYSINIT:46A0                                         </span>; we shall use it to create an environment. The first
<span style="color:maroon">SYSINIT:46A0                                         </span>; thing to go in will be the &quot;CONFIG=configuration&quot; thing.
<span style="color:maroon">SYSINIT:46A0                                         </span>; It is also important to zero the first byte of the workspace,
<span style="color:maroon">SYSINIT:46A0                                         </span>; so that copy_envvar knows the buffer is empty.
<span style="color:maroon">SYSINIT:46A3
SYSINIT:46A3 </span><span style="color:navy">loc_86D3:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:46A3                 </span><span style="color:navy">sub     cx, cx
</span><span style="color:maroon">SYSINIT:46A5                 </span><span style="color:navy">jmp     loc_87C7        </span>; empty the environment block
<span style="color:maroon">SYSINIT:46A8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:46A8
SYSINIT:46A8 </span><span style="color:navy">loc_86D8:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:46A8                 </span><span style="color:navy">cmp     bx, </span><span style="color:green">0FFFEh
</span><span style="color:maroon">SYSINIT:46AB                 </span><span style="color:navy">jnz     short loc_86E6  </span>; copy envvar at ES:SI to &quot;config_wrkseg&quot;
<span style="color:maroon">SYSINIT:46AD                 </span><span style="color:navy">mov     cx, ds:</span><span style="color:green">356h
</span><span style="color:maroon">SYSINIT:46B1                 </span><span style="color:navy">sub     si, si
</span><span style="color:maroon">SYSINIT:46B3                 </span><span style="color:navy">jmp     loc_84DA
</span><span style="color:maroon">SYSINIT:46B6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:46B6
SYSINIT:46B6 </span><span style="color:navy">loc_86E6:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:46B6                 </span><span style="color:navy">cmp     byte ptr [bx+</span><span style="color:#ff8000">52AFh</span><span style="color:navy">], </span><span style="color:#ff8000">4Fh </span><span style="color:gray">; &#039;O&#039;
</span><span style="color:maroon">SYSINIT:46BB                 </span><span style="color:navy">jnz     short loc_86FD
</span><span style="color:maroon">SYSINIT:46BD                 </span><span style="color:navy">add     bx, bx
</span><span style="color:maroon">SYSINIT:46BF                 </span><span style="color:navy">mov     di, [bx+</span><span style="color:#ff8000">52B9h</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:46C3                 </span><span style="color:navy">call    loc_88E6
</span><span style="color:maroon">SYSINIT:46C6                 </span><span style="color:navy">mov     si, di
</span><span style="color:maroon">SYSINIT:46C8                 </span><span style="color:navy">mov     cx, bx
</span><span style="color:maroon">SYSINIT:46CA                 </span><span style="color:navy">jmp     loc_8524
</span><span style="color:maroon">SYSINIT:46CD </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:46CD
SYSINIT:46CD </span><span style="color:navy">loc_86FD:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:46CD                 </span><span style="color:navy">add     bx, bx
</span><span style="color:maroon">SYSINIT:46CF                 </span><span style="color:navy">mov     bx, [bx+</span><span style="color:#ff8000">52B9h</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:46D3
SYSINIT:46D3 </span><span style="color:navy">loc_8703:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:46D3                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52ABh</span><span style="color:navy">, bx
</span><span style="color:maroon">SYSINIT:46D7                 </span><span style="color:navy">mov     cx, ds:</span><span style="color:green">356h
</span><span style="color:maroon">SYSINIT:46DB                 </span><span style="color:navy">sub     si, si
</span><span style="color:maroon">SYSINIT:46DD                 </span><span style="color:navy">push    ds              </span>; DS:SI to point to envvar
<span style="color:maroon">SYSINIT:46DE                 </span><span style="color:navy">mov     ds, word ptr ds:</span><span style="color:green">178Eh
</span><span style="color:maroon">SYSINIT:46E2                 </span><span style="color:navy">sub     di, di
</span><span style="color:maroon">SYSINIT:46E4
SYSINIT:46E4 </span><span style="color:navy">loc_8714:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:46E4                 </span><span style="color:navy">push    bx              </span>; yes, abort
<span style="color:maroon">SYSINIT:46E5                 </span><span style="color:navy">call    </span>next_line
<span style="color:maroon">SYSINIT:46E8                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">SYSINIT:46E9                 </span><span style="color:navy">jb      short loc_8757
</span><span style="color:maroon">SYSINIT:46EB
SYSINIT:46EB </span><span style="color:navy">loc_871B:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:46EB                 </span><span style="color:navy">push    ax              </span>; lf
<span style="color:maroon">SYSINIT:46EC                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:46ED                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:46EE                 </span><span style="color:navy">push    di
</span><span style="color:maroon">SYSINIT:46EF                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">52EEh
</span><span style="color:maroon">SYSINIT:46F2                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:46F3                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:46F4                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:46F5                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:46F5                 </span><span style="color:navy">call    loc_8927
</span><span style="color:maroon">SYSINIT:46F8                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:46F9                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:46F9                 </span><span style="color:navy">pop     di              </span>; back up to given varname
<span style="color:maroon">SYSINIT:46FA                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:46FB                 </span><span style="color:navy">pop     cx              </span>; CX == # of bytes in varname
<span style="color:maroon">SYSINIT:46FC                 </span><span style="color:navy">pop     ax              </span>; start looking for DS:SI at ES:0
<span style="color:maroon">SYSINIT:46FD                 </span><span style="color:navy">jz      short loc_873E
</span><span style="color:maroon">SYSINIT:46FF                 </span><span style="color:navy">or      bx, bx
</span><span style="color:maroon">SYSINIT:4701                 </span><span style="color:navy">jz      short loc_8747  </span>; search failed, just copy var
<span style="color:maroon">SYSINIT:4703                 </span><span style="color:navy">push    di              </span>; ES:BX -&gt; start of this varname
<span style="color:maroon">SYSINIT:4704                 </span><span style="color:navy">mov     di, bx
</span><span style="color:maroon">SYSINIT:4706                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:4707                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:4708                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4709                 </span><span style="color:navy">call    loc_8927
</span><span style="color:maroon">SYSINIT:470C                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:470D                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">SYSINIT:470E
SYSINIT:470E </span><span style="color:navy">loc_873E:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:470E                 </span><span style="color:navy">jb      short loc_8757
</span><span style="color:maroon">SYSINIT:4710                 </span><span style="color:navy">jnz     short loc_8747
</span><span style="color:maroon">SYSINIT:4712                 </span><span style="color:navy">call    loc_8BA3
</span><span style="color:maroon">SYSINIT:4715                 </span><span style="color:navy">jmp     short loc_8714
</span><span style="color:maroon">SYSINIT:4717 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4717
SYSINIT:4717 </span><span style="color:navy">loc_8747:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4717                 </span><span style="color:navy">call    loc_8BA3
</span><span style="color:maroon">SYSINIT:471A                 </span><span style="color:navy">call    near ptr unk_8BD3
</span><span style="color:maroon">SYSINIT:471D                 </span><span style="color:navy">jb      short loc_8757
</span><span style="color:maroon">SYSINIT:471F                 </span><span style="color:navy">and     al, </span><span style="color:green">7Fh
</span><span style="color:maroon">SYSINIT:4721                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Bh </span><span style="color:gray">; &#039;[&#039;
</span><span style="color:maroon">SYSINIT:4723                 </span><span style="color:navy">jz      short loc_871B
</span><span style="color:maroon">SYSINIT:4725                 </span><span style="color:navy">jmp     short loc_8747
</span><span style="color:maroon">SYSINIT:4727 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4727
SYSINIT:4727 </span><span style="color:navy">loc_8757:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4727                 </span><span style="color:navy">mov     cx, di
</span><span style="color:maroon">SYSINIT:4729                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:472A                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">7
</span><span style="color:maroon">SYSINIT:472D                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">52E1h
</span><span style="color:maroon">SYSINIT:4730                 </span><span style="color:navy">inc     di
</span><span style="color:maroon">SYSINIT:4731
SYSINIT:4731 </span><span style="color:navy">loc_8761:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4731                 </span><span style="color:navy">lods    byte ptr cs:[si]
</span><span style="color:maroon">SYSINIT:4733                 </span><span style="color:navy">mov     [di], al
</span><span style="color:maroon">SYSINIT:4735                 </span><span style="color:navy">inc     di
</span><span style="color:maroon">SYSINIT:4736                 </span><span style="color:navy">loop    loc_8761
</span><span style="color:maroon">SYSINIT:4738                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:4739                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">79h </span><span style="color:gray">; &#039;y&#039;
</span><span style="color:maroon">SYSINIT:473C                 </span><span style="color:navy">mov     si, word ptr cs:unk_92DB
</span><span style="color:maroon">SYSINIT:4741                 </span><span style="color:navy">or      si, si
</span><span style="color:maroon">SYSINIT:4743                 </span><span style="color:navy">jnz     short loc_877A
</span><span style="color:maroon">SYSINIT:4745                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:4746                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:4747                 </span>assume es:SYSINIT
<span style="color:maroon">SYSINIT:4747                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">52EEh
</span><span style="color:maroon">SYSINIT:474A
SYSINIT:474A </span><span style="color:navy">loc_877A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:474A                 </span><span style="color:navy">mov     al, es:[si]
</span><span style="color:maroon">SYSINIT:474D                 </span><span style="color:navy">call    loc_8D41
</span><span style="color:maroon">SYSINIT:4750                 </span><span style="color:navy">jz      short loc_8788
</span><span style="color:maroon">SYSINIT:4752                 </span><span style="color:navy">mov     [di], al
</span><span style="color:maroon">SYSINIT:4754                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4755                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:4755                 </span><span style="color:navy">inc     di
</span><span style="color:maroon">SYSINIT:4756                 </span><span style="color:navy">loop    loc_877A
</span><span style="color:maroon">SYSINIT:4758
SYSINIT:4758 </span><span style="color:navy">loc_8788:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4758                 </span><span style="color:navy">mov     byte ptr [di], </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:475B                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:475C                 </span><span style="color:navy">sub     di, di
</span><span style="color:maroon">SYSINIT:475E                 </span><span style="color:navy">mov     cs:</span>config_envlen<span style="color:navy">, di </span>; ~CONFIG_OPTION_QUERY
<span style="color:maroon">SYSINIT:4763                 </span><span style="color:navy">sub     si, si
</span><span style="color:maroon">SYSINIT:4765                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:4766                 </span><span style="color:navy">push    cx              </span>; AL == the original line code
<span style="color:maroon">SYSINIT:4767                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">SYSINIT:4769                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:476A                 </span><span style="color:navy">mov     ax, ds          </span>; CONFIG_REM
<span style="color:maroon">SYSINIT:476C                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:476D                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:476E                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:4770                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4771                 </span><span style="color:navy">mov     byte ptr es:</span><span style="color:green">0</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4777                 </span><span style="color:navy">call    loc_87D0
</span><span style="color:maroon">SYSINIT:477A                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:477B                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">52A0h</span><span style="color:navy">, </span><span style="color:#ff8000">0 </span>; don&#039;t allow INCLUDE COMMON
<span style="color:maroon">SYSINIT:4780                 </span><span style="color:navy">jz      short loc_87C7  </span>; try to find the block
<span style="color:maroon">SYSINIT:4782                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:4783                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">40h </span><span style="color:gray">; &#039;@&#039;
</span><span style="color:maroon">SYSINIT:4786                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">SYSINIT:4788                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:4788                 </span><span style="color:navy">mov     ax, ds:</span><span style="color:green">52A6h    </span>; no such block
<span style="color:maroon">SYSINIT:478B                 </span><span style="color:navy">mov     es:</span><span style="color:green">4Eh</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:478F                 </span><span style="color:navy">mov     al, ds:</span><span style="color:green">52A5h
</span><span style="color:maroon">SYSINIT:4792                 </span><span style="color:navy">mov     es:</span><span style="color:green">62h</span><span style="color:navy">, al
</span><span style="color:maroon">SYSINIT:4796                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:4797                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:4797
SYSINIT:4797 </span><span style="color:navy">loc_87C7:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4797                 </span><span style="color:navy">mov     ds:</span><span style="color:green">356h</span><span style="color:navy">, cx
</span><span style="color:maroon">SYSINIT:479B                 </span><span style="color:navy">mov     ds:</span><span style="color:green">358h</span><span style="color:navy">, cx
</span><span style="color:maroon">SYSINIT:479F                 </span><span style="color:navy">retn                    </span>; note that carry is clear, no pause
<span style="color:maroon">SYSINIT:47A0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:47A0
SYSINIT:47A0 </span><span style="color:navy">loc_87D0:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:47A0                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:47A1                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:47A2                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:47A3                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:47A4                 </span><span style="color:navy">push    es              </span>; Copy the line at ES:SI
<span style="color:maroon">SYSINIT:47A4                                         </span>;  to the current location at DS:DI
<span style="color:maroon">SYSINIT:47A5                 </span><span style="color:navy">mov     es, word ptr ds:</span><span style="color:green">178Eh
</span><span style="color:maroon">SYSINIT:47A9                 </span><span style="color:navy">pop     ds              </span>; no
<span style="color:maroon">SYSINIT:47AA                 </span><span style="color:navy">sub     cx, cx
</span><span style="color:maroon">SYSINIT:47AC
SYSINIT:47AC </span><span style="color:navy">loc_87DC:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:47AC                 </span><span style="color:navy">lodsb
</span><span style="color:maroon">SYSINIT:47AD                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:47AF                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:47B0                 </span><span style="color:navy">jz      short loc_8850
</span><span style="color:maroon">SYSINIT:47B2                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:47B4                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:47B5                 </span><span style="color:navy">jz      short loc_8850
</span><span style="color:maroon">SYSINIT:47B7                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:47B9                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:47BA                 </span><span style="color:navy">jz      short loc_8850
</span><span style="color:maroon">SYSINIT:47BC                 </span><span style="color:navy">inc     cx
</span><span style="color:maroon">SYSINIT:47BD                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Dh </span><span style="color:gray">; &#039;=&#039;
</span><span style="color:maroon">SYSINIT:47BF                 </span><span style="color:navy">jnz     short loc_87DC  </span>; end of file
<span style="color:maroon">SYSINIT:47C1                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:47C3                 </span><span style="color:navy">mov     ah, [si]
</span><span style="color:maroon">SYSINIT:47C5                 </span><span style="color:navy">sub     si, cx
</span><span style="color:maroon">SYSINIT:47C7                 </span><span style="color:navy">dec     cx
</span><span style="color:maroon">SYSINIT:47C8                 </span><span style="color:navy">sub     di, di
</span><span style="color:maroon">SYSINIT:47CA
SYSINIT:47CA </span><span style="color:navy">loc_87FA:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:47CA                 </span><span style="color:navy">cmp     es:[di], al
</span><span style="color:maroon">SYSINIT:47CD                 </span><span style="color:navy">jz      short loc_8824
</span><span style="color:maroon">SYSINIT:47CF                 </span><span style="color:navy">mov     bx, di          </span>; BX == line # (to be returned)
<span style="color:maroon">SYSINIT:47D1                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:47D2                 </span><span style="color:navy">push    si              </span>; DX == the offset we&#039;re looking for
<span style="color:maroon">SYSINIT:47D3                 </span><span style="color:navy">repe cmpsb
</span><span style="color:maroon">SYSINIT:47D5                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:47D6                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:47D7                 </span><span style="color:navy">jnz     short loc_8830
</span><span style="color:maroon">SYSINIT:47D9                 </span><span style="color:navy">cmp     byte ptr es:[di], </span><span style="color:#ff8000">3Dh </span><span style="color:gray">; &#039;=&#039;
</span><span style="color:maroon">SYSINIT:47DD                 </span><span style="color:navy">jnz     short loc_8830
</span><span style="color:maroon">SYSINIT:47DF                 </span><span style="color:navy">mov     cx, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">SYSINIT:47E2                 </span><span style="color:navy">repne scasb             </span>; have we exceeded the desired offset yet?
<span style="color:maroon">SYSINIT:47E4                 </span><span style="color:navy">push    si              </span>; no
<span style="color:maroon">SYSINIT:47E5                 </span><span style="color:navy">mov     si, di
</span><span style="color:maroon">SYSINIT:47E7                 </span><span style="color:navy">mov     di, bx
</span><span style="color:maroon">SYSINIT:47E9                 </span><span style="color:navy">mov     cx, cs:</span>config_envlen
<span style="color:maroon">SYSINIT:47EE                 </span><span style="color:navy">sub     cx, si
</span><span style="color:maroon">SYSINIT:47F0                 </span><span style="color:navy">rep movs byte ptr es:[di], byte ptr es:[si]
</span><span style="color:maroon">SYSINIT:47F3                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:47F4
SYSINIT:47F4 </span><span style="color:navy">loc_8824:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:47F4                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:47F7                 </span><span style="color:navy">jz      short loc_8848
</span><span style="color:maroon">SYSINIT:47F9                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:47FC                 </span><span style="color:navy">jz      short loc_8848  </span>; BX == # bytes remaining from that point, if found
<span style="color:maroon">SYSINIT:47FE                 </span><span style="color:navy">jmp     short loc_8839
</span><span style="color:maroon">SYSINIT:4800 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4800
SYSINIT:4800 </span><span style="color:navy">loc_8830:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4800                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:4801                 </span><span style="color:navy">mov     cx, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">SYSINIT:4804                 </span><span style="color:navy">repne scasb
</span><span style="color:maroon">SYSINIT:4806                 </span><span style="color:navy">pop     cx              </span>; end of file
<span style="color:maroon">SYSINIT:4807                 </span><span style="color:navy">jmp     short loc_87FA
</span><span style="color:maroon">SYSINIT:4809 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4809
SYSINIT:4809 </span><span style="color:navy">loc_8839:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4809                 </span><span style="color:navy">lodsb
</span><span style="color:maroon">SYSINIT:480A                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:480C                 </span><span style="color:navy">jz      short loc_8845
</span><span style="color:maroon">SYSINIT:480E                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah         </span>; CONFIG_INCLUDE
<span style="color:maroon">SYSINIT:4810                 </span><span style="color:navy">jz      short loc_8845
</span><span style="color:maroon">SYSINIT:4812                 </span><span style="color:navy">stosb
</span><span style="color:maroon">SYSINIT:4813                 </span><span style="color:navy">jmp     short loc_8839
</span><span style="color:maroon">SYSINIT:4815 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4815
SYSINIT:4815 </span><span style="color:navy">loc_8845:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4815                 </span><span style="color:navy">sub     al, al
</span><span style="color:maroon">SYSINIT:4817                 </span><span style="color:navy">stosb
</span><span style="color:maroon">SYSINIT:4818
SYSINIT:4818 </span><span style="color:navy">loc_8848:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4818                 </span><span style="color:navy">mov     es:[di], al
</span><span style="color:maroon">SYSINIT:481B                 </span><span style="color:navy">mov     cs:</span>config_envlen<span style="color:navy">, di
</span><span style="color:maroon">SYSINIT:4820
SYSINIT:4820 </span><span style="color:navy">loc_8850:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4820                 </span><span style="color:navy">pop     es              </span>; compare block names
<span style="color:maroon">SYSINIT:4821                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4822                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:4823                 </span><span style="color:navy">pop     cx              </span>; end of file, or names matched
<span style="color:maroon">SYSINIT:4824                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4825
SYSINIT:4825 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4825
SYSINIT:4825
SYSINIT:4825 </span>next_line       proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:4825                 </span><span style="color:navy">call    near ptr unk_8BD3 </span>; no, so skip to next line
<span style="color:black">SYSINIT:4828                 </span><span style="color:navy">jb      short locret_88C9
</span><span style="color:black">SYSINIT:482A                 </span><span style="color:navy">and     al, </span><span style="color:green">7Fh
</span><span style="color:black">SYSINIT:482C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Bh </span><span style="color:gray">; &#039;[&#039;
</span><span style="color:black">SYSINIT:482E                 </span><span style="color:navy">jz      short locret_88C9
</span><span style="color:black">SYSINIT:4830                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">4Ah </span><span style="color:gray">; &#039;J&#039;
</span><span style="color:black">SYSINIT:4832                 </span><span style="color:navy">mov     al, ah
</span><span style="color:black">SYSINIT:4834                 </span><span style="color:navy">jnz     short loc_88A0  </span>; (get next character we&#039;re supposed to match)
<span style="color:black">SYSINIT:4836                 </span><span style="color:navy">mov     byte ptr es:[si-</span><span style="color:green">1</span><span style="color:navy">], </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039; </span>; yes, it *could* be a match
<span style="color:black">SYSINIT:483B                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:483C                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">52E9h       </span>; match?
<span style="color:black">SYSINIT:483F                 </span><span style="color:navy">call    loc_8948
</span><span style="color:black">SYSINIT:4842                 </span><span style="color:navy">jz      short loc_8899
</span><span style="color:black">SYSINIT:4844                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">52EEh
</span><span style="color:black">SYSINIT:4847                 </span><span style="color:navy">call    loc_8948
</span><span style="color:black">SYSINIT:484A                 </span><span style="color:navy">jz      short loc_8899  </span>; if we are, this call to any_delim will tell...
<span style="color:black">SYSINIT:484A </span><span style="background:blue">next_line       endp</span><span style="background:blue"> ; sp-analysis failed</span>
<span style="color:black">SYSINIT:484A
SYSINIT:484C
SYSINIT:484C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:484C
SYSINIT:484C
SYSINIT:484C </span>omp_names_safe  proc near
<span style="color:black">SYSINIT:484C                 </span><span style="color:navy">mov     di, si
</span><span style="color:black">SYSINIT:484E                 </span><span style="color:navy">call    loc_88E6
</span><span style="color:black">SYSINIT:4851                 </span><span style="color:navy">mov     dx, di
</span><span style="color:black">SYSINIT:4853                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:4854                 </span><span style="color:navy">jnz     short loc_889A
</span><span style="color:black">SYSINIT:4856                 </span>assume ds:nothing
<span style="color:black">SYSINIT:4856                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:4857                 </span><span style="color:navy">mov     cx, bx
</span><span style="color:black">SYSINIT:4859                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:4859 </span><span style="background:blue"><span style="color:navy">omp_names_safe  endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:4859
SYSINIT:485A
SYSINIT:485A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:485A
SYSINIT:485A
SYSINIT:485A </span>print_item      proc near
<span style="color:black">SYSINIT:485A                 </span><span style="color:navy">dec     dx              </span>; display menu item #BL
<span style="color:black">SYSINIT:485B                 </span><span style="color:navy">mov     si, dx
</span><span style="color:black">SYSINIT:485D                 </span><span style="color:navy">call    loc_8BA7
</span><span style="color:black">SYSINIT:4860                 </span><span style="color:navy">call    </span>next_line
<span style="color:black">SYSINIT:4863                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:4864                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:4865                 </span><span style="color:navy">sub     al, al          </span>; - VIDEO - READ CURSOR POSITION
<span style="color:black">SYSINIT:4865                                         </span>; BH = page number
<span style="color:black">SYSINIT:4865                                         </span>; Return: DH,DL = row,column, CH = cursor start line, CL = cursor end line
<span style="color:black">SYSINIT:4867                 </span><span style="color:navy">jmp     short loc_88C4
</span><span style="color:black">SYSINIT:4869 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4869
SYSINIT:4869 </span><span style="color:navy">loc_8899:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4869                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:486A
SYSINIT:486A </span><span style="color:navy">loc_889A:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:486A                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:486B                 </span><span style="color:navy">call    loc_8CAA
</span><span style="color:black">SYSINIT:486E                 </span><span style="color:navy">jmp     short loc_88C4
</span><span style="color:black">SYSINIT:4870 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4870
SYSINIT:4870 </span><span style="color:navy">loc_88A0:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4870                 </span><span style="color:navy">mov     [di], al
</span><span style="color:black">SYSINIT:4872                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:4873                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:black">SYSINIT:4875                 </span><span style="color:navy">jb      short loc_88C4  </span>; convert menu item # to ASCII digit
<span style="color:black">SYSINIT:4877                 </span><span style="color:navy">cmp     cs:</span>config_multi<span style="color:navy">, offset </span>SYSINIT$ ; normal attribute
<span style="color:black">SYSINIT:487D                 </span><span style="color:navy">jz      short loc_88B8
</span><span style="color:black">SYSINIT:487F                 </span><span style="color:navy">call    loc_88CA
</span><span style="color:black">SYSINIT:4882                 </span><span style="color:navy">mov     [di], bx
</span><span style="color:black">SYSINIT:4884                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:4885                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:4886                 </span><span style="color:navy">jmp     short loc_88C0
</span><span style="color:black">SYSINIT:4888 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4888
SYSINIT:4888 </span><span style="color:navy">loc_88B8:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4888                 </span><span style="color:navy">call    near ptr unk_8BD3
</span><span style="color:black">SYSINIT:488B                 </span><span style="color:navy">jb      short locret_88C9
</span><span style="color:black">SYSINIT:488D                 </span><span style="color:navy">mov     [di], al
</span><span style="color:black">SYSINIT:488F                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:4890
SYSINIT:4890 </span><span style="color:navy">loc_88C0:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4890                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:4892                 </span><span style="color:navy">jnz     short loc_88B8
</span><span style="color:black">SYSINIT:4894
SYSINIT:4894 </span><span style="color:navy">loc_88C4:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4894                 </span><span style="color:navy">call    loc_8BA3
</span><span style="color:black">SYSINIT:4897                 </span><span style="color:navy">jmp     short </span>next_line
<span style="color:black">SYSINIT:4899 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4899
SYSINIT:4899 </span><span style="color:navy">locret_88C9:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4899                 </span><span style="color:navy">retn                    </span>; put the attribute in the correct register now
<span style="color:black">SYSINIT:489A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:489A
SYSINIT:489A </span><span style="color:navy">loc_88CA:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:489A                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:489B                 </span><span style="color:navy">sub     bx, bx
</span><span style="color:black">SYSINIT:489D                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:489E                 </span><span style="color:navy">mov     dx, si
</span><span style="color:black">SYSINIT:48A0                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:48A1                 </span><span style="color:navy">mov     cx, cs:</span>count
<span style="color:black">SYSINIT:48A6                 </span><span style="color:navy">sub     si, si
</span><span style="color:black">SYSINIT:48A8
SYSINIT:48A8 </span><span style="color:navy">loc_88D8:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:48A8                 </span><span style="color:navy">call    loc_8BA7
</span><span style="color:black">SYSINIT:48AB                 </span><span style="color:navy">jb      short loc_88E2
</span><span style="color:black">SYSINIT:48AD                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:48AE                 </span><span style="color:navy">cmp     si, dx
</span><span style="color:black">SYSINIT:48B0                 </span><span style="color:navy">jb      short loc_88D8
</span><span style="color:black">SYSINIT:48B2
SYSINIT:48B2 </span><span style="color:navy">loc_88E2:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:48B2                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:48B3                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:48B4                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:48B5                 </span><span style="color:navy">retn                    </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">SYSINIT:48B5                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">SYSINIT:48B5                                         </span>; BH = page number
<span style="color:black">SYSINIT:48B6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:48B6
SYSINIT:48B6 </span><span style="color:navy">loc_88E6:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:48B6                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:48B7                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:48B8                 </span><span style="color:navy">mov     cx, cs:</span>count
<span style="color:black">SYSINIT:48BD                 </span><span style="color:navy">push    si
</span><span style="color:black">SYSINIT:48BE                 </span><span style="color:navy">sub     si, si
</span><span style="color:black">SYSINIT:48C0                 </span><span style="color:navy">push    ds              </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">SYSINIT:48C0                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">SYSINIT:48C0                                         </span>; BH = page number
<span style="color:black">SYSINIT:48C1                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:48C2                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:48C3
SYSINIT:48C3 </span><span style="color:gray">print_loop</span><span style="color:navy">:                             </span>; get a character of the description
<span style="color:black">SYSINIT:48C3                 </span><span style="color:navy">call    loc_88FF
</span><span style="color:black">SYSINIT:48C6                 </span><span style="color:navy">mov     di, si
</span><span style="color:black">SYSINIT:48C8                 </span><span style="color:navy">mov     bx, cx
</span><span style="color:black">SYSINIT:48CA                 </span><span style="color:navy">pop     ds
</span><span style="color:black">SYSINIT:48CB                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:48CC                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:48CD
SYSINIT:48CD </span><span style="color:gray">print_montab</span><span style="color:navy">:
</span><span style="color:black">SYSINIT:48CD                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:48CE                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:48CF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:48CF
SYSINIT:48CF </span><span style="color:navy">loc_88FF:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:48CF                 </span><span style="color:navy">call    near ptr unk_8BD3 </span>; stop at the 1st character &lt; space
<span style="color:black">SYSINIT:48D2                 </span><span style="color:navy">jb      short locret_8926
</span><span style="color:black">SYSINIT:48D4                 </span><span style="color:navy">and     al, </span><span style="color:green">7Fh
</span><span style="color:black">SYSINIT:48D6                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Bh </span><span style="color:gray">; &#039;[&#039;
</span><span style="color:black">SYSINIT:48D8                 </span><span style="color:navy">jz      short </span><span style="color:gray">print_done
</span><span style="color:black">SYSINIT:48DA
SYSINIT:48DA </span><span style="color:navy">loc_890A:
</span><span style="color:black">SYSINIT:48DA                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">4Ah </span><span style="color:gray">; &#039;J&#039;
</span><span style="color:black">SYSINIT:48DC                 </span><span style="color:navy">jnz     short loc_8921
</span><span style="color:black">SYSINIT:48DE                 </span><span style="color:navy">or      cs:</span>config_multi<span style="color:navy">, </span><span style="color:green">1 </span>; yes
<span style="color:black">SYSINIT:48E4                 </span><span style="color:navy">jmp     short loc_8921
</span><span style="color:black">SYSINIT:48E6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:48E6
SYSINIT:48E6 </span><span style="color:gray">print_done</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:48E6                 </span><span style="color:navy">or      cs:</span>config_multi<span style="color:navy">, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:48EC                 </span><span style="color:navy">call    loc_8927
</span><span style="color:black">SYSINIT:48EF                 </span><span style="color:navy">jbe     short locret_8926
</span><span style="color:black">SYSINIT:48F1
SYSINIT:48F1 </span><span style="color:navy">loc_8921:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:48F1                 </span><span style="color:navy">call    loc_8BA3
</span><span style="color:black">SYSINIT:48F1 </span><span style="background:blue"><span style="color:navy">print_item      endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:48F1
</span><span style="color:maroon">SYSINIT:48F4                 </span><span style="color:navy">jmp     short loc_88FF
</span><span style="color:maroon">SYSINIT:48F6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:48F6
SYSINIT:48F6 </span><span style="color:navy">locret_8926:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:48F6                 </span><span style="color:navy">retn                    </span>; BL will be the default block #
<span style="color:maroon">SYSINIT:48F7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:48F7
SYSINIT:48F7 </span><span style="color:navy">loc_8927:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:48F7                 </span><span style="color:navy">push    di
</span><span style="color:maroon">SYSINIT:48F8
SYSINIT:48F8 </span><span style="color:navy">loc_8928:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:48F8                 </span><span style="color:navy">call    near ptr unk_8BD3
</span><span style="color:maroon">SYSINIT:48FB                 </span><span style="color:navy">jb      short loc_893D  </span>; display current interactive status
<span style="color:maroon">SYSINIT:48FD                 </span><span style="color:navy">call    loc_8D41
</span><span style="color:maroon">SYSINIT:4900                 </span><span style="color:navy">mov     ah, [di]
</span><span style="color:maroon">SYSINIT:4902                 </span><span style="color:navy">jz      short loc_893F
</span><span style="color:maroon">SYSINIT:4904                 </span><span style="color:navy">inc     di
</span><span style="color:maroon">SYSINIT:4905                 </span><span style="color:navy">and     ax, </span><span style="color:green">0DFDFh      </span>; GET_TIME
<span style="color:maroon">SYSINIT:4908                 </span><span style="color:navy">cmp     al, ah
</span><span style="color:maroon">SYSINIT:490A                 </span><span style="color:navy">jz      short loc_8928
</span><span style="color:maroon">SYSINIT:490C                 </span><span style="color:navy">clc
</span><span style="color:maroon">SYSINIT:490D
SYSINIT:490D </span><span style="color:navy">loc_893D:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:490D                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">SYSINIT:490E                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:490F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:490F
SYSINIT:490F </span><span style="color:navy">loc_893F:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:490F                 </span><span style="color:navy">xchg    al, ah
</span><span style="color:maroon">SYSINIT:4911                 </span><span style="color:navy">call    loc_8D41
</span><span style="color:maroon">SYSINIT:4914                 </span><span style="color:navy">xchg    al, ah          </span>; disable all further prompting
<span style="color:maroon">SYSINIT:4916                 </span><span style="color:navy">jmp     short loc_893D
</span><span style="color:maroon">SYSINIT:4918 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4918
SYSINIT:4918 </span><span style="color:navy">loc_8948:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4918                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:4919                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:491A                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:491B                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:491C                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:491D                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:491E                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:491E                 </span><span style="color:navy">call    loc_8927        </span>; time&#039;s up!
<span style="color:maroon">SYSINIT:4921                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4922                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:4922                 </span><span style="color:navy">pop     si              </span>; save # in BL
<span style="color:maroon">SYSINIT:4923                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:4924                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:4925                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4926
SYSINIT:4926 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4926
SYSINIT:4926
SYSINIT:4926 </span>sub_8956        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:4926                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:4927                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:4928                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:4929                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:492A                 </span><span style="color:navy">push    si              </span>; - VIDEO - READ CURSOR POSITION
<span style="color:black">SYSINIT:492A                                         </span>; BH = page number
<span style="color:black">SYSINIT:492A                                         </span>; Return: DH,DL = row,column, CH = cursor start line, CL = cursor end line
<span style="color:black">SYSINIT:492B                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">3
</span><span style="color:black">SYSINIT:492D                 </span><span style="color:navy">mov     bh, ds:</span><span style="color:green">52A0h    </span>; move cursor to the right
<span style="color:black">SYSINIT:4931                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO -
<span style="color:black">SYSINIT:4933                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:4934                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:4936                 </span><span style="color:navy">mov     dh, bl
</span><span style="color:black">SYSINIT:4938                 </span><span style="color:navy">add     dh, </span><span style="color:#ff8000">3
</span><span style="color:black">SYSINIT:493B                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">5
</span><span style="color:black">SYSINIT:493D                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO -
<span style="color:black">SYSINIT:493F                 </span><span style="color:navy">mov     al, bl          </span>; AL = tens digit, AH = ones digit
<span style="color:black">SYSINIT:4941                 </span><span style="color:navy">add     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:black">SYSINIT:4943                 </span><span style="color:navy">mov     ah, ds:&#039;</span><span style="color:green">R&#039;     </span>; write TTY tens digit
<span style="color:black">SYSINIT:4947                 </span><span style="color:navy">cmp     bl, ds:</span><span style="color:green">52A9h    </span>; - VIDEO - WRITE CHARACTER AND ADVANCE CURSOR (TTY WRITE)
<span style="color:black">SYSINIT:4947                                         </span>; AL = character, BH = display page (alpha modes)
<span style="color:black">SYSINIT:4947                                         </span>; BL = foreground color (graphics modes)
<span style="color:black">SYSINIT:494B                 </span><span style="color:navy">jnz     short loc_898D  </span>; write TTY ones digit
<span style="color:black">SYSINIT:494D                 </span><span style="color:navy">or      ah, </span><span style="color:green">70h
</span><span style="color:black">SYSINIT:4950                 </span><span style="color:navy">mov     ch, ah
</span><span style="color:black">SYSINIT:4952                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">4           </span>; set cursor position back to where it was
<span style="color:black">SYSINIT:4954                 </span><span style="color:navy">rol     ch, cl          </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">SYSINIT:4954                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">SYSINIT:4954                                         </span>; BH = page number
<span style="color:black">SYSINIT:4956                 </span><span style="color:navy">cmp     ch, ah
</span><span style="color:black">SYSINIT:4958                 </span><span style="color:navy">jnz     short loc_898D
</span><span style="color:black">SYSINIT:495A                 </span><span style="color:navy">xor     ah, </span><span style="color:green">8
</span><span style="color:black">SYSINIT:495D
SYSINIT:495D </span><span style="color:navy">loc_898D:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:495D                 </span><span style="color:navy">mov     bh, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:495F                 </span><span style="color:navy">add     bx, bx          </span>; -1 ; is there a time-out?
<span style="color:black">SYSINIT:4961                 </span><span style="color:navy">mov     di, [bx+</span><span style="color:#ff8000">52CDh</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:4965                 </span><span style="color:navy">mov     bl, ah
</span><span style="color:black">SYSINIT:4967                 </span><span style="color:navy">mov     bh, ds:</span><span style="color:green">52A0h
</span><span style="color:black">SYSINIT:496B                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">9
</span><span style="color:black">SYSINIT:496D                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:4970                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - WRITE ATTRIBUTES/CHARACTERS AT CURSOR POSITION
<span style="color:black">SYSINIT:4970                                         </span>; AL = character, BH = display page
<span style="color:black">SYSINIT:4970                                         </span>; BL = attributes of character (alpha modes) or color (graphics modes)
<span style="color:black">SYSINIT:4970                                         </span>; CX = number of times to write character
<span style="color:black">SYSINIT:4972                 </span><span style="color:navy">inc     dl              </span>; it wrapped back to zero, so assume one
<span style="color:black">SYSINIT:4974                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2           </span>; any change?
<span style="color:black">SYSINIT:4976                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; no
<span style="color:black">SYSINIT:4978                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">92Eh
</span><span style="color:black">SYSINIT:497B                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">SYSINIT:497B                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">SYSINIT:497B                                         </span>; BH = page number
<span style="color:black">SYSINIT:497D                 </span><span style="color:navy">inc     dl
</span><span style="color:black">SYSINIT:497F                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:4981                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO -
<span style="color:black">SYSINIT:4983                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">920h
</span><span style="color:black">SYSINIT:4986                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; -1 ; was time-out already disabled?
<span style="color:black">SYSINIT:4988                 </span><span style="color:navy">inc     dl              </span>; yes
<span style="color:black">SYSINIT:498A                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2           </span>; let&#039;s disable # seconds display
<span style="color:black">SYSINIT:498C                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">SYSINIT:498C                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">SYSINIT:498C                                         </span>; BH = page number
<span style="color:black">SYSINIT:498E                 </span><span style="color:navy">push    es
</span><span style="color:black">SYSINIT:498F
SYSINIT:498F </span><span style="color:navy">loc_89BF:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:498F                 </span><span style="color:navy">mov     al, es:[di]
</span><span style="color:black">SYSINIT:4992                 </span><span style="color:navy">inc     di              </span>; 80 of them, to be safe
<span style="color:black">SYSINIT:4992                                         </span>; to completely obliterate # seconds display
<span style="color:black">SYSINIT:4993                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">9
</span><span style="color:black">SYSINIT:4995                 </span><span style="color:navy">jnz     short loc_89C9  </span>; - VIDEO - WRITE CHARACTERS ONLY AT CURSOR POSITION
<span style="color:black">SYSINIT:4995                                         </span>; AL = character, BH = display page - alpha mode
<span style="color:black">SYSINIT:4995                                         </span>; BL = color of character (graphics mode, PCjr only)
<span style="color:black">SYSINIT:4995                                         </span>; CX = number of times to write character
<span style="color:black">SYSINIT:4997                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:black">SYSINIT:4999
SYSINIT:4999 </span><span style="color:navy">loc_89C9:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4999                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;   </span>; extended key pressed?
<span style="color:black">SYSINIT:499B                 </span><span style="color:navy">jb      short loc_89E2  </span>; no
<span style="color:black">SYSINIT:499D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">24h </span><span style="color:gray">; &#039;$&#039;   </span>; get the next part of the key then
<span style="color:black">SYSINIT:499F                 </span><span style="color:navy">jz      short loc_89E2  </span>; what happened to the second part!?
<span style="color:black">SYSINIT:49A1                 </span><span style="color:navy">mov     ah, </span><span style="color:green">9           </span>; up arrow?
<span style="color:black">SYSINIT:49A3                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; no
<span style="color:black">SYSINIT:49A5                 </span><span style="color:navy">inc     dl              </span>; are we as up as up can get?
<span style="color:black">SYSINIT:49A7                 </span><span style="color:navy">cmp     dl, </span><span style="color:#ff8000">4Eh </span><span style="color:gray">; &#039;N&#039;
</span><span style="color:black">SYSINIT:49AA                 </span><span style="color:navy">jnb     short loc_89E2
</span><span style="color:black">SYSINIT:49AC                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:49AE                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; re-print the current item
<span style="color:black">SYSINIT:49B0                 </span><span style="color:navy">jmp     short loc_89BF
</span><span style="color:black">SYSINIT:49B2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:49B2
SYSINIT:49B2 </span><span style="color:navy">loc_89E2:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:49B2                 </span><span style="color:navy">pop     es
</span><span style="color:black">SYSINIT:49B3                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:49B4                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:49B6                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">SYSINIT:49B6                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">SYSINIT:49B6                                         </span>; BH = page number
<span style="color:black">SYSINIT:49B8                 </span><span style="color:navy">pop     si
</span><span style="color:black">SYSINIT:49B9                 </span><span style="color:navy">pop     dx              </span>; are we as down as down can get?
<span style="color:black">SYSINIT:49BA                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:49BB                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:49BC                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:49BD                 </span><span style="color:navy">retn                    </span>; yes, ignore it
<span style="color:black">SYSINIT:49BD </span>sub_8956        endp
<span style="color:black">SYSINIT:49BD
</span><span style="color:maroon">SYSINIT:49BE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:49BE
SYSINIT:49BE </span><span style="color:navy">loc_89EE:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:49BE                 </span><span style="color:navy">mov     bl, ds:</span><span style="color:green">52A9h
</span><span style="color:maroon">SYSINIT:49C2                 </span><span style="color:navy">mov     al, bl
</span><span style="color:maroon">SYSINIT:49C4                 </span><span style="color:navy">call    loc_8B2E
</span><span style="color:maroon">SYSINIT:49C7                 </span><span style="color:navy">call    loc_8B3E
</span><span style="color:maroon">SYSINIT:49CA                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">52ADh</span><span style="color:navy">, </span><span style="color:#ff8000">0FFh
</span><span style="color:maroon">SYSINIT:49CF                 </span><span style="color:navy">jz      short loc_8A53
</span><span style="color:maroon">SYSINIT:49D1                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2Ch
</span><span style="color:maroon">SYSINIT:49D3                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS -
<span style="color:maroon">SYSINIT:49D5                 </span><span style="color:navy">mov     bh, dh
</span><span style="color:black">SYSINIT:49D7 </span><span style="color:gray">; START OF FUNCTION CHUNK FOR show_status
</span><span style="color:black">SYSINIT:49D7
SYSINIT:49D7 </span><span style="color:navy">loc_8A07:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:49D7                 </span><span style="color:navy">mov     al, ds:</span><span style="color:green">52ADh
</span><span style="color:black">SYSINIT:49DA                 </span><span style="color:navy">sub     al, ds:</span><span style="color:green">52AEh    </span>; no
<span style="color:black">SYSINIT:49DE                 </span><span style="color:navy">jnb     short loc_8A1D
</span><span style="color:black">SYSINIT:49E0                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">2
</span><span style="color:black">SYSINIT:49E5                 </span><span style="color:navy">mov     byte ptr ds:</span><span style="color:green">52AEh</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:49EA                 </span><span style="color:navy">jmp     loc_8B13
</span><span style="color:black">SYSINIT:49ED </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:49ED
SYSINIT:49ED </span><span style="color:navy">loc_8A1D:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:49ED                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:49EE                 </span><span style="color:navy">mov     bl, al
</span><span style="color:black">SYSINIT:49F0                 </span><span style="color:navy">mov     bh, ds:</span><span style="color:green">52A0h    </span>; special return code (-1) indicating clean boot
<span style="color:black">SYSINIT:49F4                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">3
</span><span style="color:black">SYSINIT:49F6                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO -
<span style="color:black">SYSINIT:49F8                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:49F9                 </span><span style="color:navy">add     dl, </span><span style="color:#ff8000">8
</span><span style="color:black">SYSINIT:49FC                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:49FE                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">SYSINIT:49FE                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">SYSINIT:49FE                                         </span>; BH = page number
<span style="color:black">SYSINIT:4A00                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">589Eh
</span><span style="color:black">SYSINIT:4A03                 </span><span style="color:navy">call    sub_9072        </span>; is greater than &#039;0&#039;?
<span style="color:black">SYSINIT:4A06                 </span><span style="color:navy">mov     al, bl
</span><span style="color:black">SYSINIT:4A08                 </span><span style="color:navy">cbw
</span><span style="color:black">SYSINIT:4A09                 </span><span style="color:navy">mov     cl, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:4A0B                 </span><span style="color:navy">div     cl              </span>; no
<span style="color:black">SYSINIT:4A0D                 </span><span style="color:navy">mov     cl, ah
</span><span style="color:black">SYSINIT:4A0F                 </span><span style="color:navy">add     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:black">SYSINIT:4A11                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0Eh
</span><span style="color:black">SYSINIT:4A13                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; set new selection
<span style="color:black">SYSINIT:4A15                 </span><span style="color:navy">mov     al, cl
</span><span style="color:black">SYSINIT:4A17                 </span><span style="color:navy">add     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;   </span>; return a full 16-bit value (for indexing)
<span style="color:black">SYSINIT:4A19                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0Eh
</span><span style="color:black">SYSINIT:4A1B                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; convert it into a digit, then display it
<span style="color:black">SYSINIT:4A1D
SYSINIT:4A1D </span>disp_input<span style="color:navy">:                             </span>; display a single character + cr/lf
<span style="color:black">SYSINIT:4A1D                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:4A1E                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:4A20                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">SYSINIT:4A20                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">SYSINIT:4A20                                         </span>; BH = page number
<span style="color:black">SYSINIT:4A22                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:4A23
SYSINIT:4A23 </span><span style="color:navy">loc_8A53:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4A23                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">6
</span><span style="color:black">SYSINIT:4A23 </span><span style="color:gray">; END OF FUNCTION CHUNK FOR show_status
</span><span style="color:maroon">SYSINIT:4A25                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">0FFh
</span><span style="color:maroon">SYSINIT:4A27                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS -
<span style="color:maroon">SYSINIT:4A29                 </span><span style="color:navy">jnz     short loc_8A7A
</span><span style="color:maroon">SYSINIT:4A2B                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">52ADh</span><span style="color:navy">, </span><span style="color:#ff8000">0FFh
</span><span style="color:maroon">SYSINIT:4A30                 </span><span style="color:navy">jz      short loc_8A53
</span><span style="color:black">SYSINIT:4A32
SYSINIT:4A32 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4A32
SYSINIT:4A32
SYSINIT:4A32 </span>disp_num        proc near
<span style="color:black">SYSINIT:4A32                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2Ch
</span><span style="color:black">SYSINIT:4A34                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - DIRECT CONSOLE I/O CHARACTER OUTPUT
<span style="color:black">SYSINIT:4A34                                         </span>; DL = character &lt;&gt; FFh
<span style="color:black">SYSINIT:4A34                                         </span>;  Return: ZF set = no character
<span style="color:black">SYSINIT:4A34                                         </span>;   ZF clear = character recieved, AL = character
<span style="color:black">SYSINIT:4A36                 </span><span style="color:navy">mov     ah, dh
</span><span style="color:black">SYSINIT:4A38                 </span><span style="color:navy">sub     dh, bh
</span><span style="color:black">SYSINIT:4A3A                 </span><span style="color:navy">mov     bh, ah
</span><span style="color:black">SYSINIT:4A3C                 </span><span style="color:navy">jnb     short loc_8A70
</span><span style="color:black">SYSINIT:4A3E                 </span><span style="color:navy">mov     dh, </span><span style="color:#ff8000">1           </span>; - VIDEO - WRITE CHARACTERS ONLY AT CURSOR POSITION
<span style="color:black">SYSINIT:4A3E                                         </span>; AL = character, BH = display page - alpha mode
<span style="color:black">SYSINIT:4A3E                                         </span>; BL = color of character (graphics mode, PCjr only)
<span style="color:black">SYSINIT:4A3E                                         </span>; CX = number of times to write character
<span style="color:black">SYSINIT:4A40
SYSINIT:4A40 </span><span style="color:navy">loc_8A70:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4A40                 </span><span style="color:navy">or      dh, dh
</span><span style="color:black">SYSINIT:4A40 </span><span style="background:blue"><span style="color:navy">disp_num        endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:4A40
SYSINIT:4A42
SYSINIT:4A42 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4A42
SYSINIT:4A42
SYSINIT:4A42 </span>show_status     proc near
<span style="color:black">SYSINIT:4A42
SYSINIT:4A42 </span><span style="color:gray">; FUNCTION CHUNK AT SYSINIT:49D7 SIZE 0000004E BYTES
</span><span style="color:black">SYSINIT:4A42
SYSINIT:4A42                 </span><span style="color:navy">jz      short loc_8A53  </span>; display current interactive mode setting (on/off/none)
<span style="color:black">SYSINIT:4A44                 </span><span style="color:navy">add     ds:</span><span style="color:green">52AEh</span><span style="color:navy">, dh
</span><span style="color:black">SYSINIT:4A48                 </span><span style="color:navy">jmp     short loc_8A07
</span><span style="color:black">SYSINIT:4A4A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4A4A
SYSINIT:4A4A </span><span style="color:navy">loc_8A7A:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4A4A                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:4A4B                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0FFFFh
</span><span style="color:black">SYSINIT:4A4E                 </span><span style="color:navy">xchg    ax, word ptr ds:unk_92DD </span>; set correct row/col
<span style="color:black">SYSINIT:4A52                 </span><span style="color:navy">cmp     al, </span><span style="color:green">0FFh
</span><span style="color:black">SYSINIT:4A54                 </span><span style="color:navy">jz      short loc_8A94
</span><span style="color:black">SYSINIT:4A56                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:4A57                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">0A20h       </span>; just show on/off
<span style="color:black">SYSINIT:4A5A                 </span><span style="color:navy">mov     bx, ds:</span><span style="color:green">529Fh
</span><span style="color:black">SYSINIT:4A5E                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">50h </span><span style="color:gray">; &#039;P&#039;
</span><span style="color:black">SYSINIT:4A61                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO -
<span style="color:black">SYSINIT:4A63                 </span><span style="color:navy">pop     bx              </span>; - VIDEO - WRITE CHARACTERS ONLY AT CURSOR POSITION
<span style="color:black">SYSINIT:4A63                                         </span>; AL = character, BH = display page - alpha mode
<span style="color:black">SYSINIT:4A63                                         </span>; BL = color of character (graphics mode, PCjr only)
<span style="color:black">SYSINIT:4A63                                         </span>; CX = number of times to write character
<span style="color:black">SYSINIT:4A64
SYSINIT:4A64 </span><span style="color:navy">loc_8A94:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4A64                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:4A65                 </span><span style="color:navy">or      al, al
</span><span style="color:black">SYSINIT:4A67
SYSINIT:4A67 </span><span style="color:gray">show_onoff</span><span style="color:navy">:                             </span>; - VIDEO - WRITE CHARACTERS ONLY AT CURSOR POSITION
<span style="color:black">SYSINIT:4A67                 </span><span style="color:navy">jnz     short loc_8AF3  </span>; AL = character, BH = display page - alpha mode
<span style="color:black">SYSINIT:4A67                                         </span>; BL = color of character (graphics mode, PCjr only)
<span style="color:black">SYSINIT:4A67                                         </span>; CX = number of times to write character
<span style="color:black">SYSINIT:4A69                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS -
<span style="color:black">SYSINIT:4A6B                 </span><span style="color:navy">jz      short loc_8A53
</span><span style="color:black">SYSINIT:4A6D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">48h </span><span style="color:gray">; &#039;H&#039;
</span><span style="color:black">SYSINIT:4A6F                 </span><span style="color:navy">jnz     short </span>skip_token
<span style="color:black">SYSINIT:4A71                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">1           </span>; no
<span style="color:black">SYSINIT:4A74                 </span><span style="color:navy">jbe     short loc_8A53
</span><span style="color:black">SYSINIT:4A76
SYSINIT:4A76 </span><span style="color:gray">show_noton</span><span style="color:navy">:
</span><span style="color:black">SYSINIT:4A76                 </span><span style="color:navy">dec     byte ptr ds:</span><span style="color:green">52A9h
</span><span style="color:black">SYSINIT:4A7A                 </span><span style="color:navy">call    sub_8956
</span><span style="color:black">SYSINIT:4A7D                 </span><span style="color:navy">dec     bl              </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">SYSINIT:4A7D                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">SYSINIT:4A7D                                         </span>; BH = page number
<span style="color:black">SYSINIT:4A7F                 </span><span style="color:navy">jmp     short loc_8AC3
</span><span style="color:black">SYSINIT:4A7F </span><span style="background:blue"><span style="color:navy">show_status     endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:4A7F
SYSINIT:4A81
SYSINIT:4A81 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4A81
SYSINIT:4A81
SYSINIT:4A81 </span>skip_token      proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:4A81                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">50h </span><span style="color:gray">; &#039;P&#039;   </span>; advances ES:SI/CX past the current token
<span style="color:black">SYSINIT:4A83                 </span><span style="color:navy">jnz     short loc_8ACD
</span><span style="color:black">SYSINIT:4A85                 </span><span style="color:navy">cmp     bl, ds:</span><span style="color:green">52AAh
</span><span style="color:black">SYSINIT:4A89                 </span><span style="color:navy">jnb     short loc_8ACB
</span><span style="color:black">SYSINIT:4A8B
SYSINIT:4A8B </span>skip_check_eol<span style="color:navy">:                         </span>; CR
<span style="color:black">SYSINIT:4A8B                 </span><span style="color:navy">inc     byte ptr ds:</span><span style="color:green">52A9h
</span><span style="color:black">SYSINIT:4A8F                 </span><span style="color:navy">call    sub_8956        </span>; LF
<span style="color:black">SYSINIT:4A92                 </span><span style="color:navy">inc     bx
</span><span style="color:black">SYSINIT:4A93
SYSINIT:4A93 </span><span style="color:navy">loc_8AC3:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4A93                 </span><span style="color:navy">mov     al, bl
</span><span style="color:black">SYSINIT:4A95
SYSINIT:4A95 </span><span style="color:navy">loc_8AC5:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4A95                 </span><span style="color:navy">call    sub_8956
</span><span style="color:black">SYSINIT:4A95 </span><span style="background:blue"><span style="color:navy">skip_token      endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:4A95
SYSINIT:4A98
SYSINIT:4A98 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4A98
SYSINIT:4A98
SYSINIT:4A98 </span>skip_delim      proc near
<span style="color:black">SYSINIT:4A98                 </span><span style="color:navy">call    loc_8B2E        </span>; advances ES:SI/CX past the current delimiter
<span style="color:black">SYSINIT:4A9B
SYSINIT:4A9B </span><span style="color:navy">loc_8ACB:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4A9B                 </span><span style="color:navy">jmp     short loc_8A53
</span><span style="color:black">SYSINIT:4A9D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4A9D
SYSINIT:4A9D </span><span style="color:navy">loc_8ACD:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4A9D                 </span><span style="color:navy">test    byte ptr ds:</span><span style="color:green">52A4h</span><span style="color:navy">, </span><span style="color:green">1
</span><span style="color:black">SYSINIT:4AA2                 </span><span style="color:navy">jnz     short loc_8ACB
</span><span style="color:black">SYSINIT:4AA4                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">42h </span><span style="color:gray">; &#039;B&#039;
</span><span style="color:black">SYSINIT:4AA6                 </span><span style="color:navy">jnz     short loc_8AE3
</span><span style="color:black">SYSINIT:4AA6 </span><span style="background:blue"><span style="color:navy">skip_delim      endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:4AA6
</span><span style="color:maroon">SYSINIT:4AA8                 </span><span style="color:navy">xor     byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:4AAD                 </span><span style="color:navy">call    loc_8B3E
</span><span style="color:maroon">SYSINIT:4AB0                 </span><span style="color:navy">jmp     loc_8A53        </span>; LF
<span style="color:maroon">SYSINIT:4AB3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4AB3
SYSINIT:4AB3 </span><span style="color:navy">loc_8AE3:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4AB3                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Fh </span><span style="color:gray">; &#039;?&#039;
</span><span style="color:black">SYSINIT:4AB5
SYSINIT:4AB5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4AB5
SYSINIT:4AB5
SYSINIT:4AB5 </span>get_number      proc near
<span style="color:black">SYSINIT:4AB5                 </span><span style="color:navy">jnz     short loc_8ACB  </span>; return binary equivalent of numeric string
<span style="color:black">SYSINIT:4AB5                                         </span>; BX = result
<span style="color:black">SYSINIT:4AB7
SYSINIT:4AB7 </span><span style="color:gray">num_loop</span><span style="color:navy">:
</span><span style="color:black">SYSINIT:4AB7                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">4
</span><span style="color:black">SYSINIT:4ABC                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFFh      </span>; convert to value
<span style="color:black">SYSINIT:4ABF                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:black">SYSINIT:4AC1                 </span><span style="color:navy">jmp     short loc_8B19
</span><span style="color:black">SYSINIT:4AC3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4AC3
SYSINIT:4AC3 </span><span style="color:navy">loc_8AF3:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4AC3                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:black">SYSINIT:4AC5                 </span><span style="color:navy">jz      short loc_8B13
</span><span style="color:black">SYSINIT:4AC7                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">8
</span><span style="color:black">SYSINIT:4AC9                 </span><span style="color:navy">jnz     short loc_8AFF
</span><span style="color:black">SYSINIT:4ACB                 </span><span style="color:navy">mov     bx, </span><span style="color:green">0FFFEh
</span><span style="color:black">SYSINIT:4ACE                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4ACF </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4ACF
SYSINIT:4ACF </span><span style="color:navy">loc_8AFF:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4ACF                 </span><span style="color:navy">sub     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:black">SYSINIT:4AD1                 </span><span style="color:navy">jbe     short loc_8ACB
</span><span style="color:black">SYSINIT:4AD1 </span><span style="background:blue"><span style="color:navy">get_number      endp</span></span><span style="background:blue"> <span style="color:navy">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:4AD1
</span><span style="color:maroon">SYSINIT:4AD3                 </span><span style="color:navy">cmp     al, ds:</span><span style="color:green">52AAh
</span><span style="color:black">SYSINIT:4AD7
SYSINIT:4AD7 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4AD7
SYSINIT:4AD7
SYSINIT:4AD7 </span>get_char        proc near
<span style="color:black">SYSINIT:4AD7                 </span><span style="color:navy">ja      short loc_8ACB  </span>; return next character,
<span style="color:black">SYSINIT:4AD7                                         </span>; advance ES:SI, and decrement CX
<span style="color:black">SYSINIT:4AD7                                         </span>; (use SUB to set carry,zero)
<span style="color:black">SYSINIT:4AD9                 </span><span style="color:navy">mov     ds:</span><span style="color:green">52A9h</span><span style="color:navy">, al
</span><span style="color:black">SYSINIT:4ADC                 </span><span style="color:navy">call    sub_8956        </span>; es
<span style="color:black">SYSINIT:4ADC                                         </span>; lodsb
<span style="color:black">SYSINIT:4ADF                 </span><span style="color:navy">mov     bl, al
</span><span style="color:black">SYSINIT:4AE1
SYSINIT:4AE1 </span><span style="color:gray">get_fail</span><span style="color:navy">:                               </span>; restore CX to zero
<span style="color:black">SYSINIT:4AE1                 </span><span style="color:navy">jmp     short loc_8AC5  </span>; leave carry set, zero not set
<span style="color:black">SYSINIT:4AE3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4AE3
SYSINIT:4AE3 </span><span style="color:navy">loc_8B13:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4AE3                 </span><span style="color:navy">mov     bh, </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:4AE3 </span><span style="background:blue"><span style="color:#ff8000">get_char        endp</span></span><span style="background:blue"> <span style="color:#ff8000">; sp-analysis failed</span></span>
<span style="color:black">SYSINIT:4AE3
SYSINIT:4AE5
SYSINIT:4AE5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4AE5
SYSINIT:4AE5
SYSINIT:4AE5 </span>query_user      proc near
<span style="color:black">SYSINIT:4AE5                 </span><span style="color:navy">mov     al, bl          </span>; ask user whether to execute current config.sys command
<span style="color:black">SYSINIT:4AE5                                         </span>; answer no to everything?
<span style="color:black">SYSINIT:4AE7                 </span><span style="color:navy">add     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:black">SYSINIT:4AE9
SYSINIT:4AE9 </span><span style="color:navy">loc_8B19:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4AE9                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:4AEA                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;   </span>; no
<span style="color:black">SYSINIT:4AEC                 </span><span style="color:navy">jnb     short loc_8B20  </span>; yes
<span style="color:black">SYSINIT:4AEE                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:black">SYSINIT:4AF0
SYSINIT:4AF0 </span><span style="color:navy">loc_8B20:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4AF0                 </span><span style="color:navy">mov     dl, al
</span><span style="color:black">SYSINIT:4AF2                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2
</span><span style="color:black">SYSINIT:4AF4                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; yes (and return carry clear!)
<span style="color:black">SYSINIT:4AF6                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">55C2h
</span><span style="color:black">SYSINIT:4AF9                 </span><span style="color:navy">call    sub_9072
</span><span style="color:black">SYSINIT:4AFC                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:4AFD                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4AFE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4AFE
SYSINIT:4AFE </span><span style="color:navy">loc_8B2E:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4AFE                 </span><span style="color:navy">push    bx
</span><span style="color:black">SYSINIT:4AFF                 </span><span style="color:navy">add     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;   </span>; yes
<span style="color:black">SYSINIT:4B01                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0Ah         </span>; CONFIG_OPTION_QUERY
<span style="color:black">SYSINIT:4B03                 </span><span style="color:navy">mov     bx, ds:</span><span style="color:green">529Fh
</span><span style="color:black">SYSINIT:4B07                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:4B0A                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO -
<span style="color:black">SYSINIT:4B0C                 </span><span style="color:navy">pop     bx              </span>; ~CONFIG_OPTION_QUERY
<span style="color:black">SYSINIT:4B0D                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4B0E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4B0E
SYSINIT:4B0E </span><span style="color:navy">loc_8B3E:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B0E                 </span><span style="color:navy">push    bx              </span>; config_cmd must have been 0
<span style="color:black">SYSINIT:4B0F                 </span><span style="color:navy">mov     bx, ds:</span><span style="color:green">529Fh
</span><span style="color:black">SYSINIT:4B13                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">3
</span><span style="color:black">SYSINIT:4B15                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - READ CURSOR POSITION
<span style="color:black">SYSINIT:4B15                                         </span>; BH = page number
<span style="color:black">SYSINIT:4B15                                         </span>; Return: DH,DL = row,column, CH = cursor start line, CL = cursor end line
<span style="color:black">SYSINIT:4B17
SYSINIT:4B17 </span><span style="color:gray">find_match</span><span style="color:navy">:                             </span>; get size of current keyword
<span style="color:black">SYSINIT:4B17                 </span><span style="color:navy">push    dx
</span><span style="color:black">SYSINIT:4B18                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:4B1A                 </span><span style="color:navy">mov     dx, ds:</span><span style="color:green">52A2h
</span><span style="color:black">SYSINIT:4B1E                 </span><span style="color:navy">test    byte ptr ds:</span><span style="color:green">52A4h</span><span style="color:navy">, </span><span style="color:green">1 </span>; match?
<span style="color:black">SYSINIT:4B23                 </span><span style="color:navy">jz      short loc_8B63
</span><span style="color:black">SYSINIT:4B25                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">0           </span>; loop
<span style="color:black">SYSINIT:4B27
SYSINIT:4B27 </span><span style="color:gray">cmd_match</span><span style="color:navy">:                              </span>; - VIDEO - WRITE CHARACTERS ONLY AT CURSOR POSITION
<span style="color:black">SYSINIT:4B27                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; AL = character, BH = display page - alpha mode
<span style="color:black">SYSINIT:4B27                                         </span>; BL = color of character (graphics mode, PCjr only)
<span style="color:black">SYSINIT:4B27                                         </span>; CX = number of times to write character
<span style="color:black">SYSINIT:4B29                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">0A20h
</span><span style="color:black">SYSINIT:4B2C                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">50h </span><span style="color:gray">; &#039;P&#039;   </span>; STD_CON_OUTPUT
<span style="color:black">SYSINIT:4B2F                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO -
<span style="color:black">SYSINIT:4B31                 </span><span style="color:navy">jmp     short loc_8B76
</span><span style="color:black">SYSINIT:4B33 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4B33
SYSINIT:4B33 </span><span style="color:navy">loc_8B63:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B33                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; DOS - DISPLAY OUTPUT
<span style="color:black">SYSINIT:4B33                                         </span>; DL = character to send to standard output
<span style="color:black">SYSINIT:4B35                 </span><span style="color:navy">mov     al, ds:</span><span style="color:green">589Ah
</span><span style="color:black">SYSINIT:4B38                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:4B3D                 </span><span style="color:navy">jnz     short </span><span style="color:gray">line_print
</span><span style="color:black">SYSINIT:4B3F                 </span><span style="color:navy">mov     al, ds:</span><span style="color:green">5896h
</span><span style="color:black">SYSINIT:4B42
SYSINIT:4B42 </span><span style="color:gray">line_print</span><span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B42                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0Eh
</span><span style="color:black">SYSINIT:4B44                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - WRITE CHARACTER AND ADVANCE CURSOR (TTY WRITE)
<span style="color:black">SYSINIT:4B44                                         </span>; AL = character, BH = display page (alpha modes)
<span style="color:black">SYSINIT:4B44                                         </span>; BL = foreground color (graphics modes)
<span style="color:black">SYSINIT:4B46
SYSINIT:4B46 </span><span style="color:navy">loc_8B76:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B46                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:4B47                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:4B49                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO -
<span style="color:black">SYSINIT:4B4B                 </span><span style="color:navy">pop     bx
</span><span style="color:black">SYSINIT:4B4C                 </span><span style="color:navy">retn                    </span>; yes, assume end of line
<span style="color:black">SYSINIT:4B4D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4B4D
SYSINIT:4B4D </span><span style="color:navy">loc_8B7D:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B4D                 </span><span style="color:navy">call    near ptr unk_8BD3
</span><span style="color:black">SYSINIT:4B50                 </span><span style="color:navy">jb      short locret_8B93
</span><span style="color:black">SYSINIT:4B52                 </span><span style="color:navy">call    loc_8D41
</span><span style="color:black">SYSINIT:4B55                 </span><span style="color:navy">jnz     short loc_8B7D
</span><span style="color:black">SYSINIT:4B57
SYSINIT:4B57 </span><span style="color:navy">loc_8B87:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B57                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:black">SYSINIT:4B59                 </span><span style="color:navy">jz      short loc_8B92
</span><span style="color:black">SYSINIT:4B5B                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:4B5D                 </span><span style="color:navy">jz      short loc_8B92
</span><span style="color:black">SYSINIT:4B5F                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:4B60                 </span><span style="color:navy">jmp     short locret_8B93
</span><span style="color:black">SYSINIT:4B62 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4B62
SYSINIT:4B62 </span><span style="color:navy">loc_8B92:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B62                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:4B63
SYSINIT:4B63 </span><span style="color:navy">locret_8B93:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B63                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4B64 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4B64
SYSINIT:4B64 </span>input_loop<span style="color:navy">:                             </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B64                 </span><span style="color:navy">call    near ptr unk_8BD3
</span><span style="color:black">SYSINIT:4B67                 </span><span style="color:navy">lea     bx, [si-</span><span style="color:green">1</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:4B6A                 </span><span style="color:navy">jb      short locret_8B93 </span>; no
<span style="color:black">SYSINIT:4B6C                 </span><span style="color:navy">call    loc_8D51        </span>; F5 function key?
<span style="color:black">SYSINIT:4B6F                 </span><span style="color:navy">jz      short </span>input_loop ; no
<span style="color:black">SYSINIT:4B71                 </span><span style="color:navy">jmp     short loc_8B87
</span><span style="color:black">SYSINIT:4B73 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4B73
SYSINIT:4B73 </span><span style="color:navy">loc_8BA3:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B73                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:4B75                 </span><span style="color:navy">jz      short locret_8BB0
</span><span style="color:black">SYSINIT:4B77
SYSINIT:4B77 </span><span style="color:navy">loc_8BA7:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B77                 </span><span style="color:navy">call    near ptr unk_8BD3
</span><span style="color:black">SYSINIT:4B7A                 </span><span style="color:navy">jb      short locret_8BB0
</span><span style="color:black">SYSINIT:4B7C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:4B7E                 </span><span style="color:navy">jnz     short loc_8BA7
</span><span style="color:black">SYSINIT:4B80
SYSINIT:4B80 </span><span style="color:navy">locret_8BB0:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B80                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4B81 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4B81
SYSINIT:4B81 </span><span style="color:navy">loc_8BB1:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B81                 </span><span style="color:navy">sub     bx, bx
</span><span style="color:black">SYSINIT:4B83
SYSINIT:4B83 </span><span style="color:navy">loc_8BB3:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4B83                 </span><span style="color:navy">call    near ptr unk_8BD3
</span><span style="color:black">SYSINIT:4B86                 </span><span style="color:navy">jb      short locret_8BD2
</span><span style="color:black">SYSINIT:4B88                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:black">SYSINIT:4B8A                 </span><span style="color:navy">jb      short locret_8BD2
</span><span style="color:black">SYSINIT:4B8C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">39h </span><span style="color:gray">; &#039;9&#039;
</span><span style="color:black">SYSINIT:4B8E                 </span><span style="color:navy">ja      short locret_8BD2 </span>; don&#039;t allow Esc on this query
<span style="color:black">SYSINIT:4B90                 </span><span style="color:navy">push    ax              </span>; Esc?
<span style="color:black">SYSINIT:4B91                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">0Ah
</span><span style="color:black">SYSINIT:4B94                 </span><span style="color:navy">push    dx              </span>; no more interactive boot prompts
<span style="color:black">SYSINIT:4B95                 </span><span style="color:navy">mul     bx
</span><span style="color:black">SYSINIT:4B97                 </span><span style="color:navy">pop     dx
</span><span style="color:black">SYSINIT:4B98                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:black">SYSINIT:4B9A                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:4B9B                 </span><span style="color:navy">sub     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:black">SYSINIT:4B9D                 </span><span style="color:navy">cbw
</span><span style="color:black">SYSINIT:4B9E                 </span><span style="color:navy">add     bx, ax
</span><span style="color:black">SYSINIT:4BA0                 </span><span style="color:navy">jmp     short loc_8BB3
</span><span style="color:black">SYSINIT:4BA2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4BA2
SYSINIT:4BA2 </span><span style="color:navy">locret_8BD2:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4BA2                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4BA2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:olive">SYSINIT:4BA3 </span><span style="color:navy">unk_8BD3        db  </span><span style="color:#008040">83h </span><span style="color:gray">;              </span><span style="color:green">; ...
</span><span style="color:olive">SYSINIT:4BA4                 </span><span style="color:navy">db </span><span style="color:#008040">0E9h </span><span style="color:gray">;              </span>; no
<span style="color:olive">SYSINIT:4BA5                 </span><span style="color:navy">db    </span><span style="color:#008040">1
</span><span style="color:olive">SYSINIT:4BA6                 </span><span style="color:navy">db  </span><span style="color:#008040">72h </span><span style="color:gray">; r
</span><span style="color:olive">SYSINIT:4BA7                 </span><span style="color:navy">db    </span><span style="color:#008040">5                 </span>; just do the command
<span style="color:olive">SYSINIT:4BA8                 </span><span style="color:navy">db  </span><span style="color:#008040">26h </span><span style="color:gray">; &amp;
</span><span style="color:olive">SYSINIT:4BA9                 </span><span style="color:navy">db </span><span style="color:#008040">0ACh </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:4BAA </span><span style="color:gray">skip_all</span><span style="color:navy">:
</span><span style="color:olive">SYSINIT:4BAA                 </span><span style="color:navy">db  </span><span style="color:#008040">8Ah </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:4BAB                 </span><span style="color:navy">db </span><span style="color:#008040">0E0h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:4BAC                 </span><span style="color:navy">db </span><span style="color:#008040">0C3h </span><span style="color:gray">; +
</span><span style="color:olive">SYSINIT:4BAD                 </span><span style="color:navy">db </span><span style="color:#008040">0B9h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:4BAD </span><span style="background:blue"><span style="color:gray">query_user      endp</span></span><span style="background:blue"> <span style="color:gray">; sp-analysis failed</span></span>
<span style="color:olive">SYSINIT:4BAD
SYSINIT:4BAE </span><span style="color:navy">print_error     db    </span><span style="color:#008040">0                 </span>; displays multi-config error conditions
<span style="color:olive">SYSINIT:4BAF                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:maroon">SYSINIT:4BB0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4BB0
SYSINIT:4BB0 </span><span style="color:navy">locret_8BE0:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4BB0                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4BB1 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4BB1
SYSINIT:4BB1 </span><span style="color:navy">loc_8BE1:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4BB1                 </span><span style="color:navy">test    byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">4
</span><span style="color:maroon">SYSINIT:4BB6                 </span><span style="color:navy">jz      short loc_8BEB
</span><span style="color:maroon">SYSINIT:4BB8                 </span><span style="color:navy">jmp     loc_8CA6
</span><span style="color:maroon">SYSINIT:4BBB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4BBB
SYSINIT:4BBB </span><span style="color:navy">loc_8BEB:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4BBB                 </span><span style="color:navy">test    </span>aSubmenu<span style="color:navy">, </span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:4BC0                 </span><span style="color:navy">jnz     short locret_8BE0
</span><span style="color:maroon">SYSINIT:4BC2                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:4BC3                 </span><span style="color:navy">mov     al, </span>config_cmd
<span style="color:maroon">SYSINIT:4BC6                 </span><span style="color:navy">test    </span>aSubmenu<span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:4BCB                 </span><span style="color:navy">jnz     short loc_8C04
</span><span style="color:maroon">SYSINIT:4BCD                 </span><span style="color:navy">test    al, </span><span style="color:green">80h
</span><span style="color:maroon">SYSINIT:4BCF                 </span><span style="color:navy">jnz     short loc_8C04
</span><span style="color:maroon">SYSINIT:4BD1                 </span><span style="color:navy">jmp     loc_8CA2
</span><span style="color:maroon">SYSINIT:4BD4 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4BD4
SYSINIT:4BD4 </span><span style="color:navy">loc_8C04:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4BD4                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:4BD5                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">58F0h
</span><span style="color:maroon">SYSINIT:4BD8                 </span><span style="color:navy">and     al, </span><span style="color:green">7Fh
</span><span style="color:maroon">SYSINIT:4BDA                 </span><span style="color:navy">jz      short </span>CheckQueryOpt
<span style="color:maroon">SYSINIT:4BDC                 </span><span style="color:navy">mov     dh, al
</span><span style="color:maroon">SYSINIT:4BDE                 </span><span style="color:navy">sub     bx, bx
</span><span style="color:maroon">SYSINIT:4BE0                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">52F5h
</span><span style="color:maroon">SYSINIT:4BE3
SYSINIT:4BE3 </span><span style="color:navy">loc_8C13:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4BE3                 </span><span style="color:navy">mov     bl, [di]
</span><span style="color:maroon">SYSINIT:4BE5                 </span><span style="color:navy">or      bl, bl
</span><span style="color:maroon">SYSINIT:4BE7                 </span><span style="color:navy">jz      short loc_8C3E
</span><span style="color:maroon">SYSINIT:4BE9                 </span><span style="color:navy">inc     di
</span><span style="color:maroon">SYSINIT:4BEA                 </span><span style="color:navy">cmp     al, [bx+di]
</span><span style="color:maroon">SYSINIT:4BEC                 </span><span style="color:navy">jz      short loc_8C23
</span><span style="color:maroon">SYSINIT:4BEE                 </span><span style="color:navy">lea     di, [bx+di+</span><span style="color:#ff8000">1</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4BF1                 </span><span style="color:navy">jmp     short loc_8C13
</span><span style="color:maroon">SYSINIT:4BF3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4BF3
SYSINIT:4BF3 </span><span style="color:navy">loc_8C23:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4BF3                 </span><span style="color:navy">mov     cl, [di-</span><span style="color:green">1</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4BF6                 </span><span style="color:navy">mov     ch, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4BF8                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">2
</span><span style="color:maroon">SYSINIT:4BFA
SYSINIT:4BFA </span><span style="color:navy">loc_8C2A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4BFA                 </span><span style="color:navy">mov     al, [di]
</span><span style="color:maroon">SYSINIT:4BFC                 </span><span style="color:navy">inc     di
</span><span style="color:maroon">SYSINIT:4BFD                 </span><span style="color:navy">mov     dl, al
</span><span style="color:maroon">SYSINIT:4BFF                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - DISPLAY OUTPUT
<span style="color:maroon">SYSINIT:4BFF                                         </span>; DL = character to send to standard output
<span style="color:maroon">SYSINIT:4C01                 </span><span style="color:navy">loop    loc_8C2A
</span><span style="color:maroon">SYSINIT:4C03                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">3Dh </span><span style="color:gray">; &#039;=&#039;
</span><span style="color:maroon">SYSINIT:4C05                 </span><span style="color:navy">cmp     dh, </span><span style="color:#ff8000">56h </span><span style="color:gray">; &#039;V&#039;
</span><span style="color:maroon">SYSINIT:4C08                 </span><span style="color:navy">jnz     short loc_8C3C
</span><span style="color:maroon">SYSINIT:4C0A                 </span><span style="color:navy">mov     dl, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:4C0C
SYSINIT:4C0C </span><span style="color:navy">loc_8C3C:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C0C                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - DISPLAY OUTPUT
<span style="color:maroon">SYSINIT:4C0C                                         </span>; DL = character to send to standard output
<span style="color:maroon">SYSINIT:4C0E
SYSINIT:4C0E </span><span style="color:navy">loc_8C3E:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C0E                 </span><span style="color:navy">lods    byte ptr es:[si]
</span><span style="color:maroon">SYSINIT:4C10                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:4C12                 </span><span style="color:navy">jnz     short loc_8C46
</span><span style="color:maroon">SYSINIT:4C14                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:4C16
SYSINIT:4C16 </span><span style="color:navy">loc_8C46:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C16                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:4C18                 </span><span style="color:navy">jb      short loc_8C5A
</span><span style="color:maroon">SYSINIT:4C1A                 </span><span style="color:navy">jnz     short loc_8C52
</span><span style="color:maroon">SYSINIT:4C1C                 </span><span style="color:navy">cmp     byte ptr es:[si], </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:4C20                 </span><span style="color:navy">jb      short loc_8C5A
</span><span style="color:maroon">SYSINIT:4C22
SYSINIT:4C22 </span><span style="color:navy">loc_8C52:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C22                 </span><span style="color:navy">mov     dl, al
</span><span style="color:maroon">SYSINIT:4C24                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:4C26                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - DISPLAY OUTPUT
<span style="color:maroon">SYSINIT:4C26                                         </span>; DL = character to send to standard output
<span style="color:maroon">SYSINIT:4C28                 </span><span style="color:navy">jmp     short loc_8C3E
</span><span style="color:maroon">SYSINIT:4C2A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4C2A
SYSINIT:4C2A </span><span style="color:navy">loc_8C5A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C2A                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">588Eh
</span><span style="color:maroon">SYSINIT:4C2D
SYSINIT:4C2D </span>CheckQueryOpt<span style="color:navy">:                          </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C2D                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:4C30
SYSINIT:4C30 </span><span style="color:navy">loc_8C60:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C30                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4C32                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
<span style="color:maroon">SYSINIT:4C32                                         </span>; Return: AH = scan code, AL = character
<span style="color:maroon">SYSINIT:4C34                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:4C36                 </span><span style="color:navy">jnz     short loc_8C77
</span><span style="color:maroon">SYSINIT:4C38                 </span><span style="color:navy">cmp     ah, </span><span style="color:#ff8000">3Fh </span><span style="color:gray">; &#039;?&#039;
</span><span style="color:maroon">SYSINIT:4C3B                 </span><span style="color:navy">jnz     short loc_8C60
</span><span style="color:maroon">SYSINIT:4C3D                 </span><span style="color:navy">mov     al, ds:</span><span style="color:green">589Ah
</span><span style="color:maroon">SYSINIT:4C40                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">4
</span><span style="color:maroon">SYSINIT:4C45
SYSINIT:4C45 </span>any_delim<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:4C45                 </span><span style="color:navy">jmp     short loc_8C98
</span><span style="color:maroon">SYSINIT:4C47 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4C47
SYSINIT:4C47 </span><span style="color:navy">loc_8C77:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C47                 </span><span style="color:navy">and     al, </span><span style="color:green">0DFh
</span><span style="color:maroon">SYSINIT:4C49                 </span><span style="color:navy">cmp     al, ds:</span><span style="color:green">589Ah
</span><span style="color:maroon">SYSINIT:4C4D                 </span><span style="color:navy">jz      short loc_8C98
</span><span style="color:maroon">SYSINIT:4C4F                 </span><span style="color:navy">cmp     al, ds:</span><span style="color:green">5896h
</span><span style="color:maroon">SYSINIT:4C53                 </span><span style="color:navy">jz      short loc_8C98
</span><span style="color:maroon">SYSINIT:4C55
SYSINIT:4C55 </span>delim<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:4C55                 </span><span style="color:navy">cmp     byte ptr ds:</span><span style="color:green">1790h</span><span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4C5A                 </span><span style="color:navy">jz      short loc_8C60
</span><span style="color:maroon">SYSINIT:4C5C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1Bh
</span><span style="color:maroon">SYSINIT:4C5E                 </span><span style="color:navy">jnz     short loc_8C60
</span><span style="color:maroon">SYSINIT:4C60                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:4C65                 </span><span style="color:navy">mov     al, ds:</span><span style="color:green">5896h
</span><span style="color:maroon">SYSINIT:4C68
SYSINIT:4C68 </span><span style="color:navy">loc_8C98:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C68                 </span><span style="color:navy">call    loc_8B19
</span><span style="color:maroon">SYSINIT:4C6B                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:4C6C                 </span><span style="color:navy">cmp     al, ds:</span><span style="color:green">589Ah
</span><span style="color:maroon">SYSINIT:4C70                 </span><span style="color:navy">jz      short loc_8CA5
</span><span style="color:maroon">SYSINIT:4C72
SYSINIT:4C72 </span><span style="color:navy">loc_8CA2:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C72                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:4C73                 </span><span style="color:navy">clc
</span><span style="color:maroon">SYSINIT:4C74                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4C75 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4C75
SYSINIT:4C75 </span><span style="color:navy">loc_8CA5:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C75                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:4C76
SYSINIT:4C76 </span><span style="color:navy">loc_8CA6:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C76                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:maroon">SYSINIT:4C78                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:4C79                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4C7A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4C7A
SYSINIT:4C7A </span><span style="color:navy">loc_8CAA:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4C7A                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:4C7B                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">SYSINIT:4C7C                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:4C7D                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">SYSINIT:4C7E
SYSINIT:4C7E </span>mapcase<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:4C7E                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:4C7F                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:4C80                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4C81                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:4C81                 </span><span style="color:navy">pushf
</span><span style="color:maroon">SYSINIT:4C82                 </span><span style="color:navy">call    loc_88CA
</span><span style="color:maroon">SYSINIT:4C85                 </span><span style="color:navy">mov     ds:</span><span style="color:green">2AFh</span><span style="color:navy">, bx
</span><span style="color:maroon">SYSINIT:4C89                 </span><span style="color:navy">call    </span>error_line
<span style="color:maroon">SYSINIT:4C8C                 </span><span style="color:navy">popf
</span><span style="color:maroon">SYSINIT:4C8D                 </span><span style="color:navy">jnb     short loc_8CD8
</span><span style="color:maroon">SYSINIT:4C8F                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">5755h
</span><span style="color:maroon">SYSINIT:4C92                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:4C95                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0C07h
</span><span style="color:maroon">SYSINIT:4C98                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - CLEAR KEYBOARD BUFFER
<span style="color:maroon">SYSINIT:4C98                                         </span>; AL must be 01h, 06h, 07h, 08h, or 0Ah.
<span style="color:maroon">SYSINIT:4C9A                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:4C9C                 </span><span style="color:navy">jnz     short loc_8CD2
</span><span style="color:maroon">SYSINIT:4C9E                 </span><span style="color:navy">mov     ah, </span><span style="color:green">7
</span><span style="color:maroon">SYSINIT:4CA0                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - DIRECT STDIN INPUT, NO ECHO
<span style="color:maroon">SYSINIT:4CA2
SYSINIT:4CA2 </span><span style="color:navy">loc_8CD2:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4CA2                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">55C2h
</span><span style="color:maroon">SYSINIT:4CA5                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:4CA8
SYSINIT:4CA8 </span><span style="color:navy">loc_8CD8:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4CA8                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4CA9                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">SYSINIT:4CAA
SYSINIT:4CAA </span>round<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:4CAA                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:4CAB                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">SYSINIT:4CAC                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:4CAD                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4CAE </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4CAE
SYSINIT:4CAE </span><span style="color:navy">loc_8CDE:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4CAE                 </span><span style="color:navy">test    byte ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">4
</span><span style="color:maroon">SYSINIT:4CB3                 </span><span style="color:navy">jz      short locret_8D28
</span><span style="color:maroon">SYSINIT:4CB5                 </span><span style="color:navy">test    byte ptr ds:</span><span style="color:green">529Eh</span><span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:4CBA                 </span><span style="color:navy">jnz     short locret_8D28
</span><span style="color:maroon">SYSINIT:4CBC                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">529Eh</span><span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">SYSINIT:4CC1                 </span><span style="color:navy">or      word ptr ds:</span><span style="color:green">52A8h</span><span style="color:navy">, </span><span style="color:green">102h
</span><span style="color:maroon">SYSINIT:4CC7                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">2044h
</span><span style="color:maroon">SYSINIT:4CCA
SYSINIT:4CCA </span><span style="color:navy">loc_8CFA:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4CCA                 </span><span style="color:navy">mov     al, ds:</span><span style="color:green">51DDh
</span><span style="color:maroon">SYSINIT:4CCD                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:4CCF                 </span><span style="color:navy">jz      short locret_8D28
</span><span style="color:maroon">SYSINIT:4CD1                 </span><span style="color:navy">mov     bl, ds:</span><span style="color:green">51DEh
</span><span style="color:maroon">SYSINIT:4CD5                 </span><span style="color:navy">mov     bh, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4CD7                 </span><span style="color:navy">mov     cx, bx
</span><span style="color:maroon">SYSINIT:4CD9                 </span><span style="color:navy">add     bl, </span><span style="color:#ff8000">3
</span><span style="color:maroon">SYSINIT:4CDC                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">7Eh </span><span style="color:gray">; &#039;~&#039;
</span><span style="color:maroon">SYSINIT:4CDF                 </span><span style="color:navy">ja      short locret_8D28
</span><span style="color:maroon">SYSINIT:4CE1                 </span><span style="color:navy">mov     ds:</span><span style="color:green">51DEh</span><span style="color:navy">, bl
</span><span style="color:maroon">SYSINIT:4CE5                 </span><span style="color:navy">add     bx, </span><span style="color:#ff8000">51DFh
</span><span style="color:maroon">SYSINIT:4CE9                 </span><span style="color:navy">inc     cx
</span><span style="color:maroon">SYSINIT:4CEA
SYSINIT:4CEA </span><span style="color:navy">loc_8D1A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4CEA                 </span><span style="color:navy">mov     ah, [bx-</span><span style="color:green">3</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4CED                 </span><span style="color:navy">mov     [bx], ah
</span><span style="color:maroon">SYSINIT:4CEF                 </span><span style="color:navy">dec     bx
</span><span style="color:maroon">SYSINIT:4CF0                 </span><span style="color:navy">loop    loc_8D1A
</span><span style="color:maroon">SYSINIT:4CF2                 </span><span style="color:navy">mov     [bx-</span><span style="color:green">2</span><span style="color:navy">], al
</span><span style="color:maroon">SYSINIT:4CF5                 </span><span style="color:navy">mov     [bx-</span><span style="color:green">1</span><span style="color:navy">], dx
</span><span style="color:maroon">SYSINIT:4CF8
SYSINIT:4CF8 </span><span style="color:navy">locret_8D28:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4CF8                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4CF9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4CF9
SYSINIT:4CF9 </span><span style="color:navy">loc_8D29:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4CF9                 </span><span style="color:navy">cmp     </span>aSubmenu<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:4CFE                 </span><span style="color:navy">jnz     short locret_8D28
</span><span style="color:maroon">SYSINIT:4D00                 </span><span style="color:navy">test    byte ptr ds:</span><span style="color:green">529Eh</span><span style="color:navy">, </span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:4D05                 </span><span style="color:navy">jnz     short locret_8D28
</span><span style="color:maroon">SYSINIT:4D07                 </span><span style="color:navy">or      byte ptr ds:</span><span style="color:green">529Eh</span><span style="color:navy">, </span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:4D0C                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">2059h
</span><span style="color:maroon">SYSINIT:4D0F                 </span><span style="color:navy">jmp     short loc_8CFA
</span><span style="color:maroon">SYSINIT:4D11 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4D11
SYSINIT:4D11 </span><span style="color:navy">loc_8D41:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D11                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:4D13                 </span><span style="color:navy">jz      short locret_8D6C
</span><span style="color:maroon">SYSINIT:4D15                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:4D17                 </span><span style="color:navy">jz      short locret_8D6C
</span><span style="color:maroon">SYSINIT:4D19                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Bh </span><span style="color:gray">; &#039;[&#039;
</span><span style="color:maroon">SYSINIT:4D1B                 </span><span style="color:navy">jz      short locret_8D6C
</span><span style="color:maroon">SYSINIT:4D1D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Dh </span><span style="color:gray">; &#039;]&#039;
</span><span style="color:maroon">SYSINIT:4D1F                 </span><span style="color:navy">jz      short locret_8D6C
</span><span style="color:maroon">SYSINIT:4D21
SYSINIT:4D21 </span><span style="color:navy">loc_8D51:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D21                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;
</span><span style="color:maroon">SYSINIT:4D23                 </span><span style="color:navy">jz      short locret_8D6C
</span><span style="color:maroon">SYSINIT:4D25                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4D27                 </span><span style="color:navy">jz      short locret_8D6C
</span><span style="color:maroon">SYSINIT:4D29
SYSINIT:4D29 </span><span style="color:navy">loc_8D59:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D29                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:4D2B                 </span><span style="color:navy">jz      short locret_8D6C
</span><span style="color:maroon">SYSINIT:4D2D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">9
</span><span style="color:maroon">SYSINIT:4D2F                 </span><span style="color:navy">jz      short locret_8D6C
</span><span style="color:maroon">SYSINIT:4D31                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Dh </span><span style="color:gray">; &#039;=&#039;
</span><span style="color:maroon">SYSINIT:4D33                 </span><span style="color:navy">jz      short locret_8D6C
</span><span style="color:maroon">SYSINIT:4D35                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Ch </span><span style="color:gray">; &#039;,&#039;
</span><span style="color:maroon">SYSINIT:4D37                 </span><span style="color:navy">jz      short locret_8D6C
</span><span style="color:maroon">SYSINIT:4D39                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Bh </span><span style="color:gray">; &#039;;&#039;
</span><span style="color:maroon">SYSINIT:4D3B                 </span><span style="color:navy">clc
</span><span style="color:maroon">SYSINIT:4D3C
SYSINIT:4D3C </span><span style="color:navy">locret_8D6C:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D3C                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4D3D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4D3D
SYSINIT:4D3D </span><span style="color:navy">loc_8D6D:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D3D                 </span><span style="color:navy">call    </span>getchr
<span style="color:maroon">SYSINIT:4D40                 </span><span style="color:navy">jb      short locret_8D79
</span><span style="color:maroon">SYSINIT:4D42                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:4D44                 </span><span style="color:navy">jnz     short loc_8D6D
</span><span style="color:maroon">SYSINIT:4D46                 </span><span style="color:navy">call    </span>getchr
<span style="color:maroon">SYSINIT:4D49
SYSINIT:4D49 </span><span style="color:navy">locret_8D79:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D49                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4D4A </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4D4A
SYSINIT:4D4A </span><span style="color:navy">loc_8D7A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D4A                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:4D4B                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:4D4C                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:4D4D                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:4D4E                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4D4F                 </span><span style="color:navy">mov     bl, al
</span><span style="color:maroon">SYSINIT:4D51
SYSINIT:4D51 </span><span style="color:navy">loc_8D81:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D51                 </span><span style="color:navy">lodsb
</span><span style="color:maroon">SYSINIT:4D52                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">61h </span><span style="color:gray">; &#039;a&#039;
</span><span style="color:maroon">SYSINIT:4D54                 </span><span style="color:navy">jb      short loc_8D8F
</span><span style="color:maroon">SYSINIT:4D56                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">7Ah </span><span style="color:gray">; &#039;z&#039;
</span><span style="color:maroon">SYSINIT:4D58                 </span><span style="color:navy">ja      short loc_8D8F
</span><span style="color:maroon">SYSINIT:4D5A                 </span><span style="color:navy">sub     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:4D5C                 </span><span style="color:navy">mov     [si-</span><span style="color:green">1</span><span style="color:navy">], al
</span><span style="color:maroon">SYSINIT:4D5F
SYSINIT:4D5F </span><span style="color:navy">loc_8D8F:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D5F                 </span><span style="color:navy">cmp     bl, </span><span style="color:#ff8000">56h </span><span style="color:gray">; &#039;V&#039;
</span><span style="color:maroon">SYSINIT:4D62                 </span><span style="color:navy">jnz     short loc_8D98
</span><span style="color:maroon">SYSINIT:4D64                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">3Dh </span><span style="color:gray">; &#039;=&#039;
</span><span style="color:maroon">SYSINIT:4D66                 </span><span style="color:navy">jz      short loc_8DA2
</span><span style="color:maroon">SYSINIT:4D68
SYSINIT:4D68 </span><span style="color:navy">loc_8D98:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D68                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:4D6A                 </span><span style="color:navy">jz      short loc_8DA2
</span><span style="color:maroon">SYSINIT:4D6C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:4D6E                 </span><span style="color:navy">jz      short loc_8DA2
</span><span style="color:maroon">SYSINIT:4D70                 </span><span style="color:navy">loop    loc_8D81
</span><span style="color:maroon">SYSINIT:4D72
SYSINIT:4D72 </span><span style="color:navy">loc_8DA2:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D72                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4D73                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:4D74                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:4D75                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4D76 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4D76
SYSINIT:4D76 </span><span style="color:navy">loc_8DA6:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4D76                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:4D77                 </span><span style="color:navy">mov     ax, cs:</span>memlo
<span style="color:maroon">SYSINIT:4D7B                 </span><span style="color:navy">call    </span>ParaRound
<span style="color:maroon">SYSINIT:4D7E                 </span><span style="color:navy">add     cs:</span>memhi<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:4D83
SYSINIT:4D83 </span>setdoscountryinfo<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:4D83                 </span><span style="color:navy">mov     cs:</span>memlo<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4D8A                 </span><span style="color:navy">mov     ax, cs:</span>memhi
<span style="color:maroon">SYSINIT:4D8E                 </span><span style="color:navy">cmp     ax, cs:</span>ALLOCLIM
<span style="color:maroon">SYSINIT:4D93                 </span><span style="color:navy">jnb     short loc_8DE8
</span><span style="color:maroon">SYSINIT:4D95                 </span><span style="color:navy">test    cs:</span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:4D9B                 </span><span style="color:navy">jz      short loc_8DE5
</span><span style="color:maroon">SYSINIT:4D9D                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:4D9E                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:4D9F                 </span><span style="color:navy">mov     si, cs:</span>devmark_addr
<span style="color:maroon">SYSINIT:4DA4                 </span><span style="color:navy">mov     es, si
</span><span style="color:maroon">SYSINIT:4DA6                 </span><span style="color:navy">sub     ax, si
</span><span style="color:maroon">SYSINIT:4DA8                 </span><span style="color:navy">dec     ax
</span><span style="color:maroon">SYSINIT:4DA9                 </span><span style="color:navy">mov     es:</span><span style="color:green">3</span><span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:4DAD                 </span><span style="color:navy">and     cs:</span>setdevmarkflag<span style="color:navy">, </span><span style="color:green">0FDh
</span><span style="color:maroon">SYSINIT:4DB3                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:4DB4                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:4DB5
SYSINIT:4DB5 </span><span style="color:navy">loc_8DE5:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4DB5                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:4DB6                 </span><span style="color:navy">clc
</span><span style="color:maroon">SYSINIT:4DB7                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4DB8 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4DB8
SYSINIT:4DB8 </span><span style="color:navy">loc_8DE8:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4DB8                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">569Bh
</span><span style="color:maroon">SYSINIT:4DBB                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:4DBC                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4DBD                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:4DBD                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:4DC0                 </span><span style="color:navy">jmp     </span>stall
<span style="color:maroon">SYSINIT:4DC3 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4DC3
SYSINIT:4DC3 </span><span style="color:navy">loc_8DF3:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4DC3                 </span><span style="color:navy">mov     ds, word ptr cs:</span>DevEntry<span style="color:navy">+</span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:4DC8                 </span>assume ds:nothing
<span style="color:maroon">SYSINIT:4DC8                 </span><span style="color:navy">add     bx, word ptr cs:</span>DevEntry
<span style="color:maroon">SYSINIT:4DCD                 </span><span style="color:navy">mov     ax, [bx]
</span><span style="color:maroon">SYSINIT:4DCF                 </span><span style="color:navy">push    word ptr cs:</span>DevEntry
<span style="color:maroon">SYSINIT:4DD4                 </span><span style="color:navy">mov     word ptr cs:</span>DevEntry<span style="color:navy">, ax
</span><span style="color:maroon">SYSINIT:4DD8                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">36Ah
</span><span style="color:maroon">SYSINIT:4DDB                 </span><span style="color:navy">call    cs:</span>DevEntry
<span style="color:maroon">SYSINIT:4DE0                 </span><span style="color:navy">pop     word ptr cs:</span>DevEntry
<span style="color:maroon">SYSINIT:4DE5                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4DE6
SYSINIT:4DE6 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4DE6
SYSINIT:4DE6
SYSINIT:4DE6 </span>sub_8E16        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:4DE6                 </span><span style="color:navy">sub     al, </span><span style="color:#ff8000">30h </span><span style="color:gray">; &#039;0&#039;
</span><span style="color:black">SYSINIT:4DE8                 </span><span style="color:navy">jb      short loc_8E20
</span><span style="color:black">SYSINIT:4DEA                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">9
</span><span style="color:black">SYSINIT:4DEC                 </span><span style="color:navy">ja      short loc_8E20
</span><span style="color:black">SYSINIT:4DEE                 </span><span style="color:navy">clc
</span><span style="color:black">SYSINIT:4DEF                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4DF0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4DF0
SYSINIT:4DF0 </span><span style="color:navy">loc_8E20:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4DF0                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:4DF1                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4DF1 </span>sub_8E16        endp
<span style="color:black">SYSINIT:4DF1
</span><span style="color:maroon">SYSINIT:4DF2 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4DF2
SYSINIT:4DF2 </span><span style="color:navy">loc_8E22:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4DF2                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">SYSINIT:4DF3                 </span><span style="color:navy">xor     bx, bx
</span><span style="color:maroon">SYSINIT:4DF5
SYSINIT:4DF5 </span><span style="color:navy">loc_8E25:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4DF5                 </span><span style="color:navy">call    sub_8E16
</span><span style="color:maroon">SYSINIT:4DF8                 </span><span style="color:navy">jb      short loc_8E74
</span><span style="color:maroon">SYSINIT:4DFA                 </span><span style="color:navy">xchg    ax, bx
</span><span style="color:maroon">SYSINIT:4DFB                 </span><span style="color:navy">push    bx
</span><span style="color:maroon">SYSINIT:4DFC                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:4DFF                 </span><span style="color:navy">mul     bx
</span><span style="color:maroon">SYSINIT:4E01                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">SYSINIT:4E02                 </span><span style="color:navy">add     al, bl
</span><span style="color:maroon">SYSINIT:4E04                 </span><span style="color:navy">adc     ah, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4E07                 </span><span style="color:navy">jb      short loc_8E74
</span><span style="color:maroon">SYSINIT:4E09                 </span><span style="color:navy">xchg    ax, bx
</span><span style="color:maroon">SYSINIT:4E0A                 </span><span style="color:navy">call    </span>getchr
<span style="color:maroon">SYSINIT:4E0D                 </span><span style="color:navy">jb      short loc_8E6E
</span><span style="color:maroon">SYSINIT:4E0F                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;
</span><span style="color:maroon">SYSINIT:4E11                 </span><span style="color:navy">jz      short loc_8E64
</span><span style="color:maroon">SYSINIT:4E13                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Ch </span><span style="color:gray">; &#039;,&#039;
</span><span style="color:maroon">SYSINIT:4E15                 </span><span style="color:navy">jz      short loc_8E64
</span><span style="color:maroon">SYSINIT:4E17                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">9
</span><span style="color:maroon">SYSINIT:4E19                 </span><span style="color:navy">jz      short loc_8E64
</span><span style="color:maroon">SYSINIT:4E1B                 </span><span style="color:navy">cmp     al, cs:</span>sepchr
<span style="color:maroon">SYSINIT:4E20                 </span><span style="color:navy">jz      short loc_8E64
</span><span style="color:maroon">SYSINIT:4E22                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;
</span><span style="color:maroon">SYSINIT:4E24                 </span><span style="color:navy">nop
</span><span style="color:maroon">SYSINIT:4E25                 </span><span style="color:navy">nop
</span><span style="color:maroon">SYSINIT:4E26                 </span><span style="color:navy">jz      short loc_8E64
</span><span style="color:maroon">SYSINIT:4E28                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:4E2A                 </span><span style="color:navy">jz      short loc_8E64
</span><span style="color:maroon">SYSINIT:4E2C                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">0Dh
</span><span style="color:maroon">SYSINIT:4E2E                 </span><span style="color:navy">jz      short loc_8E64
</span><span style="color:maroon">SYSINIT:4E30                 </span><span style="color:navy">or      al, al
</span><span style="color:maroon">SYSINIT:4E32                 </span><span style="color:navy">jnz     short loc_8E25
</span><span style="color:maroon">SYSINIT:4E34
SYSINIT:4E34 </span><span style="color:navy">loc_8E64:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4E34                 </span><span style="color:navy">inc     cs:</span>count
<span style="color:maroon">SYSINIT:4E39                 </span><span style="color:navy">dec     cs:</span>chrptr
<span style="color:maroon">SYSINIT:4E3E
SYSINIT:4E3E </span><span style="color:navy">loc_8E6E:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4E3E                 </span><span style="color:navy">mov     ax, bx
</span><span style="color:maroon">SYSINIT:4E40                 </span><span style="color:navy">or      ax, ax
</span><span style="color:maroon">SYSINIT:4E42                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">SYSINIT:4E43                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4E44 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4E44
SYSINIT:4E44 </span><span style="color:navy">loc_8E74:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4E44                 </span><span style="color:navy">mov     cs:</span>sepchr<span style="color:navy">, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4E4A                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:maroon">SYSINIT:4E4C                 </span><span style="color:navy">pop     bx
</span><span style="color:maroon">SYSINIT:4E4D                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:4E4E                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4E4F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4E4F
SYSINIT:4E4F </span><span style="color:navy">loc_8E7F:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4E4F                 </span><span style="color:navy">push    di
</span><span style="color:maroon">SYSINIT:4E50                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:4E51                 </span><span style="color:navy">push    dx
</span><span style="color:maroon">SYSINIT:4E52                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:maroon">SYSINIT:4E54                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:maroon">SYSINIT:4E56                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">200h
</span><span style="color:maroon">SYSINIT:4E59                 </span><span style="color:navy">call    sub_8FDC
</span><span style="color:maroon">SYSINIT:4E5C                 </span><span style="color:navy">jb      short loc_8EDB
</span><span style="color:maroon">SYSINIT:4E5E                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:4E5F                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:4E60                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:4E61                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:4E62                 </span>assume es:SYSINIT
<span style="color:maroon">SYSINIT:4E62                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">5143h
</span><span style="color:maroon">SYSINIT:4E65                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">8
</span><span style="color:maroon">SYSINIT:4E68                 </span><span style="color:navy">repe cmpsb
</span><span style="color:maroon">SYSINIT:4E6A                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:4E6B                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:4E6C                 </span>assume es:nothing
<span style="color:maroon">SYSINIT:4E6C                 </span><span style="color:navy">jnz     short loc_8EDB
</span><span style="color:maroon">SYSINIT:4E6E                 </span><span style="color:navy">add     si, </span><span style="color:#ff8000">12h
</span><span style="color:maroon">SYSINIT:4E71                 </span><span style="color:navy">cmp     byte ptr [si], </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:4E74                 </span><span style="color:navy">jnz     short loc_8EDB
</span><span style="color:maroon">SYSINIT:4E76                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4E77                 </span><span style="color:navy">mov     dx, [si]
</span><span style="color:maroon">SYSINIT:4E79                 </span><span style="color:navy">mov     cx, [si+</span><span style="color:#ff8000">2</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4E7C                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">1800h
</span><span style="color:maroon">SYSINIT:4E7F                 </span><span style="color:navy">call    sub_8FDC
</span><span style="color:maroon">SYSINIT:4E82                 </span><span style="color:navy">jb      short loc_8EDB
</span><span style="color:maroon">SYSINIT:4E84                 </span><span style="color:navy">mov     cx, [si]
</span><span style="color:maroon">SYSINIT:4E86                 </span><span style="color:navy">cmp     cx, </span><span style="color:#ff8000">1B6h
</span><span style="color:maroon">SYSINIT:4E8A                 </span><span style="color:navy">ja      short loc_8EDB
</span><span style="color:maroon">SYSINIT:4E8C                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4E8D                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4E8E                 </span><span style="color:navy">pop     dx
</span><span style="color:maroon">SYSINIT:4E8F                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:4E90                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">SYSINIT:4E91
SYSINIT:4E91 </span><span style="color:navy">loc_8EC1:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4E91                 </span><span style="color:navy">cmp     ax, [si+</span><span style="color:#ff8000">2</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4E94                 </span><span style="color:navy">jnz     short loc_8ED0
</span><span style="color:maroon">SYSINIT:4E96                 </span><span style="color:navy">cmp     dx, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4E99                 </span><span style="color:navy">jz      short loc_8EE0
</span><span style="color:maroon">SYSINIT:4E9B                 </span><span style="color:navy">cmp     dx, [si+</span><span style="color:#ff8000">4</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4E9E                 </span><span style="color:navy">jz      short loc_8EE3
</span><span style="color:maroon">SYSINIT:4EA0
SYSINIT:4EA0 </span><span style="color:navy">loc_8ED0:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4EA0                 </span><span style="color:navy">add     si, [si]
</span><span style="color:maroon">SYSINIT:4EA2                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4EA3                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4EA4                 </span><span style="color:navy">loop    loc_8EC1
</span><span style="color:maroon">SYSINIT:4EA6                 </span><span style="color:navy">mov     cx, </span><span style="color:green">0FFFFh
</span><span style="color:maroon">SYSINIT:4EA9
SYSINIT:4EA9 </span><span style="color:navy">loc_8ED9:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4EA9                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:4EAA                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:4EAB </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4EAB
SYSINIT:4EAB </span><span style="color:navy">loc_8EDB:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4EAB                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:4EAC                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:4EAD                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">SYSINIT:4EAE                 </span><span style="color:navy">jmp     short loc_8ED9
</span><span style="color:maroon">SYSINIT:4EB0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4EB0
SYSINIT:4EB0 </span><span style="color:navy">loc_8EE0:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4EB0                 </span><span style="color:navy">mov     dx, [si+</span><span style="color:#ff8000">4</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4EB3
SYSINIT:4EB3 </span><span style="color:navy">loc_8EE3:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4EB3                 </span><span style="color:navy">mov     word ptr cs:aCountry_0+</span><span style="color:green">7</span><span style="color:navy">, dx
</span><span style="color:maroon">SYSINIT:4EB8                 </span><span style="color:navy">mov     dx, [si+</span><span style="color:#ff8000">0Ah</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4EBB                 </span><span style="color:navy">mov     cx, [si+</span><span style="color:#ff8000">0Ch</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4EBE                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">200h
</span><span style="color:maroon">SYSINIT:4EC1                 </span><span style="color:navy">call    sub_8FDC
</span><span style="color:maroon">SYSINIT:4EC4                 </span><span style="color:navy">jb      short loc_8ED9
</span><span style="color:maroon">SYSINIT:4EC6                 </span><span style="color:navy">mov     cx, [si]
</span><span style="color:maroon">SYSINIT:4EC8                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4EC9                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4ECA
SYSINIT:4ECA </span><span style="color:navy">loc_8EFA:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4ECA                 </span><span style="color:navy">push    di
</span><span style="color:maroon">SYSINIT:4ECB                 </span><span style="color:navy">push    cx
</span><span style="color:maroon">SYSINIT:4ECC                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:4ECD                 </span><span style="color:navy">mov     al, [si+</span><span style="color:#ff8000">2</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4ED0                 </span><span style="color:navy">call    sub_8FAE
</span><span style="color:maroon">SYSINIT:4ED3                 </span><span style="color:navy">jb      short </span>prnerr
<span style="color:maroon">SYSINIT:4ED5                 </span><span style="color:navy">mov     dx, [si+</span><span style="color:#ff8000">4</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4ED8                 </span><span style="color:navy">mov     cx, [si+</span><span style="color:#ff8000">6</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4EDB                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4200h
</span><span style="color:maroon">SYSINIT:4EDE                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:4EDF                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
<span style="color:maroon">SYSINIT:4EDF                                         </span>; AL = method: offset from beginning of file
<span style="color:maroon">SYSINIT:4EE1                 </span><span style="color:navy">jb      short loc_8EDB
</span><span style="color:maroon">SYSINIT:4EE3                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">200h
</span><span style="color:maroon">SYSINIT:4EE6                 </span><span style="color:navy">mov     cx, </span><span style="color:#ff8000">14h
</span><span style="color:maroon">SYSINIT:4EE9                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">3Fh </span><span style="color:gray">; &#039;?&#039;
</span><span style="color:maroon">SYSINIT:4EEB                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:4EEC                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - READ FROM FILE WITH HANDLE
<span style="color:maroon">SYSINIT:4EEC                                         </span>; BX = file handle, CX = number of bytes to read
<span style="color:maroon">SYSINIT:4EEC                                         </span>; DS:DX -&gt; buffer
<span style="color:maroon">SYSINIT:4EEE                 </span><span style="color:navy">jb      short loc_8EDB
</span><span style="color:maroon">SYSINIT:4EF0                 </span><span style="color:navy">cmp     ax, cx
</span><span style="color:maroon">SYSINIT:4EF2                 </span><span style="color:navy">jnz     short loc_8EDB
</span><span style="color:maroon">SYSINIT:4EF4                 </span><span style="color:navy">mov     dx, [si+</span><span style="color:#ff8000">4</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4EF7                 </span><span style="color:navy">mov     cx, [si+</span><span style="color:#ff8000">6</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4EFA                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4200h
</span><span style="color:maroon">SYSINIT:4EFD                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:4EFE                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
<span style="color:maroon">SYSINIT:4EFE                                         </span>; AL = method: offset from beginning of file
<span style="color:maroon">SYSINIT:4F00                 </span><span style="color:navy">jb      short loc_8EDB
</span><span style="color:maroon">SYSINIT:4F02                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:4F03                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">208h
</span><span style="color:maroon">SYSINIT:4F06                 </span><span style="color:navy">mov     cx, [si]
</span><span style="color:maroon">SYSINIT:4F08                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:4F09                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">200h
</span><span style="color:maroon">SYSINIT:4F0C                 </span><span style="color:navy">add     cx, </span><span style="color:#ff8000">0Ah
</span><span style="color:maroon">SYSINIT:4F0F                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">3Fh </span><span style="color:gray">; &#039;?&#039;
</span><span style="color:maroon">SYSINIT:4F11                 </span><span style="color:navy">stc
</span><span style="color:maroon">SYSINIT:4F12                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - READ FROM FILE WITH HANDLE
<span style="color:maroon">SYSINIT:4F12                                         </span>; BX = file handle, CX = number of bytes to read
<span style="color:maroon">SYSINIT:4F12                                         </span>; DS:DX -&gt; buffer
<span style="color:maroon">SYSINIT:4F14                 </span><span style="color:navy">jb      short loc_8EDB
</span><span style="color:maroon">SYSINIT:4F16                 </span><span style="color:navy">cmp     ax, cx
</span><span style="color:maroon">SYSINIT:4F18                 </span><span style="color:navy">jnz     short loc_8EDB
</span><span style="color:maroon">SYSINIT:4F1A                 </span><span style="color:navy">mov     al, [si+</span><span style="color:#ff8000">2</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4F1D                 </span><span style="color:navy">mov     si, </span><span style="color:#ff8000">208h
</span><span style="color:maroon">SYSINIT:4F20                 </span><span style="color:navy">mov     cx, [si]
</span><span style="color:maroon">SYSINIT:4F22                 </span><span style="color:navy">inc     cx
</span><span style="color:maroon">SYSINIT:4F23                 </span><span style="color:navy">inc     cx
</span><span style="color:maroon">SYSINIT:4F24                 </span><span style="color:navy">cmp     cx, </span><span style="color:#ff8000">5F8h
</span><span style="color:maroon">SYSINIT:4F28                 </span><span style="color:navy">ja      short loc_8EDB
</span><span style="color:maroon">SYSINIT:4F2A
SYSINIT:4F2A </span>chk_drive_letter<span style="color:navy">:
</span><span style="color:maroon">SYSINIT:4F2A                 </span><span style="color:navy">call    sub_8F93
</span><span style="color:maroon">SYSINIT:4F2D                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:4F2F                 </span><span style="color:navy">jnz     short loc_8F73
</span><span style="color:maroon">SYSINIT:4F31                 </span><span style="color:navy">push    word ptr es:[di+</span><span style="color:#ff8000">18h</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4F35                 </span><span style="color:navy">push    word ptr es:[di+</span><span style="color:#ff8000">1Ah</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4F39                 </span><span style="color:navy">push    di
</span><span style="color:maroon">SYSINIT:4F3A                 </span><span style="color:navy">push    ax
</span><span style="color:maroon">SYSINIT:4F3B                 </span><span style="color:navy">mov     ax, word ptr cs:aCountry_0+</span><span style="color:green">7
</span><span style="color:maroon">SYSINIT:4F3F                 </span><span style="color:navy">mov     [si+</span><span style="color:#ff8000">4</span><span style="color:navy">], ax
</span><span style="color:maroon">SYSINIT:4F42                 </span><span style="color:navy">pop     ax
</span><span style="color:maroon">SYSINIT:4F43
SYSINIT:4F43 </span><span style="color:navy">loc_8F73:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4F43                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">SYSINIT:4F45                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:4F47                 </span><span style="color:navy">jnz     short </span>prnerr
<span style="color:maroon">SYSINIT:4F49                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">SYSINIT:4F4A                 </span><span style="color:navy">pop     word ptr es:[di+</span><span style="color:#ff8000">1Ah</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4F4E                 </span><span style="color:navy">pop     word ptr es:[di+</span><span style="color:#ff8000">18h</span><span style="color:navy">]
</span><span style="color:maroon">SYSINIT:4F52
SYSINIT:4F52 </span>prnerr<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4F52                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:4F53                 </span><span style="color:navy">pop     cx
</span><span style="color:maroon">SYSINIT:4F54                 </span><span style="color:navy">pop     di
</span><span style="color:maroon">SYSINIT:4F55                 </span><span style="color:navy">add     si, [si]
</span><span style="color:maroon">SYSINIT:4F57                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4F58                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4F59                 </span><span style="color:navy">dec     cx
</span><span style="color:maroon">SYSINIT:4F5A                 </span><span style="color:navy">cmp     cx, </span><span style="color:#ff8000">0
</span><span style="color:maroon">SYSINIT:4F5D                 </span><span style="color:navy">jz      short locret_8F92
</span><span style="color:maroon">SYSINIT:4F5F                 </span><span style="color:navy">jmp     loc_8EFA
</span><span style="color:maroon">SYSINIT:4F62 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4F62
SYSINIT:4F62 </span><span style="color:navy">locret_8F92:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4F62                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4F63
SYSINIT:4F63 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4F63
SYSINIT:4F63
SYSINIT:4F63 </span>sub_8F93        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:4F63                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">7
</span><span style="color:black">SYSINIT:4F65                 </span><span style="color:navy">jnz     short locret_8FAD
</span><span style="color:black">SYSINIT:4F67                 </span><span style="color:navy">cmp     word ptr es:[di], </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:4F6B                 </span><span style="color:navy">jz      short locret_8FAD
</span><span style="color:black">SYSINIT:4F6D                 </span><span style="color:navy">push    di
</span><span style="color:black">SYSINIT:4F6E                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:4F6F                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:4F70                 </span><span style="color:navy">mov     cx, es:[di]
</span><span style="color:black">SYSINIT:4F73                 </span><span style="color:navy">add     di, </span><span style="color:#ff8000">2
</span><span style="color:black">SYSINIT:4F76
SYSINIT:4F76 </span>print<span style="color:navy">:
</span><span style="color:black">SYSINIT:4F76                 </span><span style="color:navy">xor     al, al
</span><span style="color:black">SYSINIT:4F78                 </span><span style="color:navy">rep stosb
</span><span style="color:black">SYSINIT:4F7A                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:4F7B
SYSINIT:4F7B </span>open_dev<span style="color:navy">:
</span><span style="color:black">SYSINIT:4F7B                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:4F7C                 </span><span style="color:navy">pop     di
</span><span style="color:black">SYSINIT:4F7D
SYSINIT:4F7D </span><span style="color:navy">locret_8FAD:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4F7D                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4F7D </span>sub_8F93        endp
<span style="color:black">SYSINIT:4F7D
SYSINIT:4F7E
SYSINIT:4F7E </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4F7E
SYSINIT:4F7E
SYSINIT:4F7E </span>sub_8FAE        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:4F7E                 </span><span style="color:navy">push    cx
</span><span style="color:black">SYSINIT:4F7F                 </span><span style="color:navy">add     di, </span><span style="color:#ff8000">4Ah </span><span style="color:gray">; &#039;J&#039;
</span><span style="color:black">SYSINIT:4F82                 </span><span style="color:navy">mov     cx, es:[di]
</span><span style="color:black">SYSINIT:4F85                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:4F86                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:4F87
SYSINIT:4F87 </span><span style="color:navy">loc_8FB7:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4F87                 </span><span style="color:navy">cmp     es:[di], al
</span><span style="color:black">SYSINIT:4F8A                 </span><span style="color:navy">jz      short loc_8FCF
</span><span style="color:black">SYSINIT:4F8C                 </span><span style="color:navy">cmp     byte ptr es:[di], </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:4F90                 </span><span style="color:navy">jz      short loc_8FC7
</span><span style="color:black">SYSINIT:4F92                 </span><span style="color:navy">add     di, </span><span style="color:#ff8000">5
</span><span style="color:black">SYSINIT:4F95                 </span><span style="color:navy">jmp     short </span>open_file
<span style="color:black">SYSINIT:4F97 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4F97
SYSINIT:4F97 </span><span style="color:navy">loc_8FC7:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4F97                 </span><span style="color:navy">add     di, </span><span style="color:#ff8000">29h </span><span style="color:gray">; &#039;)&#039;
</span><span style="color:black">SYSINIT:4F9A
SYSINIT:4F9A </span>open_file<span style="color:navy">:                              </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4F9A                 </span><span style="color:navy">loop    loc_8FB7
</span><span style="color:black">SYSINIT:4F9C                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:4F9D                 </span><span style="color:navy">jmp     short loc_8FDA
</span><span style="color:black">SYSINIT:4F9F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4F9F
SYSINIT:4F9F </span><span style="color:navy">loc_8FCF:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4F9F                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">1
</span><span style="color:black">SYSINIT:4FA1                 </span><span style="color:navy">jnz     short loc_8FD6
</span><span style="color:black">SYSINIT:4FA3
SYSINIT:4FA3 </span>MsDosVersion6Copyr<span style="color:navy">:
</span><span style="color:black">SYSINIT:4FA3                 </span><span style="color:navy">inc     di
</span><span style="color:black">SYSINIT:4FA4                 </span><span style="color:navy">jmp     short loc_8FDA
</span><span style="color:black">SYSINIT:4FA6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:4FA6
SYSINIT:4FA6 </span><span style="color:navy">loc_8FD6:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4FA6                 </span><span style="color:navy">les     di, es:[di+</span><span style="color:#ff8000">1</span><span style="color:navy">]
</span><span style="color:black">SYSINIT:4FAA
SYSINIT:4FAA </span><span style="color:navy">loc_8FDA:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4FAA                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:4FAB                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4FAB </span>sub_8FAE        endp
<span style="color:black">SYSINIT:4FAB
SYSINIT:4FAC
SYSINIT:4FAC </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4FAC
SYSINIT:4FAC
SYSINIT:4FAC </span>sub_8FDC        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:4FAC                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:4FAD                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">4200h
</span><span style="color:black">SYSINIT:4FB0                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:4FB1                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
<span style="color:black">SYSINIT:4FB1                                         </span>; AL = method: offset from beginning of file
<span style="color:black">SYSINIT:4FB3                 </span><span style="color:navy">pop     cx
</span><span style="color:black">SYSINIT:4FB4                 </span><span style="color:navy">jb      short locret_8FEF
</span><span style="color:black">SYSINIT:4FB6                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">SYSINIT:4FB8                 </span><span style="color:navy">xor     si, si
</span><span style="color:black">SYSINIT:4FBA                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">3Fh </span><span style="color:gray">; &#039;?&#039;
</span><span style="color:black">SYSINIT:4FBC                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:4FBD                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - READ FROM FILE WITH HANDLE
<span style="color:black">SYSINIT:4FBD                                         </span>; BX = file handle, CX = number of bytes to read
<span style="color:black">SYSINIT:4FBD                                         </span>; DS:DX -&gt; buffer
<span style="color:black">SYSINIT:4FBF
SYSINIT:4FBF </span><span style="color:navy">locret_8FEF:                            </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:4FBF                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4FBF </span>sub_8FDC        endp
<span style="color:black">SYSINIT:4FBF
</span><span style="color:maroon">SYSINIT:4FC0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4FC0                 </span><span style="color:navy">push    si
</span><span style="color:maroon">SYSINIT:4FC1                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:4FC2                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:4FC3                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4FC4                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:4FC5                 </span><span style="color:navy">call    sub_9026
</span><span style="color:maroon">SYSINIT:4FC8                 </span><span style="color:navy">jb      short loc_9000
</span><span style="color:maroon">SYSINIT:4FCA                 </span><span style="color:navy">mov     al, [si]
</span><span style="color:maroon">SYSINIT:4FCC                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4FCD                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:4FCE                 </span><span style="color:navy">jmp     short loc_9006
</span><span style="color:maroon">SYSINIT:4FD0 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4FD0
SYSINIT:4FD0 </span><span style="color:navy">loc_9000:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4FD0                 </span><span style="color:navy">mov     ah, </span><span style="color:green">19h
</span><span style="color:maroon">SYSINIT:4FD2                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - GET DEFAULT DISK NUMBER
<span style="color:maroon">SYSINIT:4FD4                 </span><span style="color:navy">add     al, </span><span style="color:#ff8000">41h </span><span style="color:gray">; &#039;A&#039;
</span><span style="color:maroon">SYSINIT:4FD6
SYSINIT:4FD6 </span><span style="color:navy">loc_9006:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4FD6                 </span><span style="color:navy">mov     byte ptr cs:aACountry_sys, al </span><span style="color:gray">; &quot;A:\\COUNTRY.SYS&quot;
</span><span style="color:maroon">SYSINIT:4FDA                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">5103h
</span><span style="color:maroon">SYSINIT:4FDD                 </span><span style="color:navy">mov     al, [si]
</span><span style="color:maroon">SYSINIT:4FDF                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">5Ch </span><span style="color:gray">; &#039;\&#039;
</span><span style="color:maroon">SYSINIT:4FE1                 </span><span style="color:navy">jz      short loc_9019
</span><span style="color:maroon">SYSINIT:4FE3                 </span><span style="color:navy">cmp     al, </span><span style="color:#ff8000">2Fh </span><span style="color:gray">; &#039;/&#039;
</span><span style="color:maroon">SYSINIT:4FE5                 </span><span style="color:navy">jz      short loc_9019
</span><span style="color:maroon">SYSINIT:4FE7                 </span><span style="color:navy">jmp     short loc_901A
</span><span style="color:maroon">SYSINIT:4FE9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:4FE9
SYSINIT:4FE9 </span><span style="color:navy">loc_9019:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4FE9                 </span><span style="color:navy">dec     di
</span><span style="color:maroon">SYSINIT:4FEA
SYSINIT:4FEA </span><span style="color:navy">loc_901A:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:4FEA                 </span><span style="color:navy">call    sub_903C
</span><span style="color:maroon">SYSINIT:4FED                 </span><span style="color:navy">mov     di, </span><span style="color:#ff8000">5100h
</span><span style="color:maroon">SYSINIT:4FF0                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">SYSINIT:4FF1                 </span><span style="color:navy">push    es
</span><span style="color:maroon">SYSINIT:4FF2                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:4FF3                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:4FF4                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">SYSINIT:4FF5                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:4FF6
SYSINIT:4FF6 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:4FF6
SYSINIT:4FF6
SYSINIT:4FF6 </span>sub_9026        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:4FF6                 </span><span style="color:navy">push    ax
</span><span style="color:black">SYSINIT:4FF7                 </span><span style="color:navy">cmp     byte ptr [si], </span><span style="color:#ff8000">41h </span><span style="color:gray">; &#039;A&#039;
</span><span style="color:black">SYSINIT:4FFA                 </span><span style="color:navy">jb      short loc_9039
</span><span style="color:black">SYSINIT:4FFC                 </span><span style="color:navy">cmp     byte ptr [si], </span><span style="color:#ff8000">5Ah </span><span style="color:gray">; &#039;Z&#039;
</span><span style="color:black">SYSINIT:4FFF                 </span><span style="color:navy">ja      short loc_9039
</span><span style="color:black">SYSINIT:5001                 </span><span style="color:navy">cmp     byte ptr [si+</span><span style="color:#ff8000">1</span><span style="color:navy">], </span><span style="color:#ff8000">3Ah </span><span style="color:gray">; &#039;:&#039;
</span><span style="color:black">SYSINIT:5005                 </span><span style="color:navy">jnz     short loc_9039
</span><span style="color:black">SYSINIT:5007                 </span><span style="color:navy">jmp     short loc_903A
</span><span style="color:black">SYSINIT:5009 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">SYSINIT:5009
SYSINIT:5009 </span><span style="color:navy">loc_9039:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:5009                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:500A
SYSINIT:500A </span><span style="color:navy">loc_903A:                               </span><span style="color:green">; ...
</span><span style="color:black">SYSINIT:500A                 </span><span style="color:navy">pop     ax
</span><span style="color:black">SYSINIT:500B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:500B </span>sub_9026        endp
<span style="color:black">SYSINIT:500B
SYSINIT:500C
SYSINIT:500C </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:500C
SYSINIT:500C
SYSINIT:500C </span>sub_903C        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:500C                 </span><span style="color:navy">movsb
</span><span style="color:black">SYSINIT:500D                 </span><span style="color:navy">cmp     byte ptr [si-</span><span style="color:green">1</span><span style="color:navy">], </span><span style="color:#ff8000">0
</span><span style="color:black">SYSINIT:5011                 </span><span style="color:navy">jnz     short sub_903C
</span><span style="color:black">SYSINIT:5013                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:5013 </span>sub_903C        endp
<span style="color:black">SYSINIT:5013
</span><span style="color:maroon">SYSINIT:5014 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:5014
SYSINIT:5014 </span><span style="color:navy">loc_9044:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:5014                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:5015                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">SYSINIT:5016                 </span>assume es:SYSINIT
<span style="color:maroon">SYSINIT:5016                 </span><span style="color:navy">mov     si, dx
</span><span style="color:maroon">SYSINIT:5018
SYSINIT:5018 </span>nuldev<span style="color:navy">:                                 </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:5018                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">5605h
</span><span style="color:maroon">SYSINIT:501B                 </span><span style="color:navy">mov     bx, </span><span style="color:#ff8000">55C2h
</span><span style="color:maroon">SYSINIT:501E
SYSINIT:501E </span><span style="color:navy">loc_904E:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:501E                 </span><span style="color:navy">push    cs
</span><span style="color:maroon">SYSINIT:501F                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">SYSINIT:5020                 </span>assume ds:SYSINIT
<span style="color:maroon">SYSINIT:5020                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:5023
SYSINIT:5023 </span><span style="color:navy">loc_9053:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:5023                 </span><span style="color:navy">mov     dl, es:[si]
</span><span style="color:maroon">SYSINIT:5026                 </span><span style="color:navy">or      dl, dl
</span><span style="color:maroon">SYSINIT:5028                 </span><span style="color:navy">jz      short loc_9061
</span><span style="color:maroon">SYSINIT:502A                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2
</span><span style="color:maroon">SYSINIT:502C                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - DISPLAY OUTPUT
<span style="color:maroon">SYSINIT:502C                                         </span>; DL = character to send to standard output
<span style="color:maroon">SYSINIT:502E                 </span><span style="color:navy">inc     si
</span><span style="color:maroon">SYSINIT:502F                 </span><span style="color:navy">jmp     short loc_9053
</span><span style="color:maroon">SYSINIT:5031 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:5031
SYSINIT:5031 </span><span style="color:navy">loc_9061:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:5031                 </span><span style="color:navy">mov     dx, bx
</span><span style="color:maroon">SYSINIT:5033                 </span><span style="color:navy">call    sub_9072
</span><span style="color:maroon">SYSINIT:5036                 </span><span style="color:navy">cmp     cs:</span>donotshownum<span style="color:navy">, </span><span style="color:#ff8000">1
</span><span style="color:maroon">SYSINIT:503C                 </span><span style="color:navy">jz      short locret_9071
</span><span style="color:maroon">SYSINIT:503E                 </span><span style="color:navy">call    </span>error_line
<span style="color:maroon">SYSINIT:5041
SYSINIT:5041 </span><span style="color:navy">locret_9071:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:5041                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:5042
SYSINIT:5042 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:5042
SYSINIT:5042
SYSINIT:5042 </span>sub_9072        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:5042                 </span><span style="color:navy">mov     ah, </span><span style="color:green">9
</span><span style="color:black">SYSINIT:5044                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - PRINT STRING
<span style="color:black">SYSINIT:5044                                         </span>; DS:DX -&gt; string terminated by &quot;$&quot;
<span style="color:black">SYSINIT:5046                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:5046 </span>sub_9072        endp
<span style="color:black">SYSINIT:5046
</span><span style="color:maroon">SYSINIT:5047 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:5047
SYSINIT:5047 </span><span style="color:navy">loc_9077:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:5047                 </span><span style="color:navy">call    sub_9096
</span><span style="color:maroon">SYSINIT:504A                 </span><span style="color:navy">jnb     short loc_9083
</span><span style="color:maroon">SYSINIT:504C
SYSINIT:504C </span><span style="color:navy">loc_907C:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:504C                 </span><span style="color:navy">mov     dx, </span><span style="color:#ff8000">50E4h
</span><span style="color:maroon">SYSINIT:504F                 </span><span style="color:navy">call    sub_9096
</span><span style="color:maroon">SYSINIT:5052
SYSINIT:5052 </span><span style="color:navy">locret_9082:                            </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:5052                 </span><span style="color:navy">retn
</span><span style="color:maroon">SYSINIT:5053 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:5053
SYSINIT:5053 </span><span style="color:navy">loc_9083:                               </span><span style="color:green">; ...
</span><span style="color:maroon">SYSINIT:5053                 </span><span style="color:navy">mov     bx, ax
</span><span style="color:maroon">SYSINIT:5055                 </span><span style="color:navy">xor     ax, ax
</span><span style="color:maroon">SYSINIT:5057                 </span><span style="color:navy">mov     ah, </span><span style="color:green">44h
</span><span style="color:maroon">SYSINIT:5059                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - IOCTL - GET DEVICE INFORMATION
<span style="color:maroon">SYSINIT:5059                                         </span>; BX = file or device handle
<span style="color:maroon">SYSINIT:505B                 </span><span style="color:navy">test    dl, </span><span style="color:green">80h
</span><span style="color:maroon">SYSINIT:505E                 </span><span style="color:navy">jnz     short locret_9082
</span><span style="color:maroon">SYSINIT:5060                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3Eh
</span><span style="color:maroon">SYSINIT:5062                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - CLOSE A FILE WITH HANDLE
<span style="color:maroon">SYSINIT:5062                                         </span>; BX = file handle
<span style="color:maroon">SYSINIT:5064                 </span><span style="color:navy">jmp     short loc_907C
</span><span style="color:black">SYSINIT:5066
SYSINIT:5066 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">SYSINIT:5066
SYSINIT:5066
SYSINIT:5066 </span>sub_9096        proc near               <span style="color:green">; ...
</span><span style="color:black">SYSINIT:5066                 </span><span style="color:navy">mov     ah, </span><span style="color:#ff8000">3Dh </span><span style="color:gray">; &#039;=&#039;
</span><span style="color:black">SYSINIT:5068                 </span><span style="color:navy">stc
</span><span style="color:black">SYSINIT:5069                 </span><span style="color:navy">int     </span><span style="color:green">21h             </span>; DOS - 2+ - OPEN DISK FILE WITH HANDLE
<span style="color:black">SYSINIT:5069                                         </span>; DS:DX -&gt; ASCIZ filename
<span style="color:black">SYSINIT:5069                                         </span>; AL = access mode
<span style="color:black">SYSINIT:5069                                         </span>; 0 - read
<span style="color:black">SYSINIT:506B                 </span><span style="color:navy">retn
</span><span style="color:black">SYSINIT:506B </span>sub_9096        endp
<span style="color:black">SYSINIT:506B
</span><span style="color:maroon">SYSINIT:506C </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">SYSINIT:506C
SYSINIT:506C </span><span style="color:navy">loc_909C:                               </span><span style="color:#8080ff">; ...
</span><span style="color:maroon">SYSINIT:506C                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">3
</span><span style="color:maroon">SYSINIT:506E                 </span><span style="color:navy">iret
</span><span style="color:maroon">SYSINIT:506E </span><span style="color:gray">; ---------------------------------------------------------------------------
SYSINIT:506F </span><span style="color:navy">aMsDosVersion6C db &#039;MS DOS Version 6 (C)Copyright 1981-1994 Microsoft Corp Licensed M&#039;
</span><span style="color:gray">SYSINIT:506F                 </span><span style="color:navy">db &#039;aterial - Property of Microsoft All rights reserved NUL&#039;,0
</span><span style="color:gray">SYSINIT:50E8 </span><span style="color:navy">aCon_0          db &#039;CON&#039;,0              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:50EC </span><span style="color:navy">aAux_0          db &#039;AUX&#039;,0              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:50F0 </span><span style="color:navy">aPrn_0          db &#039;PRN&#039;,0              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:50F4 </span><span style="color:navy">aConfig_sys     db &#039;\CONFIG.SYS&#039;,0      </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:5100 </span><span style="color:navy">aACountry_sys   db &#039;A:\COUNTRY.SYS&#039;,0   </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:510F                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:5111 </span>def_swchr       <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:5112 </span>command_line    <span style="color:navy">db </span><span style="color:#008040">31h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)           </span>; default command.com args
<span style="color:olive">SYSINIT:5143                 </span><span style="color:navy">db </span><span style="color:#008040">0FFh
</span><span style="color:gray">SYSINIT:5144 </span><span style="color:navy">aCountry_0      db &#039;COUNTRY&#039;,0          </span><span style="color:olive">; ...
</span><span style="color:gray">SYSINIT:514C                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:514D </span><span style="color:navy">byte_917D       db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:514E </span><span style="color:navy">byte_917E       db </span><span style="color:#008040">40h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:514F </span><span style="color:navy">byte_917F       db </span><span style="color:#008040">0Ch                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:5150 </span><span style="color:navy">aCommand_com    db &#039;\COMMAND.COM&#039;,0     </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:515D </span><span style="color:navy">byte_918D       db </span><span style="color:#008040">33h </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">SYSINIT:5190 </span>command_line_126 <span style="color:navy">db &#039;\COMMAND.COM&#039;,0    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:519D                 </span><span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">SYSINIT:519E </span><span style="color:navy">aP              db &#039;/P&#039;,0
</span><span style="color:gray">SYSINIT:51A1 </span><span style="color:navy">aMsdosCommand_c db &#039;\MSDOS\COMMAND.COM&#039;,0 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:51B4                 </span><span style="color:navy">db </span><span style="color:#008040">0Bh
</span><span style="color:gray">SYSINIT:51B5 </span><span style="color:navy">aAMsdosP        db &#039;A:\MSDOS /P&#039;,0
</span><span style="color:gray">SYSINIT:51C1 </span><span style="color:navy">aDosCommand_com db &#039;\DOS\COMMAND.COM&#039;,0 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:51D2 </span>dae_flag        <span style="color:navy">db </span><span style="color:#008040">9
</span><span style="color:gray">SYSINIT:51D3 </span>bMenuColor      <span style="color:navy">db &#039;A:\DOS /P&#039;,0        </span>; default fgnd/bgnd color
<span style="color:gray">SYSINIT:51DD </span>bDefBlock       <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:51DD                                         </span>; default block #
<span style="color:gray">SYSINIT:51DE </span>bMaxBlock       <span style="color:navy">db </span><span style="color:#008040">2                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:51DE                                         </span>; maximum block #
<span style="color:gray">SYSINIT:51DF </span>offDefBlock     <span style="color:navy">db &#039;/P&#039;,0               </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:51DF                                         </span>; offset of name of default block (if any)
<span style="color:gray">SYSINIT:51E2 </span>secElapsed      <span style="color:navy">db </span><span style="color:#008040">0BCh </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)          </span>; # of seconds elapsed so far (KEEP AFTER secTimeOut)
<span style="color:gray">SYSINIT:529E </span><span style="color:navy">word_92CE       dw </span><span style="color:#008040">700h                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:52A0 </span><span style="color:navy">word_92D0       dw </span><span style="color:#008040">500h                 </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:52A2                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:52A3 </span><span style="color:navy">word_92D3       dw </span><span style="color:#008040">18h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:52A5                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:52A7                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:52A8 </span>aSubmenu        <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:52A8                                         </span>; CONFIG_SUBMENU
<span style="color:olive">SYSINIT:52A9                 </span><span style="color:navy">db    </span><span style="color:#008040">1
</span><span style="color:olive">SYSINIT:52AA                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52AB </span><span style="color:navy">unk_92DB        db    </span><span style="color:#008040">0                 </span><span style="color:#8080ff">; ...
</span><span style="color:olive">SYSINIT:52AC                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52AD </span><span style="color:navy">unk_92DD        db </span><span style="color:#008040">0FFh                 </span><span style="color:#8080ff">; ...
</span><span style="color:olive">SYSINIT:52AE                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52AF                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52B0                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52B1 </span><span style="color:navy">aMenucolor      db    </span><span style="color:#008040">0                 </span>; CONFIG_MENUCOLOR
<span style="color:olive">SYSINIT:52B2                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52B3                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52B4                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52B5                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52B6                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52B7                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52B8                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52B9                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52BA                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52BB                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52BC </span><span style="color:navy">aMenudefault    db    </span><span style="color:#008040">0                 </span>; CONFIG_MENUDEFAULT
<span style="color:olive">SYSINIT:52BD                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52BE                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52BF                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52C0                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52C1                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52C2                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52C3                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52C4                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52C5                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52C6                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52C7                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52C8                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52C9 </span><span style="color:navy">aMenuitem       db    </span><span style="color:#008040">0                 </span>; CONFIG_MENUITEM
<span style="color:olive">SYSINIT:52CA                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52CB                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52CC                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52CD                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52CE                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52CF                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52D0                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52D1                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52D2                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52D3 </span><span style="color:navy">aMultitrack     db    </span><span style="color:#008040">0                 </span>; CONFIG_MULTITRACK
<span style="color:olive">SYSINIT:52D4                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52D5                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52D6                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52D7                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52D8                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52D9                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52DA                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52DB                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52DC                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52DD                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52DE                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:52DF </span><span style="color:navy">aNumlock        db    </span><span style="color:#008040">0                 </span>; CONFIG_NUMLOCK
<span style="color:olive">SYSINIT:52E0                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:52E1 </span><span style="color:navy">aConfig         db &#039;CONFIG=&#039;,0
</span><span style="color:gray">SYSINIT:52E9 </span><span style="color:navy">aMenu           db &#039;MENU&#039;,0
</span><span style="color:gray">SYSINIT:52EE </span><span style="color:navy">aCommon         db &#039;COMMON&#039;,0
</span><span style="color:gray">SYSINIT:52F5                 </span><span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">SYSINIT:52F6                 </span><span style="color:navy">db &#039;[[&#039;
</span><span style="color:gray">SYSINIT:52F8                 </span><span style="color:navy">db </span><span style="color:#008040">5
</span><span style="color:gray">SYSINIT:52F9 </span>aStacks         <span style="color:navy">db &#039;BREAKC&#039;             </span>; CONFIG_STACKS
<span style="color:gray">SYSINIT:52FF                 </span><span style="color:navy">db </span><span style="color:#008040">7
</span><span style="color:gray">SYSINIT:5300 </span><span style="color:navy">aBuffersb       db &#039;BUFFERSB&#039;
</span><span style="color:gray">SYSINIT:5308                 </span><span style="color:navy">db </span><span style="color:#008040">7
</span><span style="color:gray">SYSINIT:5309 </span><span style="color:navy">aCommenty       db &#039;COMMENTY&#039;
</span><span style="color:gray">SYSINIT:5311                 </span><span style="color:navy">db </span><span style="color:#008040">7
</span><span style="color:gray">SYSINIT:5312 </span><span style="color:navy">aCountryq       db &#039;COUNTRYQ&#039;
</span><span style="color:gray">SYSINIT:531A                 </span><span style="color:navy">db </span><span style="color:#008040">6
</span><span style="color:gray">SYSINIT:531B </span>devp_totalsecs  <span style="color:navy">db &#039;DEVICED&#039;
</span><span style="color:gray">SYSINIT:5322 </span>devp_heads      <span style="color:navy">db </span><span style="color:#008040">0Ah
</span><span style="color:gray">SYSINIT:5323 </span><span style="color:navy">aDevicehighu    db &#039;DEVICEHIGHU&#039;
</span><span style="color:gray">SYSINIT:532E                 </span><span style="color:navy">db </span><span style="color:#008040">3
</span><span style="color:gray">SYSINIT:532F </span><span style="color:navy">aDosh           db &#039;DOSH&#039;
</span><span style="color:gray">SYSINIT:5333                 </span><span style="color:navy">db </span><span style="color:#008040">8
</span><span style="color:gray">SYSINIT:5334 </span><span style="color:navy">aDrivparmp      db &#039;DRIVPARMP&#039;
</span><span style="color:gray">SYSINIT:533D                 </span><span style="color:navy">db </span><span style="color:#008040">4
</span><span style="color:gray">SYSINIT:533E </span><span style="color:navy">aFcbsx          db &#039;FCBSX&#039;
</span><span style="color:gray">SYSINIT:5343                 </span><span style="color:navy">db </span><span style="color:#008040">5
</span><span style="color:gray">SYSINIT:5344 </span><span style="color:navy">aFilesf         db &#039;FILESF&#039;
</span><span style="color:gray">SYSINIT:534A                 </span><span style="color:navy">db </span><span style="color:#008040">7
</span><span style="color:gray">SYSINIT:534B </span><span style="color:navy">aIncludej       db &#039;INCLUDEJ&#039;
</span><span style="color:gray">SYSINIT:5353                 </span><span style="color:navy">db </span><span style="color:#008040">7
</span><span style="color:gray">SYSINIT:5354 </span><span style="color:navy">aInstalli       db &#039;INSTALLI&#039;
</span><span style="color:gray">SYSINIT:535C                 </span><span style="color:navy">db </span><span style="color:#008040">0Bh
</span><span style="color:gray">SYSINIT:535D </span><span style="color:navy">aInstallhighw   db &#039;INSTALLHIGHW&#039;
</span><span style="color:gray">SYSINIT:5369                 </span><span style="color:navy">db </span><span style="color:#008040">9
</span><span style="color:gray">SYSINIT:536A </span><span style="color:navy">aLastdrivel     db &#039;LASTDRIVEL&#039;
</span><span style="color:gray">SYSINIT:5374                 </span><span style="color:navy">db </span><span style="color:#008040">7
</span><span style="color:gray">SYSINIT:5375 </span><span style="color:navy">aSubmenuo       db &#039;SUBMENUO&#039;
</span><span style="color:gray">SYSINIT:537D                 </span><span style="color:navy">db </span><span style="color:#008040">9
</span><span style="color:gray">SYSINIT:537E </span><span style="color:navy">aMenucolorr     db &#039;MENUCOLORR&#039;
</span><span style="color:gray">SYSINIT:5388                 </span><span style="color:navy">db </span><span style="color:#008040">0Bh
</span><span style="color:gray">SYSINIT:5389 </span><span style="color:navy">aMenudefaulta   db &#039;MENUDEFAULTA&#039;
</span><span style="color:gray">SYSINIT:5395                 </span><span style="color:navy">db </span><span style="color:#008040">8
</span><span style="color:gray">SYSINIT:5396 </span><span style="color:navy">aMenuiteme      db &#039;MENUITEME&#039;
</span><span style="color:gray">SYSINIT:539F                 </span><span style="color:navy">db </span><span style="color:#008040">0Ah
</span><span style="color:gray">SYSINIT:53A0 </span><span style="color:navy">aMultitrackm    db &#039;MULTITRACKM&#039;
</span><span style="color:gray">SYSINIT:53AB                 </span><span style="color:navy">db </span><span style="color:#008040">7
</span><span style="color:gray">SYSINIT:53AC </span><span style="color:navy">aNumlockn       db &#039;NUMLOCKN&#039;
</span><span style="color:gray">SYSINIT:53B4                 </span><span style="color:navy">db </span><span style="color:#008040">3
</span><span style="color:gray">SYSINIT:53B5 </span><span style="color:navy">aRem0           db &#039;REM0&#039;
</span><span style="color:gray">SYSINIT:53B9                 </span><span style="color:navy">db </span><span style="color:#008040">3
</span><span style="color:gray">SYSINIT:53BA </span><span style="color:navy">aSetv           db &#039;SETV&#039;
</span><span style="color:gray">SYSINIT:53BE                 </span><span style="color:navy">db </span><span style="color:#008040">5
</span><span style="color:gray">SYSINIT:53BF </span><span style="color:navy">aShells         db &#039;SHELLS&#039;
</span><span style="color:gray">SYSINIT:53C5                 </span><span style="color:navy">db </span><span style="color:#008040">6
</span><span style="color:gray">SYSINIT:53C6 </span><span style="color:navy">aStacksk        db &#039;STACKSK&#039;
</span><span style="color:gray">SYSINIT:53CD                 </span><span style="color:navy">db </span><span style="color:#008040">8
</span><span style="color:gray">SYSINIT:53CE </span><span style="color:navy">aSwitches1      db &#039;SWITCHES1&#039;
</span><span style="color:gray">SYSINIT:53D7                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:53D8 </span><span style="color:navy">byte_9408       db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:53D9 </span><span style="color:navy">byte_9409       db </span><span style="color:#008040">2                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:53DA </span><span style="color:navy">byte_940A       db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:53DB                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:53DC </span><span style="color:navy">byte_940C       db </span><span style="color:#008040">50h                  </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:53DD </span><span style="color:navy">byte_940D       db </span><span style="color:#008040">11Fh </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">), </span><span style="color:#008040">2</span><span style="color:navy">, </span><span style="color:#008040">0</span><span style="color:navy">, </span><span style="color:#008040">9</span><span style="color:navy">, </span><span style="color:#008040">0 </span><span style="color:olive">; ...
SYSINIT:5500 </span><span style="color:navy">unk_9530        db    </span><span style="color:#008040">0                 </span><span style="color:#8080ff">; ...
</span><span style="color:olive">SYSINIT:5501 </span><span style="color:navy">unk_9531        db    </span><span style="color:#008040">0                 </span><span style="color:#8080ff">; ...
</span><span style="color:olive">SYSINIT:5502                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5503                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5504                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5505                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5506                 </span><span style="color:navy">db    </span><span style="color:#008040">1
</span><span style="color:olive">SYSINIT:5507                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5508                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5509                 </span><span style="color:navy">db  </span><span style="color:#008040">70h </span><span style="color:gray">; p
</span><span style="color:olive">SYSINIT:550A                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:550B                 </span><span style="color:navy">db </span><span style="color:#008040">0D0h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:550C                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:550D                 </span><span style="color:navy">db </span><span style="color:#008040">0FDh </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:550E                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:550F                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5510                 </span><span style="color:navy">db    </span><span style="color:#008040">9
</span><span style="color:olive">SYSINIT:5511                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5512                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5513                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5514                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5515                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5516                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5517                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5518 </span><span style="color:navy">badsiz_pre      db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5519                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:551A                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:551B                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:551C                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:551D                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:551E                 </span><span style="color:navy">db    </span><span style="color:#008040">1
</span><span style="color:olive">SYSINIT:551F                 </span><span style="color:navy">db    </span><span style="color:#008040">1
</span><span style="color:olive">SYSINIT:5520                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5521                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5522                 </span><span style="color:navy">db </span><span style="color:#008040">0E0h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:5523                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5524                 </span><span style="color:navy">db  </span><span style="color:#008040">60h </span><span style="color:gray">; `
</span><span style="color:olive">SYSINIT:5525                 </span><span style="color:navy">db    </span><span style="color:#008040">9
</span><span style="color:olive">SYSINIT:5526                 </span><span style="color:navy">db </span><span style="color:#008040">0F9h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:5527                 </span><span style="color:navy">db    </span><span style="color:#008040">7
</span><span style="color:olive">SYSINIT:5528                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5529                 </span><span style="color:navy">db  </span><span style="color:#008040">0Fh
</span><span style="color:olive">SYSINIT:552A                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:552B                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:552C                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:552D                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:552E                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:552F                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5530                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5531                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5532                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5533                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5534                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5535                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5536                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5537                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5538                 </span><span style="color:navy">db    </span><span style="color:#008040">1
</span><span style="color:olive">SYSINIT:5539 </span><span style="color:navy">badld_pre       db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:553A                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:553B                 </span><span style="color:navy">db  </span><span style="color:#008040">70h </span><span style="color:gray">; p
</span><span style="color:olive">SYSINIT:553C                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:553D                 </span><span style="color:navy">db </span><span style="color:#008040">0A0h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:553E                 </span><span style="color:navy">db    </span><span style="color:#008040">5
</span><span style="color:olive">SYSINIT:553F                 </span><span style="color:navy">db </span><span style="color:#008040">0F9h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:5540                 </span><span style="color:navy">db    </span><span style="color:#008040">3
</span><span style="color:olive">SYSINIT:5541                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5542                 </span><span style="color:navy">db    </span><span style="color:#008040">9
</span><span style="color:olive">SYSINIT:5543                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5544                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5545                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5546                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5547                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5548                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5549                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:554A                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:554B </span><span style="color:navy">badcom          db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:554C                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:554D                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:554E                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:554F                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5550                 </span><span style="color:navy">db    </span><span style="color:#008040">1
</span><span style="color:olive">SYSINIT:5551                 </span><span style="color:navy">db    </span><span style="color:#008040">1
</span><span style="color:olive">SYSINIT:5552                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5553                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5554                 </span><span style="color:navy">db </span><span style="color:#008040">0E0h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:5555                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5556                 </span><span style="color:navy">db  </span><span style="color:#008040">40h </span><span style="color:gray">; @
</span><span style="color:olive">SYSINIT:5557                 </span><span style="color:navy">db  </span><span style="color:#008040">0Bh
</span><span style="color:olive">SYSINIT:5558                 </span><span style="color:navy">db </span><span style="color:#008040">0F0h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:5559                 </span><span style="color:navy">db    </span><span style="color:#008040">9
</span><span style="color:olive">SYSINIT:555A                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:555B                 </span><span style="color:navy">db  </span><span style="color:#008040">12h
</span><span style="color:olive">SYSINIT:555C                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:555D                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:555E                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:555F </span><span style="color:navy">badcountry      db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5560                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5561                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5562                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5563                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5564                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5565                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5566                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5567                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5568                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5569                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:556A                 </span><span style="color:navy">db    </span><span style="color:#008040">1
</span><span style="color:olive">SYSINIT:556B                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:556C                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:556D                 </span><span style="color:navy">db </span><span style="color:#008040">0F0h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:556E                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:556F                 </span><span style="color:navy">db  </span><span style="color:#008040">80h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:5570                 </span><span style="color:navy">db  </span><span style="color:#008040">16h
</span><span style="color:olive">SYSINIT:5571                 </span><span style="color:navy">db </span><span style="color:#008040">0F0h </span><span style="color:gray">; 
</span><span style="color:olive">SYSINIT:5572                 </span><span style="color:navy">db    </span><span style="color:#008040">9
</span><span style="color:olive">SYSINIT:5573                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5574                 </span><span style="color:navy">db  </span><span style="color:#008040">24h </span><span style="color:gray">; $
</span><span style="color:olive">SYSINIT:5575                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5576                 </span><span style="color:navy">db    </span><span style="color:#008040">2
</span><span style="color:olive">SYSINIT:5577                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5578                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5579                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:557A                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:557B                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:557C                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:557D                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:557E                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:557F                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5580                 </span><span style="color:navy">db    </span><span style="color:#008040">3
</span><span style="color:olive">SYSINIT:5581                 </span><span style="color:navy">db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:5582                 </span><span style="color:navy">db  </span><span style="color:#008040">1Ch
</span><span style="color:olive">SYSINIT:5583                 </span><span style="color:navy">db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:5584                 </span><span style="color:navy">db  </span><span style="color:#008040">35h </span><span style="color:gray">; 5
</span><span style="color:olive">SYSINIT:5585 </span><span style="color:navy">badcountrycom   db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:5586                 </span><span style="color:navy">db  </span><span style="color:#008040">35h </span><span style="color:gray">; 5
</span><span style="color:olive">SYSINIT:5587                 </span><span style="color:navy">db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:5588                 </span><span style="color:navy">db  </span><span style="color:#008040">35h </span><span style="color:gray">; 5
</span><span style="color:olive">SYSINIT:5589                 </span><span style="color:navy">db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:558A                 </span><span style="color:navy">db  </span><span style="color:#008040">35h </span><span style="color:gray">; 5
</span><span style="color:olive">SYSINIT:558B                 </span><span style="color:navy">db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:558C                 </span><span style="color:navy">db  </span><span style="color:#008040">35h </span><span style="color:gray">; 5
</span><span style="color:olive">SYSINIT:558D                 </span><span style="color:navy">db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:558E                 </span><span style="color:navy">db  </span><span style="color:#008040">4Eh </span><span style="color:gray">; N
</span><span style="color:olive">SYSINIT:558F                 </span><span style="color:navy">db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:5590                 </span><span style="color:navy">db  </span><span style="color:#008040">35h </span><span style="color:gray">; 5
</span><span style="color:olive">SYSINIT:5591                 </span><span style="color:navy">db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:5592                 </span><span style="color:navy">db  </span><span style="color:#008040">67h </span><span style="color:gray">; g
</span><span style="color:olive">SYSINIT:5593                 </span><span style="color:navy">db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:5594                 </span><span style="color:navy">db    </span><span style="color:#008040">8
</span><span style="color:olive">SYSINIT:5595                 </span><span style="color:navy">db  </span><span style="color:#008040">46h </span><span style="color:gray">; F
</span><span style="color:olive">SYSINIT:5596                 </span><span style="color:navy">db  </span><span style="color:#008040">48h </span><span style="color:gray">; H
</span><span style="color:olive">SYSINIT:5597                 </span><span style="color:navy">db  </span><span style="color:#008040">53h </span><span style="color:gray">; S
</span><span style="color:olive">SYSINIT:5598                 </span><span style="color:navy">db  </span><span style="color:#008040">54h </span><span style="color:gray">; T
</span><span style="color:olive">SYSINIT:5599                 </span><span style="color:navy">db  </span><span style="color:#008040">44h </span><span style="color:gray">; D
</span><span style="color:olive">SYSINIT:559A                 </span><span style="color:navy">db  </span><span style="color:#008040">49h </span><span style="color:gray">; I
</span><span style="color:olive">SYSINIT:559B                 </span><span style="color:navy">db  </span><span style="color:#008040">43h </span><span style="color:gray">; C
</span><span style="color:olive">SYSINIT:559C                 </span><span style="color:navy">db  </span><span style="color:#008040">4Eh </span><span style="color:gray">; N
</span><span style="color:olive">SYSINIT:559D                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:559E </span><span style="color:navy">unk_95CE        db  </span><span style="color:#008040">0Dh                 </span><span style="color:#8080ff">; ...
</span><span style="color:olive">SYSINIT:559F                 </span><span style="color:navy">db  </span><span style="color:#008040">0Ah
</span><span style="color:olive">SYSINIT:55A0                 </span><span style="color:navy">db  </span><span style="color:#008040">55h </span><span style="color:gray">; U
</span><span style="color:olive">SYSINIT:55A1                 </span><span style="color:navy">db  </span><span style="color:#008040">6Eh </span><span style="color:gray">; n
SYSINIT:55A2 </span>insufmemory     <span style="color:navy">db &#039;recognized command in CONFIG.SYS&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:55A2                 </span><span style="color:navy">db &#039;$&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:55A2                 </span><span style="color:navy">db &#039;Bad comm&#039;
</span><span style="color:gray">SYSINIT:55CF </span>badmem          <span style="color:navy">db &#039;and or parameters - $&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:55CF                 </span><span style="color:navy">db &#039;Sector size too &#039;
</span><span style="color:gray">SYSINIT:55F6 </span>badblock        <span style="color:navy">db &#039;large in file $&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:55F6                 </span><span style="color:navy">db &#039;Bad or mis&#039;
</span><span style="color:gray">SYSINIT:5611 </span>badstack        <span style="color:navy">db &#039;sing $Command Interpreter&#039;,0,0Dh,0Ah,&#039;I&#039; </span><span style="color:olive">; ...
</span><span style="color:gray">SYSINIT:562E </span>badorder        <span style="color:navy">db &#039;nvalid country code or code page&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:562E                 </span><span style="color:navy">db &#039;$&#039;,0Dh,0Ah,&#039;E&#039;
</span><span style="color:gray">SYSINIT:5654 </span>errorcmd        <span style="color:navy">db &#039;rror in COUNTRY command&#039;,0Dh,0Ah,&#039;$&#039;
</span><span style="color:gray">SYSINIT:566E </span>OnOff           <span style="color:navy">db </span><span style="color:green">0Dh</span><span style="color:navy">,</span><span style="color:green">0Ah              </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:5670 </span>OnOff2          <span style="color:navy">db &#039;Ins&#039;
</span><span style="color:gray">SYSINIT:5673 </span>StartMsg        <span style="color:navy">db &#039;ufficient memory for C&#039;
</span><span style="color:gray">SYSINIT:5689 </span>_$PauseMsg      <span style="color:navy">db &#039;OUNTRY.SYS file&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:5689                 </span><span style="color:navy">db &#039;$&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:5689                 </span><span style="color:navy">db &#039;Configuration &#039;
</span><span style="color:gray">SYSINIT:56AB </span>_$CleanMsg      <span style="color:navy">db &#039;too large for memory&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:56AB                 </span><span style="color:navy">db &#039;$&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:56AB                 </span><span style="color:navy">db &#039;Too many block devices&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:56AB                 </span><span style="color:navy">db &#039;$&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:56AB                 </span><span style="color:navy">db &#039;Invalid ST&#039;
</span><span style="color:gray">SYSINIT:56E9 </span>_$InterMsg      <span style="color:navy">db &#039;ACK parameters&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:56E9                 </span><span style="color:navy">db &#039;$&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:56E9                 </span><span style="color:navy">db &#039;Incorrect order in CONFIG.SYS line $Error &#039;
</span><span style="color:gray">SYSINIT:5726 </span>_$MenuHeader    <span style="color:navy">db &#039;in CONFIG.SYS line $ONOFFStar&#039;
</span><span style="color:gray">SYSINIT:5743 </span><span style="color:navy">aTi             db &#039;ti&#039;
</span><span style="color:olive">SYSINIT:5745                 </span><span style="color:navy">db  </span><span style="color:#008040">6Eh </span><span style="color:gray">; n             </span>; db &#039;=======================&#039; ; ALT 205
<span style="color:olive">SYSINIT:5746                 </span><span style="color:navy">db  </span><span style="color:#008040">67h </span><span style="color:gray">; g
</span><span style="color:olive">SYSINIT:5747                 </span><span style="color:navy">db  </span><span style="color:#008040">20h
</span><span style="color:olive">SYSINIT:5748                 </span><span style="color:navy">db  </span><span style="color:#008040">4Dh </span><span style="color:gray">; M
</span><span style="color:olive">SYSINIT:5749                 </span><span style="color:navy">db  </span><span style="color:#008040">53h </span><span style="color:gray">; S
</span><span style="color:olive">SYSINIT:574A                 </span><span style="color:navy">db  </span><span style="color:#008040">2Dh </span><span style="color:gray">; -
</span><span style="color:olive">SYSINIT:574B                 </span><span style="color:navy">db  </span><span style="color:#008040">44h </span><span style="color:gray">; D
</span><span style="color:olive">SYSINIT:574C                 </span><span style="color:navy">db  </span><span style="color:#008040">4Fh </span><span style="color:gray">; O
</span><span style="color:olive">SYSINIT:574D                 </span><span style="color:navy">db  </span><span style="color:#008040">53h </span><span style="color:gray">; S
</span><span style="color:olive">SYSINIT:574E                 </span><span style="color:navy">db  </span><span style="color:#008040">2Eh </span><span style="color:gray">; .
</span><span style="color:olive">SYSINIT:574F                 </span><span style="color:navy">db  </span><span style="color:#008040">2Eh </span><span style="color:gray">; .
</span><span style="color:olive">SYSINIT:5750                 </span><span style="color:navy">db  </span><span style="color:#008040">2Eh </span><span style="color:gray">; .
</span><span style="color:olive">SYSINIT:5751                 </span><span style="color:navy">db  </span><span style="color:#008040">0Dh
</span><span style="color:olive">SYSINIT:5752                 </span><span style="color:navy">db  </span><span style="color:#008040">0Ah
</span><span style="color:olive">SYSINIT:5753                 </span><span style="color:navy">db  </span><span style="color:#008040">0Ah
</span><span style="color:olive">SYSINIT:5754                 </span><span style="color:navy">db    </span><span style="color:#008040">0
</span><span style="color:olive">SYSINIT:5755                 </span><span style="color:navy">db  </span><span style="color:#008040">50h </span><span style="color:gray">; P
</span><span style="color:olive">SYSINIT:5756                 </span><span style="color:navy">db  </span><span style="color:#008040">72h </span><span style="color:gray">; r
</span><span style="color:olive">SYSINIT:5757                 </span><span style="color:navy">db  </span><span style="color:#008040">65h </span><span style="color:gray">; e
</span><span style="color:olive">SYSINIT:5758                 </span><span style="color:navy">db  </span><span style="color:#008040">73h </span><span style="color:gray">; s
</span><span style="color:olive">SYSINIT:5759                 </span><span style="color:navy">db  </span><span style="color:#008040">73h </span><span style="color:gray">; s
</span><span style="color:olive">SYSINIT:575A                 </span><span style="color:navy">db  </span><span style="color:#008040">20h
</span><span style="color:olive">SYSINIT:575B                 </span><span style="color:navy">db  </span><span style="color:#008040">61h </span><span style="color:gray">; a
SYSINIT:575C </span><span style="color:navy">aNy             db &#039;ny &#039;
</span><span style="color:gray">SYSINIT:575F </span>_$MenuPrmpt     <span style="color:navy">db &#039;key to continue . .&#039;
</span><span style="color:gray">SYSINIT:5772 </span>_$StatusLine    <span style="color:navy">db &#039; .&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:5772                 </span><span style="color:navy">db &#039;$MS-DOS is bypassing your CONFIG.SYS and AUTOEXEC.BAT files.&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:5772                 </span><span style="color:navy">db &#039;$MS-DOS will p&#039;
</span><span style="color:gray">SYSINIT:57C2 </span>_$InterPrmpt    <span style="color:navy">db &#039;rompt yo&#039;
</span><span style="color:gray">SYSINIT:57CA </span>_$YES           <span style="color:navy">db &#039;u to&#039;
</span><span style="color:gray">SYSINIT:57CE </span>_$NO            <span style="color:navy">db &#039; con&#039;
</span><span style="color:gray">SYSINIT:57D2 </span>_$TimeOut       <span style="color:navy">db &#039;firm each CONFIG.&#039;
</span><span style="color:gray">SYSINIT:57E3 </span>badcomprmpt     <span style="color:navy">db &#039;SYS command.&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:57E3                 </span><span style="color:navy">db &#039;$&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:57E3                 </span><span style="color:navy">db &#039; MS-DOS 6.22 Startup Menu&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:57E3                 </span><span style="color:navy">db &#039; ====================&#039;
</span><span style="color:gray">SYSINIT:5824 </span>_$AutoPrmpt     <span style="color:navy">db &#039;====&#039;,0Dh,0Ah
</span><span style="color:gray">SYSINIT:5824                 </span><span style="color:navy">db &#039;$  Enter a choice: $F5&#039;
</span><span style="color:gray">SYSINIT:5840 </span>TooManyDrivesMsg <span style="color:navy">db &#039;=Bypass startup files F8=Confirm each line of CONFIG.SYS and&#039;
</span><span style="color:gray">SYSINIT:587C </span>baddblspace     <span style="color:navy">db &#039; AUTOEXEC.BAT [ ]$&#039;
</span><span style="color:gray">SYSINIT:588E                 </span><span style="color:navy">db &#039; [Y,N]?$&#039;
</span><span style="color:gray">SYSINIT:5896                 </span><span style="color:navy">db &#039;YES$&#039;
</span><span style="color:gray">SYSINIT:589A                 </span><span style="color:navy">db &#039;NO $&#039;
</span><span style="color:gray">SYSINIT:589E                 </span><span style="color:navy">db &#039;Time remaining: $&#039;
</span><span style="color:gray">SYSINIT:58AF </span><span style="color:navy">asc_98DF        db &#039;Enter correct name of Command Interpreter (eg, C:\COMMAND.COM)&#039;,0Dh,0Ah </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:58AF                 </span><span style="color:navy">db &#039;$&#039;
</span><span style="color:gray">SYSINIT:58F0                 </span><span style="color:navy">db &#039;Process AUTOEXEC.BAT [Y,N]?$&#039;
</span><span style="color:gray">SYSINIT:590C </span><span style="color:navy">asc_993C        db &#039;WARNING! Logical drives past Z: exist and will be ignored&#039;,0Dh,0Ah,&#039;$&#039; </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:5948 </span><span style="color:navy">asc_9978        db &#039;Wrong DBLSPACE.BIN version&#039;,0Dh,0Ah,&#039;$&#039; </span><span style="color:#8080ff">; ...
</span><span style="color:gray">SYSINIT:5965                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">SYSINIT:5966                 </span><span style="color:navy">db </span><span style="color:#008040">9 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">SYSINIT:5966 </span>SYSINIT         ends
<span style="color:gray">SYSINIT:5966
SYSINIT:5966
SYSINIT:5966                 </span>end
</span></body></html>
