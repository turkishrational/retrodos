     1                                  ; ****************************************************************************
     2                                  ; 'rd5hdi16.s' - Retro DOS v5 Hard Disk Image (FAT16 FS) Formatting Utility
     3                                  ; 					 	        (for MSDOS/WINDOWS)
     4                                  ; ****************************************************************************
     5                                  ; Last Update: 04/05/2024
     6                                  ; ----------------------------------------------------------------------------
     7                                  ; Beginning: 04/05/2024
     8                                  ; ----------------------------------------------------------------------------
     9                                  ; Assembler: NASM version 2.15
    10                                  ; ----------------------------------------------------------------------------
    11                                  ; Modified from 'fat16hdi.s'(FAT16HDI.COM) source code by Erdogan Tan
    12                                  ; (28/10/2023) - Retro DOS v3-v4 hard disk (FAT16) image formatting utility -
    13                                  ; ****************************************************************************
    14                                  ; nasm rd5hdi16.s -l rd5hdi16.txt -o RD5HDI16.COM
    15                                  
    16                                  bsOemName	equ RETRODOS_FAT16_hd_bs + 3
    17                                  bsBytesPerSec	equ RETRODOS_FAT16_hd_bs + 11
    18                                  bsSecPerClust	equ RETRODOS_FAT16_hd_bs + 13
    19                                  bsResSectors	equ RETRODOS_FAT16_hd_bs + 14
    20                                  bsFATs		equ RETRODOS_FAT16_hd_bs + 16	
    21                                  bsRootDirEnts	equ RETRODOS_FAT16_hd_bs + 17
    22                                  bsSectors	equ RETRODOS_FAT16_hd_bs + 19
    23                                  bsMedia		equ RETRODOS_FAT16_hd_bs + 21
    24                                  bsFATsecs	equ RETRODOS_FAT16_hd_bs + 22
    25                                  bsSecPerTrk	equ RETRODOS_FAT16_hd_bs + 24
    26                                  bsHeads		equ RETRODOS_FAT16_hd_bs + 26
    27                                  bsHidden1	equ RETRODOS_FAT16_hd_bs + 28
    28                                  bsHidden2	equ RETRODOS_FAT16_hd_bs + 30	
    29                                  bsHugeSectors	equ RETRODOS_FAT16_hd_bs + 32
    30                                  bsDriveNumber   equ RETRODOS_FAT16_hd_bs + 36
    31                                  bsReserved1	equ RETRODOS_FAT16_hd_bs + 37
    32                                  bsBpbSignature	equ RETRODOS_FAT16_hd_bs + 38
    33                                  bsVolumeID      equ RETRODOS_FAT16_hd_bs + 39
    34                                  bsVolumeLabel   equ RETRODOS_FAT16_hd_bs + 43
    35                                  bsFileSysType	equ RETRODOS_FAT16_hd_bs + 54
    36                                  bsReserved2	equ RETRODOS_FAT16_hd_bs + 62
    37                                  bsDataStart	equ RETRODOS_FAT16_hd_bs + 64	
    38                                  bsRootDirStart	equ RETRODOS_FAT16_hd_bs + 66
    39                                  bsRootDirSects	equ RETRODOS_FAT16_hd_bs + 68
    40                                  
    41                                  ; DTA (PSP+80h= Offset 128)
    42                                  DTA_Attrib equ 149 ; PDP+21
    43                                  DTA_Time equ 150 ; PSP+22
    44                                  DTA_Date equ 152 ; PSP 24
    45                                  DTA_FileSize equ 154 ; PSP + 26
    46                                  DTA_FileName equ 158 ; PSP + 30
    47                                  
    48                                  ; Masterboot / Partition Table at Beginning+1BEh
    49                                  ptBootable      equ 0
    50                                  ptBeginHead     equ 1
    51                                  ptBeginSector   equ 2
    52                                  ptBeginCylinder equ 3
    53                                  ptFileSystemID	equ 4
    54                                  ptEndHead       equ 5
    55                                  ptEndSector     equ 6
    56                                  ptEndCylinder   equ 7
    57                                  ptStartSector   equ 8
    58                                  ptSectors       equ 12
    59                                  
    60                                  pt_cylinders	equ RETRODOS_MASTERBOOT_SECTOR + 1B8h	
    61                                  pt_heads	equ RETRODOS_MASTERBOOT_SECTOR + 1BAh	
    62                                  pt_sectors	equ RETRODOS_MASTERBOOT_SECTOR + 1BCh
    63                                  partition_table equ RETRODOS_MASTERBOOT_SECTOR + 1BEh
    64                                  
    65                                  ; BIOS Disk Parameters
    66                                  DPDiskNumber  equ 0h
    67                                  DPDType       equ 1h
    68                                  DPReturn      equ 2h
    69                                  DPHeads       equ 3h
    70                                  DPCylinders   equ 4h
    71                                  DPSecPerTrack equ 6h
    72                                  DPDisks       equ 7h
    73                                  DPTableOff    equ 8h
    74                                  DPTableSeg    equ 0Ah
    75                                  DPNumOfSecs   equ 0Ch
    76                                  
    77                                  ; BIOS INT 13h Extensions (LBA extensions)
    78                                  ; Just After DP Data (DPDiskNumber+)
    79                                  DAP_PacketSize equ 10h  ; If extensions present, this byte will be >=10h
    80                                  DAP_Reserved1 equ 11h   ; Reserved Byte 
    81                                  DAP_NumOfBlocks equ 12h ; Value of this byte must be 0 to 127
    82                                  DAP_Reserved2 equ 13h   ; Reserved Byte
    83                                  DAP_Destination equ 14h ; Address of Transfer Buffer as SEGMENT:OFFSET
    84                                  DAP_LBA_Address equ 18h ; LBA=(C1*H0+H1)*S0+S1-1
    85                                                          ; C1= Selected Cylinder Number
    86                                                          ; H0= Number Of Heads (Maximum Head Number + 1)
    87                                                          ; H1= Selected Head Number
    88                                                          ; S0= Maximum Sector Number
    89                                                          ; S1= Selected Sector Number
    90                                                          ; QUAD WORD
    91                                  ; DAP_Flat_Destination equ 20h ; 64 bit address, if value in 4h is FFFF:FFFFh
    92                                                               ; QUAD WORD (Also, value in 0h must be 18h) 
    93                                                               ; TR-DOS will not use 64 bit Flat Address
    94                                  
    95                                  ; INT 13h Function 48h "Get Enhanced Disk Drive Parameters"
    96                                  ; Just After DP Data (DPDiskNumber+)
    97                                  GetDParams_48h equ 20h ; Word. Data Lenght, must be 26 (1Ah) for short data.
    98                                  GDP_48h_InfoFlag equ 22h ; Word
    99                                  ; Bit 1 = 1 -> The geometry returned in bytes 4-15 is valid.
   100                                  GDP_48h_NumOfPCyls equ 24h ; Double Word. Number physical cylinders.
   101                                  GDP_48h_NumOfPHeads equ 28h ; Double Word. Number of physical heads.
   102                                  GDP_48h_NumOfPSpT equ 2Ch ; Double word. Num of physical sectors per track.
   103                                  GDP_48h_LBA_Sectors equ 30h ; 8 bytes. Number of physical/LBA sectors.
   104                                  GDP_48h_BytesPerSec equ 38h ; Word. Number of bytes in a sector.
   105                                  
   106                                  ; Cursor Location
   107                                  CCCpointer equ  0450h   ; BIOS data, current cursor column
   108                                  
   109                                  ; MINIMUM & MAXIMUM SECTORS (partition and disk size limits in sectors)
   110                                  MINPARTSIZE equ 4096 ; 2GB
   111                                  MAXPARTSIZE equ 4128768 - 1 ; 2GB - masterboot sector	
   112                                  MINDISKSIZE equ 16384 ; 8MB
   113                                  MAXDISKSIZE equ 4128768 ; 2GB
   114                                  
   115                                  pTableOffset equ 1BEh ; 446		
   116                                  
   117                                  [BITS 16]
   118                                  [ORG 100h]
   119                                  
   120                                  	;cli
   121                                  	;cld
   122                                  	;push	cs
   123                                  	;pop	ss
   124                                  	;mov	sp, 0FFFEh
   125                                  	;sti
   126                                  	
   127 00000000 BB[491B]                	mov	bx, SizeOfFile+100
   128 00000003 83C30F                          add	bx, 15
   129 00000006 D1EB                            shr	bx, 1
   130 00000008 D1EB                            shr	bx, 1
   131 0000000A D1EB                    	shr	bx, 1
   132 0000000C D1EB                    	shr	bx, 1
   133 0000000E B44A                            mov	ah, 4Ah ; modify memory allocation
   134                                          ;push	cs
   135                                          ;pop	es
   136 00000010 CD21                            int	21h 
   137                                  
   138                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   139                                  ; get fd image file name
   140                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   141                                  
   142 00000012 BE8000                  	mov	si, 80h			; PSP command tail
   143 00000015 AC                       	lodsb
   144 00000016 08C0                    	or	al, al 			; command tail length                            
   145 00000018 0F844001                	jz	R_15			; jump if zero
   146                                  R_01:
   147 0000001C AC                      	lodsb
   148 0000001D 3C20                    	cmp	al, ' '			; is it SPACE ?
   149 0000001F 74FB                    	je	short R_01 		
   150 00000021 0F823701                	jb	R_15
   151                                  	
   152                                  	; check hd image file name
   153                                  R_02:
   154 00000025 BF[2119]                       	mov	di, img_file_name
   155 00000028 AA                      	stosb
   156                                  R_03:
   157 00000029 AC                      	lodsb
   158                                  	;cmp	al, 0Dh ; ENTER (CR) key
   159 0000002A 3C20                    	cmp	al, 20h ; ' '
   160 0000002C 760C                    	jna	short R_04
   161 0000002E AA                      	stosb
   162 0000002F 81FF[2D19]              	cmp	di, img_file_name + 12
   163 00000033 72F4                    	jb	short R_03
   164 00000035 803C20                  	cmp	byte [si], 20h 
   165 00000038 7748                    	ja	short R_11
   166                                  R_04:
   167                                  	;sub	al, al
   168                                  	;stosb
   169                                  
   170                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   171                                  ; File name capitalization
   172                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   173                                  
   174 0000003A BE[2119]                	mov	si, img_file_name
   175 0000003D 89F7                    	mov	di, si
   176 0000003F 89F3                    	mov	bx, si
   177                                  R_05:
   178 00000041 AC                      	lodsb
   179 00000042 3C61                    	cmp	al, 'a'
   180 00000044 730D                    	jnb	short R_07
   181 00000046 20C0                    	and	al, al
   182 00000048 7412                    	jz	short R_08
   183 0000004A 3C2E                    	cmp	al, '.'
   184 0000004C 7502                    	jne	short R_06
   185 0000004E 89FB                    	mov	bx, di ; dot position	
   186                                  R_06:
   187 00000050 AA                      	stosb
   188 00000051 EBEE                    	jmp	short R_05 		
   189                                  R_07:
   190 00000053 3C7A                    	cmp	al, 'z'
   191 00000055 77F9                    	ja	short R_06
   192 00000057 24DF                    	and	al, 0DFh ; NOT 32
   193 00000059 AA                      	stosb
   194 0000005A EBE5                    	jmp	short R_05	
   195                                  R_08:
   196 0000005C 8805                    	mov	[di], al
   197 0000005E 4F                      	dec	di
   198 0000005F 39FB                    	cmp	bx, di
   199 00000061 7316                    	jnb	short R_10
   200 00000063 29DF                    	sub	di, bx
   201 00000065 81EB[2119]              	sub	bx, img_file_name
   202 00000069 83FF03                  	cmp	di, 3
   203 0000006C 7606                    	jna	short R_09
   204 0000006E 21DB                    	and	bx, bx
   205 00000070 7507                    	jnz	short R_10
   206 00000072 EB0E                    	jmp	short R_11		
   207                                  R_09:
   208 00000074 83FB08                  	cmp	bx, 8
   209 00000077 7609                    	jna	short R_11
   210                                  R_10:
   211 00000079 BE[0B13]                	mov	si, msg_inv_file_name
   212 0000007C E8F004                  	call	print_msg
   213 0000007F E9CF00                  	jmp	R_14
   214                                  
   215                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   216                                  ; Find image file
   217                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   218                                  	
   219                                  R_11:
   220 00000082 BA[2119]                	mov	dx, img_file_name
   221 00000085 B93F00                  	mov	cx, 3Fh ; File Attributes
   222 00000088 B44E                    	mov	ah, 4Eh ; MS-DOS Function = Find First File
   223 0000008A CD21                    	int	21h
   224 0000008C 0F82F100                	jc	R_19
   225                                  
   226                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   227                                  ; Check image file features
   228                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   229                                  
   230 00000090 BE9500                  	mov	si, DTA_Attrib
   231 00000093 8A04                    	mov	al, [si]
   232 00000095 241F                    	and	al, 1Fh ; directory, volume label, system, hidden, read only
   233 00000097 7554                    	jnz	short R_11e     
   234 00000099 BE9A00                  	mov	si, DTA_FileSize
   235 0000009C AD                      	lodsw
   236 0000009D 8B14                    	mov	dx, [si]
   237                                  
   238 0000009F 81FAF801                	cmp	dx, 1F8h
   239 000000A3 724A                    	jb	short R_11f
   240 000000A5 7442                    	je	short R_11d
   241                                  	
   242 000000A7 81FA801F                	cmp	dx, 1F80h ; High word of 1F800000h (512MB)
   243 000000AB 7740                    	ja	short R_11e
   244                                  
   245 000000AD 21C0                    	and	ax, ax
   246 000000AF 753C                    	jnz	short R_11e
   247                                  
   248                                  	;mov	ax, 128 ; * 128 (65536/512 = 128)
   249 000000B1 B080                    	mov	al, 128
   250 000000B3 F7E2                    	mul	dx
   251 000000B5 83FA0F                  	cmp	dx, 0Fh  ; dx:ax = 0FC000h (512MB disk)
   252 000000B8 7507                    	jne	short R_11a
   253 000000BA 3D00C0                  	cmp	ax, 0C000h
   254 000000BD 752E                    	jne	short R_11e
   255 000000BF EB5C                    	jmp	short R_12
   256                                  R_11a:
   257 000000C1 83FA07                  	cmp	dx, 7
   258 000000C4 7727                    	ja	short R_11e
   259 000000C6 7207                    	jb	short R_11b
   260 000000C8 3D00E0                  	cmp	ax, 0E000h  ; 7E000h (256MB disk)
   261 000000CB 7520                    	jne	short R_11e
   262 000000CD EB4E                    	jmp	short R_12	
   263                                  R_11b:
   264 000000CF 83FA03                   	cmp	dx, 3
   265 000000D2 7719                    	ja	short R_11e
   266 000000D4 7207                    	jb	short R_11c
   267 000000D6 3D00F0                  	cmp	ax, 0F000h  ; 3F000h (128MB disk)
   268 000000D9 7512                    	jne	short R_11e
   269 000000DB EB40                    	jmp	short R_12
   270                                  R_11c:
   271 000000DD 83FA01                  	cmp	dx, 1	    ; 1F800h (64MB disk)
   272 000000E0 750B                    	jne	short R_11e
   273 000000E2 3D00F8                  	cmp	ax, 0F800h
   274 000000E5 7436                    	je	short R_12
   275 000000E7 EB04                    	jmp	short R_11e
   276                                  R_11d:
   277 000000E9 09C0                    	or	ax, ax
   278 000000EB 7430                    	jz	short R_12
   279                                  R_11e:
   280 000000ED EB7D                    	jmp	short R_17
   281                                  
   282                                  R_11f:
   283 000000EF A9FF01                  	test	ax, 511
   284 000000F2 7578                    	jnz	short R_17
   285                                  
   286 000000F4 C1E809                  	shr	ax, 9   ; / 512
   287 000000F7 C1E207                  	shl	dx, 7 ; 65536/512 = 128 (128*DX sectors + AX sectors)
   288 000000FA 01D0                    	add	ax, dx	
   289                                  
   290 000000FC 3D00FC                  	cmp	ax, 64512 ; 64*16*63 sectors
   291 000000FF 776B                    	ja	short R_17
   292 00000101 741A                    	je	short R_12
   293 00000103 3D90A2                  	cmp	ax, 41616 ; 306*8*17 sectors
   294 00000106 7264                    	jb	short R_17
   295 00000108 7413                    	je	short R_12
   296 0000010A 3D70F5                  	cmp	ax, 62832 ; 462*8*17 sectors
   297 0000010D 740E                    	je	short R_12
   298 0000010F 775B                    	ja	short R_17
   299 00000111 3D007E                  	cmp	ax, 32256 ; 32*16*63 sectors
   300 00000114 7407                    	je	short R_12
   301 00000116 7254                    	jb	short R_17
   302 00000118 3D809D                  	cmp	ax, 40320 ; 40*16*63 sectors
   303 0000011B 754F                    	jne	short R_17		
   304                                  R_12:
   305                                  
   306                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   307                                  ; Overwrite question
   308                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   309                                  
   310 0000011D BE[4117]                	mov	si, msg_overwrite_question1
   311 00000120 E84C04                  	call	print_msg
   312 00000123 BE9E00                  	mov	si, DTA_FileName
   313 00000126 E84604                  	call	print_msg
   314 00000129 BE[5E17]                	mov	si, msg_overwrite_question2
   315 0000012C E84004                  	call	print_msg
   316 0000012F BE[6617]                	mov	si, msg_yes_no
   317 00000132 E83A04                  	call	print_msg
   318                                  
   319                                  	; get answer
   320                                  R_13:
   321 00000135 31C0                    	xor	ax, ax
   322 00000137 CD16                    	int	16h			; wait for keyboard command
   323 00000139 3C03                    	cmp	al, 'C'-40h
   324 0000013B 7414                    	je	short R_14 ; Exit                   
   325 0000013D 3C1B                    	cmp	al, 27
   326 0000013F 7410                    	je	short R_14 ; Exit
   327 00000141 24DF                    	and	al, 0DFh
   328 00000143 3C59                    	cmp	al, 'Y'			; Yes?
   329 00000145 741D                    	je	short R_16		; write
   330 00000147 3C4E                    	cmp	al, 'N'			; No?
   331 00000149 75EA                    	jne	short R_13      
   332                                  					; no write (exit)  
   333 0000014B BE[4118]                	mov	si, Msg_NO
   334 0000014E E81E04                  	call	print_msg 
   335                                  
   336                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   337                                  ; Nextline & Exit
   338                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   339                                  
   340                                  R_14:
   341 00000151 BE[3918]                	mov	si, CRLF
   342 00000154 E81804                  	call	print_msg
   343 00000157 B8004C                  	mov	ax, 4C00h		; terminate
   344 0000015A CD21                    	int	21h
   345                                  
   346                                  R_15:
   347 0000015C BE[7B12]                	mov	si, RetroDOS_Welcome
   348 0000015F E80D04                  	call	print_msg
   349 00000162 EBED                    	jmp	short R_14 ; Exit
   350                                  
   351                                  R_16:
   352 00000164 BE[3C18]                	mov	si, Msg_YES
   353 00000167 E80504                  	call	print_msg
   354 0000016A EB08                    	jmp	short R_18
   355                                  
   356                                  R_17:
   357 0000016C BE[4D13]                	mov	si, msg_inv_image_file
   358 0000016F E8FD03                  	call	print_msg
   359 00000172 EBDD                    	jmp	short R_14
   360                                  
   361                                  R_18:
   362                                  	; Delete existing image file
   363 00000174 B441                    	mov	ah, 41h ; Delete file
   364 00000176 BA[2119]                	mov	dx, img_file_name
   365 00000179 CD21                    	int	21h
   366 0000017B 7304                    	jnc	short R_19
   367 0000017D 3C02                    	cmp	al, 2 ; file not found
   368 0000017F 75EB                    	jne	short R_17 ; invalid image file
   369                                  
   370                                  R_19:
   371 00000181 E8A204                  	call	write_chs_table
   372                                  R_20:
   373 00000184 30E4                    	xor	ah, ah
   374 00000186 CD16                    	int	16h
   375                                  
   376 00000188 3C31                    	cmp	al, '1'
   377 0000018A 7208                    	jb	short R_21
   378 0000018C 3C39                    	cmp	al, '9'
   379 0000018E 77F4                    	ja	short R_20
   380 00000190 2C30                    	sub	al, '0'
   381 00000192 EB09                    	jmp	short R_22
   382                                  R_21:
   383 00000194 3C1B                    	cmp	al, 27 ;  ESCape key
   384 00000196 75EC                    	jne	short R_20
   385                                  
   386                                  	; Exit
   387 00000198 B8004C                  	mov	ax, 4C00h
   388 0000019B CD21                    	int	21h
   389                                  
   390                                  R_22:
   391 0000019D A2[2019]                	mov	[DiskType], al
   392                                  
   393                                  	; clear screen
   394 000001A0 B80300                  	mov	ax, 3 ; set video mode to 03h (80x25 text)
   395 000001A3 CD10                    	int	10h
   396                                  
   397 000001A5 8A1E[2019]              	mov	bl, [DiskType]	; 1 to 9
   398 000001A9 FECB                    	dec	bl 		; 0 to 8
   399                                  	;xor	bh, bh
   400 000001AB 89DE                    	mov	si, bx ; 1i
   401 000001AD D1E3                    	shl	bx, 1
   402 000001AF 01F3                    	add	bx, si ; bx = 3i	
   403 000001B1 81C3[F518]              	add	bx, DskTypeNumStr
   404 000001B5 8A07                    	mov	al, [bx]
   405 000001B7 A2[DA18]                	mov	[msg_disk_size],al
   406 000001BA 43                      	inc	bx
   407 000001BB 8B07                    	mov	ax, [bx]
   408 000001BD A3[DB18]                	mov	[msg_disk_size+1], ax
   409 000001C0 D1E6                    	shl	si, 1 ; 2i
   410 000001C2 89F3                    	mov	bx, si
   411 000001C4 C1E602                  	shl	si, 2 ; 8i
   412 000001C7 01DE                    	add	si, bx ; 8i+2i = 10i
   413 000001C9 81C6[3206]              	add	si, DskTypeParms
   414 000001CD AD                      	lodsw
   415 000001CE A3[3E09]                	mov	[pt_cylinders], ax
   416 000001D1 AD                      	lodsw
   417 000001D2 A3[4009]                	mov	[pt_heads], ax
   418 000001D5 AD                      	lodsw
   419 000001D6 A3[4209]                	mov	[pt_sectors], ax
   420 000001D9 AD                      	lodsw
   421 000001DA A3[1C19]                	mov	[diskimage_size], ax	
   422 000001DD AD                      	lodsw
   423 000001DE A3[1E19]                	mov	[diskimage_size+2], ax	
   424                                  	
   425 000001E1 BE[CE18]                	mov	si, msg_creating
   426 000001E4 E88803                  	call	print_msg
   427                                  
   428 000001E7 BE[DA18]                	mov	si, msg_disk_size
   429 000001EA 8A04                    	mov	al, [si]
   430 000001EC 2C31                    	sub	al, '1'
   431 000001EE 83D600                  	adc	si, 0
   432 000001F1 E87B03                  	call	print_msg
   433                                  
   434                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   435                                  ; Create a new hard disk image file
   436                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   437                                  		
   438 000001F4 BA[2119]                	mov	dx, img_file_name
   439 000001F7 B90000                  	mov	cx, 0 ; File Attributes
   440 000001FA B43C                    	mov	ah, 3Ch ; MS-DOS Function = Create File
   441 000001FC CD21                    	int	21h
   442 000001FE 7208                    	jc	short R_23
   443                                  
   444                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   445                                  ; Open image file for writing
   446                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   447                                  
   448 00000200 B002                    	mov	al, 2 ; open for reading and writing
   449                                  	;mov	dx, img_file_name
   450 00000202 B43D                    	mov	ah, 3Dh ; open file
   451 00000204 CD21                    	int	21h
   452 00000206 7314                    	jnc	short R_24
   453                                  
   454                                  R_23:
   455                                  	; AL = error code
   456 00000208 E87303                  	call	bin_to_hex
   457 0000020B A3[5018]                	mov 	[error_code], ax
   458                                  
   459 0000020E BE[3918]                	mov	si, CRLF
   460 00000211 E85B03                  	call	print_msg
   461                                  
   462 00000214 BE[4518]                	mov	si, Msg_Error
   463 00000217 E85503                  	call	print_msg
   464                                  
   465 0000021A CD20                    	int	20h	; Exit
   466                                  
   467                                  R_24:
   468 0000021C A3[980B]                	mov	[img_file_handle], ax
   469                                  R_25:
   470 0000021F BA[2E19]                	mov	dx, HDFORMAT_SECBUFFER  ; 0F6h buffer
   471 00000222 B90002                  	mov	cx, 512
   472 00000225 8B1E[980B]              	mov	bx, [img_file_handle]
   473 00000229 B440                    	mov	ah, 40h ; write to file	
   474 0000022B CD21                    	int	21h
   475 0000022D 7231                    	jc	short R_26
   476                                  
   477 0000022F 66FF06[1819]            	inc	dword [CWSector]
   478                                  R_25a:
   479 00000234 A1[1C19]                	mov	ax, [diskimage_size]
   480 00000237 8B16[1E19]              	mov	dx, [diskimage_size+2]
   481                                  
   482 0000023B B90100                  	mov	cx, 1
   483                                  
   484 0000023E 3B16[1A19]              	cmp	dx, [CWSector+2]
   485 00000242 7706                    	ja	short R_25b
   486                                  	
   487 00000244 3B06[1819]              	cmp	ax, [CWSector]
   488 00000248 761E                    	jna	short R_27
   489                                  	
   490                                  R_25b:
   491 0000024A A1[1819]                	mov	ax, [CWSector]
   492 0000024D 83E003                  	and	ax, 3
   493 00000250 BB[1219]                	mov	bx, RSymbols
   494 00000253 01C3                    	add	bx, ax
   495 00000255 8A07                    	mov	al, [bx]
   496 00000257 BB0700                  	mov	bx, 7
   497                                  	;mov	cx, 1
   498 0000025A B40A                    	mov	ah, 0Ah ; write character (on previous cpos)
   499 0000025C CD10                    	int	10h
   500                                  
   501 0000025E EBBF                    	jmp	short R_25
   502                                  
   503                                  R_26:
   504                                  	; Error.. close file..
   505 00000260 50                      	push	ax
   506 00000261 B43E                    	mov	ah, 3Eh ; close file
   507                                  	;mov	bx, [img_file_handle]
   508 00000263 CD21                    	int	21h
   509 00000265 58                      	pop	ax
   510 00000266 EBA0                    	jmp	short R_23
   511                                  
   512                                  R_27:
   513 00000268 B020                    	mov	al, 20h ; space
   514 0000026A BB0700                  	mov	bx, 7
   515 0000026D B40A                    	mov	ah, 0Ah ; write character (on previous cpos)
   516                                  	;mov	cx, 1
   517 0000026F CD10                    	int	10h
   518                                  	
   519 00000271 BE[3518]                	mov	si, msg_OK
   520 00000274 E8F802                  	call	print_msg
   521                                  
   522                                  	; Wait about 1 second (~16/18.2)
   523                                  	; "before press any key to continue message"
   524 00000277 30E4                    	xor	ah, ah ; 0
   525 00000279 CD1A                    	int	1Ah
   526                                  	; CX:DX = tick count (18.2 ticks per second)
   527 0000027B 83E20F                  	and	dx, 0Fh
   528 0000027E 89D6                    	mov	si, dx
   529 00000280 31DB                    	xor	bx, bx
   530                                  R_28:
   531 00000282 B80000                  	mov	ax,0
   532 00000285 CD1A                    	int	1Ah	
   533 00000287 43                      	inc	bx
   534 00000288 7407                    	jz	short R_29 
   535 0000028A 83E20F                  	and	dx, 0Fh
   536 0000028D 39F2                    	cmp	dx, si
   537 0000028F 75F1                    	jne	short R_28
   538                                  R_29:
   539 00000291 BE[AF18]                	mov	si, msg_press_any_key
   540 00000294 E8D802                  	call	print_msg
   541                                  
   542 00000297 30E4                    	xor	ah, ah
   543 00000299 CD16                    	int	16h
   544                                  
   545                                  R_30:
   546                                  	; clear screen
   547 0000029B B80300                  	mov	ax, 3 ; set video mode to 03h (80x25 text)
   548 0000029E CD10                    	int	10h
   549                                  	
   550 000002A0 BE[2F14]                	mov	si, msg_create_dos_partition_h ; header
   551 000002A3 E8C902                  	call	print_msg
   552 000002A6 BE[2415]                	mov	si, msg_create_dos_partition_m ; menu
   553 000002A9 E8C302                  	call	print_msg
   554                                  R_31:
   555 000002AC 30E4                    	xor	ah, ah
   556 000002AE CD16                    	int	16h
   557 000002B0 3C1B                    	cmp	al, 27 ; ESC key	
   558 000002B2 743B                    	je	short R_32
   559 000002B4 3C30                    	cmp	al, '0'
   560 000002B6 7437                    	je	short R_32
   561 000002B8 72F2                    	jb	short R_31
   562 000002BA 3C39                    	cmp	al, '9'
   563 000002BC 77EE                    	ja	short R_31
   564                                  
   565 000002BE 30ED                    	xor	ch, ch
   566 000002C0 2C30                    	sub	al, '0'
   567 000002C2 88C1                    	mov	cl, al
   568 000002C4 FEC9                    	dec	cl  ; 0 to 8
   569 000002C6 8A1E[2019]              	mov	bl, [DiskType]
   570 000002CA FECB                    	dec	bl  ; 0 to 8
   571 000002CC B009                    	mov	al, 9  ; partition size options = 9
   572 000002CE F6E3                    	mul	bl	
   573 000002D0 BB[3407]                	mov	bx, OptionValidatingTable
   574 000002D3 01C8                    	add	ax, cx
   575 000002D5 01C3                    	add	bx, ax
   576 000002D7 8A07                    	mov	al, [bx]
   577 000002D9 20C0                    	and	al, al
   578 000002DB 7520                    	jnz	short R_34
   579                                  
   580 000002DD BE[9213]                	mov	si, msg_option_not_proper
   581 000002E0 E88C02                  	call	print_msg
   582 000002E3 BE[AF18]                	mov	si, msg_press_any_key
   583 000002E6 E88602                  	call	print_msg
   584 000002E9 30E4                    	xor	ah, ah
   585 000002EB CD16                    	int	16h
   586 000002ED EBAC                    	jmp	short R_30
   587                                  
   588                                  R_32:	
   589 000002EF BE[3918]                	mov	si, CRLF
   590 000002F2 E87A02                  	call	print_msg
   591                                  
   592 000002F5 30C0                    	xor	al, al	; return code = 0
   593 000002F7 B44C                    	mov	ah, 4Ch ; EXIT - terminate with return code
   594 000002F9 CD21                    	int	21h
   595                                  
   596                                  R_33:
   597 000002FB EBFE                    	jmp	short R_33
   598                                  
   599                                  R_34:
   600 000002FD FEC8                    	dec	al ; zero based type of partition selection
   601                                  	;mov	ah, 20
   602 000002FF B40E                    	mov	ah, 14 ; 19/10/2018
   603 00000301 F6E4                    	mul	ah
   604 00000303 BE[8C06]                	mov	si, partition_parms
   605 00000306 01C6                    	add	si, ax
   606 00000308 BB[4409]                	mov	bx, partition_table
   607 0000030B AD                      	lodsw
   608 0000030C A2[9309]                	mov	[bsSecPerClust], al  ; sectors per cluster
   609                                  	;lodsw
   610                                  	;;mov	cx, ax  	     ; number of clusters
   611                                  	;lodsw
   612                                  	;mov	[bsRootDirEnts], ax  ; root directory entries
   613                                  	;mov	word [bsRootDirEnts], 512
   614                                  	;add	ax, 15
   615                                  	;shr	ax, 4
   616                                  	;mov	[bsRootDirSects], ax ; root directory sectors
   617                                  	;mov	byte [bsRootDirSects], 32	
   618 0000030F AD                      	lodsw
   619 00000310 A3[A209]                	mov	[bsHidden1], ax	     ; hidden sectors
   620 00000313 894708                  	mov	[bx+ptStartSector], ax ; start sector
   621                                  	;mov	word [bx+ptStartSector+2], 0
   622                                  
   623                                  	;mov	word [bsHidden2], 0
   624                                  	;lodsw
   625                                  	;;mov	[bsResSectors], ax   ; reserved sectors = 1
   626 00000316 AD                      	lodsw
   627 00000317 A3[9C09]                	mov	[bsFATsecs], ax      ; fat sectors
   628 0000031A AD                      	lodsw
   629 0000031B A3[C809]                	mov	[bsRootDirStart], ax ; root directory address
   630 0000031E AD                      	lodsw
   631 0000031F A3[C609]                	mov	[bsDataStart], ax    ; first data sector address
   632 00000322 AD                      	lodsw
   633 00000323 8B14                    	mov	dx, [si]
   634                                  
   635 00000325 09D2                    	or	dx, dx
   636 00000327 740C                    	jz	short R_34a  ; dx = 0
   637                                  				     ; Big Partition (06h)
   638 00000329 A3[A609]                	mov	[bsHugeSectors], ax 
   639 0000032C 8916[A809]              	mov	[bsHugeSectors+2], dx
   640                                  
   641                                  	;mov	word [bsSectors], 0
   642                                  
   643 00000330 B90600                  	mov	cx, 06h	; FAT 16 BIG (>32MB) partition	
   644 00000333 EB06                     	jmp	short R_34b
   645                                  
   646                                  R_34a:	
   647 00000335 A3[9909]                	mov	[bsSectors], ax      ; partition/volume size in sectors
   648                                  	;mov	[bsHugeSectors], ax 
   649                                  	;;mov	[bsHugeSectors], 0 
   650                                  	;mov	word [bsHugeSectors+2], 0
   651 00000338 B90400                  	mov	cx, 04h ; FAT 16 (<=32MB) partition	
   652                                  R_34b:
   653 0000033B 89470C                  	mov	[bx+ptSectors], ax
   654 0000033E 89570E                  	mov	[bx+ptSectors+2], dx
   655                                  
   656                                  	; DX = High word of partition size
   657                                  	;mov	cx, ax 		     ; volume/partition size in sectors
   658 00000341 91                      	xchg	cx, ax
   659                                  
   660 00000342 C60780                  	mov	byte [bx], 80h       ; Active/Bootable partition
   661 00000345 884704                  	mov	[bx+ptFileSystemID], al ; 04h or 06h
   662 00000348 B001                    	mov	al,1
   663 0000034A 884701                  	mov	[bx+ptBeginHead], al ; beginning head = 1
   664 0000034D 884702                  	mov	[bx+ptBeginSector], al ; beginning sector = 1
   665                                  	;xor	ah, ah	
   666                                  	;mov	[bx+ptBeginCylinder], ah ; beginning cylinder = 0
   667                                  		
   668 00000350 A0[4209]                	mov	al, [pt_sectors]
   669 00000353 A2[9E09]                	mov	[bsSecPerTrk], al
   670                                  	;mov	byte [bsSecPerTrk+1], 0
   671 00000356 884706                  	mov	[bx+ptEndSector], al	
   672 00000359 01C1                    	add	cx, ax		     ; + sectors per track  
   673                                  	;adc	dx, 0    		           
   674                                  
   675 0000035B 8A26[4009]              	mov	ah, [pt_heads]
   676 0000035F 8826[A009]              	mov	[bsHeads], ah
   677                                  	;mov	byte [bsHeads+1], 0
   678 00000363 FECC                    	dec	ah
   679 00000365 886705                  	mov	[bx+ptEndHead], ah
   680 00000368 FEC4                    	inc	ah
   681 0000036A F6E4                    	mul	ah
   682 0000036C 91                      	xchg	cx, ax
   683 0000036D F7F1                    	div	cx
   684 0000036F 48                      	dec	ax  ; the last cylinder of the partition (< 1024) 
   685 00000370 884707                  	mov	[bx+ptEndCylinder], al
   686                                  	
   687                                  	; 19/10/2018
   688 00000373 20E4                    	and	ah, ah
   689 00000375 7406                    	jz	short R_34c ; last cylinder number is less than 256
   690                                  
   691 00000377 C0E406                  	shl	ah, 6 ; shift cylinder (AX) bits 8 & 9 to AH bits 6 & 7
   692 0000037A 086706                  	or	byte [bx+ptEndSector],ah ; .. and put it in EndSector bits 6 & 7
   693                                  
   694                                  R_34c:
   695                                  	; clear screen
   696 0000037D B80300                  	mov	ax, 3 ; set video mode to 03h (80x25 text)
   697 00000380 CD10                    	int	10h	
   698                                  
   699 00000382 BE[7117]                	mov	si, msg_writing_mbr
   700 00000385 E8E701                  	call	print_msg
   701                                  
   702                                  	; Move file pointer to start of the file
   703                                  	;xor	al, al
   704 00000388 8B1E[980B]              	mov	bx, [img_file_handle]
   705 0000038C 29C9                    	sub	cx, cx
   706                                  	;sub	dx, dx
   707 0000038E B442                    	mov	ah, 42h ; seek (move file pointer)
   708 00000390 CD21                    	int	21h
   709                                  
   710                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   711                                  ; writing masterboot sector
   712                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   713                                  
   714                                  	;mov	bx, [img_file_handle]
   715 00000392 BA[8607]                	mov	dx, RETRODOS_MASTERBOOT_SECTOR ; Singlix FS1 MBR
   716 00000395 B90002                  	mov	cx, 512
   717 00000398 B440                    	mov	ah, 40h ; write to file	
   718 0000039A CD21                    	int	21h
   719 0000039C 0F82C0FE                	jc	R_26 ; write error message then exit
   720                                  
   721 000003A0 BE[3518]                	mov	si, msg_OK
   722 000003A3 E8C901                  	call	print_msg
   723                                  
   724 000003A6 BF[B109]                	mov	di, bsVolumeLabel
   725 000003A9 E8EA00                  	call	write_volume_name
   726 000003AC BE[AD09]                	mov	si, bsVolumeID
   727 000003AF E83601                  	call	write_volume_serial
   728                                  
   729 000003B2 BE[A417]                	mov	si, msg_writing_boot_sector
   730 000003B5 E8B701                  	call	print_msg
   731                                  
   732                                  	; Move file pointer to start of the dos partition
   733 000003B8 8B16[4C09]              	mov	dx, [partition_table+ptStartSector]
   734                                  	
   735 000003BC B80002                  	mov	ax, 512
   736 000003BF F7E2                    	mul	dx
   737 000003C1 89D1                    	mov	cx, dx
   738 000003C3 89C2                    	mov	dx, ax
   739                                  
   740 000003C5 28C0                    	sub	al, al
   741 000003C7 8B1E[980B]              	mov	bx, [img_file_handle]
   742 000003CB B442                    	mov	ah, 42h ; seek (move file pointer)
   743 000003CD CD21                    	int	21h
   744                                  	;jc	R_26
   745                                  
   746                                  	;mov	bx, [img_file_handle]
   747 000003CF BA[8609]                	mov	dx, RETRODOS_FAT16_hd_bs
   748 000003D2 B90002                  	mov	cx, 512
   749 000003D5 B440                    	mov	ah, 40h ; write to file	
   750 000003D7 CD21                    	int	21h
   751 000003D9 0F8283FE                	jc	R_26 ; write error message then exit
   752                                  
   753 000003DD BE[3518]                	mov	si, msg_OK
   754 000003E0 E88C01                  	call	print_msg
   755                                  
   756                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   757                                  ; writing FAT sectors
   758                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   759                                  
   760                                  	;mov	si, CRLF
   761                                  	;call	print_msg
   762                                  
   763                                  	; Clear sector buffer (clear 0F6h bytes)
   764 000003E3 BF[2E19]                	mov	di, HDFORMAT_FATBUFFER
   765 000003E6 31C0                    	xor	ax, ax
   766 000003E8 B90001                  	mov	cx, 256
   767 000003EB F3AB                    	rep	stosw 
   768                                  
   769 000003ED BE[C217]                	mov	si, msg_writing_FAT_sectors
   770 000003F0 E87C01                  	call	print_msg
   771                                  
   772 000003F3 8B2E[9C09]              	mov	bp, [bsFATsecs]
   773 000003F7 4D                      	dec	bp
   774 000003F8 89EF                    	mov	di, bp
   775                                  
   776 000003FA B8F8FF                  	mov	ax, 0FFF8h
   777 000003FD BE[2E19]                	mov	si, HDFORMAT_FATBUFFER
   778 00000400 8904                    	mov	[SI], ax
   779 00000402 88E0                    	mov	al, ah
   780 00000404 894402                  	mov	[SI+2], ax ; FFFFh
   781                                  
   782 00000407 FEC0                    	inc	al ; 0	
   783                                  	;sub	al, al
   784 00000409 8B1E[980B]              	mov	bx, [img_file_handle]
   785 0000040D 89F2                    	mov	dx, si ; [HDFORMAT_FATBUFFER]
   786 0000040F B90002                  	mov	cx, 512
   787 00000412 B440                    	mov	ah, 40h ; write to file	
   788 00000414 CD21                    	int	21h
   789 00000416 0F8246FE                	jc	R_26 ; write error message then exit
   790                                  	;mov	bx, [img_file_handle]
   791 0000041A BA[2E19]                	mov	dx, HDFORMAT_ZERO_BUFF
   792                                  	;mov	cx, 512
   793 0000041D 31C0                    	xor	ax, ax
   794 0000041F 8904                    	mov	[SI], ax
   795 00000421 894402                  	mov	[SI+2], ax
   796                                  R_35:
   797                                  	;mov	dx, HDFORMAT_ZERO_BUFF
   798                                  	;mov	cx, 512
   799 00000424 B440                    	mov	ah, 40h ; write to file	
   800 00000426 CD21                    	int	21h
   801 00000428 0F8234FE                	jc	R_26 ; write error message then exit
   802                                  
   803 0000042C 28C0                    	sub	al, al
   804                                  
   805 0000042E 4D                      	dec	bp
   806 0000042F 75F3                    	jnz	short R_35
   807                                  
   808 00000431 B8F8FF                  	mov	ax, 0FFF8h
   809                                  	;mov	si, HDFORMAT_FATBUFFER
   810 00000434 8904                    	mov	[SI], ax
   811 00000436 88E0                    	mov	al,ah
   812 00000438 894402                  	mov	[SI+2], ax ; 0FFFFh
   813                                  
   814                                  	;inc	al
   815 0000043B 28C0                    	sub	al, al
   816                                  	;mov	bx, [img_file_handle]
   817 0000043D 89F2                    	mov	dx, si; [HDFORMAT_FATBUFFER]
   818                                  	;mov	cx, 512
   819 0000043F B440                    	mov	ah, 40h ; write to file	
   820 00000441 CD21                    	int	21h
   821 00000443 0F8219FE                	jc	R_26 ; write error message then exit
   822                                  	;mov	bx, [img_file_handle]
   823 00000447 BA[2E19]                	mov	dx, HDFORMAT_ZERO_BUFF
   824                                  	;mov	cx, 512
   825 0000044A 29C0                    	sub	ax, ax
   826 0000044C 8904                    	mov	[SI], ax
   827 0000044E 894402                  	mov	[SI+2], ax
   828                                  R_36:
   829                                  	;mov	dx, HDFORMAT_ZERO_BUFF
   830                                  	;mov	cx, 512
   831 00000451 B440                    	mov	ah, 40h ; write to file	
   832 00000453 CD21                    	int	21h
   833 00000455 0F8207FE                	jc	R_26 ; write error message then exit
   834                                  
   835 00000459 28C0                    	sub	al, al
   836                                  	
   837 0000045B 4F                      	dec	di
   838 0000045C 75F3                    	jnz	short R_36
   839                                  
   840 0000045E BE[3518]                	mov	si, msg_OK
   841 00000461 E80B01                  	call	print_msg
   842                                  
   843                                  	;mov	si, CRLF
   844                                  	;call	print_msg
   845                                  
   846 00000464 BE[D917]                	mov	si, msg_writing_root_dir
   847 00000467 E80501                  	call	print_msg
   848                                  
   849 0000046A 8B3E[9709]              	mov	di, [bsRootDirEnts]
   850 0000046E C1EF04                  	shr	di, 4 ; 240/16 = 15, 512/16 =  32 sectors
   851 00000471 8B1E[980B]              	mov	bx, [img_file_handle]
   852 00000475 BA[2E19]                	mov	dx, HDFORMAT_ZERO_BUFF
   853                                  	;mov	cx, 512
   854                                  R_37:
   855 00000478 28C0                    	sub	al, al
   856                                  	;mov	bx, [img_file_handle]
   857                                  	;mov	dx, HDFORMAT_ZERO_BUFF
   858                                  	;mov	cx, 512
   859 0000047A B440                    	mov	ah, 40h ; write to file	
   860 0000047C CD21                    	int	21h
   861 0000047E 0F82DEFD                	jc	R_26 ; write error message then exit
   862                                  	
   863 00000482 4F                      	dec	di
   864 00000483 75F3                    	jnz	short R_37
   865                                  
   866 00000485 BE[3518]                	mov	si, msg_OK
   867 00000488 E8E400                  	call	print_msg
   868                                  
   869 0000048B B43E                    	mov	ah, 3Eh ; close file
   870 0000048D 8B1E[980B]              	mov	bx, [img_file_handle]
   871 00000491 CD21                    	int	21h
   872                                  
   873 00000493 E959FE                  	jmp	R_32
   874                                  
   875                                  
   876                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   877                                  ; set & write volume name
   878                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   879                                  
   880                                  write_volume_name:
   881                                  	;mov	byte [vname_length], 11
   882                                  svn_fs:
   883                                  	; DI = (BS) Volume Label address
   884 00000496 BE[0718]                	mov	si, Msg_Volume_Name
   885 00000499 E8D300                  	call	print_msg
   886                                  
   887                                  	; get cursor position
   888                                  	; bh = 0  ; video page
   889 0000049C B403                    	mov     ah, 3 ; get cursor pos
   890 0000049E CD10                    	int     10h
   891 000004A0 8916[1619]              	mov	[Cursor_Pos], dx
   892                                  
   893 000004A4 E8EE00                  	call	rw_char
   894                                  	;jc	short svn_1
   895 000004A7 7216                    	jc	short svn_5
   896                                  svn_0:
   897 000004A9 AC                      	lodsb
   898 000004AA 3C20                    	cmp	al, 20h
   899 000004AC 74FB                    	je	short svn_0 
   900                                  	;mov	di, [bp+47h) ; [BS_VolLab] ; FAT32
   901                                  	;mov	di, [bp+2Bh) ; [BS_VolLab] ; FAT16 (&FAT12)
   902 000004AE 89FB                    	mov	bx, di ; *	
   903                                  	;ja	short svn_2
   904 000004B0 720D                    	jb	short svn_5
   905                                  ;svn_1:
   906                                  ;	mov	si, no_name
   907                                  ;	lodsb50
   908                                  svn_2:
   909 000004B2 B90B00                  	mov	cx, 11; [vname_length]
   910 000004B5 EB05                    	jmp	short svn_4
   911                                  svn_3:
   912 000004B7 AC                      	lodsb
   913 000004B8 3C20                    	cmp	al, 20h
   914 000004BA 7225                    	jb	short svn_6
   915                                  svn_4:
   916 000004BC AA                      	stosb
   917 000004BD E2F8                    	loop	svn_3
   918                                  svn_5:
   919 000004BF B90B00                  	mov	cx, 11 ; [vname_length]
   920 000004C2 89DE                    	mov	si, bx ; *
   921 000004C4 BF[FB17]                	mov	di, StrVolumeName
   922 000004C7 F3A4                    	rep	movsb
   923                                  	;mov	byte [di], 0
   924                                  
   925 000004C9 8B16[1619]              	mov	dx, [Cursor_Pos]
   926 000004CD BB0700                  	mov	bx, 7
   927 000004D0 B402                    	mov	ah, 2
   928 000004D2 CD10                    	int	10h  ; Set Cursor Position
   929                                  
   930 000004D4 BE[FB17]                	mov	si, StrVolumeName
   931 000004D7 E89500                  	call	print_msg
   932 000004DA BE[3918]                	mov	si, CRLF
   933 000004DD E88F00                  	call	print_msg
   934 000004E0 C3                      	retn
   935                                  svn_6:
   936 000004E1 B020                    	mov	al, 20h
   937                                  svn_7:
   938 000004E3 AA                      	stosb
   939 000004E4 E2FD                    	loop	svn_7
   940 000004E6 EBD7                    	jmp	short svn_5
   941                                  
   942                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   943                                  ; set & write volume serial number (volume ID)
   944                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
   945                                  
   946                                  write_volume_serial:
   947                                  	; SI = (BS) Volume Serial Number (binary) address
   948                                  
   949                                  	;xor	ax, ax
   950                                  	;int	1Ah			; get time of day
   951                                  
   952                                  	;mov	[si], dx
   953                                  	;mov	[si+2], cx		; set unique volume ID
   954                                  
   955                                  	;mov	ah, 02h			; Return Current Time
   956                                  	;int	1Ah
   957                                  	;xchg	ch, cl
   958                                  	;xchg	dh, dl
   959                                  
   960                                  	;add	cx, dx  
   961                                  	;add	[si+2], cx
   962                                                 
   963                                  	;mov	ah, 04h			; Return Current Date
   964                                  	;int	1Ah
   965                                  
   966                                  	;xchg	ch,cl
   967                                  	;xchg	dh,dl
   968                                  
   969                                  	;add	cx, dx  
   970                                  	;add	[si+2], cx
   971                                  
   972                                  	; According to Microsoft DOS 6.0 serial number
   973                                  	; production method...
   974                                  	; < Create unique 32 bit serial number >
   975                                  
   976                                  	; Create_Serial_ID (MSDOS 6.0 Source code, MSFOR.ASM)
   977                                  	; (20/04/1987)
   978                                  	;
   979                                  	;  Get date (INT 21h, AH=2Bh)
   980                                  	;  Get time (INT 21h, AH=2Ch)
   981                                  	;  Serial_ID+0 = DX reg date + DX reg time
   982                                  	;  Serial_ID+2 = CX reg date + CX reg time
   983                                  	;  Serial_Num_Low = Serial_ID+2
   984                                  	;  Serial_Num_High = Serial_ID+0
   985                                  
   986 000004E8 B404                    	mov	ah, 04h		; Return Current Date
   987 000004EA CD1A                    	int	1Ah
   988                                  
   989                                  	; DL = Day (BCD)	(20h) 	
   990                                  	; DH = Month (BCD)	(12h)
   991                                  	; CH = Century (BCD)	(20h)
   992                                  	; CL = Year (BCD) 	(17h)
   993                                  
   994 000004EC 88D0                    	mov	al, dl
   995 000004EE E87100                  	call	bcd_to_bin
   996 000004F1 88C2                    	mov	dl, al 
   997 000004F3 88F0                    	mov	al, dh
   998 000004F5 E86A00                  	call	bcd_to_bin
   999 000004F8 88C6                    	mov	dh, al 
  1000 000004FA 88C8                    	mov	al, cl
  1001 000004FC E86300                  	call	bcd_to_bin
  1002 000004FF 88C1                    	mov	cl, al 
  1003 00000501 88E8                    	mov	al, ch
  1004 00000503 E85C00                  	call	bcd_to_bin
  1005 00000506 88C5                    	mov	ch, al
  1006                                  
  1007                                  	; DH = Month (1-10)
  1008                                  	; DL = Day (1-31)
  1009                                  	; CX = Year (1900-2099)
  1010                                  
  1011 00000508 52                      	push	dx 
  1012 00000509 51                      	push	cx
  1013                                  
  1014 0000050A B402                    	mov	ah, 02h		; Return Current Time
  1015 0000050C CD1A                    	int	1Ah
  1016                                  	
  1017                                  	; DH = Seconds (BCD)	(59h) 	
  1018                                  	; CL = Minutes (BCD)	(59h)
  1019                                  	; CH = Hours (BCD)	(23h)
  1020                                  	; DL = Daylight savings time option (1=yes)
  1021                                  
  1022 0000050E 88F0                    	mov	al, dh
  1023 00000510 E84F00                  	call	bcd_to_bin
  1024 00000513 88C6                    	mov	dh, al 
  1025 00000515 88C8                    	mov	al, cl
  1026 00000517 E84800                  	call	bcd_to_bin
  1027 0000051A 88C1                    	mov	cl, al 
  1028 0000051C 88E8                    	mov	al, ch
  1029 0000051E E84100                  	call	bcd_to_bin
  1030 00000521 88C5                    	mov	ch, al 
  1031                                  
  1032                                  	; CH = Hour (0-23)
  1033                                  	; CL = Minutes (0-59)
  1034                                  	; DH = Seconds (0-59)
  1035                                  	; ((DL = Hundredths (0-99) - MSDOS!))
  1036                                  	; DL = 0 or 1 (here!)
  1037                                  
  1038 00000523 89C8                    	mov	ax, cx
  1039 00000525 59                      	pop	cx
  1040 00000526 01C8                    	add	ax, cx
  1041                                  
  1042 00000528 894402                  	mov	[si+2], ax
  1043                                  
  1044 0000052B 89D0                    	mov	ax, dx
  1045 0000052D 5A                      	pop	dx
  1046 0000052E 01D0                    	add	ax, dx
  1047                                  
  1048 00000530 8904                    	mov	[si], ax
  1049                                  
  1050 00000532 30E4                    	xor	ah, ah		; Read time counter
  1051 00000534 CD1A                    	int	1Ah
  1052                                  
  1053                                  	; CX = High word of clock count
  1054                                  	; DX = Low word of clock count
  1055                                  	; AL = 0 if 24 hours has not passed, else 1
  1056                                  
  1057                                  	; NOTES: 
  1058                                  	; (Ref: vitaly_filatov.tripod.com/ng/asm/asm_029.1.html)
  1059                                  	;
  1060                                     	; Following formulas convert the clock count to
  1061                                          ; the time of day:
  1062                                   	;	Hour      = Clock / 65543 (1007h)
  1063                                  	;	Remainder = Clock MOD 65543
  1064                                   	;
  1065                                  	;	Minutes   = Remainder / 1092 (444h)
  1066                                  	;	Remainder = Remainder MOD 1092
  1067                                  	;
  1068                                  	;	Second    = Remainder / 18.21
  1069                                  	;	Remainder = Remainder MOD 18.21
  1070                                  	;
  1071                                  	;	Hundredths = CINT(Remainder * 100)
  1072                                  
  1073 00000536 0014                    	add	[si], dl
  1074                                  
  1075                                  	; SI = Volume serial number address (4 bytes) 
  1076 00000538 8A04                    	mov	al, [si]
  1077 0000053A E84100                  	call	bin_to_hex
  1078 0000053D A3[3018]                	mov	[Vol_Serial2+2], ax	
  1079 00000540 8A4401                  	mov	al, [si+1]
  1080 00000543 E83800                  	call	bin_to_hex
  1081 00000546 A3[2E18]                	mov	[Vol_Serial2], ax
  1082 00000549 8A4402                  	mov	al, [si+2]
  1083 0000054C E82F00                  	call	bin_to_hex
  1084 0000054F A3[2B18]                	mov	[Vol_Serial1+2], ax	
  1085 00000552 8A4403                  	mov	al, [si+3]
  1086 00000555 E82600                  	call	bin_to_hex
  1087 00000558 A3[2918]                	mov	[Vol_Serial1], ax
  1088                                  
  1089 0000055B BE[1718]                	mov	si, Msg_Volume_Serial
  1090 0000055E E80E00                  	call	print_msg
  1091                                  
  1092 00000561 C3                      	retn
  1093                                  
  1094                                  bcd_to_bin:
  1095 00000562 53                      	push	bx
  1096 00000563 D410                    	db	0D4h,10h  ; Undocumented inst. AAM
  1097                                  			  ; AH = AL / 10h
  1098                                  			  ; AL = AL MOD 10h
  1099 00000565 88C3                    	mov	bl, al
  1100 00000567 B00A                    	mov	al, 10
  1101 00000569 F6E4                    	mul	ah
  1102 0000056B 00D8                    	add	al, bl
  1103 0000056D 5B                      	pop	bx
  1104 0000056E C3                      	retn
  1105                                  
  1106                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  1107                                  ; Print messages
  1108                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  1109                                  
  1110                                  print_msg:
  1111                                  
  1112                                  print_msg_LOOP:
  1113 0000056F AC                      	lodsb                           ; Load byte at DS:SI to AL
  1114 00000570 20C0                    	and     al, al            
  1115 00000572 7409                    	jz      short print_msg_OK       
  1116 00000574 B40E                    	mov	ah, 0Eh			
  1117 00000576 BB0700                  	mov     bx, 07h             
  1118 00000579 CD10                    	int	10h			; BIOS Service func ( ah ) = 0Eh
  1119                                  					; Write char as TTY
  1120                                  					; AL-char BH-page BL-color
  1121 0000057B EBF2                    	jmp     short print_msg_LOOP           
  1122                                  
  1123                                  print_msg_OK:
  1124 0000057D C3                      	retn
  1125                                  
  1126                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  1127                                  ; Convert byte to hexadecimal number
  1128                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  1129                                  
  1130                                  bin_to_hex:
  1131                                  	; INPUT ->
  1132                                  	; 	AL = byte (binary number)
  1133                                  	; OUTPUT ->
  1134                                  	;	AX = hexadecimal string
  1135                                  	;
  1136 0000057E 53                      	push	bx
  1137 0000057F 31DB                    	xor	bx, bx
  1138 00000581 88C3                    	mov	bl, al
  1139 00000583 C0EB04                  	shr	bl, 4
  1140 00000586 8A9F[870B]              	mov	bl, [bx+hexchrs] 	 	
  1141 0000058A 86D8                    	xchg	bl, al
  1142 0000058C 80E30F                  	and	bl, 0Fh
  1143 0000058F 8AA7[870B]              	mov	ah, [bx+hexchrs] 
  1144 00000593 5B                      	pop	bx	
  1145 00000594 C3                      	retn
  1146                                  
  1147                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  1148                                  ; Read & Write characters
  1149                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  1150                                  
  1151                                  rw_char:
  1152                                  	; OUTPUT -> DS:SI = Entered String (ASCIIZ)
  1153 00000595 BE[FB17]                	mov     si, StrVolumeName
  1154 00000598 BB0700                  	mov     bx, 7
  1155 0000059B B403                    	mov     ah, 3
  1156 0000059D CD10                    	int     10h
  1157 0000059F 8916[1619]              	mov     [Cursor_Pos], dx
  1158                                  read_next_char:
  1159 000005A3 30E4                    	xor     ah, ah
  1160 000005A5 CD16                    	int     16h
  1161 000005A7 20C0                    	and     al, al
  1162 000005A9 7439                    	jz      short loc_arrow    
  1163 000005AB 3CE0                    	cmp     al, 0E0h          
  1164 000005AD 7435                    	je      short loc_arrow
  1165 000005AF 3C08                    	cmp     al, 8
  1166 000005B1 753D                    	jne     short char_return
  1167                                  loc_back:
  1168 000005B3 B403                    	mov     ah, 3
  1169 000005B5 CD10                    	int     10h
  1170 000005B7 3A16[1619]              	cmp     dl, byte [Cursor_Pos]
  1171 000005BB 761F                    	jna     short loc_beep
  1172                                  prev_column:
  1173 000005BD FECA                    	dec     dl
  1174                                  set_cursor_pos:
  1175 000005BF B402                    	mov     ah, 2
  1176 000005C1 CD10                    	int     10h
  1177 000005C3 88D3                    	mov     bl, dl
  1178 000005C5 2A1E[1619]              	sub     bl, byte [Cursor_Pos] 
  1179 000005C9 B90100                  	mov     cx, 1
  1180 000005CC B409                    	mov     ah, 9
  1181 000005CE B020                    	mov     al, 20h
  1182 000005D0 8800                    	mov     [si+bx], al
  1183                                  loc_write_it:
  1184 000005D2 B307                    	mov     bl, 7
  1185 000005D4 CD10                    	int     10h
  1186 000005D6 8B16[1619]              	mov     dx, [Cursor_Pos]
  1187 000005DA EBC7                    	jmp     short read_next_char
  1188                                  loc_beep:
  1189 000005DC B40E                    	mov     ah, 0Eh
  1190 000005DE B007                    	mov     al, 7
  1191 000005E0 CD10                    	int     10h
  1192 000005E2 EBBF                    	jmp     short read_next_char
  1193                                  loc_arrow:    
  1194 000005E4 80FC4B                  	cmp     ah, 4Bh
  1195 000005E7 74CA                    	je      short loc_back
  1196 000005E9 80FC53                  	cmp     ah, 53h
  1197 000005EC 74C5                    	je      short loc_back
  1198 000005EE EBB3                    	jmp     short read_next_char
  1199                                  char_return:
  1200 000005F0 B403                    	mov     ah, 3
  1201 000005F2 CD10                    	int     10h
  1202                                  check_char_type:
  1203 000005F4 3C20                    	cmp     al, 20h
  1204 000005F6 7228                    	jb      short loc_escape
  1205 000005F8 88D4                    	mov     ah, dl
  1206 000005FA 2A26[1619]              	sub     ah, byte [Cursor_Pos]
  1207                                  	;cmp	ah, 10 
  1208                                  	;ja	short loc_beep
  1209 000005FE 80FC0B                  	cmp     ah, 11 ; [vname_length]
  1210 00000601 73D9                    	jnb	short loc_beep
  1211 00000603 3C7A                    	cmp     al, 'z'
  1212 00000605 779C                    	ja      short read_next_char
  1213 00000607 3C61                    	cmp     al, 'a'
  1214 00000609 7202                    	jb      short pass_capitalize
  1215 0000060B 24DF                    	and     al, 0DFh
  1216                                  pass_capitalize:
  1217 0000060D 88E3                    	mov     bl, ah 
  1218 0000060F 30E4                    	xor     ah, ah
  1219 00000611 8900                    	mov     [si+bx], ax
  1220 00000613 B307                    	mov     bl, 7
  1221 00000615 B40E                    	mov     ah, 0Eh
  1222 00000617 CD10                    	int     10h
  1223 00000619 EB88                    	jmp     short read_next_char
  1224                                  pass_escape:
  1225 0000061B 3C0D                    	cmp     al, 0Dh	; 13 ; ENTER
  1226 0000061D 7584                    	jne     short read_next_char
  1227                                  	;mov	ah, 0Eh
  1228                                  	;int	10h
  1229                                  	;mov	al, 0Ah
  1230                                  	;int	10h
  1231 0000061F C3                      	retn
  1232                                  loc_escape:
  1233 00000620 3C1B                    	cmp     al, 1Bh	; 27 ; ESC
  1234 00000622 75F7                    	jne     short pass_escape
  1235 00000624 F9                      	stc
  1236 00000625 C3                      	retn
  1237                                  
  1238                                  write_chs_table:
  1239                                  	; clear screen
  1240 00000626 B80300                  	mov	ax, 3 ; set video mode to 03h (80x25 text)
  1241 00000629 CD10                    	int	10h
  1242                                  
  1243 0000062B BE[9A0B]                	mov	si, Dsk_Type_Select_msg
  1244 0000062E E83EFF                  	call	print_msg
  1245                                  
  1246 00000631 C3                      	retn
  1247                                  
  1248                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  1249                                  ;  Data
  1250                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  1251                                  
  1252                                  DskTypeParms:
  1253                                  DskType1Parms:
  1254 00000632 3201                    cyl1:	dw 306
  1255 00000634 0800                    hed1:	dw 8
  1256 00000636 1100                    spt1:	dw 17
  1257 00000638 90A20000                cap1:	dd 306*8*17
  1258                                  DskType2Parms:
  1259 0000063C CE01                    cyl2:	dw 462
  1260 0000063E 0800                    hed2:	dw 8
  1261 00000640 1100                    spt2:	dw 17
  1262 00000642 70F50000                cap2:	dd 462*8*17
  1263                                  DskType3Parms:
  1264 00000646 2000                    cyl3:	dw 32
  1265 00000648 1000                    hed3:	dw 16
  1266 0000064A 3F00                    spt3:	dw 63
  1267 0000064C 007E0000                cap3:	dd 32*16*63
  1268                                  DskType4Parms:
  1269 00000650 2800                    cyl4:	dw 40
  1270 00000652 1000                    hed4:	dw 16
  1271 00000654 3F00                    spt4:	dw 63
  1272 00000656 809D0000                cap4:	dd 40*16*63
  1273                                  DskType5Parms:
  1274 0000065A 4000                    cyl5:	dw 64
  1275 0000065C 1000                    hed5:	dw 16
  1276 0000065E 3F00                    spt5:	dw 63
  1277 00000660 00FC0000                cap5:	dd 64*16*63
  1278                                  DskType6Parms:
  1279 00000664 8000                    cyl6:	dw 128
  1280 00000666 1000                    hed6:	dw 16
  1281 00000668 3F00                    spt6:	dw 63
  1282 0000066A 00F80100                cap6:	dd 128*16*63
  1283                                  DskType7Parms:
  1284 0000066E 0001                    cyl7:	dw 256
  1285 00000670 1000                    hed7:	dw 16
  1286 00000672 3F00                    spt7:	dw 63
  1287 00000674 00F00300                cap7:	dd 256*16*63
  1288                                  DskType8Parms:
  1289 00000678 0002                    cyl8:	dw 512
  1290 0000067A 1000                    hed8:	dw 16
  1291 0000067C 3F00                    spt8:	dw 63
  1292 0000067E 00E00700                cap8:	dd 512*16*63
  1293                                  DskType9Parms:
  1294 00000682 0004                    cyl9:	dw 1024
  1295 00000684 1000                    hed9:	dw 16
  1296 00000686 3F00                    spt9:	dw 63
  1297 00000688 00C00F00                cap9:	dd 1024*16*63
  1298                                  
  1299                                  partition_parms:
  1300                                  
  1301                                  ; FAT16 File System (04h) ; <= 32MB
  1302                                  
  1303                                  Partition_10MB_17: ; 1
  1304 0000068C 0200                    secpc1a: dw 2
  1305                                  ;clsts1a: dw 10338
  1306                                  ;roote1a: dw 512
  1307 0000068E 1100                    hidds1a: dw 17
  1308                                  ;ressc1a: dw 1
  1309 00000690 2900                    fatsc1a: dw 41
  1310 00000692 5300                    rootd1a: dw 83
  1311 00000694 7300                    fdats1a: dw 115
  1312 00000696 37510000                parts1a: dd (153*8*17)-17 ; 20791 (0 sector free)
  1313                                  
  1314                                  Partition_10MB_63: ; 2
  1315 0000069A 0200                    secpc1b: dw 2
  1316                                  ;clsts1b: dw 9992
  1317                                  ;roote1b: dw 512
  1318 0000069C 3F00                    hidds1b: dw 63
  1319                                  ;ressc1b: dw 1
  1320 0000069E 2800                    fatsc1b: dw 40
  1321 000006A0 5100                    rootd1b: dw 81
  1322 000006A2 7100                    fdats1b: dw 113
  1323 000006A4 814E0000                parts1b: dd (20*16*63)-63 ; 20097 (0 sector free)
  1324                                  
  1325                                  Partition_16MB_17: ; 3
  1326 000006A8 0200                    secpc2a: dw 2
  1327                                  ;clsts2a: dw 16231
  1328                                  ;roote2a: dw 512
  1329 000006AA 1100                    hidds2a: dw 17
  1330                                  ;ressc2a: dw 1
  1331 000006AC 4000                    fatsc2a: dw 64
  1332 000006AE 8100                    rootd2a: dw 129
  1333 000006B0 A100                    fdats2a: dw 161
  1334 000006B2 6F7F0000                parts2a: dd (240*8*17)-17 ; 32623 (0 sector0s free)
  1335                                  
  1336                                  Partition_16MB_63: ; 4
  1337 000006B6 0200                    secpc2b: dw 2
  1338                                  ;clsts2b: dw 16017
  1339                                  ;roote2b: dw 512
  1340 000006B8 3F00                    hidds2b: dw 63
  1341                                  ;ressc2b: dw 1
  1342 000006BA 3F00                    fatsc2b: dw 63
  1343 000006BC 7F00                    rootd2b: dw 127
  1344 000006BE 9F00                    fdats2b: dw 159
  1345 000006C0 C17D0000                parts2b: dd (32*16*63)-63 ; 32193 (0 sector free)					
  1346                                  
  1347                                  Partition_20MB_17: ; 5
  1348 000006C4 0400                    secpc3a: dw 4
  1349                                  ;clsts3a: dw 10371
  1350                                  ;roote3a: dw 512
  1351 000006C6 1100                    hidds3a: dw 17
  1352                                  ;ressc3a: dw 1
  1353 000006C8 2900                    fatsc3a: dw 41
  1354 000006CA 5300                    rootd3a: dw 83
  1355 000006CC 7300                    fdats3a: dw 115
  1356 000006CE 7FA20000                parts3a: dd (306*8*17)-17 ; 41599 (0 sector  free)
  1357                                  
  1358                                  Partition_20MB_63: ; 6	
  1359 000006D2 0400                    secpc3b: dw 4
  1360                                  ;clsts3b: dw 10036
  1361                                  ;roote3b: dw 512
  1362 000006D4 3F00                    hidds3b: dw 63
  1363                                  ;ressc3b: dw 1
  1364 000006D6 2800                    fatsc3b: dw 40
  1365 000006D8 5100                    rootd3b: dw 81
  1366 000006DA 7100                    fdats3b: dw 113
  1367 000006DC 419D0000                parts3b: dd (40*16*63)-63 ; 40257 (0 sector free)
  1368                                  
  1369                                  Partition_31MB:    ; 7
  1370 000006E0 0400                    secpc4a: dw 4
  1371                                  ;clsts4a: dw 15664
  1372                                  ;roote4a: dw 512
  1373 000006E2 1100                    hidds4a: dw 17
  1374                                  ;ressc4a: dw 1
  1375 000006E4 3E00                    fatsc4a: dw 62
  1376 000006E6 7D00                    rootd4a: dw 125
  1377 000006E8 9D00                    fdats4a: dw 157
  1378 000006EA 5FF50000                parts4a: dd (462*8*17)-17 ; 62815 (2 sectors free)
  1379                                  
  1380                                  Partition_32MB:	   ; 8
  1381 000006EE 0400                    secpc4b: dw 4
  1382                                  ;clsts4b: dw 16072
  1383                                  ;roote4b: dw 512
  1384 000006F0 3F00                    hidds4b: dw 63
  1385                                  ;ressc4b: dw 1
  1386 000006F2 3F00                    fatsc4b: dw 63
  1387 000006F4 7F00                    rootd4b: dw 127
  1388 000006F6 9F00                    fdats4b: dw 159
  1389 000006F8 C1FB0000                parts4b: dd (64*16*63)-63 ; 64449 (2 sectors free)
  1390                                  
  1391                                  ; FAT16 Big File System (06h) ; > 32MB
  1392                                  
  1393                                  Partition_64MB:	   ; 9
  1394 000006FC 0400                    secpc5: dw 4
  1395                                  ;clsts5: dw 32169
  1396                                  ;roote5: dw 512
  1397 000006FE 3F00                    hidds5: dw 63
  1398                                  ;ressc5: dw 1
  1399 00000700 7E00                    fatsc5: dw 126
  1400 00000702 FD00                    rootd5: dw 253
  1401 00000704 1D01                    fdats5: dw 285
  1402 00000706 C1F70100                parts5: dd (128*16*63)-63 ; 128961 (0 sector free)
  1403                                  
  1404                                  Partition_128MB:   ; 10
  1405 0000070A 0400                    secpc6: dw 4
  1406                                  ;clsts6: dw 64362
  1407                                  ;roote6: dw 512
  1408 0000070C 3F00                    hidds6: dw 63
  1409                                  ;ressc6: dw 1
  1410 0000070E FC00                    fatsc6: dw 252
  1411 00000710 F901                    rootd6: dw 505
  1412 00000712 1902                    fdats6: dw 537
  1413 00000714 C1EF0300                parts6: dd (256*16*63)-63 ; 257985 (0 sector free)
  1414                                  
  1415                                  Partition_256MB:   ; 11
  1416 00000718 0800                    secpc7: dw 8
  1417                                  ;clsts7: dw 64437
  1418                                  ;roote7: dw 512
  1419 0000071A 3F00                    hidds7: dw 63
  1420                                  ;ressc7: dw 1
  1421 0000071C FC00                    fatsc7: dw 252
  1422 0000071E F901                    rootd7: dw 505
  1423 00000720 1902                    fdats7: dw 537
  1424 00000722 C1DF0700                parts7: dd (512*16*63)-63 ; 516033 (0 sector free)
  1425                                  
  1426                                  Partition_512MB:   ; 12
  1427 00000726 1000                    secpc8: dw 16
  1428                                  ;clsts8: dw 64474
  1429                                  ;roote8: dw 512
  1430 00000728 3F00                    hidds8: dw 63
  1431                                  ;ressc8: dw 1
  1432 0000072A FC00                    fatsc8: dw 252
  1433 0000072C F901                    rootd8: dw 505
  1434 0000072E 1902                    fdats8: dw 537
  1435 00000730 C1BF0F00                parts8: dd (1024*16*63)-63 ; 1032129 (8 sectors free)
  1436                                  
  1437                                  OptionValidatingTable:
  1438                                  ; 	Option 10M,16M,20M,32M,64M,128M,256M,512M,WHOLE DISK	
  1439 00000734 010305000000000005      	db	1,  3,  5,  0,  0,  0,   0,   0,    5	 ;  20MB, 17SPT
  1440 0000073D 010305070000000007      	db	1,  3,  5,  7,  0,  0,   0,   0,    7	 ;  31MB, 17SPT	 	
  1441 00000746 020400000000000004      	db	2,  4,  0,  0,  0,  0,   0,   0,    4	 ;  16MB, 63SPT
  1442 0000074F 020406000000000006      	db	2,  4,  6,  0,  0,  0,   0,   0,    6	 ;  20MB, 63SPT
  1443 00000758 020406080000000008      	db	2,  4,  6,  8,  0,  0,   0,   0,    8	 ;  32MB, 63SPT
  1444 00000761 020406080900000009      	db	2,  4,  6,  8,  9,  0,   0,   0,    9	 ;  64MB, 63SPT
  1445 0000076A 02040608090A00000A      	db	2,  4,  6,  8,  9, 10,   0,   0,    10	 ; 128MB, 63SPT
  1446 00000773 02040608090A0B000B      	db	2,  4,  6,  8,  9, 10,  11,   0,    11	 ; 256MB, 63SPT
  1447 0000077C 02040608090A0B0C0C      	db	2,  4,  6,  8,  9, 10,  11,  12,    12	 ; 512MB, 63SPT
  1448                                  
  1449 00000785 00                      	db	0
  1450                                  
  1451                                  RETRODOS_MASTERBOOT_SECTOR:
  1452 00000786 <bin 200h>              	incbin	'FS1_MBR.BIN' ; Singlix FS1 MBR	
  1453                                  
  1454                                  RETRODOS_FAT16_hd_bs: 
  1455                                  	;;incbin 'RD3HDBS.BIN'
  1456                                  	;; 28/10/2023
  1457                                  	;incbin	'RD4HDBS.BIN'	; BS Last Update: 24/10/2023
  1458                                  	; 04/05/2024
  1459 00000986 <bin 200h>              	incbin	'RD5HDBS2.BIN' ; 20/04/2024
  1460                                  
  1461 00000B86 00                      	db	0
  1462                                  
  1463                                  hexchrs:
  1464 00000B87 303132333435363738-     	db	'0123456789ABCDEF'
  1464 00000B90 39414243444546     
  1465                                  
  1466 00000B97 90                      align 2
  1467                                  
  1468                                  img_file_handle:
  1469 00000B98 0000                    	dw	0
  1470                                  
  1471                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  1472                                  ;  Messages
  1473                                  ;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
  1474                                  
  1475                                  Dsk_Type_Select_msg:
  1476                                  ;db  "RETRO DOS v3.0 Hard Disk Image Utility by Erdogan Tan (2018)                    "
  1477 00000B9A 524554524F20444F53-     db  "RETRO DOS v5.0 Hard Disk Image Utility by Erdogan Tan (2018-2024)               "
  1477 00000BA3 2076352E3020486172-
  1477 00000BAC 64204469736B20496D-
  1477 00000BB5 616765205574696C69-
  1477 00000BBE 747920627920457264-
  1477 00000BC7 6F67616E2054616E20-
  1477 00000BD0 28323031382D323032-
  1477 00000BD9 342920202020202020-
  1477 00000BE2 2020202020202020   
  1478 00000BEA 202020202020202020-     db  "                                                                                "
  1478 00000BF3 202020202020202020-
  1478 00000BFC 202020202020202020-
  1478 00000C05 202020202020202020-
  1478 00000C0E 202020202020202020-
  1478 00000C17 202020202020202020-
  1478 00000C20 202020202020202020-
  1478 00000C29 202020202020202020-
  1478 00000C32 2020202020202020   
  1479 00000C3A 202020202020202020-     db  "                                                                                "
  1479 00000C43 202020202020202020-
  1479 00000C4C 202020202020202020-
  1479 00000C55 202020202020202020-
  1479 00000C5E 202020202020202020-
  1479 00000C67 202020202020202020-
  1479 00000C70 202020202020202020-
  1479 00000C79 202020202020202020-
  1479 00000C82 2020202020202020   
  1480 00000C8A 4469736B2054797065-     db  "Disk Type     Cylinders     Heads     Sectors       Capacity                    "
  1480 00000C93 202020202043796C69-
  1480 00000C9C 6E6465727320202020-
  1480 00000CA5 204865616473202020-
  1480 00000CAE 2020536563746F7273-
  1480 00000CB7 202020202020204361-
  1480 00000CC0 706163697479202020-
  1480 00000CC9 202020202020202020-
  1480 00000CD2 2020202020202020   
  1481 00000CDA 2D2D2D2D2D2D2D2D2D-     db  "---------     ---------     -----     -------       --------                    "
  1481 00000CE3 20202020202D2D2D2D-
  1481 00000CEC 2D2D2D2D2D20202020-
  1481 00000CF5 202D2D2D2D2D202020-
  1481 00000CFE 20202D2D2D2D2D2D2D-
  1481 00000D07 202020202020202D2D-
  1481 00000D10 2D2D2D2D2D2D202020-
  1481 00000D19 202020202020202020-
  1481 00000D22 2020202020202020   
  1482 00000D2A 202020202031202020-     db  "     1           306          8         17            20 MB                     "
  1482 00000D33 202020202020202033-
  1482 00000D3C 303620202020202020-
  1482 00000D45 202020382020202020-
  1482 00000D4E 202020203137202020-
  1482 00000D57 202020202020202020-
  1482 00000D60 3230204D4220202020-
  1482 00000D69 202020202020202020-
  1482 00000D72 2020202020202020   
  1483 00000D7A 202020202032202020-     db  "     2           462          8         17            31 MB                     "
  1483 00000D83 202020202020202034-
  1483 00000D8C 363220202020202020-
  1483 00000D95 202020382020202020-
  1483 00000D9E 202020203137202020-
  1483 00000DA7 202020202020202020-
  1483 00000DB0 3331204D4220202020-
  1483 00000DB9 202020202020202020-
  1483 00000DC2 2020202020202020   
  1484 00000DCA 202020202020202020-     db  "                                                                                "
  1484 00000DD3 202020202020202020-
  1484 00000DDC 202020202020202020-
  1484 00000DE5 202020202020202020-
  1484 00000DEE 202020202020202020-
  1484 00000DF7 202020202020202020-
  1484 00000E00 202020202020202020-
  1484 00000E09 202020202020202020-
  1484 00000E12 2020202020202020   
  1485 00000E1A 202020202033202020-     db  "     3            32         16         63            16 MB                     "
  1485 00000E23 202020202020202020-
  1485 00000E2C 333220202020202020-
  1485 00000E35 202031362020202020-
  1485 00000E3E 202020203633202020-
  1485 00000E47 202020202020202020-
  1485 00000E50 3136204D4220202020-
  1485 00000E59 202020202020202020-
  1485 00000E62 2020202020202020   
  1486 00000E6A 202020202034202020-     db  "     4            40         16         63            20 MB                     "
  1486 00000E73 202020202020202020-
  1486 00000E7C 343020202020202020-
  1486 00000E85 202031362020202020-
  1486 00000E8E 202020203633202020-
  1486 00000E97 202020202020202020-
  1486 00000EA0 3230204D4220202020-
  1486 00000EA9 202020202020202020-
  1486 00000EB2 2020202020202020   
  1487 00000EBA 202020202035202020-     db  "     5            64         16         63            32 MB                     "
  1487 00000EC3 202020202020202020-
  1487 00000ECC 363420202020202020-
  1487 00000ED5 202031362020202020-
  1487 00000EDE 202020203633202020-
  1487 00000EE7 202020202020202020-
  1487 00000EF0 3332204D4220202020-
  1487 00000EF9 202020202020202020-
  1487 00000F02 2020202020202020   
  1488 00000F0A 202020202020202020-     db  "                                                                                "
  1488 00000F13 202020202020202020-
  1488 00000F1C 202020202020202020-
  1488 00000F25 202020202020202020-
  1488 00000F2E 202020202020202020-
  1488 00000F37 202020202020202020-
  1488 00000F40 202020202020202020-
  1488 00000F49 202020202020202020-
  1488 00000F52 2020202020202020   
  1489 00000F5A 202020202036202020-     db  "     6           128         16         63            64 MB                     "
  1489 00000F63 202020202020202031-
  1489 00000F6C 323820202020202020-
  1489 00000F75 202031362020202020-
  1489 00000F7E 202020203633202020-
  1489 00000F87 202020202020202020-
  1489 00000F90 3634204D4220202020-
  1489 00000F99 202020202020202020-
  1489 00000FA2 2020202020202020   
  1490 00000FAA 202020202037202020-     db  "     7           256         16         63           128 MB                     "
  1490 00000FB3 202020202020202032-
  1490 00000FBC 353620202020202020-
  1490 00000FC5 202031362020202020-
  1490 00000FCE 202020203633202020-
  1490 00000FD7 202020202020202031-
  1490 00000FE0 3238204D4220202020-
  1490 00000FE9 202020202020202020-
  1490 00000FF2 2020202020202020   
  1491 00000FFA 202020202038202020-     db  "     8           512         16         63           256 MB                     "
  1491 00001003 202020202020202035-
  1491 0000100C 313220202020202020-
  1491 00001015 202031362020202020-
  1491 0000101E 202020203633202020-
  1491 00001027 202020202020202032-
  1491 00001030 3536204D4220202020-
  1491 00001039 202020202020202020-
  1491 00001042 2020202020202020   
  1492 0000104A 202020202039202020-     db  "     9          1024         16         63           512 MB                     "
  1492 00001053 202020202020203130-
  1492 0000105C 323420202020202020-
  1492 00001065 202031362020202020-
  1492 0000106E 202020203633202020-
  1492 00001077 202020202020202035-
  1492 00001080 3132204D4220202020-
  1492 00001089 202020202020202020-
  1492 00001092 2020202020202020   
  1493 0000109A 202020202020202020-     db  "                                                                                "
  1493 000010A3 202020202020202020-
  1493 000010AC 202020202020202020-
  1493 000010B5 202020202020202020-
  1493 000010BE 202020202020202020-
  1493 000010C7 202020202020202020-
  1493 000010D0 202020202020202020-
  1493 000010D9 202020202020202020-
  1493 000010E2 2020202020202020   
  1494 000010EA 202020202020202020-     db  "                                                                                "
  1494 000010F3 202020202020202020-
  1494 000010FC 202020202020202020-
  1494 00001105 202020202020202020-
  1494 0000110E 202020202020202020-
  1494 00001117 202020202020202020-
  1494 00001120 202020202020202020-
  1494 00001129 202020202020202020-
  1494 00001132 2020202020202020   
  1495 0000113A 507265737320646973-     db  "Press disk number (1 to 9) to SELECT or                                         "
  1495 00001143 6B206E756D62657220-
  1495 0000114C 283120746F20392920-
  1495 00001155 746F2053454C454354-
  1495 0000115E 206F72202020202020-
  1495 00001167 202020202020202020-
  1495 00001170 202020202020202020-
  1495 00001179 202020202020202020-
  1495 00001182 2020202020202020   
  1496 0000118A 202020202020202020-     db  "                                                                                "
  1496 00001193 202020202020202020-
  1496 0000119C 202020202020202020-
  1496 000011A5 202020202020202020-
  1496 000011AE 202020202020202020-
  1496 000011B7 202020202020202020-
  1496 000011C0 202020202020202020-
  1496 000011C9 202020202020202020-
  1496 000011D2 2020202020202020   
  1497 000011DA 507265737320455343-     db  "Press ESC to cancel.                                                            "
  1497 000011E3 20746F2063616E6365-
  1497 000011EC 6C2E20202020202020-
  1497 000011F5 202020202020202020-
  1497 000011FE 202020202020202020-
  1497 00001207 202020202020202020-
  1497 00001210 202020202020202020-
  1497 00001219 202020202020202020-
  1497 00001222 2020202020202020   
  1498 0000122A 202020202020202020-     db  "                                                                                "
  1498 00001233 202020202020202020-
  1498 0000123C 202020202020202020-
  1498 00001245 202020202020202020-
  1498 0000124E 202020202020202020-
  1498 00001257 202020202020202020-
  1498 00001260 202020202020202020-
  1498 00001269 202020202020202020-
  1498 00001272 2020202020202020   
  1499 0000127A 00                      db  0
  1500                                  
  1501                                  RetroDOS_Welcome:
  1502 0000127B 0D0A                    	db	0Dh, 0Ah
  1503 0000127D 526574726F20444F53-     	db	'Retro DOS v5 Fixed Disk Image (FAT16 FS) Format Utility'
  1503 00001286 207635204669786564-
  1503 0000128F 204469736B20496D61-
  1503 00001298 676520284641543136-
  1503 000012A1 2046532920466F726D-
  1503 000012AA 6174205574696C6974-
  1503 000012B3 79                 
  1504 000012B4 0D0A                    	db	0Dh, 0Ah
  1505 000012B6 464154313648444920-     	db	"FAT16HDI v5.0.240504 (c) Erdogan TAN 2018-2024"
  1505 000012BF 76352E302E32343035-
  1505 000012C8 303420286329204572-
  1505 000012D1 646F67616E2054414E-
  1505 000012DA 20323031382D323032-
  1505 000012E3 34                 
  1506 000012E4 0D0A                    	db	0Dh,0Ah
  1507 000012E6 0D0A                    	db	0Dh,0Ah
  1508 000012E8 55736167653A207264-     	db	'Usage: rd5hdi16 <image file name> '
  1508 000012F1 356864693136203C69-
  1508 000012FA 6D6167652066696C65-
  1508 00001303 206E616D653E20     
  1509 0000130A 00                      	db	0
  1510                                  
  1511                                  msg_inv_file_name: 
  1512 0000130B 0D0A                    	db	0Dh, 0Ah
  1513 0000130D 496E76616C69642066-     	db	"Invalid file name !", 0Dh, 0Ah
  1513 00001316 696C65206E616D6520-
  1513 0000131F 210D0A             
  1514 00001322 2846696C65206E616D-     	db	"(File name must fit to 8.3 DOS format) !"
  1514 0000132B 65206D757374206669-
  1514 00001334 7420746F20382E3320-
  1514 0000133D 444F5320666F726D61-
  1514 00001346 74292021           
  1515 0000134A 0D0A00                  	db	0Dh, 0Ah, 0
  1516                                  
  1517                                  msg_inv_image_file:
  1518 0000134D 0D0A                    	db	0Dh, 0Ah
  1519 0000134F 496E76616C69642066-     	db	"Invalid fixed disk image file !", 0Dh, 0Ah
  1519 00001358 69786564206469736B-
  1519 00001361 20696D616765206669-
  1519 0000136A 6C6520210D0A       
  1520 00001370 2846696C652073697A-     	db	"(File size is not compatible) !"
  1520 00001379 65206973206E6F7420-
  1520 00001382 636F6D70617469626C-
  1520 0000138B 65292021           
  1521 0000138F 0D0A00                  	db	0Dh, 0Ah, 0 
  1522                                  
  1523                                  msg_option_not_proper:
  1524 00001392 53656C656374656420-     	db	"Selected partion size is not proper for selected disk size !"
  1524 0000139B 70617274696F6E2073-
  1524 000013A4 697A65206973206E6F-
  1524 000013AD 742070726F70657220-
  1524 000013B6 666F722073656C6563-
  1524 000013BF 746564206469736B20-
  1524 000013C8 73697A652021       
  1525 000013CE 0D0A                    	db	0Dh, 0Ah
  1526 000013D0 28596F75206E656564-     	db	"(You need to select another option.)"
  1526 000013D9 20746F2073656C6563-
  1526 000013E2 7420616E6F74686572-
  1526 000013EB 206F7074696F6E2E29 
  1527 000013F4 0D0D00                  	db	0Dh, 0Dh, 0 
  1528                                  
  1529                                  msg_any_key_esc_exit:
  1530 000013F7 0D0A                    	db	0Dh, 0Ah
  1531 000013F9 507265737320455343-     	db	"Press ESC to exit or press another key to continue..."
  1531 00001402 20746F206578697420-
  1531 0000140B 6F7220707265737320-
  1531 00001414 616E6F74686572206B-
  1531 0000141D 657920746F20636F6E-
  1531 00001426 74696E75652E2E2E   
  1532 0000142E 00                      	db	0
  1533                                  
  1534                                  msg_create_dos_partition_h:
  1535 0000142F 0D0A                    	db	0Dh, 0Ah
  1536 00001431 2D2D2D2D2D2D2D2D2D-     	db	"--------------------------------------------------------------------------------"
  1536 0000143A 2D2D2D2D2D2D2D2D2D-
  1536 00001443 2D2D2D2D2D2D2D2D2D-
  1536 0000144C 2D2D2D2D2D2D2D2D2D-
  1536 00001455 2D2D2D2D2D2D2D2D2D-
  1536 0000145E 2D2D2D2D2D2D2D2D2D-
  1536 00001467 2D2D2D2D2D2D2D2D2D-
  1536 00001470 2D2D2D2D2D2D2D2D2D-
  1536 00001479 2D2D2D2D2D2D2D2D   
  1537 00001481 202020202020202020-     	db	"                        Create Primary DOS Partition                            "
  1537 0000148A 202020202020202020-
  1537 00001493 202020202020437265-
  1537 0000149C 617465205072696D61-
  1537 000014A5 727920444F53205061-
  1537 000014AE 72746974696F6E2020-
  1537 000014B7 202020202020202020-
  1537 000014C0 202020202020202020-
  1537 000014C9 2020202020202020   
  1538 000014D1 2D2D2D2D2D2D2D2D2D-     	db	"--------------------------------------------------------------------------------"	
  1538 000014DA 2D2D2D2D2D2D2D2D2D-
  1538 000014E3 2D2D2D2D2D2D2D2D2D-
  1538 000014EC 2D2D2D2D2D2D2D2D2D-
  1538 000014F5 2D2D2D2D2D2D2D2D2D-
  1538 000014FE 2D2D2D2D2D2D2D2D2D-
  1538 00001507 2D2D2D2D2D2D2D2D2D-
  1538 00001510 2D2D2D2D2D2D2D2D2D-
  1538 00001519 2D2D2D2D2D2D2D2D   
  1539 00001521 0D0A00                  	db	0Dh, 0Ah, 0	
  1540                                  msg_create_dos_partition_m:
  1541 00001524 53656C65637420616E-     	db	"Select an option: "
  1541 0000152D 206F7074696F6E3A20 
  1542 00001536 0D0A                    	db	0Dh, 0Ah
  1543 00001538 0D0A                    	db	0Dh, 0Ah
  1544 0000153A 202031292055736520-     	db	"  1) Use 10 MB disk space for FAT16 (04h) partition ", 0Dh, 0Ah
  1544 00001543 3130204D4220646973-
  1544 0000154C 6B2073706163652066-
  1544 00001555 6F7220464154313620-
  1544 0000155E 283034682920706172-
  1544 00001567 746974696F6E200D0A 
  1545 00001570 202032292055736520-     	db	"  2) Use 16 MB disk space for FAT16 (04h) partition ", 0Dh, 0Ah
  1545 00001579 3136204D4220646973-
  1545 00001582 6B2073706163652066-
  1545 0000158B 6F7220464154313620-
  1545 00001594 283034682920706172-
  1545 0000159D 746974696F6E200D0A 
  1546 000015A6 202033292055736520-     	db	"  3) Use 20 MB disk space for FAT16 (04h) partition ", 0Dh, 0Ah
  1546 000015AF 3230204D4220646973-
  1546 000015B8 6B2073706163652066-
  1546 000015C1 6F7220464154313620-
  1546 000015CA 283034682920706172-
  1546 000015D3 746974696F6E200D0A 
  1547 000015DC 202034292055736520-     	db	"  4) Use 32 MB disk space for FAT16 (04h) partition ", 0Dh, 0Ah
  1547 000015E5 3332204D4220646973-
  1547 000015EE 6B2073706163652066-
  1547 000015F7 6F7220464154313620-
  1547 00001600 283034682920706172-
  1547 00001609 746974696F6E200D0A 
  1548 00001612 0D0A                    	db	0Dh, 0Ah  
  1549 00001614 202035292055736520-     	db	"  5) Use  64 MB disk space for FAT16 (06h) partition ", 0Dh, 0Ah
  1549 0000161D 203634204D42206469-
  1549 00001626 736B20737061636520-
  1549 0000162F 666F72204641543136-
  1549 00001638 202830366829207061-
  1549 00001641 72746974696F6E200D-
  1549 0000164A 0A                 
  1550 0000164B 202036292055736520-     	db	"  6) Use 128 MB disk space for FAT16 (06h) partition ", 0Dh, 0Ah
  1550 00001654 313238204D42206469-
  1550 0000165D 736B20737061636520-
  1550 00001666 666F72204641543136-
  1550 0000166F 202830366829207061-
  1550 00001678 72746974696F6E200D-
  1550 00001681 0A                 
  1551 00001682 202037292055736520-     	db	"  7) Use 256 MB disk space for FAT16 (06h) partition ", 0Dh, 0Ah
  1551 0000168B 323536204D42206469-
  1551 00001694 736B20737061636520-
  1551 0000169D 666F72204641543136-
  1551 000016A6 202830366829207061-
  1551 000016AF 72746974696F6E200D-
  1551 000016B8 0A                 
  1552 000016B9 202038292055736520-     	db	"  8) Use 512 MB disk space for FAT16 (06h) partition ", 0Dh, 0Ah
  1552 000016C2 353132204D42206469-
  1552 000016CB 736B20737061636520-
  1552 000016D4 666F72204641543136-
  1552 000016DD 202830366829207061-
  1552 000016E6 72746974696F6E200D-
  1552 000016EF 0A                 
  1553 000016F0 0D0A                    	db	0Dh, 0Ah  
  1554 000016F2 202039292055736520-     	db	"  9) Use whole disk space for FAT16 partition ", 0Dh, 0Ah
  1554 000016FB 77686F6C6520646973-
  1554 00001704 6B2073706163652066-
  1554 0000170D 6F7220464154313620-
  1554 00001716 706172746974696F6E-
  1554 0000171F 200D0A             
  1555 00001722 0D0A                    	db	0Dh, 0Ah	
  1556 00001724 507265737320455343-     	db	"Press ESC or 0 to exit .. "
  1556 0000172D 206F72203020746F20-
  1556 00001736 65786974202E2E20   
  1557 0000173E 0D0A00                   	db 	0Dh, 0Ah, 0
  1558                                  
  1559                                  msg_overwrite_question1:
  1560 00001741 0D0A                    	db	0Dh, 0Ah
  1561 00001743 446F20796F75207761-     	db	'Do you want to overwrite '
  1561 0000174C 6E7420746F206F7665-
  1561 00001755 72777269746520     
  1562 0000175C 27                      	db	27h
  1563 0000175D 00                      	db	0
  1564                                  
  1565                                  msg_overwrite_question2: 
  1566 0000175E 27                      	db	27h
  1567 0000175F 2066696C6520            	db	' file '
  1568 00001765 00                      	db	0
  1569                                  
  1570                                  msg_yes_no:
  1571 00001766 285965732F4E6F293F-     	db	'(Yes/No)? ', 0	
  1571 0000176F 2000               
  1572                                  
  1573                                  msg_writing_mbr:
  1574 00001771 57726974696E67206D-     	db	"Writing masterboot sector...", 0
  1574 0000177A 6173746572626F6F74-
  1574 00001783 20736563746F722E2E-
  1574 0000178C 2E00               
  1575                                  
  1576                                  msg_writing_disk_sectors:
  1577 0000178E 57726974696E672064-     	db	"Writing disk sector: ", 0
  1577 00001797 69736B20736563746F-
  1577 000017A0 723A2000           
  1578                                  
  1579                                  msg_writing_boot_sector:
  1580 000017A4 57726974696E672076-     	db	"Writing volume boot sector...", 0
  1580 000017AD 6F6C756D6520626F6F-
  1580 000017B6 7420736563746F722E-
  1580 000017BF 2E2E00             
  1581                                  
  1582                                  msg_writing_FAT_sectors:
  1583 000017C2 57726974696E672046-     	db	"Writing FAT sectors...", 0
  1583 000017CB 415420736563746F72-
  1583 000017D4 732E2E2E00         
  1584                                  
  1585                                  msg_writing_root_dir:
  1586 000017D9 57726974696E672072-     	db	"Writing root directory sectors...", 0
  1586 000017E2 6F6F74206469726563-
  1586 000017EB 746F72792073656374-
  1586 000017F4 6F72732E2E2E00     
  1587                                  
  1588                                  StrVolumeName:
  1589 000017FB 00<rep Ch>              	times 	12 db  0
  1590                                  
  1591                                  Msg_Volume_Name:
  1592 00001807 0D0A                    	db	0Dh, 0Ah
  1593 00001809 566F6C756D65204E61-     	db	"Volume Name: ", 0
  1593 00001812 6D653A2000         
  1594                                  
  1595                                  Msg_Volume_Serial:
  1596 00001817 566F6C756D65205365-     	db	"Volume Serial No: "
  1596 00001820 7269616C204E6F3A20 
  1597                                  Vol_Serial1:
  1598 00001829 30303030                	db	"0000"
  1599 0000182D 2D                      	db	"-"
  1600                                  Vol_Serial2:
  1601 0000182E 30303030                	db	"0000"
  1602 00001832 0D0A00                  	db	0Dh, 0Ah, 0
  1603                                  
  1604                                  msg_OK:
  1605 00001835 204F4B2E                	db	' OK.'
  1606                                  CRLF:
  1607 00001839 0D0A00                  	db	0Dh, 0Ah, 0
  1608                                  Msg_YES:
  1609 0000183C 20                      	db	 20h
  1610                                  msg_yes_:
  1611 0000183D 59455300                	db	'YES', 0
  1612                                  Msg_NO:
  1613 00001841 20                      	db	20h
  1614                                  msg_no_:
  1615 00001842 4E4F00                  	db	'NO', 0
  1616                                  
  1617                                  Msg_Error:
  1618 00001845 0D0A                    	db	0Dh, 0Ah
  1619 00001847 4572726F72202120        	db	'Error ! '
  1620 0000184F 28                      	db	'('
  1621                                  error_code:
  1622 00001850 3030                    	dw	3030h
  1623 00001852 68                      	db	'h'
  1624 00001853 2920                    	db	') '
  1625 00001855 0D0A                    	db	0Dh, 0Ah
  1626 00001857 00                      	db	0
  1627                                  
  1628                                  msg_disk_type_selected:
  1629 00001858 4469736B2054797065-     	db	"Disk Type "
  1629 00001861 20                 
  1630                                  delected_disk_num:
  1631 00001862 202068617320626565-     	db	"  has been selected."
  1631 0000186B 6E2073656C65637465-
  1631 00001874 642E               
  1632 00001876 0D0A00                  	db 0Dh, 0Ah, 0
  1633                                  msg_enter_cancel:
  1634 00001879 0D0A                    	db	0Dh, 0Ah
  1635 0000187B 507265737320454E54-     	db	"Press ENTER to write file or press ESC to cancel." 
  1635 00001884 455220746F20777269-
  1635 0000188D 74652066696C65206F-
  1635 00001896 722070726573732045-
  1635 0000189F 534320746F2063616E-
  1635 000018A8 63656C2E           
  1636 000018AC 0D0A00                  	db	0Dh, 0Ah, 0
  1637                                  
  1638                                  msg_press_any_key:
  1639 000018AF 0D0A                    	db	0Dh, 0Ah
  1640 000018B1 50726573732061206B-     	db	"Press a key to continue..." 
  1640 000018BA 657920746F20636F6E-
  1640 000018C3 74696E75652E2E2E   
  1641 000018CB 0D0A00                  	db	0Dh, 0Ah, 0
  1642                                  
  1643                                  msg_creating:
  1644 000018CE 0D0A                    	db	0Dh, 0Ah
  1645 000018D0 4372656174696E6720-     	db	"Creating ",0
  1645 000018D9 00                 
  1646                                  msg_disk_size:
  1647 000018DA 3030304D4220686172-     	db	"000MB hard disk image... ",
  1647 000018E3 64206469736B20696D-
  1647 000018EC 6167652E2E2E20     
  1648 000018F3 20                      	db	" "
  1649 000018F4 00                      	db	0
  1650                                  
  1651                                  DskTypeNumStr:	
  1652 000018F5 303230303331303136-     	db	"020031016020032064128256512"
  1652 000018FE 303230303332303634-
  1652 00001907 313238323536353132 
  1653 00001910 0000                    	dw	0
  1654                                  
  1655                                  RSymbols:
  1656 00001912 2D5C7C2F                	db	"-\|/"
  1657                                  
  1658                                  align 2
  1659                                  
  1660                                  Cursor_Pos:
  1661 00001916 0000                    	dw	0
  1662                                  
  1663                                  CWSector:
  1664 00001918 00000000                	dd	0
  1665                                  
  1666                                  diskimage_size:
  1667 0000191C 00000000                	dd	0
  1668                                  
  1669                                  DiskType:
  1670 00001920 00                      	db	0
  1671                                  
  1672                                  img_file_name:  
  1673 00001921 00<rep Dh>              	times	13 db 0
  1674                                  
  1675                                  ;no_name:
  1676                                  ;	db 	'NO NAME    ', 0
  1677                                  
  1678                                  align 2
  1679                                  
  1680                                  HDFORMAT_SECBUFFER:
  1681                                  HDFORMAT_FATBUFFER:
  1682                                  HDFORMAT_ZERO_BUFF:
  1683 0000192E F6<rep 200h>            	times	512 db 0F6h
  1684                                  
  1685 00001B2E 00                      	db	0
  1686 00001B2F 286329204572646F67-     	db	'(c) Erdogan TAN 2018-2024'
  1686 00001B38 616E2054414E203230-
  1686 00001B41 31382D32303234     
  1687 00001B48 00                      	db	0
  1688                                  
  1689                                  SizeOfFile equ $-100
