DOSCODE:3DE0 ; File Name   : C:\retrodos4\MSDOS622.SYS
DOSCODE:3DE0 ; Format	   : Binary file
DOSCODE:3DE0 ; Base Address: 0000h Range: 0000h	- 94FAh	Loaded length: 94FAh
DOSCODE:3DE0 ; ===========================================================================
DOSCODE:3DE0 ; Segment type: Pure code
DOSCODE:3DE0 DOSCODE	     segment byte public 'CODE' use16
DOSCODE:3DE0		     assume cs:DOSCODE
DOSCODE:3DE0		     ;org 3DE0h
DOSCODE:3DE0		     assume es:nothing,	ss:nothing, ds:nothing,	fs:nothing, gs:nothing
DOSCODE:3DE0 $STARTCODE:			     ; ...
DOSCODE:3DE0		     jmp     DOSINIT
DOSCODE:3DE3		     dw	offset $STARTCODE
DOSCODE:3DE5 BioDataSeg	     dw	70h
DOSCODE:3DE7 DosDSeg	     dw	0		     ; ...
DOSCODE:3DE9 MSMAJOR	     db	6
DOSCODE:3DEA MSMINOR	     db	22
DOSCODE:3DEB I21_MAP_E_TAB   db	38h, 2,	1, 2	     ; ...
DOSCODE:3DEF		     db	39h, 2 dup(3), 2, 5
DOSCODE:3DF4		     db	3Ah, 4,	10h, 3,	2, 5
DOSCODE:3DFA		     db	3Bh, 2 dup(2), 3
DOSCODE:3DFE		     db	3Ch, 4,	3, 2, 4, 5
DOSCODE:3E04		     db	3Dh, 6,	3, 2, 0Ch, 4, 1Ah, 5
DOSCODE:3E0C		     db	3Eh, 1,	6
DOSCODE:3E0F		     db	3Fh, 2,	6, 5
DOSCODE:3E13		     db	40h, 2,	6, 5
DOSCODE:3E17		     db	41h, 2 dup(3), 2, 5
DOSCODE:3E1C		     db	42h, 2,	6, 1
DOSCODE:3E20		     db	43h, 4,	3, 2, 1, 5
DOSCODE:3E26		     db	44h, 5,	0Fh, 0Dh, 1, 6,	5
DOSCODE:3E2D		     db	45h, 2,	6, 4
DOSCODE:3E31		     db	46h, 2,	6, 4
DOSCODE:3E35		     db	47h, 2,	1Ah, 0Fh
DOSCODE:3E39		     db	48h, 2,	7, 8
DOSCODE:3E3D		     db	49h, 2,	7, 9
DOSCODE:3E41		     db	4Ah, 3,	7, 9, 8
DOSCODE:3E46		     db	4Bh, 8,	3, 1, 2, 4, 0Bh, 0Ah, 8, 5
DOSCODE:3E50		     db	4Eh, 2 dup(3), 2, 12h
DOSCODE:3E55		     db	4Fh, 1,	12h
DOSCODE:3E58		     db	56h, 5,	11h, 3,	2, 10h,	5
DOSCODE:3E5F		     db	57h, 4,	6, 8, 0Dh, 1
DOSCODE:3E65		     db	58h, 2 dup(1)
DOSCODE:3E68		     db	5Ah, 4,	3, 2, 4, 5
DOSCODE:3E6E		     db	5Bh, 5,	50h, 3,	2, 4, 5
DOSCODE:3E75		     db	5Ch, 4,	6, 1, 24h, 21h
DOSCODE:3E7B		     db	65h, 2,	1, 2
DOSCODE:3E7F		     db	66h, 2,	1, 2
DOSCODE:3E83		     db	68h, 1,	6
DOSCODE:3E86		     db	67h, 3,	4, 8, 1
DOSCODE:3E8B		     db	6Ch, 0Ah, 3, 2,	0Ch, 4,	50h, 8,	1Ah, 0Dh, 1, 5
DOSCODE:3E97		     db	69h, 4,	0Fh, 0Dh, 1, 5
DOSCODE:3E9D		     db	0FFh
DOSCODE:3E9E DISPATCH	     dw	offset $ABORT	     ; ...
DOSCODE:3EA0		     dw	offset $STD_CON_INPUT
DOSCODE:3EA2		     dw	offset $STD_CON_OUTPUT
DOSCODE:3EA4		     dw	offset $STD_AUX_INPUT
DOSCODE:3EA6		     dw	offset $STD_AUX_OUTPUT
DOSCODE:3EA8		     dw	offset $STD_PRINTER_OUTPUT
DOSCODE:3EAA		     dw	offset $RAW_CON_IO
DOSCODE:3EAC		     dw	offset $RAW_CON_INPUT
DOSCODE:3EAE		     dw	offset $STD_CON_INPUT_NO_ECHO
DOSCODE:3EB0		     dw	offset $STD_CON_STRING_OUTPUT
DOSCODE:3EB2		     dw	offset $STD_CON_STRING_INPUT
DOSCODE:3EB4		     dw	offset $STD_CON_INPUT_STATUS
DOSCODE:3EB6		     dw	offset $STD_CON_INPUT_FLUSH
DOSCODE:3EB8		     dw	offset $DISK_RESET
DOSCODE:3EBA		     dw	offset $SET_DEFAULT_DRIVE
DOSCODE:3EBC		     dw	offset $FCB_OPEN
DOSCODE:3EBE		     dw	offset $FCB_CLOSE
DOSCODE:3EC0		     dw	offset $DIR_SEARCH_FIRST
DOSCODE:3EC2		     dw	offset $DIR_SEARCH_NEXT
DOSCODE:3EC4		     dw	offset $FCB_DELETE
DOSCODE:3EC6		     dw	offset $FCB_SEQ_READ
DOSCODE:3EC8		     dw	offset $FCB_SEQ_WRITE
DOSCODE:3ECA		     dw	offset $FCB_CREATE
DOSCODE:3ECC		     dw	offset $FCB_RENAME
DOSCODE:3ECE		     dw	offset NO_OP
DOSCODE:3ED0		     dw	offset $GET_DEFAULT_DRIVE
DOSCODE:3ED2		     dw	offset $SET_DMA
DOSCODE:3ED4		     dw	offset $SLEAZEFUNC
DOSCODE:3ED6		     dw	offset $SLEAZEFUNCDL
DOSCODE:3ED8		     dw	offset NO_OP
DOSCODE:3EDA		     dw	offset NO_OP
DOSCODE:3EDC		     dw	offset $GET_DEFAULT_DPB
DOSCODE:3EDE		     dw	offset NO_OP
DOSCODE:3EE0		     dw	offset $FCB_RANDOM_READ
DOSCODE:3EE2		     dw	offset $FCB_RANDOM_WRITE
DOSCODE:3EE4		     dw	offset $GET_FCB_FILE_LENGTH
DOSCODE:3EE6		     dw	offset $GET_FCB_POSITION
DOSCODE:3EE8		     dw	offset $SET_INTERRUPT_VECTOR
DOSCODE:3EEA		     dw	offset $CREATE_PROCESS_DATA_BLOCK
DOSCODE:3EEC		     dw	offset $FCB_RANDOM_READ_BLOCK
DOSCODE:3EEE		     dw	offset $FCB_RANDOM_WRITE_BLOCK
DOSCODE:3EF0		     dw	offset $PARSE_FILE_DESCRIPTOR
DOSCODE:3EF2		     dw	offset $GET_DATE
DOSCODE:3EF4		     dw	offset $SET_DATE
DOSCODE:3EF6		     dw	offset $GET_TIME
DOSCODE:3EF8		     dw	offset $SET_TIME
DOSCODE:3EFA		     dw	offset $SET_VERIFY_ON_WRITE
DOSCODE:3EFC		     dw	offset $GET_DMA
DOSCODE:3EFE		     dw	offset $GET_VERSION
DOSCODE:3F00		     dw	offset $KEEP_PROCESS
DOSCODE:3F02		     dw	offset $GET_DPB
DOSCODE:3F04		     dw	offset $SET_CTRL_C_TRAPPING
DOSCODE:3F06		     dw	offset $GET_INDOS_FLAG
DOSCODE:3F08		     dw	offset $GET_INTERRUPT_VECTOR
DOSCODE:3F0A		     dw	offset $GET_DRIVE_FREESPACE
DOSCODE:3F0C		     dw	offset $CHAR_OPER
DOSCODE:3F0E		     dw	offset $INTERNATIONAL
DOSCODE:3F10		     dw	offset $MKDIR
DOSCODE:3F12		     dw	offset $RMDIR
DOSCODE:3F14		     dw	offset $CHDIR
DOSCODE:3F16		     dw	offset $CREAT
DOSCODE:3F18		     dw	offset $OPEN
DOSCODE:3F1A		     dw	offset $CLOSE
DOSCODE:3F1C		     dw	offset $READ
DOSCODE:3F1E		     dw	offset $WRITE
DOSCODE:3F20		     dw	offset $UNLINK
DOSCODE:3F22		     dw	offset $LSEEK
DOSCODE:3F24		     dw	offset $CHMOD
DOSCODE:3F26		     dw	offset $IOCTL
DOSCODE:3F28		     dw	offset $DUP
DOSCODE:3F2A		     dw	offset $DUP2
DOSCODE:3F2C		     dw	offset $CURRENT_DIR
DOSCODE:3F2E		     dw	offset $ALLOC
DOSCODE:3F30		     dw	offset $DEALLOC
DOSCODE:3F32		     dw	offset $SETBLOCK
DOSCODE:3F34		     dw	offset $EXEC
DOSCODE:3F36		     dw	offset $EXIT
DOSCODE:3F38		     dw	offset $WAIT
DOSCODE:3F3A		     dw	offset $FIND_FIRST
DOSCODE:3F3C		     dw	offset $FIND_NEXT
DOSCODE:3F3E		     dw	offset $SET_CURRENT_PDB
DOSCODE:3F40		     dw	offset $GET_CURRENT_PDB
DOSCODE:3F42		     dw	offset $GET_IN_VARS
DOSCODE:3F44		     dw	offset $SETDPB
DOSCODE:3F46		     dw	offset $GET_VERIFY_ON_WRITE
DOSCODE:3F48		     dw	offset $DUP_PDB
DOSCODE:3F4A		     dw	offset $RENAME
DOSCODE:3F4C		     dw	offset $FILE_TIMES
DOSCODE:3F4E		     dw	offset $ALLOCOPER
DOSCODE:3F50		     dw	offset $GetExtendedError
DOSCODE:3F52		     dw	offset $CreateTempFile
DOSCODE:3F54		     dw	offset $CreateNewFile
DOSCODE:3F56		     dw	offset $LockOper
DOSCODE:3F58		     dw	offset $ServerCall
DOSCODE:3F5A		     dw	offset $UserOper
DOSCODE:3F5C		     dw	offset $AssignOper
DOSCODE:3F5E		     dw	offset $NameTrans
DOSCODE:3F60		     dw	offset NO_OP
DOSCODE:3F62		     dw	offset $GET_CURRENT_PDB
DOSCODE:3F64		     dw	offset $ECS_Call
DOSCODE:3F66		     dw	offset $SET_PRINTER_FLAG
DOSCODE:3F68		     dw	offset $GetExtCntry
DOSCODE:3F6A		     dw	offset $GetSetCdPg
DOSCODE:3F6C		     dw	offset $ExtHandle
DOSCODE:3F6E		     dw	offset $COMMIT
DOSCODE:3F70		     dw	offset $GSetMediaID
DOSCODE:3F72		     dw	offset $COMMIT
DOSCODE:3F74		     dw	offset NO_OP
DOSCODE:3F76		     dw	offset $Extended_Open
DOSCODE:3F78 FOO	     dw	offset Leave2F	     ; ...
DOSCODE:3F7A DTab	     dw	offset DOSTable	     ; ...
DOSCODE:3F7C DOSTable	     db	48		     ; ...
DOSCODE:3F7D		     dw	offset DOSInstall
DOSCODE:3F7F		     dw	offset DOS_CLOSE
DOSCODE:3F81		     dw	offset RECSET
DOSCODE:3F83		     dw	offset DOSGetGroup
DOSCODE:3F85		     dw	offset PATHCHRCMP
DOSCODE:3F87		     dw	offset OUTT
DOSCODE:3F89		     dw	offset NET_I24_ENTRY
DOSCODE:3F8B		     dw	offset PLACEBUF
DOSCODE:3F8D		     dw	offset FREE_SFT
DOSCODE:3F8F		     dw	offset BUFWRITE
DOSCODE:3F91		     dw	offset SHARE_VIOLATION
DOSCODE:3F93		     dw	offset SHARE_ERROR
DOSCODE:3F95		     dw	offset SET_SFT_MODE
DOSCODE:3F97		     dw	offset DATE16
DOSCODE:3F99		     dw	offset Idle
DOSCODE:3F9B		     dw	offset SCANPLACE
DOSCODE:3F9D		     dw	offset Idle
DOSCODE:3F9F		     dw	offset StrCpy
DOSCODE:3FA1		     dw	offset StrLen
DOSCODE:3FA3		     dw	offset UCase
DOSCODE:3FA5		     dw	offset POINTCOMP
DOSCODE:3FA7		     dw	offset CHECKFLUSH
DOSCODE:3FA9		     dw	offset SFFromSFN
DOSCODE:3FAB		     dw	offset GetCDSFromDrv
DOSCODE:3FAD		     dw	offset Get_User_Stack
DOSCODE:3FAF		     dw	offset GETTHISDRV
DOSCODE:3FB1		     dw	offset DriveFromText
DOSCODE:3FB3		     dw	offset SETYEAR
DOSCODE:3FB5		     dw	offset DSUM
DOSCODE:3FB7		     dw	offset DSLIDE
DOSCODE:3FB9		     dw	offset StrCmp
DOSCODE:3FBB		     dw	offset InitCDS
DOSCODE:3FBD		     dw	offset pJFNFromHandle
DOSCODE:3FBF		     dw	offset $NameTrans
DOSCODE:3FC1		     dw	offset CAL_LK
DOSCODE:3FC3		     dw	offset DEVNAME
DOSCODE:3FC5		     dw	offset Idle
DOSCODE:3FC7		     dw	offset DStrLen
DOSCODE:3FC9		     dw	offset NLS_OPEN
DOSCODE:3FCB		     dw	offset $CLOSE
DOSCODE:3FCD		     dw	offset NLS_LSEEK
DOSCODE:3FCF		     dw	offset $READ
DOSCODE:3FD1		     dw	offset FastInit
DOSCODE:3FD3		     dw	offset NLS_IOCTL
DOSCODE:3FD5		     dw	offset GetDevList
DOSCODE:3FD7		     dw	offset NLS_GETEXT
DOSCODE:3FD9		     dw	offset MSG_RETRIEVAL
DOSCODE:3FDB		     dw	offset NO_OP
DOSCODE:3FDD ms_copyright    db	'MS DOS Version 6 (C)Copyright 1981-1994 Microsoft Corp Licensed M'
DOSCODE:3FDD		     db	'aterial - Property of Microsoft All rights reserved '
DOSCODE:4052 ; START OF	FUNCTION CHUNK FOR STATCHK
DOSCODE:4052 $SET_CTRL_C_TRAPPING:		     ; ...
DOSCODE:4052		     cmp     al, 6
DOSCODE:4054		     jbe     short scct_1
DOSCODE:4056		     mov     al, 0FFh
DOSCODE:4058		     iret
DOSCODE:4059 scct_1:				     ; ...
DOSCODE:4059		     push    ds
DOSCODE:405A		     mov     ds, cs:DosDSeg
DOSCODE:405F		     push    ax
DOSCODE:4060		     push    si
DOSCODE:4061		     mov     si, offset	CNTCFLAG
DOSCODE:4064		     xor     ah, ah
DOSCODE:4066		     or	     ax, ax
DOSCODE:4068		     jnz     short scct_2
DOSCODE:406A		     mov     dl, [si]
DOSCODE:406C		     jmp     short scct_9s
DOSCODE:406E scct_2:				     ; ...
DOSCODE:406E		     dec     ax
DOSCODE:406F		     jnz     short scct_3
DOSCODE:4071		     and     dl, 1
DOSCODE:4074		     mov     [si], dl
DOSCODE:4076		     jmp     short scct_9s
DOSCODE:4078 scct_3:				     ; ...
DOSCODE:4078		     dec     ax
DOSCODE:4079		     jnz     short scct_4
DOSCODE:407B		     and     dl, 1
DOSCODE:407E		     xchg    dl, [si]
DOSCODE:4080		     jmp     short scct_9s
DOSCODE:4082 scct_4:				     ; ...
DOSCODE:4082		     cmp     ax, 3
DOSCODE:4085		     jnz     short scct_5
DOSCODE:4087		     mov     dl, ds:BOOTDRIVE
DOSCODE:408B		     jmp     short scct_9s
DOSCODE:408D scct_5:				     ; ...
DOSCODE:408D		     cmp     ax, 4
DOSCODE:4090		     jnz     short scct_9s
DOSCODE:4092		     mov     bx, 1606h
DOSCODE:4095		     mov     dl, 0
DOSCODE:4097		     xor     dh, dh
DOSCODE:4099		     cmp     ds:DosHasHMA, 0
DOSCODE:409E		     jz	     short scct_9s
DOSCODE:40A0		     or	     dh, 10h
DOSCODE:40A3 scct_9s:				     ; ...
DOSCODE:40A3		     pop     si
DOSCODE:40A4		     pop     ax
DOSCODE:40A5		     pop     ds
DOSCODE:40A6		     iret
DOSCODE:40A7 SetCtrlShortEntry:			     ; ...
DOSCODE:40A7		     jmp     short $SET_CTRL_C_TRAPPING
DOSCODE:40A9 $SET_CURRENT_PDB:			     ; ...
DOSCODE:40A9		     push    ds
DOSCODE:40AA		     mov     ds, cs:DosDSeg
DOSCODE:40AF		     mov     ds:CurrentPDB, bx
DOSCODE:40B3		     pop     ds
DOSCODE:40B4		     iret
DOSCODE:40B5 $GET_CURRENT_PDB:			     ; ...
DOSCODE:40B5		     push    ds
DOSCODE:40B6		     mov     ds, cs:DosDSeg
DOSCODE:40BB		     mov     bx, ds:CurrentPDB
DOSCODE:40BF		     pop     ds
DOSCODE:40C0		     iret
DOSCODE:40C1 $SET_PRINTER_FLAG:			     ; ...
DOSCODE:40C1		     push    ds
DOSCODE:40C2		     mov     ds, cs:DosDSeg
DOSCODE:40C7		     mov     ds:PRINTER_FLAG, al
DOSCODE:40CA		     pop     ds
DOSCODE:40CB		     iret
DOSCODE:40CB ; END OF FUNCTION CHUNK FOR STATCHK
DOSCODE:40CC quit:				     ; ...
DOSCODE:40CC		     xor     ah, ah
DOSCODE:40CE		     jmp     short SAVREGS
DOSCODE:40D0 ; START OF	FUNCTION CHUNK FOR STATCHK
DOSCODE:40D0 BADCALL:				     ; ...
DOSCODE:40D0		     xor     al, al
DOSCODE:40D2 irett:				     ; ...
DOSCODE:40D2		     iret
DOSCODE:40D2 ; END OF FUNCTION CHUNK FOR STATCHK
DOSCODE:40D3 call_entry:			     ; ...
DOSCODE:40D3		     push    ds
DOSCODE:40D4		     mov     ds, cs:DosDSeg
DOSCODE:40D9		     pop     ds:SAVEDS
DOSCODE:40DD		     pop     ax
DOSCODE:40DE		     pop     ax
DOSCODE:40DF		     pop     ds:USER_SP
DOSCODE:40E3		     pushf
DOSCODE:40E4		     cli
DOSCODE:40E5		     push    ax
DOSCODE:40E6		     push    ds:USER_SP
DOSCODE:40EA		     push    ds:SAVEDS
DOSCODE:40EE		     pop     ds
DOSCODE:40EF		     cmp     cl, 36
DOSCODE:40F2		     ja	     short BADCALL
DOSCODE:40F4		     mov     ah, cl
DOSCODE:40F6		     jmp     short SAVREGS
DOSCODE:40F8 ; START OF	FUNCTION CHUNK FOR STATCHK
DOSCODE:40F8 command:				     ; ...
DOSCODE:40F8		     cli
DOSCODE:40F9		     cmp     ah, 6Ch
DOSCODE:40FC		     ja	     short BADCALL
DOSCODE:40FE SAVREGS:				     ; ...
DOSCODE:40FE		     cmp     ah, 33h
DOSCODE:4101		     jb	     short SaveAllRegs
DOSCODE:4103		     jz	     short SetCtrlShortEntry
DOSCODE:4105		     cmp     ah, 64h
DOSCODE:4108		     ja	     short SaveAllRegs
DOSCODE:410A		     jz	     short $SET_PRINTER_FLAG
DOSCODE:410C		     cmp     ah, 51h
DOSCODE:410F		     jz	     short $GET_CURRENT_PDB
DOSCODE:4111		     cmp     ah, 62h
DOSCODE:4114		     jz	     short $GET_CURRENT_PDB
DOSCODE:4116		     cmp     ah, 50h
DOSCODE:4119		     jz	     short $SET_CURRENT_PDB
DOSCODE:411B SaveAllRegs:			     ; ...
DOSCODE:411B		     push    es
DOSCODE:411C		     push    ds
DOSCODE:411D		     push    bp
DOSCODE:411E		     push    di
DOSCODE:411F		     push    si
DOSCODE:4120		     push    dx
DOSCODE:4121		     push    cx
DOSCODE:4122		     push    bx
DOSCODE:4123		     push    ax
DOSCODE:4124		     mov     ax, ds
DOSCODE:4126		     mov     ds, cs:DosDSeg
DOSCODE:412B		     mov     ds:SAVEDS,	ax
DOSCODE:412E		     mov     ds:SAVEBX,	bx
DOSCODE:4132		     mov     ax, ds:USER_SP
DOSCODE:4135		     mov     ds:NSP, ax
DOSCODE:4138		     mov     ax, ds:USER_SS
DOSCODE:413B		     mov     ds:NSS, ax
DOSCODE:413E		     xor     ax, ax
DOSCODE:4140		     mov     ds:FSHARING, al
DOSCODE:4143		     test    ds:IsWin386, 1
DOSCODE:4148		     jnz     short set_indos_flag
DOSCODE:414A		     mov     ds:USER_ID, ax
DOSCODE:414D set_indos_flag:			     ; ...
DOSCODE:414D		     inc     ds:INDOS
DOSCODE:4151		     mov     ds:USER_SP, sp
DOSCODE:4155		     mov     ds:USER_SS, ss
DOSCODE:4159		     mov     ax, ds:CurrentPDB
DOSCODE:415C		     mov     ds:PROC_ID, ax
DOSCODE:415F		     mov     ds, ax
DOSCODE:4161		     pop     ax
DOSCODE:4162		     push    ax
DOSCODE:4163		     mov     ds:2Eh, sp
DOSCODE:4167		     mov     word ptr ds:30h, ss
DOSCODE:416B		     mov     ss, cs:DosDSeg
DOSCODE:4170 REDISP:				     ; ...
DOSCODE:4170		     mov     sp, offset	AUXSTACK
DOSCODE:4173		     sti
DOSCODE:4174		     mov     bx, ss
DOSCODE:4176		     mov     ds, bx
DOSCODE:4178		     xchg    ax, bx
DOSCODE:4179		     xor     ax, ax
DOSCODE:417B		     mov     ss:EXTOPEN_ON, al
DOSCODE:417F		     and     ss:DOS34_FLAG, 800h
DOSCODE:4186		     mov     ss:CONSWAP, al
DOSCODE:418A		     mov     ss:NoSetDir, al
DOSCODE:418E		     mov     ss:FAILERR, al
DOSCODE:4192		     inc     ax
DOSCODE:4193		     mov     ss:IDLEINT, al
DOSCODE:4197		     xchg    ax, bx
DOSCODE:4198		     mov     bl, ah
DOSCODE:419A		     shl     bx, 1
DOSCODE:419C		     cld
DOSCODE:419D		     or	     ah, ah
DOSCODE:419F		     jz	     short DSKROUT
DOSCODE:41A1		     cmp     ah, 59h
DOSCODE:41A4		     jz	     short DISPCALL
DOSCODE:41A6		     cmp     ah, 0Ch
DOSCODE:41A9		     ja	     short DSKROUT
DOSCODE:41AB IOROUT:
DOSCODE:41AB		     cmp     ss:ERRORMODE, 0
DOSCODE:41B1		     jnz     short DISPCALL
DOSCODE:41B3		     mov     sp, offset	PRINTER_FLAG
DOSCODE:41B6		     jmp     short DISPCALL
DOSCODE:41B8 DSKROUT:				     ; ...
DOSCODE:41B8		     mov     ss:USER_IN_AX, ax
DOSCODE:41BC		     mov     ss:EXTERR_LOCUS, 1
DOSCODE:41C2		     mov     ss:ERRORMODE, 0
DOSCODE:41C8		     mov     ss:WPERR, 0FFh
DOSCODE:41CE		     push    ax
DOSCODE:41CF		     mov     ah, 82h
DOSCODE:41D1		     int     2Ah	     ; Microsoft Networks - END	DOS CRITICAL SECTIONS 0	THROUGH	7
DOSCODE:41D3		     pop     ax
DOSCODE:41D4		     mov     ss:IDLEINT, 0
DOSCODE:41DA		     mov     sp, offset	DSKSTACK
DOSCODE:41DD		     test    ss:CNTCFLAG, 0FFh
DOSCODE:41E3		     jz	     short DISPCALL
DOSCODE:41E5		     push    ax
DOSCODE:41E6		     call    near ptr DSKSTATCHK
DOSCODE:41E9		     pop     ax
DOSCODE:41EA DISPCALL:				     ; ...
DOSCODE:41EA		     mov     bx, cs:DISPATCH[bx]
DOSCODE:41EF		     xchg    bx, ss:SAVEBX
DOSCODE:41F4		     mov     ds, ss:SAVEDS
DOSCODE:41F9		     call    ss:SAVEBX
DOSCODE:41FE		     and     ss:DOS_FLAG, 0FBh
DOSCODE:4204 LeaveDOS:				     ; ...
DOSCODE:4204		     cli
DOSCODE:4205		     mov     ds, cs:DosDSeg
DOSCODE:420A		     cmp     ds:A20OFF_COUNT, 0
DOSCODE:420F		     jnz     short disa20
DOSCODE:4211 LeaveA20On:			     ; ...
DOSCODE:4211		     dec     ds:INDOS
DOSCODE:4215		     mov     ss, ds:USER_SS
DOSCODE:4219		     mov     sp, ds:USER_SP
DOSCODE:421D		     mov     bp, sp
DOSCODE:421F		     mov     [bp+0], al
DOSCODE:4222		     mov     ax, ds:NSP
DOSCODE:4225		     mov     ds:USER_SP, ax
DOSCODE:4228		     mov     ax, ds:NSS
DOSCODE:422B		     mov     ds:USER_SS, ax
DOSCODE:422E		     pop     ax
DOSCODE:422F		     pop     bx
DOSCODE:4230		     pop     cx
DOSCODE:4231		     pop     dx
DOSCODE:4232		     pop     si
DOSCODE:4233		     pop     di
DOSCODE:4234		     pop     bp
DOSCODE:4235		     pop     ds
DOSCODE:4236		     pop     es
DOSCODE:4237		     iret
DOSCODE:4238 disa20:				     ; ...
DOSCODE:4238		     mov     bx, ds:A20OFF_PSP
DOSCODE:423C		     cmp     bx, ds:CurrentPDB
DOSCODE:4240		     jnz     short LeaveA20On
DOSCODE:4242		     dec     ds:A20OFF_COUNT
DOSCODE:4246		     push    ds
DOSCODE:4247		     mov     bx, offset	disa20_iret
DOSCODE:424A		     push    bx
DOSCODE:424B		     retf
DOSCODE:424B ; END OF FUNCTION CHUNK FOR STATCHK
DOSCODE:424C ; =============== S U B R O U T I N E =======================================
DOSCODE:424C restore_world   proc near		     ; ...
DOSCODE:424C		     mov     es, cs:DosDSeg
DOSCODE:4251		     pop     es:RESTORE_TMP
DOSCODE:4256		     pop     ax
DOSCODE:4257		     pop     bx
DOSCODE:4258		     pop     cx
DOSCODE:4259		     pop     dx
DOSCODE:425A		     pop     si
DOSCODE:425B		     pop     di
DOSCODE:425C		     pop     bp
DOSCODE:425D		     pop     ds
DOSCODE:425E		     jmp     es:RESTORE_TMP
DOSCODE:425E restore_world   endp ; sp-analysis	failed
DOSCODE:4263 ; =============== S U B R O U T I N E =======================================
DOSCODE:4263 ; Attributes: bp-based frame
DOSCODE:4263 save_world	     proc near		     ; ...
DOSCODE:4263		     mov     es, cs:DosDSeg
DOSCODE:4268		     pop     es:RESTORE_TMP
DOSCODE:426D		     push    ds
DOSCODE:426E		     push    bp
DOSCODE:426F		     push    di
DOSCODE:4270		     push    si
DOSCODE:4271		     push    dx
DOSCODE:4272		     push    cx
DOSCODE:4273		     push    bx
DOSCODE:4274		     push    ax
DOSCODE:4275		     push    es:RESTORE_TMP
DOSCODE:427A		     push    bp
DOSCODE:427B		     mov     bp, sp
DOSCODE:427D		     mov     es, word ptr [bp+20]
DOSCODE:4280		     pop     bp
DOSCODE:4281		     retn
DOSCODE:4281 save_world	     endp ; sp-analysis	failed
DOSCODE:4282 ; =============== S U B R O U T I N E =======================================
DOSCODE:4282 Get_User_Stack  proc near		     ; ...
DOSCODE:4282		     mov     ds, cs:DosDSeg
DOSCODE:4287		     lds     si, dword ptr ds:USER_SP
DOSCODE:428B		     retn
DOSCODE:428B Get_User_Stack  endp
DOSCODE:428C ERRIN	     db	2		     ; ...
DOSCODE:428D		     db	6
DOSCODE:428E		     db	12
DOSCODE:428F		     db	4
DOSCODE:4290		     db	8
DOSCODE:4291		     db	0
DOSCODE:4292 ERROUT	     db	80h
DOSCODE:4293		     db	40h
DOSCODE:4294		     db	2
DOSCODE:4295		     db	10h
DOSCODE:4296		     db	4
DOSCODE:4297		     db	3
DOSCODE:4298 ; =============== S U B R O U T I N E =======================================
DOSCODE:4298 AbsSetup	     proc near		     ; ...
DOSCODE:4298		     inc     ss:INDOS
DOSCODE:429D		     sti
DOSCODE:429E		     cld
DOSCODE:429F		     push    ds
DOSCODE:42A0		     push    ss
DOSCODE:42A1		     pop     ds
DOSCODE:42A2		     call    GETBP
DOSCODE:42A5		     jb	     short errdriv
DOSCODE:42A7		     mov     word ptr es:[bp+1Fh], 0FFFFh
DOSCODE:42AD errdriv:				     ; ...
DOSCODE:42AD		     pop     ds
DOSCODE:42AE		     jnb     short AbsSetup2
DOSCODE:42B0 AbsSetup_retn:			     ; ...
DOSCODE:42B0		     retn
DOSCODE:42B1 AbsSetup2:				     ; ...
DOSCODE:42B1		     mov     ss:HIGH_SECTOR, 0
DOSCODE:42B8		     call    RW32_CONVERT
DOSCODE:42BB		     jb	     short AbsSetup_retn
DOSCODE:42BD		     call    SET_RQ_SC_PARMS
DOSCODE:42C0		     push    ds
DOSCODE:42C1		     push    si
DOSCODE:42C2		     push    ax
DOSCODE:42C3		     push    ss
DOSCODE:42C4		     pop     ds
DOSCODE:42C5		     mov     si, offset	OPENBUF
DOSCODE:42C8		     mov     [si], al
DOSCODE:42CA		     add     byte ptr [si], 'A'
DOSCODE:42CD		     mov     word ptr [si+1], ':'
DOSCODE:42D2		     mov     ax, 300h
DOSCODE:42D5		     clc
DOSCODE:42D6		     int     2Ah	     ; Microsoft Networks - CHECK DIRECT I/O
DOSCODE:42D6					     ; DS:SI ->	ASCIZ disk device name (may be full path or only drive
DOSCODE:42D6					     ; specifier--must include the colon)
DOSCODE:42D6					     ; Return: CF clear	if absolute disk access	allowed
DOSCODE:42D8		     pop     ax
DOSCODE:42D9		     pop     si
DOSCODE:42DA		     pop     ds
DOSCODE:42DB		     jnb     short AbsSetup_retn
DOSCODE:42DD		     mov     ss:EXTERR,	32h ; '2'
DOSCODE:42E4		     retn
DOSCODE:42E4 AbsSetup	     endp
DOSCODE:42E5 ABSDRD:				     ; ...
DOSCODE:42E5		     cli
DOSCODE:42E6		     push    ax
DOSCODE:42E7		     mov     ax, ds
DOSCODE:42E9		     mov     ds, cs:DosDSeg
DOSCODE:42EE		     mov     ds:TEMPSEG, ax
DOSCODE:42F1		     pop     ax
DOSCODE:42F2		     push    es
DOSCODE:42F3		     mov     ds:AbsRdWr_SS, ss
DOSCODE:42F7		     mov     ds:AbsRdWr_SP, sp
DOSCODE:42FB		     mov     ss, cs:DosDSeg
DOSCODE:4300		     mov     sp, offset	DSKSTACK
DOSCODE:4303		     mov     ds, ds:TEMPSEG
DOSCODE:4307		     push    es
DOSCODE:4308		     call    save_world
DOSCODE:430B		     push    es
DOSCODE:430C		     call    AbsSetup
DOSCODE:430F		     jb	     short ILEAVE
DOSCODE:4311		     call    ECritDisk
DOSCODE:4314		     mov     ss:CurSC_DRIVE, 0FFh
DOSCODE:431A		     call    LCritDisk
DOSCODE:431D		     call    DSKREAD
DOSCODE:4320		     jnz     short ERR_LEAVE
DOSCODE:4322		     mov     cx, di
DOSCODE:4324		     mov     ss:TEMP_VAR2, ds
DOSCODE:4329		     mov     ss:TEMP_VAR, bx
DOSCODE:432E		     call    DskRdBufScan
DOSCODE:4331		     jmp     short ILEAVE
DOSCODE:4333 TLEAVE:				     ; ...
DOSCODE:4333		     jz	     short ILEAVE
DOSCODE:4335 ERR_LEAVE:				     ; ...
DOSCODE:4335		     push    es
DOSCODE:4336		     push    cs
DOSCODE:4337		     pop     es
DOSCODE:4338		     xor     ah, ah
DOSCODE:433A		     mov     cx, 6
DOSCODE:433D		     mov     di, offset	ERRIN
DOSCODE:4340		     repne scasb
DOSCODE:4342		     jnz     short LEAVECODE
DOSCODE:4344		     mov     ah, es:[di+5]
DOSCODE:4348 LEAVECODE:				     ; ...
DOSCODE:4348		     pop     es
DOSCODE:4349		     mov     ss:AbsDskErr, ax
DOSCODE:434D		     stc
DOSCODE:434E ILEAVE:				     ; ...
DOSCODE:434E		     pop     es
DOSCODE:434F		     call    restore_world
DOSCODE:4352		     pop     es
DOSCODE:4353		     cli
DOSCODE:4354		     mov     ax, ss:AbsDskErr
DOSCODE:4358		     dec     ss:INDOS
DOSCODE:435D		     push    ss
DOSCODE:435E		     pop     es
DOSCODE:435F		     mov     ss, es:AbsRdWr_SS
DOSCODE:4364		     mov     sp, es:AbsRdWr_SP
DOSCODE:4369		     pop     es
DOSCODE:436A		     sti
DOSCODE:436B		     retf
DOSCODE:436C ABSDWRT:				     ; ...
DOSCODE:436C		     cli
DOSCODE:436D		     push    ax
DOSCODE:436E		     mov     ax, ds
DOSCODE:4370		     mov     ds, cs:DosDSeg
DOSCODE:4375		     mov     ds:TEMPSEG, ax
DOSCODE:4378		     pop     ax
DOSCODE:4379		     push    es
DOSCODE:437A		     mov     ds:AbsRdWr_SS, ss
DOSCODE:437E		     mov     ds:AbsRdWr_SP, sp
DOSCODE:4382		     mov     ss, cs:DosDSeg
DOSCODE:4387		     mov     sp, offset	DSKSTACK
DOSCODE:438A		     mov     ds, ds:TEMPSEG
DOSCODE:438E		     push    es
DOSCODE:438F		     call    save_world
DOSCODE:4392		     push    es
DOSCODE:4393		     call    AbsSetup
DOSCODE:4396		     jb	     short ILEAVE
DOSCODE:4398		     call    ECritDisk
DOSCODE:439B		     mov     ss:CurSC_DRIVE, 0FFh
DOSCODE:43A1		     call    Fastxxx_Purge
DOSCODE:43A4		     call    LCritDisk
DOSCODE:43A7		     push    ds
DOSCODE:43A8		     call    DskWrtBufPurge
DOSCODE:43AB		     pop     ds
DOSCODE:43AC		     call    DSKWRITE
DOSCODE:43AF		     jmp     short TLEAVE
DOSCODE:43B1 ; =============== S U B R O U T I N E =======================================
DOSCODE:43B1 GETBP	     proc near		     ; ...
DOSCODE:43B1		     push    ax
DOSCODE:43B2		     add     al, 1
DOSCODE:43B4		     jb	     short SKIPGET
DOSCODE:43B6		     call    GETTHISDRV
DOSCODE:43B9		     jnb     short SKIPGET
DOSCODE:43BB		     xor     ah, ah
DOSCODE:43BD		     cmp     ax, 1Ah
DOSCODE:43C0		     jz	     short SKIPGET
DOSCODE:43C2		     stc
DOSCODE:43C3		     mov     ds:EXTERR,	ax
DOSCODE:43C6		     mov     ds:AbsDskErr, 201h
DOSCODE:43CC SKIPGET:				     ; ...
DOSCODE:43CC		     pop     ax
DOSCODE:43CD		     jnb     short GETBP_@f
DOSCODE:43CF		     retn
DOSCODE:43D0 GETBP_@f:				     ; ...
DOSCODE:43D0		     les     bp, ds:THISCDS
DOSCODE:43D4		     test    word ptr es:[bp+43h], 8000h
DOSCODE:43DA		     jz	     short GETBP_CDS
DOSCODE:43DC		     mov     ds:EXTERR,	32h ; '2'
DOSCODE:43E2		     stc
DOSCODE:43E3		     retn
DOSCODE:43E4 GETBP_CDS:				     ; ...
DOSCODE:43E4		     les     bp, es:[bp+45h]
DOSCODE:43E4 GETBP	     endp ; sp-analysis	failed
DOSCODE:43E8 ; =============== S U B R O U T I N E =======================================
DOSCODE:43E8 GOTDPB	     proc near		     ; ...
DOSCODE:43E8		     mov     word ptr ds:THISDPB, bp
DOSCODE:43EC		     mov     word ptr ds:THISDPB+2, es
DOSCODE:43F0		     retn
DOSCODE:43F0 GOTDPB	     endp
DOSCODE:43F1 ; START OF	FUNCTION CHUNK FOR $IOCTL
DOSCODE:43F1 SYS_RET_OK:			     ; ...
DOSCODE:43F1		     call    Get_User_Stack
DOSCODE:43F4		     and     word ptr [si+16h],	0FFFEh
DOSCODE:43F8		     jmp     short DO_RET
DOSCODE:43FA SYS_RET_ERR:			     ; ...
DOSCODE:43FA		     xor     ah, ah
DOSCODE:43FC		     call    ETAB_LK
DOSCODE:43FF		     call    ErrorMap
DOSCODE:4402 From_GetSet:			     ; ...
DOSCODE:4402		     call    Get_User_Stack
DOSCODE:4405		     or	     word ptr [si+16h],	1
DOSCODE:4409		     stc
DOSCODE:440A DO_RET:				     ; ...
DOSCODE:440A		     mov     [si], ax
DOSCODE:440C		     retn
DOSCODE:440C ; END OF FUNCTION CHUNK FOR $IOCTL
DOSCODE:440D NO_OP:				     ; ...
DOSCODE:440D		     xor     al, al
DOSCODE:440F		     retn
DOSCODE:4410 ; =============== S U B R O U T I N E =======================================
DOSCODE:4410 FCB_RET_ERR     proc near		     ; ...
DOSCODE:4410		     xor     ah, ah
DOSCODE:4412		     mov     ss:EXTERR,	ax
DOSCODE:4416		     call    ErrorMap
DOSCODE:4419		     mov     al, 0FFh
DOSCODE:441B		     retn
DOSCODE:441B FCB_RET_ERR     endp
DOSCODE:441C ; =============== S U B R O U T I N E =======================================
DOSCODE:441C ErrorMap	     proc near		     ; ...
DOSCODE:441C		     push    si
DOSCODE:441D		     mov     si, offset	ERR_TABLE_21
DOSCODE:4420		     cmp     ss:FAILERR, 0
DOSCODE:4426		     jz	     short EXTENDED_NORMAL
DOSCODE:4428		     mov     ss:EXTERR,	53h
DOSCODE:442F EXTENDED_NORMAL:			     ; ...
DOSCODE:442F		     call    CAL_LK
DOSCODE:4432		     pop     si
DOSCODE:4433		     retn
DOSCODE:4433 ErrorMap	     endp
DOSCODE:4434 ; =============== S U B R O U T I N E =======================================
DOSCODE:4434 CAL_LK	     proc near		     ; ...
DOSCODE:4434		     push    ds
DOSCODE:4435		     push    ax
DOSCODE:4436		     push    bx
DOSCODE:4437		     mov     ds, cs:DosDSeg
DOSCODE:443C		     mov     bx, ds:EXTERR
DOSCODE:4440 TABLK1:				     ; ...
DOSCODE:4440		     lodsb
DOSCODE:4441		     cmp     al, 0FFh
DOSCODE:4443		     jz	     short GOT_VALS
DOSCODE:4445		     cmp     al, bl
DOSCODE:4447		     jz	     short GOT_VALS
DOSCODE:4449		     add     si, 3
DOSCODE:444C		     jmp     short TABLK1
DOSCODE:444E GOT_VALS:				     ; ...
DOSCODE:444E		     lodsw
DOSCODE:444F		     cmp     ah, 0FFh
DOSCODE:4452		     jz	     short NO_SET_ACT
DOSCODE:4454		     mov     byte ptr ds:EXTERR_ACT_CLASS, ah
DOSCODE:4458 NO_SET_ACT:			     ; ...
DOSCODE:4458		     cmp     al, 0FFh
DOSCODE:445A		     jz	     short NO_SET_CLS
DOSCODE:445C		     mov     byte ptr ds:EXTERR_ACT_CLASS+1, al
DOSCODE:445F NO_SET_CLS:			     ; ...
DOSCODE:445F		     lodsb
DOSCODE:4460		     cmp     al, 0FFh
DOSCODE:4462		     jz	     short NO_SET_LOC
DOSCODE:4464		     mov     ds:EXTERR_LOCUS, al
DOSCODE:4467 NO_SET_LOC:			     ; ...
DOSCODE:4467		     pop     bx
DOSCODE:4468		     pop     ax
DOSCODE:4469		     pop     ds
DOSCODE:446A		     retn
DOSCODE:446A CAL_LK	     endp
DOSCODE:446B ; =============== S U B R O U T I N E =======================================
DOSCODE:446B ETAB_LK	     proc near		     ; ...
DOSCODE:446B		     push    ds
DOSCODE:446C		     push    si
DOSCODE:446D		     push    cx
DOSCODE:446E		     push    bx
DOSCODE:446F		     push    ss
DOSCODE:4470		     pop     ds
DOSCODE:4471		     mov     ds:EXTERR,	ax
DOSCODE:4474		     mov     si, offset	I21_MAP_E_TAB
DOSCODE:4477		     mov     bh, al
DOSCODE:4479		     mov     bl, byte ptr ds:USER_IN_AX+1
DOSCODE:447D TABLK2:				     ; ...
DOSCODE:447D		     lods    word ptr cs:[si]
DOSCODE:447F		     cmp     al, 0FFh
DOSCODE:4481		     jz	     short NOT_IN_TABLE
DOSCODE:4483		     cmp     al, bl
DOSCODE:4485		     jz	     short GOT_CALL
DOSCODE:4487		     xchg    ah, al
DOSCODE:4489		     xor     ah, ah
DOSCODE:448B		     add     si, ax
DOSCODE:448D		     jmp     short TABLK2
DOSCODE:448F NOT_IN_TABLE:			     ; ...
DOSCODE:448F		     mov     al, bh
DOSCODE:4491		     jmp     short NO_MAP
DOSCODE:4493 GOT_CALL:				     ; ...
DOSCODE:4493		     mov     cl, ah
DOSCODE:4495		     xor     ch, ch
DOSCODE:4497 CHECK_CODE:			     ; ...
DOSCODE:4497		     lods    byte ptr cs:[si]
DOSCODE:4499		     cmp     al, bh
DOSCODE:449B		     jz	     short NO_MAP
DOSCODE:449D		     loop    CHECK_CODE
DOSCODE:449F NO_MAP:				     ; ...
DOSCODE:449F		     xor     ah, ah
DOSCODE:44A1		     pop     bx
DOSCODE:44A2		     pop     cx
DOSCODE:44A3		     pop     si
DOSCODE:44A4		     pop     ds
DOSCODE:44A5		     retn
DOSCODE:44A5 ETAB_LK	     endp
DOSCODE:44A6 ; =============== S U B R O U T I N E =======================================
DOSCODE:44A6 SetBad	     proc near		     ; ...
DOSCODE:44A6		     mov     ax, 1
DOSCODE:44A9		     push    ds
DOSCODE:44AA		     mov     ds, cs:DosDSeg
DOSCODE:44AF		     mov     ds:EXTERR_LOCUS, 1
DOSCODE:44B4		     pop     ds
DOSCODE:44B5		     stc
DOSCODE:44B6		     retn
DOSCODE:44B6 SetBad	     endp
DOSCODE:44B7 ; =============== S U B R O U T I N E =======================================
DOSCODE:44B7 BadCall	     proc far		     ; ...
DOSCODE:44B7		     call    SetBad
DOSCODE:44BA		     retf
DOSCODE:44BA BadCall	     endp
DOSCODE:44BB ; =============== S U B R O U T I N E =======================================
DOSCODE:44BB OKCall	     proc far		     ; ...
DOSCODE:44BB		     clc
DOSCODE:44BC		     retf
DOSCODE:44BC OKCall	     endp
DOSCODE:44BD INT2F:				     ; ...
DOSCODE:44BD		     sti
DOSCODE:44BE		     cmp     ah, 11h	     ; MultNET
DOSCODE:44C1		     jnz     short INT2FSHR
DOSCODE:44C3 TestInstall:			     ; ...
DOSCODE:44C3		     or	     al, al
DOSCODE:44C5		     jz	     short Leave2F
DOSCODE:44C7 BadFunc:				     ; ...
DOSCODE:44C7		     call    SetBad
DOSCODE:44CA Leave2F:				     ; ...
DOSCODE:44CA		     retf    2
DOSCODE:44CD INT2FSHR:				     ; ...
DOSCODE:44CD		     cmp     ah, 10h	     ; MultSHARE
DOSCODE:44D0		     jz	     short TestInstall
DOSCODE:44D2		     cmp     ah, 14h	     ; NLSFUNC
DOSCODE:44D5		     jz	     short TestInstall
DOSCODE:44D7		     cmp     ah, 12h	     ; MultDOS
DOSCODE:44DA		     jnz     short check_win
DOSCODE:44DC		     jmp     DispatchDOS
DOSCODE:44DF check_win:				     ; ...
DOSCODE:44DF		     cmp     ah, 16h
DOSCODE:44E2		     jz	     short Win386_Msg
DOSCODE:44E4		     cmp     ah, 46h ; 'F'
DOSCODE:44E7		     jnz     short next_i2f
DOSCODE:44E9		     jmp     Winold_swap
DOSCODE:44EC next_i2f:				     ; ...
DOSCODE:44EC		     jmp     far ptr 70h:5
DOSCODE:44F1 Win386_Msg:			     ; ...
DOSCODE:44F1		     push    ds
DOSCODE:44F2		     mov     ds, cs:DosDSeg
DOSCODE:44F7		     cmp     al, 3
DOSCODE:44F9		     jnz     short Win386_Msg_exit
DOSCODE:44FB		     jmp     OldWin386Init
DOSCODE:44FE Win386_Msg_exit:			     ; ...
DOSCODE:44FE		     cmp     al, 6
DOSCODE:4500		     jnz     short Win386_Msg_devcall
DOSCODE:4502		     jmp     Win386_Leaving
DOSCODE:4505 Win386_Msg_devcall:		     ; ...
DOSCODE:4505		     cmp     al, 7
DOSCODE:4507		     jnz     short Win386_Msg_init
DOSCODE:4509		     jmp     Win386_Query
DOSCODE:450C Win386_Msg_init:			     ; ...
DOSCODE:450C		     cmp     al, 5
DOSCODE:450E		     jz	     short Win386_Starting
DOSCODE:4510		     jmp     win_nexti2f
DOSCODE:4513 Win386_Starting:			     ; ...
DOSCODE:4513		     test    dx, 1
DOSCODE:4517		     jz	     short Win386_vchk
DOSCODE:4519		     jmp     win_nexti2f
DOSCODE:451C Win386_vchk:			     ; ...
DOSCODE:451C		     mov     word ptr ds:Win386_Info_6,	0
DOSCODE:4522		     mov     word ptr ds:Win386_Info_6+2, 0
DOSCODE:4528		     cmp     di, 30Ah
DOSCODE:452C		     jb	     short Win386_vxd
DOSCODE:452E		     jmp     noVxD31
DOSCODE:4531 Win386_vxd:			     ; ...
DOSCODE:4531		     push    ax
DOSCODE:4532		     push    bx
DOSCODE:4533		     push    cx
DOSCODE:4534		     push    dx
DOSCODE:4535		     push    si
DOSCODE:4536		     push    di
DOSCODE:4537		     mov     bx, ds:UMB_HEAD
DOSCODE:453B		     cmp     bx, 0FFFFh
DOSCODE:453E		     jz	     short Vxd31
DOSCODE:4540		     mov     ds:UmbSaveFlag, 1
DOSCODE:4545		     push    ds
DOSCODE:4546		     push    es
DOSCODE:4547		     mov     ax, ds
DOSCODE:4549		     mov     es, ax
DOSCODE:454B		     mov     ds, bx
DOSCODE:454D		     xor     si, si
DOSCODE:454F		     cld
DOSCODE:4550		     mov     di, offset	UmbSave1
DOSCODE:4553		     mov     cx, 11
DOSCODE:4556		     rep movsb
DOSCODE:4558		     mov     di, offset	UmbSave2
DOSCODE:455B		     mov     cx, 5
DOSCODE:455E		     rep movsb
DOSCODE:4560		     pop     es
DOSCODE:4561		     pop     ds
DOSCODE:4562 Vxd31:				     ; ...
DOSCODE:4562		     test    ds:DOS_FLAG, 2
DOSCODE:4567		     jz	     short Dont_Supress
DOSCODE:4569		     pop     di
DOSCODE:456A		     pop     si
DOSCODE:456B		     pop     dx
DOSCODE:456C		     pop     cx
DOSCODE:456D		     pop     bx
DOSCODE:456E		     pop     ax
DOSCODE:456F		     jmp     short noVxD31
DOSCODE:4571 Dont_Supress:			     ; ...
DOSCODE:4571		     mov     al, ds:BOOTDRIVE
DOSCODE:4574		     add     al, 40h	     ; 'A'-1
DOSCODE:4576		     mov     byte ptr ds:VxDpath, al ; "c:\\wina20.386"
DOSCODE:4579		     mov     ah, 6Ch
DOSCODE:457B		     mov     al, 0
DOSCODE:457D		     mov     bx, 2080h
DOSCODE:4580		     mov     cx, 7
DOSCODE:4583		     mov     dx, 1
DOSCODE:4586		     mov     si, offset	VxDpath	; "c:\\wina20.386"
DOSCODE:4589		     mov     di, 0FFFFh
DOSCODE:458C		     int     21h	     ; DOS - 4.0 - EXTENDED OPEN/CREATE
DOSCODE:458C					     ; BL = open mode as in AL for normal open (INT 21h/AH=3Dh)
DOSCODE:458C					     ; BH = flags, CX =	create attribute, DL = action if file exists/does not exists
DOSCODE:458C					     ; DH = 00h	(reserved), DS:SI -> ASCIZ file	name
DOSCODE:458E		     pop     di
DOSCODE:458F		     pop     si
DOSCODE:4590		     pop     dx
DOSCODE:4591		     pop     cx
DOSCODE:4592		     jnb     short VxDthere
DOSCODE:4594		     push    dx
DOSCODE:4595		     push    ds
DOSCODE:4596		     push    si
DOSCODE:4597		     mov     si, offset	NoVxDErrMsg ; "You must	have the file WINA20.386 in th"...
DOSCODE:459A		     push    cs
DOSCODE:459B		     pop     ds
DOSCODE:459C		     mov     cx, 99
DOSCODE:459F		     mov     ah, 2
DOSCODE:45A1		     cld
DOSCODE:45A2 vxdlp:				     ; ...
DOSCODE:45A2		     lodsb
DOSCODE:45A3		     xchg    dl, al
DOSCODE:45A5		     int     21h	     ; DOS -
DOSCODE:45A7		     loop    vxdlp
DOSCODE:45A9		     pop     si
DOSCODE:45AA		     pop     ds
DOSCODE:45AB		     pop     dx
DOSCODE:45AC		     pop     bx
DOSCODE:45AD		     pop     ax
DOSCODE:45AE		     inc     cx
DOSCODE:45AF		     jmp     win_nexti2f
DOSCODE:45B2 VxDthere:				     ; ...
DOSCODE:45B2		     mov     bx, ax
DOSCODE:45B4		     mov     ah, 3Eh
DOSCODE:45B6		     int     21h	     ; DOS - 2+	- CLOSE	A FILE WITH HANDLE
DOSCODE:45B6					     ; BX = file handle
DOSCODE:45B8		     mov     bx, offset	Win386_Info
DOSCODE:45BB		     mov     word ptr [bx+6], offset VxDpath ; "c:\\wina20.386"
DOSCODE:45C0		     mov     word ptr [bx+8], ds
DOSCODE:45C3		     pop     bx
DOSCODE:45C4		     pop     ax
DOSCODE:45C5 noVxD31:				     ; ...
DOSCODE:45C5		     or	     ds:IsWin386, 1
DOSCODE:45CA		     or	     ds:redir_patch, 1
DOSCODE:45CF		     push    dx
DOSCODE:45D0		     mov     dx, bx
DOSCODE:45D2		     mov     bx, offset	Win386_Info
DOSCODE:45D5		     mov     [bx+2], dx
DOSCODE:45D8		     mov     word ptr [bx+4], es
DOSCODE:45DB		     pop     dx
DOSCODE:45DC		     push    ds
DOSCODE:45DD		     pop     es
DOSCODE:45DE		     jmp     win_nexti2f
DOSCODE:45E1 Win386_Leaving:			     ; ...
DOSCODE:45E1		     test    dx, 1
DOSCODE:45E5		     jz	     short Win386_Leaving_c
DOSCODE:45E7		     jmp     win_nexti2f
DOSCODE:45EA Win386_Leaving_c:			     ; ...
DOSCODE:45EA		     cmp     ds:UmbSaveFlag, 1
DOSCODE:45EF		     jnz     short noumb
DOSCODE:45F1		     mov     ds:UmbSaveFlag, 0
DOSCODE:45F6		     push    ax
DOSCODE:45F7		     push    es
DOSCODE:45F8		     push    cx
DOSCODE:45F9		     push    si
DOSCODE:45FA		     push    di
DOSCODE:45FB		     mov     ax, ds:UMB_HEAD
DOSCODE:45FE		     mov     es, ax
DOSCODE:4600		     xor     di, di
DOSCODE:4602		     cld
DOSCODE:4603		     mov     si, offset	UmbSave1
DOSCODE:4606		     mov     cx, 11
DOSCODE:4609		     rep movsb
DOSCODE:460B		     mov     si, offset	UmbSave2
DOSCODE:460E		     mov     cx, 5
DOSCODE:4611		     rep movsb
DOSCODE:4613		     pop     di
DOSCODE:4614		     pop     si
DOSCODE:4615		     pop     cx
DOSCODE:4616		     pop     es
DOSCODE:4617		     pop     ax
DOSCODE:4618 noumb:				     ; ...
DOSCODE:4618		     and     ds:IsWin386, 0
DOSCODE:461D		     and     ds:redir_patch, 0
DOSCODE:4622		     jmp     short win_nexti2f
DOSCODE:4624 Win386_Query:			     ; ...
DOSCODE:4624		     cmp     bx, 15h	     ; Win386_DOSMGR
DOSCODE:4627		     jnz     short win_nexti2f
DOSCODE:4629		     or	     cx, cx
DOSCODE:462B		     jnz     short dosmgr_func
DOSCODE:462D		     inc     cx
DOSCODE:462E		     mov     bx, offset	Win386_DOSVars
DOSCODE:4631		     push    ds
DOSCODE:4632		     pop     es
DOSCODE:4633		     jmp     short PopIret
DOSCODE:4635 OldWin386Init:			     ; ...
DOSCODE:4635		     pop     ax
DOSCODE:4636		     mov     si, offset	OldInstanceJunk
DOSCODE:4639		     mov     ax, 5248h
DOSCODE:463C		     jmp     next_i2f
DOSCODE:463F dosmgr_func:			     ; ...
DOSCODE:463F		     dec     cx
DOSCODE:4640		     jz	     short win386_patch
DOSCODE:4642		     dec     cx
DOSCODE:4643		     jz	     short PopIret
DOSCODE:4645		     dec     cx
DOSCODE:4646		     jz	     short win386_size
DOSCODE:4648		     dec     cx
DOSCODE:4649		     jz	     short win386_inst
DOSCODE:464B		     dec     cx
DOSCODE:464C		     jnz     short PopIret
DOSCODE:464E		     mov     ax, es
DOSCODE:4650		     dec     ax
DOSCODE:4651		     push    es
DOSCODE:4652		     mov     es, ax
DOSCODE:4654		     cmp     byte ptr es:[di], 'D'
DOSCODE:4658		     jnz     short cantsize
DOSCODE:465A		     inc     ax
DOSCODE:465B		     cmp     es:[di+1],	ax
DOSCODE:465F		     jnz     short cantsize
DOSCODE:4661		     mov     ax, es:[di+3]
DOSCODE:4665		     pop     es
DOSCODE:4666		     mov     bx, 16
DOSCODE:4669		     mul     bx
DOSCODE:466B		     mov     cx, ax
DOSCODE:466D		     mov     bx, dx
DOSCODE:466F		     jmp     short win386_done
DOSCODE:4671 cantsize:				     ; ...
DOSCODE:4671		     pop     es
DOSCODE:4672		     xor     ax, ax
DOSCODE:4674		     xor     dx, dx
DOSCODE:4676		     jmp     short PopIret
DOSCODE:4678 win386_patch:			     ; ...
DOSCODE:4678		     mov     bx, dx
DOSCODE:467A		     jmp     short win386_done
DOSCODE:467C win386_size:			     ; ...
DOSCODE:467C		     test    dx, 1
DOSCODE:4680		     jz	     short PopIret
DOSCODE:4682		     mov     cx, 88
DOSCODE:4685		     jmp     short win386_done
DOSCODE:4687 win386_inst:			     ; ...
DOSCODE:4687		     xor     dx, dx
DOSCODE:4689		     jmp     short PopIret
DOSCODE:468B win386_done:			     ; ...
DOSCODE:468B		     mov     ax, 0B97Ch	     ; WIN_OP_DONE
DOSCODE:468E		     mov     dx, 0A2ABh	     ; DOSMGR_OP_DONE
DOSCODE:4691 PopIret:				     ; ...
DOSCODE:4691		     pop     ds
DOSCODE:4692		     iret
DOSCODE:4693 win_nexti2f:			     ; ...
DOSCODE:4693		     pop     ds
DOSCODE:4694		     jmp     next_i2f
DOSCODE:4697 ; =============== S U B R O U T I N E =======================================
DOSCODE:4697 getwinlast	     proc near		     ; ...
DOSCODE:4697		     mov     si, ds:CurrentPDB
DOSCODE:469B		     dec     si
DOSCODE:469C		     mov     es, si
DOSCODE:469E		     add     si, es:3
DOSCODE:46A3		     retn
DOSCODE:46A3 getwinlast	     endp
DOSCODE:46A4 Winold_swap:			     ; ...
DOSCODE:46A4		     push    ds
DOSCODE:46A5		     push    es
DOSCODE:46A6		     push    si
DOSCODE:46A7		     push    di
DOSCODE:46A8		     push    cx
DOSCODE:46A9		     mov     ds, cs:DosDSeg
DOSCODE:46AE		     cmp     al, 1
DOSCODE:46B0		     jnz     short swapin
DOSCODE:46B2		     call    getwinlast
DOSCODE:46B5		     push    ds
DOSCODE:46B6		     pop     es
DOSCODE:46B7		     mov     ds, si
DOSCODE:46B9		     xor     si, si
DOSCODE:46BB		     mov     di, offset	WinoldPatch1
DOSCODE:46BE		     mov     cx, 8
DOSCODE:46C1		     cld
DOSCODE:46C2		     push    cx
DOSCODE:46C3		     rep movsb
DOSCODE:46C5		     pop     cx
DOSCODE:46C6		     mov     di, offset	WinoldPatch2
DOSCODE:46C9		     rep movsb
DOSCODE:46CB		     jmp     short winold_done
DOSCODE:46CD swapin:				     ; ...
DOSCODE:46CD		     cmp     al, 2
DOSCODE:46CF		     jnz     short winold_done
DOSCODE:46D1		     call    getwinlast
DOSCODE:46D4		     mov     es, si
DOSCODE:46D6		     xor     di, di
DOSCODE:46D8		     mov     si, offset	WinoldPatch1
DOSCODE:46DB		     mov     cx, 8
DOSCODE:46DE		     cld
DOSCODE:46DF		     push    cx
DOSCODE:46E0		     rep movsb
DOSCODE:46E2		     pop     cx
DOSCODE:46E3		     mov     si, offset	WinoldPatch2
DOSCODE:46E6		     rep movsb
DOSCODE:46E8 winold_done:			     ; ...
DOSCODE:46E8		     pop     cx
DOSCODE:46E9		     pop     di
DOSCODE:46EA		     pop     si
DOSCODE:46EB		     pop     es
DOSCODE:46EC		     pop     ds
DOSCODE:46ED		     jmp     next_i2f
DOSCODE:46F0 DispatchDOS:			     ; ...
DOSCODE:46F0		     push    cs:FOO
DOSCODE:46F5		     push    cs:DTab
DOSCODE:46FA		     push    ax
DOSCODE:46FB		     push    bp
DOSCODE:46FC		     mov     bp, sp
DOSCODE:46FE		     mov     ax, [bp+0Eh]
DOSCODE:4701		     pop     bp
DOSCODE:4702		     call    TableDispatch
DOSCODE:4705		     jmp     BadFunc
DOSCODE:4708 DOSGetGroup:			     ; ...
DOSCODE:4708		     mov     ds, cs:DosDSeg
DOSCODE:470D		     retn
DOSCODE:470E DOSInstall:			     ; ...
DOSCODE:470E		     mov     al, 0FFh
DOSCODE:4710		     retn
DOSCODE:4711 ; =============== S U B R O U T I N E =======================================
DOSCODE:4711 RW32_CONVERT    proc near		     ; ...
DOSCODE:4711		     cmp     cx, 0FFFFh
DOSCODE:4714		     jz	     short new32format
DOSCODE:4716		     push    ax
DOSCODE:4717		     push    dx
DOSCODE:4718		     mov     ax, es:[bp+0Dh]
DOSCODE:471C		     mov     dl, es:[bp+4]
DOSCODE:4720		     cmp     dl, 0FEh ;	'þ'
DOSCODE:4723		     jz	     short letold
DOSCODE:4725		     inc     dl
DOSCODE:4727		     xor     dh, dh
DOSCODE:4729		     mul     dx
DOSCODE:472B		     or	     dx, dx
DOSCODE:472D letold:				     ; ...
DOSCODE:472D		     pop     dx
DOSCODE:472E		     pop     ax
DOSCODE:472F		     jz	     short old_style
DOSCODE:4731		     push    ds
DOSCODE:4732		     mov     ds, cs:DosDSeg
DOSCODE:4737		     mov     ds:AbsDskErr, 207h
DOSCODE:473D		     pop     ds
DOSCODE:473E		     stc
DOSCODE:473F		     retn
DOSCODE:4740 new32format:			     ; ...
DOSCODE:4740		     mov     dx, [bx+2]
DOSCODE:4743		     push    ds
DOSCODE:4744		     mov     ds, cs:DosDSeg
DOSCODE:4749		     mov     ds:HIGH_SECTOR, dx
DOSCODE:474D		     pop     ds
DOSCODE:474E		     mov     dx, [bx]
DOSCODE:4750		     mov     cx, [bx+4]
DOSCODE:4753		     lds     bx, [bx+6]
DOSCODE:4756 old_style:				     ; ...
DOSCODE:4756		     clc
DOSCODE:4757		     retn
DOSCODE:4757 RW32_CONVERT    endp
DOSCODE:4758 ; =============== S U B R O U T I N E =======================================
DOSCODE:4758 Fastxxx_Purge   proc near		     ; ...
DOSCODE:4758		     push    ax
DOSCODE:4759		     push    si
DOSCODE:475A		     push    dx
DOSCODE:475B		     push    ds
DOSCODE:475C		     mov     ds, cs:DosDSeg
DOSCODE:4761		     test    ds:FastOpenFlg, 80h
DOSCODE:4766		     pop     ds
DOSCODE:4767		     jz	     short nofast
DOSCODE:4769		     mov     ah, 1
DOSCODE:476B		     mov     al, 5
DOSCODE:476D		     mov     dl, es:[bp+0]
DOSCODE:4771		     call    Fast_Dispatch
DOSCODE:4774 nofast:				     ; ...
DOSCODE:4774		     pop     dx
DOSCODE:4775		     pop     si
DOSCODE:4776		     pop     ax
DOSCODE:4777		     retn
DOSCODE:4777 Fastxxx_Purge   endp
DOSCODE:4778 DIVMES	     db	0Dh,0Ah		     ; ...
DOSCODE:4778		     db	'Divide overflow',0Dh,0Ah
DOSCODE:478B DivMesLen	     dw	19		     ; ...
DOSCODE:478D NoVxDErrMsg     db	'You must have the file WINA20.386 in the root of your boot drive',0Dh ; ...
DOSCODE:478D		     db	0Ah
DOSCODE:478D		     db	'to run Windows in Enhanced Mode',0Dh,0Ah
DOSCODE:47F0 NLS_YES	     db	'Y'                  ; ...
DOSCODE:47F1 NLS_NO	     db	'N'                  ; ...
DOSCODE:47F2 NLS_yes2	     db	'y'                  ; ...
DOSCODE:47F3 NLS_no2	     db	'n'                  ; ...
DOSCODE:47F4 CANCHAR	     db	1Bh		     ; ...
DOSCODE:47F5 ESCCHAR	     db	0		     ; ...
DOSCODE:47F6 ESCTAB	     db	64, 77,	59, 83,	60, 62,	2 dup(61), 63, 75, 2 dup(82) ; ...
DOSCODE:47F6		     db	2 dup(65)
DOSCODE:4804 ESCFUNC	     dw	offset GETCH	     ; ...
DOSCODE:4806		     dw	offset TWOESC
DOSCODE:4808		     dw	offset EXITINS_ENTERINS
DOSCODE:480A		     dw	offset EXITINS_ENTERINS
DOSCODE:480C		     dw	offset BACKSP
DOSCODE:480E		     dw	offset REEDIT
DOSCODE:4810		     dw	offset KILNEW
DOSCODE:4812		     dw	offset COPYLIN
DOSCODE:4814		     dw	offset SKIPSTR
DOSCODE:4816		     dw	offset COPYSTR
DOSCODE:4818		     dw	offset SKIPONE
DOSCODE:481A		     dw	offset COPYONE
DOSCODE:481C		     dw	offset COPYONE
DOSCODE:481E		     dw	offset CTRLZ
DOSCODE:4820 ; START OF	FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
DOSCODE:4820 OEMFunctionKey:			     ; ...
DOSCODE:4820		     call    $STD_CON_INPUT_NO_ECHO
DOSCODE:4823		     mov     cl, 14
DOSCODE:4825		     push    di
DOSCODE:4826		     mov     di, offset	ESCTAB
DOSCODE:4829		     push    es
DOSCODE:482A		     push    cs
DOSCODE:482B		     pop     es
DOSCODE:482C		     repne scasb
DOSCODE:482E		     pop     es
DOSCODE:482F		     pop     di
DOSCODE:4830		     shl     cx, 1
DOSCODE:4832		     mov     bp, cx
DOSCODE:4834		     jmp     cs:ESCFUNC[bp]
DOSCODE:4834 ; END OF FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
DOSCODE:4839 $GET_DATE:				     ; ...
DOSCODE:4839		     push    ss
DOSCODE:483A		     pop     ds
DOSCODE:483B		     call    READTIME
DOSCODE:483E		     mov     ax, ds:YEAR
DOSCODE:4841		     mov     bx, word ptr ds:DAY
DOSCODE:4845		     call    Get_User_Stack
DOSCODE:4848		     mov     [si+6], bx
DOSCODE:484B		     add     ax, 1980
DOSCODE:484E		     mov     [si+4], ax
DOSCODE:4851		     mov     al, ss:WEEKDAY
DOSCODE:4855 _RET24:				     ; ...
DOSCODE:4855		     retn
DOSCODE:4856 $SET_DATE:				     ; ...
DOSCODE:4856		     mov     al, -1
DOSCODE:4858		     sub     cx, 1980
DOSCODE:485C		     jb	     short _RET24
DOSCODE:485E		     cmp     cx, 119
DOSCODE:4861		     ja	     short RET24
DOSCODE:4863		     or	     dh, dh
DOSCODE:4865		     jz	     short _RET24
DOSCODE:4867		     or	     dl, dl
DOSCODE:4869		     jz	     short _RET24
DOSCODE:486B		     cmp     dh, 12
DOSCODE:486E		     ja	     short RET24
DOSCODE:4870		     push    ss
DOSCODE:4871		     pop     ds
DOSCODE:4872		     call    DODATE
DOSCODE:4875 RET24:				     ; ...
DOSCODE:4875		     retn
DOSCODE:4876 $GET_TIME:				     ; ...
DOSCODE:4876		     push    ss
DOSCODE:4877		     pop     ds
DOSCODE:4878		     call    READTIME
DOSCODE:487B		     call    Get_User_Stack
DOSCODE:487E		     mov     [si+6], dx
DOSCODE:4881		     mov     [si+4], cx
DOSCODE:4884		     xor     al, al
DOSCODE:4886 RET26:				     ; ...
DOSCODE:4886		     retn
DOSCODE:4887 $SET_TIME:				     ; ...
DOSCODE:4887		     mov     al, -1
DOSCODE:4889		     cmp     ch, 24
DOSCODE:488C		     jnb     short RET26
DOSCODE:488E		     cmp     cl, 60
DOSCODE:4891		     jnb     short RET26
DOSCODE:4893		     cmp     dh, 60
DOSCODE:4896		     jnb     short RET26
DOSCODE:4898		     cmp     dl, 100
DOSCODE:489B		     jnb     short RET26
DOSCODE:489D		     push    cx
DOSCODE:489E		     push    dx
DOSCODE:489F		     push    ss
DOSCODE:48A0		     pop     ds
DOSCODE:48A1		     mov     bx, offset	TIMEBUF
DOSCODE:48A4		     mov     cx, 6
DOSCODE:48A7		     xor     dx, dx
DOSCODE:48A9		     mov     ax, dx
DOSCODE:48AB		     push    bx
DOSCODE:48AC		     call    SETREAD
DOSCODE:48AF		     push    ds
DOSCODE:48B0		     lds     si, ds:BCLOCK
DOSCODE:48B4		     call    DEVIOCALL2
DOSCODE:48B7		     pop     ds
DOSCODE:48B8		     pop     bx
DOSCODE:48B9		     call    SETWRITE
DOSCODE:48BC		     pop     ds:TIMEBUF+4
DOSCODE:48C0		     pop     ds:TIMEBUF+2
DOSCODE:48C4		     lds     si, ds:BCLOCK
DOSCODE:48C8		     call    DEVIOCALL2
DOSCODE:48CB		     xor     al, al
DOSCODE:48CD		     retn
DOSCODE:48CE ; =============== S U B R O U T I N E =======================================
DOSCODE:48CE DATE16	     proc near		     ; ...
DOSCODE:48CE		     mov     ds, cs:DosDSeg
DOSCODE:48D3		     push    cx
DOSCODE:48D4		     push    es
DOSCODE:48D5		     call    READTIME
DOSCODE:48D8		     pop     es
DOSCODE:48D9		     shl     cl, 1
DOSCODE:48DB		     shl     cl, 1
DOSCODE:48DD		     shl     cx, 1
DOSCODE:48DF		     shl     cx, 1
DOSCODE:48E1		     shl     cx, 1
DOSCODE:48E3		     shr     dh, 1
DOSCODE:48E5		     or	     cl, dh
DOSCODE:48E7		     mov     dx, cx
DOSCODE:48E9		     mov     ax, word ptr ds:MONTH
DOSCODE:48EC		     mov     cl, 4
DOSCODE:48EE		     shl     al, cl
DOSCODE:48F0		     shl     ax, 1
DOSCODE:48F2		     pop     cx
DOSCODE:48F3		     or	     al, ds:DAY
DOSCODE:48F7 RET21:				     ; ...
DOSCODE:48F7		     retn
DOSCODE:48F7 DATE16	     endp
DOSCODE:48F8 ; =============== S U B R O U T I N E =======================================
DOSCODE:48F8 READTIME	     proc near		     ; ...
DOSCODE:48F8		     mov     ds:DATE_FLAG, 0
DOSCODE:48FE		     push    si
DOSCODE:48FF		     push    bx
DOSCODE:4900		     mov     bx, offset	TIMEBUF
DOSCODE:4903		     mov     cx, 6
DOSCODE:4906		     xor     dx, dx
DOSCODE:4908		     mov     ax, dx
DOSCODE:490A		     call    SETREAD
DOSCODE:490D		     push    ds
DOSCODE:490E		     lds     si, ds:BCLOCK
DOSCODE:4912		     call    DEVIOCALL2
DOSCODE:4915		     pop     ds
DOSCODE:4916		     pop     bx
DOSCODE:4917		     pop     si
DOSCODE:4918		     mov     ax, ds:TIMEBUF
DOSCODE:491B		     mov     cx, ds:TIMEBUF+2
DOSCODE:491F		     mov     dx, ds:TIMEBUF+4
DOSCODE:4923		     cmp     ax, ds:DAYCNT
DOSCODE:4927		     jz	     short RET21
DOSCODE:4929		     cmp     ax, 43830	     ; FOURYEARS*30
DOSCODE:492C		     jnb     short RET22
DOSCODE:492E		     mov     ds:DAYCNT,	ax
DOSCODE:4931		     push    si
DOSCODE:4932		     push    cx
DOSCODE:4933		     push    dx
DOSCODE:4934		     xor     dx, dx
DOSCODE:4936		     mov     cx, 1461	     ; FOURYEARS
DOSCODE:4939		     div     cx
DOSCODE:493B		     shl     ax, 1
DOSCODE:493D		     shl     ax, 1
DOSCODE:493F		     shl     ax, 1
DOSCODE:4941		     mov     cx, ax
DOSCODE:4943		     mov     si, offset	YRTAB
DOSCODE:4946		     call    DSLIDE
DOSCODE:4949		     shr     cx, 1
DOSCODE:494B		     jnb     short SK
DOSCODE:494D		     add     dx, 200
DOSCODE:4951 SK:				     ; ...
DOSCODE:4951		     call    SETYEAR
DOSCODE:4954		     mov     cl, 1
DOSCODE:4956		     mov     si, offset	MONTAB
DOSCODE:4959		     call    DSLIDE
DOSCODE:495C		     mov     ds:MONTH, cl
DOSCODE:4960		     inc     dx
DOSCODE:4961		     mov     ds:DAY, dl
DOSCODE:4965		     call    WKDAY
DOSCODE:4968		     pop     dx
DOSCODE:4969		     pop     cx
DOSCODE:496A		     pop     si
DOSCODE:496B RET22:				     ; ...
DOSCODE:496B		     retn
DOSCODE:496B READTIME	     endp
DOSCODE:496C ; =============== S U B R O U T I N E =======================================
DOSCODE:496C DSLIDE	     proc near		     ; ...
DOSCODE:496C		     mov     ah, 0
DOSCODE:496E DSLIDE1:				     ; ...
DOSCODE:496E		     lodsb
DOSCODE:496F		     cmp     dx, ax
DOSCODE:4971		     jb	     short RET22
DOSCODE:4973		     sub     dx, ax
DOSCODE:4975		     inc     cx
DOSCODE:4976		     jmp     short DSLIDE1
DOSCODE:4976 DSLIDE	     endp
DOSCODE:4978 ; =============== S U B R O U T I N E =======================================
DOSCODE:4978 SETYEAR	     proc near		     ; ...
DOSCODE:4978		     mov     ds, cs:DosDSeg
DOSCODE:497D		     mov     byte ptr ds:YEAR, cl
DOSCODE:4981 CHKYR:				     ; ...
DOSCODE:4981		     test    cl, 3
DOSCODE:4984		     mov     al, 28
DOSCODE:4986		     jnz     short SAVFEB
DOSCODE:4988		     inc     al
DOSCODE:498A SAVFEB:				     ; ...
DOSCODE:498A		     mov     ds:february, al
DOSCODE:498D RET23:				     ; ...
DOSCODE:498D		     retn
DOSCODE:498D SETYEAR	     endp
DOSCODE:498E ; =============== S U B R O U T I N E =======================================
DOSCODE:498E DODATE	     proc near		     ; ...
DOSCODE:498E		     call    CHKYR
DOSCODE:4991		     mov     al, dh
DOSCODE:4993		     mov     bx, (offset YRTAB+7) ; MONTAB-1
DOSCODE:4996		     xlat
DOSCODE:4997		     cmp     al, dl
DOSCODE:4999		     mov     al, -1
DOSCODE:499B		     jb	     short RET23
DOSCODE:499D		     call    SETYEAR
DOSCODE:49A0		     mov     word ptr ds:DAY, dx
DOSCODE:49A4		     shr     cx, 1
DOSCODE:49A6		     shr     cx, 1
DOSCODE:49A8		     mov     ax, 1461
DOSCODE:49AB		     mov     bx, dx
DOSCODE:49AD		     mul     cx
DOSCODE:49AF		     mov     cl, byte ptr ds:YEAR
DOSCODE:49B3		     and     cl, 3
DOSCODE:49B6		     mov     si, offset	YRTAB
DOSCODE:49B9		     mov     dx, ax
DOSCODE:49BB		     shl     cx, 1
DOSCODE:49BD		     call    DSUM
DOSCODE:49C0		     mov     cl, bh
DOSCODE:49C2		     mov     si, offset	MONTAB
DOSCODE:49C5		     dec     cx
DOSCODE:49C6		     call    DSUM
DOSCODE:49C9		     mov     cl, bl
DOSCODE:49CB		     dec     cx
DOSCODE:49CC		     add     dx, cx
DOSCODE:49CE		     xchg    ax, dx
DOSCODE:49CF		     mov     ds:DAYCNT,	ax
DOSCODE:49D2		     push    si
DOSCODE:49D3		     push    bx
DOSCODE:49D4		     push    ax
DOSCODE:49D5		     mov     bx, offset	TIMEBUF
DOSCODE:49D8		     mov     cx, 6
DOSCODE:49DB		     xor     dx, dx
DOSCODE:49DD		     mov     ax, dx
DOSCODE:49DF		     push    bx
DOSCODE:49E0		     call    SETREAD
DOSCODE:49E3		     push    ds
DOSCODE:49E4		     lds     si, ds:BCLOCK
DOSCODE:49E8		     call    DEVIOCALL2
DOSCODE:49EB		     pop     ds
DOSCODE:49EC		     pop     bx
DOSCODE:49ED		     call    SETWRITE
DOSCODE:49F0		     pop     ds:TIMEBUF
DOSCODE:49F4		     push    ds
DOSCODE:49F5		     lds     si, ds:BCLOCK
DOSCODE:49F9		     call    DEVIOCALL2
DOSCODE:49FC		     pop     ds
DOSCODE:49FD		     pop     bx
DOSCODE:49FE		     pop     si
DOSCODE:49FF WKDAY:				     ; ...
DOSCODE:49FF		     mov     ax, ds:DAYCNT
DOSCODE:4A02		     xor     dx, dx
DOSCODE:4A04		     mov     cx, 7
DOSCODE:4A07		     inc     ax
DOSCODE:4A08		     inc     ax
DOSCODE:4A09		     div     cx
DOSCODE:4A0B		     mov     ds:WEEKDAY, dl
DOSCODE:4A0F		     xor     al, al
DOSCODE:4A11		     retn
DOSCODE:4A11 DODATE	     endp
DOSCODE:4A12 ; =============== S U B R O U T I N E =======================================
DOSCODE:4A12 DSUM	     proc near		     ; ...
DOSCODE:4A12		     mov     ah, 0
DOSCODE:4A14		     jcxz    short DSUM9
DOSCODE:4A16 DSUM1:				     ; ...
DOSCODE:4A16		     lodsb
DOSCODE:4A17		     add     dx, ax
DOSCODE:4A19		     loop    DSUM1
DOSCODE:4A1B DSUM9:				     ; ...
DOSCODE:4A1B		     retn
DOSCODE:4A1B DSUM	     endp
DOSCODE:4A1C $GET_VERSION:			     ; ...
DOSCODE:4A1C		     push    ss
DOSCODE:4A1D		     pop     ds
DOSCODE:4A1E		     mov     bx, word ptr ds:USERNUM_hb
DOSCODE:4A22		     mov     cx, ds:USERNUM
DOSCODE:4A26		     cmp     al, 1
DOSCODE:4A28		     jnz     short norm_vers
DOSCODE:4A2A		     xor     bh, bh
DOSCODE:4A2C norm_vers:				     ; ...
DOSCODE:4A2C		     push    ds
DOSCODE:4A2D		     mov     ds, ds:CurrentPDB
DOSCODE:4A31		     mov     ax, ds:40h	     ; PDB.Version
DOSCODE:4A34		     pop     ds
DOSCODE:4A35		     call    Get_User_Stack
DOSCODE:4A38		     mov     [si], ax
DOSCODE:4A3A		     mov     [si+2], bx
DOSCODE:4A3D		     mov     [si+4], cx
DOSCODE:4A40		     retn
DOSCODE:4A41 $GET_VERIFY_ON_WRITE:		     ; ...
DOSCODE:4A41		     mov     al, ss:VERFLG
DOSCODE:4A45		     retn
DOSCODE:4A46 $SET_VERIFY_ON_WRITE:		     ; ...
DOSCODE:4A46		     and     al, 1
DOSCODE:4A48		     mov     ss:VERFLG,	al
DOSCODE:4A4C ; =============== S U B R O U T I N E =======================================
DOSCODE:4A4C RET27	     proc near		     ; ...
DOSCODE:4A4C		     retn
DOSCODE:4A4C RET27	     endp
DOSCODE:4A4D $INTERNATIONAL:			     ; ...
DOSCODE:4A4D		     cmp     al, 0FFh
DOSCODE:4A4F		     jz	     short BX_HAS_CODE
DOSCODE:4A51		     mov     bl, al
DOSCODE:4A53		     xor     bh, bh
DOSCODE:4A55 BX_HAS_CODE:			     ; ...
DOSCODE:4A55		     push    ds
DOSCODE:4A56		     pop     es
DOSCODE:4A57		     push    dx
DOSCODE:4A58		     pop     di
DOSCODE:4A59		     push    ss
DOSCODE:4A5A		     pop     ds
DOSCODE:4A5B		     cmp     di, 0FFFFh
DOSCODE:4A5E		     jz	     short international_set
DOSCODE:4A60		     or	     bx, bx
DOSCODE:4A62		     jnz     short international_find
DOSCODE:4A64		     mov     si, offset	COUNTRY_CDPG
DOSCODE:4A67		     jmp     short international_copy
DOSCODE:4A69 international_find:		     ; ...
DOSCODE:4A69		     mov     bp, 0
DOSCODE:4A6C		     call    international_get
DOSCODE:4A6F		     jb	     short errtn
DOSCODE:4A71		     cmp     bx, 0
DOSCODE:4A74		     jnz     short international_copy
DOSCODE:4A76		     mov     bx, dx
DOSCODE:4A78		     jmp     short international_ok3
DOSCODE:4A7A ; =============== S U B R O U T I N E =======================================
DOSCODE:4A7A international_get proc near	     ; ...
DOSCODE:4A7A		     mov     si, offset	COUNTRY_CDPG
DOSCODE:4A7D		     cmp     bx, ss:[si+68h]
DOSCODE:4A81		     jz	     short RET27
DOSCODE:4A83		     mov     dx, bx
DOSCODE:4A85		     xor     bx, bx
DOSCODE:4A87		     mov     ax, 1400h
DOSCODE:4A8A		     int     2Fh	     ; - Multiplex - NLSFUNC.COM - INSTALLATION	CHECK
DOSCODE:4A8A					     ; Return: AL = 00h	not installed, OK to install
DOSCODE:4A8A					     ; 01h not installed, not OK
DOSCODE:4A8A					     ; FFh installed
DOSCODE:4A8C		     cmp     al, 0FFh
DOSCODE:4A8E		     jnz     short interr
DOSCODE:4A90		     or	     bp, bp
DOSCODE:4A92		     jnz     short stcdpg
DOSCODE:4A94		     mov     ax, 1404h
DOSCODE:4A97		     int     2Fh	     ; - Multiplex - NLSFUNC.COM - GET COUNTRY INFO
DOSCODE:4A97					     ; BX = code page, DX = country code, DS:SI	-> internal code page structure
DOSCODE:4A97					     ; ES:DI ->	user buffer
DOSCODE:4A97					     ; Return: AL = status
DOSCODE:4A99		     jmp     short chkok
DOSCODE:4A9B stcdpg:				     ; ...
DOSCODE:4A9B		     mov     ax, 1403h
DOSCODE:4A9E		     int     2Fh	     ; - Multiplex - NLSFUNC.COM - SET COUNTRY INFO
DOSCODE:4A9E					     ; DS:SI ->	internal code page structure
DOSCODE:4A9E					     ; BX = code page, DX = country code
DOSCODE:4A9E					     ; Return: AL = status
DOSCODE:4AA0 chkok:				     ; ...
DOSCODE:4AA0		     or	     al, al
DOSCODE:4AA2		     jz	     short RET27
DOSCODE:4AA4 setcarry:				     ; ...
DOSCODE:4AA4		     stc
DOSCODE:4AA5		     retn
DOSCODE:4AA6 interr:				     ; ...
DOSCODE:4AA6		     mov     al, 0FFh
DOSCODE:4AA8		     jmp     short setcarry
DOSCODE:4AA8 international_get endp
DOSCODE:4AAA international_copy:		     ; ...
DOSCODE:4AAA		     mov     bx, ss:[si+68h]
DOSCODE:4AAE		     mov     si, offset	COUNTRY_CDPG_108
DOSCODE:4AB1		     mov     cx, 24
DOSCODE:4AB4		     push    ds
DOSCODE:4AB5		     push    ss
DOSCODE:4AB6		     pop     ds
DOSCODE:4AB7		     rep movsb
DOSCODE:4AB9		     pop     ds
DOSCODE:4ABA international_ok3:			     ; ...
DOSCODE:4ABA		     call    Get_User_Stack
DOSCODE:4ABD		     mov     [si+2], bx
DOSCODE:4AC0 international_ok:			     ; ...
DOSCODE:4AC0		     mov     ax, bx
DOSCODE:4AC2 SYS_RET_OK_jmp:			     ; ...
DOSCODE:4AC2		     jmp     SYS_RET_OK
DOSCODE:4AC5 international_set:			     ; ...
DOSCODE:4AC5		     mov     bp, 1
DOSCODE:4AC8		     call    international_get
DOSCODE:4ACB		     jnb     short international_ok
DOSCODE:4ACD errtn:				     ; ...
DOSCODE:4ACD		     cmp     al, 0FFh
DOSCODE:4ACF		     jz	     short errtn2
DOSCODE:4AD1 errtn1:				     ; ...
DOSCODE:4AD1		     jmp     SYS_RET_ERR
DOSCODE:4AD4 errtn2:				     ; ...
DOSCODE:4AD4		     mov     al, 1
DOSCODE:4AD6		     jmp     short errtn1
DOSCODE:4AD8 $GetExtCntry:			     ; ...
DOSCODE:4AD8		     cmp     al, 20h ; ' '
DOSCODE:4ADA		     jb	     short notcap
DOSCODE:4ADC		     test    al, 80h
DOSCODE:4ADE		     jnz     short fileupper
DOSCODE:4AE0		     mov     bx, offset	UCASE_TAB_2
DOSCODE:4AE3		     jmp     short capit
DOSCODE:4AE5 fileupper:				     ; ...
DOSCODE:4AE5		     mov     bx, offset	FILE_UCASE_TAB_2
DOSCODE:4AE8 capit:				     ; ...
DOSCODE:4AE8		     cmp     al, 20h ; ' '
DOSCODE:4AEA		     jnz     short chkyes
DOSCODE:4AEC		     mov     al, dl
DOSCODE:4AEE		     call    GETLET3
DOSCODE:4AF1		     call    Get_User_Stack
DOSCODE:4AF4		     mov     [si+6], al
DOSCODE:4AF7		     jmp     short nono
DOSCODE:4AF9 chkyes:				     ; ...
DOSCODE:4AF9		     cmp     al, 23h
DOSCODE:4AFB		     jnz     short capstring
DOSCODE:4AFD		     xor     ax, ax
DOSCODE:4AFF		     cmp     dl, cs:NLS_YES
DOSCODE:4B04		     jz	     short yesyes
DOSCODE:4B06		     cmp     dl, cs:NLS_yes2
DOSCODE:4B0B		     jz	     short yesyes
DOSCODE:4B0D		     cmp     dl, cs:NLS_NO
DOSCODE:4B12		     jz	     short nono
DOSCODE:4B14		     cmp     dl, cs:NLS_no2
DOSCODE:4B19		     jz	     short nono
DOSCODE:4B1B		     inc     ax
DOSCODE:4B1C yesyes:				     ; ...
DOSCODE:4B1C		     inc     ax
DOSCODE:4B1D nono:				     ; ...
DOSCODE:4B1D		     jmp     short SYS_RET_OK_jmp
DOSCODE:4B1F capstring:				     ; ...
DOSCODE:4B1F		     mov     si, dx
DOSCODE:4B21		     cmp     al, 21h
DOSCODE:4B23		     jnz     short capascii
DOSCODE:4B25		     or	     cx, cx
DOSCODE:4B27		     jz	     short nono
DOSCODE:4B29 concap:				     ; ...
DOSCODE:4B29		     lodsb
DOSCODE:4B2A		     call    GETLET3
DOSCODE:4B2D		     mov     [si-1], al
DOSCODE:4B30		     loop    concap
DOSCODE:4B32		     jmp     short nono
DOSCODE:4B34 capascii:				     ; ...
DOSCODE:4B34		     cmp     al, 22h
DOSCODE:4B36		     jnz     short capinval
DOSCODE:4B38 concap2:				     ; ...
DOSCODE:4B38		     lodsb
DOSCODE:4B39		     or	     al, al
DOSCODE:4B3B		     jz	     short nono
DOSCODE:4B3D		     call    GETLET3
DOSCODE:4B40		     mov     [si-1], al
DOSCODE:4B43		     jmp     short concap2
DOSCODE:4B45 notcap:				     ; ...
DOSCODE:4B45		     cmp     cx, 5
DOSCODE:4B48		     jb	     short sizeerror
DOSCODE:4B4A		     push    ss
DOSCODE:4B4B		     pop     ds
DOSCODE:4B4C		     mov     si, offset	COUNTRY_CDPG
DOSCODE:4B4F		     cmp     dx, 0FFFFh
DOSCODE:4B52		     jnz     short GETCDPG
DOSCODE:4B54		     mov     dx, [si+68h]
DOSCODE:4B57 GETCDPG:				     ; ...
DOSCODE:4B57		     cmp     bx, 0FFFFh
DOSCODE:4B5A		     jnz     short CHKAGAIN
DOSCODE:4B5C		     mov     bx, [si+6Ah]
DOSCODE:4B5F CHKAGAIN:				     ; ...
DOSCODE:4B5F		     cmp     dx, [si+68h]
DOSCODE:4B62		     jnz     short CHKNLS
DOSCODE:4B64		     cmp     bx, [si+6Ah]
DOSCODE:4B67		     jnz     short CHKNLS
DOSCODE:4B69		     mov     bx, [si+48h]
DOSCODE:4B6C		     push    cx
DOSCODE:4B6D		     mov     cx, [si+4Ah]
DOSCODE:4B70		     mov     si, offset	COUNTRY_CDPG_76
DOSCODE:4B73 NXTENTRY:				     ; ...
DOSCODE:4B73		     cmp     al, [si]
DOSCODE:4B75		     jz	     short FOUNDIT
DOSCODE:4B77		     add     si, 5
DOSCODE:4B7A		     loop    NXTENTRY
DOSCODE:4B7C		     pop     cx
DOSCODE:4B7D capinval:				     ; ...
DOSCODE:4B7D		     mov     al, 1
DOSCODE:4B7F SYS_RET_ERR_jmp:			     ; ...
DOSCODE:4B7F		     jmp     SYS_RET_ERR
DOSCODE:4B82 FOUNDIT:				     ; ...
DOSCODE:4B82		     movsb
DOSCODE:4B83		     pop     cx
DOSCODE:4B84		     cmp     al, 1
DOSCODE:4B86		     jz	     short setsize
DOSCODE:4B88		     mov     cx, 4
DOSCODE:4B8B		     mov     ax, 5
DOSCODE:4B8E OK_RETN:				     ; ...
DOSCODE:4B8E		     rep movsb
DOSCODE:4B90		     mov     cx, ax
DOSCODE:4B92		     mov     ax, bx
DOSCODE:4B94 GETDONE:				     ; ...
DOSCODE:4B94		     call    Get_User_Stack
DOSCODE:4B97		     mov     [si+4], cx
DOSCODE:4B9A jmp_to_nono:			     ; ...
DOSCODE:4B9A		     jmp     short nono
DOSCODE:4B9C setsize:				     ; ...
DOSCODE:4B9C		     sub     cx, 3
DOSCODE:4B9F		     cmp     [si], cx
DOSCODE:4BA1		     jnb     short setsize2
DOSCODE:4BA3		     mov     cx, [si]
DOSCODE:4BA5 setsize2:				     ; ...
DOSCODE:4BA5		     mov     es:[di], cx
DOSCODE:4BA8		     add     di, 2
DOSCODE:4BAB		     add     si, 2
DOSCODE:4BAE		     mov     ax, cx
DOSCODE:4BB0		     add     ax, 3
DOSCODE:4BB3		     jmp     short OK_RETN
DOSCODE:4BB5 CHKNLS:				     ; ...
DOSCODE:4BB5		     xor     ah, ah
DOSCODE:4BB7		     push    ax
DOSCODE:4BB8		     pop     bp
DOSCODE:4BB9		     mov     ax, 1400h
DOSCODE:4BBC		     int     2Fh	     ; - Multiplex - NLSFUNC.COM - INSTALLATION	CHECK
DOSCODE:4BBC					     ; Return: AL = 00h	not installed, OK to install
DOSCODE:4BBC					     ; 01h not installed, not OK
DOSCODE:4BBC					     ; FFh installed
DOSCODE:4BBE		     cmp     al, 0FFh
DOSCODE:4BC0		     jz	     short NLSNXT
DOSCODE:4BC2 sizeerror:				     ; ...
DOSCODE:4BC2		     mov     al, 1
DOSCODE:4BC4 sizeerror_jmp:			     ; ...
DOSCODE:4BC4		     jmp     short SYS_RET_ERR_jmp
DOSCODE:4BC6 NLSNXT:				     ; ...
DOSCODE:4BC6		     mov     ax, 1402h
DOSCODE:4BC9		     int     2Fh	     ; - Multiplex - NLSFUNC.COM - GET COUNTRY INFO
DOSCODE:4BC9					     ; BP = subfunction, BX = code page
DOSCODE:4BC9					     ; DX = country code, DS:SI	-> internal code page structure
DOSCODE:4BC9					     ; ES:DI ->	user buffer, CX	= size of user buffer
DOSCODE:4BC9					     ; Return: AL = status
DOSCODE:4BC9					     ; 00h successful
DOSCODE:4BC9					     ; else DOS	error code
DOSCODE:4BCB		     cmp     al, 0
DOSCODE:4BCD		     jnz     short NLSERROR
DOSCODE:4BCF		     mov     ax, [si+48h]
DOSCODE:4BD2		     jmp     short GETDONE
DOSCODE:4BD4 NLSERROR:				     ; ...
DOSCODE:4BD4		     jmp     short sizeerror_jmp
DOSCODE:4BD6 $GetSetCdPg:			     ; ...
DOSCODE:4BD6		     push    ss
DOSCODE:4BD7		     pop     ds
DOSCODE:4BD8		     mov     si, offset	COUNTRY_CDPG
DOSCODE:4BDB		     cmp     al, 1
DOSCODE:4BDD		     jnz     short setglpg
DOSCODE:4BDF		     mov     bx, [si+6Ah]
DOSCODE:4BE2		     mov     dx, [si+48h]
DOSCODE:4BE5		     call    Get_User_Stack
DOSCODE:4BE8		     mov     [si+2], bx
DOSCODE:4BEB		     mov     [si+6], dx
DOSCODE:4BEE OK_RETURN:				     ; ...
DOSCODE:4BEE		     jmp     short jmp_to_nono
DOSCODE:4BF0 setglpg:				     ; ...
DOSCODE:4BF0		     cmp     al, 2
DOSCODE:4BF2		     jnz     short nomem
DOSCODE:4BF4		     mov     dx, [si+68h]
DOSCODE:4BF7		     mov     ax, 1400h
DOSCODE:4BFA		     int     2Fh	     ; - Multiplex - NLSFUNC.COM - INSTALLATION	CHECK
DOSCODE:4BFA					     ; Return: AL = 00h	not installed, OK to install
DOSCODE:4BFA					     ; 01h not installed, not OK
DOSCODE:4BFA					     ; FFh installed
DOSCODE:4BFC		     cmp     al, 0FFh
DOSCODE:4BFE		     jnz     short nomem
DOSCODE:4C00		     mov     ax, 1401h
DOSCODE:4C03		     int     2Fh	     ; - Multiplex - NLSFUNC.COM - CHANGE CODE PAGE
DOSCODE:4C03					     ; DS:SI ->	internal code page structure
DOSCODE:4C03					     ; BX = new	code page, DX =	country	code???
DOSCODE:4C03					     ; Return: AL = status
DOSCODE:4C03					     ; 00h successful
DOSCODE:4C03					     ; else DOS	error code
DOSCODE:4C05		     or	     al, al
DOSCODE:4C07		     jz	     short OK_RETURN
DOSCODE:4C09		     cmp     al, 65
DOSCODE:4C0B		     jnz     short seterr
DOSCODE:4C0D		     mov     ax, 65
DOSCODE:4C10		     mov     ds:EXTERR,	ax
DOSCODE:4C13		     mov     byte ptr ds:EXTERR_ACT_CLASS, 6
DOSCODE:4C18		     mov     byte ptr ds:EXTERR_ACT_CLASS+1, 5
DOSCODE:4C1D		     mov     ds:EXTERR_LOCUS, 4
DOSCODE:4C22		     jmp     From_GetSet
DOSCODE:4C25 seterr:				     ; ...
DOSCODE:4C25		     jmp     short NLSERROR
DOSCODE:4C27 nomem:				     ; ...
DOSCODE:4C27		     mov     al, 1
DOSCODE:4C29		     jmp     short seterr
DOSCODE:4C2B $GET_DRIVE_FREESPACE:		     ; ...
DOSCODE:4C2B		     push    ss
DOSCODE:4C2C		     pop     ds
DOSCODE:4C2D		     mov     al, dl
DOSCODE:4C2F		     call    GETTHISDRV
DOSCODE:4C32 SET_AX_RET:			     ; ...
DOSCODE:4C32		     jb	     short BADFDRV
DOSCODE:4C34		     call    DISK_INFO
DOSCODE:4C37		     xchg    dx, bx
DOSCODE:4C39		     jb	     short SET_AX_RET
DOSCODE:4C3B		     xor     ah, ah
DOSCODE:4C3D DoSt:				     ; ...
DOSCODE:4C3D		     call    Get_User_Stack
DOSCODE:4C40		     mov     [si+6], dx
DOSCODE:4C43		     mov     [si+4], cx
DOSCODE:4C46		     mov     [si+2], bx
DOSCODE:4C49		     mov     [si], ax
DOSCODE:4C4B		     retn
DOSCODE:4C4C BADFDRV:				     ; ...
DOSCODE:4C4C		     call    FCB_RET_ERR
DOSCODE:4C4F		     mov     ax, -1
DOSCODE:4C52		     jmp     short DoSt
DOSCODE:4C54 $GET_DMA:				     ; ...
DOSCODE:4C54		     mov     bx, word ptr ss:DMAADD
DOSCODE:4C59		     mov     cx, word ptr ss:DMAADD+2
DOSCODE:4C5E		     call    Get_User_Stack
DOSCODE:4C61		     mov     [si+2], bx
DOSCODE:4C64		     mov     [si+10h], cx
DOSCODE:4C67		     retn
DOSCODE:4C68 $SET_DMA:				     ; ...
DOSCODE:4C68		     mov     word ptr ss:DMAADD, dx
DOSCODE:4C6D		     mov     word ptr ss:DMAADD+2, ds
DOSCODE:4C72		     retn
DOSCODE:4C73 $GET_DEFAULT_DRIVE:		     ; ...
DOSCODE:4C73		     mov     al, ss:CURDRV
DOSCODE:4C77		     retn
DOSCODE:4C78 $SET_DEFAULT_DRIVE:		     ; ...
DOSCODE:4C78		     mov     al, dl
DOSCODE:4C7A		     inc     al
DOSCODE:4C7C		     call    GetVisDrv
DOSCODE:4C7F		     jb	     short SETRET
DOSCODE:4C81		     mov     ss:CURDRV,	al
DOSCODE:4C85 SETRET:				     ; ...
DOSCODE:4C85		     mov     al, ss:CDSCOUNT
DOSCODE:4C89		     retn
DOSCODE:4C8A ; =============== S U B R O U T I N E =======================================
DOSCODE:4C8A $GET_INTERRUPT_VECTOR proc	near	     ; ...
DOSCODE:4C8A		     call    RECSET
DOSCODE:4C8D		     les     bx, es:[bx]
DOSCODE:4C90		     call    Get_User_Stack
DOSCODE:4C93		     mov     [si+2], bx
DOSCODE:4C96		     mov     word ptr [si+10h],	es
DOSCODE:4C99		     retn
DOSCODE:4C99 $GET_INTERRUPT_VECTOR endp
DOSCODE:4C9A $SET_INTERRUPT_VECTOR:		     ; ...
DOSCODE:4C9A		     call    RECSET
DOSCODE:4C9D		     cli
DOSCODE:4C9E		     mov     es:[bx], dx
DOSCODE:4CA1		     mov     word ptr es:[bx+2], ds
DOSCODE:4CA5		     sti
DOSCODE:4CA6		     test    ss:DOS_FLAG, 4
DOSCODE:4CAC		     jnz     short siv_1
DOSCODE:4CAE		     retn
DOSCODE:4CAF siv_1:				     ; ...
DOSCODE:4CAF		     cmp     ss:A20OFF_COUNT, 0
DOSCODE:4CB5		     jnz     short siv_2
DOSCODE:4CB7		     mov     ss:A20OFF_COUNT, 1
DOSCODE:4CBD siv_2:				     ; ...
DOSCODE:4CBD		     retn
DOSCODE:4CBE ; =============== S U B R O U T I N E =======================================
DOSCODE:4CBE RECSET	     proc near		     ; ...
DOSCODE:4CBE		     xor     bx, bx
DOSCODE:4CC0		     mov     es, bx
DOSCODE:4CC2		     mov     bl, al
DOSCODE:4CC4		     shl     bx, 1
DOSCODE:4CC6		     shl     bx, 1
DOSCODE:4CC8		     retn
DOSCODE:4CC8 RECSET	     endp
DOSCODE:4CC9 $CHAR_OPER:			     ; ...
DOSCODE:4CC9		     or	     al, al
DOSCODE:4CCB		     mov     dl, '/'
DOSCODE:4CCD		     jz	     short chop_1
DOSCODE:4CCF		     cmp     al, 2
DOSCODE:4CD1		     mov     dl, 0FFh
DOSCODE:4CD3		     jz	     short chop_1
DOSCODE:4CD5		     retn
DOSCODE:4CD6 chop_1:				     ; ...
DOSCODE:4CD6		     call    Get_User_Stack
DOSCODE:4CD9		     mov     [si+6], dx
DOSCODE:4CDC		     retn
DOSCODE:4CDD $GetExtendedError:			     ; ...
DOSCODE:4CDD		     push    ss
DOSCODE:4CDE		     pop     ds
DOSCODE:4CDF		     mov     ax, ds:EXTERR
DOSCODE:4CE2		     les     di, ds:EXTERRPT
DOSCODE:4CE6		     mov     bx, ds:EXTERR_ACT_CLASS
DOSCODE:4CEA		     mov     ch, ds:EXTERR_LOCUS
DOSCODE:4CEE		     call    Get_User_Stack
DOSCODE:4CF1		     mov     [si+0Ah], di
DOSCODE:4CF4		     mov     word ptr [si+10h],	es
DOSCODE:4CF7		     mov     [si+2], bx
DOSCODE:4CFA		     mov     [si+4], cx
DOSCODE:4CFD jmp_SYS_RET_OK:			     ; ...
DOSCODE:4CFD		     jmp     SYS_RET_OK
DOSCODE:4D00		     push    si
DOSCODE:4D01		     mov     si, offset	COUNTRY_CDPG
DOSCODE:4D04		     mov     ax, ss:[si+6Ah]
DOSCODE:4D08		     pop     si
DOSCODE:4D09		     retn
DOSCODE:4D0A $ECS_Call:				     ; ...
DOSCODE:4D0A		     or	     al, al
DOSCODE:4D0C		     jnz     short _okok
DOSCODE:4D0E		     call    Get_User_Stack
DOSCODE:4D11		     mov     word ptr [si+8], offset DBCS_TAB_2
DOSCODE:4D16		     push    es
DOSCODE:4D17		     mov     es, cs:DosDSeg
DOSCODE:4D1C		     mov     word ptr [si+14], es
DOSCODE:4D1F		     pop     es
DOSCODE:4D20 _okok:				     ; ...
DOSCODE:4D20		     jmp     short jmp_SYS_RET_OK
DOSCODE:4D22 $PARSE_FILE_DESCRIPTOR:		     ; ...
DOSCODE:4D22		     call    MAKEFCB
DOSCODE:4D25		     push    si
DOSCODE:4D26		     call    Get_User_Stack
DOSCODE:4D29		     pop     word ptr [si+8]
DOSCODE:4D2C		     retn
DOSCODE:4D2D $SLEAZEFUNC:			     ; ...
DOSCODE:4D2D		     mov     dl, 0
DOSCODE:4D2F $SLEAZEFUNCDL:			     ; ...
DOSCODE:4D2F		     push    ss
DOSCODE:4D30		     pop     ds
DOSCODE:4D31		     mov     al, dl
DOSCODE:4D33		     call    GETTHISDRV
DOSCODE:4D36 SET_AL_RET:			     ; ...
DOSCODE:4D36		     jb	     short BADSLDRIVE
DOSCODE:4D38		     call    DISK_INFO
DOSCODE:4D3B		     jb	     short SET_AL_RET
DOSCODE:4D3D		     mov     byte ptr ds:FATBYTE, ah
DOSCODE:4D41		     mov     di, offset	FATBYTE
DOSCODE:4D44		     xor     ah, ah
DOSCODE:4D46		     call    Get_User_Stack
DOSCODE:4D49		     mov     [si+4], cx
DOSCODE:4D4C		     mov     [si+6], bx
DOSCODE:4D4F		     mov     [si+2], di
DOSCODE:4D52		     mov     word ptr [si+0Eh],	ss
DOSCODE:4D55		     retn
DOSCODE:4D56 BADSLDRIVE:			     ; ...
DOSCODE:4D56		     jmp     FCB_RET_ERR
DOSCODE:4D59 $GET_INDOS_FLAG:			     ; ...
DOSCODE:4D59		     call    Get_User_Stack
DOSCODE:4D5C		     mov     word ptr [si+2], offset INDOS
DOSCODE:4D61		     mov     word ptr [si+10h],	ss
DOSCODE:4D64		     retn
DOSCODE:4D65 $GET_IN_VARS:			     ; ...
DOSCODE:4D65		     call    Get_User_Stack
DOSCODE:4D68		     mov     word ptr [si+2], offset DPBHEAD ; SYSINITVARS
DOSCODE:4D6D		     mov     word ptr [si+10h],	ss
DOSCODE:4D70		     retn
DOSCODE:4D71 $GET_DEFAULT_DPB:			     ; ...
DOSCODE:4D71		     mov     dl, 0
DOSCODE:4D73 $GET_DPB:				     ; ...
DOSCODE:4D73		     push    ss
DOSCODE:4D74		     pop     ds
DOSCODE:4D75		     mov     al, dl
DOSCODE:4D77		     call    GETTHISDRV
DOSCODE:4D7A		     jb	     short ISNODRV
DOSCODE:4D7C		     les     di, ds:THISCDS
DOSCODE:4D80		     test    byte ptr es:[di+44h], 80h
DOSCODE:4D85		     jnz     short ISNODRV
DOSCODE:4D87		     call    ECritDisk
DOSCODE:4D8A		     call    FATREAD_CDS
DOSCODE:4D8D		     call    LCritDisk
DOSCODE:4D90		     jb	     short ISNODRV
DOSCODE:4D92		     call    Get_User_Stack
DOSCODE:4D95		     mov     [si+2], bp
DOSCODE:4D98		     mov     word ptr [si+0Eh],	es
DOSCODE:4D9B		     xor     al, al
DOSCODE:4D9D		     retn
DOSCODE:4D9E ISNODRV:				     ; ...
DOSCODE:4D9E		     mov     al, 0FFh
DOSCODE:4DA0		     retn
DOSCODE:4DA1 $DISK_RESET:			     ; ...
DOSCODE:4DA1		     mov     al, 0FFh
DOSCODE:4DA3		     push    ss
DOSCODE:4DA4		     pop     ds
DOSCODE:4DA5		     call    ECritDisk
DOSCODE:4DA8		     or	     ds:DOS34_FLAG, 4
DOSCODE:4DAD		     call    FLUSHBUF
DOSCODE:4DB0		     and     ds:DOS34_FLAG, 0FFFBh
DOSCODE:4DB5		     mov     ds:SC_STATUS, 0
DOSCODE:4DBB		     mov     bx, 0FFFFh
DOSCODE:4DBE		     mov     word ptr ds:LastBuffer+2, bx
DOSCODE:4DC2		     mov     word ptr ds:LastBuffer, bx
DOSCODE:4DC6		     call    LCritDisk
DOSCODE:4DC9		     mov     ax, 0FFFFh
DOSCODE:4DCC		     push    ax
DOSCODE:4DCD		     mov     ax, 1120h
DOSCODE:4DD0		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	FLUSH ALL DISK BUFFERS
DOSCODE:4DD0					     ; DS = DOS	CS
DOSCODE:4DD0					     ; Return: CF clear	(successful)
DOSCODE:4DD2		     pop     ax
DOSCODE:4DD3		     retn
DOSCODE:4DD4 word3	     dw	3		     ; ...
DOSCODE:4DD6 ; =============== S U B R O U T I N E =======================================
DOSCODE:4DD6 $SETDPB	     proc near		     ; ...
DOSCODE:4DD6		     mov     di, bp
DOSCODE:4DD8		     add     di, 2
DOSCODE:4DDB		     lodsw
DOSCODE:4DDC		     stosw
DOSCODE:4DDD		     cmp     byte ptr [si+3], 0
DOSCODE:4DE1		     jnz     short yesfat
DOSCODE:4DE3		     mov     byte ptr es:[di+4], 0
DOSCODE:4DE8		     jmp     short setend
DOSCODE:4DEA yesfat:				     ; ...
DOSCODE:4DEA		     mov     dx, ax
DOSCODE:4DEC		     lodsb
DOSCODE:4DED		     dec     al
DOSCODE:4DEF		     stosb
DOSCODE:4DF0		     inc     al
DOSCODE:4DF2		     xor     ah, ah
DOSCODE:4DF4 LOG2LOOP:				     ; ...
DOSCODE:4DF4		     test    al, 1
DOSCODE:4DF6		     jnz     short SAVLOG
DOSCODE:4DF8		     inc     ah
DOSCODE:4DFA		     shr     al, 1
DOSCODE:4DFC		     jmp     short LOG2LOOP
DOSCODE:4DFE SAVLOG:				     ; ...
DOSCODE:4DFE		     mov     al, ah
DOSCODE:4E00		     stosb
DOSCODE:4E01		     mov     bl, al
DOSCODE:4E03		     movsw
DOSCODE:4E04		     lodsb
DOSCODE:4E05		     stosb
DOSCODE:4E06		     mov     bh, al
DOSCODE:4E08		     lodsw
DOSCODE:4E09		     stosw
DOSCODE:4E0A		     mov     cl, 5
DOSCODE:4E0C		     shr     dx, cl
DOSCODE:4E0E		     dec     ax
DOSCODE:4E0F		     add     ax, dx
DOSCODE:4E11		     mov     cx, dx
DOSCODE:4E13		     xor     dx, dx
DOSCODE:4E15		     div     cx
DOSCODE:4E17		     mov     cx, ax
DOSCODE:4E19		     inc     di
DOSCODE:4E1A		     inc     di
DOSCODE:4E1B		     movsw
DOSCODE:4E1C		     lodsb
DOSCODE:4E1D		     mov     es:[bp+17h], al
DOSCODE:4E21		     lodsw
DOSCODE:4E22		     stosw
DOSCODE:4E23		     mov     dl, bh
DOSCODE:4E25		     xor     dh, dh
DOSCODE:4E27		     mul     dx
DOSCODE:4E29		     add     ax, es:[bp+6]
DOSCODE:4E2D		     stosw
DOSCODE:4E2E		     add     ax, cx
DOSCODE:4E30		     mov     es:[bp+0Bh], ax
DOSCODE:4E34		     mov     cl, bl
DOSCODE:4E36		     cmp     word ptr es:[bp+0Dh], 0
DOSCODE:4E3B		     jnz     short normal_dpb
DOSCODE:4E3D		     xor     ch, ch
DOSCODE:4E3F		     mov     bx, [si+8]
DOSCODE:4E42		     mov     dx, [si+0Ah]
DOSCODE:4E45		     sub     bx, ax
DOSCODE:4E47		     sbb     dx, 0
DOSCODE:4E4A		     or	     cx, cx
DOSCODE:4E4C		     jz	     short norot
DOSCODE:4E4E rott:				     ; ...
DOSCODE:4E4E		     clc
DOSCODE:4E4F		     rcr     dx, 1
DOSCODE:4E51		     rcr     bx, 1
DOSCODE:4E53		     loop    rott
DOSCODE:4E55 norot:				     ; ...
DOSCODE:4E55		     mov     ax, bx
DOSCODE:4E57		     jmp     short setend
DOSCODE:4E59 normal_dpb:			     ; ...
DOSCODE:4E59		     sub     ax, es:[bp+0Dh]
DOSCODE:4E5D		     neg     ax
DOSCODE:4E5F		     shr     ax, cl
DOSCODE:4E61 setend:				     ; ...
DOSCODE:4E61		     inc     ax
DOSCODE:4E62		     mov     bx, ax
DOSCODE:4E64		     mov     ax, es:[bp+0Fh]
DOSCODE:4E68		     mul     word ptr es:[bp+2]
DOSCODE:4E6C		     cmp     bx, 0FF6h
DOSCODE:4E70		     jb	     short setend_fat12
DOSCODE:4E72		     shr     dx, 1
DOSCODE:4E74		     jnz     short setend_faterr
DOSCODE:4E76		     rcr     ax, 1
DOSCODE:4E78		     cmp     ax, 0FF7h
DOSCODE:4E7B		     jb	     short setend_faterr
DOSCODE:4E7D		     jmp     short setend_fat16
DOSCODE:4E7F setend_fat12:			     ; ...
DOSCODE:4E7F		     add     ax, ax
DOSCODE:4E81		     adc     dx, dx
DOSCODE:4E83		     cmp     dx, 3
DOSCODE:4E86		     jnb     short setend_faterr
DOSCODE:4E88		     div     cs:word3
DOSCODE:4E8D setend_fat16:			     ; ...
DOSCODE:4E8D		     dec     ax
DOSCODE:4E8E		     cmp     ax, bx
DOSCODE:4E90		     jbe     short setend_fat
DOSCODE:4E92 setend_faterr:			     ; ...
DOSCODE:4E92		     mov     ax, bx
DOSCODE:4E94 setend_fat:			     ; ...
DOSCODE:4E94		     mov     es:[bp+0Dh], ax
DOSCODE:4E98		     mov     word ptr es:[bp+1Dh], 0
DOSCODE:4E9E		     mov     word ptr es:[bp+1Fh], 0FFFFh
DOSCODE:4EA4		     retn
DOSCODE:4EA4 $SETDPB	     endp
DOSCODE:4EA5 ; =============== S U B R O U T I N E =======================================
DOSCODE:4EA5 $DUP_PDB	     proc near		     ; ...
DOSCODE:4EA5		     mov     ds, cs:DosDSeg
DOSCODE:4EAA		     mov     ds:CreatePDB, 0FFh
DOSCODE:4EAF		     mov     ds, ds:CurrentPDB
DOSCODE:4EB3		     push    si
DOSCODE:4EB4		     jmp     short CreateCopy
DOSCODE:4EB4 $DUP_PDB	     endp
DOSCODE:4EB6 ; =============== S U B R O U T I N E =======================================
DOSCODE:4EB6 $CREATE_PROCESS_DATA_BLOCK	proc near    ; ...
DOSCODE:4EB6		     call    Get_User_Stack
DOSCODE:4EB9		     mov     ds, word ptr [si+14h]
DOSCODE:4EBC		     push    word ptr ds:2   ; PDB.BLOCK_LEN
DOSCODE:4EC0 CreateCopy:			     ; ...
DOSCODE:4EC0		     mov     es, dx
DOSCODE:4EC2		     xor     si, si
DOSCODE:4EC4		     mov     di, si
DOSCODE:4EC6		     mov     cx, 128
DOSCODE:4EC9		     rep movsw
DOSCODE:4ECB		     mov     cx, 20
DOSCODE:4ECE		     mov     di, 18h	     ; PDB.JFN_TABLE
DOSCODE:4ED1		     push    ds
DOSCODE:4ED2		     lds     si, ds:34h	     ; PDB.JFN_Pointer
DOSCODE:4ED6		     rep movsb
DOSCODE:4ED8		     pop     ds
DOSCODE:4ED9		     mov     ds, cs:DosDSeg
DOSCODE:4EDE		     cmp     ds:CreatePDB, 0
DOSCODE:4EE3		     jz	     short Create_PDB_cont
DOSCODE:4EE5		     mov     ds, cs:DosDSeg
DOSCODE:4EEA		     xor     bx, bx
DOSCODE:4EEC		     mov     cx, 20
DOSCODE:4EEF Create_dup_jfn:			     ; ...
DOSCODE:4EEF		     push    es
DOSCODE:4EF0		     call    SFFromHandle
DOSCODE:4EF3		     mov     al, 0FFh
DOSCODE:4EF5		     jb	     short CreateStash
DOSCODE:4EF7		     test    byte ptr es:[di+6], 10h
DOSCODE:4EFC		     jnz     short CreateStash
DOSCODE:4EFE		     mov     ah, es:[di+2]
DOSCODE:4F02		     and     ah, 0F0h
DOSCODE:4F05		     cmp     ah, 70h
DOSCODE:4F08		     jz	     short CreateStash
DOSCODE:4F0A		     mov     word ptr ds:THISSFT, di
DOSCODE:4F0E		     mov     word ptr ds:THISSFT+2, es
DOSCODE:4F12		     call    DOS_DUP
DOSCODE:4F15		     call    pJFNFromHandle
DOSCODE:4F18		     mov     al, es:[di]
DOSCODE:4F1B CreateStash:			     ; ...
DOSCODE:4F1B		     pop     es
DOSCODE:4F1C		     mov     es:[bx+18h], al
DOSCODE:4F20		     inc     bx
DOSCODE:4F21		     loop    Create_dup_jfn
DOSCODE:4F23		     mov     bx, ds:CurrentPDB
DOSCODE:4F27		     mov     es:16h, bx	     ; PDB.PARENT_PID
DOSCODE:4F2C		     mov     ds:CurrentPDB, es
DOSCODE:4F30		     mov     ds, bx
DOSCODE:4F32 Create_PDB_cont:			     ; ...
DOSCODE:4F32		     push    ds
DOSCODE:4F33		     mov     ds, cs:DosDSeg
DOSCODE:4F38		     mov     ds:CreatePDB, 0
DOSCODE:4F3D		     pop     ds
DOSCODE:4F3E		     pop     ax
DOSCODE:4F3F SETMEM:				     ; ...
DOSCODE:4F3F		     xor     cx, cx
DOSCODE:4F41		     mov     ds, cx
DOSCODE:4F43		     mov     es, dx
DOSCODE:4F45		     mov     si, 88h
DOSCODE:4F48		     mov     di, 10
DOSCODE:4F4B		     mov     cx, 6
DOSCODE:4F4E		     rep movsw
DOSCODE:4F50		     mov     es:2, ax
DOSCODE:4F54		     sub     ax, dx
DOSCODE:4F56		     cmp     ax, 0FFFh
DOSCODE:4F59		     jbe     short HAVDIF
DOSCODE:4F5B		     mov     ax, 0FFFh
DOSCODE:4F5E HAVDIF:				     ; ...
DOSCODE:4F5E		     sub     ax, 10h
DOSCODE:4F61		     mov     bx, 0Ch
DOSCODE:4F64		     sub     bx, ax
DOSCODE:4F66		     mov     cl, 4
DOSCODE:4F68		     shl     ax, cl
DOSCODE:4F6A		     mov     ds, dx
DOSCODE:4F6C		     mov     ds:6, ax
DOSCODE:4F6F		     mov     ds:8, bx
DOSCODE:4F73		     cmp     ax, 0FEF0h
DOSCODE:4F76		     jz	     short addr_ok
DOSCODE:4F78		     mov     word ptr ds:6, 0C0h
DOSCODE:4F7E		     mov     word ptr ds:8, 0
DOSCODE:4F84 addr_ok:				     ; ...
DOSCODE:4F84		     mov     word ptr ds:0, 20CDh
DOSCODE:4F8A		     mov     byte ptr ds:5, 9Ah
DOSCODE:4F8F		     mov     word ptr ds:50h, 21CDh
DOSCODE:4F95		     mov     byte ptr ds:52h, 0CBh
DOSCODE:4F9A		     mov     word ptr ds:34h, 18h
DOSCODE:4FA0		     mov     word ptr ds:36h, ds
DOSCODE:4FA4		     mov     word ptr ds:32h, 20
DOSCODE:4FAA		     mov     word ptr ds:38h, 0FFFFh
DOSCODE:4FB0		     mov     word ptr ds:3Ah, 0FFFFh
DOSCODE:4FB6		     mov     word ptr es:40h, 1606h ; 6.22
DOSCODE:4FBD		     retn
DOSCODE:4FBD $CREATE_PROCESS_DATA_BLOCK	endp
DOSCODE:4FBE $GSetMediaID:			     ; ...
DOSCODE:4FBE		     mov     cx, 866h
DOSCODE:4FC1		     cmp     al, 0
DOSCODE:4FC3		     jz	     short doioctl
DOSCODE:4FC5		     cmp     al, 1
DOSCODE:4FC7		     jnz     short errorfunc
DOSCODE:4FC9		     mov     cx, 846h
DOSCODE:4FCC doioctl:				     ; ...
DOSCODE:4FCC		     mov     al, 0Dh
DOSCODE:4FCE		     call    $IOCTL
DOSCODE:4FD1		     retn
DOSCODE:4FD2 errorfunc:				     ; ...
DOSCODE:4FD2		     mov     al, 1
DOSCODE:4FD4		     jmp     SYS_RET_ERR
DOSCODE:4FD7 ; =============== S U B R O U T I N E =======================================
DOSCODE:4FD7 StrCmp	     proc near		     ; ...
DOSCODE:4FD7		     push    si
DOSCODE:4FD8		     push    di
DOSCODE:4FD9		     push    ax
DOSCODE:4FDA Cmplp:				     ; ...
DOSCODE:4FDA		     lodsb
DOSCODE:4FDB		     call    UCase
DOSCODE:4FDE		     call    PATHCHRCMP
DOSCODE:4FE1		     mov     ah, al
DOSCODE:4FE3		     mov     al, es:[di]
DOSCODE:4FE6		     inc     di
DOSCODE:4FE7		     call    UCase
DOSCODE:4FEA		     call    PATHCHRCMP
DOSCODE:4FED		     cmp     ah, al
DOSCODE:4FEF		     jnz     short PopRet
DOSCODE:4FF1		     or	     al, al
DOSCODE:4FF3		     jnz     short Cmplp
DOSCODE:4FF5 PopRet:				     ; ...
DOSCODE:4FF5		     pop     ax
DOSCODE:4FF6		     pop     di
DOSCODE:4FF7		     pop     si
DOSCODE:4FF8		     retn
DOSCODE:4FF8 StrCmp	     endp
DOSCODE:4FF9 ; =============== S U B R O U T I N E =======================================
DOSCODE:4FF9 StrCpy	     proc near		     ; ...
DOSCODE:4FF9		     push    ax
DOSCODE:4FFA CPYLoop:				     ; ...
DOSCODE:4FFA		     lodsb
DOSCODE:4FFB		     call    UCase
DOSCODE:4FFE		     call    PATHCHRCMP
DOSCODE:5001		     stosb
DOSCODE:5002		     or	     al, al
DOSCODE:5004		     jnz     short CPYLoop
DOSCODE:5006		     pop     ax
DOSCODE:5007		     retn
DOSCODE:5007 StrCpy	     endp
DOSCODE:5008 ; =============== S U B R O U T I N E =======================================
DOSCODE:5008 FStrCpy	     proc near		     ; ...
DOSCODE:5008		     push    ax
DOSCODE:5009 FCPYLoop:				     ; ...
DOSCODE:5009		     lodsb
DOSCODE:500A		     stosb
DOSCODE:500B		     or	     al, al
DOSCODE:500D		     jnz     short FCPYLoop
DOSCODE:500F		     pop     ax
DOSCODE:5010		     retn
DOSCODE:5010 FStrCpy	     endp
DOSCODE:5011 ; =============== S U B R O U T I N E =======================================
DOSCODE:5011 StrLen	     proc near		     ; ...
DOSCODE:5011		     push    di
DOSCODE:5012		     push    ax
DOSCODE:5013		     mov     cx, 0FFFFh	     ; 65535
DOSCODE:5016		     xor     al, al
DOSCODE:5018		     repne scasb
DOSCODE:501A		     not     cx
DOSCODE:501C		     pop     ax
DOSCODE:501D		     pop     di
DOSCODE:501E		     retn
DOSCODE:501E StrLen	     endp
DOSCODE:501F ; =============== S U B R O U T I N E =======================================
DOSCODE:501F DStrLen	     proc near		     ; ...
DOSCODE:501F		     call    XCHGP
DOSCODE:5022		     call    StrLen
DOSCODE:5025		     call    XCHGP
DOSCODE:5028		     retn
DOSCODE:5028 DStrLen	     endp
DOSCODE:5029 ; =============== S U B R O U T I N E =======================================
DOSCODE:5029 XCHGP	     proc near		     ; ...
DOSCODE:5029		     push    ds
DOSCODE:502A		     push    es
DOSCODE:502B		     pop     ds
DOSCODE:502C		     pop     es
DOSCODE:502D		     xchg    si, di
DOSCODE:502F xchgp_retn:			     ; ...
DOSCODE:502F		     retn
DOSCODE:502F XCHGP	     endp
DOSCODE:5030 ; =============== S U B R O U T I N E =======================================
DOSCODE:5030 Idle	     proc near		     ; ...
DOSCODE:5030		     cmp     ss:FSHARING, 0
DOSCODE:5036		     jnz     short xchgp_retn
DOSCODE:5038		     push    cx
DOSCODE:5039		     mov     cx, ss:RetryLoop
DOSCODE:503E		     jcxz    short Idle3
DOSCODE:5040 Idle1:				     ; ...
DOSCODE:5040		     push    cx
DOSCODE:5041		     xor     cx, cx
DOSCODE:5043 Idle2:				     ; ...
DOSCODE:5043		     loop    Idle2
DOSCODE:5045		     pop     cx
DOSCODE:5046		     loop    Idle1
DOSCODE:5048 Idle3:				     ; ...
DOSCODE:5048		     pop     cx
DOSCODE:5049		     retn
DOSCODE:5049 Idle	     endp
DOSCODE:504A ; =============== S U B R O U T I N E =======================================
DOSCODE:504A ; Attributes: bp-based frame
DOSCODE:504A TableDispatch   proc near		     ; ...
DOSCODE:504A TFrame.Index    = byte ptr	 4
DOSCODE:504A TFrame.Tab	     = word ptr	 6
DOSCODE:504A		     push    bp
DOSCODE:504B		     mov     bp, sp
DOSCODE:504D		     push    bx
DOSCODE:504E		     mov     bx, [bp+TFrame.Tab]
DOSCODE:5051		     mov     bl, cs:[bx]
DOSCODE:5054		     cmp     [bp+TFrame.Index],	bl
DOSCODE:5057		     jnb     short TableError
DOSCODE:5059		     mov     bl, [bp+TFrame.Index]
DOSCODE:505C		     xor     bh, bh
DOSCODE:505E		     shl     bx, 1
DOSCODE:5060		     inc     bx
DOSCODE:5061		     add     bx, [bp+TFrame.Tab]
DOSCODE:5064		     mov     bx, cs:[bx]
DOSCODE:5067		     mov     [bp+TFrame.Tab], bx
DOSCODE:506A		     pop     bx
DOSCODE:506B		     pop     bp
DOSCODE:506C		     add     sp, 4
DOSCODE:506F		     retn
DOSCODE:5070 TableError:			     ; ...
DOSCODE:5070		     pop     bx
DOSCODE:5071		     pop     bp
DOSCODE:5072		     retn    6
DOSCODE:5072 TableDispatch   endp ; sp-analysis	failed
DOSCODE:5075 ; =============== S U B R O U T I N E =======================================
DOSCODE:5075 TestNet	     proc near		     ; ...
DOSCODE:5075		     mov     es, cs:DosDSeg
DOSCODE:507A		     les     di, es:THISCDS
DOSCODE:507F		     cmp     di, 0FFFFh
DOSCODE:5082		     jz	     short CMCRet
DOSCODE:5084		     test    byte ptr es:[di+44h], 80h
DOSCODE:5089		     jnz     short CMCRet
DOSCODE:508B		     retn
DOSCODE:508C CMCRet:				     ; ...
DOSCODE:508C		     cmc
DOSCODE:508D		     retn
DOSCODE:508D TestNet	     endp
DOSCODE:508E ; =============== S U B R O U T I N E =======================================
DOSCODE:508E IsSFTNet	     proc near		     ; ...
DOSCODE:508E		     test    byte ptr es:[di+6], 80h
DOSCODE:5093		     retn
DOSCODE:5093 IsSFTNet	     endp
DOSCODE:5094 FastInit:				     ; ...
DOSCODE:5094		     push    es
DOSCODE:5095		     mov     es, cs:DosDSeg
DOSCODE:509A		     mov     di, offset	FastTable_2
DOSCODE:509D		     dec     bx
DOSCODE:509E		     mov     dx, bx
DOSCODE:50A0		     shl     bx, 1
DOSCODE:50A2		     shl     bx, 1
DOSCODE:50A4		     add     di, bx
DOSCODE:50A6		     mov     ax, es:[di+2]
DOSCODE:50AA		     mov     cx, cs
DOSCODE:50AC		     cmp     ax, cx
DOSCODE:50AE		     jz	     short ok_install
DOSCODE:50B0		     or	     ax, ax
DOSCODE:50B2		     jz	     short ok_install
DOSCODE:50B4		     stc
DOSCODE:50B5		     jmp     short FSret
DOSCODE:50B7 ok_install:			     ; ...
DOSCODE:50B7		     cmp     si, 0FFFFh
DOSCODE:50BA		     jz	     short FSret
DOSCODE:50BC		     mov     cx, ds
DOSCODE:50BE		     mov     es:[di+2],	cx
DOSCODE:50C2		     mov     es:[di], si
DOSCODE:50C5		     mov     di, offset	FastOpenFlg
DOSCODE:50C8		     add     di, dx
DOSCODE:50CA		     or	     byte ptr es:[di], 80h
DOSCODE:50CE FSret:				     ; ...
DOSCODE:50CE		     pop     es
DOSCODE:50CF		     retn
DOSCODE:50D0 FastRet:				     ; ...
DOSCODE:50D0		     stc
DOSCODE:50D1		     sbb     ax, ax
DOSCODE:50D3		     retf
DOSCODE:50D4 NLS_OPEN:				     ; ...
DOSCODE:50D4		     mov     al, cl
DOSCODE:50D6		     call    $OPEN
DOSCODE:50D9		     retn
DOSCODE:50DA NLS_LSEEK:				     ; ...
DOSCODE:50DA		     push    ss:USER_SP
DOSCODE:50DF		     push    ss:USER_SS
DOSCODE:50E4		     call    Fake_User_Stack
DOSCODE:50E7		     mov     ax, bp
DOSCODE:50E9		     call    $LSEEK
DOSCODE:50EC		     pop     ss:USER_SS
DOSCODE:50F1		     pop     ss:USER_SP
DOSCODE:50F6		     retn
DOSCODE:50F7 ; =============== S U B R O U T I N E =======================================
DOSCODE:50F7 Fake_User_Stack proc near		     ; ...
DOSCODE:50F7		     mov     ax, ss:USER_SP_2F
DOSCODE:50FB		     mov     ss:USER_SP, ax
DOSCODE:50FF		     mov     ax, ss
DOSCODE:5101		     mov     ss:USER_SS, ax
DOSCODE:5105		     retn
DOSCODE:5105 Fake_User_Stack endp
DOSCODE:5106 GetDevList:			     ; ...
DOSCODE:5106		     mov     si, offset	SysInitTable
DOSCODE:5109		     mov     ds, cs:DosDSeg
DOSCODE:510E		     lds     si, [si]
DOSCODE:5110		     mov     ax, [si+22h]
DOSCODE:5113		     mov     bx, [si+24h]
DOSCODE:5116		     retn
DOSCODE:5117 NLS_IOCTL:				     ; ...
DOSCODE:5117		     push    ss:USER_SP
DOSCODE:511C		     push    ss:USER_SS
DOSCODE:5121		     call    Fake_User_Stack
DOSCODE:5124		     mov     ax, bp
DOSCODE:5126		     call    $IOCTL
DOSCODE:5129		     pop     ss:USER_SS
DOSCODE:512E		     pop     ss:USER_SP
DOSCODE:5133		     retn
DOSCODE:5134 NLS_GETEXT:			     ; ...
DOSCODE:5134		     mov     ax, ss:EXTERR
DOSCODE:5138		     retn
DOSCODE:5139 MSG_RETRIEVAL:			     ; ...
DOSCODE:5139		     retn
DOSCODE:513A ; =============== S U B R O U T I N E =======================================
DOSCODE:513A ECritDisk	     proc near		     ; ...
DOSCODE:513A ; FUNCTION	CHUNK AT DOSCODE:5146 SIZE 0000000E BYTES
DOSCODE:513A ; FUNCTION	CHUNK AT DOSCODE:5155 SIZE 00000005 BYTES
DOSCODE:513A		     pushf
DOSCODE:513B		     cmp     ss:redir_patch, 0
DOSCODE:5141		     jz	     short ECritDisk_2
DOSCODE:5143		     jmp     short ECritDisk_1
DOSCODE:5143 ECritDisk	     endp
DOSCODE:5145 ; =============== S U B R O U T I N E =======================================
DOSCODE:5145 ECritDisk_iret  proc far		     ; ...
DOSCODE:5145		     iret
DOSCODE:5145 ECritDisk_iret  endp
DOSCODE:5146 ; START OF	FUNCTION CHUNK FOR ECritDisk
DOSCODE:5146 ECritDisk_1:			     ; ...
DOSCODE:5146		     push    cs
DOSCODE:5147		     call    near ptr ECritDisk_iret
DOSCODE:514A		     push    ax
DOSCODE:514B		     mov     ax, 8001h
DOSCODE:514E		     int     2Ah	     ; Microsoft Networks - BEGIN DOS CRITICAL SECTION
DOSCODE:514E					     ; AL = critical section number (00h-0Fh)
DOSCODE:5150		     pop     ax
DOSCODE:5151		     retn
DOSCODE:5152 ECritDisk_2:			     ; ...
DOSCODE:5152		     jmp     short ECritDisk_3
DOSCODE:5152 ; END OF FUNCTION CHUNK FOR ECritDisk
DOSCODE:5154 ; =============== S U B R O U T I N E =======================================
DOSCODE:5154 ECritDisk_iret2 proc far		     ; ...
DOSCODE:5154		     iret
DOSCODE:5154 ECritDisk_iret2 endp
DOSCODE:5155 ; START OF	FUNCTION CHUNK FOR ECritDisk
DOSCODE:5155 ECritDisk_3:			     ; ...
DOSCODE:5155		     push    cs
DOSCODE:5156		     call    near ptr ECritDisk_iret2
DOSCODE:5159		     retn
DOSCODE:5159 ; END OF FUNCTION CHUNK FOR ECritDisk
DOSCODE:515A ; =============== S U B R O U T I N E =======================================
DOSCODE:515A LCritDisk	     proc near		     ; ...
DOSCODE:515A ; FUNCTION	CHUNK AT DOSCODE:5166 SIZE 0000000E BYTES
DOSCODE:515A ; FUNCTION	CHUNK AT DOSCODE:5175 SIZE 00000005 BYTES
DOSCODE:515A		     pushf
DOSCODE:515B		     cmp     ss:redir_patch, 0
DOSCODE:5161		     jz	     short LCritDisk_2
DOSCODE:5163		     jmp     short LCritDisk_1
DOSCODE:5163 LCritDisk	     endp
DOSCODE:5165 ; =============== S U B R O U T I N E =======================================
DOSCODE:5165 LCritDisk_iret  proc far		     ; ...
DOSCODE:5165		     iret
DOSCODE:5165 LCritDisk_iret  endp
DOSCODE:5166 ; START OF	FUNCTION CHUNK FOR LCritDisk
DOSCODE:5166 LCritDisk_1:			     ; ...
DOSCODE:5166		     push    cs
DOSCODE:5167		     call    near ptr LCritDisk_iret
DOSCODE:516A		     push    ax
DOSCODE:516B		     mov     ax, 8101h
DOSCODE:516E		     int     2Ah	     ; Microsoft Networks - END	DOS CRITICAL SECTION
DOSCODE:516E					     ; AL = critical section number (00h-0Fh)
DOSCODE:5170		     pop     ax
DOSCODE:5171		     retn
DOSCODE:5172 LCritDisk_2:			     ; ...
DOSCODE:5172		     jmp     short LCritDisk_3
DOSCODE:5172 ; END OF FUNCTION CHUNK FOR LCritDisk
DOSCODE:5174 ; =============== S U B R O U T I N E =======================================
DOSCODE:5174 LCritDisk_iret2 proc far		     ; ...
DOSCODE:5174		     iret
DOSCODE:5174 LCritDisk_iret2 endp
DOSCODE:5175 ; START OF	FUNCTION CHUNK FOR LCritDisk
DOSCODE:5175 LCritDisk_3:			     ; ...
DOSCODE:5175		     push    cs
DOSCODE:5176		     call    near ptr LCritDisk_iret2
DOSCODE:5179		     retn
DOSCODE:5179 ; END OF FUNCTION CHUNK FOR LCritDisk
DOSCODE:517A ; =============== S U B R O U T I N E =======================================
DOSCODE:517A ECritDevice     proc near		     ; ...
DOSCODE:517A ; FUNCTION	CHUNK AT DOSCODE:5186 SIZE 0000000E BYTES
DOSCODE:517A ; FUNCTION	CHUNK AT DOSCODE:5195 SIZE 00000005 BYTES
DOSCODE:517A		     pushf
DOSCODE:517B		     cmp     ss:redir_patch, 0
DOSCODE:5181		     jz	     short ECritDevice_2
DOSCODE:5183		     jmp     short ECritDevice_1
DOSCODE:5183 ECritDevice     endp
DOSCODE:5185 ; =============== S U B R O U T I N E =======================================
DOSCODE:5185 ECritDevice_iret proc far		     ; ...
DOSCODE:5185		     iret
DOSCODE:5185 ECritDevice_iret endp
DOSCODE:5186 ; START OF	FUNCTION CHUNK FOR ECritDevice
DOSCODE:5186 ECritDevice_1:			     ; ...
DOSCODE:5186		     push    cs
DOSCODE:5187		     call    near ptr ECritDevice_iret
DOSCODE:518A		     push    ax
DOSCODE:518B		     mov     ax, 8002h
DOSCODE:518E		     int     2Ah	     ; Microsoft Networks - BEGIN DOS CRITICAL SECTION
DOSCODE:518E					     ; AL = critical section number (00h-0Fh)
DOSCODE:5190		     pop     ax
DOSCODE:5191		     retn
DOSCODE:5192 ECritDevice_2:			     ; ...
DOSCODE:5192		     jmp     short ECritDevice_3
DOSCODE:5192 ; END OF FUNCTION CHUNK FOR ECritDevice
DOSCODE:5194 ; =============== S U B R O U T I N E =======================================
DOSCODE:5194 ECritDevice_iret2 proc far		     ; ...
DOSCODE:5194		     iret
DOSCODE:5194 ECritDevice_iret2 endp
DOSCODE:5195 ; START OF	FUNCTION CHUNK FOR ECritDevice
DOSCODE:5195 ECritDevice_3:			     ; ...
DOSCODE:5195		     push    cs
DOSCODE:5196		     call    near ptr ECritDevice_iret2
DOSCODE:5199		     retn
DOSCODE:5199 ; END OF FUNCTION CHUNK FOR ECritDevice
DOSCODE:519A ; =============== S U B R O U T I N E =======================================
DOSCODE:519A LCritDevice     proc near		     ; ...
DOSCODE:519A ; FUNCTION	CHUNK AT DOSCODE:51A6 SIZE 0000000E BYTES
DOSCODE:519A ; FUNCTION	CHUNK AT DOSCODE:51B5 SIZE 00000005 BYTES
DOSCODE:519A		     pushf
DOSCODE:519B		     cmp     ss:redir_patch, 0
DOSCODE:51A1		     jz	     short LCritDevice_2
DOSCODE:51A3		     jmp     short LCritDevice_1
DOSCODE:51A3 LCritDevice     endp
DOSCODE:51A5 ; =============== S U B R O U T I N E =======================================
DOSCODE:51A5 LCritDevice_iret proc far		     ; ...
DOSCODE:51A5		     iret
DOSCODE:51A5 LCritDevice_iret endp
DOSCODE:51A6 ; START OF	FUNCTION CHUNK FOR LCritDevice
DOSCODE:51A6 LCritDevice_1:			     ; ...
DOSCODE:51A6		     push    cs
DOSCODE:51A7		     call    near ptr LCritDevice_iret
DOSCODE:51AA		     push    ax
DOSCODE:51AB		     mov     ax, 8102h
DOSCODE:51AE		     int     2Ah	     ; Microsoft Networks - END	DOS CRITICAL SECTION
DOSCODE:51AE					     ; AL = critical section number (00h-0Fh)
DOSCODE:51B0		     pop     ax
DOSCODE:51B1		     retn
DOSCODE:51B2 LCritDevice_2:			     ; ...
DOSCODE:51B2		     jmp     short LCritDevice_3
DOSCODE:51B2 ; END OF FUNCTION CHUNK FOR LCritDevice
DOSCODE:51B4 ; =============== S U B R O U T I N E =======================================
DOSCODE:51B4 LCritDevice_iret2 proc far		     ; ...
DOSCODE:51B4		     iret
DOSCODE:51B4 LCritDevice_iret2 endp
DOSCODE:51B5 ; START OF	FUNCTION CHUNK FOR LCritDevice
DOSCODE:51B5 LCritDevice_3:			     ; ...
DOSCODE:51B5		     push    cs
DOSCODE:51B6		     call    near ptr LCritDevice_iret2
DOSCODE:51B9		     retn
DOSCODE:51B9 ; END OF FUNCTION CHUNK FOR LCritDevice
DOSCODE:51BA ; =============== S U B R O U T I N E =======================================
DOSCODE:51BA $STD_CON_INPUT_NO_ECHO proc near	     ; ...
DOSCODE:51BA		     push    ds
DOSCODE:51BB		     push    si
DOSCODE:51BC INTEST:				     ; ...
DOSCODE:51BC		     call    near ptr STATCHK
DOSCODE:51BF		     jnz     short GET
DOSCODE:51C1		     cmp     ss:PRINTER_FLAG, 0
DOSCODE:51C7		     jnz     short no_sys_wait
DOSCODE:51C9		     mov     ah, 5
DOSCODE:51CB		     call    IOFUNC
DOSCODE:51CE no_sys_wait:			     ; ...
DOSCODE:51CE		     mov     ah, 84h
DOSCODE:51D0		     int     2Ah	     ; Microsoft Networks - KEYBOARD BUSY LOOP
DOSCODE:51D2		     cmp     byte ptr ss:DATE_FLAG, 0FFh
DOSCODE:51D8		     jnz     short NoUpdate
DOSCODE:51DA		     push    ax
DOSCODE:51DB		     push    bx
DOSCODE:51DC		     push    cx
DOSCODE:51DD		     push    dx
DOSCODE:51DE		     push    ds
DOSCODE:51DF		     push    ss
DOSCODE:51E0		     pop     ds
DOSCODE:51E1		     mov     ax, 0
DOSCODE:51E4		     call    Save_Restore_Packet
DOSCODE:51E7		     call    READTIME
DOSCODE:51EA		     mov     ax, 1
DOSCODE:51ED		     call    Save_Restore_Packet
DOSCODE:51F0		     pop     ds
DOSCODE:51F1		     pop     dx
DOSCODE:51F2		     pop     cx
DOSCODE:51F3		     pop     bx
DOSCODE:51F4		     pop     ax
DOSCODE:51F5 NoUpdate:				     ; ...
DOSCODE:51F5		     inc     ss:DATE_FLAG
DOSCODE:51FA		     jmp     short INTEST
DOSCODE:51FC GET:				     ; ...
DOSCODE:51FC		     xor     ah, ah
DOSCODE:51FE		     call    IOFUNC
DOSCODE:5201		     pop     si
DOSCODE:5202		     pop     ds
DOSCODE:5203		     mov     ss:SCAN_FLAG, 0
DOSCODE:5209		     cmp     al, 0
DOSCODE:520B		     jnz     short noscan
DOSCODE:520D		     mov     ss:SCAN_FLAG, 1
DOSCODE:5213 noscan:				     ; ...
DOSCODE:5213		     retn
DOSCODE:5213 $STD_CON_INPUT_NO_ECHO endp ; sp-analysis failed
DOSCODE:5214 $STD_CON_STRING_OUTPUT:		     ; ...
DOSCODE:5214		     mov     si, dx
DOSCODE:5216 STRING_OUT1:			     ; ...
DOSCODE:5216		     lodsb
DOSCODE:5217		     cmp     al, '$'
DOSCODE:5219		     jz	     short noscan
DOSCODE:521B		     call    OUTT
DOSCODE:521E		     jmp     short STRING_OUT1
DOSCODE:5220 ; =============== S U B R O U T I N E =======================================
DOSCODE:5220 $STD_CON_STRING_INPUT proc	near	     ; ...
DOSCODE:5220 ; FUNCTION	CHUNK AT DOSCODE:4820 SIZE 00000019 BYTES
DOSCODE:5220 ; FUNCTION	CHUNK AT DOSCODE:52C5 SIZE 00000005 BYTES
DOSCODE:5220 ; FUNCTION	CHUNK AT DOSCODE:52F3 SIZE 00000019 BYTES
DOSCODE:5220 ; FUNCTION	CHUNK AT DOSCODE:537D SIZE 00000044 BYTES
DOSCODE:5220 ; FUNCTION	CHUNK AT DOSCODE:53F1 SIZE 00000021 BYTES
DOSCODE:5220		     mov     ax, ss
DOSCODE:5222		     mov     es, ax
DOSCODE:5224		     mov     si, dx
DOSCODE:5226		     xor     ch, ch
DOSCODE:5228		     lodsw
DOSCODE:5229		     or	     al, al
DOSCODE:522B		     jz	     short noscan
DOSCODE:522D		     mov     bl, ah
DOSCODE:522F		     mov     bh, ch
DOSCODE:5231		     cmp     al, bl
DOSCODE:5233		     jbe     short NOEDIT
DOSCODE:5235		     cmp     byte ptr [bx+si], 0Dh
DOSCODE:5238		     jz	     short EDITON
DOSCODE:523A NOEDIT:				     ; ...
DOSCODE:523A		     mov     bl, ch
DOSCODE:523C EDITON:				     ; ...
DOSCODE:523C		     mov     dl, al
DOSCODE:523E		     dec     dx
DOSCODE:523F NEWLIN:				     ; ...
DOSCODE:523F		     mov     al, ss:CARPOS
DOSCODE:5243		     mov     ss:STARTPOS, al
DOSCODE:5247		     push    si
DOSCODE:5248		     mov     di, offset	INBUF
DOSCODE:524B		     mov     ss:INSMODE, ch
DOSCODE:5250		     mov     bh, ch
DOSCODE:5252		     mov     dh, ch
DOSCODE:5254		     call    $STD_CON_INPUT_NO_ECHO
DOSCODE:5257		     cmp     al, 0Ah
DOSCODE:5259		     jnz     short GOTCH
DOSCODE:525B GETCH:				     ; ...
DOSCODE:525B		     call    $STD_CON_INPUT_NO_ECHO
DOSCODE:525E GOTCH:				     ; ...
DOSCODE:525E		     cmp     al, 6
DOSCODE:5260		     jz	     short GETCH
DOSCODE:5262		     cmp     al, cs:ESCCHAR
DOSCODE:5267		     jz	     short ESCAPE
DOSCODE:5269		     cmp     al, 7Fh
DOSCODE:526B		     jz	     short BACKSPJ
DOSCODE:526D		     cmp     al, 8
DOSCODE:526F		     jz	     short BACKSPJ
DOSCODE:5271		     cmp     al, 17h
DOSCODE:5273		     nop
DOSCODE:5274		     nop
DOSCODE:5275		     cmp     al, 15h
DOSCODE:5277		     nop
DOSCODE:5278		     nop
DOSCODE:5279		     cmp     al, 0Dh
DOSCODE:527B		     jz	     short ENDLIN
DOSCODE:527D		     cmp     al, 0Ah
DOSCODE:527F		     jz	     short PHYCRLF
DOSCODE:5281		     cmp     al, cs:CANCHAR
DOSCODE:5286		     jz	     short KILNEW
DOSCODE:5288 SAVCH:				     ; ...
DOSCODE:5288		     cmp     dh, dl
DOSCODE:528A		     jnb     short BUFFUL
DOSCODE:528C		     stosb
DOSCODE:528D		     inc     dh
DOSCODE:528F		     call    BUFOUT
DOSCODE:5292		     cmp     ss:INSMODE, 0
DOSCODE:5298		     jnz     short GETCH
DOSCODE:529A		     cmp     bh, bl
DOSCODE:529C		     jnb     short GETCH
DOSCODE:529E		     inc     si
DOSCODE:529F		     inc     bh
DOSCODE:52A1		     jmp     short GETCH
DOSCODE:52A3 BACKSPJ:				     ; ...
DOSCODE:52A3		     jmp     short BACKSP
DOSCODE:52A5 BUFFUL:				     ; ...
DOSCODE:52A5		     mov     al, 7
DOSCODE:52A7		     call    OUTT
DOSCODE:52AA		     jmp     short GETCH
DOSCODE:52AC ESCAPE:				     ; ...
DOSCODE:52AC		     jmp     OEMFunctionKey
DOSCODE:52AF ENDLIN:				     ; ...
DOSCODE:52AF		     stosb
DOSCODE:52B0		     call    OUTT
DOSCODE:52B3		     pop     di
DOSCODE:52B4		     mov     [di-1], dh
DOSCODE:52B7		     inc     dh
DOSCODE:52B7 $STD_CON_STRING_INPUT endp	; sp-analysis failed
DOSCODE:52B9 ; =============== S U B R O U T I N E =======================================
DOSCODE:52B9 COPYNEW	     proc near		     ; ...
DOSCODE:52B9		     push    ds
DOSCODE:52BA		     push    es
DOSCODE:52BB		     pop     ds
DOSCODE:52BC		     pop     es
DOSCODE:52BD		     mov     si, offset	INBUF
DOSCODE:52C0		     mov     cl, dh
DOSCODE:52C2		     rep movsb
DOSCODE:52C4 OLDBAK_RETN:			     ; ...
DOSCODE:52C4		     retn
DOSCODE:52C4 COPYNEW	     endp
DOSCODE:52C5 ; START OF	FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
DOSCODE:52C5 PHYCRLF:				     ; ...
DOSCODE:52C5		     call    CRLF
DOSCODE:52C8		     jmp     short GETCH
DOSCODE:52C8 ; END OF FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
DOSCODE:52CA LineDel:				     ; ...
DOSCODE:52CA		     or	     dh, dh
DOSCODE:52CC		     jz	     short GETCH
DOSCODE:52CE		     call    BackSpace
DOSCODE:52D1		     jmp     short LineDel
DOSCODE:52D3 WordDel:				     ; ...
DOSCODE:52D3		     call    BackSpace
DOSCODE:52D6		     or	     dh, dh
DOSCODE:52D8		     jz	     short getchj
DOSCODE:52DA		     mov     al, es:[di-1]
DOSCODE:52DE		     cmp     al, '0'
DOSCODE:52E0		     jb	     short getchj
DOSCODE:52E2		     cmp     al, '9'
DOSCODE:52E4		     jbe     short WordDel
DOSCODE:52E6		     or	     al, 20h
DOSCODE:52E8		     cmp     al, 'a'
DOSCODE:52EA		     jb	     short getchj
DOSCODE:52EC		     cmp     al, 'z'
DOSCODE:52EE		     jbe     short WordDel
DOSCODE:52F0 getchj:				     ; ...
DOSCODE:52F0		     jmp     GETCH
DOSCODE:52F3 ; START OF	FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
DOSCODE:52F3 KILNEW:				     ; ...
DOSCODE:52F3		     mov     al, '\'
DOSCODE:52F5		     call    OUTT
DOSCODE:52F8		     pop     si
DOSCODE:52F9 PUTNEW:				     ; ...
DOSCODE:52F9		     call    CRLF
DOSCODE:52FC		     mov     al, ss:STARTPOS
DOSCODE:5300		     call    TAB
DOSCODE:5303		     jmp     NEWLIN
DOSCODE:5306 BACKSP:				     ; ...
DOSCODE:5306		     call    BackSpace
DOSCODE:5309		     jmp     GETCH
DOSCODE:5309 ; END OF FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
DOSCODE:530C ; =============== S U B R O U T I N E =======================================
DOSCODE:530C BackSpace	     proc near		     ; ...
DOSCODE:530C		     or	     dh, dh
DOSCODE:530E		     jz	     short OLDBAK
DOSCODE:5310		     call    BACKUP
DOSCODE:5313		     mov     al, es:[di]
DOSCODE:5316		     cmp     al, 20h ; ' '
DOSCODE:5318		     jnb     short OLDBAK
DOSCODE:531A		     cmp     al, 9
DOSCODE:531C		     jz	     short BAKTAB
DOSCODE:531E		     cmp     al, 15h
DOSCODE:5320		     jz	     short OLDBAK
DOSCODE:5322		     cmp     al, 14h
DOSCODE:5324		     jz	     short OLDBAK
DOSCODE:5326		     call    BACKMES
DOSCODE:5329 OLDBAK:				     ; ...
DOSCODE:5329		     cmp     ss:INSMODE, 0
DOSCODE:532F		     jnz     short OLDBAK_RETN
DOSCODE:5331		     or	     bh, bh
DOSCODE:5333		     jz	     short OLDBAK_RETN
DOSCODE:5335		     dec     bh
DOSCODE:5337		     dec     si
DOSCODE:5338		     retn
DOSCODE:5339 BAKTAB:				     ; ...
DOSCODE:5339		     push    di
DOSCODE:533A		     dec     di
DOSCODE:533B		     std
DOSCODE:533C		     mov     cl, dh
DOSCODE:533E		     mov     al, 20h ; ' '
DOSCODE:5340		     push    bx
DOSCODE:5341		     mov     bl, 7
DOSCODE:5343		     jcxz    short FIGTAB
DOSCODE:5345 FNDPOS:				     ; ...
DOSCODE:5345		     scasb
DOSCODE:5346		     jbe     short CHKCNT
DOSCODE:5348		     cmp     byte ptr es:[di+1], 9
DOSCODE:534D		     jz	     short HAVTAB
DOSCODE:534F		     dec     bl
DOSCODE:5351 CHKCNT:				     ; ...
DOSCODE:5351		     loop    FNDPOS
DOSCODE:5353 FIGTAB:				     ; ...
DOSCODE:5353		     sub     bl, ss:STARTPOS
DOSCODE:5358 HAVTAB:				     ; ...
DOSCODE:5358		     sub     bl, dh
DOSCODE:535A		     add     cl, bl
DOSCODE:535C		     and     cl, 7
DOSCODE:535F		     cld
DOSCODE:5360		     pop     bx
DOSCODE:5361		     pop     di
DOSCODE:5362		     jz	     short OLDBAK
DOSCODE:5364 TABBAK:				     ; ...
DOSCODE:5364		     call    BACKMES
DOSCODE:5367		     loop    TABBAK
DOSCODE:5369		     jmp     short OLDBAK
DOSCODE:5369 BackSpace	     endp
DOSCODE:536B ; =============== S U B R O U T I N E =======================================
DOSCODE:536B BACKUP	     proc near		     ; ...
DOSCODE:536B		     dec     dh
DOSCODE:536D		     dec     di
DOSCODE:536D BACKUP	     endp ; sp-analysis	failed
DOSCODE:536E ; =============== S U B R O U T I N E =======================================
DOSCODE:536E BACKMES	     proc near		     ; ...
DOSCODE:536E		     mov     al, 8
DOSCODE:5370		     call    OUTT
DOSCODE:5373		     mov     al, 20h ; ' '
DOSCODE:5375		     call    OUTT
DOSCODE:5378		     mov     al, 8
DOSCODE:537A		     jmp     OUTT
DOSCODE:537A BACKMES	     endp
DOSCODE:537D ; START OF	FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
DOSCODE:537D TWOESC:				     ; ...
DOSCODE:537D		     mov     al, cs:ESCCHAR
DOSCODE:5381		     jmp     SAVCH
DOSCODE:5384 COPYLIN:				     ; ...
DOSCODE:5384		     mov     cl, bl
DOSCODE:5386		     sub     cl, bh
DOSCODE:5388		     jmp     short COPYEACH
DOSCODE:538A COPYSTR:				     ; ...
DOSCODE:538A		     call    FINDOLD
DOSCODE:538D		     jmp     short COPYEACH
DOSCODE:538F COPYONE:				     ; ...
DOSCODE:538F		     mov     cl, 1
DOSCODE:5391 COPYEACH:				     ; ...
DOSCODE:5391		     mov     ss:INSMODE, 0
DOSCODE:5397		     cmp     dh, dl
DOSCODE:5399		     jz	     short GETCH2
DOSCODE:539B		     cmp     bh, bl
DOSCODE:539D		     jz	     short GETCH2
DOSCODE:539F		     lodsb
DOSCODE:53A0		     stosb
DOSCODE:53A1		     call    BUFOUT
DOSCODE:53A4		     inc     bh
DOSCODE:53A6		     inc     dh
DOSCODE:53A8		     loop    COPYEACH
DOSCODE:53AA GETCH2:				     ; ...
DOSCODE:53AA		     jmp     GETCH
DOSCODE:53AD SKIPONE:				     ; ...
DOSCODE:53AD		     cmp     bh, bl
DOSCODE:53AF		     jz	     short GETCH2
DOSCODE:53B1		     inc     bh
DOSCODE:53B3		     inc     si
DOSCODE:53B4		     jmp     GETCH
DOSCODE:53B7 SKIPSTR:				     ; ...
DOSCODE:53B7		     call    FINDOLD
DOSCODE:53BA		     add     si, cx
DOSCODE:53BC		     add     bh, cl
DOSCODE:53BE		     jmp     GETCH
DOSCODE:53BE ; END OF FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
DOSCODE:53C1 ; =============== S U B R O U T I N E =======================================
DOSCODE:53C1 FINDOLD	     proc near		     ; ...
DOSCODE:53C1		     call    $STD_CON_INPUT_NO_ECHO
DOSCODE:53C4		     cmp     al, cs:ESCCHAR
DOSCODE:53C9		     jnz     short FINDSETUP
DOSCODE:53CB		     call    $STD_CON_INPUT_NO_ECHO
DOSCODE:53CE		     jmp     short NOTFND
DOSCODE:53D0 FINDSETUP:				     ; ...
DOSCODE:53D0		     mov     cl, bl
DOSCODE:53D2		     sub     cl, bh
DOSCODE:53D4		     jz	     short NOTFND
DOSCODE:53D6		     dec     cx
DOSCODE:53D7		     jz	     short NOTFND
DOSCODE:53D9		     push    es
DOSCODE:53DA		     push    ds
DOSCODE:53DB		     pop     es
DOSCODE:53DC		     push    di
DOSCODE:53DD		     mov     di, si
DOSCODE:53DF		     inc     di
DOSCODE:53E0		     repne scasb
DOSCODE:53E2		     pop     di
DOSCODE:53E3		     pop     es
DOSCODE:53E4		     jnz     short NOTFND
DOSCODE:53E6		     not     cl
DOSCODE:53E8		     add     cl, bl
DOSCODE:53EA		     sub     cl, bh
DOSCODE:53EC FINDOLD_RETN:			     ; ...
DOSCODE:53EC		     retn
DOSCODE:53ED NOTFND:				     ; ...
DOSCODE:53ED		     pop     bp
DOSCODE:53EE		     jmp     GETCH
DOSCODE:53EE FINDOLD	     endp ; sp-analysis	failed
DOSCODE:53F1 ; START OF	FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
DOSCODE:53F1 REEDIT:				     ; ...
DOSCODE:53F1		     mov     al, '@'
DOSCODE:53F3		     call    OUTT
DOSCODE:53F6		     pop     di
DOSCODE:53F7		     push    di
DOSCODE:53F8		     push    es
DOSCODE:53F9		     push    ds
DOSCODE:53FA		     call    COPYNEW
DOSCODE:53FD		     pop     ds
DOSCODE:53FE		     pop     es
DOSCODE:53FF		     pop     si
DOSCODE:5400		     mov     bl, dh
DOSCODE:5402		     jmp     PUTNEW
DOSCODE:5405 EXITINS_ENTERINS:			     ; ...
DOSCODE:5405		     not     ss:INSMODE
DOSCODE:540A		     jmp     GETCH
DOSCODE:540D CTRLZ:				     ; ...
DOSCODE:540D		     mov     al, 1Ah
DOSCODE:540F		     jmp     SAVCH
DOSCODE:540F ; END OF FUNCTION CHUNK FOR $STD_CON_STRING_INPUT
DOSCODE:5412 ; =============== S U B R O U T I N E =======================================
DOSCODE:5412 CRLF	     proc near		     ; ...
DOSCODE:5412		     mov     al, 0Dh
DOSCODE:5414		     call    OUTT
DOSCODE:5417		     mov     al, 0Ah
DOSCODE:5419		     jmp     OUTT
DOSCODE:5419 CRLF	     endp
DOSCODE:541C $RAW_CON_IO:			     ; ...
DOSCODE:541C		     mov     al, dl
DOSCODE:541E		     cmp     al, 0FFh
DOSCODE:5420		     jz	     short rcio1
DOSCODE:5422		     jmp     short RAWOUT
DOSCODE:5424		     nop
DOSCODE:5425 rcio1:				     ; ...
DOSCODE:5425		     les     di, dword ptr ss:USER_SP
DOSCODE:542A		     xor     bx, bx
DOSCODE:542C		     call    GET_IO_SFT
DOSCODE:542F		     jb	     short FINDOLD_RETN
DOSCODE:5431		     mov     ah, 1
DOSCODE:5433		     call    IOFUNC
DOSCODE:5436		     jnz     short RESFLG
DOSCODE:5438		     call    SPOOLINT
DOSCODE:543B		     or	     byte ptr es:[di+16h], 40h
DOSCODE:5440		     xor     al, al
DOSCODE:5442 RET17:				     ; ...
DOSCODE:5442		     retn
DOSCODE:5443 RESFLG:				     ; ...
DOSCODE:5443		     and     byte ptr es:[di+16h], 0BFh
DOSCODE:5448 rci0:				     ; ...
DOSCODE:5448		     call    SPOOLINT
DOSCODE:544B $RAW_CON_INPUT:			     ; ...
DOSCODE:544B		     push    bx
DOSCODE:544C		     xor     bx, bx
DOSCODE:544E		     call    GET_IO_SFT
DOSCODE:5451		     pop     bx
DOSCODE:5452		     jb	     short RET17
DOSCODE:5454		     mov     ah, 1
DOSCODE:5456		     call    IOFUNC
DOSCODE:5459		     jnz     short rci5
DOSCODE:545B		     mov     ah, 84h
DOSCODE:545D		     int     2Ah	     ; Microsoft Networks - KEYBOARD BUSY LOOP
DOSCODE:545F		     jmp     short rci0
DOSCODE:5461 rci5:				     ; ...
DOSCODE:5461		     xor     ah, ah
DOSCODE:5463		     call    IOFUNC
DOSCODE:5466		     retn
DOSCODE:5467 ; =============== S U B R O U T I N E =======================================
DOSCODE:5467 RAWOUT	     proc near		     ; ...
DOSCODE:5467		     push    bx
DOSCODE:5468		     mov     bx, 1
DOSCODE:546B		     call    GET_IO_SFT
DOSCODE:546E		     jb	     short RAWRET1
DOSCODE:5470		     mov     bx, [si+5]
DOSCODE:5473		     and     bx, 8080h
DOSCODE:5477		     cmp     bx, 80h ; ''
DOSCODE:547B		     jnz     short RAWNORM
DOSCODE:547D		     push    ds
DOSCODE:547E		     lds     bx, [si+7]
DOSCODE:5481		     test    byte ptr [bx+4], 10h
DOSCODE:5485		     pop     ds
DOSCODE:5486		     jz	     short RAWNORM
DOSCODE:5488		     int     29h	     ; DOS 2+ internal - FAST PUTCHAR
DOSCODE:5488					     ; AL = character to display
DOSCODE:548A RAWRET:				     ; ...
DOSCODE:548A		     clc
DOSCODE:548B RAWRET1:				     ; ...
DOSCODE:548B		     pop     bx
DOSCODE:548C RAWRET2:				     ; ...
DOSCODE:548C		     retn
DOSCODE:548D RAWNORM:				     ; ...
DOSCODE:548D		     call    RAWOUT3
DOSCODE:5490		     jmp     short RAWRET
DOSCODE:5490 RAWOUT	     endp
DOSCODE:5492 ; =============== S U B R O U T I N E =======================================
DOSCODE:5492 RAWOUT2	     proc near		     ; ...
DOSCODE:5492		     call    GET_IO_SFT
DOSCODE:5495		     jb	     short RAWRET2
DOSCODE:5495 RAWOUT2	     endp ; sp-analysis	failed
DOSCODE:5497 ; =============== S U B R O U T I N E =======================================
DOSCODE:5497 RAWOUT3	     proc near		     ; ...
DOSCODE:5497		     push    ax
DOSCODE:5498		     jmp     short RAWOSTRT
DOSCODE:549A ROLP:				     ; ...
DOSCODE:549A		     call    SPOOLINT
DOSCODE:549D		     or	     ss:DOS34_FLAG, 200h
DOSCODE:54A4		     call    near ptr DSKSTATCHK
DOSCODE:54A7 RAWOSTRT:				     ; ...
DOSCODE:54A7		     mov     ah, 3
DOSCODE:54A9		     call    IOFUNC
DOSCODE:54AC		     jz	     short ROLP
DOSCODE:54AE		     inc     ax
DOSCODE:54AF		     pop     ax
DOSCODE:54B0		     jz	     short nosend
DOSCODE:54B2		     mov     ah, 2
DOSCODE:54B4		     call    IOFUNC
DOSCODE:54B7 nosend:				     ; ...
DOSCODE:54B7		     clc
DOSCODE:54B8		     retn
DOSCODE:54B8 RAWOUT3	     endp
DOSCODE:54B9 ; =============== S U B R O U T I N E =======================================
DOSCODE:54B9 Save_Restore_Packet proc near	     ; ...
DOSCODE:54B9		     push    ds
DOSCODE:54BA		     push    es
DOSCODE:54BB		     push    si
DOSCODE:54BC		     push    di
DOSCODE:54BD		     cmp     ax, 0
DOSCODE:54C0		     jz	     short save_packet
DOSCODE:54C2 restore_packet:
DOSCODE:54C2		     mov     si, offset	FAKE_STACK_2F
DOSCODE:54C5		     mov     di, offset	DEVCALL
DOSCODE:54C8		     jmp     short set_seg
DOSCODE:54CA save_packet:			     ; ...
DOSCODE:54CA		     mov     di, offset	FAKE_STACK_2F
DOSCODE:54CD		     mov     si, offset	DEVCALL
DOSCODE:54D0 set_seg:				     ; ...
DOSCODE:54D0		     mov     ax, ss
DOSCODE:54D2		     mov     ds, ax
DOSCODE:54D4		     mov     es, ax
DOSCODE:54D6		     mov     cx, 11
DOSCODE:54D9		     rep movsw
DOSCODE:54DB		     pop     di
DOSCODE:54DC		     pop     si
DOSCODE:54DD		     pop     es
DOSCODE:54DE		     pop     ds
DOSCODE:54DF		     retn
DOSCODE:54DF Save_Restore_Packet endp
DOSCODE:54E0 $STD_CON_INPUT:			     ; ...
DOSCODE:54E0		     call    $STD_CON_INPUT_NO_ECHO
DOSCODE:54E3		     push    ax
DOSCODE:54E4		     call    OUTT
DOSCODE:54E7		     pop     ax
DOSCODE:54E8 ; =============== S U B R O U T I N E =======================================
DOSCODE:54E8 CON_INPUT_RETN  proc near		     ; ...
DOSCODE:54E8		     retn
DOSCODE:54E8 CON_INPUT_RETN  endp
DOSCODE:54E9 $STD_CON_OUTPUT:			     ; ...
DOSCODE:54E9		     mov     al, dl
DOSCODE:54EB ; =============== S U B R O U T I N E =======================================
DOSCODE:54EB OUTT	     proc near		     ; ...
DOSCODE:54EB ; FUNCTION	CHUNK AT DOSCODE:556F SIZE 00000008 BYTES
DOSCODE:54EB ; FUNCTION	CHUNK AT DOSCODE:557A SIZE 00000008 BYTES
DOSCODE:54EB ; FUNCTION	CHUNK AT DOSCODE:55CF SIZE 00000007 BYTES
DOSCODE:54EB		     cmp     al, 20h
DOSCODE:54ED		     jb	     short CTRLOUT
DOSCODE:54EF		     cmp     al, 7Fh
DOSCODE:54F1		     jz	     short OUTCH
DOSCODE:54F3		     inc     ss:CARPOS
DOSCODE:54F8 OUTCH:				     ; ...
DOSCODE:54F8		     push    ds
DOSCODE:54F9		     push    si
DOSCODE:54FA		     inc     ss:CHARCO
DOSCODE:54FF		     and     ss:CHARCO,	3Fh
DOSCODE:5505		     jnz     short OUTSKIP
DOSCODE:5507		     push    ax
DOSCODE:5508		     call    near ptr STATCHK
DOSCODE:550B		     pop     ax
DOSCODE:550C OUTSKIP:				     ; ...
DOSCODE:550C		     call    RAWOUT
DOSCODE:550F		     pop     si
DOSCODE:5510		     pop     ds
DOSCODE:5511		     test    ss:PFLAG, 0FFh
DOSCODE:5517		     jz	     short CON_INPUT_RETN
DOSCODE:5519		     push    bx
DOSCODE:551A		     push    ds
DOSCODE:551B		     push    si
DOSCODE:551C		     mov     bx, 1
DOSCODE:551F		     call    GET_IO_SFT
DOSCODE:5522		     jb	     short TRIPOPJ
DOSCODE:5524		     mov     bx, [si+5]
DOSCODE:5527		     test    bh, 80h
DOSCODE:552A		     jnz     short TRIPOPJ
DOSCODE:552C		     test    bl, 80h
DOSCODE:552F		     jz	     short TRIPOPJ
DOSCODE:5531		     mov     bx, 4
DOSCODE:5534		     call    GET_IO_SFT
DOSCODE:5537		     jb	     short TRIPOPJ
DOSCODE:5539		     test    byte ptr [si+6], 8
DOSCODE:553D		     jz	     short LISSTRT2J
DOSCODE:553F		     mov     ss:PFLAG, 0
DOSCODE:5545 TRIPOPJ:				     ; ...
DOSCODE:5545		     jmp     TRIPOP
DOSCODE:5548 LISSTRT2J:				     ; ...
DOSCODE:5548		     jmp     LISSTRT2
DOSCODE:554B CTRLOUT:				     ; ...
DOSCODE:554B		     cmp     al, 0Dh
DOSCODE:554D		     jz	     short ZERPOS
DOSCODE:554F		     cmp     al, 8
DOSCODE:5551		     jz	     short BACKPOS
DOSCODE:5553		     cmp     al, 9
DOSCODE:5555		     jnz     short OUTCH
DOSCODE:5557		     mov     al, ss:CARPOS
DOSCODE:555B		     or	     al, 0F8h
DOSCODE:555D		     neg     al
DOSCODE:555D OUTT	     endp ; sp-analysis	failed
DOSCODE:555F ; =============== S U B R O U T I N E =======================================
DOSCODE:555F TAB	     proc near		     ; ...
DOSCODE:555F		     push    cx
DOSCODE:5560		     mov     cl, al
DOSCODE:5562		     mov     ch, 0
DOSCODE:5564		     jcxz    short POPTAB
DOSCODE:5566 TABLP:				     ; ...
DOSCODE:5566		     mov     al, ' '
DOSCODE:5568		     call    OUTT
DOSCODE:556B		     loop    TABLP
DOSCODE:556D POPTAB:				     ; ...
DOSCODE:556D		     pop     cx
DOSCODE:556E		     retn
DOSCODE:556E TAB	     endp
DOSCODE:556F ; START OF	FUNCTION CHUNK FOR OUTT
DOSCODE:556F ZERPOS:				     ; ...
DOSCODE:556F		     mov     ss:CARPOS,	0
DOSCODE:5575		     jmp     short OUTCH
DOSCODE:5575 ; END OF FUNCTION CHUNK FOR OUTT
DOSCODE:5577 OUTJ:				     ; ...
DOSCODE:5577		     jmp     OUTT
DOSCODE:557A ; START OF	FUNCTION CHUNK FOR OUTT
DOSCODE:557A BACKPOS:				     ; ...
DOSCODE:557A		     dec     ss:CARPOS
DOSCODE:557F		     jmp     OUTCH
DOSCODE:557F ; END OF FUNCTION CHUNK FOR OUTT
DOSCODE:5582 ; =============== S U B R O U T I N E =======================================
DOSCODE:5582 BUFOUT	     proc near		     ; ...
DOSCODE:5582		     cmp     al, ' '
DOSCODE:5584		     jnb     short OUTJ
DOSCODE:5586		     cmp     al, 9
DOSCODE:5588		     jz	     short OUTJ
DOSCODE:558A		     cmp     al, 15h
DOSCODE:558C		     jz	     short CTRLU
DOSCODE:558E		     cmp     al, 14h
DOSCODE:5590		     jz	     short CTRLU
DOSCODE:5592 NOT_CTRLU:
DOSCODE:5592		     push    ax
DOSCODE:5593		     mov     al, '^'
DOSCODE:5595		     call    OUTT
DOSCODE:5598		     pop     ax
DOSCODE:5599		     or	     al, 40h
DOSCODE:559B CTRLU:				     ; ...
DOSCODE:559B		     call    OUTT
DOSCODE:559E BUFOUT_RETN:			     ; ...
DOSCODE:559E		     retn
DOSCODE:559E BUFOUT	     endp
DOSCODE:559F $STD_AUX_INPUT:			     ; ...
DOSCODE:559F		     call    near ptr STATCHK
DOSCODE:55A2		     mov     bx, 3
DOSCODE:55A5		     call    GET_IO_SFT
DOSCODE:55A8		     jb	     short BUFOUT_RETN
DOSCODE:55AA		     jmp     short TAISTRT
DOSCODE:55AC AUXILP:				     ; ...
DOSCODE:55AC		     call    SPOOLINT
DOSCODE:55AF TAISTRT:				     ; ...
DOSCODE:55AF		     mov     ah, 1
DOSCODE:55B1		     call    IOFUNC
DOSCODE:55B4		     jz	     short AUXILP
DOSCODE:55B6		     xor     ah, ah
DOSCODE:55B8		     call    IOFUNC
DOSCODE:55BB		     retn
DOSCODE:55BC $STD_AUX_OUTPUT:			     ; ...
DOSCODE:55BC		     push    bx
DOSCODE:55BD		     mov     bx, 3
DOSCODE:55C0		     jmp     short SENDOUT
DOSCODE:55C2 $STD_PRINTER_OUTPUT:		     ; ...
DOSCODE:55C2		     push    bx
DOSCODE:55C3		     mov     bx, 4
DOSCODE:55C6 SENDOUT:				     ; ...
DOSCODE:55C6		     mov     al, dl
DOSCODE:55C8		     push    ax
DOSCODE:55C9		     call    near ptr STATCHK
DOSCODE:55CC		     pop     ax
DOSCODE:55CD		     push    ds
DOSCODE:55CE		     push    si
DOSCODE:55CF ; START OF	FUNCTION CHUNK FOR OUTT
DOSCODE:55CF LISSTRT2:				     ; ...
DOSCODE:55CF		     call    RAWOUT2
DOSCODE:55D2 TRIPOP:				     ; ...
DOSCODE:55D2		     pop     si
DOSCODE:55D3		     pop     ds
DOSCODE:55D4		     pop     bx
DOSCODE:55D5 SCIS_RETN:				     ; ...
DOSCODE:55D5		     retn
DOSCODE:55D5 ; END OF FUNCTION CHUNK FOR OUTT
DOSCODE:55D6 $STD_CON_INPUT_STATUS:		     ; ...
DOSCODE:55D6		     call    near ptr STATCHK
DOSCODE:55D9		     mov     al, 0
DOSCODE:55DB		     jz	     short SCIS_RETN
DOSCODE:55DD		     or	     al, 0FFh
DOSCODE:55DF		     retn
DOSCODE:55E0 $STD_CON_INPUT_FLUSH:		     ; ...
DOSCODE:55E0		     push    ax
DOSCODE:55E1		     push    dx
DOSCODE:55E2		     xor     bx, bx
DOSCODE:55E4		     call    GET_IO_SFT
DOSCODE:55E7		     jb	     short BADJFNCON
DOSCODE:55E9		     mov     ah, 4
DOSCODE:55EB		     call    IOFUNC
DOSCODE:55EE BADJFNCON:				     ; ...
DOSCODE:55EE		     pop     dx
DOSCODE:55EF		     pop     ax
DOSCODE:55F0		     mov     ah, al
DOSCODE:55F2		     cmp     al, 1
DOSCODE:55F4		     jz	     short REDISPJ
DOSCODE:55F6		     cmp     al, 6
DOSCODE:55F8		     jz	     short REDISPJ
DOSCODE:55FA		     cmp     al, 7
DOSCODE:55FC		     jz	     short REDISPJ
DOSCODE:55FE		     cmp     al, 8
DOSCODE:5600		     jz	     short REDISPJ
DOSCODE:5602		     cmp     al, 0Ah
DOSCODE:5604		     jz	     short REDISPJ
DOSCODE:5606		     mov     al, 0
DOSCODE:5608		     retn
DOSCODE:5609 REDISPJ:				     ; ...
DOSCODE:5609		     cli
DOSCODE:560A		     jmp     REDISP
DOSCODE:560D $GET_FCB_POSITION:			     ; ...
DOSCODE:560D		     call    GetExtended
DOSCODE:5610		     call    GetExtent
DOSCODE:5613		     mov     [si+21h], ax
DOSCODE:5616		     mov     [si+23h], dl
DOSCODE:5619		     cmp     word ptr [si+0Eh],	64
DOSCODE:561D		     jnb     short GetFCBBye
DOSCODE:561F		     mov     [si+24h], dh
DOSCODE:5622 GetFCBBye:				     ; ...
DOSCODE:5622		     jmp     NO_OP
DOSCODE:5625 $FCB_DELETE:			     ; ...
DOSCODE:5625		     mov     di, offset	OPENBUF
DOSCODE:5628		     call    TransFCB
DOSCODE:562B		     jb	     short BadPath
DOSCODE:562D		     push    ss
DOSCODE:562E		     pop     ds
DOSCODE:562F		     call    DOS_DELETE
DOSCODE:5632		     jb	     short BadPath
DOSCODE:5634 GoodPath:				     ; ...
DOSCODE:5634		     jmp     short GetFCBBye
DOSCODE:5636 BadPath:				     ; ...
DOSCODE:5636		     jmp     FCB_RET_ERR
DOSCODE:5639 $GET_FCB_FILE_LENGTH:		     ; ...
DOSCODE:5639		     call    GetExtended
DOSCODE:563C		     mov     di, offset	OPENBUF
DOSCODE:563F		     push    ds
DOSCODE:5640		     push    si
DOSCODE:5641		     call    TransFCB
DOSCODE:5644		     pop     si
DOSCODE:5645		     pop     ds
DOSCODE:5646		     jb	     short BadPath
DOSCODE:5648		     push    ds
DOSCODE:5649		     push    si
DOSCODE:564A		     push    ss
DOSCODE:564B		     pop     ds
DOSCODE:564C		     call    GET_FILE_INFO
DOSCODE:564F		     pop     si
DOSCODE:5650		     pop     ds
DOSCODE:5651		     jb	     short BadPath
DOSCODE:5653		     mov     dx, bx
DOSCODE:5655		     mov     ax, di
DOSCODE:5657		     mov     bx, [si+0Eh]
DOSCODE:565A		     or	     bx, bx
DOSCODE:565C		     jnz     short GetSize
DOSCODE:565E		     mov     bx, 128
DOSCODE:5661 GetSize:				     ; ...
DOSCODE:5661		     mov     di, ax
DOSCODE:5663		     mov     ax, dx
DOSCODE:5665		     xor     dx, dx
DOSCODE:5667		     div     bx
DOSCODE:5669		     push    ax
DOSCODE:566A		     mov     ax, di
DOSCODE:566C		     div     bx
DOSCODE:566E		     mov     cx, dx
DOSCODE:5670		     pop     dx
DOSCODE:5671		     jcxz    short LengthStore
DOSCODE:5673		     add     ax, 1
DOSCODE:5676		     adc     dx, 0
DOSCODE:5679 LengthStore:			     ; ...
DOSCODE:5679		     mov     [si+21h], ax
DOSCODE:567C		     mov     [si+23h], dl
DOSCODE:567F		     or	     dh, dh
DOSCODE:5681		     jz	     short GoodPath
DOSCODE:5683		     mov     [si+24h], dh
DOSCODE:5686 GoodRet:				     ; ...
DOSCODE:5686		     jmp     short GoodPath
DOSCODE:5688 $FCB_CLOSE:			     ; ...
DOSCODE:5688		     xor     al, al
DOSCODE:568A		     call    GetExtended
DOSCODE:568D		     jz	     short NoAttr
DOSCODE:568F		     mov     al, [si-1]
DOSCODE:5692 NoAttr:				     ; ...
DOSCODE:5692		     mov     ss:ATTRIB,	al
DOSCODE:5696		     call    SFTFromFCB
DOSCODE:5699		     jb	     short GoodRet
DOSCODE:569B		     mov     al, es:[di+4]
DOSCODE:569F		     xor     ah, ah
DOSCODE:56A1		     push    ax
DOSCODE:56A2		     call    CheckShare
DOSCODE:56A5		     jnz     short NoStash
DOSCODE:56A7		     mov     al, ss:ATTRIB
DOSCODE:56AB		     mov     es:[di+4],	al
DOSCODE:56AF NoStash:				     ; ...
DOSCODE:56AF		     mov     ax, [si+14h]
DOSCODE:56B2		     mov     es:[di+0Fh], ax
DOSCODE:56B6		     mov     ax, [si+16h]
DOSCODE:56B9		     mov     es:[di+0Dh], ax
DOSCODE:56BD		     mov     ax, [si+10h]
DOSCODE:56C0		     mov     es:[di+11h], ax
DOSCODE:56C4		     mov     ax, [si+12h]
DOSCODE:56C7		     mov     es:[di+13h], ax
DOSCODE:56CB		     or	     word ptr es:[di+5], 4000h
DOSCODE:56D1		     push    ss
DOSCODE:56D2		     pop     ds
DOSCODE:56D3		     call    DOS_CLOSE
DOSCODE:56D6		     les     di, ds:THISSFT
DOSCODE:56DA		     pop     cx
DOSCODE:56DB		     mov     es:[di+4],	cl
DOSCODE:56DF		     pushf
DOSCODE:56E0		     cmp     word ptr es:[di], 0
DOSCODE:56E4		     jnz     short CloseOK
DOSCODE:56E6		     push    ax
DOSCODE:56E7		     mov     al, 'M'
DOSCODE:56E9		     call    BlastSFT
DOSCODE:56EC		     pop     ax
DOSCODE:56ED CloseOK:				     ; ...
DOSCODE:56ED		     popf
DOSCODE:56EE		     jnb     short GoodRet
DOSCODE:56F0		     cmp     al, 6
DOSCODE:56F2		     jz	     short GoodRet
DOSCODE:56F4		     mov     al, 2
DOSCODE:56F6 jmp_to_FCB_RET_ERR:		     ; ...
DOSCODE:56F6		     jmp     FCB_RET_ERR
DOSCODE:56F9 $FCB_RENAME:			     ; ...
DOSCODE:56F9		     call    GetExtended
DOSCODE:56FC		     push    dx
DOSCODE:56FD		     mov     al, [si]
DOSCODE:56FF		     add     si, 10h
DOSCODE:5702		     mov     di, offset	RENBUF
DOSCODE:5705		     push    word ptr [si]
DOSCODE:5707		     push    ds
DOSCODE:5708		     push    si
DOSCODE:5709		     mov     [si], al
DOSCODE:570B		     mov     dx, si
DOSCODE:570D		     call    TransFCB
DOSCODE:5710		     pop     si
DOSCODE:5711		     pop     ds
DOSCODE:5712		     pop     word ptr [si]
DOSCODE:5714		     pop     dx
DOSCODE:5715		     jb	     short fren90
DOSCODE:5717		     mov     si, ss:WFP_START
DOSCODE:571C		     mov     ss:REN_WFP, si
DOSCODE:5721		     mov     di, offset	OPENBUF
DOSCODE:5724		     call    TransFCB
DOSCODE:5727		     jb	     short fren90
DOSCODE:5729		     call    DOS_RENAME
DOSCODE:572C		     jb	     short fren90
DOSCODE:572E		     jmp     NO_OP
DOSCODE:5731 fren90:				     ; ...
DOSCODE:5731		     jmp     short jmp_to_FCB_RET_ERR
DOSCODE:5733 ; =============== S U B R O U T I N E =======================================
DOSCODE:5733 SaveFCBInfo     proc near		     ; ...
DOSCODE:5733		     les     di, ss:THISSFT
DOSCODE:5738		     call    IsSFTNet
DOSCODE:573B		     jz	     short SaveLocal
DOSCODE:573D		     mov     ax, es:[di+0Bh]
DOSCODE:5741		     mov     [si+1Ch], ax
DOSCODE:5744		     mov     bl, 80h ; ''
DOSCODE:5746		     jmp     short SaveSFN
DOSCODE:5748 SaveLocal:				     ; ...
DOSCODE:5748		     call    CheckShare
DOSCODE:574B		     jz	     short SaveNoShare
DOSCODE:574D		     jmp     short SaveShare
DOSCODE:574F SaveNoShare:			     ; ...
DOSCODE:574F		     test    byte ptr es:[di+5], 80h
DOSCODE:5754		     jnz     short SaveNoShareDev
DOSCODE:5756		     mov     ax, es:[di+1Bh]
DOSCODE:575A		     mov     [si+1Dh], ax
DOSCODE:575D		     mov     ax, es:[di+1Dh]
DOSCODE:5761		     mov     bl, es:[di+4]
DOSCODE:5765		     mov     bh, bl
DOSCODE:5767		     ror     bl, 1
DOSCODE:5769		     shl     bh, 1
DOSCODE:576B		     or	     bl, bh
DOSCODE:576D		     and     bl, 0C0h
DOSCODE:5770		     or	     al, bl
DOSCODE:5772		     mov     [si+18h], al
DOSCODE:5775		     mov     al, es:[di+1Fh]
DOSCODE:5779		     mov     [si+1Fh], al
DOSCODE:577C		     mov     ax, es:[di+0Bh]
DOSCODE:5780		     mov     [si+1Bh], ax
DOSCODE:5783		     mov     bl, 0
DOSCODE:5785 SetFCBBits:			     ; ...
DOSCODE:5785		     mov     ax, es:[di+5]
DOSCODE:5789		     and     al, 0C0h
DOSCODE:578B		     or	     al, es:[di+2]
DOSCODE:578F		     mov     [si+1Ah], al
DOSCODE:5792		     or	     bl, bl
DOSCODE:5794		     jz	     short SaveNoSFN
DOSCODE:5796		     jmp     short SaveSFN
DOSCODE:5798 SaveNoShareDev:			     ; ...
DOSCODE:5798		     mov     ax, es:[di+7]
DOSCODE:579C		     mov     [si+1Ah], ax
DOSCODE:579F		     mov     ax, es:[di+9]
DOSCODE:57A3		     mov     [si+1Ch], ax
DOSCODE:57A6		     mov     bl, 40h ; '@'
DOSCODE:57A8		     jmp     short SetFCBBits
DOSCODE:57AA SaveShare:				     ; ...
DOSCODE:57AA		     call    ss:ShSave
DOSCODE:57AF SaveSFN:				     ; ...
DOSCODE:57AF		     lea     ax, [di-6]
DOSCODE:57B2		     sub     ax, word ptr ss:SFTFCB
DOSCODE:57B7		     push    bx
DOSCODE:57B8		     mov     bl, 59
DOSCODE:57BA		     div     bl
DOSCODE:57BC		     mov     [si+18h], al
DOSCODE:57BF		     pop     bx
DOSCODE:57C0 SaveNoSFN:				     ; ...
DOSCODE:57C0		     mov     ax, es:[di+5]
DOSCODE:57C4		     and     al, 3Fh
DOSCODE:57C6		     or	     al, bl
DOSCODE:57C8		     mov     [si+19h], al
DOSCODE:57CB		     mov     ax, ss:FCBLRU
DOSCODE:57CF		     inc     ax
DOSCODE:57D0		     mov     es:[di+15h], ax
DOSCODE:57D4		     jnz     short SimpleStuff
DOSCODE:57D6		     mov     bx, 15h
DOSCODE:57D9		     call    ResetLRU
DOSCODE:57DC SimpleStuff:			     ; ...
DOSCODE:57DC		     mov     ss:FCBLRU,	ax
DOSCODE:57E0		     retn
DOSCODE:57E0 SaveFCBInfo     endp
DOSCODE:57E1 ; =============== S U B R O U T I N E =======================================
DOSCODE:57E1 ResetLRU	     proc near		     ; ...
DOSCODE:57E1		     mov     ax, 8000h
DOSCODE:57E4		     push    es
DOSCODE:57E5		     push    di
DOSCODE:57E6		     les     di, ss:SFTFCB
DOSCODE:57EB		     mov     cx, es:[di+4]
DOSCODE:57EF		     lea     di, [di+6]
DOSCODE:57F2 ovScan:				     ; ...
DOSCODE:57F2		     sub     es:[bx+di], ax
DOSCODE:57F5		     ja	     short ovLoop
DOSCODE:57F7		     mov     es:[bx+di], ax
DOSCODE:57FA ovLoop:				     ; ...
DOSCODE:57FA		     add     di, 59
DOSCODE:57FD		     loop    ovScan
DOSCODE:57FF		     pop     di
DOSCODE:5800		     pop     es
DOSCODE:5801		     mov     es:[bx+di], ax
DOSCODE:5804		     retn
DOSCODE:5804 ResetLRU	     endp
DOSCODE:5805 ; =============== S U B R O U T I N E =======================================
DOSCODE:5805 LRUFCB	     proc near		     ; ...
DOSCODE:5805		     push    es
DOSCODE:5806		     call    save_world
DOSCODE:5809		     mov     ds, cs:DosDSeg
DOSCODE:580E		     or	     al, al
DOSCODE:5810		     jnz     short lru1
DOSCODE:5812		     mov     di, word ptr ds:LocalSFT
DOSCODE:5816		     or	     di, word ptr ds:LocalSFT+2
DOSCODE:581A		     jz	     short lru1
DOSCODE:581C		     les     di, ds:LocalSFT
DOSCODE:5820 gotlocalSFT:			     ; ...
DOSCODE:5820		     mov     word ptr ds:THISSFT, di
DOSCODE:5824		     mov     word ptr ds:THISSFT+2, es
DOSCODE:5828		     clc
DOSCODE:5829		     jmp     LRUDone
DOSCODE:582C lru1:				     ; ...
DOSCODE:582C		     les     di, ds:SFTFCB
DOSCODE:5830		     mov     cx, es:[di+4]
DOSCODE:5834		     lea     di, [di+6]
DOSCODE:5837		     mov     bx, 0FFFFh
DOSCODE:583A		     mov     si, bx
DOSCODE:583C		     mov     dx, bx
DOSCODE:583E		     mov     bp, bx
DOSCODE:5840 findSFT:				     ; ...
DOSCODE:5840		     or	     word ptr es:[di], 0
DOSCODE:5844		     jz	     short gotSFT
DOSCODE:5846		     cmp     word ptr es:[di], 0FFFFh
DOSCODE:584A		     jz	     short gotSFT
DOSCODE:584C		     test    word ptr es:[di+5], 8000h
DOSCODE:5852		     jnz     short lru5
DOSCODE:5854		     call    CheckShare
DOSCODE:5857		     jnz     short lru5
DOSCODE:5859 hackpoint:				     ; ...
DOSCODE:5859		     mov     word ptr ds:LocalSFT, di
DOSCODE:585D		     mov     word ptr ds:LocalSFT+2, es
DOSCODE:5861		     or	     al, al
DOSCODE:5863		     jz	     short gotlocalSFT
DOSCODE:5865		     cmp     es:[di+15h], bx
DOSCODE:5869		     jnb     short lru4
DOSCODE:586B		     mov     bx, es:[di+15h]
DOSCODE:586F		     mov     si, di
DOSCODE:5871 lru4:				     ; ...
DOSCODE:5871		     add     di, 59
DOSCODE:5874		     loop    findSFT
DOSCODE:5876		     mov     di, si
DOSCODE:5878		     cmp     si, 0FFFFh
DOSCODE:587B		     jnz     short gotSFT
DOSCODE:587D		     mov     di, bp
DOSCODE:587F		     cmp     bp, 0FFFFh
DOSCODE:5882		     jnz     short gotnetSFT
DOSCODE:5884		     jmp     short errorbadSFT
DOSCODE:5886 lru5:				     ; ...
DOSCODE:5886		     cmp     es:[di+15h], dx
DOSCODE:588A		     jnb     short lru4
DOSCODE:588C		     mov     dx, es:[di+15h]
DOSCODE:5890		     mov     bp, di
DOSCODE:5892		     jmp     short lru4
DOSCODE:5894 gotSFT:				     ; ...
DOSCODE:5894		     or	     al, al
DOSCODE:5896		     jz	     short hackpoint
DOSCODE:5898 notlocaluse:
DOSCODE:5898		     mov     ax, es
DOSCODE:589A		     cmp     word ptr ds:LocalSFT, di
DOSCODE:589E		     jnz     short notinvalid
DOSCODE:58A0		     cmp     word ptr ds:LocalSFT+2, ax
DOSCODE:58A4		     jz	     short zerolocalSFT
DOSCODE:58A6 notinvalid:			     ; ...
DOSCODE:58A6		     jmp     gotlocalSFT
DOSCODE:58A9 zerolocalSFT:			     ; ...
DOSCODE:58A9		     xor     ax, ax
DOSCODE:58AB		     mov     word ptr ds:LocalSFT, ax
DOSCODE:58AE		     mov     word ptr ds:LocalSFT+2, ax
DOSCODE:58B1		     jmp     gotlocalSFT
DOSCODE:58B4 gotnetSFT:				     ; ...
DOSCODE:58B4		     or	     al, al
DOSCODE:58B6		     jnz     short closenet
DOSCODE:58B8		     mov     word ptr ds:LocalSFT, di
DOSCODE:58BC		     mov     word ptr ds:LocalSFT+2, es
DOSCODE:58C0 closenet:				     ; ...
DOSCODE:58C0		     mov     word ptr ds:THISSFT, di
DOSCODE:58C4		     mov     word ptr ds:THISSFT+2, es
DOSCODE:58C8 LRUClose:				     ; ...
DOSCODE:58C8		     cmp     word ptr es:[di], 0
DOSCODE:58CC		     jz	     short LRUDone
DOSCODE:58CE		     call    DOS_CLOSE
DOSCODE:58D1		     jnb     short LRUClose
DOSCODE:58D3		     cmp     al, 6
DOSCODE:58D5		     jz	     short LRUClose
DOSCODE:58D7 errorbadSFT:			     ; ...
DOSCODE:58D7		     stc
DOSCODE:58D8		     jmp     short LRUDead
DOSCODE:58DA LRUDone:				     ; ...
DOSCODE:58DA		     xor     al, al
DOSCODE:58DC		     call    BlastSFT
DOSCODE:58DF LRUDead:				     ; ...
DOSCODE:58DF		     call    restore_world
DOSCODE:58E2		     pop     es
DOSCODE:58E3		     mov     es, cs:DosDSeg
DOSCODE:58E8		     les     di, es:THISSFT
DOSCODE:58ED		     jb	     short LruFCB_err
DOSCODE:58EF		     retn
DOSCODE:58F0 LruFCB_err:			     ; ...
DOSCODE:58F0		     mov     al, 23h ; '#'
DOSCODE:58F2		     retn
DOSCODE:58F2 LRUFCB	     endp
DOSCODE:58F3 ; =============== S U B R O U T I N E =======================================
DOSCODE:58F3 RegenCopyName   proc near		     ; ...
DOSCODE:58F3		     lodsb
DOSCODE:58F4		     call    UCase
DOSCODE:58F7		     stosb
DOSCODE:58F8		     loop    RegenCopyName
DOSCODE:58FA		     retn
DOSCODE:58FA RegenCopyName   endp
DOSCODE:58FB ; =============== S U B R O U T I N E =======================================
DOSCODE:58FB FCBRegen	     proc near		     ; ...
DOSCODE:58FB		     mov     al, [si+19h]
DOSCODE:58FE		     test    al, 80h
DOSCODE:5900		     jz	     short RegenNoSharing
DOSCODE:5902		     call    CheckShare
DOSCODE:5905		     jnz     short RegenFail
DOSCODE:5907		     mov     ax, 1100h
DOSCODE:590A		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	INSTALLATION CHECK
DOSCODE:590A					     ; Return: AL = 00h	 not installed,	OK to install
DOSCODE:590A					     ; 01h  not	installed, not OK to install
DOSCODE:590A					     ; FFh  installed
DOSCODE:590C		     or	     al, al
DOSCODE:590E		     jz	     short RegenDead
DOSCODE:5910 RegenFail:				     ; ...
DOSCODE:5910		     mov     ax, ss:USER_IN_AX
DOSCODE:5914		     cmp     ah, 10h
DOSCODE:5917		     jz	     short RegenDead
DOSCODE:5919		     call    FCBHardErr
DOSCODE:591C RegenDead:				     ; ...
DOSCODE:591C		     stc
DOSCODE:591D FCBRegen_retn:			     ; ...
DOSCODE:591D		     retn
DOSCODE:591E RegenNoSharing:			     ; ...
DOSCODE:591E		     call    CheckShare
DOSCODE:5921		     jnz     short RegenFail
DOSCODE:5923		     push    ax
DOSCODE:5924		     mov     al, 0
DOSCODE:5926		     call    LRUFCB
DOSCODE:5929		     pop     ax
DOSCODE:592A		     jb	     short FCBRegen_retn
DOSCODE:592C		     mov     word ptr es:[di+2], 8002h
DOSCODE:5932		     and     al, 3Fh
DOSCODE:5934		     cbw
DOSCODE:5935		     or	     ax, 4000h
DOSCODE:5938		     mov     cl, [si+1Ah]
DOSCODE:593B		     mov     ch, cl
DOSCODE:593D		     and     ch, 0C0h
DOSCODE:5940		     or	     al, ch
DOSCODE:5942		     and     cl, 0Fh
DOSCODE:5945		     mov     es:[di+2],	cl
DOSCODE:5949		     mov     es:[di+5],	ax
DOSCODE:594D		     mov     ax, ss:PROC_ID
DOSCODE:5951		     mov     es:[di+31h], ax
DOSCODE:5955		     push    ds
DOSCODE:5956		     push    si
DOSCODE:5957		     push    es
DOSCODE:5958		     push    di
DOSCODE:5959		     push    ss
DOSCODE:595A		     pop     es
DOSCODE:595B		     mov     di, offset	NAME1
DOSCODE:595E		     mov     cx, 8
DOSCODE:5961		     inc     si
DOSCODE:5962		     call    RegenCopyName
DOSCODE:5965		     push    ss
DOSCODE:5966		     pop     ds
DOSCODE:5967		     mov     ds:ATTRIB,	16h
DOSCODE:596C		     call    DEVNAME
DOSCODE:596F		     pop     di
DOSCODE:5970		     pop     es
DOSCODE:5971		     pop     si
DOSCODE:5972		     pop     ds
DOSCODE:5973		     jb	     short RegenFileNoSharing
DOSCODE:5975		     mov     es:[di+5],	bh
DOSCODE:5979		     mov     byte ptr es:[di+4], 0
DOSCODE:597E		     lds     si, ss:DEVPT
DOSCODE:5983		     mov     es:[di+7],	si
DOSCODE:5987		     mov     word ptr es:[di+9], ds
DOSCODE:598B		     retn
DOSCODE:598C RegenDeadJ:			     ; ...
DOSCODE:598C		     jmp     short RegenDead
DOSCODE:598E RegenFileNoSharing:		     ; ...
DOSCODE:598E		     mov     ax, es:[di+5]
DOSCODE:5992		     and     ax, 3Fh
DOSCODE:5995		     push    ds
DOSCODE:5996		     push    si
DOSCODE:5997		     call    FIND_DPB
DOSCODE:599A		     mov     es:[di+7],	si
DOSCODE:599E		     mov     word ptr es:[di+9], ds
DOSCODE:59A2		     pop     si
DOSCODE:59A3		     pop     ds
DOSCODE:59A4		     jb	     short RegenDeadJ
DOSCODE:59A6		     mov     ax, [si+1Dh]
DOSCODE:59A9		     mov     es:[di+1Bh], ax
DOSCODE:59AD		     mov     al, [si+18h]
DOSCODE:59B0		     and     al, 0C0h
DOSCODE:59B2		     mov     ah, al
DOSCODE:59B4		     rol     ah, 1
DOSCODE:59B6		     shr     al, 1
DOSCODE:59B8		     or	     al, ah
DOSCODE:59BA		     and     al, 3Fh
DOSCODE:59BC		     mov     es:[di+4],	al
DOSCODE:59C0		     mov     al, [si+18h]
DOSCODE:59C3		     and     al, 3Fh
DOSCODE:59C5		     sub     ah, ah
DOSCODE:59C7		     mov     es:[di+1Dh], ax
DOSCODE:59CB		     mov     ax, [si+1Bh]
DOSCODE:59CE		     mov     es:[di+0Bh], ax
DOSCODE:59D2		     mov     es:[di+35h], ax
DOSCODE:59D6		     mov     al, [si+1Fh]
DOSCODE:59D9		     mov     es:[di+1Fh], al
DOSCODE:59DD		     inc     word ptr es:[di]
DOSCODE:59E0		     lea     si, [si+1]
DOSCODE:59E3		     lea     di, [di+20h]
DOSCODE:59E6		     mov     cx, 11
DOSCODE:59E9		     call    RegenCopyName
DOSCODE:59EC		     clc
DOSCODE:59ED		     retn
DOSCODE:59ED FCBRegen	     endp
DOSCODE:59EE ; =============== S U B R O U T I N E =======================================
DOSCODE:59EE BlastSFT	     proc near		     ; ...
DOSCODE:59EE		     push    di
DOSCODE:59EF		     mov     cx, 59
DOSCODE:59F2		     rep stosb
DOSCODE:59F4		     pop     di
DOSCODE:59F5		     sub     ax, ax
DOSCODE:59F7		     mov     es:[di], ax
DOSCODE:59FA		     mov     es:[di+15h], ax
DOSCODE:59FE		     dec     ax
DOSCODE:59FF		     mov     es:[di+17h], ax
DOSCODE:5A03		     retn
DOSCODE:5A03 BlastSFT	     endp
DOSCODE:5A04 ; =============== S U B R O U T I N E =======================================
DOSCODE:5A04 CheckFCB	     proc near		     ; ...
DOSCODE:5A04		     test    byte ptr [si+19h],	0C0h
DOSCODE:5A08		     jz	     short BadSFT
DOSCODE:5A0A		     les     di, ss:SFTFCB
DOSCODE:5A0F		     cmp     es:[di+4],	al
DOSCODE:5A13		     jb	     short BadSFT
DOSCODE:5A15		     mov     bl, 59
DOSCODE:5A17		     mul     bl
DOSCODE:5A19		     lea     di, [di+6]
DOSCODE:5A1C		     add     di, ax
DOSCODE:5A1E		     mov     ax, ss:PROC_ID
DOSCODE:5A22		     cmp     es:[di+31h], ax
DOSCODE:5A26		     jnz     short BadSFT
DOSCODE:5A28		     cmp     word ptr es:[di], 0
DOSCODE:5A2C		     jz	     short BadSFT
DOSCODE:5A2E		     mov     al, [si+19h]
DOSCODE:5A31		     test    al, 80h
DOSCODE:5A33		     jz	     short CheckNoShare
DOSCODE:5A35		     push    ax
DOSCODE:5A36		     and     al, 0C0h
DOSCODE:5A38		     cmp     al, 0C0h ;	'À'
DOSCODE:5A3A		     pop     ax
DOSCODE:5A3B		     jnz     short CheckNet
DOSCODE:5A3D		     call    ss:ShChk
DOSCODE:5A42		     jb	     short BadSFT
DOSCODE:5A44		     jmp     short CheckD
DOSCODE:5A46 CheckFirClus:
DOSCODE:5A46		     cmp     bx, es:[di+0Bh]
DOSCODE:5A4A		     jnz     short BadSFT
DOSCODE:5A4C CheckD:				     ; ...
DOSCODE:5A4C		     and     al, 3Fh
DOSCODE:5A4E		     mov     ah, es:[di+5]
DOSCODE:5A52		     and     ah, 3Fh
DOSCODE:5A55		     cmp     ah, al
DOSCODE:5A57		     jnz     short BadSFT
DOSCODE:5A59 BlastSFT_retn:			     ; ...
DOSCODE:5A59		     retn
DOSCODE:5A5A BadSFT:				     ; ...
DOSCODE:5A5A		     stc
DOSCODE:5A5B		     retn
DOSCODE:5A5C CheckNet:				     ; ...
DOSCODE:5A5C		     mov     ax, [si+1Ch]
DOSCODE:5A5F		     cmp     ax, es:[di+0Bh]
DOSCODE:5A63		     jnz     short BadSFT
DOSCODE:5A65		     retn
DOSCODE:5A66 CheckNoShare:			     ; ...
DOSCODE:5A66		     test    al, 40h
DOSCODE:5A68		     jnz     short $+2
DOSCODE:5A6A CheckNoShareDev:			     ; ...
DOSCODE:5A6A		     mov     bx, [si+1Ah]
DOSCODE:5A6D		     cmp     bx, es:[di+7]
DOSCODE:5A71		     jnz     short BadSFT
DOSCODE:5A73		     mov     bx, [si+1Ch]
DOSCODE:5A76		     cmp     bx, es:[di+9]
DOSCODE:5A7A		     jnz     short BadSFT
DOSCODE:5A7C		     jmp     short CheckD
DOSCODE:5A7C CheckFCB	     endp
DOSCODE:5A7E ; =============== S U B R O U T I N E =======================================
DOSCODE:5A7E SFTFromFCB	     proc near		     ; ...
DOSCODE:5A7E		     push    ax
DOSCODE:5A7F		     push    bx
DOSCODE:5A80		     mov     al, [si+18h]
DOSCODE:5A83		     call    CheckFCB
DOSCODE:5A86		     pop     bx
DOSCODE:5A87		     pop     ax
DOSCODE:5A88		     mov     word ptr ss:THISSFT, di
DOSCODE:5A8D		     mov     word ptr ss:THISSFT+2, es
DOSCODE:5A92		     jnb     short Set_SFT
DOSCODE:5A94		     push    es
DOSCODE:5A95		     call    save_world
DOSCODE:5A98		     call    FCBRegen
DOSCODE:5A9B		     call    restore_world
DOSCODE:5A9E		     pop     es
DOSCODE:5A9F		     mov     ax, ss:EXTERR
DOSCODE:5AA3		     jb	     short BlastSFT_retn
DOSCODE:5AA5 Set_SFT:				     ; ...
DOSCODE:5AA5		     les     di, ss:THISSFT
DOSCODE:5AAA		     push    ss:PROC_ID
DOSCODE:5AAF		     pop     word ptr es:[di+31h]
DOSCODE:5AB3		     retn
DOSCODE:5AB3 SFTFromFCB	     endp
DOSCODE:5AB4 ; =============== S U B R O U T I N E =======================================
DOSCODE:5AB4 FCBHardErr	     proc near		     ; ...
DOSCODE:5AB4		     mov     es, cs:DosDSeg
DOSCODE:5AB9		     mov     ax, 23h ; '#'
DOSCODE:5ABC		     mov     es:ALLOWED, 8
DOSCODE:5AC2		     les     bp, es:THISDPB
DOSCODE:5AC7		     mov     di, 1
DOSCODE:5ACA		     mov     cx, di
DOSCODE:5ACC		     mov     dx, es:[bp+0Bh]
DOSCODE:5AD0		     call    HARDERR
DOSCODE:5AD3		     stc
DOSCODE:5AD4		     retn
DOSCODE:5AD4 FCBHardErr	     endp
DOSCODE:5AD5 ; =============== S U B R O U T I N E =======================================
DOSCODE:5AD5 GetRR	     proc near		     ; ...
DOSCODE:5AD5		     mov     ax, [si+21h]
DOSCODE:5AD8		     mov     dx, [si+23h]
DOSCODE:5ADB		     cmp     bx, 64
DOSCODE:5ADE		     jb	     short GetRRBye
DOSCODE:5AE0		     xor     dh, dh
DOSCODE:5AE2 GetRRBye:				     ; ...
DOSCODE:5AE2		     retn
DOSCODE:5AE2 GetRR	     endp
DOSCODE:5AE3 ; =============== S U B R O U T I N E =======================================
DOSCODE:5AE3 GetExtent	     proc near		     ; ...
DOSCODE:5AE3		     mov     al, [si+20h]
DOSCODE:5AE6		     mov     dx, [si+0Ch]
DOSCODE:5AE9		     shl     al, 1
DOSCODE:5AEB		     shr     dx, 1
DOSCODE:5AED		     rcr     al, 1
DOSCODE:5AEF		     mov     ah, dl
DOSCODE:5AF1		     mov     dl, dh
DOSCODE:5AF3		     xor     dh, dh
DOSCODE:5AF5		     retn
DOSCODE:5AF5 GetExtent	     endp
DOSCODE:5AF6 ; =============== S U B R O U T I N E =======================================
DOSCODE:5AF6 SetExtent	     proc near		     ; ...
DOSCODE:5AF6		     push    ax
DOSCODE:5AF7		     push    dx
DOSCODE:5AF8		     mov     cx, ax
DOSCODE:5AFA		     and     al, 7Fh
DOSCODE:5AFC		     mov     [si+20h], al
DOSCODE:5AFF		     and     cl, 80h
DOSCODE:5B02		     shl     cx, 1
DOSCODE:5B04		     rcl     dx, 1
DOSCODE:5B06		     mov     al, ch
DOSCODE:5B08		     mov     ah, dl
DOSCODE:5B0A		     mov     [si+0Ch], ax
DOSCODE:5B0D		     pop     dx
DOSCODE:5B0E		     pop     ax
DOSCODE:5B0F		     retn
DOSCODE:5B0F SetExtent	     endp
DOSCODE:5B10 ; =============== S U B R O U T I N E =======================================
DOSCODE:5B10 GetExtended     proc near		     ; ...
DOSCODE:5B10		     mov     si, dx
DOSCODE:5B12		     cmp     byte ptr [si], 0FFh
DOSCODE:5B15		     jnz     short GetBye
DOSCODE:5B17		     add     si, 7
DOSCODE:5B1A GetBye:				     ; ...
DOSCODE:5B1A		     cmp     si, dx
DOSCODE:5B1C getextd_retn:			     ; ...
DOSCODE:5B1C		     retn
DOSCODE:5B1C GetExtended     endp
DOSCODE:5B1D ; =============== S U B R O U T I N E =======================================
DOSCODE:5B1D GetRecSize	     proc near		     ; ...
DOSCODE:5B1D		     mov     bx, [si+0Eh]
DOSCODE:5B20		     or	     bx, bx
DOSCODE:5B22		     jnz     short getextd_retn
DOSCODE:5B24		     mov     bx, 128
DOSCODE:5B27		     mov     [si+0Eh], bx
DOSCODE:5B2A		     retn
DOSCODE:5B2A GetRecSize	     endp
DOSCODE:5B2B ; =============== S U B R O U T I N E =======================================
DOSCODE:5B2B ; Attributes: bp-based frame
DOSCODE:5B2B FCBIO	     proc near		     ; ...
DOSCODE:5B2B FCBOp	     = byte ptr	-14h
DOSCODE:5B2B cRecRes	     = word ptr	-13h
DOSCODE:5B2B cResult	     = word ptr	-11h
DOSCODE:5B2B cByte	     = word ptr	-0Fh
DOSCODE:5B2B bPosL	     = word ptr	-0Dh
DOSCODE:5B2B bPosH	     = word ptr	-0Bh
DOSCODE:5B2B RecSize	     = word ptr	-9
DOSCODE:5B2B RecPosL	     = word ptr	-7
DOSCODE:5B2B RecPosH	     = word ptr	-5
DOSCODE:5B2B cRec	     = word ptr	-3
DOSCODE:5B2B FCBErr	     = byte ptr	-1
DOSCODE:5B2B		     push    bp
DOSCODE:5B2C		     mov     bp, sp
DOSCODE:5B2E		     sub     sp, 20
DOSCODE:5B31		     mov     [bp+FCBOp], al
DOSCODE:5B34		     mov     [bp+FCBErr], 0
DOSCODE:5B38		     call    GetExtended
DOSCODE:5B3B		     test    [bp+FCBOp], 8
DOSCODE:5B3F		     jnz     short GetPos
DOSCODE:5B41		     mov     cx, 1
DOSCODE:5B44 GetPos:				     ; ...
DOSCODE:5B44		     mov     [bp+cRec],	cx
DOSCODE:5B47		     call    GetExtent
DOSCODE:5B4A		     call    GetRecSize
DOSCODE:5B4D		     mov     [bp+RecSize], bx
DOSCODE:5B50		     test    [bp+FCBOp], 2
DOSCODE:5B54		     jz	     short GetRec
DOSCODE:5B56		     call    GetRR
DOSCODE:5B59 GetRec:				     ; ...
DOSCODE:5B59		     mov     [bp+RecPosL], ax
DOSCODE:5B5C		     mov     [bp+RecPosH], dx
DOSCODE:5B5F		     call    SetExtent
DOSCODE:5B62		     mov     ax, [bp+RecPosH]
DOSCODE:5B65		     mul     bx
DOSCODE:5B67		     mov     di, ax
DOSCODE:5B69		     mov     ax, [bp+RecPosL]
DOSCODE:5B6C		     mul     bx
DOSCODE:5B6E		     add     dx, di
DOSCODE:5B70		     mov     [bp+bPosL], ax
DOSCODE:5B73		     mov     [bp+bPosH], dx
DOSCODE:5B76		     mov     ax, [bp+cRec]
DOSCODE:5B79		     mul     bx
DOSCODE:5B7B		     mov     [bp+cByte], ax
DOSCODE:5B7E		     add     ax, word ptr ss:DMAADD
DOSCODE:5B83		     adc     dx, 0
DOSCODE:5B86		     jz	     short DoOper
DOSCODE:5B88		     mov     [bp+FCBErr], 2
DOSCODE:5B8C		     mov     ax, word ptr ss:DMAADD
DOSCODE:5B90		     neg     ax
DOSCODE:5B92		     jnz     short DoDiv
DOSCODE:5B94		     dec     ax
DOSCODE:5B95 DoDiv:				     ; ...
DOSCODE:5B95		     xor     dx, dx
DOSCODE:5B97		     div     bx
DOSCODE:5B99		     mov     [bp+cRec],	ax
DOSCODE:5B9C		     mul     bx
DOSCODE:5B9E		     mov     [bp+cByte], ax
DOSCODE:5BA1 DoOper:				     ; ...
DOSCODE:5BA1		     xor     bx, bx
DOSCODE:5BA3		     mov     [bp+cResult], bx
DOSCODE:5BA6		     cmp     [bp+cByte], bx
DOSCODE:5BA9		     jnz     short DoGetExt
DOSCODE:5BAB		     test    [bp+FCBErr], 2
DOSCODE:5BAF		     jz	     short DoGetExt
DOSCODE:5BB1		     jmp     short SkipOp
DOSCODE:5BB3 DoGetExt:				     ; ...
DOSCODE:5BB3		     call    SFTFromFCB
DOSCODE:5BB6		     jnb     short ContinueOp
DOSCODE:5BB8 FCBDeath:				     ; ...
DOSCODE:5BB8		     call    FCB_RET_ERR
DOSCODE:5BBB		     mov     [bp+cRecRes], 0
DOSCODE:5BC0		     mov     [bp+FCBErr], 1
DOSCODE:5BC4		     jmp     FCBSave
DOSCODE:5BC7 ContinueOp:			     ; ...
DOSCODE:5BC7		     mov     ax, [si+10h]
DOSCODE:5BCA		     mov     es:[di+11h], ax
DOSCODE:5BCE		     mov     ax, [si+12h]
DOSCODE:5BD1		     mov     es:[di+13h], ax
DOSCODE:5BD5		     mov     ax, [bp+bPosL]
DOSCODE:5BD8		     mov     dx, [bp+bPosH]
DOSCODE:5BDB		     mov     es:[di+15h], ax
DOSCODE:5BDF		     xchg    dx, es:[di+17h]
DOSCODE:5BE3		     push    dx
DOSCODE:5BE4		     mov     cx, [bp+cByte]
DOSCODE:5BE7		     mov     di, offset	DOS_READ
DOSCODE:5BEA		     test    [bp+FCBOp], 4
DOSCODE:5BEE		     jnz     short DoContext
DOSCODE:5BF0		     mov     di, offset	DOS_WRITE
DOSCODE:5BF3 DoContext:				     ; ...
DOSCODE:5BF3		     push    bp
DOSCODE:5BF4		     push    ds
DOSCODE:5BF5		     push    si
DOSCODE:5BF6		     push    ss
DOSCODE:5BF7		     pop     ds
DOSCODE:5BF8		     call    di	; DOS_READ
DOSCODE:5BFA		     pop     si
DOSCODE:5BFB		     pop     ds
DOSCODE:5BFC		     pop     bp
DOSCODE:5BFD		     jb	     short FCBDeath
DOSCODE:5BFF		     cmp     ss:DISK_FULL, 0
DOSCODE:5C05		     jz	     short NODSKFULL
DOSCODE:5C07		     mov     ss:DISK_FULL, 0
DOSCODE:5C0D		     mov     [bp+FCBErr], 1
DOSCODE:5C11 NODSKFULL:				     ; ...
DOSCODE:5C11		     mov     [bp+cResult], cx
DOSCODE:5C14		     call    SaveFCBInfo
DOSCODE:5C17		     pop     word ptr es:[di+17h]
DOSCODE:5C1B		     mov     ax, es:[di+11h]
DOSCODE:5C1F		     mov     [si+10h], ax
DOSCODE:5C22		     mov     ax, es:[di+13h]
DOSCODE:5C26		     mov     [si+12h], ax
DOSCODE:5C29 SkipOp:				     ; ...
DOSCODE:5C29		     mov     ax, [bp+cResult]
DOSCODE:5C2C		     xor     dx, dx
DOSCODE:5C2E		     div     [bp+RecSize]
DOSCODE:5C31		     mov     [bp+cRecRes], ax
DOSCODE:5C34		     add     [bp+RecPosL], ax
DOSCODE:5C37		     adc     [bp+RecPosH], 0
DOSCODE:5C3B		     cmp     ax, [bp+cRec]
DOSCODE:5C3E		     jz	     short TryBlank
DOSCODE:5C40		     test    [bp+FCBOp], 4
DOSCODE:5C44		     jnz     short SetEOF
DOSCODE:5C46		     test    byte ptr es:[di+5], 80h
DOSCODE:5C4B		     jnz     short TryBlank
DOSCODE:5C4D SetEOF:				     ; ...
DOSCODE:5C4D		     mov     [bp+FCBErr], 1
DOSCODE:5C51 TryBlank:				     ; ...
DOSCODE:5C51		     or	     dx, dx
DOSCODE:5C53		     jz	     short SetExt
DOSCODE:5C55		     add     [bp+RecPosL], 1
DOSCODE:5C59		     adc     [bp+RecPosH], 0
DOSCODE:5C5D		     test    [bp+FCBOp], 4
DOSCODE:5C61		     jz	     short SetExt
DOSCODE:5C63		     inc     [bp+cRecRes]
DOSCODE:5C66		     mov     [bp+FCBErr], 3
DOSCODE:5C6A		     mov     cx, [bp+RecSize]
DOSCODE:5C6D		     sub     cx, dx
DOSCODE:5C6F		     xor     al, al
DOSCODE:5C71		     les     di, ss:DMAADD
DOSCODE:5C76		     add     di, [bp+cResult]
DOSCODE:5C79		     rep stosb
DOSCODE:5C7B SetExt:				     ; ...
DOSCODE:5C7B		     mov     dx, [bp+RecPosH]
DOSCODE:5C7E		     mov     ax, [bp+RecPosL]
DOSCODE:5C81		     test    [bp+FCBOp], 2
DOSCODE:5C85		     jz	     short DoSetExt
DOSCODE:5C87		     test    [bp+FCBOp], 8
DOSCODE:5C8B		     jz	     short TrySetRR
DOSCODE:5C8D DoSetExt:				     ; ...
DOSCODE:5C8D		     call    SetExtent
DOSCODE:5C90 TrySetRR:				     ; ...
DOSCODE:5C90		     test    [bp+FCBOp], 8
DOSCODE:5C94		     jz	     short TryReturn
DOSCODE:5C96		     mov     [si+21h], ax
DOSCODE:5C99		     mov     [si+23h], dl
DOSCODE:5C9C		     cmp     word ptr [si+0Eh],	64
DOSCODE:5CA0		     jnb     short TryReturn
DOSCODE:5CA2		     mov     [si+24h], dh
DOSCODE:5CA5 TryReturn:				     ; ...
DOSCODE:5CA5		     test    [bp+FCBOp], 4
DOSCODE:5CA9		     jnz     short FCBSave
DOSCODE:5CAB		     push    ds
DOSCODE:5CAC		     call    DATE16
DOSCODE:5CAF		     pop     ds
DOSCODE:5CB0		     mov     [si+14h], ax
DOSCODE:5CB3		     mov     [si+16h], dx
DOSCODE:5CB6 FCBSave:				     ; ...
DOSCODE:5CB6		     test    [bp+FCBOp], 8
DOSCODE:5CBA		     jz	     short DoReturn
DOSCODE:5CBC		     mov     cx, [bp+cRecRes]
DOSCODE:5CBF		     call    Get_User_Stack
DOSCODE:5CC2		     mov     [si+4], cx
DOSCODE:5CC5 DoReturn:				     ; ...
DOSCODE:5CC5		     mov     al, [bp+FCBErr]
DOSCODE:5CC8		     mov     sp, bp
DOSCODE:5CCA		     pop     bp
DOSCODE:5CCB		     retn
DOSCODE:5CCB FCBIO	     endp ; sp-analysis	failed
DOSCODE:5CCC ; =============== S U B R O U T I N E =======================================
DOSCODE:5CCC $FCB_OPEN	     proc near		     ; ...
DOSCODE:5CCC		     mov     ax, 2
DOSCODE:5CCF		     mov     cx, offset	DOS_OPEN
DOSCODE:5CD2 DoAccess:				     ; ...
DOSCODE:5CD2		     push    ds
DOSCODE:5CD3		     push    dx
DOSCODE:5CD4		     push    cx
DOSCODE:5CD5		     push    ax
DOSCODE:5CD6		     mov     di, offset	OPENBUF
DOSCODE:5CD9		     call    TransFCB
DOSCODE:5CDC		     pop     ax
DOSCODE:5CDD		     pop     cx
DOSCODE:5CDE		     pop     dx
DOSCODE:5CDF		     pop     ds
DOSCODE:5CE0		     jnb     short FindFCB
DOSCODE:5CE2 FCBOpenErr:			     ; ...
DOSCODE:5CE2		     jmp     FCB_RET_ERR
DOSCODE:5CE5 FindFCB:				     ; ...
DOSCODE:5CE5		     call    GetExtended
DOSCODE:5CE8		     push    ax
DOSCODE:5CE9		     mov     al, 1
DOSCODE:5CEB		     call    LRUFCB
DOSCODE:5CEE		     pop     ax
DOSCODE:5CEF		     jb	     short HardMessage
DOSCODE:5CF1		     mov     word ptr es:[di+2], 8000h
DOSCODE:5CF7		     push    ds
DOSCODE:5CF8		     push    si
DOSCODE:5CF9		     push    bx
DOSCODE:5CFA		     mov     si, cx
DOSCODE:5CFC		     push    ss
DOSCODE:5CFD		     pop     ds
DOSCODE:5CFE		     call    si
DOSCODE:5D00		     pop     bx
DOSCODE:5D01		     pop     si
DOSCODE:5D02		     pop     ds
DOSCODE:5D03		     les     di, ss:THISSFT
DOSCODE:5D08		     jnb     short FCBOK
DOSCODE:5D0A		     push    ax
DOSCODE:5D0B		     mov     al, 'R'
DOSCODE:5D0D		     call    BlastSFT
DOSCODE:5D10		     pop     ax
DOSCODE:5D11		     cmp     ax, 4
DOSCODE:5D14		     jz	     short HardMessage
DOSCODE:5D16		     cmp     ax, 24h ; '$'
DOSCODE:5D19		     jnz     short DeadFCB
DOSCODE:5D1B HardMessage:			     ; ...
DOSCODE:5D1B		     push    ax
DOSCODE:5D1C		     call    FCBHardErr
DOSCODE:5D1F		     pop     ax
DOSCODE:5D20 DeadFCB:				     ; ...
DOSCODE:5D20		     jmp     short FCBOpenErr
DOSCODE:5D22 FCBOK:				     ; ...
DOSCODE:5D22		     call    IsSFTNet
DOSCODE:5D25		     jnz     short FCBOK2
DOSCODE:5D27		     call    CheckShare
DOSCODE:5D2A		     jnz     short FCBOK2
DOSCODE:5D2C		     mov     word ptr ss:LocalSFT, di
DOSCODE:5D31		     mov     word ptr ss:LocalSFT+2, es
DOSCODE:5D36 FCBOK2:				     ; ...
DOSCODE:5D36		     inc     word ptr es:[di]
DOSCODE:5D39		     call    SaveFCBInfo
DOSCODE:5D3C		     test    byte ptr es:[di+5], 80h
DOSCODE:5D41		     jnz     short FCBNoDrive
DOSCODE:5D43		     mov     al, [si]
DOSCODE:5D45		     call    GETTHISDRV
DOSCODE:5D48		     inc     al
DOSCODE:5D4A		     mov     [si], al
DOSCODE:5D4C FCBNoDrive:			     ; ...
DOSCODE:5D4C		     mov     word ptr [si+0Eh],	80h
DOSCODE:5D51		     mov     ax, es:[di+0Dh]
DOSCODE:5D55		     mov     [si+16h], ax
DOSCODE:5D58		     mov     ax, es:[di+0Fh]
DOSCODE:5D5C		     mov     [si+14h], ax
DOSCODE:5D5F		     mov     ax, es:[di+11h]
DOSCODE:5D63		     mov     [si+10h], ax
DOSCODE:5D66		     mov     ax, es:[di+13h]
DOSCODE:5D6A		     mov     [si+12h], ax
DOSCODE:5D6D		     xor     ax, ax
DOSCODE:5D6F		     mov     [si+0Ch], ax
DOSCODE:5D72		     les     di, ss:SFTFCB
DOSCODE:5D77		     mov     ah, es:[di+4]
DOSCODE:5D7B OpenScan:				     ; ...
DOSCODE:5D7B		     cmp     al, [si+18h]
DOSCODE:5D7E		     jz	     short SkipCheck
DOSCODE:5D80		     push    ax
DOSCODE:5D81		     call    CheckFCB
DOSCODE:5D84		     pop     ax
DOSCODE:5D85		     jnb     short OpenFound
DOSCODE:5D87 SkipCheck:				     ; ...
DOSCODE:5D87		     inc     al
DOSCODE:5D89		     cmp     al, ah
DOSCODE:5D8B		     jnz     short OpenScan
DOSCODE:5D8D OpenDone:				     ; ...
DOSCODE:5D8D		     xor     al, al
DOSCODE:5D8F		     retn
DOSCODE:5D90 OpenFound:				     ; ...
DOSCODE:5D90		     mov     [si+18h], al
DOSCODE:5D93		     inc     word ptr es:[di]
DOSCODE:5D96		     mov     ax, ss:FCBLRU
DOSCODE:5D9A		     mov     es:[di+15h], ax
DOSCODE:5D9E		     push    ss
DOSCODE:5D9F		     pop     ds
DOSCODE:5DA0		     les     di, ds:THISSFT
DOSCODE:5DA4		     dec     word ptr es:[di]
DOSCODE:5DA7		     call    ShareEnd
DOSCODE:5DAA		     mov     al, 'C'
DOSCODE:5DAC		     call    BlastSFT
DOSCODE:5DAF		     jmp     short OpenDone
DOSCODE:5DAF $FCB_OPEN	     endp
DOSCODE:5DB1 $FCB_CREATE:			     ; ...
DOSCODE:5DB1		     mov     cx, offset	DOS_CREATE
DOSCODE:5DB4		     xor     ax, ax
DOSCODE:5DB6		     call    GetExtended
DOSCODE:5DB9		     jz	     short DoAccessJ
DOSCODE:5DBB		     mov     al, [si-1]
DOSCODE:5DBE DoAccessJ:				     ; ...
DOSCODE:5DBE		     jmp     DoAccess
DOSCODE:5DC1 $FCB_RANDOM_WRITE_BLOCK:		     ; ...
DOSCODE:5DC1		     mov     al, 0Ah
DOSCODE:5DC3		     jmp     FCBIO
DOSCODE:5DC6 $FCB_RANDOM_READ_BLOCK:		     ; ...
DOSCODE:5DC6		     mov     al, 0Eh
DOSCODE:5DC8		     jmp     FCBIO
DOSCODE:5DCB $FCB_SEQ_READ:			     ; ...
DOSCODE:5DCB		     mov     al, 4
DOSCODE:5DCD		     jmp     FCBIO
DOSCODE:5DD0 $FCB_SEQ_WRITE:			     ; ...
DOSCODE:5DD0		     mov     al, 0
DOSCODE:5DD2		     jmp     FCBIO
DOSCODE:5DD5 $FCB_RANDOM_READ:			     ; ...
DOSCODE:5DD5		     mov     al, 6
DOSCODE:5DD7		     jmp     FCBIO
DOSCODE:5DDA $FCB_RANDOM_WRITE:			     ; ...
DOSCODE:5DDA		     mov     al, 2
DOSCODE:5DDC		     jmp     FCBIO
DOSCODE:5DDF $DIR_SEARCH_FIRST:			     ; ...
DOSCODE:5DDF		     mov     word ptr ss:THISFCB, dx
DOSCODE:5DE4		     mov     word ptr ss:THISFCB+2, ds
DOSCODE:5DE9		     mov     si, dx
DOSCODE:5DEB		     cmp     byte ptr [si], 0FFh
DOSCODE:5DEE		     jnz     short NORMFCB4
DOSCODE:5DF0		     add     si, 7
DOSCODE:5DF3 NORMFCB4:				     ; ...
DOSCODE:5DF3		     push    word ptr [si]
DOSCODE:5DF5		     push    ss
DOSCODE:5DF6		     pop     es
DOSCODE:5DF7		     mov     di, offset	OPENBUF
DOSCODE:5DFA		     call    TransFCB
DOSCODE:5DFD		     jnb     short SearchIt
DOSCODE:5DFF		     pop     bx
DOSCODE:5E00 dsf_err:				     ; ...
DOSCODE:5E00		     jmp     FCB_RET_ERR
DOSCODE:5E03 SearchIt:				     ; ...
DOSCODE:5E03		     push    ss
DOSCODE:5E04		     pop     ds
DOSCODE:5E05		     push    word ptr ds:DMAADD
DOSCODE:5E09		     push    word ptr ds:DMAADD+2
DOSCODE:5E0D		     mov     word ptr ds:DMAADD, offset	SEARCHBUF
DOSCODE:5E13		     mov     word ptr ds:DMAADD+2, ds
DOSCODE:5E17		     call    GET_FAST_SEARCH
DOSCODE:5E1A		     pop     word ptr ds:DMAADD+2
DOSCODE:5E1E		     pop     word ptr ds:DMAADD
DOSCODE:5E22		     jnb     short SearchSet
DOSCODE:5E24		     pop     bx
DOSCODE:5E25		     jmp     short dsf_err
DOSCODE:5E27 SearchSet:				     ; ...
DOSCODE:5E27		     mov     si, offset	SEARCHBUF
DOSCODE:5E2A		     les     di, ds:THISFCB
DOSCODE:5E2E		     test    ds:EXTFCB,	0FFh
DOSCODE:5E33		     jz	     short NORMFCB1
DOSCODE:5E35		     add     di, 7
DOSCODE:5E38 NORMFCB1:				     ; ...
DOSCODE:5E38		     pop     bx
DOSCODE:5E39		     or	     bl, bl
DOSCODE:5E3B		     jnz     short SearchDrv
DOSCODE:5E3D		     mov     bl, ds:CURDRV
DOSCODE:5E41		     inc     bl
DOSCODE:5E43 SearchDrv:				     ; ...
DOSCODE:5E43		     lodsb
DOSCODE:5E44		     xchg    al, bl
DOSCODE:5E46		     inc     di
DOSCODE:5E47		     mov     cx, 10
DOSCODE:5E4A		     rep movsw
DOSCODE:5E4C		     xchg    al, bl
DOSCODE:5E4E		     stosb
DOSCODE:5E4F		     les     di, ds:DMAADD
DOSCODE:5E53		     test    ds:EXTFCB,	0FFh
DOSCODE:5E58		     jz	     short NORMFCB2
DOSCODE:5E5A		     mov     al, 0FFh
DOSCODE:5E5C		     stosb
DOSCODE:5E5D		     inc     al
DOSCODE:5E5F		     mov     cx, 5
DOSCODE:5E62		     rep stosb
DOSCODE:5E64		     mov     al, ds:SATTRIB
DOSCODE:5E67		     stosb
DOSCODE:5E68 NORMFCB2:				     ; ...
DOSCODE:5E68		     mov     al, bl
DOSCODE:5E6A		     stosb
DOSCODE:5E6B		     mov     cx, 16
DOSCODE:5E6E		     rep movsw
DOSCODE:5E70		     jmp     NO_OP
DOSCODE:5E73 $DIR_SEARCH_NEXT:			     ; ...
DOSCODE:5E73		     mov     word ptr ss:THISFCB, dx
DOSCODE:5E78		     mov     word ptr ss:THISFCB+2, ds
DOSCODE:5E7D		     mov     ss:SATTRIB, 0
DOSCODE:5E83		     mov     ss:EXTFCB,	0
DOSCODE:5E89		     push    ss
DOSCODE:5E8A		     pop     es
DOSCODE:5E8B		     mov     di, offset	SEARCHBUF
DOSCODE:5E8E		     mov     si, dx
DOSCODE:5E90		     cmp     byte ptr [si], 0FFh
DOSCODE:5E93		     jnz     short NORMFCB6
DOSCODE:5E95		     add     si, 6
DOSCODE:5E98		     lodsb
DOSCODE:5E99		     mov     ss:SATTRIB, al
DOSCODE:5E9D		     dec     ss:EXTFCB
DOSCODE:5EA2 NORMFCB6:				     ; ...
DOSCODE:5EA2		     lodsb
DOSCODE:5EA3		     push    ax
DOSCODE:5EA4		     mov     al, [si+20]
DOSCODE:5EA7		     stosb
DOSCODE:5EA8		     mov     cx, 10
DOSCODE:5EAB		     rep movsw
DOSCODE:5EAD		     push    ss
DOSCODE:5EAE		     pop     ds
DOSCODE:5EAF		     push    word ptr ds:DMAADD
DOSCODE:5EB3		     push    word ptr ds:DMAADD+2
DOSCODE:5EB7		     mov     word ptr ds:DMAADD, offset	SEARCHBUF
DOSCODE:5EBD		     mov     word ptr ds:DMAADD+2, ds
DOSCODE:5EC1		     call    DOS_SEARCH_NEXT
DOSCODE:5EC4		     pop     word ptr ds:DMAADD+2
DOSCODE:5EC8		     pop     word ptr ds:DMAADD
DOSCODE:5ECC		     jb	     short SearchNoMore
DOSCODE:5ECE		     jmp     SearchSet
DOSCODE:5ED1 SearchNoMore:			     ; ...
DOSCODE:5ED1		     les     di, ds:THISFCB
DOSCODE:5ED5		     test    ds:EXTFCB,	0FFh
DOSCODE:5EDA		     jz	     short NORMFCB8
DOSCODE:5EDC		     add     di, 7
DOSCODE:5EDF NORMFCB8:				     ; ...
DOSCODE:5EDF		     pop     bx
DOSCODE:5EE0		     mov     es:[di], bl
DOSCODE:5EE3		     jmp     FCB_RET_ERR
DOSCODE:5EE6 $FIND_FIRST:			     ; ...
DOSCODE:5EE6		     mov     si, dx
DOSCODE:5EE8		     mov     ss:SATTRIB, cl
DOSCODE:5EED		     mov     di, offset	OPENBUF
DOSCODE:5EF0		     call    TransPathSet
DOSCODE:5EF3		     jnb     short Find_it
DOSCODE:5EF5		     mov     al, 3
DOSCODE:5EF7 FindError:				     ; ...
DOSCODE:5EF7		     jmp     SYS_RET_ERR
DOSCODE:5EFA Find_it:				     ; ...
DOSCODE:5EFA		     push    ss
DOSCODE:5EFB		     pop     ds
DOSCODE:5EFC		     push    word ptr ds:DMAADD
DOSCODE:5F00		     push    word ptr ds:DMAADD+2
DOSCODE:5F04		     mov     word ptr ds:DMAADD, offset	SEARCHBUF
DOSCODE:5F0A		     mov     word ptr ds:DMAADD+2, ds
DOSCODE:5F0E		     call    GET_FAST_SEARCH
DOSCODE:5F11		     pop     word ptr ds:DMAADD+2
DOSCODE:5F15		     pop     word ptr ds:DMAADD
DOSCODE:5F19		     jnb     short FindSet
DOSCODE:5F1B FindItError:			     ; ...
DOSCODE:5F1B		     jmp     short FindError
DOSCODE:5F1D FindSet:				     ; ...
DOSCODE:5F1D		     mov     si, offset	SEARCHBUF
DOSCODE:5F20		     les     di, ds:DMAADD
DOSCODE:5F24		     mov     cx, 21
DOSCODE:5F27		     rep movsb
DOSCODE:5F29		     push    si
DOSCODE:5F2A		     mov     al, [si+0Bh]
DOSCODE:5F2D		     stosb
DOSCODE:5F2E		     add     si, 16h
DOSCODE:5F31		     movsw
DOSCODE:5F32		     movsw
DOSCODE:5F33		     inc     si
DOSCODE:5F34		     inc     si
DOSCODE:5F35		     movsw
DOSCODE:5F36		     movsw
DOSCODE:5F37		     pop     si
DOSCODE:5F38		     call    PackName
DOSCODE:5F3B		     jmp     SYS_RET_OK
DOSCODE:5F3E $FIND_NEXT:			     ; ...
DOSCODE:5F3E		     push    ss
DOSCODE:5F3F		     pop     es
DOSCODE:5F40		     mov     di, offset	SEARCHBUF
DOSCODE:5F43		     lds     si, ss:DMAADD
DOSCODE:5F48		     mov     cx, 21
DOSCODE:5F4B		     rep movsb
DOSCODE:5F4D		     push    ss
DOSCODE:5F4E		     pop     ds
DOSCODE:5F4F		     push    word ptr ds:DMAADD
DOSCODE:5F53		     push    word ptr ds:DMAADD+2
DOSCODE:5F57		     mov     word ptr ds:DMAADD, offset	SEARCHBUF
DOSCODE:5F5D		     mov     word ptr ds:DMAADD+2, ds
DOSCODE:5F61		     call    DOS_SEARCH_NEXT
DOSCODE:5F64		     pop     word ptr ds:DMAADD+2
DOSCODE:5F68		     pop     word ptr ds:DMAADD
DOSCODE:5F6C		     jnb     short FindSet
DOSCODE:5F6E		     jmp     short FindItError
DOSCODE:5F70 ; =============== S U B R O U T I N E =======================================
DOSCODE:5F70 PackName	     proc near		     ; ...
DOSCODE:5F70		     mov     cx, 8
DOSCODE:5F73		     rep movsb
DOSCODE:5F75 main_kill_tail:			     ; ...
DOSCODE:5F75		     cmp     byte ptr es:[di-1], ' '
DOSCODE:5F7A		     jnz     short find_check_dot
DOSCODE:5F7C		     dec     di
DOSCODE:5F7D		     inc     cx
DOSCODE:5F7E		     cmp     cx, 8
DOSCODE:5F81		     jb	     short main_kill_tail
DOSCODE:5F83 find_check_dot:			     ; ...
DOSCODE:5F83		     cmp     word ptr [si], '  '
DOSCODE:5F87		     jnz     short got_ext
DOSCODE:5F89		     cmp     byte ptr [si+2], ' '
DOSCODE:5F8D		     jz	     short find_done
DOSCODE:5F8F got_ext:				     ; ...
DOSCODE:5F8F		     mov     al, '.'
DOSCODE:5F91		     stosb
DOSCODE:5F92		     mov     cx, 3
DOSCODE:5F95		     rep movsb
DOSCODE:5F97 ext_kill_tail:			     ; ...
DOSCODE:5F97		     cmp     byte ptr es:[di-1], ' '
DOSCODE:5F9C		     jnz     short find_done
DOSCODE:5F9E		     dec     di
DOSCODE:5F9F		     jmp     short ext_kill_tail
DOSCODE:5FA1 find_done:				     ; ...
DOSCODE:5FA1		     xor     ax, ax
DOSCODE:5FA3		     stosb
DOSCODE:5FA4		     retn
DOSCODE:5FA4 PackName	     endp
DOSCODE:5FA5 ; =============== S U B R O U T I N E =======================================
DOSCODE:5FA5 GET_FAST_SEARCH proc near		     ; ...
DOSCODE:5FA5		     or	     ss:DOS34_FLAG, 400h ; SEARCH_FASTOPEN
DOSCODE:5FAC		     call    DOS_SEARCH_FIRST
DOSCODE:5FAF		     retn
DOSCODE:5FAF GET_FAST_SEARCH endp
DOSCODE:5FB0 $CURRENT_DIR:			     ; ...
DOSCODE:5FB0		     call    ECritDisk
DOSCODE:5FB3		     mov     al, dl
DOSCODE:5FB5		     call    GetVisDrv
DOSCODE:5FB8		     jnb     short CurrentValidate
DOSCODE:5FBA CurdirErr:				     ; ...
DOSCODE:5FBA		     call    LCritDisk
DOSCODE:5FBD		     push    ds
DOSCODE:5FBE		     mov     ds, cs:DosDSeg
DOSCODE:5FC3		     mov     al, ds:DrvErr
DOSCODE:5FC6		     pop     ds
DOSCODE:5FC7 curdir_errj:			     ; ...
DOSCODE:5FC7		     jmp     SYS_RET_ERR
DOSCODE:5FCA CurrentValidate:			     ; ...
DOSCODE:5FCA		     push    ds
DOSCODE:5FCB		     push    si
DOSCODE:5FCC		     mov     ds, cs:DosDSeg
DOSCODE:5FD1		     lds     si, ds:THISCDS
DOSCODE:5FD5		     test    word ptr [si+43h],	8000h
DOSCODE:5FDA		     jnz     short $+2
DOSCODE:5FDC DoCheck:				     ; ...
DOSCODE:5FDC		     push    ds
DOSCODE:5FDD		     mov     ds, cs:DosDSeg
DOSCODE:5FE2		     mov     ds:NoSetDir, 0
DOSCODE:5FE7		     pop     ds
DOSCODE:5FE8		     mov     di, offset	OPENBUF
DOSCODE:5FEB		     call    ValidateCDS
DOSCODE:5FEE		     push    es
DOSCODE:5FEF		     push    di
DOSCODE:5FF0		     pop     si
DOSCODE:5FF1		     pop     ds
DOSCODE:5FF2		     pop     di
DOSCODE:5FF3		     pop     es
DOSCODE:5FF4		     jb	     short CurdirErr
DOSCODE:5FF6		     add     si, 0
DOSCODE:5FF9		     add     si, [si+4Fh]
DOSCODE:5FFC		     cmp     byte ptr [si], '\'
DOSCODE:5FFF		     jnz     short CurrentCopy
DOSCODE:6001		     inc     si
DOSCODE:6002 CurrentCopy:			     ; ...
DOSCODE:6002		     push    ax
DOSCODE:6003		     lodsb
DOSCODE:6004		     or	     al, al
DOSCODE:6006		     jz	     short FOK
DOSCODE:6008		     cmp     al, 5
DOSCODE:600A		     jz	     short FCHANGE
DOSCODE:600C		     jmp     short FFF
DOSCODE:600E FCPYNEXT:				     ; ...
DOSCODE:600E		     lodsb
DOSCODE:600F FFF:				     ; ...
DOSCODE:600F		     cmp     al, '\'
DOSCODE:6011		     jnz     short FOK
DOSCODE:6013		     stosb
DOSCODE:6014		     lodsb
DOSCODE:6015		     cmp     al, 5
DOSCODE:6017		     jnz     short FOK
DOSCODE:6019 FCHANGE:				     ; ...
DOSCODE:6019		     mov     al, 0E5h ;	'å'
DOSCODE:601B FOK:				     ; ...
DOSCODE:601B		     stosb
DOSCODE:601C		     or	     al, al
DOSCODE:601E		     jnz     short FCPYNEXT
DOSCODE:6020		     pop     ax
DOSCODE:6021		     xor     al, al
DOSCODE:6023		     call    LCritDisk
DOSCODE:6026		     jmp     SYS_RET_OK
DOSCODE:6029 $RMDIR:				     ; ...
DOSCODE:6029		     push    dx
DOSCODE:602A		     push    ds
DOSCODE:602B		     mov     si, dx
DOSCODE:602D		     mov     di, offset	OPENBUF
DOSCODE:6030		     push    di
DOSCODE:6031		     call    TransPathNoSet
DOSCODE:6034		     pop     di
DOSCODE:6035		     jnb     short rmlset
DOSCODE:6037		     pop     ds
DOSCODE:6038		     pop     dx
DOSCODE:6039		     mov     al, 3
DOSCODE:603B rmdir_errj:			     ; ...
DOSCODE:603B		     jmp     short curdir_errj
DOSCODE:603D rmlset:				     ; ...
DOSCODE:603D		     cmp     ss:CMETA, 0FFh
DOSCODE:6043		     jnz     short rmerr
DOSCODE:6045		     push    ss
DOSCODE:6046		     pop     es
DOSCODE:6047		     xor     al, al
DOSCODE:6049 rmloop:				     ; ...
DOSCODE:6049		     call    GetCDSFromDrv
DOSCODE:604C		     jb	     short rmcont
DOSCODE:604E		     call    StrCmp
DOSCODE:6051		     jz	     short rmerr
DOSCODE:6053		     inc     al
DOSCODE:6055		     jmp     short rmloop
DOSCODE:6057 rmerr:				     ; ...
DOSCODE:6057		     pop     ds
DOSCODE:6058		     pop     dx
DOSCODE:6059		     mov     al, 10h
DOSCODE:605B rmerrj:				     ; ...
DOSCODE:605B		     jmp     short rmdir_errj
DOSCODE:605D rmcont:				     ; ...
DOSCODE:605D		     pop     ds
DOSCODE:605E		     pop     dx
DOSCODE:605F		     mov     si, offset	DOS_RMDIR
DOSCODE:6062		     jmp     DoDirCall
DOSCODE:6065 $CHDIR:				     ; ...
DOSCODE:6065		     mov     di, offset	OPENBUF
DOSCODE:6068		     mov     si, dx
DOSCODE:606A		     call    TransPath
DOSCODE:606D		     jnb     short ChDirCrack
DOSCODE:606F ChDirErrP:				     ; ...
DOSCODE:606F		     mov     al, 3
DOSCODE:6071 ChDirErr:				     ; ...
DOSCODE:6071		     jmp     short rmerrj
DOSCODE:6073 ChDirCrack:			     ; ...
DOSCODE:6073		     cmp     ds:CMETA, 0FFh
DOSCODE:6078		     jnz     short ChDirErrP
DOSCODE:607A		     les     di, ds:THISCDS
DOSCODE:607E		     cmp     di, 0FFFFh
DOSCODE:6081		     jz	     short ChDirErrP
DOSCODE:6083		     call    DOS_CHDIR
DOSCODE:6086		     jb	     short ChDirErr
DOSCODE:6088		     les     di, ds:THISCDS
DOSCODE:608C		     test    word ptr es:[di+43h], 2000h
DOSCODE:6092		     jz	     short GotCDS
DOSCODE:6094		     push    es
DOSCODE:6095		     push    di
DOSCODE:6096		     push    cx
DOSCODE:6097		     call    Get_User_Stack
DOSCODE:609A		     mov     di, [si+6]
DOSCODE:609D		     mov     ds, word ptr [si+0Eh]
DOSCODE:60A0		     mov     si, offset	OPENBUF
DOSCODE:60A3		     xchg    si, di
DOSCODE:60A5		     xor     al, al
DOSCODE:60A7		     push    di
DOSCODE:60A8		     call    TransPathNoSet
DOSCODE:60AB		     pop     si
DOSCODE:60AC		     les     di, ds:THISCDS
DOSCODE:60B0		     mov     word ptr es:[di+49h], 0FFFFh
DOSCODE:60B6		     pop     cx
DOSCODE:60B7		     pop     di
DOSCODE:60B8		     pop     es
DOSCODE:60B9 GotCDS:				     ; ...
DOSCODE:60B9		     call    Check_PathLen
DOSCODE:60BC		     ja	     short ChDirErrP
DOSCODE:60BE		     test    word ptr es:[di+43h], 8000h
DOSCODE:60C4		     jnz     short SkipRecency
DOSCODE:60C6		     test    word ptr es:[di+43h], 2000h
DOSCODE:60CC		     jz	     short setdirclus
DOSCODE:60CE		     mov     cx, 0FFFFh
DOSCODE:60D1 setdirclus:			     ; ...
DOSCODE:60D1		     mov     es:[di+49h], cx
DOSCODE:60D5		     les     di, ds:THISCDS
DOSCODE:60D9 SkipRecency:			     ; ...
DOSCODE:60D9		     call    FStrCpy
DOSCODE:60DC		     xor     al, al
DOSCODE:60DE mkdir_ok:				     ; ...
DOSCODE:60DE		     jmp     SYS_RET_OK
DOSCODE:60E1 $MKDIR:				     ; ...
DOSCODE:60E1		     mov     si, offset	DOS_MKDIR
DOSCODE:60E4 DoDirCall:				     ; ...
DOSCODE:60E4		     mov     di, offset	OPENBUF
DOSCODE:60E7		     push    si
DOSCODE:60E8		     mov     si, dx
DOSCODE:60EA		     call    TransPath
DOSCODE:60ED		     pop     si
DOSCODE:60EE		     jnb     short MkDirCrack
DOSCODE:60F0 MkErrP:				     ; ...
DOSCODE:60F0		     mov     al, 3
DOSCODE:60F2 MkErr:				     ; ...
DOSCODE:60F2		     jmp     SYS_RET_ERR
DOSCODE:60F5 MkDirCrack:			     ; ...
DOSCODE:60F5		     cmp     ss:CMETA, 0FFh
DOSCODE:60FB		     jnz     short MkErrP
DOSCODE:60FD		     push    si
DOSCODE:60FE		     call    Check_PathLen
DOSCODE:6101		     pop     si
DOSCODE:6102		     jbe     short pathok
DOSCODE:6104		     mov     al, 5
DOSCODE:6106		     jmp     short MkErr
DOSCODE:6108 pathok:				     ; ...
DOSCODE:6108		     call    si
DOSCODE:610A		     jb	     short MkErr
DOSCODE:610C		     jmp     short mkdir_ok
DOSCODE:610E ; =============== S U B R O U T I N E =======================================
DOSCODE:610E Check_PathLen   proc near		     ; ...
DOSCODE:610E		     mov     si, ss:WFP_START
DOSCODE:610E Check_PathLen   endp
DOSCODE:6113 ; =============== S U B R O U T I N E =======================================
DOSCODE:6113 check_PathLen2  proc near		     ; ...
DOSCODE:6113		     push    ss
DOSCODE:6114		     pop     ds
DOSCODE:6115		     push    cx
DOSCODE:6116		     call    DStrLen
DOSCODE:6119		     cmp     cx, 67
DOSCODE:611C		     pop     cx
DOSCODE:611D		     retn
DOSCODE:611D check_PathLen2  endp
DOSCODE:611E IOCTLJMPTABLE   dw	offset ioctl_getset_data ; ...
DOSCODE:6120		     dw	offset ioctl_getset_data
DOSCODE:6122		     dw	offset ioctl_control_string
DOSCODE:6124		     dw	offset ioctl_control_string
DOSCODE:6126		     dw	offset ioctl_get_dev
DOSCODE:6128		     dw	offset ioctl_get_dev
DOSCODE:612A		     dw	offset ioctl_status
DOSCODE:612C		     dw	offset ioctl_status
DOSCODE:612E		     dw	offset ioctl_rem_media
DOSCODE:6130		     dw	offset ioctl_drive_attr
DOSCODE:6132		     dw	offset ioctl_handle_redir
DOSCODE:6134		     dw	offset Set_Retry_Parameters
DOSCODE:6136		     dw	offset GENERICIOCTLHANDLE
DOSCODE:6138		     dw	offset GENERICIOCTL
DOSCODE:613A		     dw	offset ioctl_drive_owner
DOSCODE:613C		     dw	offset ioctl_drive_owner
DOSCODE:613E		     dw	offset GENERICIOCTLHANDLE ; query_handle_support
DOSCODE:6140		     dw	offset GENERICIOCTL  ; query_device_support
DOSCODE:6142 ; =============== S U B R O U T I N E =======================================
DOSCODE:6142 $IOCTL	     proc near		     ; ...
DOSCODE:6142 ; FUNCTION	CHUNK AT DOSCODE:43F1 SIZE 0000001C BYTES
DOSCODE:6142 ; FUNCTION	CHUNK AT DOSCODE:63B3 SIZE 0000004A BYTES
DOSCODE:6142		     mov     si, ds
DOSCODE:6144		     push    ss
DOSCODE:6145		     pop     ds
DOSCODE:6146		     cmp     al, 11h
DOSCODE:6148		     ja	     short ioctl_bad_funj2
DOSCODE:614A		     push    ax
DOSCODE:614B		     mov     di, ax
DOSCODE:614D		     and     di, 0FFh
DOSCODE:6151		     shl     di, 1
DOSCODE:6153		     pop     ax
DOSCODE:6154		     jmp     cs:IOCTLJMPTABLE[di]
DOSCODE:6159 ioctl_bad_funj2:			     ; ...
DOSCODE:6159		     jmp     ioctl_bad_fun
DOSCODE:615C ioctl_getset_data:			     ; ...
DOSCODE:615C		     call    SFFromHandle
DOSCODE:615F		     jnb     short ioctl_check_permissions
DOSCODE:6161 ioctl_bad_handle:			     ; ...
DOSCODE:6161		     mov     al, 6
DOSCODE:6163 ioctl_error:			     ; ...
DOSCODE:6163		     jmp     SYS_RET_ERR
DOSCODE:6166 ioctl_check_permissions:		     ; ...
DOSCODE:6166		     cmp     al, 0
DOSCODE:6168		     mov     al, es:[di+5]
DOSCODE:616C		     jz	     short ioctl_read
DOSCODE:616E		     or	     dh, dh
DOSCODE:6170		     jz	     short ioctl_check_device
DOSCODE:6172		     mov     al, 0Dh
DOSCODE:6174		     jmp     short ioctl_error
DOSCODE:6176 ioctl_check_device:		     ; ...
DOSCODE:6176		     test    al, 80h
DOSCODE:6178		     jz	     short ioctl_bad_funj2
DOSCODE:617A		     or	     dl, 80h
DOSCODE:617D		     mov     ds:EXTERR_LOCUS, 4
DOSCODE:6182		     mov     es:[di+5],	dl
DOSCODE:6186 ioctl_ok:				     ; ...
DOSCODE:6186		     jmp     SYS_RET_OK
DOSCODE:6189 ioctl_read:			     ; ...
DOSCODE:6189		     mov     ds:EXTERR_LOCUS, 2
DOSCODE:618E		     xor     ah, ah
DOSCODE:6190		     test    al, 80h
DOSCODE:6192		     jz	     short ioctl_no_high
DOSCODE:6194		     mov     ds:EXTERR_LOCUS, 4
DOSCODE:6199		     les     di, es:[di+7]
DOSCODE:619D		     mov     ah, es:[di+5]
DOSCODE:61A1 ioctl_no_high:			     ; ...
DOSCODE:61A1		     mov     dx, ax
DOSCODE:61A3		     call    Get_User_Stack
DOSCODE:61A6		     mov     [si+6], dx
DOSCODE:61A9 jmp_to_ioctl_ok:			     ; ...
DOSCODE:61A9		     jmp     short ioctl_ok
DOSCODE:61AB ioctl_control_string:		     ; ...
DOSCODE:61AB		     call    SFFromHandle
DOSCODE:61AE		     jb	     short ioctl_bad_handle
DOSCODE:61B0		     test    byte ptr es:[di+5], 80h
DOSCODE:61B5		     jz	     short ioctl_bad_funj2
DOSCODE:61B7		     mov     ds:EXTERR_LOCUS, 4
DOSCODE:61BC		     les     di, es:[di+7]
DOSCODE:61C0		     xor     bl, bl
DOSCODE:61C2		     jmp     ioctl_do_string
DOSCODE:61C5 ioctl_status:			     ; ...
DOSCODE:61C5		     mov     ah, 1
DOSCODE:61C7		     sub     al, 6
DOSCODE:61C9		     jz	     short ioctl_get_status
DOSCODE:61CB		     mov     ah, 3
DOSCODE:61CD ioctl_get_status:			     ; ...
DOSCODE:61CD		     push    ax
DOSCODE:61CE		     call    GET_IO_SFT
DOSCODE:61D1		     pop     ax
DOSCODE:61D2		     jnb     short DO_IOFUNC
DOSCODE:61D4		     jmp     short ioctl_bad_handle
DOSCODE:61D6 DO_IOFUNC:				     ; ...
DOSCODE:61D6		     call    IOFUNC
DOSCODE:61D9		     mov     ah, al
DOSCODE:61DB		     mov     al, 0FFh
DOSCODE:61DD		     jnz     short ioctl_status_ret
DOSCODE:61DF		     inc     al
DOSCODE:61E1 ioctl_status_ret:			     ; ...
DOSCODE:61E1		     jmp     short jmp_to_ioctl_ok
DOSCODE:61E3 Set_Retry_Parameters:		     ; ...
DOSCODE:61E3		     mov     ds:RetryLoop, cx
DOSCODE:61E7		     or	     dx, dx
DOSCODE:61E9		     jz	     short ioctl_bad_fun
DOSCODE:61EB		     mov     ds:RetryCount, dx
DOSCODE:61EF		     jmp     short ioctl_status_ret
DOSCODE:61F1 GENERICIOCTLHANDLE:		     ; ...
DOSCODE:61F1		     call    SFFromHandle
DOSCODE:61F4		     jb	     short ioctl_bad_handlej
DOSCODE:61F6		     test    byte ptr es:[di+6], 80h
DOSCODE:61FB		     jnz     short ioctl_bad_fun
DOSCODE:61FD		     mov     ds:EXTERR_LOCUS, 4
DOSCODE:6202		     les     di, es:[di+7]
DOSCODE:6206		     jmp     short Do_GenIOCTL
DOSCODE:6208 GENERICIOCTL:			     ; ...
DOSCODE:6208		     mov     ds:EXTERR_LOCUS, 2
DOSCODE:620D		     cmp     ch, 8
DOSCODE:6210		     jnz     short ioctl_bad_fun
DOSCODE:6212		     call    Check_If_Net
DOSCODE:6215		     jnz     short ioctl_bad_fun
DOSCODE:6217 Do_GenIOCTL:			     ; ...
DOSCODE:6217		     test    byte ptr es:[di+4], 40h
DOSCODE:621C		     jz	     short ioctl_bad_fun
DOSCODE:621E		     mov     ds:IOCALL_REQFUNC,	13h
DOSCODE:6223		     cmp     al, 10h
DOSCODE:6225		     jl	     short SetIOCtlBlock
DOSCODE:6227		     test    byte ptr es:[di+4], 80h
DOSCODE:622C		     jz	     short ioctl_bad_fun
DOSCODE:622E		     mov     ds:IOCALL_REQFUNC,	19h
DOSCODE:6233 SetIOCtlBlock:			     ; ...
DOSCODE:6233		     push    es
DOSCODE:6234		     push    di
DOSCODE:6235		     mov     ds:IOCALL,	23
DOSCODE:623A		     mov     ds:IOCALL_REQUNIT,	bl
DOSCODE:623E		     mov     ds:IOMED, ch
DOSCODE:6242		     mov     byte ptr ds:IOXAD,	cl
DOSCODE:6246		     mov     word ptr ds:IOXAD+1, si
DOSCODE:624A		     mov     word ptr ds:IOXAD+3, di
DOSCODE:624E		     mov     ds:IOSCNT+1, dx
DOSCODE:6252		     mov     ds:IOSSEC+1, si
DOSCODE:6256		     mov     bx, offset	IOCALL
DOSCODE:6259		     push    ss
DOSCODE:625A		     pop     es
DOSCODE:625B		     pop     si
DOSCODE:625C		     pop     ds
DOSCODE:625D		     jmp     ioctl_do_IO
DOSCODE:6260 ioctl_bad_fun:			     ; ...
DOSCODE:6260		     mov     al, 1
DOSCODE:6262		     jmp     SYS_RET_ERR
DOSCODE:6265 ioctl_bad_handlej:			     ; ...
DOSCODE:6265		     jmp     ioctl_bad_handle
DOSCODE:6268 ioctl_rem_media:			     ; ...
DOSCODE:6268		     call    Check_If_Net
DOSCODE:626B		     jnz     short ioctl_bad_fun
DOSCODE:626D		     test    byte ptr es:[di+5], 8
DOSCODE:6272		     jz	     short ioctl_bad_fun
DOSCODE:6274		     mov     ss:IOCALL_REQFUNC,	15
DOSCODE:627A		     mov     al, 13
DOSCODE:627C		     mov     ah, bl
DOSCODE:627E		     mov     word ptr ss:IOCALL, ax
DOSCODE:6282		     xor     ax, ax
DOSCODE:6284		     mov     ss:IOCALL_REQSTAT,	ax
DOSCODE:6288		     push    es
DOSCODE:6289		     pop     ds
DOSCODE:628A		     mov     si, di
DOSCODE:628C		     push    ss
DOSCODE:628D		     pop     es
DOSCODE:628E		     mov     bx, offset	IOCALL
DOSCODE:6291		     push    ds
DOSCODE:6292		     push    si
DOSCODE:6293		     call    DEVIOCALL2
DOSCODE:6296		     pop     si
DOSCODE:6297		     pop     ds
DOSCODE:6298		     mov     ax, ss:IOCALL_REQSTAT
DOSCODE:629C		     and     ax, 200h
DOSCODE:629F		     mov     cl, 9
DOSCODE:62A1		     shr     ax, cl
DOSCODE:62A3 ioctlt_rmed_ok:			     ; ...
DOSCODE:62A3		     jmp     SYS_RET_OK
DOSCODE:62A6 ioctl_drive_attr:			     ; ...
DOSCODE:62A6		     mov     al, bl
DOSCODE:62A8		     call    GETTHISDRV
DOSCODE:62AB		     jb	     short ioctl_drv_err
DOSCODE:62AD		     call    Get_Driver_BL
DOSCODE:62B0		     jb	     short ioctl_drv_err
DOSCODE:62B2		     mov     dx, es:[di+4]
DOSCODE:62B6		     mov     bl, al
DOSCODE:62B8		     les     di, ss:THISCDS
DOSCODE:62BD		     test    byte ptr es:[di+44h], 80h
DOSCODE:62C2		     jz	     short IOCTLShare
DOSCODE:62C4		     mov     dx, 1000h
DOSCODE:62C7 IOCTLShare:			     ; ...
DOSCODE:62C7		     push    ss
DOSCODE:62C8		     pop     ds
DOSCODE:62C9		     mov     si, offset	OPENBUF
DOSCODE:62CC		     add     bl, 'A'
DOSCODE:62CF		     mov     [si], bl
DOSCODE:62D1		     mov     word ptr [si+1], ':'
DOSCODE:62D6		     mov     ax, 300h
DOSCODE:62D9		     clc
DOSCODE:62DA		     int     2Ah	     ; Microsoft Networks - CHECK DIRECT I/O
DOSCODE:62DA					     ; DS:SI ->	ASCIZ disk device name (may be full path or only drive
DOSCODE:62DA					     ; specifier--must include the colon)
DOSCODE:62DA					     ; Return: CF clear	if absolute disk access	allowed
DOSCODE:62DC		     jnb     short IOCTLLocal
DOSCODE:62DE		     or	     dx, 200h
DOSCODE:62E2 IOCTLLocal:			     ; ...
DOSCODE:62E2		     test    byte ptr es:[di+44h], 10h
DOSCODE:62E7		     jz	     short ioctl_set_DX
DOSCODE:62E9		     or	     dx, 8000h
DOSCODE:62ED ioctl_set_DX:			     ; ...
DOSCODE:62ED		     call    Get_User_Stack
DOSCODE:62F0		     mov     [si+6], dx
DOSCODE:62F3 ioctl_dattr_ok:			     ; ...
DOSCODE:62F3		     jmp     short ioctlt_rmed_ok
DOSCODE:62F5 ioctl_drv_err:			     ; ...
DOSCODE:62F5		     mov     al, 0Fh
DOSCODE:62F7 ioctl_dattr_errj:			     ; ...
DOSCODE:62F7		     jmp     SYS_RET_ERR
DOSCODE:62FA ioctl_handle_redir:		     ; ...
DOSCODE:62FA		     call    SFFromHandle
DOSCODE:62FD		     jnb     short ioctl_got_sft
DOSCODE:62FF		     jmp     ioctl_bad_handle
DOSCODE:6302 ioctl_got_sft:			     ; ...
DOSCODE:6302		     mov     dx, es:[di+5]
DOSCODE:6306		     jmp     short ioctl_set_DX
DOSCODE:6308 ioctl_bad_funj:			     ; ...
DOSCODE:6308		     jmp     ioctl_bad_fun
DOSCODE:630B ioctl_get_dev:			     ; ...
DOSCODE:630B		     call    Check_If_Net
DOSCODE:630E		     jnz     short ioctl_bad_funj
DOSCODE:6310 ioctl_do_string:			     ; ...
DOSCODE:6310		     test    byte ptr es:[di+5], 40h
DOSCODE:6315		     jz	     short ioctl_bad_funj
DOSCODE:6317		     mov     ds:IOCALL_REQFUNC,	3
DOSCODE:631C		     test    al, 1
DOSCODE:631E		     jz	     short ioctl_control_call
DOSCODE:6320		     mov     ds:IOCALL_REQFUNC,	12
DOSCODE:6325 ioctl_control_call:		     ; ...
DOSCODE:6325		     mov     al, 22
DOSCODE:6327		     mov     ah, bl
DOSCODE:6329		     mov     word ptr ds:IOCALL, ax
DOSCODE:632C		     xor     ax, ax
DOSCODE:632E		     mov     ds:IOCALL_REQSTAT,	ax
DOSCODE:6331		     mov     ds:IOMED, al
DOSCODE:6334		     mov     ds:IOSCNT,	cx
DOSCODE:6338		     mov     word ptr ds:IOXAD,	dx
DOSCODE:633C		     mov     word ptr ds:IOXAD+2, si
DOSCODE:6340		     push    es
DOSCODE:6341		     pop     ds
DOSCODE:6342		     mov     si, di
DOSCODE:6344		     push    ss
DOSCODE:6345		     pop     es
DOSCODE:6346		     mov     bx, offset	IOCALL
DOSCODE:6349 ioctl_do_IO:			     ; ...
DOSCODE:6349		     call    DEVIOCALL2
DOSCODE:634C		     test    byte ptr ss:IOCALL_REQSTAT+1, 80h
DOSCODE:6352		     jnz     short ioctl_string_err
DOSCODE:6354		     mov     ax, ss:IOSCNT
DOSCODE:6358		     jmp     short ioctl_dattr_ok
DOSCODE:635A ioctl_string_err:			     ; ...
DOSCODE:635A		     mov     di, ss:IOCALL_REQSTAT
DOSCODE:635F		     and     di, 0FFh
DOSCODE:6363		     mov     ax, di
DOSCODE:6365		     call    SET_I24_EXTENDED_ERROR
DOSCODE:6368		     mov     ax, ss:EXTERR
DOSCODE:636C		     jmp     short ioctl_dattr_errj
DOSCODE:636C $IOCTL	     endp
DOSCODE:636E ; =============== S U B R O U T I N E =======================================
DOSCODE:636E Get_Driver_BL   proc near		     ; ...
DOSCODE:636E		     push    ax
DOSCODE:636F		     mov     al, bl
DOSCODE:6371		     call    GETTHISDRV
DOSCODE:6374		     jb	     short ioctl_bad_drv
DOSCODE:6376		     xor     bl, bl
DOSCODE:6378		     mov     ds:EXTERR_LOCUS, 3
DOSCODE:637D		     les     di, ds:THISCDS
DOSCODE:6381		     test    byte ptr es:[di+44h], 80h
DOSCODE:6386		     les     di, es:[di+45h]
DOSCODE:638A		     jnz     short got_dev_ptr
DOSCODE:638C		     mov     ds:EXTERR_LOCUS, 2
DOSCODE:6391		     mov     bl, es:[di+1]
DOSCODE:6395		     les     di, es:[di+13h]
DOSCODE:6399 got_dev_ptr:			     ; ...
DOSCODE:6399		     clc
DOSCODE:639A ioctl_bad_drv:			     ; ...
DOSCODE:639A		     pop     ax
DOSCODE:639B		     retn
DOSCODE:639B Get_Driver_BL   endp
DOSCODE:639C ; =============== S U B R O U T I N E =======================================
DOSCODE:639C Check_If_Net    proc near		     ; ...
DOSCODE:639C		     call    Get_Driver_BL
DOSCODE:639F		     jb	     short ioctl_drv_err_pop
DOSCODE:63A1		     push    es
DOSCODE:63A2		     push    di
DOSCODE:63A3		     les     di, ds:THISCDS
DOSCODE:63A7		     test    byte ptr es:[di+44h], 80h
DOSCODE:63AC		     pop     di
DOSCODE:63AD		     pop     es
DOSCODE:63AE		     retn
DOSCODE:63AF ioctl_drv_err_pop:			     ; ...
DOSCODE:63AF		     pop     ax
DOSCODE:63B0		     jmp     ioctl_drv_err
DOSCODE:63B0 Check_If_Net    endp ; sp-analysis	failed
DOSCODE:63B3 ; START OF	FUNCTION CHUNK FOR $IOCTL
DOSCODE:63B3 ioctl_bad_funj3:			     ; ...
DOSCODE:63B3		     jmp     ioctl_bad_fun
DOSCODE:63B6 ioctl_string_errj:			     ; ...
DOSCODE:63B6		     jmp     short ioctl_string_err
DOSCODE:63B8 ioctl_drive_owner:			     ; ...
DOSCODE:63B8		     call    Check_If_Net
DOSCODE:63BB		     jnz     short ioctl_bad_funj3
DOSCODE:63BD		     test    byte ptr es:[di+4], 40h
DOSCODE:63C2		     jz	     short ioctl_bad_funj3
DOSCODE:63C4		     mov     ds:IOCALL_REQFUNC,	23
DOSCODE:63C9		     cmp     al, 0Eh
DOSCODE:63CB		     jz	     short GetOwner
DOSCODE:63CD		     mov     ds:IOCALL_REQFUNC,	24
DOSCODE:63D2 GetOwner:				     ; ...
DOSCODE:63D2		     mov     al, 13
DOSCODE:63D4		     mov     ah, bl
DOSCODE:63D6		     mov     word ptr ds:IOCALL, ax
DOSCODE:63D9		     xor     ax, ax
DOSCODE:63DB		     mov     ds:IOCALL_REQSTAT,	ax
DOSCODE:63DE		     push    es
DOSCODE:63DF		     pop     ds
DOSCODE:63E0		     mov     si, di
DOSCODE:63E2		     push    ss
DOSCODE:63E3		     pop     es
DOSCODE:63E4		     mov     bx, offset	IOCALL
DOSCODE:63E7		     push    ds
DOSCODE:63E8		     push    si
DOSCODE:63E9		     call    DEVIOCALL2
DOSCODE:63EC		     pop     si
DOSCODE:63ED		     pop     ds
DOSCODE:63EE		     test    byte ptr ss:IOCALL_REQSTAT+1, 80h
DOSCODE:63F4		     jnz     short ioctl_string_errj
DOSCODE:63F6		     mov     al, ss:IOCALL_REQUNIT
DOSCODE:63FA		     jmp     SYS_RET_OK
DOSCODE:63FA ; END OF FUNCTION CHUNK FOR $IOCTL
DOSCODE:63FD ; =============== S U B R O U T I N E =======================================
DOSCODE:63FD DOS_DELETE	     proc near		     ; ...
DOSCODE:63FD		     call    TestNet
DOSCODE:6400		     jnb     short LOCAL_DELETE
DOSCODE:6402		     mov     ax, 1113h
DOSCODE:6405		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	DELETE REMOTE FILE
DOSCODE:6405					     ; SS = DS = DOS CS, SDA first filename pointer -> fully-qualified filename	in DOS CS
DOSCODE:6405					     ; SDA CDS pointer -> current directory structure for drive	with file
DOSCODE:6405					     ; Return: CF set on error
DOSCODE:6407		     retn
DOSCODE:6408 LOCAL_DELETE:			     ; ...
DOSCODE:6408		     mov     ds:FOUNDDEL, 0
DOSCODE:640D		     call    ECritDisk
DOSCODE:6410		     mov     word ptr ds:CREATING, 0E500h
DOSCODE:6416		     mov     si, ds:WFP_START
DOSCODE:641A SKPNUL:				     ; ...
DOSCODE:641A		     lodsb
DOSCODE:641B		     or	     al, al
DOSCODE:641D		     jnz     short SKPNUL
DOSCODE:641F		     sub     si, 4
DOSCODE:6422		     cmp     word ptr [si], '.*'
DOSCODE:6426		     jnz     short TEST_QUEST
DOSCODE:6428		     cmp     byte ptr [si+2], '*'
DOSCODE:642C		     jz	     short CHECK_ATTS
DOSCODE:642E TEST_QUEST:			     ; ...
DOSCODE:642E		     sub     si, 9
DOSCODE:6431		     xchg    di, si
DOSCODE:6433		     push    ss
DOSCODE:6434		     pop     es
DOSCODE:6435		     mov     ax, '??'
DOSCODE:6438		     mov     cx, 4
DOSCODE:643B		     repe scasw
DOSCODE:643D		     jnz     short NOT_ALL
DOSCODE:643F		     xchg    di, si
DOSCODE:6441		     lodsw
DOSCODE:6442		     cmp     ax, '?.'
DOSCODE:6445		     jnz     short NOT_ALL
DOSCODE:6447		     lodsw
DOSCODE:6448		     cmp     ax, '??'
DOSCODE:644B		     jnz     short NOT_ALL
DOSCODE:644D CHECK_ATTS:			     ; ...
DOSCODE:644D		     mov     al, ds:SATTRIB
DOSCODE:6450		     and     al, 1Fh
DOSCODE:6452		     cmp     al, 1Fh
DOSCODE:6454		     jnz     short NOT_ALL
DOSCODE:6456		     mov     ds:DELALL,	0
DOSCODE:645B NOT_ALL:				     ; ...
DOSCODE:645B		     mov     ds:NoSetDir, 1
DOSCODE:6460		     call    GetPathNoSet
DOSCODE:6463		     jnb     short Del_found
DOSCODE:6465		     jnz     short _bad_path
DOSCODE:6467		     or	     cl, cl
DOSCODE:6469		     jz	     short _bad_path
DOSCODE:646B No_file:				     ; ...
DOSCODE:646B		     mov     ax, 2
DOSCODE:646E ErrorReturn:			     ; ...
DOSCODE:646E		     stc
DOSCODE:646F		     call    LCritDisk
DOSCODE:6472		     retn
DOSCODE:6473 _bad_path:				     ; ...
DOSCODE:6473		     mov     ax, 3
DOSCODE:6476		     jmp     short ErrorReturn
DOSCODE:6478 Del_found:				     ; ...
DOSCODE:6478		     jnz     short NOT_DIR
DOSCODE:647A		     cmp     ds:DELALL,	0
DOSCODE:647F		     jz	     short NOT_DIR
DOSCODE:6481 Del_access_err:			     ; ...
DOSCODE:6481		     mov     ax, 5
DOSCODE:6484		     jmp     short ErrorReturn
DOSCODE:6486 NOT_DIR:				     ; ...
DOSCODE:6486		     or	     ah, ah
DOSCODE:6488		     js	     short Del_access_err
DOSCODE:648A DELFILE:				     ; ...
DOSCODE:648A		     or	     ds:FOUNDDEL, 1
DOSCODE:648F		     push    ds
DOSCODE:6490		     mov     ah, ds:DELALL
DOSCODE:6494		     lds     di, ds:CURBUF
DOSCODE:6498		     test    ss:ATTRIB,	1
DOSCODE:649E		     jnz     short DoDelete
DOSCODE:64A0		     test    byte ptr [bx+0Bh],	1
DOSCODE:64A4		     jz	     short DoDelete
DOSCODE:64A6		     pop     ds
DOSCODE:64A7		     jmp     short DELNXT
DOSCODE:64A9 DoDelete:				     ; ...
DOSCODE:64A9		     call    REN_DEL_Check
DOSCODE:64AC		     jnb     short DEL_SHARE_OK
DOSCODE:64AE		     pop     ds
DOSCODE:64AF		     jmp     short DELNXT
DOSCODE:64B1 DEL_SHARE_OK:			     ; ...
DOSCODE:64B1		     test    byte ptr [di+5], 40h
DOSCODE:64B5		     jnz     short yesdirty
DOSCODE:64B7		     call    INC_DIRTY_COUNT
DOSCODE:64BA		     or	     byte ptr [di+5], 40h
DOSCODE:64BE yesdirty:				     ; ...
DOSCODE:64BE		     mov     [bx], ah
DOSCODE:64C0		     mov     bx, [si]
DOSCODE:64C2		     pop     ds
DOSCODE:64C3		     or	     ds:FOUNDDEL, 10h
DOSCODE:64C8		     cmp     bx, 2
DOSCODE:64CB		     jb	     short DELNXT
DOSCODE:64CD		     cmp     bx, es:[bp+0Dh]
DOSCODE:64D1		     ja	     short DELNXT
DOSCODE:64D3		     call    RELEASE
DOSCODE:64D6		     jb	     short No_fileJ
DOSCODE:64D8		     call    FastOpen_Delete
DOSCODE:64DB DELNXT:				     ; ...
DOSCODE:64DB		     les     bp, ds:THISDPB
DOSCODE:64DF		     call    GETENTRY
DOSCODE:64E2		     jb	     short No_fileJ
DOSCODE:64E4		     call    NEXTENT
DOSCODE:64E7		     jnb     short DELFILE
DOSCODE:64E9		     les     bp, ds:THISDPB
DOSCODE:64ED		     mov     al, es:[bp+0]
DOSCODE:64F1		     call    FLUSHBUF
DOSCODE:64F4		     jb	     short No_fileJ
DOSCODE:64F6		     test    ds:FOUNDDEL, 10h
DOSCODE:64FB		     jz	     short DelError
DOSCODE:64FD		     test    ds:ATTRIB,	8
DOSCODE:6502		     jz	     short No_Set_Flag
DOSCODE:6504		     push    ax
DOSCODE:6505		     push    es
DOSCODE:6506		     push    di
DOSCODE:6507		     les     di, ds:THISCDS
DOSCODE:650B		     mov     ah, es:[di]
DOSCODE:650E		     sub     ah, 'A'
DOSCODE:6511		     mov     ds:VOLCHNG_FLAG, ah
DOSCODE:6515		     xor     bh, bh
DOSCODE:6517		     call    Set_Media_ID
DOSCODE:651A		     call    FATREAD_CDS
DOSCODE:651D		     pop     di
DOSCODE:651E		     pop     es
DOSCODE:651F		     pop     ax
DOSCODE:6520 No_Set_Flag:			     ; ...
DOSCODE:6520		     call    LCritDisk
DOSCODE:6523		     retn
DOSCODE:6524 DelError:				     ; ...
DOSCODE:6524		     test    ds:FOUNDDEL, 1
DOSCODE:6529		     jnz     short Del_access_errJ
DOSCODE:652B No_fileJ:				     ; ...
DOSCODE:652B		     jmp     No_file
DOSCODE:652E Del_access_errJ:			     ; ...
DOSCODE:652E		     jmp     Del_access_err
DOSCODE:652E DOS_DELETE	     endp
DOSCODE:6531 ; =============== S U B R O U T I N E =======================================
DOSCODE:6531 REN_DEL_Check   proc near		     ; ...
DOSCODE:6531		     push    ds
DOSCODE:6532		     push    di
DOSCODE:6533		     push    ax
DOSCODE:6534		     push    bx
DOSCODE:6535		     push    si
DOSCODE:6536		     push    ss
DOSCODE:6537		     pop     es
DOSCODE:6538		     mov     di, ss:WFP_START
DOSCODE:653D		     mov     si, bx
DOSCODE:653F		     mov     ds, word ptr ss:CURBUF+2
DOSCODE:6544		     mov     bx, di
DOSCODE:6546		     add     bx, 2
DOSCODE:6549		     call    StrLen
DOSCODE:654C		     dec     cx
DOSCODE:654D		     add     di, cx
DOSCODE:654F		     call    SkipBack
DOSCODE:6552		     inc     di
DOSCODE:6553		     mov     ss:SAVE_BX, di
DOSCODE:6558		     call    PackName
DOSCODE:655B		     pop     si
DOSCODE:655C		     pop     bx
DOSCODE:655D		     push    bx
DOSCODE:655E		     push    si
DOSCODE:655F		     push    ss
DOSCODE:6560		     pop     ds
DOSCODE:6561		     call    ds:ShCloseFile
DOSCODE:6565		     mov     word ptr ds:THISSFT+2, ds
DOSCODE:6569		     mov     word ptr ds:THISSFT, (offset RENAMEDMA+145h) ; AUXSTACK-SF_ENTRY.size
DOSCODE:6569					     ; RENAMEDMA+(384-59)
DOSCODE:656F		     xor     ah, ah
DOSCODE:6571		     call    DOOPEN
DOSCODE:6574		     les     di, ds:THISSFT
DOSCODE:6578		     mov     word ptr es:[di+2], 10h
DOSCODE:657E		     mov     word ptr es:[di], 1
DOSCODE:6583		     call    ShareEnter
DOSCODE:6586		     jb	     short CheckDone
DOSCODE:6588		     les     di, ds:THISSFT
DOSCODE:658C		     mov     word ptr es:[di], 0
DOSCODE:6591		     call    ShareEnd
DOSCODE:6594		     clc
DOSCODE:6595 CheckDone:				     ; ...
DOSCODE:6595		     les     bp, ds:THISDPB
DOSCODE:6599		     pop     si
DOSCODE:659A		     pop     bx
DOSCODE:659B		     pop     ax
DOSCODE:659C		     pop     di
DOSCODE:659D		     pop     ds
DOSCODE:659E		     retn
DOSCODE:659E REN_DEL_Check   endp
DOSCODE:659F ; =============== S U B R O U T I N E =======================================
DOSCODE:659F FastOpen_Delete proc near		     ; ...
DOSCODE:659F		     pushf
DOSCODE:65A0		     push    si
DOSCODE:65A1		     push    bx
DOSCODE:65A2		     push    ax
DOSCODE:65A3		     mov     si, ss:WFP_START
DOSCODE:65A8		     mov     al, 3
DOSCODE:65AA fastinvoke:			     ; ...
DOSCODE:65AA		     mov     bx, offset	FastTable_2
DOSCODE:65AD		     call    dword ptr [bx]
DOSCODE:65AF		     pop     ax
DOSCODE:65B0		     pop     bx
DOSCODE:65B1		     pop     si
DOSCODE:65B2		     popf
DOSCODE:65B3		     retn
DOSCODE:65B3 FastOpen_Delete endp
DOSCODE:65B4 ; =============== S U B R O U T I N E =======================================
DOSCODE:65B4 FastOpen_Rename proc near		     ; ...
DOSCODE:65B4		     pushf
DOSCODE:65B5		     push    si
DOSCODE:65B6		     push    di
DOSCODE:65B7		     push    bx
DOSCODE:65B8		     push    ax
DOSCODE:65B9		     mov     si, ss:REN_WFP
DOSCODE:65BE		     mov     di, offset	NAME1
DOSCODE:65C1		     mov     al, 6
DOSCODE:65C3		     mov     bx, offset	FastTable_2
DOSCODE:65C6		     call    dword ptr [bx]
DOSCODE:65C8		     pop     ax
DOSCODE:65C9		     pop     bx
DOSCODE:65CA		     pop     di
DOSCODE:65CB		     pop     si
DOSCODE:65CC		     popf
DOSCODE:65CD		     retn
DOSCODE:65CD FastOpen_Rename endp
DOSCODE:65CE ; =============== S U B R O U T I N E =======================================
DOSCODE:65CE FastOpen_Update proc near		     ; ...
DOSCODE:65CE		     pushf
DOSCODE:65CF		     push    si
DOSCODE:65D0		     push    bx
DOSCODE:65D1		     push    ax
DOSCODE:65D2		     mov     al, 4
DOSCODE:65D4		     jmp     short fastinvoke
DOSCODE:65D4 FastOpen_Update endp
DOSCODE:65D6 ; =============== S U B R O U T I N E =======================================
DOSCODE:65D6 Fast_Dispatch   proc near		     ; ...
DOSCODE:65D6		     mov     si, offset	FastTable_2
DOSCODE:65D9		     call    dword ptr ss:[si]
DOSCODE:65DC		     retn
DOSCODE:65DC Fast_Dispatch   endp
DOSCODE:65DD ; =============== S U B R O U T I N E =======================================
DOSCODE:65DD DOS_RENAME	     proc near		     ; ...
DOSCODE:65DD		     call    TestNet
DOSCODE:65E0		     jnb     short LOCAL_RENAME
DOSCODE:65E2		     mov     ax, 1111h
DOSCODE:65E5		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	RENAME REMOTE FILE
DOSCODE:65E5					     ; SS = DS = DOS CS, SDA first filename pointer = offset of	fully-qualified	old name
DOSCODE:65E5					     ; SDA CDS pointer -> current directory
DOSCODE:65E5					     ; Return: CF set on error
DOSCODE:65E7		     retn
DOSCODE:65E8 LOCAL_RENAME:			     ; ...
DOSCODE:65E8		     mov     ds:EXTERR_LOCUS, 2
DOSCODE:65ED		     mov     si, ds:WFP_START
DOSCODE:65F1		     mov     di, ds:REN_WFP
DOSCODE:65F5		     mov     al, [si]
DOSCODE:65F7		     mov     ah, [di]
DOSCODE:65F9		     or	     ax, 2020h
DOSCODE:65FC		     cmp     al, ah
DOSCODE:65FE		     jz	     short SAMEDRV
DOSCODE:6600		     mov     ax, 11h
DOSCODE:6603		     stc
DOSCODE:6604		     retn
DOSCODE:6605 SAMEDRV:				     ; ...
DOSCODE:6605		     push    word ptr ds:DMAADD+2
DOSCODE:6609		     push    word ptr ds:DMAADD
DOSCODE:660D		     mov     word ptr ds:DMAADD+2, ds
DOSCODE:6611		     mov     word ptr ds:DMAADD, offset	RENAMEDMA
DOSCODE:6617		     mov     ds:FOUND_DEV, 0
DOSCODE:661C		     call    ECritDisk
DOSCODE:661F		     call    DOS_SEARCH_FIRST
DOSCODE:6622		     jnb     short Check_Dev
DOSCODE:6624		     cmp     ax, 12h
DOSCODE:6627		     jnz     short GOTERR
DOSCODE:6629		     mov     ax, 2
DOSCODE:662C GOTERR:				     ; ...
DOSCODE:662C		     stc
DOSCODE:662D RENAME_POP:			     ; ...
DOSCODE:662D		     pop     word ptr ds:DMAADD
DOSCODE:6631		     pop     word ptr ds:DMAADD+2
DOSCODE:6635		     call    LCritDisk
DOSCODE:6638		     retn
DOSCODE:6639 Check_Dev:				     ; ...
DOSCODE:6639		     mov     ax, 5
DOSCODE:663C		     push    ds
DOSCODE:663D		     lds     si, ds:DMAADD
DOSCODE:6641		     add     si, 21
DOSCODE:6644		     test    byte ptr [si+11], 10h
DOSCODE:6648		     jz	     short notdir
DOSCODE:664A		     mov     si, ds:REN_WFP
DOSCODE:664E		     call    check_PathLen2
DOSCODE:6651 notdir:				     ; ...
DOSCODE:6651		     pop     ds
DOSCODE:6652		     ja	     short GOTERR
DOSCODE:6654		     cmp     ds:FOUND_DEV, 0
DOSCODE:6659		     jnz     short GOTERR
DOSCODE:665B		     mov     si, bx
DOSCODE:665D		     add     si, 26
DOSCODE:6660		     call    REN_DEL_Check
DOSCODE:6663		     jnb     short REN_OK1
DOSCODE:6665		     mov     ax, 20h
DOSCODE:6668		     jmp     short RENAME_POP
DOSCODE:666A REN_OK1:				     ; ...
DOSCODE:666A		     push    si
DOSCODE:666B		     lds     si, ds:DMAADD
DOSCODE:666F		     add     si, 21
DOSCODE:6672		     test    byte ptr [si+11], 10h
DOSCODE:6676		     jz	     short NOT_DIR1
DOSCODE:6678		     pop     si
DOSCODE:6679		     jmp     short SWAP_SOURCE
DOSCODE:667B NOT_DIR1:				     ; ...
DOSCODE:667B		     pop     si
DOSCODE:667C		     call    FastOpen_Delete
DOSCODE:667F SWAP_SOURCE:			     ; ...
DOSCODE:667F		     mov     ax, ds:WFP_START
DOSCODE:6682		     mov     si, ds:REN_WFP
DOSCODE:6686		     mov     ds:WFP_START, si
DOSCODE:668A		     mov     ds:REN_WFP, ax
DOSCODE:668D		     mov     ds:CURR_DIR_END, 0FFFFh
DOSCODE:6693		     mov     word ptr ds:CREATING, 0E5FFh
DOSCODE:6699		     call    GetPathNoSet
DOSCODE:669C		     jb	     short NODEST
DOSCODE:669E		     or	     ah, ah
DOSCODE:66A0		     jns     short SAVEDEST
DOSCODE:66A2 BAD_ACC:				     ; ...
DOSCODE:66A2		     mov     ax, 5
DOSCODE:66A5		     stc
DOSCODE:66A6 RENAME_CLEAN:			     ; ...
DOSCODE:66A6		     pushf
DOSCODE:66A7		     push    ax
DOSCODE:66A8		     mov     al, ds:THISDRV
DOSCODE:66AB		     call    FLUSHBUF
DOSCODE:66AE		     pop     ax
DOSCODE:66AF		     cmp     ds:FAILERR, 0
DOSCODE:66B4		     jnz     short BAD_ERR
DOSCODE:66B6		     popf
DOSCODE:66B7		     jmp     RENAME_POP
DOSCODE:66BA BAD_ERR:				     ; ...
DOSCODE:66BA		     pop     ax
DOSCODE:66BB		     mov     ax, 3
DOSCODE:66BE		     jmp     GOTERR
DOSCODE:66C1 NODEST:				     ; ...
DOSCODE:66C1		     jnz     short BAD_PATH
DOSCODE:66C3		     cmp     ds:FAILERR, 0
DOSCODE:66C8		     jnz     short BAD_PATH
DOSCODE:66CA		     or	     cl, cl
DOSCODE:66CC		     jnz     short SAVEDEST
DOSCODE:66CE BAD_PATH:				     ; ...
DOSCODE:66CE		     mov     ax, 3
DOSCODE:66D1		     stc
DOSCODE:66D2		     jmp     RENAME_POP
DOSCODE:66D5 SAVEDEST:				     ; ...
DOSCODE:66D5		     push    ss
DOSCODE:66D6		     pop     es
DOSCODE:66D7		     mov     di, offset	NAME2
DOSCODE:66DA		     mov     si, offset	NAME1
DOSCODE:66DD		     mov     cx, 11
DOSCODE:66E0		     rep movsb
DOSCODE:66E2		     mov     ax, ds:DIRSTART
DOSCODE:66E5		     mov     ds:DESTSTART, ax
DOSCODE:66E8 BUILDDEST:				     ; ...
DOSCODE:66E8		     push    ss
DOSCODE:66E9		     pop     es
DOSCODE:66EA		     mov     bx, (offset RENAMEDMA+15h)
DOSCODE:66ED		     mov     di, offset	NAME1
DOSCODE:66F0		     mov     si, offset	NAME2
DOSCODE:66F3		     mov     cx, 11
DOSCODE:66F6		     call    NEW_RENAME
DOSCODE:66F9		     mov     ds:ATTRIB,	16h
DOSCODE:66FE		     mov     ds:CREATING, 0FFh
DOSCODE:6703		     call    DEVNAME
DOSCODE:6706		     jnb     short BAD_ACC
DOSCODE:6708		     mov     bx, ds:DESTSTART
DOSCODE:670C		     les     bp, ds:THISDPB
DOSCODE:6710		     call    SETDIRSRCH
DOSCODE:6713		     jb	     short BAD_ACC
DOSCODE:6715		     call    SEARCH
DOSCODE:6718		     jnb     short BAD_ACC
DOSCODE:671A		     cmp     ds:FAILERR, 0
DOSCODE:671F		     jnz     short BAD_ACCJ
DOSCODE:6721		     mov     ax, ds:DESTSTART
DOSCODE:6724		     cmp     ax, word ptr ds:RENAMEDMA+0Fh
DOSCODE:6728		     jz	     short SIMPLE_RENAME
DOSCODE:672A		     mov     al, ds:RENAMEDMA+20h
DOSCODE:672D		     test    al, 10h
DOSCODE:672F		     jnz     short BAD_ACCJ
DOSCODE:6731		     mov     ds:ATTRIB,	al
DOSCODE:6734		     mov     word ptr ds:THISSFT+2, ds
DOSCODE:6738		     mov     si, (offset RENAMEDMA+145h)
DOSCODE:673B		     mov     word ptr ds:THISSFT, si
DOSCODE:673F		     mov     word ptr [si+2], 2
DOSCODE:6744		     xor     cx, cx
DOSCODE:6746		     call    RENAME_MAKE
DOSCODE:6749		     jnb     short GOT_DEST
DOSCODE:674B BAD_ACCJ:				     ; ...
DOSCODE:674B		     jmp     BAD_ACC
DOSCODE:674E GOT_DEST:				     ; ...
DOSCODE:674E		     push    bx
DOSCODE:674F		     les     di, ds:THISSFT
DOSCODE:6753		     call    ShareEnd
DOSCODE:6756		     pop     bx
DOSCODE:6757		     les     di, ds:CURBUF
DOSCODE:675B		     test    byte ptr es:[di+5], 40h
DOSCODE:6760		     jnz     short yesdirty1
DOSCODE:6762		     call    INC_DIRTY_COUNT
DOSCODE:6765		     or	     byte ptr es:[di+5], 40h
DOSCODE:676A yesdirty1:				     ; ...
DOSCODE:676A		     mov     di, bx
DOSCODE:676C		     add     di, 11
DOSCODE:676F		     mov     si, (offset RENAMEDMA+20h)
DOSCODE:6772		     mov     cx, 21
DOSCODE:6775		     rep movsb
DOSCODE:6777		     call    GET_SOURCE
DOSCODE:677A		     jb	     short RENAME_OVER
DOSCODE:677C		     mov     di, bx
DOSCODE:677E		     mov     es, word ptr ds:CURBUF+2
DOSCODE:6782		     mov     al, 0E5h
DOSCODE:6784		     stosb
DOSCODE:6785		     jmp     short DIRTY_IT
DOSCODE:6787 SIMPLE_RENAME:			     ; ...
DOSCODE:6787		     call    GET_SOURCE
DOSCODE:678A		     jb	     short RENAME_OVER
DOSCODE:678C		     mov     di, bx
DOSCODE:678E		     mov     es, word ptr ds:CURBUF+2
DOSCODE:6792		     mov     si, offset	NAME1
DOSCODE:6795		     mov     cx, 11
DOSCODE:6798		     rep movsb
DOSCODE:679A DIRTY_IT:				     ; ...
DOSCODE:679A		     mov     di, word ptr ds:CURBUF
DOSCODE:679E		     test    byte ptr es:[di+5], 40h
DOSCODE:67A3		     jnz     short yesdirty2
DOSCODE:67A5		     call    INC_DIRTY_COUNT
DOSCODE:67A8		     or	     byte ptr es:[di+5], 40h
DOSCODE:67AD yesdirty2:				     ; ...
DOSCODE:67AD		     push    si
DOSCODE:67AE		     lds     si, ds:DMAADD
DOSCODE:67B2		     add     si, 21
DOSCODE:67B5		     test    byte ptr [si+11], 10h
DOSCODE:67B9		     jz	     short NOT_DIR2
DOSCODE:67BB		     call    FastOpen_Rename
DOSCODE:67BE		     pop     si
DOSCODE:67BF		     jmp     short NOT_DIRTY1
DOSCODE:67C1 NOT_DIR2:				     ; ...
DOSCODE:67C1		     pop     si
DOSCODE:67C2 NOT_DIRTY1:			     ; ...
DOSCODE:67C2		     mov     si, (offset RENAMEDMA+1)
DOSCODE:67C5		     call    ECritDisk
DOSCODE:67C8		     mov     ds:CREATING, 0
DOSCODE:67CD		     call    RENAME_NEXT
DOSCODE:67D0		     jb	     short RENAME_OVER
DOSCODE:67D2		     lea     si, [bx+26]
DOSCODE:67D5		     call    REN_DEL_Check
DOSCODE:67D8		     jnb     short REN_OK2
DOSCODE:67DA		     mov     ax, 20h
DOSCODE:67DD		     jmp     RENAME_CLEAN
DOSCODE:67E0 REN_OK2:				     ; ...
DOSCODE:67E0		     mov     al, ds:RENAMEDMA+20h
DOSCODE:67E3		     test    al, 10h
DOSCODE:67E5		     jz	     short Ren_Directory
DOSCODE:67E7		     call    FastOpen_Delete
DOSCODE:67EA		     jmp     BUILDDEST
DOSCODE:67ED Ren_Directory:			     ; ...
DOSCODE:67ED		     call    FastOpen_Rename
DOSCODE:67F0		     jmp     BUILDDEST
DOSCODE:67F3 RENAME_OVER:			     ; ...
DOSCODE:67F3		     clc
DOSCODE:67F4		     jmp     RENAME_CLEAN
DOSCODE:67F4 DOS_RENAME	     endp
DOSCODE:67F7 ; =============== S U B R O U T I N E =======================================
DOSCODE:67F7 GET_SOURCE	     proc near		     ; ...
DOSCODE:67F7		     mov     bx, word ptr ds:RENAMEDMA+0Fh
DOSCODE:67FB		     les     bp, ds:THISDPB
DOSCODE:67FF		     call    SETDIRSRCH
DOSCODE:6802		     jb	     short gs_ret_label
DOSCODE:6804		     call    STARTSRCH
DOSCODE:6807		     mov     ax, word ptr ds:RENAMEDMA+0Dh
DOSCODE:680A		     call    GETENT
DOSCODE:680D gs_ret_label:			     ; ...
DOSCODE:680D		     retn
DOSCODE:680D GET_SOURCE	     endp
DOSCODE:680E ; =============== S U B R O U T I N E =======================================
DOSCODE:680E NEW_RENAME	     proc near		     ; ...
DOSCODE:680E		     lodsb
DOSCODE:680F		     cmp     al, '?'
DOSCODE:6811		     jnz     short NOCHG
DOSCODE:6813		     mov     al, [bx]
DOSCODE:6815 NOCHG:				     ; ...
DOSCODE:6815		     stosb
DOSCODE:6816		     inc     bx
DOSCODE:6817		     loop    NEW_RENAME
DOSCODE:6819		     retn
DOSCODE:6819 NEW_RENAME	     endp
DOSCODE:681A ; =============== S U B R O U T I N E =======================================
DOSCODE:681A GET_FILE_INFO   proc near		     ; ...
DOSCODE:681A		     call    TestNet
DOSCODE:681D		     jnb     short LOCAL_INFO
DOSCODE:681F		     mov     ax, 110Fh
DOSCODE:6822		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	GET REMOTE FILE'S ATTRIBUTES
DOSCODE:6822					     ; SS = DOS	CS, SDA	first filename pointer -> fully-qualified name of file
DOSCODE:6822					     ; SDA CDS pointer -> current directory
DOSCODE:6822					     ; Return: CF set on error,	AX = file attributes
DOSCODE:6824		     retn
DOSCODE:6825 LOCAL_INFO:			     ; ...
DOSCODE:6825		     call    ECritDisk
DOSCODE:6828		     mov     ds:NoSetDir, 1
DOSCODE:682D		     call    Get_FAST_PATH
DOSCODE:6830		     jnb     short info_check_dev
DOSCODE:6832 NO_PATH:				     ; ...
DOSCODE:6832		     jnz     short bad_path1
DOSCODE:6834		     or	     cl, cl
DOSCODE:6836		     jz	     short bad_path1
DOSCODE:6838 info_no_file:			     ; ...
DOSCODE:6838		     mov     ax, 2
DOSCODE:683B BadRet:				     ; ...
DOSCODE:683B		     stc
DOSCODE:683C JustRet:				     ; ...
DOSCODE:683C		     call    LCritDisk
DOSCODE:683F		     retn
DOSCODE:6840 bad_path1:				     ; ...
DOSCODE:6840		     mov     ax, 3
DOSCODE:6843		     jmp     short BadRet
DOSCODE:6845 info_check_dev:			     ; ...
DOSCODE:6845		     or	     ah, ah
DOSCODE:6847		     js	     short info_no_file
DOSCODE:6849		     cmp     word ptr ds:CURBUF, 0FFFFh
DOSCODE:684E		     jnz     short not_root
DOSCODE:6850		     xor     ah, ah
DOSCODE:6852		     mov     al, 10h
DOSCODE:6854		     clc
DOSCODE:6855		     jmp     short JustRet
DOSCODE:6857 not_root:				     ; ...
DOSCODE:6857		     push    ds
DOSCODE:6858		     mov     ds, word ptr ds:CURBUF+2
DOSCODE:685C		     mov     si, bx
DOSCODE:685E		     xor     bx, bx
DOSCODE:6860		     mov     di, bx
DOSCODE:6862		     mov     cx, [si+16h]
DOSCODE:6865		     mov     dx, [si+18h]
DOSCODE:6868		     xor     ah, ah
DOSCODE:686A		     mov     al, [si+0Bh]
DOSCODE:686D		     test    al, 10h
DOSCODE:686F		     jnz     short NO_SIZE
DOSCODE:6871		     mov     di, [si+1Ch]
DOSCODE:6874		     mov     bx, [si+1Eh]
DOSCODE:6877 NO_SIZE:				     ; ...
DOSCODE:6877		     pop     ds
DOSCODE:6878		     clc
DOSCODE:6879		     jmp     short JustRet
DOSCODE:6879 GET_FILE_INFO   endp
DOSCODE:687B ; =============== S U B R O U T I N E =======================================
DOSCODE:687B SET_FILE_ATTRIBUTE	proc near	     ; ...
DOSCODE:687B		     test    ax, 0FFD8h
DOSCODE:687E		     jz	     short set_look
DOSCODE:6880 _BAD_ACC:				     ; ...
DOSCODE:6880		     mov     ds:EXTERR_LOCUS, 1
DOSCODE:6885		     mov     byte ptr ds:EXTERR_ACT_CLASS+1, 7
DOSCODE:688A		     mov     byte ptr ds:EXTERR_ACT_CLASS, 4
DOSCODE:688F		     mov     ax, 5
DOSCODE:6892		     stc
DOSCODE:6893		     retn
DOSCODE:6894 set_look:				     ; ...
DOSCODE:6894		     call    TestNet
DOSCODE:6897		     jnb     short LOCAL_SET
DOSCODE:6899		     push    ax
DOSCODE:689A		     mov     ax, 110Eh
DOSCODE:689D		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	SET REMOTE FILE'S ATTRIBUTES
DOSCODE:689D					     ; SS = DOS	CS, SDA	first filename pointer -> fully-qualified name of file
DOSCODE:689D					     ; SDA CDS pointer -> current directory
DOSCODE:689D					     ; STACK: WORD new file attributes
DOSCODE:689D					     ; Return: CF set on error
DOSCODE:689F		     pop     bx
DOSCODE:68A0		     retn
DOSCODE:68A1 LOCAL_SET:				     ; ...
DOSCODE:68A1		     call    ECritDisk
DOSCODE:68A4		     push    ax
DOSCODE:68A5		     mov     ds:NoSetDir, 1
DOSCODE:68AA		     call    GETPATH
DOSCODE:68AD		     jnb     short set_check_device
DOSCODE:68AF		     pop     bx
DOSCODE:68B0		     jmp     short NO_PATH
DOSCODE:68B2 set_check_device:			     ; ...
DOSCODE:68B2		     or	     ah, ah
DOSCODE:68B4		     jns     short set_check_share
DOSCODE:68B6		     pop     ax
DOSCODE:68B7		     call    LCritDisk
DOSCODE:68BA		     jmp     short _BAD_ACC
DOSCODE:68BC set_check_share:			     ; ...
DOSCODE:68BC		     pop     ax
DOSCODE:68BD		     cmp     word ptr ds:CURBUF, 0FFFFh
DOSCODE:68C2		     jz	     short cannot_set_root
DOSCODE:68C4		     call    REN_DEL_Check
DOSCODE:68C7		     jnb     short set_do
DOSCODE:68C9		     mov     ax, 32
DOSCODE:68CC		     jmp     short OK_BYE
DOSCODE:68CE cannot_set_root:			     ; ...
DOSCODE:68CE		     mov     ax, 5
DOSCODE:68D1		     stc
DOSCODE:68D2		     jmp     short OK_BYE
DOSCODE:68D4 set_do:				     ; ...
DOSCODE:68D4		     les     di, ds:CURBUF
DOSCODE:68D8		     and     byte ptr es:[bx+0Bh], 0D8h
DOSCODE:68DD		     or	     es:[bx+0Bh], al
DOSCODE:68E1		     test    byte ptr es:[di+5], 40h
DOSCODE:68E6		     jnz     short yesdirty3
DOSCODE:68E8		     call    INC_DIRTY_COUNT
DOSCODE:68EB		     or	     byte ptr es:[di+5], 40h
DOSCODE:68F0 yesdirty3:				     ; ...
DOSCODE:68F0		     mov     al, ds:THISDRV
DOSCODE:68F3		     push    dx
DOSCODE:68F4		     push    di
DOSCODE:68F5		     mov     ah, 0
DOSCODE:68F7		     mov     dl, al
DOSCODE:68F9		     mov     di, bx
DOSCODE:68FB		     call    FastOpen_Update
DOSCODE:68FE		     pop     di
DOSCODE:68FF		     pop     dx
DOSCODE:6900		     call    FLUSHBUF
DOSCODE:6903		     jnb     short OK_BYE
DOSCODE:6905		     mov     ax, 2
DOSCODE:6908 OK_BYE:				     ; ...
DOSCODE:6908		     call    LCritDisk
DOSCODE:690B		     retn
DOSCODE:690B SET_FILE_ATTRIBUTE	endp
DOSCODE:690C ; =============== S U B R O U T I N E =======================================
DOSCODE:690C Get_FAST_PATH   proc near		     ; ...
DOSCODE:690C		     or	     ss:FastOpenFlg, 1
DOSCODE:6912		     call    GETPATH
DOSCODE:6915		     pushf
DOSCODE:6916		     and     ss:FastOpenFlg, 80h
DOSCODE:691C		     popf
DOSCODE:691D		     retn
DOSCODE:691D Get_FAST_PATH   endp
DOSCODE:691E ; =============== S U B R O U T I N E =======================================
DOSCODE:691E DOS_DUP	     proc near		     ; ...
DOSCODE:691E		     mov     es, cs:DosDSeg
DOSCODE:6923		     les     di, es:THISSFT
DOSCODE:6928 DOS_Dup_Direct:			     ; ...
DOSCODE:6928		     call    IsSFTNet
DOSCODE:692B		     jnz     short DO_INC
DOSCODE:692D		     call    DEV_OPEN_SFT
DOSCODE:6930 DO_INC:				     ; ...
DOSCODE:6930		     inc     word ptr es:[di]
DOSCODE:6933		     retn
DOSCODE:6933 DOS_DUP	     endp
DOSCODE:6934 DOS_CREATE:			     ; ...
DOSCODE:6934		     xor     ah, ah
DOSCODE:6936 Create_inter:			     ; ...
DOSCODE:6936		     test    al, 80h
DOSCODE:6938		     jnz     short AttErr
DOSCODE:693A		     test    al, 8
DOSCODE:693C		     jz	     short NoReset
DOSCODE:693E		     or	     ds:DOS34_FLAG, 80h
DOSCODE:6944		     mov     al, 8
DOSCODE:6946 NoReset:				     ; ...
DOSCODE:6946		     or	     al, 20h
DOSCODE:6948		     test    al, 50h
DOSCODE:694A		     jz	     short ATT_OK
DOSCODE:694C AttErr:				     ; ...
DOSCODE:694C		     mov     ax, 5
DOSCODE:694F		     mov     ds:EXTERR_LOCUS, 1
DOSCODE:6954		     jmp     short SET_MKND_ERR
DOSCODE:6956 ATT_OK:				     ; ...
DOSCODE:6956		     les     di, ds:THISSFT
DOSCODE:695A		     push    es
DOSCODE:695B		     les     si, ds:THISCDS
DOSCODE:695F		     cmp     si, 0FFFFh
DOSCODE:6962		     jnz     short TEST_RE_NET
DOSCODE:6964		     pop     es
DOSCODE:6965		     test    ds:EXTOPEN_ON, 1
DOSCODE:696A		     jz	     short NOEXTOP
DOSCODE:696C IFS_extopen:			     ; ...
DOSCODE:696C		     push    ax
DOSCODE:696D		     mov     ax, 112Eh
DOSCODE:6970		     int     2Fh	     ; Multiplex - DOS 4 IFSFUNC.EXE - ???
DOSCODE:6970					     ; SS = DS = DOS CS, STACK:	WORD ???   low byte = ???
DOSCODE:6970					     ; Return: CF set on error
DOSCODE:6970					     ; CF clear	if successful
DOSCODE:6972		     pop     bx
DOSCODE:6973		     mov     ds:EXTOPEN_ON, 0
DOSCODE:6978		     retn
DOSCODE:6979 NOEXTOP:				     ; ...
DOSCODE:6979		     push    ax
DOSCODE:697A		     mov     ax, 1118h
DOSCODE:697D		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	CREATE/TRUNCATE	FILE
DOSCODE:697D					     ; ES:DI ->	uninitialized SFT, SS =	DOS CS
DOSCODE:697D					     ; SDA first filename pointer -> fully-qualified name of file
DOSCODE:697D					     ; STACK: WORD file	creation mode???
DOSCODE:697F		     pop     bx
DOSCODE:6980		     retn
DOSCODE:6981 TEST_RE_NET:			     ; ...
DOSCODE:6981		     test    word ptr es:[si+43h], 8000h
DOSCODE:6987		     pop     es
DOSCODE:6988		     jz	     short LOCAL_CREATE
DOSCODE:698A		     call    Set_EXT_mode
DOSCODE:698D		     jb	     short dochk
DOSCODE:698F		     or	     word ptr es:[di+2], 2
DOSCODE:6994 dochk:				     ; ...
DOSCODE:6994		     test    ds:EXTOPEN_ON, 1
DOSCODE:6999		     jnz     short IFS_extopen
DOSCODE:699B		     push    ax
DOSCODE:699C		     mov     ax, 1117h
DOSCODE:699F		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	CREATE/TRUNCATE	REMOTE FILE
DOSCODE:699F					     ; ES:DI ->	uninitialized SFT, SS =	DOS CS
DOSCODE:699F					     ; SDA first filename pointer -> fully-qualified name of file to open
DOSCODE:699F					     ; SDA CDS pointer -> current directory
DOSCODE:699F					     ; Return: CF set on error
DOSCODE:69A1		     pop     bx
DOSCODE:69A2		     retn
DOSCODE:69A3 LOCAL_CREATE:			     ; ...
DOSCODE:69A3		     call    Set_EXT_mode
DOSCODE:69A6		     jb	     short setdone
DOSCODE:69A8		     or	     word ptr es:[di+2], 2
DOSCODE:69AD setdone:				     ; ...
DOSCODE:69AD		     call    ECritDisk
DOSCODE:69B0		     call    MakeNode
DOSCODE:69B3		     jnb     short Create_ok
DOSCODE:69B5		     mov     ds:VOLCHNG_FLAG, 0FFh
DOSCODE:69BA		     call    LCritDisk
DOSCODE:69BD SET_MKND_ERR:			     ; ...
DOSCODE:69BD		     mov     bx, offset	CRTERRTAB
DOSCODE:69C0		     xlat    byte ptr cs:[bx]
DOSCODE:69C2		     stc
DOSCODE:69C3		     retn
DOSCODE:69C4 CRTERRTAB	     db	0, 5, 52h, 50h,	3, 5, 20h, 2 ; ...
DOSCODE:69CC Create_ok:				     ; ...
DOSCODE:69CC		     call    FastOpen_Delete
DOSCODE:69CF		     mov     al, ds:SATTRIB
DOSCODE:69D2		     test    al, 8
DOSCODE:69D4		     jz	     short NoVolLabel
DOSCODE:69D6		     les     di, ds:THISCDS
DOSCODE:69DA		     mov     ah, es:[di]
DOSCODE:69DD		     sub     ah, 'A'
DOSCODE:69E0		     mov     ds:VOLCHNG_FLAG, ah
DOSCODE:69E4		     mov     bh, 1
DOSCODE:69E6		     call    Set_Media_ID
DOSCODE:69E9		     call    ECritDisk
DOSCODE:69EC		     call    FATREAD_CDS
DOSCODE:69EF		     call    LCritDisk
DOSCODE:69F2 NoVolLabel:			     ; ...
DOSCODE:69F2		     mov     ax, 2
DOSCODE:69F5		     les     di, ds:THISSFT
DOSCODE:69F9		     call    ds:ShSU
DOSCODE:69FD		     call    LCritDisk
DOSCODE:6A00		     jmp     SET_SFT_MODE
DOSCODE:6A03 DOS_Create_New:			     ; ...
DOSCODE:6A03		     mov     ah, 1
DOSCODE:6A05		     jmp     Create_inter
DOSCODE:6A08 ; =============== S U B R O U T I N E =======================================
DOSCODE:6A08 Set_Media_ID    proc near		     ; ...
DOSCODE:6A08		     push    ax
DOSCODE:6A09		     push    es
DOSCODE:6A0A		     push    di
DOSCODE:6A0B		     inc     ah
DOSCODE:6A0D		     mov     bl, ah
DOSCODE:6A0F		     mov     al, 0Dh
DOSCODE:6A11		     mov     cx, 866h
DOSCODE:6A14		     mov     dx, offset	FAKE_STACK_2F
DOSCODE:6A17		     push    bx
DOSCODE:6A18		     push    dx
DOSCODE:6A19		     xor     bh, bh
DOSCODE:6A1B		     call    $IOCTL
DOSCODE:6A1E		     pop     dx
DOSCODE:6A1F		     pop     bx
DOSCODE:6A20		     jb	     short geterr
DOSCODE:6A22		     or	     bh, bh
DOSCODE:6A24		     jz	     short NoName
DOSCODE:6A26		     mov     si, offset	NAME1
DOSCODE:6A29		     jmp     short doset
DOSCODE:6A2B NoName:				     ; ...
DOSCODE:6A2B		     mov     si, offset	NO_NAME_ID ; "NO NAME	 "
DOSCODE:6A2E doset:				     ; ...
DOSCODE:6A2E		     mov     di, dx
DOSCODE:6A30		     add     di, 6
DOSCODE:6A33		     push    ss
DOSCODE:6A34		     pop     ds
DOSCODE:6A35		     push    ss
DOSCODE:6A36		     pop     es
DOSCODE:6A37		     mov     cx, 11
DOSCODE:6A3A		     rep movsb
DOSCODE:6A3C		     mov     cx, 846h
DOSCODE:6A3F		     mov     al, 0Dh
DOSCODE:6A41		     xor     bh, bh
DOSCODE:6A43		     call    $IOCTL
DOSCODE:6A46 geterr:				     ; ...
DOSCODE:6A46		     push    ss
DOSCODE:6A47		     pop     ds
DOSCODE:6A48		     pop     di
DOSCODE:6A49		     pop     es
DOSCODE:6A4A		     pop     ax
DOSCODE:6A4B		     retn
DOSCODE:6A4B Set_Media_ID    endp
DOSCODE:6A4C ; =============== S U B R O U T I N E =======================================
DOSCODE:6A4C Set_EXT_mode    proc near		     ; ...
DOSCODE:6A4C		     test    ss:EXTOPEN_ON, 1
DOSCODE:6A52		     jz	     short NOTEX
DOSCODE:6A54		     push    ax
DOSCODE:6A55		     mov     ax, ss:SAVE_BX
DOSCODE:6A59		     or	     es:[di+2],	ax
DOSCODE:6A5D		     pop     ax
DOSCODE:6A5E		     stc
DOSCODE:6A5F NOTEX:				     ; ...
DOSCODE:6A5F		     retn
DOSCODE:6A5F Set_EXT_mode    endp
DOSCODE:6A60 ; =============== S U B R O U T I N E =======================================
DOSCODE:6A60 DOS_OPEN	     proc near		     ; ...
DOSCODE:6A60		     mov     ds:NoSetDir, 0
DOSCODE:6A65		     call    Check_Access_AX
DOSCODE:6A68		     jb	     short do_ret_label
DOSCODE:6A6A		     les     di, ds:THISSFT
DOSCODE:6A6E		     xor     ah, ah
DOSCODE:6A70		     mov     es:[di+2],	al
DOSCODE:6A74		     push    es
DOSCODE:6A75		     les     si, ds:THISCDS
DOSCODE:6A79		     cmp     si, 0FFFFh
DOSCODE:6A7C		     jnz     short TEST_RE_NET1
DOSCODE:6A7E		     pop     es
DOSCODE:6A7F		     test    ds:EXTOPEN_ON, 1
DOSCODE:6A84		     jz	     short _NOEXTOP
DOSCODE:6A86 _IFS_extopen:			     ; ...
DOSCODE:6A86		     mov     al, byte ptr ds:SAVE_BX
DOSCODE:6A89		     push    ax
DOSCODE:6A8A		     mov     ax, 112Eh
DOSCODE:6A8D		     int     2Fh	     ; Multiplex - DOS 4 IFSFUNC.EXE - ???
DOSCODE:6A8D					     ; SS = DS = DOS CS, STACK:	WORD ???   low byte = ???
DOSCODE:6A8D					     ; Return: CF set on error
DOSCODE:6A8D					     ; CF clear	if successful
DOSCODE:6A8F		     pop     bx
DOSCODE:6A90		     mov     ds:EXTOPEN_ON, 0
DOSCODE:6A95 do_ret_label:			     ; ...
DOSCODE:6A95		     retn
DOSCODE:6A96 _NOEXTOP:				     ; ...
DOSCODE:6A96		     test    ds:DOS_FLAG, 1
DOSCODE:6A9B		     jz	     short not_exec_open
DOSCODE:6A9D		     test    byte ptr ds:DOS34_FLAG+1, 8
DOSCODE:6AA2		     jz	     short not_exec_open
DOSCODE:6AA4		     mov     al, 23h
DOSCODE:6AA6 not_exec_open:			     ; ...
DOSCODE:6AA6		     push    ax
DOSCODE:6AA7		     mov     ax, 1116h
DOSCODE:6AAA		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	OPEN EXISTING REMOTE FILE
DOSCODE:6AAA					     ; ES:DI ->	uninitialized SFT, SS =	DOS CS
DOSCODE:6AAA					     ; SDA first filename pointer -> fully-qualified name of file to open
DOSCODE:6AAA					     ; STACK: WORD file	open mode
DOSCODE:6AAA					     ; Return: CF set on error
DOSCODE:6AAC		     pop     bx
DOSCODE:6AAD		     retn
DOSCODE:6AAE TEST_RE_NET1:			     ; ...
DOSCODE:6AAE		     test    word ptr es:[si+43h], 8000h
DOSCODE:6AB4		     pop     es
DOSCODE:6AB5		     jz	     short LOCAL_OPEN
DOSCODE:6AB7		     test    ds:EXTOPEN_ON, 1
DOSCODE:6ABC		     jnz     short _IFS_extopen
DOSCODE:6ABE		     jmp     short _NOEXTOP
DOSCODE:6AC0 LOCAL_OPEN:			     ; ...
DOSCODE:6AC0		     call    ECritDisk
DOSCODE:6AC3		     or	     ds:FastOpenFlg, 5
DOSCODE:6AC8		     call    GETPATH
DOSCODE:6ACB		     jnb     short Open_found
DOSCODE:6ACD		     jnz     short bad_path2
DOSCODE:6ACF		     or	     cl, cl
DOSCODE:6AD1		     jz	     short bad_path2
DOSCODE:6AD3 OpenFNF:
DOSCODE:6AD3		     mov     ax, 2
DOSCODE:6AD6 OpenBadRet:			     ; ...
DOSCODE:6AD6		     and     ss:FastOpenFlg, 80h
DOSCODE:6ADC		     stc
DOSCODE:6ADD		     call    LCritDisk
DOSCODE:6AE0		     jmp     Clear_FastOpen
DOSCODE:6AE3 bad_path2:				     ; ...
DOSCODE:6AE3		     mov     ax, 3
DOSCODE:6AE6		     jmp     short OpenBadRet
DOSCODE:6AE8 Open_Bad_Access:			     ; ...
DOSCODE:6AE8		     mov     ax, 5
DOSCODE:6AEB		     jmp     short OpenBadRet
DOSCODE:6AED Open_found:			     ; ...
DOSCODE:6AED		     jz	     short Open_Bad_Access
DOSCODE:6AEF		     or	     ah, ah
DOSCODE:6AF1		     js	     short open_ok
DOSCODE:6AF3		     mov     es, word ptr ds:CURBUF+2
DOSCODE:6AF7		     mov     al, es:[bx+0Bh]
DOSCODE:6AFB		     test    al, 8
DOSCODE:6AFD		     jnz     short Open_Bad_Access
DOSCODE:6AFF		     test    al, 1
DOSCODE:6B01		     jz	     short open_ok
DOSCODE:6B03		     push    ds
DOSCODE:6B04		     push    si
DOSCODE:6B05		     lds     si, ds:THISSFT
DOSCODE:6B09		     mov     cx, [si+2]
DOSCODE:6B0C		     test    cx, 8000h
DOSCODE:6B10		     jnz     short ResetAccess
DOSCODE:6B12		     mov     dl, cl
DOSCODE:6B14		     and     dl, 0F0h
DOSCODE:6B17		     cmp     dl, 70h ; 'p'
DOSCODE:6B1A		     jnz     short NormalOpen
DOSCODE:6B1C ResetAccess:			     ; ...
DOSCODE:6B1C		     and     cx, 0FFF0h
DOSCODE:6B1F		     mov     [si+2], cx
DOSCODE:6B22		     jmp     short FillSFT
DOSCODE:6B24 NormalOpen:			     ; ...
DOSCODE:6B24		     and     cl, 0Fh
DOSCODE:6B27		     cmp     cl, 0
DOSCODE:6B2A		     jz	     short FillSFT
DOSCODE:6B2C		     pop     si
DOSCODE:6B2D		     pop     ds
DOSCODE:6B2E		     jmp     short Open_Bad_Access
DOSCODE:6B30 FillSFT:				     ; ...
DOSCODE:6B30		     pop     si
DOSCODE:6B31		     pop     ds
DOSCODE:6B32 open_ok:				     ; ...
DOSCODE:6B32		     call    DOOPEN
DOSCODE:6B35		     and     ss:FastOpenFlg, 80h
DOSCODE:6B3B		     call    DO_SHARE_CHECK
DOSCODE:6B3E		     jnb     short SHARE_OK
DOSCODE:6B40		     call    LCritDisk
DOSCODE:6B43		     jmp     short Clear_FastOpen
DOSCODE:6B45 SHARE_OK:				     ; ...
DOSCODE:6B45		     mov     ax, 3
DOSCODE:6B48		     les     di, ds:THISSFT
DOSCODE:6B4C		     call    ds:ShSU
DOSCODE:6B50		     call    LCritDisk
DOSCODE:6B53 SET_SFT_MODE:			     ; ...
DOSCODE:6B53		     les     di, ds:THISSFT
DOSCODE:6B57		     call    DEV_OPEN_SFT
DOSCODE:6B5A		     test    word ptr es:[di+2], 8000h
DOSCODE:6B60		     jz	     short Clear_FastOpen
DOSCODE:6B62		     mov     ax, ds:CurrentPDB
DOSCODE:6B65		     mov     es:[di+31h], ax
DOSCODE:6B69 Clear_FastOpen:			     ; ...
DOSCODE:6B69		     retn
DOSCODE:6B69 DOS_OPEN	     endp
DOSCODE:6B6A ; =============== S U B R O U T I N E =======================================
DOSCODE:6B6A SHARE_ERROR     proc near		     ; ...
DOSCODE:6B6A		     test    word ptr es:[di+2], 8000h
DOSCODE:6B70		     jnz     short _HARD_ERR
DOSCODE:6B72		     mov     cl, es:[di+2]
DOSCODE:6B76		     and     cl, 0F0h
DOSCODE:6B79		     cmp     cl, 0
DOSCODE:6B7C		     jnz     short _NO_HARD_ERR
DOSCODE:6B7E _HARD_ERR:				     ; ...
DOSCODE:6B7E		     call    SHARE_VIOLATION
DOSCODE:6B81		     jnb     short Clear_FastOpen
DOSCODE:6B83 _NO_HARD_ERR:			     ; ...
DOSCODE:6B83		     mov     ax, 20h ; ' '
DOSCODE:6B86		     stc
DOSCODE:6B87		     retn
DOSCODE:6B87 SHARE_ERROR     endp
DOSCODE:6B88 ; =============== S U B R O U T I N E =======================================
DOSCODE:6B88 DO_SHARE_CHECK  proc near		     ; ...
DOSCODE:6B88		     call    ECritDisk
DOSCODE:6B8B OPN_RETRY:				     ; ...
DOSCODE:6B8B		     mov     cx, ds:RetryCount
DOSCODE:6B8F OpenShareRetry:			     ; ...
DOSCODE:6B8F		     push    cx
DOSCODE:6B90		     call    SHARE_CHECK
DOSCODE:6B93		     pop     cx
DOSCODE:6B94		     jnb     short Share_Ok2
DOSCODE:6B96		     call    Idle
DOSCODE:6B99		     loop    OpenShareRetry
DOSCODE:6B9B		     les     di, ds:THISSFT
DOSCODE:6B9F		     call    SHARE_ERROR
DOSCODE:6BA2		     jnb     short OPN_RETRY
DOSCODE:6BA4 Share_Ok2:				     ; ...
DOSCODE:6BA4		     call    LCritDisk
DOSCODE:6BA7		     retn
DOSCODE:6BA7 DO_SHARE_CHECK  endp
DOSCODE:6BA8 ; =============== S U B R O U T I N E =======================================
DOSCODE:6BA8 Check_Access_AX proc near		     ; ...
DOSCODE:6BA8		     mov     ds:OPEN_ACCESS, al
DOSCODE:6BAB		     push    bx
DOSCODE:6BAC		     mov     bl, al
DOSCODE:6BAE		     and     bl, 0F0h
DOSCODE:6BB1		     cmp     ds:FSHARING, 0FFh
DOSCODE:6BB6		     jnz     short CheckShareMode
DOSCODE:6BB8		     cmp     bl, 70h
DOSCODE:6BBB		     jz	     short CheckAccessMode
DOSCODE:6BBD CheckShareMode:			     ; ...
DOSCODE:6BBD		     cmp     bl, 40h
DOSCODE:6BC0		     ja	     short Make_Bad_Access
DOSCODE:6BC2 CheckAccessMode:			     ; ...
DOSCODE:6BC2		     mov     bl, al
DOSCODE:6BC4		     and     bl, 0Fh
DOSCODE:6BC7		     cmp     bl, 2
DOSCODE:6BCA		     ja	     short Make_Bad_Access
DOSCODE:6BCC		     pop     bx
DOSCODE:6BCD		     clc
DOSCODE:6BCE		     retn
DOSCODE:6BCF Make_Bad_Access:			     ; ...
DOSCODE:6BCF		     mov     ax, 0Ch
DOSCODE:6BD2		     pop     bx
DOSCODE:6BD3		     stc
DOSCODE:6BD4		     retn
DOSCODE:6BD4 Check_Access_AX endp
DOSCODE:6BD5 ; =============== S U B R O U T I N E =======================================
DOSCODE:6BD5 DISK_INFO	     proc near		     ; ...
DOSCODE:6BD5		     call    TestNet
DOSCODE:6BD8		     jnb     short LOCAL_DSK_INFO
DOSCODE:6BDA		     mov     ax, 110Ch
DOSCODE:6BDD		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	GET DISK SPACE
DOSCODE:6BDD					     ; ES:DI ->	current	directory
DOSCODE:6BDD					     ; Return: AL = sectors per	cluster, BX = total clusters
DOSCODE:6BDD					     ; CX = bytes per sector, DX = number of available clusters
DOSCODE:6BDF		     retn
DOSCODE:6BE0 LOCAL_DSK_INFO:			     ; ...
DOSCODE:6BE0		     mov     ds:EXTERR_LOCUS, 2
DOSCODE:6BE5		     call    ECritDisk
DOSCODE:6BE8		     call    FATREAD_CDS
DOSCODE:6BEB		     jb	     short CRIT_LEAVE
DOSCODE:6BED		     mov     bx, 2
DOSCODE:6BF0		     call    UNPACK
DOSCODE:6BF3		     jb	     short CRIT_LEAVE
DOSCODE:6BF5		     lds     si, ds:CURBUF
DOSCODE:6BF9		     mov     ah, [si+20]
DOSCODE:6BFC		     push    ss
DOSCODE:6BFD		     pop     ds
DOSCODE:6BFE		     mov     cx, es:[bp+0Dh]
DOSCODE:6C02		     mov     dx, es:[bp+1Fh]
DOSCODE:6C06		     cmp     dx, 0FFFFh
DOSCODE:6C09		     jz	     short DoScan
DOSCODE:6C0B		     cmp     dx, cx
DOSCODE:6C0D		     jb	     short GotVal
DOSCODE:6C0F DoScan:				     ; ...
DOSCODE:6C0F		     xor     dx, dx
DOSCODE:6C11		     dec     cx
DOSCODE:6C12 SCANFREE:				     ; ...
DOSCODE:6C12		     call    UNPACK
DOSCODE:6C15		     jb	     short CRIT_LEAVE
DOSCODE:6C17		     jnz     short NOTFREECLUS
DOSCODE:6C19		     inc     dx
DOSCODE:6C1A NOTFREECLUS:			     ; ...
DOSCODE:6C1A		     inc     bx
DOSCODE:6C1B		     loop    SCANFREE
DOSCODE:6C1D		     dec     bx
DOSCODE:6C1E ReturnVals:			     ; ...
DOSCODE:6C1E		     dec     bx
DOSCODE:6C1F		     mov     al, es:[bp+4]
DOSCODE:6C23		     inc     al
DOSCODE:6C25		     mov     cx, es:[bp+2]
DOSCODE:6C29		     mov     es:[bp+1Fh], dx
DOSCODE:6C2D		     clc
DOSCODE:6C2E CRIT_LEAVE:			     ; ...
DOSCODE:6C2E		     call    LCritDisk
DOSCODE:6C31		     retn
DOSCODE:6C32 GotVal:				     ; ...
DOSCODE:6C32		     mov     bx, cx
DOSCODE:6C34		     jmp     short ReturnVals
DOSCODE:6C34 DISK_INFO	     endp
DOSCODE:6C36 ; =============== S U B R O U T I N E =======================================
DOSCODE:6C36 DOS_SEARCH_FIRST proc near		     ; ...
DOSCODE:6C36 ; FUNCTION	CHUNK AT DOSCODE:6C8B SIZE 0000009C BYTES
DOSCODE:6C36		     les     di, ds:THISCDS
DOSCODE:6C3A		     cmp     di, 0FFFFh
DOSCODE:6C3D		     jnz     short TEST_RE_NET2
DOSCODE:6C3F		     mov     ax, 1119h
DOSCODE:6C42		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	???
DOSCODE:6C44		     retn
DOSCODE:6C45 TEST_RE_NET2:			     ; ...
DOSCODE:6C45		     test    word ptr es:[di+43h], 8000h
DOSCODE:6C4B		     jz	     short LOCAL_SEARCH_FIRST
DOSCODE:6C4D		     mov     ax, 111Bh
DOSCODE:6C50		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	FINDFIRST
DOSCODE:6C50					     ; SS = DS = DOS CS, [DTA] = uninitialized 21-byte findfirst search	data
DOSCODE:6C50					     ; SDA first filename pointer -> fully-qualified search template
DOSCODE:6C50					     ; SDA CDS pointer -> current directory
DOSCODE:6C50					     ; Return: CF set on error
DOSCODE:6C52		     retn
DOSCODE:6C53 LOCAL_SEARCH_FIRST:		     ; ...
DOSCODE:6C53		     call    ECritDisk
DOSCODE:6C56		     test    ds:DOS34_FLAG, 400h
DOSCODE:6C5C		     jz	     short NOFN
DOSCODE:6C5E		     or	     ds:FastOpenFlg, 1
DOSCODE:6C63 NOFN:				     ; ...
DOSCODE:6C63		     mov     ds:NoSetDir, 1
DOSCODE:6C68		     call    CHECK_QUESTION
DOSCODE:6C6B		     jnb     short norm_GETPATH
DOSCODE:6C6D		     and     ds:FastOpenFlg, 80h
DOSCODE:6C72 norm_GETPATH:			     ; ...
DOSCODE:6C72		     call    GETPATH
DOSCODE:6C75		     jnb     short find_check_dev
DOSCODE:6C77		     jnz     short bad_path3
DOSCODE:6C79		     or	     cl, cl
DOSCODE:6C7B		     jz	     short bad_path3
DOSCODE:6C7B DOS_SEARCH_FIRST endp
DOSCODE:6C7D ; START OF	FUNCTION CHUNK FOR DOS_SEARCH_NEXT
DOSCODE:6C7D find_no_more:			     ; ...
DOSCODE:6C7D		     mov     ax, 12h
DOSCODE:6C80 BadBye:				     ; ...
DOSCODE:6C80		     and     ss:FastOpenFlg, 80h
DOSCODE:6C86		     stc
DOSCODE:6C87		     call    LCritDisk
DOSCODE:6C8A		     retn
DOSCODE:6C8A ; END OF FUNCTION CHUNK FOR DOS_SEARCH_NEXT
DOSCODE:6C8B ; START OF	FUNCTION CHUNK FOR DOS_SEARCH_FIRST
DOSCODE:6C8B bad_path3:				     ; ...
DOSCODE:6C8B		     mov     ax, 3
DOSCODE:6C8E		     jmp     short BadBye
DOSCODE:6C90 find_check_dev:			     ; ...
DOSCODE:6C90		     or	     ah, ah
DOSCODE:6C92		     jns     short found_entry
DOSCODE:6C94		     mov     ds:LASTENT, 0FFFFh
DOSCODE:6C9A		     inc     ds:FOUND_DEV
DOSCODE:6C9E found_entry:			     ; ...
DOSCODE:6C9E		     les     di, ds:DMAADD
DOSCODE:6CA2		     mov     si, ds:WFP_START
DOSCODE:6CA6		     lodsb
DOSCODE:6CA7		     sub     al, 40h ; '@'
DOSCODE:6CA9		     stosb
DOSCODE:6CAA found_it:				     ; ...
DOSCODE:6CAA		     les     di, ds:DMAADD
DOSCODE:6CAE		     inc     di
DOSCODE:6CAF		     push    ds
DOSCODE:6CB0		     test    ds:FastOpenFlg, 10h
DOSCODE:6CB5		     jz	     short notfast
DOSCODE:6CB7		     mov     si, bx
DOSCODE:6CB9		     mov     ds, word ptr ds:CURBUF+2
DOSCODE:6CBD		     jmp     short movmov
DOSCODE:6CBF notfast:				     ; ...
DOSCODE:6CBF		     mov     si, offset	NAME1
DOSCODE:6CC2 movmov:				     ; ...
DOSCODE:6CC2		     movsb
DOSCODE:6CC3		     cmp     byte ptr es:[di-1], 5
DOSCODE:6CC8		     jnz     short NOTKANJB
DOSCODE:6CCA		     mov     byte ptr es:[di-1], 0E5h ;	'å'
DOSCODE:6CCF NOTKANJB:				     ; ...
DOSCODE:6CCF		     mov     cx, 10
DOSCODE:6CD2		     rep movsb
DOSCODE:6CD4		     pop     ds
DOSCODE:6CD5		     mov     al, ds:ATTRIB
DOSCODE:6CD8		     stosb
DOSCODE:6CD9		     push    ax
DOSCODE:6CDA		     mov     ax, ds:LASTENT
DOSCODE:6CDD		     stosw
DOSCODE:6CDE		     mov     ax, ds:DIRSTART
DOSCODE:6CE1		     stosw
DOSCODE:6CE2		     add     di, 4
DOSCODE:6CE5		     pop     ax
DOSCODE:6CE6		     or	     ah, ah
DOSCODE:6CE8		     js	     short DOSREL
DOSCODE:6CEA		     cmp     word ptr ds:CURBUF, 0FFFFh
DOSCODE:6CEF		     jnz     short OKSTORE
DOSCODE:6CF1		     test    ds:FastOpenFlg, 10h
DOSCODE:6CF6		     jnz     short OKSTORE
DOSCODE:6CF8		     mov     word ptr es:[di-8], 0FFFFh
DOSCODE:6CFE		     jmp     find_no_more
DOSCODE:6D01 OKSTORE:				     ; ...
DOSCODE:6D01		     mov     ds, word ptr ds:CURBUF+2
DOSCODE:6D05 DOSREL:				     ; ...
DOSCODE:6D05		     mov     si, bx
DOSCODE:6D07		     mov     cx, 32
DOSCODE:6D0A		     mov     ax, di
DOSCODE:6D0C		     rep movsb
DOSCODE:6D0E		     mov     di, ax
DOSCODE:6D10		     cmp     byte ptr es:[di], 5
DOSCODE:6D14		     jnz     short NO05
DOSCODE:6D16		     mov     byte ptr es:[di], 0E5h
DOSCODE:6D1A NO05:				     ; ...
DOSCODE:6D1A		     and     ss:FastOpenFlg, 80h
DOSCODE:6D20		     push    ss
DOSCODE:6D21		     pop     ds
DOSCODE:6D22		     clc
DOSCODE:6D23		     call    LCritDisk
DOSCODE:6D26		     retn
DOSCODE:6D26 ; END OF FUNCTION CHUNK FOR DOS_SEARCH_FIRST
DOSCODE:6D27 ; =============== S U B R O U T I N E =======================================
DOSCODE:6D27 DOS_SEARCH_NEXT proc near		     ; ...
DOSCODE:6D27 ; FUNCTION	CHUNK AT DOSCODE:6C7D SIZE 0000000E BYTES
DOSCODE:6D27		     les     di, ds:DMAADD
DOSCODE:6D2B		     mov     al, es:[di]
DOSCODE:6D2E		     test    al, 80h
DOSCODE:6D30		     jz	     short LOCAL_SEARCH_NEXT
DOSCODE:6D32		     mov     ax, 111Ch
DOSCODE:6D35		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	FINDNEXT
DOSCODE:6D35					     ; SS = DS = DOS CS, [DTA] = 21-byte findfirst search data
DOSCODE:6D35					     ; Return: CF set on error,	AX = DOS error code
DOSCODE:6D35					     ; CF clear	if successful
DOSCODE:6D37		     retn
DOSCODE:6D38 LOCAL_SEARCH_NEXT:			     ; ...
DOSCODE:6D38		     mov     ds:EXTERR_LOCUS, 2
DOSCODE:6D3D		     call    ECritDisk
DOSCODE:6D40		     mov     word ptr ds:THISCDS, offset DUMMYCDS
DOSCODE:6D46		     mov     word ptr ds:THISCDS+2, ds
DOSCODE:6D4A		     add     al, 40h ; '@'
DOSCODE:6D4C		     call    InitCDS
DOSCODE:6D4F		     jb	     short No_files
DOSCODE:6D51		     les     di, ds:THISCDS
DOSCODE:6D55		     les     bp, es:[di+45h]
DOSCODE:6D59		     call    GOTDPB
DOSCODE:6D5C		     mov     al, es:[bp+0]
DOSCODE:6D60		     mov     ds:THISDRV, al
DOSCODE:6D63		     mov     word ptr ds:CREATING, 0E500h
DOSCODE:6D69		     mov     ds:NoSetDir, 1
DOSCODE:6D6E		     lds     si, ds:DMAADD
DOSCODE:6D72		     lodsb
DOSCODE:6D73 RENAME_NEXT:			     ; ...
DOSCODE:6D73		     push    ss
DOSCODE:6D74		     pop     es
DOSCODE:6D75		     mov     di, offset	NAME1
DOSCODE:6D78		     mov     cx, 11
DOSCODE:6D7B		     rep movsb
DOSCODE:6D7D		     lodsb
DOSCODE:6D7E		     mov     ss:ATTRIB,	al
DOSCODE:6D82		     lodsw
DOSCODE:6D83		     or	     ax, ax
DOSCODE:6D85		     jns     short cont_load
DOSCODE:6D87 No_files:				     ; ...
DOSCODE:6D87		     jmp     find_no_more
DOSCODE:6D8A cont_load:				     ; ...
DOSCODE:6D8A		     push    ax
DOSCODE:6D8B		     lodsw
DOSCODE:6D8C		     mov     bx, ax
DOSCODE:6D8E		     push    ss
DOSCODE:6D8F		     pop     ds
DOSCODE:6D90		     les     bp, ds:THISDPB
DOSCODE:6D94		     call    SETDIRSRCH
DOSCODE:6D97		     jnb     short SEARCH_GOON
DOSCODE:6D99		     pop     ax
DOSCODE:6D9A		     jmp     short No_files
DOSCODE:6D9C SEARCH_GOON:			     ; ...
DOSCODE:6D9C		     call    STARTSRCH
DOSCODE:6D9F		     pop     ax
DOSCODE:6DA0		     call    GETENT
DOSCODE:6DA3		     jb	     short No_files
DOSCODE:6DA5		     call    NEXTENT
DOSCODE:6DA8		     jb	     short No_files
DOSCODE:6DAA		     xor     ah, ah
DOSCODE:6DAC		     jmp     found_it
DOSCODE:6DAC DOS_SEARCH_NEXT endp
DOSCODE:6DAF ; =============== S U B R O U T I N E =======================================
DOSCODE:6DAF CHECK_QUESTION  proc near		     ; ...
DOSCODE:6DAF		     push    ss
DOSCODE:6DB0		     pop     ds
DOSCODE:6DB1		     mov     si, ss:WFP_START
DOSCODE:6DB6 getnext:				     ; ...
DOSCODE:6DB6		     lodsb
DOSCODE:6DB7		     or	     al, al
DOSCODE:6DB9		     jz	     short NO_Question
DOSCODE:6DBB		     cmp     al, '?'
DOSCODE:6DBD		     jnz     short getnext
DOSCODE:6DBF		     stc
DOSCODE:6DC0 NO_Question:			     ; ...
DOSCODE:6DC0		     retn
DOSCODE:6DC0 CHECK_QUESTION  endp
DOSCODE:6DC1 ; =============== S U B R O U T I N E =======================================
DOSCODE:6DC1 DOS_ABORT	     proc near		     ; ...
DOSCODE:6DC1		     mov     es, ss:CurrentPDB
DOSCODE:6DC6		     mov     cx, es:32h	     ; [ES:PDB.JFN_Length]
DOSCODE:6DCB reset_free_jfn:			     ; ...
DOSCODE:6DCB		     mov     bx, cx
DOSCODE:6DCD		     push    cx
DOSCODE:6DCE		     dec     bx
DOSCODE:6DCF		     call    $CLOSE
DOSCODE:6DD2		     pop     cx
DOSCODE:6DD3		     loop    reset_free_jfn
DOSCODE:6DD5		     push    ss
DOSCODE:6DD6		     pop     ds
DOSCODE:6DD7		     mov     ax, 111Dh
DOSCODE:6DDA		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	CLOSE ALL REMOTE FILES FOR PROCESS
DOSCODE:6DDA					     ; DS???, SS = DOS CS
DOSCODE:6DDC		     call    ds:MFTCloseP
DOSCODE:6DE0		     les     di, ss:SFTFCB
DOSCODE:6DE5		     mov     cx, es:[di+4]
DOSCODE:6DE9		     jcxz    short FCBScanDone
DOSCODE:6DEB		     lea     di, [di+6]
DOSCODE:6DEE		     mov     ax, ss:PROC_ID
DOSCODE:6DF2 FCBTest:				     ; ...
DOSCODE:6DF2		     cmp     es:[di+31h], ax
DOSCODE:6DF6		     jnz     short FCBNext
DOSCODE:6DF8		     mov     word ptr es:[di], 0
DOSCODE:6DFD FCBNext:				     ; ...
DOSCODE:6DFD		     add     di, 59
DOSCODE:6E00		     loop    FCBTest
DOSCODE:6E02 FCBScanDone:			     ; ...
DOSCODE:6E02		     xor     bx, bx
DOSCODE:6E04 Scan:				     ; ...
DOSCODE:6E04		     push    bx
DOSCODE:6E05		     call    SFFromSFN
DOSCODE:6E08		     pop     bx
DOSCODE:6E09		     jnb     short Scan1
DOSCODE:6E0B		     retn
DOSCODE:6E0C Scan1:				     ; ...
DOSCODE:6E0C		     cmp     word ptr es:[di], 0FFFFh
DOSCODE:6E10		     jnz     short scan_next
DOSCODE:6E12		     mov     ax, ss:PROC_ID
DOSCODE:6E16		     cmp     es:[di+31h], ax
DOSCODE:6E1A		     jnz     short scan_next
DOSCODE:6E1C		     mov     ax, ss:USER_ID
DOSCODE:6E20		     cmp     es:[di+2Fh], ax
DOSCODE:6E24		     jnz     short scan_next
DOSCODE:6E26		     mov     word ptr es:[di], 0
DOSCODE:6E2B scan_next:				     ; ...
DOSCODE:6E2B		     inc     bx
DOSCODE:6E2C		     jmp     short Scan
DOSCODE:6E2C DOS_ABORT	     endp
DOSCODE:6E2E ; =============== S U B R O U T I N E =======================================
DOSCODE:6E2E DOS_CLOSE	     proc near		     ; ...
DOSCODE:6E2E		     les     di, ds:THISSFT
DOSCODE:6E32		     mov     bx, es:[di+5]
DOSCODE:6E36		     test    bx, 8000h
DOSCODE:6E3A		     jz	     short LocalClose
DOSCODE:6E3C		     mov     ax, 1106h
DOSCODE:6E3F		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	CLOSE REMOTE FILE
DOSCODE:6E3F					     ; ES:DI ->	SFT
DOSCODE:6E3F					     ; SFT DPB field ->	DPB of drive containing	file
DOSCODE:6E3F					     ; Return: CF set on error,	AX = DOS error code
DOSCODE:6E3F					     ; CF clear	if successful
DOSCODE:6E41		     retn
DOSCODE:6E42 LocalClose:			     ; ...
DOSCODE:6E42		     call    ECritDisk
DOSCODE:6E45		     call    SetSFTTimes
DOSCODE:6E48		     call    FREE_SFT
DOSCODE:6E4B		     push    ss
DOSCODE:6E4C		     pop     ds
DOSCODE:6E4D		     push    ax
DOSCODE:6E4E		     push    bx
DOSCODE:6E4F		     call    ShareEnd
DOSCODE:6E52		     pop     bx
DOSCODE:6E53		     pop     ax
DOSCODE:6E54 CloseEntry:			     ; ...
DOSCODE:6E54		     push    ax
DOSCODE:6E55		     test    bx, 0C0h
DOSCODE:6E59		     jz	     short rdir
DOSCODE:6E5B		     jmp     FREE_SFT_OK
DOSCODE:6E5E rdir:				     ; ...
DOSCODE:6E5E		     call    DirFromSFT
DOSCODE:6E61		     mov     al, 5
DOSCODE:6E63		     jnb     short clook
DOSCODE:6E65		     jmp     CloseFinish
DOSCODE:6E68 clook:				     ; ...
DOSCODE:6E68		     push    di
DOSCODE:6E69		     push    si
DOSCODE:6E6A		     lea     si, [si+20h]
DOSCODE:6E6D		     call    XCHGP
DOSCODE:6E70		     call    MetaCompare
DOSCODE:6E73		     call    XCHGP
DOSCODE:6E76		     pop     si
DOSCODE:6E77		     pop     di
DOSCODE:6E78		     jz	     short CLOSE_GO
DOSCODE:6E7A		     mov     di, si
DOSCODE:6E7C		     push    ds
DOSCODE:6E7D		     pop     es
DOSCODE:6E7E		     push    ss
DOSCODE:6E7F		     pop     ds
DOSCODE:6E80		     stc
DOSCODE:6E81		     mov     al, 2
DOSCODE:6E83		     jmp     CloseFinish
DOSCODE:6E86 CLOSE_GO:				     ; ...
DOSCODE:6E86		     test    word ptr [si+2], 8000h
DOSCODE:6E8B		     jz	     short nofcb
DOSCODE:6E8D		     mov     ch, es:[di+0Bh]
DOSCODE:6E91		     mov     al, [si+4]
DOSCODE:6E94		     mov     ss:ATTRIB,	al
DOSCODE:6E98		     jmp     short setattr
DOSCODE:6E9A nofcb:				     ; ...
DOSCODE:6E9A		     mov     al, [si+4]
DOSCODE:6E9D		     mov     es:[di+0Bh], al
DOSCODE:6EA1 setattr:				     ; ...
DOSCODE:6EA1		     or	     byte ptr es:[di+0Bh], 20h
DOSCODE:6EA6		     mov     ax, es:[di+1Ah]
DOSCODE:6EAA		     mov     ss:OLD_FIRSTCLUS, ax
DOSCODE:6EAE		     mov     ax, [si+0Bh]
DOSCODE:6EB1		     mov     es:[di+1Ah], ax
DOSCODE:6EB5		     mov     ax, [si+11h]
DOSCODE:6EB8		     mov     es:[di+1Ch], ax
DOSCODE:6EBC		     mov     ax, [si+13h]
DOSCODE:6EBF		     mov     es:[di+1Eh], ax
DOSCODE:6EC3		     mov     ax, [si+0Fh]
DOSCODE:6EC6		     mov     es:[di+18h], ax
DOSCODE:6ECA		     mov     ax, [si+0Dh]
DOSCODE:6ECD		     mov     es:[di+16h], ax
DOSCODE:6ED1		     test    byte ptr es:[bx+5], 40h
DOSCODE:6ED6		     jnz     short yesdirty4
DOSCODE:6ED8		     call    INC_DIRTY_COUNT
DOSCODE:6EDB		     or	     byte ptr es:[bx+5], 40h
DOSCODE:6EE0 yesdirty4:				     ; ...
DOSCODE:6EE0		     push    ds
DOSCODE:6EE1		     push    si
DOSCODE:6EE2		     mov     cx, [si+0Bh]
DOSCODE:6EE5		     mov     al, ss:THISDRV
DOSCODE:6EE9		     push    dx
DOSCODE:6EEA		     mov     ah, 0
DOSCODE:6EEC		     mov     dl, al
DOSCODE:6EEE		     or	     cx, cx
DOSCODE:6EF0		     jnz     short do_update2
DOSCODE:6EF2		     mov     ah, 3
DOSCODE:6EF4		     mov     di, [si+1Bh]
DOSCODE:6EF7		     mov     cx, [si+1Dh]
DOSCODE:6EFA		     mov     dh, [si+1Fh]
DOSCODE:6EFD		     jmp     short do_update
DOSCODE:6EFF do_update2:			     ; ...
DOSCODE:6EFF		     cmp     cx, ss:OLD_FIRSTCLUS
DOSCODE:6F04		     jz	     short do_update
DOSCODE:6F06		     mov     ah, 2
DOSCODE:6F08		     mov     cx, ss:OLD_FIRSTCLUS
DOSCODE:6F0D do_update:				     ; ...
DOSCODE:6F0D		     push    ss
DOSCODE:6F0E		     pop     ds
DOSCODE:6F0F		     call    FastOpen_Update
DOSCODE:6F12		     pop     dx
DOSCODE:6F13		     call    FLUSHBUF
DOSCODE:6F16		     pop     di
DOSCODE:6F17		     pop     es
DOSCODE:6F18		     mov     al, 5
DOSCODE:6F1A		     jb	     short CloseFinish
DOSCODE:6F1C FREE_SFT_OK:			     ; ...
DOSCODE:6F1C		     clc
DOSCODE:6F1D CloseFinish:			     ; ...
DOSCODE:6F1D		     pushf
DOSCODE:6F1E		     call    DEV_CLOSE_SFT
DOSCODE:6F21		     popf
DOSCODE:6F22		     pop     cx
DOSCODE:6F23		     pushf
DOSCODE:6F24		     dec     cx
DOSCODE:6F25		     jnz     short NoFree
DOSCODE:6F27		     mov     es:[di], cx
DOSCODE:6F2A NoFree:				     ; ...
DOSCODE:6F2A		     call    LCritDisk
DOSCODE:6F2D		     popf
DOSCODE:6F2E		     retn
DOSCODE:6F2E DOS_CLOSE	     endp
DOSCODE:6F2F ; =============== S U B R O U T I N E =======================================
DOSCODE:6F2F FREE_SFT	     proc near		     ; ...
DOSCODE:6F2F		     pushf
DOSCODE:6F30		     mov     ax, es:[di]
DOSCODE:6F33		     dec     ax
DOSCODE:6F34		     jnz     short SetCount
DOSCODE:6F36		     dec     ax
DOSCODE:6F37 SetCount:				     ; ...
DOSCODE:6F37		     xchg    ax, es:[di]
DOSCODE:6F3A		     popf
DOSCODE:6F3B		     retn
DOSCODE:6F3B FREE_SFT	     endp
DOSCODE:6F3C ; =============== S U B R O U T I N E =======================================
DOSCODE:6F3C DirFromSFT	     proc near		     ; ...
DOSCODE:6F3C		     mov     ds:EXTERR_LOCUS, 2
DOSCODE:6F41		     push    es
DOSCODE:6F42		     push    di
DOSCODE:6F43		     mov     dx, es:[di+1Dh]
DOSCODE:6F47		     mov     ds:HIGH_SECTOR, dx
DOSCODE:6F4B		     mov     dx, es:[di+1Bh]
DOSCODE:6F4F		     push    ds:HIGH_SECTOR
DOSCODE:6F53		     push    dx
DOSCODE:6F54		     call    FATREAD_SFT
DOSCODE:6F57		     pop     dx
DOSCODE:6F58		     pop     ds:HIGH_SECTOR
DOSCODE:6F5C		     jb	     short PopDone
DOSCODE:6F5E		     xor     al, al
DOSCODE:6F60		     mov     ds:ALLOWED, 18h
DOSCODE:6F65		     call    GETBUFFR
DOSCODE:6F68		     jb	     short PopDone
DOSCODE:6F6A		     pop     si
DOSCODE:6F6B		     pop     ds
DOSCODE:6F6C		     les     di, ss:CURBUF
DOSCODE:6F71		     or	     byte ptr es:[di+5], 4
DOSCODE:6F76		     mov     bx, di
DOSCODE:6F78		     lea     di, [di+14h]
DOSCODE:6F7B		     mov     al, 20h ; ' '
DOSCODE:6F7D		     mul     byte ptr [si+1Fh]
DOSCODE:6F80		     add     di, ax
DOSCODE:6F82		     retn
DOSCODE:6F83 PopDone:				     ; ...
DOSCODE:6F83		     pop     di
DOSCODE:6F84		     pop     es
DOSCODE:6F85 PopDone_retn:			     ; ...
DOSCODE:6F85		     retn
DOSCODE:6F85 DirFromSFT	     endp
DOSCODE:6F86 ; =============== S U B R O U T I N E =======================================
DOSCODE:6F86 DOS_COMMIT	     proc near		     ; ...
DOSCODE:6F86		     les     di, ds:THISSFT
DOSCODE:6F8A		     mov     bx, es:[di+5]
DOSCODE:6F8E		     test    bx, 0C0h
DOSCODE:6F92		     jnz     short PopDone_retn
DOSCODE:6F94		     test    bx, 8000h
DOSCODE:6F98		     jz	     short LOCAL_COMMIT
DOSCODE:6F9A		     mov     ax, 1107h
DOSCODE:6F9D		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	COMMIT REMOTE FILE
DOSCODE:6F9D					     ; ES:DI ->	SFT
DOSCODE:6F9D					     ; SFT DPB field ->	DPB of drive containing	file
DOSCODE:6F9D					     ; Return: CF set on error,	AX = DOS error code
DOSCODE:6F9D					     ; CF clear	if successful
DOSCODE:6F9F		     retn
DOSCODE:6FA0 LOCAL_COMMIT:			     ; ...
DOSCODE:6FA0		     call    ECritDisk
DOSCODE:6FA3		     call    ECritDisk
DOSCODE:6FA6		     call    SetSFTTimes
DOSCODE:6FA9		     mov     ax, 0FFFFh
DOSCODE:6FAC		     call    CloseEntry
DOSCODE:6FAF		     pushf
DOSCODE:6FB0		     call    DEV_OPEN_SFT
DOSCODE:6FB3		     popf
DOSCODE:6FB4		     call    LCritDisk
DOSCODE:6FB7 localcommit_retn:			     ; ...
DOSCODE:6FB7		     retn
DOSCODE:6FB7 DOS_COMMIT	     endp
DOSCODE:6FB8 ; =============== S U B R O U T I N E =======================================
DOSCODE:6FB8 SetSFTTimes     proc near		     ; ...
DOSCODE:6FB8		     test    bx, 0C0h
DOSCODE:6FBC		     jnz     short localcommit_retn
DOSCODE:6FBE		     test    bx, 4000h
DOSCODE:6FC2		     jnz     short localcommit_retn
DOSCODE:6FC4		     push    ax
DOSCODE:6FC5		     push    bx
DOSCODE:6FC6		     call    DATE16
DOSCODE:6FC9		     mov     es:[di+0Fh], ax
DOSCODE:6FCD		     mov     es:[di+0Dh], dx
DOSCODE:6FD1		     xor     ax, ax
DOSCODE:6FD3		     call    ds:ShSU
DOSCODE:6FD7		     pop     bx
DOSCODE:6FD8		     pop     ax
DOSCODE:6FD9		     retn
DOSCODE:6FD9 SetSFTTimes     endp
DOSCODE:6FDA DOS_MKDIR:				     ; ...
DOSCODE:6FDA		     call    TestNet
DOSCODE:6FDD		     jnb     short LOCAL_MKDIR
DOSCODE:6FDF		     mov     ax, 1103h
DOSCODE:6FE2		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	MAKE REMOTE DIRECTORY
DOSCODE:6FE2					     ; SS = DOS	CS
DOSCODE:6FE2					     ; SDA first filename pointer -> fully-qualified directory name
DOSCODE:6FE2					     ; SDA CDS pointer -> current directory
DOSCODE:6FE2					     ; Return: CF set on error,	AX = DOS error code
DOSCODE:6FE2					     ; CF clear	if successful
DOSCODE:6FE4		     retn
DOSCODE:6FE5 ; START OF	FUNCTION CHUNK FOR DOS_RMDIR
DOSCODE:6FE5 NODEACCERRJ:			     ; ...
DOSCODE:6FE5		     mov     ax, 5
DOSCODE:6FE8 _BadRet:				     ; ...
DOSCODE:6FE8		     stc
DOSCODE:6FE9		     call    LCritDisk
DOSCODE:6FEC		     retn
DOSCODE:6FEC ; END OF FUNCTION CHUNK FOR DOS_RMDIR
DOSCODE:6FED PATHNFJ:				     ; ...
DOSCODE:6FED		     call    LCritDisk
DOSCODE:6FF0		     jmp     SET_MKND_ERR
DOSCODE:6FF3 LOCAL_MKDIR:			     ; ...
DOSCODE:6FF3		     call    ECritDisk
DOSCODE:6FF6		     mov     word ptr ds:THISSFT+2, ss
DOSCODE:6FFA		     mov     word ptr ds:THISSFT, offset RENBUF
DOSCODE:7000		     mov     word ptr ds:RENBUF+33h, 0 ; [RENBUF+SF_ENTRY.sf_MFT]
DOSCODE:7006		     mov     al, 10h
DOSCODE:7008		     call    MakeNode
DOSCODE:700B		     jb	     short PATHNFJ
DOSCODE:700D		     cmp     ax, 3
DOSCODE:7010		     jz	     short NODEACCERRJ
DOSCODE:7012		     les     bp, ds:THISDPB
DOSCODE:7016		     lds     di, ds:CURBUF
DOSCODE:701A		     sub     si, di
DOSCODE:701C		     push    si
DOSCODE:701D		     push    word ptr [di+8]
DOSCODE:7020		     push    word ptr [di+6]
DOSCODE:7023		     push    ss
DOSCODE:7024		     pop     ds
DOSCODE:7025		     push    ds:DIRSTART
DOSCODE:7029		     xor     ax, ax
DOSCODE:702B		     mov     ds:DIRSTART, ax
DOSCODE:702E		     call    NEWDIR
DOSCODE:7031		     jb	     short NODEEXISTSPOPDEL
DOSCODE:7033		     call    GETENT
DOSCODE:7036		     jb	     short NODEEXISTSPOPDEL
DOSCODE:7038		     les     di, ds:CURBUF
DOSCODE:703C		     test    byte ptr es:[di+5], 40h
DOSCODE:7041		     jnz     short yesdirty5
DOSCODE:7043		     call    INC_DIRTY_COUNT
DOSCODE:7046		     or	     byte ptr es:[di+5], 40h
DOSCODE:704B yesdirty5:				     ; ...
DOSCODE:704B		     add     di, 20
DOSCODE:704E		     mov     ax, 202Eh
DOSCODE:7051		     mov     dx, ds:DIRSTART
DOSCODE:7055		     call    SETDOTENT
DOSCODE:7058		     mov     ax, 2E2Eh
DOSCODE:705B		     pop     dx
DOSCODE:705C		     call    SETDOTENT
DOSCODE:705F		     les     bp, ds:THISDPB
DOSCODE:7063		     mov     ds:ALLOWED, 18h
DOSCODE:7068		     pop     dx
DOSCODE:7069		     pop     ds:HIGH_SECTOR
DOSCODE:706D		     xor     al, al
DOSCODE:706F		     call    GETBUFFR
DOSCODE:7072		     jb	     short NODEEXISTSP
DOSCODE:7074		     mov     dx, ds:DIRSTART
DOSCODE:7078		     lds     di, ds:CURBUF
DOSCODE:707C		     or	     byte ptr [di+5], 4
DOSCODE:7080		     pop     si
DOSCODE:7081		     add     si, di
DOSCODE:7083		     mov     [si], dx
DOSCODE:7085		     xor     dx, dx
DOSCODE:7087		     mov     [si+2], dx
DOSCODE:708A		     mov     [si+4], dx
DOSCODE:708D ; =============== S U B R O U T I N E =======================================
DOSCODE:708D DIRUP	     proc near		     ; ...
DOSCODE:708D		     test    byte ptr [di+5], 40h
DOSCODE:7091		     jnz     short yesdirty6
DOSCODE:7093		     call    INC_DIRTY_COUNT
DOSCODE:7096		     or	     byte ptr [di+5], 40h
DOSCODE:709A yesdirty6:				     ; ...
DOSCODE:709A		     push    ss
DOSCODE:709B		     pop     ds
DOSCODE:709C		     mov     al, es:[bp+0]
DOSCODE:70A0		     call    FLUSHBUF
DOSCODE:70A3		     mov     ax, 5
DOSCODE:70A6		     call    LCritDisk
DOSCODE:70A9		     retn
DOSCODE:70A9 DIRUP	     endp
DOSCODE:70AA NODEEXISTSPOPDEL:			     ; ...
DOSCODE:70AA		     pop     dx
DOSCODE:70AB		     pop     dx
DOSCODE:70AC		     pop     ds:HIGH_SECTOR
DOSCODE:70B0		     les     bp, ds:THISDPB
DOSCODE:70B4		     mov     ds:ALLOWED, 18h
DOSCODE:70B9		     xor     al, al
DOSCODE:70BB		     call    GETBUFFR
DOSCODE:70BE		     jb	     short NODEEXISTSP
DOSCODE:70C0		     lds     di, ds:CURBUF
DOSCODE:70C4		     or	     byte ptr [di+5], 4
DOSCODE:70C8		     pop     si
DOSCODE:70C9		     add     si, di
DOSCODE:70CB		     sub     si, 1Ah
DOSCODE:70CE		     mov     byte ptr [si], 0E5h ; 'å'
DOSCODE:70D1		     call    DIRUP
DOSCODE:70D4 NODEEXISTS:			     ; ...
DOSCODE:70D4		     jmp     NODEACCERRJ
DOSCODE:70D7 NODEEXISTSP:			     ; ...
DOSCODE:70D7		     pop     si
DOSCODE:70D8		     jmp     short NODEEXISTS
DOSCODE:70DA ; =============== S U B R O U T I N E =======================================
DOSCODE:70DA DOS_CHDIR	     proc near		     ; ...
DOSCODE:70DA		     call    TestNet
DOSCODE:70DD		     jnb     short LOCAL_CHDIR
DOSCODE:70DF		     mov     ax, 1105h
DOSCODE:70E2		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	CHDIR
DOSCODE:70E2					     ; SS = DOS	CS
DOSCODE:70E2					     ; SDA first filename pointer -> fully-qualified directory name
DOSCODE:70E2					     ; SDA CDS pointer -> current directory
DOSCODE:70E2					     ; Return: CF set on error,	AX = DOS error code
DOSCODE:70E2					     ; CF clear	if successful
DOSCODE:70E4		     retn
DOSCODE:70E5 LOCAL_CHDIR:			     ; ...
DOSCODE:70E5		     call    ECritDisk
DOSCODE:70E8		     test    word ptr es:[di+43h], 2000h
DOSCODE:70EE		     jz	     short nojoin
DOSCODE:70F0		     mov     word ptr es:[di+49h], 0FFFFh
DOSCODE:70F6 nojoin:				     ; ...
DOSCODE:70F6		     mov     ds:NoSetDir, 0
DOSCODE:70FB		     mov     ds:SATTRIB, 16h
DOSCODE:7100		     or	     ds:FastOpenFlg, 1
DOSCODE:7105		     call    GETPATH
DOSCODE:7108		     pushf
DOSCODE:7109		     and     ds:FastOpenFlg, 80h
DOSCODE:710E		     popf
DOSCODE:710F		     mov     ax, 3
DOSCODE:7112		     jb	     short ChDirDone
DOSCODE:7114		     jnz     short NOTDIRPATH
DOSCODE:7116		     mov     cx, ds:DIRSTART
DOSCODE:711A		     clc
DOSCODE:711B ChDirDone:				     ; ...
DOSCODE:711B		     call    LCritDisk
DOSCODE:711E		     retn
DOSCODE:711E DOS_CHDIR	     endp
DOSCODE:711F ; =============== S U B R O U T I N E =======================================
DOSCODE:711F DOS_RMDIR	     proc near		     ; ...
DOSCODE:711F ; FUNCTION	CHUNK AT DOSCODE:6FE5 SIZE 00000008 BYTES
DOSCODE:711F		     call    TestNet
DOSCODE:7122		     jnb     short LOCAL_RMDIR
DOSCODE:7124		     mov     ax, 1101h
DOSCODE:7127		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	REMOVE REMOTE DIRECTORY
DOSCODE:7127					     ; SS = DOS	CS
DOSCODE:7127					     ; SDA first filename pointer -> fully-qualified directory name
DOSCODE:7127					     ; SDA CDS pointer -> current directory
DOSCODE:7127					     ; Return: CF set on error,	AX = DOS error code
DOSCODE:7127					     ; CF clear	if successful
DOSCODE:7129		     retn
DOSCODE:712A LOCAL_RMDIR:			     ; ...
DOSCODE:712A		     call    ECritDisk
DOSCODE:712D		     mov     ds:NoSetDir, 0
DOSCODE:7132		     mov     ds:SATTRIB, 16h
DOSCODE:7137		     call    GETPATH
DOSCODE:713A		     jb	     short NOPATH
DOSCODE:713C		     jnz     short NOTDIRPATH
DOSCODE:713E		     mov     di, ds:DIRSTART
DOSCODE:7142		     or	     di, di
DOSCODE:7144		     jnz     short rmdir_get_buf
DOSCODE:7146		     jmp     short NOTDIRPATH
DOSCODE:7148 NOPATH:				     ; ...
DOSCODE:7148		     mov     ax, 3
DOSCODE:714B		     jmp     _BadRet
DOSCODE:714E NOTDIRPATHPOP:			     ; ...
DOSCODE:714E		     pop     ax
DOSCODE:714F		     pop     ax
DOSCODE:7150 NOTDIRPATHPOP2:			     ; ...
DOSCODE:7150		     pop     ax
DOSCODE:7151 NOTDIRPATH:			     ; ...
DOSCODE:7151		     jmp     NODEACCERRJ
DOSCODE:7154 rmdir_get_buf:			     ; ...
DOSCODE:7154		     lds     di, ds:CURBUF
DOSCODE:7158		     sub     bx, di
DOSCODE:715A		     push    bx
DOSCODE:715B		     push    word ptr [di+8]
DOSCODE:715E		     push    word ptr [di+6]
DOSCODE:7161		     push    ss
DOSCODE:7162		     pop     ds
DOSCODE:7163		     push    ss
DOSCODE:7164		     pop     es
DOSCODE:7165		     mov     di, offset	NAME1
DOSCODE:7168		     mov     al, '?'
DOSCODE:716A		     mov     cx, 11
DOSCODE:716D		     rep stosb
DOSCODE:716F		     xor     al, al
DOSCODE:7171		     stosb
DOSCODE:7172		     call    STARTSRCH
DOSCODE:7175		     call    GETENTRY
DOSCODE:7178		     jb	     short NOTDIRPATHPOP
DOSCODE:717A		     mov     ds, word ptr ds:CURBUF+2
DOSCODE:717E		     mov     si, bx
DOSCODE:7180		     lodsw
DOSCODE:7181		     cmp     ax, 202Eh
DOSCODE:7184		     jnz     short NOTDIRPATHPOP
DOSCODE:7186		     add     si, 30
DOSCODE:7189		     lodsw
DOSCODE:718A		     cmp     ax, 2E2Eh
DOSCODE:718D		     jnz     short NOTDIRPATHPOP
DOSCODE:718F		     push    ss
DOSCODE:7190		     pop     ds
DOSCODE:7191		     mov     ds:LASTENT, 2
DOSCODE:7197		     call    GETENTRY
DOSCODE:719A		     jb	     short NOTDIRPATHPOP
DOSCODE:719C		     mov     ds:ATTRIB,	16h
DOSCODE:71A1		     call    SRCH
DOSCODE:71A4		     jnb     short NOTDIRPATHPOP
DOSCODE:71A6		     cmp     ds:FAILERR, 0
DOSCODE:71AB		     jnz     short NOTDIRPATHPOP
DOSCODE:71AD		     les     bp, ds:THISDPB
DOSCODE:71B1		     mov     bx, ds:DIRSTART
DOSCODE:71B5		     call    RELEASE
DOSCODE:71B8		     jb	     short NOTDIRPATHPOP
DOSCODE:71BA		     pop     dx
DOSCODE:71BB		     pop     ds:HIGH_SECTOR
DOSCODE:71BF		     mov     ds:ALLOWED, 18h
DOSCODE:71C4		     xor     al, al
DOSCODE:71C6		     call    GETBUFFR
DOSCODE:71C9		     jb	     short NOTDIRPATHPOP2
DOSCODE:71CB		     lds     di, ds:CURBUF
DOSCODE:71CF		     or	     byte ptr [di+5], 4
DOSCODE:71D3		     pop     bx
DOSCODE:71D4		     add     bx, di
DOSCODE:71D6		     mov     byte ptr [bx], 0E5h
DOSCODE:71D9		     push    ds
DOSCODE:71DA		     push    ss
DOSCODE:71DB		     pop     ds
DOSCODE:71DC		     call    FastOpen_Delete
DOSCODE:71DF		     pop     ds
DOSCODE:71E0		     jmp     DIRUP
DOSCODE:71E0 DOS_RMDIR	     endp
DOSCODE:71E3 ; =============== S U B R O U T I N E =======================================
DOSCODE:71E3 SWAPBACK	     proc near		     ; ...
DOSCODE:71E3		     mov     ds:CONSWAP, 0
DOSCODE:71E8		     retn
DOSCODE:71E8 SWAPBACK	     endp
DOSCODE:71E9 ; =============== S U B R O U T I N E =======================================
DOSCODE:71E9 SWAPCON	     proc near		     ; ...
DOSCODE:71E9		     mov     ds:CONSWAP, 1
DOSCODE:71EE		     push    ax
DOSCODE:71EF		     mov     ax, word ptr ds:THISSFT
DOSCODE:71F2		     mov     word ptr ds:CONSFT, ax
DOSCODE:71F5		     mov     ax, word ptr ds:THISSFT+2
DOSCODE:71F8		     mov     word ptr ds:CONSFT+2, ax
DOSCODE:71FB		     pop     ax
DOSCODE:71FC		     retn
DOSCODE:71FC SWAPCON	     endp
DOSCODE:71FD ; =============== S U B R O U T I N E =======================================
DOSCODE:71FD DOS_READ	     proc near		     ; ...
DOSCODE:71FD		     les     di, ds:THISSFT
DOSCODE:7201		     mov     al, es:[di+2]
DOSCODE:7205		     and     al, 0Fh
DOSCODE:7207		     cmp     al, 1
DOSCODE:7209		     jnz     short READ_NO_MODE
DOSCODE:720B		     jmp     SET_ACC_ERR
DOSCODE:720E READ_NO_MODE:			     ; ...
DOSCODE:720E		     call    SETUP
DOSCODE:7211		     jcxz    short NoIORet
DOSCODE:7213		     call    IsSFTNet
DOSCODE:7216		     jz	     short LOCAL_READ
DOSCODE:7218		     mov     ax, 1108h
DOSCODE:721B		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	READ FROM REMOTE FILE
DOSCODE:721B					     ; ES:DI ->	SFT
DOSCODE:721B					     ; SFT DPB field ->	DPB of drive containing	file
DOSCODE:721B					     ; CX = number of bytes, SS	= DOS CS, SDA DTA field	-> user	buffer
DOSCODE:721B					     ; Return: CF set on error,	CX = bytes read
DOSCODE:721D		     retn
DOSCODE:721E NoIORet:				     ; ...
DOSCODE:721E		     clc
DOSCODE:721F		     retn
DOSCODE:7220 LOCAL_READ:			     ; ...
DOSCODE:7220		     test    byte ptr es:[di+5], 80h
DOSCODE:7225		     jnz     short READDEV
DOSCODE:7227		     mov     ds:EXTERR_LOCUS, 2
DOSCODE:722C		     call    ECritDisk
DOSCODE:722F		     call    DISKREAD
DOSCODE:7232 critexit:
DOSCODE:7232		     call    LCritDisk
DOSCODE:7235		     retn
DOSCODE:7236 READDEV:				     ; ...
DOSCODE:7236		     mov     ds:EXTERR_LOCUS, 4
DOSCODE:723B		     mov     bl, es:[di+5]
DOSCODE:723F		     les     di, ds:DMAADD
DOSCODE:7243		     test    bl, 40h
DOSCODE:7246		     jz	     short ENDRDDEVJ3
DOSCODE:7248		     test    bl, 4
DOSCODE:724B		     jz	     short TESTRAW
DOSCODE:724D		     xor     al, al
DOSCODE:724F ENDRDDEVJ3:			     ; ...
DOSCODE:724F		     jmp     ENDRDDEVJ2
DOSCODE:7252 TESTRAW:				     ; ...
DOSCODE:7252		     test    bl, 20h
DOSCODE:7255		     jnz     short DVRDRAW
DOSCODE:7257		     test    bl, 1
DOSCODE:725A		     jz	     short NOTRDCON
DOSCODE:725C		     jmp     READCON
DOSCODE:725F DVRDRAW:				     ; ...
DOSCODE:725F		     push    es
DOSCODE:7260		     pop     ds
DOSCODE:7261		     test    ss:IsWin386, 1
DOSCODE:7267		     jz	     short ReadRawRetry
DOSCODE:7269		     test    bl, 1
DOSCODE:726C		     jz	     short ReadRawRetry
DOSCODE:726E		     jmp     do_polling
DOSCODE:7271 ReadRawRetry:			     ; ...
DOSCODE:7271		     mov     bx, di
DOSCODE:7273		     xor     ax, ax
DOSCODE:7275		     mov     dx, ax
DOSCODE:7277		     call    SETREAD
DOSCODE:727A		     push    ds
DOSCODE:727B		     lds     si, ss:THISSFT
DOSCODE:7280		     call    DEVIOCALL
DOSCODE:7283		     mov     dx, di
DOSCODE:7285		     mov     ah, 86h
DOSCODE:7287		     mov     di, ss:DEVCALL_REQSTAT
DOSCODE:728C		     or	     di, di
DOSCODE:728E		     jns     short CRDROK
DOSCODE:7290		     call    CHARHARD
DOSCODE:7293		     mov     di, dx
DOSCODE:7295		     add     di, word ptr ss:CALLBPB
DOSCODE:729A		     sub     cx, word ptr ss:CALLBPB
DOSCODE:729F		     or	     al, al
DOSCODE:72A1		     jz	     short CRDROK
DOSCODE:72A3		     cmp     al, 3
DOSCODE:72A5		     jz	     short CRDFERR
DOSCODE:72A7		     pop     ds
DOSCODE:72A8		     jmp     short ReadRawRetry
DOSCODE:72AA CRDFERR:				     ; ...
DOSCODE:72AA		     pop     di
DOSCODE:72AB DEVIOFERR:				     ; ...
DOSCODE:72AB		     les     di, ss:THISSFT
DOSCODE:72B0		     jmp     SET_ACC_ERR_DS
DOSCODE:72B3 CRDROK:				     ; ...
DOSCODE:72B3		     pop     di
DOSCODE:72B4		     mov     di, dx
DOSCODE:72B6		     add     di, word ptr ss:CALLBPB
DOSCODE:72BB		     jmp     short ENDRDDEVJ3
DOSCODE:72BD NOTRDCON:				     ; ...
DOSCODE:72BD		     mov     ax, es
DOSCODE:72BF		     mov     ds, ax
DOSCODE:72C1		     mov     bx, di
DOSCODE:72C3		     xor     dx, dx
DOSCODE:72C5		     mov     ax, dx
DOSCODE:72C7		     push    cx
DOSCODE:72C8		     mov     cx, 1
DOSCODE:72CB		     call    SETREAD
DOSCODE:72CE		     pop     cx
DOSCODE:72CF		     lds     si, ss:THISSFT
DOSCODE:72D4		     lds     si, [si+7]
DOSCODE:72D7 DVRDLP:				     ; ...
DOSCODE:72D7		     call    near ptr DSKSTATCHK
DOSCODE:72DA		     call    DEVIOCALL2
DOSCODE:72DD		     push    di
DOSCODE:72DE		     mov     ah, 86h
DOSCODE:72E0		     mov     di, ss:DEVCALL_REQSTAT
DOSCODE:72E5		     or	     di, di
DOSCODE:72E7		     jns     short CRDOK
DOSCODE:72E9		     call    CHARHARD
DOSCODE:72EC		     pop     di
DOSCODE:72ED		     mov     word ptr ss:CALLBPB, 1
DOSCODE:72F4		     cmp     al, 1
DOSCODE:72F6		     jz	     short DVRDLP
DOSCODE:72F8		     cmp     al, 3
DOSCODE:72FA		     jz	     short DEVIOFERR
DOSCODE:72FC		     xor     al, al
DOSCODE:72FE		     jmp     short DVRDIGN
DOSCODE:7300 CRDOK:				     ; ...
DOSCODE:7300		     pop     di
DOSCODE:7301		     cmp     word ptr ss:CALLBPB, 1 ; [SS:CALLSCNT]
DOSCODE:7307		     jnz     short ENDRDDEVJ2
DOSCODE:7309		     push    ds
DOSCODE:730A		     mov     ds, word ptr ss:CALLBR+2 ;	[SS:CALLXAD+2]
DOSCODE:730F		     mov     al, [di]
DOSCODE:7311		     pop     ds
DOSCODE:7312 DVRDIGN:				     ; ...
DOSCODE:7312		     inc     word ptr ss:CALLBR	; [SS:CALLXAD]
DOSCODE:7317		     mov     ss:DEVCALL_REQSTAT, 0
DOSCODE:731E		     inc     di
DOSCODE:731F		     cmp     al, 1Ah
DOSCODE:7321		     jz	     short ENDRDDEVJ2
DOSCODE:7323		     cmp     al, 0Dh
DOSCODE:7325		     loopne  DVRDLP
DOSCODE:7327		     inc     ax
DOSCODE:7328 ENDRDDEVJ2:			     ; ...
DOSCODE:7328		     jmp     ENDRDDEV
DOSCODE:732B do_polling:			     ; ...
DOSCODE:732B		     mov     bx, di
DOSCODE:732D		     xor     ax, ax
DOSCODE:732F		     mov     dx, ax
DOSCODE:7331		     call    SETREAD
DOSCODE:7334 do_io:				     ; ...
DOSCODE:7334		     mov     byte ptr es:[bx+2], 5
DOSCODE:7339		     push    ds
DOSCODE:733A		     lds     si, ss:THISSFT
DOSCODE:733F		     call    DEVIOCALL
DOSCODE:7342		     pop     ds
DOSCODE:7343		     test    word ptr es:[bx+3], 8000h
DOSCODE:7349		     jz	     short check_busy
DOSCODE:734B		     push    ds
DOSCODE:734C		     mov     dx, di
DOSCODE:734E		     call    CHARHARD
DOSCODE:7351		     mov     di, dx
DOSCODE:7353		     or	     al, al
DOSCODE:7355		     jz	     short pop_done_read
DOSCODE:7357		     cmp     al, 3
DOSCODE:7359		     jz	     short devrderr
DOSCODE:735B		     pop     ds
DOSCODE:735C		     jmp     short do_io
DOSCODE:735E check_busy:			     ; ...
DOSCODE:735E		     test    word ptr es:[bx+3], 200h
DOSCODE:7364		     jnz     short no_char
DOSCODE:7366		     mov     byte ptr es:[bx+2], 4
DOSCODE:736B		     mov     word ptr es:[bx+12h], 1
DOSCODE:7371		     push    ds
DOSCODE:7372		     lds     si, ss:THISSFT
DOSCODE:7377		     call    DEVIOCALL
DOSCODE:737A		     mov     dx, di
DOSCODE:737C		     mov     ah, 86h
DOSCODE:737E		     mov     di, es:[bx+3]
DOSCODE:7382		     test    di, 8000h
DOSCODE:7386		     jz	     short next_char
DOSCODE:7388		     call    CHARHARD
DOSCODE:738B		     mov     di, dx
DOSCODE:738D		     or	     al, al
DOSCODE:738F		     jz	     short pop_done_read
DOSCODE:7391		     cmp     al, 3
DOSCODE:7393		     jz	     short devrderr
DOSCODE:7395		     pop     ds
DOSCODE:7396		     jmp     short do_io
DOSCODE:7398 next_char:				     ; ...
DOSCODE:7398		     pop     ds
DOSCODE:7399		     mov     di, dx
DOSCODE:739B		     dec     cx
DOSCODE:739C		     jcxz    short done_read
DOSCODE:739E		     inc     word ptr es:[bx+14]
DOSCODE:73A2		     jmp     short do_io
DOSCODE:73A4 devrderr:				     ; ...
DOSCODE:73A4		     pop     di
DOSCODE:73A5		     les     di, ss:THISSFT
DOSCODE:73AA		     jmp     SET_ACC_ERR_DS
DOSCODE:73AD no_char:				     ; ...
DOSCODE:73AD		     push    ax
DOSCODE:73AE		     mov     ah, 84h
DOSCODE:73B0		     int     2Ah	     ; Microsoft Networks - KEYBOARD BUSY LOOP
DOSCODE:73B2		     pop     ax
DOSCODE:73B3		     jmp     do_io
DOSCODE:73B6 pop_done_read:			     ; ...
DOSCODE:73B6		     pop     ds
DOSCODE:73B7 done_read:				     ; ...
DOSCODE:73B7		     add     di, word ptr ss:CALLBPB
DOSCODE:73BC		     jmp     ENDRDDEVJ3
DOSCODE:73BF TRANBUF:				     ; ...
DOSCODE:73BF		     lodsb
DOSCODE:73C0		     stosb
DOSCODE:73C1		     cmp     al, 0Dh
DOSCODE:73C3		     jnz     short NORMCH
DOSCODE:73C5		     mov     byte ptr [si], 0Ah
DOSCODE:73C8 NORMCH:				     ; ...
DOSCODE:73C8		     cmp     al, 0Ah
DOSCODE:73CA		     loopne  TRANBUF
DOSCODE:73CC		     jnz     short ENDRDCON
DOSCODE:73CE		     xor     si, si
DOSCODE:73D0		     call    OUTT
DOSCODE:73D3		     or	     al, 1
DOSCODE:73D5 ENDRDCON:				     ; ...
DOSCODE:73D5		     push    ss
DOSCODE:73D6		     pop     ds
DOSCODE:73D7		     call    SWAPBACK
DOSCODE:73DA		     mov     ds:CONTPOS, si
DOSCODE:73DE ENDRDDEV:				     ; ...
DOSCODE:73DE		     push    ss
DOSCODE:73DF		     pop     ds
DOSCODE:73E0		     mov     ds:NEXTADD, di
DOSCODE:73E4		     jnz     short SETSFTC
DOSCODE:73E6		     les     di, ds:THISSFT
DOSCODE:73EA		     and     byte ptr es:[di+5], 0BFh
DOSCODE:73EF SETSFTC:				     ; ...
DOSCODE:73EF		     call    SETSFT
DOSCODE:73F2		     retn
DOSCODE:73F3 READCON:				     ; ...
DOSCODE:73F3		     call    SWAPCON
DOSCODE:73F6		     mov     si, ds:CONTPOS
DOSCODE:73FA		     or	     si, si
DOSCODE:73FC		     jnz     short TRANBUF
DOSCODE:73FE		     cmp     ds:CONBUF,	128
DOSCODE:7403		     jz	     short GETBUF
DOSCODE:7405		     mov     word ptr ds:CONBUF, 0FF80h
DOSCODE:740B GETBUF:				     ; ...
DOSCODE:740B		     push    cx
DOSCODE:740C		     push    es
DOSCODE:740D		     push    di
DOSCODE:740E		     mov     dx, offset	CONBUF
DOSCODE:7411		     call    $STD_CON_STRING_INPUT
DOSCODE:7414		     pop     di
DOSCODE:7415		     pop     es
DOSCODE:7416		     pop     cx
DOSCODE:7417		     mov     si, (offset CONBUF+2)
DOSCODE:741A		     cmp     byte ptr [si], 1Ah
DOSCODE:741D		     jnz     short TRANBUF
DOSCODE:741F		     mov     al, 1Ah
DOSCODE:7421		     stosb
DOSCODE:7422		     dec     di
DOSCODE:7423		     mov     al, 0Ah
DOSCODE:7425		     call    OUTT
DOSCODE:7428		     xor     si, si
DOSCODE:742A		     jmp     short ENDRDCON
DOSCODE:742A DOS_READ	     endp
DOSCODE:742C ; =============== S U B R O U T I N E =======================================
DOSCODE:742C DOS_WRITE	     proc near		     ; ...
DOSCODE:742C		     les     di, ds:THISSFT
DOSCODE:7430		     mov     al, es:[di+2]
DOSCODE:7434		     and     al, 0Fh
DOSCODE:7436		     cmp     al, 0
DOSCODE:7438		     jnz     short Check_FCB_RO
DOSCODE:743A BadMode:				     ; ...
DOSCODE:743A		     jmp     SET_ACC_ERR
DOSCODE:743D Check_FCB_RO:			     ; ...
DOSCODE:743D		     test    byte ptr es:[di+3], 80h
DOSCODE:7442		     jz	     short WRITE_NO_MODE
DOSCODE:7444		     test    byte ptr es:[di+4], 1
DOSCODE:7449		     jnz     short BadMode
DOSCODE:744B WRITE_NO_MODE:			     ; ...
DOSCODE:744B		     call    SETUP
DOSCODE:744E		     call    IsSFTNet
DOSCODE:7451		     jz	     short LOCAL_WRITE
DOSCODE:7453		     mov     ax, 1109h
DOSCODE:7456		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	WRITE TO REMOTE	FILE
DOSCODE:7456					     ; ES:DI ->	SFT
DOSCODE:7456					     ; SFT DPB field ->	DPB of drive containing	file
DOSCODE:7456					     ; CX = number of bytes, SS	= DOS CS, SDA DTA field	-> user	buffer
DOSCODE:7456					     ; Return: CF set on error,	CX = bytes written
DOSCODE:7458		     retn
DOSCODE:7459 LOCAL_WRITE:			     ; ...
DOSCODE:7459		     test    byte ptr es:[di+5], 80h
DOSCODE:745E		     jnz     short WRTDEV
DOSCODE:7460		     mov     ds:EXTERR_LOCUS, 2
DOSCODE:7465		     call    ECritDisk
DOSCODE:7468		     call    DISKWRITE
DOSCODE:746B		     jb	     short nocommit
DOSCODE:746D		     les     di, ds:THISSFT
DOSCODE:7471		     test    byte ptr es:[di+3], 40h
DOSCODE:7476		     jz	     short nocommit
DOSCODE:7478		     push    cx
DOSCODE:7479		     call    DOS_COMMIT
DOSCODE:747C		     pop     cx
DOSCODE:747D nocommit:				     ; ...
DOSCODE:747D		     call    LCritDisk
DOSCODE:7480		     retn
DOSCODE:7481 DVWRTRAW:				     ; ...
DOSCODE:7481		     xor     ax, ax
DOSCODE:7483		     call    SETWRITE
DOSCODE:7486		     push    ds
DOSCODE:7487		     lds     si, ss:THISSFT
DOSCODE:748C		     call    DEVIOCALL
DOSCODE:748F		     mov     dx, di
DOSCODE:7491		     mov     ah, 87h
DOSCODE:7493		     mov     di, ss:DEVCALL_REQSTAT
DOSCODE:7498		     or	     di, di
DOSCODE:749A		     jns     short CWRTROK
DOSCODE:749C		     call    CHARHARD
DOSCODE:749F		     sub     cx, word ptr ss:CALLBPB ; [ss:CALLSCNT]
DOSCODE:74A4		     mov     bx, dx
DOSCODE:74A6		     add     bx, word ptr ss:CALLBPB
DOSCODE:74AB		     mov     di, bx
DOSCODE:74AD		     or	     al, al
DOSCODE:74AF		     jz	     short CWRTROK
DOSCODE:74B1		     cmp     al, 3
DOSCODE:74B3		     jz	     short CWRFERR
DOSCODE:74B5		     pop     ds
DOSCODE:74B6		     jmp     short DVWRTRAW
DOSCODE:74B8 CWRFERR:				     ; ...
DOSCODE:74B8		     pop     ax
DOSCODE:74B9		     jmp     CRDFERR
DOSCODE:74BC CWRTROK:				     ; ...
DOSCODE:74BC		     pop     ax
DOSCODE:74BD		     pop     ds
DOSCODE:74BE		     mov     ax, word ptr ds:CALLBPB
DOSCODE:74C1 ENDWRDEV:				     ; ...
DOSCODE:74C1		     les     di, ds:THISSFT
DOSCODE:74C5		     mov     cx, ax
DOSCODE:74C7		     call    ADDREC
DOSCODE:74CA		     retn
DOSCODE:74CB WRTNUL:				     ; ...
DOSCODE:74CB		     mov     dx, cx
DOSCODE:74CD WRTCOOKJ:				     ; ...
DOSCODE:74CD		     jmp     WRTCOOKDONE
DOSCODE:74D0 WRTDEV:				     ; ...
DOSCODE:74D0		     mov     ds:EXTERR_LOCUS, 4
DOSCODE:74D5		     or	     byte ptr es:[di+5], 40h
DOSCODE:74DA		     mov     bl, es:[di+5]
DOSCODE:74DE		     xor     ax, ax
DOSCODE:74E0		     jcxz    short ENDWRDEV
DOSCODE:74E2		     push    ds
DOSCODE:74E3		     mov     al, bl
DOSCODE:74E5		     lds     bx, ds:DMAADD
DOSCODE:74E9		     mov     di, bx
DOSCODE:74EB		     xor     dx, dx
DOSCODE:74ED		     test    al, 20h
DOSCODE:74EF		     jz	     short TEST_DEV_CON
DOSCODE:74F1		     jmp     short DVWRTRAW
DOSCODE:74F3 TEST_DEV_CON:			     ; ...
DOSCODE:74F3		     test    al, 2
DOSCODE:74F5		     jnz     short WRITECON
DOSCODE:74F7		     test    al, 4
DOSCODE:74F9		     jnz     short WRTNUL
DOSCODE:74FB		     mov     ax, dx
DOSCODE:74FD		     cmp     byte ptr [bx], 1Ah
DOSCODE:7500		     jz	     short WRTCOOKJ
DOSCODE:7502		     push    cx
DOSCODE:7503		     mov     cx, 1
DOSCODE:7506		     call    SETWRITE
DOSCODE:7509		     pop     cx
DOSCODE:750A		     lds     si, ss:THISSFT
DOSCODE:750F		     lds     si, [si+7]
DOSCODE:7512 DVWRTLP:				     ; ...
DOSCODE:7512		     call    near ptr DSKSTATCHK
DOSCODE:7515		     call    DEVIOCALL2
DOSCODE:7518		     push    di
DOSCODE:7519		     mov     ah, 87h
DOSCODE:751B		     mov     di, ss:35Dh
DOSCODE:7520		     or	     di, di
DOSCODE:7522		     jns     short CWROK
DOSCODE:7524		     call    CHARHARD
DOSCODE:7527		     pop     di
DOSCODE:7528		     mov     word ptr ss:CALLBPB, 1
DOSCODE:752F		     cmp     al, 1
DOSCODE:7531		     jz	     short DVWRTLP
DOSCODE:7533		     or	     al, al
DOSCODE:7535		     jz	     short DVWRTIGN
DOSCODE:7537		     jmp     CRDFERR
DOSCODE:753A CWROK:				     ; ...
DOSCODE:753A		     pop     di
DOSCODE:753B		     cmp     word ptr ss:CALLBPB, 0
DOSCODE:7541		     jz	     short WRTCOOKDONE
DOSCODE:7543 DVWRTIGN:				     ; ...
DOSCODE:7543		     inc     dx
DOSCODE:7544		     inc     word ptr ss:CALLBR
DOSCODE:7549		     inc     di
DOSCODE:754A		     push    ds
DOSCODE:754B		     mov     ds, word ptr ss:CALLBR+2
DOSCODE:7550		     cmp     byte ptr [di], 1Ah
DOSCODE:7553		     pop     ds
DOSCODE:7554		     jz	     short WRTCOOKDONE
DOSCODE:7556		     mov     ss:DEVCALL_REQSTAT, 0
DOSCODE:755D		     loop    DVWRTLP
DOSCODE:755F WRTCOOKDONE:			     ; ...
DOSCODE:755F		     mov     ax, dx
DOSCODE:7561		     pop     ds
DOSCODE:7562		     jmp     ENDWRDEV
DOSCODE:7565 WRITECON:				     ; ...
DOSCODE:7565		     push    ds
DOSCODE:7566		     push    ss
DOSCODE:7567		     pop     ds
DOSCODE:7568		     call    SWAPCON
DOSCODE:756B		     pop     ds
DOSCODE:756C		     mov     si, bx
DOSCODE:756E		     push    cx
DOSCODE:756F WRCONLP:				     ; ...
DOSCODE:756F		     lodsb
DOSCODE:7570		     cmp     al, 1Ah
DOSCODE:7572		     jz	     short CONEOF
DOSCODE:7574		     call    OUTT
DOSCODE:7577		     loop    WRCONLP
DOSCODE:7579 CONEOF:				     ; ...
DOSCODE:7579		     pop     ax
DOSCODE:757A		     sub     ax, cx
DOSCODE:757C		     pop     ds
DOSCODE:757D		     call    SWAPBACK
DOSCODE:7580		     jmp     ENDWRDEV
DOSCODE:7580 DOS_WRITE	     endp
DOSCODE:7583 ; =============== S U B R O U T I N E =======================================
DOSCODE:7583 GET_IO_SFT	     proc near		     ; ...
DOSCODE:7583		     cmp     ss:CONSWAP, 0
DOSCODE:7589		     jnz     short GetRedir
DOSCODE:758B GetNormal:				     ; ...
DOSCODE:758B		     push    ss
DOSCODE:758C		     pop     ds
DOSCODE:758D		     push    es
DOSCODE:758E		     push    di
DOSCODE:758F		     call    SFFromHandle
DOSCODE:7592		     jb	     short RET44P
DOSCODE:7594		     mov     si, es
DOSCODE:7596		     mov     ds, si
DOSCODE:7598		     mov     si, di
DOSCODE:759A RET44P:				     ; ...
DOSCODE:759A		     pop     di
DOSCODE:759B		     pop     es
DOSCODE:759C		     retn
DOSCODE:759D GetRedir:				     ; ...
DOSCODE:759D		     cmp     bx, 1
DOSCODE:75A0		     ja	     short GetNormal
DOSCODE:75A2		     lds     si, ss:CONSFT
DOSCODE:75A7		     clc
DOSCODE:75A8 get_io_sft_retn:			     ; ...
DOSCODE:75A8		     retn
DOSCODE:75A8 GET_IO_SFT	     endp
DOSCODE:75A9 ; =============== S U B R O U T I N E =======================================
DOSCODE:75A9 DIRREAD	     proc near		     ; ...
DOSCODE:75A9		     xor     dx, dx
DOSCODE:75AB		     cmp     ds:DIRSTART, 0
DOSCODE:75B0		     jnz     short SubDir
DOSCODE:75B2		     xchg    ax, dx
DOSCODE:75B3		     jmp     short DoRead
DOSCODE:75B5 SubDir:				     ; ...
DOSCODE:75B5		     mov     dl, al
DOSCODE:75B7		     and     dl, es:[bp+4]
DOSCODE:75BB		     mov     cl, es:[bp+5]
DOSCODE:75BF		     shr     ax, cl
DOSCODE:75C1 DoRead:				     ; ...
DOSCODE:75C1		     mov     ds:SECCLUSPOS, dl
DOSCODE:75C5		     mov     cx, ax
DOSCODE:75C7		     mov     ah, dl
DOSCODE:75C9		     mov     dx, ds:DIRSEC+2
DOSCODE:75CD		     mov     ds:HIGH_SECTOR, dx
DOSCODE:75D1		     mov     dx, ds:DIRSEC
DOSCODE:75D5		     add     dl, ah
DOSCODE:75D7		     adc     dh, 0
DOSCODE:75DA		     adc     ds:HIGH_SECTOR, 0
DOSCODE:75DF		     mov     bx, ds:CLUSNUM
DOSCODE:75E3		     mov     ds:NXTCLUSNUM, bx
DOSCODE:75E7		     jcxz    short FIRSTCLUSTER
DOSCODE:75E9 SKPCLLP:				     ; ...
DOSCODE:75E9		     call    UNPACK
DOSCODE:75EC		     jb	     short get_io_sft_retn
DOSCODE:75EE		     xchg    bx, di
DOSCODE:75F0		     call    IsEOF
DOSCODE:75F3		     jnb     short HAVESKIPPED
DOSCODE:75F5		     loop    SKPCLLP
DOSCODE:75F7 HAVESKIPPED:			     ; ...
DOSCODE:75F7		     mov     ds:NXTCLUSNUM, bx
DOSCODE:75FB		     mov     dx, di
DOSCODE:75FD		     mov     bl, ah
DOSCODE:75FF		     call    FIGREC
DOSCODE:7602 FIRSTCLUSTER:			     ; ...
DOSCODE:7602		     mov     ds:ALLOWED, 18h
DOSCODE:7607		     xor     al, al
DOSCODE:7609		     call    GETBUFFR
DOSCODE:760C		     jb	     short get_io_sft_retn
DOSCODE:760E SET_BUF_AS_DIR:			     ; ...
DOSCODE:760E		     push    ds
DOSCODE:760F		     push    si
DOSCODE:7610		     lds     si, ds:CURBUF
DOSCODE:7614		     or	     byte ptr [si+5], 4
DOSCODE:7618		     pop     si
DOSCODE:7619		     pop     ds
DOSCODE:761A dirread_retn:			     ; ...
DOSCODE:761A		     retn
DOSCODE:761A DIRREAD	     endp
DOSCODE:761B ; =============== S U B R O U T I N E =======================================
DOSCODE:761B FATSECRD	     proc near		     ; ...
DOSCODE:761B ; FUNCTION	CHUNK AT DOSCODE:7660 SIZE 00000002 BYTES
DOSCODE:761B		     mov     ss:ALLOWED, 18h
DOSCODE:7621		     mov     di, cx
DOSCODE:7623		     mov     cl, es:[bp+8]
DOSCODE:7627		     mov     ax, es:[bp+0Fh]
DOSCODE:762B		     xor     ch, ch
DOSCODE:762D		     push    dx
DOSCODE:762E NXTFAT:				     ; ...
DOSCODE:762E		     mov     ss:HIGH_SECTOR, 0
DOSCODE:7635		     push    cx
DOSCODE:7636		     push    ax
DOSCODE:7637		     mov     cx, di
DOSCODE:7639		     call    DSKREAD
DOSCODE:763C		     pop     ax
DOSCODE:763D		     pop     cx
DOSCODE:763E		     jz	     short RET41P
DOSCODE:7640		     add     dx, ax
DOSCODE:7642		     loop    NXTFAT
DOSCODE:7644		     pop     dx
DOSCODE:7645		     mov     cx, di
DOSCODE:7645 FATSECRD	     endp ; sp-analysis	failed
DOSCODE:7647 ; =============== S U B R O U T I N E =======================================
DOSCODE:7647 DREAD	     proc near		     ; ...
DOSCODE:7647		     call    DSKREAD
DOSCODE:764A		     jz	     short dirread_retn
DOSCODE:764C		     mov     ss:READOP,	0
DOSCODE:7652		     call    HARDERRRW
DOSCODE:7655		     cmp     al, 1
DOSCODE:7657		     jz	     short DREAD
DOSCODE:7659		     cmp     al, 3
DOSCODE:765B		     clc
DOSCODE:765C		     jnz     short NO_CAR
DOSCODE:765E		     stc
DOSCODE:765F NO_CAR:				     ; ...
DOSCODE:765F		     retn
DOSCODE:765F DREAD	     endp
DOSCODE:7660 ; START OF	FUNCTION CHUNK FOR FATSECRD
DOSCODE:7660 RET41P:				     ; ...
DOSCODE:7660		     pop     dx
DOSCODE:7661		     retn
DOSCODE:7661 ; END OF FUNCTION CHUNK FOR FATSECRD
DOSCODE:7662 ; =============== S U B R O U T I N E =======================================
DOSCODE:7662 CHECK_WRITE_LOCK proc near		     ; ...
DOSCODE:7662		     test    byte ptr es:[di+4], 8
DOSCODE:7667		     jz	     short write_cont
DOSCODE:7669		     call    SET_ACC_ERR_DS
DOSCODE:766C		     retn
DOSCODE:766D write_cont:			     ; ...
DOSCODE:766D		     push    cx
DOSCODE:766E		     or	     cx, cx
DOSCODE:7670		     jnz     short Not_Truncate
DOSCODE:7672		     dec     cx
DOSCODE:7673 Not_Truncate:			     ; ...
DOSCODE:7673		     mov     al, 80h ; ''
DOSCODE:7675		     call    LOCK_CHECK
DOSCODE:7678		     pop     cx
DOSCODE:7679		     jnb     short WRITE_OK
DOSCODE:767B		     call    WRITE_LOCK_VIOLATION
DOSCODE:767E		     jnb     short write_cont
DOSCODE:7680 WRITE_OK:				     ; ...
DOSCODE:7680		     retn
DOSCODE:7680 CHECK_WRITE_LOCK endp
DOSCODE:7681 ; =============== S U B R O U T I N E =======================================
DOSCODE:7681 CHECK_READ_LOCK proc near		     ; ...
DOSCODE:7681		     test    byte ptr es:[di+4], 8
DOSCODE:7686		     jz	     short do_retry
DOSCODE:7688		     call    SET_ACC_ERR
DOSCODE:768B		     retn
DOSCODE:768C do_retry:				     ; ...
DOSCODE:768C		     xor     al, al
DOSCODE:768E		     call    LOCK_CHECK
DOSCODE:7691		     jnb     short READLOCK_OK
DOSCODE:7693		     call    READ_LOCK_VIOLATION
DOSCODE:7696		     jnb     short do_retry
DOSCODE:7698 READLOCK_OK:			     ; ...
DOSCODE:7698		     retn
DOSCODE:7698 CHECK_READ_LOCK endp
DOSCODE:7699 ; =============== S U B R O U T I N E =======================================
DOSCODE:7699 DSKREAD	     proc near		     ; ...
DOSCODE:7699		     push    cx
DOSCODE:769A		     mov     ah, es:[bp+17h]
DOSCODE:769E		     mov     al, es:[bp+1]
DOSCODE:76A2		     push    bx
DOSCODE:76A3		     push    es
DOSCODE:76A4		     call    SETREAD
DOSCODE:76A7		     jmp     short DODSKOP
DOSCODE:76A7 DSKREAD	     endp
DOSCODE:76A9 ; =============== S U B R O U T I N E =======================================
DOSCODE:76A9 DWRITE	     proc near		     ; ...
DOSCODE:76A9		     call    DSKWRITE
DOSCODE:76AC		     jz	     short dw_ret_label
DOSCODE:76AE		     mov     ss:READOP,	1
DOSCODE:76B4		     call    HARDERRRW
DOSCODE:76B7		     cmp     al, 1
DOSCODE:76B9		     jz	     short DWRITE
DOSCODE:76BB		     cmp     al, 3
DOSCODE:76BD		     clc
DOSCODE:76BE		     jnz     short dw_ret_label
DOSCODE:76C0		     stc
DOSCODE:76C1 dw_ret_label:			     ; ...
DOSCODE:76C1		     retn
DOSCODE:76C1 DWRITE	     endp
DOSCODE:76C2 ; =============== S U B R O U T I N E =======================================
DOSCODE:76C2 DSKWRITE	     proc near		     ; ...
DOSCODE:76C2		     push    cx
DOSCODE:76C3		     mov     ah, es:[bp+17h]
DOSCODE:76C7		     mov     al, es:[bp+1]
DOSCODE:76CB		     push    bx
DOSCODE:76CC		     push    es
DOSCODE:76CD		     call    SETWRITE
DOSCODE:76D0 DODSKOP:				     ; ...
DOSCODE:76D0		     mov     cx, ds
DOSCODE:76D2		     pop     ds
DOSCODE:76D3		     push    ds
DOSCODE:76D4		     lds     si, ds:[bp+13h]
DOSCODE:76D8		     call    DEVIOCALL2
DOSCODE:76DB		     mov     ds, cx
DOSCODE:76DD		     pop     es
DOSCODE:76DE		     pop     bx
DOSCODE:76DF		     mov     cx, word ptr ss:CALLBPB
DOSCODE:76E4		     pop     di
DOSCODE:76E5		     sub     cx, di
DOSCODE:76E7		     neg     cx
DOSCODE:76E9		     mov     ax, ss:DEVCALL_REQSTAT
DOSCODE:76ED		     test    ax, 8000h
DOSCODE:76F0		     retn
DOSCODE:76F0 DSKWRITE	     endp
DOSCODE:76F1 ; =============== S U B R O U T I N E =======================================
DOSCODE:76F1 HARDERRRW	     proc near		     ; ...
DOSCODE:76F1		     cmp     al, 0Fh
DOSCODE:76F3		     jnz     short DO_ERR
DOSCODE:76F5		     push    ax
DOSCODE:76F6		     mov     ax, word ptr ss:CALLVIDRW
DOSCODE:76FA		     mov     word ptr ss:EXTERRPT, ax
DOSCODE:76FE		     mov     ax, word ptr ss:CALLVIDRW+2
DOSCODE:7702		     mov     word ptr ss:EXTERRPT+2, ax
DOSCODE:7706		     pop     ax
DOSCODE:7707 DO_ERR:				     ; ...
DOSCODE:7707		     call    HARDERR
DOSCODE:770A		     retn
DOSCODE:770A HARDERRRW	     endp
DOSCODE:770B ; =============== S U B R O U T I N E =======================================
DOSCODE:770B SETUP	     proc near		     ; ...
DOSCODE:770B		     lds     si, es:[di+7]
DOSCODE:770F		     mov     word ptr ss:THISDPB+2, ds
DOSCODE:7714		     push    ss
DOSCODE:7715		     pop     ds
DOSCODE:7716		     mov     word ptr ds:THISDPB, si
DOSCODE:771A		     mov     bx, word ptr ds:DMAADD
DOSCODE:771E		     mov     ds:NEXTADD, bx
DOSCODE:7722		     mov     ds:TRANS, 0
DOSCODE:7727		     mov     ax, es:[di+15h]
DOSCODE:772B		     mov     dx, es:[di+17h]
DOSCODE:772F		     mov     ds:BYTPOS+2, dx
DOSCODE:7733		     mov     ds:BYTPOS,	ax
DOSCODE:7736		     test    word ptr es:[di+5], 8080h
DOSCODE:773C		     jnz     short NOSETSTUFF
DOSCODE:773E		     push    es
DOSCODE:773F		     les     bp, ds:THISDPB
DOSCODE:7743		     mov     bl, es:[bp+0]
DOSCODE:7747		     mov     ds:THISDRV, bl
DOSCODE:774B		     mov     bx, es:[bp+2]
DOSCODE:774F		     push    cx
DOSCODE:7750		     call    DIV32
DOSCODE:7753		     mov     ds:BYTSECPOS, dx
DOSCODE:7757		     mov     ds:SECPOS,	ax
DOSCODE:775A		     mov     ds:SECPOS+2, cx
DOSCODE:775E		     mov     dx, cx
DOSCODE:7760		     mov     bx, ax
DOSCODE:7762		     and     bl, es:[bp+4]
DOSCODE:7766		     mov     ds:SECCLUSPOS, bl
DOSCODE:776A		     call    SHR32
DOSCODE:776D		     pop     cx
DOSCODE:776E		     jnz     short EOFERR
DOSCODE:7770		     cmp     ax, es:[bp+0Dh]
DOSCODE:7774		     ja	     short EOFERR
DOSCODE:7776		     mov     ds:CLUSNUM, ax
DOSCODE:7779		     pop     es
DOSCODE:777A NOSETSTUFF:			     ; ...
DOSCODE:777A		     mov     ax, cx
DOSCODE:777C		     add     ax, word ptr ds:DMAADD
DOSCODE:7780		     jnb     short setup_OK
DOSCODE:7782		     mov     ax, word ptr ds:DMAADD
DOSCODE:7785		     neg     ax
DOSCODE:7787		     jnz     short NoDec
DOSCODE:7789		     dec     ax
DOSCODE:778A NoDec:				     ; ...
DOSCODE:778A		     mov     cx, ax
DOSCODE:778C		     jcxz    short NOROOM
DOSCODE:778E setup_OK:				     ; ...
DOSCODE:778E		     retn
DOSCODE:778F EOFERR:				     ; ...
DOSCODE:778F		     pop     es
DOSCODE:7790		     xor     cx, cx
DOSCODE:7792 NOROOM:				     ; ...
DOSCODE:7792		     pop     bx
DOSCODE:7793		     clc
DOSCODE:7794		     retn
DOSCODE:7794 SETUP	     endp ; sp-analysis	failed
DOSCODE:7795 ; =============== S U B R O U T I N E =======================================
DOSCODE:7795 BREAKDOWN	     proc near		     ; ...
DOSCODE:7795		     mov     ax, ds:BYTSECPOS
DOSCODE:7798		     mov     bx, cx
DOSCODE:779A		     or	     ax, ax
DOSCODE:779C		     jz	     short SAVFIR
DOSCODE:779E		     sub     ax, es:[bp+2]
DOSCODE:77A2		     neg     ax
DOSCODE:77A4		     sub     bx, ax
DOSCODE:77A6		     jnb     short SAVFIR
DOSCODE:77A8		     add     ax, bx
DOSCODE:77AA		     xor     bx, bx
DOSCODE:77AC SAVFIR:				     ; ...
DOSCODE:77AC		     mov     ds:BYTCNT1, ax
DOSCODE:77AF		     mov     ax, bx
DOSCODE:77B1		     xor     dx, dx
DOSCODE:77B3		     div     word ptr es:[bp+2]
DOSCODE:77B7		     mov     ds:SECCNT,	ax
DOSCODE:77BA		     mov     ds:BYTCNT2, dx
DOSCODE:77BE _RET45:				     ; ...
DOSCODE:77BE		     retn
DOSCODE:77BE BREAKDOWN	     endp
DOSCODE:77BF ; =============== S U B R O U T I N E =======================================
DOSCODE:77BF READ_LOCK_VIOLATION proc near	     ; ...
DOSCODE:77BF		     mov     ds:READOP,	0
DOSCODE:77C4 ERR_ON_CHECK:			     ; ...
DOSCODE:77C4		     test    byte ptr es:[di+3], 80h
DOSCODE:77C9		     jnz     short HARD_ERR
DOSCODE:77CB		     push    cx
DOSCODE:77CC		     mov     cl, es:[di+2]
DOSCODE:77D0		     and     cl, 0F0h
DOSCODE:77D3		     cmp     cl, 0
DOSCODE:77D6		     pop     cx
DOSCODE:77D7		     jnz     short NO_HARD_ERR
DOSCODE:77D9 HARD_ERR:				     ; ...
DOSCODE:77D9		     call    LOCK_VIOLATION
DOSCODE:77DC		     jnb     short _RET45
DOSCODE:77DE NO_HARD_ERR:			     ; ...
DOSCODE:77DE		     xor     cx, cx
DOSCODE:77E0		     mov     ax, 21h
DOSCODE:77E3		     stc
DOSCODE:77E4		     retn
DOSCODE:77E4 READ_LOCK_VIOLATION endp
DOSCODE:77E5 ; =============== S U B R O U T I N E =======================================
DOSCODE:77E5 WRITE_LOCK_VIOLATION proc near	     ; ...
DOSCODE:77E5		     mov     ds:READOP,	1
DOSCODE:77EA		     jmp     short ERR_ON_CHECK
DOSCODE:77EA WRITE_LOCK_VIOLATION endp
DOSCODE:77EC ; =============== S U B R O U T I N E =======================================
DOSCODE:77EC DISKREAD	     proc near		     ; ...
DOSCODE:77EC ; FUNCTION	CHUNK AT DOSCODE:782C SIZE 00000002 BYTES
DOSCODE:77EC ; FUNCTION	CHUNK AT DOSCODE:7837 SIZE 0000008B BYTES
DOSCODE:77EC ; FUNCTION	CHUNK AT DOSCODE:7A4E SIZE 0000000B BYTES
DOSCODE:77EC		     mov     ax, es:[di+11h]
DOSCODE:77F0		     mov     bx, es:[di+13h]
DOSCODE:77F4		     sub     ax, ds:BYTPOS
DOSCODE:77F8		     sbb     bx, ds:BYTPOS+2
DOSCODE:77FC		     jb	     short RDERR
DOSCODE:77FE		     jnz     short ENUF
DOSCODE:7800		     or	     ax, ax
DOSCODE:7802		     jz	     short RDERR
DOSCODE:7804		     cmp     ax, cx
DOSCODE:7806		     jnb     short ENUF
DOSCODE:7808		     mov     cx, ax
DOSCODE:780A ENUF:				     ; ...
DOSCODE:780A		     call    CHECK_READ_LOCK
DOSCODE:780D		     jnb     short _READ_OK
DOSCODE:780F		     retn
DOSCODE:7810 _READ_OK:				     ; ...
DOSCODE:7810		     les     bp, ds:THISDPB
DOSCODE:7814		     call    BREAKDOWN
DOSCODE:7817		     mov     cx, ds:CLUSNUM
DOSCODE:781B		     call    FNDCLUS
DOSCODE:781E		     jb	     short SET_ACC_ERR_DS
DOSCODE:7820		     or	     cx, cx
DOSCODE:7822		     jz	     short SKIPERR
DOSCODE:7824 RDERR:				     ; ...
DOSCODE:7824		     mov     ah, 0Eh
DOSCODE:7826		     jmp     WRTERR22
DOSCODE:7826 DISKREAD	     endp ; sp-analysis	failed
DOSCODE:7829 ; =============== S U B R O U T I N E =======================================
DOSCODE:7829 ; Attributes: thunk
DOSCODE:7829 SETSFTJ2	     proc near		     ; ...
DOSCODE:7829		     jmp     SETSFT
DOSCODE:7829 SETSFTJ2	     endp
DOSCODE:782C ; START OF	FUNCTION CHUNK FOR DISKREAD
DOSCODE:782C CANOT_READ:			     ; ...
DOSCODE:782C		     pop     cx
DOSCODE:782D		     pop     bx
DOSCODE:782D ; END OF FUNCTION CHUNK FOR DISKREAD
DOSCODE:782E ; =============== S U B R O U T I N E =======================================
DOSCODE:782E SET_ACC_ERR_DS  proc near		     ; ...
DOSCODE:782E		     push    ss
DOSCODE:782F		     pop     ds
DOSCODE:782F SET_ACC_ERR_DS  endp ; sp-analysis	failed
DOSCODE:7830 ; =============== S U B R O U T I N E =======================================
DOSCODE:7830 SET_ACC_ERR     proc near		     ; ...
DOSCODE:7830		     xor     cx, cx
DOSCODE:7832		     mov     ax, 5
DOSCODE:7835		     stc
DOSCODE:7836		     retn
DOSCODE:7836 SET_ACC_ERR     endp
DOSCODE:7837 ; START OF	FUNCTION CHUNK FOR DISKREAD
DOSCODE:7837 SKIPERR:				     ; ...
DOSCODE:7837		     mov     ds:LASTPOS, dx
DOSCODE:783B		     mov     ds:CLUSNUM, bx
DOSCODE:783F		     cmp     ds:BYTCNT1, 0
DOSCODE:7844		     jz	     short RDMID
DOSCODE:7846		     call    BUFRD
DOSCODE:7849		     jb	     short SET_ACC_ERR_DS
DOSCODE:784B RDMID:				     ; ...
DOSCODE:784B		     cmp     ds:SECCNT,	0
DOSCODE:7850		     jz	     short RDLAST
DOSCODE:7852		     call    NEXTSEC
DOSCODE:7855		     jb	     short SETSFTJ2
DOSCODE:7857		     mov     ds:TRANS, 1
DOSCODE:785C		     mov     dl, ds:SECCLUSPOS
DOSCODE:7860		     mov     cx, ds:SECCNT
DOSCODE:7864		     mov     bx, ds:CLUSNUM
DOSCODE:7868 RDLP:				     ; ...
DOSCODE:7868		     call    OPTIMIZE
DOSCODE:786B		     jb	     short SET_ACC_ERR_DS
DOSCODE:786D		     push    di
DOSCODE:786E		     push    ax
DOSCODE:786F		     push    bx
DOSCODE:7870		     mov     ds:ALLOWED, 38h
DOSCODE:7875		     mov     ds, word ptr ds:DMAADD+2
DOSCODE:7879		     push    dx
DOSCODE:787A		     push    cx
DOSCODE:787B		     call    SET_RQ_SC_PARMS
DOSCODE:787E		     call    DREAD
DOSCODE:7881		     pop     cx
DOSCODE:7882		     pop     dx
DOSCODE:7883		     pop     ss:TEMP_VAR
DOSCODE:7888		     jb	     short CANOT_READ
DOSCODE:788A		     mov     ss:TEMP_VAR2, ds
DOSCODE:788F		     call    DskRdBufScan
DOSCODE:7892		     push    ss
DOSCODE:7893		     pop     ds
DOSCODE:7894		     pop     cx
DOSCODE:7895		     pop     bx
DOSCODE:7896		     jcxz    short RDLAST
DOSCODE:7898		     call    IsEOF
DOSCODE:789B		     jnb     short SETSFT
DOSCODE:789D		     mov     dl, 0
DOSCODE:789F		     inc     ds:LASTPOS
DOSCODE:78A3		     jmp     short RDLP
DOSCODE:78A5 RDLAST:				     ; ...
DOSCODE:78A5		     mov     ax, ds:BYTCNT2
DOSCODE:78A8		     or	     ax, ax
DOSCODE:78AA		     jz	     short SETSFT
DOSCODE:78AC		     mov     ds:BYTCNT1, ax
DOSCODE:78AF		     call    NEXTSEC
DOSCODE:78B2		     jb	     short SETSFT
DOSCODE:78B4		     mov     ds:BYTSECPOS, 0
DOSCODE:78BA		     call    BUFRD
DOSCODE:78BD		     jnb     short SETSFT
DOSCODE:78BF		     jmp     SET_ACC_ERR_DS
DOSCODE:78BF ; END OF FUNCTION CHUNK FOR DISKREAD
DOSCODE:78C2 ; =============== S U B R O U T I N E =======================================
DOSCODE:78C2 SETSFT	     proc near		     ; ...
DOSCODE:78C2		     les     di, ds:THISSFT
DOSCODE:78C6 SETCLUS:				     ; ...
DOSCODE:78C6		     mov     cx, ds:NEXTADD
DOSCODE:78CA		     sub     cx, word ptr ds:DMAADD
DOSCODE:78CE		     test    byte ptr es:[di+5], 80h
DOSCODE:78D3		     jnz     short ADDREC
DOSCODE:78D5		     mov     ax, ds:CLUSNUM
DOSCODE:78D8		     mov     es:[di+35h], ax
DOSCODE:78DC		     mov     ax, ds:LASTPOS
DOSCODE:78DF		     mov     es:[di+19h], ax
DOSCODE:78DF SETSFT	     endp ; sp-analysis	failed
DOSCODE:78E3 ; =============== S U B R O U T I N E =======================================
DOSCODE:78E3 ADDREC	     proc near		     ; ...
DOSCODE:78E3		     jcxz    short RET28
DOSCODE:78E5		     add     es:[di+15h], cx
DOSCODE:78E9		     adc     word ptr es:[di+17h], 0
DOSCODE:78EE RET28:				     ; ...
DOSCODE:78EE		     clc
DOSCODE:78EF		     retn
DOSCODE:78EF ADDREC	     endp
DOSCODE:78F0 ; =============== S U B R O U T I N E =======================================
DOSCODE:78F0 DskRdBufScan    proc near		     ; ...
DOSCODE:78F0		     cmp     ss:DirtyBufferCount, 0
DOSCODE:78F6		     jz	     short bufx
DOSCODE:78F8		     mov     bx, ss:HIGH_SECTOR
DOSCODE:78FD		     mov     si, bx
DOSCODE:78FF		     add     cx, dx
DOSCODE:7901		     adc     si, 0
DOSCODE:7904		     call    GETCURHEAD
DOSCODE:7907		     mov     ax, [di+2]
DOSCODE:790A		     mov     ss:FIRST_BUFF_ADDR, ax
DOSCODE:790E		     mov     al, es:[bp+0]
DOSCODE:7912 bufq:				     ; ...
DOSCODE:7912		     cmp     al, [di+4]
DOSCODE:7915		     jnz     short bufq1
DOSCODE:7917		     cmp     bx, [di+8]
DOSCODE:791A		     jnz     short bufq01
DOSCODE:791C		     cmp     dx, [di+6]
DOSCODE:791F bufq01:				     ; ...
DOSCODE:791F		     ja	     short bufq1
DOSCODE:7921		     cmp     si, [di+8]
DOSCODE:7924		     jnz     short bufq02
DOSCODE:7926		     cmp     cx, [di+6]
DOSCODE:7929 bufq02:				     ; ...
DOSCODE:7929		     ja	     short bufq2
DOSCODE:792B bufq1:				     ; ...
DOSCODE:792B		     cmp     di, ss:FIRST_BUFF_ADDR
DOSCODE:7930		     mov     di, [di]
DOSCODE:7932		     jnz     short bufq
DOSCODE:7934 bufx:				     ; ...
DOSCODE:7934		     retn
DOSCODE:7935 bufq2:				     ; ...
DOSCODE:7935		     push    ax
DOSCODE:7936		     test    byte ptr [di+5], 40h
DOSCODE:793A		     jz	     short bufq3
DOSCODE:793C		     push    cx
DOSCODE:793D		     push    dx
DOSCODE:793E		     push    si
DOSCODE:793F		     push    di
DOSCODE:7940		     push    es
DOSCODE:7941		     mov     ax, dx
DOSCODE:7943		     sub     ax, [di+6]
DOSCODE:7946		     neg     ax
DOSCODE:7948		     lea     si, [di+20]
DOSCODE:794B		     mov     cx, es:[bp+2]
DOSCODE:794F		     mul     cx
DOSCODE:7951		     mov     di, ss:TEMP_VAR
DOSCODE:7956		     add     di, ax
DOSCODE:7958		     mov     es, ss:TEMP_VAR2
DOSCODE:795D		     shr     cx, 1
DOSCODE:795F		     rep movsw
DOSCODE:7961		     adc     cx, 0
DOSCODE:7964		     rep movsb
DOSCODE:7966		     pop     es
DOSCODE:7967		     pop     di
DOSCODE:7968		     pop     si
DOSCODE:7969		     pop     dx
DOSCODE:796A		     pop     cx
DOSCODE:796B bufq3:				     ; ...
DOSCODE:796B		     mov     ax, di
DOSCODE:796D		     call    SCANPLACE
DOSCODE:7970		     cmp     ax, ss:FIRST_BUFF_ADDR
DOSCODE:7975		     pop     ax
DOSCODE:7976		     jnz     short bufq
DOSCODE:7978		     jmp     short bufx
DOSCODE:7978 DskRdBufScan    endp
DOSCODE:797A ; =============== S U B R O U T I N E =======================================
DOSCODE:797A DISKWRITE	     proc near		     ; ...
DOSCODE:797A ; FUNCTION	CHUNK AT DOSCODE:7A59 SIZE 000001B5 BYTES
DOSCODE:797A		     call    CHECK_WRITE_LOCK
DOSCODE:797D		     jnb     short _WRITE_OK
DOSCODE:797F		     retn
DOSCODE:7980 WRTEOFJ:				     ; ...
DOSCODE:7980		     jmp     WRTEOF
DOSCODE:7983 _WRITE_OK:				     ; ...
DOSCODE:7983		     and     word ptr es:[di+5], 0BFBFh
DOSCODE:7989		     mov     ax, es:[di+11h]
DOSCODE:798D		     mov     ds:TEMP_VAR, ax
DOSCODE:7990		     mov     ax, es:[di+13h]
DOSCODE:7994		     mov     ds:TEMP_VAR2, ax
DOSCODE:7997		     les     bp, ds:THISDPB
DOSCODE:799B		     call    BREAKDOWN
DOSCODE:799E		     mov     ax, ds:BYTPOS
DOSCODE:79A1		     mov     dx, ds:BYTPOS+2
DOSCODE:79A5		     jcxz    short WRTEOFJ
DOSCODE:79A7		     add     ax, cx
DOSCODE:79A9		     adc     dx, 0
DOSCODE:79AC		     mov     bx, es:[bp+2]
DOSCODE:79B0		     call    DIV32
DOSCODE:79B3		     mov     si, ax
DOSCODE:79B5		     mov     ds:HIGH_SECTOR, cx
DOSCODE:79B9		     or	     dx, dx
DOSCODE:79BB		     push    dx
DOSCODE:79BC		     mov     dx, cx
DOSCODE:79BE		     jnz     short CALCLUS
DOSCODE:79C0		     sub     ax, 1
DOSCODE:79C3		     sbb     dx, 0
DOSCODE:79C6 CALCLUS:				     ; ...
DOSCODE:79C6		     call    SHR32
DOSCODE:79C9		     pop     dx
DOSCODE:79CA		     push    ax
DOSCODE:79CB		     push    dx
DOSCODE:79CC		     mov     dx, ds:TEMP_VAR2
DOSCODE:79D0		     mov     ax, ds:TEMP_VAR
DOSCODE:79D3		     call    DIV32
DOSCODE:79D6		     mov     ds:TEMP_VAR2, cx
DOSCODE:79DA		     mov     ds:VALSEC+2, cx
DOSCODE:79DE		     mov     cx, ax
DOSCODE:79E0		     mov     bx, si
DOSCODE:79E2		     or	     dx, dx
DOSCODE:79E4		     jz	     short NORND
DOSCODE:79E6		     add     ax, 1
DOSCODE:79E9		     adc     ds:VALSEC+2, 0
DOSCODE:79EE NORND:				     ; ...
DOSCODE:79EE		     mov     ds:VALSEC,	ax
DOSCODE:79F1		     xor     ax, ax
DOSCODE:79F3		     mov     ds:GROWCNT, ax
DOSCODE:79F6		     mov     ds:GROWCNT+2, ax
DOSCODE:79F9		     pop     ax
DOSCODE:79FA		     mov     di, ds:HIGH_SECTOR
DOSCODE:79FE		     cmp     di, ds:TEMP_VAR2
DOSCODE:7A02		     jb	     short NOGROW
DOSCODE:7A04		     jz	     short lowsec
DOSCODE:7A06		     sub     bx, cx
DOSCODE:7A08		     sbb     di, ds:TEMP_VAR2
DOSCODE:7A0C		     jmp     short yesgrow
DOSCODE:7A0E lowsec:				     ; ...
DOSCODE:7A0E		     mov     di, 0
DOSCODE:7A11		     sub     bx, cx
DOSCODE:7A13		     jb	     short NOGROW
DOSCODE:7A15		     jz	     short TESTTAIL
DOSCODE:7A17 yesgrow:				     ; ...
DOSCODE:7A17		     mov     cx, dx
DOSCODE:7A19		     xchg    ax, bx
DOSCODE:7A1A		     mul     word ptr es:[bp+2]
DOSCODE:7A1E		     mov     ds:HIGH_SECTOR, dx
DOSCODE:7A22		     mov     ds:TEMP_VAR2, ax
DOSCODE:7A25		     mov     ax, di
DOSCODE:7A27		     mul     word ptr es:[bp+2]
DOSCODE:7A2B		     add     ax, ds:HIGH_SECTOR
DOSCODE:7A2F		     mov     dx, ax
DOSCODE:7A31		     mov     ax, ds:TEMP_VAR2
DOSCODE:7A34		     sub     ax, cx
DOSCODE:7A36		     sbb     dx, 0
DOSCODE:7A39		     add     ax, bx
DOSCODE:7A3B		     adc     dx, 0
DOSCODE:7A3E		     jmp     short SETGRW
DOSCODE:7A40 HAVSTART:				     ; ...
DOSCODE:7A40		     mov     cx, ax
DOSCODE:7A42		     call    SKPCLP
DOSCODE:7A45		     jcxz    short DOWRTJ
DOSCODE:7A47		     call    ALLOCATE
DOSCODE:7A4A		     jnb     short DOWRTJ
DOSCODE:7A4C WRTERR:				     ; ...
DOSCODE:7A4C		     mov     ah, 0Fh
DOSCODE:7A4C DISKWRITE	     endp ; sp-analysis	failed
DOSCODE:7A4E ; START OF	FUNCTION CHUNK FOR DISKREAD
DOSCODE:7A4E WRTERR22:				     ; ...
DOSCODE:7A4E		     mov     al, ds:THISDRV
DOSCODE:7A51		     xor     cx, cx
DOSCODE:7A53		     les     di, ds:THISSFT
DOSCODE:7A57		     clc
DOSCODE:7A58		     retn
DOSCODE:7A58 ; END OF FUNCTION CHUNK FOR DISKREAD
DOSCODE:7A59 ; START OF	FUNCTION CHUNK FOR DISKWRITE
DOSCODE:7A59 DOWRTJ:				     ; ...
DOSCODE:7A59		     jmp     short DOWRT
DOSCODE:7A5B ACC_ERRWJ:				     ; ...
DOSCODE:7A5B		     jmp     SET_ACC_ERRW
DOSCODE:7A5E TESTTAIL:				     ; ...
DOSCODE:7A5E		     sub     ax, dx
DOSCODE:7A60		     jbe     short NOGROW
DOSCODE:7A62		     xor     dx, dx
DOSCODE:7A64 SETGRW:				     ; ...
DOSCODE:7A64		     mov     ds:GROWCNT, ax
DOSCODE:7A67		     mov     ds:GROWCNT+2, dx
DOSCODE:7A6B NOGROW:				     ; ...
DOSCODE:7A6B		     pop     ax
DOSCODE:7A6C		     mov     cx, ds:CLUSNUM
DOSCODE:7A70		     call    FNDCLUS
DOSCODE:7A73		     jb	     short ACC_ERRWJ
DOSCODE:7A75		     mov     ds:CLUSNUM, bx
DOSCODE:7A79		     mov     ds:LASTPOS, dx
DOSCODE:7A7D		     sub     ax, dx
DOSCODE:7A7F		     jz	     short DOWRT
DOSCODE:7A81		     jcxz    short HAVSTART
DOSCODE:7A83		     push    cx
DOSCODE:7A84		     mov     cx, ax
DOSCODE:7A86		     call    ALLOCATE
DOSCODE:7A89		     pop     cx
DOSCODE:7A8A		     jb	     short WRTERR
DOSCODE:7A8C		     mov     dx, ds:LASTPOS
DOSCODE:7A90		     inc     dx
DOSCODE:7A91		     dec     cx
DOSCODE:7A92		     jz	     short NOSKIP
DOSCODE:7A94		     call    SKPCLP
DOSCODE:7A97		     jb	     short ACC_ERRWJ
DOSCODE:7A99 NOSKIP:				     ; ...
DOSCODE:7A99		     mov     ds:CLUSNUM, bx
DOSCODE:7A9D		     mov     ds:LASTPOS, dx
DOSCODE:7AA1 DOWRT:				     ; ...
DOSCODE:7AA1		     cmp     ds:BYTCNT1, 0
DOSCODE:7AA6		     jz	     short WRTMID
DOSCODE:7AA8		     mov     bx, ds:CLUSNUM
DOSCODE:7AAC		     call    BUFWRT
DOSCODE:7AAF		     jb	     short ACC_ERRWJ
DOSCODE:7AB1 WRTMID:				     ; ...
DOSCODE:7AB1		     mov     ax, ds:SECCNT
DOSCODE:7AB4		     or	     ax, ax
DOSCODE:7AB6		     jz	     short WRTLAST
DOSCODE:7AB8		     add     ds:SECPOS,	ax
DOSCODE:7ABC		     adc     ds:SECPOS+2, 0
DOSCODE:7AC1		     call    NEXTSEC
DOSCODE:7AC4		     jb	     short SET_ACC_ERRW
DOSCODE:7AC6		     mov     ds:TRANS, 1
DOSCODE:7ACB		     mov     dl, ds:SECCLUSPOS
DOSCODE:7ACF		     mov     bx, ds:CLUSNUM
DOSCODE:7AD3		     mov     cx, ds:SECCNT
DOSCODE:7AD7 WRTLP:				     ; ...
DOSCODE:7AD7		     call    OPTIMIZE
DOSCODE:7ADA		     jb	     short SET_ACC_ERRW
DOSCODE:7ADC		     push    di
DOSCODE:7ADD		     push    ax
DOSCODE:7ADE		     call    DskWrtBufPurge
DOSCODE:7AE1		     mov     ds, word ptr ss:DMAADD+2
DOSCODE:7AE6		     mov     ss:ALLOWED, 38h
DOSCODE:7AEC DWRITE_LUP:			     ; ...
DOSCODE:7AEC		     call    DSKWRITE
DOSCODE:7AEF		     jz	     short DWRITE_OKAY
DOSCODE:7AF1		     cmp     al, 27h
DOSCODE:7AF3		     jz	     short DWRITE_DISK_FULL
DOSCODE:7AF5		     mov     ss:READOP,	1
DOSCODE:7AFB		     call    HARDERRRW
DOSCODE:7AFE		     cmp     al, 1
DOSCODE:7B00		     jz	     short DWRITE_LUP
DOSCODE:7B02		     cmp     al, 3
DOSCODE:7B04		     clc
DOSCODE:7B05		     jnz     short DWRITE_OKAY
DOSCODE:7B07		     stc
DOSCODE:7B08 DWRITE_OKAY:			     ; ...
DOSCODE:7B08		     pop     cx
DOSCODE:7B09		     pop     bx
DOSCODE:7B0A		     push    ss
DOSCODE:7B0B		     pop     ds
DOSCODE:7B0C		     jb	     short SET_ACC_ERRW
DOSCODE:7B0E		     jcxz    short WRTLAST
DOSCODE:7B10		     mov     dl, 0
DOSCODE:7B12		     inc     ds:LASTPOS
DOSCODE:7B16		     jmp     short WRTLP
DOSCODE:7B18 DWRITE_DISK_FULL:			     ; ...
DOSCODE:7B18		     push    ss
DOSCODE:7B19		     pop     ds
DOSCODE:7B1A		     pop     cx
DOSCODE:7B1B		     pop     bx
DOSCODE:7B1C		     mov     ds:DISK_FULL, 1
DOSCODE:7B21		     stc
DOSCODE:7B22		     jmp     WRTERR
DOSCODE:7B25 SET_ACC_ERRW:			     ; ...
DOSCODE:7B25		     jmp     SET_ACC_ERR_DS
DOSCODE:7B28 WRTLAST:				     ; ...
DOSCODE:7B28		     mov     ax, ds:BYTCNT2
DOSCODE:7B2B		     or	     ax, ax
DOSCODE:7B2D		     jz	     short FINWRT
DOSCODE:7B2F		     mov     ds:BYTCNT1, ax
DOSCODE:7B32		     call    NEXTSEC
DOSCODE:7B35		     jb	     short SET_ACC_ERRW
DOSCODE:7B37		     mov     ds:BYTSECPOS, 0
DOSCODE:7B3D		     call    BUFWRT
DOSCODE:7B40		     jb	     short SET_ACC_ERRW
DOSCODE:7B42 FINWRT:				     ; ...
DOSCODE:7B42		     les     di, ds:THISSFT
DOSCODE:7B46		     mov     ax, ds:GROWCNT
DOSCODE:7B49		     mov     cx, ds:GROWCNT+2
DOSCODE:7B4D		     or	     ax, ax
DOSCODE:7B4F		     jnz     short UPDATE_size
DOSCODE:7B51		     jcxz    short SAMSIZ
DOSCODE:7B53 UPDATE_size:			     ; ...
DOSCODE:7B53		     add     es:[di+11h], ax
DOSCODE:7B57		     adc     es:[di+13h], cx
DOSCODE:7B5B		     mov     ax, 1
DOSCODE:7B5E		     call    ds:ShSU
DOSCODE:7B62 SAMSIZ:				     ; ...
DOSCODE:7B62		     jmp     SETCLUS
DOSCODE:7B65 WRTEOF:				     ; ...
DOSCODE:7B65		     mov     cx, ax
DOSCODE:7B67		     or	     cx, dx
DOSCODE:7B69		     jz	     short KILLFIL
DOSCODE:7B6B		     sub     ax, 1
DOSCODE:7B6E		     sbb     dx, 0
DOSCODE:7B71		     push    bx
DOSCODE:7B72		     mov     bx, es:[bp+2]
DOSCODE:7B76		     call    DIV32
DOSCODE:7B79		     pop     bx
DOSCODE:7B7A		     mov     dx, cx
DOSCODE:7B7C		     mov     ds:HIGH_SECTOR, cx
DOSCODE:7B80		     call    SHR32
DOSCODE:7B83		     mov     cx, ax
DOSCODE:7B85		     call    FNDCLUS
DOSCODE:7B88 SET_ACC_ERRWJ2:			     ; ...
DOSCODE:7B88		     jb	     short SET_ACC_ERRW
DOSCODE:7B8A		     jcxz    short RELFILE
DOSCODE:7B8C		     call    ALLOCATE
DOSCODE:7B8F		     jb	     short WRTERRJ
DOSCODE:7B91 UPDATE:				     ; ...
DOSCODE:7B91		     les     di, ds:THISSFT
DOSCODE:7B95		     mov     ax, ds:BYTPOS
DOSCODE:7B98		     mov     es:[di+11h], ax
DOSCODE:7B9C		     mov     ax, ds:BYTPOS+2
DOSCODE:7B9F		     mov     es:[di+13h], ax
DOSCODE:7BA3		     mov     ax, 2
DOSCODE:7BA6		     call    ds:ShSU
DOSCODE:7BAA		     xor     cx, cx
DOSCODE:7BAC		     jmp     ADDREC
DOSCODE:7BAF WRTERRJ:				     ; ...
DOSCODE:7BAF		     jmp     WRTERR
DOSCODE:7BB2 RELFILE:				     ; ...
DOSCODE:7BB2		     push    es
DOSCODE:7BB3		     les     di, ds:THISSFT
DOSCODE:7BB7		     cmp     dx, es:[di+19h]
DOSCODE:7BBB		     jnb     short SKIPRESET
DOSCODE:7BBD		     mov     word ptr es:[di+19h], 0
DOSCODE:7BC3		     mov     dx, es:[di+0Bh]
DOSCODE:7BC7		     mov     es:[di+35h], dx
DOSCODE:7BCB SKIPRESET:				     ; ...
DOSCODE:7BCB		     pop     es
DOSCODE:7BCC		     mov     dx, 0FFFFh
DOSCODE:7BCF		     call    RELBLKS
DOSCODE:7BD2 SET_ACC_ERRWJJ:			     ; ...
DOSCODE:7BD2		     jb	     short SET_ACC_ERRWJ2
DOSCODE:7BD4		     jmp     short UPDATE
DOSCODE:7BD6 KILLFIL:				     ; ...
DOSCODE:7BD6		     xor     bx, bx
DOSCODE:7BD8		     push    es
DOSCODE:7BD9		     les     di, ds:THISSFT
DOSCODE:7BDD		     mov     es:[di+19h], bx
DOSCODE:7BE1		     mov     es:[di+35h], bx
DOSCODE:7BE5		     xchg    bx, es:[di+0Bh]
DOSCODE:7BE9		     pop     es
DOSCODE:7BEA		     or	     bx, bx
DOSCODE:7BEC		     jz	     short UPDATEJ
DOSCODE:7BEE		     push    es
DOSCODE:7BEF		     push    bp
DOSCODE:7BF0		     push    ax
DOSCODE:7BF1		     push    cx
DOSCODE:7BF2		     push    dx
DOSCODE:7BF3		     les     bp, ds:THISDPB
DOSCODE:7BF7		     mov     dl, es:[bp+0]
DOSCODE:7BFB		     mov     cx, bx
DOSCODE:7BFD		     mov     ah, 2
DOSCODE:7BFF		     call    FastOpen_Update
DOSCODE:7C02		     pop     dx
DOSCODE:7C03		     pop     cx
DOSCODE:7C04		     pop     ax
DOSCODE:7C05		     pop     bp
DOSCODE:7C06		     pop     es
DOSCODE:7C07		     call    RELEASE
DOSCODE:7C0A		     jb	     short SET_ACC_ERRWJJ
DOSCODE:7C0C UPDATEJ:				     ; ...
DOSCODE:7C0C		     jmp     short UPDATE
DOSCODE:7C0C ; END OF FUNCTION CHUNK FOR DISKWRITE
DOSCODE:7C0E ; =============== S U B R O U T I N E =======================================
DOSCODE:7C0E DskWrtBufPurge  proc near		     ; ...
DOSCODE:7C0E		     push    bx
DOSCODE:7C0F		     push    cx
DOSCODE:7C10		     mov     bx, ss:HIGH_SECTOR
DOSCODE:7C15		     mov     si, bx
DOSCODE:7C17		     add     cx, dx
DOSCODE:7C19		     adc     si, 0
DOSCODE:7C1C		     mov     al, es:[bp+0]
DOSCODE:7C20		     cmp     ss:SC_CACHE_COUNT,	0
DOSCODE:7C26		     jz	     short nosc
DOSCODE:7C28		     cmp     al, ss:CurSC_DRIVE
DOSCODE:7C2D		     jnz     short nosc
DOSCODE:7C2F		     push    ax
DOSCODE:7C30		     mov     ax, ss:CurSC_SECTOR
DOSCODE:7C34		     mov     di, ss:CurSC_SECTOR+2
DOSCODE:7C39		     cmp     si, di
DOSCODE:7C3B		     jnz     short sc01
DOSCODE:7C3D		     cmp     cx, ax
DOSCODE:7C3F sc01:				     ; ...
DOSCODE:7C3F		     jbe     short sc5
DOSCODE:7C41		     add     ax, ss:SC_CACHE_COUNT
DOSCODE:7C46		     adc     di, 0
DOSCODE:7C49		     cmp     bx, di
DOSCODE:7C4B		     jnz     short sc02
DOSCODE:7C4D		     cmp     dx, ax
DOSCODE:7C4F sc02:				     ; ...
DOSCODE:7C4F		     jnb     short sc5
DOSCODE:7C51		     mov     ss:SC_STATUS, 0
DOSCODE:7C58 sc5:				     ; ...
DOSCODE:7C58		     pop     ax
DOSCODE:7C59 nosc:				     ; ...
DOSCODE:7C59		     call    GETCURHEAD
DOSCODE:7C5C _bufq:				     ; ...
DOSCODE:7C5C		     cmp     al, [di+4]
DOSCODE:7C5F		     jnz     short bufq5
DOSCODE:7C61		     cmp     bx, [di+8]
DOSCODE:7C64		     jnz     short bufq04
DOSCODE:7C66		     cmp     dx, [di+6]
DOSCODE:7C69 bufq04:				     ; ...
DOSCODE:7C69		     ja	     short bufq5
DOSCODE:7C6B		     cmp     si, [di+8]
DOSCODE:7C6E		     jnz     short bufq05
DOSCODE:7C70		     cmp     cx, [di+6]
DOSCODE:7C73 bufq05:				     ; ...
DOSCODE:7C73		     jbe     short bufq5
DOSCODE:7C75		     test    byte ptr [di+5], 40h
DOSCODE:7C79		     jz	     short bufq4
DOSCODE:7C7B		     call    DEC_DIRTY_COUNT
DOSCODE:7C7E bufq4:				     ; ...
DOSCODE:7C7E		     mov     word ptr [di+4], 20FFh
DOSCODE:7C83		     call    SCANPLACE
DOSCODE:7C86		     jmp     short bufq6
DOSCODE:7C88 bufq5:				     ; ...
DOSCODE:7C88		     mov     di, [di]
DOSCODE:7C8A bufq6:				     ; ...
DOSCODE:7C8A		     cmp     di, ss:FIRST_BUFF_ADDR
DOSCODE:7C8F		     jnz     short _bufq
DOSCODE:7C91		     pop     cx
DOSCODE:7C92		     pop     bx
DOSCODE:7C93		     retn
DOSCODE:7C93 DskWrtBufPurge  endp
DOSCODE:7C94 ; =============== S U B R O U T I N E =======================================
DOSCODE:7C94 DIV32	     proc near		     ; ...
DOSCODE:7C94		     cmp     bx, 512
DOSCODE:7C98		     jnz     short div5
DOSCODE:7C9A		     mov     cx, dx
DOSCODE:7C9C		     mov     dx, ax
DOSCODE:7C9E		     and     dx, 511
DOSCODE:7CA2		     mov     al, ah
DOSCODE:7CA4		     mov     ah, cl
DOSCODE:7CA6		     mov     cl, ch
DOSCODE:7CA8		     xor     ch, ch
DOSCODE:7CAA		     shr     cx, 1
DOSCODE:7CAC		     rcr     ax, 1
DOSCODE:7CAE		     retn
DOSCODE:7CAF div5:				     ; ...
DOSCODE:7CAF		     mov     cx, ax
DOSCODE:7CB1		     mov     ax, dx
DOSCODE:7CB3		     xor     dx, dx
DOSCODE:7CB5		     div     bx
DOSCODE:7CB7		     xchg    ax, cx
DOSCODE:7CB8		     div     bx
DOSCODE:7CBA		     retn
DOSCODE:7CBA DIV32	     endp
DOSCODE:7CBB ; =============== S U B R O U T I N E =======================================
DOSCODE:7CBB SHR32	     proc near		     ; ...
DOSCODE:7CBB		     mov     cl, es:[bp+5]
DOSCODE:7CBF		     xor     ch, ch
DOSCODE:7CC1		     jcxz    short norota
DOSCODE:7CC3 rotashft2:				     ; ...
DOSCODE:7CC3		     shr     dx, 1
DOSCODE:7CC5		     rcr     ax, 1
DOSCODE:7CC7		     loop    rotashft2
DOSCODE:7CC9 norota:				     ; ...
DOSCODE:7CC9		     retn
DOSCODE:7CC9 SHR32	     endp
DOSCODE:7CCA ; =============== S U B R O U T I N E =======================================
DOSCODE:7CCA SEARCH	     proc near		     ; ...
DOSCODE:7CCA		     call    STARTSRCH
DOSCODE:7CCD		     mov     al, ds:ATTRIB
DOSCODE:7CD0		     and     al, 9Eh
DOSCODE:7CD2		     cmp     al, 8
DOSCODE:7CD4		     jnz     short NOTVOLSRCH
DOSCODE:7CD6		     call    SETROOTSRCH
DOSCODE:7CD9 NOTVOLSRCH:			     ; ...
DOSCODE:7CD9		     call    GETENTRY
DOSCODE:7CDC		     jnb     short SRCH
DOSCODE:7CDE		     jmp     SETESRET
DOSCODE:7CE1 SRCH:				     ; ...
DOSCODE:7CE1		     push    ds
DOSCODE:7CE2		     mov     ds, word ptr ds:CURBUF+2
DOSCODE:7CE6		     mov     ah, [bx]
DOSCODE:7CE8		     or	     ah, ah
DOSCODE:7CEA		     jz	     short FREE
DOSCODE:7CEC		     cmp     ah, ss:DELALL
DOSCODE:7CF1		     jz	     short FREE
DOSCODE:7CF3		     test    byte ptr [bx+0Bh],	8
DOSCODE:7CF7		     jz	     short CHKFNAM
DOSCODE:7CF9		     inc     ss:VOLID
DOSCODE:7CFE CHKFNAM:				     ; ...
DOSCODE:7CFE		     mov     si, ss
DOSCODE:7D00		     mov     es, si
DOSCODE:7D02		     mov     si, bx
DOSCODE:7D04		     mov     di, offset	NAME1
DOSCODE:7D07		     cmp     ss:NAME1, 0E5h
DOSCODE:7D0D		     jnz     short NO_E5
DOSCODE:7D0F		     mov     ss:NAME1, 5
DOSCODE:7D15 NO_E5:				     ; ...
DOSCODE:7D15		     call    MetaCompare
DOSCODE:7D18		     jz	     short FOUND
DOSCODE:7D1A		     pop     ds
DOSCODE:7D1B NEXTENT:				     ; ...
DOSCODE:7D1B		     les     bp, ds:THISDPB
DOSCODE:7D1F		     call    NEXTENTRY
DOSCODE:7D22		     jnb     short SRCH
DOSCODE:7D24		     jmp     short SETESRET
DOSCODE:7D26 FREE:				     ; ...
DOSCODE:7D26		     pop     ds
DOSCODE:7D27		     mov     cx, ds:LASTENT
DOSCODE:7D2B		     cmp     cx, ds:ENTFREE
DOSCODE:7D2F		     jnb     short TSTALL
DOSCODE:7D31		     mov     ds:ENTFREE, cx
DOSCODE:7D35 TSTALL:				     ; ...
DOSCODE:7D35		     cmp     ah, ds:DELALL
DOSCODE:7D39 NEXTENTJ:				     ; ...
DOSCODE:7D39		     jz	     short NEXTENT
DOSCODE:7D3B		     mov     ds:ENTLAST, cx
DOSCODE:7D3F		     stc
DOSCODE:7D40		     jmp     short SETESRET
DOSCODE:7D42 FOUND:				     ; ...
DOSCODE:7D42		     mov     ch, [si]
DOSCODE:7D44		     pop     ds
DOSCODE:7D45		     mov     ah, ds:ATTRIB
DOSCODE:7D49		     and     ah, 9Eh
DOSCODE:7D4C		     lea     si, [si+0Fh]
DOSCODE:7D4F		     test    ch, 8
DOSCODE:7D52		     jz	     short check_one_volume_id
DOSCODE:7D54		     test    ah, 8
DOSCODE:7D57		     jz	     short NEXTENTJ
DOSCODE:7D59		     xor     ah, ah
DOSCODE:7D5B		     jmp     short RETFF
DOSCODE:7D5D check_one_volume_id:		     ; ...
DOSCODE:7D5D		     cmp     ah, 8
DOSCODE:7D60		     jz	     short NEXTENTJ
DOSCODE:7D62		     call    MatchAttributes
DOSCODE:7D65		     jz	     short RETFF
DOSCODE:7D67		     test    ds:CREATING, 0FFh
DOSCODE:7D6C		     jz	     short NEXTENTJ
DOSCODE:7D6E RETFF:				     ; ...
DOSCODE:7D6E		     les     bp, ds:THISDPB
DOSCODE:7D72		     mov     ah, es:[bp+0]
DOSCODE:7D76 SETESRET:				     ; ...
DOSCODE:7D76		     push    ss
DOSCODE:7D77		     pop     es
DOSCODE:7D78		     retn
DOSCODE:7D78 SEARCH	     endp
DOSCODE:7D79 ; =============== S U B R O U T I N E =======================================
DOSCODE:7D79 MetaCompare     proc near		     ; ...
DOSCODE:7D79		     mov     cx, 11
DOSCODE:7D7C WILDCRD:				     ; ...
DOSCODE:7D7C		     repe cmpsb
DOSCODE:7D7E		     jz	     short MetaRet
DOSCODE:7D80		     cmp     byte ptr es:[di-1], '?'
DOSCODE:7D85		     jz	     short WILDCRD
DOSCODE:7D87 MetaRet:				     ; ...
DOSCODE:7D87		     retn
DOSCODE:7D87 MetaCompare     endp
DOSCODE:7D88 ; =============== S U B R O U T I N E =======================================
DOSCODE:7D88 NEXTENTRY	     proc near		     ; ...
DOSCODE:7D88		     mov     ax, ds:LASTENT
DOSCODE:7D8B		     cmp     ax, ds:ENTLAST
DOSCODE:7D8F		     jz	     short NONE
DOSCODE:7D91		     inc     ax
DOSCODE:7D92		     lea     bx, [bx+32]
DOSCODE:7D95		     cmp     bx, dx
DOSCODE:7D97		     jnz     short HAVIT
DOSCODE:7D99		     mov     bl, ds:SECCLUSPOS
DOSCODE:7D9D		     inc     bl
DOSCODE:7D9F		     cmp     bl, ds:CLUSFAC
DOSCODE:7DA3		     jb	     short SAMECLUS
DOSCODE:7DA5		     mov     bx, ds:NXTCLUSNUM
DOSCODE:7DA9		     call    IsEOF
DOSCODE:7DAC		     jnb     short NONE
DOSCODE:7DAE		     cmp     bx, 2
DOSCODE:7DB1		     jb	     short NONE
DOSCODE:7DB3		     jmp     short GETENT
DOSCODE:7DB5 NONE:				     ; ...
DOSCODE:7DB5		     stc
DOSCODE:7DB6		     retn
DOSCODE:7DB7 HAVIT:				     ; ...
DOSCODE:7DB7		     mov     ds:LASTENT, ax
DOSCODE:7DBA		     clc
DOSCODE:7DBB nextentry_retn:			     ; ...
DOSCODE:7DBB		     retn
DOSCODE:7DBC SAMECLUS:				     ; ...
DOSCODE:7DBC		     mov     ds:SECCLUSPOS, bl
DOSCODE:7DC0		     mov     ds:LASTENT, ax
DOSCODE:7DC3		     push    ds
DOSCODE:7DC4		     lds     di, ds:CURBUF
DOSCODE:7DC8		     mov     dx, [di+8]
DOSCODE:7DCB		     mov     ss:HIGH_SECTOR, dx
DOSCODE:7DD0		     mov     dx, [di+6]
DOSCODE:7DD3		     add     dx, 1
DOSCODE:7DD6		     adc     ss:HIGH_SECTOR, 0
DOSCODE:7DDC		     pop     ds
DOSCODE:7DDD		     call    FIRSTCLUSTER
DOSCODE:7DE0		     xor     bx, bx
DOSCODE:7DE2		     jmp     short SETENTRY
DOSCODE:7DE2 NEXTENTRY	     endp
DOSCODE:7DE4 ; =============== S U B R O U T I N E =======================================
DOSCODE:7DE4 GETENTRY	     proc near		     ; ...
DOSCODE:7DE4		     mov     ax, ds:LASTENT
DOSCODE:7DE7 GETENT:				     ; ...
DOSCODE:7DE7		     mov     ds:LASTENT, ax
DOSCODE:7DEA		     mov     cl, 5
DOSCODE:7DEC		     rol     ax, cl
DOSCODE:7DEE		     mov     dx, ax
DOSCODE:7DF0		     and     ax, 0FFE0h
DOSCODE:7DF3		     and     dx, 1Fh
DOSCODE:7DF6		     mov     bx, es:[bp+2]
DOSCODE:7DFA		     and     bl, 0E0h	     ; 255-31
DOSCODE:7DFD		     div     bx
DOSCODE:7DFF		     mov     bx, dx
DOSCODE:7E01		     push    bx
DOSCODE:7E02		     call    DIRREAD
DOSCODE:7E05		     pop     bx
DOSCODE:7E06		     jb	     short nextentry_retn
DOSCODE:7E08 SETENTRY:				     ; ...
DOSCODE:7E08		     mov     dx, word ptr ds:CURBUF
DOSCODE:7E0C		     add     dx, 20
DOSCODE:7E0F		     add     bx, dx
DOSCODE:7E11		     add     dx, es:[bp+2]
DOSCODE:7E15		     clc
DOSCODE:7E16		     retn
DOSCODE:7E16 GETENTRY	     endp
DOSCODE:7E17 ; =============== S U B R O U T I N E =======================================
DOSCODE:7E17 SETDIRSRCH	     proc near		     ; ...
DOSCODE:7E17		     or	     bx, bx
DOSCODE:7E19		     jz	     short SETROOTSRCH
DOSCODE:7E1B		     mov     ds:DIRSTART, bx
DOSCODE:7E1F		     mov     al, es:[bp+4]
DOSCODE:7E23		     inc     al
DOSCODE:7E25		     mov     ds:CLUSFAC, al
DOSCODE:7E28		     push    si
DOSCODE:7E29		     test    ds:FastOpenFlg, 2
DOSCODE:7E2E		     jnz     short UNP_OK
DOSCODE:7E30		     call    UNPACK
DOSCODE:7E33		     jnb     short UNP_OK
DOSCODE:7E35		     pop     si
DOSCODE:7E36		     retn
DOSCODE:7E37 UNP_OK:				     ; ...
DOSCODE:7E37		     mov     ds:CLUSNUM, di
DOSCODE:7E3B		     mov     dx, bx
DOSCODE:7E3D		     xor     bl, bl
DOSCODE:7E3F		     mov     ds:SECCLUSPOS, bl
DOSCODE:7E43		     call    FIGREC
DOSCODE:7E46		     pop     si
DOSCODE:7E47		     push    dx
DOSCODE:7E48		     mov     dx, ds:HIGH_SECTOR
DOSCODE:7E4C		     mov     ds:DIRSEC+2, dx
DOSCODE:7E50		     pop     dx
DOSCODE:7E51		     mov     ds:DIRSEC,	dx
DOSCODE:7E55		     clc
DOSCODE:7E56		     retn
DOSCODE:7E56 SETDIRSRCH	     endp
DOSCODE:7E57 ; =============== S U B R O U T I N E =======================================
DOSCODE:7E57 SETROOTSRCH     proc near		     ; ...
DOSCODE:7E57		     xor     ax, ax
DOSCODE:7E59		     mov     ds:DIRSTART, ax
DOSCODE:7E5C		     mov     ds:SECCLUSPOS, al
DOSCODE:7E5F		     dec     ax
DOSCODE:7E60		     mov     ds:CLUSNUM, ax
DOSCODE:7E63		     mov     ax, es:[bp+0Bh]
DOSCODE:7E67		     mov     dx, es:[bp+11h]
DOSCODE:7E6B		     sub     ax, dx
DOSCODE:7E6D		     mov     ds:CLUSFAC, al
DOSCODE:7E70		     mov     ds:DIRSEC,	dx
DOSCODE:7E74		     mov     ds:DIRSEC+2, 0
DOSCODE:7E7A		     clc
DOSCODE:7E7B		     retn
DOSCODE:7E7B SETROOTSRCH     endp
DOSCODE:7E7C ; =============== S U B R O U T I N E =======================================
DOSCODE:7E7C GETPATH	     proc near		     ; ...
DOSCODE:7E7C ; FUNCTION	CHUNK AT DOSCODE:7F82 SIZE 000001A5 BYTES
DOSCODE:7E7C		     mov     word ptr ds:CREATING, 0E500h
DOSCODE:7E82 GetPathNoSet:			     ; ...
DOSCODE:7E82		     mov     ds:EXTERR_LOCUS, 2
DOSCODE:7E87		     mov     word ptr ds:CURBUF, 0FFFFh
DOSCODE:7E8D		     mov     di, ds:WFP_START
DOSCODE:7E91		     cmp     word ptr [di+1], '\:' ; ':\'
DOSCODE:7E96		     jz	     short CrackIt
DOSCODE:7E98		     add     di, 3
DOSCODE:7E9B		     mov     si, di
DOSCODE:7E9D		     call    CHKDEV
DOSCODE:7EA0		     jb	     short InternalError
DOSCODE:7EA2 Build_devJ:			     ; ...
DOSCODE:7EA2		     mov     al, ds:SATTRIB
DOSCODE:7EA5		     mov     ds:ATTRIB,	al
DOSCODE:7EA8		     mov     ds:EXTERR_LOCUS, 1
DOSCODE:7EAD		     push    ss
DOSCODE:7EAE		     pop     es
DOSCODE:7EAF		     mov     si, offset	NAME1
DOSCODE:7EB2		     mov     di, ds:WFP_START
DOSCODE:7EB6		     mov     dx, di
DOSCODE:7EB8		     mov     cx, 8
DOSCODE:7EBB MoveLoop:				     ; ...
DOSCODE:7EBB		     lodsb
DOSCODE:7EBC		     stosb
DOSCODE:7EBD		     cmp     al, 20h ; ' '
DOSCODE:7EBF		     jz	     short NoSave
DOSCODE:7EC1		     mov     dx, di
DOSCODE:7EC3 NoSave:				     ; ...
DOSCODE:7EC3		     loop    MoveLoop
DOSCODE:7EC5		     mov     di, dx
DOSCODE:7EC7		     mov     byte ptr [di], 0
DOSCODE:7ECA		     call    Build_device_ent
DOSCODE:7ECD		     inc     al
DOSCODE:7ECF		     retn
DOSCODE:7ED0 InternalError:			     ; ...
DOSCODE:7ED0		     jmp     short InternalError
DOSCODE:7ED2 CrackIt:				     ; ...
DOSCODE:7ED2		     mov     si, ds:CURR_DIR_END
DOSCODE:7ED6		     cmp     si, 0FFFFh
DOSCODE:7ED9		     jnz     short LOOK_SING
DOSCODE:7EDB		     lea     si, [di+3]
DOSCODE:7EDE LOOK_SING:				     ; ...
DOSCODE:7EDE		     mov     ds:ATTRIB,	16h
DOSCODE:7EE3		     les     di, ds:THISCDS
DOSCODE:7EE7		     mov     ax, 0FFFFh
DOSCODE:7EEA		     mov     bx, es:[di+73]
DOSCODE:7EEE		     mov     si, ds:CURR_DIR_END
DOSCODE:7EF2		     cmp     si, ax
DOSCODE:7EF4		     jz	     short NO_CURR_D
DOSCODE:7EF6		     cmp     bx, ax
DOSCODE:7EF8		     jz	     short NO_CURR_D
DOSCODE:7EFA		     test    ds:FastOpenFlg, 1
DOSCODE:7EFF		     jz	     short GOT_SEARCH_CLUSTER
DOSCODE:7F01		     push    es
DOSCODE:7F02		     push    di
DOSCODE:7F03		     push    cx
DOSCODE:7F04		     push    word ptr [si-1]
DOSCODE:7F07		     push    si
DOSCODE:7F08		     push    bx
DOSCODE:7F09		     mov     byte ptr [si-1], 0
DOSCODE:7F0D		     mov     si, ds:WFP_START
DOSCODE:7F11		     mov     bx, offset	FastOpenTable
DOSCODE:7F14		     mov     di, offset	Dir_Info_Buff
DOSCODE:7F17		     mov     cx, offset	FastOpen_Ext_Info
DOSCODE:7F1A		     mov     al, 1
DOSCODE:7F1C		     push    ds
DOSCODE:7F1D		     pop     es
DOSCODE:7F1E		     call    dword ptr [bx+2]
DOSCODE:7F21		     jb	     short GO_Chk_end1
DOSCODE:7F23		     cmp     byte ptr [si], 0
DOSCODE:7F26		     jz	     short GO_Chk_end
DOSCODE:7F28		     stc
DOSCODE:7F29		     jmp     short GO_Chk_end
DOSCODE:7F2B GO_Chk_end1:			     ; ...
DOSCODE:7F2B		     clc
DOSCODE:7F2C GO_Chk_end:			     ; ...
DOSCODE:7F2C		     pop     bx
DOSCODE:7F2D		     pop     si
DOSCODE:7F2E		     pop     word ptr [si-1]
DOSCODE:7F31		     pop     cx
DOSCODE:7F32		     pop     di
DOSCODE:7F33		     pop     es
DOSCODE:7F34		     jnb     short GOT_SEARCH_CLUSTER
DOSCODE:7F36 NO_CURR_D:				     ; ...
DOSCODE:7F36		     mov     si, ds:WFP_START
DOSCODE:7F3A		     lea     si, [si+3]
DOSCODE:7F3D		     les     bp, ds:THISDPB
DOSCODE:7F41		     jmp     short ROOTPATH
DOSCODE:7F43 GOT_SEARCH_CLUSTER:		     ; ...
DOSCODE:7F43		     les     bp, ds:THISDPB
DOSCODE:7F47		     call    SETDIRSRCH
DOSCODE:7F4A		     jb	     short SETFERR
DOSCODE:7F4C		     jmp     short FINDPATH
DOSCODE:7F4E SETFERR:				     ; ...
DOSCODE:7F4E		     xor     cl, cl
DOSCODE:7F50		     stc
DOSCODE:7F51		     retn
DOSCODE:7F51 GETPATH	     endp
DOSCODE:7F52 ; =============== S U B R O U T I N E =======================================
DOSCODE:7F52 CHKDEV	     proc near		     ; ...
DOSCODE:7F52		     mov     si, di
DOSCODE:7F54		     mov     di, ss
DOSCODE:7F56		     mov     es, di
DOSCODE:7F58		     mov     di, offset	NAME1
DOSCODE:7F5B		     mov     cx, 9
DOSCODE:7F5E TESTLOOP:				     ; ...
DOSCODE:7F5E		     call    GETLET
DOSCODE:7F61		     cmp     al, 2Eh ; '.'
DOSCODE:7F63		     jz	     short TESTDEVICE
DOSCODE:7F65		     call    PATHCHRCMP
DOSCODE:7F68		     jz	     short NOTDEV
DOSCODE:7F6A		     or	     al, al
DOSCODE:7F6C		     jz	     short TESTDEVICE
DOSCODE:7F6E		     stosb
DOSCODE:7F6F		     loop    TESTLOOP
DOSCODE:7F71 NOTDEV:				     ; ...
DOSCODE:7F71		     stc
DOSCODE:7F72		     retn
DOSCODE:7F73 TESTDEVICE:			     ; ...
DOSCODE:7F73		     add     cx, 2
DOSCODE:7F76		     mov     al, 20h ; ' '
DOSCODE:7F78		     rep stosb
DOSCODE:7F7A		     mov     ax, ss
DOSCODE:7F7C		     mov     ds, ax
DOSCODE:7F7E		     call    DEVNAME
DOSCODE:7F81		     retn
DOSCODE:7F81 CHKDEV	     endp
DOSCODE:7F82 ; START OF	FUNCTION CHUNK FOR GETPATH
DOSCODE:7F82 ROOTPATH:				     ; ...
DOSCODE:7F82		     call    SETROOTSRCH
DOSCODE:7F85		     cmp     byte ptr [si], 0
DOSCODE:7F88		     jnz     short FINDPATH
DOSCODE:7F8A		     mov     al, ds:SATTRIB
DOSCODE:7F8D		     mov     ds:ATTRIB,	al
DOSCODE:7F90		     xor     ah, ah
DOSCODE:7F92		     retn
DOSCODE:7F93 FINDPATH:				     ; ...
DOSCODE:7F93		     push    es
DOSCODE:7F94		     push    si
DOSCODE:7F95		     mov     di, si
DOSCODE:7F97		     mov     cx, ds:DIRSTART
DOSCODE:7F9B		     cmp     ds:CURR_DIR_END, 0FFFFh
DOSCODE:7FA0		     jz	     short NOIDS
DOSCODE:7FA2		     cmp     di, ds:CURR_DIR_END
DOSCODE:7FA6		     jnz     short NOIDS
DOSCODE:7FA8		     les     di, ds:THISCDS
DOSCODE:7FAC		     mov     es:[di+73], cx
DOSCODE:7FB0 NOIDS:				     ; ...
DOSCODE:7FB0		     mov     ax, ss
DOSCODE:7FB2		     mov     es, ax
DOSCODE:7FB4		     mov     di, offset	NAME1
DOSCODE:7FB7		     mov     ax, 2020h
DOSCODE:7FBA		     stosb
DOSCODE:7FBB		     stosw
DOSCODE:7FBC		     stosw
DOSCODE:7FBD		     stosw
DOSCODE:7FBE		     stosw
DOSCODE:7FBF		     stosw
DOSCODE:7FC0		     mov     di, offset	NAME1
DOSCODE:7FC3		     xor     ah, ah
DOSCODE:7FC5 GetNam:				     ; ...
DOSCODE:7FC5		     inc     cl
DOSCODE:7FC7		     lodsb
DOSCODE:7FC8		     cmp     al, '.'
DOSCODE:7FCA		     jz	     short _SetExt
DOSCODE:7FCC		     or	     al, al
DOSCODE:7FCE		     jz	     short _GetDone
DOSCODE:7FD0		     cmp     al, '\'
DOSCODE:7FD2		     jz	     short _GetDone
DOSCODE:7FD4		     cmp     al, '?'
DOSCODE:7FD6		     jnz     short StoNam
DOSCODE:7FD8		     or	     ah, 1
DOSCODE:7FDB StoNam:				     ; ...
DOSCODE:7FDB		     stosb
DOSCODE:7FDC		     jmp     short GetNam
DOSCODE:7FDE _SetExt:				     ; ...
DOSCODE:7FDE		     mov     di, (offset NAME1+8)
DOSCODE:7FE1 GetExt:				     ; ...
DOSCODE:7FE1		     lodsb
DOSCODE:7FE2		     or	     al, al
DOSCODE:7FE4		     jz	     short _GetDone
DOSCODE:7FE6		     cmp     al, '\'
DOSCODE:7FE8		     jz	     short _GetDone
DOSCODE:7FEA		     cmp     al, '?'
DOSCODE:7FEC		     jnz     short StoExt
DOSCODE:7FEE		     or	     ah, 1
DOSCODE:7FF1 StoExt:				     ; ...
DOSCODE:7FF1		     stosb
DOSCODE:7FF2		     jmp     short GetExt
DOSCODE:7FF4 _GetDone:				     ; ...
DOSCODE:7FF4		     dec     si
DOSCODE:7FF5		     mov     cl, ah
DOSCODE:7FF7		     or	     cl, 80h
DOSCODE:7FFA		     pop     di
DOSCODE:7FFB		     pop     es
DOSCODE:7FFC		     cmp     si, di
DOSCODE:7FFE		     jnz     short check_device
DOSCODE:8000		     jmp     _BADPATH
DOSCODE:8003 check_device:			     ; ...
DOSCODE:8003		     push    si
DOSCODE:8004		     mov     al, [si]
DOSCODE:8006		     or	     al, al
DOSCODE:8008		     jnz     short NOT_LAST
DOSCODE:800A		     mov     bh, ds:SATTRIB
DOSCODE:800E		     mov     ds:ATTRIB,	bh
DOSCODE:8012 NOT_LAST:				     ; ...
DOSCODE:8012		     push    es
DOSCODE:8013		     push    ss
DOSCODE:8014		     pop     es
DOSCODE:8015		     call    DEVNAME
DOSCODE:8018		     pop     es
DOSCODE:8019		     jb	     short FindFile
DOSCODE:801B		     or	     al, al
DOSCODE:801D		     jz	     short GO_BDEV
DOSCODE:801F		     jmp     FILEINPATH
DOSCODE:8022 GO_BDEV:				     ; ...
DOSCODE:8022		     pop     si
DOSCODE:8023		     jmp     Build_devJ
DOSCODE:8026 FindFile:				     ; ...
DOSCODE:8026		     cmp     ds:NAME1, 0E5h
DOSCODE:802B		     jnz     short NOE5
DOSCODE:802D		     mov     ds:NAME1, 5
DOSCODE:8032 NOE5:				     ; ...
DOSCODE:8032		     push    di
DOSCODE:8033		     push    es
DOSCODE:8034		     push    cx
DOSCODE:8035		     call    LookupPath
DOSCODE:8038		     jnb     short DIR_FOUND
DOSCODE:803A		     call    SEARCH
DOSCODE:803D DIR_FOUND:				     ; ...
DOSCODE:803D		     pop     cx
DOSCODE:803E		     pop     es
DOSCODE:803F		     pop     di
DOSCODE:8040		     jnb     short LOAD_BUF
DOSCODE:8042		     jmp     BADPATHPOP
DOSCODE:8045 LOAD_BUF:				     ; ...
DOSCODE:8045		     lds     di, ds:CURBUF
DOSCODE:8049		     test    byte ptr [bx+0Bh],	10h
DOSCODE:804D		     jnz     short GO_NEXT
DOSCODE:804F		     jmp     FILEINPATH
DOSCODE:8052 GO_NEXT:				     ; ...
DOSCODE:8052		     cmp     ss:NoSetDir, 0
DOSCODE:8058		     jz	     short SetDir
DOSCODE:805A		     mov     dx, di
DOSCODE:805C		     mov     cx, ds
DOSCODE:805E		     push    ss
DOSCODE:805F		     pop     ds
DOSCODE:8060		     pop     di
DOSCODE:8061		     test    ds:FastOpenFlg, 1
DOSCODE:8066		     jz	     short _nofast
DOSCODE:8068		     test    ds:FastOpenFlg, 2
DOSCODE:806D		     jz	     short _nofast
DOSCODE:806F		     mov     di, ds:Next_Element_Start
DOSCODE:8073 _nofast:				     ; ...
DOSCODE:8073		     cmp     byte ptr [di], 0
DOSCODE:8076		     jnz     short NEXT_ONE
DOSCODE:8078		     jmp     _SETRET
DOSCODE:807B NEXT_ONE:				     ; ...
DOSCODE:807B		     push    di
DOSCODE:807C		     mov     di, dx
DOSCODE:807E		     mov     ds, cx
DOSCODE:8080 SetDir:				     ; ...
DOSCODE:8080		     mov     dx, [si]
DOSCODE:8082		     push    ds
DOSCODE:8083		     push    ss
DOSCODE:8084		     pop     ds
DOSCODE:8085		     test    ds:FastOpenFlg, 2
DOSCODE:808A		     jz	     short DO_NORMAL
DOSCODE:808C		     mov     bx, dx
DOSCODE:808E		     mov     di, ds:CLUSNUM
DOSCODE:8092		     push    ax
DOSCODE:8093		     call    SETDIRSRCH
DOSCODE:8096		     pop     ax
DOSCODE:8097		     add     sp, 2
DOSCODE:809A		     jmp     short FAST_OPEN_SKIP
DOSCODE:809C DO_NORMAL:				     ; ...
DOSCODE:809C		     pop     ds
DOSCODE:809D		     sub     bx, di
DOSCODE:809F		     sub     si, di
DOSCODE:80A1		     push    bx
DOSCODE:80A2		     push    ax
DOSCODE:80A3		     push    si
DOSCODE:80A4		     push    cx
DOSCODE:80A5		     push    word ptr [di+6]
DOSCODE:80A8		     push    word ptr [di+8]
DOSCODE:80AB		     mov     bx, dx
DOSCODE:80AD		     push    ss
DOSCODE:80AE		     pop     ds
DOSCODE:80AF		     call    SETDIRSRCH
DOSCODE:80B2		     pop     ds:HIGH_SECTOR
DOSCODE:80B6		     pop     dx
DOSCODE:80B7		     jb	     short SKIP_GETB
DOSCODE:80B9		     mov     ds:ALLOWED, 18h
DOSCODE:80BE		     xor     al, al
DOSCODE:80C0		     call    GETBUFFR
DOSCODE:80C3 SKIP_GETB:				     ; ...
DOSCODE:80C3		     pop     cx
DOSCODE:80C4		     pop     si
DOSCODE:80C5		     pop     ax
DOSCODE:80C6		     pop     bx
DOSCODE:80C7		     jnb     short SET_THE_BUF
DOSCODE:80C9		     pop     di
DOSCODE:80CA		     mov     si, di
DOSCODE:80CC		     jmp     short _BADPATH
DOSCODE:80CE SET_THE_BUF:			     ; ...
DOSCODE:80CE		     call    SET_BUF_AS_DIR
DOSCODE:80D1		     mov     di, word ptr ds:CURBUF
DOSCODE:80D5		     add     si, di
DOSCODE:80D7		     add     bx, di
DOSCODE:80D9 FAST_OPEN_SKIP:			     ; ...
DOSCODE:80D9		     pop     di
DOSCODE:80DA		     call    InsertPath
DOSCODE:80DD		     mov     al, [di]
DOSCODE:80DF		     or	     al, al
DOSCODE:80E1		     jz	     short _SETRET
DOSCODE:80E3		     inc     di
DOSCODE:80E4		     mov     si, di
DOSCODE:80E6		     call    PATHCHRCMP
DOSCODE:80E9		     jnz     short find_bad_name
DOSCODE:80EB		     jmp     FINDPATH
DOSCODE:80EE find_bad_name:			     ; ...
DOSCODE:80EE		     dec     si
DOSCODE:80EF _BADPATH:				     ; ...
DOSCODE:80EF		     xor     cl, cl
DOSCODE:80F1		     jmp     short BADPRET
DOSCODE:80F3 FILEINPATH:			     ; ...
DOSCODE:80F3		     pop     di
DOSCODE:80F4		     push    ss
DOSCODE:80F5		     pop     ds
DOSCODE:80F6		     test    ds:FastOpenFlg, 1
DOSCODE:80FB		     jz	     short NO_FAST
DOSCODE:80FD		     test    ds:FastOpenFlg, 2
DOSCODE:8102		     jz	     short NO_FAST
DOSCODE:8104		     mov     di, ds:Next_Element_Start
DOSCODE:8108 NO_FAST:				     ; ...
DOSCODE:8108		     mov     al, [di]
DOSCODE:810A		     or	     al, al
DOSCODE:810C		     jz	     short INCRET
DOSCODE:810E		     mov     si, di
DOSCODE:8110		     jmp     short BADPRET
DOSCODE:8112 INCRET:				     ; ...
DOSCODE:8112		     call    InsertPath
DOSCODE:8115		     inc     al
DOSCODE:8117 _SETRET:				     ; ...
DOSCODE:8117		     retn
DOSCODE:8118 BADPATHPOP:			     ; ...
DOSCODE:8118		     pop     si
DOSCODE:8119		     mov     al, [si]
DOSCODE:811B		     mov     si, di
DOSCODE:811D		     or	     al, al
DOSCODE:811F BADPRET:				     ; ...
DOSCODE:811F		     mov     al, ds:SATTRIB
DOSCODE:8122		     mov     ds:ATTRIB,	al
DOSCODE:8125		     stc
DOSCODE:8126		     retn
DOSCODE:8126 ; END OF FUNCTION CHUNK FOR GETPATH
DOSCODE:8127 ; =============== S U B R O U T I N E =======================================
DOSCODE:8127 STARTSRCH	     proc near		     ; ...
DOSCODE:8127		     les     bp, ds:THISDPB
DOSCODE:812B		     xor     ax, ax
DOSCODE:812D		     mov     ds:LASTENT, ax
DOSCODE:8130		     mov     ds:VOLID, al
DOSCODE:8133		     dec     ax
DOSCODE:8134		     mov     ds:ENTFREE, ax
DOSCODE:8137		     mov     ds:ENTLAST, ax
DOSCODE:813A		     retn
DOSCODE:813A STARTSRCH	     endp
DOSCODE:813B ; =============== S U B R O U T I N E =======================================
DOSCODE:813B MatchAttributes proc near		     ; ...
DOSCODE:813B		     push    ax
DOSCODE:813C		     mov     al, ss:ATTRIB
DOSCODE:8140		     not     al
DOSCODE:8142		     and     al, ch
DOSCODE:8144		     and     al, 16h
DOSCODE:8146		     pop     ax
DOSCODE:8147		     retn
DOSCODE:8147 MatchAttributes endp
DOSCODE:8148 ; =============== S U B R O U T I N E =======================================
DOSCODE:8148 DEVNAME	     proc near		     ; ...
DOSCODE:8148		     push    si
DOSCODE:8149		     push    di
DOSCODE:814A		     push    cx
DOSCODE:814B		     push    ax
DOSCODE:814C		     push    word ptr ds:NAME1
DOSCODE:8150		     cmp     ds:NAME1, 5
DOSCODE:8155		     jnz     short NOKTR
DOSCODE:8157		     mov     ds:NAME1, 0E5h
DOSCODE:815C NOKTR:				     ; ...
DOSCODE:815C		     test    ds:ATTRIB,	8
DOSCODE:8161		     jnz     short RET31
DOSCODE:8163		     mov     si, offset	NULDEV
DOSCODE:8166 LOOKIO:				     ; ...
DOSCODE:8166		     test    word ptr [si+4], 8000h
DOSCODE:816B		     jz	     short SKIPDEV
DOSCODE:816D		     mov     ax, si
DOSCODE:816F		     add     si, 10
DOSCODE:8172		     mov     di, offset	NAME1
DOSCODE:8175		     mov     cx, 4
DOSCODE:8178		     repe cmpsw
DOSCODE:817A		     mov     si, ax
DOSCODE:817C		     jz	     short IOCHK
DOSCODE:817E SKIPDEV:				     ; ...
DOSCODE:817E		     lds     si, [si]
DOSCODE:8180		     cmp     si, 0FFFFh
DOSCODE:8183		     jnz     short LOOKIO
DOSCODE:8185 RET31:				     ; ...
DOSCODE:8185		     stc
DOSCODE:8186 RETNV:				     ; ...
DOSCODE:8186		     mov     cx, ss
DOSCODE:8188		     mov     ds, cx
DOSCODE:818A		     pop     word ptr ds:NAME1
DOSCODE:818E		     pop     ax
DOSCODE:818F		     pop     cx
DOSCODE:8190		     pop     di
DOSCODE:8191		     pop     si
DOSCODE:8192		     retn
DOSCODE:8193 IOCHK:				     ; ...
DOSCODE:8193		     mov     word ptr ss:DEVPT+2, ds
DOSCODE:8198		     mov     bh, [si+4]
DOSCODE:819B		     or	     bh, 0C0h
DOSCODE:819E		     and     bh, 0DFh
DOSCODE:81A1		     mov     word ptr ss:DEVPT,	si
DOSCODE:81A6		     jmp     short RETNV
DOSCODE:81A6 DEVNAME	     endp
DOSCODE:81A8 ; =============== S U B R O U T I N E =======================================
DOSCODE:81A8 Build_device_ent proc near		     ; ...
DOSCODE:81A8		     mov     ax, 2020h
DOSCODE:81AB		     mov     di, (offset NAME1+8) ; DEVFCB+8
DOSCODE:81AE		     stosw
DOSCODE:81AF		     stosb
DOSCODE:81B0		     mov     al, 40h
DOSCODE:81B2		     stosb
DOSCODE:81B3		     xor     ax, ax
DOSCODE:81B5		     mov     cx, 10
DOSCODE:81B8		     rep stosw
DOSCODE:81BA		     call    DATE16
DOSCODE:81BD		     mov     di, (offset NAME2+0Ah)
DOSCODE:81C0		     xchg    ax, dx
DOSCODE:81C1		     stosw
DOSCODE:81C2		     xchg    ax, dx
DOSCODE:81C3		     stosw
DOSCODE:81C4		     mov     si, di
DOSCODE:81C6		     mov     ax, word ptr ds:DEVPT
DOSCODE:81C9		     stosw
DOSCODE:81CA		     mov     ax, word ptr ds:DEVPT+2
DOSCODE:81CD		     stosw
DOSCODE:81CE		     mov     ah, bh
DOSCODE:81D0		     mov     bx, offset	NAME1
DOSCODE:81D3		     xor     al, al
DOSCODE:81D5		     retn
DOSCODE:81D5 Build_device_ent endp
DOSCODE:81D6 ; =============== S U B R O U T I N E =======================================
DOSCODE:81D6 ; Attributes: bp-based frame
DOSCODE:81D6 ValidateCDS     proc near		     ; ...
DOSCODE:81D6 SaveCDS	     = dword ptr -6
DOSCODE:81D6 Temp	     = word ptr	-2
DOSCODE:81D6		     push    bp
DOSCODE:81D7		     mov     bp, sp
DOSCODE:81D9		     sub     sp, 6
DOSCODE:81DC		     mov     [bp+Temp],	di
DOSCODE:81DF		     lds     si, ss:THISCDS
DOSCODE:81E4		     mov     word ptr [bp+SaveCDS], si
DOSCODE:81E7		     mov     word ptr [bp+SaveCDS+2], ds
DOSCODE:81EA		     call    ECritDisk
DOSCODE:81ED		     test    word ptr [si+43h],	8000h
DOSCODE:81F2		     jz	     short _DoSplice
DOSCODE:81F4		     jmp     FatFail
DOSCODE:81F7 _DoSplice:				     ; ...
DOSCODE:81F7		     xor     dl, dl
DOSCODE:81F9		     xchg    dl, ss:NoSetDir
DOSCODE:81FE		     push    ss
DOSCODE:81FF		     pop     es
DOSCODE:8200		     call    FStrCpy
DOSCODE:8203		     mov     si, [bp+Temp]
DOSCODE:8206		     push    ss
DOSCODE:8207		     pop     ds
DOSCODE:8208		     call    Splice
DOSCODE:820B		     push    ss
DOSCODE:820C		     pop     ds
DOSCODE:820D		     mov     ds:NoSetDir, dl
DOSCODE:8211		     les     di, ds:THISCDS
DOSCODE:8215		     push    bp
DOSCODE:8216		     call    FATREAD_CDS
DOSCODE:8219		     pop     bp
DOSCODE:821A		     jb	     short FatFail
DOSCODE:821C		     lds     si, ds:THISCDS
DOSCODE:8220		     cmp     word ptr [si+49h],	0FFFFh
DOSCODE:8224		     jnz     short RestoreCDS
DOSCODE:8226		     push    ss
DOSCODE:8227		     pop     es
DOSCODE:8228		     push    ss:WFP_START
DOSCODE:822D		     cmp     si, word ptr [bp+SaveCDS]
DOSCODE:8230		     jnz     short DoChdir
DOSCODE:8232		     mov     di, [bp+Temp]
DOSCODE:8235		     mov     ss:WFP_START, di
DOSCODE:823A		     call    FStrCpy
DOSCODE:823D DoChdir:				     ; ...
DOSCODE:823D		     push    ss
DOSCODE:823E		     pop     ds
DOSCODE:823F		     push    word ptr ds:SATTRIB
DOSCODE:8243		     push    bp
DOSCODE:8244		     call    DOS_CHDIR
DOSCODE:8247		     pop     bp
DOSCODE:8248		     pop     bx
DOSCODE:8249		     pop     ds:WFP_START
DOSCODE:824D		     mov     ds:SATTRIB, bl
DOSCODE:8251		     lds     si, [bp+SaveCDS]
DOSCODE:8254		     jnb     short SetCluster
DOSCODE:8256		     mov     word ptr ss:THISCDS, si
DOSCODE:825B		     mov     word ptr ss:THISCDS+2, ds
DOSCODE:8260		     xor     cx, cx
DOSCODE:8262		     mov     [si+3], cl
DOSCODE:8265 SetCluster:			     ; ...
DOSCODE:8265		     mov     word ptr [si+49h],	0FFFFh
DOSCODE:826A		     lds     si, ss:THISCDS
DOSCODE:826F		     test    word ptr [si+43h],	2000h
DOSCODE:8274		     jz	     short _setdirclus
DOSCODE:8276		     mov     cx, 0FFFFh
DOSCODE:8279 _setdirclus:			     ; ...
DOSCODE:8279		     mov     [si+49h], cx
DOSCODE:827C RestoreCDS:			     ; ...
DOSCODE:827C		     les     di, [bp+SaveCDS]
DOSCODE:827F		     mov     word ptr ss:THISCDS, di
DOSCODE:8284		     mov     word ptr ss:THISCDS+2, es
DOSCODE:8289		     clc
DOSCODE:828A FatFail:				     ; ...
DOSCODE:828A		     call    LCritDisk
DOSCODE:828D		     les     di, [bp+SaveCDS]
DOSCODE:8290		     mov     sp, bp
DOSCODE:8292		     pop     bp
DOSCODE:8293		     retn
DOSCODE:8293 ValidateCDS     endp
DOSCODE:8294 ; =============== S U B R O U T I N E =======================================
DOSCODE:8294 CheckThisDevice proc near		     ; ...
DOSCODE:8294		     push    di
DOSCODE:8295		     push    si
DOSCODE:8296		     mov     di, si
DOSCODE:8298		     mov     al, [si]
DOSCODE:829A		     call    PATHCHRCMP
DOSCODE:829D		     jnz     short ParseDev
DOSCODE:829F		     inc     si
DOSCODE:82A0		     lodsw
DOSCODE:82A1		     or	     ax, 2020h
DOSCODE:82A4		     cmp     ax, 'ed'        ; 'de'
DOSCODE:82A7		     jnz     short NotDevice
DOSCODE:82A9		     lodsb
DOSCODE:82AA		     or	     al, 20h
DOSCODE:82AC		     cmp     al, 'v'
DOSCODE:82AE		     jnz     short NotDevice
DOSCODE:82B0		     lodsb
DOSCODE:82B1		     call    PATHCHRCMP
DOSCODE:82B4		     jnz     short NotDevice
DOSCODE:82B6 ParseDev:				     ; ...
DOSCODE:82B6		     push    ds
DOSCODE:82B7		     push    si
DOSCODE:82B8		     call    NAMETRANS
DOSCODE:82BB		     cmp     byte ptr [si], 0
DOSCODE:82BE		     stc
DOSCODE:82BF		     jnz     short SkipSearch
DOSCODE:82C1		     push    ss
DOSCODE:82C2		     pop     ds
DOSCODE:82C3		     mov     al, ds:SATTRIB
DOSCODE:82C6		     mov     ds:ATTRIB,	al
DOSCODE:82C9		     call    DEVNAME
DOSCODE:82CC SkipSearch:			     ; ...
DOSCODE:82CC		     pop     si
DOSCODE:82CD		     pop     ds
DOSCODE:82CE CheckReturn:			     ; ...
DOSCODE:82CE		     pop     di
DOSCODE:82CF		     jnb     short Check_Done
DOSCODE:82D1		     mov     si, di
DOSCODE:82D3 Check_Done:			     ; ...
DOSCODE:82D3		     pop     di
DOSCODE:82D4		     cmc
DOSCODE:82D5		     retn
DOSCODE:82D6 NotDevice:				     ; ...
DOSCODE:82D6		     stc
DOSCODE:82D7		     jmp     short CheckReturn
DOSCODE:82D7 CheckThisDevice endp ; sp-analysis	failed
DOSCODE:82D9 ; =============== S U B R O U T I N E =======================================
DOSCODE:82D9 LookupPath	     proc near		     ; ...
DOSCODE:82D9		     test    ss:FastOpenFlg, 1
DOSCODE:82DF		     jnz     short FASTINST
DOSCODE:82E1 NOLOOK:				     ; ...
DOSCODE:82E1		     jmp     NOLOOKUP
DOSCODE:82E4 FASTINST:				     ; ...
DOSCODE:82E4		     test    ss:FastOpenFlg, 8
DOSCODE:82EA		     jnz     short NOLOOK
DOSCODE:82EC		     mov     bx, offset	FastOpenTable
DOSCODE:82EF		     mov     si, ss:WFP_START
DOSCODE:82F4		     mov     di, offset	Dir_Info_Buff
DOSCODE:82F7		     mov     cx, offset	FastOpen_Ext_Info
DOSCODE:82FA		     mov     al, 1
DOSCODE:82FC		     push    ds
DOSCODE:82FD		     pop     es
DOSCODE:82FE		     call    dword ptr [bx+2]
DOSCODE:8301		     jb	     short NOTFOUND
DOSCODE:8303		     lea     bx, [si-2]
DOSCODE:8306		     cmp     bx, ss:WFP_START
DOSCODE:830B		     jz	     short NOTFOUND
DOSCODE:830D		     cmp     byte ptr [si], 0
DOSCODE:8310		     jnz     short parfnd
DOSCODE:8312		     push    cx
DOSCODE:8313		     mov     cl, ss:ATTRIB
DOSCODE:8318		     mov     ch, ss:SATTRIB
DOSCODE:831D		     mov     ss:ATTRIB,	ch
DOSCODE:8322		     mov     ch, es:[di+0Bh]
DOSCODE:8326		     call    MatchAttributes
DOSCODE:8329		     pop     cx
DOSCODE:832A		     jnz     short NOLOOKUP
DOSCODE:832C parfnd:				     ; ...
DOSCODE:832C		     mov     ss:Next_Element_Start, si
DOSCODE:8331		     mov     bx, cx
DOSCODE:8333		     mov     ax, [bx+7]
DOSCODE:8336		     mov     ss:LASTENT, ax
DOSCODE:833A		     mov     ax, [bx+9]
DOSCODE:833D		     mov     ss:DIRSTART, ax
DOSCODE:8341		     mov     ax, [bx+5]
DOSCODE:8344		     mov     ss:CLUSNUM, ax
DOSCODE:8348		     push    es
DOSCODE:8349		     les     bx, ss:THISDPB
DOSCODE:834E		     mov     ah, es:[bx]
DOSCODE:8351		     pop     es
DOSCODE:8352		     mov     word ptr ss:CURBUF, 0
DOSCODE:8359		     mov     word ptr ss:CURBUF+2, es
DOSCODE:835E		     mov     bx, di
DOSCODE:8360		     lea     si, [di+1Ah]
DOSCODE:8363		     or	     ss:FastOpenFlg, 12h
DOSCODE:8369		     retn
DOSCODE:836A NOTFOUND:				     ; ...
DOSCODE:836A		     cmp     ax, 0FFFFh
DOSCODE:836D		     jnz     short Partial_Success
DOSCODE:836F		     mov     ss:FastOpenFlg, 0
DOSCODE:8375 Partial_Success:			     ; ...
DOSCODE:8375		     and     ss:FastOpenFlg, 0FBh
DOSCODE:837B NOLOOKUP:				     ; ...
DOSCODE:837B		     stc
DOSCODE:837C		     retn
DOSCODE:837C LookupPath	     endp
DOSCODE:837D ; =============== S U B R O U T I N E =======================================
DOSCODE:837D InsertPath	     proc near		     ; ...
DOSCODE:837D		     pushf
DOSCODE:837E		     test    ss:FastOpenFlg, 1
DOSCODE:8384		     jz	     short GET_NEXT_ELEMENT
DOSCODE:8386		     test    ss:FastOpenFlg, 2
DOSCODE:838C		     jz	     short INSERT_DIR_INFO
DOSCODE:838E		     and     ss:FastOpenFlg, 0FDh
DOSCODE:8394		     mov     di, ss:Next_Element_Start
DOSCODE:8399		     jmp     short GET_NEXT2
DOSCODE:839B INSERT_DIR_INFO:			     ; ...
DOSCODE:839B		     push    ds
DOSCODE:839C		     push    es
DOSCODE:839D		     push    bx
DOSCODE:839E		     push    si
DOSCODE:839F		     push    di
DOSCODE:83A0		     push    cx
DOSCODE:83A1		     push    ax
DOSCODE:83A2		     lds     di, ss:CURBUF
DOSCODE:83A7		     mov     si, offset	FastOpen_Ext_Info
DOSCODE:83AA		     mov     ax, [di+6]
DOSCODE:83AD		     mov     ss:[si+1],	ax
DOSCODE:83B1		     mov     ax, [di+8]
DOSCODE:83B4		     push    ss
DOSCODE:83B5		     pop     ds
DOSCODE:83B6		     mov     [si+3], ax
DOSCODE:83B9		     mov     ax, ds:CLUSNUM
DOSCODE:83BC		     mov     [si+5], ax
DOSCODE:83BF		     mov     ax, ds:LASTENT
DOSCODE:83C2		     mov     [si+7], ax
DOSCODE:83C5		     mov     ax, ds:DIRSTART
DOSCODE:83C8		     mov     [si+9], ax
DOSCODE:83CB		     mov     ax, bx
DOSCODE:83CD		     add     di, 20
DOSCODE:83D0		     sub     ax, di
DOSCODE:83D2		     mov     cl, 32
DOSCODE:83D4		     div     cl
DOSCODE:83D6		     mov     [si], al
DOSCODE:83D8		     push    ds
DOSCODE:83D9		     pop     es
DOSCODE:83DA		     mov     ds, word ptr ds:CURBUF+2
DOSCODE:83DE		     mov     di, bx
DOSCODE:83E0		     cmp     word ptr [di+1Ah],	0
DOSCODE:83E4		     jz	     short SKIP_INSERT
DOSCODE:83E6		     push    si
DOSCODE:83E7		     pop     bx
DOSCODE:83E8		     mov     al, 2
DOSCODE:83EA		     mov     si, offset	FastOpenTable
DOSCODE:83ED		     call    dword ptr es:[si+2]
DOSCODE:83F1		     clc
DOSCODE:83F2 SKIP_INSERT:			     ; ...
DOSCODE:83F2		     pop     ax
DOSCODE:83F3		     pop     cx
DOSCODE:83F4		     pop     di
DOSCODE:83F5		     pop     si
DOSCODE:83F6		     pop     bx
DOSCODE:83F7		     pop     es
DOSCODE:83F8		     pop     ds
DOSCODE:83F9 GET_NEXT2:				     ; ...
DOSCODE:83F9		     or	     ss:FastOpenFlg, 8
DOSCODE:83FF GET_NEXT_ELEMENT:			     ; ...
DOSCODE:83FF		     popf
DOSCODE:8400		     retn
DOSCODE:8400 InsertPath	     endp
DOSCODE:8401 LenTab	     db	22, 14,	22, 13,	15, 14 ; ...
DOSCODE:8407 CmdTab	     db	86h, 4		     ; ...
DOSCODE:8409		     db	86h, 5
DOSCODE:840B		     db	87h, 8
DOSCODE:840D		     db	87h, 0Ah
DOSCODE:840F		     db	86h, 7
DOSCODE:8411		     db	86h, 5
DOSCODE:8413 ; =============== S U B R O U T I N E =======================================
DOSCODE:8413 IOFUNC	     proc near		     ; ...
DOSCODE:8413		     mov     word ptr ss:IOXAD+2, ss
DOSCODE:8418		     mov     word ptr ss:IOXAD,	offset DEVIOBUF
DOSCODE:841F		     mov     ss:IOSCNT,	1
DOSCODE:8426		     mov     ss:DEVIOBUF, ax
DOSCODE:842A		     test    byte ptr [si+6], 80h
DOSCODE:842E		     jz	     short IOTO22
DOSCODE:8430		     jmp     IOTOFILE
DOSCODE:8433 IOTO22:				     ; ...
DOSCODE:8433		     test    byte ptr [si+5], 80h
DOSCODE:8437		     jnz     short IOTO33
DOSCODE:8439		     jmp     IOTOFILE
DOSCODE:843C IOTO33:				     ; ...
DOSCODE:843C		     push    es
DOSCODE:843D		     call    save_world
DOSCODE:8440		     mov     dx, ds
DOSCODE:8442		     mov     bx, ss
DOSCODE:8444		     mov     ds, bx
DOSCODE:8446		     mov     es, bx
DOSCODE:8448		     xor     bx, bx
DOSCODE:844A		     cmp     ah, 5
DOSCODE:844D		     jnz     short _no_sys_wait
DOSCODE:844F		     or	     bx, 400h
DOSCODE:8453 _no_sys_wait:			     ; ...
DOSCODE:8453		     mov     ds:IOCALL_REQSTAT,	bx
DOSCODE:8457		     xor     bx, bx
DOSCODE:8459		     mov     ds:IOMED, bl
DOSCODE:845D		     mov     bl, ah
DOSCODE:845F		     mov     ah, cs:LenTab[bx]
DOSCODE:8464		     shl     bx, 1
DOSCODE:8466		     mov     cx, word ptr cs:CmdTab[bx]
DOSCODE:846B		     mov     bx, offset	IOCALL
DOSCODE:846E		     mov     ds:IOCALL,	ah
DOSCODE:8472		     mov     ds:IOCALL_REQFUNC,	ch
DOSCODE:8476		     mov     ds, dx
DOSCODE:8478		     call    DEVIOCALL
DOSCODE:847B		     mov     di, ss:IOCALL_REQSTAT
DOSCODE:8480		     and     di, di
DOSCODE:8482		     js	     short DevErr
DOSCODE:8484 OKDevIO:				     ; ...
DOSCODE:8484		     mov     ax, ss
DOSCODE:8486		     mov     ds, ax
DOSCODE:8488		     cmp     ch, 5
DOSCODE:848B		     jnz     short DNODRD
DOSCODE:848D		     mov     al, ds:IOMED
DOSCODE:8490		     mov     byte ptr ds:DEVIOBUF, al
DOSCODE:8493 DNODRD:				     ; ...
DOSCODE:8493		     mov     ah, byte ptr ds:IOCALL_REQSTAT+1
DOSCODE:8497		     not     ah
DOSCODE:8499		     and     ah, 2
DOSCODE:849C QuickReturn:
DOSCODE:849C		     call    restore_world
DOSCODE:849F		     pop     es
DOSCODE:84A0		     pushf
DOSCODE:84A1		     mov     al, ss:IoStatFail
DOSCODE:84A5		     cbw
DOSCODE:84A6		     cmp     ax, 0FFFFh
DOSCODE:84A9		     jnz     short not_fail_ret
DOSCODE:84AB		     inc     ss:IoStatFail
DOSCODE:84B0		     popf
DOSCODE:84B1		     retn
DOSCODE:84B2 not_fail_ret:			     ; ...
DOSCODE:84B2		     mov     ax, ss:DEVIOBUF
DOSCODE:84B6		     popf
DOSCODE:84B7		     retn
DOSCODE:84B8 DevErr:				     ; ...
DOSCODE:84B8		     mov     ah, cl
DOSCODE:84BA		     call    CHARHARD
DOSCODE:84BD		     cmp     al, 1
DOSCODE:84BF		     jnz     short NO_RETRY
DOSCODE:84C1		     call    restore_world
DOSCODE:84C4		     pop     es
DOSCODE:84C5		     jmp     IOFUNC
DOSCODE:84C8 NO_RETRY:				     ; ...
DOSCODE:84C8		     and     byte ptr ss:IOCALL_REQSTAT+1, 0FDh
DOSCODE:84CE		     cmp     al, 3
DOSCODE:84D0		     jnz     short not_fail
DOSCODE:84D2		     dec     ss:IoStatFail
DOSCODE:84D7 not_fail:				     ; ...
DOSCODE:84D7		     jmp     short OKDevIO
DOSCODE:84D9 IOTOFILE:				     ; ...
DOSCODE:84D9		     or	     ah, ah
DOSCODE:84DB		     jz	     short IOIN
DOSCODE:84DD		     dec     ah
DOSCODE:84DF		     jz	     short IOIST
DOSCODE:84E1		     dec     ah
DOSCODE:84E3		     jz	     short IOUT
DOSCODE:84E5		     retn
DOSCODE:84E6 IOIST:				     ; ...
DOSCODE:84E6		     push    word ptr [si+15h]
DOSCODE:84E9		     push    word ptr [si+17h]
DOSCODE:84EC		     call    IOIN
DOSCODE:84EF		     pop     word ptr [si+17h]
DOSCODE:84F2		     pop     word ptr [si+15h]
DOSCODE:84F5		     retn
DOSCODE:84F6 IOUT:				     ; ...
DOSCODE:84F6		     call    SETXADDR
DOSCODE:84F9		     call    DOS_WRITE
DOSCODE:84FC		     call    RESTXADDR
DOSCODE:84FF IOUT_retn:				     ; ...
DOSCODE:84FF		     retn
DOSCODE:84FF IOFUNC	     endp
DOSCODE:8500 ; =============== S U B R O U T I N E =======================================
DOSCODE:8500 IOIN	     proc near		     ; ...
DOSCODE:8500		     call    SETXADDR
DOSCODE:8503		     or	     ss:DOS34_FLAG, 40h
DOSCODE:8509		     call    DOS_READ
DOSCODE:850C		     and     ss:DOS34_FLAG, 0FFBFh
DOSCODE:8512		     or	     cx, cx
DOSCODE:8514		     call    RESTXADDR
DOSCODE:8517		     mov     al, byte ptr ss:DEVIOBUF
DOSCODE:851B		     jnz     short IOUT_retn
DOSCODE:851D		     mov     al, 1Ah
DOSCODE:851F		     retn
DOSCODE:851F IOIN	     endp
DOSCODE:8520 ; =============== S U B R O U T I N E =======================================
DOSCODE:8520 SETXADDR	     proc near		     ; ...
DOSCODE:8520		     pop     word ptr ss:CALLBPB
DOSCODE:8525		     push    es
DOSCODE:8526		     call    save_world
DOSCODE:8529		     push    word ptr ss:DMAADD
DOSCODE:852E		     push    word ptr ss:DMAADD+2
DOSCODE:8533		     mov     word ptr ss:THISSFT+2, ds
DOSCODE:8538		     push    ss
DOSCODE:8539		     pop     ds
DOSCODE:853A		     mov     word ptr ds:THISSFT, si
DOSCODE:853E		     mov     cx, word ptr ds:IOXAD+2
DOSCODE:8542		     mov     word ptr ds:DMAADD+2, cx
DOSCODE:8546		     mov     cx, word ptr ds:IOXAD
DOSCODE:854A		     mov     word ptr ds:DMAADD, cx
DOSCODE:854E		     mov     cx, ds:IOSCNT
DOSCODE:8552		     jmp     short RESTRET
DOSCODE:8552 SETXADDR	     endp
DOSCODE:8554 ; =============== S U B R O U T I N E =======================================
DOSCODE:8554 RESTXADDR	     proc near		     ; ...
DOSCODE:8554		     pop     word ptr ds:CALLBPB
DOSCODE:8558		     pop     word ptr ds:DMAADD+2
DOSCODE:855C		     pop     word ptr ds:DMAADD
DOSCODE:8560		     call    restore_world
DOSCODE:8563		     pop     es
DOSCODE:8564 RESTRET:				     ; ...
DOSCODE:8564		     jmp     word ptr ss:CALLBPB
DOSCODE:8564 RESTXADDR	     endp ; sp-analysis	failed
DOSCODE:8569 ; =============== S U B R O U T I N E =======================================
DOSCODE:8569 DEV_OPEN_SFT    proc near		     ; ...
DOSCODE:8569		     push    es
DOSCODE:856A		     call    save_world
DOSCODE:856D		     mov     al, 0Dh
DOSCODE:856F		     jmp     short DO_OPCLS
DOSCODE:856F DEV_OPEN_SFT    endp
DOSCODE:8571 ; =============== S U B R O U T I N E =======================================
DOSCODE:8571 DEV_CLOSE_SFT   proc near		     ; ...
DOSCODE:8571		     push    es
DOSCODE:8572		     call    save_world
DOSCODE:8575		     mov     al, 0Eh
DOSCODE:8577 DO_OPCLS:				     ; ...
DOSCODE:8577		     test    byte ptr es:[di+6], 80h
DOSCODE:857C		     jnz     short OPCLS_DONE
DOSCODE:857E		     xor     ah, ah
DOSCODE:8580		     test    byte ptr es:[di+5], 80h
DOSCODE:8585		     les     di, es:[di+7]
DOSCODE:8589		     jnz     short GOT_DEV_ADDR
DOSCODE:858B		     cmp     ss:fShare,	1
DOSCODE:8591		     jbe     short OPCLS_DONE
DOSCODE:8593		     mov     ah, es:[di+1]
DOSCODE:8597		     mov     cl, es:[di]
DOSCODE:859A		     les     di, es:[di+13h]
DOSCODE:859E GOT_DEV_ADDR:			     ; ...
DOSCODE:859E		     test    byte ptr es:[di+5], 8
DOSCODE:85A3		     jz	     short OPCLS_DONE
DOSCODE:85A5		     push    es
DOSCODE:85A6		     pop     ds
DOSCODE:85A7		     mov     si, di
DOSCODE:85A9 OPCLS_RETRY:			     ; ...
DOSCODE:85A9		     push    ss
DOSCODE:85AA		     pop     es
DOSCODE:85AB		     mov     di, offset	DEVCALL
DOSCODE:85AE		     mov     bx, di
DOSCODE:85B0		     push    ax
DOSCODE:85B1		     mov     al, 13
DOSCODE:85B3		     stosb
DOSCODE:85B4		     pop     ax
DOSCODE:85B5		     xchg    ah, al
DOSCODE:85B7		     stosb
DOSCODE:85B8		     xchg    ah, al
DOSCODE:85BA		     stosb
DOSCODE:85BB		     mov     word ptr es:[di], 0
DOSCODE:85C0		     push    ax
DOSCODE:85C1		     call    DEVIOCALL2
DOSCODE:85C4		     mov     di, es:[bx+3]
DOSCODE:85C8		     and     di, di
DOSCODE:85CA		     jns     short OPCLS_DONEP
DOSCODE:85CC		     test    byte ptr [si+5], 80h
DOSCODE:85D0		     jz	     short BLKDEV
DOSCODE:85D2		     mov     ah, 86h
DOSCODE:85D4		     jmp     short HRDERR
DOSCODE:85D6 BLKDEV:				     ; ...
DOSCODE:85D6		     mov     al, cl
DOSCODE:85D8		     mov     ah, 6
DOSCODE:85DA HRDERR:				     ; ...
DOSCODE:85DA		     call    CHARHARD
DOSCODE:85DD		     cmp     al, 1
DOSCODE:85DF		     jnz     short OPCLS_DONEP
DOSCODE:85E1		     pop     ax
DOSCODE:85E2		     jmp     short OPCLS_RETRY
DOSCODE:85E4 OPCLS_DONEP:			     ; ...
DOSCODE:85E4		     pop     ax
DOSCODE:85E5 OPCLS_DONE:			     ; ...
DOSCODE:85E5		     call    restore_world
DOSCODE:85E8		     pop     es
DOSCODE:85E9		     retn
DOSCODE:85E9 DEV_CLOSE_SFT   endp
DOSCODE:85EA ; =============== S U B R O U T I N E =======================================
DOSCODE:85EA DEVIOCALL	     proc near		     ; ...
DOSCODE:85EA		     lds     si, [si+7]
DOSCODE:85EA DEVIOCALL	     endp
DOSCODE:85ED ; =============== S U B R O U T I N E =======================================
DOSCODE:85ED DEVIOCALL2	     proc near		     ; ...
DOSCODE:85ED		     call    ECritDevice
DOSCODE:85F0		     test    byte ptr [si+5], 80h
DOSCODE:85F4		     jnz     short chardev2
DOSCODE:85F6		     cmp     byte ptr es:[bx+2], 4
DOSCODE:85FB		     jz	     short chkext
DOSCODE:85FD		     cmp     byte ptr es:[bx+2], 8
DOSCODE:8602		     jz	     short chkext
DOSCODE:8604		     cmp     byte ptr es:[bx+2], 9
DOSCODE:8609		     jnz     short chardev2
DOSCODE:860B chkext:				     ; ...
DOSCODE:860B		     call    RW_SC
DOSCODE:860E		     jb	     short dev_exit
DOSCODE:8610		     test    byte ptr [si+4], 2
DOSCODE:8614		     jz	     short chksector
DOSCODE:8616		     add     byte ptr es:[bx], 8
DOSCODE:861A		     mov     ax, word ptr ss:CALLBPB+2
DOSCODE:861E		     mov     word ptr ss:CALLBPB+2, 0FFFFh
DOSCODE:8625		     mov     word ptr ss:CALLNEWSC, ax
DOSCODE:8629		     mov     ax, ss:HIGH_SECTOR
DOSCODE:862D		     mov     word ptr ss:CALLNEWSC+2, ax
DOSCODE:8631		     jmp     short chardev2
DOSCODE:8633 chksector:				     ; ...
DOSCODE:8633		     cmp     ss:HIGH_SECTOR, 0
DOSCODE:8639		     jz	     short chardev2
DOSCODE:863B		     mov     word ptr es:[bx+3], 8107h
DOSCODE:8641		     jmp     short dev_exit
DOSCODE:8643 chardev2:				     ; ...
DOSCODE:8643		     mov     ax, [si+6]
DOSCODE:8646		     mov     word ptr ss:CALLDEVAD, ax
DOSCODE:864A		     mov     word ptr ss:CALLDEVAD+2, ds
DOSCODE:864F		     call    ss:CALLDEVAD
DOSCODE:8654		     mov     ax, [si+8]
DOSCODE:8657		     mov     word ptr ss:CALLDEVAD, ax
DOSCODE:865B		     call    ss:CALLDEVAD
DOSCODE:8660		     call    VIRREAD
DOSCODE:8663		     jb	     short chardev2
DOSCODE:8665 dev_exit:				     ; ...
DOSCODE:8665		     call    LCritDevice
DOSCODE:8668		     retn
DOSCODE:8668 DEVIOCALL2	     endp
DOSCODE:8669 ; =============== S U B R O U T I N E =======================================
DOSCODE:8669 SETREAD	     proc near		     ; ...
DOSCODE:8669		     push    di
DOSCODE:866A		     push    cx
DOSCODE:866B		     push    ax
DOSCODE:866C		     mov     cl, 4
DOSCODE:866E SETCALLHEAD:			     ; ...
DOSCODE:866E		     mov     al, 16h
DOSCODE:8670		     push    ss
DOSCODE:8671		     pop     es
DOSCODE:8672		     mov     di, offset	DEVCALL
DOSCODE:8675		     stosb
DOSCODE:8676		     pop     ax
DOSCODE:8677		     stosb
DOSCODE:8678		     push    ax
DOSCODE:8679		     mov     al, cl
DOSCODE:867B		     stosb
DOSCODE:867C		     xor     ax, ax
DOSCODE:867E		     stosw
DOSCODE:867F		     add     di, 8
DOSCODE:8682		     pop     ax
DOSCODE:8683		     xchg    ah, al
DOSCODE:8685		     stosb
DOSCODE:8686		     xchg    al, ah
DOSCODE:8688		     push    ax
DOSCODE:8689		     mov     ax, bx
DOSCODE:868B		     stosw
DOSCODE:868C		     mov     ax, ds
DOSCODE:868E		     stosw
DOSCODE:868F		     pop     cx
DOSCODE:8690		     pop     ax
DOSCODE:8691		     stosw
DOSCODE:8692		     xchg    ax, dx
DOSCODE:8693		     stosw
DOSCODE:8694		     xchg    ax, cx
DOSCODE:8695		     xchg    dx, cx
DOSCODE:8697		     pop     di
DOSCODE:8698		     mov     bx, offset	DEVCALL
DOSCODE:869B		     retn
DOSCODE:869B SETREAD	     endp
DOSCODE:869C ; =============== S U B R O U T I N E =======================================
DOSCODE:869C SETWRITE	     proc near		     ; ...
DOSCODE:869C		     push    di
DOSCODE:869D		     push    cx
DOSCODE:869E		     push    ax
DOSCODE:869F		     mov     cl, 8
DOSCODE:86A1		     add     cl, ss:VERFLG
DOSCODE:86A6		     jmp     short SETCALLHEAD
DOSCODE:86A6 SETWRITE	     endp
DOSCODE:86A8 ; =============== S U B R O U T I N E =======================================
DOSCODE:86A8 RW_SC	     proc near		     ; ...
DOSCODE:86A8		     cmp     ss:SC_CACHE_COUNT,	0
DOSCODE:86AE		     jz	     short scexit4
DOSCODE:86B0		     cmp     word ptr ss:CALLBPB, 1
DOSCODE:86B6		     jnz     short scexit4
DOSCODE:86B8		     push    cx
DOSCODE:86B9		     push    dx
DOSCODE:86BA		     push    ds
DOSCODE:86BB		     push    si
DOSCODE:86BC		     push    es
DOSCODE:86BD		     push    di
DOSCODE:86BE		     mov     dx, word ptr ss:CALLBPB+2
DOSCODE:86C3		     cmp     ss:DEVCALL_REQFUNC, 4
DOSCODE:86C9		     jz	     short doread
DOSCODE:86CB		     call    INVALIDATE_SC
DOSCODE:86CE		     jmp     scexit2
DOSCODE:86D1 scexit4:				     ; ...
DOSCODE:86D1		     clc
DOSCODE:86D2		     retn
DOSCODE:86D3 doread:				     ; ...
DOSCODE:86D3		     call    SC2BUF
DOSCODE:86D6		     jb	     short readSC
DOSCODE:86D8		     mov     ss:DEVCALL_REQSTAT, 100h
DOSCODE:86DF		     stc
DOSCODE:86E0		     jmp     short saveseq
DOSCODE:86E2 readSC:				     ; ...
DOSCODE:86E2		     mov     ax, ss:HIGH_SECTOR
DOSCODE:86E6		     mov     cx, word ptr ss:CALLBPB+2
DOSCODE:86EB		     sub     cx, ss:SEQ_SECTOR
DOSCODE:86F0		     sbb     ax, ss:SEQ_SECTOR+2
DOSCODE:86F5		     cmp     ax, 0
DOSCODE:86F8		     jnz     short saveseq2
DOSCODE:86FA chklow:
DOSCODE:86FA		     cmp     cx, 1
DOSCODE:86FD		     ja	     short saveseq2
DOSCODE:86FF		     mov     ss:SC_STATUS, 0FFFFh
DOSCODE:8706		     mov     ax, ss:SC_CACHE_COUNT
DOSCODE:870A		     mov     word ptr ss:CALLBPB, ax ; [ss:CALLSCNT]
DOSCODE:870E readsr:
DOSCODE:870E		     mov     ax, word ptr ss:CALLBR+2
DOSCODE:8712		     mov     ss:TEMP_VAR2, ax
DOSCODE:8716		     mov     ax, word ptr ss:CALLBR
DOSCODE:871A		     mov     ss:TEMP_VAR, ax
DOSCODE:871E		     mov     ax, word ptr ss:SC_CACHE_PTR
DOSCODE:8722		     mov     word ptr ss:CALLBR, ax
DOSCODE:8726		     mov     ax, word ptr ss:SC_CACHE_PTR+2
DOSCODE:872A		     mov     word ptr ss:CALLBR+2, ax
DOSCODE:872E		     mov     ss:SC_FLAG, 1
DOSCODE:8734		     mov     al, ss:SC_DRIVE
DOSCODE:8738		     mov     ss:CurSC_DRIVE, al
DOSCODE:873C		     mov     ax, word ptr ss:CALLBPB+2
DOSCODE:8740		     mov     ss:CurSC_SECTOR, ax
DOSCODE:8744		     mov     ax, ss:HIGH_SECTOR
DOSCODE:8748		     mov     ss:CurSC_SECTOR+2,	ax
DOSCODE:874C saveseq2:				     ; ...
DOSCODE:874C		     clc
DOSCODE:874D saveseq:				     ; ...
DOSCODE:874D		     mov     ax, ss:HIGH_SECTOR
DOSCODE:8751		     mov     ss:SEQ_SECTOR+2, ax
DOSCODE:8755		     mov     ax, word ptr ss:CALLBPB+2
DOSCODE:8759		     mov     ss:SEQ_SECTOR, ax
DOSCODE:875D		     jmp     short scexit
DOSCODE:875F scexit2:				     ; ...
DOSCODE:875F		     clc
DOSCODE:8760 scexit:				     ; ...
DOSCODE:8760		     pop     di
DOSCODE:8761		     pop     es
DOSCODE:8762		     pop     si
DOSCODE:8763		     pop     ds
DOSCODE:8764		     pop     dx
DOSCODE:8765		     pop     cx
DOSCODE:8766		     retn
DOSCODE:8766 RW_SC	     endp
DOSCODE:8767 ; =============== S U B R O U T I N E =======================================
DOSCODE:8767 IN_SC	     proc near		     ; ...
DOSCODE:8767		     mov     al, ss:SC_DRIVE
DOSCODE:876B		     cmp     al, ss:CurSC_DRIVE
DOSCODE:8770		     jnz     short outrange2
DOSCODE:8772		     mov     ax, ss:HIGH_SECTOR
DOSCODE:8776		     mov     cx, dx
DOSCODE:8778		     sub     cx, ss:CurSC_SECTOR
DOSCODE:877D		     sbb     ax, ss:CurSC_SECTOR+2
DOSCODE:8782		     cmp     ax, 0
DOSCODE:8785		     jnz     short outrange2
DOSCODE:8787		     cmp     cx, ss:SC_CACHE_COUNT
DOSCODE:878C		     jnb     short outrange2
DOSCODE:878E		     clc
DOSCODE:878F		     jmp     short inexit
DOSCODE:8791 outrange2:				     ; ...
DOSCODE:8791		     stc
DOSCODE:8792 inexit:				     ; ...
DOSCODE:8792		     retn
DOSCODE:8792 IN_SC	     endp
DOSCODE:8793 ; =============== S U B R O U T I N E =======================================
DOSCODE:8793 INVALIDATE_SC   proc near		     ; ...
DOSCODE:8793		     call    IN_SC
DOSCODE:8796		     jb	     short outrange
DOSCODE:8798		     mov     ax, 1
DOSCODE:879B		     shl     ax, cl
DOSCODE:879D		     not     ax
DOSCODE:879F		     and     ss:SC_STATUS, ax
DOSCODE:87A4 outrange:				     ; ...
DOSCODE:87A4		     retn
DOSCODE:87A4 INVALIDATE_SC   endp
DOSCODE:87A5 ; =============== S U B R O U T I N E =======================================
DOSCODE:87A5 VIRREAD	     proc near		     ; ...
DOSCODE:87A5		     cmp     ss:SC_FLAG, 0
DOSCODE:87AB		     jz	     short sc2end
DOSCODE:87AD		     mov     ax, ss:TEMP_VAR2
DOSCODE:87B1		     mov     word ptr ss:CALLBR+2, ax
DOSCODE:87B5		     mov     ax, ss:TEMP_VAR
DOSCODE:87B9		     mov     word ptr ss:CALLBR, ax
DOSCODE:87BD		     mov     ss:SC_FLAG, 0
DOSCODE:87C3		     mov     word ptr ss:CALLBPB, 1 ; [ss:CALLSCNT]
DOSCODE:87CA		     test    byte ptr ss:DEVCALL_REQSTAT+1, 80h
DOSCODE:87D0		     jnz     short scerror
DOSCODE:87D2		     push    ds
DOSCODE:87D3		     push    si
DOSCODE:87D4		     push    es
DOSCODE:87D5		     push    di
DOSCODE:87D6		     push    dx
DOSCODE:87D7		     push    cx
DOSCODE:87D8		     xor     cx, cx
DOSCODE:87DA		     call    SC2BUF2
DOSCODE:87DD		     pop     cx
DOSCODE:87DE		     pop     dx
DOSCODE:87DF		     pop     di
DOSCODE:87E0		     pop     es
DOSCODE:87E1		     pop     si
DOSCODE:87E2		     pop     ds
DOSCODE:87E3		     jmp     short sc2end
DOSCODE:87E5 scerror:				     ; ...
DOSCODE:87E5		     mov     word ptr ss:CALLBPB, 1
DOSCODE:87EC		     mov     ss:SC_STATUS, 0
DOSCODE:87F3		     mov     ss:CurSC_DRIVE, 0FFh
DOSCODE:87F9		     stc
DOSCODE:87FA		     retn
DOSCODE:87FB sc2end:				     ; ...
DOSCODE:87FB		     clc
DOSCODE:87FC		     retn
DOSCODE:87FC VIRREAD	     endp
DOSCODE:87FD ; =============== S U B R O U T I N E =======================================
DOSCODE:87FD SC2BUF	     proc near		     ; ...
DOSCODE:87FD		     call    IN_SC
DOSCODE:8800		     jb	     short noSC
DOSCODE:8802		     mov     ax, 1
DOSCODE:8805		     shl     ax, cl
DOSCODE:8807		     test    ss:SC_STATUS, ax
DOSCODE:880C		     jz	     short noSC
DOSCODE:880E SC2BUF2:				     ; ...
DOSCODE:880E		     mov     ax, cx
DOSCODE:8810		     mul     ss:SC_SECTOR_SIZE
DOSCODE:8815		     add     ax, word ptr ss:SC_CACHE_PTR
DOSCODE:881A		     adc     dx, word ptr ss:SC_CACHE_PTR+2
DOSCODE:881F		     mov     ds, dx
DOSCODE:8821		     mov     si, ax
DOSCODE:8823		     mov     es, word ptr ss:CALLBR+2
DOSCODE:8828		     mov     di, word ptr ss:CALLBR
DOSCODE:882D		     mov     cx, ss:SC_SECTOR_SIZE
DOSCODE:8832		     shr     cx, 1
DOSCODE:8834 MOVWORDS:
DOSCODE:8834		     cmp     ss:DDMOVE,	0
DOSCODE:883A		     jz	     short nodd
DOSCODE:883C		     shr     cx, 1
DOSCODE:883E		     db	66h		     ; 80386, 32 bit op	prefix
DOSCODE:883F nodd:				     ; ...
DOSCODE:883F		     rep movsw
DOSCODE:8841		     clc
DOSCODE:8842		     retn
DOSCODE:8843 noSC:				     ; ...
DOSCODE:8843		     stc
DOSCODE:8844		     retn
DOSCODE:8844 SC2BUF	     endp ; sp-analysis	failed
DOSCODE:8845 ; =============== S U B R O U T I N E =======================================
DOSCODE:8845 BUILDDIR	     proc near		     ; ...
DOSCODE:8845		     mov     ax, ds:ENTFREE
DOSCODE:8848		     cmp     ax, 0FFFFh
DOSCODE:884B		     jz	     short CHECK_IF_ROOT
DOSCODE:884D		     clc
DOSCODE:884E		     retn
DOSCODE:884F CHECK_IF_ROOT:			     ; ...
DOSCODE:884F		     cmp     ds:DIRSTART, 0
DOSCODE:8854		     jnz     short NEWDIR
DOSCODE:8856		     stc
DOSCODE:8857 builddir_retn:			     ; ...
DOSCODE:8857		     retn
DOSCODE:8858 NEWDIR:				     ; ...
DOSCODE:8858		     mov     bx, ds:DIRSTART
DOSCODE:885C		     or	     bx, bx
DOSCODE:885E		     jz	     short NULLDIR
DOSCODE:8860		     call    GETEOF
DOSCODE:8863		     jb	     short builddir_retn
DOSCODE:8865 NULLDIR:				     ; ...
DOSCODE:8865		     mov     cx, 1
DOSCODE:8868		     call    ALLOCATE
DOSCODE:886B		     jb	     short builddir_retn
DOSCODE:886D		     mov     dx, ds:DIRSTART
DOSCODE:8871		     or	     dx, dx
DOSCODE:8873		     jnz     short ADDINGDIR
DOSCODE:8875		     call    SETDIRSRCH
DOSCODE:8878		     jb	     short builddir_retn
DOSCODE:887A		     mov     ds:LASTENT, 0FFFFh
DOSCODE:8880		     jmp     short GOTDIRREC
DOSCODE:8882 ADDINGDIR:				     ; ...
DOSCODE:8882		     push    bx
DOSCODE:8883		     mov     bx, ds:CLUSNUM
DOSCODE:8887		     call    IsEOF
DOSCODE:888A		     pop     bx
DOSCODE:888B		     jb	     short NOTFIRSTGROW
DOSCODE:888D		     mov     ds:CLUSNUM, bx
DOSCODE:8891		     push    cx
DOSCODE:8892		     push    ax
DOSCODE:8893		     push    bp
DOSCODE:8894		     mov     ah, 1
DOSCODE:8896		     mov     dl, es:[bp+0]
DOSCODE:889A		     mov     cx, ds:DIRSTART
DOSCODE:889E		     mov     bp, bx
DOSCODE:88A0		     call    FastOpen_Update
DOSCODE:88A3		     pop     bp
DOSCODE:88A4		     pop     ax
DOSCODE:88A5		     pop     cx
DOSCODE:88A6 NOTFIRSTGROW:			     ; ...
DOSCODE:88A6		     mov     dx, bx
DOSCODE:88A8		     xor     bl, bl
DOSCODE:88AA		     call    FIGREC
DOSCODE:88AD GOTDIRREC:				     ; ...
DOSCODE:88AD		     mov     cl, es:[bp+4]
DOSCODE:88B1		     inc     cl
DOSCODE:88B3		     xor     ch, ch
DOSCODE:88B5 ZERODIR:				     ; ...
DOSCODE:88B5		     push    cx
DOSCODE:88B6		     mov     ds:ALLOWED, 18h
DOSCODE:88BB		     mov     al, 0FFh
DOSCODE:88BD		     call    GETBUFFR
DOSCODE:88C0		     jnb     short GET_SSIZE
DOSCODE:88C2		     pop     cx
DOSCODE:88C3		     retn
DOSCODE:88C4 GET_SSIZE:				     ; ...
DOSCODE:88C4		     mov     cx, es:[bp+2]
DOSCODE:88C8		     push    es
DOSCODE:88C9		     les     di, ds:CURBUF
DOSCODE:88CD		     or	     byte ptr es:[di+5], 4
DOSCODE:88D2		     push    di
DOSCODE:88D3		     add     di, 20
DOSCODE:88D6		     xor     ax, ax
DOSCODE:88D8		     shr     cx, 1
DOSCODE:88DA		     rep stosw
DOSCODE:88DC		     jnb     short EVENZ
DOSCODE:88DE		     stosb
DOSCODE:88DF EVENZ:				     ; ...
DOSCODE:88DF		     pop     di
DOSCODE:88E0		     test    byte ptr es:[di+5], 40h
DOSCODE:88E5		     jnz     short yesdirty7
DOSCODE:88E7		     call    INC_DIRTY_COUNT
DOSCODE:88EA		     or	     byte ptr es:[di+5], 40h
DOSCODE:88EF yesdirty7:				     ; ...
DOSCODE:88EF		     pop     es
DOSCODE:88F0		     pop     cx
DOSCODE:88F1		     add     dx, 1
DOSCODE:88F4		     adc     ds:HIGH_SECTOR, 0
DOSCODE:88F9		     loop    ZERODIR
DOSCODE:88FB		     mov     ax, ds:LASTENT
DOSCODE:88FE		     inc     ax
DOSCODE:88FF		     clc
DOSCODE:8900		     retn
DOSCODE:8900 BUILDDIR	     endp
DOSCODE:8901 ; =============== S U B R O U T I N E =======================================
DOSCODE:8901 SETDOTENT	     proc near		     ; ...
DOSCODE:8901		     stosw
DOSCODE:8902		     mov     cx, 4
DOSCODE:8905		     mov     ax, 2020h
DOSCODE:8908		     rep stosw
DOSCODE:890A		     stosb
DOSCODE:890B		     mov     al, 10h
DOSCODE:890D		     stosb
DOSCODE:890E		     add     di, 10
DOSCODE:8911		     mov     si, word ptr ds:THISSFT
DOSCODE:8915		     mov     ax, [si+0Dh]
DOSCODE:8918		     stosw
DOSCODE:8919		     mov     ax, [si+0Fh]
DOSCODE:891C		     stosw
DOSCODE:891D		     mov     ax, dx
DOSCODE:891F		     stosw
DOSCODE:8920		     xor     ax, ax
DOSCODE:8922		     stosw
DOSCODE:8923		     stosw
DOSCODE:8924		     retn
DOSCODE:8924 SETDOTENT	     endp
DOSCODE:8925 ; =============== S U B R O U T I N E =======================================
DOSCODE:8925 MakeNode	     proc near		     ; ...
DOSCODE:8925		     mov     word ptr ds:CREATING, 0E5FFh
DOSCODE:892B		     push    ax
DOSCODE:892C		     mov     ds:NoSetDir, 0
DOSCODE:8931		     mov     ds:SATTRIB, al
DOSCODE:8934		     call    GetPathNoSet
DOSCODE:8937		     mov     dl, cl
DOSCODE:8939		     mov     cx, ax
DOSCODE:893B		     pop     ax
DOSCODE:893C		     jnb     short make_exists
DOSCODE:893E		     jnz     short make_err_4
DOSCODE:8940		     cmp     dl, 80h
DOSCODE:8943		     jz	     short RENAME_MAKE
DOSCODE:8945 make_err_4:			     ; ...
DOSCODE:8945		     mov     al, 4
DOSCODE:8947 make_err_ret:			     ; ...
DOSCODE:8947		     xor     ah, ah
DOSCODE:8949		     stc
DOSCODE:894A		     retn
DOSCODE:894B RENAME_MAKE:			     ; ...
DOSCODE:894B		     test    ds:EXTOPEN_ON, 1
DOSCODE:8950		     jz	     short make_type2
DOSCODE:8952		     or	     ds:EXTOPEN_ON, 4
DOSCODE:8957		     test    byte ptr ds:EXTOPEN_FLAG, 0F0h
DOSCODE:895C		     jnz     short make_type2
DOSCODE:895E		     stc
DOSCODE:895F		     mov     ax, 7
DOSCODE:8962 make_retn:				     ; ...
DOSCODE:8962		     retn
DOSCODE:8963 make_type2:			     ; ...
DOSCODE:8963		     les     di, ds:THISSFT
DOSCODE:8967		     xor     ax, ax
DOSCODE:8969		     stc
DOSCODE:896A		     jmp     short make_new
DOSCODE:896C make_exists:			     ; ...
DOSCODE:896C		     jz	     short make_exists_dir
DOSCODE:896E		     mov     al, 3
DOSCODE:8970		     test    ds:ATTRIB,	18h
DOSCODE:8975		     jnz     short make_err_ret_5
DOSCODE:8977		     or	     ch, ch
DOSCODE:8979		     js	     short make_share
DOSCODE:897B		     or	     ah, ah
DOSCODE:897D		     jnz     short make_err_ret
DOSCODE:897F		     push    cx
DOSCODE:8980		     mov     es, word ptr ds:CURBUF+2
DOSCODE:8984		     mov     ch, es:[bx+0Bh]
DOSCODE:8988		     test    ch, 1
DOSCODE:898B		     jnz     short make_err_ret_5P
DOSCODE:898D		     call    MatchAttributes
DOSCODE:8990		     pop     cx
DOSCODE:8991		     jnz     short make_err_ret_5
DOSCODE:8993		     xor     al, al
DOSCODE:8995 make_share:			     ; ...
DOSCODE:8995		     xor     ah, ah
DOSCODE:8997		     push    ax
DOSCODE:8998		     push    cx
DOSCODE:8999		     mov     ah, ch
DOSCODE:899B		     call    DOOPEN
DOSCODE:899E		     les     di, ds:THISSFT
DOSCODE:89A2		     push    si
DOSCODE:89A3		     push    bx
DOSCODE:89A4		     call    ShareEnter
DOSCODE:89A7		     jnb     short MakeEndShare
DOSCODE:89A9		     pop     bx
DOSCODE:89AA		     pop     si
DOSCODE:89AB		     pop     cx
DOSCODE:89AC		     pop     ax
DOSCODE:89AD Make_Share_ret:			     ; ...
DOSCODE:89AD		     mov     al, 6
DOSCODE:89AF		     jmp     short make_err_ret
DOSCODE:89B1 make_err_ret_5P:			     ; ...
DOSCODE:89B1		     pop     cx
DOSCODE:89B2 make_err_ret_5:			     ; ...
DOSCODE:89B2		     mov     al, 5
DOSCODE:89B4		     jmp     short make_err_ret
DOSCODE:89B6 make_exists_dir:			     ; ...
DOSCODE:89B6		     mov     al, 1
DOSCODE:89B8		     jmp     short make_err_ret
DOSCODE:89BA make_save:				     ; ...
DOSCODE:89BA		     push    ax
DOSCODE:89BB		     mov     ax, cx
DOSCODE:89BD		     call    NEWENTRY
DOSCODE:89C0		     pop     ax
DOSCODE:89C1		     jnb     short make_retn
DOSCODE:89C3		     mov     al, 2
DOSCODE:89C5 make_save_retn:			     ; ...
DOSCODE:89C5		     retn
DOSCODE:89C6 make_new:				     ; ...
DOSCODE:89C6		     call    make_save
DOSCODE:89C9		     jb	     short make_save_retn
DOSCODE:89CB		     test    ds:ATTRIB,	10h
DOSCODE:89D0		     jnz     short make_save_retn
DOSCODE:89D2		     push    ax
DOSCODE:89D3		     push    bx
DOSCODE:89D4		     push    si
DOSCODE:89D5		     call    ShareEnter
DOSCODE:89D8		     pop     si
DOSCODE:89D9		     pop     bx
DOSCODE:89DA		     pop     ax
DOSCODE:89DB		     jnb     short make_save_retn
DOSCODE:89DD		     push    ax
DOSCODE:89DE		     les     di, ds:CURBUF
DOSCODE:89E2		     mov     byte ptr es:[bx], 0E5h
DOSCODE:89E6		     test    byte ptr es:[di+5], 40h
DOSCODE:89EB		     jnz     short yesdirty8
DOSCODE:89ED		     call    INC_DIRTY_COUNT
DOSCODE:89F0		     or	     byte ptr es:[di+5], 40h
DOSCODE:89F5 yesdirty8:				     ; ...
DOSCODE:89F5		     les     bp, ds:THISDPB
DOSCODE:89F9		     mov     al, es:[bp+0]
DOSCODE:89FD		     call    FLUSHBUF
DOSCODE:8A00		     pop     ax
DOSCODE:8A01		     jmp     short Make_Share_ret
DOSCODE:8A03 MakeEndShare:			     ; ...
DOSCODE:8A03		     les     di, ds:THISSFT
DOSCODE:8A07		     xor     ax, ax
DOSCODE:8A09		     call    ECritDisk
DOSCODE:8A0C		     xchg    ax, es:[di]
DOSCODE:8A0F		     push    ax
DOSCODE:8A10		     push    di
DOSCODE:8A11		     push    es
DOSCODE:8A12		     pushf
DOSCODE:8A13		     call    ShareEnd
DOSCODE:8A16		     popf
DOSCODE:8A17		     pop     es
DOSCODE:8A18		     pop     di
DOSCODE:8A19		     pop     word ptr es:[di]
DOSCODE:8A1C		     call    LCritDisk
DOSCODE:8A1F		     pop     bx
DOSCODE:8A20		     pop     si
DOSCODE:8A21		     pop     cx
DOSCODE:8A22		     pop     ax
DOSCODE:8A23		     call    make_save
DOSCODE:8A26		     jb	     short make_save_retn
DOSCODE:8A28		     push    ax
DOSCODE:8A29		     push    bx
DOSCODE:8A2A		     push    si
DOSCODE:8A2B		     pushf
DOSCODE:8A2C		     call    ShareEnter
DOSCODE:8A2F		     popf
DOSCODE:8A30		     pop     si
DOSCODE:8A31		     pop     bx
DOSCODE:8A32		     pop     ax
DOSCODE:8A33 makeendshare_retn:			     ; ...
DOSCODE:8A33		     retn
DOSCODE:8A33 MakeNode	     endp
DOSCODE:8A34 ; =============== S U B R O U T I N E =======================================
DOSCODE:8A34 NEWENTRY	     proc near		     ; ...
DOSCODE:8A34		     les     bp, ds:THISDPB
DOSCODE:8A38		     jnb     short EXISTENT
DOSCODE:8A3A		     cmp     ds:FAILERR, 0
DOSCODE:8A3F		     stc
DOSCODE:8A40		     jnz     short makeendshare_retn
DOSCODE:8A42		     call    BUILDDIR
DOSCODE:8A45		     jb	     short makeendshare_retn
DOSCODE:8A47		     call    GETENT
DOSCODE:8A4A		     jb	     short makeendshare_retn
DOSCODE:8A4C		     jmp     short FREESPOT
DOSCODE:8A4E ERRRET3:				     ; ...
DOSCODE:8A4E		     stc
DOSCODE:8A4F newentry_retn:			     ; ...
DOSCODE:8A4F		     retn
DOSCODE:8A50 EXISTENT:				     ; ...
DOSCODE:8A50		     or	     ah, ah
DOSCODE:8A52		     jns     short NOT_DEV1
DOSCODE:8A54		     jmp     DOOPEN
DOSCODE:8A57 NOT_DEV1:				     ; ...
DOSCODE:8A57		     call    FREEENT
DOSCODE:8A5A		     jb	     short newentry_retn
DOSCODE:8A5C FREESPOT:				     ; ...
DOSCODE:8A5C		     test    ds:ATTRIB,	8
DOSCODE:8A61		     jz	     short NOTVOLID
DOSCODE:8A63		     cmp     ds:VOLID, 0
DOSCODE:8A68		     jnz     short ERRRET3
DOSCODE:8A6A NOTVOLID:				     ; ...
DOSCODE:8A6A		     mov     es, word ptr ds:CURBUF+2
DOSCODE:8A6E		     mov     di, bx
DOSCODE:8A70		     mov     si, offset	NAME1
DOSCODE:8A73		     mov     cx, 5
DOSCODE:8A76		     rep movsw
DOSCODE:8A78		     movsb
DOSCODE:8A79		     mov     al, ds:ATTRIB
DOSCODE:8A7C		     stosb
DOSCODE:8A7D		     mov     cl, 5
DOSCODE:8A7F		     xor     ax, ax
DOSCODE:8A81		     rep stosw
DOSCODE:8A83		     call    DATE16
DOSCODE:8A86		     xchg    ax, dx
DOSCODE:8A87		     stosw
DOSCODE:8A88		     xchg    ax, dx
DOSCODE:8A89		     stosw
DOSCODE:8A8A		     xor     ax, ax
DOSCODE:8A8C		     push    di
DOSCODE:8A8D		     stosw
DOSCODE:8A8E		     stosw
DOSCODE:8A8F		     stosw
DOSCODE:8A90		     mov     si, word ptr ds:CURBUF
DOSCODE:8A94		     test    byte ptr es:[si+5], 40h
DOSCODE:8A99		     jnz     short yesdirty9
DOSCODE:8A9B		     call    INC_DIRTY_COUNT
DOSCODE:8A9E		     or	     byte ptr es:[si+5], 40h
DOSCODE:8AA3 yesdirty9:				     ; ...
DOSCODE:8AA3		     les     bp, ds:THISDPB
DOSCODE:8AA7		     mov     al, es:[bp+0]
DOSCODE:8AAB		     push    ax
DOSCODE:8AAC		     push    bx
DOSCODE:8AAD		     push    es
DOSCODE:8AAE		     push    di
DOSCODE:8AAF		     les     di, ds:THISSFT
DOSCODE:8AB3		     test    byte ptr es:[di+5], 80h
DOSCODE:8AB8		     jnz     short GotADevice
DOSCODE:8ABA		     push    ds
DOSCODE:8ABB		     push    bx
DOSCODE:8ABC		     lds     bx, ds:THISDPB
DOSCODE:8AC0		     mov     es:[di+7],	bx
DOSCODE:8AC4		     mov     bx, ds
DOSCODE:8AC6		     mov     es:[di+9],	bx
DOSCODE:8ACA		     pop     bx
DOSCODE:8ACB		     pop     ds
DOSCODE:8ACC		     call    DEV_OPEN_SFT
DOSCODE:8ACF		     mov     ds:VIRTUAL_OPEN, 1
DOSCODE:8AD4 GotADevice:			     ; ...
DOSCODE:8AD4		     pop     di
DOSCODE:8AD5		     pop     es
DOSCODE:8AD6		     call    FLUSHBUF
DOSCODE:8AD9		     call    CHECK_VIRT_OPEN
DOSCODE:8ADC		     pop     bx
DOSCODE:8ADD		     pop     ax
DOSCODE:8ADE		     pop     si
DOSCODE:8ADF		     mov     ah, al
DOSCODE:8AE1		     jnb     short DOOPEN
DOSCODE:8AE3		     retn
DOSCODE:8AE3 NEWENTRY	     endp
DOSCODE:8AE4 ; =============== S U B R O U T I N E =======================================
DOSCODE:8AE4 DOOPEN	     proc near		     ; ...
DOSCODE:8AE4		     mov     dh, ah
DOSCODE:8AE6		     les     di, ds:THISSFT
DOSCODE:8AEA		     add     di, 4
DOSCODE:8AED		     xor     al, al
DOSCODE:8AEF		     or	     dh, dh
DOSCODE:8AF1		     js	     short DEV_SFT1
DOSCODE:8AF3		     mov     ds, word ptr ds:CURBUF+2
DOSCODE:8AF7		     mov     al, [bx+0Bh]
DOSCODE:8AFA DEV_SFT1:				     ; ...
DOSCODE:8AFA		     stosb
DOSCODE:8AFB		     xor     ax, ax
DOSCODE:8AFD		     mov     al, dh
DOSCODE:8AFF		     or	     al, 40h
DOSCODE:8B01		     stosw
DOSCODE:8B02		     push    ds
DOSCODE:8B03		     lds     ax, [bx+1Ah]
DOSCODE:8B06		     or	     dh, dh
DOSCODE:8B08		     js	     short DEV_SFT2
DOSCODE:8B0A		     lds     ax, ss:THISDPB
DOSCODE:8B0F DEV_SFT2:				     ; ...
DOSCODE:8B0F		     stosw
DOSCODE:8B10		     mov     ax, ds
DOSCODE:8B12		     pop     ds
DOSCODE:8B13		     stosw
DOSCODE:8B14		     push    si
DOSCODE:8B15		     movsw
DOSCODE:8B16		     sub     si, 6
DOSCODE:8B19		     movsw
DOSCODE:8B1A		     movsw
DOSCODE:8B1B		     lodsw
DOSCODE:8B1C		     lodsw
DOSCODE:8B1D		     mov     cx, ax
DOSCODE:8B1F		     lodsw
DOSCODE:8B20		     or	     dh, dh
DOSCODE:8B22		     jns     short FILE_SFT1
DOSCODE:8B24		     xor     ax, ax
DOSCODE:8B26		     mov     cx, ax
DOSCODE:8B28 FILE_SFT1:				     ; ...
DOSCODE:8B28		     xchg    ax, cx
DOSCODE:8B29		     stosw
DOSCODE:8B2A		     xchg    ax, cx
DOSCODE:8B2B		     stosw
DOSCODE:8B2C		     xor     ax, ax
DOSCODE:8B2E		     stosw
DOSCODE:8B2F		     stosw
DOSCODE:8B30		     or	     dh, dh
DOSCODE:8B32		     js	     short DEV_SFT3
DOSCODE:8B34		     stosw
DOSCODE:8B35		     mov     ax, [bx+1Ah]
DOSCODE:8B38		     push    di
DOSCODE:8B39		     sub     di, 1Bh	     ; SF_ENTRY.sf_dirsec
DOSCODE:8B3C		     mov     es:[di+35h], ax
DOSCODE:8B40		     pop     di
DOSCODE:8B41		     push    ds
DOSCODE:8B42		     push    ss
DOSCODE:8B43		     pop     ds
DOSCODE:8B44		     test    ds:FastOpenFlg, 4
DOSCODE:8B49		     jz	     short Not_FastOpen
DOSCODE:8B4B		     mov     si, offset	FastOpen_Ext_Info
DOSCODE:8B4E		     mov     ax, [si+1]
DOSCODE:8B51		     stosw
DOSCODE:8B52		     mov     ax, [si+3]
DOSCODE:8B55		     stosw
DOSCODE:8B56		     mov     al, [si]
DOSCODE:8B58		     stosb
DOSCODE:8B59		     pop     ds
DOSCODE:8B5A		     jmp     short Next_Name
DOSCODE:8B5C Not_FastOpen:			     ; ...
DOSCODE:8B5C		     pop     ds
DOSCODE:8B5D		     mov     si, word ptr ss:CURBUF
DOSCODE:8B62		     mov     ax, [si+6]
DOSCODE:8B65		     stosw
DOSCODE:8B66		     mov     ax, [si+8]
DOSCODE:8B69		     stosw
DOSCODE:8B6A		     mov     ax, bx
DOSCODE:8B6C		     add     si, 20
DOSCODE:8B6F		     sub     ax, si
DOSCODE:8B71		     mov     cl, 32
DOSCODE:8B73		     div     cl
DOSCODE:8B75		     stosb
DOSCODE:8B76 Next_Name:				     ; ...
DOSCODE:8B76		     jmp     short FILE_SFT2
DOSCODE:8B78 DEV_SFT3:				     ; ...
DOSCODE:8B78		     add     di, 7
DOSCODE:8B7B FILE_SFT2:				     ; ...
DOSCODE:8B7B		     mov     si, bx
DOSCODE:8B7D		     mov     cx, 11
DOSCODE:8B80		     rep movsb
DOSCODE:8B82		     pop     si
DOSCODE:8B83		     push    ss
DOSCODE:8B84		     pop     ds
DOSCODE:8B85		     clc
DOSCODE:8B86		     retn
DOSCODE:8B86 DOOPEN	     endp
DOSCODE:8B87 ; =============== S U B R O U T I N E =======================================
DOSCODE:8B87 FREEENT	     proc near		     ; ...
DOSCODE:8B87		     push    ds
DOSCODE:8B88		     lds     di, ds:CURBUF
DOSCODE:8B8C		     mov     cx, [si]
DOSCODE:8B8E		     mov     dx, [di+8]
DOSCODE:8B91		     mov     ss:HIGH_SECTOR, dx
DOSCODE:8B96		     mov     dx, [di+6]
DOSCODE:8B99		     pop     ds
DOSCODE:8B9A		     cmp     cx, 2
DOSCODE:8B9D		     jb	     short RET1
DOSCODE:8B9F		     cmp     cx, es:[bp+0Dh]
DOSCODE:8BA3		     ja	     short RET1
DOSCODE:8BA5		     sub     bx, di
DOSCODE:8BA7		     push    bx
DOSCODE:8BA8		     push    ds:HIGH_SECTOR
DOSCODE:8BAC		     push    dx
DOSCODE:8BAD		     mov     bx, cx
DOSCODE:8BAF		     call    RELEASE
DOSCODE:8BB2		     pop     dx
DOSCODE:8BB3		     pop     ds:HIGH_SECTOR
DOSCODE:8BB7		     jnb     short GET_BUF_BACK
DOSCODE:8BB9		     pop     bx
DOSCODE:8BBA freeent_retn:			     ; ...
DOSCODE:8BBA		     retn
DOSCODE:8BBB GET_BUF_BACK:			     ; ...
DOSCODE:8BBB		     mov     ds:ALLOWED, 18h
DOSCODE:8BC0		     xor     al, al
DOSCODE:8BC2		     call    GETBUFFR
DOSCODE:8BC5		     pop     bx
DOSCODE:8BC6		     jb	     short freeent_retn
DOSCODE:8BC8		     call    SET_BUF_AS_DIR
DOSCODE:8BCB		     add     bx, word ptr ds:CURBUF
DOSCODE:8BCF		     mov     si, bx
DOSCODE:8BD1		     add     si, 1Ah
DOSCODE:8BD4 RET1:				     ; ...
DOSCODE:8BD4		     clc
DOSCODE:8BD5		     retn
DOSCODE:8BD5 FREEENT	     endp
DOSCODE:8BD6 ; =============== S U B R O U T I N E =======================================
DOSCODE:8BD6 CHECK_VIRT_OPEN proc near		     ; ...
DOSCODE:8BD6		     push    ax
DOSCODE:8BD7		     lahf
DOSCODE:8BD8		     cmp     ds:VIRTUAL_OPEN, 0
DOSCODE:8BDD		     jz	     short ALL_CLOSED
DOSCODE:8BDF		     mov     ds:VIRTUAL_OPEN, 0
DOSCODE:8BE4		     push    es
DOSCODE:8BE5		     push    di
DOSCODE:8BE6		     les     di, ds:THISSFT
DOSCODE:8BEA		     call    DEV_CLOSE_SFT
DOSCODE:8BED		     pop     di
DOSCODE:8BEE		     pop     es
DOSCODE:8BEF ALL_CLOSED:			     ; ...
DOSCODE:8BEF		     sahf
DOSCODE:8BF0		     pop     ax
DOSCODE:8BF1		     retn
DOSCODE:8BF1 CHECK_VIRT_OPEN endp
DOSCODE:8BF2 ; =============== S U B R O U T I N E =======================================
DOSCODE:8BF2 FNDCLUS	     proc near		     ; ...
DOSCODE:8BF2		     push    es
DOSCODE:8BF3		     les     di, ds:THISSFT
DOSCODE:8BF7		     mov     bx, es:[di+35h]
DOSCODE:8BFB		     mov     dx, es:[di+19h]
DOSCODE:8BFF		     or	     bx, bx
DOSCODE:8C01		     jz	     short NOCLUS
DOSCODE:8C03		     sub     cx, dx
DOSCODE:8C05		     jnb     short FINDIT
DOSCODE:8C07		     add     cx, dx
DOSCODE:8C09		     xor     dx, dx
DOSCODE:8C0B		     mov     bx, es:[di+0Bh]
DOSCODE:8C0F FINDIT:				     ; ...
DOSCODE:8C0F		     pop     es
DOSCODE:8C10		     jcxz    short RET9
DOSCODE:8C12 SKPCLP:				     ; ...
DOSCODE:8C12		     call    UNPACK
DOSCODE:8C15		     jb	     short fndclus_retn
DOSCODE:8C17		     xchg    bx, di
DOSCODE:8C19		     call    IsEOF
DOSCODE:8C1C		     xchg    bx, di
DOSCODE:8C1E		     jnb     short RET9
DOSCODE:8C20		     xchg    bx, di
DOSCODE:8C22		     inc     dx
DOSCODE:8C23		     loop    SKPCLP
DOSCODE:8C25 RET9:				     ; ...
DOSCODE:8C25		     clc
DOSCODE:8C26		     retn
DOSCODE:8C27 NOCLUS:				     ; ...
DOSCODE:8C27		     pop     es
DOSCODE:8C28		     inc     cx
DOSCODE:8C29		     dec     dx
DOSCODE:8C2A		     clc
DOSCODE:8C2B fndclus_retn:			     ; ...
DOSCODE:8C2B		     retn
DOSCODE:8C2B FNDCLUS	     endp
DOSCODE:8C2C ; =============== S U B R O U T I N E =======================================
DOSCODE:8C2C BUFSEC	     proc near		     ; ...
DOSCODE:8C2C		     mov     dx, ds:CLUSNUM
DOSCODE:8C30		     mov     bl, ds:SECCLUSPOS
DOSCODE:8C34		     mov     ds:ALLOWED, 38h
DOSCODE:8C39		     call    FIGREC
DOSCODE:8C3C		     call    GETBUFFR
DOSCODE:8C3F		     jb	     short fndclus_retn
DOSCODE:8C41		     mov     ds:TRANS, 1
DOSCODE:8C46		     mov     si, ds:NEXTADD
DOSCODE:8C4A		     mov     di, si
DOSCODE:8C4C		     mov     cx, ds:BYTCNT1
DOSCODE:8C50		     add     di, cx
DOSCODE:8C52		     mov     ds:NEXTADD, di
DOSCODE:8C56		     les     di, ds:CURBUF
DOSCODE:8C5A		     or	     byte ptr es:[di+5], 8
DOSCODE:8C5F		     lea     di, [di+20]
DOSCODE:8C62		     add     di, ds:BYTSECPOS
DOSCODE:8C66		     clc
DOSCODE:8C67		     retn
DOSCODE:8C67 BUFSEC	     endp
DOSCODE:8C68 ; =============== S U B R O U T I N E =======================================
DOSCODE:8C68 BUFRD	     proc near		     ; ...
DOSCODE:8C68		     push    es
DOSCODE:8C69		     xor     ax, ax
DOSCODE:8C6B		     call    BUFSEC
DOSCODE:8C6E		     jnb     short BUF_OK
DOSCODE:8C70 BUF_IO_FAIL:			     ; ...
DOSCODE:8C70		     pop     es
DOSCODE:8C71		     jmp     short RBUFPLACED
DOSCODE:8C73 BUF_OK:				     ; ...
DOSCODE:8C73		     mov     bx, es
DOSCODE:8C75		     mov     es, word ptr ds:DMAADD+2
DOSCODE:8C79		     mov     ds, bx
DOSCODE:8C7B		     xchg    di, si
DOSCODE:8C7D		     shr     cx, 1
DOSCODE:8C7F		     rep movsw
DOSCODE:8C81		     adc     cx, 0
DOSCODE:8C84		     rep movsb
DOSCODE:8C86		     pop     es
DOSCODE:8C87		     lds     di, ss:CURBUF
DOSCODE:8C8C		     lea     bx, [di+20]
DOSCODE:8C8F		     sub     si, bx
DOSCODE:8C91		     call    PLACEBUF
DOSCODE:8C94		     cmp     si, es:[bp+2]
DOSCODE:8C98		     jb	     short RBUFPLACEDC
DOSCODE:8C9A		     mov     word ptr ss:BufferQueue, di
DOSCODE:8C9F RBUFPLACEDC:			     ; ...
DOSCODE:8C9F		     clc
DOSCODE:8CA0 RBUFPLACED:			     ; ...
DOSCODE:8CA0		     push    ss
DOSCODE:8CA1		     pop     ds
DOSCODE:8CA2		     retn
DOSCODE:8CA2 BUFRD	     endp
DOSCODE:8CA3 ; =============== S U B R O U T I N E =======================================
DOSCODE:8CA3 BUFWRT	     proc near		     ; ...
DOSCODE:8CA3		     mov     ax, ds:SECPOS
DOSCODE:8CA6		     add     ax, 1
DOSCODE:8CA9		     mov     ds:SECPOS,	ax
DOSCODE:8CAC		     adc     ds:SECPOS+2, 0
DOSCODE:8CB1		     mov     ax, ds:SECPOS+2
DOSCODE:8CB4		     cmp     ax, ds:VALSEC+2
DOSCODE:8CB8		     mov     al, 1
DOSCODE:8CBA		     ja	     short NOREAD
DOSCODE:8CBC		     jb	     short _doread
DOSCODE:8CBE		     mov     ax, ds:SECPOS
DOSCODE:8CC1		     cmp     ax, ds:VALSEC
DOSCODE:8CC5		     mov     al, 1
DOSCODE:8CC7		     ja	     short NOREAD
DOSCODE:8CC9 _doread:				     ; ...
DOSCODE:8CC9		     xor     al, al
DOSCODE:8CCB NOREAD:				     ; ...
DOSCODE:8CCB		     push    es
DOSCODE:8CCC		     call    BUFSEC
DOSCODE:8CCF		     jb	     short BUF_IO_FAIL
DOSCODE:8CD1		     mov     ds, word ptr ds:DMAADD+2
DOSCODE:8CD5		     shr     cx, 1
DOSCODE:8CD7		     rep movsw
DOSCODE:8CD9		     adc     cx, 0
DOSCODE:8CDC		     rep movsb
DOSCODE:8CDE		     pop     es
DOSCODE:8CDF		     lds     bx, ss:CURBUF
DOSCODE:8CE4		     test    byte ptr [bx+5], 40h
DOSCODE:8CE8		     jnz     short yesdirty10
DOSCODE:8CEA		     call    INC_DIRTY_COUNT
DOSCODE:8CED		     or	     byte ptr [bx+5], 40h
DOSCODE:8CF1 yesdirty10:			     ; ...
DOSCODE:8CF1		     lea     si, [bx+20]
DOSCODE:8CF4		     sub     di, si
DOSCODE:8CF6		     cmp     di, es:[bp+2]
DOSCODE:8CFA		     jb	     short WBUFPLACED
DOSCODE:8CFC		     mov     word ptr ss:BufferQueue, bx
DOSCODE:8D01 WBUFPLACED:			     ; ...
DOSCODE:8D01		     clc
DOSCODE:8D02		     push    ss
DOSCODE:8D03		     pop     ds
DOSCODE:8D04		     retn
DOSCODE:8D04 BUFWRT	     endp
DOSCODE:8D05 ; =============== S U B R O U T I N E =======================================
DOSCODE:8D05 NEXTSEC	     proc near		     ; ...
DOSCODE:8D05		     test    ds:TRANS, 0FFh
DOSCODE:8D0A		     jz	     short CLRET
DOSCODE:8D0C		     mov     al, ds:SECCLUSPOS
DOSCODE:8D0F		     inc     al
DOSCODE:8D11		     cmp     al, es:[bp+4]
DOSCODE:8D15		     jbe     short SAVPOS
DOSCODE:8D17		     mov     bx, ds:CLUSNUM
DOSCODE:8D1B		     call    IsEOF
DOSCODE:8D1E		     jnb     short NONEXT
DOSCODE:8D20		     call    UNPACK
DOSCODE:8D23		     jb	     short NONEXT
DOSCODE:8D25		     mov     ds:CLUSNUM, di
DOSCODE:8D29		     inc     ds:LASTPOS
DOSCODE:8D2D		     mov     al, 0
DOSCODE:8D2F SAVPOS:				     ; ...
DOSCODE:8D2F		     mov     ds:SECCLUSPOS, al
DOSCODE:8D32 CLRET:				     ; ...
DOSCODE:8D32		     clc
DOSCODE:8D33		     retn
DOSCODE:8D34 NONEXT:				     ; ...
DOSCODE:8D34		     stc
DOSCODE:8D35		     retn
DOSCODE:8D35 NEXTSEC	     endp
DOSCODE:8D36 ; =============== S U B R O U T I N E =======================================
DOSCODE:8D36 OPTIMIZE	     proc near		     ; ...
DOSCODE:8D36		     push    dx
DOSCODE:8D37		     push    bx
DOSCODE:8D38		     mov     al, es:[bp+4]
DOSCODE:8D3C		     inc     al
DOSCODE:8D3E		     mov     ah, al
DOSCODE:8D40		     sub     al, dl
DOSCODE:8D42		     mov     dx, cx
DOSCODE:8D44		     mov     cx, 0
DOSCODE:8D47 OPTCLUS:				     ; ...
DOSCODE:8D47		     call    UNPACK
DOSCODE:8D4A		     jb	     short OP_ERR
DOSCODE:8D4C		     add     cl, al
DOSCODE:8D4E		     adc     ch, 0
DOSCODE:8D51		     cmp     cx, dx
DOSCODE:8D53		     jnb     short BLKDON
DOSCODE:8D55		     mov     al, ah
DOSCODE:8D57		     inc     bx
DOSCODE:8D58		     cmp     di, bx
DOSCODE:8D5A		     jz	     short OPTCLUS
DOSCODE:8D5C		     dec     bx
DOSCODE:8D5D FINCLUS:				     ; ...
DOSCODE:8D5D		     mov     ds:CLUSNUM, bx
DOSCODE:8D61		     sub     dx, cx
DOSCODE:8D63		     push    dx
DOSCODE:8D64		     mov     ax, cx
DOSCODE:8D66		     mul     word ptr es:[bp+2]
DOSCODE:8D6A		     mov     si, ds:NEXTADD
DOSCODE:8D6E		     add     ax, si
DOSCODE:8D70		     mov     ds:NEXTADD, ax
DOSCODE:8D73		     pop     ax
DOSCODE:8D74		     pop     dx
DOSCODE:8D75		     sub     bx, dx
DOSCODE:8D77		     add     ds:LASTPOS, bx
DOSCODE:8D7B		     pop     bx
DOSCODE:8D7C		     call    FIGREC
DOSCODE:8D7F		     mov     bx, si
DOSCODE:8D81		     clc
DOSCODE:8D82		     retn
DOSCODE:8D83 OP_ERR:				     ; ...
DOSCODE:8D83		     add     sp, 4
DOSCODE:8D86		     stc
DOSCODE:8D87		     retn
DOSCODE:8D88 BLKDON:				     ; ...
DOSCODE:8D88		     sub     cx, dx
DOSCODE:8D8A		     sub     ah, cl
DOSCODE:8D8C		     dec     ah
DOSCODE:8D8E		     mov     ds:SECCLUSPOS, ah
DOSCODE:8D92		     mov     cx, dx
DOSCODE:8D94		     jmp     short FINCLUS
DOSCODE:8D94 OPTIMIZE	     endp
DOSCODE:8D96 ; =============== S U B R O U T I N E =======================================
DOSCODE:8D96 FIGREC	     proc near		     ; ...
DOSCODE:8D96		     push    cx
DOSCODE:8D97		     mov     cl, es:[bp+5]
DOSCODE:8D9B		     dec     dx
DOSCODE:8D9C		     dec     dx
DOSCODE:8D9D		     mov     ss:HIGH_SECTOR, 0
DOSCODE:8DA4		     or	     cl, cl
DOSCODE:8DA6		     jz	     short noshift
DOSCODE:8DA8		     xor     ch, ch
DOSCODE:8DAA rotleft:				     ; ...
DOSCODE:8DAA		     clc
DOSCODE:8DAB		     rcl     dx, 1
DOSCODE:8DAD		     rcl     ss:HIGH_SECTOR, 1
DOSCODE:8DB2		     loop    rotleft
DOSCODE:8DB4 noshift:				     ; ...
DOSCODE:8DB4		     or	     dl, bl
DOSCODE:8DB6		     add     dx, es:[bp+0Bh]
DOSCODE:8DBA		     adc     ss:HIGH_SECTOR, 0
DOSCODE:8DC0		     pop     cx
DOSCODE:8DC1 figrec_retn:			     ; ...
DOSCODE:8DC1		     retn
DOSCODE:8DC1 FIGREC	     endp
DOSCODE:8DC2 ; =============== S U B R O U T I N E =======================================
DOSCODE:8DC2 callmagic	     proc far		     ; ...
DOSCODE:8DC2		     push    ds
DOSCODE:8DC3		     push    ss:OffsetMagicPatch
DOSCODE:8DC8		     retf
DOSCODE:8DC8 callmagic	     endp ; sp-analysis	failed
DOSCODE:8DC9 ; =============== S U B R O U T I N E =======================================
DOSCODE:8DC9 ALLOCATE	     proc near		     ; ...
DOSCODE:8DC9		     clc
DOSCODE:8DCA		     push    cs
DOSCODE:8DCB		     call    near ptr callmagic
DOSCODE:8DCE		     jnb     short Regular_Allocate_Path
DOSCODE:8DD0		     jmp     Disk_Full_Return
DOSCODE:8DD3 Regular_Allocate_Path:		     ; ...
DOSCODE:8DD3		     push    bx
DOSCODE:8DD4		     xor     bx, bx
DOSCODE:8DD6		     call    UNPACK
DOSCODE:8DD9		     mov     ds:FATBYT,	di
DOSCODE:8DDD		     pop     bx
DOSCODE:8DDE		     jb	     short figrec_retn
DOSCODE:8DE0		     push    cx
DOSCODE:8DE1		     push    bx
DOSCODE:8DE2		     mov     dx, bx
DOSCODE:8DE4		     mov     bx, es:[bp+1Dh]
DOSCODE:8DE8		     cmp     bx, 2
DOSCODE:8DEB		     ja	     short FINDFRE
DOSCODE:8DED ads1:				     ; ...
DOSCODE:8DED		     mov     word ptr es:[bp+1Dh], 2
DOSCODE:8DF3		     mov     bx, 1
DOSCODE:8DF6 FINDFRE:				     ; ...
DOSCODE:8DF6		     inc     bx
DOSCODE:8DF7		     cmp     bx, es:[bp+0Dh]
DOSCODE:8DFB		     ja	     short ads7
DOSCODE:8DFD		     call    UNPACK
DOSCODE:8E00		     jb	     short ads4
DOSCODE:8E02		     jnz     short FINDFRE
DOSCODE:8E04		     mov     es:[bp+1Dh], bx
DOSCODE:8E08		     xchg    ax, dx
DOSCODE:8E09		     mov     dx, 1
DOSCODE:8E0C		     call    PACK
DOSCODE:8E0F		     jb	     short ads4
DOSCODE:8E11		     cmp     word ptr es:[bp+1Fh], 0FFFFh
DOSCODE:8E16		     jz	     short NO_ALLOC
DOSCODE:8E18		     dec     word ptr es:[bp+1Fh]
DOSCODE:8E1C NO_ALLOC:				     ; ...
DOSCODE:8E1C		     xchg    ax, dx
DOSCODE:8E1D		     xchg    bx, dx
DOSCODE:8E1F		     mov     ax, dx
DOSCODE:8E21		     call    PACK
DOSCODE:8E24		     jb	     short ads4
DOSCODE:8E26		     xchg    ax, bx
DOSCODE:8E27		     mov     dx, bx
DOSCODE:8E29		     loop    FINDFRE
DOSCODE:8E2B		     mov     dx, 0FFFFh
DOSCODE:8E2E		     call    PACK
DOSCODE:8E31 ads4:				     ; ...
DOSCODE:8E31		     pop     bx
DOSCODE:8E32		     pop     cx
DOSCODE:8E33		     jb	     short figrec_retn
DOSCODE:8E35		     call    UNPACK
DOSCODE:8E38		     jb	     short figrec_retn
DOSCODE:8E3A		     call    RESTFATBYT
DOSCODE:8E3D		     jb	     short figrec_retn
DOSCODE:8E3F		     xchg    bx, di
DOSCODE:8E41		     or	     di, di
DOSCODE:8E43		     jz	     short dofastk
DOSCODE:8E45		     retn
DOSCODE:8E46 dofastk:				     ; ...
DOSCODE:8E46		     push    dx
DOSCODE:8E47		     mov     dl, es:[bp+0]
DOSCODE:8E4B		     push    es
DOSCODE:8E4C		     les     di, ds:THISSFT
DOSCODE:8E50		     mov     es:[di+0Bh], bx
DOSCODE:8E54		     mov     es:[di+35h], bx
DOSCODE:8E58		     pop     es
DOSCODE:8E59		     pop     dx
DOSCODE:8E5A		     retn
DOSCODE:8E5B ads7:				     ; ...
DOSCODE:8E5B		     cmp     word ptr es:[bp+1Dh], 2
DOSCODE:8E60		     jnz     short ads1
DOSCODE:8E62		     pop     bx
DOSCODE:8E63		     mov     dx, 0FFFFh
DOSCODE:8E66		     call    RELBLKS
DOSCODE:8E69		     pop     ax
DOSCODE:8E6A		     sub     ax, cx
DOSCODE:8E6C		     call    RESTFATBYT
DOSCODE:8E6F Disk_Full_Return:			     ; ...
DOSCODE:8E6F		     mov     ds:DISK_FULL, 1
DOSCODE:8E74		     stc
DOSCODE:8E75		     retn
DOSCODE:8E75 ALLOCATE	     endp
DOSCODE:8E76 ; =============== S U B R O U T I N E =======================================
DOSCODE:8E76 RESTFATBYT	     proc near		     ; ...
DOSCODE:8E76		     push    bx
DOSCODE:8E77		     push    dx
DOSCODE:8E78		     push    di
DOSCODE:8E79		     xor     bx, bx
DOSCODE:8E7B		     mov     dx, ds:FATBYT
DOSCODE:8E7F		     call    PACK
DOSCODE:8E82		     pop     di
DOSCODE:8E83		     pop     dx
DOSCODE:8E84		     pop     bx
DOSCODE:8E85		     retn
DOSCODE:8E85 RESTFATBYT	     endp
DOSCODE:8E86 ; =============== S U B R O U T I N E =======================================
DOSCODE:8E86 RELEASE	     proc near		     ; ...
DOSCODE:8E86		     xor     dx, dx
DOSCODE:8E88 RELBLKS:				     ; ...
DOSCODE:8E88		     call    UNPACK
DOSCODE:8E8B		     jb	     short RELEASE_flush
DOSCODE:8E8D		     jz	     short RELEASE_flush
DOSCODE:8E8F		     mov     ax, di
DOSCODE:8E91		     push    dx
DOSCODE:8E92		     call    PACK
DOSCODE:8E95		     pop     dx
DOSCODE:8E96		     jb	     short RELEASE_flush
DOSCODE:8E98		     or	     dx, dx
DOSCODE:8E9A		     jnz     short NO_DEALLOC
DOSCODE:8E9C		     cmp     word ptr es:[bp+1Fh], -1
DOSCODE:8EA1		     jz	     short NO_DEALLOC
DOSCODE:8EA3		     inc     word ptr es:[bp+1Fh]
DOSCODE:8EA7 NO_DEALLOC:			     ; ...
DOSCODE:8EA7		     mov     bx, ax
DOSCODE:8EA9		     dec     ax
DOSCODE:8EAA		     jz	     short RELEASE_flush
DOSCODE:8EAC		     call    IsEOF
DOSCODE:8EAF		     jb	     short RELEASE
DOSCODE:8EB1 RELEASE_flush:			     ; ...
DOSCODE:8EB1		     mov     al, es:[bp+0]
DOSCODE:8EB5		     push    si
DOSCODE:8EB6		     push    cx
DOSCODE:8EB7		     push    es
DOSCODE:8EB8		     push    bp
DOSCODE:8EB9		     call    FLUSHBUF
DOSCODE:8EBC		     pop     bp
DOSCODE:8EBD		     pop     es
DOSCODE:8EBE		     pop     cx
DOSCODE:8EBF		     pop     si
DOSCODE:8EC0 RET12:				     ; ...
DOSCODE:8EC0		     retn
DOSCODE:8EC0 RELEASE	     endp
DOSCODE:8EC1 ; =============== S U B R O U T I N E =======================================
DOSCODE:8EC1 GETEOF	     proc near		     ; ...
DOSCODE:8EC1		     call    UNPACK
DOSCODE:8EC4		     jb	     short RET12
DOSCODE:8EC6		     push    bx
DOSCODE:8EC7		     mov     bx, di
DOSCODE:8EC9		     call    IsEOF
DOSCODE:8ECC		     pop     bx
DOSCODE:8ECD		     jnb     short RET12
DOSCODE:8ECF		     mov     bx, di
DOSCODE:8ED1		     jmp     short GETEOF
DOSCODE:8ED1 GETEOF	     endp
DOSCODE:8ED3 ; =============== S U B R O U T I N E =======================================
DOSCODE:8ED3 MAKEFCB	     proc near		     ; ...
DOSCODE:8ED3		     mov     ss:SpaceFlag, 0
DOSCODE:8ED9		     xor     dl, dl
DOSCODE:8EDB		     test    al, 2
DOSCODE:8EDD		     jnz     short DEFDRV
DOSCODE:8EDF		     mov     byte ptr es:[di], 0
DOSCODE:8EE3 DEFDRV:				     ; ...
DOSCODE:8EE3		     inc     di
DOSCODE:8EE4		     mov     cx, 8
DOSCODE:8EE7		     test    al, 4
DOSCODE:8EE9		     xchg    ax, bx
DOSCODE:8EEA		     mov     al, ' '
DOSCODE:8EEC		     jz	     short FILLB
DOSCODE:8EEE		     add     di, cx
DOSCODE:8EF0		     xor     cx, cx
DOSCODE:8EF2 FILLB:				     ; ...
DOSCODE:8EF2		     rep stosb
DOSCODE:8EF4		     mov     cl, 3
DOSCODE:8EF6		     test    bl, 8
DOSCODE:8EF9		     jz	     short FILLB2
DOSCODE:8EFB		     add     di, cx
DOSCODE:8EFD		     xor     cx, cx
DOSCODE:8EFF FILLB2:				     ; ...
DOSCODE:8EFF		     rep stosb
DOSCODE:8F01		     xchg    ax, cx
DOSCODE:8F02		     stosw
DOSCODE:8F03		     stosw
DOSCODE:8F04		     sub     di, 16
DOSCODE:8F07		     test    bl, 1
DOSCODE:8F0A		     jz	     short SKPSPC
DOSCODE:8F0C		     call    SCANB
DOSCODE:8F0F		     call    DELIM
DOSCODE:8F12		     jnz     short NOSCAN
DOSCODE:8F14		     inc     si
DOSCODE:8F15 SKPSPC:				     ; ...
DOSCODE:8F15		     call    SCANB
DOSCODE:8F18 NOSCAN:				     ; ...
DOSCODE:8F18		     call    GETLET
DOSCODE:8F1B		     jbe     short NODRV
DOSCODE:8F1D		     cmp     byte ptr [si], ':'
DOSCODE:8F20		     jnz     short NODRV
DOSCODE:8F22		     inc     si
DOSCODE:8F23		     sub     al, '@'
DOSCODE:8F25		     jbe     short BADDRV
DOSCODE:8F27		     push    ax
DOSCODE:8F28		     call    GetVisDrv
DOSCODE:8F2B		     pop     ax
DOSCODE:8F2C		     jnb     short HAVDRV
DOSCODE:8F2E		     cmp     ss:DrvErr,	1Ah
DOSCODE:8F34		     jz	     short HAVDRV
DOSCODE:8F36 BADDRV:				     ; ...
DOSCODE:8F36		     mov     dl, -1
DOSCODE:8F38 HAVDRV:				     ; ...
DOSCODE:8F38		     stosb
DOSCODE:8F39		     inc     si
DOSCODE:8F3A		     dec     di
DOSCODE:8F3B NODRV:				     ; ...
DOSCODE:8F3B		     dec     si
DOSCODE:8F3C		     inc     di
DOSCODE:8F3D NORMSCAN:				     ; ...
DOSCODE:8F3D		     mov     cx, 8
DOSCODE:8F40		     call    GETWORD
DOSCODE:8F43		     cmp     byte ptr [si], '.'
DOSCODE:8F46		     jnz     short NODOT
DOSCODE:8F48		     inc     si
DOSCODE:8F49		     test    byte ptr ss:DOS34_FLAG+1, 1
DOSCODE:8F4F		     jz	     short VOLOK
DOSCODE:8F51		     movsb
DOSCODE:8F52		     mov     cx, 2
DOSCODE:8F55		     jmp     short contvol
DOSCODE:8F57 VOLOK:				     ; ...
DOSCODE:8F57		     mov     cx, 3
DOSCODE:8F5A contvol:				     ; ...
DOSCODE:8F5A		     call    MUSTGETWORD
DOSCODE:8F5D NODOT:				     ; ...
DOSCODE:8F5D		     mov     al, dl
DOSCODE:8F5F		     and     ss:DOS34_FLAG, 0FEFFh
DOSCODE:8F66		     retn
DOSCODE:8F66 MAKEFCB	     endp
DOSCODE:8F67 ; START OF	FUNCTION CHUNK FOR GETWORD
DOSCODE:8F67 NONAM:				     ; ...
DOSCODE:8F67		     add     di, cx
DOSCODE:8F69		     dec     si
DOSCODE:8F6A		     retn
DOSCODE:8F6A ; END OF FUNCTION CHUNK FOR GETWORD
DOSCODE:8F6B ; =============== S U B R O U T I N E =======================================
DOSCODE:8F6B GETWORD	     proc near		     ; ...
DOSCODE:8F6B ; FUNCTION	CHUNK AT DOSCODE:8F67 SIZE 00000004 BYTES
DOSCODE:8F6B		     call    GETLET
DOSCODE:8F6E		     jbe     short NONAM
DOSCODE:8F70		     dec     si
DOSCODE:8F71 MUSTGETWORD:			     ; ...
DOSCODE:8F71		     call    GETLET
DOSCODE:8F74		     jnz     short MustCheckCX
DOSCODE:8F76		     test    ss:SpaceFlag, 0FFh
DOSCODE:8F7C		     jz	     short FILLNAM
DOSCODE:8F7E		     cmp     al, ' '
DOSCODE:8F80		     jnz     short FILLNAM
DOSCODE:8F82 MustCheckCX:			     ; ...
DOSCODE:8F82		     jcxz    short MUSTGETWORD
DOSCODE:8F84		     dec     cx
DOSCODE:8F85		     cmp     al, '*'
DOSCODE:8F87		     jnz     short NOSTAR
DOSCODE:8F89		     mov     al, '?'
DOSCODE:8F8B		     rep stosb
DOSCODE:8F8D NOSTAR:				     ; ...
DOSCODE:8F8D		     stosb
DOSCODE:8F8E		     cmp     al, '?'
DOSCODE:8F90		     jnz     short MUSTGETWORD
DOSCODE:8F92		     or	     dl, 1
DOSCODE:8F95		     jmp     short MUSTGETWORD
DOSCODE:8F97 FILLNAM:				     ; ...
DOSCODE:8F97		     mov     al, ' '
DOSCODE:8F99		     rep stosb
DOSCODE:8F9B		     dec     si
DOSCODE:8F9C		     retn
DOSCODE:8F9C GETWORD	     endp
DOSCODE:8F9D ; =============== S U B R O U T I N E =======================================
DOSCODE:8F9D SCANB	     proc near		     ; ...
DOSCODE:8F9D		     lodsb
DOSCODE:8F9E		     call    SPCHK
DOSCODE:8FA1		     jz	     short SCANB
DOSCODE:8FA3		     dec     si
DOSCODE:8FA4 scanb_retn:			     ; ...
DOSCODE:8FA4		     retn
DOSCODE:8FA4 SCANB	     endp
DOSCODE:8FA5 ; =============== S U B R O U T I N E =======================================
DOSCODE:8FA5 NAMETRANS	     proc near		     ; ...
DOSCODE:8FA5		     mov     ss:SpaceFlag, 1
DOSCODE:8FAB		     push    ss
DOSCODE:8FAC		     pop     es
DOSCODE:8FAD		     mov     di, offset	NAME1
DOSCODE:8FB0		     push    di
DOSCODE:8FB1		     mov     ax, '  '
DOSCODE:8FB4		     mov     cx, 5
DOSCODE:8FB7		     stosb
DOSCODE:8FB8		     rep stosw
DOSCODE:8FBA		     xor     al, al
DOSCODE:8FBC		     mov     dl, al
DOSCODE:8FBE		     stosb
DOSCODE:8FBF		     pop     di
DOSCODE:8FC0		     call    NORMSCAN
DOSCODE:8FC3		     cmp     ss:NAME1, 0E5h
DOSCODE:8FC9		     jnz     short scanb_retn
DOSCODE:8FCB		     mov     ss:NAME1, 5
DOSCODE:8FD1		     retn
DOSCODE:8FD1 NAMETRANS	     endp
DOSCODE:8FD2 CharType	     db	4 dup(66h), 6, 0Bh dup(66h), 0F8h, 0F6h, 3 dup(0FFh) ; ...
DOSCODE:8FD2		     db	4Fh, 0F4h, 6Eh,	5 dup(0FFh), 2 dup(44h), 0F4h, 0Dh dup(0FFh)
DOSCODE:8FD2		     db	6Fh, 66h, 0Fh dup(0FFh), 0F4h
DOSCODE:9011 ; =============== S U B R O U T I N E =======================================
DOSCODE:9011 GETLET	     proc near		     ; ...
DOSCODE:9011		     lodsb
DOSCODE:9011 GETLET	     endp
DOSCODE:9012 ; =============== S U B R O U T I N E =======================================
DOSCODE:9012 UCase	     proc near		     ; ...
DOSCODE:9012		     push    bx
DOSCODE:9013		     mov     bx, offset	FILE_UCASE_TAB_2
DOSCODE:9016 gl_0:				     ; ...
DOSCODE:9016		     cmp     al, 'a'
DOSCODE:9018		     jb	     short gl_2
DOSCODE:901A		     cmp     al, 'z'
DOSCODE:901C		     ja	     short gl_1
DOSCODE:901E		     sub     al, 20h
DOSCODE:9020 gl_1:				     ; ...
DOSCODE:9020		     cmp     al, 80h
DOSCODE:9022		     jb	     short gl_2
DOSCODE:9024		     sub     al, 80h
DOSCODE:9026		     push    ds
DOSCODE:9027		     mov     ds, cs:DosDSeg
DOSCODE:902C		     xlat
DOSCODE:902D		     pop     ds
DOSCODE:902E gl_2:				     ; ...
DOSCODE:902E		     push    ax
DOSCODE:902F		     call    GetCharType
DOSCODE:9032		     test    al, 1
DOSCODE:9034		     pop     ax
DOSCODE:9035		     pop     bx
DOSCODE:9036		     retn
DOSCODE:9036 UCase	     endp
DOSCODE:9037 ; =============== S U B R O U T I N E =======================================
DOSCODE:9037 GETLET3	     proc near		     ; ...
DOSCODE:9037		     push    bx
DOSCODE:9038		     jmp     short gl_0
DOSCODE:9038 GETLET3	     endp
DOSCODE:903A ; =============== S U B R O U T I N E =======================================
DOSCODE:903A DELIM	     proc near		     ; ...
DOSCODE:903A		     push    ax
DOSCODE:903B		     call    GetCharType
DOSCODE:903E		     test    al, 2
DOSCODE:9040		     pop     ax
DOSCODE:9041		     retn
DOSCODE:9041 DELIM	     endp
DOSCODE:9042 ; =============== S U B R O U T I N E =======================================
DOSCODE:9042 SPCHK	     proc near		     ; ...
DOSCODE:9042		     push    ax
DOSCODE:9043		     call    GetCharType
DOSCODE:9046		     test    al, 4
DOSCODE:9048		     pop     ax
DOSCODE:9049		     retn
DOSCODE:9049 SPCHK	     endp
DOSCODE:904A ; =============== S U B R O U T I N E =======================================
DOSCODE:904A GetCharType     proc near		     ; ...
DOSCODE:904A		     cmp     al, 7Eh
DOSCODE:904C		     jnb     short gct_90
DOSCODE:904E		     push    bx
DOSCODE:904F		     mov     bx, offset	CharType
DOSCODE:9052		     shr     al, 1
DOSCODE:9054		     xlat    byte ptr cs:[bx]
DOSCODE:9056		     pop     bx
DOSCODE:9057		     jnb     short gct_80
DOSCODE:9059		     shr     al, 1
DOSCODE:905B		     shr     al, 1
DOSCODE:905D		     shr     al, 1
DOSCODE:905F		     shr     al, 1
DOSCODE:9061 gct_80:				     ; ...
DOSCODE:9061		     and     al, 0Fh
DOSCODE:9063		     retn
DOSCODE:9064 gct_90:				     ; ...
DOSCODE:9064		     mov     al, 0Fh
DOSCODE:9066		     retn
DOSCODE:9066 GetCharType     endp
DOSCODE:9067 ; =============== S U B R O U T I N E =======================================
DOSCODE:9067 PATHCHRCMP	     proc near		     ; ...
DOSCODE:9067		     cmp     al, '/'
DOSCODE:9069		     jbe     short PathRet
DOSCODE:906B		     cmp     al, '\'
DOSCODE:906D		     retn
DOSCODE:906E GotFor:				     ; ...
DOSCODE:906E		     mov     al, '\'
DOSCODE:9070		     retn
DOSCODE:9071 PathRet:				     ; ...
DOSCODE:9071		     jz	     short GotFor
DOSCODE:9073		     retn
DOSCODE:9073 PATHCHRCMP	     endp
DOSCODE:9074 LowInt23Addr    dd	offset LowInt23	     ; ...
DOSCODE:9078 LowInt24Addr    dd	offset LowInt24	     ; ...
DOSCODE:907C LowInt28Addr    dd	offset LowInt28	     ; ...
DOSCODE:9080 ; =============== S U B R O U T I N E =======================================
DOSCODE:9080 DSKSTATCHK	     proc far		     ; ...
DOSCODE:9080		     cmp     ss:INDOS, 1
DOSCODE:9086		     jz	     short dskstatchk1
DOSCODE:9088		     retn
DOSCODE:9089 dskstatchk1:			     ; ...
DOSCODE:9089		     push    cx
DOSCODE:908A		     push    es
DOSCODE:908B		     push    bx
DOSCODE:908C		     push    ds
DOSCODE:908D		     push    si
DOSCODE:908E		     mov     bx, ss
DOSCODE:9090		     mov     es, bx
DOSCODE:9092		     mov     ds, bx
DOSCODE:9094		     mov     ss:DSKSTCOM, 5
DOSCODE:909A		     mov     ss:DSKSTCALL, 0Eh
DOSCODE:90A0		     mov     ss:DSKSTST, 0
DOSCODE:90A7		     mov     bx, offset	DSKSTCALL
DOSCODE:90AA		     lds     si, ss:BCON
DOSCODE:90AF		     call    DEVIOCALL2
DOSCODE:90B2		     test    byte ptr ss:DSKSTST+1, 2
DOSCODE:90B8		     jz	     short _GotCh
DOSCODE:90BA		     xor     al, al
DOSCODE:90BC RET36:				     ; ...
DOSCODE:90BC		     pop     si
DOSCODE:90BD		     pop     ds
DOSCODE:90BE		     pop     bx
DOSCODE:90BF		     pop     es
DOSCODE:90C0		     pop     cx
DOSCODE:90C1		     retn
DOSCODE:90C2 _GotCh:				     ; ...
DOSCODE:90C2		     mov     al, ss:DSKCHRET
DOSCODE:90C6		     cmp     al, 3
DOSCODE:90C8		     jnz     short RET36
DOSCODE:90CA		     mov     ss:DSKSTCOM, 4
DOSCODE:90D0		     mov     ss:DSKSTCALL, 16h
DOSCODE:90D6		     mov     ss:DSKCHRET, cl
DOSCODE:90DB		     mov     ss:DSKSTST, 0
DOSCODE:90E2		     mov     ss:DSKSTCNT, 1
DOSCODE:90E9		     call    DEVIOCALL2
DOSCODE:90EC		     pop     si
DOSCODE:90ED		     pop     ds
DOSCODE:90EE		     pop     bx
DOSCODE:90EF		     pop     es
DOSCODE:90F0		     pop     cx
DOSCODE:90F1		     jmp     CNTCHAND
DOSCODE:90F1 DSKSTATCHK	     endp
DOSCODE:90F4 ; START OF	FUNCTION CHUNK FOR STATCHK
DOSCODE:90F4 NOSTOP:				     ; ...
DOSCODE:90F4		     cmp     al, 10h	     ; "P"-"@"
DOSCODE:90F6		     jnz     short check_next
DOSCODE:90F8		     cmp     ss:SCAN_FLAG, 0
DOSCODE:90FE		     jz	     short INCHKJ
DOSCODE:9100		     retn
DOSCODE:9101 check_next:			     ; ...
DOSCODE:9101		     cmp     al, 3	     ; "C"-"@"
DOSCODE:9103		     jz	     short INCHKJ
DOSCODE:9105 check_end:				     ; ...
DOSCODE:9105		     retn
DOSCODE:9106 INCHKJ:				     ; ...
DOSCODE:9106		     jmp     INCHK
DOSCODE:9106 ; END OF FUNCTION CHUNK FOR STATCHK
DOSCODE:9109 ; =============== S U B R O U T I N E =======================================
DOSCODE:9109 SPOOLINT	     proc near		     ; ...
DOSCODE:9109		     pushf
DOSCODE:910A		     cmp     ss:IDLEINT, 0
DOSCODE:9110		     jz	     short POPFRET
DOSCODE:9112		     cmp     ss:ERRORMODE, 0
DOSCODE:9118		     jnz     short POPFRET
DOSCODE:911A		     push    word ptr ss:IDLEINT
DOSCODE:911F		     cmp     ss:DosHasHMA, 0
DOSCODE:9125		     jnz     short do_low_int28
DOSCODE:9127		     int     28h	     ; DOS 2+ internal - KEYBOARD BUSY LOOP
DOSCODE:9129		     jmp     short spool_ret_addr
DOSCODE:912B do_low_int28:			     ; ...
DOSCODE:912B		     call    cs:LowInt28Addr
DOSCODE:9130 spool_ret_addr:			     ; ...
DOSCODE:9130		     pop     word ptr ss:IDLEINT
DOSCODE:9135 POPFRET:				     ; ...
DOSCODE:9135		     popf
DOSCODE:9136 _RET18:				     ; ...
DOSCODE:9136		     retn
DOSCODE:9136 SPOOLINT	     endp
DOSCODE:9137 ; =============== S U B R O U T I N E =======================================
DOSCODE:9137 STATCHK	     proc far		     ; ...
DOSCODE:9137 ; FUNCTION	CHUNK AT DOSCODE:4052 SIZE 0000007A BYTES
DOSCODE:9137 ; FUNCTION	CHUNK AT DOSCODE:40D0 SIZE 00000003 BYTES
DOSCODE:9137 ; FUNCTION	CHUNK AT DOSCODE:40F8 SIZE 00000154 BYTES
DOSCODE:9137 ; FUNCTION	CHUNK AT DOSCODE:90F4 SIZE 00000015 BYTES
DOSCODE:9137		     call    near ptr DSKSTATCHK
DOSCODE:913A		     push    bx
DOSCODE:913B		     xor     bx, bx
DOSCODE:913D		     call    GET_IO_SFT
DOSCODE:9140		     pop     bx
DOSCODE:9141		     jb	     short _RET18
DOSCODE:9143		     mov     ah, 1
DOSCODE:9145		     call    IOFUNC
DOSCODE:9148		     jz	     short SPOOLINT
DOSCODE:914A		     cmp     al, 13h	     ; 'S'-'@'
DOSCODE:914C		     jnz     short NOSTOP
DOSCODE:914E		     cmp     ss:SCAN_FLAG, 0
DOSCODE:9154		     jnz     short check_end
DOSCODE:9156		     xor     ah, ah
DOSCODE:9158		     call    IOFUNC
DOSCODE:915B		     jmp     short PAUSOSTRT
DOSCODE:915D PRINTONOFF:			     ; ...
DOSCODE:915D		     not     ss:PFLAG
DOSCODE:9162		     push    bx
DOSCODE:9163		     mov     bx, 4
DOSCODE:9166		     call    GET_IO_SFT
DOSCODE:9169		     pop     bx
DOSCODE:916A		     jb	     short _RET18
DOSCODE:916C		     push    es
DOSCODE:916D		     push    di
DOSCODE:916E		     push    ds
DOSCODE:916F		     pop     es
DOSCODE:9170		     mov     di, si
DOSCODE:9172		     test    byte ptr es:[di+6], 8
DOSCODE:9177		     jz	     short NORM_PR
DOSCODE:9179		     push    ax
DOSCODE:917A		     mov     ax, 1126h
DOSCODE:917D		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	???
DOSCODE:917D					     ; Return: CF set on error,	AX = error code
DOSCODE:917D					     ; STACK unchanged
DOSCODE:917F		     pop     ax
DOSCODE:9180		     jnb     short NORM_PR
DOSCODE:9182		     mov     ss:PFLAG, 0
DOSCODE:9188		     push    ax
DOSCODE:9189		     mov     ax, 1124h
DOSCODE:918C		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	???
DOSCODE:918C					     ; ES:DI ->	SFT, SS	= DOS CS
DOSCODE:918E		     pop     ax
DOSCODE:918F		     jmp     short RETP6
DOSCODE:9191 NORM_PR:				     ; ...
DOSCODE:9191		     cmp     ss:PFLAG, 0
DOSCODE:9197		     jnz     short PRNOPN
DOSCODE:9199		     call    DEV_CLOSE_SFT
DOSCODE:919C		     jmp     short RETP6
DOSCODE:919E PRNOPN:				     ; ...
DOSCODE:919E		     call    DEV_OPEN_SFT
DOSCODE:91A1 RETP6:				     ; ...
DOSCODE:91A1		     pop     di
DOSCODE:91A2		     pop     es
DOSCODE:91A3 STATCHK_RETN:			     ; ...
DOSCODE:91A3		     retn
DOSCODE:91A4 PAUSOLP:				     ; ...
DOSCODE:91A4		     call    SPOOLINT
DOSCODE:91A7 PAUSOSTRT:				     ; ...
DOSCODE:91A7		     mov     ah, 1
DOSCODE:91A9		     call    IOFUNC
DOSCODE:91AC		     jz	     short PAUSOLP
DOSCODE:91AE INCHK:				     ; ...
DOSCODE:91AE		     push    bx
DOSCODE:91AF		     xor     bx, bx
DOSCODE:91B1		     call    GET_IO_SFT
DOSCODE:91B4		     pop     bx
DOSCODE:91B5		     jb	     short STATCHK_RETN
DOSCODE:91B7		     xor     ah, ah
DOSCODE:91B9		     call    IOFUNC
DOSCODE:91BC		     cmp     al, 10h	     ; "P"-"@"
DOSCODE:91BE		     jz	     short PRINTONOFF
DOSCODE:91C0		     cmp     al, 3	     ; "C"-"@"
DOSCODE:91C2		     jnz     short STATCHK_RETN
DOSCODE:91C4 CNTCHAND:				     ; ...
DOSCODE:91C4		     test    byte ptr ss:DOS34_FLAG+1, 2
DOSCODE:91CA		     jnz     short around_deadlock
DOSCODE:91CC		     mov     al, 3
DOSCODE:91CE		     call    BUFOUT
DOSCODE:91D1		     call    CRLF
DOSCODE:91D4 around_deadlock:			     ; ...
DOSCODE:91D4		     push    ss
DOSCODE:91D5		     pop     ds
DOSCODE:91D6		     cmp     ds:CONSWAP, 0
DOSCODE:91DB		     jz	     short NOSWAP
DOSCODE:91DD		     call    SWAPBACK
DOSCODE:91E0 NOSWAP:				     ; ...
DOSCODE:91E0		     cli
DOSCODE:91E1		     mov     ss, ds:USER_SS
DOSCODE:91E5		     mov     sp, ds:USER_SP
DOSCODE:91E9		     call    restore_world
DOSCODE:91EC		     pop     es
DOSCODE:91ED		     push    ds
DOSCODE:91EE		     mov     ds, cs:DosDSeg
DOSCODE:91F3		     mov     ds:INDOS, 0
DOSCODE:91F8		     mov     ds:ERRORMODE, 0
DOSCODE:91FD		     mov     ds:ConC_Spsave, sp
DOSCODE:9201		     add     ds:ConC_Spsave, 2
DOSCODE:9206		     cmp     ds:DosHasHMA, 0
DOSCODE:920B		     pop     ds
DOSCODE:920C		     jnz     short do_low_int23
DOSCODE:920E		     clc
DOSCODE:920F		     int     23h	     ; DOS - CONTROL "C" EXIT ADDRESS
DOSCODE:920F					     ; Return: return via RETF 2 with CF set
DOSCODE:920F					     ; DOS will	abort program with errorlevel 0
DOSCODE:920F					     ; else
DOSCODE:920F					     ; interrupted DOS call continues
DOSCODE:9211		     jmp     short ctrlc_ret_addr
DOSCODE:9213 do_low_int23:			     ; ...
DOSCODE:9213		     clc
DOSCODE:9214		     call    cs:LowInt23Addr
DOSCODE:9219 ctrlc_ret_addr:			     ; ...
DOSCODE:9219		     cli
DOSCODE:921A		     push    ax
DOSCODE:921B		     mov     ax, ds
DOSCODE:921D		     mov     ds, cs:DosDSeg
DOSCODE:9222		     mov     ds:TEMPSEG, ax
DOSCODE:9225		     pop     ax
DOSCODE:9226		     mov     ds:USER_IN_AX, ax
DOSCODE:9229		     pushf
DOSCODE:922A		     pop     ax
DOSCODE:922B		     cmp     sp, ds:ConC_Spsave
DOSCODE:922F		     jnz     short ctrlc_try_new
DOSCODE:9231 ctrlc_repeat:			     ; ...
DOSCODE:9231		     mov     ax, ds:USER_IN_AX
DOSCODE:9234		     mov     ds, ds:TEMPSEG
DOSCODE:9238 COMMANDJ:				     ; ...
DOSCODE:9238		     jmp     command
DOSCODE:923B ctrlc_try_new:			     ; ...
DOSCODE:923B		     add     sp, 2
DOSCODE:923E		     test    al, 1
DOSCODE:9240		     jz	     short ctrlc_repeat
DOSCODE:9242		     mov     ds, ds:TEMPSEG
DOSCODE:9246 ctrlc_abort:			     ; ...
DOSCODE:9246		     mov     ax, 4C00h
DOSCODE:9249		     push    ds
DOSCODE:924A		     mov     ds, cs:DosDSeg
DOSCODE:924F		     mov     ds:DidCTRLC, 0FFh
DOSCODE:9254		     pop     ds
DOSCODE:9255		     jmp     short COMMANDJ
DOSCODE:9255 STATCHK	     endp ; sp-analysis	failed
DOSCODE:9257 DIVOV:				     ; ...
DOSCODE:9257		     mov     si, offset	DIVMES ; "\r\nDivide overflow\r\n"
DOSCODE:925A		     mov     bx, cs:DivMesLen
DOSCODE:925F		     mov     ss, cs:DosDSeg
DOSCODE:9264		     mov     sp, offset	AUXSTACK
DOSCODE:9267		     call    _OUTMES
DOSCODE:926A		     jmp     short ctrlc_abort
DOSCODE:926C ; =============== S U B R O U T I N E =======================================
DOSCODE:926C _OUTMES	     proc near		     ; ...
DOSCODE:926C		     push    ss
DOSCODE:926D		     pop     es
DOSCODE:926E		     push    ss
DOSCODE:926F		     pop     ds
DOSCODE:9270		     mov     ds:DSKSTCOM, 8
DOSCODE:9275		     mov     ds:DSKSTCALL, 16h
DOSCODE:927A		     mov     ds:DSKSTST, 0
DOSCODE:9280		     mov     ds:DSKSTCNT, bx
DOSCODE:9284		     mov     bx, offset	DSKSTCALL
DOSCODE:9287		     mov     ds:DEVIOBUF_PTR, si ; [DSKCHRET+1]
DOSCODE:928B		     mov     ds:DOSSEG_INIT, cs	; [DSKCHRET+3]
DOSCODE:928F		     lds     si, ds:BCON
DOSCODE:9293		     call    DEVIOCALL2
DOSCODE:9296		     mov     es:DEVIOBUF_PTR, offset DEVIOBUF
DOSCODE:929D		     mov     es:DSKSTCNT, 1
DOSCODE:92A4		     retn
DOSCODE:92A4 _OUTMES	     endp
DOSCODE:92A5 ; =============== S U B R O U T I N E =======================================
DOSCODE:92A5 CHARHARD	     proc near		     ; ...
DOSCODE:92A5		     cmp     ss:ERRORMODE, 0
DOSCODE:92AB		     jnz     short chard1
DOSCODE:92AD		     or	     ah, 10h
DOSCODE:92B0		     test    ss:PFLAG, 0FFh
DOSCODE:92B6		     jnz     short ctrlp
DOSCODE:92B8 chard1:				     ; ...
DOSCODE:92B8		     or	     ah, 38h
DOSCODE:92BB ctrlp:				     ; ...
DOSCODE:92BB		     mov     ss:ALLOWED, ah
DOSCODE:92C0		     mov     word ptr ss:EXITHOLD+2, es
DOSCODE:92C5		     mov     word ptr ss:EXITHOLD, bp
DOSCODE:92CA		     push    si
DOSCODE:92CB		     and     di, 0FFh
DOSCODE:92CF		     mov     bp, ds
DOSCODE:92D1		     call    near ptr FATALC
DOSCODE:92D4		     pop     si
DOSCODE:92D5		     retn
DOSCODE:92D5 CHARHARD	     endp
DOSCODE:92D6 ; =============== S U B R O U T I N E =======================================
DOSCODE:92D6 HARDERR	     proc near		     ; ...
DOSCODE:92D6		     xchg    ax, di
DOSCODE:92D7		     and     di, 0FFh
DOSCODE:92DB		     cmp     di, 0
DOSCODE:92DE		     jnz     short NOSETWRPERR
DOSCODE:92E0		     push    ax
DOSCODE:92E1		     mov     al, es:[bp+0]
DOSCODE:92E5		     mov     ss:WPERR, al
DOSCODE:92E9		     pop     ax
DOSCODE:92EA NOSETWRPERR:			     ; ...
DOSCODE:92EA		     sub     ax, cx
DOSCODE:92EC		     add     dx, ax
DOSCODE:92EE		     push    dx
DOSCODE:92EF		     mul     word ptr es:[bp+2]
DOSCODE:92F3		     pop     dx
DOSCODE:92F4		     add     bx, ax
DOSCODE:92F6		     xor     ah, ah
DOSCODE:92F8		     cmp     dx, es:[bp+6]
DOSCODE:92FC		     jb	     short ERRINT
DOSCODE:92FE		     inc     ah
DOSCODE:9300		     cmp     dx, es:[bp+11h]
DOSCODE:9304		     jnb     short TESTDIR
DOSCODE:9306		     mov     word ptr es:[bp+1Fh], 0FFFFh
DOSCODE:930C		     jmp     short ERRINT
DOSCODE:930E TESTDIR:				     ; ...
DOSCODE:930E		     inc     ah
DOSCODE:9310		     cmp     dx, es:[bp+0Bh]
DOSCODE:9314		     jb	     short ERRINT
DOSCODE:9316		     inc     ah
DOSCODE:9318 ERRINT:				     ; ...
DOSCODE:9318		     shl     ah, 1
DOSCODE:931A		     or	     ah, ss:READOP
DOSCODE:931F		     or	     ah, ss:ALLOWED
DOSCODE:9324 FATAL:				     ; ...
DOSCODE:9324		     mov     al, es:[bp+0]
DOSCODE:9328 FATAL1:				     ; ...
DOSCODE:9328		     mov     word ptr ss:EXITHOLD+2, es
DOSCODE:932D		     mov     word ptr ss:EXITHOLD, bp
DOSCODE:9332		     les     si, es:[bp+13h]
DOSCODE:9336		     mov     bp, es
DOSCODE:9336 HARDERR	     endp ; sp-analysis	failed
DOSCODE:9338 ; =============== S U B R O U T I N E =======================================
DOSCODE:9338 FATALC	     proc far		     ; ...
DOSCODE:9338 ; FUNCTION	CHUNK AT DOSCODE:A1EA SIZE 0000000D BYTES
DOSCODE:9338 ; FUNCTION	CHUNK AT DOSCODE:A1FF SIZE 00000022 BYTES
DOSCODE:9338		     call    SET_I24_EXTENDED_ERROR
DOSCODE:933B		     cmp     di, 0Ch
DOSCODE:933E		     jbe     short NET_I24_ENTRY
DOSCODE:9340		     mov     di, 0Ch
DOSCODE:9343 NET_I24_ENTRY:			     ; ...
DOSCODE:9343		     cmp     ss:ERRORMODE, 0
DOSCODE:9349		     jz	     short NoSetFail
DOSCODE:934B		     mov     al, 3
DOSCODE:934D		     jmp     short FailRet
DOSCODE:934F NoSetFail:				     ; ...
DOSCODE:934F		     mov     ss:CONTSTK, sp
DOSCODE:9354		     push    ss
DOSCODE:9355		     pop     es
DOSCODE:9356		     cmp     ss:SFN, 0FFFFh
DOSCODE:935C		     jz	     short _NoFree
DOSCODE:935E		     push    ds
DOSCODE:935F		     push    si
DOSCODE:9360		     lds     si, ss:PJFN
DOSCODE:9365		     mov     byte ptr [si], 0FFh
DOSCODE:9368		     pop     si
DOSCODE:9369		     pop     ds
DOSCODE:936A _NoFree:				     ; ...
DOSCODE:936A		     cli
DOSCODE:936B		     inc     ss:ERRORMODE
DOSCODE:9370		     dec     ss:INDOS
DOSCODE:9375		     test    ss:EXTOPEN_ON, 2
DOSCODE:937B		     jz	     short i24yes
DOSCODE:937D		     mov     al, 3
DOSCODE:937F		     jmp     short passi24
DOSCODE:9381 i24yes:				     ; ...
DOSCODE:9381		     mov     ss, ss:USER_SS
DOSCODE:9386		     mov     sp, es:USER_SP
DOSCODE:938B		     cmp     es:DosHasHMA, 0
DOSCODE:9391		     jnz     short do_low_int24
DOSCODE:9393		     int     24h	     ; DOS - FATAL ERROR HANDLER ADDRESS
DOSCODE:9393					     ; Automatically called upon detection of unrecoverable I/O	error.
DOSCODE:9395		     jmp     short criterr_ret_addr
DOSCODE:9397 do_low_int24:			     ; ...
DOSCODE:9397		     call    cs:LowInt24Addr
DOSCODE:939C criterr_ret_addr:			     ; ...
DOSCODE:939C		     mov     es:USER_SP, sp
DOSCODE:93A1		     mov     es:USER_SS, ss
DOSCODE:93A6		     mov     bp, es
DOSCODE:93A8		     mov     ss, bp
DOSCODE:93AA passi24:				     ; ...
DOSCODE:93AA		     mov     sp, ss:CONTSTK
DOSCODE:93AF		     inc     ss:INDOS
DOSCODE:93B4		     mov     ss:ERRORMODE, 0
DOSCODE:93BA		     sti
DOSCODE:93BB FailRet:				     ; ...
DOSCODE:93BB		     les     bp, ss:EXITHOLD
DOSCODE:93C0		     cmp     al, 1
DOSCODE:93C2		     jb	     short CheckIgnore
DOSCODE:93C4		     jz	     short CheckRetry
DOSCODE:93C6		     cmp     al, 3
DOSCODE:93C8		     jnz     short DoAbort
DOSCODE:93CA		     test    ss:ALLOWED, 8
DOSCODE:93D0		     jz	     short DoAbort
DOSCODE:93D2 DoFail:				     ; ...
DOSCODE:93D2		     mov     al, 3
DOSCODE:93D4		     test    ss:EXTOPEN_ON, 2
DOSCODE:93DA		     jnz     short CleanUp
DOSCODE:93DC		     inc     ss:FAILERR
DOSCODE:93E1 CleanUp:				     ; ...
DOSCODE:93E1		     mov     ss:WPERR, 0FFh
DOSCODE:93E7		     cmp     ss:SFN, 0FFFFh
DOSCODE:93ED		     jnz     short CleanUp2
DOSCODE:93EF		     retn
DOSCODE:93F0 CleanUp2:				     ; ...
DOSCODE:93F0		     push    ds
DOSCODE:93F1		     push    si
DOSCODE:93F2		     push    ax
DOSCODE:93F3		     mov     ax, ss:SFN
DOSCODE:93F7		     lds     si, ss:PJFN
DOSCODE:93FC		     mov     [si], al
DOSCODE:93FE		     pop     ax
DOSCODE:93FF		     pop     si
DOSCODE:9400		     pop     ds
DOSCODE:9401		     retn
DOSCODE:9402 CheckIgnore:			     ; ...
DOSCODE:9402		     test    ss:ALLOWED, 20h
DOSCODE:9408		     jz	     short DoFail
DOSCODE:940A		     jmp     short CleanUp
DOSCODE:940C CheckRetry:			     ; ...
DOSCODE:940C		     test    ss:ALLOWED, 10h
DOSCODE:9412		     jz	     short DoFail
DOSCODE:9414		     jmp     short CleanUp
DOSCODE:9416 DoAbort:				     ; ...
DOSCODE:9416		     push    ss
DOSCODE:9417		     pop     ds
DOSCODE:9418		     cmp     ds:CONSWAP, 0
DOSCODE:941D		     jz	     short NOSWAP2
DOSCODE:941F		     call    SWAPBACK
DOSCODE:9422 NOSWAP2:				     ; ...
DOSCODE:9422		     cmp     ds:fAborting, 0
DOSCODE:9427		     jnz     short DoFail
DOSCODE:9429		     mov     ds:EXIT_TYPE, 2
DOSCODE:942E		     xor     al, al
DOSCODE:9430		     jmp     exit_inner
DOSCODE:9433 reset_environment:			     ; ...
DOSCODE:9433		     push    ds
DOSCODE:9434		     mov     ah, 82h
DOSCODE:9436		     int     2Ah	     ; Microsoft Networks - END	DOS CRITICAL SECTIONS 0	THROUGH	7
DOSCODE:9438		     mov     ss:fAborting, 0FFh	; -1
DOSCODE:943E		     mov     ax, 1122h
DOSCODE:9441		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	PROCESS	TERMINATION HOOK
DOSCODE:9441					     ; SS = DOS	CS
DOSCODE:9443		     mov     al, 22h
DOSCODE:9445		     call    $GET_INTERRUPT_VECTOR
DOSCODE:9448		     pop     cx
DOSCODE:9449		     push    es
DOSCODE:944A		     push    bx
DOSCODE:944B		     mov     bx, ss:CurrentPDB
DOSCODE:9450		     mov     ds, bx
DOSCODE:9452		     mov     ax, ds:16h	     ; [PDB.PARENT_PID]
DOSCODE:9455		     cmp     ax, bx
DOSCODE:9457		     jz	     short reset_return
DOSCODE:9459		     cmp     bx, cx
DOSCODE:945B		     jnz     short reset_return
DOSCODE:945D		     push    ax
DOSCODE:945E		     cmp     ss:EXIT_TYPE, 3
DOSCODE:9464		     jz	     short reset_to_parent
DOSCODE:9466		     call    arena_free_process
DOSCODE:9469		     call    DOS_ABORT
DOSCODE:946C reset_to_parent:			     ; ...
DOSCODE:946C		     pop     ss:CurrentPDB
DOSCODE:9471 reset_return:			     ; ...
DOSCODE:9471		     push    ss
DOSCODE:9472		     pop     ds
DOSCODE:9473		     mov     al, 0FFh
DOSCODE:9475		     call    ECritDisk
DOSCODE:9478		     call    FLUSHBUF
DOSCODE:947B		     call    LCritDisk
DOSCODE:947E		     call    CHECK_VIRT_OPEN
DOSCODE:9481		     cli
DOSCODE:9482		     mov     ds:INDOS, 0
DOSCODE:9487		     mov     ds:WPERR, 0FFh
DOSCODE:948C		     mov     ds:fAborting, 0
DOSCODE:9491		     pop     word ptr ds:EXITHOLD
DOSCODE:9495		     pop     word ptr ds:EXITHOLD+2
DOSCODE:9499		     mov     ds, ds:CurrentPDB
DOSCODE:949D		     mov     ss, word ptr ds:30h
DOSCODE:94A1		     mov     sp, ds:2Eh	     ; [PDB.USER_STACK]
DOSCODE:94A5		     call    restore_world
DOSCODE:94A8		     pop     es
DOSCODE:94A9		     push    ax
DOSCODE:94AA		     mov     ax, ds
DOSCODE:94AC		     mov     ds, cs:DosDSeg
DOSCODE:94B1		     mov     ds:TEMPSEG, ax
DOSCODE:94B4		     pop     ax
DOSCODE:94B5		     mov     ds:USER_SP, ax
DOSCODE:94B8		     pop     ax
DOSCODE:94B9		     pop     ax
DOSCODE:94BA		     pop     ax
DOSCODE:94BB		     lahf
DOSCODE:94BC		     xchg    ah, al
DOSCODE:94BE		     and     al, 2
DOSCODE:94C0		     mov     ah, 0F2h
DOSCODE:94C2		     push    ax
DOSCODE:94C3		     push    word ptr ds:EXITHOLD+2
DOSCODE:94C7		     push    word ptr ds:EXITHOLD
DOSCODE:94CB		     mov     ax, ds:USER_SP
DOSCODE:94CE		     mov     ds, ds:TEMPSEG
DOSCODE:94D2		     iret
DOSCODE:94D2 FATALC	     endp ; sp-analysis	failed
DOSCODE:94D3 ; =============== S U B R O U T I N E =======================================
DOSCODE:94D3 SET_I24_EXTENDED_ERROR proc near	     ; ...
DOSCODE:94D3		     push    ax
DOSCODE:94D4		     mov     ax, offset	FIRST_BUFF_ADDR	; ErrMap24End
DOSCODE:94D7		     sub     ax, offset	ErrMap24
DOSCODE:94DA		     push    ds
DOSCODE:94DB		     mov     ds, cs:DosDSeg
DOSCODE:94E0		     cmp     di, ax
DOSCODE:94E2		     mov     ax, di
DOSCODE:94E4		     jnb     short NoTrans
DOSCODE:94E6		     mov     al, ds:ErrMap24[di]
DOSCODE:94EA		     xor     ah, ah
DOSCODE:94EC NoTrans:				     ; ...
DOSCODE:94EC		     mov     ds:EXTERR,	ax
DOSCODE:94EF		     pop     ds
DOSCODE:94F0		     pop     ax
DOSCODE:94F1		     push    si
DOSCODE:94F2		     mov     si, offset	ERR_TABLE_24
DOSCODE:94F5		     call    CAL_LK
DOSCODE:94F8		     pop     si
DOSCODE:94F9		     retn
DOSCODE:94F9 SET_I24_EXTENDED_ERROR endp
DOSCODE:94FA ; =============== S U B R O U T I N E =======================================
DOSCODE:94FA IsEOF	     proc near		     ; ...
DOSCODE:94FA		     cmp     word ptr es:[bp+0Dh], 0FF6h
DOSCODE:9500		     jnb     short EOF16
DOSCODE:9502		     cmp     bx, 0FF0h
DOSCODE:9506		     jz	     short IsEOF_other
DOSCODE:9508		     cmp     bx, 0FF8h
DOSCODE:950C IsEOF_other:			     ; ...
DOSCODE:950C		     retn
DOSCODE:950D EOF16:				     ; ...
DOSCODE:950D		     cmp     bx, 0FFF8h
DOSCODE:9510		     retn
DOSCODE:9510 IsEOF	     endp
DOSCODE:9511 ; =============== S U B R O U T I N E =======================================
DOSCODE:9511 UNPACK	     proc near		     ; ...
DOSCODE:9511		     or	     bx, bx
DOSCODE:9513		     jnz     short up_cont
DOSCODE:9515		     mov     di, ds:CL0FATENTRY
DOSCODE:9519		     or	     di, di
DOSCODE:951B		     retn
DOSCODE:951C up_cont:				     ; ...
DOSCODE:951C		     cmp     bx, es:[bp+0Dh]
DOSCODE:9520		     ja	     short HURTFAT
DOSCODE:9522		     call    MAPCLUSTER
DOSCODE:9525		     jb	     short _DoContext
DOSCODE:9527		     mov     di, [di]
DOSCODE:9529		     jnz     short High12
DOSCODE:952B		     mov     si, es:[bp+0Dh]
DOSCODE:952F		     cmp     si, 0FF6h
DOSCODE:9533		     jb	     short Unpack12
DOSCODE:9535		     or	     di, di
DOSCODE:9537		     jmp     short _DoContext
DOSCODE:9539 High12:				     ; ...
DOSCODE:9539		     shr     di, 1
DOSCODE:953B		     shr     di, 1
DOSCODE:953D		     shr     di, 1
DOSCODE:953F		     shr     di, 1
DOSCODE:9541 Unpack12:				     ; ...
DOSCODE:9541		     and     di, 0FFFh
DOSCODE:9545 _DoContext:			     ; ...
DOSCODE:9545		     push    ss
DOSCODE:9546		     pop     ds
DOSCODE:9547		     retn
DOSCODE:9548 HURTFAT:				     ; ...
DOSCODE:9548		     mov     word ptr es:[bp+1Fh], 0FFFFh
DOSCODE:954E		     push    ax
DOSCODE:954F		     mov     ah, 88h
DOSCODE:9551		     mov     ss:ALLOWED, 8
DOSCODE:9557		     mov     di, 0FFFh
DOSCODE:955A		     call    FATAL
DOSCODE:955D		     cmp     al, 3
DOSCODE:955F		     clc
DOSCODE:9560		     jnz     short OKU_RET
DOSCODE:9562		     stc
DOSCODE:9563 OKU_RET:				     ; ...
DOSCODE:9563		     pop     ax
DOSCODE:9564 hurtfat_retn:			     ; ...
DOSCODE:9564		     retn
DOSCODE:9564 UNPACK	     endp
DOSCODE:9565 ; =============== S U B R O U T I N E =======================================
DOSCODE:9565 PACK	     proc near		     ; ...
DOSCODE:9565		     or	     bx, bx
DOSCODE:9567		     jnz     short p_cont
DOSCODE:9569		     mov     ds:CL0FATENTRY, dx
DOSCODE:956D		     retn
DOSCODE:956E p_cont:				     ; ...
DOSCODE:956E		     call    MAPCLUSTER
DOSCODE:9571		     jb	     short _DoContext
DOSCODE:9573		     mov     si, [di]
DOSCODE:9575		     jz	     short ALIGNED
DOSCODE:9577		     push    cx
DOSCODE:9578		     mov     cl, 4
DOSCODE:957A		     shl     dx, cl
DOSCODE:957C		     pop     cx
DOSCODE:957D		     and     si, 0Fh
DOSCODE:9580		     jmp     short PACKIN
DOSCODE:9582 ALIGNED:				     ; ...
DOSCODE:9582		     cmp     word ptr es:[bp+0Dh], 0FF6h
DOSCODE:9588		     jnb     short Pack16
DOSCODE:958A		     and     si, 0F000h
DOSCODE:958E		     and     dx, 0FFFh
DOSCODE:9592		     jmp     short PACKIN
DOSCODE:9594 Pack16:				     ; ...
DOSCODE:9594		     xor     si, si
DOSCODE:9596 PACKIN:				     ; ...
DOSCODE:9596		     or	     si, dx
DOSCODE:9598		     mov     [di], si
DOSCODE:959A		     lds     si, ss:CURBUF
DOSCODE:959F		     test    byte ptr [si+5], 40h
DOSCODE:95A3		     jnz     short yesdirty11
DOSCODE:95A5		     call    INC_DIRTY_COUNT
DOSCODE:95A8		     or	     byte ptr [si+5], 40h
DOSCODE:95AC yesdirty11:			     ; ...
DOSCODE:95AC		     cmp     ss:CLUSSPLIT, 0
DOSCODE:95B2		     push    ss
DOSCODE:95B3		     pop     ds
DOSCODE:95B4		     jz	     short hurtfat_retn
DOSCODE:95B6		     push    ax
DOSCODE:95B7		     push    bx
DOSCODE:95B8		     push    cx
DOSCODE:95B9		     mov     ax, ds:CLUSSAVE
DOSCODE:95BC		     mov     ds, word ptr ds:CURBUF+2
DOSCODE:95C0		     add     si, 20
DOSCODE:95C3		     mov     [si], ah
DOSCODE:95C5		     push    ss
DOSCODE:95C6		     pop     ds
DOSCODE:95C7		     push    ax
DOSCODE:95C8		     mov     dx, ds:CLUSSEC+2
DOSCODE:95CC		     mov     ds:HIGH_SECTOR, dx
DOSCODE:95D0		     mov     dx, ds:CLUSSEC
DOSCODE:95D4		     mov     si, 1
DOSCODE:95D7		     xor     al, al
DOSCODE:95D9		     call    GETBUFFRB
DOSCODE:95DC		     pop     ax
DOSCODE:95DD		     jb	     short POPP_RET
DOSCODE:95DF		     lds     di, ds:CURBUF
DOSCODE:95E3		     test    byte ptr [di+5], 40h
DOSCODE:95E7		     jnz     short yesdirty12
DOSCODE:95E9		     call    INC_DIRTY_COUNT
DOSCODE:95EC		     or	     byte ptr [di+5], 40h
DOSCODE:95F0 yesdirty12:			     ; ...
DOSCODE:95F0		     add     di, 20
DOSCODE:95F3		     dec     di
DOSCODE:95F4		     add     di, es:[bp+2]
DOSCODE:95F8		     mov     [di], al
DOSCODE:95FA		     clc
DOSCODE:95FB POPP_RET:				     ; ...
DOSCODE:95FB		     push    ss
DOSCODE:95FC		     pop     ds
DOSCODE:95FD		     pop     cx
DOSCODE:95FE		     pop     bx
DOSCODE:95FF		     pop     ax
DOSCODE:9600		     retn
DOSCODE:9600 PACK	     endp
DOSCODE:9601 ; =============== S U B R O U T I N E =======================================
DOSCODE:9601 MAPCLUSTER	     proc near		     ; ...
DOSCODE:9601		     mov     ds:CLUSSPLIT, 0
DOSCODE:9606		     push    ax
DOSCODE:9607		     push    bx
DOSCODE:9608		     push    cx
DOSCODE:9609		     push    dx
DOSCODE:960A		     mov     ax, bx
DOSCODE:960C		     cmp     word ptr es:[bp+0Dh], 0FF6h
DOSCODE:9612		     jnb     short Map16
DOSCODE:9614		     shr     ax, 1
DOSCODE:9616 Map16:				     ; ...
DOSCODE:9616		     xor     di, di
DOSCODE:9618		     add     ax, bx
DOSCODE:961A		     adc     di, di
DOSCODE:961C		     mov     cx, es:[bp+2]
DOSCODE:9620		     cmp     cx, 512
DOSCODE:9624		     jnz     short _DoDiv
DOSCODE:9626		     mov     dx, ax
DOSCODE:9628		     and     dx, 1FFh
DOSCODE:962C		     mov     al, ah
DOSCODE:962E		     shr     di, 1
DOSCODE:9630		     rcr     al, 1
DOSCODE:9632		     xor     ah, ah
DOSCODE:9634		     jmp     short DivDone
DOSCODE:9636 _DoDiv:				     ; ...
DOSCODE:9636		     mov     dx, di
DOSCODE:9638		     div     cx
DOSCODE:963A DivDone:				     ; ...
DOSCODE:963A		     add     ax, es:[bp+6]
DOSCODE:963E		     dec     cx
DOSCODE:963F		     push    ax
DOSCODE:9640		     push    dx
DOSCODE:9641		     push    cx
DOSCODE:9642		     mov     dx, ax
DOSCODE:9644		     mov     ds:HIGH_SECTOR, 0
DOSCODE:964A		     xor     al, al
DOSCODE:964C		     mov     si, 1
DOSCODE:964F		     call    GETBUFFRB
DOSCODE:9652		     pop     cx
DOSCODE:9653		     pop     ax
DOSCODE:9654		     pop     dx
DOSCODE:9655		     jb	     short MAP_POP
DOSCODE:9657		     lds     si, ds:CURBUF
DOSCODE:965B		     lea     di, [si+20]
DOSCODE:965E		     add     di, ax
DOSCODE:9660		     cmp     ax, cx
DOSCODE:9662		     jnz     short MAPRET
DOSCODE:9664		     mov     al, [di]
DOSCODE:9666		     push    ss
DOSCODE:9667		     pop     ds
DOSCODE:9668		     inc     ds:CLUSSPLIT
DOSCODE:966C		     mov     byte ptr ds:CLUSSAVE, al
DOSCODE:966F		     mov     ds:CLUSSEC, dx
DOSCODE:9673		     mov     ds:CLUSSEC+2, 0
DOSCODE:9679		     inc     dx
DOSCODE:967A		     mov     ds:HIGH_SECTOR, 0
DOSCODE:9680		     xor     al, al
DOSCODE:9682		     mov     si, 1
DOSCODE:9685		     call    GETBUFFRB
DOSCODE:9688		     jb	     short MAP_POP
DOSCODE:968A		     lds     si, ds:CURBUF
DOSCODE:968E		     lea     di, [si+20]
DOSCODE:9691		     mov     al, [di]
DOSCODE:9693		     push    ss
DOSCODE:9694		     pop     ds
DOSCODE:9695		     mov     byte ptr ds:CLUSSAVE+1, al
DOSCODE:9698		     mov     di, offset	CLUSSAVE
DOSCODE:969B MAPRET:				     ; ...
DOSCODE:969B		     pop     dx
DOSCODE:969C		     pop     cx
DOSCODE:969D		     pop     bx
DOSCODE:969E		     xor     ax, ax
DOSCODE:96A0		     cmp     word ptr es:[bp+0Dh], 0FF6h
DOSCODE:96A6		     jnb     short MapSet
DOSCODE:96A8		     mov     ax, bx
DOSCODE:96AA MapSet:				     ; ...
DOSCODE:96AA		     test    al, 1
DOSCODE:96AC		     pop     ax
DOSCODE:96AD		     retn
DOSCODE:96AE MAP_POP:				     ; ...
DOSCODE:96AE		     pop     dx
DOSCODE:96AF		     pop     cx
DOSCODE:96B0		     pop     bx
DOSCODE:96B1		     pop     ax
DOSCODE:96B2		     retn
DOSCODE:96B2 MAPCLUSTER	     endp
DOSCODE:96B3 ; =============== S U B R O U T I N E =======================================
DOSCODE:96B3 FATREAD_SFT     proc near		     ; ...
DOSCODE:96B3		     les     bp, es:[di+7]
DOSCODE:96B7		     mov     al, es:[bp+0]
DOSCODE:96BB		     mov     ds:THISDRV, al
DOSCODE:96BE		     call    GOTDPB
DOSCODE:96C1		     call    FAT_GOT_DPB
DOSCODE:96C4 fatread_sft_retn:			     ; ...
DOSCODE:96C4		     retn
DOSCODE:96C4 FATREAD_SFT     endp
DOSCODE:96C5 ; =============== S U B R O U T I N E =======================================
DOSCODE:96C5 FATREAD_CDS     proc near		     ; ...
DOSCODE:96C5		     push    es
DOSCODE:96C6		     push    di
DOSCODE:96C7		     les     bp, es:[di+45h]
DOSCODE:96CB		     mov     al, es:[bp+0]
DOSCODE:96CF		     mov     ds:THISDRV, al
DOSCODE:96D2		     call    GOTDPB
DOSCODE:96D5		     call    FAT_GOT_DPB
DOSCODE:96D8		     pop     di
DOSCODE:96D9		     pop     es
DOSCODE:96DA		     jb	     short fatread_sft_retn
DOSCODE:96DC		     jnz     short NO_CHANGE
DOSCODE:96DE		     xor     ax, ax
DOSCODE:96E0		     dec     ax
DOSCODE:96E1		     push    ds
DOSCODE:96E2		     mov     cl, ds:CDSCOUNT
DOSCODE:96E6		     xor     ch, ch
DOSCODE:96E8		     lds     si, es:[di+45h]
DOSCODE:96EC		     les     di, ss:CDSADDR
DOSCODE:96F1 frcd20:				     ; ...
DOSCODE:96F1		     test    byte ptr es:[di+44h], 80h
DOSCODE:96F6		     jnz     short frcd25
DOSCODE:96F8		     cmp     si, es:[di+45h]
DOSCODE:96FC		     jnz     short frcd25
DOSCODE:96FE		     mov     bx, ds
DOSCODE:9700		     cmp     bx, es:[di+47h]
DOSCODE:9704		     jnz     short frcd25
DOSCODE:9706		     test    es:[di+49h], ax
DOSCODE:970A		     jz	     short frcd25
DOSCODE:970C		     mov     es:[di+49h], ax
DOSCODE:9710 frcd25:				     ; ...
DOSCODE:9710		     add     di, 88
DOSCODE:9713		     loop    frcd20
DOSCODE:9715		     pop     ds
DOSCODE:9716 NO_CHANGE:				     ; ...
DOSCODE:9716		     les     bp, ds:THISDPB
DOSCODE:971A		     clc
DOSCODE:971B		     retn
DOSCODE:971B FATREAD_CDS     endp
DOSCODE:971C ; START OF	FUNCTION CHUNK FOR FAT_GOT_DPB
DOSCODE:971C FAT_operation:			     ; ...
DOSCODE:971C		     mov     word ptr es:[bp+1Fh], 0FFFFh ; -1
DOSCODE:9722		     and     di, 0FFh
DOSCODE:9726		     mov     ds:ALLOWED, 18h
DOSCODE:972B		     mov     ah, 1Ah
DOSCODE:972D		     mov     al, ds:THISDRV
DOSCODE:9730		     call    FATAL1
DOSCODE:9733		     les     bp, ds:THISDPB
DOSCODE:9737		     cmp     al, 3
DOSCODE:9739		     jnz     short FAT_GOT_DPB
DOSCODE:973B		     stc
DOSCODE:973C		     retn
DOSCODE:973C ; END OF FUNCTION CHUNK FOR FAT_GOT_DPB
DOSCODE:973D ; =============== S U B R O U T I N E =======================================
DOSCODE:973D FAT_GOT_DPB     proc near		     ; ...
DOSCODE:973D ; FUNCTION	CHUNK AT DOSCODE:971C SIZE 00000021 BYTES
DOSCODE:973D		     push    ss
DOSCODE:973E		     pop     ds
DOSCODE:973F		     mov     al, 0Fh
DOSCODE:9741		     mov     ah, es:[bp+1]
DOSCODE:9745		     mov     word ptr ds:DEVCALL, ax
DOSCODE:9748		     mov     ds:DEVCALL_REQFUNC, 1
DOSCODE:974D		     mov     ds:DEVCALL_REQSTAT, 0
DOSCODE:9753		     mov     al, es:[bp+17h] ; [ES:BP+DPB.MEDIA]
DOSCODE:9757		     mov     ds:CALLUNIT, al ; [CALLMED]
DOSCODE:975A		     push    es
DOSCODE:975B		     push    ds
DOSCODE:975C		     mov     bx, offset	DEVCALL
DOSCODE:975F		     lds     si, es:[bp+13h] ; [ES:BP+DPB.DRIVER_ADDR]
DOSCODE:9763		     pop     es
DOSCODE:9764		     call    DEVIOCALL2
DOSCODE:9767		     push    ss
DOSCODE:9768		     pop     ds
DOSCODE:9769		     pop     es
DOSCODE:976A		     mov     di, ds:DEVCALL_REQSTAT
DOSCODE:976E		     or	     di, di
DOSCODE:9770		     js	     short FAT_operation
DOSCODE:9772		     xor     ah, ah
DOSCODE:9774		     xchg    ah, es:[bp+18h] ; [ES:BP+DPB.FIRST_ACCESS]
DOSCODE:9778		     mov     al, ds:THISDRV
DOSCODE:977B		     cmp     ds:VOLCHNG_FLAG, al
DOSCODE:977F		     jnz     short CHECK_BYT
DOSCODE:9781		     mov     ds:VOLCHNG_FLAG, 0FFh ; -1
DOSCODE:9786		     jmp     GOGETBPB
DOSCODE:9789 CHECK_BYT:				     ; ...
DOSCODE:9789		     or	     ah, byte ptr ds:CALLBR ; [CALLRBYT]
DOSCODE:978D		     jns     short CHECK_ZR
DOSCODE:978F		     jmp     short NEWDSK
DOSCODE:9791 CHECK_ZR:				     ; ...
DOSCODE:9791		     jz	     short CHKBUFFDIRT
DOSCODE:9793		     clc
DOSCODE:9794		     retn
DOSCODE:9795 DISK_CHNG_ERR:			     ; ...
DOSCODE:9795		     push    es
DOSCODE:9796		     push    bp
DOSCODE:9797		     les     bp, es:[bp+13h]
DOSCODE:979B		     test    byte ptr es:[bp+5], 8
DOSCODE:97A0		     pop     bp
DOSCODE:97A1		     pop     es
DOSCODE:97A2		     jz	     short FAIL_OPJ2
DOSCODE:97A4		     push    ds
DOSCODE:97A5		     push    di
DOSCODE:97A6		     push    ss
DOSCODE:97A7		     pop     ds
DOSCODE:97A8		     mov     ds:ALLOWED, 18h ; Allowed_FAIL+Allowed_RETRY
DOSCODE:97AD		     push    es
DOSCODE:97AE		     les     di, ds:CALLBR+1 ; [CALLVIDM]
DOSCODE:97B2		     mov     word ptr ds:EXTERRPT+2, es
DOSCODE:97B6		     pop     es
DOSCODE:97B7		     mov     word ptr ds:EXTERRPT, di
DOSCODE:97BB		     mov     ax, 0Fh
DOSCODE:97BE		     mov     ds:READOP,	1
DOSCODE:97C3		     call    HARDERR
DOSCODE:97C6		     pop     di
DOSCODE:97C7		     pop     ds
DOSCODE:97C8		     cmp     al, 3
DOSCODE:97CA FAIL_OPJ2:				     ; ...
DOSCODE:97CA		     jz	     short FAIL_OP
DOSCODE:97CC		     jmp     FAT_GOT_DPB
DOSCODE:97CF CHKBUFFDIRT:			     ; ...
DOSCODE:97CF		     cmp     ss:DirtyBufferCount, 0
DOSCODE:97D5		     jz	     short NEWDSK
DOSCODE:97D7		     call    GETCURHEAD
DOSCODE:97DA nbuffer:				     ; ...
DOSCODE:97DA		     cmp     [di+4], al	     ; [di+BUFFINFO.buf_ID]
DOSCODE:97DD		     jnz     short lfnxt
DOSCODE:97DF		     test    byte ptr [di+5], 40h ; [di+BUFFINFO.buf_flags]
DOSCODE:97E3		     jz	     short lfnxt
DOSCODE:97E5		     push    ss
DOSCODE:97E6		     pop     ds
DOSCODE:97E7		     clc
DOSCODE:97E8		     retn
DOSCODE:97E9 FAIL_OP:				     ; ...
DOSCODE:97E9		     push    ss
DOSCODE:97EA		     pop     ds
DOSCODE:97EB		     stc
DOSCODE:97EC		     retn
DOSCODE:97ED lfnxt:				     ; ...
DOSCODE:97ED		     mov     di, [di]
DOSCODE:97EF		     cmp     ss:FIRST_BUFF_ADDR, di
DOSCODE:97F4		     jnz     short nbuffer
DOSCODE:97F6 NEWDSK:				     ; ...
DOSCODE:97F6		     mov     word ptr es:[bp+1Fh], 0FFFFh ; -1
DOSCODE:97FC		     call    GETCURHEAD
DOSCODE:97FF nxbuffer:				     ; ...
DOSCODE:97FF		     cmp     [di+4], al
DOSCODE:9802		     jnz     short lfnxt2
DOSCODE:9804		     test    byte ptr [di+5], 40h ; buf_dirty
DOSCODE:9808		     jnz     short DISK_CHNG_ERR
DOSCODE:980A		     mov     word ptr [di+4], 20FFh
DOSCODE:980F		     call    SCANPLACE
DOSCODE:9812		     jmp     short skpbuff
DOSCODE:9814 lfnxt2:				     ; ...
DOSCODE:9814		     mov     di, [di]
DOSCODE:9816 skpbuff:				     ; ...
DOSCODE:9816		     cmp     di, ss:FIRST_BUFF_ADDR
DOSCODE:981B		     jnz     short nxbuffer
DOSCODE:981D		     cmp     ss:SC_CACHE_COUNT,	0
DOSCODE:9823		     jz	     short GOGETBPB
DOSCODE:9825		     cmp     al, ss:CurSC_DRIVE
DOSCODE:982A		     jnz     short GOGETBPB
DOSCODE:982C		     mov     ss:CurSC_DRIVE, 0FFh ; -1
DOSCODE:9832 GOGETBPB:				     ; ...
DOSCODE:9832		     lds     di, es:[bp+13h]
DOSCODE:9836		     test    byte ptr [di+5], 20h
DOSCODE:983A		     jnz     short GETFREEBUF
DOSCODE:983C		     push    ss
DOSCODE:983D		     pop     ds
DOSCODE:983E		     mov     bx, 2
DOSCODE:9841		     call    UNPACK
DOSCODE:9844 FAIL_OPJ:				     ; ...
DOSCODE:9844		     jb	     short FAIL_OP
DOSCODE:9846		     lds     di, ds:CURBUF
DOSCODE:984A		     jmp     short GOTGETBUF
DOSCODE:984C GETFREEBUF:			     ; ...
DOSCODE:984C		     push    es
DOSCODE:984D		     push    bp
DOSCODE:984E		     xor     dx, dx
DOSCODE:9850		     mov     ss:HIGH_SECTOR, dx
DOSCODE:9855		     call    GETCURHEAD
DOSCODE:9858		     call    BUFWRITE
DOSCODE:985B		     pop     bp
DOSCODE:985C		     pop     es
DOSCODE:985D		     jb	     short FAIL_OPJ
DOSCODE:985F GOTGETBUF:				     ; ...
DOSCODE:985F		     add     di, 20	     ; BUFINSIZ
DOSCODE:9862		     mov     word ptr ss:CALLBR+2, ds ;	[SS:CALLXAD+2]
DOSCODE:9867		     push    ss
DOSCODE:9868		     pop     ds
DOSCODE:9869		     mov     word ptr ds:CALLBR, di ; [CALLXAD]
DOSCODE:986D		     mov     al, 16h
DOSCODE:986F		     mov     ah, es:[bp+1]   ; ES:BP+DPB.UNIT]
DOSCODE:9873		     mov     word ptr ds:DEVCALL, ax ; [DEVCALL_REQLEN]
DOSCODE:9876		     mov     ds:DEVCALL_REQFUNC, 2
DOSCODE:987B		     mov     ds:DEVCALL_REQSTAT, 0
DOSCODE:9881		     mov     al, es:[bp+17h] ; [ES:BP+DPB.MEDIA]
DOSCODE:9885		     mov     ds:CALLUNIT, al ; [CALLMED]
DOSCODE:9888		     push    es
DOSCODE:9889		     push    ds
DOSCODE:988A		     push    word ptr es:[bp+15h]
DOSCODE:988E		     push    word ptr es:[bp+13h] ; [ES:BP+DPB.DRIVER_ADDR]
DOSCODE:9892		     mov     bx, offset	DEVCALL
DOSCODE:9895		     pop     si
DOSCODE:9896		     pop     ds
DOSCODE:9897		     pop     es
DOSCODE:9898		     call    DEVIOCALL2
DOSCODE:989B		     pop     es
DOSCODE:989C		     push    ss
DOSCODE:989D		     pop     ds
DOSCODE:989E		     mov     di, ds:DEVCALL_REQSTAT
DOSCODE:98A2		     or	     di, di
DOSCODE:98A4		     js	     short FATERRJ
DOSCODE:98A6		     mov     al, es:[bp+17h]
DOSCODE:98AA		     lds     si, ds:CALLBPB
DOSCODE:98AE		     mov     word ptr es:[bp+1Dh], 0 ; [ES:BP+DPB.NEXT_FREE]
DOSCODE:98B4		     call    $SETDPB
DOSCODE:98B7		     lds     di, ss:CALLBR   ; [SS:CALLXAD]
DOSCODE:98BC		     mov     al, es:[bp+8]   ; [ES:BP+DPB.FAT_COUNT]
DOSCODE:98C0		     mov     [di-0Ah], al    ; [DI+BUFFINFO.buf_wrtcnt-BUFINSIZ]
DOSCODE:98C3		     mov     ax, es:[bp+0Fh] ; [ES:BP+DPB.FAT_SIZE]
DOSCODE:98C7		     mov     [di-9], ax	     ; [DI+BUFFINFO.buf_wrtcntinc-BUFINSIZ]
DOSCODE:98CA		     push    ss
DOSCODE:98CB		     pop     ds
DOSCODE:98CC		     xor     al, al
DOSCODE:98CE		     retn
DOSCODE:98CF FATERRJ:				     ; ...
DOSCODE:98CF		     jmp     FAT_operation
DOSCODE:98CF FAT_GOT_DPB     endp
DOSCODE:98D2 ; =============== S U B R O U T I N E =======================================
DOSCODE:98D2 GETCURHEAD	     proc near		     ; ...
DOSCODE:98D2		     lds     di, ss:BufferQueue
DOSCODE:98D7		     mov     word ptr ss:LastBuffer, 0FFFFh ; -1
DOSCODE:98DE		     mov     ss:FIRST_BUFF_ADDR, di
DOSCODE:98E3		     retn
DOSCODE:98E3 GETCURHEAD	     endp
DOSCODE:98E4 ; =============== S U B R O U T I N E =======================================
DOSCODE:98E4 SCANPLACE	     proc near		     ; ...
DOSCODE:98E4		     push    word ptr [di]
DOSCODE:98E6		     call    PLACEBUF
DOSCODE:98E9		     pop     di
DOSCODE:98EA		     retn
DOSCODE:98EA SCANPLACE	     endp
DOSCODE:98EB ; =============== S U B R O U T I N E =======================================
DOSCODE:98EB PLACEBUF	     proc near		     ; ...
DOSCODE:98EB		     push    ax
DOSCODE:98EC		     push    bx
DOSCODE:98ED		     push    si
DOSCODE:98EE		     mov     ax, [di]
DOSCODE:98F0		     mov     bx, word ptr ss:BufferQueue
DOSCODE:98F5		     cmp     ax, bx
DOSCODE:98F7		     jz	     short nret
DOSCODE:98F9		     cmp     di, bx
DOSCODE:98FB		     jnz     short not_first
DOSCODE:98FD		     mov     word ptr ss:BufferQueue, ax
DOSCODE:9901		     jmp     short nret
DOSCODE:9903 not_first:				     ; ...
DOSCODE:9903		     mov     si, [di+2]
DOSCODE:9906		     mov     [si], ax
DOSCODE:9908		     xchg    ax, si
DOSCODE:9909		     mov     [si+2], ax
DOSCODE:990C		     mov     si, [bx+2]
DOSCODE:990F		     mov     [si], di
DOSCODE:9911		     mov     [bx+2], di
DOSCODE:9914		     mov     [di+2], si
DOSCODE:9917		     mov     [di], bx
DOSCODE:9919 nret:				     ; ...
DOSCODE:9919		     pop     si
DOSCODE:991A		     pop     bx
DOSCODE:991B		     pop     ax
DOSCODE:991C		     cmp     byte ptr [di+4], 0FFh
DOSCODE:9920		     jnz     short pbx
DOSCODE:9922		     mov     word ptr ss:BufferQueue, di
DOSCODE:9927 pbx:				     ; ...
DOSCODE:9927		     retn
DOSCODE:9927 PLACEBUF	     endp
DOSCODE:9928 POINTCOMP:				     ; ...
DOSCODE:9928		     cmp     si, di
DOSCODE:992A		     jnz     short _ret_label
DOSCODE:992C		     push    cx
DOSCODE:992D		     push    dx
DOSCODE:992E		     mov     cx, ds
DOSCODE:9930		     mov     dx, es
DOSCODE:9932		     cmp     cx, dx
DOSCODE:9934		     pop     dx
DOSCODE:9935		     pop     cx
DOSCODE:9936 _ret_label:			     ; ...
DOSCODE:9936		     retn
DOSCODE:9937 ; =============== S U B R O U T I N E =======================================
DOSCODE:9937 GETBUFFR	     proc near		     ; ...
DOSCODE:9937		     xor     si, si
DOSCODE:9937 GETBUFFR	     endp
DOSCODE:9939 ; =============== S U B R O U T I N E =======================================
DOSCODE:9939 GETBUFFRB	     proc near		     ; ...
DOSCODE:9939		     mov     ds:PREREAD, ax
DOSCODE:993C		     mov     al, es:[bp+0]   ; [ES:BP+DPB.DRIVE]
DOSCODE:9940		     lds     di, ds:LastBuffer
DOSCODE:9944		     mov     cx, ss:HIGH_SECTOR
DOSCODE:9949		     cmp     di, 0FFFFh	     ; -1
DOSCODE:994C		     jz	     short getb5
DOSCODE:994E		     cmp     dx, [di+6]	     ; [DI+BUFFINFO.buf_sector]
DOSCODE:9951		     jnz     short getb5
DOSCODE:9953		     cmp     cx, [di+8]	     ; [DI+BUFFINFO.buf_sector+2]
DOSCODE:9956		     jnz     short getb5
DOSCODE:9958		     cmp     al, [di+4]	     ; [DI+BUFFINFO.buf_ID]
DOSCODE:995B		     jnz     short getb5
DOSCODE:995D		     jmp     getb35
DOSCODE:9960 getb5:				     ; ...
DOSCODE:9960		     call    GETCURHEAD
DOSCODE:9963 getb10:				     ; ...
DOSCODE:9963		     cmp     dx, [di+6]
DOSCODE:9966		     jnz     short getb12
DOSCODE:9968		     cmp     cx, [di+8]
DOSCODE:996B		     jnz     short getb12
DOSCODE:996D		     cmp     al, [di+4]
DOSCODE:9970		     jnz     short getb12
DOSCODE:9972		     jmp     getb25
DOSCODE:9975 getb12:				     ; ...
DOSCODE:9975		     mov     di, [di]
DOSCODE:9977		     cmp     di, ss:FIRST_BUFF_ADDR
DOSCODE:997C		     jnz     short getb10
DOSCODE:997E		     push    cx
DOSCODE:997F		     push    si
DOSCODE:9980		     push    dx
DOSCODE:9981		     push    bp
DOSCODE:9982		     push    es
DOSCODE:9983		     call    BUFWRITE
DOSCODE:9986		     pop     es
DOSCODE:9987		     pop     bp
DOSCODE:9988		     pop     dx
DOSCODE:9989		     pop     si
DOSCODE:998A		     pop     ss:HIGH_SECTOR
DOSCODE:998F		     jnb     short getb13
DOSCODE:9991		     jmp     getbx
DOSCODE:9994 getb13:				     ; ...
DOSCODE:9994		     call    SET_RQ_SC_PARMS
DOSCODE:9997		     xor     ah, ah
DOSCODE:9999		     cmp     byte ptr ss:PREREAD, ah
DOSCODE:999E		     jnz     short getb20
DOSCODE:99A0		     lea     bx, [di+20]     ; [DI+BUFINSIZ]
DOSCODE:99A3		     mov     cx, 1
DOSCODE:99A6		     push    si
DOSCODE:99A7		     push    di
DOSCODE:99A8		     push    dx
DOSCODE:99A9		     push    es
DOSCODE:99AA		     cmp     ss:BuffInHMA, 0
DOSCODE:99B0		     jz	     short getb14
DOSCODE:99B2		     push    ds
DOSCODE:99B3		     push    bx
DOSCODE:99B4		     lds     bx, ss:LoMemBuff
DOSCODE:99B9 getb14:				     ; ...
DOSCODE:99B9		     or	     si, si
DOSCODE:99BB		     jz	     short getb15
DOSCODE:99BD		     call    FATSECRD
DOSCODE:99C0		     mov     ah, 2
DOSCODE:99C2		     jmp     short getb17
DOSCODE:99C4 getb15:				     ; ...
DOSCODE:99C4		     call    DREAD
DOSCODE:99C7		     mov     ah, 0
DOSCODE:99C9 getb17:				     ; ...
DOSCODE:99C9		     pushf
DOSCODE:99CA		     cmp     ss:BuffInHMA, 0
DOSCODE:99D0		     jz	     short not_in_hma
DOSCODE:99D2		     mov     cx, es:[bp+2]
DOSCODE:99D6		     shr     cx, 1
DOSCODE:99D8		     popf
DOSCODE:99D9		     mov     si, bx
DOSCODE:99DB		     pop     di
DOSCODE:99DC		     pop     es
DOSCODE:99DD		     cld
DOSCODE:99DE		     pushf
DOSCODE:99DF		     rep movsw
DOSCODE:99E1		     push    es
DOSCODE:99E2		     pop     ds
DOSCODE:99E3 not_in_hma:			     ; ...
DOSCODE:99E3		     popf
DOSCODE:99E4		     pop     es
DOSCODE:99E5		     pop     dx
DOSCODE:99E6		     pop     di
DOSCODE:99E7		     pop     si
DOSCODE:99E8		     jb	     short getbx
DOSCODE:99EA getb20:				     ; ...
DOSCODE:99EA		     mov     cx, ss:HIGH_SECTOR
DOSCODE:99EF		     mov     [di+8], cx	     ; [DI+BUFFINFO.buf_sector+2]
DOSCODE:99F2		     mov     [di+6], dx	     ; [DI+BUFFINFO.buf_sector]
DOSCODE:99F5		     mov     [di+0Dh], bp    ; [DI+BUFFINFO.buf_DPB]
DOSCODE:99F8		     mov     word ptr [di+0Fh],	es ; [DI+BUFFINFO.buf_DPB+2]
DOSCODE:99FB		     mov     al, es:[bp+0]   ; [ES:BP+DPB.DRIVE]
DOSCODE:99FF		     mov     [di+4], ax	     ; [DI+BUFFINFO.buf_ID]
DOSCODE:9A02 getb25:				     ; ...
DOSCODE:9A02		     mov     byte ptr [di+0Ah],	1 ; [DI+BUFFINFO.buf_wrtcnt]
DOSCODE:9A06		     xor     ax, ax
DOSCODE:9A08		     or	     si, si
DOSCODE:9A0A		     jz	     short getb30
DOSCODE:9A0C		     mov     al, es:[bp+8]   ; [ES:BP+DPB.FAT_COUNT]
DOSCODE:9A10		     mov     [di+0Ah], al    ; [DI+BUFFINFO.buf_wrtcnt]
DOSCODE:9A13		     mov     ax, es:[bp+0Fh] ; [ES:BP+DPB.FAT_SIZE]
DOSCODE:9A17 getb30:				     ; ...
DOSCODE:9A17		     mov     [di+0Bh], ax    ; [DI+BUFFINFO.buf_wrtcntinc]
DOSCODE:9A1A		     call    PLACEBUF
DOSCODE:9A1D getb35:				     ; ...
DOSCODE:9A1D		     mov     word ptr ss:CURBUF+2, ds
DOSCODE:9A22		     mov     word ptr ss:LastBuffer+2, ds
DOSCODE:9A27		     mov     word ptr ss:CURBUF, di
DOSCODE:9A2C		     mov     word ptr ss:LastBuffer, di
DOSCODE:9A31		     clc
DOSCODE:9A32 getbx:				     ; ...
DOSCODE:9A32		     push    ss
DOSCODE:9A33		     pop     ds
DOSCODE:9A34 getbuffrb_retn:			     ; ...
DOSCODE:9A34		     retn
DOSCODE:9A34 GETBUFFRB	     endp ; sp-analysis	failed
DOSCODE:9A35 ; =============== S U B R O U T I N E =======================================
DOSCODE:9A35 FLUSHBUF	     proc near		     ; ...
DOSCODE:9A35		     call    GETCURHEAD
DOSCODE:9A38		     test    byte ptr ss:DOS34_FLAG, 4
DOSCODE:9A3E		     jnz     short scan_buf_queue
DOSCODE:9A40		     cmp     ss:DirtyBufferCount, 0
DOSCODE:9A46		     jz	     short end_scan
DOSCODE:9A48 scan_buf_queue:			     ; ...
DOSCODE:9A48		     call    CHECKFLUSH
DOSCODE:9A4B		     mov     ah, [di+4]
DOSCODE:9A4E		     cmp     ss:WPERR, ah
DOSCODE:9A53		     jz	     short free_the_buf
DOSCODE:9A55		     test    byte ptr ss:DOS34_FLAG, 4
DOSCODE:9A5B		     jz	     short dont_free_the_buf
DOSCODE:9A5D free_the_buf:			     ; ...
DOSCODE:9A5D		     mov     word ptr [di+4], 0FFh ; [DI+BUFFINFO.buf_ID]
DOSCODE:9A62 dont_free_the_buf:			     ; ...
DOSCODE:9A62		     mov     di, [di]	     ; [DI+BUFFINFO.buf_link]
DOSCODE:9A64		     cmp     di, ss:FIRST_BUFF_ADDR
DOSCODE:9A69		     jnz     short scan_buf_queue
DOSCODE:9A6B end_scan:				     ; ...
DOSCODE:9A6B		     push    ss
DOSCODE:9A6C		     pop     ds
DOSCODE:9A6D		     cmp     ds:FAILERR, 0
DOSCODE:9A72		     jnz     short bad_flush
DOSCODE:9A74		     retn
DOSCODE:9A75 bad_flush:				     ; ...
DOSCODE:9A75		     stc
DOSCODE:9A76		     retn
DOSCODE:9A76 FLUSHBUF	     endp
DOSCODE:9A77 ; =============== S U B R O U T I N E =======================================
DOSCODE:9A77 CHECKFLUSH	     proc near		     ; ...
DOSCODE:9A77		     mov     ah, 0FFh
DOSCODE:9A79		     cmp     [di+4], ah
DOSCODE:9A7C		     jz	     short getbuffrb_retn
DOSCODE:9A7E		     cmp     ah, al
DOSCODE:9A80		     jz	     short DOBUFFER
DOSCODE:9A82		     cmp     al, [di+4]
DOSCODE:9A85		     clc
DOSCODE:9A86		     jnz     short getbuffrb_retn
DOSCODE:9A88 DOBUFFER:				     ; ...
DOSCODE:9A88		     test    byte ptr [di+5], 40h ; buf_dirty
DOSCODE:9A8C		     jz	     short getbuffrb_retn
DOSCODE:9A8E		     push    ax
DOSCODE:9A8F		     push    word ptr [di+4]
DOSCODE:9A92		     call    BUFWRITE
DOSCODE:9A95		     pop     ax
DOSCODE:9A96		     jb	     short LEAVE_BUF
DOSCODE:9A98		     and     ah, 0BFh	     ; not 40h
DOSCODE:9A9B		     mov     [di+4], ax
DOSCODE:9A9E LEAVE_BUF:				     ; ...
DOSCODE:9A9E		     pop     ax
DOSCODE:9A9F checkflush_retn:			     ; ...
DOSCODE:9A9F		     retn
DOSCODE:9A9F CHECKFLUSH	     endp
DOSCODE:9AA0 ; =============== S U B R O U T I N E =======================================
DOSCODE:9AA0 BUFWRITE	     proc near		     ; ...
DOSCODE:9AA0		     mov     ax, 0FFh
DOSCODE:9AA3		     xchg    ax, [di+4]	     ; [DI+BUFFINFO.buf_ID]
DOSCODE:9AA6		     cmp     al, 0FFh
DOSCODE:9AA8		     jz	     short checkflush_retn
DOSCODE:9AAA		     test    ah, 40h
DOSCODE:9AAD		     jz	     short checkflush_retn
DOSCODE:9AAF		     call    DEC_DIRTY_COUNT
DOSCODE:9AB2		     cmp     al, ss:WPERR
DOSCODE:9AB7		     jz	     short checkflush_retn
DOSCODE:9AB9		     mov     ss:SC_DRIVE, al
DOSCODE:9ABD		     les     bp, [di+0Dh]    ; [DI+BUFFINFO.buf_DPB]
DOSCODE:9AC0		     lea     bx, [di+14h]    ; [DI+BUFINSIZ]
DOSCODE:9AC3		     mov     dx, [di+6]	     ; [DI+BUFFINFO.buf_sector]
DOSCODE:9AC6		     mov     cx, [di+8]
DOSCODE:9AC9		     mov     ss:HIGH_SECTOR, cx
DOSCODE:9ACE		     mov     cl, [di+0Ah]    ; [DI+BUFFINFO.buf_wrtcnt]
DOSCODE:9AD1		     xor     ch, ch
DOSCODE:9AD3		     mov     ss:ALLOWED, 18h ; Allowed_RETRY+Allowed_FAIL
DOSCODE:9AD9		     test    ah, 8
DOSCODE:9ADC		     jz	     short NO_IGNORE
DOSCODE:9ADE		     or	     ss:ALLOWED, 20h ; Allowed_IGNORE
DOSCODE:9AE4 NO_IGNORE:				     ; ...
DOSCODE:9AE4		     mov     ax, [di+11]     ; [DI+BUFFINFO.buf_wrtcntinc]
DOSCODE:9AE7		     push    di
DOSCODE:9AE8		     xor     di, di
DOSCODE:9AEA		     push    ds
DOSCODE:9AEB		     push    bx
DOSCODE:9AEC WRTAGAIN:				     ; ...
DOSCODE:9AEC		     push    di
DOSCODE:9AED		     push    cx
DOSCODE:9AEE		     push    ax
DOSCODE:9AEF		     mov     cx, 1
DOSCODE:9AF2		     push    bx
DOSCODE:9AF3		     push    dx
DOSCODE:9AF4		     push    ds
DOSCODE:9AF5		     cmp     ss:BuffInHMA, 0
DOSCODE:9AFB		     jz	     short NBUFFINHMA
DOSCODE:9AFD		     push    cx
DOSCODE:9AFE		     push    es
DOSCODE:9AFF		     mov     si, bx
DOSCODE:9B01		     mov     cx, es:[bp+2]   ; [es:bp+DPB.SECTOR_SIZE]
DOSCODE:9B05		     shr     cx, 1
DOSCODE:9B07		     les     di, ss:LoMemBuff
DOSCODE:9B0C		     mov     bx, di
DOSCODE:9B0E		     cld
DOSCODE:9B0F		     rep movsw
DOSCODE:9B11		     push    es
DOSCODE:9B12		     pop     ds
DOSCODE:9B13		     pop     es
DOSCODE:9B14		     pop     cx
DOSCODE:9B15 NBUFFINHMA:			     ; ...
DOSCODE:9B15		     call    DWRITE
DOSCODE:9B18		     pop     ds
DOSCODE:9B19		     pop     dx
DOSCODE:9B1A		     pop     bx
DOSCODE:9B1B		     pop     ax
DOSCODE:9B1C		     pop     cx
DOSCODE:9B1D		     pop     di
DOSCODE:9B1E		     jb	     short NOSET
DOSCODE:9B20		     inc     di
DOSCODE:9B21 NOSET:				     ; ...
DOSCODE:9B21		     add     dx, ax
DOSCODE:9B23		     loop    WRTAGAIN
DOSCODE:9B25		     pop     bx
DOSCODE:9B26		     pop     ds
DOSCODE:9B27		     or	     di, di
DOSCODE:9B29		     jnz     short BWROK
DOSCODE:9B2B		     stc
DOSCODE:9B2C BWROK:				     ; ...
DOSCODE:9B2C		     pop     di
DOSCODE:9B2D		     retn
DOSCODE:9B2D BUFWRITE	     endp
DOSCODE:9B2E ; =============== S U B R O U T I N E =======================================
DOSCODE:9B2E SET_RQ_SC_PARMS proc near		     ; ...
DOSCODE:9B2E		     push    ax
DOSCODE:9B2F		     mov     ax, es:[bp+2]
DOSCODE:9B33		     mov     ss:SC_SECTOR_SIZE,	ax
DOSCODE:9B37		     mov     al, es:[bp+0]
DOSCODE:9B3B		     mov     ss:SC_DRIVE, al
DOSCODE:9B3F		     pop     ax
DOSCODE:9B40		     retn
DOSCODE:9B40 SET_RQ_SC_PARMS endp
DOSCODE:9B41 ; =============== S U B R O U T I N E =======================================
DOSCODE:9B41 INC_DIRTY_COUNT proc near		     ; ...
DOSCODE:9B41		     inc     ss:DirtyBufferCount
DOSCODE:9B46		     retn
DOSCODE:9B46 INC_DIRTY_COUNT endp
DOSCODE:9B47 ; =============== S U B R O U T I N E =======================================
DOSCODE:9B47 DEC_DIRTY_COUNT proc near		     ; ...
DOSCODE:9B47		     cmp     ss:DirtyBufferCount, 0
DOSCODE:9B4D		     jz	     short ddcx
DOSCODE:9B4F		     dec     ss:DirtyBufferCount
DOSCODE:9B54 ddcx:				     ; ...
DOSCODE:9B54		     retn
DOSCODE:9B54 DEC_DIRTY_COUNT endp
DOSCODE:9B55 $WAIT:				     ; ...
DOSCODE:9B55		     xor     ax, ax
DOSCODE:9B57		     xchg    ax, ss:exit_code
DOSCODE:9B5C		     jmp     SYS_RET_OK
DOSCODE:9B5F ; =============== S U B R O U T I N E =======================================
DOSCODE:9B5F $EXEC	     proc far		     ; ...
DOSCODE:9B5F		     mov     ss:A20OFF_COUNT, 0
DOSCODE:9B65		     cmp     al, 5
DOSCODE:9B67		     jnz     short Exec_@f
DOSCODE:9B69		     pop     cx
DOSCODE:9B6A		     mov     cx, offset	LeaveDOS
DOSCODE:9B6D		     push    cx
DOSCODE:9B6E Exec_@f:				     ; ...
DOSCODE:9B6E		     push    bp
DOSCODE:9B6F		     mov     bp, sp
DOSCODE:9B71		     sub     sp, 29	     ; sub sp, 30  ; Retro DOS v4
DOSCODE:9B74		     cmp     al, 5
DOSCODE:9B76		     jbe     short Exec_Check_2
DOSCODE:9B78 Exec_Bad_Fun:			     ; ...
DOSCODE:9B78		     mov     ss:EXTERR_LOCUS, 1
DOSCODE:9B7E		     mov     al, 1
DOSCODE:9B80 Exec_Ret_Err:			     ; ...
DOSCODE:9B80		     mov     sp, bp
DOSCODE:9B82		     pop     bp
DOSCODE:9B83		     jmp     SYS_RET_ERR
DOSCODE:9B86 ExecReadyJ:			     ; ...
DOSCODE:9B86		     call    ExecReady
DOSCODE:9B89		     jmp     norm_ovl
DOSCODE:9B8C Exec_Check_2:			     ; ...
DOSCODE:9B8C		     cmp     al, 2
DOSCODE:9B8E		     jz	     short Exec_Bad_Fun
DOSCODE:9B90		     cmp     al, 4
DOSCODE:9B92		     jz	     short Exec_Bad_Fun
DOSCODE:9B94		     cmp     al, 5
DOSCODE:9B96		     jz	     short ExecReadyJ
DOSCODE:9B98		     mov     [bp-4], bx
DOSCODE:9B9B		     mov     word ptr [bp-2], es
DOSCODE:9B9E		     mov     [bp-5], al
DOSCODE:9BA1		     mov     byte ptr [bp-6], 0
DOSCODE:9BA5		     mov     [bp-26], dx
DOSCODE:9BA8		     mov     word ptr [bp-24], ds
DOSCODE:9BAB		     mov     si, dx
DOSCODE:9BAD		     call    DStrLen
DOSCODE:9BB0		     mov     [bp-22], cx
DOSCODE:9BB3		     mov     al, ss:AllocMethod
DOSCODE:9BB7		     mov     ss:ALLOCMSAVE, al
DOSCODE:9BBB		     xor     al, al
DOSCODE:9BBD		     push    bp
DOSCODE:9BBE		     or	     ss:DOS_FLAG, 1
DOSCODE:9BC4		     call    $OPEN
DOSCODE:9BC7		     pushf
DOSCODE:9BC8		     and     ss:DOS_FLAG, 0FEh ; not 1
DOSCODE:9BCE		     popf
DOSCODE:9BCF		     pop     bp
DOSCODE:9BD0		     jb	     short Exec_Ret_Err
DOSCODE:9BD2		     mov     [bp-8], ax
DOSCODE:9BD5		     mov     bx, ax
DOSCODE:9BD7		     xor     al, al
DOSCODE:9BD9		     call    $IOCTL
DOSCODE:9BDC		     jb	     short Exec_BombJ
DOSCODE:9BDE		     test    dl, 80h
DOSCODE:9BE1		     jz	     short Exec_Check_Environ
DOSCODE:9BE3		     mov     al, 2
DOSCODE:9BE5 Exec_BombJ:			     ; ...
DOSCODE:9BE5		     jmp     Exec_Bomb
DOSCODE:9BE8 BadEnv:				     ; ...
DOSCODE:9BE8		     mov     al, 0Ah
DOSCODE:9BEA		     jmp     Exec_Bomb
DOSCODE:9BED Exec_Check_Environ:		     ; ...
DOSCODE:9BED		     mov     word ptr [bp-18], 0
DOSCODE:9BF2		     mov     word ptr [bp-14], 0
DOSCODE:9BF7		     test    byte ptr [bp-5], 2
DOSCODE:9BFB		     jnz     short Exec_Read_Header
DOSCODE:9BFD		     lds     si, [bp-4]
DOSCODE:9C00		     mov     ax, [si]
DOSCODE:9C02		     or	     ax, ax
DOSCODE:9C04		     jnz     short Exec_Scan_Env
DOSCODE:9C06		     mov     ds, ss:CurrentPDB
DOSCODE:9C0B		     mov     ax, ds:2Ch
DOSCODE:9C0E		     or	     ax, ax
DOSCODE:9C10		     jz	     short Exec_Read_Header
DOSCODE:9C12 Exec_Scan_Env:			     ; ...
DOSCODE:9C12		     mov     es, ax
DOSCODE:9C14		     xor     di, di
DOSCODE:9C16		     mov     cx, 8000h
DOSCODE:9C19		     xor     al, al
DOSCODE:9C1B Exec_Get_Environ_Len:		     ; ...
DOSCODE:9C1B		     repne scasb
DOSCODE:9C1D		     jnz     short BadEnv
DOSCODE:9C1F		     dec     cx
DOSCODE:9C20		     js	     short BadEnv
DOSCODE:9C22		     scasb
DOSCODE:9C23		     jnz     short Exec_Get_Environ_Len
DOSCODE:9C25		     push    di
DOSCODE:9C26		     lea     bx, [di+11h]
DOSCODE:9C29		     add     bx, [bp-22]
DOSCODE:9C2C		     mov     cl, 4
DOSCODE:9C2E		     shr     bx, cl
DOSCODE:9C30		     push    es
DOSCODE:9C31		     call    $ALLOC
DOSCODE:9C34		     pop     ds
DOSCODE:9C35		     pop     cx
DOSCODE:9C36		     jnb     short Exec_Save_Environ
DOSCODE:9C38		     jmp     short Exec_No_Mem
DOSCODE:9C3A Exec_Save_Environ:			     ; ...
DOSCODE:9C3A		     mov     es, ax
DOSCODE:9C3C		     mov     [bp-14], ax
DOSCODE:9C3F		     xor     si, si
DOSCODE:9C41		     mov     di, si
DOSCODE:9C43		     rep movsb
DOSCODE:9C45		     mov     ax, 1
DOSCODE:9C48		     stosw
DOSCODE:9C49		     lds     si, [bp-26]
DOSCODE:9C4C		     mov     cx, [bp-22]
DOSCODE:9C4F		     rep movsb
DOSCODE:9C51 Exec_Read_Header:			     ; ...
DOSCODE:9C51		     push    ss
DOSCODE:9C52		     pop     ds
DOSCODE:9C53		     mov     cx, 26
DOSCODE:9C56		     mov     dx, offset	exec_signature
DOSCODE:9C59		     push    es
DOSCODE:9C5A		     push    ds
DOSCODE:9C5B		     call    ExecRead
DOSCODE:9C5E		     pop     ds
DOSCODE:9C5F		     pop     es
DOSCODE:9C60		     jb	     short Exec_Bad_File
DOSCODE:9C62		     or	     ax, ax
DOSCODE:9C64		     jz	     short Exec_Bad_File
DOSCODE:9C66		     cmp     ax, 26
DOSCODE:9C69		     jnz     short Exec_Com_Filej
DOSCODE:9C6B		     test    ds:exec_max_BSS, 0FFFFh
DOSCODE:9C71		     jnz     short Exec_Check_Sig
DOSCODE:9C73		     mov     byte ptr [bp-6], 0FFh
DOSCODE:9C77 Exec_Check_Sig:			     ; ...
DOSCODE:9C77		     mov     ax, ds:exec_signature
DOSCODE:9C7A		     cmp     ax, 'ZM'
DOSCODE:9C7D		     jz	     short Exec_Save_Start
DOSCODE:9C7F		     cmp     ax, 'MZ'
DOSCODE:9C82		     jz	     short Exec_Save_Start
DOSCODE:9C84 Exec_Com_Filej:			     ; ...
DOSCODE:9C84		     jmp     Exec_Com_File
DOSCODE:9C87 Exec_Save_Start:			     ; ...
DOSCODE:9C87		     mov     ax, ds:exec_pages
DOSCODE:9C8A		     mov     cl, 5
DOSCODE:9C8C		     shl     ax, cl
DOSCODE:9C8E		     sub     ax, ds:exec_par_dir
DOSCODE:9C92		     mov     [bp-12], ax
DOSCODE:9C95		     test    byte ptr [bp-5], 2
DOSCODE:9C99		     jz	     short Exec_Allocate
DOSCODE:9C9B		     les     di, [bp-4]
DOSCODE:9C9E		     mov     ax, es:[di]
DOSCODE:9CA1		     mov     [bp-20], ax
DOSCODE:9CA4		     mov     ax, es:[di+2]
DOSCODE:9CA8		     mov     [bp-10], ax
DOSCODE:9CAB		     jmp     Exec_Find_Res
DOSCODE:9CAE Exec_No_Mem:			     ; ...
DOSCODE:9CAE		     mov     al, 8
DOSCODE:9CB0		     jmp     short Exec_Bomb
DOSCODE:9CB2 Exec_Bad_File:			     ; ...
DOSCODE:9CB2		     mov     al, 0Bh
DOSCODE:9CB4 Exec_Bomb:				     ; ...
DOSCODE:9CB4		     mov     bx, [bp-8]
DOSCODE:9CB7		     call    Exec_Dealloc
DOSCODE:9CBA		     call    LCritDisk
DOSCODE:9CBD		     push    ax
DOSCODE:9CBE		     push    bp
DOSCODE:9CBF		     call    $CLOSE
DOSCODE:9CC2		     pop     bp
DOSCODE:9CC3		     pop     ax
DOSCODE:9CC4		     jmp     Exec_Ret_Err
DOSCODE:9CC7 Exec_Chk_Mem:			     ; ...
DOSCODE:9CC7		     mov     al, ss:AllocMethod
DOSCODE:9CCB		     mov     bl, ss:ALLOCMSAVE
DOSCODE:9CD0		     mov     ss:AllocMethod, bl
DOSCODE:9CD5		     test    bl, 40h
DOSCODE:9CD8		     jnz     short Exec_No_Mem
DOSCODE:9CDA		     test    al, 40h
DOSCODE:9CDC		     jz	     short Exec_No_Mem
DOSCODE:9CDE		     mov     ax, ss:SAVE_AX
DOSCODE:9CE2		     jmp     short Exec_Norm_Alloc
DOSCODE:9CE4 Exec_Allocate:			     ; ...
DOSCODE:9CE4		     mov     byte ptr [bp-29], 0
DOSCODE:9CE8		     cmp     ds:exec_SS, 0
DOSCODE:9CED		     jnz     short ea1
DOSCODE:9CEF		     cmp     ds:exec_SP, 0
DOSCODE:9CF4		     jnz     short ea1
DOSCODE:9CF6		     inc     byte ptr [bp-29]
DOSCODE:9CF9		     cmp     ax, 0FF0h	     ; 1000h-10h
DOSCODE:9CFC		     jnb     short ea1
DOSCODE:9CFE		     add     ax, 10h
DOSCODE:9D01 ea1:				     ; ...
DOSCODE:9D01		     test    ds:AllocMethod, 80h ; HIGH_FIRST
DOSCODE:9D06		     jz	     short Exec_Norm_Alloc
DOSCODE:9D08		     or	     ds:AllocMethod, 40h ; HIGH_ONLY
DOSCODE:9D0D Exec_Norm_Alloc:			     ; ...
DOSCODE:9D0D		     mov     ds:SAVE_AX, ax
DOSCODE:9D10		     mov     bx, 0FFFFh
DOSCODE:9D13		     push    ds
DOSCODE:9D14		     call    $ALLOC
DOSCODE:9D17		     pop     ds
DOSCODE:9D18		     mov     ax, ds:SAVE_AX
DOSCODE:9D1B		     add     ax, 10h
DOSCODE:9D1E		     cmp     bx, 11h
DOSCODE:9D21		     jb	     short Exec_Chk_Mem
DOSCODE:9D23		     cmp     ax, bx
DOSCODE:9D25		     ja	     short Exec_Chk_Mem
DOSCODE:9D27		     test    byte ptr [bp-6], 0FFh
DOSCODE:9D2B		     jnz     short Exec_BX_Max
DOSCODE:9D2D		     add     ax, ds:exec_min_BSS
DOSCODE:9D31		     jb	     short Exec_Chk_Mem
DOSCODE:9D33		     cmp     ax, bx
DOSCODE:9D35		     ja	     short Exec_Chk_Mem
DOSCODE:9D37		     sub     ax, ds:exec_min_BSS
DOSCODE:9D3B		     add     ax, ds:exec_max_BSS
DOSCODE:9D3F		     jb	     short Exec_BX_Max
DOSCODE:9D41		     cmp     ax, bx
DOSCODE:9D43		     jbe     short Exec_Got_Block
DOSCODE:9D45 Exec_BX_Max:			     ; ...
DOSCODE:9D45		     mov     ax, bx
DOSCODE:9D47 Exec_Got_Block:			     ; ...
DOSCODE:9D47		     push    ds
DOSCODE:9D48		     mov     bx, ax
DOSCODE:9D4A		     mov     [bp-16], bx
DOSCODE:9D4D		     call    $ALLOC
DOSCODE:9D50		     pop     ds
DOSCODE:9D51		     jnb     short eat0
DOSCODE:9D53		     jmp     Exec_Chk_Mem
DOSCODE:9D56 eat0:				     ; ...
DOSCODE:9D56		     mov     cl, ds:ALLOCMSAVE
DOSCODE:9D5A		     mov     ds:AllocMethod, cl
DOSCODE:9D5E		     cmp     byte ptr [bp-29], 0
DOSCODE:9D62		     jz	     short ea2
DOSCODE:9D64		     cmp     bx, 1000h
DOSCODE:9D68		     jnb     short ea2
DOSCODE:9D6A		     mov     cl, 4
DOSCODE:9D6C		     shl     bx, cl
DOSCODE:9D6E		     sub     bx, 100h
DOSCODE:9D72		     mov     ds:exec_SP, bx
DOSCODE:9D76 ea2:				     ; ...
DOSCODE:9D76		     mov     [bp-18], ax
DOSCODE:9D79		     add     ax, 10h
DOSCODE:9D7C		     test    byte ptr [bp-6], 0FFh
DOSCODE:9D80		     jz	     short Exec_Use_AX
DOSCODE:9D82		     add     ax, [bp-16]
DOSCODE:9D85		     sub     ax, [bp-12]
DOSCODE:9D88		     sub     ax, 10h
DOSCODE:9D8B Exec_Use_AX:			     ; ...
DOSCODE:9D8B		     mov     [bp-10], ax
DOSCODE:9D8E		     mov     [bp-20], ax
DOSCODE:9D91 Exec_Find_Res:			     ; ...
DOSCODE:9D91		     mov     dx, [bp-20]
DOSCODE:9D94		     mov     [bp-28], dx
DOSCODE:9D97		     mov     dx, ds:exec_par_dir
DOSCODE:9D9B		     push    dx
DOSCODE:9D9C		     mov     cl, 4
DOSCODE:9D9E		     shl     dx, cl
DOSCODE:9DA0		     pop     ax
DOSCODE:9DA1		     mov     cl, 12
DOSCODE:9DA3		     shr     ax, cl
DOSCODE:9DA5		     mov     cx, ax
DOSCODE:9DA7		     mov     bx, [bp-8]
DOSCODE:9DAA		     push    ds
DOSCODE:9DAB		     xor     al, al
DOSCODE:9DAD		     call    $LSEEK
DOSCODE:9DB0		     pop     ds
DOSCODE:9DB1		     jnb     short Exec_Big_Read
DOSCODE:9DB3		     jmp     Exec_Bomb
DOSCODE:9DB6 Exec_Big_Read:			     ; ...
DOSCODE:9DB6		     mov     bx, [bp-12]
DOSCODE:9DB9		     cmp     bx, 1000h
DOSCODE:9DBD		     jb	     short Exec_Read_OK
DOSCODE:9DBF		     mov     bx, 0FE0h
DOSCODE:9DC2 Exec_Read_OK:			     ; ...
DOSCODE:9DC2		     sub     [bp-12], bx
DOSCODE:9DC5		     push    bx
DOSCODE:9DC6		     mov     cl, 4
DOSCODE:9DC8		     shl     bx, cl
DOSCODE:9DCA		     mov     cx, bx
DOSCODE:9DCC		     push    ds
DOSCODE:9DCD		     mov     ds, word ptr [bp-20]
DOSCODE:9DD0		     xor     dx, dx
DOSCODE:9DD2		     push    cx
DOSCODE:9DD3		     call    ExecRead
DOSCODE:9DD6		     pop     cx
DOSCODE:9DD7		     pop     ds
DOSCODE:9DD8		     jb	     short Exec_Bad_FileJ
DOSCODE:9DDA		     cmp     cx, ax
DOSCODE:9DDC		     pop     bx
DOSCODE:9DDD		     jz	     short ExecCheckEnd
DOSCODE:9DDF		     sub     cx, ax
DOSCODE:9DE1		     cmp     cx, 512
DOSCODE:9DE5		     jnb     short Exec_Bad_FileJ
DOSCODE:9DE7 ExecCheckEnd:			     ; ...
DOSCODE:9DE7		     add     [bp-20], bx
DOSCODE:9DEA		     test    word ptr [bp-12], 0FFFFh
DOSCODE:9DEF		     jnz     short Exec_Big_Read
DOSCODE:9DF1		     mov     cx, [bp-10]
DOSCODE:9DF4		     mov     ax, ds:exec_SS
DOSCODE:9DF7		     add     ax, cx
DOSCODE:9DF9		     mov     ds:exec_init_SS, ax
DOSCODE:9DFC		     mov     ax, ds:exec_SP
DOSCODE:9DFF		     mov     ds:exec_init_SP, ax
DOSCODE:9E02		     les     ax, dword ptr ds:exec_IP
DOSCODE:9E06		     mov     ds:exec_init_IP, ax
DOSCODE:9E09		     mov     ax, es
DOSCODE:9E0B		     add     ax, cx
DOSCODE:9E0D		     mov     ds:exec_init_CS, ax
DOSCODE:9E10		     xor     cx, cx
DOSCODE:9E12		     mov     dx, ds:exec_rle_table
DOSCODE:9E16		     mov     bx, [bp-8]
DOSCODE:9E19		     push    ds
DOSCODE:9E1A		     xor     ax, ax
DOSCODE:9E1C		     call    $LSEEK
DOSCODE:9E1F		     pop     ds
DOSCODE:9E20		     jnb     short exec_get_entries
DOSCODE:9E22 Exec_Bad_FileJ:			     ; ...
DOSCODE:9E22		     jmp     Exec_Bad_File
DOSCODE:9E25 exec_get_entries:			     ; ...
DOSCODE:9E25		     mov     dx, ds:exec_rle_count
DOSCODE:9E29 exec_read_reloc:			     ; ...
DOSCODE:9E29		     push    dx
DOSCODE:9E2A		     mov     dx, offset	OPENBUF	; Exec_Internal_Buffer
DOSCODE:9E2D		     mov     cx, 396	     ; (Exec_Internal_Buffer_Size)/4)*4
DOSCODE:9E30		     push    ds
DOSCODE:9E31		     call    ExecRead
DOSCODE:9E34		     pop     es
DOSCODE:9E35		     pop     dx
DOSCODE:9E36		     jb	     short Exec_Bad_FileJ
DOSCODE:9E38		     mov     cx, 99	     ; (Exec_Internal_Buffer_Size)/4
DOSCODE:9E3B		     mov     di, offset	OPENBUF	; Exec_Internal_Buffer
DOSCODE:9E3E		     mov     si, [bp-10]
DOSCODE:9E41 exec_reloc_one:			     ; ...
DOSCODE:9E41		     or	     dx, dx
DOSCODE:9E43		     jz	     short Exec_Set_PDBJ
DOSCODE:9E45 exec_get_addr:
DOSCODE:9E45		     lds     bx, es:[di]
DOSCODE:9E48		     mov     ax, ds
DOSCODE:9E4A		     add     ax, [bp-28]
DOSCODE:9E4D		     mov     ds, ax
DOSCODE:9E4F		     add     [bx], si
DOSCODE:9E51		     add     di, 4
DOSCODE:9E54		     dec     dx
DOSCODE:9E55		     loop    exec_reloc_one
DOSCODE:9E57		     push    es
DOSCODE:9E58		     pop     ds
DOSCODE:9E59		     jmp     short exec_read_reloc
DOSCODE:9E5B Exec_Set_PDBJ:			     ; ...
DOSCODE:9E5B		     push    es
DOSCODE:9E5C		     push    ax
DOSCODE:9E5D		     push    cx
DOSCODE:9E5E		     mov     es, word ptr [bp-28]
DOSCODE:9E61		     mov     ax, ss:exec_init_CS
DOSCODE:9E65		     mov     cx, ss:exec_init_IP
DOSCODE:9E6A		     call    ss:FixExePatch
DOSCODE:9E6F		     call    ss:Rational386PatchPtr
DOSCODE:9E74		     pop     cx
DOSCODE:9E75		     pop     ax
DOSCODE:9E76		     pop     es
DOSCODE:9E77		     jmp     Exec_Set_PDB
DOSCODE:9E7A Exec_No_Memj:			     ; ...
DOSCODE:9E7A		     jmp     Exec_No_Mem
DOSCODE:9E7D Exec_Com_File:			     ; ...
DOSCODE:9E7D		     test    byte ptr [bp-5], 2
DOSCODE:9E81		     jz	     short Exec_Alloc_Com_File
DOSCODE:9E83		     lds     si, [bp-4]
DOSCODE:9E86		     lodsw
DOSCODE:9E87		     mov     [bp-20], ax
DOSCODE:9E8A		     mov     ax, 0FFFFh
DOSCODE:9E8D		     jmp     short Exec_Read_Block
DOSCODE:9E8F Exec_Chk_Com_Mem:			     ; ...
DOSCODE:9E8F		     mov     al, ss:AllocMethod
DOSCODE:9E93		     mov     bl, ss:ALLOCMSAVE
DOSCODE:9E98		     mov     ss:AllocMethod, bl
DOSCODE:9E9D		     test    bl, 40h
DOSCODE:9EA0		     jnz     short Exec_No_Memj
DOSCODE:9EA2		     test    al, 40h
DOSCODE:9EA4		     jz	     short Exec_No_Memj
DOSCODE:9EA6		     mov     ax, [bp-18]
DOSCODE:9EA9		     xor     bx, bx
DOSCODE:9EAB		     call    ChangeOwner
DOSCODE:9EAE		     jmp     short Exec_Norm_Com_Alloc
DOSCODE:9EB0 Exec_Alloc_Com_File:		     ; ...
DOSCODE:9EB0		     test    ss:AllocMethod, 80h
DOSCODE:9EB6		     jz	     short Exec_Norm_Com_Alloc
DOSCODE:9EB8		     or	     ss:AllocMethod, 40h
DOSCODE:9EBE Exec_Norm_Com_Alloc:		     ; ...
DOSCODE:9EBE		     mov     bx, 0FFFFh
DOSCODE:9EC1		     call    $ALLOC
DOSCODE:9EC4		     or	     bx, bx
DOSCODE:9EC6		     jz	     short Exec_Chk_Com_Mem
DOSCODE:9EC8		     mov     [bp-16], bx
DOSCODE:9ECB		     push    bx
DOSCODE:9ECC		     call    $ALLOC
DOSCODE:9ECF		     pop     bx
DOSCODE:9ED0		     mov     [bp-18], ax
DOSCODE:9ED3		     add     ax, 10h
DOSCODE:9ED6		     mov     [bp-20], ax
DOSCODE:9ED9		     xor     ax, ax
DOSCODE:9EDB		     cmp     bx, 1000h
DOSCODE:9EDF		     jnb     short Exec_Read_Com
DOSCODE:9EE1		     mov     ax, bx
DOSCODE:9EE3		     mov     cl, 4
DOSCODE:9EE5		     shl     ax, cl
DOSCODE:9EE7		     cmp     ax, 200h
DOSCODE:9EEA		     jbe     short Exec_Chk_Com_Mem
DOSCODE:9EEC		     sub     ax, 100h
DOSCODE:9EEF Exec_Read_Com:			     ; ...
DOSCODE:9EEF		     sub     ax, 100h
DOSCODE:9EF2 Exec_Read_Block:			     ; ...
DOSCODE:9EF2		     push    ax
DOSCODE:9EF3		     mov     bx, [bp-8]
DOSCODE:9EF6		     xor     cx, cx
DOSCODE:9EF8		     mov     dx, cx
DOSCODE:9EFA		     xor     ax, ax
DOSCODE:9EFC		     call    $LSEEK
DOSCODE:9EFF		     pop     cx
DOSCODE:9F00		     mov     ds, word ptr [bp-20]
DOSCODE:9F03		     xor     dx, dx
DOSCODE:9F05		     push    cx
DOSCODE:9F06		     call    ExecRead
DOSCODE:9F09		     pop     si
DOSCODE:9F0A		     jnb     short OkRead
DOSCODE:9F0C		     jmp     Exec_Bad_File
DOSCODE:9F0F OkRead:				     ; ...
DOSCODE:9F0F		     cmp     ax, si
DOSCODE:9F11		     jnz     short OkRead2
DOSCODE:9F13		     jmp     Exec_Chk_Com_Mem
DOSCODE:9F16 OkRead2:				     ; ...
DOSCODE:9F16		     mov     bl, ss:ALLOCMSAVE
DOSCODE:9F1B		     mov     ss:AllocMethod, bl
DOSCODE:9F20		     test    byte ptr [bp-5], 2
DOSCODE:9F24		     jnz     short Exec_Set_PDB
DOSCODE:9F26		     mov     ax, [bp-20]
DOSCODE:9F29		     sub     ax, 10h
DOSCODE:9F2C		     mov     ss:exec_init_CS, ax
DOSCODE:9F30		     mov     ss:exec_init_IP, 100h
DOSCODE:9F37		     add     si, 0FEh
DOSCODE:9F3B		     cmp     si, 0FFFEh
DOSCODE:9F3E		     jz	     short Exec_St_Ok
DOSCODE:9F40		     add     si, 100h
DOSCODE:9F44 Exec_St_Ok:			     ; ...
DOSCODE:9F44		     mov     ss:exec_init_SP, si
DOSCODE:9F49		     mov     ss:exec_init_SS, ax
DOSCODE:9F4D		     mov     ds, ax
DOSCODE:9F4F		     mov     word ptr [si], 0
DOSCODE:9F53		     call    ss:ChkCopyProt
DOSCODE:9F58 Exec_Set_PDB:			     ; ...
DOSCODE:9F58		     mov     bx, [bp-8]
DOSCODE:9F5B		     call    Exec_Dealloc
DOSCODE:9F5E		     push    bp
DOSCODE:9F5F		     call    $CLOSE
DOSCODE:9F62		     pop     bp
DOSCODE:9F63		     call    Exec_Alloc
DOSCODE:9F66		     test    byte ptr [bp-5], 2	; exec_func_overlay
DOSCODE:9F6A		     jz	     short Exec_Build_Header
DOSCODE:9F6C		     call    Scan_Execname
DOSCODE:9F6F		     call    Scan_Special_Entries
DOSCODE:9F72		     cmp     ss:DriverLoad, 0
DOSCODE:9F78		     jz	     short norm_ovl
DOSCODE:9F7A		     push    si
DOSCODE:9F7B		     push    es
DOSCODE:9F7C		     les     si, ss:BiosDataPtr
DOSCODE:9F81		     cmp     byte ptr es:[si], 0
DOSCODE:9F85		     jz	     short sysinit_done
DOSCODE:9F87		     mov     es, ss:CurrentPDB
DOSCODE:9F8C		     push    ss:SPECIAL_VERSION
DOSCODE:9F91		     pop     word ptr es:40h
DOSCODE:9F96		     jmp     short setver_done
DOSCODE:9F98 sysinit_done:			     ; ...
DOSCODE:9F98		     mov     ss:DriverLoad, 0
DOSCODE:9F9E setver_done:			     ; ...
DOSCODE:9F9E		     pop     es
DOSCODE:9F9F		     pop     si
DOSCODE:9FA0 norm_ovl:				     ; ...
DOSCODE:9FA0		     mov     sp, bp
DOSCODE:9FA2		     pop     bp
DOSCODE:9FA3		     jmp     SYS_RET_OK
DOSCODE:9FA6 Exec_Build_Header:			     ; ...
DOSCODE:9FA6		     mov     dx, [bp-18]
DOSCODE:9FA9		     mov     si, 1
DOSCODE:9FAC		     mov     ax, [bp-14]
DOSCODE:9FAF		     or	     ax, ax
DOSCODE:9FB1		     jz	     short No_Owner
DOSCODE:9FB3		     dec     ax
DOSCODE:9FB4		     mov     ds, ax
DOSCODE:9FB6		     mov     [si], dx
DOSCODE:9FB8 No_Owner:				     ; ...
DOSCODE:9FB8		     mov     ax, [bp-18]
DOSCODE:9FBB		     dec     ax
DOSCODE:9FBC		     mov     ds, ax
DOSCODE:9FBE		     mov     [si], dx
DOSCODE:9FC0		     push    ds
DOSCODE:9FC1		     pop     es
DOSCODE:9FC2		     mov     di, 8
DOSCODE:9FC5		     call    Scan_Execname
DOSCODE:9FC8		     push    cx
DOSCODE:9FC9		     push    si
DOSCODE:9FCA MoveName:				     ; ...
DOSCODE:9FCA		     lodsb
DOSCODE:9FCB		     cmp     al, '.'
DOSCODE:9FCD		     jz	     short mem_done
DOSCODE:9FCF		     stosb
DOSCODE:9FD0		     cmp     di, 16	     ; ARENAHEADERSIZE
DOSCODE:9FD3		     jnb     short mem_done
DOSCODE:9FD5		     loop    MoveName
DOSCODE:9FD7 mem_done:				     ; ...
DOSCODE:9FD7		     xor     al, al
DOSCODE:9FD9		     cmp     di, 16
DOSCODE:9FDC		     jnb     short Fill8
DOSCODE:9FDE		     stosb
DOSCODE:9FDF Fill8:				     ; ...
DOSCODE:9FDF		     pop     si
DOSCODE:9FE0		     pop     cx
DOSCODE:9FE1		     call    Scan_Special_Entries
DOSCODE:9FE4		     push    dx
DOSCODE:9FE5		     mov     si, [bp-16]
DOSCODE:9FE8		     add     si, dx
DOSCODE:9FEA		     call    $DUP_PDB
DOSCODE:9FED		     pop     dx
DOSCODE:9FEE		     push    word ptr [bp-14]
DOSCODE:9FF1		     pop     word ptr es:2Ch ; [ES:PDB.ENVIRON]
DOSCODE:9FF6		     push    ss:SPECIAL_VERSION
DOSCODE:9FFB		     pop     word ptr es:40h ; [ES:PDB.Version]
DOSCODE:A000		     lds     si, [bp-4]
DOSCODE:A003		     push    ds
DOSCODE:A004		     push    si
DOSCODE:A005		     lds     si, [si+6]
DOSCODE:A008		     mov     cx, 12
DOSCODE:A00B		     push    cx
DOSCODE:A00C		     mov     di, 5Ch
DOSCODE:A00F		     mov     bl, [si]
DOSCODE:A011		     rep movsb
DOSCODE:A013		     xor     ax, ax
DOSCODE:A015		     stosw
DOSCODE:A016		     stosw
DOSCODE:A017		     pop     cx
DOSCODE:A018		     pop     si
DOSCODE:A019		     pop     ds
DOSCODE:A01A		     push    ds
DOSCODE:A01B		     push    si
DOSCODE:A01C		     lds     si, [si+0Ah]
DOSCODE:A01F		     mov     bh, [si]
DOSCODE:A021		     rep movsb
DOSCODE:A023		     stosw
DOSCODE:A024		     stosw
DOSCODE:A025		     pop     si
DOSCODE:A026		     pop     ds
DOSCODE:A027		     lds     si, [si+2]
DOSCODE:A02A		     or	     cl, 80h
DOSCODE:A02D		     mov     di, cx
DOSCODE:A02F		     rep movsb
DOSCODE:A031		     dec     cl
DOSCODE:A033		     mov     al, bh
DOSCODE:A035		     xor     bh, bh
DOSCODE:A037		     call    GetVisDrv
DOSCODE:A03A		     jnb     short Exec_BL
DOSCODE:A03C		     mov     bh, cl
DOSCODE:A03E Exec_BL:				     ; ...
DOSCODE:A03E		     mov     al, bl
DOSCODE:A040		     xor     bl, bl
DOSCODE:A042		     call    GetVisDrv
DOSCODE:A045		     jnb     short Exec_Set_Return
DOSCODE:A047		     mov     bl, cl
DOSCODE:A049 Exec_Set_Return:			     ; ...
DOSCODE:A049		     call    Get_User_Stack
DOSCODE:A04C		     push    word ptr [si+14h]
DOSCODE:A04F		     push    word ptr [si+12h]
DOSCODE:A052		     push    word ptr [si+14h]
DOSCODE:A055		     push    word ptr [si+12h]
DOSCODE:A058		     pop     word ptr es:0Ah ; [ES:PDB.EXIT]
DOSCODE:A05D		     pop     word ptr es:0Ch
DOSCODE:A062		     xor     ax, ax
DOSCODE:A064		     mov     ds, ax
DOSCODE:A066		     pop     word ptr ds:88h ; [addr_int_terminate] ; 22h*4
DOSCODE:A06A		     pop     word ptr ds:8Ah
DOSCODE:A06E		     mov     word ptr ss:DMAADD, 80h
DOSCODE:A075		     mov     ds, ss:CurrentPDB
DOSCODE:A07A		     mov     word ptr ss:DMAADD+2, ds
DOSCODE:A07F		     test    byte ptr [bp-5], 1
DOSCODE:A083		     jz	     short exec_go
DOSCODE:A085		     lds     si, dword ptr ss:exec_init_SP
DOSCODE:A08A		     les     di, [bp-4]
DOSCODE:A08D		     mov     word ptr es:[di+10h], ds
DOSCODE:A091		     dec     si
DOSCODE:A092		     dec     si
DOSCODE:A093		     mov     [si], bx
DOSCODE:A095		     mov     es:[di+0Eh], si
DOSCODE:A099		     lds     ax, dword ptr ss:exec_init_IP
DOSCODE:A09E		     mov     word ptr es:[di+14h], ds
DOSCODE:A0A2		     mov     es:[di+12h], ax
DOSCODE:A0A6		     mov     sp, bp
DOSCODE:A0A8		     pop     bp
DOSCODE:A0A9		     jmp     SYS_RET_OK
DOSCODE:A0AC exec_go:				     ; ...
DOSCODE:A0AC		     lds     si, dword ptr ss:exec_init_IP
DOSCODE:A0B1		     les     di, dword ptr ss:exec_init_SP
DOSCODE:A0B6		     mov     ax, es
DOSCODE:A0B8		     cmp     ss:DosHasHMA, 0
DOSCODE:A0BE		     jz	     short Xfer_To_User
DOSCODE:A0C0		     push    ds
DOSCODE:A0C1		     mov     ds, cs:DosDSeg
DOSCODE:A0C6		     or	     ds:DOS_FLAG, 4  ; EXECA20OFF
DOSCODE:A0CB		     mov     ds:A20OFF_PSP, dx
DOSCODE:A0CF		     mov     ax, ds
DOSCODE:A0D1		     pop     ds
DOSCODE:A0D2		     push    ax
DOSCODE:A0D3		     mov     ax, offset	disa20_xfer
DOSCODE:A0D6		     push    ax
DOSCODE:A0D7		     mov     ax, es
DOSCODE:A0D9		     retf
DOSCODE:A0DA Xfer_To_User:			     ; ...
DOSCODE:A0DA		     cli
DOSCODE:A0DB		     mov     ss:INDOS, 0
DOSCODE:A0E1		     mov     ss, ax
DOSCODE:A0E3		     mov     sp, di
DOSCODE:A0E5		     sti
DOSCODE:A0E6		     push    ds
DOSCODE:A0E7		     push    si
DOSCODE:A0E8		     mov     es, dx
DOSCODE:A0EA		     mov     ds, dx
DOSCODE:A0EC		     mov     ax, bx
DOSCODE:A0EE		     retf
DOSCODE:A0EE $EXEC	     endp ; sp-analysis	failed
DOSCODE:A0EF ; =============== S U B R O U T I N E =======================================
DOSCODE:A0EF ExecRead	     proc near		     ; ...
DOSCODE:A0EF		     call    Exec_Dealloc
DOSCODE:A0F2		     mov     bx, [bp-8]
DOSCODE:A0F5		     push    bp
DOSCODE:A0F6		     call    $READ
DOSCODE:A0F9		     pop     bp
DOSCODE:A0FA		     call    Exec_Alloc
DOSCODE:A0FD		     retn
DOSCODE:A0FD ExecRead	     endp
DOSCODE:A0FE ; =============== S U B R O U T I N E =======================================
DOSCODE:A0FE Exec_Dealloc    proc near		     ; ...
DOSCODE:A0FE		     push    bx
DOSCODE:A0FF		     sub     bx, bx
DOSCODE:A101		     call    ECritDisk
DOSCODE:A104		     call    ChangeOwners
DOSCODE:A107		     pop     bx
DOSCODE:A108		     retn
DOSCODE:A108 Exec_Dealloc    endp
DOSCODE:A109 ; =============== S U B R O U T I N E =======================================
DOSCODE:A109 Exec_Alloc	     proc near		     ; ...
DOSCODE:A109		     push    bx
DOSCODE:A10A		     mov     bx, ss:CurrentPDB
DOSCODE:A10F		     call    ChangeOwners
DOSCODE:A112		     call    LCritDisk
DOSCODE:A115		     pop     bx
DOSCODE:A116		     retn
DOSCODE:A116 Exec_Alloc	     endp
DOSCODE:A117 ; =============== S U B R O U T I N E =======================================
DOSCODE:A117 ChangeOwners    proc near		     ; ...
DOSCODE:A117		     pushf
DOSCODE:A118		     push    ax
DOSCODE:A119		     mov     ax, [bp-14]
DOSCODE:A11C		     call    ChangeOwner
DOSCODE:A11F		     mov     ax, [bp-18]
DOSCODE:A122		     call    ChangeOwner
DOSCODE:A125		     pop     ax
DOSCODE:A126		     popf
DOSCODE:A127 chgown_retn:			     ; ...
DOSCODE:A127		     retn
DOSCODE:A127 ChangeOwners    endp
DOSCODE:A128 ; =============== S U B R O U T I N E =======================================
DOSCODE:A128 ChangeOwner     proc near		     ; ...
DOSCODE:A128		     or	     ax, ax
DOSCODE:A12A		     jz	     short chgown_retn
DOSCODE:A12C		     dec     ax
DOSCODE:A12D		     push    ds
DOSCODE:A12E		     mov     ds, ax
DOSCODE:A130		     mov     ds:1, bx	     ; [ARENA.OWNER]
DOSCODE:A134		     pop     ds
DOSCODE:A135		     retn
DOSCODE:A135 ChangeOwner     endp
DOSCODE:A136 ; =============== S U B R O U T I N E =======================================
DOSCODE:A136 Scan_Execname   proc near		     ; ...
DOSCODE:A136		     lds     si, [bp-26]
DOSCODE:A139 Scan_Execname1:			     ; ...
DOSCODE:A139		     mov     cx, si
DOSCODE:A13B Scan0:				     ; ...
DOSCODE:A13B		     lodsb
DOSCODE:A13C		     cmp     al, ':'
DOSCODE:A13E		     jz	     short Scan_Execname1
DOSCODE:A140		     cmp     al, '\'
DOSCODE:A142		     jz	     short Scan_Execname1
DOSCODE:A144		     cmp     al, 0
DOSCODE:A146		     jnz     short Scan0
DOSCODE:A148		     sub     si, cx
DOSCODE:A14A		     xchg    si, cx
DOSCODE:A14C		     retn
DOSCODE:A14C Scan_Execname   endp
DOSCODE:A14D ; =============== S U B R O U T I N E =======================================
DOSCODE:A14D Scan_Special_Entries proc near	     ; ...
DOSCODE:A14D		     dec     cx
DOSCODE:A14E		     mov     ss:SPECIAL_VERSION, 1606h
DOSCODE:A155		     les     di, ss:UU_IFS_DOS_CALL
DOSCODE:A15A		     mov     ax, es
DOSCODE:A15C		     or	     ax, di
DOSCODE:A15E		     jz	     short End_List
DOSCODE:A160 GetEntries:			     ; ...
DOSCODE:A160		     mov     al, es:[di]
DOSCODE:A163		     or	     al, al
DOSCODE:A165		     jz	     short End_List
DOSCODE:A167		     mov     ss:TEMP_VAR2, di
DOSCODE:A16C		     cmp     al, cl
DOSCODE:A16E		     jnz     short SkipOne
DOSCODE:A170		     inc     di
DOSCODE:A171		     push    cx
DOSCODE:A172		     push    si
DOSCODE:A173		     push    ax
DOSCODE:A174 sse_next_char:			     ; ...
DOSCODE:A174		     lodsb
DOSCODE:A175		     call    UCase
DOSCODE:A178		     scasb
DOSCODE:A179		     jnz     short Not_Matched
DOSCODE:A17B		     loop    sse_next_char
DOSCODE:A17D		     pop     ax
DOSCODE:A17E		     mov     ax, es:[di]
DOSCODE:A181		     mov     ss:SPECIAL_VERSION, ax
DOSCODE:A185		     pop     si
DOSCODE:A186		     pop     cx
DOSCODE:A187		     jmp     short End_List
DOSCODE:A189 Not_Matched:			     ; ...
DOSCODE:A189		     pop     ax
DOSCODE:A18A		     pop     si
DOSCODE:A18B		     pop     cx
DOSCODE:A18C SkipOne:				     ; ...
DOSCODE:A18C		     mov     di, ss:TEMP_VAR2
DOSCODE:A191		     xor     ah, ah
DOSCODE:A193		     add     di, ax
DOSCODE:A195		     add     di, 3
DOSCODE:A198		     jmp     short GetEntries
DOSCODE:A19A End_List:				     ; ...
DOSCODE:A19A		     retn
DOSCODE:A19A Scan_Special_Entries endp
DOSCODE:A19B $KEEP_PROCESS:			     ; ...
DOSCODE:A19B		     push    ax
DOSCODE:A19C		     mov     ss:EXIT_TYPE, 3
DOSCODE:A1A2		     mov     es, ss:CurrentPDB
DOSCODE:A1A7		     cmp     dx, 6
DOSCODE:A1AA		     jnb     short Keep_Shrink
DOSCODE:A1AC		     mov     dx, 6
DOSCODE:A1AF Keep_Shrink:			     ; ...
DOSCODE:A1AF		     mov     bx, dx
DOSCODE:A1B1		     push    bx
DOSCODE:A1B2		     push    es
DOSCODE:A1B3		     call    $SETBLOCK
DOSCODE:A1B6		     pop     ds
DOSCODE:A1B7		     pop     bx
DOSCODE:A1B8		     jb	     short Keep_Done
DOSCODE:A1BA		     mov     ax, ds
DOSCODE:A1BC		     add     ax, bx
DOSCODE:A1BE		     mov     ds:2, ax	     ; [PDB.BLOCK_LEN]
DOSCODE:A1C1 Keep_Done:				     ; ...
DOSCODE:A1C1		     pop     ax
DOSCODE:A1C2		     jmp     short exit_inner
DOSCODE:A1C4 stay_resident:			     ; ...
DOSCODE:A1C4		     mov     ax, 3100h
DOSCODE:A1C7		     add     dx, 15
DOSCODE:A1CA		     rcr     dx, 1
DOSCODE:A1CC		     mov     cl, 3
DOSCODE:A1CE		     shr     dx, cl
DOSCODE:A1D0		     jmp     command
DOSCODE:A1D3 $EXIT:				     ; ...
DOSCODE:A1D3		     xor     ah, ah
DOSCODE:A1D5		     xchg    ah, ss:DidCTRLC
DOSCODE:A1DA		     or	     ah, ah
DOSCODE:A1DC		     mov     ss:EXIT_TYPE, 0 ; EXIT_TERMINATE
DOSCODE:A1E2		     jz	     short exit_inner
DOSCODE:A1E4		     mov     ss:EXIT_TYPE, 1 ; EXIT_CTRL_C
DOSCODE:A1EA ; START OF	FUNCTION CHUNK FOR FATALC
DOSCODE:A1EA exit_inner:			     ; ...
DOSCODE:A1EA		     call    Get_User_Stack
DOSCODE:A1ED		     push    ss:CurrentPDB
DOSCODE:A1F2		     pop     word ptr [si+14h]
DOSCODE:A1F5		     jmp     short abort_inner
DOSCODE:A1F5 ; END OF FUNCTION CHUNK FOR FATALC
DOSCODE:A1F7 $ABORT:				     ; ...
DOSCODE:A1F7		     xor     al, al
DOSCODE:A1F9		     mov     ss:EXIT_TYPE, 0 ; EXIT_ABORT
DOSCODE:A1FF ; START OF	FUNCTION CHUNK FOR FATALC
DOSCODE:A1FF abort_inner:			     ; ...
DOSCODE:A1FF		     mov     ah, ss:EXIT_TYPE
DOSCODE:A204		     mov     ss:exit_code, ax
DOSCODE:A208		     call    Get_User_Stack
DOSCODE:A20B		     mov     ds, word ptr [si+14h]
DOSCODE:A20E		     xor     ax, ax
DOSCODE:A210		     mov     es, ax
DOSCODE:A212		     mov     si, 10
DOSCODE:A215		     mov     di, 88h
DOSCODE:A218		     movsw
DOSCODE:A219		     movsw
DOSCODE:A21A		     movsw
DOSCODE:A21B		     movsw
DOSCODE:A21C		     movsw
DOSCODE:A21D		     movsw
DOSCODE:A21E		     jmp     reset_environment
DOSCODE:A21E ; END OF FUNCTION CHUNK FOR FATALC
DOSCODE:A221 RetExePatch:			     ; ...
DOSCODE:A221		     retn
DOSCODE:A222 ; =============== S U B R O U T I N E =======================================
DOSCODE:A222 arena_free_process	proc near	     ; ...
DOSCODE:A222		     mov     ax, ss:arena_head
DOSCODE:A226 arena_free_process_start:		     ; ...
DOSCODE:A226		     mov     di, 0
DOSCODE:A229		     call    check_signature
DOSCODE:A22C arena_free_process_loop:		     ; ...
DOSCODE:A22C		     jb	     short check_signature_ok
DOSCODE:A22E		     push    es
DOSCODE:A22F		     pop     ds
DOSCODE:A230		     cmp     ds:1, bx	     ; [ARENA.OWNER]
DOSCODE:A234		     jnz     short arena_free_next
DOSCODE:A236		     mov     ds:1, di
DOSCODE:A23A arena_free_next:			     ; ...
DOSCODE:A23A		     cmp     byte ptr [di], 5Ah	; 'Z'
DOSCODE:A23D		     jz	     short arena_chk_umbs
DOSCODE:A23F		     call    arena_next
DOSCODE:A242		     jmp     short arena_free_process_loop
DOSCODE:A244 arena_chk_umbs:			     ; ...
DOSCODE:A244		     mov     ax, ss:UMB_HEAD
DOSCODE:A248		     cmp     ax, 0FFFFh
DOSCODE:A24B		     jz	     short check_signature_ok
DOSCODE:A24D		     mov     di, ds
DOSCODE:A24F		     cmp     di, ax
DOSCODE:A251		     jnb     short check_signature_ok
DOSCODE:A253		     jmp     short arena_free_process_start
DOSCODE:A253 arena_free_process	endp
DOSCODE:A255 ; =============== S U B R O U T I N E =======================================
DOSCODE:A255 arena_next	     proc near		     ; ...
DOSCODE:A255		     mov     ax, ds
DOSCODE:A257		     add     ax, ds:3	     ; [ARENA.SIZE]
DOSCODE:A25B		     inc     ax
DOSCODE:A25B arena_next	     endp ; sp-analysis	failed
DOSCODE:A25C ; =============== S U B R O U T I N E =======================================
DOSCODE:A25C check_signature proc near		     ; ...
DOSCODE:A25C		     mov     es, ax
DOSCODE:A25E		     cmp     byte ptr es:[di], 4Dh ; 'M'
DOSCODE:A262		     jz	     short check_signature_ok
DOSCODE:A264		     cmp     byte ptr es:[di], 5Ah ; 'Z'
DOSCODE:A268		     jz	     short check_signature_ok
DOSCODE:A26A		     stc
DOSCODE:A26B check_signature_ok:		     ; ...
DOSCODE:A26B		     retn
DOSCODE:A26B check_signature endp
DOSCODE:A26C ; =============== S U B R O U T I N E =======================================
DOSCODE:A26C Coalesce	     proc near		     ; ...
DOSCODE:A26C		     cmp     byte ptr [di], 5Ah	; 'Z'
DOSCODE:A26F		     jz	     short check_signature_ok
DOSCODE:A271		     call    arena_next
DOSCODE:A274		     jb	     short check_signature_ok
DOSCODE:A276		     cmp     es:1, di
DOSCODE:A27B		     jnz     short check_signature_ok
DOSCODE:A27D		     mov     cx, es:3
DOSCODE:A282		     inc     cx
DOSCODE:A283		     add     ds:3, cx
DOSCODE:A287		     mov     cl, es:[di]
DOSCODE:A28A		     mov     [di], cl
DOSCODE:A28C		     jmp     short Coalesce
DOSCODE:A28C Coalesce	     endp
DOSCODE:A28E ; =============== S U B R O U T I N E =======================================
DOSCODE:A28E $ALLOC	     proc near		     ; ...
DOSCODE:A28E		     call    ECritDisk	     ; ECritMEM
DOSCODE:A291		     mov     ax, ss:arena_head
DOSCODE:A295		     mov     ss:START_ARENA, ax
DOSCODE:A299		     test    ss:AllocMethod, 0C0h ; HIGH_FIRST+HIGH_ONLY
DOSCODE:A29F		     jz	     short norm_alloc
DOSCODE:A2A1		     test    ss:UMBFLAG, 1
DOSCODE:A2A7		     jz	     short norm_alloc
DOSCODE:A2A9		     mov     ax, ss:UMB_HEAD
DOSCODE:A2AD		     mov     ss:START_ARENA, ax
DOSCODE:A2B1 norm_alloc:			     ; ...
DOSCODE:A2B1		     xor     ax, ax
DOSCODE:A2B3		     mov     di, ax
DOSCODE:A2B5		     mov     ss:FirstArena, ax
DOSCODE:A2B9		     mov     ss:BestArena, ax
DOSCODE:A2BD		     mov     ss:LastArena, ax
DOSCODE:A2C1		     push    ax
DOSCODE:A2C2 start_scan:			     ; ...
DOSCODE:A2C2		     mov     ax, ss:START_ARENA
DOSCODE:A2C6		     call    check_signature
DOSCODE:A2C9		     jb	     short alloc_err
DOSCODE:A2CB alloc_scan:			     ; ...
DOSCODE:A2CB		     push    es
DOSCODE:A2CC		     pop     ds
DOSCODE:A2CD		     cmp     ds:1, di
DOSCODE:A2D1		     jz	     short alloc_free
DOSCODE:A2D3 alloc_next:			     ; ...
DOSCODE:A2D3		     test    ss:UMBFLAG, 1
DOSCODE:A2D9		     jz	     short norm_strat
DOSCODE:A2DB		     test    ss:AllocMethod, 80h
DOSCODE:A2E1		     jz	     short norm_strat
DOSCODE:A2E3		     mov     ax, ss:START_ARENA
DOSCODE:A2E7		     cmp     ax, ss:arena_head
DOSCODE:A2EC		     jnz     short norm_strat
DOSCODE:A2EE		     mov     ax, ds
DOSCODE:A2F0		     cmp     ax, ss:UMB_HEAD
DOSCODE:A2F5		     jmp     short alloc_chk_end
DOSCODE:A2F7 norm_strat:			     ; ...
DOSCODE:A2F7		     cmp     byte ptr [di], 5Ah	; 'Z'
DOSCODE:A2FA alloc_chk_end:			     ; ...
DOSCODE:A2FA		     jz	     short alloc_end
DOSCODE:A2FC		     call    arena_next
DOSCODE:A2FF		     jnb     short alloc_scan
DOSCODE:A301 alloc_err:				     ; ...
DOSCODE:A301		     pop     ax
DOSCODE:A302 alloc_trashed:			     ; ...
DOSCODE:A302		     call    LCritDisk	     ; LCritMEM
DOSCODE:A305		     mov     al, 7
DOSCODE:A307 alloc_errj:			     ; ...
DOSCODE:A307		     jmp     SYS_RET_ERR
DOSCODE:A30A alloc_end:				     ; ...
DOSCODE:A30A		     cmp     ss:FirstArena, 0
DOSCODE:A310		     jz	     short alloc_chk
DOSCODE:A312		     jmp     alloc_do_split
DOSCODE:A315 alloc_chk:				     ; ...
DOSCODE:A315		     mov     ax, ss:arena_head
DOSCODE:A319		     cmp     ax, ss:START_ARENA
DOSCODE:A31E		     jz	     short alloc_fail
DOSCODE:A320		     test    ss:AllocMethod, 40h
DOSCODE:A326		     jnz     short alloc_fail
DOSCODE:A328		     mov     ss:START_ARENA, ax
DOSCODE:A32C		     jmp     short start_scan
DOSCODE:A32E alloc_fail:			     ; ...
DOSCODE:A32E		     call    Get_User_Stack
DOSCODE:A331		     pop     bx
DOSCODE:A332		     mov     [si+2], bx
DOSCODE:A335		     call    LCritDisk	     ; LCritMEM
DOSCODE:A338		     mov     al, 8
DOSCODE:A33A		     jmp     short alloc_errj
DOSCODE:A33C alloc_free:			     ; ...
DOSCODE:A33C		     call    Coalesce
DOSCODE:A33F		     jb	     short alloc_err
DOSCODE:A341		     mov     cx, ds:3
DOSCODE:A345		     pop     dx
DOSCODE:A346		     cmp     cx, dx
DOSCODE:A348		     jbe     short alloc_test
DOSCODE:A34A		     mov     dx, cx
DOSCODE:A34C alloc_test:			     ; ...
DOSCODE:A34C		     push    dx
DOSCODE:A34D		     cmp     bx, cx
DOSCODE:A34F		     ja	     short alloc_next
DOSCODE:A351		     cmp     ss:FirstArena, 0
DOSCODE:A357		     jnz     short alloc_best
DOSCODE:A359		     mov     ss:FirstArena, ds
DOSCODE:A35E alloc_best:			     ; ...
DOSCODE:A35E		     cmp     ss:BestArena, 0
DOSCODE:A364		     jz	     short alloc_make_best
DOSCODE:A366		     push    es
DOSCODE:A367		     mov     es, ss:BestArena
DOSCODE:A36C		     cmp     es:3, cx
DOSCODE:A371		     pop     es
DOSCODE:A372		     jbe     short alloc_last
DOSCODE:A374 alloc_make_best:			     ; ...
DOSCODE:A374		     mov     ss:BestArena, ds
DOSCODE:A379 alloc_last:			     ; ...
DOSCODE:A379		     mov     ss:LastArena, ds
DOSCODE:A37E		     jmp     alloc_next
DOSCODE:A381 alloc_do_split_high:		     ; ...
DOSCODE:A381		     mov     ds, ss:LastArena
DOSCODE:A386		     mov     cx, ds:3
DOSCODE:A38A		     sub     cx, bx
DOSCODE:A38C		     mov     dx, ds
DOSCODE:A38E		     jz	     short alloc_set_owner
DOSCODE:A390		     add     dx, cx
DOSCODE:A392		     mov     es, dx
DOSCODE:A394		     dec     cx
DOSCODE:A395		     xchg    bx, cx
DOSCODE:A397		     jmp     short alloc_set_sizes
DOSCODE:A399 alloc_do_split:			     ; ...
DOSCODE:A399		     xor     cx, cx
DOSCODE:A39B		     mov     cl, ss:AllocMethod
DOSCODE:A3A0		     and     cx, 0FF3Fh
DOSCODE:A3A4		     cmp     cx, 1
DOSCODE:A3A7		     ja	     short alloc_do_split_high
DOSCODE:A3A9		     mov     ds, ss:FirstArena
DOSCODE:A3AE		     jb	     short alloc_get_size
DOSCODE:A3B0		     mov     ds, ss:BestArena
DOSCODE:A3B5 alloc_get_size:			     ; ...
DOSCODE:A3B5		     mov     cx, ds:3
DOSCODE:A3B9		     sub     cx, bx
DOSCODE:A3BB		     mov     ax, ds
DOSCODE:A3BD		     mov     dx, ax
DOSCODE:A3BF		     jz	     short alloc_set_owner
DOSCODE:A3C1		     add     ax, bx
DOSCODE:A3C3		     inc     ax
DOSCODE:A3C4		     mov     es, ax
DOSCODE:A3C6		     dec     cx
DOSCODE:A3C7 alloc_set_sizes:			     ; ...
DOSCODE:A3C7		     mov     ds:3, bx
DOSCODE:A3CB		     mov     es:3, cx
DOSCODE:A3D0		     mov     bl, 4Dh ; 'M'
DOSCODE:A3D2		     xchg    bl, [di]
DOSCODE:A3D4		     mov     es:[di], bl
DOSCODE:A3D7		     mov     es:1, di
DOSCODE:A3DC alloc_set_owner:			     ; ...
DOSCODE:A3DC		     mov     ds, dx
DOSCODE:A3DE		     mov     ax, ss:CurrentPDB
DOSCODE:A3E2		     mov     ds:1, ax
DOSCODE:A3E5		     mov     ax, ds
DOSCODE:A3E7		     inc     ax
DOSCODE:A3E8		     pop     bx
DOSCODE:A3E9		     call    LCritDisk	     ; LCritMEM
DOSCODE:A3EC alloc_ok:				     ; ...
DOSCODE:A3EC		     jmp     SYS_RET_OK
DOSCODE:A3EC $ALLOC	     endp
DOSCODE:A3EF ; =============== S U B R O U T I N E =======================================
DOSCODE:A3EF $SETBLOCK	     proc near		     ; ...
DOSCODE:A3EF		     call    ECritDisk	     ; ECritMEM
DOSCODE:A3F2		     mov     di, 0
DOSCODE:A3F5		     mov     ax, es
DOSCODE:A3F7		     dec     ax
DOSCODE:A3F8		     call    check_signature
DOSCODE:A3FB		     jnb     short setblock_grab
DOSCODE:A3FD setblock_bad:			     ; ...
DOSCODE:A3FD		     jmp     alloc_trashed
DOSCODE:A400 setblock_grab:			     ; ...
DOSCODE:A400		     mov     ds, ax
DOSCODE:A402		     call    Coalesce
DOSCODE:A405		     jb	     short setblock_bad
DOSCODE:A407		     mov     cx, ds:3
DOSCODE:A40B		     push    cx
DOSCODE:A40C		     cmp     bx, cx
DOSCODE:A40E		     jbe     short alloc_get_size
DOSCODE:A410		     jmp     alloc_fail
DOSCODE:A410 $SETBLOCK	     endp
DOSCODE:A413 ; =============== S U B R O U T I N E =======================================
DOSCODE:A413 $DEALLOC	     proc near		     ; ...
DOSCODE:A413		     call    ECritDisk	     ; ECritMEM
DOSCODE:A416		     test    ss:DOS_FLAG, 4  ; EXECA20OFF
DOSCODE:A41C		     jz	     short deallocate
DOSCODE:A41E		     cmp     ss:A20OFF_COUNT, 0
DOSCODE:A424		     jnz     short deallocate
DOSCODE:A426		     mov     ss:A20OFF_COUNT, 1
DOSCODE:A42C deallocate:			     ; ...
DOSCODE:A42C		     mov     di, 0
DOSCODE:A42F		     mov     ax, es
DOSCODE:A431		     dec     ax
DOSCODE:A432		     call    check_signature
DOSCODE:A435		     jb	     short dealloc_err
DOSCODE:A437		     mov     es:1, di
DOSCODE:A43C		     call    LCritDisk	     ; LCritMEM
DOSCODE:A43F dealloc_ok:			     ; ...
DOSCODE:A43F		     jmp     short alloc_ok
DOSCODE:A441 dealloc_err:			     ; ...
DOSCODE:A441		     call    LCritDisk	     ; LCritMEM
DOSCODE:A444		     mov     al, 9
DOSCODE:A446 dealloc_errj:			     ; ...
DOSCODE:A446		     jmp     SYS_RET_ERR
DOSCODE:A446 $DEALLOC	     endp
DOSCODE:A449 $ALLOCOPER:			     ; ...
DOSCODE:A449		     or	     al, al
DOSCODE:A44B		     jz	     short AllocGetStrat
DOSCODE:A44D		     cmp     al, 1
DOSCODE:A44F		     jz	     short AllocSetStrat
DOSCODE:A451		     cmp     al, 2
DOSCODE:A453		     jz	     short AllocGetLink
DOSCODE:A455		     cmp     al, 3
DOSCODE:A457		     jz	     short AllocSetLink
DOSCODE:A459 AllocOperError:			     ; ...
DOSCODE:A459		     mov     ss:EXTERR_LOCUS, 5
DOSCODE:A45F		     mov     al, 1
DOSCODE:A461 AllocOperErrj:			     ; ...
DOSCODE:A461		     jmp     short dealloc_errj
DOSCODE:A463 AllocArenaError:			     ; ...
DOSCODE:A463		     mov     ss:EXTERR_LOCUS, 5
DOSCODE:A469		     mov     al, 7
DOSCODE:A46B		     jmp     short AllocOperErrj
DOSCODE:A46D AllocGetStrat:			     ; ...
DOSCODE:A46D		     mov     al, ss:AllocMethod
DOSCODE:A471		     xor     ah, ah
DOSCODE:A473 AllocOperOK:			     ; ...
DOSCODE:A473		     jmp     short dealloc_ok
DOSCODE:A475 AllocSetStrat:			     ; ...
DOSCODE:A475		     push    bx
DOSCODE:A476		     and     bx, 0FF3Fh
DOSCODE:A47A		     cmp     bx, 2
DOSCODE:A47D		     pop     bx
DOSCODE:A47E		     ja	     short AllocOperError
DOSCODE:A480 AllocOperSet:
DOSCODE:A480		     mov     ss:AllocMethod, bl
DOSCODE:A485 AllocOperSetOK:			     ; ...
DOSCODE:A485		     jmp     short AllocOperOK
DOSCODE:A487 AllocGetLink:			     ; ...
DOSCODE:A487		     mov     al, ss:UMBFLAG
DOSCODE:A48B		     and     al, 1
DOSCODE:A48D AllocGetLinkOK:			     ; ...
DOSCODE:A48D		     jmp     short AllocOperSetOK
DOSCODE:A48F AllocSetLink:			     ; ...
DOSCODE:A48F		     mov     cx, ss:UMB_HEAD
DOSCODE:A494		     cmp     cx, 0FFFFh
DOSCODE:A497		     jz	     short AllocOperError
DOSCODE:A499		     cmp     bx, 1
DOSCODE:A49C		     jb	     short UnlinkUmbs
DOSCODE:A49E		     jz	     short LinkUmbs
DOSCODE:A4A0		     jmp     short AllocOperError
DOSCODE:A4A2 UnlinkUmbs:			     ; ...
DOSCODE:A4A2		     test    ss:UMBFLAG, 1
DOSCODE:A4A8		     jz	     short unlinked
DOSCODE:A4AA		     call    GetLastArena
DOSCODE:A4AD		     jb	     short AllocArenaError
DOSCODE:A4AF		     mov     byte ptr ds:0, 5Ah	; 'Z'
DOSCODE:A4B4		     and     ss:UMBFLAG, 0FEh
DOSCODE:A4BA unlinked:				     ; ...
DOSCODE:A4BA		     jmp     short AllocGetLinkOK
DOSCODE:A4BC LinkUmbs:				     ; ...
DOSCODE:A4BC		     test    ss:UMBFLAG, 1
DOSCODE:A4C2		     jnz     short linked
DOSCODE:A4C4		     call    GetLastArena
DOSCODE:A4C7		     jb	     short AllocArenaError
DOSCODE:A4C9		     mov     byte ptr ds:0, 4Dh	; 'M'
DOSCODE:A4CE		     or	     ss:UMBFLAG, 1
DOSCODE:A4D4 linked:				     ; ...
DOSCODE:A4D4		     jmp     short unlinked
DOSCODE:A4D6 ; =============== S U B R O U T I N E =======================================
DOSCODE:A4D6 GetLastArena    proc near		     ; ...
DOSCODE:A4D6		     push    ax
DOSCODE:A4D7		     mov     ax, ss:arena_head
DOSCODE:A4DB		     mov     es, ax
DOSCODE:A4DD		     xor     di, di
DOSCODE:A4DF		     cmp     byte ptr es:[di], 5Ah ; 'Z'
DOSCODE:A4E3		     jz	     short GLA_done
DOSCODE:A4E5 GLA_next:				     ; ...
DOSCODE:A4E5		     mov     ds, ax
DOSCODE:A4E7		     call    arena_next
DOSCODE:A4EA		     jb	     short GLA_err
DOSCODE:A4EC		     test    ss:UMBFLAG, 1
DOSCODE:A4F2		     jnz     short GLA_chkumb
DOSCODE:A4F4		     cmp     byte ptr es:[di], 5Ah ; 'Z'
DOSCODE:A4F8		     jmp     short GLA_@f
DOSCODE:A4FA GLA_chkumb:			     ; ...
DOSCODE:A4FA		     cmp     ax, cx
DOSCODE:A4FC GLA_@f:				     ; ...
DOSCODE:A4FC		     jnz     short GLA_next
DOSCODE:A4FE GLA_done:				     ; ...
DOSCODE:A4FE		     test    ss:UMBFLAG, 1
DOSCODE:A504		     jnz     short GLA_ret
DOSCODE:A506		     mov     ds, ax
DOSCODE:A508		     call    arena_next
DOSCODE:A50B		     jb	     short GLA_err
DOSCODE:A50D		     cmp     ax, cx
DOSCODE:A50F		     jnz     short GLA_err
DOSCODE:A511 GLA_ret:				     ; ...
DOSCODE:A511		     clc
DOSCODE:A512		     pop     ax
DOSCODE:A513		     retn
DOSCODE:A514 GLA_err:				     ; ...
DOSCODE:A514		     stc
DOSCODE:A515		     pop     ax
DOSCODE:A516		     retn
DOSCODE:A516 GetLastArena    endp
DOSCODE:A517 SERVERTAB	     dw	offset SERVER_DISP   ; ...
DOSCODE:A519 SERVERLEAVE     dw	offset SERVERRETURN  ; ...
DOSCODE:A51B SERVER_DISP     db	11		     ; ...
DOSCODE:A51C		     dw	offset SRV_CALL
DOSCODE:A51E		     dw	offset COMMIT_ALL
DOSCODE:A520		     dw	offset CLOSE_NAME
DOSCODE:A522		     dw	offset CLOSE_UID
DOSCODE:A524		     dw	offset CLOSE_UID_PID
DOSCODE:A526		     dw	offset GET_LIST
DOSCODE:A528		     dw	offset GET_DOS_DATA
DOSCODE:A52A		     dw	offset SPOOL_OPER
DOSCODE:A52C		     dw	offset SPOOL_OPER
DOSCODE:A52E		     dw	offset SPOOL_OPER
DOSCODE:A530		     dw	offset _$SetExtendedError
DOSCODE:A532 $ServerCall:			     ; ...
DOSCODE:A532		     cmp     al, 7
DOSCODE:A534		     jb	     short SET_STUFF
DOSCODE:A536		     cmp     al, 9
DOSCODE:A538		     jbe     short NO_SET_ID
DOSCODE:A53A SET_STUFF:				     ; ...
DOSCODE:A53A		     mov     si, dx
DOSCODE:A53C		     mov     bx, [si+12h]
DOSCODE:A53F		     test    ss:IsWin386, 1
DOSCODE:A545		     jnz     short skip_win386
DOSCODE:A547		     mov     ss:USER_ID, bx
DOSCODE:A54C skip_win386:			     ; ...
DOSCODE:A54C		     mov     bx, [si+14h]
DOSCODE:A54F		     mov     ss:PROC_ID, bx
DOSCODE:A554 NO_SET_ID:				     ; ...
DOSCODE:A554		     push    cs:SERVERLEAVE
DOSCODE:A559		     push    cs:SERVERTAB
DOSCODE:A55E		     push    ax
DOSCODE:A55F		     call    TableDispatch
DOSCODE:A562		     mov     ss:EXTERR_LOCUS, 1
DOSCODE:A568		     mov     al, 1
DOSCODE:A56A servercall_error:			     ; ...
DOSCODE:A56A		     jmp     SYS_RET_ERR
DOSCODE:A56D SERVERRETURN:			     ; ...
DOSCODE:A56D		     retn
DOSCODE:A56E COMMIT_ALL:			     ; ...
DOSCODE:A56E		     xor     bx, bx
DOSCODE:A570		     push    ss
DOSCODE:A571		     pop     ds
DOSCODE:A572		     call    ECritDisk
DOSCODE:A575 CommitLoop:			     ; ...
DOSCODE:A575		     push    bx
DOSCODE:A576		     call    SFFromSFN
DOSCODE:A579		     jb	     short CommitDone
DOSCODE:A57B		     cmp     word ptr es:[di], 0
DOSCODE:A57F		     jz	     short CommitNext
DOSCODE:A581		     cmp     word ptr es:[di], 0FFFFh
DOSCODE:A585		     jz	     short CommitNext
DOSCODE:A587		     test    word ptr es:[di+5], 8000h
DOSCODE:A58D		     jnz     short CommitNext
DOSCODE:A58F		     mov     word ptr ds:THISSFT, di
DOSCODE:A593		     mov     word ptr ds:THISSFT+2, es
DOSCODE:A597		     call    DOS_COMMIT
DOSCODE:A59A CommitNext:			     ; ...
DOSCODE:A59A		     pop     bx
DOSCODE:A59B		     inc     bx
DOSCODE:A59C		     jmp     short CommitLoop
DOSCODE:A59E CommitDone:			     ; ...
DOSCODE:A59E		     call    LCritDisk	     ; LCritSFT
DOSCODE:A5A1		     pop     bx
DOSCODE:A5A2 jmp_to_SYS_RET_OK:			     ; ...
DOSCODE:A5A2		     jmp     SYS_RET_OK
DOSCODE:A5A5 CLOSE_NAME:			     ; ...
DOSCODE:A5A5		     call    ss:MFTCloN
DOSCODE:A5AA CheckReturns:			     ; ...
DOSCODE:A5AA		     jb	     short func_err
DOSCODE:A5AC jmp_to_jmp_to_SYS_RET_OK:		     ; ...
DOSCODE:A5AC		     jmp     short jmp_to_SYS_RET_OK
DOSCODE:A5AE func_err:				     ; ...
DOSCODE:A5AE		     jmp     short servercall_error
DOSCODE:A5B0 CLOSE_UID:				     ; ...
DOSCODE:A5B0		     call    ss:MFTclU
DOSCODE:A5B5		     jmp     short CheckReturns
DOSCODE:A5B7 CLOSE_UID_PID:			     ; ...
DOSCODE:A5B7		     call    ss:MFTCloseP
DOSCODE:A5BC		     jmp     short CheckReturns
DOSCODE:A5BE GET_LIST:				     ; ...
DOSCODE:A5BE		     call    ss:MFT_get
DOSCODE:A5C3		     jb	     short func_err
DOSCODE:A5C5		     call    Get_User_Stack
DOSCODE:A5C8		     mov     [si+2], bx
DOSCODE:A5CB		     mov     [si+0Ah], di
DOSCODE:A5CE		     mov     word ptr [si+10h],	es
DOSCODE:A5D1 SetCXOK:				     ; ...
DOSCODE:A5D1		     mov     [si+4], cx
DOSCODE:A5D4 third_jmp_short_SYS_RET_OK:	     ; ...
DOSCODE:A5D4		     jmp     short jmp_to_jmp_to_SYS_RET_OK
DOSCODE:A5D6 SRV_CALL:				     ; ...
DOSCODE:A5D6		     pop     ax
DOSCODE:A5D7		     push    ds
DOSCODE:A5D8		     push    si
DOSCODE:A5D9		     call    Get_User_Stack
DOSCODE:A5DC		     pop     di
DOSCODE:A5DD		     pop     es
DOSCODE:A5DE		     call    XCHGP
DOSCODE:A5E1		     push    si
DOSCODE:A5E2		     mov     cx, 6
DOSCODE:A5E5		     rep movsw
DOSCODE:A5E7		     inc     di
DOSCODE:A5E8		     inc     di
DOSCODE:A5E9		     movsw
DOSCODE:A5EA		     movsw
DOSCODE:A5EB		     pop     si
DOSCODE:A5EC		     mov     ax, [si]
DOSCODE:A5EE		     mov     bx, [si+2]
DOSCODE:A5F1		     mov     cx, [si+4]
DOSCODE:A5F4		     mov     dx, [si+6]
DOSCODE:A5F7		     mov     di, [si+0Ah]
DOSCODE:A5FA		     mov     es, word ptr [si+0Eh]
DOSCODE:A5FD		     push    word ptr [si+8]
DOSCODE:A600		     mov     ds, word ptr [si+0Ch]
DOSCODE:A603		     pop     si
DOSCODE:A604		     mov     ss:SAVEDS,	ds
DOSCODE:A609		     mov     ss:SAVEBX,	bx
DOSCODE:A60E		     mov     ss:FSHARING, 0FFh
DOSCODE:A614		     jmp     REDISP
DOSCODE:A617 GET_DOS_DATA:			     ; ...
DOSCODE:A617		     push    ss
DOSCODE:A618		     pop     es
DOSCODE:A619		     mov     di, offset	ERRORMODE ; SWAP_START
DOSCODE:A61C		     mov     cx, offset	SWAP_END
DOSCODE:A61F		     mov     dx, offset	USER_IN_AX ; SWAP_ALWAYS
DOSCODE:A622		     sub     cx, di
DOSCODE:A624		     sub     dx, di
DOSCODE:A626		     shr     cx, 1
DOSCODE:A628		     adc     cx, 0
DOSCODE:A62B		     shl     cx, 1
DOSCODE:A62D		     call    Get_User_Stack
DOSCODE:A630		     mov     word ptr [si+0Eh],	es
DOSCODE:A633		     mov     [si+8], di
DOSCODE:A636		     mov     [si+6], dx
DOSCODE:A639		     jmp     short SetCXOK
DOSCODE:A63B SPOOL_OPER:			     ; ...
DOSCODE:A63B		     push    ax
DOSCODE:A63C		     mov     ax, 1125h
DOSCODE:A63F		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	REDIRECTED PRINTER MODE
DOSCODE:A63F					     ; STACK: WORD subfunction
DOSCODE:A63F					     ; Return: CF set on error,	AX = error code
DOSCODE:A63F					     ; STACK unchanged
DOSCODE:A641		     pop     bx
DOSCODE:A642		     jb	     short func_err2
DOSCODE:A644		     jmp     short third_jmp_short_SYS_RET_OK
DOSCODE:A646 func_err2:				     ; ...
DOSCODE:A646		     jmp     SYS_RET_ERR
DOSCODE:A649 _$SetExtendedError:		     ; ...
DOSCODE:A649		     mov     ax, [si]
DOSCODE:A64B		     mov     ss:EXTERR,	ax
DOSCODE:A64F		     mov     ax, [si+0Ah]
DOSCODE:A652		     mov     word ptr ss:EXTERRPT, ax
DOSCODE:A656		     mov     ax, [si+0Eh]
DOSCODE:A659		     mov     word ptr ss:EXTERRPT+2, ax
DOSCODE:A65D		     mov     ax, [si+2]
DOSCODE:A660		     mov     ss:EXTERR_ACT_CLASS, ax
DOSCODE:A664		     mov     ax, [si+4]
DOSCODE:A667		     mov     ss:EXTERR_LOCUS, ah
DOSCODE:A66C		     retn
DOSCODE:A66D ; =============== S U B R O U T I N E =======================================
DOSCODE:A66D pJFNFromHandle  proc near		     ; ...
DOSCODE:A66D		     mov     es, cs:DosDSeg
DOSCODE:A672		     mov     es, es:CurrentPDB
DOSCODE:A677		     cmp     bx, es:32h	     ; [ES:PDB.JFN_Length]
DOSCODE:A67C		     jb	     short pjfn10
DOSCODE:A67E		     mov     al, 6
DOSCODE:A680 ReturnCarry:			     ; ...
DOSCODE:A680		     stc
DOSCODE:A681		     retn
DOSCODE:A682 pjfn10:				     ; ...
DOSCODE:A682		     les     di, es:34h	     ; [ES:PDB.JFN_Pointer]
DOSCODE:A687		     add     di, bx
DOSCODE:A689 pJFNFromHandle_error:		     ; ...
DOSCODE:A689		     retn
DOSCODE:A689 pJFNFromHandle  endp
DOSCODE:A68A ; =============== S U B R O U T I N E =======================================
DOSCODE:A68A SFFromHandle    proc near		     ; ...
DOSCODE:A68A		     call    pJFNFromHandle
DOSCODE:A68D		     jb	     short pJFNFromHandle_error
DOSCODE:A68F		     cmp     byte ptr es:[di], 0FFh
DOSCODE:A693		     jnz     short GetSF
DOSCODE:A695		     mov     al, 6
DOSCODE:A697		     jmp     short ReturnCarry
DOSCODE:A699 GetSF:				     ; ...
DOSCODE:A699		     push    bx
DOSCODE:A69A		     mov     bl, es:[di]
DOSCODE:A69D		     xor     bh, bh
DOSCODE:A69F		     call    SFFromSFN
DOSCODE:A6A2		     pop     bx
DOSCODE:A6A3		     retn
DOSCODE:A6A3 SFFromHandle    endp
DOSCODE:A6A4 ; =============== S U B R O U T I N E =======================================
DOSCODE:A6A4 SFFromSFN	     proc near		     ; ...
DOSCODE:A6A4		     mov     es, cs:DosDSeg
DOSCODE:A6A9		     les     di, es:SFT_ADDR
DOSCODE:A6AE sfsfn5:				     ; ...
DOSCODE:A6AE		     cmp     bx, es:[di+4]
DOSCODE:A6B2		     jb	     short sfsfn7
DOSCODE:A6B4		     sub     bx, es:[di+4]
DOSCODE:A6B8		     les     di, es:[di]
DOSCODE:A6BB		     cmp     di, 0FFFFh
DOSCODE:A6BE		     jnz     short sfsfn5
DOSCODE:A6C0		     stc
DOSCODE:A6C1		     retn
DOSCODE:A6C2 sfsfn7:				     ; ...
DOSCODE:A6C2		     push    ax
DOSCODE:A6C3		     mov     ax, 59	     ; SF_ENTRY.size
DOSCODE:A6C6		     mul     bl
DOSCODE:A6C8		     add     di, ax
DOSCODE:A6CA		     pop     ax
DOSCODE:A6CB		     add     di, 6
DOSCODE:A6CE		     retn		     ; SFT.SFTable
DOSCODE:A6CE SFFromSFN	     endp
DOSCODE:A6CF ; =============== S U B R O U T I N E =======================================
DOSCODE:A6CF JFNFree	     proc near		     ; ...
DOSCODE:A6CF		     xor     bx, bx
DOSCODE:A6D1 jfnf1:				     ; ...
DOSCODE:A6D1		     call    pJFNFromHandle
DOSCODE:A6D4		     jb	     short jfnf5
DOSCODE:A6D6		     cmp     byte ptr es:[di], 0FFh
DOSCODE:A6DA		     jz	     short jfnfx
DOSCODE:A6DC		     inc     bx
DOSCODE:A6DD		     jmp     short jfnf1
DOSCODE:A6DF jfnf5:				     ; ...
DOSCODE:A6DF		     mov     al, 4
DOSCODE:A6E1 jfnfx:				     ; ...
DOSCODE:A6E1		     retn
DOSCODE:A6E1 JFNFree	     endp
DOSCODE:A6E2 ; =============== S U B R O U T I N E =======================================
DOSCODE:A6E2 SFNFree	     proc near		     ; ...
DOSCODE:A6E2		     push    ax
DOSCODE:A6E3		     xor     bx, bx
DOSCODE:A6E5 sfnf5:				     ; ...
DOSCODE:A6E5		     push    bx
DOSCODE:A6E6		     call    SFFromSFN
DOSCODE:A6E9		     pop     bx
DOSCODE:A6EA		     jb	     short sfnf95
DOSCODE:A6EC		     cmp     word ptr es:[di], 0
DOSCODE:A6F0		     jz	     short sfnf20
DOSCODE:A6F2		     cmp     word ptr es:[di], 0FFFFh
DOSCODE:A6F6		     jz	     short sfnf10
DOSCODE:A6F8 sfnf7:				     ; ...
DOSCODE:A6F8		     inc     bx
DOSCODE:A6F9		     jmp     short sfnf5
DOSCODE:A6FB sfnf10:				     ; ...
DOSCODE:A6FB		     mov     ax, ss:USER_ID
DOSCODE:A6FF		     cmp     es:[di+2Fh], ax
DOSCODE:A703		     jnz     short sfnf7
DOSCODE:A705		     mov     ax, ss:PROC_ID
DOSCODE:A709		     cmp     es:[di+31h], ax
DOSCODE:A70D		     jnz     short sfnf7
DOSCODE:A70F sfnf20:				     ; ...
DOSCODE:A70F		     mov     word ptr es:[di], 0FFFFh
DOSCODE:A714		     mov     ax, ss:USER_ID
DOSCODE:A718		     mov     es:[di+2Fh], ax
DOSCODE:A71C		     mov     ax, ss:PROC_ID
DOSCODE:A720		     mov     es:[di+31h], ax
DOSCODE:A724		     pop     ax
DOSCODE:A725		     clc
DOSCODE:A726		     retn
DOSCODE:A727 sfnf95:				     ; ...
DOSCODE:A727		     pop     ax
DOSCODE:A728		     mov     al, 4
DOSCODE:A72A		     retn
DOSCODE:A72A SFNFree	     endp
DOSCODE:A72B ; =============== S U B R O U T I N E =======================================
DOSCODE:A72B $CLOSE	     proc near		     ; ...
DOSCODE:A72B		     call    CheckOwner
DOSCODE:A72E		     jb	     short CloseError
DOSCODE:A730		     push    ss
DOSCODE:A731		     pop     ds
DOSCODE:A732		     mov     word ptr ds:THISSFT, di
DOSCODE:A736		     mov     word ptr ds:THISSFT+2, es
DOSCODE:A73A		     cmp     word ptr es:[di], 1
DOSCODE:A73E		     jz	     short FreeJFN
DOSCODE:A740		     mov     al, es:[di+2]
DOSCODE:A744		     and     al, 0F0h
DOSCODE:A746		     cmp     al, 70h
DOSCODE:A748		     jz	     short PostFree
DOSCODE:A74A FreeJFN:				     ; ...
DOSCODE:A74A		     call    pJFNFromHandle
DOSCODE:A74D		     mov     byte ptr es:[di], 0FFh
DOSCODE:A751 PostFree:				     ; ...
DOSCODE:A751		     call    DOS_CLOSE
DOSCODE:A754		     jb	     short CloseError
DOSCODE:A756		     mov     ah, 3Eh
DOSCODE:A758 Close_OK:				     ; ...
DOSCODE:A758		     jmp     SYS_RET_OK
DOSCODE:A75B CloseError:			     ; ...
DOSCODE:A75B		     jmp     SYS_RET_ERR
DOSCODE:A75B $CLOSE	     endp
DOSCODE:A75E $COMMIT:				     ; ...
DOSCODE:A75E		     call    CheckOwner
DOSCODE:A761		     jb	     short CommitError
DOSCODE:A763		     push    ss
DOSCODE:A764		     pop     ds
DOSCODE:A765		     mov     word ptr ds:THISSFT, di
DOSCODE:A769		     mov     word ptr ds:THISSFT+2, es
DOSCODE:A76D		     call    DOS_COMMIT
DOSCODE:A770		     jb	     short CommitError
DOSCODE:A772		     mov     ah, 68h
DOSCODE:A774 ; START OF	FUNCTION CHUNK FOR $READ
DOSCODE:A774 Commit_OK:				     ; ...
DOSCODE:A774		     jmp     short Close_OK
DOSCODE:A776 CommitError:			     ; ...
DOSCODE:A776		     jmp     short CloseError
DOSCODE:A776 ; END OF FUNCTION CHUNK FOR $READ
DOSCODE:A778 $ExtHandle:			     ; ...
DOSCODE:A778		     xor     bp, bp
DOSCODE:A77A		     cmp     bx, 20
DOSCODE:A77D		     jnb     short exth2
DOSCODE:A77F		     mov     bx, 20	     ; FILPERPROC
DOSCODE:A782 exth2:				     ; ...
DOSCODE:A782		     mov     es, ss:CurrentPDB
DOSCODE:A787		     mov     cx, es:32h	     ; [ES:PDB.JFN_Length]
DOSCODE:A78C		     cmp     bx, cx
DOSCODE:A78E		     jz	     short ok_done
DOSCODE:A790		     ja	     short larger
DOSCODE:A792		     mov     bp, 1
DOSCODE:A795		     mov     ds, word ptr es:36h ; [ES:PDB.JFN_Pointer+2]
DOSCODE:A79A		     mov     si, bx
DOSCODE:A79C		     sub     cx, bx
DOSCODE:A79E chck_handles:			     ; ...
DOSCODE:A79E		     cmp     byte ptr [si], 0FFh
DOSCODE:A7A1		     jnz     short too_many_files
DOSCODE:A7A3		     inc     si
DOSCODE:A7A4		     loop    chck_handles
DOSCODE:A7A6		     cmp     bx, 20
DOSCODE:A7A9		     ja	     short larger
DOSCODE:A7AB		     mov     bp, 2
DOSCODE:A7AE		     mov     di, 24	     ; PDB.JFN_TABLE
DOSCODE:A7B1		     push    bx
DOSCODE:A7B2		     jmp     short movhandl
DOSCODE:A7B4 larger:				     ; ...
DOSCODE:A7B4		     cmp     bx, 0FFFFh
DOSCODE:A7B7		     jz	     short invalid_func
DOSCODE:A7B9		     clc
DOSCODE:A7BA		     push    bx
DOSCODE:A7BB		     add     bx, 0Fh
DOSCODE:A7BE		     mov     cl, 4
DOSCODE:A7C0		     rcr     bx, cl
DOSCODE:A7C2		     and     bx, 1FFFh
DOSCODE:A7C6		     push    bp
DOSCODE:A7C7		     call    $ALLOC
DOSCODE:A7CA		     pop     bp
DOSCODE:A7CB		     jb	     short no_memory
DOSCODE:A7CD		     mov     es, ax
DOSCODE:A7CF		     xor     di, di
DOSCODE:A7D1 movhandl:				     ; ...
DOSCODE:A7D1		     mov     ds, ss:CurrentPDB
DOSCODE:A7D6		     test    bp, 3
DOSCODE:A7DA		     jz	     short enlarge
DOSCODE:A7DC		     pop     cx
DOSCODE:A7DD		     push    cx
DOSCODE:A7DE		     jmp     short copy_hand
DOSCODE:A7E0 ; START OF	FUNCTION CHUNK FOR $READ
DOSCODE:A7E0 ok_done:				     ; ...
DOSCODE:A7E0		     jmp     short Commit_OK
DOSCODE:A7E0 ; END OF FUNCTION CHUNK FOR $READ
DOSCODE:A7E2 too_many_files:			     ; ...
DOSCODE:A7E2		     mov     al, 4
DOSCODE:A7E4 ; START OF	FUNCTION CHUNK FOR $READ
DOSCODE:A7E4 CommitErrorj:			     ; ...
DOSCODE:A7E4		     jmp     short CommitError
DOSCODE:A7E4 ; END OF FUNCTION CHUNK FOR $READ
DOSCODE:A7E6 enlarge:				     ; ...
DOSCODE:A7E6		     mov     cx, ds:32h	     ; [PDB.JFN_Length]
DOSCODE:A7EA copy_hand:				     ; ...
DOSCODE:A7EA		     mov     dx, cx
DOSCODE:A7EC		     lds     si, ds:34h
DOSCODE:A7F0		     rep movsb
DOSCODE:A7F2		     pop     cx
DOSCODE:A7F3		     push    cx
DOSCODE:A7F4		     sub     cx, dx
DOSCODE:A7F6		     mov     al, 0FFh
DOSCODE:A7F8		     rep stosb
DOSCODE:A7FA		     mov     ds, ss:CurrentPDB
DOSCODE:A7FF		     cmp     word ptr ds:34h, 0	; [PDB.JFN_Pointer]
DOSCODE:A804		     jnz     short update_info
DOSCODE:A806		     push    bp
DOSCODE:A807		     push    ds
DOSCODE:A808		     push    es
DOSCODE:A809		     mov     es, word ptr ds:36h ; [PDB.JFN_Pointer+2]
DOSCODE:A80D		     call    $DEALLOC
DOSCODE:A810		     pop     es
DOSCODE:A811		     pop     ds
DOSCODE:A812		     pop     bp
DOSCODE:A813 update_info:			     ; ...
DOSCODE:A813		     test    bp, 2
DOSCODE:A817		     jz	     short non_psp
DOSCODE:A819		     mov     word ptr ds:34h, 18h ; 24
DOSCODE:A81F		     jmp     short final
DOSCODE:A821 non_psp:				     ; ...
DOSCODE:A821		     mov     word ptr ds:34h, 0
DOSCODE:A827 final:				     ; ...
DOSCODE:A827		     mov     word ptr ds:36h, es
DOSCODE:A82B		     pop     word ptr ds:32h
DOSCODE:A82F ; START OF	FUNCTION CHUNK FOR $READ
DOSCODE:A82F ExtHandle_OK:			     ; ...
DOSCODE:A82F		     jmp     short ok_done
DOSCODE:A82F ; END OF FUNCTION CHUNK FOR $READ
DOSCODE:A831 no_memory:				     ; ...
DOSCODE:A831		     pop     bx
DOSCODE:A832		     mov     al, 8
DOSCODE:A834 ; START OF	FUNCTION CHUNK FOR $READ
DOSCODE:A834 jmp_to_jmp_CommitError:		     ; ...
DOSCODE:A834		     jmp     short CommitErrorj
DOSCODE:A834 ; END OF FUNCTION CHUNK FOR $READ
DOSCODE:A836 invalid_func:			     ; ...
DOSCODE:A836		     mov     al, 1
DOSCODE:A838 ; START OF	FUNCTION CHUNK FOR $READ
DOSCODE:A838 ExtHandle_err:			     ; ...
DOSCODE:A838		     jmp     short jmp_to_jmp_CommitError
DOSCODE:A838 ; END OF FUNCTION CHUNK FOR $READ
DOSCODE:A83A ; =============== S U B R O U T I N E =======================================
DOSCODE:A83A $READ	     proc near		     ; ...
DOSCODE:A83A ; FUNCTION	CHUNK AT DOSCODE:A774 SIZE 00000004 BYTES
DOSCODE:A83A ; FUNCTION	CHUNK AT DOSCODE:A7E0 SIZE 00000002 BYTES
DOSCODE:A83A ; FUNCTION	CHUNK AT DOSCODE:A7E4 SIZE 00000002 BYTES
DOSCODE:A83A ; FUNCTION	CHUNK AT DOSCODE:A82F SIZE 00000002 BYTES
DOSCODE:A83A ; FUNCTION	CHUNK AT DOSCODE:A834 SIZE 00000002 BYTES
DOSCODE:A83A ; FUNCTION	CHUNK AT DOSCODE:A838 SIZE 00000002 BYTES
DOSCODE:A83A		     mov     si, offset	DOS_READ
DOSCODE:A83D ReadDo:				     ; ...
DOSCODE:A83D		     call    pJFNFromHandle
DOSCODE:A840		     jb	     short ReadError
DOSCODE:A842		     mov     al, es:[di]
DOSCODE:A845		     call    CheckOwner
DOSCODE:A848		     jnb     short ReadSetup
DOSCODE:A84A ReadError:				     ; ...
DOSCODE:A84A		     jmp     short ExtHandle_err
DOSCODE:A84C ReadSetup:				     ; ...
DOSCODE:A84C		     mov     word ptr ss:THISSFT, di
DOSCODE:A851		     mov     word ptr ss:THISSFT+2, es
DOSCODE:A856		     test    byte ptr es:[di+3], 20h
DOSCODE:A85B		     jz	     short needi24
DOSCODE:A85D		     or	     ss:EXTOPEN_ON, 2
DOSCODE:A863 needi24:				     ; ...
DOSCODE:A863		     push    word ptr ss:DMAADD
DOSCODE:A868		     push    word ptr ss:DMAADD+2
DOSCODE:A86D		     call    Align_Buffer
DOSCODE:A870		     push    ss
DOSCODE:A871		     pop     ds
DOSCODE:A872		     call    si	; DOS_READ
DOSCODE:A874		     pop     word ptr ds:DMAADD+2
DOSCODE:A878		     pop     word ptr ds:DMAADD
DOSCODE:A87C		     jnb     short READ_OK
DOSCODE:A87E		     jmp     short ReadError
DOSCODE:A880 READ_OK:				     ; ...
DOSCODE:A880		     mov     ax, cx
DOSCODE:A882 Read_OK_j:				     ; ...
DOSCODE:A882		     jmp     short ExtHandle_OK
DOSCODE:A882 $READ	     endp
DOSCODE:A884 ; =============== S U B R O U T I N E =======================================
DOSCODE:A884 Align_Buffer    proc near		     ; ...
DOSCODE:A884		     mov     bx, dx
DOSCODE:A886		     push    cx
DOSCODE:A887		     mov     cl, 4
DOSCODE:A889		     shr     bx, cl
DOSCODE:A88B		     pop     cx
DOSCODE:A88C		     mov     ax, ds
DOSCODE:A88E		     add     ax, bx
DOSCODE:A890		     mov     ds, ax
DOSCODE:A892		     and     dx, 0Fh
DOSCODE:A895		     mov     word ptr ss:DMAADD, dx
DOSCODE:A89A		     mov     word ptr ss:DMAADD+2, ds
DOSCODE:A89F		     retn
DOSCODE:A89F Align_Buffer    endp
DOSCODE:A8A0 $WRITE:				     ; ...
DOSCODE:A8A0		     mov     si, offset	DOS_WRITE
DOSCODE:A8A3		     jmp     short ReadDo
DOSCODE:A8A5 ; =============== S U B R O U T I N E =======================================
DOSCODE:A8A5 $LSEEK	     proc near		     ; ...
DOSCODE:A8A5		     call    CheckOwner
DOSCODE:A8A8 LSeekError:			     ; ...
DOSCODE:A8A8		     jnb     short CHKOWN_OK
DOSCODE:A8AA		     jmp     short ReadError
DOSCODE:A8AC CHKOWN_OK:				     ; ...
DOSCODE:A8AC		     cmp     al, 2
DOSCODE:A8AE		     jbe     short LSeekDisp
DOSCODE:A8B0		     mov     ss:EXTERR_LOCUS, 1
DOSCODE:A8B6		     mov     al, 1
DOSCODE:A8B8 jmp_to_ReadError:			     ; ...
DOSCODE:A8B8		     jmp     short ReadError
DOSCODE:A8BA LSeekDisp:				     ; ...
DOSCODE:A8BA		     cmp     al, 1
DOSCODE:A8BC		     jb	     short LSeekStore
DOSCODE:A8BE		     ja	     short LSeekEOF
DOSCODE:A8C0		     add     dx, es:[di+15h]
DOSCODE:A8C4		     adc     cx, es:[di+17h]
DOSCODE:A8C8 LSeekStore:			     ; ...
DOSCODE:A8C8		     mov     ax, cx
DOSCODE:A8CA		     xchg    ax, dx
DOSCODE:A8CB LSeekSetpos:			     ; ...
DOSCODE:A8CB		     mov     es:[di+15h], ax
DOSCODE:A8CF		     mov     es:[di+17h], dx
DOSCODE:A8D3		     call    Get_User_Stack
DOSCODE:A8D6		     mov     [si+6], dx
DOSCODE:A8D9 jmp_to_Read_OK_j:			     ; ...
DOSCODE:A8D9		     jmp     short Read_OK_j
DOSCODE:A8DB LSeekEOF:				     ; ...
DOSCODE:A8DB		     test    byte ptr es:[di+6], 80h
DOSCODE:A8E0		     jnz     short Check_LSeek_Mode
DOSCODE:A8E2 LOCAL_LSeek:			     ; ...
DOSCODE:A8E2		     add     dx, es:[di+11h]
DOSCODE:A8E6		     adc     cx, es:[di+13h]
DOSCODE:A8EA		     jmp     short LSeekStore
DOSCODE:A8EC Check_LSeek_Mode:			     ; ...
DOSCODE:A8EC		     test    byte ptr es:[di+3], 80h
DOSCODE:A8F1		     jnz     short LOCAL_LSeek
DOSCODE:A8F3		     mov     ax, es:[di+2]
DOSCODE:A8F7		     and     ax, 0F0h
DOSCODE:A8FA		     cmp     ax, 40h
DOSCODE:A8FD		     jz	     short NET_LSEEK
DOSCODE:A8FF		     cmp     ax, 30h
DOSCODE:A902		     jnz     short LOCAL_LSeek
DOSCODE:A904 NET_LSEEK:				     ; ...
DOSCODE:A904		     mov     ax, 1121h
DOSCODE:A907		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	SEEK FROM END OF REMOTE	FILE
DOSCODE:A907					     ; CX:DX = offset (in bytes) from end
DOSCODE:A907					     ; ES:DI ->	SFT, SFT DPB field -> DPB of drive with	file
DOSCODE:A907					     ; SS = DOS	CS
DOSCODE:A907					     ; Return: CF set on error
DOSCODE:A907					     ; CF clear	if successful, DX:AX = new file	position
DOSCODE:A909		     jnb     short LSeekSetpos
DOSCODE:A90B jmp_to_jmp_ReadError:		     ; ...
DOSCODE:A90B		     jmp     short jmp_to_ReadError
DOSCODE:A90B $LSEEK	     endp
DOSCODE:A90D $FILE_TIMES:			     ; ...
DOSCODE:A90D		     cmp     al, 2
DOSCODE:A90F		     jnb     short inval_func
DOSCODE:A911		     call    CheckOwner
DOSCODE:A914		     jb	     short LSeekError
DOSCODE:A916		     or	     al, al
DOSCODE:A918		     jnz     short ft_set_time
DOSCODE:A91A		     cli
DOSCODE:A91B		     mov     cx, es:[di+0Dh]
DOSCODE:A91F		     mov     dx, es:[di+0Fh]
DOSCODE:A923		     sti
DOSCODE:A924		     call    Get_User_Stack
DOSCODE:A927		     mov     [si+4], cx
DOSCODE:A92A		     mov     [si+6], dx
DOSCODE:A92D		     jmp     short ok_ret
DOSCODE:A92F ft_set_time:			     ; ...
DOSCODE:A92F		     call    ECritDisk	     ; ECritSFT
DOSCODE:A932		     mov     es:[di+0Dh], cx
DOSCODE:A936		     mov     es:[di+0Fh], dx
DOSCODE:A93A		     xor     ax, ax
DOSCODE:A93C		     call    ss:ShSU
DOSCODE:A941		     and     word ptr es:[di+5], 0FFBFh
DOSCODE:A946		     or	     word ptr es:[di+5], 4000h
DOSCODE:A94C		     call    LCritDisk	     ; LCritSFT
DOSCODE:A94F ok_ret:				     ; ...
DOSCODE:A94F		     jmp     short jmp_to_Read_OK_j
DOSCODE:A951 inval_func:			     ; ...
DOSCODE:A951		     mov     ss:EXTERR_LOCUS, 1
DOSCODE:A957		     mov     al, 1
DOSCODE:A959 jmp3_to_ReadError:			     ; ...
DOSCODE:A959		     jmp     short jmp_to_jmp_ReadError
DOSCODE:A95B $DUP:				     ; ...
DOSCODE:A95B		     mov     ax, bx
DOSCODE:A95D		     call    JFNFree
DOSCODE:A960 DupErrorCheck:			     ; ...
DOSCODE:A960		     jb	     short DupErr
DOSCODE:A962		     push    es
DOSCODE:A963		     push    di
DOSCODE:A964		     pop     si
DOSCODE:A965		     pop     ds
DOSCODE:A966		     xchg    ax, bx
DOSCODE:A967		     call    CheckOwner
DOSCODE:A96A		     jb	     short DupErr
DOSCODE:A96C		     call    DOS_Dup_Direct
DOSCODE:A96F		     call    pJFNFromHandle
DOSCODE:A972		     mov     bl, es:[di]
DOSCODE:A975		     mov     [si], bl
DOSCODE:A977		     jmp     short ok_ret
DOSCODE:A979 DupErr:				     ; ...
DOSCODE:A979		     jmp     short jmp3_to_ReadError
DOSCODE:A97B $DUP2:				     ; ...
DOSCODE:A97B		     push    bx
DOSCODE:A97C		     push    cx
DOSCODE:A97D		     mov     bx, cx
DOSCODE:A97F		     call    $CLOSE
DOSCODE:A982		     pop     bx
DOSCODE:A983		     pop     ax
DOSCODE:A984		     call    pJFNFromHandle
DOSCODE:A987		     jmp     short DupErrorCheck
DOSCODE:A989 ; =============== S U B R O U T I N E =======================================
DOSCODE:A989 CheckOwner	     proc near		     ; ...
DOSCODE:A989		     call    SFFromHandle
DOSCODE:A98C		     jb	     short co_ret_label
DOSCODE:A98E		     push    ax
DOSCODE:A98F		     test    ss:IsWin386, 1
DOSCODE:A995		     jz	     short no_win386
DOSCODE:A997		     xor     ax, ax
DOSCODE:A999		     jmp     short _skip_win386
DOSCODE:A99B no_win386:				     ; ...
DOSCODE:A99B		     mov     ax, ss:USER_ID
DOSCODE:A99F		     cmp     ax, es:[di+47]  ; [es:di+SF_ENTRY.sf_UID]
DOSCODE:A9A3 _skip_win386:			     ; ...
DOSCODE:A9A3		     pop     ax
DOSCODE:A9A4		     jnz     short CheckOwner_err
DOSCODE:A9A6		     retn
DOSCODE:A9A7 CheckOwner_err:			     ; ...
DOSCODE:A9A7		     mov     al, 6
DOSCODE:A9A9		     stc
DOSCODE:A9AA co_ret_label:			     ; ...
DOSCODE:A9AA		     retn
DOSCODE:A9AA CheckOwner	     endp
DOSCODE:A9AB $AssignOper:			     ; ...
DOSCODE:A9AB		     cmp     al, 7
DOSCODE:A9AD		     jnz     short chk08
DOSCODE:A9AF srinuse:				     ; ...
DOSCODE:A9AF		     push    ax
DOSCODE:A9B0		     mov     al, dl
DOSCODE:A9B2		     call    GetCDSFromDrv
DOSCODE:A9B5		     pop     ax
DOSCODE:A9B6		     jb	     short baddrv
DOSCODE:A9B8		     cmp     word ptr [si+45h],	0
DOSCODE:A9BC		     jz	     short baddrv
DOSCODE:A9BE		     cmp     al, 7
DOSCODE:A9C0		     jnz     short resetdrv
DOSCODE:A9C2		     or	     word ptr [si+43h],	4000h
DOSCODE:A9C7		     jmp     short okdone
DOSCODE:A9C9 resetdrv:				     ; ...
DOSCODE:A9C9		     and     word ptr [si+43h],	0BFFFh
DOSCODE:A9CE		     jmp     short okdone
DOSCODE:A9D0 baddrv:				     ; ...
DOSCODE:A9D0		     mov     ax, 0Fh
DOSCODE:A9D3		     jmp     short ASS_ERR
DOSCODE:A9D5 chk08:				     ; ...
DOSCODE:A9D5		     cmp     al, 8
DOSCODE:A9D7		     jz	     short srinuse
DOSCODE:A9D9		     push    ax
DOSCODE:A9DA		     mov     ax, 111Eh
DOSCODE:A9DD		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	DO REDIRECTION
DOSCODE:A9DD					     ; SS = DOS	CS
DOSCODE:A9DD					     ; STACK: WORD function to execute
DOSCODE:A9DD					     ; Return: CF set on error,	AX = error code
DOSCODE:A9DD					     ; STACK unchanged
DOSCODE:A9DF		     pop     bx
DOSCODE:A9E0		     jb	     short ASS_ERR
DOSCODE:A9E2 okdone:				     ; ...
DOSCODE:A9E2		     jmp     SYS_RET_OK
DOSCODE:A9E5 ASS_ERR:				     ; ...
DOSCODE:A9E5		     jmp     SYS_RET_ERR
DOSCODE:A9E8 ; =============== S U B R O U T I N E =======================================
DOSCODE:A9E8 FIND_DPB	     proc near		     ; ...
DOSCODE:A9E8		     lds     si, ss:DPBHEAD
DOSCODE:A9ED fdpb5:				     ; ...
DOSCODE:A9ED		     cmp     si, 0FFFFh
DOSCODE:A9F0		     jz	     short fdpb10
DOSCODE:A9F2		     cmp     al, [si]	     ; [SI+DPB.DRIVE]
DOSCODE:A9F4		     jz	     short ret_label15
DOSCODE:A9F6		     lds     si, [si+19h]    ; [SI+DPB.NEXT_DPB]
DOSCODE:A9F9		     jmp     short fdpb5
DOSCODE:A9FB fdpb10:				     ; ...
DOSCODE:A9FB		     stc
DOSCODE:A9FC ret_label15:			     ; ...
DOSCODE:A9FC		     retn
DOSCODE:A9FC FIND_DPB	     endp
DOSCODE:A9FD ; =============== S U B R O U T I N E =======================================
DOSCODE:A9FD InitCDS	     proc near		     ; ...
DOSCODE:A9FD		     push    ax
DOSCODE:A9FE		     les     di, ss:THISCDS
DOSCODE:AA03		     mov     word ptr es:[di+43h], 0
DOSCODE:AA09		     sub     al, 40h ; '@'
DOSCODE:AA0B		     cmp     ss:NUMIO, al
DOSCODE:AA10		     jb	     short icdsx
DOSCODE:AA12		     dec     ax
DOSCODE:AA13		     push    ax
DOSCODE:AA14		     add     al, 'A'
DOSCODE:AA16		     mov     ah, ':'
DOSCODE:AA18		     mov     es:[di], ax
DOSCODE:AA1B		     mov     word ptr es:[di+2], '\'
DOSCODE:AA21		     or	     byte ptr es:[di+44h], 40h
DOSCODE:AA26		     sub     ax, ax
DOSCODE:AA28		     mov     es:[di+49h], ax
DOSCODE:AA2C		     mov     es:[di+4Bh], ax
DOSCODE:AA30		     mov     al, 2
DOSCODE:AA32		     mov     es:[di+4Fh], ax
DOSCODE:AA36		     pop     ax
DOSCODE:AA37		     push    ds
DOSCODE:AA38		     push    si
DOSCODE:AA39		     call    FIND_DPB
DOSCODE:AA3C		     jb	     short icds5
DOSCODE:AA3E		     mov     es:[di+45h], si
DOSCODE:AA42		     mov     word ptr es:[di+47h], ds
DOSCODE:AA46 icds5:				     ; ...
DOSCODE:AA46		     pop     si
DOSCODE:AA47		     pop     ds
DOSCODE:AA48 icdsx:				     ; ...
DOSCODE:AA48		     pop     ax
DOSCODE:AA49 RET45:				     ; ...
DOSCODE:AA49		     retn
DOSCODE:AA49 InitCDS	     endp
DOSCODE:AA4A $UserOper:				     ; ...
DOSCODE:AA4A		     push    ax
DOSCODE:AA4B		     sub     al, 1
DOSCODE:AA4D		     pop     ax
DOSCODE:AA4E		     jb	     short UserGet
DOSCODE:AA50		     jz	     short UserSet
DOSCODE:AA52		     cmp     al, 5
DOSCODE:AA54		     jbe     short UserPrint
DOSCODE:AA56		     mov     ss:EXTERR_LOCUS, 1
DOSCODE:AA5C		     mov     al, 1
DOSCODE:AA5E useroper_error:			     ; ...
DOSCODE:AA5E		     jmp     short ASS_ERR
DOSCODE:AA60 UserGet:				     ; ...
DOSCODE:AA60		     push    ds
DOSCODE:AA61		     pop     es
DOSCODE:AA62		     mov     di, dx
DOSCODE:AA64		     mov     cx, ss:MYNUM
DOSCODE:AA69		     call    Get_User_Stack
DOSCODE:AA6C		     mov     [si+4], cx
DOSCODE:AA6F		     push    ss
DOSCODE:AA70		     pop     ds
DOSCODE:AA71		     mov     si, offset	MYNAME
DOSCODE:AA74 UserMove:				     ; ...
DOSCODE:AA74		     mov     cx, 15
DOSCODE:AA77		     rep movsb
DOSCODE:AA79		     xor     ax, ax
DOSCODE:AA7B		     stosb
DOSCODE:AA7C UserBye:				     ; ...
DOSCODE:AA7C		     jmp     SYS_RET_OK
DOSCODE:AA7F UserSet:				     ; ...
DOSCODE:AA7F		     mov     ss:MYNUM, cx
DOSCODE:AA84		     mov     si, dx
DOSCODE:AA86		     push    ss
DOSCODE:AA87		     pop     es
DOSCODE:AA88		     mov     di, offset	MYNAME
DOSCODE:AA8B		     inc     ss:DIFFNAM
DOSCODE:AA90		     jmp     short UserMove
DOSCODE:AA92 UserPrint:				     ; ...
DOSCODE:AA92		     push    ax
DOSCODE:AA93		     mov     ax, 111Fh
DOSCODE:AA96		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	PRINTER	SETUP
DOSCODE:AA96					     ; STACK: WORD function
DOSCODE:AA96					     ; Return: CF set on error,	AX = error code
DOSCODE:AA96					     ; STACK unchanged
DOSCODE:AA98		     pop     dx
DOSCODE:AA99		     jnb     short OKPA
DOSCODE:AA9B		     jmp     short useroper_error
DOSCODE:AA9D OKPA:				     ; ...
DOSCODE:AA9D		     jmp     short UserBye
DOSCODE:AA9F ; =============== S U B R O U T I N E =======================================
DOSCODE:AA9F GetVisDrv	     proc near		     ; ...
DOSCODE:AA9F		     call    GETTHISDRV
DOSCODE:AAA2		     jb	     short RET45
DOSCODE:AAA4		     push    ds
DOSCODE:AAA5		     push    si
DOSCODE:AAA6		     lds     si, ss:THISCDS
DOSCODE:AAAB		     test    word ptr [si+43h],	2000h
DOSCODE:AAB0		     pop     si
DOSCODE:AAB1		     pop     ds
DOSCODE:AAB2		     jz	     short RET45
DOSCODE:AAB4		     mov     ss:DrvErr,	0Fh
DOSCODE:AABA		     stc
DOSCODE:AABB		     retn
DOSCODE:AABB GetVisDrv	     endp
DOSCODE:AABC ; =============== S U B R O U T I N E =======================================
DOSCODE:AABC GETTHISDRV	     proc near		     ; ...
DOSCODE:AABC		     or	     al, al
DOSCODE:AABE		     jnz     short GTD10
DOSCODE:AAC0		     mov     al, ss:CURDRV
DOSCODE:AAC4		     inc     ax
DOSCODE:AAC5 GTD10:				     ; ...
DOSCODE:AAC5		     dec     ax
DOSCODE:AAC6		     push    ds
DOSCODE:AAC7		     push    si
DOSCODE:AAC8		     mov     ss:EXTERR_LOCUS, 2
DOSCODE:AACE		     test    ss:FSHARING, 0FFh
DOSCODE:AAD4		     jz	     short GTD20
DOSCODE:AAD6		     push    ax
DOSCODE:AAD7		     push    es
DOSCODE:AAD8		     push    di
DOSCODE:AAD9		     mov     word ptr ss:THISCDS, offset DUMMYCDS
DOSCODE:AAE0		     mov     word ptr ss:THISCDS+2, ss
DOSCODE:AAE5		     add     al, 'A'
DOSCODE:AAE7		     call    InitCDS
DOSCODE:AAEA		     test    word ptr es:[di+43h], 4000h
DOSCODE:AAF0		     pop     di
DOSCODE:AAF1		     pop     es
DOSCODE:AAF2		     pop     ax
DOSCODE:AAF3		     jz	     short GTD30
DOSCODE:AAF5		     jmp     short GTDX
DOSCODE:AAF7 GTD20:				     ; ...
DOSCODE:AAF7		     call    GetCDSFromDrv
DOSCODE:AAFA		     jb	     short GTD30
DOSCODE:AAFC		     test    word ptr [si+43h],	4000h
DOSCODE:AB01		     jnz     short GTDX
DOSCODE:AB03 GTD30:				     ; ...
DOSCODE:AB03		     mov     al, 0Fh
DOSCODE:AB05		     mov     ss:DrvErr,	al
DOSCODE:AB09		     mov     ss:EXTERR_LOCUS, 1
DOSCODE:AB0F		     stc
DOSCODE:AB10 GTDX:				     ; ...
DOSCODE:AB10		     pop     si
DOSCODE:AB11		     pop     ds
DOSCODE:AB12		     retn
DOSCODE:AB12 GETTHISDRV	     endp
DOSCODE:AB13 ; =============== S U B R O U T I N E =======================================
DOSCODE:AB13 GetCDSFromDrv   proc near		     ; ...
DOSCODE:AB13		     cmp     al, ss:CDSCOUNT
DOSCODE:AB18		     jb	     short GetCDS
DOSCODE:AB1A		     stc
DOSCODE:AB1B		     retn
DOSCODE:AB1C GetCDS:				     ; ...
DOSCODE:AB1C		     push    bx
DOSCODE:AB1D		     push    ax
DOSCODE:AB1E		     lds     si, ss:CDSADDR
DOSCODE:AB23		     mov     bl, 88	     ; curdir.size
DOSCODE:AB25		     mul     bl
DOSCODE:AB27		     add     si, ax
DOSCODE:AB29		     mov     word ptr ss:THISCDS, si
DOSCODE:AB2E		     mov     word ptr ss:THISCDS+2, ds
DOSCODE:AB33		     pop     ax
DOSCODE:AB34		     pop     bx
DOSCODE:AB35		     clc
DOSCODE:AB36		     retn
DOSCODE:AB36 GetCDSFromDrv   endp
DOSCODE:AB37 ; =============== S U B R O U T I N E =======================================
DOSCODE:AB37 ; Attributes: bp-based frame
DOSCODE:AB37 TransFCB	     proc near		     ; ...
DOSCODE:AB37		     push    bp
DOSCODE:AB38		     mov     bp, sp
DOSCODE:AB3A		     sub     sp, 16
DOSCODE:AB3D		     push    ss
DOSCODE:AB3E		     pop     es
DOSCODE:AB3F		     push    es
DOSCODE:AB40		     push    di
DOSCODE:AB41		     lea     di, [bp-16]     ; FCBTmp
DOSCODE:AB44		     mov     ss:EXTFCB,	0
DOSCODE:AB4A		     mov     ss:SATTRIB, 0
DOSCODE:AB50		     call    GetExtended
DOSCODE:AB53		     jz	     short GetDrive
DOSCODE:AB55		     mov     al, [si-1]
DOSCODE:AB58		     mov     ss:SATTRIB, al
DOSCODE:AB5C		     mov     ss:EXTFCB,	0FFh
DOSCODE:AB62 GetDrive:				     ; ...
DOSCODE:AB62		     lodsb
DOSCODE:AB63		     call    GETTHISDRV
DOSCODE:AB66		     jb	     short BadPack
DOSCODE:AB68		     call    TextFromDrive
DOSCODE:AB6B		     mov     cx, 11
DOSCODE:AB6E		     push    si
DOSCODE:AB6F FCBScan:				     ; ...
DOSCODE:AB6F		     lodsb
DOSCODE:AB70		     call    GetCharType
DOSCODE:AB73		     test    al, 8
DOSCODE:AB75		     jz	     short BadPack
DOSCODE:AB77		     loop    FCBScan
DOSCODE:AB79		     pop     si
DOSCODE:AB7A		     mov     bx, di
DOSCODE:AB7C		     call    PackName
DOSCODE:AB7F		     pop     di
DOSCODE:AB80		     pop     es
DOSCODE:AB81		     push    ss
DOSCODE:AB82		     pop     ds
DOSCODE:AB83		     lea     si, [bp-16]     ;	FCBTmp
DOSCODE:AB86		     cmp     byte ptr [bx], 0
DOSCODE:AB89		     jz	     short BadPack
DOSCODE:AB8B		     push    bp
DOSCODE:AB8C		     call    TransPathSet
DOSCODE:AB8F		     pop     bp
DOSCODE:AB90		     jnb     short FCBRet
DOSCODE:AB92 BadPack:				     ; ...
DOSCODE:AB92		     stc
DOSCODE:AB93		     mov     al, 3
DOSCODE:AB95 FCBRet:				     ; ...
DOSCODE:AB95		     mov     sp, bp
DOSCODE:AB97		     pop     bp
DOSCODE:AB98 TransPath_retn:			     ; ...
DOSCODE:AB98		     retn
DOSCODE:AB98 TransFCB	     endp ; sp-analysis	failed
DOSCODE:AB99 ; =============== S U B R O U T I N E =======================================
DOSCODE:AB99 TransPath	     proc near		     ; ...
DOSCODE:AB99		     xor     al, al
DOSCODE:AB9B		     jmp     short SetSplice
DOSCODE:AB9B TransPath	     endp
DOSCODE:AB9D ; =============== S U B R O U T I N E =======================================
DOSCODE:AB9D TransPathSet    proc near		     ; ...
DOSCODE:AB9D ; FUNCTION	CHUNK AT DOSCODE:AC6D SIZE 000000A5 BYTES
DOSCODE:AB9D		     mov     al, 0FFh
DOSCODE:AB9F SetSplice:				     ; ...
DOSCODE:AB9F		     mov     ss:NoSetDir, al
DOSCODE:ABA3		     mov     al, 0FFh
DOSCODE:ABA5 TransPathNoSet:			     ; ...
DOSCODE:ABA5		     mov     ss:FSPLICE, al
DOSCODE:ABA9		     mov     ss:CMETA, 0FFh
DOSCODE:ABAF		     mov     ss:WFP_START, di
DOSCODE:ABB4		     mov     ss:CURR_DIR_END, 0FFFFh
DOSCODE:ABBB		     push    ss
DOSCODE:ABBC		     pop     es
DOSCODE:ABBD		     lea     bp, [di+134]    ; lea bp,[di+TEMPLEN]
DOSCODE:ABC1		     test    ss:FSHARING, 0FFh
DOSCODE:ABC7		     jz	     short CheckUNC
DOSCODE:ABC9		     call    DriveFromText
DOSCODE:ABCC		     call    GETTHISDRV
DOSCODE:ABCF		     jb	     short NoPath
DOSCODE:ABD1		     call    TextFromDrive
DOSCODE:ABD4		     lea     bx, [di+1]
DOSCODE:ABD7		     call    Canonicalize
DOSCODE:ABDA		     jb	     short TransPath_retn
DOSCODE:ABDC		     push    ss
DOSCODE:ABDD		     pop     ds
DOSCODE:ABDE		     mov     si, ds:WFP_START
DOSCODE:ABE2		     test    ds:FSPLICE, 0FFh
DOSCODE:ABE7		     jz	     short NoServerSplice
DOSCODE:ABE9		     call    Splice
DOSCODE:ABEC NoServerSplice:			     ; ...
DOSCODE:ABEC		     push    ss
DOSCODE:ABED		     pop     ds
DOSCODE:ABEE		     les     di, ds:THISCDS
DOSCODE:ABF2		     call    ECritDisk
DOSCODE:ABF5		     call    FATREAD_CDS
DOSCODE:ABF8		     call    LCritDisk
DOSCODE:ABFB NoPath:				     ; ...
DOSCODE:ABFB		     mov     al, 3
DOSCODE:ABFD		     retn
DOSCODE:ABFE CheckUNC:				     ; ...
DOSCODE:ABFE		     mov     word ptr ss:THISCDS, 0FFFFh
DOSCODE:AC05		     mov     ax, 1123h
DOSCODE:AC08		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	QUALIFY	REMOTE FILENAME
DOSCODE:AC08					     ; DS:SI ->	ASCIZ filename to canonicalize
DOSCODE:AC08					     ; ES:DI ->	128-byte buffer	for qualified name
DOSCODE:AC08					     ; Return: CF set if not resolved
DOSCODE:AC0A		     jnb     short UNCDone
DOSCODE:AC0C		     call    DriveFromText
DOSCODE:AC0F		     push    ax
DOSCODE:AC10		     mov     ax, [si]
DOSCODE:AC12		     call    PATHCHRCMP
DOSCODE:AC15		     xchg    ah, al
DOSCODE:AC17		     call    PATHCHRCMP
DOSCODE:AC1A		     jnz     short CheckDevice
DOSCODE:AC1C		     cmp     ah, al
DOSCODE:AC1E		     jnz     short CheckDevice
DOSCODE:AC20		     pop     ax
DOSCODE:AC21		     movsw
DOSCODE:AC22 UNCCpy:				     ; ...
DOSCODE:AC22		     lodsb
DOSCODE:AC23		     call    UCase
DOSCODE:AC26		     or	     al, al
DOSCODE:AC28		     jz	     short UNCTerm
DOSCODE:AC2A		     call    PATHCHRCMP
DOSCODE:AC2D		     mov     bx, di
DOSCODE:AC2F		     stosb
DOSCODE:AC30		     jnz     short UNCCpy
DOSCODE:AC32		     call    Canonicalize
DOSCODE:AC35 UNCDone:				     ; ...
DOSCODE:AC35		     push    ss
DOSCODE:AC36		     pop     ds
DOSCODE:AC37		     retn
DOSCODE:AC38 UNCTerm:				     ; ...
DOSCODE:AC38		     stosb
DOSCODE:AC39		     jmp     short UNCDone
DOSCODE:AC3B CheckDevice:			     ; ...
DOSCODE:AC3B		     pop     ax
DOSCODE:AC3C		     cmp     byte ptr [si], 0
DOSCODE:AC3F		     jnz     short CheckPath
DOSCODE:AC41		     mov     al, 2
DOSCODE:AC43		     stc
DOSCODE:AC44		     retn
DOSCODE:AC45 CheckPath:				     ; ...
DOSCODE:AC45		     push    ax
DOSCODE:AC46		     push    bp
DOSCODE:AC47		     call    no5Dshere	     ; call CheckThisDevice
DOSCODE:AC4A		     pop     bp
DOSCODE:AC4B		     pop     ax
DOSCODE:AC4C		     jnb     short DoFile
DOSCODE:AC4E		     mov     ss:FSHARING, 0FFh
DOSCODE:AC54		     call    GETTHISDRV
DOSCODE:AC57		     mov     ss:FSHARING, 0
DOSCODE:AC5D		     call    TextFromDrive
DOSCODE:AC60		     mov     al, '/'
DOSCODE:AC62		     stosb
DOSCODE:AC63		     call    StrCpy
DOSCODE:AC66		     clc
DOSCODE:AC67		     push    ss
DOSCODE:AC68		     pop     ds
DOSCODE:AC69 DoFile_retn:			     ; ...
DOSCODE:AC69		     retn
DOSCODE:AC69 TransPathSet    endp
DOSCODE:AC6A ; =============== S U B R O U T I N E =======================================
DOSCODE:AC6A ; Attributes: thunk
DOSCODE:AC6A no5Dshere	     proc near		     ; ...
DOSCODE:AC6A		     jmp     CheckThisDevice
DOSCODE:AC6A no5Dshere	     endp
DOSCODE:AC6D ; START OF	FUNCTION CHUNK FOR TransPathSet
DOSCODE:AC6D DoFile:				     ; ...
DOSCODE:AC6D		     call    GetVisDrv
DOSCODE:AC70		     mov     al, 3
DOSCODE:AC72		     jb	     short DoFile_retn
DOSCODE:AC74		     push    ds
DOSCODE:AC75		     push    si
DOSCODE:AC76		     push    es
DOSCODE:AC77		     push    di
DOSCODE:AC78		     call    ValidateCDS
DOSCODE:AC7B		     pop     di
DOSCODE:AC7C		     pop     es
DOSCODE:AC7D		     pop     si
DOSCODE:AC7E		     pop     ds
DOSCODE:AC7F		     mov     al, 3
DOSCODE:AC81		     jb	     short DoFile_retn
DOSCODE:AC83		     push    ds
DOSCODE:AC84		     push    si
DOSCODE:AC85		     lds     si, ss:THISCDS
DOSCODE:AC8A		     mov     bx, di
DOSCODE:AC8C		     add     bx, [si+79]
DOSCODE:AC8F		     lea     bp, [di+134]
DOSCODE:AC93		     call    FStrCpy
DOSCODE:AC96		     dec     di
DOSCODE:AC97		     mov     al, '\'
DOSCODE:AC99		     cmp     es:[di-1],	al
DOSCODE:AC9D		     jz	     short GetOrig
DOSCODE:AC9F		     stosb
DOSCODE:ACA0 GetOrig:				     ; ...
DOSCODE:ACA0		     dec     di
DOSCODE:ACA1		     pop     si
DOSCODE:ACA2		     pop     ds
DOSCODE:ACA3		     call    PathSep
DOSCODE:ACA6		     jnz     short PathAssure
DOSCODE:ACA8		     or	     al, al
DOSCODE:ACAA		     jz	     short DoCanon
DOSCODE:ACAC		     mov     di, bx
DOSCODE:ACAE SkipPath:				     ; ...
DOSCODE:ACAE		     lodsb
DOSCODE:ACAF		     call    PATHCHRCMP
DOSCODE:ACB2		     jz	     short SkipPath
DOSCODE:ACB4		     dec     si
DOSCODE:ACB5		     or	     al, al
DOSCODE:ACB7		     jz	     short DoCanon
DOSCODE:ACB9 PathAssure:			     ; ...
DOSCODE:ACB9		     mov     al, '\'
DOSCODE:ACBB		     stosb
DOSCODE:ACBC DoCanon:				     ; ...
DOSCODE:ACBC		     call    Canonicalize
DOSCODE:ACBF		     jb	     short DoFile_retn
DOSCODE:ACC1		     push    ss
DOSCODE:ACC2		     pop     ds
DOSCODE:ACC3		     mov     di, ds:WFP_START
DOSCODE:ACC7		     lds     si, ds:THISCDS
DOSCODE:ACCB		     call    PathPref
DOSCODE:ACCE		     jnz     short DoSplice
DOSCODE:ACD0		     mov     al, [si-1]
DOSCODE:ACD3		     call    PATHCHRCMP
DOSCODE:ACD6		     jz	     short DoSplice
DOSCODE:ACD8 Pathline:
DOSCODE:ACD8		     cmp     byte ptr es:[di], 0
DOSCODE:ACDC		     jz	     short DoSplice
DOSCODE:ACDE		     inc     di
DOSCODE:ACDF		     mov     ss:CURR_DIR_END, di
DOSCODE:ACE4 DoSplice:				     ; ...
DOSCODE:ACE4		     push    ss
DOSCODE:ACE5		     pop     ds
DOSCODE:ACE6		     mov     si, ds:WFP_START
DOSCODE:ACEA		     xor     cx, cx
DOSCODE:ACEC		     test    ds:FSPLICE, 0FFh
DOSCODE:ACF1		     jz	     short SkipSplice
DOSCODE:ACF3		     call    Splice
DOSCODE:ACF6 SkipSplice:			     ; ...
DOSCODE:ACF6		     push    ss
DOSCODE:ACF7		     pop     ds
DOSCODE:ACF8		     les     di, ds:THISCDS
DOSCODE:ACFC		     test    word ptr es:[di+67], 8000h
DOSCODE:AD02		     jnz     short Done
DOSCODE:AD04		     jcxz    short Done
DOSCODE:AD06		     call    ECritDisk
DOSCODE:AD09		     call    FATREAD_CDS
DOSCODE:AD0C		     call    LCritDisk
DOSCODE:AD0F		     mov     al, 3
DOSCODE:AD11 Done:				     ; ...
DOSCODE:AD11		     retn
DOSCODE:AD11 ; END OF FUNCTION CHUNK FOR TransPathSet
DOSCODE:AD12 ; =============== S U B R O U T I N E =======================================
DOSCODE:AD12 Canonicalize    proc near		     ; ...
DOSCODE:AD12		     lodsb
DOSCODE:AD13		     call    PATHCHRCMP
DOSCODE:AD16		     jnz     short CanonDec
DOSCODE:AD18		     cmp     di, bp
DOSCODE:AD1A		     jnb     short CanonBad
DOSCODE:AD1C		     stosb
DOSCODE:AD1D		     jmp     short Canonicalize
DOSCODE:AD1F CanonDec:				     ; ...
DOSCODE:AD1F		     dec     si
DOSCODE:AD20 CanonLoop:				     ; ...
DOSCODE:AD20		     xor     ax, ax
DOSCODE:AD22		     cmp     [si], al
DOSCODE:AD24		     jnz     short DoComponent
DOSCODE:AD26		     cmp     byte ptr es:[di-1], ':'
DOSCODE:AD2B		     jnz     short DoTerminate
DOSCODE:AD2D		     mov     al, '\'
DOSCODE:AD2F		     stosb
DOSCODE:AD30		     mov     al, ah
DOSCODE:AD32 DoTerminate:			     ; ...
DOSCODE:AD32		     stosb
DOSCODE:AD33		     clc
DOSCODE:AD34		     retn
DOSCODE:AD35 CanonBad:				     ; ...
DOSCODE:AD35		     call    ScanPathChar
DOSCODE:AD38		     mov     al, 3
DOSCODE:AD3A		     jz	     short PathEnc
DOSCODE:AD3C		     mov     al, 2
DOSCODE:AD3E PathEnc:				     ; ...
DOSCODE:AD3E		     stc
DOSCODE:AD3F CanonBad_retn:			     ; ...
DOSCODE:AD3F		     retn
DOSCODE:AD40 DoComponent:			     ; ...
DOSCODE:AD40		     call    CopyComponent
DOSCODE:AD43		     jb	     short CanonBad_retn
DOSCODE:AD45		     cmp     word ptr es:[di], '.' ; 2Eh
DOSCODE:AD49		     jz	     short Skip1
DOSCODE:AD4B		     cmp     word ptr es:[di], '..' ; 2E2Eh
DOSCODE:AD50		     jnz     short CanonNormal
DOSCODE:AD52		     dec     di
DOSCODE:AD53 Skip1:				     ; ...
DOSCODE:AD53		     call    SkipBack
DOSCODE:AD56		     mov     al, 3
DOSCODE:AD58		     jb	     short CanonBad_retn
DOSCODE:AD5A		     jmp     short CanonPath
DOSCODE:AD5C CanonNormal:			     ; ...
DOSCODE:AD5C		     add     di, cx
DOSCODE:AD5E CanonPath:				     ; ...
DOSCODE:AD5E		     call    PathSep
DOSCODE:AD61		     jnz     short CanonBad
DOSCODE:AD63		     lodsb
DOSCODE:AD64		     call    PATHCHRCMP
DOSCODE:AD67		     jnz     short CanonDec
DOSCODE:AD69		     cmp     di, bp
DOSCODE:AD6B		     jnb     short CanonBad
DOSCODE:AD6D		     stosb
DOSCODE:AD6E CanonPathLoop:			     ; ...
DOSCODE:AD6E		     lodsb
DOSCODE:AD6F		     call    PATHCHRCMP
DOSCODE:AD72		     jz	     short CanonPathLoop
DOSCODE:AD74		     dec     si
DOSCODE:AD75		     jmp     short CanonLoop
DOSCODE:AD75 Canonicalize    endp
DOSCODE:AD77 ; =============== S U B R O U T I N E =======================================
DOSCODE:AD77 PathSep	     proc near		     ; ...
DOSCODE:AD77		     mov     al, [si]
DOSCODE:AD79 PathSepGotCh:			     ; ...
DOSCODE:AD79		     or	     al, al
DOSCODE:AD7B		     jz	     short CanonBad_retn
DOSCODE:AD7D		     call    PATHCHRCMP
DOSCODE:AD80		     retn
DOSCODE:AD80 PathSep	     endp
DOSCODE:AD81 ; =============== S U B R O U T I N E =======================================
DOSCODE:AD81 SkipBack	     proc near		     ; ...
DOSCODE:AD81		     cmp     di, bx
DOSCODE:AD83		     jb	     short SkipBad
DOSCODE:AD85		     dec     di
DOSCODE:AD86		     mov     al, es:[di]
DOSCODE:AD89		     call    PATHCHRCMP
DOSCODE:AD8C		     jnz     short SkipBack
DOSCODE:AD8E		     clc
DOSCODE:AD8F		     retn
DOSCODE:AD90 SkipBad:				     ; ...
DOSCODE:AD90		     mov     al, 3
DOSCODE:AD92		     stc
DOSCODE:AD93		     retn
DOSCODE:AD93 SkipBack	     endp
DOSCODE:AD94 ; =============== S U B R O U T I N E =======================================
DOSCODE:AD94 CopyComponent   proc near		     ; ...
DOSCODE:AD94		     sub     sp, 14
DOSCODE:AD97		     push    ds
DOSCODE:AD98		     push    si
DOSCODE:AD99		     push    es
DOSCODE:AD9A		     push    di
DOSCODE:AD9B		     push    bp
DOSCODE:AD9C		     mov     bp, sp
DOSCODE:AD9E		     mov     ah, '.'
DOSCODE:ADA0		     lodsb
DOSCODE:ADA1		     stosb
DOSCODE:ADA2		     cmp     al, ah
DOSCODE:ADA4		     jnz     short NormalComp
DOSCODE:ADA6		     call    PathSep
DOSCODE:ADA9		     jz	     short NulTerm
DOSCODE:ADAB TryTwoDot:
DOSCODE:ADAB		     lodsb
DOSCODE:ADAC		     stosb
DOSCODE:ADAD		     cmp     al, ah
DOSCODE:ADAF		     jnz     short CopyBad
DOSCODE:ADB1		     call    PathSep
DOSCODE:ADB4		     jnz     short CopyBad
DOSCODE:ADB6 NulTerm:				     ; ...
DOSCODE:ADB6		     xor     al, al
DOSCODE:ADB8		     stosb
DOSCODE:ADB9		     mov     [bp+6], si
DOSCODE:ADBC		     jmp     short _GoodRet
DOSCODE:ADBE NormalComp:			     ; ...
DOSCODE:ADBE		     mov     si, [bp+6]
DOSCODE:ADC1		     call    NAMETRANS
DOSCODE:ADC4		     cmp     si, [bp+6]
DOSCODE:ADC7		     jz	     short CopyBad
DOSCODE:ADC9		     test    ss:FSHARING, 0FFh
DOSCODE:ADCF		     jnz     short DoPack
DOSCODE:ADD1		     and     dl, 1
DOSCODE:ADD4		     add     ss:CMETA, dl
DOSCODE:ADD9		     jg	     short CopyBad
DOSCODE:ADDB		     jnz     short DoPack
DOSCODE:ADDD		     or	     dl, dl
DOSCODE:ADDF		     jz	     short CopyBadPath
DOSCODE:ADE1 DoPack:				     ; ...
DOSCODE:ADE1		     mov     [bp+6], si
DOSCODE:ADE4		     push    ss
DOSCODE:ADE5		     pop     ds
DOSCODE:ADE6		     mov     si, offset	NAME1
DOSCODE:ADE9		     lea     di, [bp+0Ah]
DOSCODE:ADEC		     push    di
DOSCODE:ADED		     call    PackName
DOSCODE:ADF0		     pop     di
DOSCODE:ADF1		     call    StrLen
DOSCODE:ADF4		     dec     cx
DOSCODE:ADF5		     add     cx, [bp+2]
DOSCODE:ADF8		     cmp     cx, [bp+0]
DOSCODE:ADFB		     jnb     short CopyBad
DOSCODE:ADFD		     mov     si, di
DOSCODE:ADFF		     les     di, [bp+2]
DOSCODE:AE02		     call    FStrCpy
DOSCODE:AE05 _GoodRet:				     ; ...
DOSCODE:AE05		     clc
DOSCODE:AE06		     jmp     short CopyEnd
DOSCODE:AE08 CopyBad:				     ; ...
DOSCODE:AE08		     stc
DOSCODE:AE09		     call    ScanPathChar
DOSCODE:AE0C		     mov     al, 2
DOSCODE:AE0E		     jnz     short CopyEnd
DOSCODE:AE10 CopyBadPath:			     ; ...
DOSCODE:AE10		     stc
DOSCODE:AE11		     mov     al, 3
DOSCODE:AE13 CopyEnd:				     ; ...
DOSCODE:AE13		     pop     bp
DOSCODE:AE14		     pop     di
DOSCODE:AE15		     pop     es
DOSCODE:AE16		     pop     si
DOSCODE:AE17		     pop     ds
DOSCODE:AE18		     lahf
DOSCODE:AE19		     add     sp, 14
DOSCODE:AE1C		     call    StrLen
DOSCODE:AE1F		     dec     cx
DOSCODE:AE20		     sahf
DOSCODE:AE21		     retn
DOSCODE:AE21 CopyComponent   endp
DOSCODE:AE22 ; =============== S U B R O U T I N E =======================================
DOSCODE:AE22 Splice	     proc near		     ; ...
DOSCODE:AE22		     test    ss:SPLICES, 0FFh
DOSCODE:AE28		     jz	     short AllDone
DOSCODE:AE2A		     push    word ptr ss:THISCDS
DOSCODE:AE2F		     push    word ptr ss:THISCDS+2
DOSCODE:AE34		     push    ds
DOSCODE:AE35		     push    si
DOSCODE:AE36		     pop     di
DOSCODE:AE37		     pop     es
DOSCODE:AE38		     xor     ax, ax
DOSCODE:AE3A SpliceScan:			     ; ...
DOSCODE:AE3A		     call    GetCDSFromDrv
DOSCODE:AE3D		     jb	     short SpliceDone
DOSCODE:AE3F		     inc     al
DOSCODE:AE41		     test    word ptr [si+43h],	2000h
DOSCODE:AE46		     jz	     short SpliceScan
DOSCODE:AE48		     push    di
DOSCODE:AE49		     call    PathPref
DOSCODE:AE4C		     jz	     short SpliceFound
DOSCODE:AE4E SpliceSkip:			     ; ...
DOSCODE:AE4E		     pop     di
DOSCODE:AE4F		     jmp     short SpliceScan
DOSCODE:AE51 SpliceFound:			     ; ...
DOSCODE:AE51		     cmp     byte ptr es:[di], 0
DOSCODE:AE55		     jnz     short SpliceDo
DOSCODE:AE57		     test    ss:NoSetDir, 0FFh
DOSCODE:AE5D		     jnz     short SpliceSkip
DOSCODE:AE5F SpliceDo:				     ; ...
DOSCODE:AE5F		     mov     si, di
DOSCODE:AE61		     push    es
DOSCODE:AE62		     pop     ds
DOSCODE:AE63		     pop     di
DOSCODE:AE64		     call    TextFromDrive1
DOSCODE:AE67		     mov     ax, ss:CURR_DIR_END
DOSCODE:AE6B		     or	     ax, ax
DOSCODE:AE6D		     js	     short NoPoke
DOSCODE:AE6F		     add     ax, di
DOSCODE:AE71		     sub     ax, si
DOSCODE:AE73		     mov     ss:CURR_DIR_END, ax
DOSCODE:AE77 NoPoke:				     ; ...
DOSCODE:AE77		     cmp     byte ptr [si], 0
DOSCODE:AE7A		     jnz     short SpliceCopy
DOSCODE:AE7C		     mov     al, '\'
DOSCODE:AE7E		     stosb
DOSCODE:AE7F SpliceCopy:			     ; ...
DOSCODE:AE7F		     call    FStrCpy
DOSCODE:AE82		     add     sp, 4
DOSCODE:AE85		     or	     cl, 1
DOSCODE:AE88		     jmp     short DoSet
DOSCODE:AE8A SpliceDone:			     ; ...
DOSCODE:AE8A		     pop     word ptr ss:THISCDS+2
DOSCODE:AE8F		     pop     word ptr ss:THISCDS
DOSCODE:AE94 AllDone:				     ; ...
DOSCODE:AE94		     xor     cx, cx
DOSCODE:AE96 DoSet:				     ; ...
DOSCODE:AE96		     lds     si, ss:THISCDS
DOSCODE:AE9B		     les     di, [si+45h]
DOSCODE:AE9E		     mov     word ptr ss:THISDPB, di
DOSCODE:AEA3		     mov     word ptr ss:THISDPB+2, es
DOSCODE:AEA8 Splice_retn:			     ; ...
DOSCODE:AEA8		     retn
DOSCODE:AEA8 Splice	     endp
DOSCODE:AEA9 ; =============== S U B R O U T I N E =======================================
DOSCODE:AEA9 $NameTrans	     proc far		     ; ...
DOSCODE:AEA9		     push    ds
DOSCODE:AEAA		     push    si
DOSCODE:AEAB		     push    es
DOSCODE:AEAC		     push    di
DOSCODE:AEAD		     push    cx
DOSCODE:AEAE		     mov     ch, 16h	     ; attr_hidden+attr_system+attr_directory
DOSCODE:AEB0		     call    SetAttrib
DOSCODE:AEB3		     mov     di, offset	OPENBUF
DOSCODE:AEB6		     call    TransPath
DOSCODE:AEB9		     pop     cx
DOSCODE:AEBA		     pop     di
DOSCODE:AEBB		     pop     es
DOSCODE:AEBC		     pop     si
DOSCODE:AEBD		     pop     ds
DOSCODE:AEBE		     jnb     short TransOK
DOSCODE:AEC0		     jmp     SYS_RET_ERR
DOSCODE:AEC3 TransOK:				     ; ...
DOSCODE:AEC3		     mov     si, offset	OPENBUF
DOSCODE:AEC6		     push    ss
DOSCODE:AEC7		     pop     ds
DOSCODE:AEC8		     call    FStrCpy
DOSCODE:AECB		     jmp     SYS_RET_OK
DOSCODE:AECB $NameTrans	     endp
DOSCODE:AECE ; =============== S U B R O U T I N E =======================================
DOSCODE:AECE DriveFromText   proc near		     ; ...
DOSCODE:AECE		     xor     al, al
DOSCODE:AED0		     cmp     byte ptr [si], 0
DOSCODE:AED3		     jz	     short Splice_retn
DOSCODE:AED5		     cmp     byte ptr [si+1], ':'
DOSCODE:AED9		     jnz     short Splice_retn
DOSCODE:AEDB		     lodsw
DOSCODE:AEDC		     or	     al, 20h
DOSCODE:AEDE		     sub     al, 60h
DOSCODE:AEE0		     jnz     short Splice_retn
DOSCODE:AEE2		     mov     al, 0FFh
DOSCODE:AEE4		     retn
DOSCODE:AEE4 DriveFromText   endp
DOSCODE:AEE5 ; =============== S U B R O U T I N E =======================================
DOSCODE:AEE5 TextFromDrive   proc near		     ; ...
DOSCODE:AEE5		     inc     al
DOSCODE:AEE7 TextFromDrive1:			     ; ...
DOSCODE:AEE7		     add     al, 40h ; '@'   ; 'A'-1
DOSCODE:AEE9		     mov     ah, ':'
DOSCODE:AEEB		     stosw
DOSCODE:AEEC PathPref_retn:			     ; ...
DOSCODE:AEEC		     retn
DOSCODE:AEEC TextFromDrive   endp
DOSCODE:AEED ; =============== S U B R O U T I N E =======================================
DOSCODE:AEED PathPref	     proc near		     ; ...
DOSCODE:AEED		     call    DStrLen
DOSCODE:AEF0		     dec     cx
DOSCODE:AEF1		     repe cmpsb
DOSCODE:AEF3		     jnz     short PathPref_retn
DOSCODE:AEF5		     push    ax
DOSCODE:AEF6		     mov     al, [si-1]
DOSCODE:AEF9		     call    PATHCHRCMP
DOSCODE:AEFC		     jz	     short Prefix
DOSCODE:AEFE		     mov     al, es:[di]
DOSCODE:AF01		     call    PathSepGotCh
DOSCODE:AF04 Prefix:				     ; ...
DOSCODE:AF04		     pop     ax
DOSCODE:AF05		     retn
DOSCODE:AF05 PathPref	     endp
DOSCODE:AF06 ; =============== S U B R O U T I N E =======================================
DOSCODE:AF06 ScanPathChar    proc near		     ; ...
DOSCODE:AF06		     lodsb
DOSCODE:AF07		     call    PathSepGotCh
DOSCODE:AF0A		     jnz     short ScanPathChar
DOSCODE:AF0C		     call    PATHCHRCMP
DOSCODE:AF0F		     retn
DOSCODE:AF0F ScanPathChar    endp
DOSCODE:AF10 ; =============== S U B R O U T I N E =======================================
DOSCODE:AF10 $OPEN	     proc near		     ; ...
DOSCODE:AF10		     xor     ah, ah
DOSCODE:AF12 $Open2:				     ; ...
DOSCODE:AF12		     mov     ch, 16h	     ; attr_hidden+attr_system+attr_directory
DOSCODE:AF14		     call    SetAttrib
DOSCODE:AF17		     mov     cx, offset	DOS_OPEN
DOSCODE:AF1A		     push    ax
DOSCODE:AF1B AccessFile:			     ; ...
DOSCODE:AF1B		     call    ECritDisk	     ; ECritSFT
DOSCODE:AF1E		     call    SFNFree
DOSCODE:AF21		     call    LCritDisk	     ; LCritSFT
DOSCODE:AF24		     jb	     short OpenFailJ
DOSCODE:AF26		     mov     ss:SFN, bx
DOSCODE:AF2B		     mov     word ptr ss:THISSFT, di
DOSCODE:AF30		     mov     word ptr ss:THISSFT+2, es
DOSCODE:AF35		     call    JFNFree
DOSCODE:AF38		     jnb     short SaveJFN
DOSCODE:AF3A OpenFailJ:				     ; ...
DOSCODE:AF3A		     jmp     OpenFail
DOSCODE:AF3D SaveJFN:				     ; ...
DOSCODE:AF3D		     mov     word ptr ss:PJFN, di
DOSCODE:AF42		     mov     word ptr ss:PJFN+2, es
DOSCODE:AF47		     mov     ss:JFN, bx
DOSCODE:AF4C		     mov     bx, ss:SFN
DOSCODE:AF51		     mov     es:[di], bl
DOSCODE:AF54		     mov     si, dx
DOSCODE:AF56		     mov     di, offset	OPENBUF
DOSCODE:AF59		     push    cx
DOSCODE:AF5A		     call    TransPath
DOSCODE:AF5D		     pop     bx
DOSCODE:AF5E		     lds     si, ss:THISSFT
DOSCODE:AF63		     jb	     short OpenCleanJ
DOSCODE:AF65		     cmp     ss:CMETA, 0FFh
DOSCODE:AF6B		     jz	     short SetSearch
DOSCODE:AF6D		     mov     al, 2
DOSCODE:AF6F OpenCleanJ:			     ; ...
DOSCODE:AF6F		     jmp     short OpenClean
DOSCODE:AF71 SetSearch:				     ; ...
DOSCODE:AF71		     pop     ax
DOSCODE:AF72		     xor     cx, cx
DOSCODE:AF74		     mov     [si+2], cx
DOSCODE:AF77		     mov     [si+51], cx
DOSCODE:AF7A		     cmp     bx, offset	DOS_OPEN
DOSCODE:AF7E		     jnz     short _DoOper
DOSCODE:AF80		     test    al, 80h
DOSCODE:AF82		     jz	     short _DoOper
DOSCODE:AF84		     and     al, 7Fh
DOSCODE:AF86		     mov     cx, 1000h
DOSCODE:AF89 _DoOper:				     ; ...
DOSCODE:AF89		     push    di
DOSCODE:AF8A		     push    es
DOSCODE:AF8B		     push    ds
DOSCODE:AF8C		     pop     es
DOSCODE:AF8D		     push    si
DOSCODE:AF8E		     pop     di
DOSCODE:AF8F		     call    Set_EXT_mode
DOSCODE:AF92		     pop     es
DOSCODE:AF93		     pop     di
DOSCODE:AF94		     push    ss
DOSCODE:AF95		     pop     ds
DOSCODE:AF96		     push    cx
DOSCODE:AF97		     call    bx
DOSCODE:AF99		     pop     cx
DOSCODE:AF9A		     lds     si, ds:THISSFT
DOSCODE:AF9E		     jb	     short OpenE2
DOSCODE:AFA0 OpenOK:
DOSCODE:AFA0		     mov     word ptr [si], 1
DOSCODE:AFA4		     or	     [si+5], cx
DOSCODE:AFA7		     mov     ax, ss:JFN
DOSCODE:AFAB		     call    ss:ShCol
DOSCODE:AFB0		     mov     ss:SFN, 0FFFFh
DOSCODE:AFB7 OpenOKJ:				     ; ...
DOSCODE:AFB7		     jmp     SYS_RET_OK
DOSCODE:AFBA OpenE2:				     ; ...
DOSCODE:AFBA		     cmp     ax, 57h
DOSCODE:AFBD		     jnz     short OpenE
DOSCODE:AFBF		     jmp     short OpenCritLeave
DOSCODE:AFC1 OpenClean:				     ; ...
DOSCODE:AFC1		     pop     bx
DOSCODE:AFC2 OpenE:				     ; ...
DOSCODE:AFC2		     mov     word ptr [si], 0
DOSCODE:AFC6		     lds     si, ss:PJFN
DOSCODE:AFCB		     mov     byte ptr [si], 0FFh
DOSCODE:AFCE		     jmp     short OpenCritLeave
DOSCODE:AFD0 OpenFail:				     ; ...
DOSCODE:AFD0		     sti
DOSCODE:AFD1		     pop     cx
DOSCODE:AFD2 OpenCritLeave:			     ; ...
DOSCODE:AFD2		     mov     ss:SFN, 0FFFFh
DOSCODE:AFD9		     cmp     ss:EXTERR,	25h
DOSCODE:AFDF		     jnz     short NORERR
DOSCODE:AFE1		     jmp     From_GetSet
DOSCODE:AFE4 NORERR:				     ; ...
DOSCODE:AFE4		     jmp     SYS_RET_ERR
DOSCODE:AFE4 $OPEN	     endp
DOSCODE:AFE7 ; =============== S U B R O U T I N E =======================================
DOSCODE:AFE7 $CREAT	     proc near		     ; ...
DOSCODE:AFE7		     push    cx
DOSCODE:AFE8		     mov     cx, offset	DOS_CREATE
DOSCODE:AFE8 $CREAT	     endp
DOSCODE:AFEB ; START OF	FUNCTION CHUNK FOR $CreateNewFile
DOSCODE:AFEB AccessSet:				     ; ...
DOSCODE:AFEB		     mov     ss:SATTRIB, 6   ; attr_hidden+attr_system
DOSCODE:AFF1		     jmp     AccessFile
DOSCODE:AFF1 ; END OF FUNCTION CHUNK FOR $CreateNewFile
DOSCODE:AFF4 $CHMOD:				     ; ...
DOSCODE:AFF4		     mov     di, offset	OPENBUF
DOSCODE:AFF7		     push    ax
DOSCODE:AFF8		     push    cx
DOSCODE:AFF9		     mov     si, dx
DOSCODE:AFFB		     call    TransPathSet
DOSCODE:AFFE		     pop     cx
DOSCODE:AFFF		     pop     ax
DOSCODE:B000		     jb	     short ChModErr
DOSCODE:B002		     push    ss
DOSCODE:B003		     pop     ds
DOSCODE:B004		     cmp     ds:CMETA, 0FFh
DOSCODE:B009		     jnz     short ChModErr
DOSCODE:B00B		     mov     ds:SATTRIB, 16h
DOSCODE:B010		     sub     al, 1
DOSCODE:B012		     jb	     short ChModGet
DOSCODE:B014		     jz	     short ChModSet
DOSCODE:B016		     mov     ds:EXTERR_LOCUS, 1
DOSCODE:B01B		     mov     al, 1
DOSCODE:B01D ; START OF	FUNCTION CHUNK FOR $UNLINK
DOSCODE:B01D ChModErrj:				     ; ...
DOSCODE:B01D		     jmp     short NORERR
DOSCODE:B01D ; END OF FUNCTION CHUNK FOR $UNLINK
DOSCODE:B01F ChModGet:				     ; ...
DOSCODE:B01F		     call    GET_FILE_INFO
DOSCODE:B022		     jb	     short ChModE
DOSCODE:B024		     call    Get_User_Stack
DOSCODE:B027		     mov     [si+4], ax
DOSCODE:B02A ; START OF	FUNCTION CHUNK FOR $UNLINK
DOSCODE:B02A ChModOKj:				     ; ...
DOSCODE:B02A		     jmp     short OpenOKJ
DOSCODE:B02A ; END OF FUNCTION CHUNK FOR $UNLINK
DOSCODE:B02C ChModSet:				     ; ...
DOSCODE:B02C		     mov     ax, cx
DOSCODE:B02E		     call    SET_FILE_ATTRIBUTE
DOSCODE:B031		     jb	     short ChModE
DOSCODE:B033 ; START OF	FUNCTION CHUNK FOR $UNLINK
DOSCODE:B033 ChModOK:				     ; ...
DOSCODE:B033		     jmp     short ChModOKj
DOSCODE:B035 ChModErr:				     ; ...
DOSCODE:B035		     mov     al, 3
DOSCODE:B037 ChModE:				     ; ...
DOSCODE:B037		     jmp     short ChModErrj
DOSCODE:B037 ; END OF FUNCTION CHUNK FOR $UNLINK
DOSCODE:B039 ; =============== S U B R O U T I N E =======================================
DOSCODE:B039 $UNLINK	     proc near		     ; ...
DOSCODE:B039 ; FUNCTION	CHUNK AT DOSCODE:B01D SIZE 00000002 BYTES
DOSCODE:B039 ; FUNCTION	CHUNK AT DOSCODE:B02A SIZE 00000002 BYTES
DOSCODE:B039 ; FUNCTION	CHUNK AT DOSCODE:B033 SIZE 00000006 BYTES
DOSCODE:B039		     push    cx
DOSCODE:B03A		     mov     si, dx
DOSCODE:B03C		     mov     di, offset	OPENBUF
DOSCODE:B03F		     call    TransPathSet
DOSCODE:B042		     pop     cx
DOSCODE:B043		     jb	     short ChModErr
DOSCODE:B045		     cmp     ss:CMETA, 0FFh  ; -1
DOSCODE:B04B		     jnz     short NotFound
DOSCODE:B04D		     push    ss
DOSCODE:B04E		     pop     ds
DOSCODE:B04F		     mov     ch, 6
DOSCODE:B051		     call    SetAttrib
DOSCODE:B054		     call    DOS_DELETE
DOSCODE:B057		     jb	     short UnlinkE
DOSCODE:B059 UnLinkOK:				     ; ...
DOSCODE:B059		     jmp     short ChModOK
DOSCODE:B05B NotFound:				     ; ...
DOSCODE:B05B		     mov     al, 3
DOSCODE:B05D UnlinkE:				     ; ...
DOSCODE:B05D		     jmp     short ChModE
DOSCODE:B05D $UNLINK	     endp
DOSCODE:B05F $RENAME:				     ; ...
DOSCODE:B05F		     push    cx
DOSCODE:B060		     push    ds
DOSCODE:B061		     push    dx
DOSCODE:B062		     push    es
DOSCODE:B063		     pop     ds
DOSCODE:B064		     mov     si, di
DOSCODE:B066		     mov     di, offset	RENBUF
DOSCODE:B069		     call    TransPathSet
DOSCODE:B06C		     push    ss:WFP_START
DOSCODE:B071		     pop     ss:REN_WFP
DOSCODE:B076		     pop     si
DOSCODE:B077		     pop     ds
DOSCODE:B078		     pop     cx
DOSCODE:B079 epjc2:				     ; ...
DOSCODE:B079		     jb	     short ChModErr
DOSCODE:B07B		     cmp     ss:CMETA, 0FFh
DOSCODE:B081		     jnz     short NotFound
DOSCODE:B083		     push    cx
DOSCODE:B084		     mov     di, offset	OPENBUF
DOSCODE:B087		     call    TransPathSet
DOSCODE:B08A		     pop     cx
DOSCODE:B08B		     jb	     short epjc2
DOSCODE:B08D		     push    ss
DOSCODE:B08E		     pop     ds
DOSCODE:B08F		     cmp     ds:CMETA, 0FFh
DOSCODE:B094		     jb	     short NotFound
DOSCODE:B096		     push    word ptr ds:THISCDS
DOSCODE:B09A		     push    word ptr ds:THISCDS+2
DOSCODE:B09E		     mov     di, offset	OPENBUF
DOSCODE:B0A1		     push    ss
DOSCODE:B0A2		     pop     es
DOSCODE:B0A3		     xor     al, al
DOSCODE:B0A5 rnloop:				     ; ...
DOSCODE:B0A5		     call    GetCDSFromDrv
DOSCODE:B0A8		     jb	     short dorn
DOSCODE:B0AA		     call    StrCmp
DOSCODE:B0AD		     jz	     short rnerr
DOSCODE:B0AF		     inc     al
DOSCODE:B0B1		     jmp     short rnloop
DOSCODE:B0B3 rnerr:				     ; ...
DOSCODE:B0B3		     add     sp, 4
DOSCODE:B0B6		     mov     al, 10h
DOSCODE:B0B8		     jmp     short UnlinkE
DOSCODE:B0BA dorn:				     ; ...
DOSCODE:B0BA		     pop     word ptr ss:THISCDS+2
DOSCODE:B0BF		     pop     word ptr ss:THISCDS
DOSCODE:B0C4		     push    ss
DOSCODE:B0C5		     pop     ds
DOSCODE:B0C6		     mov     ch, 16h	     ; attr_directory+attr_hidden+attr_system
DOSCODE:B0C8		     call    SetAttrib
DOSCODE:B0CB		     call    DOS_RENAME
DOSCODE:B0CE		     jb	     short UnlinkE
DOSCODE:B0D0		     jmp     short UnLinkOK
DOSCODE:B0D2 ; =============== S U B R O U T I N E =======================================
DOSCODE:B0D2 $CreateNewFile  proc near		     ; ...
DOSCODE:B0D2 ; FUNCTION	CHUNK AT DOSCODE:AFEB SIZE 00000009 BYTES
DOSCODE:B0D2		     push    cx
DOSCODE:B0D3		     mov     cx, offset	DOS_Create_New
DOSCODE:B0D6		     jmp     AccessSet
DOSCODE:B0D6 $CreateNewFile  endp
DOSCODE:B0D9 ; =============== S U B R O U T I N E =======================================
DOSCODE:B0D9 BinToAscii	     proc near		     ; ...
DOSCODE:B0D9		     mov     cx, 404h
DOSCODE:B0DC bta5:				     ; ...
DOSCODE:B0DC		     rol     ax, cl
DOSCODE:B0DE		     push    ax
DOSCODE:B0DF		     and     al, 0Fh
DOSCODE:B0E1		     add     al, 'A'
DOSCODE:B0E3		     stosb
DOSCODE:B0E4		     pop     ax
DOSCODE:B0E5		     dec     ch
DOSCODE:B0E7		     jnz     short bta5
DOSCODE:B0E9		     retn
DOSCODE:B0E9 BinToAscii	     endp
DOSCODE:B0EA $CreateTempFile:			     ; ...
DOSCODE:B0EA		     push    bp
DOSCODE:B0EB		     mov     bp, sp
DOSCODE:B0ED		     sub     sp, 10
DOSCODE:B0F0		     test    cx, 0FFD8h	     ; ~attr_changeable
DOSCODE:B0F4		     jz	     short OKatts
DOSCODE:B0F6		     mov     ax, 5
DOSCODE:B0F9		     jmp     short SETTMPERR
DOSCODE:B0FB OKatts:				     ; ...
DOSCODE:B0FB		     mov     [bp-10], cx
DOSCODE:B0FE		     mov     [bp-8], dx
DOSCODE:B101		     mov     word ptr [bp-6], ds
DOSCODE:B104		     mov     word ptr [bp-2], ds
DOSCODE:B107		     push    ds
DOSCODE:B108		     pop     es
DOSCODE:B109		     mov     di, dx
DOSCODE:B10B		     mov     cx, di
DOSCODE:B10D		     neg     cx
DOSCODE:B10F		     or	     cx, cx
DOSCODE:B111		     jnz     short okok
DOSCODE:B113		     mov     cx, 0FFFFh
DOSCODE:B116 okok:				     ; ...
DOSCODE:B116		     xor     ax, ax
DOSCODE:B118		     repne scasb
DOSCODE:B11A		     dec     di
DOSCODE:B11B		     mov     al, es:[di-1]
DOSCODE:B11F		     call    PATHCHRCMP
DOSCODE:B122		     jz	     short SETENDPTR
DOSCODE:B124		     mov     al, '\'
DOSCODE:B126		     stosb
DOSCODE:B127 SETENDPTR:				     ; ...
DOSCODE:B127		     mov     [bp-4], di
DOSCODE:B12A CreateLoop:			     ; ...
DOSCODE:B12A		     push    ss
DOSCODE:B12B		     pop     ds
DOSCODE:B12C		     push    bp
DOSCODE:B12D		     call    READTIME
DOSCODE:B130		     pop     bp
DOSCODE:B131		     les     di, [bp-4]
DOSCODE:B134		     mov     ax, cx
DOSCODE:B136		     call    BinToAscii
DOSCODE:B139		     mov     ax, dx
DOSCODE:B13B		     call    BinToAscii
DOSCODE:B13E		     xor     al, al
DOSCODE:B140		     stosb
DOSCODE:B141		     lds     dx, [bp-8]
DOSCODE:B144		     mov     cx, [bp-10]
DOSCODE:B147		     push    bp
DOSCODE:B148		     call    $CreateNewFile
DOSCODE:B14B		     pop     bp
DOSCODE:B14C		     jnb     short CreateDone
DOSCODE:B14E		     cmp     al, 50h
DOSCODE:B150		     jz	     short CreateLoop
DOSCODE:B152		     cmp     al, 5
DOSCODE:B154		     jnz     short SETTMPERR
DOSCODE:B156		     cmp     ss:EXTERR,	41h
DOSCODE:B15C		     jz	     short SETTMPERR
DOSCODE:B15E		     cmp     ss:EXTERR,	53h
DOSCODE:B164		     jz	     short SETTMPERR
DOSCODE:B166		     jmp     short CreateLoop
DOSCODE:B168 SETTMPERR:				     ; ...
DOSCODE:B168		     stc
DOSCODE:B169 CreateDone:			     ; ...
DOSCODE:B169		     mov     sp, bp
DOSCODE:B16B		     pop     bp
DOSCODE:B16C		     jb	     short CreateFail
DOSCODE:B16E		     jmp     SYS_RET_OK
DOSCODE:B171 ; START OF	FUNCTION CHUNK FOR $Extended_Open
DOSCODE:B171 CreateFail:			     ; ...
DOSCODE:B171		     jmp     SYS_RET_ERR
DOSCODE:B171 ; END OF FUNCTION CHUNK FOR $Extended_Open
DOSCODE:B174 ; =============== S U B R O U T I N E =======================================
DOSCODE:B174 SetAttrib	     proc near		     ; ...
DOSCODE:B174		     test    ss:FSHARING, 0FFh
DOSCODE:B17A		     jnz     short Set
DOSCODE:B17C		     mov     cl, ch
DOSCODE:B17E Set:				     ; ...
DOSCODE:B17E		     mov     ss:SATTRIB, cl
DOSCODE:B183		     retn
DOSCODE:B183 SetAttrib	     endp
DOSCODE:B184 ; =============== S U B R O U T I N E =======================================
DOSCODE:B184 $Extended_Open  proc near		     ; ...
DOSCODE:B184 ; FUNCTION	CHUNK AT DOSCODE:B171 SIZE 00000003 BYTES
DOSCODE:B184		     mov     ss:EXTOPEN_FLAG, dx
DOSCODE:B189		     mov     ss:EXTOPEN_IO_MODE, 0
DOSCODE:B190		     test    dx, 0FE00h	     ; RESERVED_BITS_MASK
DOSCODE:B194		     jnz     short ext_inval2
DOSCODE:B196		     mov     ah, dl
DOSCODE:B198		     cmp     dl, 0
DOSCODE:B19B		     jz	     short ext_inval2
DOSCODE:B19D		     and     dl, 0Fh
DOSCODE:B1A0		     cmp     dl, 2
DOSCODE:B1A3		     ja	     short ext_inval2
DOSCODE:B1A5		     and     ah, 0F0h
DOSCODE:B1A8		     cmp     ah, 10h
DOSCODE:B1AB		     ja	     short ext_inval2
DOSCODE:B1AD		     mov     ss:SAVE_ES, es
DOSCODE:B1B2		     mov     ss:SAVE_DI, di
DOSCODE:B1B7		     push    ss:EXTOPEN_FLAG
DOSCODE:B1BC		     pop     ss:SAVE_DX
DOSCODE:B1C1		     mov     ss:SAVE_CX, cx
DOSCODE:B1C6		     mov     ss:SAVE_BX, bx
DOSCODE:B1CB		     mov     ss:SAVE_DS, ds
DOSCODE:B1D0		     mov     ss:SAVE_SI, si
DOSCODE:B1D5		     mov     dx, si
DOSCODE:B1D7		     mov     ax, bx
DOSCODE:B1D9		     jmp     short goopen2
DOSCODE:B1DB ext_inval2:			     ; ...
DOSCODE:B1DB		     mov     al, 1
DOSCODE:B1DD jmp_to_CreateFail:			     ; ...
DOSCODE:B1DD		     jmp     short CreateFail
DOSCODE:B1DF ext_inval_parm:
DOSCODE:B1DF		     pop     cx
DOSCODE:B1E0		     pop     si
DOSCODE:B1E1		     mov     al, 13
DOSCODE:B1E3		     jmp     short jmp_to_CreateFail
DOSCODE:B1E5 error_return:			     ; ...
DOSCODE:B1E5		     retn
DOSCODE:B1E6 goopen2:				     ; ...
DOSCODE:B1E6		     test    bx, 2000h
DOSCODE:B1EA		     jz	     short goopen
DOSCODE:B1EC		     or	     ss:EXTOPEN_ON, 2
DOSCODE:B1F2 goopen:				     ; ...
DOSCODE:B1F2		     or	     ss:EXTOPEN_ON, 1
DOSCODE:B1F8		     and     ss:EXTOPEN_FLAG, 0FFh
DOSCODE:B1FF		     cmp     ss:EXTOPEN_FLAG, 10h
DOSCODE:B205		     jnz     short chknext
DOSCODE:B207		     call    $CreateNewFile
DOSCODE:B20A		     jb	     short error_return
DOSCODE:B20C		     cmp     ss:EXTOPEN_ON, 0
DOSCODE:B212		     jz	     short ok_return2
DOSCODE:B214		     mov     ss:EXTOPEN_FLAG, 2
DOSCODE:B21B		     jmp     setXAttr
DOSCODE:B21E ok_return2:			     ; ...
DOSCODE:B21E		     jmp     SYS_RET_OK
DOSCODE:B221 chknext:				     ; ...
DOSCODE:B221		     test    ss:EXTOPEN_FLAG, 1
DOSCODE:B228		     jnz     short exist_open
DOSCODE:B22A		     call    $CREAT
DOSCODE:B22D		     jb	     short error_return
DOSCODE:B22F		     cmp     ss:EXTOPEN_ON, 0
DOSCODE:B235		     jz	     short ok_return2
DOSCODE:B237		     mov     ss:EXTOPEN_FLAG, 2
DOSCODE:B23E		     test    ss:EXTOPEN_ON, 4
DOSCODE:B244		     jnz     short setXAttr
DOSCODE:B246		     mov     ss:EXTOPEN_FLAG, 3
DOSCODE:B24D		     jmp     short setXAttr
DOSCODE:B24F error_return2:			     ; ...
DOSCODE:B24F		     stc
DOSCODE:B250		     retn
DOSCODE:B251 exist_open:			     ; ...
DOSCODE:B251		     test    ss:FSHARING, 0FFh
DOSCODE:B257		     jz	     short noserver
DOSCODE:B259		     mov     cl, ch
DOSCODE:B25B noserver:				     ; ...
DOSCODE:B25B		     call    $Open2
DOSCODE:B25E		     jnb     short ext_ok
DOSCODE:B260		     cmp     ss:EXTOPEN_ON, 0
DOSCODE:B266		     jz	     short error_return2
DOSCODE:B268		     cmp     ax, 2
DOSCODE:B26B		     jnz     short error_return2
DOSCODE:B26D		     test    ss:EXTOPEN_FLAG, 10h
DOSCODE:B274		     jnz     short do_creat
DOSCODE:B276		     jmp     short extexit
DOSCODE:B278 do_creat:				     ; ...
DOSCODE:B278		     mov     cx, ss:SAVE_CX
DOSCODE:B27D		     lds     si, dword ptr ss:SAVE_SI
DOSCODE:B282		     mov     dx, si
DOSCODE:B284		     call    $CREAT
DOSCODE:B287		     jb	     short extexit
DOSCODE:B289		     mov     ss:EXTOPEN_FLAG, 2
DOSCODE:B290		     jmp     short setXAttr
DOSCODE:B292 ext_ok:				     ; ...
DOSCODE:B292		     cmp     ss:EXTOPEN_ON, 0
DOSCODE:B298		     jz	     short ok_return
DOSCODE:B29A		     mov     ss:EXTOPEN_FLAG, 1
DOSCODE:B2A1 setXAttr:				     ; ...
DOSCODE:B2A1		     push    ax
DOSCODE:B2A2		     call    Get_User_Stack
DOSCODE:B2A5		     mov     ax, ss:EXTOPEN_FLAG
DOSCODE:B2A9		     mov     [si+4], ax
DOSCODE:B2AC		     pop     ax
DOSCODE:B2AD		     mov     [si], ax
DOSCODE:B2AF ok_return:				     ; ...
DOSCODE:B2AF		     jmp     SYS_RET_OK
DOSCODE:B2B2 extexit2:
DOSCODE:B2B2		     pop     bx
DOSCODE:B2B3		     push    ax
DOSCODE:B2B4		     cmp     ss:EXTOPEN_FLAG, 2
DOSCODE:B2BA		     jnz     short justopen
DOSCODE:B2BC		     lds     si, dword ptr ss:SAVE_SI
DOSCODE:B2C1		     lds     dx, [si]
DOSCODE:B2C3		     call    $UNLINK
DOSCODE:B2C6		     jmp     short reserror
DOSCODE:B2C8 justopen:				     ; ...
DOSCODE:B2C8		     call    $CLOSE
DOSCODE:B2CB reserror:				     ; ...
DOSCODE:B2CB		     pop     ax
DOSCODE:B2CC		     jmp     short extexit
DOSCODE:B2CE		     mov     ax, 2
DOSCODE:B2D1		     jmp     short extexit
DOSCODE:B2D3		     mov     ax, 1
DOSCODE:B2D6 extexit:				     ; ...
DOSCODE:B2D6		     jmp     SYS_RET_ERR
DOSCODE:B2D6 $Extended_Open  endp
DOSCODE:B2D9 $LockOper:				     ; ...
DOSCODE:B2D9		     cmp     al, 1
DOSCODE:B2DB		     ja	     short lock_bad_func
DOSCODE:B2DD		     push    di
DOSCODE:B2DE		     call    SFFromHandle
DOSCODE:B2E1		     jnb     short lock_do
DOSCODE:B2E3		     pop     di
DOSCODE:B2E4		     mov     al, 6
DOSCODE:B2E6 LockOperErrj:			     ; ...
DOSCODE:B2E6		     jmp     SYS_RET_ERR
DOSCODE:B2E9 lock_bad_func:			     ; ...
DOSCODE:B2E9		     mov     ss:EXTERR_LOCUS, 1
DOSCODE:B2EF		     mov     al, 1
DOSCODE:B2F1 LockOperErr:			     ; ...
DOSCODE:B2F1		     jmp     short LockOperErrj
DOSCODE:B2F3 lock_do:				     ; ...
DOSCODE:B2F3		     mov     bx, ax
DOSCODE:B2F5		     mov     bp, offset	Lock_Buffer
DOSCODE:B2F8		     mov     [bp+0], dx
DOSCODE:B2FB		     mov     [bp+2], cx
DOSCODE:B2FE		     pop     cx
DOSCODE:B2FF		     mov     [bp+4], cx
DOSCODE:B302		     mov     [bp+6], si
DOSCODE:B305		     mov     cx, 1
DOSCODE:B308		     push    ss
DOSCODE:B309		     pop     ds
DOSCODE:B30A		     mov     dx, bp
DOSCODE:B30C		     test    al, 1
DOSCODE:B30E		     jnz     short DOS_Unlock
DOSCODE:B310		     jmp     short DOS_Lock
DOSCODE:B312 DOS_Unlock:			     ; ...
DOSCODE:B312		     test    byte ptr es:[di+6], 80h
DOSCODE:B317		     jz	     short LOCAL_UNLOCK
DOSCODE:B319		     mov     ax, 110Ah
DOSCODE:B31C		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	LOCK REGION OF FILE
DOSCODE:B31C					     ; BX = file handle, CX:DX = starting offset, SI = high word of size
DOSCODE:B31C					     ; STACK: WORD low word of size, ES:DI -> SFT
DOSCODE:B31C					     ; SFT DPB field ->	DPB of drive containing	file, SS = DOS CS
DOSCODE:B31C					     ; Return: CF set error
DOSCODE:B31E		     jmp     short ValChk
DOSCODE:B320 LOCAL_UNLOCK:			     ; ...
DOSCODE:B320		     call    ds:clr_block
DOSCODE:B324 ValChk:				     ; ...
DOSCODE:B324		     jnb     short Lock_OK
DOSCODE:B326		     jmp     short LockOperErr
DOSCODE:B328 Lock_OK:				     ; ...
DOSCODE:B328		     mov     ax, ds:TEMP_VAR
DOSCODE:B32B		     jmp     SYS_RET_OK
DOSCODE:B32E DOS_Lock:				     ; ...
DOSCODE:B32E		     test    byte ptr es:[di+6], 80h
DOSCODE:B333		     jz	     short LOCAL_LOCK
DOSCODE:B335		     mov     ax, 110Ah
DOSCODE:B338		     int     2Fh	     ; Multiplex - NETWORK REDIRECTOR -	LOCK REGION OF FILE
DOSCODE:B338					     ; BX = file handle, CX:DX = starting offset, SI = high word of size
DOSCODE:B338					     ; STACK: WORD low word of size, ES:DI -> SFT
DOSCODE:B338					     ; SFT DPB field ->	DPB of drive containing	file, SS = DOS CS
DOSCODE:B338					     ; Return: CF set error
DOSCODE:B33A		     jmp     short ValChk
DOSCODE:B33C LOCAL_LOCK:			     ; ...
DOSCODE:B33C		     call    ds:set_block
DOSCODE:B340		     jmp     short ValChk
DOSCODE:B342 ; =============== S U B R O U T I N E =======================================
DOSCODE:B342 LOCK_CHECK	     proc near		     ; ...
DOSCODE:B342		     mov     bx, ds:RetryCount
DOSCODE:B346 LockRetry:				     ; ...
DOSCODE:B346		     push    bx
DOSCODE:B347		     push    ax
DOSCODE:B348		     call    ds:chk_block
DOSCODE:B34C		     pop     ax
DOSCODE:B34D		     pop     bx
DOSCODE:B34E		     jnb     short lc_ret_label
DOSCODE:B350		     call    Idle
DOSCODE:B353		     dec     bx
DOSCODE:B354		     jnz     short LockRetry
DOSCODE:B356		     stc
DOSCODE:B357 lc_ret_label:			     ; ...
DOSCODE:B357		     retn
DOSCODE:B357 LOCK_CHECK	     endp
DOSCODE:B358 ; =============== S U B R O U T I N E =======================================
DOSCODE:B358 LOCK_VIOLATION  proc near		     ; ...
DOSCODE:B358		     push    ds
DOSCODE:B359		     push    es
DOSCODE:B35A		     push    di
DOSCODE:B35B		     push    cx
DOSCODE:B35C		     mov     ax, 21h	     ; error_lock_violation
DOSCODE:B35F		     mov     ds:ALLOWED, 18h ; Allowed_FAIL+Allowed_RETRY
DOSCODE:B364		     les     bp, ds:THISDPB
DOSCODE:B368		     mov     di, 1
DOSCODE:B36B		     mov     cx, di
DOSCODE:B36D		     mov     dx, es:[bp+0Bh] ; [ES:BP+DPB.FIRST_SECTOR]
DOSCODE:B371		     call    HARDERR
DOSCODE:B374		     pop     cx
DOSCODE:B375		     pop     di
DOSCODE:B376		     pop     es
DOSCODE:B377		     pop     ds
DOSCODE:B378		     cmp     al, 1
DOSCODE:B37A		     jz	     short lc_ret_label
DOSCODE:B37C		     stc
DOSCODE:B37D		     retn
DOSCODE:B37D LOCK_VIOLATION  endp
DOSCODE:B37E ; =============== S U B R O U T I N E =======================================
DOSCODE:B37E CheckShare	     proc near		     ; ...
DOSCODE:B37E		     push    ds
DOSCODE:B37F		     mov     ds, cs:DosDSeg
DOSCODE:B384		     cmp     ds:fShare,	0
DOSCODE:B389		     pop     ds
DOSCODE:B38A		     retn
DOSCODE:B38A CheckShare	     endp
DOSCODE:B38B ; =============== S U B R O U T I N E =======================================
DOSCODE:B38B SHARE_CHECK     proc near		     ; ...
DOSCODE:B38B		     call    ds:MFT_enter
DOSCODE:B38F shchk_retn:			     ; ...
DOSCODE:B38F		     retn
DOSCODE:B38F SHARE_CHECK     endp
DOSCODE:B390 ; =============== S U B R O U T I N E =======================================
DOSCODE:B390 SHARE_VIOLATION proc near		     ; ...
DOSCODE:B390		     push    ds
DOSCODE:B391		     push    es
DOSCODE:B392		     push    di
DOSCODE:B393		     mov     ds:READOP,	0
DOSCODE:B398		     mov     ds:ALLOWED, 18h ; Allowed_FAIL+Allowed_RETRY
DOSCODE:B39D		     les     bp, ds:THISDPB
DOSCODE:B3A1		     mov     di, 1
DOSCODE:B3A4		     mov     cx, di
DOSCODE:B3A6		     mov     dx, es:[bp+17]  ; [ES:BP+DPB.DIR_SECTOR]
DOSCODE:B3AA		     call    HARDERR
DOSCODE:B3AD		     pop     di
DOSCODE:B3AE		     pop     es
DOSCODE:B3AF		     pop     ds
DOSCODE:B3B0		     cmp     al, 1
DOSCODE:B3B2		     jz	     short shchk_retn
DOSCODE:B3B4		     stc
DOSCODE:B3B5		     retn
DOSCODE:B3B5 SHARE_VIOLATION endp
DOSCODE:B3B6 ; =============== S U B R O U T I N E =======================================
DOSCODE:B3B6 ShareEnd	     proc near		     ; ...
DOSCODE:B3B6		     call    ds:MFTClose
DOSCODE:B3BA		     retn
DOSCODE:B3BA ShareEnd	     endp
DOSCODE:B3BB ; =============== S U B R O U T I N E =======================================
DOSCODE:B3BB ShareEnter	     proc near		     ; ...
DOSCODE:B3BB		     push    cx
DOSCODE:B3BC retry:				     ; ...
DOSCODE:B3BC		     mov     cx, ds:RetryCount
DOSCODE:B3C0 attempt:				     ; ...
DOSCODE:B3C0		     les     di, ds:THISSFT
DOSCODE:B3C4		     xor     ax, ax
DOSCODE:B3C6		     mov     es:[di+51], ax  ; [ES:DI+SF_ENTRY.sf_MFT]
DOSCODE:B3CA		     push    cx
DOSCODE:B3CB		     call    SHARE_CHECK
DOSCODE:B3CE		     pop     cx
DOSCODE:B3CF		     jnb     short done
DOSCODE:B3D1		     call    Idle
DOSCODE:B3D4		     loop    attempt
DOSCODE:B3D6		     call    SHARE_VIOLATION
DOSCODE:B3D9		     jnb     short retry
DOSCODE:B3DB done:				     ; ...
DOSCODE:B3DB		     pop     cx
DOSCODE:B3DC		     retn
DOSCODE:B3DC ShareEnter	     endp
DOSCODE:B3DD ; =============== S U B R O U T I N E =======================================
DOSCODE:B3DD ExecReady	     proc near		     ; ...
DOSCODE:B3DD		     mov     si, dx
DOSCODE:B3DF		     test    word ptr [si+2], 1
DOSCODE:B3E4		     jz	     short er_setver
DOSCODE:B3E6		     mov     ax, [si+8]
DOSCODE:B3E9		     add     ax, 10h
DOSCODE:B3EC		     mov     es, ax
DOSCODE:B3EE		     mov     cx, [si+0Ah]
DOSCODE:B3F1		     mov     ax, [si+0Ch]
DOSCODE:B3F4		     call    ss:FixExePatch
DOSCODE:B3F9		     call    ss:Rational386PatchPtr
DOSCODE:B3FE er_setver:				     ; ...
DOSCODE:B3FE		     test    word ptr [si+2], 2
DOSCODE:B403		     jnz     short er_chkdoshi
DOSCODE:B405		     push    ds
DOSCODE:B406		     push    si
DOSCODE:B407		     lds     si, [si+4]
DOSCODE:B40A		     call    Scan_Execname1
DOSCODE:B40D		     call    Scan_Special_Entries
DOSCODE:B410		     pop     si
DOSCODE:B411		     pop     ds
DOSCODE:B412		     mov     es, word ptr [si+8]
DOSCODE:B415		     mov     ax, ss:SPECIAL_VERSION
DOSCODE:B419		     mov     es:40h, ax	     ; [es:PDB.Version]
DOSCODE:B41D er_chkdoshi:			     ; ...
DOSCODE:B41D		     cmp     ss:DosHasHMA, 0
DOSCODE:B423		     jz	     short er_done
DOSCODE:B425		     mov     ax, [si+8]
DOSCODE:B428		     or	     ss:DOS_FLAG, 4
DOSCODE:B42E		     test    word ptr [si+2], 1
DOSCODE:B433		     jnz     short er_seta20
DOSCODE:B435		     push    ds
DOSCODE:B436		     mov     ds, ax
DOSCODE:B438		     call    IsCopyProt
DOSCODE:B43B		     pop     ds
DOSCODE:B43C er_seta20:				     ; ...
DOSCODE:B43C		     inc     ss:A20OFF_COUNT
DOSCODE:B441		     mov     ss:A20OFF_PSP, ax
DOSCODE:B445 er_done:				     ; ...
DOSCODE:B445		     xor     ax, ax
DOSCODE:B447		     retn
DOSCODE:B447 ExecReady	     endp
DOSCODE:B448 rpFind1	     db	0FAh, 0E4h, 21h, 60h, 33h, 0C0h, 0E6h, 43h, 8Bh, 16h ; ...
DOSCODE:B452 rpFind1a	     db	0B0h, 0Eh, 0E6h, 37h, 33h, 0C0h, 0E6h, 0F2h ; ...
DOSCODE:B45A rpFind2	     db	0Fh, 20h, 0C0h	     ; ...
DOSCODE:B45D rpFind3	     db	0Fh, 22h, 0C0h,	0EAh ; ...
DOSCODE:B461 rpRepl2	     db	66h, 50h, 51h, 0Fh, 20h, 0C0h ;	...
DOSCODE:B467 rpRepl3	     db	8Eh, 0D3h, 59h,	66h, 58h ; ...
DOSCODE:B46C rpFind4	     db	93h, 58h, 8Bh, 0CCh  ; ...
DOSCODE:B470 rpFind5	     db	0B8h, 0Ch, 0DEh, 0CDh, 67h, 8Bh, 0E1h, 0FFh, 0E3h ; ...
DOSCODE:B479 rpRepl4	     db	93h, 58h, 8Bh, 0CCh  ; ...
DOSCODE:B47D		     db	2Eh, 66h, 0A3h
DOSCODE:B480		     db	2 dup(0)
DOSCODE:B482		     db	2Eh, 66h, 89h, 36h
DOSCODE:B486		     db	2 dup(0)
DOSCODE:B488 rpRepl5	     db	8Bh, 0E1h	     ; ...
DOSCODE:B48A		     db	2Eh, 66h, 0A1h
DOSCODE:B48D		     db	2 dup(0)
DOSCODE:B48F		     db	2Eh, 66h, 8Bh, 36h
DOSCODE:B493		     db	2 dup(0)
DOSCODE:B495		     db	0FFh, 0E3h
DOSCODE:B497 rpFind6	     db	0FAh, 52h, 51h	     ; ...
DOSCODE:B49A rpFind7a	     db	0B8h, 0Ch, 0DEh, 66h, 26h, 0FFh, 1Eh ; ...
DOSCODE:B4A1 rpFind7b	     db	59h, 5Ah, 5Bh	     ; ...
DOSCODE:B4A4 rpRepl6	     db	0FAh, 66h, 50h,	66h, 53h, 66h, 51h, 66h, 52h ; ...
DOSCODE:B4AD rpRepl7	     db	66h, 5Ah, 66h, 59h, 66h, 5Bh, 66h, 58h,	5Bh ; ...
DOSCODE:B4B6 rpFind8	     db	60h, 6,	1Eh, 0B8h, 2 dup(0), 8Eh, 0D8h ; ...
DOSCODE:B4BE rpFind9	     db	1Fh, 7,	61h	     ; ...
DOSCODE:B4C1 rpRepl8	     db	66h, 60h, 6, 1Eh     ; ...
DOSCODE:B4C5 rpRepl9	     db	1Fh, 7,	66h, 61h, 0C3h ; ...
DOSCODE:B4CA rpBug1Strs	     dw	offset rpFind2	     ; ...
DOSCODE:B4CC		     dw	3
DOSCODE:B4CE		     dw	offset rpFind3
DOSCODE:B4D0		     dw	4
DOSCODE:B4D2		     dw	20h
DOSCODE:B4D4 rpBug2Strs	     dw	offset rpFind4	     ; ...
DOSCODE:B4D6		     dw	4
DOSCODE:B4D8		     dw	offset rpFind5
DOSCODE:B4DA		     dw	9
DOSCODE:B4DC		     dw	80h
DOSCODE:B4DE rpBug3Strs	     dw	offset rpFind6	     ; ...
DOSCODE:B4E0		     dw	3
DOSCODE:B4E2		     dw	offset rpFind7a
DOSCODE:B4E4		     dw	7
DOSCODE:B4E6		     dw	80h
DOSCODE:B4E8 rpBug4Strs	     dw	offset rpFind8	     ; ...
DOSCODE:B4EA		     dw	4
DOSCODE:B4EC		     dw	offset rpFind9
DOSCODE:B4EE		     dw	3
DOSCODE:B4F0		     dw	80h
DOSCODE:B4F2 Rational386Patch:			     ; ...
DOSCODE:B4F2		     cmp     word ptr es:0, 395
DOSCODE:B4F9		     jnb     short rp3QuickOut
DOSCODE:B4FB		     cmp     word ptr es:0Ch, 20h ; ' '
DOSCODE:B501		     jnz     short rp3QuickOut
DOSCODE:B503		     push    ax
DOSCODE:B504		     mov     ax, 18h
DOSCODE:B507		     cmp     es:18h, ax
DOSCODE:B50C		     jnz     short rp3QO_ax
DOSCODE:B50E		     cmp     es:1Ch, ax
DOSCODE:B513		     jnz     short rp3QO_ax
DOSCODE:B515		     cmp     es:24h, ax
DOSCODE:B51A		     jz	     short rp3Maybe
DOSCODE:B51C rp3QO_ax:				     ; ...
DOSCODE:B51C		     pop     ax
DOSCODE:B51D rp3QuickOut:			     ; ...
DOSCODE:B51D		     retn
DOSCODE:B51E rp3Maybe:				     ; ...
DOSCODE:B51E		     cld
DOSCODE:B51F		     push    bx
DOSCODE:B520		     push    cx
DOSCODE:B521		     push    dx
DOSCODE:B522		     push    si
DOSCODE:B523		     push    di
DOSCODE:B524		     push    es
DOSCODE:B525		     push    ds
DOSCODE:B526		     push    bp
DOSCODE:B527		     sub     sp, 6
DOSCODE:B52A		     mov     bp, sp
DOSCODE:B52C		     push    cs
DOSCODE:B52D		     pop     ds
DOSCODE:B52E		     mov     ax, es:0
DOSCODE:B532		     mov     [bp+0], ax
DOSCODE:B535		     call    VerifyVersion
DOSCODE:B538		     jnz     short rp3Exit_j
DOSCODE:B53A		     mov     cx, 4500h
DOSCODE:B53D		     mov     [bp+2], cx
DOSCODE:B540		     mov     es, word ptr es:20h
DOSCODE:B545		     mov     si, offset	rpFind1
DOSCODE:B548		     mov     dx, 10
DOSCODE:B54B		     call    ScanCodeSeq
DOSCODE:B54E		     jz	     short rpGotPatch
DOSCODE:B550		     mov     si, offset	rpFind1a
DOSCODE:B553		     mov     dx, 8
DOSCODE:B556		     call    ScanCodeSeq
DOSCODE:B559		     jz	     short rpGotPatch
DOSCODE:B55B rp3Exit_j:				     ; ...
DOSCODE:B55B		     jmp     rp3Exit
DOSCODE:B55E rpGotPatch:			     ; ...
DOSCODE:B55E		     mov     [bp+4], di
DOSCODE:B561		     cmp     word ptr [bp+0], 381
DOSCODE:B566		     jnb     short rpBug2
DOSCODE:B568		     mov     bx, offset	rpBug1Strs
DOSCODE:B56B		     call    FindBadCode
DOSCODE:B56E		     jb	     short rpBug2
DOSCODE:B570		     push    di
DOSCODE:B571		     mov     di, si
DOSCODE:B573		     mov     dx, 3
DOSCODE:B576		     cmp     byte ptr es:[di-1], 51h ; 'Q'
DOSCODE:B57B		     jnz     short rp_no_cx
DOSCODE:B57D		     dec     di
DOSCODE:B57E		     inc     dx
DOSCODE:B57F rp_no_cx:				     ; ...
DOSCODE:B57F		     mov     si, offset	rpRepl2
DOSCODE:B582		     mov     cx, 6
DOSCODE:B585		     call    GenPatch
DOSCODE:B588		     pop     di
DOSCODE:B589		     cmp     byte ptr es:[di-1], 59h ; 'Y'
DOSCODE:B58E		     jnz     short rp_no_cx2
DOSCODE:B590		     mov     byte ptr es:[di-1], 90h ; ''
DOSCODE:B595 rp_no_cx2:				     ; ...
DOSCODE:B595		     mov     ax, [bp+4]
DOSCODE:B598		     mov     es:[di+4],	ax
DOSCODE:B59C		     push    di
DOSCODE:B59D		     mov     si, offset	rpRepl3
DOSCODE:B5A0		     mov     cx, 5
DOSCODE:B5A3		     call    CopyPatch
DOSCODE:B5A6		     pop     bx
DOSCODE:B5A7		     add     bx, 8
DOSCODE:B5AA		     call    GenJump
DOSCODE:B5AD		     mov     [bp+4], di
DOSCODE:B5B0 rpBug2:				     ; ...
DOSCODE:B5B0		     mov     bx, offset	rpBug2Strs
DOSCODE:B5B3		     call    FindBadCode
DOSCODE:B5B6		     jb	     short rpBug3
DOSCODE:B5B8		     push    word ptr [bp+4]
DOSCODE:B5BB		     push    di
DOSCODE:B5BC		     mov     di, si
DOSCODE:B5BE		     mov     dx, 4
DOSCODE:B5C1		     mov     si, offset	rpRepl4
DOSCODE:B5C4		     mov     cx, 15
DOSCODE:B5C7		     call    GenPatch
DOSCODE:B5CA		     pop     di
DOSCODE:B5CB		     add     di, 5
DOSCODE:B5CE		     mov     bx, [bp+4]
DOSCODE:B5D1		     push    bx
DOSCODE:B5D2		     call    GenJump
DOSCODE:B5D5		     mov     si, offset	rpRepl5
DOSCODE:B5D8		     mov     cx, 15
DOSCODE:B5DB		     call    CopyPatch
DOSCODE:B5DE		     pop     di
DOSCODE:B5DF		     pop     si
DOSCODE:B5E0		     mov     ax, [bp+4]
DOSCODE:B5E3		     mov     es:[si+7],	ax
DOSCODE:B5E7		     mov     es:[di+5],	ax
DOSCODE:B5EB		     add     ax, 4
DOSCODE:B5EE		     mov     es:[si+0Dh], ax
DOSCODE:B5F2		     mov     es:[di+0Bh], ax
DOSCODE:B5F6		     add     word ptr [bp+4], 8
DOSCODE:B5FA rpBug3:				     ; ...
DOSCODE:B5FA		     mov     bx, offset	rpBug3Strs
DOSCODE:B5FD		     call    FindBadCode
DOSCODE:B600		     jb	     short rpBug4
DOSCODE:B602		     add     di, 9
DOSCODE:B605		     push    si
DOSCODE:B606		     mov     si, offset	rpFind7b
DOSCODE:B609		     mov     dx, 3
DOSCODE:B60C		     call    ScanCodeSeq_di
DOSCODE:B60F		     pop     si
DOSCODE:B610		     jnz     short rpBug4
DOSCODE:B612		     push    di
DOSCODE:B613		     mov     di, si
DOSCODE:B615		     mov     dx, 3
DOSCODE:B618		     mov     si, offset	rpRepl6
DOSCODE:B61B		     mov     cx, 9
DOSCODE:B61E		     call    GenPatch
DOSCODE:B621		     pop     di
DOSCODE:B622		     mov     dx, 3
DOSCODE:B625		     mov     si, offset	rpRepl7
DOSCODE:B628		     mov     cx, 9
DOSCODE:B62B		     call    GenPatch
DOSCODE:B62E rpBug4:				     ; ...
DOSCODE:B62E		     cmp     word ptr [bp+0], 360
DOSCODE:B633		     jbe     short rp3Exit
DOSCODE:B635		     mov     bx, offset	rpBug4Strs
DOSCODE:B638		     call    FindBadCode
DOSCODE:B63B		     jb	     short rp3Exit
DOSCODE:B63D		     push    di
DOSCODE:B63E		     mov     di, si
DOSCODE:B640		     mov     dx, 3
DOSCODE:B643		     mov     si, offset	rpRepl8
DOSCODE:B646		     mov     cx, 4
DOSCODE:B649		     call    GenPatch
DOSCODE:B64C		     pop     di
DOSCODE:B64D		     mov     bx, [bp+4]
DOSCODE:B650		     call    GenJump
DOSCODE:B653		     mov     si, offset	rpRepl9
DOSCODE:B656		     mov     cx, 5
DOSCODE:B659		     call    CopyPatch
DOSCODE:B65C rp3Exit:				     ; ...
DOSCODE:B65C		     add     sp, 6
DOSCODE:B65F		     pop     bp
DOSCODE:B660		     pop     ds
DOSCODE:B661		     pop     es
DOSCODE:B662		     pop     di
DOSCODE:B663		     pop     si
DOSCODE:B664		     pop     dx
DOSCODE:B665		     pop     cx
DOSCODE:B666		     pop     bx
DOSCODE:B667		     pop     ax
DOSCODE:B668		     retn
DOSCODE:B669 ; =============== S U B R O U T I N E =======================================
DOSCODE:B669 FindBadCode     proc near		     ; ...
DOSCODE:B669		     mov     cx, [bp+2]
DOSCODE:B66C		     mov     si, [bx]
DOSCODE:B66E		     mov     dx, [bx+2]
DOSCODE:B671		     call    ScanCodeSeq
DOSCODE:B674		     jnz     short fbc_error
DOSCODE:B676		     push    di
DOSCODE:B677		     mov     si, [bx+4]
DOSCODE:B67A		     mov     dx, [bx+6]
DOSCODE:B67D		     call    ScanCodeSeq_di
DOSCODE:B680		     pop     si
DOSCODE:B681		     jnz     short fbc_error
DOSCODE:B683		     mov     ax, di
DOSCODE:B685		     sub     ax, si
DOSCODE:B687		     jb	     short fbc_error
DOSCODE:B689		     cmp     ax, [bx+8]
DOSCODE:B68C		     ja	     short fbc_error
DOSCODE:B68E		     clc
DOSCODE:B68F		     retn
DOSCODE:B690 fbc_error:				     ; ...
DOSCODE:B690		     stc
DOSCODE:B691		     retn
DOSCODE:B691 FindBadCode     endp
DOSCODE:B692 ; =============== S U B R O U T I N E =======================================
DOSCODE:B692 GenPatch	     proc near		     ; ...
DOSCODE:B692		     push    di
DOSCODE:B693		     mov     bx, [bp+4]
DOSCODE:B696		     call    GenJump
DOSCODE:B699		     call    CopyPatch
DOSCODE:B69C		     pop     bx
DOSCODE:B69D		     add     bx, dx
DOSCODE:B69F		     call    GenJump
DOSCODE:B6A2		     mov     [bp+4], di
DOSCODE:B6A5		     retn
DOSCODE:B6A5 GenPatch	     endp
DOSCODE:B6A6 ; =============== S U B R O U T I N E =======================================
DOSCODE:B6A6 CopyPatch	     proc near		     ; ...
DOSCODE:B6A6		     push    cx
DOSCODE:B6A7		     mov     di, [bp+4]
DOSCODE:B6AA		     cld
DOSCODE:B6AB		     rep movsb
DOSCODE:B6AD		     pop     cx
DOSCODE:B6AE		     mov     [bp+4], di
DOSCODE:B6B1		     retn
DOSCODE:B6B1 CopyPatch	     endp
DOSCODE:B6B2 ; =============== S U B R O U T I N E =======================================
DOSCODE:B6B2 GenJump	     proc near		     ; ...
DOSCODE:B6B2		     mov     al, 0E9h
DOSCODE:B6B4		     stosb
DOSCODE:B6B5		     mov     ax, bx
DOSCODE:B6B7		     sub     ax, di
DOSCODE:B6B9		     sub     ax, 2
DOSCODE:B6BC		     stosw
DOSCODE:B6BD		     retn
DOSCODE:B6BD GenJump	     endp
DOSCODE:B6BE ; =============== S U B R O U T I N E =======================================
DOSCODE:B6BE ScanCodeSeq     proc near		     ; ...
DOSCODE:B6BE		     mov     di, 200h
DOSCODE:B6BE ScanCodeSeq     endp
DOSCODE:B6C1 ; =============== S U B R O U T I N E =======================================
DOSCODE:B6C1 ScanCodeSeq_di  proc near		     ; ...
DOSCODE:B6C1		     push    cx
DOSCODE:B6C2		     sub     cx, dx
DOSCODE:B6C4		     inc     cx
DOSCODE:B6C5 scsagain:				     ; ...
DOSCODE:B6C5		     push    si
DOSCODE:B6C6		     push    di
DOSCODE:B6C7		     push    cx
DOSCODE:B6C8		     mov     cx, dx
DOSCODE:B6CA		     repe cmpsb
DOSCODE:B6CC		     pop     cx
DOSCODE:B6CD		     pop     di
DOSCODE:B6CE		     pop     si
DOSCODE:B6CF		     jz	     short scsfound
DOSCODE:B6D1		     inc     di
DOSCODE:B6D2		     loop    scsagain
DOSCODE:B6D4 scsfound:				     ; ...
DOSCODE:B6D4		     pop     cx
DOSCODE:B6D5		     retn
DOSCODE:B6D5 ScanCodeSeq_di  endp
DOSCODE:B6D6 ; =============== S U B R O U T I N E =======================================
DOSCODE:B6D6 VerifyVersion   proc near		     ; ...
DOSCODE:B6D6		     mov     si, es:2Ah
DOSCODE:B6DB		     mov     bl, 10
DOSCODE:B6DD		     add     si, 3
DOSCODE:B6E0		     call    VVDigit
DOSCODE:B6E3		     jnz     short vvexit
DOSCODE:B6E5		     call    VVDigit
DOSCODE:B6E8		     jnz     short vvexit
DOSCODE:B6EA		     cmp     byte ptr es:[si], '.'
DOSCODE:B6EE		     jnz     short vvexit
DOSCODE:B6F0		     dec     si
DOSCODE:B6F1		     call    VVDigit
DOSCODE:B6F4 vvexit:				     ; ...
DOSCODE:B6F4		     retn
DOSCODE:B6F4 VerifyVersion   endp
DOSCODE:B6F5 ; =============== S U B R O U T I N E =======================================
DOSCODE:B6F5 VVDigit	     proc near		     ; ...
DOSCODE:B6F5		     div     bl
DOSCODE:B6F7		     add     ah, '0'
DOSCODE:B6FA		     dec     si
DOSCODE:B6FB		     cmp     es:[si+1],	ah
DOSCODE:B6FF		     mov     ah, 0
DOSCODE:B701		     retn
DOSCODE:B701 VVDigit	     endp
DOSCODE:B702 exepatch_start:			     ; ...
DOSCODE:B702		     push    es
DOSCODE:B703		     mov     ax, ds
DOSCODE:B705		     sub     ax, dx
DOSCODE:B707 first:
DOSCODE:B707		     mov     ds, ax
DOSCODE:B709		     mov     es, ax
DOSCODE:B70B		     mov     di, 0Fh
DOSCODE:B70E		     push    di
DOSCODE:B70F		     mov     cx, 10h
DOSCODE:B712		     mov     al, 0FFh
DOSCODE:B714		     repe scasb
DOSCODE:B716		     inc     di
DOSCODE:B717		     mov     si, di
DOSCODE:B719		     pop     di
DOSCODE:B71A		     pop     ax
DOSCODE:B71B		     sub     ax, dx
DOSCODE:B71D second:
DOSCODE:B71D		     mov     es, ax
DOSCODE:B71F _NextRec:				     ; ...
DOSCODE:B71F		     mov     cx, 204h
DOSCODE:B722 _norm_agn:				     ; ...
DOSCODE:B722		     mov     ax, si
DOSCODE:B724		     not     ax
DOSCODE:B726		     shr     ax, cl
DOSCODE:B728		     jz	     short _SI_ok
DOSCODE:B72A		     mov     dx, ds
DOSCODE:B72C		     or	     si, 0FFF0h
DOSCODE:B72F		     sub     dx, ax
DOSCODE:B731		     jnb     short _SItoDS
DOSCODE:B733		     neg     dx
DOSCODE:B735		     shl     dx, cl
DOSCODE:B737		     sub     si, dx
DOSCODE:B739		     xor     dx, dx
DOSCODE:B73B _SItoDS:				     ; ...
DOSCODE:B73B		     mov     ds, dx
DOSCODE:B73D _SI_ok:				     ; ...
DOSCODE:B73D		     xchg    si, di
DOSCODE:B73F		     push    ds
DOSCODE:B740		     push    es
DOSCODE:B741		     pop     ds
DOSCODE:B742		     pop     es
DOSCODE:B743		     dec     ch
DOSCODE:B745		     jnz     short _norm_agn
DOSCODE:B747		     lodsb
DOSCODE:B748		     xchg    ax, dx
DOSCODE:B749		     dec     si
DOSCODE:B74A		     lodsw
DOSCODE:B74B		     mov     cx, ax
DOSCODE:B74D		     inc     si
DOSCODE:B74E		     mov     al, dl
DOSCODE:B750		     and     al, 0FEh
DOSCODE:B752		     cmp     al, 0B0h	     ; RPTREC
DOSCODE:B754		     jnz     short TryEnum
DOSCODE:B756		     lodsb
DOSCODE:B757		     rep stosb
DOSCODE:B759		     jmp     short TryNext
DOSCODE:B75B TryEnum:				     ; ...
DOSCODE:B75B		     cmp     al, 0B2h	     ; ENMREC
DOSCODE:B75D		     jnz     short near	ptr NextRec_2+1	; db 75h,6Bh
DOSCODE:B75F		     rep movsb
DOSCODE:B761 TryNext:				     ; ...
DOSCODE:B761		     xchg    ax, dx
DOSCODE:B762		     test    al, 1
DOSCODE:B764		     jz	     short _NextRec  ; db 74h,0BAh
DOSCODE:B766		     nop
DOSCODE:B767		     nop
DOSCODE:B768 scan_patch1:			     ; ...
DOSCODE:B768		     mov     bx, es
DOSCODE:B76A		     mov     ax, ds
DOSCODE:B76C		     sub     ax, dx
DOSCODE:B76E		     mov     ds, ax
DOSCODE:B770		     mov     es, ax
DOSCODE:B772		     mov     di, 0Fh
DOSCODE:B775		     mov     cx, 10h
DOSCODE:B778		     mov     al, 0FFh
DOSCODE:B77A		     repe scasb
DOSCODE:B77C		     inc     di
DOSCODE:B77D		     mov     si, di
DOSCODE:B77F		     mov     ax, bx
DOSCODE:B781		     sub     ax, dx
DOSCODE:B783		     mov     es, ax
DOSCODE:B785		     mov     di, 0Fh
DOSCODE:B788 NextRec_1:
DOSCODE:B788		     mov     cl, 4
DOSCODE:B78A		     mov     ax, si
DOSCODE:B78C		     not     ax
DOSCODE:B78E		     shr     ax, cl
DOSCODE:B790		     jz	     short SI_ok_1
DOSCODE:B792		     mov     dx, ds
DOSCODE:B794		     sub     dx, ax
DOSCODE:B796		     mov     ds, dx
DOSCODE:B798		     assume ds:nothing
DOSCODE:B798		     or	     si, 0FFF0h
DOSCODE:B79B SI_ok_1:				     ; ...
DOSCODE:B79B		     mov     ax, di
DOSCODE:B79D		     not     ax
DOSCODE:B79F		     shr     ax, cl
DOSCODE:B7A1		     jz	     short scan_patch2
DOSCODE:B7A3		     mov     dx, es
DOSCODE:B7A5		     sub     dx, ax
DOSCODE:B7A7		     mov     es, dx
DOSCODE:B7A9		     assume es:nothing
DOSCODE:B7A9		     or	     di, 0FFF0h
DOSCODE:B7AC scan_patch2:			     ; ...
DOSCODE:B7AC		     mov     bx, es
DOSCODE:B7AE		     mov     ax, ds
DOSCODE:B7B0		     dec     ax
DOSCODE:B7B1		     mov     ds, ax
DOSCODE:B7B3		     assume ds:nothing
DOSCODE:B7B3		     mov     es, ax
DOSCODE:B7B5		     mov     di, 0Fh
DOSCODE:B7B8		     mov     cx, 10h
DOSCODE:B7BB		     mov     al, 0FFh
DOSCODE:B7BD		     repe scasb
DOSCODE:B7BF		     inc     di
DOSCODE:B7C0		     mov     si, di
DOSCODE:B7C2		     mov     ax, bx
DOSCODE:B7C4		     dec     ax
DOSCODE:B7C5		     mov     es, ax
DOSCODE:B7C7		     assume es:nothing
DOSCODE:B7C7		     mov     di, 0Fh
DOSCODE:B7CA NextRec_2:				     ; ...
DOSCODE:B7CA		     mov     cl, 4
DOSCODE:B7CC		     mov     ax, si
DOSCODE:B7CE		     not     ax
DOSCODE:B7D0		     shr     ax, cl
DOSCODE:B7D2		     jz	     short SI_ok_2
DOSCODE:B7D4		     mov     dx, ds
DOSCODE:B7D6		     sub     dx, ax
DOSCODE:B7D8		     mov     ds, dx
DOSCODE:B7DA		     assume ds:nothing
DOSCODE:B7DA		     or	     si, 0FFF0h
DOSCODE:B7DE SI_ok_2:				     ; ...
DOSCODE:B7DE		     mov     ax, di
DOSCODE:B7E0		     not     ax
DOSCODE:B7E2		     shr     ax, cl
DOSCODE:B7E4		     jz	     short scan_patch3
DOSCODE:B7E6		     mov     dx, es
DOSCODE:B7E8		     sub     dx, ax
DOSCODE:B7EA		     mov     es, dx
DOSCODE:B7EC		     assume es:nothing
DOSCODE:B7EC		     or	     di, 0FFF0h
DOSCODE:B7F0 scan_patch3:			     ; ...
DOSCODE:B7F0		     mov     bx, es
DOSCODE:B7F2		     mov     ax, ds
DOSCODE:B7F4		     dec     ax
DOSCODE:B7F5		     mov     ds, ax
DOSCODE:B7F7		     assume ds:nothing
DOSCODE:B7F7		     mov     es, ax
DOSCODE:B7F9		     assume es:nothing
DOSCODE:B7F9		     mov     di, 0Fh
DOSCODE:B7FC		     mov     cx, 10h
DOSCODE:B7FF		     mov     al, 0FFh
DOSCODE:B801		     repe scasb
DOSCODE:B803		     inc     di
DOSCODE:B804		     mov     si, di
DOSCODE:B806		     mov     ax, bx
DOSCODE:B808		     dec     ax
DOSCODE:B809		     mov     es, ax
DOSCODE:B80B		     assume es:nothing
DOSCODE:B80B		     mov     di, 0Fh
DOSCODE:B80E NextRec_3:
DOSCODE:B80E		     mov     cl, 4
DOSCODE:B810		     mov     ax, si
DOSCODE:B812		     not     ax
DOSCODE:B814		     shr     ax, cl
DOSCODE:B816		     jz	     short SI_ok_3
DOSCODE:B818		     mov     dx, ds
DOSCODE:B81A		     sub     dx, ax
DOSCODE:B81C		     mov     ds, dx
DOSCODE:B81E		     assume ds:nothing
DOSCODE:B81E		     or	     si, 0FFF0h
DOSCODE:B821 SI_ok_3:				     ; ...
DOSCODE:B821		     mov     ax, di
DOSCODE:B823		     not     ax
DOSCODE:B825		     shr     ax, cl
DOSCODE:B827		     jz	     short scan_com
DOSCODE:B829		     mov     dx, es
DOSCODE:B82B		     sub     dx, ax
DOSCODE:B82D		     mov     es, dx
DOSCODE:B82F		     assume es:nothing
DOSCODE:B82F		     or	     di, 0FFF0h
DOSCODE:B832 scan_com:				     ; ...
DOSCODE:B832		     lodsb
DOSCODE:B833		     mov     dl, al
DOSCODE:B835		     dec     si
DOSCODE:B836		     lodsw
DOSCODE:B837		     mov     cx, ax
DOSCODE:B839		     inc     si
DOSCODE:B83A		     mov     al, dl
DOSCODE:B83C		     and     al, 0FEh
DOSCODE:B83E		     cmp     al, 0B0h
DOSCODE:B840		     jnz     short _TryEnum
DOSCODE:B842		     lodsb
DOSCODE:B843		     rep stosb
DOSCODE:B845		     jmp     short _TryNext
DOSCODE:B847		     nop
DOSCODE:B848 _TryEnum:				     ; ...
DOSCODE:B848		     cmp     al, 0B2h
DOSCODE:B84A		     jnz     short near	ptr ep_chkpatch2+2
DOSCODE:B84C		     rep movsb
DOSCODE:B84E _TryNext:				     ; ...
DOSCODE:B84E		     mov     al, dl
DOSCODE:B850		     test    al, 1
DOSCODE:B852 ExePatch:				     ; ...
DOSCODE:B852		     call    ExePackPatch
DOSCODE:B855		     call    ss:RationalPatchPtr
DOSCODE:B85A		     retn
DOSCODE:B85B ; =============== S U B R O U T I N E =======================================
DOSCODE:B85B ExePackPatch    proc near		     ; ...
DOSCODE:B85B		     push    bx
DOSCODE:B85C		     mov     bx, es
DOSCODE:B85E		     cmp     bx, 0FFFh
DOSCODE:B862		     jbe     short ep_cont
DOSCODE:B864		     pop     bx
DOSCODE:B865		     retn
DOSCODE:B866 ep_cont:				     ; ...
DOSCODE:B866		     push    ds
DOSCODE:B867		     push    es
DOSCODE:B868		     push    ax
DOSCODE:B869		     push    cx
DOSCODE:B86A		     push    si
DOSCODE:B86B		     push    di
DOSCODE:B86C		     sub     cx, 2
DOSCODE:B86F		     jnb     short epp_1
DOSCODE:B871		     jmp     ep_notpacked
DOSCODE:B874 epp_1:				     ; ...
DOSCODE:B874		     mov     di, cx
DOSCODE:B876		     mov     es, ax
DOSCODE:B878		     assume es:nothing
DOSCODE:B878		     mov     ss:UNPACK_OFFSET, di
DOSCODE:B87D		     cmp     word ptr es:[di], 'BR'
DOSCODE:B882		     jz	     short epp_2
DOSCODE:B884		     jmp     ep_notpacked
DOSCODE:B887 epp_2:				     ; ...
DOSCODE:B887		     push    cs
DOSCODE:B888		     pop     ds
DOSCODE:B889		     assume ds:nothing
DOSCODE:B889		     add     di, 6Ch
DOSCODE:B88C		     call    chk_common_str
DOSCODE:B88F		     jnz     short ep_chkpatch2
DOSCODE:B891		     mov     si, offset	scan_patch1
DOSCODE:B894		     mov     di, ss:UNPACK_OFFSET
DOSCODE:B899		     add     di, 28h
DOSCODE:B89C		     mov     cx, 68
DOSCODE:B89F		     mov     bx, 142
DOSCODE:B8A2		     mov     ax, 0EF4Eh
DOSCODE:B8A5		     call    chk_patchsum
DOSCODE:B8A8		     jb	     short ep_done1
DOSCODE:B8AA		     mov     si, offset	exepatch_start
DOSCODE:B8AD		     mov     cx, 102
DOSCODE:B8B0		     rep movsb
DOSCODE:B8B2 ep_done1:				     ; ...
DOSCODE:B8B2		     jmp     ep_notpacked
DOSCODE:B8B5 ep_chkpatch2:			     ; ...
DOSCODE:B8B5		     mov     di, 76h
DOSCODE:B8B8		     call    chk_common_str
DOSCODE:B8BB		     jnz     short ep_chkpatch3
DOSCODE:B8BD		     mov     si, offset	scan_patch2
DOSCODE:B8C0		     mov     di, 32h
DOSCODE:B8C3		     mov     cx, 68
DOSCODE:B8C6		     mov     bx, 140
DOSCODE:B8C9		     mov     ax, 78B2h
DOSCODE:B8CC		     call    chk_patchsum
DOSCODE:B8CF		     jnb     short ep_patchcode2
DOSCODE:B8D1		     mov     si, offset	scan_patch2
DOSCODE:B8D4		     mov     cx, 68
DOSCODE:B8D7		     mov     bx, 129
DOSCODE:B8DA		     mov     ax, 1C47h
DOSCODE:B8DD		     call    chk_patchsum
DOSCODE:B8E0		     jb	     short ep_notpacked
DOSCODE:B8E2 ep_patchcode2:			     ; ...
DOSCODE:B8E2		     mov     si, offset	exepatch_start
DOSCODE:B8E5		     mov     cx, 3
DOSCODE:B8E8		     rep movsb
DOSCODE:B8EA		     mov     ax, 4890h
DOSCODE:B8ED		     stosw
DOSCODE:B8EE		     add     si, 2
DOSCODE:B8F1		     mov     cx, 20
DOSCODE:B8F4		     rep movsb
DOSCODE:B8F6		     stosw
DOSCODE:B8F7		     add     si, 2
DOSCODE:B8FA		     mov     cx, 75
DOSCODE:B8FD		     rep movsb
DOSCODE:B8FF		     jmp     short ep_notpacked
DOSCODE:B901 ep_chkpatch3:			     ; ...
DOSCODE:B901		     mov     di, 74h
DOSCODE:B904		     call    chk_common_str
DOSCODE:B907		     jnz     short ep_notpacked
DOSCODE:B909		     mov     si, offset	scan_patch3
DOSCODE:B90C		     mov     di, 32h
DOSCODE:B90F		     mov     cx, 66
DOSCODE:B912		     mov     bx, 139
DOSCODE:B915		     mov     ax, 4EDEh
DOSCODE:B918		     call    chk_patchsum
DOSCODE:B91B		     jb	     short ep_notpacked
DOSCODE:B91D		     mov     si, offset	exepatch_start
DOSCODE:B920		     mov     cx, 3
DOSCODE:B923		     rep movsb
DOSCODE:B925		     mov     al, 48h ; 'H'
DOSCODE:B927		     stosb
DOSCODE:B928		     add     si, 2
DOSCODE:B92B		     mov     cx, 20
DOSCODE:B92E		     rep movsb
DOSCODE:B930		     stosb
DOSCODE:B931		     add     si, 2
DOSCODE:B934		     mov     cx, 75
DOSCODE:B937		     rep movsb
DOSCODE:B939 ep_notpacked:			     ; ...
DOSCODE:B939		     pop     di
DOSCODE:B93A		     pop     si
DOSCODE:B93B		     pop     cx
DOSCODE:B93C		     pop     ax
DOSCODE:B93D		     pop     es
DOSCODE:B93E		     pop     ds
DOSCODE:B93F		     pop     bx
DOSCODE:B940		     retn
DOSCODE:B940 ExePackPatch    endp
DOSCODE:B941 ; =============== S U B R O U T I N E =======================================
DOSCODE:B941 chk_common_str  proc near		     ; ...
DOSCODE:B941		     mov     si, offset	scan_com
DOSCODE:B944		     mov     cx, 32
DOSCODE:B947		     repe cmpsb
DOSCODE:B949		     jz	     short ccs_done
DOSCODE:B94B		     cmp     byte ptr es:[di-1], 56h
DOSCODE:B950		     jnz     short ccs_done
DOSCODE:B952		     repe cmpsb
DOSCODE:B954 ccs_done:				     ; ...
DOSCODE:B954		     retn
DOSCODE:B954 chk_common_str  endp
DOSCODE:B955 ; =============== S U B R O U T I N E =======================================
DOSCODE:B955 chk_patchsum    proc near		     ; ...
DOSCODE:B955		     push    di
DOSCODE:B956		     repe cmpsb
DOSCODE:B958		     jnz     short cp_fail
DOSCODE:B95A		     mov     di, ss:87h
DOSCODE:B95F		     mov     cx, bx
DOSCODE:B961		     mov     bx, ax
DOSCODE:B963		     xor     ax, ax
DOSCODE:B965 ep_chksum:				     ; ...
DOSCODE:B965		     add     ax, es:[di]
DOSCODE:B968		     add     di, 2
DOSCODE:B96B		     loop    ep_chksum
DOSCODE:B96D		     pop     di
DOSCODE:B96E		     cmp     ax, bx
DOSCODE:B970		     jnz     short cp_fail
DOSCODE:B972		     clc
DOSCODE:B973		     retn
DOSCODE:B974 cp_fail:				     ; ...
DOSCODE:B974		     stc
DOSCODE:B975		     retn
DOSCODE:B975 chk_patchsum    endp ; sp-analysis	failed
DOSCODE:B976 RScanPattern1   db	2 dup(0), 20h, 3 dup(0), 40h, 0, 1, 0 ;	...
DOSCODE:B980 RScanPattern2   db	8Bh, 0Eh, 10h, 0, 90h, 0E2h, 0FEh, 0E8h	; ...
DOSCODE:B988 RScanPattern3   db	8Bh, 0Eh, 10h, 0, 0E2h,	0FEh, 0E8h ; ...
DOSCODE:B98F RationalPatch:			     ; ...
DOSCODE:B98F		     cld
DOSCODE:B990		     push    ax
DOSCODE:B991		     push    bx
DOSCODE:B992		     push    cx
DOSCODE:B993		     push    dx
DOSCODE:B994		     push    si
DOSCODE:B995		     push    di
DOSCODE:B996		     push    es
DOSCODE:B997		     push    ds
DOSCODE:B998		     mov     di, 0Ah
DOSCODE:B99B		     push    cs
DOSCODE:B99C		     pop     ds
DOSCODE:B99D		     mov     si, offset	RScanPattern1
DOSCODE:B9A0		     mov     cx, 10
DOSCODE:B9A3		     repe cmpsb
DOSCODE:B9A5		     jnz     short rpexit
DOSCODE:B9A7		     mov     ax, es:0
DOSCODE:B9AB		     cmp     ax, 348
DOSCODE:B9AE		     jb	     short rpexit
DOSCODE:B9B0		     cmp     ax, 383
DOSCODE:B9B3		     ja	     short rpexit
DOSCODE:B9B5		     call    VerifyVersion
DOSCODE:B9B8		     jnz     short rpexit
DOSCODE:B9BA		     mov     cx, es:16h
DOSCODE:B9BF		     sub     cx, 200h
DOSCODE:B9C3		     mov     es, word ptr es:20h
DOSCODE:B9C8		     mov     si, offset	RScanPattern2
DOSCODE:B9CB		     mov     dx, 8
DOSCODE:B9CE		     call    ScanCodeSeq
DOSCODE:B9D1		     jz	     short rpfound
DOSCODE:B9D3		     mov     si, offset	RScanPattern3
DOSCODE:B9D6		     mov     dx, 15
DOSCODE:B9D9		     call    ScanCodeSeq
DOSCODE:B9DC		     jnz     short rpexit
DOSCODE:B9DE rpfound:				     ; ...
DOSCODE:B9DE		     mov     al, 9Ah
DOSCODE:B9E0		     stosb
DOSCODE:B9E1		     mov     ax, offset	RatBugCode
DOSCODE:B9E4		     stosw
DOSCODE:B9E5		     mov     ax, ss
DOSCODE:B9E7		     stosw
DOSCODE:B9E8		     mov     cx, dx
DOSCODE:B9EA		     sub     cx, 6
DOSCODE:B9ED		     mov     al, 90h
DOSCODE:B9EF		     rep stosb
DOSCODE:B9F1 rpexit:				     ; ...
DOSCODE:B9F1		     pop     ds
DOSCODE:B9F2		     pop     es
DOSCODE:B9F3		     pop     di
DOSCODE:B9F4		     pop     si
DOSCODE:B9F5		     pop     dx
DOSCODE:B9F6		     pop     cx
DOSCODE:B9F7		     pop     bx
DOSCODE:B9F8		     pop     ax
DOSCODE:B9F9		     retn
DOSCODE:B9FA CPScanPattern   db	89h, 26h, 48h, 1, 8Ch, 0Eh, 4Ch, 1, 0C7h, 6, 4Ah, 1 ; ...
DOSCODE:B9FA		     db	0, 1, 8Ch, 0Eh,	13h, 1,	0B8h, 20h, 1, 0BEh, 0, 1
DOSCODE:BA12 ; =============== S U B R O U T I N E =======================================
DOSCODE:BA12 IsCopyProt	     proc near		     ; ...
DOSCODE:BA12		     cmp     word ptr ds:11Bh, 5343h
DOSCODE:BA18		     jnz     short CP_done
DOSCODE:BA1A		     cmp     word ptr ds:173h, 5044h
DOSCODE:BA20		     jnz     short CP_done
DOSCODE:BA22		     cmp     word ptr ds:146h, 0F413h
DOSCODE:BA28		     jnz     short CP_done
DOSCODE:BA2A		     cmp     word ptr ds:124h, 8000h
DOSCODE:BA30		     jnz     short CP_done
DOSCODE:BA32		     push    cs
DOSCODE:BA33		     pop     es
DOSCODE:BA34		     mov     di, offset	CPScanPattern
DOSCODE:BA37		     mov     si, 175h
DOSCODE:BA3A		     mov     cx, 24
DOSCODE:BA3D		     repe cmpsb
DOSCODE:BA3F		     jnz     short CP_done
DOSCODE:BA41		     mov     ss:A20OFF_COUNT, 0Ah
DOSCODE:BA47 CP_done:				     ; ...
DOSCODE:BA47		     retn
DOSCODE:BA47 IsCopyProt	     endp
DOSCODE:BA48 initiret:				     ; ...
DOSCODE:BA48		     iret
DOSCODE:BA49 InitBioDataSeg  dw	70h		     ; ...
DOSCODE:BA4B ; =============== S U B R O U T I N E =======================================
DOSCODE:BA4B ParaRound	     proc near		     ; ...
DOSCODE:BA4B		     add     ax, 15
DOSCODE:BA4E		     rcr     ax, 1
DOSCODE:BA50		     shr     ax, 1
DOSCODE:BA52		     shr     ax, 1
DOSCODE:BA54		     shr     ax, 1
DOSCODE:BA56		     retn
DOSCODE:BA56 ParaRound	     endp
DOSCODE:BA57 DOSINIT:				     ; ...
DOSCODE:BA57		     cli
DOSCODE:BA58		     cld
DOSCODE:BA59		     push    dx
DOSCODE:BA5A		     push    si
DOSCODE:BA5B		     push    ds
DOSCODE:BA5C		     push    di
DOSCODE:BA5D		     mov     bx, es
DOSCODE:BA5F		     mov     ax, offset	MEMSTRT
DOSCODE:BA62		     add     ax, 0Fh
DOSCODE:BA65		     and     ax, 0FFF0h
DOSCODE:BA68		     mov     si, ax
DOSCODE:BA6A		     mov     ax, cs
DOSCODE:BA6C		     mov     ds, ax
DOSCODE:BA6E		     mov     es, cs:InitBioDataSeg
DOSCODE:BA73		     assume es:nothing
DOSCODE:BA73		     mov     es, word ptr es:3 ; DosDataSg equ 3
DOSCODE:BA78		     assume es:nothing
DOSCODE:BA78		     xor     di, di
DOSCODE:BA7A		     mov     cx, 4970	     ; DOSDATASIZE (MSDAT001E)
DOSCODE:BA7D		     rep movsb
DOSCODE:BA7F		     pop     di
DOSCODE:BA80		     pop     ds
DOSCODE:BA81		     pop     si
DOSCODE:BA82		     pop     dx
DOSCODE:BA83		     push    es
DOSCODE:BA84		     push    ds
DOSCODE:BA85		     pop     es
DOSCODE:BA86		     pop     ds
DOSCODE:BA87		     mov     word ptr ds:BiosDataPtr, di
DOSCODE:BA8B		     mov     word ptr ds:BiosDataPtr+2,	bx
DOSCODE:BA8F		     mov     cs:DosDSeg, ds
DOSCODE:BA94		     mov     word ptr cs:LowInt23Addr+2, ds
DOSCODE:BA99		     mov     word ptr cs:LowInt24Addr+2, ds
DOSCODE:BA9E		     mov     word ptr cs:LowInt28Addr+2, ds
DOSCODE:BAA3		     mov     ds:ENDMEM,	dx
DOSCODE:BAA7		     mov     ds:USER_SP, sp
DOSCODE:BAAB		     mov     ds:USER_SS, ss
DOSCODE:BAAF		     mov     ax, ds
DOSCODE:BAB1		     mov     ss, ax
DOSCODE:BAB3		     mov     sp, offset	DSKSTACK
DOSCODE:BAB6		     mov     ds:FixExePatch, offset RetExePatch
DOSCODE:BABC		     mov     ds:RationalPatchPtr, offset RetExePatch
DOSCODE:BAC2		     mov     ds:ChkCopyProt, offset RetExePatch
DOSCODE:BAC8		     call    WhatCPUType
DOSCODE:BACB		     cmp     al, 2
DOSCODE:BACD		     mov     ax, offset	Rational386Patch
DOSCODE:BAD0		     jnb     short di_set_patch
DOSCODE:BAD2		     mov     ax, offset	RetExePatch
DOSCODE:BAD5 di_set_patch:			     ; ...
DOSCODE:BAD5		     mov     ds:Rational386PatchPtr, ax
DOSCODE:BAD8		     mov     ax, cs
DOSCODE:BADA		     mov     ds:TEMP_DOSLOC, ax
DOSCODE:BADD		     mov     word ptr ds:NULDEV+2, es
DOSCODE:BAE1		     mov     word ptr ds:NULDEV, si
DOSCODE:BAE5		     mov     ds:SIS_Instance_Data_Ptr_2, ds
DOSCODE:BAE9		     push    si
DOSCODE:BAEA		     mov     cx, 7
DOSCODE:BAED		     mov     si, offset	Instance_Table_2
DOSCODE:BAF0 Instance_init_loop:		     ; ...
DOSCODE:BAF0		     mov     word ptr [si], ds
DOSCODE:BAF2		     add     si, 6
DOSCODE:BAF5		     loop    Instance_init_loop
DOSCODE:BAF7		     mov     cx, 5
DOSCODE:BAFA		     mov     si, offset	OldInstanceJunk_6
DOSCODE:BAFD OldInstance_init_loop:		     ; ...
DOSCODE:BAFD		     mov     word ptr [si], ds
DOSCODE:BAFF		     add     si, 6
DOSCODE:BB02		     loop    OldInstance_init_loop
DOSCODE:BB04		     pop     si
DOSCODE:BB05		     push    es
DOSCODE:BB06		     pop     ds
DOSCODE:BB07		     push    ds
DOSCODE:BB08		     xor     ax, ax
DOSCODE:BB0A		     mov     ds, ax
DOSCODE:BB0C		     mov     ax, offset	initiret
DOSCODE:BB0F		     mov     ds:0A8h, ax     ; [2Ah*4]
DOSCODE:BB12		     mov     ax, cs
DOSCODE:BB14		     mov     ds:0AAh, ax
DOSCODE:BB17		     pop     ds
DOSCODE:BB18		     call    CHARINIT
DOSCODE:BB1B		     push    si
DOSCODE:BB1C		     push    ss
DOSCODE:BB1D		     pop     es
DOSCODE:BB1E		     mov     di, offset	SFT0_SFTable ; SFTABL+SFT.SFTable
DOSCODE:BB21		     mov     ax, 3
DOSCODE:BB24		     stosw
DOSCODE:BB25		     dec     al
DOSCODE:BB27		     stosw
DOSCODE:BB28		     xor     al, al
DOSCODE:BB2A		     stosb
DOSCODE:BB2B		     mov     al, 0C3h
DOSCODE:BB2D		     stosw
DOSCODE:BB2E		     mov     ax, si
DOSCODE:BB30		     stosw
DOSCODE:BB31		     mov     ax, ds
DOSCODE:BB33		     stosw
DOSCODE:BB34		     xor     ax, ax
DOSCODE:BB36		     stosw
DOSCODE:BB37		     stosw
DOSCODE:BB38		     stosw
DOSCODE:BB39		     dec     ax
DOSCODE:BB3A		     stosw
DOSCODE:BB3B		     stosw
DOSCODE:BB3C		     inc     ax
DOSCODE:BB3D		     stosw
DOSCODE:BB3E		     stosw
DOSCODE:BB3F		     add     di, 7
DOSCODE:BB42		     add     si, 10
DOSCODE:BB45		     mov     cx, 4
DOSCODE:BB48		     rep movsw
DOSCODE:BB4A		     mov     cl, 3
DOSCODE:BB4C		     mov     al, ' '
DOSCODE:BB4E		     rep stosb
DOSCODE:BB50		     pop     si
DOSCODE:BB51		     or	     byte ptr [si+4], 3
DOSCODE:BB55		     mov     word ptr ss:BCON, si
DOSCODE:BB5A		     mov     word ptr ss:BCON+2, ds
DOSCODE:BB5F char_init_loop:			     ; ...
DOSCODE:BB5F		     lds     si, [si]
DOSCODE:BB61		     call    CHARINIT
DOSCODE:BB64		     test    byte ptr [si+4], 8
DOSCODE:BB68		     jz	     short char_init_loop
DOSCODE:BB6A		     mov     word ptr ss:BCLOCK, si
DOSCODE:BB6F		     mov     word ptr ss:BCLOCK+2, ds
DOSCODE:BB74		     mov     bp, 4970	     ; MSDAT001E
DOSCODE:BB77		     mov     word ptr ss:DPBHEAD, bp
DOSCODE:BB7C		     mov     word ptr ss:DPBHEAD+2, es
DOSCODE:BB81 PERDRV:				     ; ...
DOSCODE:BB81		     lds     si, [si]
DOSCODE:BB83		     cmp     si, -1
DOSCODE:BB86		     jz	     short CONTINIT
DOSCODE:BB88		     call    CHARINIT
DOSCODE:BB8B		     test    word ptr [si+4], 8000h
DOSCODE:BB90		     jnz     short PERDRV
DOSCODE:BB92		     mov     cl, ss:CALLUNIT
DOSCODE:BB97		     xor     ch, ch
DOSCODE:BB99		     mov     [si+10], cl
DOSCODE:BB9C		     mov     dl, ss:NUMIO
DOSCODE:BBA1		     xor     dh, dh
DOSCODE:BBA3		     add     ss:NUMIO, cl
DOSCODE:BBA8		     push    ds
DOSCODE:BBA9		     push    si
DOSCODE:BBAA		     lds     bx, ss:CALLBPB
DOSCODE:BBAF PERUNIT:				     ; ...
DOSCODE:BBAF		     mov     si, [bx]
DOSCODE:BBB1		     inc     bx
DOSCODE:BBB2		     inc     bx
DOSCODE:BBB3		     mov     es:[bp+0],	dl
DOSCODE:BBB7		     mov     es:[bp+1],	dh
DOSCODE:BBBB		     push    bx
DOSCODE:BBBC		     push    cx
DOSCODE:BBBD		     push    dx
DOSCODE:BBBE		     call    $SETDPB
DOSCODE:BBC1		     mov     ax, es:[bp+2]
DOSCODE:BBC5		     cmp     ax, ss:MAXSEC
DOSCODE:BBCA		     jbe     short NOTMAX
DOSCODE:BBCC		     mov     ss:MAXSEC,	ax
DOSCODE:BBD0 NOTMAX:				     ; ...
DOSCODE:BBD0		     mov     ax, bp
DOSCODE:BBD2		     add     ax, 33	     ; DPBSIZ
DOSCODE:BBD5		     mov     es:[bp+19h], ax
DOSCODE:BBD9		     mov     word ptr es:[bp+1Bh], es
DOSCODE:BBDD		     mov     byte ptr es:[bp+18h], 0FFh
DOSCODE:BBE2		     pop     dx
DOSCODE:BBE3		     pop     cx
DOSCODE:BBE4		     pop     bx
DOSCODE:BBE5		     mov     ax, ds
DOSCODE:BBE7		     pop     si
DOSCODE:BBE8		     pop     ds
DOSCODE:BBE9		     mov     es:[bp+13h], si
DOSCODE:BBED		     mov     word ptr es:[bp+15h], ds
DOSCODE:BBF1		     push    ds
DOSCODE:BBF2		     push    si
DOSCODE:BBF3		     inc     dh
DOSCODE:BBF5		     inc     dl
DOSCODE:BBF7		     mov     ds, ax
DOSCODE:BBF9		     add     bp, 33	     ; DPBSIZ
DOSCODE:BBFC		     loop    PERUNIT
DOSCODE:BBFE		     pop     si
DOSCODE:BBFF		     pop     ds
DOSCODE:BC00		     jmp     PERDRV
DOSCODE:BC03 CONTINIT:				     ; ...
DOSCODE:BC03		     sub     bp, 33
DOSCODE:BC06		     mov     word ptr [bp+19h],	0FFFFh
DOSCODE:BC0B		     mov     word ptr [bp+1Bh],	0FFFFh
DOSCODE:BC10		     add     bp, 33
DOSCODE:BC13		     push    ss
DOSCODE:BC14		     pop     ds
DOSCODE:BC15		     mov     ax, bp
DOSCODE:BC17		     call    ParaRound
DOSCODE:BC1A		     mov     dx, ds
DOSCODE:BC1C		     add     dx, ax
DOSCODE:BC1E		     mov     bx, 0Fh
DOSCODE:BC21		     mov     cx, ds:ENDMEM
DOSCODE:BC25		     mov     ds:DOSSEG_INIT, ds
DOSCODE:BC29		     push    dx
DOSCODE:BC2A		     mov     ax, ds:TEMP_DOSLOC
DOSCODE:BC2D		     mov     es, ax
DOSCODE:BC2F		     mov     ds:TEMP_DOSLOC, 0FFFFh
DOSCODE:BC35		     call    patch_vec_segments
DOSCODE:BC38		     call    patch_misc_segments
DOSCODE:BC3B		     mov     ds:TEMP_DOSLOC, es
DOSCODE:BC3F		     pop     dx
DOSCODE:BC40		     xor     ax, ax
DOSCODE:BC42		     mov     ds, ax
DOSCODE:BC44		     mov     es, ax
DOSCODE:BC46		     mov     di, 90h
DOSCODE:BC49		     mov     ax, ss:TEMP_DOSLOC
DOSCODE:BC4D		     mov     [di+2], ax
DOSCODE:BC50		     mov     di, 82h
DOSCODE:BC53		     mov     word ptr ds:0, offset DIVOV
DOSCODE:BC59		     mov     di, 80h	     ; INTBASE
DOSCODE:BC5C		     mov     ax, offset	irett
DOSCODE:BC5F		     mov     cx, 9
DOSCODE:BC62 iset1:				     ; ...
DOSCODE:BC62		     stosw
DOSCODE:BC63		     add     di, 2
DOSCODE:BC66		     loop    iset1
DOSCODE:BC68		     add     di, 4
DOSCODE:BC6B		     mov     cx, 6
DOSCODE:BC6E iset2:				     ; ...
DOSCODE:BC6E		     stosw
DOSCODE:BC6F		     add     di, 2
DOSCODE:BC72		     loop    iset2
DOSCODE:BC74		     add     di, 8
DOSCODE:BC77		     mov     cx, 14
DOSCODE:BC7A iset3:				     ; ...
DOSCODE:BC7A		     stosw
DOSCODE:BC7B		     add     di, 2
DOSCODE:BC7E		     loop    iset3
DOSCODE:BC80		     mov     word ptr ds:0BCh, offset INT2F
DOSCODE:BC86		     mov     ax, ss:TEMP_DOSLOC
DOSCODE:BC8A		     mov     ds:0BEh, ax
DOSCODE:BC8D		     mov     byte ptr ds:0C0h, 0EAh
DOSCODE:BC92		     mov     word ptr ds:0C1h, offset call_entry
DOSCODE:BC98		     mov     word ptr ds:80h, offset quit
DOSCODE:BC9E		     mov     word ptr ds:84h, offset command
DOSCODE:BCA4		     mov     word ptr ds:88h, 100h
DOSCODE:BCAA		     mov     ds:8Ah, dx
DOSCODE:BCAE		     mov     word ptr ds:94h, offset ABSDRD
DOSCODE:BCB4		     mov     word ptr ds:98h, offset ABSDWRT
DOSCODE:BCBA		     mov     word ptr ds:9Ch, offset stay_resident
DOSCODE:BCC0		     push    ss
DOSCODE:BCC1		     pop     ds
DOSCODE:BCC2		     push    ss
DOSCODE:BCC3		     pop     es
DOSCODE:BCC4		     push    dx
DOSCODE:BCC5		     inc     dx
DOSCODE:BCC6		     mov     ds:CurrentPDB, dx
DOSCODE:BCCA		     xor     di, di
DOSCODE:BCCC		     mov     es, dx
DOSCODE:BCCE		     xor     ax, ax
DOSCODE:BCD0		     mov     cx, 128
DOSCODE:BCD3		     rep stosw
DOSCODE:BCD5		     mov     ax, ds:ENDMEM
DOSCODE:BCD8		     call    SETMEM
DOSCODE:BCDB		     push    ss
DOSCODE:BCDC		     pop     ds
DOSCODE:BCDD		     mov     di, 24
DOSCODE:BCE0		     xor     ax, ax
DOSCODE:BCE2		     stosw
DOSCODE:BCE3		     stosb
DOSCODE:BCE4		     mov     al, 0FFh
DOSCODE:BCE6		     mov     cx, 17
DOSCODE:BCE9		     rep stosb
DOSCODE:BCEB		     push    ss
DOSCODE:BCEC		     pop     es
DOSCODE:BCED		     mov     word ptr ds:SFT_ADDR+2, ds
DOSCODE:BCF1		     mov     si, offset	SysInitTable
DOSCODE:BCF4		     mov     word ptr es:[si+6], es
DOSCODE:BCF8		     mov     word ptr es:[si+2], es
DOSCODE:BCFC		     mov     word ptr es:BUFFHEAD+2, es
DOSCODE:BD01		     mov     si, offset	BufferQueue ; HASHINITVAR
DOSCODE:BD04		     mov     word ptr es:BUFFHEAD, si
DOSCODE:BD09		     pop     dx
DOSCODE:BD0A		     mov     word ptr ds:DMAADD+2, dx
DOSCODE:BD0E		     mov     es:arena_head, dx
DOSCODE:BD13		     mov     ds, dx
DOSCODE:BD15		     mov     byte ptr ds:0, 'Z'
DOSCODE:BD1A		     mov     word ptr ds:1, 0
DOSCODE:BD20		     mov     ax, ss:ENDMEM
DOSCODE:BD24		     sub     ax, dx
DOSCODE:BD26		     dec     ax
DOSCODE:BD27		     mov     ds:3, ax
DOSCODE:BD2A		     mov     di, offset	SFT0_SFTable
DOSCODE:BD2D		     mov     ax, 3
DOSCODE:BD30		     stosw
DOSCODE:BD31		     mov     di, offset	SysInitTable
DOSCODE:BD34		     inc     dx
DOSCODE:BD35		     mov     ds, dx
DOSCODE:BD37		     mov     dx, offset	_seg_reinit
DOSCODE:BD3A		     mov     cx, offset	exepatch_start
DOSCODE:BD3D		     sub     cx, offset	$STARTCODE
DOSCODE:BD41		     mov     ax, offset	initiret
DOSCODE:BD44		     sub     ax, offset	$STARTCODE
DOSCODE:BD47		     mov     sp, ss:USER_SP
DOSCODE:BD4C		     mov     ss, ss:USER_SS
DOSCODE:BD51		     retf
DOSCODE:BD52 ; =============== S U B R O U T I N E =======================================
DOSCODE:BD52 CHARINIT	     proc near		     ; ...
DOSCODE:BD52		     mov     ss:DEVCALL, 26
DOSCODE:BD58		     mov     ss:DEVCALL_REQUNIT, 0
DOSCODE:BD5E		     mov     ss:DEVCALL_REQFUNC, 0
DOSCODE:BD64		     mov     ss:DEVCALL_REQSTAT, 0
DOSCODE:BD6B		     push    es
DOSCODE:BD6C		     push    bx
DOSCODE:BD6D		     push    ax
DOSCODE:BD6E		     mov     bx, offset	DEVCALL
DOSCODE:BD71		     push    ss
DOSCODE:BD72		     pop     es
DOSCODE:BD73		     call    DEVIOCALL2
DOSCODE:BD76		     pop     ax
DOSCODE:BD77		     pop     bx
DOSCODE:BD78		     pop     es
DOSCODE:BD79		     retn
DOSCODE:BD79 CHARINIT	     endp
DOSCODE:BD7A ; =============== S U B R O U T I N E =======================================
DOSCODE:BD7A check_XMM	     proc near		     ; ...
DOSCODE:BD7A		     push    ax
DOSCODE:BD7B		     mov     ax, 4300h
DOSCODE:BD7E		     int     2Fh	     ; - Multiplex - XMS - INSTALLATION	CHECK
DOSCODE:BD7E					     ; Return: AL = 80h	XMS driver installed
DOSCODE:BD7E					     ; AL <> 80h no driver
DOSCODE:BD80		     cmp     al, 80h
DOSCODE:BD82		     jnz     short cXMM_no_driver
DOSCODE:BD84		     push    bx
DOSCODE:BD85		     push    dx
DOSCODE:BD86		     push    ds
DOSCODE:BD87		     push    es
DOSCODE:BD88		     mov     ax, 4310h
DOSCODE:BD8B		     int     2Fh	     ; - Multiplex - XMS - GET DRIVER ADDRESS
DOSCODE:BD8B					     ; Return: ES:BX ->	driver entry point
DOSCODE:BD8D		     mov     ds, cs:DosDSeg
DOSCODE:BD92		     mov     word ptr ds:XMMcontrol, bx
DOSCODE:BD96		     mov     word ptr ds:XMMcontrol+2, es
DOSCODE:BD9A		     clc
DOSCODE:BD9B		     pop     es
DOSCODE:BD9C		     pop     ds
DOSCODE:BD9D		     pop     dx
DOSCODE:BD9E		     pop     bx
DOSCODE:BD9F		     pop     ax
DOSCODE:BDA0		     retn
DOSCODE:BDA1 cXMM_no_driver:			     ; ...
DOSCODE:BDA1		     stc
DOSCODE:BDA2		     pop     ax
DOSCODE:BDA3		     retn
DOSCODE:BDA3 check_XMM	     endp
DOSCODE:BDA4 num_entry	     db	0		     ; ...
DOSCODE:BDA5 _seg_reinit:			     ; ...
DOSCODE:BDA5		     push    ds
DOSCODE:BDA6		     mov     ds, cs:DosDSeg
DOSCODE:BDAB		     call    patch_misc_segments
DOSCODE:BDAE		     cmp     ax, 0
DOSCODE:BDB1		     jnz     short patch_vec_seg
DOSCODE:BDB3		     cmp     cs:num_entry, 0
DOSCODE:BDB9		     jnz     short second_entry
DOSCODE:BDBB		     mov     ax, ds
DOSCODE:BDBD		     call    patch_vec_segments
DOSCODE:BDC0		     call    patch_offset
DOSCODE:BDC3 second_entry:			     ; ...
DOSCODE:BDC3		     mov     ax, es
DOSCODE:BDC5		     mov     di, offset	DOSINTTABLE
DOSCODE:BDC8		     mov     cx, 9
DOSCODE:BDCB		     push    ds
DOSCODE:BDCC		     pop     es
DOSCODE:BDCD dosinttabloop:			     ; ...
DOSCODE:BDCD		     add     di, 2
DOSCODE:BDD0		     stosw
DOSCODE:BDD1		     loop    dosinttabloop
DOSCODE:BDD3		     cmp     ax, 0F000h
DOSCODE:BDD6		     jb	     short sr_done
DOSCODE:BDD8		     call    check_XMM
DOSCODE:BDDB		     jb	     short sr_done
DOSCODE:BDDD		     call    patch_in_nops
DOSCODE:BDE0		     mov     ds:DosHasHMA, 1
DOSCODE:BDE5		     mov     ds:FixExePatch, offset ExePatch
DOSCODE:BDEB		     mov     ds:ChkCopyProt, offset IsCopyProt
DOSCODE:BDF1		     call    WhatCPUType
DOSCODE:BDF4		     cmp     al, 1
DOSCODE:BDF6		     jnz     short sr_done
DOSCODE:BDF8		     mov     ds:RationalPatchPtr, offset RationalPatch
DOSCODE:BDFE		     jmp     short sr_done
DOSCODE:BE00 patch_vec_seg:			     ; ...
DOSCODE:BE00		     mov     ax, es
DOSCODE:BE02		     call    patch_vec_segments
DOSCODE:BE05 sr_done:				     ; ...
DOSCODE:BE05		     mov     cs:num_entry, 1
DOSCODE:BE0B		     pop     ds
DOSCODE:BE0C		     retf
DOSCODE:BE0D ; =============== S U B R O U T I N E =======================================
DOSCODE:BE0D WhatCPUType     proc near		     ; ...
DOSCODE:BE0D		     pushf
DOSCODE:BE0E		     push    bx
DOSCODE:BE0F		     xor     bx, bx
DOSCODE:BE11		     xor     ax, ax
DOSCODE:BE13		     push    ax
DOSCODE:BE14		     popf
DOSCODE:BE15		     pushf
DOSCODE:BE16		     pop     ax
DOSCODE:BE17		     and     ax, 0F000h
DOSCODE:BE1A		     cmp     ax, 0F000h
DOSCODE:BE1D		     jz	     short cpu_8086
DOSCODE:BE1F		     mov     ax, 0F000h
DOSCODE:BE22		     push    ax
DOSCODE:BE23		     popf
DOSCODE:BE24		     pushf
DOSCODE:BE25		     pop     ax
DOSCODE:BE26		     and     ax, 0F000h
DOSCODE:BE29		     jz	     short cpu_286
DOSCODE:BE2B cpu_386:
DOSCODE:BE2B		     inc     bx
DOSCODE:BE2C cpu_286:				     ; ...
DOSCODE:BE2C		     inc     bx
DOSCODE:BE2D cpu_8086:				     ; ...
DOSCODE:BE2D		     mov     ax, bx
DOSCODE:BE2F		     pop     bx
DOSCODE:BE30		     popf
DOSCODE:BE31		     retn
DOSCODE:BE31 WhatCPUType     endp
DOSCODE:BE32 ; =============== S U B R O U T I N E =======================================
DOSCODE:BE32 patch_vec_segments	proc near	     ; ...
DOSCODE:BE32		     push    es
DOSCODE:BE33		     xor     cx, cx
DOSCODE:BE35		     mov     es, cx
DOSCODE:BE37		     mov     di, 82h	     ; INTBASE+2
DOSCODE:BE3A		     mov     es:2, ax
DOSCODE:BE3E		     mov     cx, 2
DOSCODE:BE41 ps_set1:				     ; ...
DOSCODE:BE41		     stosw
DOSCODE:BE42		     add     di, 2
DOSCODE:BE45		     loop    ps_set1
DOSCODE:BE47		     add     di, 4
DOSCODE:BE4A		     stosw
DOSCODE:BE4B		     add     di, 6
DOSCODE:BE4E		     mov     cx, 4
DOSCODE:BE51 ps_set2:				     ; ...
DOSCODE:BE51		     stosw
DOSCODE:BE52		     add     di, 2
DOSCODE:BE55		     loop    ps_set2
DOSCODE:BE57		     add     di, 4
DOSCODE:BE5A		     mov     cx, 6
DOSCODE:BE5D ps_set3:				     ; ...
DOSCODE:BE5D		     stosw
DOSCODE:BE5E		     add     di, 2
DOSCODE:BE61		     loop    ps_set3
DOSCODE:BE63		     add     di, 8
DOSCODE:BE66		     mov     cx, 14
DOSCODE:BE69 ps_set4:				     ; ...
DOSCODE:BE69		     stosw
DOSCODE:BE6A		     add     di, 2
DOSCODE:BE6D		     loop    ps_set4
DOSCODE:BE6F		     mov     es:0C3h, ax
DOSCODE:BE73		     pop     es
DOSCODE:BE74		     retn
DOSCODE:BE74 patch_vec_segments	endp
DOSCODE:BE75 ; =============== S U B R O U T I N E =======================================
DOSCODE:BE75 patch_misc_segments proc near	     ; ...
DOSCODE:BE75		     push    bx
DOSCODE:BE76		     push    es
DOSCODE:BE77		     push    ax
DOSCODE:BE78		     mov     ax, es
DOSCODE:BE7A		     push    ds
DOSCODE:BE7B		     pop     es
DOSCODE:BE7C		     mov     di, offset	JShare
DOSCODE:BE7F		     mov     bx, ds:TEMP_DOSLOC
DOSCODE:BE83		     mov     cx, 15
DOSCODE:BE86 jumptabloop:			     ; ...
DOSCODE:BE86		     add     di, 2
DOSCODE:BE89		     cmp     bx, 0FFFFh
DOSCODE:BE8C		     jz	     short share_patch
DOSCODE:BE8E		     cmp     bx, es:[di]
DOSCODE:BE91		     jnz     short no_share_patch
DOSCODE:BE93 share_patch:			     ; ...
DOSCODE:BE93		     stosw
DOSCODE:BE94 no_share_patch:			     ; ...
DOSCODE:BE94		     loop    jumptabloop
DOSCODE:BE96		     mov     si, offset	COUNTRY_CDPG
DOSCODE:BE99		     mov     word ptr [si+4Fh],	ds
DOSCODE:BE9C		     mov     word ptr [si+54h],	ds
DOSCODE:BE9F		     mov     word ptr [si+59h],	ds
DOSCODE:BEA2		     mov     word ptr [si+5Eh],	ds
DOSCODE:BEA5		     mov     word ptr [si+80h],	ds
DOSCODE:BEA9		     mov     word ptr [si+63h],	ds
DOSCODE:BEAC		     mov     si, offset	FastOpenTable
DOSCODE:BEAF		     cmp     ds:TEMP_DOSLOC, 0FFFFh
DOSCODE:BEB4		     jz	     short fast_patch
DOSCODE:BEB6		     mov     cx, ds:TEMP_DOSLOC
DOSCODE:BEBA		     cmp     cx, [si+4]
DOSCODE:BEBD		     jnz     short no_fast_patch
DOSCODE:BEBF fast_patch:			     ; ...
DOSCODE:BEBF		     mov     [si+4], ax
DOSCODE:BEC2 no_fast_patch:			     ; ...
DOSCODE:BEC2		     pop     ax
DOSCODE:BEC3		     pop     es
DOSCODE:BEC4		     pop     bx
DOSCODE:BEC5		     retn
DOSCODE:BEC5 patch_misc_segments endp
DOSCODE:BEC6 ; =============== S U B R O U T I N E =======================================
DOSCODE:BEC6 patch_offset    proc near		     ; ...
DOSCODE:BEC6		     push    es
DOSCODE:BEC7		     xor     ax, ax
DOSCODE:BEC9		     mov     es, ax
DOSCODE:BECB		     mov     word ptr es:0, offset ldivov
DOSCODE:BED2		     mov     di, 80h
DOSCODE:BED5		     mov     ax, offset	lirett
DOSCODE:BED8		     mov     cx, 2
DOSCODE:BEDB po_iset1:				     ; ...
DOSCODE:BEDB		     stosw
DOSCODE:BEDC		     add     di, 2
DOSCODE:BEDF		     loop    po_iset1
DOSCODE:BEE1		     add     di, 4
DOSCODE:BEE4		     stosw
DOSCODE:BEE5		     add     di, 6
DOSCODE:BEE8		     mov     cx, 4
DOSCODE:BEEB po_iset2:				     ; ...
DOSCODE:BEEB		     stosw
DOSCODE:BEEC		     add     di, 2
DOSCODE:BEEF		     loop    po_iset2
DOSCODE:BEF1		     add     di, 4
DOSCODE:BEF4		     mov     cx, 6
DOSCODE:BEF7 po_iset3:				     ; ...
DOSCODE:BEF7		     stosw
DOSCODE:BEF8		     add     di, 2
DOSCODE:BEFB		     loop    po_iset3
DOSCODE:BEFD		     add     di, 8
DOSCODE:BF00		     mov     cx, 14
DOSCODE:BF03 po_iset4:				     ; ...
DOSCODE:BF03		     stosw
DOSCODE:BF04		     add     di, 2
DOSCODE:BF07		     loop    po_iset4
DOSCODE:BF09		     mov     word ptr es:0BCh, offset lint2f
DOSCODE:BF10		     mov     byte ptr es:0C0h, 0EAh
DOSCODE:BF16		     mov     word ptr es:0C1h, offset lcall_entry
DOSCODE:BF1D		     mov     word ptr es:80h, offset lquit
DOSCODE:BF24		     mov     word ptr es:84h, offset lcommand
DOSCODE:BF2B		     mov     word ptr es:94h, offset labsdrd
DOSCODE:BF32		     mov     word ptr es:98h, offset labsdwrt
DOSCODE:BF39		     mov     word ptr es:9Ch, offset lstay_resident
DOSCODE:BF40		     pop     es
DOSCODE:BF41		     retn
DOSCODE:BF41 patch_offset    endp
DOSCODE:BF42 patch_table     dw	offset ldivov	     ; ...
DOSCODE:BF44		     dw	offset lquit
DOSCODE:BF46		     dw	offset lcommand
DOSCODE:BF48		     dw	offset labsdrd
DOSCODE:BF4A		     dw	offset labsdwrt
DOSCODE:BF4C		     dw	offset lstay_resident
DOSCODE:BF4E		     dw	offset lint2f
DOSCODE:BF50		     dw	offset lcall_entry
DOSCODE:BF52 ; =============== S U B R O U T I N E =======================================
DOSCODE:BF52 patch_in_nops   proc near		     ; ...
DOSCODE:BF52		     push    ax
DOSCODE:BF53		     push    si
DOSCODE:BF54		     mov     si, offset	patch_table
DOSCODE:BF57		     mov     ax, 9090h
DOSCODE:BF5A		     mov     cx, 8
DOSCODE:BF5D pin_loop:				     ; ...
DOSCODE:BF5D		     mov     di, cs:[si]
DOSCODE:BF60		     stosw
DOSCODE:BF61		     add     si, 2
DOSCODE:BF64		     loop    pin_loop
DOSCODE:BF66		     pop     si
DOSCODE:BF67		     pop     ax
DOSCODE:BF68		     retn
DOSCODE:BF68 patch_in_nops   endp
DOSCODE:BF69 MEMSTRT	     db	7 dup(0)	     ; ...
DOSCODE:BF69 DOSCODE	     ends
DOSDATA:0000 ; ===========================================================================
DOSDATA:0000 ; Segment type: Pure data
DOSDATA:0000 DOSDATA	     segment byte public 'DATA' use16
DOSDATA:0000		     assume cs:DOSDATA
DOSDATA:0000 byte_BF70	     db	4 dup(0)	     ; ...
DOSDATA:0004 DataVersion     dw	1		     ; ...
DOSDATA:0006 WinoldPatch1    db	8 dup(0)	     ; ...
DOSDATA:000E MYNUM	     dw	0		     ; ...
DOSDATA:0010 FCBLRU	     dw	0		     ; ...
DOSDATA:0012 OpenLRU	     dw	0
DOSDATA:0014 OEM_HANDLER     dd	0FFFFFFFFh	     ; ...
DOSDATA:0018 LeaveAddr	     dw	offset LeaveDOS	     ; ...
DOSDATA:001A RetryCount	     dw	3		     ; ...
DOSDATA:001C RetryLoop	     dw	1		     ; ...
DOSDATA:001E LastBuffer	     dd	0FFFFFFFFh	     ; ...
DOSDATA:0022 CONTPOS	     dw	0		     ; ...
DOSDATA:0024 arena_head	     dw	0		     ; ...
DOSDATA:0026 DPBHEAD	     dd	0		     ; ...
DOSDATA:002A SFT_ADDR	     dd	offset SFTABL	     ; ...
DOSDATA:002E BCLOCK	     dd	0		     ; ...
DOSDATA:0032 BCON	     dd	0		     ; ...
DOSDATA:0036 MAXSEC	     dw	128		     ; ...
DOSDATA:0038 BUFFHEAD	     dd	0		     ; ...
DOSDATA:003C CDSADDR	     dd	0		     ; ...
DOSDATA:0040 SFTFCB	     dd	0		     ; ...
DOSDATA:0044 KEEPCOUNT	     dw	0
DOSDATA:0046 NUMIO	     db	0		     ; ...
DOSDATA:0047 CDSCOUNT	     db	0		     ; ...
DOSDATA:0048 NULDEV	     dd	0		     ; ...
DOSDATA:004C		     dw	8004h		     ; DEVTYP|ISNULL
DOSDATA:004E		     dw	offset SNULDEV
DOSDATA:0050 off_BFC0	     dw	offset INULDEV	     ; ...
DOSDATA:0052 aNul	     db	'NUL     '           ; ...
DOSDATA:005A SPLICES	     db	0		     ; ...
DOSDATA:005B Special_Entries dw	0
DOSDATA:005D UU_IFS_DOS_CALL dd	0		     ; ...
DOSDATA:0061 ChkCopyProt     dw	0		     ; ...
DOSDATA:0063 A20OFF_PSP	     dw	0		     ; ...
DOSDATA:0065 BUFFERS_PARM1   dw	0
DOSDATA:0067 BUFFERS_PARM2   dw	0
DOSDATA:0069 BOOTDRIVE	     db	0		     ; ...
DOSDATA:006A DDMOVE	     db	0		     ; ...
DOSDATA:006B EXT_MEM_SIZE    dw	0
DOSDATA:006D BufferQueue     dd	0		     ; ...
DOSDATA:0071 DirtyBufferCount dw 0		     ; ...
DOSDATA:0073 SC_CACHE_PTR    dd	0		     ; ...
DOSDATA:0077 SC_CACHE_COUNT  dw	0		     ; ...
DOSDATA:0079 BuffInHMA	     db	0		     ; ...
DOSDATA:007A LoMemBuff	     dd	0		     ; ...
DOSDATA:007E UU_BUF_EMS_FIRST_PAGE db 3	dup(0)	     ; ...
DOSDATA:0081 CL0FATENTRY     dw	0FFFFh		     ; ...
DOSDATA:0083 IoStatFail	     db	0		     ; ...
DOSDATA:0084 ALLOCMSAVE	     db	0		     ; ...
DOSDATA:0085 A20OFF_COUNT    db	0		     ; ...
DOSDATA:0086 DOS_FLAG	     db	0		     ; ...
DOSDATA:0087 UNPACK_OFFSET   dw	0		     ; ...
DOSDATA:0089 UMBFLAG	     db	0		     ; ...
DOSDATA:008A SAVE_AX	     dw	0		     ; ...
DOSDATA:008C UMB_HEAD	     dw	0FFFFh		     ; ...
DOSDATA:008E START_ARENA     dw	1		     ; ...
DOSDATA:0090 JShare	     dd	BadCall		     ; ...
DOSDATA:0094 MFT_enter	     dd	OKCall		     ; ...
DOSDATA:0098 MFTClose	     dd	OKCall		     ; ...
DOSDATA:009C MFTclU	     dd	BadCall		     ; ...
DOSDATA:00A0 MFTCloseP	     dd	BadCall		     ; ...
DOSDATA:00A4 MFTCloN	     dd	BadCall		     ; ...
DOSDATA:00A8 set_block	     dd	BadCall		     ; ...
DOSDATA:00AC clr_block	     dd	BadCall		     ; ...
DOSDATA:00B0 chk_block	     dd	OKCall		     ; ...
DOSDATA:00B4 MFT_get	     dd	BadCall		     ; ...
DOSDATA:00B8 ShSave	     dd	BadCall		     ; ...
DOSDATA:00BC ShChk	     dd	BadCall		     ; ...
DOSDATA:00C0 ShCol	     dd	OKCall		     ; ...
DOSDATA:00C4 ShCloseFile     dd	BadCall		     ; ...
DOSDATA:00C8 ShSU	     dd	BadCall		     ; ...
DOSDATA:00CC SFTABL	     dd	0FFFFFFFFh	     ; ...
DOSDATA:00D0		     dw	5
DOSDATA:00D2 SFT0_SFTable    db	295 dup(0)	     ; ...
DOSDATA:01F9 CARPOS	     db	0		     ; ...
DOSDATA:01FA STARTPOS	     db	0		     ; ...
DOSDATA:01FB INBUF	     db	128 dup(0)	     ; ...
DOSDATA:027B CONBUF	     db	131 dup(0)	     ; ...
DOSDATA:02FE PFLAG	     db	0		     ; ...
DOSDATA:02FF VERFLG	     db	0		     ; ...
DOSDATA:0300 CHARCO	     db	3		     ; ...
DOSDATA:0301 chSwitch	     db	'/'
DOSDATA:0302 AllocMethod     db	0		     ; ...
DOSDATA:0303 fShare	     db	0		     ; ...
DOSDATA:0304 DIFFNAM	     db	1		     ; ...
DOSDATA:0305 MYNAME	     db	16 dup(32)	     ; ...
DOSDATA:0315 CritPatch	     dw	offset redir_patch   ; ...
DOSDATA:0317		     dw	offset redir_patch
DOSDATA:0319		     dw	offset redir_patch
DOSDATA:031B		     dw	offset redir_patch
DOSDATA:031D		     dw	0
DOSDATA:031F		     db	90h
DOSDATA:0320 ERRORMODE	     db	0		     ; ...
DOSDATA:0321 INDOS	     db	0		     ; ...
DOSDATA:0322 WPERR	     db	0FFh		     ; ...
DOSDATA:0323 EXTERR_LOCUS    db	0		     ; ...
DOSDATA:0324 EXTERR	     dw	0		     ; ...
DOSDATA:0326 EXTERR_ACT_CLASS dw 0		     ; ...
DOSDATA:0328 EXTERRPT	     dd	0		     ; ...
DOSDATA:032C DMAADD	     dd	80h		     ; ...
DOSDATA:0330 CurrentPDB	     dw	0		     ; ...
DOSDATA:0332 ConC_Spsave     dw	0		     ; ...
DOSDATA:0334 exit_code	     dw	0		     ; ...
DOSDATA:0336 CURDRV	     db	0		     ; ...
DOSDATA:0337 CNTCFLAG	     db	0		     ; ...
DOSDATA:0338 CPSWFLAG	     db	0
DOSDATA:0339 CPSWSAVE	     db	0
DOSDATA:033A USER_IN_AX	     dw	0		     ; ...
DOSDATA:033C PROC_ID	     dw	0		     ; ...
DOSDATA:033E USER_ID	     dw	0		     ; ...
DOSDATA:0340 FirstArena	     dw	0		     ; ...
DOSDATA:0342 BestArena	     dw	0		     ; ...
DOSDATA:0344 LastArena	     dw	0		     ; ...
DOSDATA:0346 ENDMEM	     dw	0		     ; ...
DOSDATA:0348 LASTENT	     dw	0		     ; ...
DOSDATA:034A FAILERR	     db	0		     ; ...
DOSDATA:034B ALLOWED	     db	0		     ; ...
DOSDATA:034C NoSetDir	     db	0		     ; ...
DOSDATA:034D DidCTRLC	     db	0		     ; ...
DOSDATA:034E SpaceFlag	     db	0		     ; ...
DOSDATA:034F		     db	90h
DOSDATA:0350 DAY	     db	0		     ; ...
DOSDATA:0351 MONTH	     db	0		     ; ...
DOSDATA:0352 YEAR	     dw	0		     ; ...
DOSDATA:0354 DAYCNT	     dw	0FFFFh		     ; ...
DOSDATA:0356 WEEKDAY	     db	0		     ; ...
DOSDATA:0357 CONSWAP	     db	0		     ; ...
DOSDATA:0358 IDLEINT	     db	1		     ; ...
DOSDATA:0359 fAborting	     db	0		     ; ...
DOSDATA:035A DEVCALL	     db	0		     ; ...
DOSDATA:035B DEVCALL_REQUNIT db	0		     ; ...
DOSDATA:035C DEVCALL_REQFUNC db	0		     ; ...
DOSDATA:035D DEVCALL_REQSTAT dw	0		     ; ...
DOSDATA:035F		     db	8 dup(0)
DOSDATA:0367 CALLUNIT	     db	0		     ; ...
DOSDATA:0368 CALLBR	     dd	0		     ; ...
DOSDATA:036C CALLBPB	     dd	0		     ; ...
DOSDATA:0370 CALLVIDRW	     dd	0		     ; ...
DOSDATA:0374 CALLNEWSC	     dd	0		     ; ...
DOSDATA:0378 CALLDEVAD	     dd	0		     ; ...
DOSDATA:037C IOCALL	     db	0		     ; ...
DOSDATA:037D IOCALL_REQUNIT  db	0		     ; ...
DOSDATA:037E IOCALL_REQFUNC  db	0		     ; ...
DOSDATA:037F IOCALL_REQSTAT  dw	0		     ; ...
DOSDATA:0381		     db	8 dup(0)
DOSDATA:0389 IOMED	     db	0		     ; ...
DOSDATA:038A IOXAD	     dd	0		     ; ...
DOSDATA:038E IOSCNT	     dw	0		     ; ...
DOSDATA:0390 IOSSEC	     dw	0		     ; ...
DOSDATA:0392 DSKSTCALL	     db	14		     ; ...
DOSDATA:0393		     db	0
DOSDATA:0394 DSKSTCOM	     db	5		     ; ...
DOSDATA:0395 DSKSTST	     dw	0		     ; ...
DOSDATA:0397		     db	8 dup(0)
DOSDATA:039F DSKCHRET	     db	0		     ; ...
DOSDATA:03A0 DEVIOBUF_PTR    dw	offset DEVIOBUF	     ; ...
DOSDATA:03A2 DOSSEG_INIT     dw	0		     ; ...
DOSDATA:03A4 DSKSTCNT	     dw	1		     ; ...
DOSDATA:03A6		     dw	0
DOSDATA:03A8 CreatePDB	     db	0		     ; ...
DOSDATA:03A9 Lock_Buffer     dd	0		     ; ...
DOSDATA:03AD		     dd	0
DOSDATA:03B1		     db	90h
DOSDATA:03B2 USERNUM	     dw	0		     ; ...
DOSDATA:03B4 USERNUM_hb	     db	0		     ; ...
DOSDATA:03B5 OEMNUM	     db	0FFh
DOSDATA:03B6 TIMEBUF	     dw	3 dup(0)	     ; ...
DOSDATA:03BC DEVIOBUF	     dw	0		     ; ...
DOSDATA:03BE OPENBUF	     db	128 dup(0)	     ; ...
DOSDATA:043E RENBUF	     db	128 dup(0)	     ; ...
DOSDATA:04BE SEARCHBUF	     db	53 dup(0)	     ; ...
DOSDATA:04F3 DUMMYCDS	     db	88 dup(0)	     ; ...
DOSDATA:054B NAME1	     db	12 dup(0)	     ; ...
DOSDATA:0557 NAME2	     db	13 dup(0)	     ; ...
DOSDATA:0564 DESTSTART	     dw	0		     ; ...
DOSDATA:0566		     db	5 dup(0)
DOSDATA:056B ATTRIB	     db	0		     ; ...
DOSDATA:056C EXTFCB	     db	0		     ; ...
DOSDATA:056D SATTRIB	     db	0		     ; ...
DOSDATA:056E OPEN_ACCESS     db	0		     ; ...
DOSDATA:056F FOUNDDEL	     db	0		     ; ...
DOSDATA:0570 FOUND_DEV	     db	0		     ; ...
DOSDATA:0571 FSPLICE	     db	0		     ; ...
DOSDATA:0572 FSHARING	     db	0		     ; ...
DOSDATA:0573 SECCLUSPOS	     db	0		     ; ...
DOSDATA:0574 TRANS	     db	0		     ; ...
DOSDATA:0575 READOP	     db	0		     ; ...
DOSDATA:0576 THISDRV	     db	0		     ; ...
DOSDATA:0577 CLUSFAC	     db	0		     ; ...
DOSDATA:0578 CLUSSPLIT	     db	0		     ; ...
DOSDATA:0579 INSMODE	     db	0		     ; ...
DOSDATA:057A CMETA	     db	0		     ; ...
DOSDATA:057B VOLID	     db	0		     ; ...
DOSDATA:057C EXIT_TYPE	     db	0		     ; ...
DOSDATA:057D		     db	90h
DOSDATA:057E CREATING	     db	0		     ; ...
DOSDATA:057F DELALL	     db	0		     ; ...
DOSDATA:0580 EXITHOLD	     dd	0		     ; ...
DOSDATA:0584 USER_SP	     dw	0		     ; ...
DOSDATA:0586 USER_SS	     dw	0		     ; ...
DOSDATA:0588 CONTSTK	     dw	0		     ; ...
DOSDATA:058A THISDPB	     dd	0		     ; ...
DOSDATA:058E CLUSSAVE	     dw	0		     ; ...
DOSDATA:0590 CLUSSEC	     dw	2 dup(0)	     ; ...
DOSDATA:0594 PREREAD	     dw	0		     ; ...
DOSDATA:0596 FATBYT	     dw	0		     ; ...
DOSDATA:0598 FATBYTE	     dw	0		     ; ...
DOSDATA:059A DEVPT	     dd	0		     ; ...
DOSDATA:059E THISSFT	     dd	0		     ; ...
DOSDATA:05A2 THISCDS	     dd	0		     ; ...
DOSDATA:05A6 THISFCB	     dd	0		     ; ...
DOSDATA:05AA SFN	     dw	0FFFFh		     ; ...
DOSDATA:05AC JFN	     dw	0		     ; ...
DOSDATA:05AE PJFN	     dd	0		     ; ...
DOSDATA:05B2 WFP_START	     dw	0		     ; ...
DOSDATA:05B4 REN_WFP	     dw	0		     ; ...
DOSDATA:05B6 CURR_DIR_END    dw	0		     ; ...
DOSDATA:05B8 NEXTADD	     dw	0		     ; ...
DOSDATA:05BA LASTPOS	     dw	0		     ; ...
DOSDATA:05BC CLUSNUM	     dw	0		     ; ...
DOSDATA:05BE DIRSEC	     dw	2 dup(0)	     ; ...
DOSDATA:05C2 DIRSTART	     dw	0		     ; ...
DOSDATA:05C4 SECPOS	     dw	2 dup(0)	     ; ...
DOSDATA:05C8 VALSEC	     dw	2 dup(0)	     ; ...
DOSDATA:05CC BYTSECPOS	     dw	0		     ; ...
DOSDATA:05CE BYTPOS	     dw	2 dup(0)	     ; ...
DOSDATA:05D2 BYTCNT1	     dw	0		     ; ...
DOSDATA:05D4 BYTCNT2	     dw	0		     ; ...
DOSDATA:05D6 SECCNT	     dw	0		     ; ...
DOSDATA:05D8 ENTFREE	     dw	0		     ; ...
DOSDATA:05DA ENTLAST	     dw	0		     ; ...
DOSDATA:05DC NXTCLUSNUM	     dw	0		     ; ...
DOSDATA:05DE GROWCNT	     dw	2 dup(0)	     ; ...
DOSDATA:05E2 CURBUF	     dd	0		     ; ...
DOSDATA:05E6 CONSFT	     dd	0		     ; ...
DOSDATA:05EA SAVEBX	     dw	0		     ; ...
DOSDATA:05EC SAVEDS	     dw	0		     ; ...
DOSDATA:05EE RESTORE_TMP     dw	0		     ; ...
DOSDATA:05F0 NSS	     dw	0		     ; ...
DOSDATA:05F2 NSP	     dw	0		     ; ...
DOSDATA:05F4 EXTOPEN_FLAG    dw	0		     ; ...
DOSDATA:05F6 EXTOPEN_ON	     db	0		     ; ...
DOSDATA:05F7 EXTOPEN_IO_MODE dw	0		     ; ...
DOSDATA:05F9 SAVE_DI	     dw	0		     ; ...
DOSDATA:05FB SAVE_ES	     dw	0		     ; ...
DOSDATA:05FD SAVE_DX	     dw	0		     ; ...
DOSDATA:05FF SAVE_CX	     dw	0		     ; ...
DOSDATA:0601 SAVE_BX	     dw	0		     ; ...
DOSDATA:0603 SAVE_SI	     dw	0		     ; ...
DOSDATA:0605 SAVE_DS	     dw	0		     ; ...
DOSDATA:0607 HIGH_SECTOR     dw	0		     ; ...
DOSDATA:0609 OffsetMagicPatch dw offset	MagicPatch   ; ...
DOSDATA:060B DISK_FULL	     db	0		     ; ...
DOSDATA:060C TEMP_VAR	     dw	0		     ; ...
DOSDATA:060E TEMP_VAR2	     dw	0		     ; ...
DOSDATA:0610 DrvErr	     db	0		     ; ...
DOSDATA:0611 DOS34_FLAG	     dw	0		     ; ...
DOSDATA:0613 NO_FILTER_PATH  dd	0
DOSDATA:0617 NO_FILTER_DPATH dd	0
DOSDATA:061B AbsRdWr_SS	     dw	0		     ; ...
DOSDATA:061D AbsRdWr_SP	     dw	0		     ; ...
DOSDATA:061F		     db	0
DOSDATA:0620 RENAMEDMA	     db	180h dup(0)	     ; ...
DOSDATA:07A0 AUXSTACK	     db	384 dup(0)	     ; ...
DOSDATA:0920 DSKSTACK	     db	384 dup(0)	     ; ...
DOSDATA:0AA0 PRINTER_FLAG    db	0		     ; ...
DOSDATA:0AA1 VOLCHNG_FLAG    db	0		     ; ...
DOSDATA:0AA2 VIRTUAL_OPEN    db	0		     ; ...
DOSDATA:0AA3 FSeek_drive     db	0
DOSDATA:0AA4 FSeek_firclus   dw	0
DOSDATA:0AA6 FSeek_logclus   dw	0
DOSDATA:0AA8 FSeek_logsave   dw	0
DOSDATA:0AAA TEMP_DOSLOC     dw	0FFFFh		     ; ...
DOSDATA:0AAC SWAP_END	     db	0		     ; ...
DOSDATA:0AAD UCASE_TAB	     dw	128		     ; ...
DOSDATA:0AAF UCASE_TAB_2     db	128, 154, 69, 65, 142, 65, 143,	128, 3 dup(69),	3 dup(73) ; ...
DOSDATA:0AAF		     db	142, 143, 144, 2 dup(146), 79, 153, 79,	2 dup(85), 89
DOSDATA:0AAF		     db	153, 154, 155, 156, 157, 158, 159, 65, 73, 79, 85, 2 dup(165)
DOSDATA:0AAF		     db	166, 167, 168, 169, 170, 171, 172, 173,	174, 175, 176
DOSDATA:0AAF		     db	177, 178, 179, 180, 181, 182, 183, 184,	185, 186, 187
DOSDATA:0AAF		     db	188, 189, 190, 191, 192, 193, 194, 195,	196, 197, 198
DOSDATA:0AAF		     db	199, 200, 201, 202, 203, 204, 205, 206,	207, 208, 209
DOSDATA:0AAF		     db	210, 211, 212, 213, 214, 215, 216, 217,	218, 219, 220
DOSDATA:0AAF		     db	221, 222, 223, 224, 225, 226, 227, 228,	229, 230, 231
DOSDATA:0AAF		     db	232, 233, 234, 235, 236, 237, 238, 239,	240, 241, 242
DOSDATA:0AAF		     db	243, 244, 245, 246, 247, 248, 249, 250,	251, 252, 253
DOSDATA:0AAF		     db	254, 255
DOSDATA:0B2F FILE_UCASE_TAB  dw	128		     ; ...
DOSDATA:0B31 FILE_UCASE_TAB_2 db 128, 154, 69, 65, 142,	65, 143, 128, 3	dup(69), 3 dup(73) ; ...
DOSDATA:0B31		     db	142, 143, 144, 2 dup(146), 79, 153, 79,	2 dup(85), 89
DOSDATA:0B31		     db	153, 154, 155, 156, 157, 158, 159, 65, 73, 79, 85, 2 dup(165)
DOSDATA:0B31		     db	166, 167, 168, 169, 170, 171, 172, 173,	174, 175, 176
DOSDATA:0B31		     db	177, 178, 179, 180, 181, 182, 183, 184,	185, 186, 187
DOSDATA:0B31		     db	188, 189, 190, 191, 192, 193, 194, 195,	196, 197, 198
DOSDATA:0B31		     db	199, 200, 201, 202, 203, 204, 205, 206,	207, 208, 209
DOSDATA:0B31		     db	210, 211, 212, 213, 214, 215, 216, 217,	218, 219, 220
DOSDATA:0B31		     db	221, 222, 223, 224, 225, 226, 227, 228,	229, 230, 231
DOSDATA:0B31		     db	232, 233, 234, 235, 236, 237, 238, 239,	240, 241, 242
DOSDATA:0B31		     db	243, 244, 245, 246, 247, 248, 249, 250,	251, 252, 253
DOSDATA:0B31		     db	254, 255
DOSDATA:0BB1 FILE_CHAR_TAB   dw	22		     ; ...
DOSDATA:0BB3		     db	1, 0, 255, 2 dup(0), 32, 2, 14
DOSDATA:0BBB a_		     db	'."/\[]:|<>+=;,'
DOSDATA:0BC9		     db	24 dup(0)
DOSDATA:0BE1 COLLATE_TAB     dw	256		     ; ...
DOSDATA:0BE3		     db	0, 1, 2, 3, 4, 5, 6, 7,	8, 9, 10, 11, 12, 13, 14, 15
DOSDATA:0BE3		     db	16, 17,	18, 19,	20, 21,	22, 23,	24, 25,	26, 27,	28
DOSDATA:0BE3		     db	29, 30,	31
DOSDATA:0C03 a_0123456789?@abcd	db ' !"#$%&',27h,'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]'
DOSDATA:0C03		     db	'^_`ABCDEFGHIJKLMNOPQRSTUVWXYZ{|}~'
DOSDATA:0C62		     db	127
DOSDATA:0C63 aCueaaaaceeeiiiaae	db 'CUEAAAACEEEIIIAAEAAOOOUUYOU$$$$$AIOUNN'
DOSDATA:0C89		     db	166, 167
DOSDATA:0C8B		     db	'?'
DOSDATA:0C8C		     db	169, 170, 171, 172
DOSDATA:0C90		     db	'!', 2 dup('"')
DOSDATA:0C93		     db	176, 177, 178, 179, 180, 181, 182, 183,	184, 185, 186
DOSDATA:0C93		     db	187, 188, 189, 190, 191, 192, 193, 194,	195, 196, 197
DOSDATA:0C93		     db	198, 199, 200, 201, 202, 203, 204, 205,	206, 207, 208
DOSDATA:0C93		     db	209, 210, 211, 212, 213, 214, 215, 216,	217, 218, 219
DOSDATA:0C93		     db	220, 221, 222, 223, 224
DOSDATA:0CC4		     db	'S'
DOSDATA:0CC5		     db	226, 227, 228, 229, 230, 231, 232, 233,	234, 235, 236
DOSDATA:0CC5		     db	237, 238, 239, 240, 241, 242, 243, 244,	245, 246, 247
DOSDATA:0CC5		     db	248, 249, 250, 251, 252, 253, 254, 255
DOSDATA:0CE3 DBCS_TAB	     dw	0		     ; ...
DOSDATA:0CE5 DBCS_TAB_2	     db	16 dup(0)	     ; ...
DOSDATA:0CF5 MAP_CASE:				     ; ...
DOSDATA:0CF5		     cmp     al, 80h
DOSDATA:0CF7		     jnb     short Map1
DOSDATA:0CF9		     retf
DOSDATA:0CFA Map1:				     ; ...
DOSDATA:0CFA		     sub     al, 80h
DOSDATA:0CFC		     push    ds
DOSDATA:0CFD		     push    bx
DOSDATA:0CFE		     mov     bx, offset	UCASE_TAB_2
DOSDATA:0D01		     push    cs
DOSDATA:0D02		     pop     ds
DOSDATA:0D03		     xlat
DOSDATA:0D04		     pop     bx
DOSDATA:0D05		     pop     ds
DOSDATA:0D06		     retf
DOSDATA:0D07 InterChar	     db	0
DOSDATA:0D08 InterCon	     db	0
DOSDATA:0D09 SaveCurFlg	     db	0
DOSDATA:0D0A TEMPSEG	     dw	0		     ; ...
DOSDATA:0D0C redir_patch     db	0		     ; ...
DOSDATA:0D0D Mark1	     db	5 dup(0)
DOSDATA:0D12 MSVERSION	     db	6
DOSDATA:0D13		     db	22
DOSDATA:0D14 YRTAB	     db	200, 166, 200, 165, 200, 165, 200, 165 ; ...
DOSDATA:0D1C MONTAB	     db	31		     ; ...
DOSDATA:0D1D february	     db	28		     ; ...
DOSDATA:0D1E		     db	31, 30,	31, 30,	2 dup(31), 30, 31, 30, 31
DOSDATA:0D28 SysInitTable    dd	offset DPBHEAD	     ; ...
DOSDATA:0D2C		     dd	offset COUNTRY_CDPG
DOSDATA:0D30 FastOpenTable   dw	2		     ; ...
DOSDATA:0D32 FastTable_2     dw	offset FastRet	     ; ...
DOSDATA:0D34		     dw	0
DOSDATA:0D36		     dw	offset FastRet
DOSDATA:0D38		     dw	0
DOSDATA:0D3A FastOpenFlg     db	0		     ; ...
DOSDATA:0D3B FastOpen_Ext_Info db 11 dup(0)	     ; ...
DOSDATA:0D46 Dir_Info_Buff   db	32 dup(0)	     ; ...
DOSDATA:0D66 Next_Element_Start	dw 0		     ; ...
DOSDATA:0D68 Del_ExtCluster  dw	0
DOSDATA:0D6A USER_SP_2F	     dw	offset FAKE_STACK_2F ; ...
DOSDATA:0D6C FAKE_STACK_2F   dw	14 dup(0)	     ; ...
DOSDATA:0D88 Hash_Temp	     dw	4 dup(0)
DOSDATA:0D90 SCAN_FLAG	     db	0		     ; ...
DOSDATA:0D91 DATE_FLAG	     dw	0		     ; ...
DOSDATA:0D93 FETCHI_TAG	     dw	0
DOSDATA:0D95 MSG_EXTERROR    dd	0
DOSDATA:0D99		     dd	0
DOSDATA:0D9D		     dd	0
DOSDATA:0DA1		     dd	0
DOSDATA:0DA5		     dd	0
DOSDATA:0DA9 SEQ_SECTOR	     dw	2 dup(0FFFFh)	     ; ...
DOSDATA:0DAD SC_SECTOR_SIZE  dw	0		     ; ...
DOSDATA:0DAF SC_DRIVE	     db	0		     ; ...
DOSDATA:0DB0 CurSC_DRIVE     db	0FFh		     ; ...
DOSDATA:0DB1 CurSC_SECTOR    dw	2 dup(0)	     ; ...
DOSDATA:0DB5 SC_STATUS	     dw	0		     ; ...
DOSDATA:0DB7 SC_FLAG	     db	0		     ; ...
DOSDATA:0DB8 AbsDskErr	     dw	0		     ; ...
DOSDATA:0DBA NO_NAME_ID	     db	'NO NAME    '        ; ...
DOSDATA:0DC5 LOOKSIZ	     db	0
DOSDATA:0DC6 SNULDEV:				     ; ...
DOSDATA:0DC6		     or	     word ptr es:[bx+3], 100h
DOSDATA:0DCC INULDEV:				     ; ...
DOSDATA:0DCC		     retf
DOSDATA:0DCD WinoldPatch2    db	8 dup(0)	     ; ...
DOSDATA:0DD5 UmbSave2	     db	5 dup(0)	     ; ...
DOSDATA:0DDA UmbSaveFlag     db	0		     ; ...
DOSDATA:0DDB ERR_TABLE_21    db	1, 7, 4, 0FFh, 2, 8, 3,	2, 3, 8, 3, 2, 4, 1, 4,	1, 5 ; ...
DOSDATA:0DDB		     db	2 dup(3), 0FFh,	6, 7, 4, 1, 2 dup(7), 2	dup(5),	8, 1
DOSDATA:0DDB		     db	4, 5, 9, 7, 4, 5, 0Ah, 7, 4, 5,	0Bh, 9,	3, 1, 0Ch, 7
DOSDATA:0DDB		     db	4, 1, 0Dh, 9, 4, 1, 0Fh, 8, 3, 2, 10h, 2 dup(3), 2
DOSDATA:0DDB		     db	11h, 0Dh, 3, 2,	12h, 8,	3, 2, 50h, 0Ch,	3, 2, 20h, 0Ah
DOSDATA:0DDB		     db	2 dup(2), 21h, 0Ah, 2 dup(2), 54h, 1, 4, 0FFh, 56h
DOSDATA:0DDB		     db	2 dup(3), 1, 52h, 1, 4,	2, 32h,	9, 2 dup(3), 55h, 0Ch
DOSDATA:0DDB		     db	2 dup(3), 57h, 9, 3, 1,	53h, 0Dh, 4, 1,	24h, 1,	4, 5
DOSDATA:0DDB		     db	26h, 1,	4, 1, 27h, 1, 4, 1, 5Ah, 0Dh, 4, 2, 4 dup(0FFh)
DOSDATA:0E5B ERR_TABLE_24    db	13h, 0Bh, 7, 2,	14h, 4,	5, 1, 15h, 5, 7, 0FFh, 16h ; ...
DOSDATA:0E5B		     db	4, 5, 1, 17h, 0Bh, 4, 2, 18h, 4, 5, 1, 19h, 5, 1, 2
DOSDATA:0E5B		     db	1Ah, 0Bh, 7, 2,	1Bh, 0Bh, 4, 2,	1Ch, 2,	7, 4, 1Dh, 5
DOSDATA:0E5B		     db	4, 0FFh, 1Eh, 5, 4, 0FFh, 1Fh, 0Dh, 4, 0FFh, 20h, 0Ah
DOSDATA:0E5B		     db	2 dup(2), 21h, 0Ah, 2 dup(2), 22h, 0Bh,	7, 2, 32h, 9
DOSDATA:0E5B		     db	2 dup(3), 23h, 7, 4, 1,	24h, 1,	4, 5, 0FFh, 0Dh, 5
DOSDATA:0E5B		     db	0FFh
DOSDATA:0EAB ErrMap24	     db	13h, 14h, 15h, 16h, 17h, 18h, 19h, 1Ah,	1Bh, 1Ch, 1Dh ;	...
DOSDATA:0EAB		     db	1Eh, 3 dup(1Fh), 22h
DOSDATA:0EBB FIRST_BUFF_ADDR dw	0		     ; ...
DOSDATA:0EBD SPECIAL_VERSION dw	0		     ; ...
DOSDATA:0EBF FAKE_COUNT	     db	255 dup(0)
DOSDATA:0FBE OLD_FIRSTCLUS   dw	0		     ; ...
DOSDATA:0FC0 exec_init_SP    dw	0		     ; ...
DOSDATA:0FC2 exec_init_SS    dw	0		     ; ...
DOSDATA:0FC4 exec_init_IP    dw	0		     ; ...
DOSDATA:0FC6 exec_init_CS    dw	0		     ; ...
DOSDATA:0FC8 exec_signature  dw	0		     ; ...
DOSDATA:0FCA exec_len_mod_512 dw 0
DOSDATA:0FCC exec_pages	     dw	0		     ; ...
DOSDATA:0FCE exec_rle_count  dw	0		     ; ...
DOSDATA:0FD0 exec_par_dir    dw	0		     ; ...
DOSDATA:0FD2 exec_min_BSS    dw	0		     ; ...
DOSDATA:0FD4 exec_max_BSS    dw	0		     ; ...
DOSDATA:0FD6 exec_SS	     dw	0		     ; ...
DOSDATA:0FD8 exec_SP	     dw	0		     ; ...
DOSDATA:0FDA exec_chksum     dw	0
DOSDATA:0FDC exec_IP	     dw	0		     ; ...
DOSDATA:0FDE exec_CS	     dw	0
DOSDATA:0FE0 exec_rle_table  dw	0		     ; ...
DOSDATA:0FE2 Win386_Info     db	3		     ; ...
DOSDATA:0FE3		     db	0
DOSDATA:0FE4		     dd	0
DOSDATA:0FE8 Win386_Info_6   dd	0		     ; ...
DOSDATA:0FEC		     dd	0
DOSDATA:0FF0 SIS_Instance_Data_Ptr dw offset Instance_Table
DOSDATA:0FF2 SIS_Instance_Data_Ptr_2 dw	0	     ; ...
DOSDATA:0FF4 Instance_Table  dw	offset CONTPOS	     ; ...
DOSDATA:0FF6 Instance_Table_2 dw 0		     ; ...
DOSDATA:0FF8		     dw	2
DOSDATA:0FFA		     dw	offset BCON
DOSDATA:0FFC		     dw	0
DOSDATA:0FFE		     dw	4
DOSDATA:1000		     dw	offset CARPOS
DOSDATA:1002		     dw	0
DOSDATA:1004		     dw	106h
DOSDATA:1006		     dw	offset CHARCO
DOSDATA:1008		     dw	0
DOSDATA:100A		     dw	1
DOSDATA:100C		     dw	offset exec_init_SP
DOSDATA:100E		     dw	0
DOSDATA:1010		     dw	34
DOSDATA:1012		     dw	offset UMBFLAG
DOSDATA:1014		     dw	0
DOSDATA:1016		     dw	1
DOSDATA:1018		     dw	offset UMB_HEAD
DOSDATA:101A		     dw	0
DOSDATA:101C		     dw	2
DOSDATA:101E		     dw	0
DOSDATA:1020		     dw	0
DOSDATA:1022 Win386_DOSVars  db	5		     ; ...
DOSDATA:1023		     db	0
DOSDATA:1024		     dw	offset SAVEDS
DOSDATA:1026		     dw	offset SAVEBX
DOSDATA:1028		     dw	offset INDOS
DOSDATA:102A		     dw	offset USER_ID
DOSDATA:102C		     dw	offset CritPatch
DOSDATA:102E		     dw	offset UMB_HEAD
DOSDATA:1030 IsWin386	     db	0		     ; ...
DOSDATA:1031 VxDpath	     db	'c:\wina20.386',0    ; ...
DOSDATA:103F DriverLoad	     db	1		     ; ...
DOSDATA:1040 BiosDataPtr     dd	0		     ; ...
DOSDATA:1044		     db	36h, 0F6h, 6, 20h, 3, 0FFh
DOSDATA:104A		     db	75h, 0Ch
DOSDATA:104C		     db	36h, 0FFh, 36h,	58h, 3
DOSDATA:1051		     db	0CDh, 28h
DOSDATA:1053		     db	80h, 3Eh, 20h, 3, 0
DOSDATA:1058		     db	75h, 37h
DOSDATA:105A		     db	0BCh, 0A0h, 0Ah
DOSDATA:105D LocalSFT	     dd	0		     ; ...
DOSDATA:1061		     db	90h
DOSDATA:1062 DOSINTTABLE     dd	DIVOV		     ; ...
DOSDATA:1066 DOSINTTABLE_4   dd	quit		     ; ...
DOSDATA:106A DOSINTTABLE_8   dd	command		     ; ...
DOSDATA:106E DOSINTTABLE_12  dd	ABSDRD		     ; ...
DOSDATA:1072 DOSINTTABLE_16  dd	ABSDWRT		     ; ...
DOSDATA:1076 DOSINTTABLE_20  dd	stay_resident	     ; ...
DOSDATA:107A DOSINTTABLE_24  dd	INT2F		     ; ...
DOSDATA:107E DOSINTTABLE_28  dd	call_entry	     ; ...
DOSDATA:1082 DOSINTTABLE_32  dd	irett
DOSDATA:1086 SS_Save	     dw	0		     ; ...
DOSDATA:1088 SP_Save	     dw	0		     ; ...
DOSDATA:108A ldivov:				     ; ...
DOSDATA:108A		     jmp     short divov_cont
DOSDATA:108C		     call    EnsureA20ON
DOSDATA:108F divov_cont:			     ; ...
DOSDATA:108F		     jmp     cs:DOSINTTABLE
DOSDATA:1094 lquit:				     ; ...
DOSDATA:1094		     jmp     short quit_cont
DOSDATA:1096		     call    EnsureA20ON
DOSDATA:1099 quit_cont:				     ; ...
DOSDATA:1099		     jmp     cs:DOSINTTABLE_4
DOSDATA:109E lcommand:				     ; ...
DOSDATA:109E		     jmp     short command_cont
DOSDATA:10A0		     call    EnsureA20ON
DOSDATA:10A3 command_cont:			     ; ...
DOSDATA:10A3		     jmp     cs:DOSINTTABLE_8
DOSDATA:10A8 labsdrd:				     ; ...
DOSDATA:10A8		     jmp     short absdrd_cont
DOSDATA:10AA		     call    EnsureA20ON
DOSDATA:10AD absdrd_cont:			     ; ...
DOSDATA:10AD		     jmp     cs:DOSINTTABLE_12
DOSDATA:10B2 labsdwrt:				     ; ...
DOSDATA:10B2		     jmp     short absdwrt_cont
DOSDATA:10B4		     call    EnsureA20ON
DOSDATA:10B7 absdwrt_cont:			     ; ...
DOSDATA:10B7		     jmp     cs:DOSINTTABLE_16
DOSDATA:10BC lstay_resident:			     ; ...
DOSDATA:10BC		     jmp     short sr_cont
DOSDATA:10BE		     call    EnsureA20ON
DOSDATA:10C1 sr_cont:				     ; ...
DOSDATA:10C1		     jmp     cs:DOSINTTABLE_20
DOSDATA:10C6 lint2f:				     ; ...
DOSDATA:10C6		     jmp     short int2f_cont
DOSDATA:10C8		     call    EnsureA20ON
DOSDATA:10CB int2f_cont:			     ; ...
DOSDATA:10CB		     jmp     cs:DOSINTTABLE_24
DOSDATA:10D0 lcall_entry:			     ; ...
DOSDATA:10D0		     jmp     short callentry_cont
DOSDATA:10D2		     call    EnsureA20ON
DOSDATA:10D5 callentry_cont:			     ; ...
DOSDATA:10D5		     jmp     cs:DOSINTTABLE_28
DOSDATA:10DA lirett:				     ; ...
DOSDATA:10DA		     iret
DOSDATA:10DB DosRetAddr23    dd	0		     ; ...
DOSDATA:10DF DosRetAddr24    dd	0		     ; ...
DOSDATA:10E3 DosRetAddr28    dd	0
DOSDATA:10E7 LowInt23:				     ; ...
DOSDATA:10E7		     pop     word ptr cs:DosRetAddr23
DOSDATA:10EC		     pop     word ptr cs:DosRetAddr23+2
DOSDATA:10F1		     int     23h	     ; DOS - CONTROL "C" EXIT ADDRESS
DOSDATA:10F1					     ; Return: return via RETF 2 with CF set
DOSDATA:10F1					     ; DOS will	abort program with errorlevel 0
DOSDATA:10F1					     ; else
DOSDATA:10F1					     ; interrupted DOS call continues
DOSDATA:10F3		     call    EnsureA20ON
DOSDATA:10F6		     jmp     cs:DosRetAddr23
DOSDATA:10FB LowInt24:				     ; ...
DOSDATA:10FB		     pop     word ptr cs:DosRetAddr24
DOSDATA:1100		     pop     word ptr cs:DosRetAddr24+2
DOSDATA:1105		     int     24h	     ; DOS - FATAL ERROR HANDLER ADDRESS
DOSDATA:1105					     ; Automatically called upon detection of unrecoverable I/O	error.
DOSDATA:1107		     call    EnsureA20ON
DOSDATA:110A		     jmp     cs:DosRetAddr24
DOSDATA:110F LowInt28:				     ; ...
DOSDATA:110F		     int     28h	     ; DOS 2+ internal - KEYBOARD BUSY LOOP
DOSDATA:1111		     call    EnsureA20ON
DOSDATA:1114		     retf
DOSDATA:1115 disa20_xfer:			     ; ...
DOSDATA:1115		     call    XMMDisableA20
DOSDATA:1118		     cli
DOSDATA:1119		     mov     cs:INDOS, 0
DOSDATA:111F		     mov     ss, ax
DOSDATA:1121		     mov     sp, di
DOSDATA:1123		     sti
DOSDATA:1124		     push    ds
DOSDATA:1125		     push    si
DOSDATA:1126		     mov     es, dx
DOSDATA:1128		     mov     ds, dx
DOSDATA:112A		     mov     ax, bx
DOSDATA:112C		     retf
DOSDATA:112D disa20_iret:			     ; ...
DOSDATA:112D		     call    XMMDisableA20
DOSDATA:1130		     dec     ds:INDOS
DOSDATA:1134		     mov     ss, ds:USER_SS
DOSDATA:1138		     mov     sp, ds:USER_SP
DOSDATA:113C		     mov     bp, sp
DOSDATA:113E		     mov     [bp+0], al
DOSDATA:1141		     mov     ax, ds:NSP
DOSDATA:1144		     mov     ds:USER_SP, ax
DOSDATA:1147		     mov     ax, ds:NSS
DOSDATA:114A		     mov     ds:USER_SS, ax
DOSDATA:114D		     pop     ax
DOSDATA:114E		     pop     bx
DOSDATA:114F		     pop     cx
DOSDATA:1150		     pop     dx
DOSDATA:1151		     pop     si
DOSDATA:1152		     pop     di
DOSDATA:1153		     pop     bp
DOSDATA:1154		     pop     ds
DOSDATA:1155		     pop     es
DOSDATA:1156		     iret
DOSDATA:1157 ; =============== S U B R O U T I N E =======================================
DOSDATA:1157 XMMDisableA20   proc near		     ; ...
DOSDATA:1157		     push    bx
DOSDATA:1158		     push    ax
DOSDATA:1159		     mov     ah, 6
DOSDATA:115B		     call    cs:XMMcontrol
DOSDATA:1160		     pop     ax
DOSDATA:1161		     pop     bx
DOSDATA:1162		     retn
DOSDATA:1162 XMMDisableA20   endp
DOSDATA:1163 XMMcontrol	     dd	0		     ; ...
DOSDATA:1167 LowMemory	     dd	80h		     ; ...
DOSDATA:116B HighMemory	     dd	0FFFF0090h	     ; ...
DOSDATA:116F ; =============== S U B R O U T I N E =======================================
DOSDATA:116F EnsureA20ON     proc near		     ; ...
DOSDATA:116F		     pushf
DOSDATA:1170		     push    ds
DOSDATA:1171		     push    es
DOSDATA:1172		     push    cx
DOSDATA:1173		     push    si
DOSDATA:1174		     push    di
DOSDATA:1175		     lds     si, cs:LowMemory
DOSDATA:117A		     les     di, cs:HighMemory
DOSDATA:117F		     mov     cx, 4
DOSDATA:1182		     cld
DOSDATA:1183		     repe cmpsw
DOSDATA:1185		     jz	     short EA20_OFF
DOSDATA:1187 EA20_RET:				     ; ...
DOSDATA:1187		     pop     di
DOSDATA:1188		     pop     si
DOSDATA:1189		     pop     cx
DOSDATA:118A		     pop     es
DOSDATA:118B		     pop     ds
DOSDATA:118C		     popf
DOSDATA:118D		     retn
DOSDATA:118E EA20_OFF:				     ; ...
DOSDATA:118E		     push    bx
DOSDATA:118F		     push    ax
DOSDATA:1190		     mov     ax, ss
DOSDATA:1192		     mov     cs:SS_Save, ax
DOSDATA:1196		     mov     cs:SP_Save, sp
DOSDATA:119B		     mov     ax, cs
DOSDATA:119D		     mov     ss, ax
DOSDATA:119F		     mov     sp, offset	AUXSTACK
DOSDATA:11A2		     mov     ah, 5
DOSDATA:11A4		     call    cs:XMMcontrol
DOSDATA:11A9		     or	     ax, ax
DOSDATA:11AB		     jz	     short XMMerror
DOSDATA:11AD		     mov     ax, cs:SS_Save
DOSDATA:11B1		     mov     ss, ax
DOSDATA:11B3		     mov     sp, cs:SP_Save
DOSDATA:11B8		     pop     ax
DOSDATA:11B9		     pop     bx
DOSDATA:11BA		     jmp     short EA20_RET
DOSDATA:11BC XMMerror:				     ; ...
DOSDATA:11BC		     mov     ah, 0Fh
DOSDATA:11BE		     int     10h	     ; - VIDEO - GET CURRENT VIDEO MODE
DOSDATA:11BE					     ; Return: AH = number of columns on screen
DOSDATA:11BE					     ; AL = current video mode
DOSDATA:11BE					     ; BH = current active display page
DOSDATA:11C0		     cmp     al, 7
DOSDATA:11C2		     jz	     short XMMcont
DOSDATA:11C4		     xor     ah, ah
DOSDATA:11C6		     mov     al, 2
DOSDATA:11C8		     int     10h	     ; - VIDEO - SET VIDEO MODE
DOSDATA:11C8					     ; AL = mode
DOSDATA:11CA XMMcont:				     ; ...
DOSDATA:11CA		     mov     ah, 5
DOSDATA:11CC		     xor     al, al
DOSDATA:11CE		     int     10h	     ; - VIDEO - SELECT	DISPLAY	PAGE
DOSDATA:11CE					     ; AL = display page, 0-7  for modes 0 & 1,	0-3  for modes 2 & 3
DOSDATA:11D0		     mov     si, offset	XMMERRMSG ; "\r\nA20 Hardware Error\r\n$"
DOSDATA:11D3		     push    cs
DOSDATA:11D4		     pop     ds
DOSDATA:11D5		     cld
DOSDATA:11D6 XMMprnt:				     ; ...
DOSDATA:11D6		     lodsb
DOSDATA:11D7		     cmp     al, '$'
DOSDATA:11D9		     jz	     short XMMStall
DOSDATA:11DB		     mov     ah, 0Eh
DOSDATA:11DD		     mov     bx, 7
DOSDATA:11E0		     int     10h	     ; - VIDEO - WRITE CHARACTER AND ADVANCE CURSOR (TTY WRITE)
DOSDATA:11E0					     ; AL = character, BH = display page (alpha	modes)
DOSDATA:11E0					     ; BL = foreground color (graphics modes)
DOSDATA:11E2		     jmp     short XMMprnt
DOSDATA:11E4 XMMStall:				     ; ...
DOSDATA:11E4		     sti
DOSDATA:11E5		     jmp     short XMMStall
DOSDATA:11E5 EnsureA20ON     endp
DOSDATA:11E7 OldInstanceJunk dw	70h		     ; ...
DOSDATA:11E9		     dw	0
DOSDATA:11EB		     dw	6
DOSDATA:11ED OldInstanceJunk_6 dw 0		     ; ...
DOSDATA:11EF		     dw	offset CONTPOS
DOSDATA:11F1		     dw	2
DOSDATA:11F3		     dw	0
DOSDATA:11F5		     dw	offset BCON
DOSDATA:11F7		     dw	4
DOSDATA:11F9		     dw	0
DOSDATA:11FB		     dw	offset CARPOS
DOSDATA:11FD		     dw	106h
DOSDATA:11FF		     dw	0
DOSDATA:1201		     dw	offset CHARCO
DOSDATA:1203		     dw	1
DOSDATA:1205		     dw	0
DOSDATA:1207		     dw	offset exec_init_SP
DOSDATA:1209		     dw	34
DOSDATA:120B		     dw	70h
DOSDATA:120D		     dw	0Ch
DOSDATA:120F		     dw	1
DOSDATA:1211 DosHasHMA	     db	0		     ; ...
DOSDATA:1212 FixExePatch     dw	0		     ; ...
DOSDATA:1214 RationalPatchPtr dw 0		     ; ...
DOSDATA:1216 RatBugCode:			     ; ...
DOSDATA:1216		     push    cx
DOSDATA:1217		     mov     cx, ds:10h
DOSDATA:121B rbc_loop:				     ; ...
DOSDATA:121B		     loop    rbc_loop
DOSDATA:121D		     pop     cx
DOSDATA:121E		     retf
DOSDATA:121F UmbSave1	     db	11 dup(0)	     ; ...
DOSDATA:122A COUNTRY_CDPG    db	8 dup(0)	     ; ...
DOSDATA:1232 aCountry_sys    db	'\COUNTRY.SYS',0
DOSDATA:123F		     db	51 dup(0)
DOSDATA:1272		     dw	437
DOSDATA:1274		     dw	6
DOSDATA:1276 COUNTRY_CDPG_76 db	2		     ; ...
DOSDATA:1277		     dw	offset UCASE_TAB
DOSDATA:1279		     dw	0
DOSDATA:127B		     db	4
DOSDATA:127C		     dw	offset FILE_UCASE_TAB
DOSDATA:127E		     dw	0
DOSDATA:1280		     db	5
DOSDATA:1281		     dw	offset FILE_CHAR_TAB
DOSDATA:1283		     dw	0
DOSDATA:1285		     db	6
DOSDATA:1286		     dw	offset COLLATE_TAB
DOSDATA:1288		     dw	0
DOSDATA:128A		     db	7
DOSDATA:128B		     dw	offset DBCS_TAB
DOSDATA:128D		     dw	0
DOSDATA:128F		     db	1
DOSDATA:1290		     dw	38
DOSDATA:1292		     dw	1
DOSDATA:1294		     dw	437
DOSDATA:1296 COUNTRY_CDPG_108 dw 0		     ; ...
DOSDATA:1298		     db	'$',0,0,0,0
DOSDATA:129D		     db	',',0
DOSDATA:129F a__0	     db	'.',0
DOSDATA:12A1		     db	'-',0
DOSDATA:12A3		     db	':',0
DOSDATA:12A5		     db	0
DOSDATA:12A6		     db	2
DOSDATA:12A7		     db	0
DOSDATA:12A8		     dw	offset MAP_CASE
DOSDATA:12AA		     dw	0
DOSDATA:12AC		     db	',',0
DOSDATA:12AE		     dw	5 dup(0)
DOSDATA:12B8 XMMERRMSG	     db	0Dh,0Ah		     ; ...
DOSDATA:12B8		     db	'A20 Hardware Error',0Dh,0Ah,'$'
DOSDATA:12CF DOSP1_ID	     db	36h, 0C5h, 36h
DOSDATA:12D2 DOSP1_THISSFT   db	36h, 5,	0C5h, 74h, 7, 0E8h
DOSDATA:12D8		     db	2 dup(90h)
DOSDATA:12DA DOSP12_ID	     db	36h, 0C5h, 36h
DOSDATA:12DD DOSP12_THISSFT  db	36h, 5,	0C5h, 74h, 7, 0E8h
DOSDATA:12E3 DOSP3_ID	     db	51h, 6,	57h, 0BAh
DOSDATA:12E7 DOSP3_CONBUF    db	29h, 2,	0E8h
DOSDATA:12EA		     db	9Ah, 0E3h, 5Fh,	7
DOSDATA:12EE DOSP4_ID	     db	59h
DOSDATA:12EF DOSP5_ID	     db	51h
DOSDATA:12F0		     db	0ACh, 3Ch, 1Ah,	74h, 5
DOSDATA:12F5		     db	0E8h
DOSDATA:12F6 DOSP7_ID	     db	2Eh, 8Ch, 1Eh
DOSDATA:12F9 DOSP7_SAVEDS    db	7Eh, 5
DOSDATA:12FB		     db	2Eh, 89h, 1Eh
DOSDATA:12FE DOSP7_SAVEBX    db	7Ch, 5
DOSDATA:1300		     db	8Ch, 0CBh
DOSDATA:1302		     db	8Eh, 0DBh
DOSDATA:1304		     db	0FEh, 6
DOSDATA:1306 DOSP7_INDOS     db	0CFh, 2
DOSDATA:1308		     db	33h, 0C0h
DOSDATA:130A DOSP8_ID	     db	50h
DOSDATA:130B		     db	36h, 0A1h
DOSDATA:130D DOSP8_USER_ID   db	0EAh, 2
DOSDATA:130F		     db	26h, 3Bh, 45h
DOSDATA:1312		     db	2Fh, 58h
DOSDATA:1314 DOSP10_ID	     db	6, 1Fh
DOSDATA:1316 DOSP10_LOC	     db	8Bh, 0DFh
DOSDATA:1318		     db	33h, 0C0h, 8Bh,	0D0h, 0E8h
DOSDATA:131D		     db	0DFh, 0Eh
DOSDATA:131F		     db	1Eh, 36h, 0C5h,	2 dup(36h), 5, 0E8h, 0AFh, 0Eh
DOSDATA:1328		     db	8Bh, 0D7h, 0B4h, 86h, 36h, 8Bh,	3Eh
DOSDATA:132F		     db	9, 3
DOSDATA:1331		     db	0F7h, 0C7h, 0, 80h, 74h, 19h, 0E8h, 47h, 17h
DOSDATA:133A		     db	8Bh, 0FAh, 0Ah,	0C0h, 74h, 10h,	3Ch, 3,	74h, 3
DOSDATA:1344		     db	1Fh, 0EBh, 0CFh
DOSDATA:1347		     db	5Fh
DOSDATA:1348		     db	36h, 0C4h, 3Eh,	36h, 5,	0E9h, 0A1h, 4
DOSDATA:1350		     db	5Fh, 8Bh, 0FAh
DOSDATA:1353 DOSP13_ID	     db	0ACh
DOSDATA:1354		     db	3Ch, 24h
DOSDATA:1356		     db	74h, 8
DOSDATA:1358		     db	0B3h, 7
DOSDATA:135A		     db	0B4h, 0Eh
DOSDATA:135C		     db	0CDh, 10h
DOSDATA:135E		     db	0EBh, 0F3h
DOSDATA:1360		     db	0EBh, 0FEh
DOSDATA:1362 Rational386PatchPtr dw 0		     ; ...
DOSDATA:1364 MagicPatch:			     ; ...
DOSDATA:1364		     retf
DOSDATA:1365		     nop
DOSDATA:1366		     nop
DOSDATA:1367		     nop
DOSDATA:1368		     nop
DOSDATA:1369		     nop
DOSDATA:1369 DOSDATA	     ends
DOSDATA:1369		     end
