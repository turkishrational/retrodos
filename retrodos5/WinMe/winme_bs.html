<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>IDA - C:\WinMe\winme_bs.img</title>
</head>
<body bgcolor="white">
<span style="white-space: pre; font-family: Consolas; color: blue; background: white">

<span style="color:maroon">WinMeBS:7C00 </span>;
<span style="color:maroon">WinMeBS:7C00 </span>; +-------------------------------------------------------------------------+
<span style="color:maroon">WinMeBS:7C00 </span>; |   This file has been generated by The Interactive Disassembler (IDA)    |
<span style="color:maroon">WinMeBS:7C00 </span>; |           Copyright (c) 2013 Hex-Rays, &lt;support@hex-rays.com&gt;           |
<span style="color:maroon">WinMeBS:7C00 </span>; |                      License info: 48-325F-7034-FF                      |
<span style="color:maroon">WinMeBS:7C00 </span>; |                     Rico Baumgart, personal license                     |
<span style="color:maroon">WinMeBS:7C00 </span>; +-------------------------------------------------------------------------+
<span style="color:maroon">WinMeBS:7C00 </span>;
<span style="color:maroon">WinMeBS:7C00 </span>; Input MD5   : 7C2CD691F1F331653D7B043E28D38477
<span style="color:maroon">WinMeBS:7C00 </span>; Input CRC32 : C316C648
<span style="color:maroon">WinMeBS:7C00
WinMeBS:7C00 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">WinMeBS:7C00 </span>; File Name   : C:\WinMe\winme_bs.img
<span style="color:maroon">WinMeBS:7C00 </span>; Format      : Binary file
<span style="color:maroon">WinMeBS:7C00 </span>; Base Address: 0000h Range: 0000h - 0200h Loaded length: 0200h
<span style="color:maroon">WinMeBS:7C00
WinMeBS:7C00                 .</span>686p
<span style="color:maroon">WinMeBS:7C00                 </span>.mmx
<span style="color:maroon">WinMeBS:7C00                 </span>.model flat
<span style="color:maroon">WinMeBS:7C00
WinMeBS:7C00 </span><span style="color:gray">; ===========================================================================
</span><span style="color:maroon">WinMeBS:7C00
WinMeBS:7C00 </span><span style="color:gray">; Segment type: Pure code
</span><span style="color:maroon">WinMeBS:7C00 </span>WinMeBS         segment byte public &#039;CODE&#039; use16
<span style="color:maroon">WinMeBS:7C00                 </span>assume cs:WinMeBS
<span style="color:maroon">WinMeBS:7C00                 </span><span style="color:gray">;org 7C00h
</span><span style="color:maroon">WinMeBS:7C00                 </span>assume es:nothing, ss:nothing, ds:nothing, fs:nothing, gs:nothing
<span style="color:maroon">WinMeBS:7C00
WinMeBS:7C00 </span>BS_jmpBoot<span style="color:navy">:
</span><span style="color:maroon">WinMeBS:7C00                 </span><span style="color:navy">jmp     short </span>bootcode
<span style="color:maroon">WinMeBS:7C00 </span><span style="color:gray">; ---------------------------------------------------------------------------
WinMeBS:7C02                 </span><span style="color:navy">db </span><span style="color:#008040">90h
</span><span style="color:gray">WinMeBS:7C03 </span>BS_OEMName      <span style="color:navy">db &#039;MSWIN4.1&#039;
</span><span style="color:gray">WinMeBS:7C0B </span>BPB_BytsPerSec  <span style="color:navy">dw </span><span style="color:#008040">512
</span><span style="color:gray">WinMeBS:7C0D </span>BPB_SecPerClus  <span style="color:navy">db </span><span style="color:#008040">1
</span><span style="color:gray">WinMeBS:7C0E </span>BPB_RsvdSecCnt  <span style="color:navy">dw </span><span style="color:#008040">1
</span><span style="color:gray">WinMeBS:7C10 </span>BPB_NumFATs     <span style="color:navy">db </span><span style="color:#008040">2
</span><span style="color:gray">WinMeBS:7C11 </span>BPB_RootEntCnt  <span style="color:navy">dw </span><span style="color:#008040">224
</span><span style="color:gray">WinMeBS:7C13 </span>BPB_TotSec16    <span style="color:navy">dw </span><span style="color:#008040">2880
</span><span style="color:gray">WinMeBS:7C15 </span>BPB_Media       <span style="color:navy">db </span><span style="color:#008040">0F0h
</span><span style="color:gray">WinMeBS:7C16 </span>BPB_FATSz16     <span style="color:navy">dw </span><span style="color:#008040">9
</span><span style="color:gray">WinMeBS:7C18 </span>BPB_SecPerTrk   <span style="color:navy">dw </span><span style="color:#008040">18
</span><span style="color:gray">WinMeBS:7C1A </span>BPB_NumHeads    <span style="color:navy">dw </span><span style="color:#008040">2
</span><span style="color:gray">WinMeBS:7C1C </span>BPB_HiddSec     <span style="color:navy">dd </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; DATA XREF: WinMeBS:7C76r
</span><span style="color:gray">WinMeBS:7C20 </span>BPB_TotSec32    <span style="color:navy">dd </span><span style="color:#008040">0
</span><span style="color:gray">WinMeBS:7C24 </span>BS_DrvNum       <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">WinMeBS:7C25 </span>BS_Reserved1    <span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">WinMeBS:7C26 </span>BS_BootSig      <span style="color:navy">db </span><span style="color:#008040">29h
</span><span style="color:gray">WinMeBS:7C27 </span>BS_VolID        <span style="color:navy">dd </span><span style="color:#008040">0C4B0FDDh
</span><span style="color:gray">WinMeBS:7C2B </span>BS_VolLab       <span style="color:navy">db &#039;BOOTCD     &#039;
</span><span style="color:gray">WinMeBS:7C36 </span>BS_FilSysType   <span style="color:navy">db &#039;FAT12   &#039;
</span><span style="color:maroon">WinMeBS:7C3E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">WinMeBS:7C3E
WinMeBS:7C3E </span>bootcode<span style="color:navy">:                               </span><span style="color:green">; CODE XREF: WinMeBS:BS_jmpBootj
</span><span style="color:maroon">WinMeBS:7C3E                 </span><span style="color:navy">xor     cx, cx
</span><span style="color:maroon">WinMeBS:7C40                 </span><span style="color:navy">mov     ss, cx          </span>; 0
<span style="color:maroon">WinMeBS:7C42                 </span><span style="color:navy">mov     sp, </span><span style="color:green">7BFCh       </span>; 7C00h-4
<span style="color:maroon">WinMeBS:7C45                 </span><span style="color:navy">push    ss
</span><span style="color:maroon">WinMeBS:7C46                 </span><span style="color:navy">pop     es
</span><span style="color:maroon">WinMeBS:7C47                 </span><span style="color:navy">mov     bp, </span><span style="color:green">78h         </span>; 1Eh*4 (INT 1Eh vector)
<span style="color:maroon">WinMeBS:7C4A                 </span><span style="color:navy">lds     si, [bp+</span><span style="color:green">0</span><span style="color:navy">]
</span><span style="color:maroon">WinMeBS:7C4D                 </span><span style="color:navy">push    ds
</span><span style="color:maroon">WinMeBS:7C4E                 </span><span style="color:navy">push    si
</span><span style="color:maroon">WinMeBS:7C4F                 </span><span style="color:navy">push    ss
</span><span style="color:maroon">WinMeBS:7C50                 </span><span style="color:navy">push    bp
</span><span style="color:maroon">WinMeBS:7C51                 </span><span style="color:navy">mov     di, </span><span style="color:green">522h        </span>; new floppy dpt address
<span style="color:maroon">WinMeBS:7C54                 </span><span style="color:navy">mov     [bp+</span><span style="color:green">0</span><span style="color:navy">], di
</span><span style="color:maroon">WinMeBS:7C57                 </span><span style="color:navy">mov     [bp+</span><span style="color:green">2</span><span style="color:navy">], cx
</span><span style="color:maroon">WinMeBS:7C5A                 </span><span style="color:navy">mov     cl, </span><span style="color:green">11
</span><span style="color:maroon">WinMeBS:7C5C                 </span><span style="color:navy">cld
</span><span style="color:maroon">WinMeBS:7C5D                 </span><span style="color:navy">rep movsb
</span><span style="color:maroon">WinMeBS:7C5F                 </span><span style="color:navy">push    es
</span><span style="color:maroon">WinMeBS:7C60                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">WinMeBS:7C61                 </span><span style="color:navy">mov     bp, </span><span style="color:green">7C00h       </span>; boot sector buffer address (MBR loads here)
<span style="color:maroon">WinMeBS:7C64                 </span><span style="color:navy">mov     byte ptr [di-</span><span style="color:green">2</span><span style="color:navy">], </span><span style="color:green">0Fh </span>; safe head settle time (15, max.)
<span style="color:maroon">WinMeBS:7C68                 </span><span style="color:navy">cmp     [bp+</span><span style="color:#ff8000">24h</span><span style="color:navy">], cl    </span>; drive number = 0 ?
<span style="color:maroon">WinMeBS:7C6B                 </span><span style="color:navy">jge     short </span>bscode_3  ; find and read JO.SYS
<span style="color:maroon">WinMeBS:7C6D                 </span><span style="color:navy">mov     ax, cx          </span>; Hard disk (80h)
<span style="color:maroon">WinMeBS:7C6F                 </span><span style="color:navy">cwd
</span><span style="color:maroon">WinMeBS:7C70                 </span><span style="color:navy">call    </span>read_one_sector
<span style="color:maroon">WinMeBS:7C73                 </span><span style="color:navy">sub     bx, </span><span style="color:green">58          </span>; 700h - 3Ah
<span style="color:maroon">WinMeBS:7C76                 </span><span style="color:navy">mov     eax, ds:</span>BPB_HiddSec
<span style="color:maroon">WinMeBS:7C7A
WinMeBS:7C7A </span>bscode_1<span style="color:navy">:                               </span><span style="color:green">; CODE XREF: WinMeBS:7C8Bj
</span><span style="color:maroon">WinMeBS:7C7A                 </span><span style="color:navy">cmp     eax, [bx]       </span>; MBR PTE offset 8 (partition start sector)
<span style="color:maroon">WinMeBS:7C7D                 </span><span style="color:navy">mov     dl, [bx-</span><span style="color:green">4</span><span style="color:navy">]      </span>; PTE offset 4, partition/fs ID
<span style="color:maroon">WinMeBS:7C80                 </span><span style="color:navy">jnz     short </span>bscope_2  ; not same
<span style="color:maroon">WinMeBS:7C82                 </span><span style="color:navy">or      dl, </span><span style="color:green">2           </span>; 0Ch -&gt; 0Eh (0Eh -&gt; 0Eh) LBA type
<span style="color:maroon">WinMeBS:7C85                 </span><span style="color:navy">mov     [bp+</span><span style="color:green">2</span><span style="color:navy">], dl      </span>; BS offset 2 (default=90h)
<span style="color:maroon">WinMeBS:7C88
WinMeBS:7C88 </span>bscope_2<span style="color:navy">:                               </span><span style="color:green">; CODE XREF: WinMeBS:7C80j
</span><span style="color:maroon">WinMeBS:7C88                 </span><span style="color:navy">add     bl, </span><span style="color:green">10h         </span>; next PT entry
<span style="color:maroon">WinMeBS:7C8B                 </span><span style="color:navy">jnb     short </span>bscode_1
<span style="color:maroon">WinMeBS:7C8D
WinMeBS:7C8D </span>bscode_3<span style="color:navy">:                               </span><span style="color:green">; CODE XREF: WinMeBS:7C6Bj
</span><span style="color:maroon">WinMeBS:7C8D                 </span><span style="color:navy">xor     cx, cx          </span>; JO.SYS
<span style="color:maroon">WinMeBS:7C8F                 </span><span style="color:navy">inc     byte ptr ds:</span>IO_SYS <span style="color:gray">; &quot;IO      SYS&quot;
</span><span style="color:maroon">WinMeBS:7C93
WinMeBS:7C93 </span>bscode_4<span style="color:navy">:                               </span><span style="color:green">; CODE XREF: WinMeBS:7CEAj
</span><span style="color:maroon">WinMeBS:7C93                 </span><span style="color:navy">mov     al, [bp+</span><span style="color:green">10h</span><span style="color:navy">]    </span>; number of fats
<span style="color:maroon">WinMeBS:7C96                 </span><span style="color:navy">cbw
</span><span style="color:maroon">WinMeBS:7C97                 </span><span style="color:navy">mul     word ptr [bp+</span><span style="color:green">16h</span><span style="color:navy">] </span>; fat size (sectors)
<span style="color:maroon">WinMeBS:7C9A                 </span><span style="color:navy">add     ax, [bp+</span><span style="color:green">1Ch</span><span style="color:navy">]    </span>; + hidden sectors
<span style="color:maroon">WinMeBS:7C9D                 </span><span style="color:navy">adc     dx, [bp+</span><span style="color:green">1Eh</span><span style="color:navy">]
</span><span style="color:maroon">WinMeBS:7CA0                 </span><span style="color:navy">add     ax, [bp+</span><span style="color:green">0Eh</span><span style="color:navy">]    </span>; + reserved sector count
<span style="color:maroon">WinMeBS:7CA3                 </span><span style="color:navy">adc     dx, cx          </span>; cx = 0
<span style="color:maroon">WinMeBS:7CA5                 </span><span style="color:navy">mov     si, [bp+</span><span style="color:green">11h</span><span style="color:navy">]    </span>; root dir entries
<span style="color:maroon">WinMeBS:7CA8                 </span><span style="color:navy">pusha
</span><span style="color:maroon">WinMeBS:7CA9                 </span><span style="color:navy">mov     [bp-</span><span style="color:green">4</span><span style="color:navy">], ax
</span><span style="color:maroon">WinMeBS:7CAC                 </span><span style="color:navy">mov     [bp-</span><span style="color:green">2</span><span style="color:navy">], dx
</span><span style="color:maroon">WinMeBS:7CAF                 </span><span style="color:navy">mov     ax, </span><span style="color:green">32          </span>; 32 bytes per entry
<span style="color:maroon">WinMeBS:7CB2                 </span><span style="color:navy">mul     si
</span><span style="color:maroon">WinMeBS:7CB4                 </span><span style="color:navy">mov     bx, [bp+</span><span style="color:green">0Bh</span><span style="color:navy">]    </span>; bytes per sector
<span style="color:maroon">WinMeBS:7CB7                 </span><span style="color:navy">add     ax, bx
</span><span style="color:maroon">WinMeBS:7CB9                 </span><span style="color:navy">dec     ax              </span>; round up
<span style="color:maroon">WinMeBS:7CBA                 </span><span style="color:navy">div     bx
</span><span style="color:maroon">WinMeBS:7CBC                 </span><span style="color:navy">add     [bp-</span><span style="color:green">4</span><span style="color:navy">], ax      </span>; result = start of data (file) sectors
<span style="color:maroon">WinMeBS:7CBF                 </span><span style="color:navy">adc     [bp-</span><span style="color:green">2</span><span style="color:navy">], cx      </span>; cx = 0
<span style="color:maroon">WinMeBS:7CC2                 </span><span style="color:navy">popa
</span><span style="color:maroon">WinMeBS:7CC3
WinMeBS:7CC3 </span>bscode_5<span style="color:navy">:                               </span><span style="color:green">; CODE XREF: WinMeBS:7CE4j
</span><span style="color:maroon">WinMeBS:7CC3                 </span><span style="color:navy">mov     di, </span><span style="color:green">700h        </span>; 0:700h (or 70h:0)
<span style="color:maroon">WinMeBS:7CC6                 </span><span style="color:navy">call    </span>read_one_sector
<span style="color:maroon">WinMeBS:7CC9                 </span><span style="color:navy">jb      short </span>bscode_11
<span style="color:maroon">WinMeBS:7CCB
WinMeBS:7CCB </span>bscode_6<span style="color:navy">:                               </span><span style="color:green">; CODE XREF: WinMeBS:7CE2j
</span><span style="color:maroon">WinMeBS:7CCB                 </span><span style="color:navy">cmp     [di], ch
</span><span style="color:maroon">WinMeBS:7CCD                 </span><span style="color:navy">jz      short </span>bscode_7
<span style="color:maroon">WinMeBS:7CCF                 </span><span style="color:navy">pusha
</span><span style="color:maroon">WinMeBS:7CD0                 </span><span style="color:navy">mov     cl, </span><span style="color:green">11
</span><span style="color:maroon">WinMeBS:7CD2                 </span><span style="color:navy">mov     si, offset </span>IO_SYS <span style="color:gray">; &quot;IO      SYS&quot;
</span><span style="color:maroon">WinMeBS:7CD5                 </span><span style="color:navy">repe cmpsb
</span><span style="color:maroon">WinMeBS:7CD7                 </span><span style="color:navy">popa
</span><span style="color:maroon">WinMeBS:7CD8                 </span><span style="color:navy">jz      short </span>bscode_13
<span style="color:maroon">WinMeBS:7CDA                 </span><span style="color:navy">dec     si
</span><span style="color:maroon">WinMeBS:7CDB                 </span><span style="color:navy">jz      short </span>bscode_7
<span style="color:maroon">WinMeBS:7CDD                 </span><span style="color:navy">add     di, </span><span style="color:green">32          </span>; 2nd dir entry name (&#039;MSDOS   SYS&#039;)
<span style="color:maroon">WinMeBS:7CE0                 </span><span style="color:navy">cmp     di, bx
</span><span style="color:maroon">WinMeBS:7CE2                 </span><span style="color:navy">jb      short </span>bscode_6
<span style="color:maroon">WinMeBS:7CE4                 </span><span style="color:navy">jmp     short </span>bscode_5
<span style="color:maroon">WinMeBS:7CE6 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">WinMeBS:7CE6
WinMeBS:7CE6 </span>bscode_7<span style="color:navy">:                               </span><span style="color:green">; CODE XREF: WinMeBS:7CCDj
</span><span style="color:maroon">WinMeBS:7CE6                                         </span><span style="color:green">; WinMeBS:7CDBj
</span><span style="color:maroon">WinMeBS:7CE6                 </span><span style="color:navy">dec     byte ptr ds:</span>IO_SYS <span style="color:gray">; &quot;IO      SYS&quot;
</span><span style="color:maroon">WinMeBS:7CEA                 </span><span style="color:navy">jnp     short </span>bscode_4
<span style="color:maroon">WinMeBS:7CEC                 </span><span style="color:navy">mov     si, offset </span>invsd_msg_ptr
<span style="color:maroon">WinMeBS:7CEF
WinMeBS:7CEF </span>bscode_8<span style="color:navy">:                               </span><span style="color:green">; CODE XREF: WinMeBS:7D07j
</span><span style="color:maroon">WinMeBS:7CEF                                         </span><span style="color:green">; WinMeBS:7D0Cj
</span><span style="color:maroon">WinMeBS:7CEF                 </span><span style="color:navy">lodsb
</span><span style="color:maroon">WinMeBS:7CF0                 </span><span style="color:navy">cbw
</span><span style="color:maroon">WinMeBS:7CF1                 </span><span style="color:navy">add     si, ax
</span><span style="color:maroon">WinMeBS:7CF3
WinMeBS:7CF3 </span>bscode_9<span style="color:navy">:                               </span><span style="color:green">; CODE XREF: WinMeBS:7D02j
</span><span style="color:maroon">WinMeBS:7CF3                 </span><span style="color:navy">lodsb
</span><span style="color:maroon">WinMeBS:7CF4                 </span><span style="color:navy">cbw
</span><span style="color:maroon">WinMeBS:7CF5                 </span><span style="color:navy">inc     ax
</span><span style="color:maroon">WinMeBS:7CF6                 </span><span style="color:navy">jz      short </span>bscode_10
<span style="color:maroon">WinMeBS:7CF8                 </span><span style="color:navy">dec     ax
</span><span style="color:maroon">WinMeBS:7CF9                 </span><span style="color:navy">jz      short </span>bscode_12
<span style="color:maroon">WinMeBS:7CFB                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0Eh
</span><span style="color:maroon">WinMeBS:7CFD                 </span><span style="color:navy">mov     bx, </span><span style="color:green">7
</span><span style="color:maroon">WinMeBS:7D00                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - WRITE CHARACTER AND ADVANCE CURSOR (TTY WRITE)
<span style="color:maroon">WinMeBS:7D00                                         </span>; AL = character, BH = display page (alpha modes)
<span style="color:maroon">WinMeBS:7D00                                         </span>; BL = foreground color (graphics modes)
<span style="color:maroon">WinMeBS:7D02                 </span><span style="color:navy">jmp     short </span>bscode_9
<span style="color:maroon">WinMeBS:7D04 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">WinMeBS:7D04
WinMeBS:7D04 </span>bscode_10<span style="color:navy">:                              </span><span style="color:green">; CODE XREF: WinMeBS:7CF6j
</span><span style="color:maroon">WinMeBS:7D04                 </span><span style="color:navy">mov     si, offset </span>rdpkey_msg_ptr
<span style="color:maroon">WinMeBS:7D07                 </span><span style="color:navy">jmp     short </span>bscode_8
<span style="color:maroon">WinMeBS:7D09 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">WinMeBS:7D09
WinMeBS:7D09 </span>bscode_11<span style="color:navy">:                              </span><span style="color:green">; CODE XREF: WinMeBS:7CC9j
</span><span style="color:maroon">WinMeBS:7D09                                         </span><span style="color:green">; WinMeBS:7D30j
</span><span style="color:maroon">WinMeBS:7D09                 </span><span style="color:navy">mov     si, offset </span>diskerr_msg_ptr
<span style="color:maroon">WinMeBS:7D0C                 </span><span style="color:navy">jmp     short </span>bscode_8
<span style="color:maroon">WinMeBS:7D0E </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">WinMeBS:7D0E
WinMeBS:7D0E </span>bscode_12<span style="color:navy">:                              </span><span style="color:green">; CODE XREF: WinMeBS:7CF9j
</span><span style="color:maroon">WinMeBS:7D0E                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD -
<span style="color:maroon">WinMeBS:7D10                 </span><span style="color:navy">pop     si
</span><span style="color:maroon">WinMeBS:7D11                 </span><span style="color:navy">pop     ds
</span><span style="color:maroon">WinMeBS:7D12                 </span><span style="color:navy">pop     large dword ptr [si]
</span><span style="color:maroon">WinMeBS:7D15                 </span><span style="color:navy">int     </span><span style="color:green">19h             </span>; DISK BOOT
<span style="color:maroon">WinMeBS:7D15                                         </span>; causes reboot of disk system
<span style="color:maroon">WinMeBS:7D17
WinMeBS:7D17 </span>bscode_13<span style="color:navy">:                              </span><span style="color:green">; CODE XREF: WinMeBS:7CD8j
</span><span style="color:maroon">WinMeBS:7D17                 </span><span style="color:navy">mov     si, offset </span>one
<span style="color:maroon">WinMeBS:7D1A                 </span><span style="color:navy">mov     di, [di+</span><span style="color:green">1Ah</span><span style="color:navy">]    </span>; first cluster of IO.SYS
<span style="color:maroon">WinMeBS:7D1D                 </span><span style="color:navy">lea     ax, [di-</span><span style="color:green">2</span><span style="color:navy">]      </span>; ax = di-2
<span style="color:maroon">WinMeBS:7D20                 </span><span style="color:navy">mov     cl, [bp+</span><span style="color:green">0Dh</span><span style="color:navy">]    </span>; * sectors per cluster
<span style="color:maroon">WinMeBS:7D23                 </span><span style="color:navy">mul     cx
</span><span style="color:maroon">WinMeBS:7D25                 </span><span style="color:navy">add     ax, [bp-</span><span style="color:green">4</span><span style="color:navy">]      </span>; + data area start address
<span style="color:maroon">WinMeBS:7D28                 </span><span style="color:navy">adc     dx, [bp-</span><span style="color:green">2</span><span style="color:navy">]      </span>; result = LBA of IO.SYS 1st cluster
<span style="color:maroon">WinMeBS:7D2B                 </span><span style="color:navy">mov     cl, </span><span style="color:green">4           </span>; read 4 sectors (complete MSLOAD section)
<span style="color:maroon">WinMeBS:7D2D                 </span><span style="color:navy">call    </span>read_1st_cluster
<span style="color:maroon">WinMeBS:7D30                 </span><span style="color:navy">jb      short </span>bscode_11
<span style="color:maroon">WinMeBS:7D32                 </span><span style="color:navy">jmp     far ptr </span><span style="background:blue"><span style="color:navy">70h:200h</span></span> ; jump to IO.SYS offset 200h (MSLOAD section)
<span style="color:black">WinMeBS:7D37 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">WinMeBS:7D37 </span><span style="color:gray">; START OF FUNCTION CHUNK FOR read_1st_cluster
</span><span style="color:black">WinMeBS:7D37
WinMeBS:7D37 </span><span style="color:gray">disk_read</span><span style="color:navy">:                              </span><span style="color:green">; CODE XREF: read_1st_cluster+7j
</span><span style="color:black">WinMeBS:7D37                 </span><span style="color:navy">push    dx
</span><span style="color:black">WinMeBS:7D38                 </span><span style="color:navy">push    ax
</span><span style="color:black">WinMeBS:7D39                 </span><span style="color:navy">push    es
</span><span style="color:black">WinMeBS:7D3A                 </span><span style="color:navy">push    bx
</span><span style="color:black">WinMeBS:7D3B                 </span><span style="color:navy">push    </span><span style="color:green">1               </span>; 1 sector
<span style="color:black">WinMeBS:7D3D                 </span><span style="color:navy">push    </span><span style="color:green">10h
</span><span style="color:black">WinMeBS:7D3F                 </span><span style="color:navy">xchg    ax, cx
</span><span style="color:black">WinMeBS:7D40                 </span><span style="color:navy">mov     ax, [bp+</span><span style="color:green">18h</span><span style="color:navy">]    </span>; sectors per track
<span style="color:black">WinMeBS:7D43                 </span><span style="color:navy">mov     ds:</span><span style="color:green">526h</span><span style="color:navy">, al     </span>; save spt value to disk parms table
<span style="color:black">WinMeBS:7D46                 </span><span style="color:navy">xchg    ax, si          </span>; si = spt
<span style="color:black">WinMeBS:7D47                 </span><span style="color:navy">xchg    ax, dx          </span>; 32 bit division (high word at 1st)
<span style="color:black">WinMeBS:7D48                 </span><span style="color:navy">xor     dx, dx
</span><span style="color:black">WinMeBS:7D4A                 </span><span style="color:navy">div     si
</span><span style="color:black">WinMeBS:7D4C                 </span><span style="color:navy">xchg    ax, cx          </span>; low word (at 2nd)
<span style="color:black">WinMeBS:7D4C                                         </span>; cx = high word of divison result
<span style="color:black">WinMeBS:7D4D                 </span><span style="color:navy">div     si              </span>; dx:ax/spt
<span style="color:black">WinMeBS:7D4F                 </span><span style="color:navy">inc     dx              </span>; sector number is 1 based
<span style="color:black">WinMeBS:7D50                 </span><span style="color:navy">xchg    cx, dx
</span><span style="color:black">WinMeBS:7D52                 </span><span style="color:navy">div     word ptr [bp+</span><span style="color:green">1Ah</span><span style="color:navy">] </span>; number of heads
<span style="color:black">WinMeBS:7D55                 </span><span style="color:navy">mov     dh, dl
</span><span style="color:black">WinMeBS:7D57                 </span><span style="color:navy">mov     ch, al          </span>; cylinder (low 8 bit)
<span style="color:black">WinMeBS:7D59                 </span><span style="color:navy">ror     ah, </span><span style="color:green">2
</span><span style="color:black">WinMeBS:7D5C                 </span><span style="color:navy">or      cl, ah          </span>; sector (6 bit) and cylinder high 2 bit
<span style="color:black">WinMeBS:7D5E                 </span><span style="color:navy">mov     ax, </span><span style="color:green">201h        </span>; CHS read (1 sector)
<span style="color:black">WinMeBS:7D61                 </span><span style="color:navy">cmp     byte ptr [bp+</span><span style="color:green">2</span><span style="color:navy">], </span><span style="color:green">0Eh </span>; if it is not a LBA type partition,
<span style="color:black">WinMeBS:7D61                                         </span>; CHS read is forced
<span style="color:black">WinMeBS:7D65                 </span><span style="color:navy">jnz     short </span><span style="color:gray">diskrd_1
</span><span style="color:black">WinMeBS:7D67                 </span><span style="color:navy">mov     ah, </span><span style="color:green">42h         </span>; LBA read
<span style="color:black">WinMeBS:7D69                 </span><span style="color:navy">mov     si, sp
</span><span style="color:black">WinMeBS:7D6B
WinMeBS:7D6B </span><span style="color:gray">diskrd_1</span><span style="color:navy">:                               </span><span style="color:green">; CODE XREF: read_1st_cluster-8Dj
</span><span style="color:black">WinMeBS:7D6B                 </span><span style="color:navy">mov     dl, [bp+</span><span style="color:#ff8000">24h</span><span style="color:navy">]
</span><span style="color:black">WinMeBS:7D6E                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - IBM/MS Extension - EXTENDED READ (DL - drive, DS:SI - disk address packet)
<span style="color:black">WinMeBS:7D70                 </span><span style="color:navy">popa
</span><span style="color:black">WinMeBS:7D71                 </span><span style="color:navy">popa
</span><span style="color:black">WinMeBS:7D72                 </span><span style="color:navy">jb      short </span><span style="color:gray">disk_rd3  </span>; error
<span style="color:black">WinMeBS:7D74                 </span><span style="color:navy">inc     ax              </span>; next disk sector address
<span style="color:black">WinMeBS:7D75                 </span><span style="color:navy">jnz     short </span><span style="color:gray">diskrd_2
</span><span style="color:black">WinMeBS:7D77                 </span><span style="color:navy">inc     dx
</span><span style="color:black">WinMeBS:7D78
WinMeBS:7D78 </span><span style="color:gray">diskrd_2</span><span style="color:navy">:                               </span><span style="color:green">; CODE XREF: read_1st_cluster-7Dj
</span><span style="color:black">WinMeBS:7D78                 </span><span style="color:navy">add     bx, [bp+</span><span style="color:green">0Bh</span><span style="color:navy">]    </span>; add bps (512 bytes) to buffer addr
<span style="color:black">WinMeBS:7D7B                 </span><span style="color:navy">dec     cx              </span>; remain sectors to read
<span style="color:black">WinMeBS:7D7C                 </span><span style="color:navy">jnz     short </span><span style="color:gray">diskrd_4  </span>; read next sector (of IO.SYS 1st cluster)
<span style="color:black">WinMeBS:7D7E
WinMeBS:7D7E </span><span style="color:gray">disk_rd3</span><span style="color:navy">:                               </span><span style="color:green">; CODE XREF: read_1st_cluster-80j
</span><span style="color:black">WinMeBS:7D7E                 </span><span style="color:navy">retn
</span><span style="color:black">WinMeBS:7D7E </span><span style="color:gray">; END OF FUNCTION CHUNK FOR read_1st_cluster
</span><span style="color:black">WinMeBS:7D7E </span><span style="color:gray">; ---------------------------------------------------------------------------
WinMeBS:7D7F </span>invsd_msg_ptr   <span style="color:navy">db </span><span style="color:#008040">3                    </span><span style="color:#8080ff">; DATA XREF: WinMeBS:7CECo
</span><span style="color:gray">WinMeBS:7D80 </span>diskerr_msg_ptr <span style="color:navy">db </span><span style="color:#008040">24                   </span><span style="color:#8080ff">; DATA XREF: WinMeBS:bscode_11o
</span><span style="color:gray">WinMeBS:7D81 </span>one             <span style="color:navy">db </span><span style="color:#008040">1                    </span><span style="color:#8080ff">; DATA XREF: WinMeBS:bscode_13o
</span><span style="color:gray">WinMeBS:7D82 </span>rdpkey_msg_ptr  <span style="color:navy">db </span><span style="color:#008040">27h                  </span><span style="color:#8080ff">; DATA XREF: WinMeBS:bscode_10o
</span><span style="color:gray">WinMeBS:7D83                 </span><span style="color:navy">db </span><span style="color:green">0Dh</span><span style="color:navy">,</span><span style="color:green">0Ah
</span><span style="color:gray">WinMeBS:7D83                 </span><span style="color:navy">db &#039;Invalid system disk&#039;
</span><span style="color:olive">WinMeBS:7D98                 </span><span style="color:navy">db </span><span style="color:#008040">0FFh
</span><span style="color:gray">WinMeBS:7D99                 </span><span style="color:navy">db </span><span style="color:green">0Dh</span><span style="color:navy">,</span><span style="color:green">0Ah
</span><span style="color:gray">WinMeBS:7D99                 </span><span style="color:navy">db &#039;Disk I/O error&#039;
</span><span style="color:olive">WinMeBS:7DA9                 </span><span style="color:navy">db </span><span style="color:#008040">0FFh
</span><span style="color:gray">WinMeBS:7DAA                 </span><span style="color:navy">db </span><span style="color:green">0Dh</span><span style="color:navy">,</span><span style="color:green">0Ah
</span><span style="color:gray">WinMeBS:7DAA                 </span><span style="color:navy">db &#039;Replace the disk, and then press any key&#039;,0Dh,0Ah,0
</span><span style="color:gray">WinMeBS:7DD7                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">WinMeBS:7DD8 </span>IO_SYS          <span style="color:navy">db &#039;IO      SYS&#039;        </span><span style="color:#8080ff">; DATA XREF: WinMeBS:7C8Fw
</span><span style="color:gray">WinMeBS:7DD8                                         </span><span style="color:#8080ff">; WinMeBS:7CD2o ...
</span><span style="color:gray">WinMeBS:7DE3 </span>MSDOS_SYS       <span style="color:navy">db &#039;MSDOS   SYS&#039;
</span><span style="color:gray">WinMeBS:7DEE                 </span><span style="color:navy">dw </span><span style="color:#008040">17Fh
</span><span style="color:gray">WinMeBS:7DF0                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:black">WinMeBS:7DF1
WinMeBS:7DF1 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">WinMeBS:7DF1
WinMeBS:7DF1
WinMeBS:7DF1 </span>read_one_sector proc near               <span style="color:green">; CODE XREF: WinMeBS:7C70p
</span><span style="color:black">WinMeBS:7DF1                                         </span><span style="color:green">; WinMeBS:7CC6p
</span><span style="color:black">WinMeBS:7DF1                 </span><span style="color:navy">inc     cx              </span>; cx = 1
<span style="color:black">WinMeBS:7DF1 </span><span style="background:blue">read_one_sector endp</span><span style="background:blue"> ; sp-analysis failed</span>
<span style="color:black">WinMeBS:7DF1
WinMeBS:7DF2
WinMeBS:7DF2 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">WinMeBS:7DF2
WinMeBS:7DF2
WinMeBS:7DF2 </span>read_1st_cluster proc near              <span style="color:green">; CODE XREF: WinMeBS:7D2Dp
</span><span style="color:black">WinMeBS:7DF2
WinMeBS:7DF2 </span><span style="color:gray">; FUNCTION CHUNK AT WinMeBS:7D37 SIZE 00000048 BYTES
</span><span style="color:black">WinMeBS:7DF2
WinMeBS:7DF2                 </span><span style="color:navy">mov     bx, </span><span style="color:green">700h        </span>; buffer -&gt; es:bx = 0:700h
<span style="color:black">WinMeBS:7DF5
WinMeBS:7DF5 </span><span style="color:gray">diskrd_4</span><span style="color:navy">:                               </span><span style="color:green">; CODE XREF: read_1st_cluster-76j
</span><span style="color:black">WinMeBS:7DF5                 </span><span style="color:navy">pusha                   </span>; push all registers except seg segs
<span style="color:black">WinMeBS:7DF6                 </span><span style="color:navy">push    large </span><span style="color:green">0         </span>; dd 0
<span style="color:black">WinMeBS:7DF9                 </span><span style="color:navy">jmp     </span><span style="color:gray">disk_read
</span><span style="color:black">WinMeBS:7DF9 </span><span style="background:blue"><span style="color:gray">read_1st_cluster endp</span></span><span style="background:blue"> <span style="color:gray">; sp-analysis failed</span></span>
<span style="color:black">WinMeBS:7DF9
WinMeBS:7DF9 </span><span style="color:gray">; ---------------------------------------------------------------------------
WinMeBS:7DFC                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">WinMeBS:7DFE                 </span><span style="color:navy">dw </span><span style="color:#008040">0AA55h               </span>; BS signature (magic word)
<span style="color:gray">WinMeBS:7DFE </span>WinMeBS         ends                    ; (last word of BS, offset 510)
<span style="color:gray">WinMeBS:7DFE
WinMeBS:7DFE
WinMeBS:7DFE                 </span>end
</span></body></html>
