<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>IDA - C:\WinMe\jo.idb (jo.sys)</title>
</head>
<body bgcolor="white">
<span style="white-space: pre; font-family: Consolas; color: blue; background: white">

<span style="color:olive">seg000:0000 </span>;
<span style="color:olive">seg000:0000 </span>; +-------------------------------------------------------------------------+
<span style="color:olive">seg000:0000 </span>; |   This file has been generated by The Interactive Disassembler (IDA)    |
<span style="color:olive">seg000:0000 </span>; |           Copyright (c) 2013 Hex-Rays, &lt;support@hex-rays.com&gt;           |
<span style="color:olive">seg000:0000 </span>; |                      License info: 48-325F-7034-FF                      |
<span style="color:olive">seg000:0000 </span>; |                     Rico Baumgart, personal license                     |
<span style="color:olive">seg000:0000 </span>; +-------------------------------------------------------------------------+
<span style="color:olive">seg000:0000 </span>;
<span style="color:olive">seg000:0000 </span>; Input MD5   : 4ED87A7F53B3F4492BBE2E0E72ABE4EF
<span style="color:olive">seg000:0000 </span>; Input CRC32 : BD494D2D
<span style="color:olive">seg000:0000
seg000:0000 </span>; File Name   : C:\WinMe\jo.sys
<span style="color:olive">seg000:0000 </span>; Format      : MS-DOS SYS-file (perhaps device driver)
<span style="color:olive">seg000:0000 </span>; Base Address: 0h Range: 0h-800h Loaded length: 800h
<span style="color:olive">seg000:0000
seg000:0000                 .</span>686p
<span style="color:olive">seg000:0000                 </span>.mmx
<span style="color:olive">seg000:0000                 </span>.model small
<span style="color:olive">seg000:0000
seg000:0000 </span><span style="color:gray">; ===========================================================================
</span><span style="color:olive">seg000:0000
seg000:0000 </span><span style="color:gray">; Segment type: Pure code
</span><span style="color:olive">seg000:0000 </span>seg000          segment byte public &#039;CODE&#039; use16
<span style="color:olive">seg000:0000                 </span>assume cs:seg000
<span style="color:olive">seg000:0000                 </span>assume es:nothing, ss:nothing, ds:nothing, fs:nothing, gs:nothing
<span style="color:olive">seg000:0000 </span><span style="color:navy">unk_0           db  </span><span style="color:#008040">4Dh </span><span style="color:gray">; M
</span><span style="color:olive">seg000:0001                 </span><span style="color:navy">db  </span><span style="color:#008040">5Ah </span><span style="color:gray">; Z
seg000:0002                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">seg000:0004                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; block device
<span style="color:gray">seg000:0006                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">seg000:0008                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">seg000:000A </span><span style="color:navy">word_A          dw </span><span style="color:#008040">0                    </span>; May be device number
<span style="color:gray">seg000:000C                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">seg000:000E                 </span><span style="color:navy">dw </span><span style="color:#008040">0
</span><span style="color:gray">seg000:0010 </span>MBR             <span style="color:navy">dd </span><span style="color:#008040">7C00h                </span><span style="color:#8080ff">; DATA XREF: hard_disk_boot+2Ar
</span><span style="color:gray">seg000:0010                                         </span><span style="color:#8080ff">; cdrom_fd_boot+18r
</span><span style="color:gray">seg000:0014 </span><span style="color:navy">word_14         dw </span><span style="color:#008040">0
</span><span style="color:gray">seg000:0016                 </span><span style="color:navy">dw </span><span style="color:#008040">0FFFFh
</span><span style="color:gray">seg000:0018 </span>menu_header     <span style="color:navy">dw offset </span>menu_row_1    <span style="color:#8080ff">; DATA XREF: show_menu+3o
</span><span style="color:gray">seg000:001A                 </span><span style="color:navy">dw </span><span style="color:#008040">0                    </span>; row 0, col 0
<span style="color:gray">seg000:001C                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">seg000:001D                 </span><span style="color:navy">dw </span><span style="color:#008040">40
</span><span style="color:gray">seg000:001F </span>start_of_string <span style="color:navy">db &#039;Microsoft Windows ME CD-ROM Startup Menu&#039;
</span><span style="color:gray">seg000:0047 </span>menu_row_1      <span style="color:navy">dw offset </span>menu_row_2    <span style="color:#8080ff">; DATA XREF: seg000:menu_headero
</span><span style="color:gray">seg000:0049                 </span><span style="color:navy">dw </span><span style="color:#008040">100h                 </span>; row 1, col 0
<span style="color:gray">seg000:004B                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">seg000:004C                 </span><span style="color:navy">db </span><span style="color:#008040">40
</span><span style="color:gray">seg000:004D                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">seg000:004E </span>menu_line       <span style="color:navy">db &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;
</span><span style="color:gray">seg000:004E                 </span><span style="color:navy">db &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;
</span><span style="color:gray">seg000:004E                 </span><span style="color:navy">db &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;</span><span style="color:navy">, &#039;</span><span style="color:green">=&#039;
</span><span style="color:gray">seg000:0076 </span>menu_row_2      <span style="color:navy">dw offset </span>menu_row_3    <span style="color:#8080ff">; DATA XREF: seg000:menu_row_1o
</span><span style="color:gray">seg000:0076                                         </span><span style="color:#8080ff">; seg000:025Bo ...
</span><span style="color:gray">seg000:0078                 </span><span style="color:navy">dw </span><span style="color:#008040">300h                 </span>; row 3, col 0
<span style="color:gray">seg000:007A                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">seg000:007B                 </span><span style="color:navy">dw </span><span style="color:#008040">23                   </span>; string length
<span style="color:gray">seg000:007D </span>menu_option_1   <span style="color:navy">db &#039;1.  Boot from Hard Disk&#039;
</span><span style="color:gray">seg000:0094 </span>menu_row_3      <span style="color:navy">dw offset </span>menu_row_4    <span style="color:#8080ff">; DATA XREF: seg000:menu_row_2o
</span><span style="color:gray">seg000:0094                                         </span><span style="color:#8080ff">; seg000:0263o ...
</span><span style="color:gray">seg000:0096                 </span><span style="color:navy">dw </span><span style="color:#008040">400h                 </span>; row 4, col 0
<span style="color:gray">seg000:0098                 </span><span style="color:navy">db </span><span style="color:#008040">0                    </span>; mode 0
<span style="color:gray">seg000:0099                 </span><span style="color:navy">dw </span><span style="color:#008040">20
</span><span style="color:gray">seg000:009B </span>menu_option_2   <span style="color:navy">db &#039;2.  Boot from CD-ROM&#039;
</span><span style="color:gray">seg000:00AF </span>menu_row_4      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; DATA XREF: seg000:menu_row_3o
</span><span style="color:gray">seg000:00AF                                         </span>; end of menu rows
<span style="color:gray">seg000:00B1                 </span><span style="color:navy">dw </span><span style="color:#008040">600h                 </span>; row 6, col 0
<span style="color:gray">seg000:00B3                 </span><span style="color:navy">db </span><span style="color:#008040">1                    </span>; mode 1
<span style="color:gray">seg000:00B4                 </span><span style="color:navy">dw </span><span style="color:#008040">19
</span><span style="color:gray">seg000:00B6                 </span><span style="color:navy">db &#039;Enter your choice: &#039;
</span><span style="color:gray">seg000:00C9 </span>timer_text      <span style="color:navy">dw </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; DATA XREF: wait_for_keypress+12o
</span><span style="color:gray">seg000:00C9                                         </span><span style="color:#8080ff">; wait_for_keypress+61o
</span><span style="color:gray">seg000:00CB                 </span><span style="color:navy">dw </span><span style="color:#008040">619h                 </span>; row 6, col 25
<span style="color:gray">seg000:00CD                 </span><span style="color:navy">db </span><span style="color:#008040">0
</span><span style="color:gray">seg000:00CE                 </span><span style="color:navy">dw </span><span style="color:#008040">18
</span><span style="color:gray">seg000:00D0                 </span><span style="color:navy">db &#039;Time remaining: __&#039;
</span><span style="color:gray">seg000:00E2 </span>timer_ticks     <span style="color:navy">dw </span><span style="color:#008040">2 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)             </span><span style="color:#8080ff">; DATA XREF: wait_for_keypress:read_timer_1r
</span><span style="color:gray">seg000:00E2                                         </span><span style="color:#8080ff">; wait_for_keypress+2Dw ...
</span><span style="color:gray">seg000:00E6 </span>timer_over      <span style="color:navy">db </span><span style="color:#008040">0                    </span><span style="color:#8080ff">; DATA XREF: seg000:m_getc_okw
</span><span style="color:gray">seg000:00E6                                         </span><span style="color:#8080ff">; wait_for_keypressr ...
</span><span style="color:gray">seg000:00E7 </span>timer_divisor   <span style="color:navy">db </span><span style="color:#008040">18                   </span><span style="color:#8080ff">; DATA XREF: wait_for_keypress+49r
</span><span style="color:gray">seg000:00E7                                         </span>; column 18
<span style="color:gray">seg000:00E8 </span>divisor_10      <span style="color:navy">db </span><span style="color:#008040">10                   </span><span style="color:#8080ff">; DATA XREF: wait_for_keypress+59r
</span><span style="color:gray">seg000:00E8                                         </span>; row 10
<span style="color:gray">seg000:00E9 </span>structure_buf   <span style="color:navy">dw </span><span style="color:#008040">19                   </span><span style="color:#8080ff">; DATA XREF: hard_disk_boot+Ao
</span><span style="color:gray">seg000:00E9                                         </span>; 19 bytes empty structure buffer
<span style="color:gray">seg000:00E9                                         </span>; for INT 13h ah=4B00h
<span style="color:gray">seg000:00EB                 </span><span style="color:navy">db </span><span style="color:#008040">17 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">seg000:00FC </span>selection       <span style="color:navy">dw &#039;</span><span style="color:green">1&#039;                  </span><span style="color:#8080ff">; DATA XREF: seg000:0221r
</span><span style="color:gray">seg000:00FC                                         </span><span style="color:#8080ff">; seg000:0230r ...
</span><span style="color:gray">seg000:00FC                                         </span>; default choice is 1
<span style="color:gray">seg000:00FE                 </span><span style="color:navy">db </span><span style="color:#008040">258 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:maroon">seg000:0200 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">seg000:0200
seg000:0200 </span>START$<span style="color:navy">:
</span><span style="color:maroon">seg000:0200                 </span><span style="color:navy">cli
</span><span style="color:maroon">seg000:0201                 </span><span style="color:navy">mov     ax, </span><span style="color:green">0
</span><span style="color:maroon">seg000:0204                 </span><span style="color:navy">mov     ss, ax
</span><span style="color:maroon">seg000:0206                 </span>assume ss:seg000
<span style="color:maroon">seg000:0206                 </span><span style="color:navy">mov     sp, </span><span style="color:green">7C00h
</span><span style="color:maroon">seg000:0209                 </span><span style="color:navy">mov     ax, cs
</span><span style="color:maroon">seg000:020B                 </span><span style="color:navy">mov     es, ax
</span><span style="color:maroon">seg000:020D                 </span>assume es:seg000
<span style="color:maroon">seg000:020D                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:maroon">seg000:020F                 </span>assume ds:seg000
<span style="color:maroon">seg000:020F                 </span><span style="color:navy">cld
</span><span style="color:maroon">seg000:0210                 </span><span style="color:navy">sti
</span><span style="color:maroon">seg000:0211                 </span><span style="color:navy">call    </span>show_menu
<span style="color:maroon">seg000:0214                 </span><span style="color:navy">call    </span>flush_keyb_buf
<span style="color:maroon">seg000:0217
seg000:0217 </span>m_getc<span style="color:navy">:                                 </span><span style="color:green">; CODE XREF: seg000:021Fj
</span><span style="color:maroon">seg000:0217                                         </span><span style="color:green">; seg000:026Bj ...
</span><span style="color:maroon">seg000:0217                 </span><span style="color:navy">call    </span>get_char
<span style="color:maroon">seg000:021A                 </span><span style="color:navy">jb      short </span>m_getc_ok
<span style="color:maroon">seg000:021C                 </span><span style="color:navy">call    </span>wait_for_keypress
<span style="color:maroon">seg000:021F                 </span><span style="color:navy">jnb     short </span>m_getc
<span style="color:maroon">seg000:0221                 </span><span style="color:navy">mov     ax, cs:</span>selection ; character (user has pressed this key)
<span style="color:maroon">seg000:0225
seg000:0225 </span>m_getc_ok<span style="color:navy">:                              </span><span style="color:green">; CODE XREF: seg000:021Aj
</span><span style="color:maroon">seg000:0225                 </span><span style="color:navy">or      cs:</span>timer_over<span style="color:navy">, </span><span style="color:green">1
</span><span style="color:maroon">seg000:022B                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">0Dh         </span>; CR
<span style="color:maroon">seg000:022E                 </span><span style="color:navy">jnz     short </span>chk_choice_1
<span style="color:maroon">seg000:0230                 </span><span style="color:navy">mov     ax, cs:</span>selection
<span style="color:maroon">seg000:0234
seg000:0234 </span>chk_choice_1<span style="color:navy">:                           </span><span style="color:green">; CODE XREF: seg000:022Ej
</span><span style="color:maroon">seg000:0234                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">31h </span><span style="color:gray">; &#039;1&#039;   </span>; Option 1
<span style="color:maroon">seg000:0237                 </span><span style="color:navy">jnz     short </span>chk_choice_2
<span style="color:maroon">seg000:0239                 </span><span style="color:navy">call    </span>set_vmode
<span style="color:maroon">seg000:023C                 </span><span style="color:navy">call    </span>hard_disk_boot
<span style="color:maroon">seg000:023F                 </span><span style="color:navy">jmp     </span>int19h
<span style="color:maroon">seg000:0242 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">seg000:0242
seg000:0242 </span>chk_choice_2<span style="color:navy">:                           </span><span style="color:green">; CODE XREF: seg000:0237j
</span><span style="color:maroon">seg000:0242                 </span><span style="color:navy">cmp     ax, </span><span style="color:#ff8000">32h </span><span style="color:gray">; &#039;2&#039;   </span>; Option 2
<span style="color:maroon">seg000:0245                 </span><span style="color:navy">jnz     short </span>chk_choice_up
<span style="color:maroon">seg000:0247                 </span><span style="color:navy">call    </span>set_vmode
<span style="color:maroon">seg000:024A                 </span><span style="color:navy">call    </span>cdrom_fd_boot
<span style="color:maroon">seg000:024D                 </span><span style="color:navy">jmp     short </span>int19h
<span style="color:maroon">seg000:024F </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">seg000:024F
seg000:024F </span>chk_choice_up<span style="color:navy">:                          </span><span style="color:green">; CODE XREF: seg000:0245j
</span><span style="color:maroon">seg000:024F                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">4800h       </span>; up arrow
<span style="color:maroon">seg000:0252                 </span><span style="color:navy">jnz     short </span>chk_choice_down
<span style="color:maroon">seg000:0254                 </span><span style="color:navy">mov     cs:</span>selection<span style="color:navy">, &#039;</span><span style="color:green">1&#039; </span>; user&#039;s menu choice is &#039;1&#039;
<span style="color:maroon">seg000:0254                                         </span>; (but he/she has not ENTERed it yet)
<span style="color:maroon">seg000:025B                 </span><span style="color:navy">mov     si, offset </span>menu_row_2 ; selected (focused)
<span style="color:maroon">seg000:025E                 </span><span style="color:navy">mov     al, </span><span style="color:green">70h         </span>; character attribute (highlighted)
<span style="color:maroon">seg000:0260                 </span><span style="color:navy">call    </span>display_row
<span style="color:maroon">seg000:0263                 </span><span style="color:navy">mov     si, offset </span>menu_row_3
<span style="color:maroon">seg000:0266                 </span><span style="color:navy">mov     al, </span><span style="color:green">7           </span>; character attribute (normal)
<span style="color:maroon">seg000:0268                 </span><span style="color:navy">call    </span>display_row
<span style="color:maroon">seg000:026B                 </span><span style="color:navy">jmp     short </span>m_getc
<span style="color:maroon">seg000:026D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">seg000:026D
seg000:026D </span>chk_choice_down<span style="color:navy">:                        </span><span style="color:green">; CODE XREF: seg000:0252j
</span><span style="color:maroon">seg000:026D                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">5000h       </span>; down arrow
<span style="color:maroon">seg000:0270                 </span><span style="color:navy">jnz     short </span>chk_choice_getc
<span style="color:maroon">seg000:0272                 </span><span style="color:navy">mov     cs:</span>selection<span style="color:navy">, &#039;</span><span style="color:green">2&#039; </span>; user&#039;s menu choice is &#039;2&#039;
<span style="color:maroon">seg000:0272                                         </span>; (but he/she has not ENTERed it yet)
<span style="color:maroon">seg000:0279                 </span><span style="color:navy">mov     si, offset </span>menu_row_3 ; selected (focused)
<span style="color:maroon">seg000:027C                 </span><span style="color:navy">mov     al, </span><span style="color:green">70h         </span>; character attribute (highlighted)
<span style="color:maroon">seg000:027E                 </span><span style="color:navy">call    </span>display_row
<span style="color:maroon">seg000:0281                 </span><span style="color:navy">mov     si, offset </span>menu_row_2
<span style="color:maroon">seg000:0284                 </span><span style="color:navy">mov     al, </span><span style="color:green">7           </span>; character attribute (normal)
<span style="color:maroon">seg000:0286                 </span><span style="color:navy">call    </span>display_row
<span style="color:maroon">seg000:0289                 </span><span style="color:navy">jmp     short </span>m_getc
<span style="color:maroon">seg000:028B </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">seg000:028B
seg000:028B </span>chk_choice_getc<span style="color:navy">:                        </span><span style="color:green">; CODE XREF: seg000:0270j
</span><span style="color:maroon">seg000:028B                 </span><span style="color:navy">jmp     short </span>m_getc
<span style="color:maroon">seg000:028D </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:maroon">seg000:028D
seg000:028D </span>int19h<span style="color:navy">:                                 </span><span style="color:green">; CODE XREF: seg000:023Fj
</span><span style="color:maroon">seg000:028D                                         </span><span style="color:green">; seg000:024Dj ...
</span><span style="color:maroon">seg000:028D                 </span><span style="color:navy">int     </span><span style="color:green">19h             </span>; DISK BOOT
<span style="color:maroon">seg000:028D                                         </span>; causes reboot of disk system
<span style="color:maroon">seg000:028F                 </span><span style="color:navy">jmp     short </span>int19h
<span style="color:black">seg000:0291
seg000:0291 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:0291
seg000:0291
seg000:0291 </span>read_disk_sector_0 proc near            <span style="color:green">; CODE XREF: hard_disk_boot+1Ep
</span><span style="color:black">seg000:0291                                         </span><span style="color:green">; cdrom_fd_boot+2p
</span><span style="color:black">seg000:0291                 </span><span style="color:navy">sub     ax, ax
</span><span style="color:black">seg000:0293                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">seg000:0295                 </span><span style="color:navy">mov     bx, </span><span style="color:green">7C00h
</span><span style="color:black">seg000:0298                 </span><span style="color:navy">mov     ax, </span><span style="color:#ff8000">201h
</span><span style="color:black">seg000:029B                 </span><span style="color:navy">mov     cx, </span><span style="color:green">1
</span><span style="color:black">seg000:029E                 </span><span style="color:navy">mov     dh, </span><span style="color:green">0
</span><span style="color:black">seg000:02A0                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - READ SECTORS INTO MEMORY
<span style="color:black">seg000:02A0                                         </span>; AL = number of sectors to read, CH = track, CL = sector
<span style="color:black">seg000:02A0                                         </span>; DH = head, DL = drive, ES:BX -&gt; buffer to fill
<span style="color:black">seg000:02A0                                         </span>; Return: CF set on error, AH = status, AL = number of sectors read
<span style="color:black">seg000:02A2                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:02A2 </span>read_disk_sector_0 endp
<span style="color:black">seg000:02A2
seg000:02A3
seg000:02A3 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:02A3
seg000:02A3
seg000:02A3 </span>hard_disk_boot  proc near               <span style="color:green">; CODE XREF: seg000:023Cp
</span><span style="color:black">seg000:02A3                 </span><span style="color:navy">push    </span>word ptr ss:0410h ; ROMBIOS DATA area,
<span style="color:black">seg000:02A3                                         </span>; save equipment flags
<span style="color:black">seg000:02A8                 </span><span style="color:navy">mov     ax, </span><span style="color:green">4B00h
</span><span style="color:black">seg000:02AB                 </span><span style="color:navy">mov     dl, </span><span style="color:green">0           </span>; terminate drive A: emulation
<span style="color:black">seg000:02AD                 </span><span style="color:navy">mov     si, offset </span>structure_buf
<span style="color:black">seg000:02B0                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - Bootable CD-ROM - AL =TERMINATE DISK EMULATION
<span style="color:black">seg000:02B2                 </span><span style="color:navy">pop     </span>word ptr ss:0410h ; restore equipment flags
<span style="color:black">seg000:02B7                 </span><span style="color:navy">jnb     short $+</span><span style="color:green">2
</span><span style="color:black">seg000:02B9
seg000:02B9 </span><span style="color:gray">reset_hd</span><span style="color:navy">:                               </span><span style="color:green">; CODE XREF: hard_disk_boot+14j
</span><span style="color:black">seg000:02B9                 </span><span style="color:navy">sub     ax, ax
</span><span style="color:black">seg000:02BB                 </span><span style="color:navy">mov     dl, </span><span style="color:green">80h
</span><span style="color:black">seg000:02BD                 </span><span style="color:navy">int     </span><span style="color:green">13h             </span>; DISK - RESET DISK SYSTEM
<span style="color:black">seg000:02BD                                         </span>; DL = drive (if bit 7 is set both hard disks and floppy disks reset)
<span style="color:black">seg000:02BF                 </span><span style="color:navy">mov     dl, </span><span style="color:green">80h
</span><span style="color:black">seg000:02C1                 </span><span style="color:navy">call    </span>read_disk_sector_0
<span style="color:black">seg000:02C4                 </span><span style="color:navy">jnb     short </span><span style="color:gray">jmp_to_mbr
</span><span style="color:black">seg000:02C6                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:02C7 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">seg000:02C7
seg000:02C7 </span><span style="color:gray">jmp_to_mbr</span><span style="color:navy">:                             </span><span style="color:green">; CODE XREF: hard_disk_boot+21j
</span><span style="color:black">seg000:02C7                 </span><span style="color:navy">sub     ax, ax          </span>; set ds and es to zero
<span style="color:black">seg000:02C9                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">seg000:02CB                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">seg000:02CD                 </span><span style="color:navy">jmp     cs:</span>MBR          ; jump to master boot code
<span style="color:black">seg000:02CD </span>hard_disk_boot  endp
<span style="color:black">seg000:02CD
seg000:02D2
seg000:02D2 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:02D2
seg000:02D2
seg000:02D2 </span>cdrom_fd_boot   proc near               <span style="color:green">; CODE XREF: seg000:024Ap
</span><span style="color:black">seg000:02D2                 </span><span style="color:navy">mov     dl, </span><span style="color:green">0
</span><span style="color:black">seg000:02D4                 </span><span style="color:navy">call    </span>read_disk_sector_0
<span style="color:black">seg000:02D7                 </span><span style="color:navy">jnb     short </span><span style="color:gray">read_sector_0_ok
</span><span style="color:black">seg000:02D9                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:02DA </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">seg000:02DA
seg000:02DA </span><span style="color:gray">read_sector_0_ok</span><span style="color:navy">:                       </span><span style="color:green">; CODE XREF: cdrom_fd_boot+5j
</span><span style="color:black">seg000:02DA                 </span><span style="color:navy">sub     ax, ax
</span><span style="color:black">seg000:02DC                 </span><span style="color:navy">mov     ds, ax
</span><span style="color:black">seg000:02DE                 </span><span style="color:navy">mov     es, ax
</span><span style="color:black">seg000:02E0                 </span><span style="color:navy">mov     si, </span><span style="color:green">7C8Fh       </span>; put 4 NOPs at BS offset 008Fh
<span style="color:black">seg000:02E0                                         </span>; (&#039;IO      SYS&#039; name will be preserved by overwriting
<span style="color:black">seg000:02E0                                         </span>;  &#039;inc byte ptr ds:IO_SYS&#039; code there) -otherwise, it would be
<span style="color:black">seg000:02E0                                         </span>;  converted to &#039;JO      SYS&#039; just as how we are here, in JO.SYS.)
<span style="color:black">seg000:02E3                 </span><span style="color:navy">mov     dword ptr [si], </span><span style="color:green">90909090h </span>; (overwrite JO.SYS loading code)
<span style="color:black">seg000:02EA                 </span><span style="color:navy">jmp     cs:</span>MBR
<span style="color:black">seg000:02EA </span>cdrom_fd_boot   endp
<span style="color:black">seg000:02EA
seg000:02EF
seg000:02EF </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:02EF
seg000:02EF
seg000:02EF </span>set_vmode       proc near               <span style="color:green">; CODE XREF: seg000:0239p
</span><span style="color:black">seg000:02EF                                         </span><span style="color:green">; seg000:0247p ...
</span><span style="color:black">seg000:02EF                 </span><span style="color:navy">mov     ax, </span><span style="color:green">3
</span><span style="color:black">seg000:02F2                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SET VIDEO MODE
<span style="color:black">seg000:02F2                                         </span>; AL = mode
<span style="color:black">seg000:02F4                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:02F4 </span>set_vmode       endp
<span style="color:black">seg000:02F4
seg000:02F5
seg000:02F5 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:02F5
seg000:02F5
seg000:02F5 </span>display_row     proc near               <span style="color:green">; CODE XREF: seg000:0260p
</span><span style="color:black">seg000:02F5                                         </span><span style="color:green">; seg000:0268p ...
</span><span style="color:black">seg000:02F5                 </span><span style="color:navy">movzx   di, al
</span><span style="color:black">seg000:02F8                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3
</span><span style="color:black">seg000:02FA                 </span><span style="color:navy">mov     bh, </span><span style="color:green">0
</span><span style="color:black">seg000:02FC                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - READ CURSOR POSITION
<span style="color:black">seg000:02FC                                         </span>; BH = page number
<span style="color:black">seg000:02FC                                         </span>; Return: DH,DL = row,column, CH = cursor start line, CL = cursor end line
<span style="color:black">seg000:02FE                 </span><span style="color:navy">push    dx              </span>; save cursor position
<span style="color:black">seg000:02FF                 </span><span style="color:navy">push    word ptr [si+</span><span style="color:green">2</span><span style="color:navy">]
</span><span style="color:black">seg000:0302                 </span><span style="color:navy">mov     cx, </span><span style="color:green">40          </span>; 40 colums
<span style="color:black">seg000:0305
seg000:0305 </span><span style="color:gray">display_next_col</span><span style="color:navy">:                       </span><span style="color:green">; CODE XREF: display_row+2Fj
</span><span style="color:black">seg000:0305                 </span><span style="color:navy">push    cx
</span><span style="color:black">seg000:0306                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2
</span><span style="color:black">seg000:0308                 </span><span style="color:navy">mov     bh, </span><span style="color:green">0
</span><span style="color:black">seg000:030A                 </span><span style="color:navy">mov     dx, [si+</span><span style="color:green">2</span><span style="color:navy">]
</span><span style="color:black">seg000:030D                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">seg000:030D                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">seg000:030D                                         </span>; BH = page number
<span style="color:black">seg000:030F                 </span><span style="color:navy">mov     ah, </span><span style="color:green">8
</span><span style="color:black">seg000:0311                 </span><span style="color:navy">mov     bh, </span><span style="color:green">0
</span><span style="color:black">seg000:0313                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - READ ATTRIBUTES/CHARACTER AT CURSOR POSITION
<span style="color:black">seg000:0313                                         </span>; BH = display page
<span style="color:black">seg000:0313                                         </span>; Return: AL = character
<span style="color:black">seg000:0313                                         </span>; AH = attribute of character (alpha modes)
<span style="color:black">seg000:0315                 </span><span style="color:navy">mov     ah, </span><span style="color:green">9
</span><span style="color:black">seg000:0317                 </span><span style="color:navy">mov     bx, di
</span><span style="color:black">seg000:0319                 </span><span style="color:navy">mov     bh, </span><span style="color:green">0
</span><span style="color:black">seg000:031B                 </span><span style="color:navy">mov     cx, </span><span style="color:green">1
</span><span style="color:black">seg000:031E                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - WRITE ATTRIBUTES/CHARACTERS AT CURSOR POSITION
<span style="color:black">seg000:031E                                         </span>; AL = character, BH = display page
<span style="color:black">seg000:031E                                         </span>; BL = attributes of character (alpha modes) or color (graphics modes)
<span style="color:black">seg000:031E                                         </span>; CX = number of times to write character
<span style="color:black">seg000:0320                 </span><span style="color:navy">inc     word ptr [si+</span><span style="color:green">2</span><span style="color:navy">] </span>; next column
<span style="color:black">seg000:0323                 </span><span style="color:navy">pop     cx
</span><span style="color:black">seg000:0324                 </span><span style="color:navy">loop    </span><span style="color:gray">display_next_col
</span><span style="color:black">seg000:0326                 </span><span style="color:navy">pop     word ptr [si+</span><span style="color:green">2</span><span style="color:navy">]
</span><span style="color:black">seg000:0329                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2
</span><span style="color:black">seg000:032B                 </span><span style="color:navy">mov     bh, </span><span style="color:green">0
</span><span style="color:black">seg000:032D                 </span><span style="color:navy">pop     dx              </span>; restore cursor position
<span style="color:black">seg000:032E                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">seg000:032E                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">seg000:032E                                         </span>; BH = page number
<span style="color:black">seg000:0330                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:0330 </span>display_row     endp
<span style="color:black">seg000:0330
seg000:0331
seg000:0331 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:0331
seg000:0331
seg000:0331 </span>erase_timer_text proc near              <span style="color:green">; CODE XREF: wait_for_keypress+15p
</span><span style="color:black">seg000:0331                 </span><span style="color:navy">mov     ah, </span><span style="color:green">3
</span><span style="color:black">seg000:0333                 </span><span style="color:navy">mov     bh, </span><span style="color:green">0
</span><span style="color:black">seg000:0335                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - READ CURSOR POSITION
<span style="color:black">seg000:0335                                         </span>; BH = page number
<span style="color:black">seg000:0335                                         </span>; Return: DH,DL = row,column, CH = cursor start line, CL = cursor end line
<span style="color:black">seg000:0337                 </span><span style="color:navy">push    dx
</span><span style="color:black">seg000:0338                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2
</span><span style="color:black">seg000:033A                 </span><span style="color:navy">mov     bh, </span><span style="color:green">0
</span><span style="color:black">seg000:033C                 </span><span style="color:navy">mov     dx, [si+</span><span style="color:green">2</span><span style="color:navy">]
</span><span style="color:black">seg000:033F                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">seg000:033F                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">seg000:033F                                         </span>; BH = page number
<span style="color:black">seg000:0341                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0Ah
</span><span style="color:black">seg000:0343                 </span><span style="color:navy">mov     al, </span><span style="color:#ff8000">20h </span><span style="color:gray">; &#039; &#039;   </span>; blank / space (erase char)
<span style="color:black">seg000:0345                 </span><span style="color:navy">mov     bx, </span><span style="color:green">7
</span><span style="color:black">seg000:0348                 </span><span style="color:navy">mov     cx, [si+</span><span style="color:green">5</span><span style="color:navy">]
</span><span style="color:black">seg000:034B                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - WRITE CHARACTERS ONLY AT CURSOR POSITION
<span style="color:black">seg000:034B                                         </span>; AL = character, BH = display page - alpha mode
<span style="color:black">seg000:034B                                         </span>; BL = color of character (graphics mode, PCjr only)
<span style="color:black">seg000:034B                                         </span>; CX = number of times to write character
<span style="color:black">seg000:034D                 </span><span style="color:navy">mov     ah, </span><span style="color:green">2
</span><span style="color:black">seg000:034F                 </span><span style="color:navy">mov     bh, </span><span style="color:green">0
</span><span style="color:black">seg000:0351                 </span><span style="color:navy">pop     dx
</span><span style="color:black">seg000:0352                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - SET CURSOR POSITION
<span style="color:black">seg000:0352                                         </span>; DH,DL = row, column (0,0 = upper left)
<span style="color:black">seg000:0352                                         </span>; BH = page number
<span style="color:black">seg000:0354                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:0354 </span>erase_timer_text endp
<span style="color:black">seg000:0354
seg000:0355
seg000:0355 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:0355
seg000:0355
seg000:0355 </span>display_menu    proc near               <span style="color:green">; CODE XREF: display_menu+19j
</span><span style="color:black">seg000:0355                                         </span><span style="color:green">; wait_for_keypress+70p ...
</span><span style="color:black">seg000:0355                 </span><span style="color:navy">or      si, si
</span><span style="color:black">seg000:0357                 </span><span style="color:navy">jz      short </span><span style="color:gray">dm_ok
</span><span style="color:black">seg000:0359                 </span><span style="color:navy">mov     ah, </span><span style="color:green">13h
</span><span style="color:black">seg000:035B                 </span><span style="color:navy">mov     al, [si+</span><span style="color:green">4</span><span style="color:navy">]
</span><span style="color:black">seg000:035E                 </span><span style="color:navy">mov     bx, </span><span style="color:green">7
</span><span style="color:black">seg000:0361                 </span><span style="color:navy">mov     cx, [si+</span><span style="color:green">5</span><span style="color:navy">]      </span>; string length (char count)
<span style="color:black">seg000:0364                 </span><span style="color:navy">mov     dx, [si+</span><span style="color:green">2</span><span style="color:navy">]      </span>; cursor pos
<span style="color:black">seg000:0367                 </span><span style="color:navy">lea     bp, [si+</span><span style="color:green">7</span><span style="color:navy">]      </span>; start_of_string
<span style="color:black">seg000:036A                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - WRITE STRING (AT,XT286,PS,EGA,VGA)
<span style="color:black">seg000:036A                                         </span>; AL = mode, BL = attribute if AL bit 1 clear, BH = display page number
<span style="color:black">seg000:036A                                         </span>; DH,DL = row,column of starting cursor position, CX = length of string
<span style="color:black">seg000:036A                                         </span>; ES:BP -&gt; start of string
<span style="color:black">seg000:036C                 </span><span style="color:navy">mov     si, [si]
</span><span style="color:black">seg000:036E                 </span><span style="color:navy">jmp     short </span>display_menu
<span style="color:black">seg000:0370 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">seg000:0370
seg000:0370 </span><span style="color:gray">dm_ok</span><span style="color:navy">:                                  </span><span style="color:green">; CODE XREF: display_menu+2j
</span><span style="color:black">seg000:0370                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:0370 </span>display_menu    endp
<span style="color:black">seg000:0370
seg000:0371
seg000:0371 </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:0371
seg000:0371
seg000:0371 </span>wait_for_keypress proc near             <span style="color:green">; CODE XREF: seg000:021Cp
</span><span style="color:black">seg000:0371                 </span><span style="color:navy">test    cs:</span>timer_over<span style="color:navy">, </span><span style="color:green">3
</span><span style="color:black">seg000:0377                 </span><span style="color:navy">jz      short </span><span style="color:gray">read_timer_1
</span><span style="color:black">seg000:0379                 </span><span style="color:navy">test    cs:</span>timer_over<span style="color:navy">, </span><span style="color:green">2
</span><span style="color:black">seg000:037F                 </span><span style="color:navy">jnz     </span><span style="color:gray">read_timer_3
</span><span style="color:black">seg000:0383                 </span><span style="color:navy">mov     si, offset </span>timer_text
<span style="color:black">seg000:0386                 </span><span style="color:navy">call    </span>erase_timer_text
<span style="color:black">seg000:0389                 </span><span style="color:navy">or      cs:</span>timer_over<span style="color:navy">, </span><span style="color:green">2
</span><span style="color:black">seg000:038F                 </span><span style="color:navy">jmp     short </span><span style="color:gray">read_timer_3
</span><span style="color:black">seg000:0391 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">seg000:0391
seg000:0391 </span><span style="color:gray">read_timer_1</span><span style="color:navy">:                           </span><span style="color:green">; CODE XREF: wait_for_keypress+6j
</span><span style="color:black">seg000:0391                 </span><span style="color:navy">cmp     dword ptr cs:</span>timer_ticks<span style="color:navy">, </span><span style="color:green">0
</span><span style="color:black">seg000:0398                 </span><span style="color:navy">jnz     short </span><span style="color:gray">read_timer_2
</span><span style="color:black">seg000:039A                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0
</span><span style="color:black">seg000:039C                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - GET TIME OF DAY
<span style="color:black">seg000:039C                                         </span>; Return: CX:DX = clock count
<span style="color:black">seg000:039C                                         </span>; AL = 00h if clock was read or written (via AH=0,1) since the previous
<span style="color:black">seg000:039C                                         </span>; midnight
<span style="color:black">seg000:039C                                         </span>; Otherwise, AL &gt; 0
<span style="color:black">seg000:039E                 </span><span style="color:navy">mov     cs:</span>timer_ticks<span style="color:navy">, dx
</span><span style="color:black">seg000:03A3                 </span><span style="color:navy">mov     cs:</span>timer_ticks<span style="color:navy">+</span><span style="color:green">2</span><span style="color:navy">, cx
</span><span style="color:black">seg000:03A8
seg000:03A8 </span><span style="color:gray">read_timer_2</span><span style="color:navy">:                           </span><span style="color:green">; CODE XREF: wait_for_keypress+27j
</span><span style="color:black">seg000:03A8                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0
</span><span style="color:black">seg000:03AA                 </span><span style="color:navy">int     </span><span style="color:green">1Ah             </span>; CLOCK - GET TIME OF DAY
<span style="color:black">seg000:03AA                                         </span>; Return: CX:DX = clock count
<span style="color:black">seg000:03AA                                         </span>; AL = 00h if clock was read or written (via AH=0,1) since the previous
<span style="color:black">seg000:03AA                                         </span>; midnight
<span style="color:black">seg000:03AA                                         </span>; Otherwise, AL &gt; 0
<span style="color:black">seg000:03AC                 </span><span style="color:navy">mov     ax, cx
</span><span style="color:black">seg000:03AE                 </span><span style="color:navy">shl     eax, </span><span style="color:green">16         </span>; high word
<span style="color:black">seg000:03B2                 </span><span style="color:navy">mov     ax, dx
</span><span style="color:black">seg000:03B4                 </span><span style="color:navy">sub     eax, dword ptr cs:</span>timer_ticks
<span style="color:black">seg000:03BA                 </span><span style="color:navy">idiv    cs:</span>timer_divisor ; result = seconds
<span style="color:black">seg000:03BF                 </span><span style="color:navy">sub     al, </span><span style="color:green">10          </span>; al &lt;= 10
<span style="color:black">seg000:03C1                 </span><span style="color:navy">neg     al              </span>; -9 -&gt; 9, -8 -&gt; 8
<span style="color:black">seg000:03C3                 </span><span style="color:navy">or      al, al          </span>; 0 ?
<span style="color:black">seg000:03C5                 </span><span style="color:navy">jz      short </span><span style="color:gray">time_over
</span><span style="color:black">seg000:03C7                 </span><span style="color:navy">movzx   ax, al
</span><span style="color:black">seg000:03CA                 </span><span style="color:navy">div     cs:</span>divisor_10
<span style="color:black">seg000:03CF                 </span><span style="color:navy">or      ax, </span><span style="color:green">3030h
</span><span style="color:black">seg000:03D2                 </span><span style="color:navy">mov     si, offset </span>timer_text
<span style="color:black">seg000:03D5                 </span><span style="color:navy">lea     di, [si+</span><span style="color:green">5</span><span style="color:navy">]      </span>; ofset &quot;Time remaining: __&quot; - 2
<span style="color:black">seg000:03D8                 </span><span style="color:navy">add     di, [si+</span><span style="color:green">5</span><span style="color:navy">]      </span>; the end of &quot;Time remaining: &quot;
<span style="color:black">seg000:03DB                 </span><span style="color:navy">cmp     ax, [di]        </span>; same digits (numeric) ?
<span style="color:black">seg000:03DD                 </span><span style="color:navy">mov     [di], ax
</span><span style="color:black">seg000:03DF                 </span><span style="color:navy">jz      short </span><span style="color:gray">read_timer_3 </span>; yes, don&#039;t display &#039;remain seconds&#039; this time
<span style="color:black">seg000:03E1                 </span><span style="color:navy">call    </span>display_menu    ; no, display new numeric chars (and menu again) as countdown
<span style="color:black">seg000:03E4                 </span><span style="color:navy">mov     ah, </span><span style="color:green">13h         </span>; display timer text and countdown value (numeric chars)
<span style="color:black">seg000:03E6                 </span><span style="color:navy">mov     al, [si+</span><span style="color:green">4</span><span style="color:navy">]
</span><span style="color:black">seg000:03E9                 </span><span style="color:navy">mov     bx, </span><span style="color:green">7
</span><span style="color:black">seg000:03EC                 </span><span style="color:navy">mov     cx, [si+</span><span style="color:green">5</span><span style="color:navy">]
</span><span style="color:black">seg000:03EF                 </span><span style="color:navy">mov     dx, [si+</span><span style="color:green">2</span><span style="color:navy">]
</span><span style="color:black">seg000:03F2                 </span><span style="color:navy">lea     bp, [si+</span><span style="color:green">7</span><span style="color:navy">]
</span><span style="color:black">seg000:03F5                 </span><span style="color:navy">int     </span><span style="color:green">10h             </span>; - VIDEO - WRITE STRING (AT,XT286,PS,EGA,VGA)
<span style="color:black">seg000:03F5                                         </span>; AL = mode, BL = attribute if AL bit 1 clear, BH = display page number
<span style="color:black">seg000:03F5                                         </span>; DH,DL = row,column of starting cursor position, CX = length of string
<span style="color:black">seg000:03F5                                         </span>; ES:BP -&gt; start of string
<span style="color:black">seg000:03F7
seg000:03F7 </span><span style="color:gray">read_timer_3</span><span style="color:navy">:                           </span><span style="color:green">; CODE XREF: wait_for_keypress+Ej
</span><span style="color:black">seg000:03F7                                         </span><span style="color:green">; wait_for_keypress+1Ej ...
</span><span style="color:black">seg000:03F7                 </span><span style="color:navy">clc
</span><span style="color:black">seg000:03F8                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:03F9 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">seg000:03F9
seg000:03F9 </span><span style="color:gray">time_over</span><span style="color:navy">:                              </span><span style="color:green">; CODE XREF: wait_for_keypress+54j
</span><span style="color:black">seg000:03F9                 </span><span style="color:navy">stc
</span><span style="color:black">seg000:03FA                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:03FA </span>wait_for_keypress endp
<span style="color:black">seg000:03FA
seg000:03FB
seg000:03FB </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:03FB
seg000:03FB
seg000:03FB </span>show_menu       proc near               <span style="color:green">; CODE XREF: seg000:0211p
</span><span style="color:black">seg000:03FB                 </span><span style="color:navy">call    </span>set_vmode       ; set video mode to 3 (80x25 text mode)
<span style="color:black">seg000:03FE                 </span><span style="color:navy">mov     si, offset </span>menu_header
<span style="color:black">seg000:0401                 </span><span style="color:navy">call    </span>display_menu
<span style="color:black">seg000:0404                 </span><span style="color:navy">mov     si, offset </span>menu_row_2
<span style="color:black">seg000:0407                 </span><span style="color:navy">mov     al, </span><span style="color:green">70h
</span><span style="color:black">seg000:0409                 </span><span style="color:navy">call    </span>display_row
<span style="color:black">seg000:040C                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:040C </span>show_menu       endp
<span style="color:black">seg000:040C
seg000:040D
seg000:040D </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:040D
seg000:040D
seg000:040D </span>flush_keyb_buf  proc near               <span style="color:green">; CODE XREF: seg000:0214p
</span><span style="color:black">seg000:040D                                         </span><span style="color:green">; flush_keyb_buf+Aj
</span><span style="color:black">seg000:040D                 </span><span style="color:navy">mov     ah, </span><span style="color:green">1
</span><span style="color:black">seg000:040F                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - CHECK BUFFER, DO NOT CLEAR
<span style="color:black">seg000:040F                                         </span>; Return: ZF clear if character in buffer
<span style="color:black">seg000:040F                                         </span>; AH = scan code, AL = character
<span style="color:black">seg000:040F                                         </span>; ZF set if no character in buffer
<span style="color:black">seg000:0411                 </span><span style="color:navy">jz      short </span><span style="color:gray">flush_kbb_ok
</span><span style="color:black">seg000:0413                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0
</span><span style="color:black">seg000:0415                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
<span style="color:black">seg000:0415                                         </span>; Return: AH = scan code, AL = character
<span style="color:black">seg000:0417                 </span><span style="color:navy">jmp     short </span>flush_keyb_buf
<span style="color:black">seg000:0419 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">seg000:0419
seg000:0419 </span><span style="color:gray">flush_kbb_ok</span><span style="color:navy">:                           </span><span style="color:green">; CODE XREF: flush_keyb_buf+4j
</span><span style="color:black">seg000:0419                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:0419 </span>flush_keyb_buf  endp
<span style="color:black">seg000:0419
seg000:041A
seg000:041A </span><span style="color:gray">; =============== S U B R O U T I N E =======================================
</span><span style="color:black">seg000:041A
seg000:041A
seg000:041A </span>get_char        proc near               <span style="color:green">; CODE XREF: seg000:m_getcp
</span><span style="color:black">seg000:041A                 </span><span style="color:navy">mov     ah, </span><span style="color:green">1
</span><span style="color:black">seg000:041C                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - CHECK BUFFER, DO NOT CLEAR
<span style="color:black">seg000:041C                                         </span>; Return: ZF clear if character in buffer
<span style="color:black">seg000:041C                                         </span>; AH = scan code, AL = character
<span style="color:black">seg000:041C                                         </span>; ZF set if no character in buffer
<span style="color:black">seg000:041E                 </span><span style="color:navy">jnz     short </span><span style="color:gray">getchar
</span><span style="color:black">seg000:0420                 </span><span style="color:navy">clc                     </span>; no key press
<span style="color:black">seg000:0421                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:0422 </span><span style="color:gray">; ---------------------------------------------------------------------------
</span><span style="color:black">seg000:0422
seg000:0422 </span><span style="color:gray">getchar</span><span style="color:navy">:                                </span><span style="color:green">; CODE XREF: get_char+4j
</span><span style="color:black">seg000:0422                 </span><span style="color:navy">mov     ah, </span><span style="color:green">0
</span><span style="color:black">seg000:0424                 </span><span style="color:navy">int     </span><span style="color:green">16h             </span>; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
<span style="color:black">seg000:0424                                         </span>; Return: AH = scan code, AL = character
<span style="color:black">seg000:0426                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">4800h       </span>; up (arrow) key
<span style="color:black">seg000:0429                 </span><span style="color:navy">jz      short </span><span style="color:gray">getc_ok
</span><span style="color:black">seg000:042B                 </span><span style="color:navy">cmp     ax, </span><span style="color:green">5000h       </span>; down (arrow) key
<span style="color:black">seg000:042E                 </span><span style="color:navy">jz      short </span><span style="color:gray">getc_ok
</span><span style="color:black">seg000:0430                 </span><span style="color:navy">sub     ah, ah          </span>; clear (zero) scan code
<span style="color:black">seg000:0432
seg000:0432 </span><span style="color:gray">getc_ok</span><span style="color:navy">:                                </span><span style="color:green">; CODE XREF: get_char+Fj
</span><span style="color:black">seg000:0432                                         </span><span style="color:green">; get_char+14j
</span><span style="color:black">seg000:0432                 </span><span style="color:navy">stc                     </span>; a key pressed
<span style="color:black">seg000:0433                 </span><span style="color:navy">retn
</span><span style="color:black">seg000:0433 </span>get_char        endp
<span style="color:black">seg000:0433
seg000:0433 </span><span style="color:gray">; ---------------------------------------------------------------------------
seg000:0434                 </span><span style="color:navy">db </span><span style="color:#008040">972 </span><span style="color:navy">dup(</span><span style="color:#008040">0</span><span style="color:navy">)
</span><span style="color:gray">seg000:0434 </span>seg000          ends
<span style="color:gray">seg000:0434
seg000:0434
seg000:0434                 </span>end
</span></body></html>
