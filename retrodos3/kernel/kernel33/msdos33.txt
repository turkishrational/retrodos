     1                                  ;
     2                                  ; ===========================================================================
     3                                  ; º	This file is generated by The Interactive Disassembler (IDA)	    º
     4                                  ; º	Copyright (c) 2010 by Hex-Rays SA, <support@hex-rays.com>	    º
     5                                  ; º			 Licensed to: Freeware version			    º
     6                                  ; ===========================================================================
     7                                  ;
     8                                  ; Input	MD5   :	EF2ADCA1CB3882118FD247DD4C672C81
     9                                  
    10                                  ; ---------------------------------------------------------------------------
    11                                  ; File Name   :	D:\Documents and Settings\Erdoðan Tan\Desktop\MSDOS33.BIN
    12                                  ; Format      :	Binary file
    13                                  ; Base Address:	0000h Range: 0000h - 75CFh Loaded length: 75CFh
    14                                  
    15                                  		;.8086
    16                                  		;.model flat
    17                                  
    18                                  ; --------------------------------------------------------------------------
    19                                  ; Disassembled IBMDOS.COM (PCDOS 3.3 kernel) source has been converted to
    20                                  ; NASM syntax by Erdogan Tan (09/09/2022)
    21                                  ; --------------------------------------------------------------------------
    22                                  ;
    23                                  ; retrodos 3 sysinit:
    24                                  ; c:\nasm> nasm sysini33.s -l sysini33.txt -o SYSINI33.BIN -Z error.txt
    25                                  ;
    26                                  ; original msdos kernel: (original source code instead of retro source code) 
    27                                  ; c:\nasm> nasm msdos33.asm -l msdos33.txt -o MSDOS33.BIN -Z error.txt
    28                                  ;
    29                                  ; retrodos3.s: (retrodos IO.SYS + SYSINI33.BIN + MSDOS33.BIN = RETRODOS.SYS)
    30                                  ; c:\nasm> nasm retrodos33.s -l retrodos33.txt -o MSDOS.SYS -Z error.txt
    31                                  ;
    32                                  ; Name of the RETRODOS.SYS (retrodos 'IO.SYS'+'MSDOS.SYS') is 'MSDOS.SYS'
    33                                  ;
    34                                  ; 'MSDOS.SYS' must be in root directory of bootable Retrodos 3 disk/diskette
    35                                  ; Retrodos 3 boot sector loads 'msdos.sys' and it runs as PCDOS (MSDOS) 3.3
    36                                  
    37                                  ; ===========================================================================
    38                                  
    39                                  ; 09/09/2022
    40                                  
    41                                  ARENA_SIZE	equ 3	; word
    42                                  PDB_CPM_CALL	equ 5	; 5 bytes
    43                                  PDB_EXIT	equ 10	; dword
    44                                  PDB_CALL_SYSTEM equ 50h	; 5 bytes
    45                                  ENTRYPOINT	equ 30h*4  ; INT30h vector
    46                                  
    47                                  ; ===========================================================================
    48                                  
    49                                  [BITS 16]
    50                                  [ORG 0]
    51                                  		; 15/09/2022
    52                                  		; 14/09/2022
    53                                  		; 13/09/2022
    54                                  		; 10/09/2022
    55                                  		; 09/09/2022
    56                                  		; 08/09/2022
    57                                  		; 07/09/2022 - Erdogan Tan (Istanbul) - Retro DOS v3.x (2022)
    58                                  START:
    59 00000000 E90E72                  		jmp	DOSINIT
    60                                  
    61                                  ; ---------------------------------------------------------------------------
    62                                  
    63                                  		; 07/09/2022
    64                                  
    65 00000003 0000                    		dw 0
    66 00000005 00                      		db 0
    67 00000006 42                      		db 42h	; B
    68 00000007 55                      		db 55h	; U
    69 00000008 47                      		db 47h	; G
    70 00000009 20                      		db 20h
    71 0000000A 0000                    		dw 0
    72 0000000C 0000                    		dw 0
    73 0000000E 0000                    MYNUM:		dw 0
    74 00000010 0000                    FCBLRU:		dw 0
    75 00000012 0000                    OpenLRU:	dw 0
    76 00000014 FFFF                    OEM_HANDLER:	dw -1
    77 00000016 FFFF                    		dw -1
    78 00000018 [4415]                  LeaveAddr:	dw LeaveDOS
    79 0000001A 0300                    RetryCount:	dw 3
    80 0000001C 0100                    RetryLoop:	dw 1
    81 0000001E FFFFFFFF                LastBuffer:	dd -1
    82 00000022 0000                    CONTPOS:	dw 0
    83 00000024 0000                    arena_head:	dw 0
    84                                  SYSINITVARS:
    85 00000026 00000000                DPBHEAD:	dd 0
    86 0000002A [98000000]              SFT_ADDR:	dd SFTABL
    87 0000002E 00000000                BCLOCK:		dd 0
    88 00000032 00000000                BCON:		dd 0
    89 00000036 8000                    MAXSEC:		dw 128
    90 00000038 00000000                BUFFHEAD:	dd 0
    91 0000003C 00000000                CDSAddr:	dd 0
    92 00000040 00000000                SFTFCB:		dd 0
    93 00000044 0000                    KEEPCOUNT:	dw 0
    94 00000046 00                      NUMIO:		db 0
    95 00000047 00                      CDSCOUNT:	db 0
    96 00000048 00000000                NULDEV:		dd 0
    97 0000004C 0480                    		dw 8004h
    98 0000004E [9915]                  		dw SNULDEV
    99 00000050 [9F15]                  		dw INULDEV
   100 00000052 4E554C2020202020        		db 'NUL     '
   101 0000005A 00                      SPLICES:	db 0
   102                                  
   103 0000005B 90                      		db 90h
   104                                  
   105 0000005C [28170000]              JShare:		dd BadCall
   106 00000060 [2C170000]              MFT_enter:	dd OKCall
   107 00000064 [2C170000]              MFTClose:	dd OKCall
   108 00000068 [28170000]              MFTclU:		dd BadCall
   109 0000006C [28170000]              MFTCloseP:	dd BadCall
   110 00000070 [28170000]              MFTCloN:	dd BadCall
   111 00000074 [28170000]              set_block:	dd BadCall
   112 00000078 [28170000]              clr_block:	dd BadCall
   113 0000007C [2C170000]              chk_block:	dd OKCall
   114 00000080 [28170000]              MFT_get:	dd BadCall
   115 00000084 [28170000]              ShSave:		dd BadCall
   116 00000088 [28170000]              ShChk:		dd BadCall
   117 0000008C [2C170000]              ShCol:		dd OKCall
   118 00000090 [28170000]              ShCloseFile:	dd BadCall
   119 00000094 [28170000]              ShSU:		dd BadCall
   120                                  
   121 00000098 FFFFFFFF                SFTABL:		dd -1
   122                                  SFTABL_SFT_SFCOUNT:
   123 0000009C 0500                    		dw 5
   124                                  SFTABL_SFT_SFTable:
   125 0000009E 0000                    		dw 0
   126 000000A0 0000                    		dw 0
   127 000000A2 0000                    		dw 0
   128 000000A4 0000                    		dw 0
   129 000000A6 0000                    		dw 0
   130 000000A8 0000                    		dw 0
   131 000000AA 0000                    		dw 0
   132 000000AC 00<rep 10h>             		times 16 db 0
   133 000000BC 0000                    		dw 0
   134 000000BE 00                      		db 0
   135 000000BF 00                      		db 0
   136 000000C0 00                      		db 0
   137 000000C1 0000                    		dw 0
   138 000000C3 0000                    		dw 0
   139 000000C5 00<rep E2h>             		times 226 db 0
   140 000001A7 00                      CARPOS:		db 0
   141 000001A8 00                      STARTPOS:	db 0
   142 000001A9 00                      INBUF:		db 0
   143 000001AA 00<rep 7Fh>             		times 127 db 0
   144 00000229 0000                    CONBUF:		dw 0
   145 0000022B 00                      		db 0
   146 0000022C 00<rep 80h>             		times 128 db 0
   147 000002AC 00                      PFLAG:		db 0
   148 000002AD 00                      VERFLG:		db 0
   149 000002AE 03                      CHARCO:		db 3
   150 000002AF 2F                      chSwitch:	db '/'
   151 000002B0 00                      AllocMethod:	db 0
   152 000002B1 00                      fShare:		db 0
   153 000002B2 01                      DIFFNAM:	db 1
   154 000002B3 20<rep 10h>             MYNAME:		times 16 db 20h
   155                                  
   156 000002C3 [351F]                  		dw EcritDisk
   157 000002C5 [3D1F]                  		dw LcritDisk
   158 000002C7 [451F]                  		dw EcritDevice
   159 000002C9 [4D1F]                  		dw LcritDevice
   160 000002CB 0000                    		dw 0
   161                                  
   162 000002CD 90                      		db 90h
   163                                  
   164 000002CE 00                      ERRORMODE:	db 0
   165 000002CF 00                      INDOS:		db 0
   166 000002D0 FF                      WPERR:		db 0FFh
   167 000002D1 00                      EXTERR_LOCUS:	db 0
   168 000002D2 0000                    EXTERR:		dw 0
   169 000002D4 00                      EXTERR_ACTION:	db 0
   170 000002D5 00                      EXTERR_CLASS:	db 0
   171 000002D6 0000                    EXTERRPT:	dw 0
   172 000002D8 0000                    		dw 0
   173 000002DA 8000                    DMAADD:		dw 80h
   174 000002DC 0000                    		dw 0
   175 000002DE 0000                    CurrentPDB:	dw 0
   176 000002E0 0000                    ConC_Spsave:	dw 0
   177 000002E2 0000                    exit_code:	dw 0
   178 000002E4 00                      CURDRV:		db 0
   179 000002E5 00                      CNTCFLAG:	db 0
   180 000002E6 00                      USER_IN_AX:	db 0
   181 000002E7 00                      		db 0
   182 000002E8 0000                    PROC_ID:	dw 0
   183 000002EA 0000                    USER_ID:	dw 0
   184 000002EC 0000                    FirstArena:	dw 0
   185 000002EE 0000                    BestArena:	dw 0
   186 000002F0 0000                    LastArena:	dw 0
   187 000002F2 0000                    ENDMEM:		dw 0
   188 000002F4 0000                    LASTENT:	dw 0
   189 000002F6 00                      FAILERR:	db 0
   190 000002F7 00                      ALLOWED:	db 0
   191 000002F8 00                      NoSetDir:	db 0
   192 000002F9 00                      DidCTRLC:	db 0
   193 000002FA 00                      SpaceFlag:	db 0
   194 000002FB 90                      		db 90h
   195 000002FC 00                      DAY:		db 0
   196 000002FD 00                      MONTH:		db 0
   197 000002FE 0000                    YEAR:		dw 0
   198 00000300 FFFF                    DAYCNT:		dw 0FFFFh
   199 00000302 00                      WEEKDAY:	db 0
   200 00000303 00                      CONSWAP:	db 0
   201 00000304 01                      IDLEINT:	db 1
   202 00000305 00                      fAborting:	db 0
   203                                  
   204 00000306 00                      DEVCALL:	db 0
   205                                  DEVCALL_REQUNIT:
   206 00000307 00                      		db 0
   207                                  DEVCALL_REQFUNC:
   208 00000308 00                      		db 0
   209                                  DEVCALL_REQSTAT:
   210 00000309 00<rep Ah>              		times 10 db 0
   211                                  
   212 00000313 00                      CALLMED:	db 0
   213 00000314 00                      CALLXAD:	db 0
   214 00000315 00                      CALLVIDM:	db 0
   215 00000316 0000                    		dw 0
   216 00000318 00000000                CALLSCNT:	dd 0
   217 0000031C 00000000                CALLVIDRW:	dd 0
   218 00000320 0000                    CALLDEVAD:	dw 0
   219 00000322 0000                    		dw 0
   220                                  
   221 00000324 00                      IOCALL		db 0
   222 00000325 00                      IOCALL_REQUNIT	db 0
   223 00000326 00                      IOCALL_REQFUNC	db 0
   224 00000327 00                      IOCALL_REQSTAT: db 0
   225 00000328 00<rep 9h>              		times 9 db 0
   226 00000331 00                      IOMED:		db 0
   227 00000332 00                      IOXAD:		db 0
   228                                  IOCTL_REQ_REG_SI:
   229 00000333 00                      		db 0
   230 00000334 00                      		db 0
   231                                  IOCTL_REQ_REG_DI:
   232 00000335 00                      		db 0
   233 00000336 00                      IOSCNT:		db 0
   234                                  IOCTL_REQ_GENERICIOCTL_PACKET:
   235 00000337 00                      		db 0
   236 00000338 00                      		db 0
   237 00000339 00                      		db 0
   238 0000033A 0E00                    DSKSTCALL:	dw 0Eh
   239 0000033C 05                      DSKSTCOM:	db 5
   240 0000033D 00<rep Ah>              DSKSTST:	times 10 db 0
   241 00000347 00                      DSKCHRET:	db 0
   242 00000348 5E                      DEVIOBUF_PTR:	db 5Eh
   243 00000349 03                      		db 3
   244 0000034A 0000                    		dw 0
   245 0000034C 01                      DSKSTCNT:	db 1
   246 0000034D 00                      		db 0
   247 0000034E 00                      		db 0
   248 0000034F 00                      		db 0
   249 00000350 00                      CreatePDB:	db 0
   250 00000351 00                      		db 0
   251 00000352 0000                    USERNUM:	dw 0
   252 00000354 00                      		db 0
   253 00000355 00                      OEMNUM:		db 0
   254 00000356 [980F]                  		dw USTABLE
   255                                  DATASEGMENT:
   256                                  INITBLOCK:	; 272 bytes
   257 00000358 0000                    TIMEBUF:	dw 0
   258 0000035A 0000                    		dw 0
   259 0000035C 0000                    		dw 0
   260 0000035E 0000                    DEVIOBUF:	dw 0
   261 00000360 00                      OPENBUF:	db 0
   262 00000361 00<rep 7Fh>             		times 127 db 0
   263 000003E0 0000                    RENBUF:		dw 0
   264 000003E2 00<rep 31h>             		times 49 db 0
   265                                  RENBUF_SF_ENTRY_sf_MFT:
   266 00000413 0000                    		dw 0
   267 00000415 00<rep 4Bh>             		times 75 db 0
   268 00000460 00<rep 8h>              SEARCHBUF:	times 8 db 0
   269                                  
   270 00000468 0000                    INITSP:		dw 0
   271 0000046A 0000                    INITSS:		dw 0
   272                                  
   273                                  ; ---------------------------------------------------------------------------
   274                                  
   275                                  		; 07/09/2022
   276                                  MOVDPB:
   277 0000046C 2E8E16[6A04]            		mov	ss, [cs:INITSS]
   278 00000471 2E8B26[6804]            		mov	sp, [cs:INITSP]
   279 00000476 F3A4                    		rep movsb
   280 00000478 FC                      		cld
   281 00000479 268916[DC02]            		mov	[es:DMAADD+2], dx
   282 0000047E 8B36[2600]              		mov	si, word [DPBHEAD]
   283 00000482 268C06[2800]            		mov	[es:DPBHEAD+2], es
   284 00000487 268C06[2C00]            		mov	[es:SFT_ADDR+2], es
   285 0000048C 8A0E[4600]              		mov	cl, [NUMIO]
   286 00000490 30ED                    		xor	ch, ch
   287                                  SETFINDPB:
   288 00000492 268C441A                		mov	word [es:si+1Ah], es
   289 00000496 26C64417FF              		mov	byte [es:si+17h], -1
   290 0000049B 83C620                  		add	si, 32
   291 0000049E E2F2                    		loop	SETFINDPB
   292 000004A0 83EE20                  		sub	si, 32
   293 000004A3 26C7441AFFFF            		mov	word [es:si+1Ah], -1
   294 000004A9 06                      		push	es
   295 000004AA BF1F72                  		mov	di, 721Fh ; SYSBUF+15
   296 000004AD D1DF                    		rcr	di, 1
   297 000004AF D1EF                    		shr	di, 1
   298 000004B1 D1EF                    		shr	di, 1
   299 000004B3 D1EF                    		shr	di, 1
   300 000004B5 8CC0                    		mov	ax, es
   301 000004B7 01F8                    		add	ax, di
   302 000004B9 8EC0                    		mov	es, ax
   303 000004BB 31FF                    		xor	di, di
   304 000004BD 8C06[3A00]              		mov	word [BUFFHEAD+2], es
   305 000004C1 893E[3800]              		mov	word [BUFFHEAD], di
   306 000004C5 26C74504FF00            		mov	word [es:di+4], 0FFh
   307 000004CB 26C705FFFF              		mov	word [es:di], -1
   308 000004D0 26C74502FFFF            		mov	word [es:di+2], -1
   309 000004D6 07                      		pop	es
   310 000004D7 06                      		push	es
   311 000004D8 42                      		inc	dx
   312 000004D9 8B36[F202]              		mov	si, [ENDMEM]
   313 000004DD E81318                  		call	_$DUP_PDB
   314 000004E0 07                      		pop	es
   315 000004E1 2EA1[DE02]              		mov	ax, [cs:CurrentPDB]
   316 000004E5 26A3[DE02]              		mov	[es:CurrentPDB], ax
   317 000004E9 26C606[5003]00          		mov	byte [es:CreatePDB], 0
   318 000004EF 48                      		dec	ax
   319 000004F0 26A3[2400]              		mov	[es:arena_head], ax
   320 000004F4 1E                      		push	ds
   321 000004F5 8ED8                    		mov	ds, ax
   322 000004F7 C606[0000]5A            		mov	byte [START], 5Ah
   323 000004FC C706[0100]0000          		mov	word [START+1], 0
   324 00000502 262B06[F202]            		sub	ax, [es:ENDMEM]
   325 00000507 F7D8                    		neg	ax
   326 00000509 48                      		dec	ax
   327 0000050A A30300                  		mov	[ARENA_SIZE], ax
   328 0000050D 1F                      		pop	ds
   329 0000050E BF[9E00]                		mov	di, SFTABL_SFT_SFTable
   330 00000511 B80300                  		mov	ax, 3
   331 00000514 AB                      		stosw
   332 00000515 BF[330F]                		mov	di, SysInitTable
   333 00000518 CB                      		retf
   334                                  
   335                                  ; ---------------------------------------------------------------------------
   336                                  
   337                                  ; 09/09/2022
   338                                  
   339                                  DEVFCB		equ DATASEGMENT+398
   340                                  NAME1		equ DEVFCB  ; DATASEGMENT+398
   341                                  NAME2		equ NAME1+12
   342                                  DEVFCB_dir_time equ NAME2+10
   343                                  ATTRIB		equ DEVFCB+32 
   344                                  ExtFCB		equ ATTRIB+1
   345                                  SATTRIB		equ ExtFCB+1	
   346                                  Open_Access	equ SATTRIB+1
   347                                  FOUNDDEL	equ Open_Access+1
   348                                  FOUND_DEV	equ FOUNDDEL+1	
   349                                  fSplice		equ FOUND_DEV+1
   350                                  fSharing	equ fSplice+1
   351                                  SECCLUSPOS	equ fSharing+1
   352                                  TRANS		EQU SECCLUSPOS+1 ; DATASEGMENT+439
   353                                  READOP		EQU TRANS+1
   354                                  THISDRV		equ READOP+1
   355                                  INSMODE		equ THISDRV+3
   356                                  cMeta		equ INSMODE+1
   357                                  CREATING	equ cMeta+3	
   358                                   
   359                                  ; ---------------------------------------------------------------------------
   360                                  
   361                                  		; 07/09/2022
   362                                  
   363 00000519 00                      DELALL:		db 0 ; DELALL equ CREATING+1 ; 09/09/2022
   364 0000051A 00000000                EXITHOLD:	dd 0
   365 0000051E 0000                    User_SP:	dw 0
   366 00000520 0000                    User_SS:	dw 0
   367 00000522 0000                    CONTSTK:	dw 0
   368 00000524 00000000                THISDPB:	dd 0
   369 00000528 0000                    CLUSSAVE:	dw 0
   370 0000052A 0000                    CLUSSEC:	dw 0
   371 0000052C 0000                    PREREAD:	dw 0
   372 0000052E 0000                    FATBYT:		dw 0
   373 00000530 0000                    FATBYTE:	dw 0
   374 00000532 00000000                DEVPT:		dd 0
   375 00000536 00000000                THISSFT:	dd 0
   376 0000053A 00000000                THISCDS:	dd 0
   377 0000053E 00000000                THISFCB:	dd 0
   378 00000542 FFFF                    SFN:		dw -1
   379 00000544 0000                    JFN:		dw 0
   380 00000546 00000000                PJFN:		dd 0
   381 0000054A 0000                    WFP_START:	dw 0
   382 0000054C 0000                    REN_WFP:	dw 0
   383 0000054E 0000                    CURR_DIR_END:	dw 0
   384 00000550 0000                    NEXTADD:	dw 0
   385 00000552 0000                    LASTPOS:	dw 0
   386 00000554 0000                    CLUSNUM:	dw 0
   387 00000556 0000                    DIRSEC:		dw 0
   388 00000558 0000                    DIRSTART:	dw 0
   389 0000055A 0000                    SECPOS:		dw 0
   390 0000055C 0000                    VALSEC:		dw 0
   391 0000055E 0000                    BYTSECPOS:	dw 0
   392 00000560 00000000                BYTPOS:		dd 0
   393 00000564 0000                    BYTCNT1:	dw 0
   394 00000566 0000                    BYTCNT2:	dw 0
   395 00000568 0000                    SECCNT:		dw 0
   396 0000056A 0000                    ENTFREE:	dw 0
   397 0000056C 0000                    ENTLAST:	dw 0
   398 0000056E 0000                    NXTCLUSNUM:	dw 0
   399 00000570 00000000                GROWCNT:	dd 0
   400 00000574 00000000                CURBUF:		dd 0
   401 00000578 00000000                CONSFT:		dd 0
   402 0000057C 0000                    SaveBX:		dw 0
   403 0000057E 0000                    SaveDS:		dw 0
   404 00000580 0000                    restore_tmp:	dw 0
   405 00000582 0000                    NSS:		dw 0
   406 00000584 0000                    NSP:		dw 0
   407 00000586 00                      RENAMEDMA:	db 0
   408 00000587 00<rep Ch>              RENAMEDMA_1:	times 12 db 0
   409 00000593 0000                    RENAMEDMA_13:	dw 0
   410 00000595 0000                    RENAMEDMA_15:	dw 0
   411 00000597 00000000                		dd 0
   412 0000059B 00<rep Bh>              RENAMEDMA_21:	times 11 db 0
   413                                  RENAMEDMA_21_dir_attr:
   414 000005A6 00                      		db 0
   415 000005A7 00<rep 12Ah>            		times 298 db 0
   416                                  AUX_STACK_SF_ENTRY_size:
   417 000006D1 0000                    		dw 0
   418 000006D3 00<rep 33h>             		times 51 db 0
   419 00000706 0000                    AUXSTACK:	dw 0
   420 00000708 00<rep 17Eh>            		times 382 db 0
   421 00000886 0000                    DSKSTACK:	dw 0
   422 00000888 00<rep 90h>             		times 144 db 0
   423                                  		; 15/09/2022	
   424                                  ;ADJFAC:	dw 0
   425                                  		;times 236 db 0
   426 00000918 00<rep EEh>             		times 238 db 0
   427 00000A06 00                      IOSTACK:	db 0
   428 00000A07 00                      VOLCHNG_FLAG:	db 0
   429 00000A08 00                      VIRTUAL_OPEN:	db 0
   430 00000A09 0000                    SWAP_END:	dw 0
   431 00000A0B 00<rep 26Dh>            		times 621 db 0
   432                                  
   433 00000C78 03                      MSVERS:		db 3
   434 00000C79 1E                      		db 30
   435                                  		;db 31 ; 14/09/2022
   436                                  
   437 00000C7A C8                      YRTAB:		db 200
   438 00000C7B A6                      		db 166
   439 00000C7C C8                      		db 200
   440 00000C7D A5                      		db 165
   441 00000C7E C8                      		db 200
   442 00000C7F A5                      		db 165
   443 00000C80 C8                      		db 200
   444 00000C81 A5                      MONTAB_x1:	db 165
   445 00000C82 1F                      MONTAB:		db 31
   446 00000C83 1C                      february:	db 28
   447 00000C84 1F                      		db 31
   448 00000C85 1E                      		db 30
   449 00000C86 1F                      		db 31
   450 00000C87 1E                      		db 30
   451 00000C88 1F                      		db 31
   452 00000C89 1F                      		db 31
   453 00000C8A 1E                      		db 30
   454 00000C8B 1F                      		db 31
   455 00000C8C 1E                      		db 30
   456 00000C8D 1F                      		db 31
   457                                  
   458                                  I21_MAP_E_TAB:
   459 00000C8E 38020102                		db 38h,2,1,2
   460 00000C92 3903030205              		db 39h,3,3,2,5
   461 00000C97 3A0410030205            		db 3Ah,4,10h,3,2,5
   462 00000C9D 3B020203                		db 3Bh,2,2,3
   463 00000CA1 3C0403020405            		db 3Ch,4,3,2,4,5
   464 00000CA7 3D0503020C0405          		db 3Dh,5,3,2,0Ch,4,5
   465 00000CAE 3E0106                  		db 3Eh,1,6
   466 00000CB1 3F020605                		db 3Fh,2,6,5
   467 00000CB5 40020605                		db 40h,2,6,5
   468 00000CB9 4103030205              		db 41h,	3, 3, 2, 5
   469 00000CBE 42020601                		db 42h,2,6,1
   470 00000CC2 430403020105            		db 43h,	4, 3, 2, 1, 5
   471 00000CC8 44050F0D010605          		db 44h,5,0Fh,0Dh,1,6,5
   472 00000CCF 45020604                		db 45h,2,6,4
   473 00000CD3 46020604                		db 46h,2,6,4
   474 00000CD7 47010F                  		db 47h,1,0Fh
   475 00000CDA 48020708                		db 48h,2,7,8
   476 00000CDE 49020709                		db 49h,2,7,9
   477 00000CE2 4A03070908              		db 4Ah,3,7,9,8
   478 00000CE7 4B08030102040B0A08-     		db 4Bh,8,3,1,2,4,0Bh,0Ah,8,5
   478 00000CF0 05                 
   479 00000CF1 4E03030212              		db 4Eh,3,3,2,12h
   480 00000CF6 4F0112                  		db 4Fh,1,12h
   481 00000CF9 560411030205            		db 56h,4,11h,3,2,5
   482 00000CFF 57020601                		db 57h,2,6,1
   483 00000D03 580101                  		db 58h,1,1
   484 00000D06 5A0403020405            		db 5Ah,4,3,2,4,5
   485 00000D0C 5B055003020405          		db 5Bh,5,50h,3,2,4,5
   486 00000D13 5C0406012421            		db 5Ch,4,6,1,24h,21h
   487 00000D19 65020102                		db 65h,2,1,2
   488 00000D1D 66020102                		db 66h,2,1,2
   489 00000D21 680106                  		db 68h,1,6
   490 00000D24 6703040801              		db 67h,3,4,8,1
   491 00000D29 FF                      		db 0FFh
   492                                  ERR_TABLE_21:
   493 00000D2A 010704FF                		db 1,7,4,0FFh
   494 00000D2E 02080302                		db 2,8,3,2
   495 00000D32 03080302                		db 3,8,3,2
   496 00000D36 04010401                		db 4,1,4,1
   497 00000D3A 050303FF                		db 5,3,3,0FFh
   498 00000D3E 06070401                		db 6,7,4,1
   499 00000D42 07070505                		db 7,7,5,5
   500 00000D46 08010405                		db 8,1,4,5
   501 00000D4A 09070405                		db 9,7,4,5
   502 00000D4E 0A070405                		db 0Ah,7,4,5
   503 00000D52 0B090301                		db 0Bh,9,3,1
   504 00000D56 0C070401                		db 0Ch,7,4,1
   505 00000D5A 0D090401                		db 0Dh,9,4,1
   506 00000D5E 0F080302                		db 0Fh,8,3,2
   507 00000D62 10030302                		db 10h,3,3,2
   508 00000D66 110D0302                		db 11h,0Dh,3,2
   509 00000D6A 12080302                		db 12h,8,3,2
   510 00000D6E 500C0302                		db 50h,0Ch,3,2
   511 00000D72 200A0202                		db 20h,0Ah,2,2
   512 00000D76 210A0202                		db 21h,0Ah,2,2
   513 00000D7A 540104FF                		db 54h,1,4,0FFh
   514 00000D7E 56030301                		db 56h,3,3,1
   515 00000D82 52010402                		db 52h,1,4,2
   516 00000D86 32090303                		db 32h,9,3,3
   517 00000D8A 550C0303                		db 55h,0Ch,3,3
   518 00000D8E 57090301                		db 57h,9,3,1
   519 00000D92 530D0401                		db 53h,0Dh,4,1
   520 00000D96 24010405                		db 24h,1,4,5
   521 00000D9A FFFFFFFF                		db 0FFh,0FFh,0FFh,0FFh
   522                                  ERR_TABLE_24:
   523 00000D9E 130B0702                		db 13h,0Bh,7,2
   524 00000DA2 14040501                		db 14h,4,5,1
   525 00000DA6 150507FF                		db 15h,5,7,0FFh
   526 00000DAA 16040501                		db 16h,4,5,1
   527 00000DAE 170B0402                		db 17h,0Bh,4,2
   528 00000DB2 18040501                		db 18h,4,5,1
   529 00000DB6 19050102                		db 19h,5,1,2
   530 00000DBA 1A0B0702                		db 1Ah,0Bh,7,2
   531 00000DBE 1B0B0402                		db 1Bh,0Bh,4,2
   532 00000DC2 1C020704                		db 1Ch,2,7,4
   533 00000DC6 1D0504FF                		db 1Dh,5,4,0FFh
   534 00000DCA 1E0504FF                		db 1Eh,5,4,0FFh
   535 00000DCE 1F0D04FF                		db 1Fh,0Dh,4,0FFh
   536 00000DD2 200A0202                		db 20h,0Ah,2,2
   537 00000DD6 210A0202                		db 21h,0Ah,2,2
   538 00000DDA 220B0702                		db 22h,0Bh,7,2
   539 00000DDE 32090303                		db 32h,9,3,3
   540 00000DE2 23070401                		db 23h,7,4,1
   541 00000DE6 24010405                		db 24h,1,4,5
   542 00000DEA FF0D05FF                		db 0FFh,0Dh,5,0FFh
   543                                  ErrMap24:
   544 00000DEE 13                      		db 13h
   545 00000DEF 14                      		db 14h
   546 00000DF0 15                      		db 15h
   547 00000DF1 16                      		db 16h
   548 00000DF2 17                      		db 17h
   549 00000DF3 18                      		db 18h
   550 00000DF4 19                      		db 19h
   551 00000DF5 1A                      		db 1Ah
   552 00000DF6 1B                      		db 1Bh
   553 00000DF7 1C                      		db 1Ch
   554 00000DF8 1D                      		db 1Dh
   555 00000DF9 1E                      		db 1Eh
   556 00000DFA 1F                      		db 1Fh
   557 00000DFB 1F                      		db 1Fh
   558 00000DFC 1F                      		db 1Fh
   559 00000DFD 22                      		db 22h
   560                                  
   561 00000DFE 24                      MAXCALL:	db 36
   562 00000DFF 68                      MAXCOM:		db 104
   563                                  DISPATCH:	
   564 00000E00 [9863]                  		dw _$ABORT
   565 00000E02 [7922]                  		dw _$STD_CON_INPUT
   566 00000E04 [8222]                  		dw _$STD_CON_OUTPUT
   567 00000E06 [3C23]                  		dw _$STD_AUX_INPUT
   568 00000E08 [5923]                  		dw _$STD_AUX_OUTPUT
   569 00000E0A [5F23]                  		dw _$STD_PRINTER_OUTPUT
   570 00000E0C [C421]                  		dw _$RAW_CON_IO
   571 00000E0E [F021]                  		dw _$RAW_CON_INPUT
   572 00000E10 [551F]                  		dw _$STD_CON_INPUT_NO_ECHO
   573 00000E12 [BB1F]                  		dw _$STD_CON_STRING_OUTPUT
   574 00000E14 [C71F]                  		dw _$STD_CON_STRING_INPUT
   575 00000E16 [7323]                  		dw _$STD_CON_INPUT_STATUS
   576 00000E18 [7D23]                  		dw _$STD_CON_INPUT_FLUSH
   577 00000E1A [501C]                  		dw _$DISK_RESET
   578 00000E1C [4C1B]                  		dw _$SET_DEFAULT_DRIVE
   579 00000E1E [882A]                  		dw _$FCB_OPEN
   580 00000E20 [2524]                  		dw _$FCB_CLOSE
   581 00000E22 [872B]                  		dw _$DIR_SEARCH_FIRST
   582 00000E24 [1B2C]                  		dw _$DIR_SEARCH_NEXT
   583 00000E26 [C223]                  		dw _$FCB_DELETE
   584 00000E28 [732B]                  		dw _$FCB_SEQ_READ
   585 00000E2A [782B]                  		dw _$FCB_SEQ_WRITE
   586 00000E2C [592B]                  		dw _$FCB_CREATE
   587 00000E2E [9724]                  		dw _$FCB_RENAME
   588 00000E30 [8616]                  		dw NO_OP
   589 00000E32 [471B]                  		dw _$GET_DEFAULT_DRIVE
   590 00000E34 [3C1B]                  		dw _$SET_DMA
   591 00000E36 [D91B]                  		dw _$SLEAZEFUNC
   592 00000E38 [DB1B]                  		dw _$SLEAZEFUNCDL
   593 00000E3A [8616]                  		dw NO_OP
   594 00000E3C [8616]                  		dw NO_OP
   595 00000E3E [1F1C]                  		dw _$GET_DEFAULT_DPB
   596 00000E40 [8616]                  		dw NO_OP
   597 00000E42 [7D2B]                  		dw _$FCB_RANDOM_READ
   598 00000E44 [822B]                  		dw _$FCB_RANDOM_WRITE
   599 00000E46 [D623]                  		dw _$GET_FCB_FILE_LENGTH
   600 00000E48 [AA23]                  		dw _$GET_FCB_POSITION
   601 00000E4A [6E1B]                  		dw _$SET_INTERRUPT_VECTOR
   602 00000E4C [011D]                  		dw _$CREATE_PROCESS_DATA_BLOCK
   603 00000E4E [6E2B]                  		dw _$FCB_RANDOM_READ_BLOCK
   604 00000E50 [692B]                  		dw _$FCB_RANDOM_WRITE_BLOCK
   605 00000E52 [CE1B]                  		dw _$PARSE_FILE_DESCRIPTOR
   606 00000E54 [9117]                  		dw _$GET_DATE
   607 00000E56 [AE17]                  		dw _$SET_DATE
   608 00000E58 [CE17]                  		dw _$GET_TIME
   609 00000E5A [DF17]                  		dw _$SET_TIME
   610 00000E5C [8A19]                  		dw _$SET_VERIFY_ON_WRITE
   611 00000E5E [281B]                  		dw _$GET_DMA
   612 00000E60 [6C19]                  		dw _$GET_VERSION
   613 00000E62 [3C63]                  		dw _$KEEP_PROCESS
   614 00000E64 [211C]                  		dw _$GET_DPB
   615 00000E66 [1314]                  		dw _$SET_CTRL_C_TRAPPING
   616 00000E68 [071C]                  		dw _$GET_INDOS_FLAG
   617 00000E6A [5E1B]                  		dw _$GET_INTERRUPT_VECTOR
   618 00000E6C [FD1A]                  		dw _$GET_DRIVE_FREESPACE
   619 00000E6E [861B]                  		dw _$CHAR_OPER
   620 00000E70 [9119]                  		dw _$INTERNATIONAL
   621 00000E72 [6D2E]                  		dw _$MKDIR
   622 00000E74 [B52D]                  		dw _$RMDIR
   623 00000E76 [F12D]                  		dw _$CHDIR
   624 00000E78 [BE6F]                  		dw _$CREAT
   625 00000E7A [FF6E]                  		dw _$OPEN
   626 00000E7C [996C]                  		dw _$CLOSE
   627 00000E7E [AB6D]                  		dw _$READ
   628 00000E80 [FF6D]                  		dw _$WRITE
   629 00000E82 [1070]                  		dw _$UNLINK
   630 00000E84 [046E]                  		dw _$LSEEK
   631 00000E86 [CB6F]                  		dw _$CHMOD
   632 00000E88 [912E]                  		dw _$IOCTL
   633 00000E8A [BB6E]                  		dw _$DUP
   634 00000E8C [DB6E]                  		dw _$DUP2
   635 00000E8E [4D2D]                  		dw _$CURRENT_DIR
   636 00000E90 [1E64]                  		dw _$ALLOC
   637 00000E92 [3B65]                  		dw _$DEALLOC
   638 00000E94 [1765]                  		dw _$SETBLOCK
   639 00000E96 [FA5E]                  		dw _$EXEC
   640 00000E98 [7463]                  		dw _$EXIT
   641 00000E9A [F05E]                  		dw _$WAIT
   642 00000E9C [8E2C]                  		dw _$FIND_FIRST
   643 00000E9E [E62C]                  		dw _$FIND_NEXT
   644 00000EA0 [0714]                  		dw _$SET_CURRENT_PDB
   645 00000EA2 [0D14]                  		dw _$GET_CURRENT_PDB
   646 00000EA4 [131C]                  		dw _$GET_IN_VARS
   647 00000EA6 [8A1C]                  		dw _$SETDPB
   648 00000EA8 [8519]                  		dw _$GET_VERIFY_ON_WRITE
   649 00000EAA [F31C]                  		dw _$DUP_PDB
   650 00000EAC [3670]                  		dw _$RENAME
   651 00000EAE [6C6E]                  		dw _$FILE_TIMES
   652 00000EB0 [5B65]                  		dw _$ALLOCOPER
   653 00000EB2 [AB1B]                  		dw _$GetExtendedError
   654 00000EB4 [9970]                  		dw _$CreateTempFile
   655 00000EB6 [7970]                  		dw _$CreateNewFile
   656 00000EB8 [1E71]                  		dw _$LockOper
   657 00000EBA [7A65]                  		dw _$ServerCall
   658 00000EBC [E267]                  		dw _$UserOper
   659 00000EBE [6B67]                  		dw _$AssignOper
   660 00000EC0 [396C]                  		dw _$NameTrans
   661 00000EC2 [8616]                  		dw NO_OP
   662 00000EC4 [0D14]                  		dw _$GET_CURRENT_PDB
   663 00000EC6 [8616]                  		dw NO_OP
   664 00000EC8 [3A14]                  		dw _$SET_PRINTER_FLAG
   665 00000ECA [181A]                  		dw _$GetExtCntry
   666 00000ECC [A81A]                  		dw _$GetSetCdPg
   667 00000ECE [E66C]                  		dw _$ExtHandle
   668 00000ED0 [CC6C]                  		dw _$COMMIT
   669 00000ED2 [3B17]                  FOO:		dw Leave2F
   670 00000ED4 [D60E]                  DTab:		dw DOSTable
   671                                  DOSTable:
   672 00000ED6 2E                      		db 46
   673 00000ED7 [6817]                  		dw DOSInstall
   674 00000ED9 [CF39]                  		dw DOS_CLOSE
   675 00000EDB [7B1B]                  		dw RECSET
   676 00000EDD [6517]                  		dw DOSGetGroup
   677 00000EDF [5055]                  		dw PATHCHRCMP
   678 00000EE1 [8422]                  		dw OUTT
   679 00000EE3 [BB57]                  		dw NET_I24_ENTRY
   680 00000EE5 [E75C]                  		dw PLACEBUF
   681 00000EE7 [893A]                  		dw FREESFT
   682 00000EE9 [935E]                  		dw BUFWRITE
   683 00000EEB [B971]                  		dw SHARE_VIOLATION
   684 00000EED [7937]                  		dw SHARE_ERROR
   685 00000EEF [6137]                  		dw SET_SFT_MODE
   686 00000EF1 [2618]                  		dw DATE16
   687 00000EF3 [AE5C]                  		dw SETVISIT
   688 00000EF5 [DB5C]                  		dw SCANPLACE
   689 00000EF7 [C75C]                  		dw SKIPVISIT
   690 00000EF9 [161E]                  		dw StrCpy
   691 00000EFB [321E]                  		dw StrLen
   692 00000EFD [2E1E]                  		dw Ucase
   693 00000EFF [835D]                  		dw POINTCOMP
   694 00000F01 [6C5E]                  		dw CHECKFLUSH
   695 00000F03 [E066]                  		dw SFFromSFN
   696 00000F05 [A268]                  		dw GetCDSFromDrv
   697 00000F07 [9315]                  		dw Get_User_Stack
   698 00000F09 [4F68]                  		dw GetThisDrv
   699 00000F0B [576C]                  		dw DriveFromText
   700 00000F0D [CD18]                  		dw SETYEAR
   701 00000F0F [6219]                  		dw DSUM
   702 00000F11 [C118]                  		dw DSLIDE
   703 00000F13 [F41D]                  		dw StrCmp
   704 00000F15 [9067]                  		dw InitCDS
   705 00000F17 [AD66]                  		dw pJFNFromHandle
   706 00000F19 [396C]                  		dw _$NameTrans
   707 00000F1B [B016]                  		dw CAL_LK
   708 00000F1D [FA49]                  		dw DEVNAME
   709 00000F1F [511E]                  		dw Idle
   710 00000F21 [401E]                  		dw DStrLen
   711 00000F23 [D41E]                  		dw NLS_OPEN
   712 00000F25 [996C]                  		dw _$CLOSE
   713 00000F27 [DA1E]                  		dw NLS_LSEEK
   714 00000F29 [AB6D]                  		dw _$READ
   715 00000F2B [B21E]                  		dw FastInit
   716 00000F2D [131F]                  		dw NLS_IOCTL
   717 00000F2F [061F]                  		dw GetDevList
   718 00000F31 [301F]                  		dw NLS_GETEXT
   719 00000F33 [26000000]              SysInitTable:	dd DPBHEAD
   720 00000F37 [B10F0000]              		dd COUNTRY_CDPG
   721 00000F3B 0400                    FastTable:	dw 4
   722 00000F3D [CF1E]                  		dw FastRet
   723 00000F3F 0000                    		dw 0
   724                                  FastOpen_Ext_Info:
   725 00000F41 00<rep 5h>              		times 5 db 0
   726 00000F46 00<rep 20h>             Dir_Info_Buff:	times 32 db 0
   727 00000F66 00                      FastOpenFlg:	db 0
   728                                  Next_Element_Start:
   729 00000F67 0000                    		dw 0
   730 00000F69 [6B0F]                  User_SP_2F:	dw FAKE_STACK_2F
   731 00000F6B 0000<rep Ch>            FAKE_STACK_2F:	times 12 dw 0
   732 00000F83 00                      SCAN_FLAG:	db 0
   733 00000F84 00                      DISK_FULL:	db 0
   734 00000F85 0000                    DATE_FLAG:	dw 0
   735 00000F87 0000                    FETCHI_TAG:	dw 0
   736                                  
   737 00000F89 02                      ERRIN:		db 2
   738 00000F8A 06                      		db 6
   739 00000F8B 0C                      		db 12
   740 00000F8C 04                      		db 4
   741 00000F8D 08                      		db 8
   742 00000F8E 00                      		db 0
   743 00000F8F 80                      ERROUT		db 80h
   744 00000F90 40                      		db 40h
   745 00000F91 02                      		db 2
   746 00000F92 10                      		db 10h
   747 00000F93 04                      		db 4
   748 00000F94 03                      		db 3
   749                                  
   750                                  international_table:
   751 00000F95 18                      		db 24
   752 00000F96 0100                    		dw 1
   753                                  USTABLE:
   754 00000F98 0000                    		dw 0
   755 00000F9A 24                      		db '$'
   756 00000F9B 00                      		db 0
   757 00000F9C 00                      		db 0
   758 00000F9D 00                      		db 0
   759 00000F9E 00                      		db 0
   760 00000F9F 2C                      		db ','
   761 00000FA0 00                      		db 0
   762 00000FA1 2E                      		db '.'
   763 00000FA2 00                      		db 0
   764 00000FA3 2D                      		db '-'
   765 00000FA4 00                      		db 0
   766 00000FA5 3A                      		db ':'
   767 00000FA6 00                      		db 0
   768 00000FA7 00                      		db 0
   769 00000FA8 02                      		db 2
   770 00000FA9 00                      		db 0
   771 00000FAA [6B17]                  		dw MAP_CASE
   772 00000FAC 0000                    		dw 0
   773 00000FAE 2C                      		db ','
   774 00000FAF 00                      		db 0
   775 00000FB0 FF                      		db -1
   776                                  COUNTRY_CDPG:
   777 00000FB1 00                      		db 0
   778 00000FB2 00                      		db 0
   779 00000FB3 00                      		db 0
   780 00000FB4 00                      		db 0
   781 00000FB5 00                      		db 0
   782 00000FB6 00                      		db 0
   783 00000FB7 00                      		db 0
   784 00000FB8 00                      		db 0
   785 00000FB9 5C434F554E5452592E-     		db '\COUNTRY.SYS',0
   785 00000FC2 53595300           
   786 00000FC6 00<rep 33h>             		times 51 db 0
   787 00000FF9 B501                    		dw 437
   788 00000FFB 0500                    		dw 5
   789                                  CDPG_ccSetUcase:
   790 00000FFD 02                      		db 2
   791 00000FFE [3A10]                  		dw UCASE_TAB
   792 00001000 0000                    		dw 0
   793 00001002 04                      		db 4
   794 00001003 [BC10]                  		dw FILE_UCASE_TAB
   795 00001005 0000                    		dw 0
   796 00001007 05                      		db 5
   797 00001008 [3E11]                  		dw FILE_CHAR_TAB
   798 0000100A 0000                    		dw 0
   799 0000100C 06                      		db 6
   800 0000100D [6E11]                  		dw COLLATE_TAB
   801 0000100F 0000                    		dw 0
   802 00001011 01                      		db 1
   803 00001012 2600                    		dw 38
   804 00001014 0100                    		dw 1
   805 00001016 B501                    		dw 437
   806                                  CDPG_ccDFormat:
   807 00001018 0000                    		dw 0
   808 0000101A 24                      		db '$'
   809 0000101B 00                      		db 0
   810 0000101C 00                      		db 0
   811 0000101D 00                      		db 0
   812 0000101E 00                      		db 0
   813 0000101F 2C                      		db ','
   814 00001020 00                      		db 0
   815 00001021 2E                      		db '.'
   816 00001022 00                      		db 0
   817 00001023 2D                      		db '-'
   818 00001024 00                      		db 0
   819 00001025 3A                      		db ':'
   820 00001026 00                      		db 0
   821 00001027 00                      		db 0
   822 00001028 02                      		db 2
   823 00001029 00                      		db 0
   824 0000102A [6B17]                  		dw MAP_CASE
   825 0000102C 0000                    		dw 0
   826 0000102E 2C                      		db ','
   827 0000102F 00                      		db 0
   828 00001030 0000                    		dw 0
   829 00001032 0000                    		dw 0
   830 00001034 0000                    		dw 0
   831 00001036 0000                    		dw 0
   832 00001038 0000                    		dw 0
   833                                  UCASE_TAB:
   834 0000103A 8000                    		dw 128
   835 0000103C 809A45418E418F80        		db 128,154,69,65,142,65,143,128
   836 00001044 4545454949498E8F        		db 69,69,69,73,73,73,142,143
   837 0000104C 9092924F994F5555        		db 144,146,146,79,153,79,85,85
   838 00001054 59999A9B9C9D9E9F        		db 89,153,154,155,156,157,158,159
   839 0000105C 41494F55A5A5A6A7        		db 65,73,79,85,165,165,166,167
   840 00001064 A8A9AAABACADAEAF        		db 168,169,170,171,172,173,174,175
   841 0000106C B0B1B2B3B4B5B6B7        		db 176,177,178,179,180,181,182,183
   842 00001074 B8B9BABBBCBDBEBF        		db 184,185,186,187,188,189,190,191
   843 0000107C C0C1C2C3C4C5C6C7        		db 192,193,194,195,196,197,198,199
   844 00001084 C8C9CACBCCCDCECF        		db 200,201,202,203,204,205,206,207
   845 0000108C D0D1D2D3D4D5D6D7        		db 208,209,210,211,212,213,214,215
   846 00001094 D8D9DADBDCDDDEDF        		db 216,217,218,219,220,221,222,223
   847 0000109C E0E1E2E3E4E5E6E7        		db 224,225,226,227,228,229,230,231
   848 000010A4 E8E9EAEBECEDEEEF        		db 232,233,234,235,236,237,238,239
   849 000010AC F0F1F2F3F4F5F6F7        		db 240,241,242,243,244,245,246,247
   850 000010B4 F8F9FAFBFCFDFEFF        		db 248,249,250,251,252,253,254,255
   851                                  FILE_UCASE_TAB:
   852 000010BC 8000                    		dw 128
   853 000010BE 809A45418E418F80        		db 128,154,69,65,142,65,143,128
   854 000010C6 4545454949498E8F        		db 69,69,69,73,73,73,142,143
   855 000010CE 9092924F994F5555        		db 144,146,146,79,153,79,85,85
   856 000010D6 59999A9B9C9D9E9F        		db 89,153,154,155,156,157,158,159
   857 000010DE 41494F55A5A5A6A7        		db 65,73,79,85,165,165,166,167
   858 000010E6 A8A9AAABACADAEAF        		db 168,169,170,171,172,173,174,175
   859 000010EE B0B1B2B3B4B5B6B7        		db 176,177,178,179,180,181,182,183
   860 000010F6 B8B9BABBBCBDBEBF        		db 184,185,186,187,188,189,190,191
   861 000010FE C0C1C2C3C4C5C6C7        		db 192,193,194,195,196,197,198,199
   862 00001106 C8C9CACBCCCDCECF        		db 200,201,202,203,204,205,206,207
   863 0000110E D0D1D2D3D4D5D6D7        		db 208,209,210,211,212,213,214,215
   864 00001116 D8D9DADBDCDDDEDF        		db 216,217,218,219,220,221,222,223
   865 0000111E E0E1E2E3E4E5E6E7        		db 224,225,226,227,228,229,230,231
   866 00001126 E8E9EAEBECEDEEEF        		db 232,233,234,235,236,237,238,239
   867 0000112E F0F1F2F3F4F5F6F7        		db 240,241,242,243,244,245,246,247
   868 00001136 F8F9FAFBFCFDFEFF        		db 248,249,250,251,252,253,254,255
   869                                  FILE_CHAR_TAB:
   870 0000113E 1600                    		dw 22
   871 00001140 0100FF                  		db 1,0,255
   872 00001143 000020                  		db 0,0,20h
   873 00001146 020E                    		db 2,14
   874 00001148 2E222F5C5B5D3A7C3C-     		db '."/\[]:|<>+=;,',0
   874 00001151 3E2B3D3B2C00       
   875 00001157 000000000000000000-     		db 23 dup(0)
   875 00001160 000000000000000000-
   875 00001169 0000000000         
   876                                  COLLATE_TAB:
   877 0000116E 0001                    		dw 256
   878 00001170 0001020304050607        		db 0,1,2,3,4,5,6,7
   879 00001178 08090A0B0C0D0E0F        		db 8,9,0Ah,0Bh,0Ch,0Dh,0Eh,0Fh
   880 00001180 1011121314151617        		db 10h,11h,12h,13h,14h,15h,16h,17h
   881 00001188 18191A1B1C1D1E1F        		db 18h,19h,1Ah,1Bh,1Ch,1Dh,1Eh,1Fh
   882 00001190 2021222324252627        		db 20h,21h,22h,23h,24h,25h,26h,27h
   883 00001198 28292A2B2C2D2E2F        		db 28h,29h,2Ah,2Bh,2Ch,2Dh,2Eh,2Fh
   884 000011A0 3031323334353637        		db 30h,31h,32h,33h,34h,35h,36h,37h
   885 000011A8 38393A3B3C3D3E3F        		db 38h,39h,3Ah,3Bh,3Ch,3Dh,3Eh,3Fh
   886 000011B0 4041424344454647        		db 40h,41h,42h,43h,44h,45h,46h,47h
   887 000011B8 48494A4B4C4D4E4F        		db 48h,49h,4Ah,4Bh,4Ch,4Dh,4Eh,4Fh
   888 000011C0 5051525354555657        		db 50h,51h,52h,53h,54h,55h,56h,57h
   889 000011C8 58595A5B5C5D5E5F        		db 58h,59h,5Ah,5Bh,5Ch,5Dh,5Eh,5Fh
   890 000011D0 6041424344454647        		db 60h,41h,42h,43h,44h,45h,46h,47h
   891 000011D8 48494A4B4C4D4E4F        		db 48h,49h,4Ah,4Bh,4Ch,4Dh,4Eh,4Fh
   892 000011E0 5051525354555657        		db 50h,51h,52h,53h,54h,55h,56h,57h
   893 000011E8 58595A7B7C7D7E7F        		db 58h,59h,5Ah,7Bh,7Ch,7Dh,7Eh,7Fh
   894 000011F0 4355454141414143        		db 43h,55h,45h,41h,41h,41h,41h,43h
   895 000011F8 4545454949494141        		db 45h,45h,45h,49h,49h,49h,41h,41h
   896 00001200 4541414F4F4F5555        		db 45h,41h,41h,4Fh,4Fh,4Fh,55h,55h
   897 00001208 594F552424242424        		db 59h,4Fh,55h,24h,24h,24h,24h,24h
   898 00001210 41494F554E4EA6A7        		db 41h,49h,4Fh,55h,4Eh,4Eh,0A6h,0A7h
   899 00001218 3FA9AAABAC212222        		db 3Fh,0A9h,0AAh,0ABh,0ACh,21h,22h,22h
   900 00001220 B0B1B2B3B4B5B6B7        		db 0B0h,0B1h,0B2h,0B3h,0B4h,0B5h,0B6h,0B7h
   901 00001228 B8B9BABBBCBDBEBF        		db 0B8h,0B9h,0BAh,0BBh,0BCh,0BDh,0BEh,0BFh
   902 00001230 C0C1C2C3C4C5C6C7        		db 0C0h,0C1h,0C2h,0C3h,0C4h,0C5h,0C6h,0C7h
   903 00001238 C8C9CACBCCCDCECF        		db 0C8h,0C9h,0CAh,0CBh,0CCh,0CDh,0CEh,0CFh
   904 00001240 D0D1D2D3D4D5D6D7        		db 0D0h,0D1h,0D2h,0D3h,0D4h,0D5h,0D6h,0D7h
   905 00001248 D8D9DADBDCDDDEDF        		db 0D8h,0D9h,0DAh,0DBh,0DCh,0DDh,0DEh,0DFh
   906 00001250 E053E2E3E4E5E6E7        		db 0E0h,53h,0E2h,0E3h,0E4h,0E5h,0E6h,0E7h
   907 00001258 E8E9EAEBECEDEEEF        		db 0E8h,0E9h,0EAh,0EBh,0ECh,0EDh,0EEh,0EFh
   908 00001260 F0F1F2F3F4F5F6F7        		db 0F0h,0F1h,0F2h,0F3h,0F4h,0F5h,0F6h,0F7h
   909 00001268 F8F9FAFBFCFDFEFF        		db 0F8h,0F9h,0FAh,0FBh,0FCh,0FDh,0FEh,0FFh
   910                                  DIVMES:
   911 00001270 0D0A                    		db 0Dh,0Ah
   912 00001272 446976696465206F76-     		db 'Divide overflow',0Dh,0Ah
   912 0000127B 6572666C6F770D0A   
   913 00001283 1300                    DivMesLen:	dw 19
   914 00001285 1B                      CANCHAR:	db 1Bh
   915 00001286 00                      ESCCHAR:	db 0
   916                                  
   917 00001287 40                      ESCTAB:		db  40h	; @
   918 00001288 4D                      		db  4Dh	; M
   919 00001289 3B                      		db  3Bh	; ;
   920 0000128A 53                      		db  53h	; S
   921 0000128B 3C                      		db  3Ch	; <
   922 0000128C 3E                      		db  3Eh	; >
   923 0000128D 3D                      		db  3Dh	; =
   924 0000128E 3D                      		db  3Dh	; =
   925 0000128F 3F                      		db  3Fh	; ?
   926 00001290 4B                      		db  4Bh	; K
   927 00001291 52                      		db  52h	; R
   928 00001292 52                      		db  52h	; R
   929 00001293 41                      		db  41h	; A
   930 00001294 41                      		db  41h	; A
   931                                  ESCFUNC:
   932 00001295 [0220]                  		dw GETCH
   933 00001297 [2421]                  		dw TwoEsc
   934 00001299 [AD21]                  		dw ENTERINS_EXITINS
   935 0000129B [AD21]                  		dw ENTERINS_EXITINS
   936 0000129D [AD20]                  		dw BACKSP
   937 0000129F [9921]                  		dw REEDIT
   938 000012A1 [9A20]                  		dw KILNEW
   939 000012A3 [2B21]                  		dw COPYLIN
   940 000012A5 [5E21]                  		dw SKIPSTR
   941 000012A7 [3121]                  		dw CopyStr
   942 000012A9 [5421]                  		dw SKIPONE
   943 000012AB [3621]                  		dw COPYONE
   944 000012AD [3621]                  		dw COPYONE
   945 000012AF [B521]                  		dw CTRLZ
   946                                  CRTERRTAB:	
   947 000012B1 00                      		db 0
   948 000012B2 05                      		db 5
   949 000012B3 52                      		db 52h
   950 000012B4 50                      		db 50h
   951 000012B5 03                      		db 3
   952 000012B6 05                      		db 5
   953 000012B7 20                      		db 20h
   954 000012B8 160E160D0F0E            LenTab:		db 22,14,22,13,15,14
   955 000012BE 8604                    CmdTab:		db 86h,4
   956 000012C0 8605                    		db 86h,5
   957 000012C2 8708                    		db 87h,8
   958 000012C4 870A                    		db 87h,0Ah
   959 000012C6 8607                    		db 86h,7
   960 000012C8 8605                    		db 86h,5
   961                                  CharType:
   962 000012CA F6F6F6F6F6F6F6F6        		db 0F6h,0F6h,0F6h,0F6h,0F6h,0F6h,0F6h,0F6h
   963 000012D2 F6F0F6F6F6F6F6F6        		db 0F6h,0F0h,0F6h,0F6h,0F6h,0F6h,0F6h,0F6h
   964 000012DA F6F6F6F6F6F6F6F6        		db 0F6h,0F6h,0F6h,0F6h,0F6h,0F6h,0F6h,0F6h
   965 000012E2 F6F6F6F6F6F6F6F6        		db 0F6h,0F6h,0F6h,0F6h,0F6h,0F6h,0F6h,0F6h
   966 000012EA F8FFF6FFFFFFFFFF        		db 0F8h,0FFh,0F6h,0FFh,0FFh,0FFh,0FFh,0FFh
   967 000012F2 FFFFFFF4F4FFFEF6        		db 0FFh,0FFh,0FFh,0F4h,0F4h,0FFh,0FEh,0F6h
   968 000012FA FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   969 00001302 FFFFF4F4F4F4F4FF        		db 0FFh,0FFh,0F4h,0F4h,0F4h,0F4h,0F4h,0FFh
   970 0000130A FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   971 00001312 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   972 0000131A FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   973 00001322 FFFFFFF6F6F6FFFF        		db 0FFh,0FFh,0FFh,0F6h,0F6h,0F6h,0FFh,0FFh
   974 0000132A FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   975 00001332 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   976 0000133A FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   977 00001342 FFFFFFFFF4FFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0F4h,0FFh,0FFh,0FFh
   978 0000134A FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   979 00001352 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   980 0000135A FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   981 00001362 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   982 0000136A FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   983 00001372 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   984 0000137A FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   985 00001382 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   986 0000138A FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   987 00001392 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   988 0000139A FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   989 000013A2 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   990 000013AA FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   991 000013B2 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   992 000013BA FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   993 000013C2 FFFFFFFFFFFFFFFF        		db 0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh,0FFh
   994                                  exec_init_sp:
   995 000013CA 0000                    		dw 0
   996 000013CC 0000                    exec_init_ss:	dw 0
   997 000013CE 0000                    exec_init_ip:	dw 0
   998 000013D0 0000                    exec_init_cs:	dw 0
   999 000013D2 0000                    exec_signature:	dw 0
  1000                                  exec_len_mod_512:
  1001 000013D4 0000                    		dw 0
  1002 000013D6 0000                    exec_pages:	dw 0
  1003 000013D8 0000                    exec_rle_count:	dw 0
  1004 000013DA 0000                    exec_par_dir:	dw 0
  1005 000013DC 0000                    exec_min_BSS:	dw 0
  1006 000013DE 0000                    exec_max_BSS:	dw 0
  1007 000013E0 0000                    exec_SS:	dw 0
  1008 000013E2 0000                    exec_SP:	dw 0
  1009 000013E4 0000                    exec_chksum:	dw 0
  1010 000013E6 0000                    exec_IP:	dw 0
  1011 000013E8 0000                    exec_CS:	dw 0
  1012 000013EA 0000                    exec_rle_table:	dw 0
  1013                                  
  1014 000013EC [F013]                  SERVERTAB:	dw SERVER_DISP
  1015 000013EE [AD65]                  SERVERLEAVE:	dw SERVERRETURN
  1016                                  SERVER_DISP:
  1017 000013F0 0B                      		db 11
  1018 000013F1 [1666]                  		dw SRV_CALL
  1019 000013F3 [AE65]                  		dw COMMIT_ALL
  1020 000013F5 [E565]                  		dw CLOSE_NAME
  1021 000013F7 [F065]                  		dw CLOSE_UID
  1022 000013F9 [F765]                  		dw CLOSE_UID_PID
  1023 000013FB [FE65]                  		dw GET_LIST
  1024 000013FD [5766]                  		dw GET_DOS_DATA
  1025 000013FF [7B66]                  		dw SPOOL_OPER
  1026 00001401 [7B66]                  		dw SPOOL_OPER
  1027 00001403 [7B66]                  		dw SPOOL_OPER
  1028 00001405 [8966]                  		dw _$setExtendedError
  1029                                  
  1030                                  ; ---------------------------------------------------------------------------
  1031                                  
  1032                                  		; 07/09/2022
  1033                                  _$SET_CURRENT_PDB:			
  1034 00001407 2E891E[DE02]            		mov	[cs:CurrentPDB], bx
  1035 0000140C CF                      		iret
  1036                                  
  1037                                  ; ---------------------------------------------------------------------------
  1038                                  
  1039                                  		; 07/09/2022
  1040                                  _$GET_CURRENT_PDB:
  1041 0000140D 2E8B1E[DE02]            		mov	bx, [cs:CurrentPDB]
  1042 00001412 CF                      		iret
  1043                                  
  1044                                  ; ---------------------------------------------------------------------------
  1045                                  
  1046                                  		; 07/09/2022
  1047                                  _$SET_CTRL_C_TRAPPING:
  1048 00001413 08C0                    		or	al, al
  1049 00001415 7506                    		jnz	short CTRL_C_set
  1050 00001417 2E8A16[E502]            		mov	dl, [cs:CNTCFLAG]
  1051 0000141C CF                      		iret
  1052                                  
  1053                                  ; ---------------------------------------------------------------------------
  1054                                  
  1055                                  		; 07/09/2022
  1056                                  CTRL_C_set:
  1057 0000141D 3C02                    		cmp	al, 2
  1058 0000141F 7716                    		ja	short bad_val
  1059 00001421 740B                    		jz	short scct_3
  1060 00001423 52                      		push	dx
  1061 00001424 80E201                  		and	dl, 1
  1062 00001427 2E8816[E502]            		mov	[cs:CNTCFLAG], dl
  1063 0000142C 5A                      		pop	dx
  1064 0000142D CF                      		iret
  1065                                  scct_3:
  1066 0000142E 80E201                  		and	dl, 1
  1067 00001431 2E8616[E502]            		xchg	dl, [cs:CNTCFLAG]
  1068 00001436 CF                      		iret
  1069                                  bad_val:
  1070 00001437 B0FF                    		mov	al, 0FFh
  1071 00001439 CF                      		iret
  1072                                  
  1073                                  ; ---------------------------------------------------------------------------
  1074                                  
  1075                                  		; 07/09/2022
  1076                                  _$SET_PRINTER_FLAG:
  1077 0000143A 2EA2[060A]              		mov	[cs:IOSTACK], al
  1078 0000143E CF                      		iret
  1079                                  
  1080                                  ; ---------------------------------------------------------------------------
  1081                                  
  1082                                  		; 07/09/2022
  1083                                  QUIT:
  1084 0000143F B400                    		mov	ah, 0
  1085 00001441 EB24                    		jmp	short SAVREGS
  1086                                  
  1087                                  ; ---------------------------------------------------------------------------
  1088                                  
  1089                                  		; 07/09/2022
  1090                                  BADCALL:
  1091 00001443 B000                    		mov	al, 0
  1092                                  _IRET:
  1093 00001445 CF                      		iret
  1094                                  
  1095                                  ; ---------------------------------------------------------------------------
  1096                                  
  1097                                  		; 07/09/2022
  1098                                  CALL_ENTRY:
  1099 00001446 58                      		pop	ax
  1100 00001447 58                      		pop	ax
  1101 00001448 2E8F06[1E05]            		pop	word [cs:User_SP]
  1102 0000144D 9C                      		pushf
  1103 0000144E FA                      		cli
  1104 0000144F 50                      		push	ax
  1105 00001450 2EFF36[1E05]            		push	word [cs:User_SP]
  1106 00001455 2E3A0E[FE0D]            		cmp	cl, [cs:MAXCALL]
  1107 0000145A 77E7                    		ja	short BADCALL
  1108 0000145C 88CC                    		mov	ah, cl
  1109 0000145E EB07                    		jmp	short SAVREGS
  1110                                  
  1111                                  		; 07/09/2022
  1112                                  COMMAND:
  1113 00001460 2E3A26[FF0D]            		cmp	ah, [cs:MAXCOM]
  1114 00001465 77DC                    		ja	short BADCALL
  1115                                  SAVREGS:
  1116 00001467 80FC51                  		cmp	ah, 51h
  1117 0000146A 74A1                    		jz	short _$GET_CURRENT_PDB
  1118 0000146C 80FC62                  		cmp	ah, 62h
  1119 0000146F 749C                    		jz	short _$GET_CURRENT_PDB
  1120 00001471 80FC50                  		cmp	ah, 50h
  1121 00001474 7491                    		jz	short _$SET_CURRENT_PDB
  1122 00001476 80FC33                  		cmp	ah, 33h
  1123 00001479 7498                    		jz	short _$SET_CTRL_C_TRAPPING
  1124 0000147B 80FC64                  		cmp	ah, 64h
  1125 0000147E 74BA                    		jz	short _$SET_PRINTER_FLAG
  1126 00001480 E8FD00                  		call	save_world
  1127 00001483 2E8C1E[7E05]            		mov	[cs:SaveDS], ds
  1128 00001488 2E891E[7C05]            		mov	[cs:SaveBX], bx
  1129 0000148D 8CCB                    		mov	bx, cs
  1130 0000148F 8EDB                    		mov	ds, bx
  1131 00001491 FE06[CF02]              		inc	byte [INDOS]
  1132                                  		;xor	ax, ax
  1133                                  		; 13/09/2022 - Temporary! (Magic code for Windows 3.1)
  1134 00001495 33C0                    		db 	33h, 0C0h
  1135 00001497 A3[EA02]                		mov	[USER_ID], ax
  1136 0000149A A1[DE02]                		mov	ax, [CurrentPDB]
  1137 0000149D A3[E802]                		mov	[PROC_ID], ax
  1138 000014A0 A1[1E05]                		mov	ax, [User_SP]
  1139 000014A3 A3[8405]                		mov	[NSP], ax
  1140 000014A6 A1[2005]                		mov	ax, [User_SS]
  1141 000014A9 A3[8205]                		mov	[NSS], ax
  1142 000014AC 58                      		pop	ax
  1143 000014AD 50                      		push	ax
  1144 000014AE 8926[1E05]              		mov	[User_SP], sp
  1145 000014B2 8C16[2005]              		mov	[User_SS], ss
  1146 000014B6 8E1E[DE02]              		mov	ds, [CurrentPDB]
  1147 000014BA 8926[2E00]              		mov	word [BCLOCK], sp
  1148 000014BE 8C16[3000]              		mov	word [BCLOCK+2], ss
  1149 000014C2 2EC606[0D05]00          		mov	byte [cs:fSharing], 0
  1150 000014C8 8CCB                    		mov	bx, cs
  1151 000014CA 8ED3                    		mov	ss, bx
  1152                                  REDISP:
  1153 000014CC BC[0607]                		mov	sp, AUXSTACK
  1154 000014CF FB                      		sti
  1155 000014D0 8CCB                    		mov	bx, cs
  1156 000014D2 8EDB                    		mov	ds, bx
  1157 000014D4 30FF                    		xor	bh, bh
  1158 000014D6 883E[0303]              		mov	[CONSWAP], bh
  1159 000014DA C606[0403]01            		mov	byte [IDLEINT], 1
  1160 000014DF 883E[F802]              		mov	[NoSetDir], bh
  1161 000014E3 883E[F602]              		mov	[FAILERR], bh
  1162 000014E7 88E3                    		mov	bl, ah
  1163 000014E9 D1E3                    		shl	bx, 1
  1164 000014EB FC                      		cld
  1165 000014EC 08E4                    		or	ah, ah
  1166 000014EE 7416                    		jz	short DSKROUT
  1167 000014F0 80FC59                  		cmp	ah, 59h
  1168 000014F3 743D                    		jz	short DISPCALL
  1169 000014F5 80FC0C                  		cmp	ah, 0Ch
  1170 000014F8 770C                    		ja	short DSKROUT
  1171                                  IOROUT:
  1172 000014FA 803E[CE02]00            		cmp	byte [ERRORMODE], 0
  1173 000014FF 7531                    		jnz	short DISPCALL
  1174 00001501 BC[060A]                		mov	sp, IOSTACK
  1175 00001504 EB2C                    		jmp	short DISPCALL
  1176                                  DSKROUT:
  1177 00001506 A3[E602]                		mov	word [USER_IN_AX], ax
  1178 00001509 C606[D102]01            		mov	byte [EXTERR_LOCUS], 1
  1179 0000150E C606[CE02]00            		mov	byte [ERRORMODE], 0
  1180 00001513 C606[D002]FF            		mov	byte [WPERR], -1
  1181 00001518 50                      		push	ax
  1182 00001519 B482                    		mov	ah, 82h
  1183 0000151B CD2A                    		int	2Ah		; Microsoft Networks - END DOS CRITICAL	SECTIONS 0 THROUGH 7
  1184 0000151D 58                      		pop	ax
  1185 0000151E C606[0403]00            		mov	byte [IDLEINT], 0
  1186 00001523 BC[8608]                		mov	sp, DSKSTACK
  1187 00001526 F606[E502]FF            		test	byte [CNTCFLAG], -1
  1188 0000152B 7405                    		jz	short DISPCALL
  1189 0000152D 50                      		push	ax
  1190 0000152E E82C40                  		call	DSKSTATCHK
  1191 00001531 58                      		pop	ax
  1192                                  DISPCALL:
  1193 00001532 2E8B9F[000E]            		mov	bx, [cs:bx+DISPATCH]
  1194 00001537 871E[7C05]              		xchg	bx, [SaveBX]
  1195 0000153B 8E1E[7E05]              		mov	ds, [SaveDS]
  1196 0000153F 36FF16[7C05]            		call	word [ss:SaveBX]
  1197                                  LeaveDOS:
  1198 00001544 FA                      		cli
  1199 00001545 2EFE0E[CF02]            		dec	byte [cs:INDOS]
  1200 0000154A 2E8E16[2005]            		mov	ss, [cs:User_SS]
  1201 0000154F 2E8B26[1E05]            		mov	sp, [cs:User_SP]
  1202 00001554 89E5                    		mov	bp, sp
  1203 00001556 884600                  		mov	[bp+0],	al
  1204 00001559 2EA1[8405]              		mov	ax, [cs:NSP]
  1205 0000155D 2EA3[1E05]              		mov	[cs:User_SP], ax
  1206 00001561 2EA1[8205]              		mov	ax, [cs:NSS]
  1207 00001565 2EA3[2005]              		mov	[cs:User_SS], ax
  1208 00001569 E80100                  		call	restore_world
  1209 0000156C CF                      		iret
  1210                                  
  1211                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1212                                  
  1213                                  		; 07/09/2022
  1214                                  restore_world:
  1215 0000156D 2E8F06[8005]            		pop	word [cs:restore_tmp]
  1216 00001572 58                      		pop	ax
  1217 00001573 5B                      		pop	bx
  1218 00001574 59                      		pop	cx
  1219 00001575 5A                      		pop	dx
  1220 00001576 5E                      		pop	si
  1221 00001577 5F                      		pop	di
  1222 00001578 5D                      		pop	bp
  1223 00001579 1F                      		pop	ds
  1224 0000157A 07                      		pop	es
  1225 0000157B 2EFF26[8005]            		jmp	word [cs:restore_tmp]
  1226                                  
  1227                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1228                                  
  1229                                  		; 07/09/2022
  1230                                  save_world:
  1231 00001580 2E8F06[8005]            		pop	word [cs:restore_tmp]
  1232 00001585 06                      		push	es
  1233 00001586 1E                      		push	ds
  1234 00001587 55                      		push	bp
  1235 00001588 57                      		push	di
  1236 00001589 56                      		push	si
  1237 0000158A 52                      		push	dx
  1238 0000158B 51                      		push	cx
  1239 0000158C 53                      		push	bx
  1240 0000158D 50                      		push	ax
  1241 0000158E 2EFF26[8005]            		jmp	word [cs:restore_tmp]
  1242                                  
  1243                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1244                                  
  1245                                  		; 07/09/2022
  1246                                  Get_User_Stack:
  1247 00001593 2EC536[1E05]            		lds	si, [cs:User_SP]
  1248 00001598 C3                      		retn
  1249                                  
  1250                                  ; ---------------------------------------------------------------------------
  1251                                  
  1252                                  		; 07/09/2022
  1253                                  SNULDEV:
  1254 00001599 26814F030001            		or	word [es:bx+3], 100h
  1255                                  INULDEV:
  1256 0000159F CB                      		retf
  1257                                  
  1258                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1259                                  
  1260                                  		; 07/09/2022
  1261                                  AbsSetup:
  1262 000015A0 36FE06[CF02]            		inc	byte [ss:INDOS]
  1263 000015A5 FB                      		sti
  1264 000015A6 FC                      		cld
  1265 000015A7 1E                      		push	ds
  1266 000015A8 16                      		push	ss
  1267 000015A9 1F                      		pop	ds
  1268 000015AA E88D00                  		call	GETBP
  1269 000015AD 26C7461EFFFF            		mov	word [es:bp+30], -1
  1270 000015B3 1F                      		pop	ds
  1271 000015B4 7301                    		jnb	short AbsSetup2
  1272                                  AbsSetup_retn:
  1273 000015B6 C3                      		retn
  1274                                  AbsSetup2:
  1275 000015B7 1E                      		push	ds
  1276 000015B8 56                      		push	si
  1277 000015B9 50                      		push	ax
  1278 000015BA 16                      		push	ss
  1279 000015BB 1F                      		pop	ds
  1280 000015BC BE[6003]                		mov	si, OPENBUF
  1281 000015BF 8804                    		mov	[si], al
  1282 000015C1 800441                  		add	byte [si], 'A'
  1283 000015C4 C744013A00              		mov	word [si+1], ':'
  1284 000015C9 B80003                  		mov	ax, 300h
  1285 000015CC F8                      		clc
  1286 000015CD CD2A                    		int	2Ah		; Microsoft Networks - CHECK DIRECT I/O
  1287                                  					; DS:SI	-> ASCIZ disk device name (may be full path or only drive
  1288                                  					; specifier--must include the colon)
  1289                                  					; Return: CF clear if absolute disk access allowed
  1290 000015CF 58                      		pop	ax
  1291 000015D0 5E                      		pop	si
  1292 000015D1 1F                      		pop	ds
  1293 000015D2 73E2                    		jnb	short AbsSetup_retn
  1294 000015D4 36C706[D202]3200        		mov	word [ss:EXTERR], 32h
  1295                                  GETBP_RETN:
  1296 000015DB C3                      		retn
  1297                                  
  1298                                  ; ---------------------------------------------------------------------------
  1299                                  
  1300                                  		; 07/09/2022
  1301                                  ABSDRD:
  1302 000015DC FA                      		cli
  1303 000015DD 2E8C16[2005]            		mov	[cs:User_SS], ss
  1304 000015E2 2E8926[1E05]            		mov	[cs:User_SP], sp
  1305 000015E7 0E                      		push	cs
  1306 000015E8 17                      		pop	ss
  1307 000015E9 BC[8608]                		mov	sp, DSKSTACK
  1308 000015EC 06                      		push	es
  1309 000015ED E8B0FF                  		call	AbsSetup
  1310 000015F0 721A                    		jb	short ILEAVE
  1311 000015F2 E8B02A                  		call	DSKREAD
  1312                                  TLEAVE:
  1313 000015F5 7415                    		jz	short ILEAVE
  1314 000015F7 06                      		push	es
  1315 000015F8 0E                      		push	cs
  1316 000015F9 07                      		pop	es
  1317 000015FA 30E4                    		xor	ah, ah
  1318 000015FC B90600                  		mov	cx, 6
  1319 000015FF BF[890F]                		mov	di, ERRIN
  1320 00001602 F2AE                    		repne scasb
  1321 00001604 7504                    		jnz	short LEAVECODE
  1322 00001606 268A6505                		mov	ah, [es:di+5]
  1323                                  LEAVECODE:
  1324 0000160A 07                      		pop	es
  1325 0000160B F9                      		stc
  1326                                  ILEAVE:
  1327 0000160C 07                      		pop	es
  1328 0000160D FA                      		cli
  1329 0000160E 36FE0E[CF02]            		dec	byte [ss:INDOS]
  1330 00001613 368E16[2005]            		mov	ss, [ss:User_SS]
  1331 00001618 2E8B26[1E05]            		mov	sp, [cs:User_SP]
  1332 0000161D FB                      		sti
  1333 0000161E CB                      		retf
  1334                                  
  1335                                  ; ---------------------------------------------------------------------------
  1336                                  
  1337                                  		; 07/09/2022
  1338                                  ABSDWRT:
  1339 0000161F FA                      		cli
  1340 00001620 2E8C16[2005]            		mov	[cs:User_SS], ss
  1341 00001625 2E8926[1E05]            		mov	[cs:User_SP], sp
  1342 0000162A 0E                      		push	cs
  1343 0000162B 17                      		pop	ss
  1344 0000162C BC[8608]                		mov	sp, DSKSTACK
  1345 0000162F 06                      		push	es
  1346 00001630 E86DFF                  		call	AbsSetup
  1347 00001633 72D7                    		jb	short ILEAVE
  1348 00001635 E8982A                  		call	DSKWRITE
  1349 00001638 EBBB                    		jmp	short TLEAVE
  1350                                  
  1351                                  ; ---------------------------------------------------------------------------
  1352                                  
  1353                                  		; 07/09/2022
  1354                                  GETBP:
  1355 0000163A 50                      		push	ax
  1356 0000163B 0401                    		add	al, 1
  1357 0000163D 7203                    		jb	short SKIPGET
  1358 0000163F E80D52                  		call	GetThisDrv
  1359                                  
  1360                                  SKIPGET:
  1361 00001642 58                      		pop	ax
  1362 00001643 7296                    		jb	short GETBP_RETN
  1363 00001645 C42E[3A05]              		les	bp, [THISCDS]
  1364 00001649 26F746430080            		test	word [es:bp+43h], 8000h
  1365 0000164F 7408                    		jz	short GETBP_CDS
  1366 00001651 C706[D202]3200          		mov	word [EXTERR], 32h
  1367 00001657 F9                      		stc
  1368 00001658 C3                      		retn
  1369                                  
  1370                                  ; ---------------------------------------------------------------------------
  1371                                  
  1372                                  		; 07/09/2022
  1373                                  GETBP_CDS:
  1374 00001659 26C46E45                		les	bp, [es:bp+45h]
  1375                                  GOTDPB:
  1376 0000165D 892E[2405]              		mov	word [THISDPB], bp
  1377 00001661 8C06[2605]              		mov	word [THISDPB+2], es
  1378 00001665 C3                      		retn
  1379                                  ; ---------------------------------------------------------------------------
  1380                                  
  1381                                  		; 14/09/2022
  1382                                  		; 07/09/2022
  1383                                  SYS_RET_OK:
  1384 00001666 E87C07                  		call	FETCHI_CHECK
  1385 00001669 E827FF                  		call	Get_User_Stack
  1386 0000166C 836416FE                		and	word [si+16h], 0FFFEh ; 14/09/2022
  1387                                  		; 09/09/2022 - Temporary !
  1388                                  		;db 	81h, 64h, 16h, 0FEh, 0FFh
  1389 00001670 EB11                    		jmp	short DO_RET
  1390                                  
  1391                                  ; ---------------------------------------------------------------------------
  1392                                  
  1393                                  		; 07/09/2022
  1394                                  SYS_Ret_Err:
  1395 00001672 30E4                    		xor	ah, ah
  1396 00001674 E86D00                  		call	ETAB_LK
  1397 00001677 E81B00                  		call	ErrorMap
  1398                                  From_GetSet:
  1399 0000167A E816FF                  		call	Get_User_Stack
  1400                                  		;or	word [si+16h], 1
  1401                                  		; 09/09/2022 - Temporary !
  1402 0000167D 814C160100              		db	81h, 4Ch, 16h, 1, 0
  1403 00001682 F9                      		stc
  1404                                  DO_RET:
  1405 00001683 8904                    		mov	[si], ax
  1406 00001685 C3                      		retn
  1407                                  
  1408                                  ; ---------------------------------------------------------------------------
  1409                                  
  1410                                  		; 07/09/2022
  1411                                  NO_OP:
  1412 00001686 30C0                    		xor	al, al
  1413 00001688 C3                      		retn
  1414                                  
  1415                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1416                                  
  1417                                  		; 07/09/2022
  1418                                  FCB_Ret_Err:
  1419 00001689 30E4                    		xor	ah, ah
  1420 0000168B 36A3[D202]              		mov	[ss:EXTERR], ax
  1421 0000168F E80300                  		call	ErrorMap
  1422 00001692 B0FF                    		mov	al, -1
  1423 00001694 C3                      		retn
  1424                                  
  1425                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1426                                  
  1427                                  		; 07/09/2022
  1428                                  ErrorMap:
  1429 00001695 56                      		push	si
  1430 00001696 BE[2A0D]                		mov	si, ERR_TABLE_21
  1431 00001699 36803E[F602]00          		cmp	byte [ss:FAILERR], 0
  1432 0000169F 740A                    		jz	short EXTENDED_NORMAL
  1433 000016A1 36C706[D202]5300        		mov	word [ss:EXTERR], 53h
  1434 000016A8 BE[2A0D]                		mov	si, ERR_TABLE_21
  1435                                  EXTENDED_NORMAL:
  1436 000016AB E80200                  		call	CAL_LK
  1437 000016AE 5E                      		pop	si
  1438 000016AF C3                      		retn
  1439                                  
  1440                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1441                                  
  1442                                  		; 07/09/2022
  1443                                  CAL_LK:
  1444 000016B0 1E                      		push	ds
  1445 000016B1 50                      		push	ax
  1446 000016B2 53                      		push	bx
  1447 000016B3 16                      		push	ss
  1448 000016B4 1F                      		pop	ds
  1449 000016B5 8B1E[D202]              		mov	bx, [EXTERR]
  1450                                  TABLK1:
  1451 000016B9 AC                      		lodsb
  1452 000016BA 3CFF                    		cmp	al, 0FFh
  1453 000016BC 7409                    		jz	short GOT_VALS
  1454 000016BE 38D8                    		cmp	al, bl
  1455 000016C0 7405                    		jz	short GOT_VALS
  1456 000016C2 83C603                  		add	si, 3
  1457 000016C5 EBF2                    		jmp	short TABLK1
  1458                                  GOT_VALS:
  1459 000016C7 AD                      		lodsw
  1460 000016C8 80FCFF                  		cmp	ah, 0FFh
  1461 000016CB 7404                    		jz	short NO_SET_ACT
  1462 000016CD 8826[D402]              		mov	[EXTERR_ACTION], ah
  1463                                  NO_SET_ACT:
  1464 000016D1 3CFF                    		cmp	al, 0FFh
  1465 000016D3 7403                    		jz	short NO_SET_CLS
  1466 000016D5 A2[D502]                		mov	[EXTERR_CLASS], al
  1467                                  NO_SET_CLS:
  1468 000016D8 AC                      		lodsb
  1469 000016D9 3CFF                    		cmp	al, 0FFh
  1470 000016DB 7403                    		jz	short NO_SET_LOC
  1471 000016DD A2[D102]                		mov	[EXTERR_LOCUS], al
  1472                                  NO_SET_LOC:
  1473 000016E0 5B                      		pop	bx
  1474 000016E1 58                      		pop	ax
  1475 000016E2 1F                      		pop	ds
  1476 000016E3 C3                      		retn
  1477                                  
  1478                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1479                                  
  1480                                  		; 07/09/2022
  1481                                  ETAB_LK:
  1482 000016E4 1E                      		push	ds
  1483 000016E5 56                      		push	si
  1484 000016E6 51                      		push	cx
  1485 000016E7 53                      		push	bx
  1486 000016E8 16                      		push	ss
  1487 000016E9 1F                      		pop	ds
  1488 000016EA A3[D202]                		mov	[EXTERR], ax
  1489 000016ED BE[8E0C]                		mov	si, I21_MAP_E_TAB
  1490 000016F0 88C7                    		mov	bh, al
  1491 000016F2 8A1E[E702]              		mov	bl, [USER_IN_AX+1]
  1492                                  TABLK2:
  1493 000016F6 AD                      		lodsw
  1494 000016F7 3CFF                    		cmp	al, 0FFh
  1495 000016F9 740C                    		jz	short NOT_IN_TABLE
  1496 000016FB 38D8                    		cmp	al, bl
  1497 000016FD 740C                    		jz	short GOT_CALL
  1498 000016FF 86E0                    		xchg	ah, al
  1499 00001701 30E4                    		xor	ah, ah
  1500 00001703 01C6                    		add	si, ax
  1501 00001705 EBEF                    		jmp	short TABLK2
  1502                                  NOT_IN_TABLE:
  1503 00001707 88F8                    		mov	al, bh
  1504 00001709 EB0B                    		jmp	short NO_MAP
  1505                                  GOT_CALL:
  1506 0000170B 88E1                    		mov	cl, ah
  1507 0000170D 30ED                    		xor	ch, ch
  1508                                  CHECK_CODE:
  1509 0000170F AC                      		lodsb
  1510 00001710 38F8                    		cmp	al, bh
  1511 00001712 7402                    		jz	short NO_MAP
  1512 00001714 E2F9                    		loop	CHECK_CODE
  1513                                  NO_MAP:
  1514 00001716 30E4                    		xor	ah, ah
  1515 00001718 5B                      		pop	bx
  1516 00001719 59                      		pop	cx
  1517 0000171A 5E                      		pop	si
  1518 0000171B 1F                      		pop	ds
  1519 0000171C C3                      		retn
  1520                                  
  1521                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1522                                  
  1523                                  		; 07/09/2022
  1524                                  SetBad:
  1525 0000171D B80100                  		mov	ax, 1
  1526 00001720 2EC606[D102]01          		mov	byte [cs:EXTERR_LOCUS], 1
  1527 00001726 F9                      		stc
  1528 00001727 C3                      		retn
  1529                                  
  1530                                  ; ---------------------------------------------------------------------------
  1531                                  
  1532                                  		; 07/09/2022
  1533                                  BadCall:
  1534 00001728 E8F2FF                  		call	SetBad
  1535 0000172B CB                      		retf
  1536                                  
  1537                                  ; ---------------------------------------------------------------------------
  1538                                  
  1539                                  		; 07/09/2022
  1540                                  OKCall:
  1541 0000172C F8                      		clc
  1542 0000172D CB                      		retf
  1543                                  
  1544                                  ; ---------------------------------------------------------------------------
  1545                                  
  1546                                  		; 07/09/2022
  1547                                  INT2F:
  1548 0000172E FB                      		sti
  1549 0000172F 80FC11                  		cmp	ah, 11h
  1550 00001732 750A                    		jnz	short INT2FSHR
  1551                                  TestInstall:
  1552 00001734 08C0                    		or	al, al
  1553 00001736 7403                    		jz	short Leave2F
  1554                                  BadFunc:
  1555 00001738 E8E2FF                  		call	SetBad
  1556                                  Leave2F:
  1557 0000173B CA0200                  		retf	2
  1558                                  
  1559                                  ; ---------------------------------------------------------------------------
  1560                                  
  1561                                  		; 07/09/2022
  1562                                  INT2FSHR:
  1563 0000173E 80FC10                  		cmp	ah, 10h
  1564 00001741 74F1                    		jz	short TestInstall
  1565 00001743 80FC14                  		cmp	ah, 14h
  1566 00001746 74EC                    		jz	short TestInstall
  1567 00001748 80FC12                  		cmp	ah, 12h
  1568 0000174B 7401                    		jz	short DispatchDOS
  1569 0000174D CF                      		iret
  1570                                  
  1571                                  ; ---------------------------------------------------------------------------
  1572                                  
  1573                                  		; 07/09/2022
  1574                                  DispatchDOS:
  1575 0000174E 2EFF36[D20E]            		push	word [cs:FOO]
  1576 00001753 2EFF36[D40E]            		push	word [cs:DTab]
  1577 00001758 50                      		push	ax
  1578 00001759 55                      		push	bp
  1579 0000175A 89E5                    		mov	bp, sp
  1580 0000175C 8B460E                  		mov	ax, [bp+0Eh]
  1581 0000175F 5D                      		pop	bp
  1582 00001760 E80807                  		call	TableDispatch
  1583 00001763 EBD3                    		jmp	short BadFunc
  1584                                  
  1585                                  ; ---------------------------------------------------------------------------
  1586                                  
  1587                                  		; 07/09/2022
  1588                                  DOSGetGroup:
  1589 00001765 0E                      		push	cs
  1590 00001766 1F                      		pop	ds
  1591 00001767 C3                      		retn
  1592                                  
  1593                                  ; ---------------------------------------------------------------------------
  1594                                  
  1595                                  		; 07/09/2022
  1596                                  DOSInstall:
  1597 00001768 B0FF                    		mov	al, 0FFh
  1598 0000176A C3                      		retn
  1599                                  
  1600                                  ; ---------------------------------------------------------------------------
  1601                                  
  1602                                  		; 07/09/2022
  1603                                  MAP_CASE:
  1604 0000176B 3C80                    		cmp	al, 80h
  1605 0000176D 7301                    		jnb	short Map1
  1606 0000176F CB                      		retf
  1607                                  Map1:
  1608 00001770 2C80                    		sub	al, 80h
  1609 00001772 1E                      		push	ds
  1610 00001773 53                      		push	bx
  1611 00001774 BB[3C10]                		mov	bx, UCASE_TAB+2
  1612 00001777 0E                      		push	cs
  1613 00001778 1F                      		pop	ds
  1614 00001779 D7                      		xlat
  1615 0000177A 5B                      		pop	bx
  1616 0000177B 1F                      		pop	ds
  1617 0000177C CB                      		retf
  1618                                  
  1619                                  ; ---------------------------------------------------------------------------
  1620                                  
  1621                                  		; 07/09/2022
  1622                                  OEMFunctionKey:
  1623 0000177D E8D507                  		call	_$STD_CON_INPUT_NO_ECHO
  1624 00001780 B10E                    		mov	cl, 14
  1625 00001782 57                      		push	di
  1626 00001783 BF[8712]                		mov	di, ESCTAB
  1627 00001786 F2AE                    		repne scasb
  1628 00001788 5F                      		pop	di
  1629 00001789 D1E1                    		shl	cx, 1
  1630 0000178B 89CD                    		mov	bp, cx
  1631 0000178D FFA6[9512]              		jmp	word [bp+ESCFUNC]
  1632                                  
  1633                                  ; ---------------------------------------------------------------------------
  1634                                  
  1635                                  		; 07/09/2022
  1636                                  _$GET_DATE:
  1637 00001791 16                      		push	ss
  1638 00001792 1F                      		pop	ds
  1639 00001793 E8B700                  		call	READTIME
  1640 00001796 A1[FE02]                		mov	ax, [YEAR]
  1641 00001799 8B1E[FC02]              		mov	bx, word [DAY]
  1642 0000179D E8F3FD                  		call	Get_User_Stack
  1643 000017A0 895C06                  		mov	[si+6],	bx
  1644 000017A3 05BC07                  		add	ax, 1980
  1645 000017A6 894404                  		mov	[si+4],	ax
  1646 000017A9 36A0[0203]              		mov	al, [ss:WEEKDAY]
  1647                                  GetDT_retn:
  1648 000017AD C3                      		retn
  1649                                  
  1650                                  ; ---------------------------------------------------------------------------
  1651                                  
  1652                                  		; 07/09/2022
  1653                                  _$SET_DATE:
  1654 000017AE B0FF                    		mov	al, -1
  1655 000017B0 81E9BC07                		sub	cx, 1980
  1656 000017B4 72F7                    		jb	short GetDT_retn
  1657 000017B6 83F977                  		cmp	cx, 119
  1658 000017B9 7712                    		ja	short RET24
  1659 000017BB 08F6                    		or	dh, dh
  1660 000017BD 74EE                    		jz	short GetDT_retn
  1661 000017BF 08D2                    		or	dl, dl
  1662 000017C1 74EA                    		jz	short GetDT_retn
  1663 000017C3 80FE0C                  		cmp	dh, 12
  1664 000017C6 7705                    		ja	short RET24
  1665 000017C8 16                      		push	ss
  1666 000017C9 1F                      		pop	ds
  1667 000017CA E81101                  		call	DODATE
  1668                                  RET24:
  1669 000017CD C3                      		retn
  1670                                  
  1671                                  ; ---------------------------------------------------------------------------
  1672                                  
  1673                                  		; 07/09/2022
  1674                                  _$GET_TIME:
  1675 000017CE 16                      		push	ss
  1676 000017CF 1F                      		pop	ds
  1677 000017D0 E87A00                  		call	READTIME
  1678 000017D3 E8BDFD                  		call	Get_User_Stack
  1679 000017D6 895406                  		mov	[si+6],	dx
  1680 000017D9 894C04                  		mov	[si+4],	cx
  1681 000017DC 30C0                    		xor	al, al
  1682                                  RET26:
  1683 000017DE C3                      		retn
  1684                                  ; ---------------------------------------------------------------------------
  1685                                  
  1686                                  		; 07/09/2022
  1687                                  _$SET_TIME:
  1688 000017DF B0FF                    		mov	al, -1
  1689 000017E1 80FD18                  		cmp	ch, 24
  1690 000017E4 73F8                    		jnb	short RET26
  1691 000017E6 80F93C                  		cmp	cl, 60
  1692 000017E9 73F3                    		jnb	short RET26
  1693 000017EB 80FE3C                  		cmp	dh, 60
  1694 000017EE 73EE                    		jnb	short RET26
  1695 000017F0 80FA64                  		cmp	dl, 100
  1696 000017F3 73E9                    		jnb	short RET26
  1697 000017F5 51                      		push	cx
  1698 000017F6 52                      		push	dx
  1699 000017F7 16                      		push	ss
  1700 000017F8 1F                      		pop	ds
  1701 000017F9 BB[5803]                		mov	bx, TIMEBUF
  1702 000017FC B90600                  		mov	cx, 6
  1703 000017FF 31D2                    		xor	dx, dx
  1704 00001801 89D0                    		mov	ax, dx
  1705 00001803 53                      		push	bx
  1706 00001804 E81F36                  		call	SETREAD
  1707 00001807 1E                      		push	ds
  1708 00001808 C536[2E00]              		lds	si, [BCLOCK]
  1709 0000180C E8F335                  		call	DEVIOCALL2
  1710 0000180F 1F                      		pop	ds
  1711 00001810 5B                      		pop	bx
  1712 00001811 E84536                  		call	SETWRITE
  1713 00001814 8F06[5C03]              		pop	word [TIMEBUF+4]
  1714 00001818 8F06[5A03]              		pop	word [TIMEBUF+2]
  1715 0000181C C536[2E00]              		lds	si, [BCLOCK]
  1716 00001820 E8DF35                  		call	DEVIOCALL2
  1717 00001823 30C0                    		xor	al, al
  1718 00001825 C3                      		retn
  1719                                  
  1720                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1721                                  
  1722                                  		; 07/09/2022
  1723                                  DATE16:
  1724 00001826 16                      		push	ss
  1725 00001827 1F                      		pop	ds
  1726 00001828 51                      		push	cx
  1727 00001829 06                      		push	es
  1728 0000182A E82000                  		call	READTIME
  1729 0000182D 07                      		pop	es
  1730 0000182E D0E1                    		shl	cl, 1
  1731 00001830 D0E1                    		shl	cl, 1
  1732 00001832 D1E1                    		shl	cx, 1
  1733 00001834 D1E1                    		shl	cx, 1
  1734 00001836 D1E1                    		shl	cx, 1
  1735 00001838 D0EE                    		shr	dh, 1
  1736 0000183A 08F1                    		or	cl, dh
  1737 0000183C 89CA                    		mov	dx, cx
  1738 0000183E A1[FD02]                		mov	ax, word [MONTH]
  1739 00001841 B104                    		mov	cl, 4
  1740 00001843 D2E0                    		shl	al, cl
  1741 00001845 D1E0                    		shl	ax, 1
  1742 00001847 59                      		pop	cx
  1743 00001848 0A06[FC02]              		or	al, [DAY]
  1744                                  RET21:
  1745 0000184C C3                      		retn
  1746                                  
  1747                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1748                                  
  1749                                  		; 09/09/2022
  1750                                  		; 07/09/2022
  1751                                  READTIME:
  1752 0000184D C706[850F]0000          		mov	word [DATE_FLAG], 0
  1753 00001853 56                      		push	si
  1754 00001854 53                      		push	bx
  1755 00001855 BB[5803]                		mov	bx, TIMEBUF
  1756 00001858 B90600                  		mov	cx, 6
  1757 0000185B 31D2                    		xor	dx, dx
  1758 0000185D 89D0                    		mov	ax, dx
  1759 0000185F E8C435                  		call	SETREAD
  1760 00001862 1E                      		push	ds
  1761 00001863 C536[2E00]              		lds	si, [BCLOCK]
  1762 00001867 E89835                  		call	DEVIOCALL2
  1763 0000186A 1F                      		pop	ds
  1764 0000186B 5B                      		pop	bx
  1765 0000186C 5E                      		pop	si
  1766 0000186D A1[5803]                		mov	ax, [TIMEBUF]
  1767 00001870 8B0E[5A03]              		mov	cx, [TIMEBUF+2] ; 09/09/2022
  1768 00001874 8B16[5C03]              		mov	dx, [TIMEBUF+4] ; 09/09/2022
  1769 00001878 3B06[0003]              		cmp	ax, [DAYCNT]
  1770 0000187C 74CE                    		jz	short RET21
  1771 0000187E 3D36AB                  		cmp	ax, 43830
  1772 00001881 733D                    		jnb	short RET22
  1773 00001883 A3[0003]                		mov	[DAYCNT], ax
  1774 00001886 56                      		push	si
  1775 00001887 51                      		push	cx
  1776 00001888 52                      		push	dx
  1777 00001889 31D2                    		xor	dx, dx
  1778 0000188B B9B505                  		mov	cx, 1461
  1779 0000188E F7F1                    		div	cx
  1780 00001890 D1E0                    		shl	ax, 1
  1781 00001892 D1E0                    		shl	ax, 1
  1782 00001894 D1E0                    		shl	ax, 1
  1783 00001896 89C1                    		mov	cx, ax
  1784 00001898 BE[7A0C]                		mov	si, YRTAB
  1785 0000189B E82300                  		call	DSLIDE
  1786 0000189E D1E9                    		shr	cx, 1
  1787 000018A0 7304                    		jnb	short SK
  1788 000018A2 81C2C800                		add	dx, 200
  1789                                  SK:
  1790 000018A6 E82400                  		call	SETYEAR
  1791 000018A9 B101                    		mov	cl, 1
  1792 000018AB BE[820C]                		mov	si, MONTAB
  1793 000018AE E81000                  		call	DSLIDE
  1794 000018B1 880E[FD02]              		mov	[MONTH], cl
  1795 000018B5 42                      		inc	dx
  1796 000018B6 8816[FC02]              		mov	[DAY], dl
  1797 000018BA E89200                  		call	WKDAY
  1798 000018BD 5A                      		pop	dx
  1799 000018BE 59                      		pop	cx
  1800 000018BF 5E                      		pop	si
  1801                                  RET22:
  1802 000018C0 C3                      		retn
  1803                                  
  1804                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1805                                  
  1806                                  		; 07/09/2022
  1807                                  DSLIDE:
  1808 000018C1 B400                    		mov	ah, 0
  1809                                  DSLIDE1:
  1810 000018C3 AC                      		lodsb
  1811 000018C4 39C2                    		cmp	dx, ax
  1812 000018C6 72F8                    		jb	short RET22
  1813 000018C8 29C2                    		sub	dx, ax
  1814 000018CA 41                      		inc	cx
  1815 000018CB EBF6                    		jmp	short DSLIDE1
  1816                                  
  1817                                  ; ---------------------------------------------------------------------------
  1818                                  
  1819                                  		; 07/09/2022
  1820                                  SETYEAR:
  1821 000018CD 880E[FE02]              		mov	byte [YEAR], cl
  1822                                  CHKYR:
  1823 000018D1 F6C103                  		test	cl, 3
  1824 000018D4 B01C                    		mov	al, 28
  1825 000018D6 7502                    		jnz	short SAVFEB
  1826 000018D8 FEC0                    		inc	al
  1827                                  SAVFEB:
  1828 000018DA A2[830C]                		mov	[february], al
  1829                                  RET23:
  1830 000018DD C3                      		retn
  1831                                  
  1832                                  ; ---------------------------------------------------------------------------
  1833                                  
  1834                                  		; 07/09/2022
  1835                                  DODATE:
  1836 000018DE E8F0FF                  		call	CHKYR
  1837 000018E1 88F0                    		mov	al, dh
  1838 000018E3 BB[810C]                		mov	bx, MONTAB_x1
  1839 000018E6 D7                      		xlat
  1840 000018E7 38D0                    		cmp	al, dl
  1841 000018E9 B0FF                    		mov	al, -1
  1842 000018EB 72F0                    		jb	short RET23
  1843 000018ED E8DDFF                  		call	SETYEAR
  1844 000018F0 8916[FC02]              		mov	word [DAY], dx
  1845 000018F4 D1E9                    		shr	cx, 1
  1846 000018F6 D1E9                    		shr	cx, 1
  1847 000018F8 B8B505                  		mov	ax, 1461
  1848 000018FB 89D3                    		mov	bx, dx
  1849 000018FD F7E1                    		mul	cx
  1850 000018FF 8A0E[FE02]              		mov	cl, byte [YEAR]
  1851 00001903 80E103                  		and	cl, 3
  1852 00001906 BE[7A0C]                		mov	si, YRTAB
  1853 00001909 89C2                    		mov	dx, ax
  1854 0000190B D1E1                    		shl	cx, 1
  1855 0000190D E85200                  		call	DSUM
  1856 00001910 88F9                    		mov	cl, bh
  1857 00001912 BE[820C]                		mov	si, MONTAB
  1858 00001915 49                      		dec	cx
  1859 00001916 E84900                  		call	DSUM
  1860 00001919 88D9                    		mov	cl, bl
  1861 0000191B 49                      		dec	cx
  1862 0000191C 01CA                    		add	dx, cx
  1863 0000191E 92                      		xchg	ax, dx
  1864 0000191F A3[0003]                		mov	[DAYCNT], ax
  1865 00001922 56                      		push	si
  1866 00001923 53                      		push	bx
  1867 00001924 50                      		push	ax
  1868 00001925 BB[5803]                		mov	bx, TIMEBUF
  1869 00001928 B90600                  		mov	cx, 6
  1870 0000192B 31D2                    		xor	dx, dx
  1871 0000192D 89D0                    		mov	ax, dx
  1872 0000192F 53                      		push	bx
  1873 00001930 E8F334                  		call	SETREAD
  1874 00001933 1E                      		push	ds
  1875 00001934 C536[2E00]              		lds	si, [BCLOCK]
  1876 00001938 E8C734                  		call	DEVIOCALL2
  1877 0000193B 1F                      		pop	ds
  1878 0000193C 5B                      		pop	bx
  1879 0000193D E81935                  		call	SETWRITE
  1880 00001940 8F06[5803]              		pop	word [TIMEBUF]
  1881 00001944 1E                      		push	ds
  1882 00001945 C536[2E00]              		lds	si, [BCLOCK]
  1883 00001949 E8B634                  		call	DEVIOCALL2
  1884 0000194C 1F                      		pop	ds
  1885 0000194D 5B                      		pop	bx
  1886 0000194E 5E                      		pop	si
  1887                                  WKDAY:
  1888 0000194F A1[0003]                		mov	ax, [DAYCNT]
  1889 00001952 31D2                    		xor	dx, dx
  1890 00001954 B90700                  		mov	cx, 7
  1891 00001957 40                      		inc	ax
  1892 00001958 40                      		inc	ax
  1893 00001959 F7F1                    		div	cx
  1894 0000195B 8816[0203]              		mov	[WEEKDAY], dl
  1895 0000195F 30C0                    		xor	al, al
  1896                                  RET25:
  1897 00001961 C3                      		retn
  1898                                  
  1899                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1900                                  
  1901                                  		; 07/09/2022
  1902                                  DSUM:
  1903 00001962 B400                    		mov	ah, 0
  1904 00001964 E3FB                    		jcxz	RET25
  1905                                  DSUM1:
  1906 00001966 AC                      		lodsb
  1907 00001967 01C2                    		add	dx, ax
  1908 00001969 E2FB                    		loop	DSUM1
  1909 0000196B C3                      		retn
  1910                                  
  1911                                  ; ---------------------------------------------------------------------------
  1912                                  
  1913                                  		; 07/09/2022
  1914                                  _$GET_VERSION:
  1915 0000196C 16                      		push	ss
  1916 0000196D 1F                      		pop	ds
  1917 0000196E 8B1E[5403]              		mov	bx, word [USERNUM+2]
  1918 00001972 8B0E[5203]              		mov	cx, [USERNUM]
  1919 00001976 A1[780C]                		mov	ax, word [MSVERS]
  1920 00001979 E817FC                  		call	Get_User_Stack
  1921 0000197C 895C02                  		mov	[si+2],	bx
  1922 0000197F 894C04                  		mov	[si+4],	cx
  1923 00001982 8904                    		mov	[si], ax
  1924 00001984 C3                      		retn
  1925                                  
  1926                                  ; ---------------------------------------------------------------------------
  1927                                  
  1928                                  		; 07/09/2022
  1929                                  _$GET_VERIFY_ON_WRITE:
  1930 00001985 36A0[AD02]              		mov	al, [ss:VERFLG]
  1931 00001989 C3                      		retn
  1932                                  
  1933                                  ; ---------------------------------------------------------------------------
  1934                                  
  1935                                  _$SET_VERIFY_ON_WRITE:
  1936 0000198A 2401                    		and	al, 1
  1937 0000198C 36A2[AD02]              		mov	[ss:VERFLG], al
  1938                                  RET27:
  1939 00001990 C3                      		retn
  1940                                  
  1941                                  ; ---------------------------------------------------------------------------
  1942                                  
  1943                                  		; 07/09/2022
  1944                                  _$INTERNATIONAL:
  1945 00001991 3CFF                    		cmp	al, 0FFh
  1946 00001993 7404                    		jz	short BX_HAS_CODE
  1947 00001995 88C3                    		mov	bl, al
  1948 00001997 30FF                    		xor	bh, bh
  1949                                  BX_HAS_CODE:
  1950 00001999 1E                      		push	ds
  1951 0000199A 07                      		pop	es
  1952 0000199B 52                      		push	dx
  1953 0000199C 5F                      		pop	di
  1954 0000199D 16                      		push	ss
  1955 0000199E 1F                      		pop	ds
  1956 0000199F 83FFFF                  		cmp	di, -1
  1957 000019A2 7461                    		jz	short international_set
  1958 000019A4 09DB                    		or	bx, bx
  1959 000019A6 7505                    		jnz	short international_find
  1960 000019A8 BE[B10F]                		mov	si, COUNTRY_CDPG
  1961 000019AB EB42                    		jmp	short international_copy
  1962                                  
  1963                                  ; ---------------------------------------------------------------------------
  1964                                  
  1965                                  		; 07/09/2022
  1966                                  international_find:
  1967 000019AD BD0000                  		mov	bp, 0
  1968 000019B0 E80B00                  		call	international_get
  1969 000019B3 7258                    		jb	short errtn
  1970 000019B5 83FB00                  		cmp	bx, 0
  1971 000019B8 7535                    		jnz	short international_copy
  1972 000019BA 89D3                    		mov	bx, dx
  1973 000019BC EB3C                    		jmp	short international_ok3
  1974                                  
  1975                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  1976                                  
  1977                                  		; 07/09/2022
  1978                                  international_get:
  1979 000019BE BE[B10F]                		mov	si, COUNTRY_CDPG
  1980 000019C1 3B5C63                  		cmp	bx, [si+63h]
  1981 000019C4 74CA                    		jz	short RET27
  1982 000019C6 89DA                    		mov	dx, bx
  1983 000019C8 31DB                    		xor	bx, bx
  1984 000019CA B80014                  		mov	ax, 1400h
  1985 000019CD CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - INSTALLATION CHECK
  1986                                  					; Return: AL = 00h not installed, OK to	install
  1987                                  					; 01h not installed, not OK
  1988                                  					; FFh installed
  1989 000019CF 3CFF                    		cmp	al, 0FFh
  1990 000019D1 7518                    		jnz	short interr
  1991 000019D3 83FD00                  		cmp	bp, 0
  1992 000019D6 7508                    		jnz	short stcdpg
  1993 000019D8 B80414                  		mov	ax, 1404h
  1994 000019DB CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - GET COUNTRY INFO
  1995                                  					; BX = code page, DX = country code, [SI -> internal code page structure
  1996                                  					; ES:DI	-> user	buffer
  1997                                  					; Return: AL = status
  1998 000019DD EB06                    		jmp	short chkok
  1999                                  
  2000 000019DF 90                      		nop
  2001                                  stcdpg:
  2002 000019E0 B80314                  		mov	ax, 1403h
  2003 000019E3 CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - SET COUNTRY INFO
  2004                                  					; DS:SI	-> internal code page structure
  2005                                  					; BX = code page, DX = country code
  2006                                  					; Return: AL = status
  2007                                  chkok:
  2008 000019E5 3C00                    		cmp	al, 0
  2009 000019E7 74A7                    		jz	short RET27
  2010                                  setcarry:
  2011 000019E9 F9                      		stc
  2012 000019EA C3                      		retn
  2013                                  interr:
  2014 000019EB B0FF                    		mov	al, 0FFh
  2015 000019ED EBFA                    		jmp	short setcarry
  2016                                  
  2017                                  ; ---------------------------------------------------------------------------
  2018                                  
  2019                                  		; 07/09/2022
  2020                                  international_copy:
  2021 000019EF 8B5C63                  		mov	bx, [si+63h]
  2022 000019F2 BE[1810]                		mov	si, CDPG_ccDFormat
  2023 000019F5 B91800                  		mov	cx, 24
  2024 000019F8 F3A4                    		rep movsb
  2025                                  
  2026                                  international_ok3:
  2027 000019FA E896FB                  		call	Get_User_Stack
  2028 000019FD 895C02                  		mov	[si+2],	bx
  2029                                  
  2030                                  international_ok:
  2031 00001A00 89D8                    		mov	ax, bx
  2032                                  
  2033                                  international_okj:
  2034 00001A02 E961FC                  		jmp	SYS_RET_OK
  2035                                  
  2036                                  ; ---------------------------------------------------------------------------
  2037                                  
  2038                                  		; 07/09/2022
  2039                                  international_set:
  2040 00001A05 BD0100                  		mov	bp, 1
  2041 00001A08 E8B3FF                  		call	international_get
  2042 00001A0B 73F3                    		jnb	short international_ok
  2043                                  errtn:
  2044 00001A0D 3CFF                    		cmp	al, 0FFh
  2045 00001A0F 7403                    		jz	short errtn2
  2046                                  errtn1:
  2047 00001A11 E95EFC                  		jmp	SYS_Ret_Err
  2048                                  errtn2:
  2049 00001A14 B001                    		mov	al, 1
  2050                                  errtn3:
  2051 00001A16 EBF9                    		jmp	short errtn1
  2052                                  
  2053                                  ; ---------------------------------------------------------------------------
  2054                                  
  2055                                  		; 07/09/2022
  2056                                  _$GetExtCntry:
  2057 00001A18 83F905                  		cmp	cx, 5
  2058 00001A1B 7277                    		jb	short sizeerror
  2059 00001A1D 16                      		push	ss
  2060 00001A1E 1F                      		pop	ds
  2061 00001A1F BE[B10F]                		mov	si, COUNTRY_CDPG
  2062 00001A22 83FAFF                  		cmp	dx, -1
  2063 00001A25 7503                    		jnz	short GETCDPG
  2064 00001A27 8B5463                  		mov	dx, [si+63h]
  2065                                  GETCDPG:
  2066 00001A2A 83FBFF                  		cmp	bx, -1
  2067 00001A2D 7503                    		jnz	short CHKAGAIN
  2068 00001A2F 8B5C65                  		mov	bx, [si+65h]
  2069                                  CHKAGAIN:
  2070 00001A32 3B5463                  		cmp	dx, [si+63h]
  2071 00001A35 7550                    		jnz	short CHKNLS
  2072 00001A37 3B5C65                  		cmp	bx, [si+65h]
  2073 00001A3A 754B                    		jnz	short CHKNLS
  2074 00001A3C 8B5C48                  		mov	bx, [si+48h]
  2075 00001A3F 51                      		push	cx
  2076 00001A40 8B4C4A                  		mov	cx, [si+4Ah]
  2077 00001A43 BE[FD0F]                		mov	si, CDPG_ccSetUcase
  2078                                  NXTENTRY:
  2079 00001A46 3A04                    		cmp	al, [si]
  2080 00001A48 740A                    		jz	short FOUNDIT
  2081 00001A4A 83C605                  		add	si, 5
  2082 00001A4D E2F7                    		loop	NXTENTRY
  2083 00001A4F 59                      		pop	cx
  2084                                  capinval:
  2085 00001A50 B001                    		mov	al, 1
  2086                                  capinvalj:
  2087 00001A52 EBC2                    		jmp	short errtn3
  2088                                  FOUNDIT:
  2089 00001A54 A4                      		movsb
  2090 00001A55 59                      		pop	cx
  2091 00001A56 3C01                    		cmp	al, 1
  2092 00001A58 7414                    		jz	short setsize
  2093 00001A5A B90400                  		mov	cx, 4
  2094 00001A5D B80500                  		mov	ax, 5
  2095                                  OK_RETN:
  2096 00001A60 F3A4                    		rep movsb
  2097 00001A62 89C1                    		mov	cx, ax
  2098 00001A64 89D8                    		mov	ax, bx
  2099                                  GETDONE:
  2100 00001A66 E82AFB                  		call	Get_User_Stack
  2101 00001A69 894C04                  		mov	[si+4],	cx
  2102                                  GETDONE_J:
  2103 00001A6C EB94                    		jmp	short international_okj
  2104                                  setsize:
  2105 00001A6E 83E903                  		sub	cx, 3
  2106 00001A71 390C                    		cmp	[si], cx
  2107 00001A73 7302                    		jnb	short setsize2
  2108 00001A75 8B0C                    		mov	cx, [si]
  2109                                  setsize2:
  2110 00001A77 26890D                  		mov	[es:di], cx
  2111 00001A7A 83C702                  		add	di, 2
  2112 00001A7D 83C602                  		add	si, 2
  2113 00001A80 89C8                    		mov	ax, cx
  2114 00001A82 83C003                  		add	ax, 3
  2115 00001A85 EBD9                    		jmp	short OK_RETN
  2116                                  
  2117                                  ; ---------------------------------------------------------------------------
  2118                                  
  2119                                  		; 07/09/2022
  2120                                  CHKNLS:
  2121 00001A87 30E4                    		xor	ah, ah
  2122 00001A89 50                      		push	ax
  2123 00001A8A 5D                      		pop	bp
  2124 00001A8B B80014                  		mov	ax, 1400h
  2125 00001A8E CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - INSTALLATION CHECK
  2126                                  					; Return: AL = 00h not installed, OK to	install
  2127                                  					; 01h not installed, not OK
  2128                                  					; FFh installed
  2129 00001A90 3CFF                    		cmp	al, 0FFh
  2130 00001A92 7404                    		jz	short NLSNXT
  2131                                  sizeerror:
  2132 00001A94 B001                    		mov	al, 1
  2133                                  sizerrorj:
  2134 00001A96 EBBA                    		jmp	short capinvalj
  2135                                  NLSNXT:
  2136 00001A98 B80214                  		mov	ax, 1402h
  2137 00001A9B CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - GET COUNTRY INFO
  2138                                  					; BP = subfunction, BX = code page
  2139                                  					; DX = country code, [SI -> internal code page structure
  2140                                  					; ES:DI	-> user	buffer,	CX = size of user buffer
  2141                                  					; Return: AL = status
  2142                                  					; 00h successful
  2143                                  					; else DOS error code
  2144 00001A9D 3C00                    		cmp	al, 0
  2145 00001A9F 7505                    		jnz	short NLSERROR
  2146 00001AA1 8B4448                  		mov	ax, [si+48h]
  2147 00001AA4 EBC0                    		jmp	short GETDONE
  2148                                  NLSERROR:
  2149 00001AA6 EBEE                    		jmp	short sizerrorj
  2150                                  
  2151                                  ; ---------------------------------------------------------------------------
  2152                                  
  2153                                  		; 07/09/2022
  2154                                  _$GetSetCdPg:
  2155 00001AA8 16                      		push	ss
  2156 00001AA9 1F                      		pop	ds
  2157 00001AAA BE[B10F]                		mov	si, COUNTRY_CDPG
  2158 00001AAD 3C01                    		cmp	al, 1
  2159 00001AAF 7511                    		jnz	short setglpg
  2160 00001AB1 8B5C65                  		mov	bx, [si+65h]
  2161 00001AB4 8B5448                  		mov	dx, [si+48h]
  2162 00001AB7 E8D9FA                  		call	Get_User_Stack
  2163 00001ABA 895C02                  		mov	[si+2],	bx
  2164 00001ABD 895406                  		mov	[si+6],	dx
  2165                                  OK_RETURN:
  2166 00001AC0 EBAA                    		jmp	short GETDONE_J
  2167                                  setglpg:
  2168 00001AC2 3C02                    		cmp	al, 2
  2169 00001AC4 7533                    		jnz	short nomem
  2170 00001AC6 8B5463                  		mov	dx, [si+63h]
  2171 00001AC9 B80014                  		mov	ax, 1400h
  2172 00001ACC CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - INSTALLATION CHECK
  2173                                  					; Return: AL = 00h not installed, OK to	install
  2174                                  					; 01h not installed, not OK
  2175                                  					; FFh installed
  2176 00001ACE 3CFF                    		cmp	al, 0FFh
  2177 00001AD0 7527                    		jnz	short nomem
  2178 00001AD2 B80114                  		mov	ax, 1401h
  2179 00001AD5 CD2F                    		int	2Fh		; - Multiplex -	NLSFUNC.COM - CHANGE CODE PAGE
  2180                                  					; DS:SI	-> internal code page structure
  2181                                  					; BX = new code	page, DX = country code???
  2182                                  					; Return: AL = status
  2183                                  					; 00h successful
  2184                                  					; else DOS error code
  2185 00001AD7 3C00                    		cmp	al, 0
  2186 00001AD9 74E5                    		jz	short OK_RETURN
  2187 00001ADB 3C41                    		cmp	al, 65
  2188 00001ADD 7518                    		jnz	short seterr
  2189 00001ADF B84100                  		mov	ax, 65
  2190 00001AE2 A3[D202]                		mov	[EXTERR], ax
  2191 00001AE5 C606[D402]06            		mov	byte [EXTERR_ACTION], 6
  2192 00001AEA C606[D502]05            		mov	byte [EXTERR_CLASS], 5
  2193 00001AEF C606[D102]04            		mov	byte [EXTERR_LOCUS], 4
  2194 00001AF4 E983FB                  		jmp	From_GetSet
  2195                                  seterr:	
  2196 00001AF7 EBAD                    		jmp	short NLSERROR
  2197                                  nomem:
  2198 00001AF9 B001                    		mov	al, 1
  2199 00001AFB EBFA                    		jmp	short seterr
  2200                                  
  2201                                  ; ---------------------------------------------------------------------------
  2202                                  
  2203                                  		; 07/09/2022
  2204                                  _$GET_DRIVE_FREESPACE:
  2205 00001AFD 16                      		push	ss
  2206 00001AFE 1F                      		pop	ds
  2207 00001AFF 88D0                    		mov	al, dl
  2208 00001B01 E84B4D                  		call	GetThisDrv
  2209                                  SET_AX_RET:
  2210 00001B04 7218                    		jb	short BADFDRV
  2211 00001B06 E8BB1C                  		call	DISK_INFO
  2212 00001B09 87D3                    		xchg	dx, bx
  2213 00001B0B 72F7                    		jb	short SET_AX_RET
  2214 00001B0D 30E4                    		xor	ah, ah
  2215                                  DoSt:
  2216 00001B0F E881FA                  		call	Get_User_Stack
  2217 00001B12 895406                  		mov	[si+6],	dx
  2218 00001B15 894C04                  		mov	[si+4],	cx
  2219 00001B18 895C02                  		mov	[si+2],	bx
  2220 00001B1B 8904                    		mov	[si], ax
  2221 00001B1D C3                      		retn
  2222                                  BADFDRV:
  2223 00001B1E B00F                    		mov	al, 0Fh
  2224 00001B20 E866FB                  		call	FCB_Ret_Err
  2225 00001B23 B8FFFF                  		mov	ax, -1
  2226 00001B26 EBE7                    		jmp	short DoSt
  2227                                  
  2228                                  ; ---------------------------------------------------------------------------
  2229                                  
  2230                                  		; 07/09/2022
  2231                                  _$GET_DMA:
  2232 00001B28 368B1E[DA02]            		mov	bx, [ss:DMAADD]
  2233 00001B2D 368B0E[DC02]            		mov	cx, [ss:DMAADD+2]
  2234 00001B32 E85EFA                  		call	Get_User_Stack
  2235 00001B35 895C02                  		mov	[si+2],	bx
  2236 00001B38 894C10                  		mov	[si+10h], cx
  2237 00001B3B C3                      		retn
  2238                                  
  2239                                  ; ---------------------------------------------------------------------------
  2240                                  
  2241                                  		; 07/09/2022
  2242                                  _$SET_DMA:
  2243 00001B3C 368916[DA02]            		mov	[ss:DMAADD], dx
  2244 00001B41 368C1E[DC02]            		mov	[ss:DMAADD+2], ds
  2245 00001B46 C3                      		retn
  2246                                  
  2247                                  ; ---------------------------------------------------------------------------
  2248                                  
  2249                                  		; 07/09/2022
  2250                                  _$GET_DEFAULT_DRIVE:
  2251 00001B47 36A0[E402]              		mov	al, [ss:CURDRV]
  2252 00001B4B C3                      		retn
  2253                                  
  2254                                  ; ---------------------------------------------------------------------------
  2255                                  
  2256                                  		; 07/09/2022
  2257                                  _$SET_DEFAULT_DRIVE:
  2258 00001B4C 88D0                    		mov	al, dl
  2259 00001B4E FEC0                    		inc	al
  2260 00001B50 E8E54C                  		call	GETVISDRV
  2261 00001B53 7204                    		jb	short SETRET
  2262 00001B55 36A2[E402]              		mov	[ss:CURDRV], al
  2263                                  SETRET:
  2264 00001B59 36A0[4700]              		mov	al, [ss:CDSCOUNT]
  2265 00001B5D C3                      		retn
  2266                                  
  2267                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2268                                  
  2269                                  		; 07/09/2022
  2270                                  _$GET_INTERRUPT_VECTOR:
  2271 00001B5E E81A00                  		call	RECSET
  2272 00001B61 26C41F                  		les	bx, [es:bx]
  2273 00001B64 E82CFA                  		call	Get_User_Stack
  2274 00001B67 895C02                  		mov	[si+2],	bx
  2275 00001B6A 8C4410                  		mov	word [si+10h], es
  2276 00001B6D C3                      		retn
  2277                                  
  2278                                  ; ---------------------------------------------------------------------------
  2279                                  
  2280                                  		; 07/09/2022
  2281                                  _$SET_INTERRUPT_VECTOR:
  2282 00001B6E E80A00                  		call	RECSET
  2283 00001B71 FA                      		cli
  2284 00001B72 268917                  		mov	[es:bx], dx
  2285 00001B75 268C5F02                		mov	word [es:bx+2], ds
  2286 00001B79 FB                      		sti
  2287 00001B7A C3                      		retn
  2288                                  
  2289                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2290                                  
  2291                                  		; 07/09/2022
  2292                                  RECSET:
  2293 00001B7B 31DB                    		xor	bx, bx
  2294 00001B7D 8EC3                    		mov	es, bx
  2295 00001B7F 88C3                    		mov	bl, al
  2296 00001B81 D1E3                    		shl	bx, 1
  2297 00001B83 D1E3                    		shl	bx, 1
  2298 00001B85 C3                      		retn
  2299                                  
  2300                                  ; ---------------------------------------------------------------------------
  2301                                  
  2302                                  		; 07/09/2022
  2303                                  _$CHAR_OPER:
  2304 00001B86 16                      		push	ss
  2305 00001B87 1F                      		pop	ds
  2306 00001B88 3C01                    		cmp	al, 1
  2307 00001B8A 720B                    		jb	short chop_1
  2308 00001B8C 740F                    		jz	short chop_2
  2309 00001B8E 3C03                    		cmp	al, 3
  2310 00001B90 7210                    		jb	short chop_3
  2311 00001B92 7416                    		jz	short chop_5
  2312 00001B94 B0FF                    		mov	al, 0FFh
  2313 00001B96 C3                      		retn
  2314                                  chop_1:
  2315 00001B97 8A16[AF02]              		mov	dl, [chSwitch]
  2316 00001B9B EB07                    		jmp	short chop_4
  2317                                  chop_2:
  2318 00001B9D 8816[AF02]              		mov	[chSwitch], dl
  2319 00001BA1 C3                      		retn
  2320                                  chop_3:
  2321 00001BA2 B2FF                    		mov	dl, 0FFh
  2322                                  chop_4:
  2323 00001BA4 E8ECF9                  		call	Get_User_Stack
  2324 00001BA7 895406                  		mov	[si+6],	dx
  2325                                  chop_5:
  2326 00001BAA C3                      		retn
  2327                                  
  2328                                  ; ---------------------------------------------------------------------------
  2329                                  
  2330                                  		; 07/09/2022
  2331                                  _$GetExtendedError:
  2332 00001BAB 16                      		push	ss
  2333 00001BAC 1F                      		pop	ds
  2334 00001BAD A1[D202]                		mov	ax, [EXTERR]
  2335 00001BB0 C43E[D602]              		les	di, [EXTERRPT]
  2336 00001BB4 8B1E[D402]              		mov	bx, word [EXTERR_ACTION]
  2337 00001BB8 8A2E[D102]              		mov	ch, [EXTERR_LOCUS]
  2338 00001BBC E8D4F9                  		call	Get_User_Stack
  2339 00001BBF 897C0A                  		mov	[si+0Ah], di
  2340 00001BC2 8C4410                  		mov	word [si+10h], es
  2341 00001BC5 895C02                  		mov	[si+2],	bx
  2342 00001BC8 894C04                  		mov	[si+4],	cx
  2343 00001BCB E998FA                  		jmp	SYS_RET_OK
  2344                                  
  2345                                  ; ---------------------------------------------------------------------------
  2346                                  
  2347                                  		; 07/09/2022
  2348                                  _$PARSE_FILE_DESCRIPTOR:
  2349 00001BCE E86138                  		call	MAKEFCB
  2350 00001BD1 56                      		push	si
  2351 00001BD2 E8BEF9                  		call	Get_User_Stack
  2352 00001BD5 8F4408                  		pop	word [si+8]
  2353 00001BD8 C3                      		retn
  2354                                  
  2355                                  ; ---------------------------------------------------------------------------
  2356                                  
  2357                                  		; 07/09/2022
  2358                                  _$SLEAZEFUNC:
  2359 00001BD9 B200                    		mov	dl, 0
  2360                                  _$SLEAZEFUNCDL:
  2361 00001BDB 16                      		push	ss
  2362 00001BDC 1F                      		pop	ds
  2363 00001BDD 88D0                    		mov	al, dl
  2364 00001BDF E86D4C                  		call	GetThisDrv
  2365                                  SET_AL_RET:
  2366 00001BE2 B00F                    		mov	al, 0Fh
  2367 00001BE4 721E                    		jb	short BADSLDRIVE
  2368 00001BE6 E8DB1B                  		call	DISK_INFO
  2369 00001BE9 72F7                    		jb	short SET_AL_RET
  2370 00001BEB 8826[3005]              		mov	byte [FATBYTE], ah
  2371 00001BEF BF[3005]                		mov	di, FATBYTE
  2372 00001BF2 30E4                    		xor	ah, ah
  2373 00001BF4 E89CF9                  		call	Get_User_Stack
  2374 00001BF7 894C04                  		mov	[si+4],	cx
  2375 00001BFA 895C06                  		mov	[si+6],	bx
  2376 00001BFD 897C02                  		mov	[si+2],	di
  2377 00001C00 8C4C0E                  		mov	word [si+0Eh], cs
  2378 00001C03 C3                      		retn
  2379                                  
  2380                                  BADSLDRIVE:
  2381 00001C04 E982FA                  		jmp	FCB_Ret_Err
  2382                                  
  2383                                  ; ---------------------------------------------------------------------------
  2384                                  
  2385                                  		; 07/09/2022
  2386                                  _$GET_INDOS_FLAG:
  2387 00001C07 E889F9                  		call	Get_User_Stack
  2388 00001C0A C74402[CF02]            		mov	word [si+2], INDOS
  2389 00001C0F 8C5410                  		mov	word [si+10h], ss
  2390 00001C12 C3                      		retn
  2391                                  
  2392                                  ; ---------------------------------------------------------------------------
  2393                                  
  2394                                  		; 07/09/2022
  2395                                  _$GET_IN_VARS:
  2396 00001C13 E87DF9                  		call	Get_User_Stack
  2397 00001C16 C74402[2600]            		mov	word [si+2], DPBHEAD
  2398 00001C1B 8C5410                  		mov	word [si+10h], ss
  2399 00001C1E C3                      		retn
  2400                                  
  2401                                  ; ---------------------------------------------------------------------------
  2402                                  
  2403                                  		; 07/09/2022
  2404                                  _$GET_DEFAULT_DPB:
  2405 00001C1F B200                    		mov	dl, 0
  2406                                  _$GET_DPB:
  2407 00001C21 16                      		push	ss
  2408 00001C22 1F                      		pop	ds
  2409 00001C23 88D0                    		mov	al, dl
  2410 00001C25 E8274C                  		call	GetThisDrv
  2411 00001C28 7223                    		jb	short ISNODRV
  2412 00001C2A C43E[3A05]              		les	di, [THISCDS]
  2413 00001C2E 26F745430080            		test	word [es:di+43h], 8000h
  2414 00001C34 7517                    		jnz	short ISNODRV
  2415 00001C36 E8FC02                  		call	EcritDisk
  2416 00001C39 E8843E                  		call	FatRead_CDS
  2417 00001C3C E8FE02                  		call	LcritDisk
  2418 00001C3F 720C                    		jb	short ISNODRV
  2419 00001C41 E84FF9                  		call	Get_User_Stack
  2420 00001C44 896C02                  		mov	[si+2],	bp
  2421 00001C47 8C440E                  		mov	word [si+0Eh], es
  2422 00001C4A 30C0                    		xor	al, al
  2423 00001C4C C3                      		retn
  2424                                  ISNODRV:
  2425 00001C4D B0FF                    		mov	al, -1
  2426 00001C4F C3                      		retn
  2427                                  ; ---------------------------------------------------------------------------
  2428                                  
  2429                                  		; 07/09/2022
  2430                                  _$DISK_RESET:
  2431 00001C50 16                      		push	ss
  2432 00001C51 1F                      		pop	ds
  2433 00001C52 B0FF                    		mov	al, -1
  2434 00001C54 E8DE02                  		call	EcritDisk
  2435 00001C57 E8E341                  		call	FLUSHBUF
  2436 00001C5A BBFFFF                  		mov	bx, -1
  2437 00001C5D 891E[2000]              		mov	word [LastBuffer+2], bx
  2438 00001C61 891E[1E00]              		mov	word [LastBuffer], bx
  2439 00001C65 C536[3800]              		lds	si, [BUFFHEAD]
  2440 00001C69 B8FF20                  		mov	ax, 20FFh
  2441                                  DRST_1:
  2442 00001C6C 894404                  		mov	[si+4],	ax
  2443 00001C6F C534                    		lds	si, [si]
  2444 00001C71 39DE                    		cmp	si, bx
  2445 00001C73 7409                    		jz	short DRST_2
  2446 00001C75 894404                  		mov	[si+4],	ax
  2447 00001C78 C534                    		lds	si, [si]
  2448 00001C7A 39DE                    		cmp	si, bx
  2449 00001C7C 75EE                    		jnz	short DRST_1
  2450                                  DRST_2:
  2451 00001C7E E8BC02                  		call	LcritDisk
  2452 00001C81 B8FFFF                  		mov	ax, -1
  2453 00001C84 B82011                  		mov	ax, 1120h
  2454 00001C87 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - FLUSH ALL DISK BUFFERS
  2455                                  					; DS = DOS CS
  2456                                  					; Return: CF clear (successful)
  2457 00001C89 C3                      		retn
  2458                                  
  2459                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2460                                  
  2461                                  		; 07/09/2022
  2462                                  _$SETDPB:
  2463 00001C8A 89EF                    		mov	di, bp
  2464 00001C8C 83C702                  		add	di, 2
  2465 00001C8F AD                      		lodsw
  2466 00001C90 AB                      		stosw
  2467 00001C91 89C2                    		mov	dx, ax
  2468 00001C93 AC                      		lodsb
  2469 00001C94 FEC8                    		dec	al
  2470 00001C96 AA                      		stosb
  2471 00001C97 FEC0                    		inc	al
  2472 00001C99 30E4                    		xor	ah, ah
  2473                                  LOG2LOOP:
  2474 00001C9B A801                    		test	al, 1
  2475 00001C9D 7506                    		jnz	short SAVLOG
  2476 00001C9F FEC4                    		inc	ah
  2477 00001CA1 D0E8                    		shr	al, 1
  2478 00001CA3 EBF6                    		jmp	short LOG2LOOP
  2479                                  SAVLOG:
  2480 00001CA5 88E0                    		mov	al, ah
  2481 00001CA7 AA                      		stosb
  2482 00001CA8 88C3                    		mov	bl, al
  2483 00001CAA A5                      		movsw
  2484 00001CAB AC                      		lodsb
  2485 00001CAC AA                      		stosb
  2486 00001CAD 88C7                    		mov	bh, al
  2487 00001CAF AD                      		lodsw
  2488 00001CB0 AB                      		stosw
  2489 00001CB1 B105                    		mov	cl, 5
  2490 00001CB3 D3EA                    		shr	dx, cl
  2491 00001CB5 48                      		dec	ax
  2492 00001CB6 01D0                    		add	ax, dx
  2493 00001CB8 89D1                    		mov	cx, dx
  2494 00001CBA 31D2                    		xor	dx, dx
  2495 00001CBC F7F1                    		div	cx
  2496 00001CBE 89C1                    		mov	cx, ax
  2497 00001CC0 47                      		inc	di
  2498 00001CC1 47                      		inc	di
  2499 00001CC2 A5                      		movsw
  2500 00001CC3 AC                      		lodsb
  2501 00001CC4 26884616                		mov	[es:bp+16h], al
  2502 00001CC8 AD                      		lodsw
  2503 00001CC9 AA                      		stosb
  2504 00001CCA F6E7                    		mul	bh
  2505 00001CCC 26034606                		add	ax, [es:bp+6]
  2506 00001CD0 AB                      		stosw
  2507 00001CD1 01C8                    		add	ax, cx
  2508 00001CD3 2689460B                		mov	[es:bp+0Bh], ax
  2509 00001CD7 262B460D                		sub	ax, [es:bp+0Dh]
  2510 00001CDB F7D8                    		neg	ax
  2511 00001CDD 88D9                    		mov	cl, bl
  2512 00001CDF D3E8                    		shr	ax, cl
  2513 00001CE1 40                      		inc	ax
  2514 00001CE2 2689460D                		mov	[es:bp+0Dh], ax
  2515 00001CE6 26C7461C0000            		mov	word [es:bp+1Ch], 0
  2516 00001CEC 26C7461EFFFF            		mov	word [es:bp+1Eh], -1
  2517 00001CF2 C3                      		retn
  2518                                  
  2519                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2520                                  
  2521                                  		; 07/09/2022
  2522                                  _$DUP_PDB:
  2523 00001CF3 2EC606[5003]FF          		mov	byte [cs:CreatePDB], 0FFh
  2524 00001CF9 2E8E1E[DE02]            		mov	ds, [cs:CurrentPDB]
  2525 00001CFE 56                      		push	si
  2526 00001CFF EB0A                    		jmp	short CreateCopy
  2527                                  
  2528                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2529                                  
  2530                                  		; 07/09/2022 
  2531                                  _$CREATE_PROCESS_DATA_BLOCK:
  2532 00001D01 E88FF8                  		call	Get_User_Stack
  2533 00001D04 8E5C14                  		mov	ds, word [si+14h]
  2534 00001D07 FF36[0200]              		push	word [START+2]
  2535                                  CreateCopy:
  2536 00001D0B 8EC2                    		mov	es, dx
  2537 00001D0D 31F6                    		xor	si, si
  2538 00001D0F 89F7                    		mov	di, si
  2539 00001D11 B98000                  		mov	cx, 80h
  2540 00001D14 F3A5                    		rep movsw
  2541 00001D16 B91400                  		mov	cx, 20
  2542 00001D19 BF1800                  		mov	di, 18h
  2543 00001D1C 1E                      		push	ds
  2544 00001D1D C536[3400]              		lds	si, [BCON+2]
  2545 00001D21 F3A4                    		rep movsb
  2546 00001D23 1F                      		pop	ds
  2547 00001D24 2EF606[5003]FF          		test	byte [cs:CreatePDB], 0FFh
  2548 00001D2A 744B                    		jz	short Create_PDB_cont
  2549 00001D2C 0E                      		push	cs
  2550 00001D2D 1F                      		pop	ds
  2551 00001D2E 31DB                    		xor	bx, bx
  2552 00001D30 B91400                  		mov	cx, 20
  2553                                  Create_dup_jfn:
  2554 00001D33 06                      		push	es
  2555 00001D34 E88F49                  		call	SFFromHandle
  2556 00001D37 B0FF                    		mov	al, -1
  2557 00001D39 7225                    		jb	short CreateStash
  2558 00001D3B 26F745050010            		test	word [es:di+5], 1000h
  2559 00001D41 751D                    		jnz	short CreateStash
  2560 00001D43 268A6502                		mov	ah, [es:di+2]
  2561 00001D47 80E4F0                  		and	ah, 0F0h
  2562 00001D4A 80FC70                  		cmp	ah, 70h
  2563 00001D4D 7411                    		jz	short CreateStash
  2564 00001D4F 893E[3605]              		mov	word [THISSFT], di
  2565 00001D53 8C06[3805]              		mov	word [THISSFT+2], es
  2566 00001D57 E87718                  		call	DOS_DUP
  2567 00001D5A E85049                  		call	pJFNFromHandle
  2568 00001D5D 268A05                  		mov	al, [es:di]
  2569                                  CreateStash:
  2570 00001D60 07                      		pop	es
  2571 00001D61 26884718                		mov	[es:bx+18h], al
  2572 00001D65 43                      		inc	bx
  2573 00001D66 E2CB                    		loop	Create_dup_jfn
  2574 00001D68 8B1E[DE02]              		mov	bx, [CurrentPDB]
  2575 00001D6C 26891E[1600]            		mov	[es:OEM_HANDLER+2], bx
  2576 00001D71 8C06[DE02]              		mov	[CurrentPDB], es
  2577 00001D75 8EDB                    		mov	ds, bx
  2578                                  Create_PDB_cont:
  2579 00001D77 2EC606[5003]00          		mov	byte [cs:CreatePDB], 0
  2580 00001D7D 58                      		pop	ax
  2581                                  
  2582                                  ; ---------------------------------------------------------------------------
  2583                                  
  2584                                  		; 09/09/2022
  2585                                  		; 07/09/2022 
  2586                                  setmem:
  2587 00001D7E 31C9                    		xor	cx, cx
  2588 00001D80 8ED9                    		mov	ds, cx
  2589 00001D82 8EC2                    		mov	es, dx
  2590 00001D84 BE8800                  		mov	si, 88h
  2591 00001D87 BF0A00                  		mov	di, 10
  2592 00001D8A B90600                  		mov	cx, 6
  2593 00001D8D F3A5                    		rep movsw
  2594 00001D8F 26A3[0200]              		mov	word [es:START+2], ax
  2595 00001D93 29D0                    		sub	ax, dx
  2596 00001D95 3DFF0F                  		cmp	ax, 0FFFh
  2597 00001D98 7603                    		jbe	short HAVDIF
  2598 00001D9A B8FF0F                  		mov	ax, 0FFFh
  2599                                  HAVDIF:
  2600 00001D9D 83E810                  		sub	ax, 10h
  2601 00001DA0 BB0C00                  		mov	bx, 0Ch
  2602 00001DA3 29C3                    		sub	bx, ax
  2603 00001DA5 B104                    		mov	cl, 4
  2604 00001DA7 D3E0                    		shl	ax, cl
  2605 00001DA9 8EDA                    		mov	ds, dx
  2606 00001DAB A30600                  		mov	word [PDB_CPM_CALL+1], ax
  2607 00001DAE 891E0800                		mov	word [PDB_CPM_CALL+3], bx
  2608 00001DB2 C706[0000]CD20          		mov	word [START], 20CDh
  2609 00001DB8 C60605009A              		mov	byte [PDB_CPM_CALL], 9Ah
  2610 00001DBD C7065000CD21            		mov	word [PDB_CALL_SYSTEM], 21CDh  ; 09/09/2022
  2611 00001DC3 C6065200CB              		mov	byte [PDB_CALL_SYSTEM+2], 0CBh ; "NUL	    "
  2612 00001DC8 C706[3400][1800]        		mov	word [BCON+2], LeaveAddr
  2613 00001DCE 8C1E[3600]              		mov	[MAXSEC], ds
  2614 00001DD2 C706[3200]1400          		mov	word [BCON], 20
  2615 00001DD8 C706[3800]FFFF          		mov	word [BUFFHEAD], -1
  2616 00001DDE C706[3A00]FFFF          		mov	word [BUFFHEAD+2], -1
  2617 00001DE4 C3                      		retn
  2618                                  
  2619                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2620                                  
  2621                                  		; 07/09/2022
  2622                                  FETCHI_CHECK:
  2623 00001DE5 9C                      		pushf
  2624 00001DE6 2E813E[870F]7258        		cmp	word [cs:FETCHI_TAG], 5872h
  2625 00001DED 7403                    		jz	short FETCHI_CHK_RETN
  2626 00001DEF E81F54                  		call	DOSINIT
  2627                                  FETCHI_CHK_RETN:
  2628 00001DF2 9D                      		popf
  2629 00001DF3 C3                      		retn
  2630                                  
  2631                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2632                                  
  2633                                  		; 07/09/2022
  2634                                  StrCmp:
  2635 00001DF4 56                      		push	si
  2636 00001DF5 57                      		push	di
  2637 00001DF6 50                      		push	ax
  2638                                  Cmplp:
  2639 00001DF7 AC                      		lodsb
  2640 00001DF8 E83300                  		call	Ucase
  2641 00001DFB E85237                  		call	PATHCHRCMP
  2642 00001DFE 88C4                    		mov	ah, al
  2643 00001E00 268A05                  		mov	al, [es:di]
  2644 00001E03 47                      		inc	di
  2645 00001E04 E82700                  		call	Ucase
  2646 00001E07 E84637                  		call	PATHCHRCMP
  2647 00001E0A 38C4                    		cmp	ah, al
  2648 00001E0C 7504                    		jnz	short PopRet
  2649 00001E0E 08C0                    		or	al, al
  2650 00001E10 75E5                    		jnz	short Cmplp
  2651                                  PopRet:
  2652 00001E12 58                      		pop	ax
  2653 00001E13 5F                      		pop	di
  2654 00001E14 5E                      		pop	si
  2655 00001E15 C3                      		retn
  2656                                  
  2657                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2658                                  
  2659                                  		; 07/09/2022
  2660                                  StrCpy:
  2661 00001E16 50                      		push	ax
  2662                                  CPYLoop:
  2663 00001E17 AC                      		lodsb
  2664 00001E18 E81300                  		call	Ucase
  2665 00001E1B E83237                  		call	PATHCHRCMP
  2666 00001E1E AA                      		stosb
  2667 00001E1F 08C0                    		or	al, al
  2668 00001E21 75F4                    		jnz	short CPYLoop
  2669 00001E23 58                      		pop	ax
  2670 00001E24 C3                      		retn
  2671                                  
  2672                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2673                                  
  2674                                  		; 07/09/2022
  2675                                  FStrCpy:
  2676 00001E25 50                      		push	ax
  2677                                  FCPYLoop:
  2678 00001E26 AC                      		lodsb
  2679 00001E27 AA                      		stosb
  2680 00001E28 08C0                    		or	al, al
  2681 00001E2A 75FA                    		jnz	short FCPYLoop
  2682 00001E2C 58                      		pop	ax
  2683 00001E2D C3                      		retn
  2684                                  
  2685                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2686                                  
  2687                                  		; 07/09/2022
  2688                                  Ucase:
  2689 00001E2E E8E636                  		call	_UCase
  2690 00001E31 C3                      		retn
  2691                                  
  2692                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2693                                  
  2694                                  		; 07/09/2022
  2695                                  StrLen:
  2696 00001E32 57                      		push	di
  2697 00001E33 50                      		push	ax
  2698 00001E34 B9FFFF                  		mov	cx, 65535
  2699 00001E37 30C0                    		xor	al, al
  2700 00001E39 F2AE                    		repne scasb
  2701 00001E3B F7D1                    		not	cx
  2702 00001E3D 58                      		pop	ax
  2703 00001E3E 5F                      		pop	di
  2704 00001E3F C3                      		retn
  2705                                  
  2706                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2707                                  
  2708                                  		; 07/09/2022
  2709                                  DStrLen:
  2710 00001E40 E80700                  		call	XCHGP
  2711 00001E43 E8ECFF                  		call	StrLen
  2712 00001E46 E80100                  		call	XCHGP
  2713 00001E49 C3                      		retn
  2714                                  
  2715                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2716                                  
  2717                                  		; 07/09/2022
  2718                                  XCHGP:
  2719 00001E4A 1E                      		push	ds
  2720 00001E4B 06                      		push	es
  2721 00001E4C 1F                      		pop	ds
  2722 00001E4D 07                      		pop	es
  2723 00001E4E 87F7                    		xchg	si, di
  2724                                  xchgp_retn:
  2725 00001E50 C3                      		retn
  2726                                  
  2727                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2728                                  
  2729                                  		; 07/09/2022
  2730                                  Idle:
  2731 00001E51 36F606[0D05]FF          		test	byte [ss:fSharing], 0FFh
  2732 00001E57 75F7                    		jnz	short xchgp_retn
  2733 00001E59 51                      		push	cx
  2734 00001E5A 368B0E[1C00]            		mov	cx, [ss:RetryLoop]
  2735 00001E5F E308                    		jcxz	Idle3
  2736                                  Idle1:
  2737 00001E61 51                      		push	cx
  2738 00001E62 31C9                    		xor	cx, cx
  2739                                  Idle2:
  2740 00001E64 E2FE                    		loop	Idle2
  2741 00001E66 59                      		pop	cx
  2742 00001E67 E2F8                    		loop	Idle1
  2743                                  Idle3:
  2744 00001E69 59                      		pop	cx
  2745 00001E6A C3                      		retn
  2746                                  
  2747                                  ; ---------------------------------------------------------------------------
  2748                                  
  2749                                  		; 07/09/2022
  2750                                  TableDispatch:
  2751 00001E6B 55                      		push	bp
  2752 00001E6C 89E5                    		mov	bp, sp
  2753 00001E6E 53                      		push	bx
  2754 00001E6F 8B5E06                  		mov	bx, [bp+6]
  2755 00001E72 2E8A1F                  		mov	bl, [cs:bx]
  2756 00001E75 385E04                  		cmp	[bp+4],	bl
  2757 00001E78 7317                    		jnb	short TableError
  2758 00001E7A 8A5E04                  		mov	bl, [bp+4]
  2759 00001E7D 30FF                    		xor	bh, bh
  2760 00001E7F D1E3                    		shl	bx, 1
  2761 00001E81 43                      		inc	bx
  2762 00001E82 035E06                  		add	bx, [bp+6]
  2763 00001E85 2E8B1F                  		mov	bx, [cs:bx]
  2764 00001E88 895E06                  		mov	[bp+6],	bx
  2765 00001E8B 5B                      		pop	bx
  2766 00001E8C 5D                      		pop	bp
  2767 00001E8D 83C404                  		add	sp, 4
  2768 00001E90 C3                      		retn
  2769                                  TableError:
  2770 00001E91 5B                      		pop	bx
  2771 00001E92 5D                      		pop	bp
  2772 00001E93 C20600                  		retn	6
  2773                                  
  2774                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2775                                  
  2776                                  		; 07/09/2022
  2777                                  TestNet:
  2778 00001E96 2EC43E[3A05]            		les	di, [cs:THISCDS]
  2779 00001E9B 83FFFF                  		cmp	di, -1
  2780 00001E9E 7409                    		jz	short CMCRet
  2781 00001EA0 26F745430080            		test	word [es:di+43h], 8000h
  2782 00001EA6 7501                    		jnz	short CMCRet
  2783 00001EA8 C3                      		retn
  2784                                  CMCRet:
  2785 00001EA9 F5                      		cmc
  2786 00001EAA C3                      		retn
  2787                                  
  2788                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2789                                  
  2790                                  		; 07/09/2022
  2791                                  IsSFTNet:
  2792 00001EAB 26F745050080            		test	word [es:di+5], 8000h
  2793 00001EB1 C3                      		retn
  2794                                  
  2795                                  ; ---------------------------------------------------------------------------
  2796                                  
  2797                                  		; 07/09/2022
  2798                                  FastInit:
  2799 00001EB2 BF[3B0F]                		mov	di, FastTable
  2800 00001EB5 2E8B4504                		mov	ax, [cs:di+4]
  2801 00001EB9 8CCB                    		mov	bx, cs
  2802 00001EBB 39D8                    		cmp	ax, bx
  2803 00001EBD 7402                    		jz	short ok_install
  2804 00001EBF F9                      		stc
  2805 00001EC0 C3                      		retn
  2806                                  
  2807                                  ; ---------------------------------------------------------------------------
  2808                                  
  2809                                  		; 07/09/2022
  2810                                  ok_install:
  2811 00001EC1 BB[3B0F]                		mov	bx, FastTable
  2812 00001EC4 8CD9                    		mov	cx, ds
  2813 00001EC6 2E894F04                		mov	[cs:bx+4], cx
  2814 00001ECA 2E897702                		mov	[cs:bx+2], si
  2815 00001ECE C3                      		retn
  2816                                  
  2817                                  ; ---------------------------------------------------------------------------
  2818                                  
  2819                                  		; 07/09/2022
  2820                                  FastRet:
  2821 00001ECF B8FFFF                  		mov	ax, -1
  2822 00001ED2 F9                      		stc
  2823 00001ED3 CB                      		retf
  2824                                  
  2825                                  ; ---------------------------------------------------------------------------
  2826                                  
  2827                                  		; 07/09/2022
  2828                                  NLS_OPEN:
  2829 00001ED4 88C8                    		mov	al, cl
  2830 00001ED6 E82650                  		call	_$OPEN
  2831 00001ED9 C3                      		retn
  2832                                  
  2833                                  ; ---------------------------------------------------------------------------
  2834                                  
  2835                                  		; 07/09/2022
  2836                                  NLS_LSEEK:
  2837 00001EDA 2EFF36[1E05]            		push	word [cs:User_SP]
  2838 00001EDF 2EFF36[2005]            		push	word [cs:User_SS]
  2839 00001EE4 E81000                  		call	Fake_User_Stack
  2840 00001EE7 89E8                    		mov	ax, bp
  2841 00001EE9 E8184F                  		call	_$LSEEK
  2842 00001EEC 2E8F06[2005]            		pop	word [cs:User_SS]
  2843 00001EF1 2E8F06[1E05]            		pop	word [cs:User_SP]
  2844 00001EF6 C3                      		retn
  2845                                  
  2846                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2847                                  
  2848                                  		; 07/09/2022
  2849                                  Fake_User_Stack:
  2850 00001EF7 2EA1[690F]              		mov	ax, [cs:User_SP_2F]
  2851 00001EFB 2EA3[1E05]              		mov	[cs:User_SP], ax
  2852 00001EFF 8CC8                    		mov	ax, cs
  2853 00001F01 2EA3[2005]              		mov	[cs:User_SS], ax
  2854 00001F05 C3                      		retn
  2855                                  
  2856                                  ; ---------------------------------------------------------------------------
  2857                                  
  2858                                  		; 07/09/2022
  2859                                  GetDevList:
  2860 00001F06 BE[330F]                		mov	si, SysInitTable
  2861 00001F09 2EC534                  		lds	si, [cs:si]
  2862 00001F0C 8B4422                  		mov	ax, [si+34]
  2863 00001F0F 8B5C24                  		mov	bx, [si+36]
  2864 00001F12 C3                      		retn
  2865                                  
  2866                                  ; ---------------------------------------------------------------------------
  2867                                  
  2868                                  		; 07/09/2022
  2869                                  NLS_IOCTL:
  2870 00001F13 2EFF36[1E05]            		push	word [cs:User_SP]
  2871 00001F18 2EFF36[2005]            		push	word [cs:User_SS]
  2872 00001F1D E8D7FF                  		call	Fake_User_Stack
  2873 00001F20 89E8                    		mov	ax, bp
  2874 00001F22 E86C0F                  		call	_$IOCTL
  2875 00001F25 2E8F06[2005]            		pop	word [cs:User_SS]
  2876 00001F2A 2E8F06[1E05]            		pop	word [cs:User_SP]
  2877 00001F2F C3                      		retn
  2878                                  
  2879                                  ; ---------------------------------------------------------------------------
  2880                                  
  2881                                  		; 07/09/2022
  2882                                  NLS_GETEXT:
  2883 00001F30 2EA1[D202]              		mov	ax, [cs:EXTERR]
  2884 00001F34 C3                      		retn
  2885                                  
  2886                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2887                                  
  2888                                  		; 07/09/2022
  2889                                  EcritDisk:
  2890 00001F35 C3                      		retn
  2891                                  
  2892                                  ; ---------------------------------------------------------------------------
  2893                                  		
  2894                                  		; 07/09/2022
  2895 00001F36 B80180                  		mov	ax, 8001h
  2896 00001F39 CD2A                    		int	2Ah		; Microsoft Networks - BEGIN DOS CRITICAL SECTION
  2897                                  					; AL = critical	section	number (00h-0Fh)
  2898 00001F3B 58                      		pop	ax
  2899 00001F3C C3                      		retn
  2900                                  
  2901                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2902                                  
  2903                                  		; 07/09/2022
  2904                                  LcritDisk:
  2905 00001F3D C3                      		retn
  2906                                  
  2907                                  ; ---------------------------------------------------------------------------
  2908                                  		
  2909                                  		; 07/09/2022
  2910 00001F3E B80181                  		mov	ax, 8101h
  2911 00001F41 CD2A                    		int	2Ah		; Microsoft Networks - END DOS CRITICAL	SECTION
  2912                                  					; AL = critical	section	number (00h-0Fh)
  2913 00001F43 58                      		pop	ax
  2914 00001F44 C3                      		retn
  2915                                  
  2916                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2917                                  
  2918                                  		; 07/09/2022
  2919                                  EcritDevice:
  2920 00001F45 C3                      		retn
  2921                                  
  2922                                  ; ---------------------------------------------------------------------------
  2923                                  		
  2924                                  		; 07/09/2022
  2925 00001F46 B80280                  		mov	ax, 8002h
  2926 00001F49 CD2A                    		int	2Ah		; Microsoft Networks - BEGIN DOS CRITICAL SECTION
  2927                                  					; AL = critical	section	number (00h-0Fh)
  2928 00001F4B 58                      		pop	ax
  2929 00001F4C C3                      		retn
  2930                                  
  2931                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  2932                                  
  2933                                  		; 07/09/2022
  2934                                  LcritDevice:
  2935 00001F4D C3                      		retn
  2936                                  
  2937                                  ; ---------------------------------------------------------------------------
  2938                                  
  2939                                  		; 07/09/2022
  2940 00001F4E B80281                  		mov	ax, 8102h
  2941 00001F51 CD2A                    		int	2Ah		; Microsoft Networks - END DOS CRITICAL	SECTION
  2942                                  					; AL = critical	section	number (00h-0Fh)
  2943 00001F53 58                      		pop	ax
  2944 00001F54 C3                      		retn
  2945                                  
  2946                                  ; ---------------------------------------------------------------------------
  2947                                  
  2948                                  		; 07/09/2022
  2949                                  _$STD_CON_INPUT_NO_ECHO:
  2950 00001F55 1E                      		push	ds
  2951 00001F56 56                      		push	si
  2952                                  INTEST:
  2953 00001F57 E89D36                  		call	STATCHK
  2954 00001F5A 754D                    		jnz	short GET
  2955 00001F5C 36803E[060A]00          		cmp	byte [ss:IOSTACK], 0
  2956 00001F62 7505                    		jnz	short no_sys_wait
  2957 00001F64 B405                    		mov	ah, 5
  2958 00001F66 E8F12C                  		call	IOFUNC
  2959                                  no_sys_wait:
  2960 00001F69 B484                    		mov	ah, 84h
  2961 00001F6B CD2A                    		int	2Ah		; Microsoft Networks - KEYBOARD	BUSY LOOP
  2962 00001F6D 36803E[850F]FF          		cmp	byte [ss:DATE_FLAG], -1
  2963 00001F73 752D                    		jnz	short NoUpdate
  2964 00001F75 50                      		push	ax
  2965 00001F76 53                      		push	bx
  2966 00001F77 51                      		push	cx
  2967 00001F78 52                      		push	dx
  2968 00001F79 1E                      		push	ds
  2969 00001F7A 0E                      		push	cs
  2970 00001F7B 1F                      		pop	ds
  2971 00001F7C B80000                  		mov	ax, 0
  2972 00001F7F E8CF02                  		call	Save_Restore_Packet
  2973 00001F82 E8C8F8                  		call	READTIME
  2974 00001F85 B80100                  		mov	ax, 1
  2975 00001F88 E8C602                  		call	Save_Restore_Packet
  2976 00001F8B 53                      		push	bx
  2977 00001F8C BB[850F]                		mov	bx, DATE_FLAG
  2978 00001F8F 83C302                  		add	bx, 2
  2979 00001F92 2E813F7258              		cmp	word [cs:bx], 5872h
  2980 00001F97 7403                    		jz	short FETCHI_TAG_chk_ok
  2981 00001F99 E87552                  		call	DOSINIT
  2982                                  FETCHI_TAG_chk_ok:
  2983 00001F9C 5B                      		pop	bx
  2984 00001F9D 1F                      		pop	ds
  2985 00001F9E 5A                      		pop	dx
  2986 00001F9F 59                      		pop	cx
  2987 00001FA0 5B                      		pop	bx
  2988 00001FA1 58                      		pop	ax
  2989                                  NoUpdate:
  2990 00001FA2 36FF06[850F]            		inc	word [ss:DATE_FLAG]
  2991 00001FA7 EBAE                    		jmp	short INTEST
  2992                                  
  2993                                  GET:
  2994 00001FA9 30E4                    		xor	ah, ah
  2995 00001FAB E8AC2C                  		call	IOFUNC
  2996 00001FAE 5E                      		pop	si
  2997 00001FAF 1F                      		pop	ds
  2998 00001FB0 3C00                    		cmp	al, 0
  2999 00001FB2 7506                    		jnz	short noscan
  3000 00001FB4 36C606[830F]01          		mov	byte [ss:SCAN_FLAG], 1
  3001                                  noscan:
  3002 00001FBA C3                      		retn
  3003                                  
  3004                                  ; ---------------------------------------------------------------------------
  3005                                  
  3006                                  		; 07/09/2022
  3007                                  _$STD_CON_STRING_OUTPUT:
  3008 00001FBB 89D6                    		mov	si, dx
  3009                                  STRING_OUT1:
  3010 00001FBD AC                      		lodsb
  3011 00001FBE 3C24                    		cmp	al, '$'
  3012 00001FC0 74F8                    		jz	short noscan
  3013 00001FC2 E8BF02                  		call	OUTT
  3014 00001FC5 EBF6                    		jmp	short STRING_OUT1
  3015                                  
  3016                                  ; ---------------------------------------------------------------------------
  3017                                  
  3018                                  		; 07/09/2022
  3019                                  _$STD_CON_STRING_INPUT:
  3020 00001FC7 8CD0                    		mov	ax, ss
  3021 00001FC9 8EC0                    		mov	es, ax
  3022 00001FCB 89D6                    		mov	si, dx
  3023 00001FCD 30ED                    		xor	ch, ch
  3024 00001FCF AD                      		lodsw
  3025 00001FD0 08C0                    		or	al, al
  3026 00001FD2 74E6                    		jz	short noscan
  3027 00001FD4 88E3                    		mov	bl, ah
  3028 00001FD6 88EF                    		mov	bh, ch
  3029 00001FD8 38D8                    		cmp	al, bl
  3030 00001FDA 7605                    		jbe	short noedit
  3031 00001FDC 80380D                  		cmp	byte [bx+si], 0Dh
  3032 00001FDF 7402                    		jz	short editon
  3033                                  noedit:
  3034 00001FE1 88EB                    		mov	bl, ch
  3035                                  editon:
  3036 00001FE3 88C2                    		mov	dl, al
  3037 00001FE5 4A                      		dec	dx
  3038                                  newlin:
  3039 00001FE6 36A0[A701]              		mov	al, [ss:CARPOS]
  3040 00001FEA 36A2[A801]              		mov	[ss:STARTPOS], al
  3041 00001FEE 56                      		push	si
  3042 00001FEF BF[A901]                		mov	di, INBUF
  3043 00001FF2 36882E[1405]            		mov	byte [ss:INSMODE], ch
  3044 00001FF7 88EF                    		mov	bh, ch
  3045 00001FF9 88EE                    		mov	dh, ch
  3046 00001FFB E857FF                  		call	_$STD_CON_INPUT_NO_ECHO
  3047 00001FFE 3C0A                    		cmp	al, 0Ah
  3048 00002000 7503                    		jnz	short GOTCH
  3049                                  GETCH:
  3050 00002002 E850FF                  		call	_$STD_CON_INPUT_NO_ECHO
  3051                                  GOTCH:
  3052 00002005 3C06                    		cmp	al, 6
  3053 00002007 74F9                    		jz	short GETCH
  3054 00002009 363A06[8612]            		cmp	al, [ss:ESCCHAR]
  3055 0000200E 7443                    		jz	short ESCape
  3056 00002010 3C7F                    		cmp	al, 7Fh
  3057 00002012 7436                    		jz	short BACKSPJ
  3058 00002014 3C08                    		cmp	al, 8
  3059 00002016 7432                    		jz	short BACKSPJ
  3060 00002018 3C17                    		cmp	al, 17h
  3061 0000201A 90                      		nop
  3062 0000201B 90                      		nop
  3063 0000201C 3C15                    		cmp	al, 15h
  3064 0000201E 90                      		nop
  3065 0000201F 90                      		nop
  3066 00002020 3C0D                    		cmp	al, 0Dh
  3067 00002022 7432                    		jz	short ENDLIN
  3068 00002024 3C0A                    		cmp	al, 0Ah
  3069 00002026 7444                    		jz	short PHYCRLF
  3070 00002028 363A06[8512]            		cmp	al, [ss:CANCHAR]
  3071 0000202D 746B                    		jz	short KILNEW
  3072                                  SAVCH:
  3073 0000202F 38D6                    		cmp	dh, dl
  3074 00002031 7319                    		jnb	short BUFFUL
  3075 00002033 AA                      		stosb
  3076 00002034 FEC6                    		inc	dh
  3077 00002036 E8E602                  		call	BUFOUT
  3078 00002039 36803E[1405]00          		cmp	byte [ss:INSMODE], 0
  3079 0000203F 75C1                    		jnz	short GETCH
  3080 00002041 38DF                    		cmp	bh, bl
  3081 00002043 73BD                    		jnb	short GETCH
  3082 00002045 46                      		inc	si
  3083 00002046 FEC7                    		inc	bh
  3084 00002048 EBB8                    		jmp	short GETCH
  3085                                  BACKSPJ:
  3086 0000204A EB61                    		jmp	short BACKSP
  3087                                  BUFFUL:
  3088 0000204C B007                    		mov	al, 7
  3089 0000204E E83302                  		call	OUTT
  3090 00002051 EBAF                    		jmp	short GETCH
  3091                                  ESCape:
  3092 00002053 E927F7                  		jmp	OEMFunctionKey
  3093                                  ENDLIN:
  3094 00002056 AA                      		stosb
  3095 00002057 E82A02                  		call	OUTT
  3096 0000205A 5F                      		pop	di
  3097 0000205B 8875FF                  		mov	[di-1],	dh
  3098 0000205E FEC6                    		inc	dh
  3099                                  
  3100                                  ; ---------------------------------------------------------------------------
  3101                                  
  3102                                  		; 07/09/2022
  3103                                  COPYNEW:
  3104 00002060 1E                      		push	ds
  3105 00002061 06                      		push	es
  3106 00002062 1F                      		pop	ds
  3107 00002063 07                      		pop	es
  3108 00002064 BE[A901]                		mov	si, INBUF
  3109 00002067 88F1                    		mov	cl, dh
  3110 00002069 F3A4                    		rep movsb
  3111                                  
  3112                                  OLDBAK_RETN:
  3113 0000206B C3                      		retn
  3114                                  
  3115                                  ; ---------------------------------------------------------------------------
  3116                                  
  3117                                  		; 07/09/2022
  3118                                  PHYCRLF:
  3119 0000206C E84B01                  		call	CRLF
  3120 0000206F EB91                    		jmp	short GETCH
  3121                                  
  3122                                  ; ---------------------------------------------------------------------------
  3123                                  
  3124                                  		; 07/09/2022
  3125                                  LineDel:
  3126 00002071 08F6                    		or	dh, dh
  3127 00002073 748D                    		jz	short GETCH
  3128 00002075 E83B00                  		call	BackSpace
  3129 00002078 EBF7                    		jmp	short LineDel
  3130                                  
  3131                                  ; ---------------------------------------------------------------------------
  3132                                  
  3133                                  		; 07/09/2022
  3134                                  WordDel:
  3135 0000207A E83600                  		call	BackSpace
  3136 0000207D 08F6                    		or	dh, dh
  3137 0000207F 7416                    		jz	short GetChJ
  3138 00002081 268A45FF                		mov	al, [es:di-1]
  3139 00002085 3C30                    		cmp	al, '0'
  3140 00002087 720E                    		jb	short GetChJ
  3141 00002089 3C39                    		cmp	al, '9'
  3142 0000208B 76ED                    		jbe	short WordDel
  3143 0000208D 0C20                    		or	al, 20h
  3144 0000208F 3C61                    		cmp	al, 'a'
  3145 00002091 7204                    		jb	short GetChJ
  3146 00002093 3C7A                    		cmp	al, 'z'
  3147 00002095 76E3                    		jbe	short WordDel
  3148                                  GetChJ:
  3149 00002097 E968FF                  		jmp	GETCH
  3150                                  
  3151                                  ; ---------------------------------------------------------------------------
  3152                                  
  3153                                  		; 07/09/2022
  3154                                  KILNEW:
  3155 0000209A B05C                    		mov	al, '\'
  3156 0000209C E8E501                  		call	OUTT
  3157 0000209F 5E                      		pop	si
  3158                                  PUTNEW:
  3159 000020A0 E81701                  		call	CRLF
  3160 000020A3 36A0[A801]              		mov	al, [ss:STARTPOS]
  3161 000020A7 E85102                  		call	TAB
  3162 000020AA E939FF                  		jmp	newlin
  3163                                  
  3164                                  ; ---------------------------------------------------------------------------
  3165                                  
  3166                                  		; 07/09/2022
  3167                                  BACKSP:
  3168 000020AD E80300                  		call	BackSpace
  3169 000020B0 E94FFF                  		jmp	GETCH
  3170                                  
  3171                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  3172                                  
  3173                                  		; 07/09/2022
  3174                                  BackSpace:
  3175 000020B3 08F6                    		or	dh, dh
  3176 000020B5 7419                    		jz	short OLDBAK
  3177 000020B7 E85800                  		call	BACKUP
  3178 000020BA 268A05                  		mov	al, [es:di]
  3179 000020BD 3C20                    		cmp	al, ' '
  3180 000020BF 730F                    		jnb	short OLDBAK
  3181 000020C1 3C09                    		cmp	al, 9
  3182 000020C3 741B                    		jz	short BAKTAB
  3183 000020C5 3C15                    		cmp	al, 15h
  3184 000020C7 7407                    		jz	short OLDBAK
  3185 000020C9 3C14                    		cmp	al, 14h
  3186 000020CB 7403                    		jz	short OLDBAK
  3187 000020CD E84500                  		call	BACKMES
  3188                                  OLDBAK:
  3189 000020D0 36803E[1405]00          		cmp	byte [ss:INSMODE], 0
  3190 000020D6 7593                    		jnz	short OLDBAK_RETN
  3191 000020D8 08FF                    		or	bh, bh
  3192 000020DA 748F                    		jz	short OLDBAK_RETN
  3193 000020DC FECF                    		dec	bh
  3194 000020DE 4E                      		dec	si
  3195 000020DF C3                      		retn
  3196                                  
  3197                                  ; ---------------------------------------------------------------------------
  3198                                  
  3199                                  		; 07/09/2022
  3200                                  BAKTAB:
  3201 000020E0 57                      		push	di
  3202 000020E1 4F                      		dec	di
  3203 000020E2 FD                      		std
  3204 000020E3 88F1                    		mov	cl, dh
  3205 000020E5 B020                    		mov	al, ' '
  3206 000020E7 53                      		push	bx
  3207 000020E8 B307                    		mov	bl, 7
  3208 000020EA E30E                    		jcxz	FIGTAB
  3209                                  FNDPOS:
  3210 000020EC AE                      		scasb
  3211 000020ED 7609                    		jbe	short CHKCNT
  3212 000020EF 26807D0109              		cmp	byte [es:di+1], 9
  3213 000020F4 7409                    		jz	short HAVTAB
  3214 000020F6 FECB                    		dec	bl
  3215                                  CHKCNT:
  3216 000020F8 E2F2                    		loop	FNDPOS
  3217                                  FIGTAB:
  3218 000020FA 362A1E[A801]            		sub	bl, [ss:STARTPOS]
  3219                                  HAVTAB:
  3220 000020FF 28F3                    		sub	bl, dh
  3221 00002101 00D9                    		add	cl, bl
  3222 00002103 80E107                  		and	cl, 7
  3223 00002106 FC                      		cld
  3224 00002107 5B                      		pop	bx
  3225 00002108 5F                      		pop	di
  3226 00002109 74C5                    		jz	short OLDBAK
  3227                                  TABBAK:
  3228 0000210B E80700                  		call	BACKMES
  3229 0000210E E2FB                    		loop	TABBAK
  3230 00002110 EBBE                    		jmp	short OLDBAK
  3231                                  
  3232                                  ; ---------------------------------------------------------------------------
  3233                                  
  3234                                  		; 07/09/2022
  3235                                  BACKUP:
  3236 00002112 FECE                    		dec	dh
  3237 00002114 4F                      		dec	di
  3238                                  BACKMES:
  3239 00002115 B008                    		mov	al, 8
  3240 00002117 E86A01                  		call	OUTT
  3241 0000211A B020                    		mov	al, ' '
  3242 0000211C E86501                  		call	OUTT
  3243 0000211F B008                    		mov	al, 8
  3244 00002121 E96001                  		jmp	OUTT
  3245                                  
  3246                                  ; ---------------------------------------------------------------------------
  3247                                  
  3248                                  		; 07/09/2022
  3249                                  TwoEsc:
  3250 00002124 36A0[8612]              		mov	al, [ss:ESCCHAR]
  3251 00002128 E904FF                  		jmp	SAVCH
  3252                                  
  3253                                  ; ---------------------------------------------------------------------------
  3254                                  
  3255                                  		; 07/09/2022
  3256                                  COPYLIN:
  3257 0000212B 88D9                    		mov	cl, bl
  3258 0000212D 28F9                    		sub	cl, bh
  3259 0000212F EB07                    		jmp	short COPYEACH
  3260                                  
  3261                                  ; ---------------------------------------------------------------------------
  3262                                  
  3263                                  		; 07/09/2022
  3264                                  CopyStr:
  3265 00002131 E83400                  		call	FINDOLD
  3266 00002134 EB02                    		jmp	short COPYEACH
  3267                                  
  3268                                  ; ---------------------------------------------------------------------------
  3269                                  
  3270                                  		; 07/09/2022
  3271                                  COPYONE:
  3272 00002136 B101                    		mov	cl, 1
  3273                                  COPYEACH:
  3274 00002138 36C606[1405]00          		mov	byte [ss:INSMODE], 0
  3275 0000213E 38D6                    		cmp	dh, dl
  3276 00002140 740F                    		jz	short GETCH2
  3277 00002142 38DF                    		cmp	bh, bl
  3278 00002144 740B                    		jz	short GETCH2
  3279 00002146 AC                      		lodsb
  3280 00002147 AA                      		stosb
  3281 00002148 E8D401                  		call	BUFOUT
  3282 0000214B FEC7                    		inc	bh
  3283 0000214D FEC6                    		inc	dh
  3284 0000214F E2E7                    		loop	COPYEACH
  3285                                  GETCH2:
  3286 00002151 E9AEFE                  		jmp	GETCH
  3287                                  
  3288                                  ; ---------------------------------------------------------------------------
  3289                                  
  3290                                  		; 07/09/2022
  3291                                  SKIPONE:
  3292 00002154 38DF                    		cmp	bh, bl
  3293 00002156 74F9                    		jz	short GETCH2
  3294 00002158 FEC7                    		inc	bh
  3295 0000215A 46                      		inc	si
  3296 0000215B E9A4FE                  		jmp	GETCH
  3297                                  
  3298                                  ; ---------------------------------------------------------------------------
  3299                                  
  3300                                  		; 07/09/2022
  3301                                  SKIPSTR:
  3302 0000215E E80700                  		call	FINDOLD
  3303 00002161 01CE                    		add	si, cx
  3304 00002163 00CF                    		add	bh, cl
  3305 00002165 E99AFE                  		jmp	GETCH
  3306                                  
  3307                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  3308                                  
  3309                                  		; 07/09/2022
  3310                                  FINDOLD:
  3311 00002168 E8EAFD                  		call	_$STD_CON_INPUT_NO_ECHO
  3312 0000216B 363A06[8612]            		cmp	al, [ss:ESCCHAR]
  3313 00002170 7506                    		jnz	short FindSetup
  3314 00002172 E8E0FD                  		call	_$STD_CON_INPUT_NO_ECHO
  3315 00002175 EB1E                    		jmp	short NotFnd
  3316                                  
  3317 00002177 90                      		nop
  3318                                  FindSetup:
  3319 00002178 88D9                    		mov	cl, bl
  3320 0000217A 28F9                    		sub	cl, bh
  3321 0000217C 7417                    		jz	short NotFnd
  3322 0000217E 49                      		dec	cx
  3323 0000217F 7414                    		jz	short NotFnd
  3324 00002181 06                      		push	es
  3325 00002182 1E                      		push	ds
  3326 00002183 07                      		pop	es
  3327 00002184 57                      		push	di
  3328 00002185 89F7                    		mov	di, si
  3329 00002187 47                      		inc	di
  3330 00002188 F2AE                    		repne scasb
  3331 0000218A 5F                      		pop	di
  3332 0000218B 07                      		pop	es
  3333 0000218C 7507                    		jnz	short NotFnd
  3334 0000218E F6D1                    		not	cl
  3335 00002190 00D9                    		add	cl, bl
  3336 00002192 28F9                    		sub	cl, bh
  3337                                  FINDOLD_RETN:
  3338 00002194 C3                      		retn
  3339                                  
  3340                                  ; ---------------------------------------------------------------------------
  3341                                  
  3342                                  		; 07/09/2022
  3343                                  NotFnd:
  3344 00002195 5D                      		pop	bp
  3345 00002196 E969FE                  		jmp	GETCH
  3346                                  
  3347                                  ; ---------------------------------------------------------------------------
  3348                                  
  3349                                  		; 07/09/2022
  3350                                  REEDIT:
  3351 00002199 B040                    		mov	al, 40h	; '@'
  3352 0000219B E8E600                  		call	OUTT
  3353 0000219E 5F                      		pop	di
  3354 0000219F 57                      		push	di
  3355 000021A0 06                      		push	es
  3356 000021A1 1E                      		push	ds
  3357 000021A2 E8BBFE                  		call	COPYNEW
  3358 000021A5 1F                      		pop	ds
  3359 000021A6 07                      		pop	es
  3360 000021A7 5E                      		pop	si
  3361 000021A8 88F3                    		mov	bl, dh
  3362 000021AA E9F3FE                  		jmp	PUTNEW
  3363                                  
  3364                                  ; ---------------------------------------------------------------------------
  3365                                  
  3366                                  		; 07/09/2022
  3367                                  ENTERINS_EXITINS:
  3368 000021AD 36F616[1405]            		not	byte [ss:INSMODE]
  3369 000021B2 E94DFE                  		jmp	GETCH
  3370                                  
  3371                                  ; ---------------------------------------------------------------------------
  3372                                  
  3373                                  		; 07/09/2022
  3374                                  CTRLZ:
  3375 000021B5 B01A                    		mov	al, 1Ah
  3376 000021B7 E975FE                  		jmp	SAVCH
  3377                                  
  3378                                  ; ---------------------------------------------------------------------------
  3379                                  
  3380                                  		; 07/09/2022
  3381                                  CRLF:
  3382 000021BA B00D                    		mov	al, 0Dh
  3383 000021BC E8C500                  		call	OUTT
  3384 000021BF B00A                    		mov	al, 0Ah
  3385 000021C1 E9C000                  		jmp	OUTT
  3386                                  
  3387                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  3388                                  
  3389                                  		; 07/09/2022
  3390                                  _$RAW_CON_IO:
  3391 000021C4 88D0                    		mov	al, dl
  3392 000021C6 3CFF                    		cmp	al, -1
  3393 000021C8 7542                    		jnz	short RAWOUT
  3394 000021CA 36C43E[1E05]            		les	di, [ss:User_SP]
  3395 000021CF 31DB                    		xor	bx, bx
  3396 000021D1 E8031E                  		call	GET_IO_SFT
  3397 000021D4 72BE                    		jb	short FINDOLD_RETN
  3398 000021D6 B401                    		mov	ah, 1
  3399 000021D8 E87F2A                  		call	IOFUNC
  3400 000021DB 750B                    		jnz	short RESFLG
  3401 000021DD E8F833                  		call	SPOOLINT
  3402 000021E0 26804D1640              		or	byte [es:di+16h], 40h
  3403 000021E5 30C0                    		xor	al, al
  3404                                  RET17:
  3405 000021E7 C3                      		retn
  3406                                  RESFLG:
  3407 000021E8 26806516BF              		and	byte [es:di+16h], 0BFh
  3408                                  rci0:
  3409 000021ED E8E833                  		call	SPOOLINT
  3410                                  
  3411                                  ; ---------------------------------------------------------------------------
  3412                                  
  3413                                  		; 07/09/2022
  3414                                  _$RAW_CON_INPUT:
  3415 000021F0 53                      		push	bx
  3416 000021F1 31DB                    		xor	bx, bx
  3417 000021F3 E8E11D                  		call	GET_IO_SFT
  3418 000021F6 5B                      		pop	bx
  3419 000021F7 72EE                    		jb	short RET17
  3420 000021F9 B401                    		mov	ah, 1
  3421 000021FB E85C2A                  		call	IOFUNC
  3422 000021FE 7506                    		jnz	short rci5
  3423 00002200 B484                    		mov	ah, 84h
  3424 00002202 CD2A                    		int	2Ah		; Microsoft Networks - KEYBOARD	BUSY LOOP
  3425 00002204 EBE7                    		jmp	short rci0
  3426                                  rci5:
  3427 00002206 30E4                    		xor	ah, ah
  3428 00002208 E84F2A                  		call	IOFUNC
  3429 0000220B C3                      		retn
  3430                                  
  3431                                  ; ---------------------------------------------------------------------------
  3432                                  
  3433                                  		; 07/09/2022
  3434                                  RAWOUT:
  3435 0000220C 53                      		push	bx
  3436 0000220D BB0100                  		mov	bx, 1
  3437 00002210 E8C41D                  		call	GET_IO_SFT
  3438 00002213 721B                    		jb	short RAWRET1
  3439 00002215 8B5C05                  		mov	bx, [si+5]
  3440 00002218 81E38080                		and	bx, 8080h
  3441 0000221C 81FB8000                		cmp	bx, 80h
  3442 00002220 7510                    		jnz	short RAWNORM
  3443 00002222 1E                      		push	ds
  3444 00002223 C55C07                  		lds	bx, [si+7]
  3445 00002226 F6470410                		test	byte [bx+4], 10h
  3446 0000222A 1F                      		pop	ds
  3447 0000222B 7405                    		jz	short RAWNORM
  3448 0000222D CD29                    		int	29h		; DOS 2+ internal - FAST PUTCHAR
  3449                                  					; AL = character to display
  3450                                  RAWRET:
  3451 0000222F F8                      		clc
  3452                                  RAWRET1:
  3453 00002230 5B                      		pop	bx
  3454                                  RAWRET2:
  3455 00002231 C3                      		retn
  3456                                  RAWNORM:
  3457 00002232 E80700                  		call	RAWOUT3
  3458 00002235 EBF8                    		jmp	short RAWRET
  3459                                  
  3460                                  ; ---------------------------------------------------------------------------
  3461                                  
  3462                                  		; 07/09/2022
  3463                                  RAWOUT2:
  3464 00002237 E89D1D                  		call	GET_IO_SFT
  3465 0000223A 72F5                    		jb	short RAWRET2
  3466                                  
  3467                                  ; ---------------------------------------------------------------------------
  3468                                  
  3469                                  		; 07/09/2022
  3470                                  RAWOUT3:
  3471 0000223C 50                      		push	ax
  3472 0000223D EB03                    		jmp	short RAWOSTRT
  3473                                  
  3474                                  ; ---------------------------------------------------------------------------
  3475                                  
  3476                                  		; 07/09/2022
  3477                                  ROLP:
  3478 0000223F E89633                  		call	SPOOLINT
  3479                                  RAWOSTRT:
  3480 00002242 B403                    		mov	ah, 3
  3481 00002244 E8132A                  		call	IOFUNC
  3482 00002247 74F6                    		jz	short ROLP
  3483 00002249 58                      		pop	ax
  3484 0000224A B402                    		mov	ah, 2
  3485 0000224C E80B2A                  		call	IOFUNC
  3486 0000224F F8                      		clc
  3487 00002250 C3                      		retn
  3488                                  
  3489                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  3490                                  
  3491                                  		; 07/09/2022
  3492                                  Save_Restore_Packet:
  3493 00002251 1E                      		push	ds
  3494 00002252 06                      		push	es
  3495 00002253 56                      		push	si
  3496 00002254 57                      		push	di
  3497 00002255 83F800                  		cmp	ax, 0
  3498 00002258 7409                    		jz	short save_packet
  3499 0000225A BE[6B0F]                		mov	si, FAKE_STACK_2F
  3500 0000225D BF[0603]                		mov	di, DEVCALL
  3501 00002260 EB07                    		jmp	short set_seg
  3502                                  
  3503 00002262 90                      		nop
  3504                                  save_packet:
  3505 00002263 BF[6B0F]                		mov	di, FAKE_STACK_2F
  3506 00002266 BE[0603]                		mov	si, DEVCALL
  3507                                  set_seg:
  3508 00002269 8CC8                    		mov	ax, cs
  3509 0000226B 8ED8                    		mov	ds, ax
  3510 0000226D 8EC0                    		mov	es, ax
  3511 0000226F B90B00                  		mov	cx, 11
  3512 00002272 F3A5                    		rep movsw
  3513 00002274 5F                      		pop	di
  3514 00002275 5E                      		pop	si
  3515 00002276 07                      		pop	es
  3516 00002277 1F                      		pop	ds
  3517 00002278 C3                      		retn
  3518                                  
  3519                                  ; ---------------------------------------------------------------------------
  3520                                  
  3521                                  		; 07/09/2022
  3522                                  _$STD_CON_INPUT:
  3523 00002279 E8D9FC                  		call	_$STD_CON_INPUT_NO_ECHO
  3524 0000227C 50                      		push	ax
  3525 0000227D E80400                  		call	OUTT
  3526 00002280 58                      		pop	ax
  3527                                  
  3528                                  CON_INPUT_RETN:
  3529 00002281 C3                      		retn
  3530                                  
  3531                                  ; ---------------------------------------------------------------------------
  3532                                  
  3533                                  		; 07/09/2022
  3534                                  _$STD_CON_OUTPUT:
  3535 00002282 88D0                    		mov	al, dl
  3536                                  
  3537                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  3538                                  
  3539                                  		; 07/09/2022
  3540                                  OUTT:
  3541 00002284 3C20                    		cmp	al, 20h
  3542 00002286 725F                    		jb	short CTRLOUT
  3543 00002288 3C7F                    		cmp	al, 7Fh
  3544 0000228A 7405                    		jz	short OUTCH
  3545                                  OUTCHA:
  3546 0000228C 36FE06[A701]            		inc	byte [ss:CARPOS]
  3547                                  OUTCH:
  3548 00002291 1E                      		push	ds
  3549 00002292 56                      		push	si
  3550 00002293 36FE06[AE02]            		inc	byte [ss:CHARCO]
  3551 00002298 368026[AE02]03          		and	byte [ss:CHARCO], 3
  3552 0000229E 7505                    		jnz	short OUTSKIP
  3553 000022A0 50                      		push	ax
  3554 000022A1 E85333                  		call	STATCHK
  3555 000022A4 58                      		pop	ax
  3556                                  OUTSKIP:
  3557 000022A5 E864FF                  		call	RAWOUT
  3558 000022A8 5E                      		pop	si
  3559 000022A9 1F                      		pop	ds
  3560 000022AA 36F606[AC02]FF          		test	byte [ss:PFLAG], 0FFh
  3561 000022B0 74CF                    		jz	short CON_INPUT_RETN
  3562 000022B2 53                      		push	bx
  3563 000022B3 1E                      		push	ds
  3564 000022B4 56                      		push	si
  3565 000022B5 BB0100                  		mov	bx, 1
  3566 000022B8 E81C1D                  		call	GET_IO_SFT
  3567 000022BB 7224                    		jb	short TRIPOPJ
  3568 000022BD 8B5C05                  		mov	bx, [si+5]
  3569 000022C0 F7C30080                		test	bx, 8000h
  3570 000022C4 751B                    		jnz	short TRIPOPJ
  3571 000022C6 F7C38000                		test	bx, 80h
  3572 000022CA 7415                    		jz	short TRIPOPJ
  3573 000022CC BB0400                  		mov	bx, 4
  3574 000022CF E8051D                  		call	GET_IO_SFT
  3575 000022D2 720D                    		jb	short TRIPOPJ
  3576 000022D4 F744050008              		test	word [si+5], 800h
  3577 000022D9 7409                    		jz	short LISSTRT2J
  3578 000022DB 36C606[AC02]00          		mov	byte [ss:PFLAG], 0
  3579                                  TRIPOPJ:
  3580 000022E1 E98B00                  		jmp	TRIPOP
  3581                                  LISSTRT2J:
  3582 000022E4 E98500                  		jmp	LISSTRT2
  3583                                  CTRLOUT:
  3584 000022E7 3C0D                    		cmp	al, 0Dh
  3585 000022E9 7420                    		jz	short ZERPOS
  3586 000022EB 3C08                    		cmp	al, 8
  3587 000022ED 7428                    		jz	short BACKPOS
  3588 000022EF 3C09                    		cmp	al, 9
  3589 000022F1 759E                    		jnz	short OUTCH
  3590 000022F3 36A0[A701]              		mov	al, [ss:CARPOS]
  3591 000022F7 0CF8                    		or	al, 0F8h
  3592 000022F9 F6D8                    		neg	al
  3593                                  
  3594                                  ; ---------------------------------------------------------------------------
  3595                                  
  3596                                  		; 07/09/2022
  3597                                  TAB:
  3598 000022FB 51                      		push	cx
  3599 000022FC 88C1                    		mov	cl, al
  3600 000022FE B500                    		mov	ch, 0
  3601 00002300 E307                    		jcxz	POPTAB
  3602                                  TABLP:
  3603 00002302 B020                    		mov	al, ' '
  3604 00002304 E87DFF                  		call	OUTT
  3605 00002307 E2F9                    		loop	TABLP
  3606                                  POPTAB:
  3607 00002309 59                      		pop	cx
  3608 0000230A C3                      		retn
  3609                                  
  3610                                  ; ---------------------------------------------------------------------------
  3611                                  
  3612                                  		; 07/09/2022
  3613                                  ZERPOS:
  3614 0000230B 36C606[A701]00          		mov	byte [ss:CARPOS], 0
  3615 00002311 E97DFF                  		jmp	OUTCH
  3616                                  
  3617                                  ; ---------------------------------------------------------------------------
  3618                                  
  3619                                  		; 07/09/2022
  3620                                  OUTJ:
  3621 00002314 E96DFF                  		jmp	OUTT
  3622                                  
  3623                                  ; ---------------------------------------------------------------------------
  3624                                  
  3625                                  		; 07/09/2022
  3626                                  BACKPOS:
  3627 00002317 36FE0E[A701]            		dec	byte [ss:CARPOS]
  3628 0000231C E972FF                  		jmp	OUTCH
  3629                                  
  3630                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  3631                                  
  3632                                  		; 07/09/2022
  3633                                  BUFOUT:
  3634 0000231F 3C20                    		cmp	al, ' '
  3635 00002321 73F1                    		jnb	short OUTJ
  3636 00002323 3C09                    		cmp	al, 9
  3637 00002325 74ED                    		jz	short OUTJ
  3638 00002327 3C15                    		cmp	al, 15h
  3639 00002329 740D                    		jz	short CTRLU
  3640 0000232B 3C14                    		cmp	al, 14h
  3641 0000232D 7409                    		jz	short CTRLU
  3642 0000232F 50                      		push	ax
  3643 00002330 B05E                    		mov	al, '^'
  3644 00002332 E84FFF                  		call	OUTT
  3645 00002335 58                      		pop	ax
  3646 00002336 0C40                    		or	al, 40h
  3647                                  CTRLU:
  3648 00002338 E849FF                  		call	OUTT
  3649                                  BUFOUT_RETN:
  3650 0000233B C3                      		retn
  3651                                  
  3652                                  ; ---------------------------------------------------------------------------
  3653                                  
  3654                                  		; 07/09/2022
  3655                                  _$STD_AUX_INPUT:
  3656 0000233C E8B832                  		call	STATCHK
  3657 0000233F BB0300                  		mov	bx, 3
  3658 00002342 E8921C                  		call	GET_IO_SFT
  3659 00002345 72F4                    		jb	short BUFOUT_RETN
  3660 00002347 EB03                    		jmp	short TAISTRT
  3661                                  
  3662                                  ; ---------------------------------------------------------------------------
  3663                                  
  3664                                  		; 07/09/2022
  3665                                  AUXILP:
  3666 00002349 E88C32                  		call	SPOOLINT
  3667                                  TAISTRT:
  3668 0000234C B401                    		mov	ah, 1
  3669 0000234E E80929                  		call	IOFUNC
  3670 00002351 74F6                    		jz	short AUXILP
  3671 00002353 30E4                    		xor	ah, ah
  3672 00002355 E80229                  		call	IOFUNC
  3673 00002358 C3                      		retn
  3674                                  
  3675                                  ; ---------------------------------------------------------------------------
  3676                                  
  3677                                  		; 07/09/2022
  3678                                  _$STD_AUX_OUTPUT:
  3679 00002359 53                      		push	bx
  3680 0000235A BB0300                  		mov	bx, 3
  3681 0000235D EB04                    		jmp	short SENDOUT
  3682                                  
  3683                                  ; ---------------------------------------------------------------------------
  3684                                  
  3685                                  		; 07/09/2022
  3686                                  _$STD_PRINTER_OUTPUT:
  3687 0000235F 53                      		push	bx
  3688 00002360 BB0400                  		mov	bx, 4
  3689                                  SENDOUT:
  3690 00002363 88D0                    		mov	al, dl
  3691 00002365 50                      		push	ax
  3692 00002366 E88E32                  		call	STATCHK
  3693 00002369 58                      		pop	ax
  3694 0000236A 1E                      		push	ds
  3695 0000236B 56                      		push	si
  3696                                  LISSTRT2:
  3697 0000236C E8C8FE                  		call	RAWOUT2
  3698                                  TRIPOP:
  3699 0000236F 5E                      		pop	si
  3700 00002370 1F                      		pop	ds
  3701 00002371 5B                      		pop	bx
  3702                                  SCIS_RETN:
  3703 00002372 C3                      		retn
  3704                                  
  3705                                  ; ---------------------------------------------------------------------------
  3706                                  
  3707                                  		; 07/09/2022
  3708                                  _$STD_CON_INPUT_STATUS:
  3709 00002373 E88132                  		call	STATCHK
  3710 00002376 B000                    		mov	al, 0
  3711 00002378 74F8                    		jz	short SCIS_RETN
  3712 0000237A 0CFF                    		or	al, -1
  3713 0000237C C3                      		retn
  3714                                  
  3715                                  ; ---------------------------------------------------------------------------
  3716                                  
  3717                                  		; 07/09/2022
  3718                                  _$STD_CON_INPUT_FLUSH:
  3719 0000237D 50                      		push	ax
  3720 0000237E 52                      		push	dx
  3721 0000237F 31DB                    		xor	bx, bx
  3722 00002381 E8531C                  		call	GET_IO_SFT
  3723 00002384 7205                    		jb	short BADJFNCON
  3724 00002386 B404                    		mov	ah, 4
  3725 00002388 E8CF28                  		call	IOFUNC
  3726                                  BADJFNCON:
  3727 0000238B 5A                      		pop	dx
  3728 0000238C 58                      		pop	ax
  3729 0000238D 88C4                    		mov	ah, al
  3730 0000238F 3C01                    		cmp	al, 1
  3731 00002391 7413                    		jz	short REDISPJ
  3732 00002393 3C06                    		cmp	al, 6
  3733 00002395 740F                    		jz	short REDISPJ
  3734 00002397 3C07                    		cmp	al, 7
  3735 00002399 740B                    		jz	short REDISPJ
  3736 0000239B 3C08                    		cmp	al, 8
  3737 0000239D 7407                    		jz	short REDISPJ
  3738 0000239F 3C0A                    		cmp	al, 0Ah
  3739 000023A1 7403                    		jz	short REDISPJ
  3740 000023A3 B000                    		mov	al, 0
  3741 000023A5 C3                      		retn
  3742                                  REDISPJ:
  3743 000023A6 FA                      		cli
  3744 000023A7 E922F1                  		jmp	REDISP
  3745                                  
  3746                                  ; ---------------------------------------------------------------------------
  3747                                  
  3748                                  		; 07/09/2022
  3749                                  _$GET_FCB_POSITION:
  3750 000023AA E82005                  		call	GetExtended
  3751 000023AD E8F004                  		call	GetExtent
  3752 000023B0 894421                  		mov	[si+21h], ax
  3753 000023B3 885423                  		mov	[si+23h], dl
  3754 000023B6 837C0E40                		cmp	word [si+0Eh], 64
  3755 000023BA 7303                    		jnb	short GetFCBBye
  3756 000023BC 887424                  		mov	[si+24h], dh
  3757                                  GetFCBBye:
  3758 000023BF E9C4F2                  		jmp	NO_OP
  3759                                  
  3760                                  ; ---------------------------------------------------------------------------
  3761                                  
  3762                                  		; 07/09/2022
  3763                                  _$FCB_DELETE:
  3764 000023C2 BF[6003]                		mov	di, OPENBUF
  3765 000023C5 E8FE44                  		call	TransFCB
  3766 000023C8 7209                    		jb	short BadPath
  3767 000023CA 16                      		push	ss
  3768 000023CB 1F                      		pop	ds
  3769 000023CC E8AF0D                  		call	DOS_DELETE
  3770 000023CF 7202                    		jb	short BadPath
  3771                                  GoodPath:
  3772 000023D1 EBEC                    		jmp	short GetFCBBye
  3773                                  BadPath:
  3774 000023D3 E9B3F2                  		jmp	FCB_Ret_Err
  3775                                  
  3776                                  ; ---------------------------------------------------------------------------
  3777                                  
  3778                                  		; 07/09/2022
  3779                                  _$GET_FCB_FILE_LENGTH:
  3780 000023D6 E8F404                  		call	GetExtended
  3781 000023D9 BF[6003]                		mov	di, OPENBUF
  3782 000023DC 1E                      		push	ds
  3783 000023DD 56                      		push	si
  3784 000023DE E8E544                  		call	TransFCB
  3785 000023E1 5E                      		pop	si
  3786 000023E2 1F                      		pop	ds
  3787 000023E3 72EE                    		jb	short BadPath
  3788 000023E5 1E                      		push	ds
  3789 000023E6 56                      		push	si
  3790 000023E7 16                      		push	ss
  3791 000023E8 1F                      		pop	ds
  3792 000023E9 E81811                  		call	GET_FILE_INFO
  3793 000023EC 5E                      		pop	si
  3794 000023ED 1F                      		pop	ds
  3795 000023EE 72E3                    		jb	short BadPath
  3796 000023F0 89DA                    		mov	dx, bx
  3797 000023F2 89F8                    		mov	ax, di
  3798 000023F4 8B5C0E                  		mov	bx, [si+0Eh]
  3799 000023F7 09DB                    		or	bx, bx
  3800 000023F9 7503                    		jnz	short GetSize
  3801 000023FB BB8000                  		mov	bx, 128
  3802                                  GetSize:
  3803 000023FE 89C7                    		mov	di, ax
  3804 00002400 89D0                    		mov	ax, dx
  3805 00002402 31D2                    		xor	dx, dx
  3806 00002404 F7F3                    		div	bx
  3807 00002406 50                      		push	ax
  3808 00002407 89F8                    		mov	ax, di
  3809 00002409 F7F3                    		div	bx
  3810 0000240B 89D1                    		mov	cx, dx
  3811 0000240D 5A                      		pop	dx
  3812 0000240E E306                    		jcxz	LengthStore
  3813 00002410 83C001                  		add	ax, 1
  3814 00002413 83D200                  		adc	dx, 0
  3815                                  LengthStore:
  3816 00002416 894421                  		mov	[si+21h], ax
  3817 00002419 885423                  		mov	[si+23h], dl
  3818 0000241C 08F6                    		or	dh, dh
  3819 0000241E 74B1                    		jz	short GoodPath
  3820 00002420 887424                  		mov	[si+24h], dh
  3821                                  GoodRet:
  3822 00002423 EBAC                    		jmp	short GoodPath
  3823                                  
  3824                                  ; ---------------------------------------------------------------------------
  3825                                  
  3826                                  		; 07/09/2022
  3827                                  _$FCB_CLOSE:
  3828 00002425 30C0                    		xor	al, al
  3829 00002427 E8A304                  		call	GetExtended
  3830 0000242A 7403                    		jz	short NoAttr
  3831 0000242C 8A44FF                  		mov	al, [si-1]
  3832                                  NoAttr:
  3833 0000242F 36A2[0605]              		mov	byte [ss:ATTRIB], al
  3834 00002433 E80C04                  		call	SFTFromFCB
  3835 00002436 72EB                    		jb	short GoodRet
  3836 00002438 268A4504                		mov	al, [es:di+4]
  3837 0000243C 30E4                    		xor	ah, ah
  3838 0000243E 50                      		push	ax
  3839 0000243F E86B4D                  		call	CheckShare
  3840 00002442 7508                    		jnz	short NoStash
  3841 00002444 36A0[0605]              		mov	al, byte [ss:ATTRIB]
  3842 00002448 26884504                		mov	[es:di+4], al
  3843                                  NoStash:
  3844 0000244C 8B4414                  		mov	ax, [si+14h]
  3845 0000244F 2689450F                		mov	[es:di+0Fh], ax
  3846 00002453 8B4416                  		mov	ax, [si+16h]
  3847 00002456 2689450D                		mov	[es:di+0Dh], ax
  3848 0000245A 8B4410                  		mov	ax, [si+10h]
  3849 0000245D 26894511                		mov	[es:di+11h], ax
  3850 00002461 8B4412                  		mov	ax, [si+12h]
  3851 00002464 26894513                		mov	[es:di+13h], ax
  3852 00002468 26814D050040            		or	word [es:di+5], 4000h
  3853 0000246E 16                      		push	ss
  3854 0000246F 1F                      		pop	ds
  3855 00002470 E85C15                  		call	DOS_CLOSE
  3856 00002473 C43E[3605]              		les	di, [THISSFT]
  3857 00002477 59                      		pop	cx
  3858 00002478 26884D04                		mov	[es:di+4], cl
  3859 0000247C 9C                      		pushf
  3860 0000247D 26F705FFFF              		test	word [es:di], 0FFFFh
  3861 00002482 7507                    		jnz	short CloseOK
  3862 00002484 50                      		push	ax
  3863 00002485 B04D                    		mov	al, 'M'
  3864 00002487 E8DA02                  		call	BlastSFT
  3865 0000248A 58                      		pop	ax
  3866                                  CloseOK:
  3867 0000248B 9D                      		popf
  3868 0000248C 7395                    		jnb	short GoodRet
  3869 0000248E 3C06                    		cmp	al, 6
  3870 00002490 7491                    		jz	short GoodRet
  3871 00002492 B002                    		mov	al, 2
  3872                                  fcb_close_err:
  3873 00002494 E9F2F1                  		jmp	FCB_Ret_Err
  3874                                  
  3875                                  ; ---------------------------------------------------------------------------
  3876                                  
  3877                                  		; 07/09/2022
  3878                                  _$FCB_RENAME:
  3879 00002497 E83304                  		call	GetExtended
  3880 0000249A 52                      		push	dx
  3881 0000249B 8A04                    		mov	al, [si]
  3882 0000249D 83C610                  		add	si, 10h
  3883 000024A0 BF[E003]                		mov	di, RENBUF
  3884 000024A3 FF34                    		push	word [si]
  3885 000024A5 1E                      		push	ds
  3886 000024A6 56                      		push	si
  3887 000024A7 8804                    		mov	[si], al
  3888 000024A9 89F2                    		mov	dx, si
  3889 000024AB E81844                  		call	TransFCB
  3890 000024AE 5E                      		pop	si
  3891 000024AF 1F                      		pop	ds
  3892 000024B0 8F04                    		pop	word [si]
  3893 000024B2 5A                      		pop	dx
  3894 000024B3 721A                    		jb	short fren90
  3895 000024B5 368B36[4A05]            		mov	si, [ss:WFP_START]
  3896 000024BA 368936[4C05]            		mov	[ss:REN_WFP], si
  3897 000024BF BF[6003]                		mov	di, OPENBUF
  3898 000024C2 E80144                  		call	TransFCB
  3899 000024C5 7208                    		jb	short fren90
  3900 000024C7 E8670E                  		call	DOS_RENAME
  3901 000024CA 7203                    		jb	short fren90
  3902 000024CC E9B7F1                  		jmp	NO_OP
  3903                                  fren90:
  3904 000024CF EBC3                    		jmp	short fcb_close_err
  3905                                  
  3906                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  3907                                  
  3908                                  		; 07/09/2022
  3909                                  SaveFCBInfo:
  3910 000024D1 36C43E[3605]            		les	di, [ss:THISSFT]
  3911 000024D6 E8D2F9                  		call	IsSFTNet
  3912 000024D9 7419                    		jz	short SaveLocal
  3913 000024DB 268B451D                		mov	ax, [es:di+1Dh]
  3914 000024DF 89441A                  		mov	[si+1Ah], ax
  3915 000024E2 06                      		push	es
  3916 000024E3 57                      		push	di
  3917 000024E4 26C47D19                		les	di, [es:di+19h]
  3918 000024E8 897C1C                  		mov	[si+1Ch], di
  3919 000024EB 8C441E                  		mov	word [si+1Eh], es
  3920 000024EE 5F                      		pop	di
  3921 000024EF 07                      		pop	es
  3922 000024F0 B380                    		mov	bl, 80h
  3923 000024F2 EB4E                    		jmp	short SaveSFN
  3924                                  SaveLocal:
  3925 000024F4 E8B64C                  		call	CheckShare
  3926 000024F7 7403                    		jz	short SaveNoShare
  3927 000024F9 EB42                    		jmp	short SaveShare
  3928                                  
  3929 000024FB 90                      		nop
  3930                                  SaveNoShare:
  3931 000024FC 26F745058000            		test	word [es:di+5], 80h
  3932 00002502 7527                    		jnz	short SaveNoShareDev
  3933 00002504 268B451D                		mov	ax, [es:di+1Dh]
  3934 00002508 89441D                  		mov	[si+1Dh], ax
  3935 0000250B 268A451F                		mov	al, [es:di+1Fh]
  3936 0000250F 88441F                  		mov	[si+1Fh], al
  3937 00002512 268B450B                		mov	ax, [es:di+0Bh]
  3938 00002516 89441B                  		mov	[si+1Bh], ax
  3939 00002519 B300                    		mov	bl, 0
  3940                                  SetFCBBits:
  3941 0000251B 268B4505                		mov	ax, [es:di+5]
  3942 0000251F 24C0                    		and	al, 0C0h
  3943 00002521 260A4502                		or	al, [es:di+2]
  3944 00002525 88441A                  		mov	[si+1Ah], al
  3945 00002528 EB18                    		jmp	short SaveSFN
  3946                                  
  3947 0000252A 90                      		nop
  3948                                  SaveNoShareDev:
  3949 0000252B 268B4507                		mov	ax, [es:di+7]
  3950 0000252F 89441A                  		mov	[si+1Ah], ax
  3951 00002532 268B4509                		mov	ax, [es:di+9]
  3952 00002536 89441C                  		mov	[si+1Ch], ax
  3953 00002539 B340                    		mov	bl, 40h
  3954 0000253B EBDE                    		jmp	short SetFCBBits
  3955                                  
  3956                                  ; ---------------------------------------------------------------------------
  3957                                  
  3958                                  		; 07/09/2022
  3959                                  SaveShare:
  3960 0000253D 36FF1E[8400]            		call	far [ss:ShSave]
  3961                                  SaveSFN:
  3962 00002542 268B4505                		mov	ax, [es:di+5]
  3963 00002546 243F                    		and	al, 3Fh
  3964 00002548 08D8                    		or	al, bl
  3965 0000254A 884419                  		mov	[si+19h], al
  3966 0000254D 8D45FA                  		lea	ax, [di-6]
  3967 00002550 362B06[4000]            		sub	ax, word [ss:SFTFCB]
  3968 00002555 B335                    		mov	bl, 53
  3969 00002557 F6F3                    		div	bl
  3970 00002559 884418                  		mov	[si+18h], al
  3971 0000255C 36A1[1000]              		mov	ax, [ss:FCBLRU]
  3972 00002560 40                      		inc	ax
  3973 00002561 26894515                		mov	[es:di+15h], ax
  3974 00002565 7506                    		jnz	short SimpleStuff
  3975 00002567 BB1500                  		mov	bx, 15h
  3976 0000256A E80500                  		call	ResetLRU
  3977                                  SimpleStuff:
  3978 0000256D 36A3[1000]              		mov	[ss:FCBLRU], ax
  3979 00002571 C3                      		retn
  3980                                  
  3981                                  ; ---------------------------------------------------------------------------
  3982                                  
  3983                                  		; 07/09/2022
  3984                                  ResetLRU:
  3985 00002572 B80080                  		mov	ax, 8000h
  3986 00002575 06                      		push	es
  3987 00002576 57                      		push	di
  3988 00002577 2EC43E[4000]            		les	di, [cs:SFTFCB]
  3989 0000257C 268B4D04                		mov	cx, [es:di+4]
  3990 00002580 8D7D06                  		lea	di, [di+6]
  3991                                  ovScan:
  3992 00002583 262901                  		sub	[es:bx+di], ax
  3993 00002586 7703                    		ja	short ovLoop
  3994 00002588 268901                  		mov	[es:bx+di], ax
  3995                                  ovLoop:
  3996 0000258B 83C735                  		add	di, 53
  3997 0000258E E2F3                    		loop	ovScan
  3998 00002590 5F                      		pop	di
  3999 00002591 07                      		pop	es
  4000 00002592 268901                  		mov	[es:bx+di], ax
  4001 00002595 C3                      		retn
  4002                                  
  4003                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4004                                  
  4005                                  		; 07/09/2022
  4006                                  SetOpenAge:
  4007 00002596 2EA1[1200]              		mov	ax, [cs:OpenLRU]
  4008 0000259A 40                      		inc	ax
  4009 0000259B 26894517                		mov	[es:di+17h], ax
  4010 0000259F 7506                    		jnz	short SetDone
  4011 000025A1 BB1700                  		mov	bx, 17h
  4012 000025A4 E8CBFF                  		call	ResetLRU
  4013                                  SetDone:
  4014 000025A7 2EA3[1200]              		mov	[cs:OpenLRU], ax
  4015 000025AB C3                      		retn
  4016                                  
  4017                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4018                                  
  4019                                  		; 07/09/2022
  4020                                  LRUFCB:
  4021 000025AC E8D1EF                  		call	save_world
  4022 000025AF 2E8B2E[4400]            		mov	bp, [cs:KEEPCOUNT]
  4023 000025B4 31C0                    		xor	ax, ax
  4024                                  lru1:
  4025 000025B6 83FD00                  		cmp	bp, 0
  4026 000025B9 7452                    		jz	short lru75
  4027 000025BB 4D                      		dec	bp
  4028 000025BC BBFFFF                  		mov	bx, -1
  4029 000025BF 89DE                    		mov	si, bx
  4030 000025C1 2EC43E[4000]            		les	di, [cs:SFTFCB]
  4031 000025C6 268B4D04                		mov	cx, [es:di+4]
  4032 000025CA 8D7D06                  		lea	di, [di+6]
  4033                                  lru2:
  4034 000025CD 26833D00                		cmp	word [es:di], 0
  4035 000025D1 7406                    		jz	short lru25
  4036 000025D3 26833DFF                		cmp	word [es:di], 0FFFFh
  4037 000025D7 7505                    		jnz	short lru3
  4038                                  lru25:
  4039 000025D9 89FE                    		mov	si, di
  4040 000025DB EB6A                    		jmp	short lru11
  4041                                  
  4042 000025DD 90                      		nop
  4043                                  lru3:
  4044 000025DE 26F745050080            		test	word [es:di+5], 8000h
  4045 000025E4 7505                    		jnz	short lru35
  4046 000025E6 E8C44B                  		call	CheckShare
  4047 000025E9 7410                    		jz	short lru5
  4048                                  lru35:
  4049 000025EB 268B5517                		mov	dx, [es:di+17h]
  4050 000025EF 39C2                    		cmp	dx, ax
  4051 000025F1 7208                    		jb	short lru5
  4052 000025F3 39DA                    		cmp	dx, bx
  4053 000025F5 7304                    		jnb	short lru5
  4054 000025F7 89D3                    		mov	bx, dx
  4055 000025F9 89FE                    		mov	si, di
  4056                                  lru5:
  4057 000025FB 83C735                  		add	di, 53
  4058 000025FE E2CD                    		loop	lru2
  4059 00002600 83FEFF                  		cmp	si, -1
  4060 00002603 7408                    		jz	short lru75
  4061 00002605 8D4701                  		lea	ax, [bx+1]
  4062 00002608 EBAC                    		jmp	short lru1
  4063                                  lru65:
  4064 0000260A F9                      		stc
  4065 0000260B EB70                    		jmp	short lruDead
  4066                                  lru75:
  4067 0000260D BBFFFF                  		mov	bx, -1
  4068 00002610 89DE                    		mov	si, bx
  4069 00002612 2EC43E[4000]            		les	di, [cs:SFTFCB]
  4070 00002617 268B4D04                		mov	cx, [es:di+4]
  4071 0000261B 8D7D06                  		lea	di, [di+6]
  4072                                  lru8:
  4073 0000261E 26F745050080            		test	word [es:di+5], 8000h
  4074 00002624 7505                    		jnz	short lru85
  4075 00002626 E8844B                  		call	CheckShare
  4076 00002629 7406                    		jz	short lru86
  4077                                  lru85:
  4078 0000262B 26394517                		cmp	[es:di+17h], ax
  4079 0000262F 720C                    		jb	short lru9
  4080                                  lru86:
  4081 00002631 26395D15                		cmp	[es:di+15h], bx
  4082 00002635 7306                    		jnb	short lru9
  4083 00002637 89FE                    		mov	si, di
  4084 00002639 268B5D15                		mov	bx, [es:di+15h]
  4085                                  lru9:
  4086 0000263D 83C735                  		add	di, 53
  4087 00002640 E2DC                    		loop	lru8
  4088                                  lru10:
  4089 00002642 83FEFF                  		cmp	si, -1
  4090 00002645 74C3                    		jz	short lru65
  4091                                  lru11:
  4092 00002647 89F7                    		mov	di, si
  4093 00002649 2E893E[3605]            		mov	word [cs:THISSFT], di
  4094 0000264E 2E8C06[3805]            		mov	word [cs:THISSFT+2], es
  4095 00002653 26F745050080            		test	word [es:di+5], 8000h
  4096 00002659 7505                    		jnz	short LRUClose
  4097 0000265B E84F4B                  		call	CheckShare
  4098 0000265E 7418                    		jz	short LRUDone
  4099                                  LRUClose:
  4100 00002660 16                      		push	ss
  4101 00002661 1F                      		pop	ds
  4102 00002662 C43E[3605]              		les	di, [THISSFT]
  4103 00002666 26833D00                		cmp	word [es:di], 0
  4104 0000266A 740C                    		jz	short LRUDone
  4105 0000266C E86013                  		call	DOS_CLOSE
  4106 0000266F 73EF                    		jnb	short LRUClose
  4107 00002671 3C06                    		cmp	al, 6
  4108 00002673 74EB                    		jz	short LRUClose
  4109 00002675 F9                      		stc
  4110 00002676 EB05                    		jmp	short lruDead
  4111                                  LRUDone:
  4112 00002678 30C0                    		xor	al, al
  4113 0000267A E8E700                  		call	BlastSFT
  4114                                  lruDead:
  4115 0000267D E8EDEE                  		call	restore_world
  4116 00002680 2EC43E[3605]            		les	di, [cs:THISSFT]
  4117 00002685 7201                    		jb	short LRUFCB_err
  4118 00002687 C3                      		retn
  4119                                  LRUFCB_err:
  4120 00002688 B023                    		mov	al, 23h
  4121 0000268A C3                      		retn
  4122                                  
  4123                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4124                                  
  4125                                  		; 07/09/2022
  4126                                  FCBRegen:
  4127 0000268B 8A4419                  		mov	al, [si+19h]
  4128 0000268E A880                    		test	al, 80h
  4129 00002690 741C                    		jz	short RegenNoSharing
  4130 00002692 E8184B                  		call	CheckShare
  4131 00002695 7509                    		jnz	short RegenFail
  4132 00002697 B80011                  		mov	ax, 1100h
  4133 0000269A CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - INSTALLATION	CHECK
  4134                                  					; Return: AL = 00h  not	installed, OK to install
  4135                                  					; 01h  not installed, not OK to	install
  4136                                  					; FFh  installed
  4137 0000269C 08C0                    		or	al, al
  4138 0000269E 740C                    		jz	short RegenDead
  4139                                  RegenFail:
  4140 000026A0 2EA1[E602]              		mov	ax, word [cs:USER_IN_AX]
  4141 000026A4 80FC10                  		cmp	ah, 10h
  4142 000026A7 7403                    		jz	short RegenDead
  4143 000026A9 E8CA01                  		call	FCBHardErr
  4144                                  RegenDead:
  4145 000026AC F9                      		stc
  4146                                  FCBRegen_retn:
  4147 000026AD C3                      		retn
  4148                                  
  4149                                  ; ---------------------------------------------------------------------------
  4150                                  
  4151                                  		; 09/09/2022
  4152                                  		; 07/09/2022
  4153                                  RegenNoSharing:
  4154 000026AE E8FC4A                  		call	CheckShare
  4155 000026B1 75ED                    		jnz	short RegenFail
  4156 000026B3 E8F6FE                  		call	LRUFCB
  4157 000026B6 72F5                    		jb	short FCBRegen_retn
  4158 000026B8 26C745020280            		mov	word [es:di+2], 8002h
  4159 000026BE 243F                    		and	al, 3Fh
  4160 000026C0 98                      		cbw
  4161 000026C1 0D0040                  		or	ax, 4000h
  4162 000026C4 8A4C1A                  		mov	cl, [si+1Ah]
  4163 000026C7 88CD                    		mov	ch, cl
  4164 000026C9 80E5C0                  		and	ch, 0C0h
  4165 000026CC 08E8                    		or	al, ch
  4166 000026CE 80E10F                  		and	cl, 0Fh
  4167 000026D1 26884D02                		mov	[es:di+2], cl
  4168 000026D5 26894505                		mov	[es:di+5], ax
  4169 000026D9 2EA1[E802]              		mov	ax, [cs:PROC_ID]
  4170 000026DD 26894531                		mov	[es:di+31h], ax
  4171 000026E1 1E                      		push	ds
  4172 000026E2 56                      		push	si
  4173 000026E3 06                      		push	es
  4174 000026E4 57                      		push	di
  4175 000026E5 16                      		push	ss
  4176 000026E6 07                      		pop	es
  4177 000026E7 BF[E604]                		mov	di, NAME1
  4178 000026EA B90800                  		mov	cx, 8
  4179 000026ED 46                      		inc	si
  4180                                  RegenCopyName:
  4181 000026EE AC                      		lodsb
  4182 000026EF E83CF7                  		call	Ucase
  4183 000026F2 AA                      		stosb
  4184 000026F3 E2F9                    		loop	RegenCopyName
  4185 000026F5 16                      		push	ss
  4186 000026F6 1F                      		pop	ds
  4187 000026F7 C606[0605]16            		mov	byte [ATTRIB], 16h
  4188 000026FC E8FB22                  		call	DEVNAME
  4189 000026FF 5F                      		pop	di
  4190 00002700 07                      		pop	es
  4191 00002701 5E                      		pop	si
  4192 00002702 1F                      		pop	ds
  4193 00002703 7219                    		jb	short RegenFileNoSharing
  4194 00002705 26887D05                		mov	[es:di+5], bh
  4195 00002709 26C6450400              		mov	byte [es:di+4], 0
  4196 0000270E 2EC536[3205]            		lds	si, [cs:DEVPT]
  4197 00002713 26897507                		mov	[es:di+7], si
  4198 00002717 268C5D09                		mov	word [es:di+9], ds
  4199 0000271B C3                      		retn
  4200                                  RegenDeadJ:
  4201 0000271C EB8E                    		jmp	short RegenDead
  4202                                  RegenFileNoSharing:
  4203 0000271E 268B4505                		mov	ax, [es:di+5]
  4204 00002722 83E03F                  		and	ax, 3Fh
  4205 00002725 1E                      		push	ds
  4206 00002726 56                      		push	si
  4207 00002727 E85040                  		call	Find_DPB
  4208 0000272A 26897507                		mov	[es:di+7], si
  4209 0000272E 268C5D09                		mov	word [es:di+9], ds
  4210 00002732 5E                      		pop	si
  4211 00002733 1F                      		pop	ds
  4212 00002734 72E6                    		jb	short RegenDeadJ
  4213 00002736 8B441D                  		mov	ax, [si+1Dh]
  4214 00002739 2689451D                		mov	[es:di+1Dh], ax
  4215 0000273D 8B441B                  		mov	ax, [si+1Bh]
  4216 00002740 2689450B                		mov	[es:di+0Bh], ax
  4217 00002744 2689451B                		mov	[es:di+1Bh], ax
  4218 00002748 8A441F                  		mov	al, [si+1Fh]
  4219 0000274B 2688451F                		mov	[es:di+1Fh], al
  4220 0000274F 26FF05                  		inc	word [es:di]
  4221 00002752 8D7401                  		lea	si, [si+1]
  4222 00002755 8D7D20                  		lea	di, [di+20h]
  4223 00002758 B90B00                  		mov	cx, 11
  4224                                  RegenCopyName2:
  4225 0000275B AC                      		lodsb
  4226 0000275C E8CFF6                  		call	Ucase
  4227 0000275F AA                      		stosb
  4228 00002760 E2F9                    		loop	RegenCopyName2
  4229 00002762 F8                      		clc
  4230 00002763 C3                      		retn
  4231                                  
  4232                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4233                                  
  4234                                  		; 07/09/2022
  4235                                  BlastSFT:
  4236 00002764 57                      		push	di
  4237 00002765 B93500                  		mov	cx, 53
  4238 00002768 F3AA                    		rep stosb
  4239 0000276A 5F                      		pop	di
  4240 0000276B 26C7050000              		mov	word [es:di], 0
  4241 00002770 26C745150000            		mov	word [es:di+15h], 0
  4242 00002776 26C74517FFFF            		mov	word [es:di+17h], -1
  4243                                  BlastSFT_retn:
  4244 0000277C C3                      		retn
  4245                                  
  4246                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4247                                  
  4248                                  		; 07/09/2022
  4249                                  CheckFCB:
  4250 0000277D 2EC43E[4000]            		les	di, [cs:SFTFCB]
  4251 00002782 26384504                		cmp	[es:di+4], al
  4252 00002786 7244                    		jb	short BadSFT
  4253 00002788 B335                    		mov	bl, 53
  4254 0000278A F6E3                    		mul	bl
  4255 0000278C 8D7D06                  		lea	di, [di+6]
  4256 0000278F 01C7                    		add	di, ax
  4257 00002791 2EA1[E802]              		mov	ax, [cs:PROC_ID]
  4258 00002795 26394531                		cmp	[es:di+31h], ax
  4259 00002799 7531                    		jnz	short BadSFT
  4260 0000279B 26833D00                		cmp	word [es:di], 0
  4261 0000279F 742B                    		jz	short BadSFT
  4262 000027A1 8A4419                  		mov	al, [si+19h]
  4263 000027A4 A880                    		test	al, 80h
  4264 000027A6 7442                    		jz	short CheckNoShare
  4265 000027A8 50                      		push	ax
  4266 000027A9 24C0                    		and	al, 0C0h
  4267 000027AB 3CC0                    		cmp	al, 0C0h
  4268 000027AD 58                      		pop	ax
  4269 000027AE 751E                    		jnz	short CheckNet
  4270 000027B0 2EFF1E[8800]            		call	far [cs:ShChk]
  4271 000027B5 7215                    		jb	short BadSFT
  4272 000027B7 EB06                    		jmp	short CheckD
  4273                                  
  4274                                  ; ---------------------------------------------------------------------------
  4275                                  
  4276                                  		; 07/09/2022
  4277                                  CheckFirClus:
  4278 000027B9 263B5D0B                		cmp	bx, [es:di+0Bh]
  4279 000027BD 750D                    		jnz	short BadSFT
  4280                                  CheckD:
  4281 000027BF 243F                    		and	al, 3Fh
  4282 000027C1 268A6505                		mov	ah, [es:di+5]
  4283 000027C5 80E43F                  		and	ah, 3Fh
  4284 000027C8 38C4                    		cmp	ah, al
  4285 000027CA 74B0                    		jz	short BlastSFT_retn
  4286                                  BadSFT:
  4287 000027CC F9                      		stc
  4288 000027CD C3                      		retn
  4289                                  
  4290                                  ; ---------------------------------------------------------------------------
  4291                                  
  4292                                  		; 07/09/2022
  4293                                  CheckNet:
  4294 000027CE 8B441A                  		mov	ax, [si+1Ah]
  4295 000027D1 263B451D                		cmp	ax, [es:di+1Dh]
  4296 000027D5 75F5                    		jnz	short BadSFT
  4297 000027D7 8B441C                  		mov	ax, [si+1Ch]
  4298 000027DA 263B4519                		cmp	ax, [es:di+19h]
  4299 000027DE 75EC                    		jnz	short BadSFT
  4300 000027E0 8B441E                  		mov	ax, [si+1Eh]
  4301 000027E3 263B451B                		cmp	ax, [es:di+1Bh]
  4302 000027E7 75E3                    		jnz	short BadSFT
  4303                                  CheckNet_retn:
  4304 000027E9 C3                      		retn
  4305                                  
  4306                                  ; ---------------------------------------------------------------------------
  4307                                  
  4308                                  		; 07/09/2022
  4309                                  CheckNoShare:
  4310 000027EA A840                    		test	al, 40h
  4311 000027EC 753F                    		jnz	short CheckNoShareDev
  4312 000027EE 8B5C1D                  		mov	bx, [si+1Dh]
  4313 000027F1 263B5D1D                		cmp	bx, [es:di+1Dh]
  4314 000027F5 75D5                    		jnz	short BadSFT
  4315 000027F7 8A5C1F                  		mov	bl, [si+1Fh]
  4316 000027FA 263A5D1F                		cmp	bl, [es:di+1Fh]
  4317 000027FE 75CC                    		jnz	short BadSFT
  4318 00002800 8A5C1A                  		mov	bl, [si+1Ah]
  4319 00002803 268A7D05                		mov	bh, [es:di+5]
  4320 00002807 30DF                    		xor	bh, bl
  4321 00002809 80E7C0                  		and	bh, 0C0h
  4322 0000280C 75BE                    		jnz	short BadSFT
  4323 0000280E 26325D02                		xor	bl, [es:di+2]
  4324 00002812 80E30F                  		and	bl, 0Fh
  4325 00002815 75B5                    		jnz	short BadSFT
  4326 00002817 57                      		push	di
  4327 00002818 56                      		push	si
  4328 00002819 8D7D20                  		lea	di, [di+20h]
  4329 0000281C 8D7401                  		lea	si, [si+1]
  4330 0000281F B90B00                  		mov	cx, 0Bh
  4331 00002822 F3A6                    		repe cmpsb
  4332 00002824 5E                      		pop	si
  4333 00002825 5F                      		pop	di
  4334 00002826 75A4                    		jnz	short BadSFT
  4335 00002828 8B5C1B                  		mov	bx, [si+1Bh]
  4336 0000282B EB8C                    		jmp	short CheckFirClus
  4337                                  
  4338                                  CheckNoShareDev:
  4339 0000282D 8B5C1A                  		mov	bx, [si+1Ah]
  4340 00002830 263B5D07                		cmp	bx, [es:di+7]
  4341 00002834 7596                    		jnz	short BadSFT
  4342 00002836 8B5C1C                  		mov	bx, [si+1Ch]
  4343 00002839 263B5D09                		cmp	bx, [es:di+9]
  4344 0000283D 758D                    		jnz	short BadSFT
  4345 0000283F E97DFF                  		jmp	CheckD
  4346                                  
  4347                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4348                                  
  4349                                  		; 07/09/2022
  4350                                  SFTFromFCB:
  4351 00002842 50                      		push	ax
  4352 00002843 53                      		push	bx
  4353 00002844 8A4418                  		mov	al, [si+18h]
  4354 00002847 E833FF                  		call	CheckFCB
  4355 0000284A 5B                      		pop	bx
  4356 0000284B 58                      		pop	ax
  4357 0000284C 2E893E[3605]            		mov	word [cs:THISSFT], di
  4358 00002851 2E8C06[3805]            		mov	word [cs:THISSFT+2], es
  4359 00002856 730F                    		jnb	short SetSFT
  4360 00002858 E825ED                  		call	save_world
  4361 0000285B E82DFE                  		call	FCBRegen
  4362 0000285E E80CED                  		call	restore_world
  4363 00002861 2EA1[D202]              		mov	ax, [cs:EXTERR]
  4364 00002865 7282                    		jb	short CheckNet_retn
  4365                                  SetSFT:
  4366 00002867 2EC43E[3605]            		les	di, [cs:THISSFT]
  4367 0000286C 2EFF36[E802]            		push	word [cs:PROC_ID]
  4368 00002871 268F4531                		pop	word [es:di+31h]
  4369 00002875 C3                      		retn
  4370                                  
  4371                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4372                                  
  4373                                  		; 07/09/2022
  4374                                  FCBHardErr:
  4375 00002876 B82300                  		mov	ax, 23h
  4376 00002879 2EC606[F702]08          		mov	byte [cs:ALLOWED], 8
  4377 0000287F 2EC42E[2405]            		les	bp, [cs:THISDPB]
  4378 00002884 BF0100                  		mov	di, 1
  4379 00002887 89F9                    		mov	cx, di
  4380 00002889 268B560B                		mov	dx, [es:bp+0Bh]
  4381 0000288D E8BE2E                  		call	HARDERR
  4382 00002890 F9                      		stc
  4383 00002891 C3                      		retn
  4384                                  
  4385                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4386                                  
  4387                                  		; 07/09/2022
  4388                                  GetRR:
  4389 00002892 8B4421                  		mov	ax, [si+21h]
  4390 00002895 8B5423                  		mov	dx, [si+23h]
  4391 00002898 83FB40                  		cmp	bx, 64
  4392 0000289B 7202                    		jb	short GetRRBye
  4393 0000289D 30F6                    		xor	dh, dh
  4394                                  GetRRBye:
  4395 0000289F C3                      		retn
  4396                                  
  4397                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4398                                  
  4399                                  		; 07/09/2022
  4400                                  GetExtent:
  4401 000028A0 8A4420                  		mov	al, [si+20h]
  4402 000028A3 8B540C                  		mov	dx, [si+0Ch]
  4403 000028A6 D0E0                    		shl	al, 1
  4404 000028A8 D1EA                    		shr	dx, 1
  4405 000028AA D0D8                    		rcr	al, 1
  4406 000028AC 88D4                    		mov	ah, dl
  4407 000028AE 88F2                    		mov	dl, dh
  4408 000028B0 30F6                    		xor	dh, dh
  4409 000028B2 C3                      		retn
  4410                                  
  4411                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4412                                  
  4413                                  		; 07/09/2022
  4414                                  SetExtent:
  4415 000028B3 50                      		push	ax
  4416 000028B4 52                      		push	dx
  4417 000028B5 89C1                    		mov	cx, ax
  4418 000028B7 247F                    		and	al, 7Fh
  4419 000028B9 884420                  		mov	[si+20h], al
  4420 000028BC 80E180                  		and	cl, 80h
  4421 000028BF D1E1                    		shl	cx, 1
  4422 000028C1 D1D2                    		rcl	dx, 1
  4423 000028C3 88E8                    		mov	al, ch
  4424 000028C5 88D4                    		mov	ah, dl
  4425 000028C7 89440C                  		mov	[si+0Ch], ax
  4426 000028CA 5A                      		pop	dx
  4427 000028CB 58                      		pop	ax
  4428 000028CC C3                      		retn
  4429                                  
  4430                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4431                                  
  4432                                  		; 07/09/2022
  4433                                  GetExtended:
  4434 000028CD 89D6                    		mov	si, dx
  4435 000028CF 803CFF                  		cmp	byte [si], -1
  4436 000028D2 7503                    		jnz	short GetBye
  4437 000028D4 83C607                  		add	si, 7
  4438                                  GetBye:
  4439 000028D7 39D6                    		cmp	si, dx
  4440                                  getextd_retn:
  4441 000028D9 C3                      		retn
  4442                                  
  4443                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4444                                  
  4445                                  		; 07/09/2022
  4446                                  GetRecSize:
  4447 000028DA 8B5C0E                  		mov	bx, [si+0Eh]
  4448 000028DD 09DB                    		or	bx, bx
  4449 000028DF 75F8                    		jnz	short getextd_retn
  4450 000028E1 BB8000                  		mov	bx, 128
  4451 000028E4 895C0E                  		mov	[si+0Eh], bx
  4452 000028E7 C3                      		retn
  4453                                  
  4454                                  ; ---------------------------------------------------------------------------
  4455                                  
  4456                                  		; 07/09/2022
  4457                                  FCBIO:
  4458 000028E8 55                      		push	bp
  4459 000028E9 89E5                    		mov	bp, sp
  4460 000028EB 83EC14                  		sub	sp, 20
  4461 000028EE 8846EC                  		mov	[bp-20], al
  4462 000028F1 C646FF00                		mov	byte [bp-1], 0
  4463 000028F5 E8D5FF                  		call	GetExtended
  4464 000028F8 F646EC08                		test	byte [bp-20], 8
  4465 000028FC 7503                    		jnz	short GetPos
  4466 000028FE B90100                  		mov	cx, 1
  4467                                  GetPos:
  4468 00002901 894EFD                  		mov	[bp-3],	cx
  4469 00002904 E899FF                  		call	GetExtent
  4470 00002907 E8D0FF                  		call	GetRecSize
  4471 0000290A 895EF7                  		mov	[bp-9],	bx
  4472 0000290D F646EC02                		test	byte [bp-20], 2
  4473 00002911 7403                    		jz	short GetRec
  4474 00002913 E87CFF                  		call	GetRR
  4475                                  GetRec:
  4476 00002916 8946F9                  		mov	[bp-7],	ax
  4477 00002919 8956FB                  		mov	[bp-5],	dx
  4478 0000291C E894FF                  		call	SetExtent
  4479 0000291F 8B46FB                  		mov	ax, [bp-5]
  4480 00002922 F7E3                    		mul	bx
  4481 00002924 89C7                    		mov	di, ax
  4482 00002926 8B46F9                  		mov	ax, [bp-7]
  4483 00002929 F7E3                    		mul	bx
  4484 0000292B 01FA                    		add	dx, di
  4485 0000292D 8946F3                  		mov	[bp-13], ax
  4486 00002930 8956F5                  		mov	[bp-11], dx
  4487 00002933 8B46FD                  		mov	ax, [bp-3]
  4488 00002936 F7E3                    		mul	bx
  4489 00002938 8946F1                  		mov	[bp-15], ax
  4490 0000293B 360306[DA02]            		add	ax, [ss:DMAADD]
  4491 00002940 83D200                  		adc	dx, 0
  4492 00002943 7419                    		jz	short DoOper
  4493 00002945 C646FF02                		mov	byte [bp-1], 2
  4494 00002949 36A1[DA02]              		mov	ax, [ss:DMAADD]
  4495 0000294D F7D8                    		neg	ax
  4496 0000294F 7501                    		jnz	short DoDiv
  4497 00002951 48                      		dec	ax
  4498                                  DoDiv:
  4499 00002952 31D2                    		xor	dx, dx
  4500 00002954 F7F3                    		div	bx
  4501 00002956 8946FD                  		mov	[bp-3],	ax
  4502 00002959 F7E3                    		mul	bx
  4503 0000295B 8946F1                  		mov	[bp-15], ax
  4504                                  DoOper:
  4505 0000295E 31DB                    		xor	bx, bx
  4506 00002960 895EEF                  		mov	[bp-17], bx
  4507 00002963 395EF1                  		cmp	[bp-15], bx
  4508 00002966 7506                    		jnz	short DoGetExt
  4509 00002968 F646FF02                		test	byte [bp-1], 2
  4510 0000296C 7576                    		jnz	short SkipOp
  4511                                  DoGetExt:
  4512 0000296E E8D1FE                  		call	SFTFromFCB
  4513 00002971 730F                    		jnb	short ContinueOp
  4514                                  FCBDeath:
  4515 00002973 E813ED                  		call	FCB_Ret_Err
  4516 00002976 C746ED0000              		mov	word [bp-19], 0
  4517 0000297B C646FF01                		mov	byte [bp-1], 1
  4518 0000297F E9F000                  		jmp	FCBSave
  4519                                  ContinueOp:
  4520 00002982 8B4410                  		mov	ax, [si+10h]
  4521 00002985 26894511                		mov	[es:di+11h], ax
  4522 00002989 8B4412                  		mov	ax, [si+12h]
  4523 0000298C 26894513                		mov	[es:di+13h], ax
  4524 00002990 8B46F3                  		mov	ax, [bp-13]
  4525 00002993 8B56F5                  		mov	dx, [bp-11]
  4526 00002996 26894515                		mov	[es:di+15h], ax
  4527 0000299A 26875517                		xchg	dx, [es:di+17h]
  4528 0000299E 52                      		push	dx
  4529 0000299F 8B4EF1                  		mov	cx, [bp-15]
  4530 000029A2 BF[133D]                		mov	di, DOS_READ
  4531 000029A5 F646EC04                		test	byte [bp-20], 4
  4532 000029A9 7503                    		jnz	short DoContext
  4533 000029AB BF[983E]                		mov	di, DOS_WRITE
  4534                                  DoContext:
  4535 000029AE 55                      		push	bp
  4536 000029AF 1E                      		push	ds
  4537 000029B0 56                      		push	si
  4538 000029B1 16                      		push	ss
  4539 000029B2 1F                      		pop	ds
  4540 000029B3 FFD7                    		call	di ; DOS_READ or DOS_WRITE
  4541 000029B5 5E                      		pop	si
  4542 000029B6 1F                      		pop	ds
  4543 000029B7 5D                      		pop	bp
  4544 000029B8 72B9                    		jb	short FCBDeath
  4545 000029BA 36803E[840F]00          		cmp	byte [ss:DISK_FULL], 0
  4546 000029C0 740A                    		jz	short NODSKFULL
  4547 000029C2 36C606[840F]00          		mov	byte [ss:DISK_FULL], 0
  4548 000029C8 C646FF01                		mov	byte [bp-1], 1
  4549                                  NODSKFULL:
  4550 000029CC 894EEF                  		mov	[bp-17], cx
  4551 000029CF E8FFFA                  		call	SaveFCBInfo
  4552 000029D2 268F4517                		pop	word [es:di+17h]
  4553 000029D6 268B4511                		mov	ax, [es:di+11h]
  4554 000029DA 894410                  		mov	[si+10h], ax
  4555 000029DD 268B4513                		mov	ax, [es:di+13h]
  4556 000029E1 894412                  		mov	[si+12h], ax
  4557                                  SkipOp:
  4558 000029E4 8B46EF                  		mov	ax, [bp-17]
  4559 000029E7 31D2                    		xor	dx, dx
  4560 000029E9 F776F7                  		div	word [bp-9]
  4561 000029EC 8946ED                  		mov	[bp-19], ax
  4562 000029EF 0146F9                  		add	[bp-7],	ax
  4563 000029F2 8356FB00                		adc	word [bp-5], 0
  4564 000029F6 3B46FD                  		cmp	ax, [bp-3]
  4565 000029F9 7412                    		jz	short TryBlank
  4566 000029FB F646EC04                		test	byte [bp-20], 4
  4567 000029FF 7508                    		jnz	short SetEOF
  4568 00002A01 26F745058000            		test	word [es:di+5], 80h
  4569 00002A07 7504                    		jnz	short TryBlank
  4570                                  SetEOF:
  4571 00002A09 C646FF01                		mov	byte [bp-1], 1
  4572                                  TryBlank:
  4573 00002A0D 09D2                    		or	dx, dx
  4574 00002A0F 7426                    		jz	short SetExt
  4575 00002A11 8346F901                		add	word [bp-7], 1
  4576 00002A15 8356FB00                		adc	word [bp-5], 0
  4577 00002A19 F646EC04                		test	byte [bp-20], 4
  4578 00002A1D 7418                    		jz	short SetExt
  4579 00002A1F FF46ED                  		inc	word [bp-19]
  4580 00002A22 C646FF03                		mov	byte [bp-1], 3
  4581 00002A26 8B4EF7                  		mov	cx, [bp-9]
  4582 00002A29 29D1                    		sub	cx, dx
  4583 00002A2B 30C0                    		xor	al, al
  4584 00002A2D 36C43E[DA02]            		les	di, [ss:DMAADD]
  4585 00002A32 037EEF                  		add	di, [bp-17]
  4586 00002A35 F3AA                    		rep stosb
  4587                                  SetExt:
  4588 00002A37 8B56FB                  		mov	dx, [bp-5]
  4589 00002A3A 8B46F9                  		mov	ax, [bp-7]
  4590 00002A3D F646EC02                		test	byte [bp-20], 2
  4591 00002A41 7406                    		jz	short DoSetExt
  4592 00002A43 F646EC08                		test	byte [bp-20], 8
  4593 00002A47 7403                    		jz	short TrySetRR
  4594                                  DoSetExt:
  4595 00002A49 E867FE                  		call	SetExtent
  4596                                  TrySetRR:
  4597 00002A4C F646EC08                		test	byte [bp-20], 8
  4598 00002A50 740F                    		jz	short TryReturn
  4599 00002A52 894421                  		mov	[si+21h], ax
  4600 00002A55 885423                  		mov	[si+23h], dl
  4601 00002A58 837C0E40                		cmp	word [si+0Eh], 64
  4602 00002A5C 7303                    		jnb	short TryReturn
  4603 00002A5E 887424                  		mov	[si+24h], dh
  4604                                  TryReturn:
  4605 00002A61 F646EC04                		test	byte [bp-20], 4
  4606 00002A65 750B                    		jnz	short FCBSave
  4607 00002A67 1E                      		push	ds
  4608 00002A68 E8BBED                  		call	DATE16
  4609 00002A6B 1F                      		pop	ds
  4610 00002A6C 894414                  		mov	[si+14h], ax
  4611 00002A6F 895416                  		mov	[si+16h], dx
  4612                                  FCBSave:
  4613 00002A72 F646EC08                		test	byte [bp-20], 8
  4614 00002A76 7409                    		jz	short DoReturn
  4615 00002A78 8B4EED                  		mov	cx, [bp-19]
  4616 00002A7B E815EB                  		call	Get_User_Stack
  4617 00002A7E 894C04                  		mov	[si+4],	cx
  4618                                  DoReturn:
  4619 00002A81 8A46FF                  		mov	al, [bp-1]
  4620 00002A84 89EC                    		mov	sp, bp
  4621 00002A86 5D                      		pop	bp
  4622 00002A87 C3                      		retn
  4623                                  
  4624                                  ; ---------------------------------------------------------------------------
  4625                                  
  4626                                  		; 07/09/2022
  4627                                  _$FCB_OPEN:
  4628 00002A88 B80200                  		mov	ax, 2
  4629 00002A8B B9[7936]                		mov	cx, DOS_OPEN
  4630                                  DoAccess:
  4631 00002A8E 1E                      		push	ds
  4632 00002A8F 52                      		push	dx
  4633 00002A90 51                      		push	cx
  4634 00002A91 50                      		push	ax
  4635 00002A92 BF[6003]                		mov	di, OPENBUF
  4636 00002A95 E82E3E                  		call	TransFCB
  4637 00002A98 58                      		pop	ax
  4638 00002A99 59                      		pop	cx
  4639 00002A9A 5A                      		pop	dx
  4640 00002A9B 1F                      		pop	ds
  4641 00002A9C 7303                    		jnb	short FindFCB
  4642                                  FCBOpenErr:
  4643 00002A9E E9E8EB                  		jmp	FCB_Ret_Err
  4644                                  
  4645                                  ; ---------------------------------------------------------------------------
  4646                                  
  4647                                  		; 07/09/2022
  4648                                  FindFCB:
  4649 00002AA1 E829FE                  		call	GetExtended
  4650 00002AA4 E805FB                  		call	LRUFCB
  4651 00002AA7 722A                    		jb	short HardMessage
  4652 00002AA9 26C745020080            		mov	word [es:di+2], 8000h
  4653 00002AAF 1E                      		push	ds
  4654 00002AB0 56                      		push	si
  4655 00002AB1 53                      		push	bx
  4656 00002AB2 89CE                    		mov	si, cx
  4657 00002AB4 16                      		push	ss
  4658 00002AB5 1F                      		pop	ds
  4659 00002AB6 FFD6                    		call	si
  4660 00002AB8 5B                      		pop	bx
  4661 00002AB9 5E                      		pop	si
  4662 00002ABA 1F                      		pop	ds
  4663 00002ABB 36C43E[3605]            		les	di, [ss:THISSFT]
  4664 00002AC0 7318                    		jnb	short FCBOK
  4665 00002AC2 50                      		push	ax
  4666 00002AC3 B052                    		mov	al, 'R'
  4667 00002AC5 E89CFC                  		call	BlastSFT
  4668 00002AC8 58                      		pop	ax
  4669 00002AC9 83F804                  		cmp	ax, 4
  4670 00002ACC 7405                    		jz	short HardMessage
  4671 00002ACE 83F824                  		cmp	ax, 24h
  4672 00002AD1 7505                    		jnz	short DeadFCB
  4673                                  HardMessage:
  4674 00002AD3 50                      		push	ax
  4675 00002AD4 E89FFD                  		call	FCBHardErr
  4676 00002AD7 58                      		pop	ax
  4677                                  DeadFCB:
  4678 00002AD8 EBC4                    		jmp	short FCBOpenErr
  4679                                  
  4680                                  ; ---------------------------------------------------------------------------
  4681                                  
  4682                                  		; 07/09/2022
  4683                                  FCBOK:
  4684 00002ADA 26FF05                  		inc	word [es:di]
  4685 00002ADD E8F1F9                  		call	SaveFCBInfo
  4686 00002AE0 E8B3FA                  		call	SetOpenAge
  4687 00002AE3 26F745058000            		test	word [es:di+5], 80h
  4688 00002AE9 7509                    		jnz	short FCBNoDrive
  4689 00002AEB 8A04                    		mov	al, [si]
  4690 00002AED E85F3D                  		call	GetThisDrv
  4691 00002AF0 FEC0                    		inc	al
  4692 00002AF2 8804                    		mov	[si], al
  4693                                  FCBNoDrive:
  4694 00002AF4 C7440E8000              		mov	word [si+0Eh], 128
  4695 00002AF9 268B450D                		mov	ax, [es:di+0Dh]
  4696 00002AFD 894416                  		mov	[si+16h], ax
  4697 00002B00 268B450F                		mov	ax, [es:di+0Fh]
  4698 00002B04 894414                  		mov	[si+14h], ax
  4699 00002B07 268B4511                		mov	ax, [es:di+11h]
  4700 00002B0B 894410                  		mov	[si+10h], ax
  4701 00002B0E 268B4513                		mov	ax, [es:di+13h]
  4702 00002B12 894412                  		mov	[si+12h], ax
  4703 00002B15 31C0                    		xor	ax, ax
  4704 00002B17 89440C                  		mov	[si+0Ch], ax
  4705 00002B1A 36C43E[4000]            		les	di, [ss:SFTFCB]
  4706 00002B1F 268A6504                		mov	ah, [es:di+4]
  4707                                  OpenScan:
  4708 00002B23 3A4418                  		cmp	al, [si+18h]
  4709 00002B26 7407                    		jz	short SkipCheck
  4710 00002B28 50                      		push	ax
  4711 00002B29 E851FC                  		call	CheckFCB
  4712 00002B2C 58                      		pop	ax
  4713 00002B2D 7309                    		jnb	short OpenFound
  4714                                  SkipCheck:
  4715 00002B2F FEC0                    		inc	al
  4716 00002B31 38E0                    		cmp	al, ah
  4717 00002B33 75EE                    		jnz	short OpenScan
  4718                                  OpenDone:
  4719 00002B35 30C0                    		xor	al, al
  4720 00002B37 C3                      		retn
  4721                                  
  4722                                  ; ---------------------------------------------------------------------------
  4723                                  
  4724                                  		; 07/09/2022
  4725                                  OpenFound:
  4726 00002B38 884418                  		mov	[si+18h], al
  4727 00002B3B 26FF05                  		inc	word [es:di]
  4728 00002B3E 36A1[1000]              		mov	ax, [ss:FCBLRU]
  4729 00002B42 26894515                		mov	[es:di+15h], ax
  4730 00002B46 16                      		push	ss
  4731 00002B47 1F                      		pop	ds
  4732 00002B48 C43E[3605]              		les	di, [THISSFT]
  4733 00002B4C 26FF0D                  		dec	word [es:di]
  4734 00002B4F E88D46                  		call	ShareEnd
  4735 00002B52 B043                    		mov	al, 'C'
  4736 00002B54 E80DFC                  		call	BlastSFT
  4737 00002B57 EBDC                    		jmp	short OpenDone
  4738                                  
  4739                                  ; ---------------------------------------------------------------------------
  4740                                  
  4741                                  		; 07/09/2022
  4742                                  _$FCB_CREATE:
  4743 00002B59 B9[E235]                		mov	cx, DOS_CREATE
  4744 00002B5C 31C0                    		xor	ax, ax
  4745 00002B5E E86CFD                  		call	GetExtended
  4746 00002B61 7403                    		jz	short DoAccessJ
  4747 00002B63 8A44FF                  		mov	al, [si-1]
  4748                                  DoAccessJ:
  4749 00002B66 E925FF                  		jmp	DoAccess
  4750                                  
  4751                                  ; ---------------------------------------------------------------------------
  4752                                  
  4753                                  		; 07/09/2022
  4754                                  _$FCB_RANDOM_WRITE_BLOCK:
  4755 00002B69 B00A                    		mov	al, 0Ah
  4756 00002B6B E97AFD                  		jmp	FCBIO
  4757                                  
  4758                                  ; ---------------------------------------------------------------------------
  4759                                  
  4760                                  		; 07/09/2022
  4761                                  _$FCB_RANDOM_READ_BLOCK:
  4762 00002B6E B00E                    		mov	al, 0Eh
  4763 00002B70 E975FD                  		jmp	FCBIO
  4764                                  
  4765                                  ; ---------------------------------------------------------------------------
  4766                                  
  4767                                  		; 07/09/2022
  4768                                  _$FCB_SEQ_READ:
  4769 00002B73 B004                    		mov	al, 4
  4770 00002B75 E970FD                  		jmp	FCBIO
  4771                                  
  4772                                  ; ---------------------------------------------------------------------------
  4773                                  
  4774                                  		; 07/09/2022
  4775                                  _$FCB_SEQ_WRITE:
  4776 00002B78 B000                    		mov	al, 0
  4777 00002B7A E96BFD                  		jmp	FCBIO
  4778                                  
  4779                                  ; ---------------------------------------------------------------------------
  4780                                  
  4781                                  		; 07/09/2022
  4782                                  _$FCB_RANDOM_READ:
  4783 00002B7D B006                    		mov	al, 6
  4784 00002B7F E966FD                  		jmp	FCBIO
  4785                                  
  4786                                  ; ---------------------------------------------------------------------------
  4787                                  
  4788                                  		; 07/09/2022
  4789                                  _$FCB_RANDOM_WRITE:
  4790 00002B82 B002                    		mov	al, 2
  4791 00002B84 E961FD                  		jmp	FCBIO
  4792                                  
  4793                                  ; ---------------------------------------------------------------------------
  4794                                  
  4795                                  		; 07/09/2022
  4796                                  _$DIR_SEARCH_FIRST:
  4797 00002B87 368916[3E05]            		mov	word [ss:THISFCB], dx
  4798 00002B8C 368C1E[4005]            		mov	word [ss:THISFCB+2], ds
  4799 00002B91 89D6                    		mov	si, dx
  4800 00002B93 803CFF                  		cmp	byte [si], 0FFh
  4801 00002B96 7503                    		jnz	short NORMFCB4
  4802 00002B98 83C607                  		add	si, 7
  4803                                  NORMFCB4:
  4804 00002B9B FF34                    		push	word [si]
  4805 00002B9D 16                      		push	ss
  4806 00002B9E 07                      		pop	es
  4807 00002B9F BF[6003]                		mov	di, OPENBUF
  4808 00002BA2 E8213D                  		call	TransFCB
  4809 00002BA5 7304                    		jnb	short SearchIt
  4810 00002BA7 5B                      		pop	bx
  4811                                  DIR_SF_retn:
  4812 00002BA8 E9DEEA                  		jmp	FCB_Ret_Err
  4813                                  
  4814                                  ; ---------------------------------------------------------------------------
  4815                                  
  4816                                  		; 07/09/2022
  4817                                  SearchIt:
  4818 00002BAB 16                      		push	ss
  4819 00002BAC 1F                      		pop	ds
  4820 00002BAD FF36[DA02]              		push	word [DMAADD]
  4821 00002BB1 FF36[DC02]              		push	word [DMAADD+2]
  4822 00002BB5 C706[DA02][6004]        		mov	word [DMAADD], SEARCHBUF
  4823 00002BBB 8C1E[DC02]              		mov	[DMAADD+2], ds
  4824 00002BBF E8630C                  		call	DOS_SEARCH_FIRST
  4825 00002BC2 8F06[DC02]              		pop	word [DMAADD+2]
  4826 00002BC6 8F06[DA02]              		pop	word [DMAADD]
  4827 00002BCA 7303                    		jnb	short SearchSet
  4828 00002BCC 5B                      		pop	bx
  4829 00002BCD EBD9                    		jmp	short DIR_SF_retn
  4830                                  
  4831                                  ; ---------------------------------------------------------------------------
  4832                                  
  4833                                  		; 07/09/2022
  4834                                  SearchSet:
  4835 00002BCF BE[6004]                		mov	si, SEARCHBUF
  4836 00002BD2 C43E[3E05]              		les	di, [THISFCB]
  4837 00002BD6 F606[0705]FF            		test	byte [ExtFCB], 0FFh
  4838 00002BDB 7403                    		jz	short NORMFCB1
  4839 00002BDD 83C707                  		add	di, 7
  4840                                  NORMFCB1:
  4841 00002BE0 5B                      		pop	bx
  4842 00002BE1 08DB                    		or	bl, bl
  4843 00002BE3 7506                    		jnz	short SearchDrv
  4844 00002BE5 8A1E[E402]              		mov	bl, [CURDRV]
  4845 00002BE9 FEC3                    		inc	bl
  4846                                  SearchDrv:
  4847 00002BEB AC                      		lodsb
  4848 00002BEC 86C3                    		xchg	al, bl
  4849 00002BEE 47                      		inc	di
  4850 00002BEF B90A00                  		mov	cx, 10
  4851 00002BF2 F3A5                    		rep movsw
  4852 00002BF4 86C3                    		xchg	al, bl
  4853 00002BF6 AA                      		stosb
  4854 00002BF7 C43E[DA02]              		les	di, [DMAADD]
  4855 00002BFB F606[0705]FF            		test	byte [ExtFCB], 0FFh
  4856 00002C00 740E                    		jz	short NORMFCB2
  4857 00002C02 B0FF                    		mov	al, 0FFh
  4858 00002C04 AA                      		stosb
  4859 00002C05 FEC0                    		inc	al
  4860 00002C07 B90500                  		mov	cx, 5
  4861 00002C0A F3AA                    		rep stosb
  4862 00002C0C A0[0805]                		mov	al, byte [ExtFCB+1]
  4863 00002C0F AA                      		stosb
  4864                                  NORMFCB2:
  4865 00002C10 88D8                    		mov	al, bl
  4866 00002C12 AA                      		stosb
  4867 00002C13 B91000                  		mov	cx, 16
  4868 00002C16 F3A5                    		rep movsw
  4869 00002C18 E96BEA                  		jmp	NO_OP
  4870                                  
  4871                                  ; ---------------------------------------------------------------------------
  4872                                  
  4873                                  		; 07/09/2022
  4874                                  _$DIR_SEARCH_NEXT:
  4875 00002C1B 368916[3E05]            		mov	word [ss:THISFCB], dx
  4876 00002C20 368C1E[4005]            		mov	word [ss:THISFCB+2], ds
  4877 00002C25 36C606[0805]00          		mov	byte [ss:ExtFCB+1], 0
  4878 00002C2B 36C606[0705]00          		mov	byte [ss:ExtFCB], 0
  4879 00002C31 16                      		push	ss
  4880 00002C32 07                      		pop	es
  4881 00002C33 BF[6004]                		mov	di, SEARCHBUF
  4882 00002C36 89D6                    		mov	si, dx
  4883 00002C38 803CFF                  		cmp	byte [si], 0FFh
  4884 00002C3B 750D                    		jnz	short NORMFCB6
  4885 00002C3D 83C606                  		add	si, 6
  4886 00002C40 AC                      		lodsb
  4887 00002C41 36A2[0805]              		mov	byte [ss:ExtFCB+1], al
  4888 00002C45 36FE0E[0705]            		dec	byte [ss:ExtFCB]
  4889                                  NORMFCB6:
  4890 00002C4A AC                      		lodsb
  4891 00002C4B 50                      		push	ax
  4892 00002C4C 8A4414                  		mov	al, [si+20]
  4893 00002C4F AA                      		stosb
  4894 00002C50 B90A00                  		mov	cx, 10
  4895 00002C53 F3A5                    		rep movsw
  4896 00002C55 16                      		push	ss
  4897 00002C56 1F                      		pop	ds
  4898 00002C57 FF36[DA02]              		push	word [DMAADD]
  4899 00002C5B FF36[DC02]              		push	word [DMAADD+2]
  4900 00002C5F C706[DA02][6004]        		mov	word [DMAADD], SEARCHBUF
  4901 00002C65 8C1E[DC02]              		mov	[DMAADD+2], ds
  4902 00002C69 E86E0C                  		call	DOS_SEARCH_NEXT
  4903 00002C6C 8F06[DC02]              		pop	word [DMAADD+2]
  4904 00002C70 8F06[DA02]              		pop	word [DMAADD]
  4905 00002C74 7203                    		jb	short SearchNoMore
  4906 00002C76 E956FF                  		jmp	SearchSet
  4907                                  SearchNoMore:
  4908 00002C79 C43E[3E05]              		les	di, [THISFCB]
  4909 00002C7D F606[0705]FF            		test	byte [ExtFCB], 0FFh
  4910 00002C82 7403                    		jz	short NORMFCB8
  4911 00002C84 83C707                  		add	di, 7
  4912                                  NORMFCB8:
  4913 00002C87 5B                      		pop	bx
  4914 00002C88 26881D                  		mov	[es:di], bl
  4915 00002C8B E9FBE9                  		jmp	FCB_Ret_Err
  4916                                  
  4917                                  ; ---------------------------------------------------------------------------
  4918                                  
  4919                                  		; 07/09/2022
  4920                                  _$FIND_FIRST:
  4921 00002C8E 89D6                    		mov	si, dx
  4922 00002C90 36880E[0805]            		mov	byte [ss:ExtFCB+1], cl
  4923 00002C95 BF[6003]                		mov	di, OPENBUF
  4924 00002C98 E8933C                  		call	TransPathSet
  4925 00002C9B 7305                    		jnb	short Find_it
  4926 00002C9D B003                    		mov	al, 3
  4927                                  fff_errj:
  4928 00002C9F E9D0E9                  		jmp	SYS_Ret_Err
  4929                                  Find_it:
  4930 00002CA2 16                      		push	ss
  4931 00002CA3 1F                      		pop	ds
  4932 00002CA4 FF36[DA02]              		push	word [DMAADD]
  4933 00002CA8 FF36[DC02]              		push	word [DMAADD+2]
  4934 00002CAC C706[DA02][6004]        		mov	word [DMAADD], SEARCHBUF
  4935 00002CB2 8C1E[DC02]              		mov	[DMAADD+2], ds
  4936 00002CB6 E86C0B                  		call	DOS_SEARCH_FIRST
  4937 00002CB9 8F06[DC02]              		pop	word [DMAADD+2]
  4938 00002CBD 8F06[DA02]              		pop	word [DMAADD]
  4939 00002CC1 7302                    		jnb	short FindSet
  4940                                  findit_errj:
  4941 00002CC3 EBDA                    		jmp	short fff_errj
  4942                                  
  4943                                  ; ---------------------------------------------------------------------------
  4944                                  
  4945                                  		; 07/09/2022
  4946                                  FindSet:
  4947 00002CC5 BE[6004]                		mov	si, SEARCHBUF
  4948 00002CC8 C43E[DA02]              		les	di, [DMAADD]
  4949 00002CCC B91500                  		mov	cx, 21
  4950 00002CCF F3A4                    		rep movsb
  4951 00002CD1 56                      		push	si
  4952 00002CD2 8A440B                  		mov	al, [si+0Bh]
  4953 00002CD5 AA                      		stosb
  4954 00002CD6 83C616                  		add	si, 16h
  4955 00002CD9 A5                      		movsw
  4956 00002CDA A5                      		movsw
  4957 00002CDB 46                      		inc	si
  4958 00002CDC 46                      		inc	si
  4959 00002CDD A5                      		movsw
  4960 00002CDE A5                      		movsw
  4961 00002CDF 5E                      		pop	si
  4962 00002CE0 E83500                  		call	PackName
  4963 00002CE3 E980E9                  		jmp	SYS_RET_OK
  4964                                  
  4965                                  ; ---------------------------------------------------------------------------
  4966                                  
  4967                                  		; 07/09/2022
  4968                                  _$FIND_NEXT:
  4969 00002CE6 16                      		push	ss
  4970 00002CE7 07                      		pop	es
  4971 00002CE8 BF[6004]                		mov	di, SEARCHBUF
  4972 00002CEB 36C536[DA02]            		lds	si, [ss:DMAADD]
  4973 00002CF0 B91500                  		mov	cx, 21
  4974 00002CF3 F3A4                    		rep movsb
  4975 00002CF5 16                      		push	ss
  4976 00002CF6 1F                      		pop	ds
  4977 00002CF7 FF36[DA02]              		push	word [DMAADD]
  4978 00002CFB FF36[DC02]              		push	word [DMAADD+2]
  4979 00002CFF C706[DA02][6004]        		mov	word [DMAADD], SEARCHBUF
  4980 00002D05 8C1E[DC02]              		mov	[DMAADD+2], ds
  4981 00002D09 E8CE0B                  		call	DOS_SEARCH_NEXT
  4982 00002D0C 8F06[DC02]              		pop	word [DMAADD+2]
  4983 00002D10 8F06[DA02]              		pop	word [DMAADD]
  4984 00002D14 73AF                    		jnb	short FindSet
  4985 00002D16 EBAB                    		jmp	short findit_errj
  4986                                  
  4987                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  4988                                  
  4989                                  		; 07/09/2022
  4990                                  PackName:
  4991 00002D18 B90800                  		mov	cx, 8
  4992 00002D1B F3A4                    		rep movsb
  4993                                  main_kill_tail:
  4994 00002D1D 26807DFF20              		cmp	byte [es:di-1], ' '
  4995 00002D22 7507                    		jnz	short find_check_dot
  4996 00002D24 4F                      		dec	di
  4997 00002D25 41                      		inc	cx
  4998 00002D26 83F908                  		cmp	cx, 8
  4999 00002D29 72F2                    		jb	short main_kill_tail
  5000                                  find_check_dot:
  5001 00002D2B 813C2020                		cmp	word [si], 2020h
  5002 00002D2F 7506                    		jnz	short got_ext
  5003 00002D31 807C0220                		cmp	byte [si+2], 20h
  5004 00002D35 7412                    		jz	short find_done
  5005                                  got_ext:
  5006 00002D37 B02E                    		mov	al, '.'
  5007 00002D39 AA                      		stosb
  5008 00002D3A B90300                  		mov	cx, 3
  5009 00002D3D F3A4                    		rep movsb
  5010                                  ext_kill_tail:
  5011 00002D3F 26807DFF20              		cmp	byte [es:di-1], ' '
  5012 00002D44 7503                    		jnz	short find_done
  5013 00002D46 4F                      		dec	di
  5014 00002D47 EBF6                    		jmp	short ext_kill_tail
  5015                                  find_done:
  5016 00002D49 31C0                    		xor	ax, ax
  5017 00002D4B AA                      		stosb
  5018 00002D4C C3                      		retn
  5019                                  
  5020                                  ; ---------------------------------------------------------------------------
  5021                                  
  5022                                  		; 07/09/2022
  5023                                  _$CURRENT_DIR:
  5024 00002D4D E8E5F1                  		call	EcritDisk
  5025 00002D50 88D0                    		mov	al, dl
  5026 00002D52 E8E33A                  		call	GETVISDRV
  5027 00002D55 7308                    		jnb	short CurrentValidate
  5028                                  CurdirErr:
  5029 00002D57 E8E3F1                  		call	LcritDisk
  5030 00002D5A B00F                    		mov	al, 0Fh
  5031                                  curdir_errj:
  5032 00002D5C E913E9                  		jmp	SYS_Ret_Err
  5033                                  CurrentValidate:
  5034 00002D5F 1E                      		push	ds
  5035 00002D60 56                      		push	si
  5036 00002D61 2EC536[3A05]            		lds	si, [cs:THISCDS]
  5037 00002D66 F744430080              		test	word [si+43h], 8000h
  5038 00002D6B 7500                    		jnz	short $+2
  5039 00002D6D 2EC606[F802]00          		mov	byte [cs:NoSetDir], 0
  5040 00002D73 BF[6003]                		mov	di, OPENBUF
  5041 00002D76 E80F1D                  		call	ValidateCDS
  5042 00002D79 06                      		push	es
  5043 00002D7A 57                      		push	di
  5044 00002D7B 5E                      		pop	si
  5045 00002D7C 1F                      		pop	ds
  5046 00002D7D 5F                      		pop	di
  5047 00002D7E 07                      		pop	es
  5048 00002D7F 72D6                    		jb	short CurdirErr
  5049 00002D81 83C600                  		add	si, 0
  5050 00002D84 03744F                  		add	si, [si+4Fh]
  5051 00002D87 803C5C                  		cmp	byte [si], '\'
  5052 00002D8A 7501                    		jnz	short CurrentCopy
  5053 00002D8C 46                      		inc	si
  5054                                  CurrentCopy:
  5055 00002D8D 50                      		push	ax
  5056 00002D8E AC                      		lodsb
  5057 00002D8F 08C0                    		or	al, al
  5058 00002D91 7414                    		jz	short FOK
  5059 00002D93 3C05                    		cmp	al, 5
  5060 00002D95 740E                    		jz	short FCHANGE
  5061 00002D97 EB02                    		jmp	short FFF
  5062                                  
  5063 00002D99 90                      		nop
  5064                                  FCPYNEXT:
  5065 00002D9A AC                      		lodsb
  5066                                  FFF:
  5067 00002D9B 3C5C                    		cmp	al, '\'
  5068 00002D9D 7508                    		jnz	short FOK
  5069 00002D9F AA                      		stosb
  5070 00002DA0 AC                      		lodsb
  5071 00002DA1 3C05                    		cmp	al, 5
  5072 00002DA3 7502                    		jnz	short FOK
  5073                                  FCHANGE:
  5074 00002DA5 B0E5                    		mov	al, 0E5h
  5075                                  FOK:
  5076 00002DA7 AA                      		stosb
  5077 00002DA8 08C0                    		or	al, al
  5078 00002DAA 75EE                    		jnz	short FCPYNEXT
  5079 00002DAC 58                      		pop	ax
  5080 00002DAD 30C0                    		xor	al, al
  5081 00002DAF E88BF1                  		call	LcritDisk
  5082 00002DB2 E9B1E8                  		jmp	SYS_RET_OK
  5083                                  
  5084                                  ; ---------------------------------------------------------------------------
  5085                                  
  5086                                  		; 07/09/2022
  5087                                  _$RMDIR:
  5088 00002DB5 52                      		push	dx
  5089 00002DB6 1E                      		push	ds
  5090 00002DB7 89D6                    		mov	si, dx
  5091 00002DB9 BF[6003]                		mov	di, OPENBUF
  5092 00002DBC 57                      		push	di
  5093 00002DBD E8763B                  		call	TransPathNoSet
  5094 00002DC0 5F                      		pop	di
  5095 00002DC1 7306                    		jnb	short rmlset
  5096 00002DC3 1F                      		pop	ds
  5097 00002DC4 5A                      		pop	dx
  5098 00002DC5 B003                    		mov	al, 3
  5099                                  rmdir_error:
  5100 00002DC7 EB93                    		jmp	short curdir_errj
  5101                                  rmlset:
  5102 00002DC9 36803E[1505]FF          		cmp	byte [ss:cMeta], -1
  5103 00002DCF 7512                    		jnz	short rmerr
  5104 00002DD1 16                      		push	ss
  5105 00002DD2 07                      		pop	es
  5106 00002DD3 30C0                    		xor	al, al
  5107                                  rmloop:
  5108 00002DD5 E8CA3A                  		call	GetCDSFromDrv
  5109 00002DD8 720F                    		jb	short rmcont
  5110 00002DDA E817F0                  		call	StrCmp
  5111 00002DDD 7404                    		jz	short rmerr
  5112 00002DDF FEC0                    		inc	al
  5113 00002DE1 EBF2                    		jmp	short rmloop
  5114                                  rmerr:
  5115 00002DE3 1F                      		pop	ds
  5116 00002DE4 5A                      		pop	dx
  5117 00002DE5 B010                    		mov	al, 10h
  5118                                  chdir_errj:
  5119 00002DE7 EBDE                    		jmp	short rmdir_error
  5120                                  rmcont:
  5121 00002DE9 1F                      		pop	ds
  5122 00002DEA 5A                      		pop	dx
  5123 00002DEB BE[303C]                		mov	si, DOS_RMDIR
  5124                                  		;jmp	DoDirCall
  5125                                  		; 09/09/2022 - Temporary !
  5126 00002DEE E97F00                  		db	0E9h, 7Fh, 0
  5127                                  
  5128                                  ; ---------------------------------------------------------------------------
  5129                                  
  5130                                  		; 07/09/2022
  5131                                  _$CHDIR:
  5132 00002DF1 BF[6003]                		mov	di, OPENBUF
  5133 00002DF4 89D6                    		mov	si, dx
  5134 00002DF6 E8313B                  		call	TransPath
  5135 00002DF9 7304                    		jnb	short ChDirCrack
  5136                                  ChDirErrP:
  5137 00002DFB B003                    		mov	al, 3
  5138                                  ChdirErr:
  5139 00002DFD EBE8                    		jmp	short chdir_errj
  5140                                  ChDirCrack:
  5141 00002DFF 803E[1505]FF            		cmp	byte [cMeta], 0FFh
  5142 00002E04 75F5                    		jnz	short ChDirErrP
  5143 00002E06 C43E[3A05]              		les	di, [THISCDS]
  5144 00002E0A 83FFFF                  		cmp	di, -1
  5145 00002E0D 74EC                    		jz	short ChDirErrP
  5146 00002E0F E8E90D                  		call	DOS_CHDIR
  5147 00002E12 72E9                    		jb	short ChdirErr
  5148 00002E14 C43E[3A05]              		les	di, [THISCDS]
  5149 00002E18 26F745430020            		test	word [es:di+43h], 2000h
  5150 00002E1E 7425                    		jz	short GotCDS
  5151 00002E20 06                      		push	es
  5152 00002E21 57                      		push	di
  5153 00002E22 51                      		push	cx
  5154 00002E23 E86DE7                  		call	Get_User_Stack
  5155 00002E26 8B7C06                  		mov	di, [si+6]
  5156 00002E29 8E5C0E                  		mov	ds, word [si+14]
  5157 00002E2C BE[6003]                		mov	si, OPENBUF
  5158 00002E2F 87F7                    		xchg	si, di
  5159 00002E31 30C0                    		xor	al, al
  5160 00002E33 57                      		push	di
  5161 00002E34 E8FF3A                  		call	TransPathNoSet
  5162 00002E37 5E                      		pop	si
  5163 00002E38 C43E[3A05]              		les	di, [THISCDS]
  5164 00002E3C 26C74549FFFF            		mov	word [es:di+49h], -1
  5165 00002E42 59                      		pop	cx
  5166 00002E43 5F                      		pop	di
  5167 00002E44 07                      		pop	es
  5168                                  GotCDS:
  5169 00002E45 16                      		push	ss
  5170 00002E46 1F                      		pop	ds
  5171 00002E47 8B36[4A05]              		mov	si, [WFP_START]
  5172 00002E4B 51                      		push	cx
  5173 00002E4C E8F1EF                  		call	DStrLen
  5174 00002E4F 83F943                  		cmp	cx, 67
  5175 00002E52 59                      		pop	cx
  5176 00002E53 77A6                    		ja	short ChDirErrP
  5177 00002E55 26F745430080            		test	word [es:di+43h], 8000h
  5178 00002E5B 7508                    		jnz	short SkipRecency
  5179 00002E5D 26894D49                		mov	[es:di+49h], cx
  5180 00002E61 C43E[3A05]              		les	di, [THISCDS]
  5181                                  SkipRecency:
  5182 00002E65 E8BDEF                  		call	FStrCpy
  5183 00002E68 30C0                    		xor	al, al
  5184                                  chdir_ok:
  5185 00002E6A E9F9E7                  		jmp	SYS_RET_OK
  5186                                  
  5187                                  ; ---------------------------------------------------------------------------
  5188                                  
  5189                                  		; 07/09/2022
  5190                                  _$MKDIR:
  5191 00002E6D BE[193B]                		mov	si, DOS_MKDIR
  5192                                  DoDirCall:
  5193 00002E70 BF[6003]                		mov	di, OPENBUF
  5194 00002E73 56                      		push	si
  5195 00002E74 89D6                    		mov	si, dx
  5196 00002E76 E8B13A                  		call	TransPath
  5197 00002E79 5E                      		pop	si
  5198 00002E7A 7305                    		jnb	short MkDirCrack
  5199                                  MkErrP:
  5200 00002E7C B003                    		mov	al, 3
  5201                                  MkErr:
  5202 00002E7E E9F1E7                  		jmp	SYS_Ret_Err
  5203                                  MkDirCrack:
  5204 00002E81 36803E[1505]FF          		cmp	byte [ss:cMeta], -1
  5205 00002E87 75F3                    		jnz	short MkErrP
  5206 00002E89 16                      		push	ss
  5207 00002E8A 1F                      		pop	ds
  5208 00002E8B FFD6                    		call	si
  5209 00002E8D 72EF                    		jb	short MkErr
  5210 00002E8F EBD9                    		jmp	short chdir_ok
  5211                                  
  5212                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  5213                                  
  5214                                  		; 07/09/2022
  5215                                  _$IOCTL:
  5216 00002E91 8CDE                    		mov	si, ds
  5217 00002E93 16                      		push	ss
  5218 00002E94 1F                      		pop	ds
  5219 00002E95 3C03                    		cmp	al, 3
  5220 00002E97 7772                    		ja	short ioctl_1
  5221 00002E99 E82A38                  		call	SFFromHandle
  5222 00002E9C 7305                    		jnb	short ioctl_check_permissions
  5223                                  ioctl_bad_handle:
  5224 00002E9E B006                    		mov	al, 6
  5225                                  ioctl_error:
  5226 00002EA0 E9CFE7                  		jmp	SYS_Ret_Err
  5227                                  ioctl_check_permissions:
  5228 00002EA3 3C02                    		cmp	al, 2
  5229 00002EA5 7348                    		jnb	short ioctl_check_device2
  5230 00002EA7 3C00                    		cmp	al, 0
  5231 00002EA9 268A4505                		mov	al, [es:di+5]
  5232 00002EAD 741E                    		jz	short ioctl_read
  5233 00002EAF 08F6                    		or	dh, dh
  5234 00002EB1 7407                    		jz	short ioctl_check_device
  5235 00002EB3 B00D                    		mov	al, 0Dh
  5236 00002EB5 EBE9                    		jmp	short ioctl_error
  5237                                  ioctl_bad_funj2:
  5238 00002EB7 E91901                  		jmp	ioctl_bad_fun
  5239                                  
  5240                                  ; ---------------------------------------------------------------------------
  5241                                  
  5242                                  		; 07/09/2022
  5243                                  ioctl_check_device:
  5244 00002EBA A880                    		test	al, 80h
  5245 00002EBC 74F9                    		jz	short ioctl_bad_funj2
  5246 00002EBE C606[D102]04            		mov	byte [EXTERR_LOCUS], 4
  5247 00002EC3 80CA80                  		or	dl, 80h
  5248 00002EC6 26885505                		mov	[es:di+5], dl
  5249                                  ioctl_ok:
  5250 00002ECA E999E7                  		jmp	SYS_RET_OK
  5251                                  
  5252                                  ; ---------------------------------------------------------------------------
  5253                                  
  5254                                  		; 07/09/2022
  5255                                  ioctl_read:
  5256 00002ECD C606[D102]02            		mov	byte [EXTERR_LOCUS], 2
  5257 00002ED2 30E4                    		xor	ah, ah
  5258 00002ED4 A880                    		test	al, 80h
  5259 00002ED6 740D                    		jz	short ioctl_no_high
  5260 00002ED8 C606[D102]04            		mov	byte [EXTERR_LOCUS], 4
  5261 00002EDD 26C47D07                		les	di, [es:di+7]
  5262 00002EE1 268A6505                		mov	ah, [es:di+5]
  5263                                  ioctl_no_high:
  5264 00002EE5 89C2                    		mov	dx, ax
  5265 00002EE7 E8A9E6                  		call	Get_User_Stack
  5266 00002EEA 895406                  		mov	[si+6],	dx
  5267                                  ioctl_sr_ok:
  5268 00002EED EBDB                    		jmp	short ioctl_ok
  5269                                  
  5270                                  ; ---------------------------------------------------------------------------
  5271                                  
  5272                                  		; 07/09/2022
  5273                                  ioctl_check_device2:
  5274 00002EEF 26F745058000            		test	word [es:di+5], 80h
  5275 00002EF5 7503                    		jnz	short ioctl_control_string
  5276 00002EF7 E9D900                  		jmp	ioctl_bad_fun
  5277                                  ioctl_control_string:
  5278 00002EFA C606[D102]04            		mov	byte [EXTERR_LOCUS], 4
  5279 00002EFF 26C47D07                		les	di, [es:di+7]
  5280 00002F03 30DB                    		xor	bl, bl
  5281 00002F05 E97D01                  		jmp	ioctl_do_string
  5282                                  ioctl_getdevj:
  5283 00002F08 E97501                  		jmp	ioctl_get_dev
  5284                                  
  5285                                  ; ---------------------------------------------------------------------------
  5286                                  
  5287                                  		; 07/09/2022
  5288                                  ioctl_1:
  5289 00002F0B FEC8                    		dec	al
  5290 00002F0D FEC8                    		dec	al
  5291 00002F0F 3C03                    		cmp	al, 3
  5292 00002F11 76F5                    		jbe	short ioctl_getdevj
  5293 00002F13 3C06                    		cmp	al, 6
  5294 00002F15 731F                    		jnb	short ioctl_2
  5295                                  ioctl_status:
  5296 00002F17 B401                    		mov	ah, 1
  5297 00002F19 2C04                    		sub	al, 4
  5298 00002F1B 7402                    		jz	short ioctl_get_status
  5299 00002F1D B403                    		mov	ah, 3
  5300                                  ioctl_get_status:
  5301 00002F1F 50                      		push	ax
  5302 00002F20 E8B410                  		call	GET_IO_SFT
  5303 00002F23 58                      		pop	ax
  5304 00002F24 7303                    		jnb	short DO_IOFUNC
  5305 00002F26 E975FF                  		jmp	ioctl_bad_handle
  5306                                  DO_IOFUNC:
  5307 00002F29 E82E1D                  		call	IOFUNC
  5308 00002F2C 88C4                    		mov	ah, al
  5309 00002F2E B0FF                    		mov	al, 0FFh
  5310 00002F30 7502                    		jnz	short ioctl_status_ret
  5311 00002F32 FEC0                    		inc	al
  5312                                  ioctl_status_ret:
  5313 00002F34 EBB7                    		jmp	short ioctl_sr_ok
  5314                                  ioctl_2:
  5315 00002F36 7407                    		jz	short ioctl_3
  5316 00002F38 2C07                    		sub	al, 7
  5317 00002F3A 7509                    		jnz	short ioctl_5
  5318 00002F3C E9DA00                  		jmp	Ioctl_Drive_attr
  5319                                  ioctl_3:
  5320 00002F3F E99900                  		jmp	ioctl_rem_media
  5321                                  ioctl_4:
  5322 00002F42 E98E00                  		jmp	ioctl_bad_fun
  5323                                  ioctl_5:
  5324 00002F45 FEC8                    		dec	al
  5325 00002F47 7503                    		jnz	short ioctl_6
  5326 00002F49 E98400                  		jmp	ioctl_redirj
  5327                                  ioctl_6:
  5328 00002F4C FEC8                    		dec	al
  5329 00002F4E 746F                    		jz	short Set_Retry_Parameters
  5330 00002F50 FEC8                    		dec	al
  5331 00002F52 740B                    		jz	short GENERICIOCTLHANDLE
  5332 00002F54 FEC8                    		dec	al
  5333 00002F56 741E                    		jz	short GENERICIOCTL
  5334 00002F58 3C02                    		cmp	al, 2
  5335 00002F5A 77E6                    		ja	short ioctl_4
  5336 00002F5C E9D601                  		jmp	ioctl_drive_owner
  5337                                  
  5338                                  ; ---------------------------------------------------------------------------
  5339                                  
  5340                                  		; 07/09/2022
  5341                                  GENERICIOCTLHANDLE:
  5342 00002F5F E86437                  		call	SFFromHandle
  5343 00002F62 7274                    		jb	short ioctl_bad_handlej
  5344 00002F64 F745050080              		test	word [di+5], 8000h
  5345 00002F69 7568                    		jnz	short ioctl_bad_fun
  5346 00002F6B C606[D102]04            		mov	byte [EXTERR_LOCUS], 4
  5347 00002F70 26C47D07                		les	di, [es:di+7]
  5348 00002F74 EB0F                    		jmp	short Do_GenIOCTL
  5349                                  
  5350                                  ; ---------------------------------------------------------------------------
  5351                                  
  5352                                  		; 07/09/2022
  5353                                  GENERICIOCTL:
  5354 00002F76 C606[D102]02            		mov	byte [EXTERR_LOCUS], 2
  5355 00002F7B 80FD08                  		cmp	ch, 8
  5356 00002F7E 7553                    		jnz	short ioctl_bad_fun
  5357 00002F80 E89501                  		call	Check_If_Net
  5358 00002F83 754E                    		jnz	short ioctl_bad_fun
  5359                                  Do_GenIOCTL:
  5360 00002F85 26F745044000            		test	word [es:di+4], 40h
  5361 00002F8B 7446                    		jz	short ioctl_bad_fun
  5362 00002F8D 06                      		push	es
  5363 00002F8E 57                      		push	di
  5364 00002F8F C606[2403]17            		mov	byte [IOCALL], 23
  5365 00002F94 C606[2603]13            		mov	byte [IOCALL_REQFUNC], 19
  5366 00002F99 881E[2503]              		mov	[IOCALL_REQUNIT], bl
  5367 00002F9D 882E[3103]              		mov	[IOMED], ch
  5368 00002FA1 880E[3203]              		mov	[IOXAD], cl
  5369 00002FA5 8936[3303]              		mov	word [IOCTL_REQ_REG_SI], si
  5370 00002FA9 893E[3503]              		mov	word [IOCTL_REQ_REG_DI], di
  5371 00002FAD 8916[3703]              		mov	word [IOCTL_REQ_GENERICIOCTL_PACKET], dx
  5372 00002FB1 8936[3903]              		mov	word [IOCTL_REQ_GENERICIOCTL_PACKET+2], si
  5373 00002FB5 BB[2403]                		mov	bx, IOCALL
  5374 00002FB8 16                      		push	ss
  5375 00002FB9 07                      		pop	es
  5376 00002FBA 5E                      		pop	si
  5377 00002FBB 1F                      		pop	ds
  5378 00002FBC E90401                  		jmp	ioctl_do_IO
  5379                                  ; ---------------------------------------------------------------------------
  5380                                  
  5381                                  		; 07/09/2022
  5382                                  Set_Retry_Parameters:
  5383 00002FBF 36890E[1C00]            		mov	[ss:RetryLoop], cx
  5384 00002FC4 09D2                    		or	dx, dx
  5385 00002FC6 740B                    		jz	short ioctl_bad_fun
  5386 00002FC8 368916[1A00]            		mov	[ss:RetryCount], dx
  5387                                  doneok:
  5388 00002FCD E996E6                  		jmp	SYS_RET_OK
  5389                                  ioctl_redirj:
  5390 00002FD0 E99B00                  		jmp	Ioctl_Handle_redir
  5391                                  ioctl_bad_fun:
  5392 00002FD3 B001                    		mov	al, 1
  5393 00002FD5 E99AE6                  		jmp	SYS_Ret_Err
  5394                                  ioctl_bad_handlej:
  5395 00002FD8 E9C3FE                  		jmp	ioctl_bad_handle
  5396                                  
  5397                                  ; ---------------------------------------------------------------------------
  5398                                  
  5399                                  		; 07/09/2022
  5400                                  ioctl_rem_media:
  5401 00002FDB E83A01                  		call	Check_If_Net
  5402 00002FDE 75F3                    		jnz	short ioctl_bad_fun
  5403 00002FE0 26F745040008            		test	word [es:di+4], 800h
  5404 00002FE6 74EB                    		jz	short ioctl_bad_fun
  5405 00002FE8 36C606[2603]0F          		mov	byte [ss:IOCALL_REQFUNC], 0Fh
  5406 00002FEE B00D                    		mov	al, 13
  5407 00002FF0 88DC                    		mov	ah, bl
  5408 00002FF2 36A3[2403]              		mov	word [ss:IOCALL], ax
  5409 00002FF6 31C0                    		xor	ax, ax
  5410 00002FF8 36A3[2703]              		mov	word [ss:IOCALL_REQSTAT], ax
  5411 00002FFC 06                      		push	es
  5412 00002FFD 1F                      		pop	ds
  5413 00002FFE 89FE                    		mov	si, di
  5414 00003000 16                      		push	ss
  5415 00003001 07                      		pop	es
  5416 00003002 BB[2403]                		mov	bx, IOCALL
  5417 00003005 1E                      		push	ds
  5418 00003006 56                      		push	si
  5419 00003007 E8F81D                  		call	DEVIOCALL2
  5420 0000300A 5E                      		pop	si
  5421 0000300B 1F                      		pop	ds
  5422 0000300C 36A1[2703]              		mov	ax, word [ss:IOCALL_REQSTAT]
  5423 00003010 250002                  		and	ax, 200h
  5424 00003013 B109                    		mov	cl, 9
  5425 00003015 D3E8                    		shr	ax, cl
  5426                                  ioctl_okj1:
  5427 00003017 EBB4                    		jmp	short doneok
  5428                                  Ioctl_Drive_attr:
  5429 00003019 88D8                    		mov	al, bl
  5430 0000301B E83138                  		call	GetThisDrv
  5431 0000301E 7249                    		jb	short ioctl_drv_err
  5432 00003020 E8C600                  		call	Get_Driver_BL
  5433 00003023 268B5504                		mov	dx, [es:di+4]
  5434 00003027 88C3                    		mov	bl, al
  5435 00003029 36C43E[3A05]            		les	di, [ss:THISCDS]
  5436 0000302E 26F745430080            		test	word [es:di+43h], 8000h
  5437 00003034 7404                    		jz	short IOCTLShare
  5438 00003036 81CA0010                		or	dx, 1000h
  5439                                  IOCTLShare:
  5440 0000303A 16                      		push	ss
  5441 0000303B 1F                      		pop	ds
  5442 0000303C BE[6003]                		mov	si, OPENBUF
  5443 0000303F 80C341                  		add	bl, 'A'
  5444 00003042 881C                    		mov	[si], bl
  5445 00003044 C744013A00              		mov	word [si+1], ':'
  5446 00003049 B80003                  		mov	ax, 300h
  5447 0000304C F8                      		clc
  5448 0000304D CD2A                    		int	2Ah		; Microsoft Networks - CHECK DIRECT I/O
  5449                                  					; DS:SI	-> ASCIZ disk device name (may be full path or only drive
  5450                                  					; specifier--must include the colon)
  5451                                  					; Return: CF clear if absolute disk access allowed
  5452 0000304F 7304                    		jnb	short IOCTLLocal
  5453 00003051 81CA0002                		or	dx, 200h
  5454                                  IOCTLLocal:
  5455 00003055 26F745430010            		test	word [es:di+43h], 1000h
  5456 0000305B 7404                    		jz	short ioctl_set_DX
  5457 0000305D 81CA0080                		or	dx, 8000h
  5458                                  ioctl_set_DX:
  5459 00003061 E82FE5                  		call	Get_User_Stack
  5460 00003064 895406                  		mov	[si+6],	dx
  5461                                  
  5462                                  ioctl_okj2:
  5463 00003067 EBAE                    		jmp	short ioctl_okj1
  5464                                  
  5465                                  ; ---------------------------------------------------------------------------
  5466                                  
  5467                                  		; 07/09/2022
  5468                                  ioctl_drv_err:
  5469 00003069 B00F                    		mov	al, 0Fh
  5470                                  ioctl_errj:
  5471 0000306B E904E6                  		jmp	SYS_Ret_Err
  5472                                  Ioctl_Handle_redir:
  5473 0000306E E85536                  		call	SFFromHandle
  5474 00003071 7304                    		jnb	short ioctl_got_sft
  5475 00003073 B006                    		mov	al, 6
  5476                                  ioctl_errj1:
  5477 00003075 EBF4                    		jmp	short ioctl_errj
  5478                                  ioctl_got_sft:
  5479 00003077 268B5505                		mov	dx, [es:di+5]
  5480 0000307B EBE4                    		jmp	short ioctl_set_DX
  5481                                  
  5482                                  ; ---------------------------------------------------------------------------
  5483                                  
  5484                                  		; 07/09/2022
  5485                                  ioctl_bad_funj:
  5486 0000307D E953FF                  		jmp	ioctl_bad_fun
  5487                                  ioctl_get_dev:
  5488 00003080 E89500                  		call	Check_If_Net
  5489 00003083 75F8                    		jnz	short ioctl_bad_funj
  5490                                  ioctl_do_string:
  5491 00003085 26F745040040            		test	word [es:di+4], 4000h
  5492 0000308B 74F0                    		jz	short ioctl_bad_funj
  5493 0000308D FEC8                    		dec	al
  5494 0000308F FEC8                    		dec	al
  5495 00003091 7407                    		jz	short ioctl_reqfunc_read
  5496 00003093 C606[2603]0C            		mov	byte [IOCALL_REQFUNC], 12
  5497 00003098 EB05                    		jmp	short ioctl_control_call
  5498                                  
  5499                                  ; ---------------------------------------------------------------------------
  5500                                  
  5501                                  		; 07/09/2022
  5502                                  ioctl_reqfunc_read:
  5503 0000309A C606[2603]03            		mov	byte [IOCALL_REQFUNC], 3
  5504                                  ioctl_control_call:
  5505 0000309F B016                    		mov	al, 22
  5506                                  ioctl_setup_pkt:
  5507 000030A1 88DC                    		mov	ah, bl
  5508 000030A3 A3[2403]                		mov	word [IOCALL], ax
  5509 000030A6 31C0                    		xor	ax, ax
  5510 000030A8 A3[2703]                		mov	word [IOCALL_REQSTAT], ax
  5511 000030AB A2[3103]                		mov	[IOMED], al
  5512 000030AE 890E[3603]              		mov	word [IOSCNT], cx
  5513 000030B2 8916[3203]              		mov	word [IOXAD], dx
  5514 000030B6 8936[3403]              		mov	word [IOXAD+2], si
  5515 000030BA 06                      		push	es
  5516 000030BB 1F                      		pop	ds
  5517 000030BC 89FE                    		mov	si, di
  5518 000030BE 16                      		push	ss
  5519 000030BF 07                      		pop	es
  5520 000030C0 BB[2403]                		mov	bx, IOCALL
  5521                                  ioctl_do_IO:
  5522 000030C3 E83C1D                  		call	DEVIOCALL2
  5523 000030C6 36F706[2703]0080        		test	word [ss:IOCALL_REQSTAT], 8000h
  5524 000030CD 7506                    		jnz	short Ioctl_string_err
  5525 000030CF 36A1[3603]              		mov	ax, word [ss:IOSCNT]
  5526 000030D3 EB92                    		jmp	short ioctl_okj2
  5527                                  Ioctl_string_err:
  5528 000030D5 368B3E[2703]            		mov	di, word [ss:IOCALL_REQSTAT]
  5529 000030DA 81E7FF00                		and	di, 0FFh
  5530 000030DE 89F8                    		mov	ax, di
  5531 000030E0 E83528                  		call	SET_I24_EXTENDED_ERROR
  5532 000030E3 2EA1[D202]              		mov	ax, [cs:EXTERR]
  5533                                  		; 09/09/2022
  5534 000030E7 EB8C                    		jmp     short ioctl_errj1
  5535                                  
  5536                                  ; ---------------------------------------------------------------------------
  5537                                  
  5538                                  		; 07/09/2022
  5539                                  Get_Driver_BL:
  5540 000030E9 50                      		push	ax
  5541 000030EA 88D8                    		mov	al, bl
  5542 000030EC E86037                  		call	GetThisDrv
  5543 000030EF 7225                    		jb	short ioctl_bad_drv
  5544 000030F1 30DB                    		xor	bl, bl
  5545 000030F3 C606[D102]03            		mov	byte [EXTERR_LOCUS], 3
  5546 000030F8 C43E[3A05]              		les	di, [THISCDS]
  5547 000030FC 26F745430080            		test	word [es:di+43h], 8000h
  5548 00003102 26C47D45                		les	di, [es:di+45h]
  5549 00003106 750D                    		jnz	short got_dev_ptr
  5550 00003108 C606[D102]02            		mov	byte [EXTERR_LOCUS], 2
  5551 0000310D 268A5D01                		mov	bl, [es:di+1]
  5552 00003111 26C47D12                		les	di, [es:di+12h]
  5553                                  got_dev_ptr:
  5554 00003115 F8                      		clc
  5555                                  ioctl_bad_drv:
  5556 00003116 58                      		pop	ax
  5557 00003117 C3                      		retn
  5558                                  
  5559                                  ; ---------------------------------------------------------------------------
  5560                                  
  5561                                  		; 07/09/2022
  5562                                  Check_If_Net:
  5563 00003118 E8CEFF                  		call	Get_Driver_BL
  5564 0000311B 720F                    		jb	short ioctl_drv_err_pop
  5565 0000311D 06                      		push	es
  5566 0000311E 57                      		push	di
  5567 0000311F C43E[3A05]              		les	di, [THISCDS]
  5568 00003123 26F745430080            		test	word [es:di+43h], 8000h
  5569 00003129 5F                      		pop	di
  5570 0000312A 07                      		pop	es
  5571 0000312B C3                      		retn
  5572                                  ioctl_drv_err_pop:
  5573 0000312C 58                      		pop	ax
  5574 0000312D E939FF                  		jmp	ioctl_drv_err
  5575                                  
  5576                                  ; ---------------------------------------------------------------------------
  5577                                  
  5578                                  		; 07/09/2022
  5579                                  ioctl_bad_funj3:
  5580 00003130 E9A0FE                  		jmp	ioctl_bad_fun
  5581                                  
  5582                                  ; ---------------------------------------------------------------------------
  5583                                  
  5584                                  		; 07/09/2022
  5585                                  ioctl_string_errj:
  5586 00003133 EBA0                    		jmp	short Ioctl_string_err
  5587                                  
  5588                                  ; ---------------------------------------------------------------------------
  5589                                  
  5590                                  		; 07/09/2022
  5591                                  ioctl_drive_owner:
  5592 00003135 E8E0FF                  		call	Check_If_Net
  5593 00003138 75F6                    		jnz	short ioctl_bad_funj3
  5594 0000313A 26F745044000            		test	word [es:di+4], 40h
  5595 00003140 74EE                    		jz	short ioctl_bad_funj3
  5596 00003142 FEC8                    		dec	al
  5597 00003144 7407                    		jz	short SetOwner
  5598 00003146 C606[2603]18            		mov	byte [IOCALL_REQFUNC], 24
  5599 0000314B EB05                    		jmp	short GetOwner
  5600                                  
  5601                                  ; ---------------------------------------------------------------------------
  5602                                  
  5603                                  		; 07/09/2022
  5604                                  SetOwner:
  5605 0000314D C606[2603]17            		mov	byte [IOCALL_REQFUNC], 23
  5606                                  
  5607                                  GetOwner:
  5608 00003152 B00D                    		mov	al, 13
  5609 00003154 88DC                    		mov	ah, bl
  5610 00003156 A3[2403]                		mov	word [IOCALL], ax
  5611 00003159 31C0                    		xor	ax, ax
  5612 0000315B A3[2703]                		mov	word [IOCALL_REQSTAT], ax
  5613 0000315E 06                      		push	es
  5614 0000315F 1F                      		pop	ds
  5615 00003160 89FE                    		mov	si, di
  5616 00003162 16                      		push	ss
  5617 00003163 07                      		pop	es
  5618 00003164 BB[2403]                		mov	bx, IOCALL
  5619 00003167 1E                      		push	ds
  5620 00003168 56                      		push	si
  5621 00003169 E8961C                  		call	DEVIOCALL2
  5622 0000316C 5E                      		pop	si
  5623 0000316D 1F                      		pop	ds
  5624 0000316E 36F706[2703]0080        		test	word [ss:IOCALL_REQSTAT], 8000h
  5625 00003175 75BC                    		jnz	short ioctl_string_errj
  5626 00003177 36A0[2503]              		mov	al, [ss:IOCALL_REQUNIT]
  5627 0000317B E9E8E4                  		jmp	SYS_RET_OK
  5628                                  
  5629                                  
  5630                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  5631                                  
  5632                                  		; 08/09/2022
  5633                                  DOS_DELETE:
  5634 0000317E E815ED                  		call	TestNet
  5635 00003181 7306                    		jnb	short LOCAL_DELETE
  5636 00003183 B81311                  		mov	ax, 1113h
  5637 00003186 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - DELETE REMOTE FILE
  5638                                  					; SS = DS = DOS	CS, SDA	first filename pointer -> fully-qualified filename in DOS CS
  5639                                  					; SDA CDS pointer -> current directory structure for drive with	file
  5640                                  					; Return: CF set on error
  5641 00003188 C3                      		retn
  5642                                  
  5643                                  ; ---------------------------------------------------------------------------
  5644                                  
  5645                                  		; 09/09/2022
  5646                                  		; 08/09/2022
  5647                                  LOCAL_DELETE:
  5648 00003189 C606[0A05]00            		mov	byte [FOUNDDEL], 0 ; 09/09/2022
  5649 0000318E E8A4ED                  		call	EcritDisk
  5650 00003191 C706[1805]00E5          		mov	word [CREATING], 0E500h
  5651 00003197 8B36[4A05]              		mov	si, [WFP_START]
  5652                                  SKPNUL:
  5653 0000319B AC                      		lodsb
  5654 0000319C 08C0                    		or	al, al
  5655 0000319E 75FB                    		jnz	short SKPNUL
  5656 000031A0 83EE04                  		sub	si, 4
  5657 000031A3 813C2A2E                		cmp	word [si], 2E2Ah
  5658 000031A7 7506                    		jnz	short TEST_QUEST
  5659 000031A9 807C022A                		cmp	byte [si+2], '*'
  5660 000031AD 741F                    		jz	short CHECK_ATTS
  5661                                  TEST_QUEST:
  5662 000031AF 83EE09                  		sub	si, 9
  5663 000031B2 87FE                    		xchg	di, si
  5664 000031B4 16                      		push	ss
  5665 000031B5 07                      		pop	es
  5666 000031B6 B83F3F                  		mov	ax, '??'
  5667 000031B9 B90400                  		mov	cx, 4
  5668 000031BC F3AF                    		repe scasw
  5669 000031BE 751C                    		jnz	short NOT_ALL
  5670 000031C0 87FE                    		xchg	di, si
  5671 000031C2 AD                      		lodsw
  5672 000031C3 3D2E3F                  		cmp	ax, '.?'
  5673 000031C6 7514                    		jnz	short NOT_ALL
  5674 000031C8 AD                      		lodsw
  5675 000031C9 3D3F3F                  		cmp	ax, '??'
  5676 000031CC 750E                    		jnz	short NOT_ALL
  5677                                  CHECK_ATTS:
  5678 000031CE A0[0805]                		mov	al, byte [ExtFCB+1]
  5679 000031D1 241F                    		and	al, 1Fh
  5680 000031D3 3C1F                    		cmp	al, 1Fh
  5681 000031D5 7505                    		jnz	short NOT_ALL
  5682 000031D7 C606[1905]00            		mov	byte [DELALL], 0
  5683                                  NOT_ALL:
  5684 000031DC C606[F802]01            		mov	byte [NoSetDir], 1
  5685 000031E1 E86815                  		call	GetPathNoSet
  5686 000031E4 7313                    		jnb	short Del_found
  5687 000031E6 750C                    		jnz	short _bad_path
  5688 000031E8 08C9                    		or	cl, cl
  5689 000031EA 7408                    		jz	short _bad_path
  5690                                  No_file:
  5691 000031EC B80200                  		mov	ax, 2
  5692                                  ErrorReturn:
  5693 000031EF F9                      		stc
  5694 000031F0 E84AED                  		call	LcritDisk
  5695 000031F3 C3                      		retn
  5696                                  _bad_path:
  5697 000031F4 B80300                  		mov	ax, 3
  5698 000031F7 EBF6                    		jmp	short ErrorReturn
  5699                                  Del_found:
  5700 000031F9 750C                    		jnz	short NOT_DIR
  5701 000031FB 803E[1905]00            		cmp	byte [DELALL], 0
  5702 00003200 7405                    		jz	short NOT_DIR
  5703                                  Del_access_err:
  5704 00003202 B80500                  		mov	ax, 5
  5705 00003205 EBE8                    		jmp	short ErrorReturn
  5706                                  NOT_DIR:
  5707 00003207 08E4                    		or	ah, ah
  5708 00003209 78F7                    		js	short Del_access_err
  5709                                  DELFILE:
  5710 0000320B 800E[0A05]01            		or	byte [FOUNDDEL], 1 ; 09/09/2022
  5711 00003210 1E                      		push	ds
  5712 00003211 8A26[1905]              		mov	ah, [DELALL]
  5713 00003215 C53E[7405]              		lds	di, [CURBUF]
  5714 00003219 36F606[0605]01          		test	byte [ss:ATTRIB], 1
  5715 0000321F 7509                    		jnz	short DoDelete
  5716 00003221 F6470B01                		test	byte [bx+0Bh], 1
  5717 00003225 7403                    		jz	short DoDelete
  5718 00003227 1F                      		pop	ds
  5719 00003228 EB29                    		jmp	short DELNXT
  5720                                  
  5721                                  ; ---------------------------------------------------------------------------
  5722                                  
  5723                                  		; 09/09/2022
  5724                                  		; 08/09/2022
  5725                                  DoDelete:
  5726 0000322A E87700                  		call	REN_DEL_Check
  5727 0000322D 7303                    		jnb	short DEL_SHARE_OK
  5728 0000322F 1F                      		pop	ds
  5729 00003230 EB21                    		jmp	short DELNXT
  5730                                  DEL_SHARE_OK:
  5731 00003232 804D0540                		or	byte [di+5], 40h
  5732 00003236 8827                    		mov	[bx], ah
  5733 00003238 8B1C                    		mov	bx, [si]
  5734 0000323A 1F                      		pop	ds
  5735 0000323B 800E[0A05]10            		or	byte [FOUNDDEL], 10h ; 09/09/2022
  5736 00003240 83FB02                  		cmp	bx, 2
  5737 00003243 720E                    		jb	short DELNXT
  5738 00003245 263B5E0D                		cmp	bx, [es:bp+0Dh]
  5739 00003249 7708                    		ja	short DELNXT
  5740 0000324B E8A621                  		call	RELEASE
  5741 0000324E 724E                    		jb	short No_fileJ
  5742 00003250 E8BA00                  		call	FastOpen_Delete
  5743                                  DELNXT:
  5744 00003253 C42E[2405]              		les	bp, [THISDPB]
  5745 00003257 E86414                  		call	GETENTRY
  5746 0000325A 7242                    		jb	short No_fileJ
  5747 0000325C E8A413                  		call	NextEnt
  5748 0000325F 73AA                    		jnb	short DELFILE
  5749 00003261 C42E[2405]              		les	bp, [THISDPB]
  5750 00003265 268A4600                		mov	al, [es:bp+0]
  5751 00003269 E8D12B                  		call	FLUSHBUF
  5752 0000326C 7230                    		jb	short No_fileJ
  5753 0000326E F606[0A05]10            		test	byte [FOUNDDEL], 10h ; 09/09/2022
  5754 00003273 7422                    		jz	short DelError
  5755 00003275 F606[0605]08            		test	byte [ATTRIB], 8
  5756 0000327A 7417                    		jz	short No_Set_Flag
  5757 0000327C 50                      		push	ax
  5758 0000327D 06                      		push	es
  5759 0000327E 57                      		push	di
  5760 0000327F C43E[3A05]              		les	di, [THISCDS]
  5761 00003283 268A25                  		mov	ah, [es:di]
  5762 00003286 80EC41                  		sub	ah, 'A'
  5763 00003289 8826[070A]              		mov	[VOLCHNG_FLAG], ah
  5764 0000328D E83028                  		call	FatRead_CDS
  5765 00003290 5F                      		pop	di
  5766 00003291 07                      		pop	es
  5767 00003292 58                      		pop	ax
  5768                                  No_Set_Flag:
  5769 00003293 E8A7EC                  		call	LcritDisk
  5770 00003296 C3                      		retn
  5771                                  DelError:
  5772 00003297 F606[0A05]01            		test	byte [FOUNDDEL], 1 ; 09/09/2022
  5773 0000329C 7503                    		jnz	short Del_Access_errJ
  5774                                  No_fileJ:
  5775 0000329E E94BFF                  		jmp	No_file
  5776                                  Del_Access_errJ:
  5777 000032A1 E95EFF                  		jmp	Del_access_err
  5778                                  
  5779                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  5780                                  
  5781                                  		; 08/09/2022
  5782                                  REN_DEL_Check:
  5783 000032A4 1E                      		push	ds
  5784 000032A5 57                      		push	di
  5785 000032A6 50                      		push	ax
  5786 000032A7 53                      		push	bx
  5787 000032A8 56                      		push	si
  5788 000032A9 16                      		push	ss
  5789 000032AA 07                      		pop	es
  5790 000032AB 368B3E[4A05]            		mov	di, [ss:WFP_START]
  5791 000032B0 89DE                    		mov	si, bx
  5792 000032B2 368E1E[7605]            		mov	ds, word [ss:CURBUF+2]
  5793 000032B7 89FB                    		mov	bx, di
  5794 000032B9 83C302                  		add	bx, 2
  5795 000032BC E873EB                  		call	StrLen
  5796 000032BF 49                      		dec	cx
  5797 000032C0 01CF                    		add	di, cx
  5798 000032C2 E84C38                  		call	SkipBack
  5799 000032C5 47                      		inc	di
  5800 000032C6 E84FFA                  		call	PackName
  5801 000032C9 5E                      		pop	si
  5802 000032CA 5B                      		pop	bx
  5803 000032CB 53                      		push	bx
  5804 000032CC 56                      		push	si
  5805 000032CD 16                      		push	ss
  5806 000032CE 1F                      		pop	ds
  5807 000032CF FF1E[9000]              		call	far [ShCloseFile]
  5808 000032D3 8C1E[3805]              		mov	word [THISSFT+2], ds
  5809 000032D7 C706[3605][D106]        		mov	word [THISSFT], AUX_STACK_SF_ENTRY_size
  5810 000032DD 30E4                    		xor	ah, ah
  5811 000032DF E8E61D                  		call	DOOPEN
  5812 000032E2 C43E[3605]              		les	di, [THISSFT]
  5813 000032E6 26C745021000            		mov	word [es:di+2], 10h
  5814 000032EC 26C7050100              		mov	word [es:di], 1
  5815 000032F1 E8F03E                  		call	ShareEnter
  5816 000032F4 720D                    		jb	short CheckDone
  5817 000032F6 C43E[3605]              		les	di, [THISSFT]
  5818 000032FA 26C7050000              		mov	word [es:di], 0
  5819 000032FF E8DD3E                  		call	ShareEnd
  5820 00003302 F8                      		clc
  5821                                  CheckDone:
  5822 00003303 C42E[2405]              		les	bp, [THISDPB]
  5823 00003307 5E                      		pop	si
  5824 00003308 5B                      		pop	bx
  5825 00003309 58                      		pop	ax
  5826 0000330A 5F                      		pop	di
  5827 0000330B 1F                      		pop	ds
  5828 0000330C C3                      		retn
  5829                                  
  5830                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  5831                                  
  5832                                  		; 08/09/2022
  5833                                  FastOpen_Delete:
  5834 0000330D 9C                      		pushf
  5835 0000330E 56                      		push	si
  5836 0000330F 53                      		push	bx
  5837 00003310 50                      		push	ax
  5838 00003311 8B36[4A05]              		mov	si, [WFP_START]
  5839 00003315 BB[3B0F]                		mov	bx, FastTable
  5840 00003318 B003                    		mov	al, 3
  5841 0000331A FF5F02                  		call	far [bx+2] ; 09/09/2022
  5842 0000331D 58                      		pop	ax
  5843 0000331E 5B                      		pop	bx
  5844 0000331F 5E                      		pop	si
  5845 00003320 9D                      		popf
  5846 00003321 C3                      		retn
  5847                                  
  5848                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  5849                                  
  5850                                  		; 08/09/2022
  5851                                  FastOpen_Update:
  5852 00003322 9C                      		pushf
  5853 00003323 53                      		push	bx
  5854 00003324 50                      		push	ax
  5855 00003325 BB[3B0F]                		mov	bx, FastTable
  5856 00003328 B004                    		mov	al, 4
  5857 0000332A FF5F02                  		call	far [bx+2] ; 09/09/2022
  5858 0000332D 58                      		pop	ax
  5859 0000332E 5B                      		pop	bx
  5860 0000332F 9D                      		popf
  5861 00003330 C3                      		retn
  5862                                  
  5863                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  5864                                  
  5865                                  		; 08/09/2022
  5866                                  DOS_RENAME:
  5867 00003331 E862EB                  		call	TestNet
  5868 00003334 7306                    		jnb	short LOCAL_RENAME
  5869 00003336 B81111                  		mov	ax, 1111h
  5870 00003339 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - RENAME REMOTE FILE
  5871                                  					; SS = DS = DOS	CS, SDA	first filename pointer = offset	of fully-qualified old name
  5872                                  					; SDA CDS pointer -> current directory
  5873                                  					; Return: CF set on error
  5874 0000333B C3                      		retn
  5875                                  
  5876                                  ; ---------------------------------------------------------------------------
  5877                                  
  5878                                  		; 08/09/2022
  5879                                  LOCAL_RENAME:
  5880 0000333C C606[D102]02            		mov	byte [EXTERR_LOCUS], 2
  5881 00003341 8B36[4A05]              		mov	si, [WFP_START]
  5882 00003345 8B3E[4C05]              		mov	di, [REN_WFP]
  5883 00003349 8A04                    		mov	al, [si]
  5884 0000334B 8A25                    		mov	ah, [di]
  5885 0000334D 0D2020                  		or	ax, 2020h
  5886 00003350 38E0                    		cmp	al, ah
  5887 00003352 7405                    		jz	short SAMEDRV
  5888 00003354 B81100                  		mov	ax, 11h
  5889 00003357 F9                      		stc
  5890 00003358 C3                      		retn
  5891                                  SAMEDRV:
  5892 00003359 FF36[DC02]              		push	word [DMAADD+2]
  5893 0000335D FF36[DA02]              		push	word [DMAADD]
  5894 00003361 8C1E[DC02]              		mov	[DMAADD+2], ds
  5895 00003365 C706[DA02][8605]        		mov	word [DMAADD], RENAMEDMA
  5896 0000336B C606[0B05]00            		mov	byte [FOUND_DEV], 0
  5897 00003370 E8C2EB                  		call	EcritDisk
  5898 00003373 E8AF04                  		call	DOS_SEARCH_FIRST
  5899 00003376 7315                    		jnb	short Check_Dev
  5900 00003378 83F812                  		cmp	ax, 12h
  5901 0000337B 7503                    		jnz	short GOTERR
  5902 0000337D B80200                  		mov	ax, 2
  5903                                  GOTERR:
  5904 00003380 F9                      		stc
  5905                                  RENAME_POP:
  5906 00003381 8F06[DA02]              		pop	word [DMAADD]
  5907 00003385 8F06[DC02]              		pop	word [DMAADD+2]
  5908 00003389 E8B1EB                  		call	LcritDisk
  5909 0000338C C3                      		retn
  5910                                  
  5911                                  ; ---------------------------------------------------------------------------
  5912                                  
  5913                                  		; 09/09/2022
  5914                                  		; 08/09/2022
  5915                                  Check_Dev:
  5916 0000338D B80500                  		mov	ax, 5
  5917 00003390 803E[0B05]00            		cmp	byte [FOUND_DEV], 0 ; 09/09/2022
  5918 00003395 75E9                    		jnz	short GOTERR
  5919 00003397 89DE                    		mov	si, bx
  5920 00003399 83C61A                  		add	si, 1Ah
  5921 0000339C E805FF                  		call	REN_DEL_Check
  5922 0000339F 7305                    		jnb	short REN_OK1
  5923 000033A1 B82000                  		mov	ax, 20h
  5924 000033A4 EBDB                    		jmp	short RENAME_POP
  5925                                  REN_OK1:
  5926 000033A6 E864FF                  		call	FastOpen_Delete
  5927                                  SWAP_SOURCE:
  5928 000033A9 8B36[4C05]              		mov	si, [REN_WFP]
  5929 000033AD 8936[4A05]              		mov	[WFP_START], si
  5930 000033B1 C706[4E05]FFFF          		mov	word [CURR_DIR_END], 0FFFFh
  5931 000033B7 C706[1805]FFE5          		mov	word [CREATING], 0E5FFh
  5932 000033BD E88C13                  		call	GetPathNoSet
  5933 000033C0 7223                    		jb	short NODEST
  5934 000033C2 7404                    		jz	short BAD_ACC
  5935 000033C4 08E4                    		or	ah, ah
  5936 000033C6 7930                    		jns	short SAVEDEST
  5937                                  BAD_ACC:
  5938 000033C8 B80500                  		mov	ax, 5
  5939 000033CB F9                      		stc
  5940                                  RENAME_CLEAN:
  5941 000033CC 9C                      		pushf
  5942 000033CD 50                      		push	ax
  5943 000033CE A0[1105]                		mov	al, byte [THISDRV]
  5944 000033D1 E8692A                  		call	FLUSHBUF
  5945 000033D4 58                      		pop	ax
  5946 000033D5 803E[F602]00            		cmp	byte [FAILERR], 0
  5947 000033DA 7503                    		jnz	short BAD_ERR
  5948 000033DC 9D                      		popf
  5949 000033DD EBA2                    		jmp	short RENAME_POP
  5950                                  BAD_ERR:
  5951 000033DF 58                      		pop	ax
  5952 000033E0 B80300                  		mov	ax, 3
  5953 000033E3 EB9B                    		jmp	short GOTERR
  5954                                  NODEST:
  5955 000033E5 750B                    		jnz	short BAD_PATH
  5956 000033E7 803E[F602]00            		cmp	byte [FAILERR], 0
  5957 000033EC 7504                    		jnz	short BAD_PATH
  5958 000033EE 08C9                    		or	cl, cl
  5959 000033F0 7506                    		jnz	short SAVEDEST
  5960                                  BAD_PATH:
  5961 000033F2 B80300                  		mov	ax, 3
  5962 000033F5 F9                      		stc
  5963 000033F6 EB89                    		jmp	short RENAME_POP
  5964                                  SAVEDEST:
  5965 000033F8 16                      		push	ss
  5966 000033F9 07                      		pop	es
  5967 000033FA BF[F204]                		mov	di, NAME2
  5968 000033FD BE[E604]                		mov	si, NAME1
  5969 00003400 B90B00                  		mov	cx, 11
  5970 00003403 F3A4                    		rep movsb
  5971 00003405 A1[5805]                		mov	ax, [DIRSTART]
  5972 00003408 A3[FF04]                		mov	word [DEVFCB_dir_time+3], ax
  5973                                  
  5974                                  BUILDDEST:
  5975 0000340B 16                      		push	ss
  5976 0000340C 07                      		pop	es
  5977 0000340D BB[9B05]                		mov	bx, RENAMEDMA_21
  5978 00003410 BF[E604]                		mov	di, NAME1
  5979 00003413 BE[F204]                		mov	si, NAME2
  5980 00003416 B90B00                  		mov	cx, 11
  5981                                  NEWNAM:
  5982 00003419 AC                      		lodsb
  5983 0000341A 3C3F                    		cmp	al, '?'
  5984 0000341C 7502                    		jnz	short NOCHG
  5985 0000341E 8A07                    		mov	al, [bx]
  5986                                  NOCHG:
  5987 00003420 AA                      		stosb
  5988 00003421 43                      		inc	bx
  5989 00003422 E2F5                    		loop	NEWNAM
  5990 00003424 C606[0605]16            		mov	byte [ATTRIB], 16h
  5991 00003429 C606[1805]FF            		mov	byte [CREATING], 0FFh
  5992 0000342E E8C915                  		call	DEVNAME
  5993 00003431 7395                    		jnb	short BAD_ACC
  5994 00003433 8B1E[FF04]              		mov	bx, word [DEVFCB_dir_time+3]
  5995 00003437 C42E[2405]              		les	bp, [THISDPB]
  5996 0000343B E8B312                  		call	SETDIRSRCH
  5997 0000343E 7288                    		jb	short BAD_ACC
  5998 00003440 E86F11                  		call	FINDENTRY
  5999 00003443 7383                    		jnb	short BAD_ACC
  6000 00003445 803E[F602]00            		cmp	byte [FAILERR], 0
  6001 0000344A 752A                    		jnz	short BAD_ACCJ
  6002 0000344C A1[FF04]                		mov	ax, word [DEVFCB_dir_time+3]
  6003 0000344F 3B06[9505]              		cmp	ax, [RENAMEDMA_15]
  6004 00003453 7453                    		jz	short SIMPLE_RENAME
  6005 00003455 A0[A605]                		mov	al, [RENAMEDMA_21_dir_attr]
  6006 00003458 A810                    		test	al, 10h
  6007 0000345A 751A                    		jnz	short BAD_ACCJ
  6008 0000345C A2[0605]                		mov	byte [ATTRIB], al
  6009 0000345F 8C1E[3805]              		mov	word [THISSFT+2], ds
  6010 00003463 BE[D106]                		mov	si, AUX_STACK_SF_ENTRY_size
  6011 00003466 8936[3605]              		mov	word [THISSFT], si
  6012 0000346A C744020200              		mov	word [si+2], 2
  6013 0000346F 31C9                    		xor	cx, cx
  6014 00003471 E8E61A                  		call	make_type	; RENAME_MAKE
  6015 00003474 7303                    		jnb	short GOT_DEST
  6016                                  BAD_ACCJ:
  6017 00003476 E94FFF                  		jmp	BAD_ACC
  6018                                  
  6019                                  ; ---------------------------------------------------------------------------
  6020                                  
  6021                                  		; 08/09/2022
  6022                                  GOT_DEST:
  6023 00003479 53                      		push	bx
  6024 0000347A C43E[3605]              		les	di, [THISSFT]
  6025 0000347E E85E3D                  		call	ShareEnd
  6026 00003481 5B                      		pop	bx
  6027 00003482 C43E[7405]              		les	di, [CURBUF]
  6028 00003486 26804D0540              		or	byte [es:di+5], 40h
  6029 0000348B 89DF                    		mov	di, bx
  6030 0000348D 83C70B                  		add	di, 0Bh
  6031 00003490 BE[A605]                		mov	si, RENAMEDMA_21_dir_attr
  6032 00003493 B91500                  		mov	cx, 21
  6033 00003496 F3A4                    		rep movsb
  6034 00003498 E85100                  		call	GET_SOURCE
  6035 0000349B 724B                    		jb	short RENAME_OVER
  6036 0000349D 89DF                    		mov	di, bx
  6037 0000349F 8E06[7605]              		mov	es, word [CURBUF+2]
  6038 000034A3 B0E5                    		mov	al, 0E5h
  6039 000034A5 AA                      		stosb
  6040 000034A6 EB13                    		jmp	short DIRTY_IT
  6041                                  
  6042                                  ; ---------------------------------------------------------------------------
  6043                                  
  6044                                  		; 09/09/2022
  6045                                  		; 08/09/2022
  6046                                  SIMPLE_RENAME:
  6047 000034A8 E84100                  		call	GET_SOURCE
  6048 000034AB 723B                    		jb	short RENAME_OVER
  6049 000034AD 89DF                    		mov	di, bx
  6050 000034AF 8E06[7605]              		mov	es, word [CURBUF+2]
  6051 000034B3 BE[E604]                		mov	si, NAME1
  6052 000034B6 B90B00                  		mov	cx, 11
  6053 000034B9 F3A4                    		rep movsb
  6054                                  DIRTY_IT:
  6055 000034BB 8B3E[7405]              		mov	di, word [CURBUF]
  6056 000034BF 26804D0540              		or	byte [es:di+5], 40h
  6057 000034C4 BE[8705]                		mov	si, RENAMEDMA_1
  6058 000034C7 E86BEA                  		call	EcritDisk
  6059 000034CA C606[1805]00            		mov	byte [CREATING], 0
  6060 000034CF E85404                  		call	RENAME_NEXT
  6061 000034D2 7214                    		jb	short RENAME_OVER
  6062 000034D4 8D771A                  		lea	si, [bx+1Ah]
  6063 000034D7 E8CAFD                  		call	REN_DEL_Check
  6064 000034DA 7306                    		jnb	short REN_OK2
  6065 000034DC B82000                  		mov	ax, 20h
  6066 000034DF E9EAFE                  		jmp	RENAME_CLEAN
  6067                                  REN_OK2:
  6068 000034E2 E828FE                  		call	FastOpen_Delete
  6069 000034E5 E923FF                  		jmp	BUILDDEST
  6070                                  RENAME_OVER:
  6071 000034E8 F8                      		clc
  6072 000034E9 E9E0FE                  		jmp	RENAME_CLEAN
  6073                                  
  6074                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6075                                  
  6076                                  		; 08/09/2022
  6077                                  GET_SOURCE:
  6078 000034EC 8B1E[9505]              		mov	bx, [RENAMEDMA_15]
  6079 000034F0 C42E[2405]              		les	bp, [THISDPB]
  6080 000034F4 E8FA11                  		call	SETDIRSRCH
  6081 000034F7 7301                    		jnb	short gs_startsrch
  6082 000034F9 C3                      		retn
  6083                                  gs_startsrch:
  6084 000034FA E8DC14                  		call	STARTSRCH
  6085 000034FD A1[9305]                		mov	ax, [RENAMEDMA_13]
  6086 00003500 E8BE11                  		call	GetEnt
  6087 00003503 C3                      		retn
  6088                                  
  6089                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6090                                  
  6091                                  		; 08/09/2022
  6092                                  GET_FILE_INFO:
  6093 00003504 E88FE9                  		call	TestNet
  6094 00003507 7306                    		jnb	short LOCAL_INFO
  6095 00003509 B80F11                  		mov	ax, 110Fh
  6096 0000350C CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - GET REMOTE FILE'S ATTRIBUTES
  6097                                  					; SS = DOS CS, SDA first filename pointer -> fully-qualified name of file
  6098                                  					; SDA CDS pointer -> current directory
  6099                                  					; Return: CF set on error, AX =	file attributes
  6100 0000350E C3                      		retn
  6101                                  
  6102                                  ; ---------------------------------------------------------------------------
  6103                                  
  6104                                  		; 08/09/2022
  6105                                  LOCAL_INFO:
  6106 0000350F E823EA                  		call	EcritDisk
  6107 00003512 C606[F802]01            		mov	byte [NoSetDir], 1
  6108 00003517 E82C12                  		call	GetPath
  6109 0000351A 7313                    		jnb	short info_check_dev
  6110                                  NO_PATH:
  6111 0000351C 750C                    		jnz	short bad_path1
  6112 0000351E 08C9                    		or	cl, cl
  6113 00003520 7408                    		jz	short bad_path1
  6114                                  info_no_file:
  6115 00003522 B80200                  		mov	ax, 2
  6116                                  BadRet:
  6117 00003525 F9                      		stc
  6118                                  justRet:
  6119 00003526 E814EA                  		call	LcritDisk
  6120 00003529 C3                      		retn
  6121                                  bad_path1:
  6122 0000352A B80300                  		mov	ax, 3
  6123 0000352D EBF6                    		jmp	short BadRet
  6124                                  info_check_dev:
  6125 0000352F 08E4                    		or	ah, ah
  6126 00003531 78EF                    		js	short info_no_file
  6127 00003533 1E                      		push	ds
  6128 00003534 8E1E[7605]              		mov	ds, word [CURBUF+2]
  6129 00003538 89DE                    		mov	si, bx
  6130 0000353A 31DB                    		xor	bx, bx
  6131 0000353C 89DF                    		mov	di, bx
  6132 0000353E 8B4C16                  		mov	cx, [si+16h]
  6133 00003541 8B5418                  		mov	dx, [si+18h]
  6134 00003544 30E4                    		xor	ah, ah
  6135 00003546 8A440B                  		mov	al, [si+0Bh]
  6136 00003549 A810                    		test	al, 10h
  6137 0000354B 7506                    		jnz	short NO_SIZE
  6138 0000354D 8B7C1C                  		mov	di, [si+1Ch]
  6139 00003550 8B5C1E                  		mov	bx, [si+1Eh]
  6140                                  NO_SIZE:
  6141 00003553 1F                      		pop	ds
  6142 00003554 F8                      		clc
  6143 00003555 EBCF                    		jmp	short justRet
  6144                                  
  6145                                  ; ---------------------------------------------------------------------------
  6146                                  
  6147                                  		; 08/09/2022
  6148                                  SET_FILE_ATTRIBUTE:
  6149 00003557 A9D8FF                  		test	ax, 0FFD8h
  6150 0000355A 7414                    		jz	short set_look
  6151                                  _BAD_ACC:
  6152 0000355C C606[D102]01            		mov	byte [EXTERR_LOCUS], 1
  6153 00003561 C606[D502]07            		mov	byte [EXTERR_CLASS], 7
  6154 00003566 C606[D402]04            		mov	byte [EXTERR_ACTION], 4
  6155 0000356B B80500                  		mov	ax, 5
  6156 0000356E F9                      		stc
  6157 0000356F C3                      		retn
  6158                                  set_look:
  6159 00003570 E823E9                  		call	TestNet
  6160 00003573 7308                    		jnb	short Local_Set
  6161 00003575 50                      		push	ax
  6162 00003576 B80E11                  		mov	ax, 110Eh
  6163 00003579 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - SET REMOTE FILE'S ATTRIBUTES
  6164                                  					; SS = DOS CS, SDA first filename pointer -> fully-qualified name of file
  6165                                  					; SDA CDS pointer -> current directory
  6166                                  					; STACK: WORD new file attributes
  6167                                  					; Return: CF set on error
  6168 0000357B 5B                      		pop	bx
  6169 0000357C C3                      		retn
  6170                                  Local_Set:
  6171 0000357D E8B5E9                  		call	EcritDisk
  6172 00003580 50                      		push	ax
  6173 00003581 C606[F802]01            		mov	byte [NoSetDir], 1
  6174 00003586 E8BD11                  		call	GetPath
  6175 00003589 7303                    		jnb	short set_check_device
  6176 0000358B 5B                      		pop	bx
  6177 0000358C EB8E                    		jmp	short NO_PATH
  6178                                  set_check_device:
  6179 0000358E 08E4                    		or	ah, ah
  6180 00003590 7906                    		jns	short set_check_share
  6181 00003592 58                      		pop	ax
  6182 00003593 E8A7E9                  		call	LcritDisk
  6183 00003596 EBC4                    		jmp	short _BAD_ACC
  6184                                  set_check_share:
  6185 00003598 58                      		pop	ax
  6186 00003599 E808FD                  		call	REN_DEL_Check
  6187 0000359C 7305                    		jnb	short set_do
  6188 0000359E B82000                  		mov	ax, 20h
  6189 000035A1 EB2A                    		jmp	short OK_BYE
  6190                                  set_do:
  6191 000035A3 C43E[7405]              		les	di, [CURBUF]
  6192 000035A7 2680670BD8              		and	byte [es:bx+0Bh], 0D8h
  6193 000035AC 2608470B                		or	[es:bx+0Bh], al
  6194 000035B0 26804D0540              		or	byte [es:di+5], 40h
  6195 000035B5 A0[1105]                		mov	al, byte [THISDRV]
  6196 000035B8 52                      		push	dx
  6197 000035B9 57                      		push	di
  6198 000035BA B400                    		mov	ah, 0
  6199 000035BC 88C2                    		mov	dl, al
  6200 000035BE 89DF                    		mov	di, bx
  6201 000035C0 E85FFD                  		call	FastOpen_Update
  6202 000035C3 5F                      		pop	di
  6203 000035C4 5A                      		pop	dx
  6204 000035C5 E87528                  		call	FLUSHBUF
  6205 000035C8 7303                    		jnb	short OK_BYE
  6206 000035CA B80200                  		mov	ax, 2
  6207                                  OK_BYE:
  6208 000035CD E86DE9                  		call	LcritDisk
  6209 000035D0 C3                      		retn
  6210                                  
  6211                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6212                                  
  6213                                  		; 08/09/2022
  6214                                  DOS_DUP:
  6215 000035D1 2EC43E[3605]            		les	di, [cs:THISSFT]
  6216                                  DOS_Dup_Direct:
  6217 000035D6 E8D2E8                  		call	IsSFTNet
  6218 000035D9 7503                    		jnz	short DO_INC
  6219 000035DB E8A317                  		call	DEV_OPEN_SFT
  6220                                  DO_INC:
  6221 000035DE 26FF05                  		inc	word [es:di]
  6222 000035E1 C3                      		retn
  6223                                  
  6224                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6225                                  
  6226                                  		; 08/09/2022
  6227                                  DOS_CREATE:
  6228 000035E2 30E4                    		xor	ah, ah
  6229                                  Create_inter:
  6230 000035E4 A880                    		test	al, 80h
  6231 000035E6 750C                    		jnz	short AttErr
  6232 000035E8 A808                    		test	al, 8
  6233 000035EA 7402                    		jz	short NoReset
  6234 000035EC B008                    		mov	al, 8
  6235                                  NoReset:
  6236 000035EE 0C20                    		or	al, 20h
  6237 000035F0 A850                    		test	al, 50h
  6238 000035F2 740A                    		jz	short ATT_OK
  6239                                  AttErr:
  6240 000035F4 B80500                  		mov	ax, 5
  6241 000035F7 C606[D102]01            		mov	byte [EXTERR_LOCUS], 1
  6242 000035FC EB3E                    		jmp	short SET_MKND_ERR
  6243                                  ATT_OK:
  6244 000035FE C43E[3605]              		les	di, [THISSFT]
  6245 00003602 06                      		push	es
  6246 00003603 C436[3A05]              		les	si, [THISCDS]
  6247 00003607 83FEFF                  		cmp	si, 0FFFFh
  6248 0000360A 7509                    		jnz	short TEST_RE_NET
  6249 0000360C 07                      		pop	es
  6250 0000360D 50                      		push	ax
  6251 0000360E B81811                  		mov	ax, 1118h
  6252 00003611 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - CREATE/TRUNCATE FILE
  6253                                  					; ES:DI	-> uninitialized SFT, SS = DOS CS
  6254                                  					; SDA first filename pointer ->	fully-qualified	name of	file
  6255                                  					; STACK: WORD file creation mode???
  6256 00003613 5B                      		pop	bx
  6257 00003614 C3                      		retn
  6258                                  TEST_RE_NET:
  6259 00003615 26F744430080            		test	word [es:si+43h], 8000h
  6260 0000361B 07                      		pop	es
  6261 0000361C 7408                    		jz	short LOCAL_CREATE
  6262 0000361E 50                      		push	ax
  6263 0000361F B81711                  		mov	ax, 1117h
  6264 00003622 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - CREATE/TRUNCATE REMOTE FILE
  6265                                  					; ES:DI	-> uninitialized SFT, SS = DOS CS
  6266                                  					; SDA first filename pointer ->	fully-qualified	name of	file to	open
  6267                                  					; SDA CDS pointer -> current directory
  6268                                  					; Return: CF set on error
  6269 00003624 5B                      		pop	bx
  6270 00003625 C3                      		retn
  6271                                  
  6272                                  ; ---------------------------------------------------------------------------
  6273                                  
  6274                                  		; 08/09/2022
  6275                                  LOCAL_CREATE:
  6276                                  		;or	word [es:di+2], 2
  6277                                  		; 09/09/2022 - Temporary !
  6278 00003626 26814D020200            		db	26h, 81h, 4Dh, 2, 2, 0 
  6279                                  		
  6280 0000362C E806E9                  		call	EcritDisk
  6281 0000362F E80219                  		call	MakeNode
  6282 00003632 730E                    		jnb	short Create_ok
  6283 00003634 C606[070A]FF            		mov	byte [VOLCHNG_FLAG], -1
  6284 00003639 E801E9                  		call	LcritDisk
  6285                                  SET_MKND_ERR:
  6286 0000363C BB[B112]                		mov	bx, CRTERRTAB
  6287 0000363F D7                      		xlat
  6288 00003640 F9                      		stc
  6289 00003641 C3                      		retn
  6290                                  Create_ok:
  6291 00003642 E8C8FC                  		call	FastOpen_Delete
  6292 00003645 A0[0805]                		mov	al, byte [ExtFCB+1]
  6293 00003648 A808                    		test	al, 8
  6294 0000364A 7417                    		jz	short NoVolLabel
  6295 0000364C C43E[3A05]              		les	di, [THISCDS]
  6296 00003650 268A25                  		mov	ah, [es:di]
  6297 00003653 80EC41                  		sub	ah, 'A'
  6298 00003656 8826[070A]              		mov	[VOLCHNG_FLAG], ah
  6299 0000365A E8D8E8                  		call	EcritDisk
  6300 0000365D E86024                  		call	FatRead_CDS
  6301 00003660 E8DAE8                  		call	LcritDisk
  6302                                  NoVolLabel:
  6303 00003663 B80200                  		mov	ax, 2
  6304 00003666 C43E[3605]              		les	di, [THISSFT]
  6305 0000366A FF1E[9400]              		call	far [ShSU]
  6306 0000366E E8CCE8                  		call	LcritDisk
  6307 00003671 E9ED00                  		jmp	SET_SFT_MODE
  6308                                  
  6309                                  ; ---------------------------------------------------------------------------
  6310                                  
  6311                                  		; 08/09/2022
  6312                                  DOS_Create_New:
  6313 00003674 B401                    		mov	ah, 1
  6314 00003676 E96BFF                  		jmp	Create_inter
  6315                                  
  6316                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6317                                  
  6318                                  		; 08/09/2022
  6319                                  DOS_OPEN:
  6320 00003679 C606[F802]00            		mov	byte [NoSetDir], 0
  6321 0000367E E81601                  		call	Check_Access_AX
  6322 00003681 7301                    		jnb	short dos_open1
  6323 00003683 C3                      		retn
  6324                                  
  6325                                  ; ---------------------------------------------------------------------------
  6326                                  
  6327                                  		; 08/09/2022
  6328                                  dos_open1:
  6329 00003684 C43E[3605]              		les	di, [THISSFT]
  6330 00003688 30E4                    		xor	ah, ah
  6331 0000368A 26884502                		mov	[es:di+2], al
  6332 0000368E 06                      		push	es
  6333 0000368F C436[3A05]              		les	si, [THISCDS]
  6334 00003693 83FEFF                  		cmp	si, -1
  6335 00003696 7509                    		jnz	short TEST_RE_NET1
  6336 00003698 07                      		pop	es
  6337 00003699 50                      		push	ax
  6338 0000369A B81611                  		mov	ax, 1116h
  6339 0000369D CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - OPEN	EXISTING REMOTE	FILE
  6340                                  					; ES:DI	-> uninitialized SFT, SS = DOS CS
  6341                                  					; SDA first filename pointer ->	fully-qualified	name of	file to	open
  6342                                  					; STACK: WORD file open	mode
  6343                                  					; Return: CF set on error
  6344 0000369F 5B                      		pop	bx
  6345 000036A0 C3                      		retn
  6346                                  TEST_RE_NET1:
  6347 000036A1 26F744430080            		test	word [es:si+43h], 8000h
  6348 000036A7 07                      		pop	es
  6349 000036A8 7408                    		jz	short LOCAL_OPEN
  6350 000036AA 50                      		push	ax
  6351 000036AB B81611                  		mov	ax, 1116h
  6352 000036AE CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - OPEN	EXISTING REMOTE	FILE
  6353                                  					; ES:DI	-> uninitialized SFT, SS = DOS CS
  6354                                  					; SDA first filename pointer ->	fully-qualified	name of	file to	open
  6355                                  					; STACK: WORD file open	mode
  6356                                  					; Return: CF set on error
  6357 000036B0 5B                      		pop	bx
  6358 000036B1 C3                      		retn
  6359                                  ; ---------------------------------------------------------------------------
  6360                                  
  6361                                  		; 08/09/2022
  6362                                  LOCAL_OPEN:
  6363 000036B2 E880E8                  		call	EcritDisk
  6364 000036B5 800E[660F]05            		or	byte [FastOpenFlg], 5
  6365 000036BA E88910                  		call	GetPath
  6366 000036BD 7320                    		jnb	short Open_found
  6367 000036BF 7514                    		jnz	short bad_path2
  6368 000036C1 08C9                    		or	cl, cl
  6369 000036C3 7410                    		jz	short bad_path2
  6370 000036C5 B80200                  		mov	ax, 2
  6371                                  OpenBadRet:
  6372 000036C8 F9                      		stc
  6373 000036C9 2EC606[660F]00          		mov	byte [cs:FastOpenFlg], 0
  6374 000036CF E86BE8                  		call	LcritDisk
  6375 000036D2 E9A300                  		jmp	Clear_FastOpen
  6376                                  bad_path2:
  6377 000036D5 B80300                  		mov	ax, 3
  6378 000036D8 EBEE                    		jmp	short OpenBadRet
  6379                                  open_bad_access:
  6380 000036DA B80500                  		mov	ax, 5
  6381 000036DD EBE9                    		jmp	short OpenBadRet
  6382                                  Open_found:
  6383 000036DF 74F9                    		jz	short open_bad_access
  6384 000036E1 08E4                    		or	ah, ah
  6385 000036E3 7840                    		js	short open_ok
  6386 000036E5 8E06[7605]              		mov	es, word [CURBUF+2]
  6387 000036E9 268A470B                		mov	al, [es:bx+0Bh]
  6388 000036ED A808                    		test	al, 8
  6389 000036EF 75E9                    		jnz	short open_bad_access
  6390 000036F1 A801                    		test	al, 1
  6391 000036F3 7430                    		jz	short open_ok
  6392 000036F5 1E                      		push	ds
  6393 000036F6 56                      		push	si
  6394 000036F7 C536[3605]              		lds	si, [THISSFT]
  6395 000036FB 8B4C02                  		mov	cx, [si+2]
  6396 000036FE F7C10080                		test	cx, 8000h
  6397 00003702 750A                    		jnz	short ResetAccess
  6398 00003704 88CA                    		mov	dl, cl
  6399 00003706 80E2F0                  		and	dl, 0F0h
  6400 00003709 80FA70                  		cmp	dl, 70h
  6401 0000370C 7509                    		jnz	short NormalOpen
  6402                                  ResetAccess:
  6403                                  		;and	cx, 0FFF0h
  6404                                  		; 09/09/2022 - Temporary !
  6405 0000370E 81E1F0FF                		db	81h, 0E1h, 0F0h, 0FFh	
  6406                                  		
  6407 00003712 894C02                  		mov	[si+2],	cx
  6408 00003715 EB0C                    		jmp	short FillSFT
  6409                                  NormalOpen:
  6410 00003717 80E10F                  		and	cl, 0Fh
  6411 0000371A 80F900                  		cmp	cl, 0
  6412 0000371D 7404                    		jz	short FillSFT
  6413 0000371F 5E                      		pop	si
  6414 00003720 1F                      		pop	ds
  6415 00003721 EBB7                    		jmp	short open_bad_access
  6416                                  FillSFT:
  6417 00003723 5E                      		pop	si
  6418 00003724 1F                      		pop	ds
  6419                                  open_ok:
  6420 00003725 E8A019                  		call	DOOPEN
  6421                                  DO_SHARE_CHECK:
  6422 00003728 8B0E[1A00]              		mov	cx, [RetryCount]
  6423                                  OpenShareRetry:
  6424 0000372C 51                      		push	cx
  6425 0000372D E8843A                  		call	SHARE_CHECK
  6426 00003730 59                      		pop	cx
  6427 00003731 731A                    		jnb	short SHARE_OK
  6428 00003733 E81BE7                  		call	Idle
  6429 00003736 E2F4                    		loop	OpenShareRetry
  6430 00003738 C43E[3605]              		les	di, [THISSFT]
  6431 0000373C E83A00                  		call	SHARE_ERROR
  6432 0000373F 73E7                    		jnb	short DO_SHARE_CHECK
  6433 00003741 2EC606[660F]00          		mov	byte [cs:FastOpenFlg], 0
  6434 00003747 E8F3E7                  		call	LcritDisk
  6435 0000374A EB2C                    		jmp	short Clear_FastOpen
  6436                                  
  6437 0000374C 90                      		nop
  6438                                  SHARE_OK:
  6439 0000374D B80300                  		mov	ax, 3
  6440 00003750 C43E[3605]              		les	di, [THISSFT]
  6441 00003754 FF1E[9400]              		call	far [ShSU]
  6442 00003758 2EC606[660F]00          		mov	byte [cs:FastOpenFlg], 0
  6443 0000375E E8DCE7                  		call	LcritDisk
  6444                                  SET_SFT_MODE:
  6445 00003761 C43E[3605]              		les	di, [THISSFT]
  6446 00003765 E81916                  		call	DEV_OPEN_SFT
  6447 00003768 26F745020080            		test	word [es:di+2], 8000h
  6448 0000376E 7501                    		jnz	short set_sft_mode_not_fcb
  6449 00003770 C3                      		retn
  6450                                  set_sft_mode_not_fcb:
  6451 00003771 A1[DE02]                		mov	ax, [CurrentPDB]
  6452 00003774 26894531                		mov	[es:di+31h], ax
  6453                                  Clear_FastOpen:
  6454 00003778 C3                      		retn
  6455                                  
  6456                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6457                                  
  6458                                  		; 08/09/2022
  6459                                  SHARE_ERROR:
  6460 00003779 26F745020080            		test	word [es:di+2], 8000h
  6461 0000377F 750C                    		jnz	short HARD_ERR
  6462 00003781 268A4D02                		mov	cl, [es:di+2]
  6463 00003785 80E1F0                  		and	cl, 0F0h
  6464 00003788 80F900                  		cmp	cl, 0
  6465 0000378B 7505                    		jnz	short NO_HARD_ERR
  6466                                  HARD_ERR:
  6467 0000378D E8293A                  		call	SHARE_VIOLATION
  6468 00003790 73E6                    		jnb	short Clear_FastOpen
  6469                                  NO_HARD_ERR:
  6470 00003792 B82000                  		mov	ax, 20h
  6471 00003795 F9                      		stc
  6472 00003796 C3                      		retn
  6473                                  
  6474                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6475                                  
  6476                                  		; 08/09/2022
  6477                                  Check_Access_AX:
  6478 00003797 A2[0905]                		mov	byte [Open_Access], al
  6479 0000379A 53                      		push	bx
  6480 0000379B 88C3                    		mov	bl, al
  6481 0000379D 80E3F0                  		and	bl, 0F0h
  6482 000037A0 803E[0D05]FF            		cmp	byte [fSharing], -1
  6483 000037A5 7505                    		jnz	short CheckShareMode
  6484 000037A7 80FB70                  		cmp	bl, 70h
  6485 000037AA 7405                    		jz	short CheckAccessMode
  6486                                  CheckShareMode:
  6487 000037AC 80FB40                  		cmp	bl, 40h
  6488 000037AF 770D                    		ja	short Make_Bad_Access
  6489                                  CheckAccessMode:
  6490 000037B1 88C3                    		mov	bl, al
  6491 000037B3 80E30F                  		and	bl, 0Fh
  6492 000037B6 80FB02                  		cmp	bl, 2
  6493 000037B9 7703                    		ja	short Make_Bad_Access
  6494 000037BB 5B                      		pop	bx
  6495 000037BC F8                      		clc
  6496 000037BD C3                      		retn
  6497                                  Make_Bad_Access:
  6498 000037BE B80C00                  		mov	ax, 0Ch
  6499 000037C1 5B                      		pop	bx
  6500 000037C2 F9                      		stc
  6501 000037C3 C3                      		retn
  6502                                  
  6503                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6504                                  
  6505                                  		; 08/09/2022
  6506                                  DISK_INFO:
  6507 000037C4 E8CFE6                  		call	TestNet
  6508 000037C7 7306                    		jnb	short _LOCAL_INFO
  6509 000037C9 B80C11                  		mov	ax, 110Ch
  6510 000037CC CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - GET DISK SPACE
  6511                                  					; ES:DI	-> current directory
  6512                                  					; Return: AL = sectors per cluster, BX = total clusters
  6513                                  					; CX = bytes per sector, DX = number of	available clusters
  6514 000037CE C3                      		retn
  6515                                  
  6516                                  ; ---------------------------------------------------------------------------
  6517                                  
  6518                                  		; 08/09/2022
  6519                                  _LOCAL_INFO:
  6520 000037CF C606[D102]02            		mov	byte [EXTERR_LOCUS], 2
  6521 000037D4 E85EE7                  		call	EcritDisk
  6522 000037D7 E8E622                  		call	FatRead_CDS
  6523 000037DA 7241                    		jb	short CRIT_LEAVE
  6524 000037DC BB0200                  		mov	bx, 2
  6525 000037DF E86F21                  		call	UNPACK
  6526 000037E2 7239                    		jb	short CRIT_LEAVE
  6527 000037E4 C536[7405]              		lds	si, [CURBUF]
  6528 000037E8 8A6410                  		mov	ah, [si+16]
  6529 000037EB 16                      		push	ss
  6530 000037EC 1F                      		pop	ds
  6531 000037ED 268B4E0D                		mov	cx, [es:bp+0Dh]
  6532 000037F1 268B561E                		mov	dx, [es:bp+1Eh]
  6533 000037F5 83FAFF                  		cmp	dx, -1
  6534 000037F8 7404                    		jz	short DoScan
  6535 000037FA 39CA                    		cmp	dx, cx
  6536 000037FC 7223                    		jb	short GotVal
  6537                                  DoScan:
  6538 000037FE 31D2                    		xor	dx, dx
  6539 00003800 49                      		dec	cx
  6540                                  SCANFREE:
  6541 00003801 E84D21                  		call	UNPACK
  6542 00003804 7217                    		jb	short CRIT_LEAVE
  6543 00003806 7501                    		jnz	short NOTFREECLUS
  6544 00003808 42                      		inc	dx
  6545                                  NOTFREECLUS:
  6546 00003809 43                      		inc	bx
  6547 0000380A E2F5                    		loop	SCANFREE
  6548 0000380C 4B                      		dec	bx
  6549                                  ReturnVals:
  6550 0000380D 4B                      		dec	bx
  6551 0000380E 268A4604                		mov	al, [es:bp+4]
  6552 00003812 FEC0                    		inc	al
  6553 00003814 268B4E02                		mov	cx, [es:bp+2]
  6554 00003818 2689561E                		mov	[es:bp+1Eh], dx
  6555 0000381C F8                      		clc
  6556                                  CRIT_LEAVE:
  6557 0000381D E81DE7                  		call	LcritDisk
  6558 00003820 C3                      		retn
  6559                                  GotVal:
  6560 00003821 89CB                    		mov	bx, cx
  6561 00003823 EBE8                    		jmp	short ReturnVals
  6562                                  
  6563                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6564                                  
  6565                                  		; 08/09/2022
  6566                                  DOS_SEARCH_FIRST:
  6567 00003825 C43E[3A05]              		les	di, [THISCDS]
  6568 00003829 83FFFF                  		cmp	di, -1
  6569 0000382C 7506                    		jnz	short _TEST_RE_NET
  6570 0000382E B81911                  		mov	ax, 1119h
  6571 00003831 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - ???
  6572 00003833 C3                      		retn
  6573                                  
  6574                                  ; ---------------------------------------------------------------------------
  6575                                  
  6576                                  		; 08/09/2022
  6577                                  _TEST_RE_NET:
  6578 00003834 26F745430080            		test	word [es:di+43h], 8000h
  6579 0000383A 7406                    		jz	short LOCAL_SEARCH_FIRST
  6580 0000383C B81B11                  		mov	ax, 111Bh
  6581 0000383F CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - FINDFIRST
  6582                                  					; SS = DS = DOS	CS, [DTA] = uninitialized 21-byte findfirst search data
  6583                                  					; SDA first filename pointer ->	fully-qualified	search template
  6584                                  					; SDA CDS pointer -> current directory
  6585                                  					; Return: CF set on error
  6586 00003841 C3                      		retn
  6587                                  
  6588                                  ; ---------------------------------------------------------------------------
  6589                                  
  6590                                  		; 09/09/2022
  6591                                  		; 08/09/2022
  6592                                  LOCAL_SEARCH_FIRST:
  6593 00003842 E8F0E6                  		call	EcritDisk
  6594 00003845 C606[F802]01            		mov	byte [NoSetDir], 1
  6595 0000384A E8F90E                  		call	GetPath
  6596 0000384D 7313                    		jnb	short find_check_dev
  6597 0000384F 750C                    		jnz	short bad_path3
  6598 00003851 08C9                    		or	cl, cl
  6599 00003853 7408                    		jz	short bad_path3
  6600                                  find_no_more:
  6601 00003855 B81200                  		mov	ax, 12h
  6602                                  BadBye:
  6603 00003858 F9                      		stc
  6604 00003859 E8E1E6                  		call	LcritDisk
  6605 0000385C C3                      		retn
  6606                                  bad_path3:
  6607 0000385D B80300                  		mov	ax, 3
  6608 00003860 EBF6                    		jmp	short BadBye
  6609                                  find_check_dev:
  6610 00003862 08E4                    		or	ah, ah
  6611 00003864 790A                    		jns	short found_entry
  6612 00003866 C706[F402]FFFF          		mov	word [LASTENT], -1
  6613 0000386C FE06[0B05]              		inc	byte [FOUND_DEV] ; 09/09/2022
  6614                                  found_entry:
  6615 00003870 C43E[DA02]              		les	di, [DMAADD]
  6616 00003874 8B36[4A05]              		mov	si, [WFP_START]
  6617 00003878 AC                      		lodsb
  6618 00003879 2C40                    		sub	al, 40h
  6619 0000387B AA                      		stosb
  6620                                  found_it:
  6621 0000387C C43E[DA02]              		les	di, [DMAADD]
  6622 00003880 47                      		inc	di
  6623 00003881 BE[E604]                		mov	si, NAME1
  6624 00003884 A4                      		movsb
  6625 00003885 26807DFF05              		cmp	byte [es:di-1], 5
  6626 0000388A 7505                    		jnz	short NOTKANJB
  6627 0000388C 26C645FFE5              		mov	byte [es:di-1], 0E5h
  6628                                  NOTKANJB:
  6629 00003891 B90A00                  		mov	cx, 10
  6630 00003894 F3A4                    		rep movsb
  6631 00003896 A0[0605]                		mov	al, byte [ATTRIB]
  6632 00003899 AA                      		stosb
  6633 0000389A 50                      		push	ax
  6634 0000389B A1[F402]                		mov	ax, word [LASTENT]
  6635 0000389E AB                      		stosw
  6636 0000389F A1[5805]                		mov	ax, [DIRSTART]
  6637 000038A2 AB                      		stosw
  6638 000038A3 83C704                  		add	di, 4
  6639 000038A6 58                      		pop	ax
  6640 000038A7 08E4                    		or	ah, ah
  6641 000038A9 7813                    		js	short DOSREL
  6642 000038AB 833E[7405]FF            		cmp	word [CURBUF], -1
  6643 000038B0 7508                    		jnz	short OKSTORE
  6644 000038B2 26C745F8FFFF            		mov	word [es:di-8], -1
  6645 000038B8 EB9B                    		jmp	short find_no_more
  6646                                  OKSTORE:
  6647 000038BA 8E1E[7605]              		mov	ds, word [CURBUF+2]
  6648                                  DOSREL:
  6649 000038BE 89DE                    		mov	si, bx
  6650 000038C0 B92000                  		mov	cx, 32
  6651 000038C3 89F8                    		mov	ax, di
  6652 000038C5 F3A4                    		rep movsb
  6653 000038C7 89C7                    		mov	di, ax
  6654 000038C9 26803D05                		cmp	byte [es:di], 5
  6655 000038CD 7504                    		jnz	short NO05
  6656 000038CF 26C605E5                		mov	byte [es:di], 0E5h
  6657                                  NO05:
  6658 000038D3 16                      		push	ss
  6659 000038D4 1F                      		pop	ds
  6660 000038D5 F8                      		clc
  6661 000038D6 E864E6                  		call	LcritDisk
  6662 000038D9 C3                      		retn
  6663                                  
  6664                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6665                                  
  6666                                  		; 08/09/2022
  6667                                  DOS_SEARCH_NEXT:
  6668 000038DA C43E[DA02]              		les	di, [DMAADD]
  6669 000038DE 268A05                  		mov	al, [es:di]
  6670 000038E1 A880                    		test	al, 80h
  6671 000038E3 7406                    		jz	short LOCAL_SEARCH_NEXT
  6672 000038E5 B81C11                  		mov	ax, 111Ch
  6673 000038E8 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - FINDNEXT
  6674                                  					; SS = DS = DOS	CS, [DTA] = 21-byte findfirst search data
  6675                                  					; Return: CF set on error, AX =	DOS error code
  6676                                  					; CF clear if successful
  6677 000038EA C3                      		retn
  6678                                  
  6679                                  ; ---------------------------------------------------------------------------
  6680                                  
  6681                                  		; 08/09/2022
  6682                                  LOCAL_SEARCH_NEXT:
  6683 000038EB C606[D102]02            		mov	byte [EXTERR_LOCUS], 2
  6684 000038F0 E842E6                  		call	EcritDisk
  6685 000038F3 C706[3A05][9504]        		mov	word [THISCDS], SETFINDPB+3
  6686 000038F9 8C0E[3C05]              		mov	word [THISCDS+2], cs
  6687 000038FD 0440                    		add	al, 40h
  6688 000038FF E88E2E                  		call	InitCDS
  6689 00003902 7236                    		jb	short No_files
  6690 00003904 C43E[3A05]              		les	di, [THISCDS]
  6691 00003908 26C46D45                		les	bp, [es:di+45h]
  6692 0000390C E84EDD                  		call	GOTDPB
  6693 0000390F 268A4600                		mov	al, [es:bp+0]
  6694 00003913 A2[1105]                		mov	byte [THISDRV], al
  6695 00003916 C706[1805]00E5          		mov	word [CREATING], 0E500h
  6696 0000391C C606[F802]01            		mov	byte [NoSetDir], 1
  6697 00003921 C536[DA02]              		lds	si, [DMAADD]
  6698 00003925 AC                      		lodsb
  6699                                  
  6700                                  ; ---------------------------------------------------------------------------
  6701                                  
  6702                                  		; 08/09/2022
  6703                                  RENAME_NEXT:
  6704 00003926 16                      		push	ss
  6705 00003927 07                      		pop	es
  6706 00003928 BF[E604]                		mov	di, NAME1
  6707 0000392B B90B00                  		mov	cx, 11
  6708 0000392E F3A4                    		rep movsb
  6709 00003930 AC                      		lodsb
  6710 00003931 36A2[0605]              		mov	byte [ss:ATTRIB], al
  6711 00003935 AD                      		lodsw
  6712 00003936 09C0                    		or	ax, ax
  6713 00003938 7903                    		jns	short cont_load
  6714                                  No_files:
  6715 0000393A E918FF                  		jmp	find_no_more
  6716                                  cont_load:
  6717 0000393D 50                      		push	ax
  6718 0000393E AD                      		lodsw
  6719 0000393F 89C3                    		mov	bx, ax
  6720 00003941 16                      		push	ss
  6721 00003942 1F                      		pop	ds
  6722 00003943 C42E[2405]              		les	bp, [THISDPB]
  6723 00003947 E8A70D                  		call	SETDIRSRCH
  6724 0000394A 7303                    		jnb	short SEARCH_GOON
  6725 0000394C 58                      		pop	ax
  6726 0000394D EBEB                    		jmp	short No_files
  6727                                  SEARCH_GOON:
  6728 0000394F E88710                  		call	STARTSRCH
  6729 00003952 58                      		pop	ax
  6730 00003953 E86B0D                  		call	GetEnt
  6731 00003956 72E2                    		jb	short No_files
  6732 00003958 E8A80C                  		call	NextEnt
  6733 0000395B 72DD                    		jb	short No_files
  6734 0000395D 30E4                    		xor	ah, ah
  6735 0000395F E91AFF                  		jmp	found_it
  6736                                  
  6737                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6738                                  
  6739                                  		; 08/09/2022
  6740                                  DOS_ABORT:
  6741 00003962 368E06[DE02]            		mov	es, [ss:CurrentPDB]
  6742 00003967 268B0E[3200]            		mov	cx, word [es:BCON]
  6743                                  reset_free_jfn:
  6744 0000396C 89CB                    		mov	bx, cx
  6745 0000396E 51                      		push	cx
  6746 0000396F 4B                      		dec	bx
  6747 00003970 E82633                  		call	_$CLOSE
  6748 00003973 59                      		pop	cx
  6749 00003974 E2F6                    		loop	reset_free_jfn
  6750 00003976 16                      		push	ss
  6751 00003977 1F                      		pop	ds
  6752 00003978 B81D11                  		mov	ax, 111Dh
  6753 0000397B CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - CLOSE ALL REMOTE FILES FOR PROCESS
  6754                                  					; DS???, SS = DOS CS
  6755 0000397D FF1E[6C00]              		call	far [MFTCloseP]
  6756 00003981 36C43E[4000]            		les	di, [ss:SFTFCB]
  6757 00003986 268B4D04                		mov	cx, [es:di+4]
  6758 0000398A E317                    		jcxz	FCBScanDone
  6759 0000398C 8D7D06                  		lea	di, [di+6]
  6760 0000398F 36A1[E802]              		mov	ax, [ss:PROC_ID]
  6761                                  FCBTest:
  6762 00003993 26394531                		cmp	[es:di+31h], ax
  6763 00003997 7505                    		jnz	short FCBNext
  6764 00003999 26C7050000              		mov	word [es:di], 0
  6765                                  FCBNext:
  6766 0000399E 83C735                  		add	di, 53
  6767 000039A1 E2F0                    		loop	FCBTest
  6768                                  FCBScanDone:
  6769 000039A3 31DB                    		xor	bx, bx
  6770                                  Scan:
  6771 000039A5 53                      		push	bx
  6772 000039A6 E8372D                  		call	SFFromSFN
  6773 000039A9 5B                      		pop	bx
  6774 000039AA 7301                    		jnb	short Scan1
  6775 000039AC C3                      		retn
  6776                                  
  6777                                  ; ---------------------------------------------------------------------------
  6778                                  
  6779                                  		; 08/09/2022
  6780                                  Scan1:
  6781 000039AD 26833D00                		cmp	word [es:di], 0
  6782 000039B1 7419                    		jz	short scan_next
  6783 000039B3 36A1[E802]              		mov	ax, [ss:PROC_ID]
  6784 000039B7 26394531                		cmp	[es:di+31h], ax
  6785 000039BB 750F                    		jnz	short scan_next
  6786 000039BD 36A1[EA02]              		mov	ax, [ss:USER_ID]
  6787 000039C1 2639452F                		cmp	[es:di+2Fh], ax
  6788 000039C5 7505                    		jnz	short scan_next
  6789 000039C7 26C7050000              		mov	word [es:di], 0
  6790                                  scan_next:
  6791 000039CC 43                      		inc	bx
  6792 000039CD EBD6                    		jmp	short Scan
  6793                                  
  6794                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6795                                  
  6796                                  		; 08/09/2022
  6797                                  DOS_CLOSE:
  6798 000039CF C43E[3605]              		les	di, [THISSFT]
  6799 000039D3 268B5D05                		mov	bx, [es:di+5]
  6800 000039D7 F7C30080                		test	bx, 8000h
  6801 000039DB 7406                    		jz	short LocalClose
  6802 000039DD B80611                  		mov	ax, 1106h
  6803 000039E0 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - CLOSE REMOTE	FILE
  6804                                  					; ES:DI	-> SFT
  6805                                  					; SFT DPB field	-> DPB of drive	containing file
  6806                                  					; Return: CF set on error, AX =	DOS error code
  6807                                  					; CF clear if successful
  6808 000039E2 C3                      		retn
  6809                                  
  6810                                  ; ---------------------------------------------------------------------------
  6811                                  
  6812                                  		; 08/09/2022
  6813                                  LocalClose:
  6814 000039E3 E84FE5                  		call	EcritDisk
  6815 000039E6 E80E01                  		call	SetSFTTimes
  6816 000039E9 E89D00                  		call	FREESFT
  6817 000039EC 16                      		push	ss
  6818 000039ED 1F                      		pop	ds
  6819 000039EE 50                      		push	ax
  6820 000039EF 53                      		push	bx
  6821 000039F0 E8EC37                  		call	ShareEnd
  6822 000039F3 5B                      		pop	bx
  6823 000039F4 58                      		pop	ax
  6824                                  CloseEntry:
  6825 000039F5 50                      		push	ax
  6826 000039F6 F7C3C000                		test	bx, 0C0h
  6827 000039FA 757A                    		jnz	short FREE_SFT_OK
  6828                                  rdir:
  6829 000039FC E89700                  		call	DirFromSFT
  6830 000039FF B005                    		mov	al, 5
  6831 00003A01 7274                    		jb	short CloseFinish
  6832                                  clook:
  6833 00003A03 57                      		push	di
  6834 00003A04 56                      		push	si
  6835 00003A05 8D7420                  		lea	si, [si+20h]
  6836 00003A08 E83FE4                  		call	XCHGP
  6837 00003A0B E8530C                  		call	MetaCompare
  6838 00003A0E E839E4                  		call	XCHGP
  6839 00003A11 5E                      		pop	si
  6840 00003A12 5F                      		pop	di
  6841 00003A13 740B                    		jz	short CLOSE_GO
  6842                                  Bye:
  6843 00003A15 89F7                    		mov	di, si
  6844 00003A17 1E                      		push	ds
  6845 00003A18 07                      		pop	es
  6846 00003A19 16                      		push	ss
  6847 00003A1A 1F                      		pop	ds
  6848 00003A1B F9                      		stc
  6849 00003A1C B002                    		mov	al, 2
  6850 00003A1E EB57                    		jmp	short CloseFinish
  6851                                  
  6852                                  ; ---------------------------------------------------------------------------
  6853                                  
  6854                                  		; 08/09/2022
  6855                                  CLOSE_GO:
  6856 00003A20 268A6D0B                		mov	ch, [es:di+0Bh]
  6857 00003A24 8A4404                  		mov	al, [si+4]
  6858 00003A27 36A2[0605]              		mov	byte [ss:ATTRIB], al
  6859 00003A2B E8BF0F                  		call	MatchAttributes
  6860 00003A2E 75E5                    		jnz	short Bye
  6861                                  
  6862                                  setattr:
  6863 00003A30 26804D0B20              		or	byte [es:di+0Bh], 20h
  6864 00003A35 8B440B                  		mov	ax, [si+0Bh]
  6865 00003A38 2689451A                		mov	[es:di+1Ah], ax
  6866 00003A3C 8B4411                  		mov	ax, [si+11h]
  6867 00003A3F 2689451C                		mov	[es:di+1Ch], ax
  6868 00003A43 8B4413                  		mov	ax, [si+13h]
  6869 00003A46 2689451E                		mov	[es:di+1Eh], ax
  6870 00003A4A 8B440F                  		mov	ax, [si+0Fh]
  6871 00003A4D 26894518                		mov	[es:di+18h], ax
  6872 00003A51 8B440D                  		mov	ax, [si+0Dh]
  6873 00003A54 26894516                		mov	[es:di+16h], ax
  6874 00003A58 26804F0540              		or	byte [es:bx+5], 40h
  6875                                  yesdirty:
  6876 00003A5D 1E                      		push	ds
  6877 00003A5E 56                      		push	si
  6878 00003A5F 16                      		push	ss
  6879 00003A60 1F                      		pop	ds
  6880 00003A61 A0[1105]                		mov	al, byte [THISDRV]
  6881 00003A64 52                      		push	dx
  6882 00003A65 B400                    		mov	ah, 0
  6883 00003A67 88C2                    		mov	dl, al
  6884                                  
  6885                                  do_update:
  6886 00003A69 E8B6F8                  		call	FastOpen_Update
  6887 00003A6C 5A                      		pop	dx
  6888 00003A6D E8CD23                  		call	FLUSHBUF
  6889 00003A70 5F                      		pop	di
  6890 00003A71 07                      		pop	es
  6891 00003A72 B005                    		mov	al, 5
  6892 00003A74 7201                    		jb	short CloseFinish
  6893                                  FREE_SFT_OK:
  6894 00003A76 F8                      		clc
  6895                                  CloseFinish:
  6896 00003A77 9C                      		pushf
  6897 00003A78 E80D13                  		call	DEV_CLOSE_SFT
  6898 00003A7B 9D                      		popf
  6899 00003A7C 59                      		pop	cx
  6900 00003A7D 9C                      		pushf
  6901 00003A7E 49                      		dec	cx
  6902 00003A7F 7503                    		jnz	short NoFree
  6903 00003A81 26890D                  		mov	[es:di], cx
  6904                                  NoFree:
  6905 00003A84 E8B6E4                  		call	LcritDisk
  6906 00003A87 9D                      		popf
  6907 00003A88 C3                      		retn
  6908                                  
  6909                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6910                                  
  6911                                  		; 08/09/2022
  6912                                  FREESFT:
  6913 00003A89 9C                      		pushf
  6914 00003A8A 268B05                  		mov	ax, [es:di]
  6915 00003A8D 48                      		dec	ax
  6916 00003A8E 7501                    		jnz	short SetCount
  6917 00003A90 48                      		dec	ax
  6918                                  SetCount:
  6919 00003A91 268705                  		xchg	ax, [es:di]
  6920 00003A94 9D                      		popf
  6921 00003A95 C3                      		retn
  6922                                  
  6923                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6924                                  
  6925                                  		; 08/09/2022
  6926                                  DirFromSFT:
  6927 00003A96 C606[D102]02            		mov	byte [EXTERR_LOCUS], 2
  6928 00003A9B 06                      		push	es
  6929 00003A9C 57                      		push	di
  6930 00003A9D 268B551D                		mov	dx, [es:di+1Dh]
  6931 00003AA1 52                      		push	dx
  6932 00003AA2 E80920                  		call	FATREAD_SFT
  6933 00003AA5 5A                      		pop	dx
  6934 00003AA6 7225                    		jb	short PopDone
  6935 00003AA8 30C0                    		xor	al, al
  6936 00003AAA C606[F702]18            		mov	byte [ALLOWED], 18h
  6937 00003AAF E8E022                  		call	GETBUFFR
  6938 00003AB2 7219                    		jb	short PopDone
  6939 00003AB4 5E                      		pop	si
  6940 00003AB5 1F                      		pop	ds
  6941 00003AB6 36C43E[7405]            		les	di, [ss:CURBUF]
  6942 00003ABB 26804D0504              		or	byte [es:di+5], 4
  6943 00003AC0 89FB                    		mov	bx, di
  6944 00003AC2 8D7D10                  		lea	di, [di+10h]
  6945 00003AC5 B020                    		mov	al, 32
  6946 00003AC7 F6641F                  		mul	byte [si+1Fh]
  6947 00003ACA 01C7                    		add	di, ax
  6948 00003ACC C3                      		retn
  6949                                  PopDone:
  6950 00003ACD 5F                      		pop	di
  6951 00003ACE 07                      		pop	es
  6952                                  PopDone_retn:
  6953 00003ACF C3                      		retn
  6954                                  
  6955                                  ; ---------------------------------------------------------------------------
  6956                                  
  6957                                  		; 08/09/2022
  6958                                  DOS_COMMIT:
  6959 00003AD0 C43E[3605]              		les	di, [THISSFT]
  6960 00003AD4 268B5D05                		mov	bx, [es:di+5]
  6961 00003AD8 F7C3C000                		test	bx, 0C0h
  6962 00003ADC 75F1                    		jnz	short PopDone_retn
  6963 00003ADE F7C30080                		test	bx, 8000h
  6964 00003AE2 7406                    		jz	short LOCAL_COMMIT
  6965 00003AE4 B80711                  		mov	ax, 1107h
  6966 00003AE7 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - COMMIT REMOTE FILE
  6967                                  					; ES:DI	-> SFT
  6968                                  					; SFT DPB field	-> DPB of drive	containing file
  6969                                  					; Return: CF set on error, AX =	DOS error code
  6970                                  					; CF clear if successful
  6971 00003AE9 C3                      		retn
  6972                                  
  6973                                  ; ---------------------------------------------------------------------------
  6974                                  
  6975                                  		; 08/09/2022
  6976                                  LOCAL_COMMIT:
  6977 00003AEA E848E4                  		call	EcritDisk
  6978 00003AED E80700                  		call	SetSFTTimes
  6979 00003AF0 B8FFFF                  		mov	ax, -1
  6980 00003AF3 E8FFFE                  		call	CloseEntry
  6981                                  
  6982                                  localcommit_retn:
  6983 00003AF6 C3                      		retn
  6984                                  
  6985                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  6986                                  
  6987                                  		; 08/09/2022
  6988                                  SetSFTTimes:
  6989 00003AF7 F7C3C000                		test	bx, 0C0h
  6990 00003AFB 75F9                    		jnz	short localcommit_retn
  6991 00003AFD F7C30040                		test	bx, 4000h
  6992 00003B01 75F3                    		jnz	short localcommit_retn
  6993 00003B03 50                      		push	ax
  6994 00003B04 53                      		push	bx
  6995 00003B05 E81EDD                  		call	DATE16
  6996 00003B08 2689450F                		mov	[es:di+0Fh], ax
  6997 00003B0C 2689550D                		mov	[es:di+0Dh], dx
  6998 00003B10 31C0                    		xor	ax, ax
  6999 00003B12 FF1E[9400]              		call	far [ShSU]
  7000 00003B16 5B                      		pop	bx
  7001 00003B17 58                      		pop	ax
  7002 00003B18 C3                      		retn
  7003                                  
  7004                                  ; ---------------------------------------------------------------------------
  7005                                  
  7006                                  		; 08/09/2022
  7007                                  DOS_MKDIR:
  7008 00003B19 E87AE3                  		call	TestNet
  7009 00003B1C 7314                    		jnb	short LOCAL_MKDIR
  7010 00003B1E B80311                  		mov	ax, 1103h
  7011 00003B21 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - MAKE	REMOTE DIRECTORY
  7012                                  					; SS = DOS CS
  7013                                  					; SDA first filename pointer ->	fully-qualified	directory name
  7014                                  					; SDA CDS pointer -> current directory
  7015                                  					; Return: CF set on error, AX =	DOS error code
  7016                                  					; CF clear if successful
  7017 00003B23 C3                      		retn
  7018                                  
  7019                                  ; ---------------------------------------------------------------------------
  7020                                  
  7021                                  		; 08/09/2022
  7022                                  NODEACCERRJ:
  7023 00003B24 B80500                  		mov	ax, 5
  7024                                  _BadRet:
  7025 00003B27 F9                      		stc
  7026 00003B28 E812E4                  		call	LcritDisk
  7027 00003B2B C3                      		retn
  7028                                  PATHNFJ:
  7029 00003B2C E80EE4                  		call	LcritDisk
  7030 00003B2F E90AFB                  		jmp	SET_MKND_ERR
  7031                                  
  7032                                  ; ---------------------------------------------------------------------------
  7033                                  
  7034                                  		; 08/09/2022
  7035                                  LOCAL_MKDIR:
  7036 00003B32 E800E4                  		call	EcritDisk
  7037 00003B35 8C16[3805]              		mov	word [THISSFT+2], ss
  7038 00003B39 C706[3605][E003]        		mov	word [THISSFT], RENBUF
  7039 00003B3F C706[1304]0000          		mov	word [RENBUF_SF_ENTRY_sf_MFT], 0
  7040 00003B45 B010                    		mov	al, 10h
  7041 00003B47 E8EA13                  		call	MakeNode
  7042 00003B4A 72E0                    		jb	short PATHNFJ
  7043 00003B4C 83F803                  		cmp	ax, 3
  7044 00003B4F 74D3                    		jz	short NODEACCERRJ
  7045 00003B51 C42E[2405]              		les	bp, [THISDPB]
  7046 00003B55 C53E[7405]              		lds	di, [CURBUF]
  7047 00003B59 29FE                    		sub	si, di
  7048 00003B5B 56                      		push	si
  7049 00003B5C FF7506                  		push	word [di+6]
  7050 00003B5F 16                      		push	ss
  7051 00003B60 1F                      		pop	ds
  7052 00003B61 FF36[5805]              		push	word [DIRSTART]
  7053 00003B65 31C0                    		xor	ax, ax
  7054 00003B67 A3[5805]                		mov	[DIRSTART], ax
  7055 00003B6A E80B13                  		call	NEWDIR
  7056 00003B6D 7260                    		jb	short NODEEXISTSPOPDEL
  7057 00003B6F E84F0B                  		call	GetEnt
  7058 00003B72 725B                    		jb	short NODEEXISTSPOPDEL
  7059 00003B74 C43E[7405]              		les	di, [CURBUF]
  7060 00003B78 26804D0540              		or	byte [es:di+5], 40h
  7061                                  
  7062                                  yesdirty1:
  7063 00003B7D 83C710                  		add	di, 16
  7064 00003B80 B82E20                  		mov	ax, 202Eh
  7065 00003B83 8B16[5805]              		mov	dx, [DIRSTART]
  7066 00003B87 E88613                  		call	SETDOTENT
  7067 00003B8A B82E2E                  		mov	ax, 2E2Eh
  7068 00003B8D 5A                      		pop	dx
  7069 00003B8E E87F13                  		call	SETDOTENT
  7070 00003B91 C42E[2405]              		les	bp, [THISDPB]
  7071 00003B95 C606[F702]18            		mov	byte [ALLOWED], 18h
  7072 00003B9A 5A                      		pop	dx
  7073 00003B9B 30C0                    		xor	al, al
  7074 00003B9D E8F221                  		call	GETBUFFR
  7075 00003BA0 7256                    		jb	short NODEEXISTSP
  7076 00003BA2 8B16[5805]              		mov	dx, [DIRSTART]
  7077 00003BA6 C53E[7405]              		lds	di, [CURBUF]
  7078 00003BAA 804D0504                		or	byte [di+5], 4
  7079 00003BAE 5E                      		pop	si
  7080 00003BAF 01FE                    		add	si, di
  7081 00003BB1 8914                    		mov	[si], dx
  7082 00003BB3 31D2                    		xor	dx, dx
  7083 00003BB5 895402                  		mov	[si+2],	dx
  7084 00003BB8 895404                  		mov	[si+4],	dx
  7085                                  DIRUP:
  7086 00003BBB 804D0540                		or	byte [di+5], 40h
  7087                                  yesdirty2:
  7088 00003BBF 16                      		push	ss
  7089 00003BC0 1F                      		pop	ds
  7090 00003BC1 268A4600                		mov	al, [es:bp+0]
  7091 00003BC5 E87522                  		call	FLUSHBUF
  7092 00003BC8 B80500                  		mov	ax, 5
  7093 00003BCB E86FE3                  		call	LcritDisk
  7094 00003BCE C3                      		retn
  7095                                  
  7096                                  NODEEXISTSPOPDEL:
  7097 00003BCF 5A                      		pop	dx
  7098 00003BD0 5A                      		pop	dx
  7099 00003BD1 C42E[2405]              		les	bp, [THISDPB]
  7100 00003BD5 C606[F702]18            		mov	byte [ALLOWED], 18h
  7101 00003BDA 30C0                    		xor	al, al
  7102 00003BDC E8B321                  		call	GETBUFFR
  7103 00003BDF 7217                    		jb	short NODEEXISTSP
  7104 00003BE1 C53E[7405]              		lds	di, [CURBUF]
  7105 00003BE5 804D0504                		or	byte [di+5], 4
  7106 00003BE9 5E                      		pop	si
  7107 00003BEA 01FE                    		add	si, di
  7108 00003BEC 83EE1A                  		sub	si, 1Ah
  7109 00003BEF C604E5                  		mov	byte [si], 0E5h
  7110 00003BF2 E8C6FF                  		call	DIRUP
  7111                                  NODEEXISTS:
  7112 00003BF5 E92CFF                  		jmp	NODEACCERRJ
  7113                                  NODEEXISTSP:
  7114 00003BF8 5E                      		pop	si
  7115 00003BF9 EBFA                    		jmp	short NODEEXISTS
  7116                                  
  7117                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7118                                  
  7119                                  		; 08/09/2022
  7120                                  DOS_CHDIR:
  7121 00003BFB E898E2                  		call	TestNet
  7122 00003BFE 7306                    		jnb	short LOCAL_CHDIR
  7123 00003C00 B80511                  		mov	ax, 1105h
  7124 00003C03 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - CHDIR
  7125                                  					; SS = DOS CS
  7126                                  					; SDA first filename pointer ->	fully-qualified	directory name
  7127                                  					; SDA CDS pointer -> current directory
  7128                                  					; Return: CF set on error, AX =	DOS error code
  7129                                  					; CF clear if successful
  7130 00003C05 C3                      		retn
  7131                                  
  7132                                  ; ---------------------------------------------------------------------------
  7133                                  
  7134                                  		; 08/09/2022
  7135                                  LOCAL_CHDIR:
  7136 00003C06 E82CE3                  		call	EcritDisk
  7137 00003C09 C606[F802]00            		mov	byte [NoSetDir], 0
  7138 00003C0E C606[0805]16            		mov	byte [ExtFCB+1], 16h
  7139 00003C13 800E[660F]01            		or	byte [FastOpenFlg], 1
  7140 00003C18 E82B0B                  		call	GetPath
  7141 00003C1B C606[660F]00            		mov	byte [FastOpenFlg], 0
  7142 00003C20 B80300                  		mov	ax, 3
  7143 00003C23 7207                    		jb	short ChDirDone
  7144 00003C25 753A                    		jnz	short NOTDIRPATH
  7145 00003C27 8B0E[5805]              		mov	cx, [DIRSTART]
  7146 00003C2B F8                      		clc
  7147                                  ChDirDone:
  7148 00003C2C E80EE3                  		call	LcritDisk
  7149 00003C2F C3                      		retn
  7150                                  
  7151                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7152                                  
  7153                                  		; 08/09/2022
  7154                                  DOS_RMDIR:
  7155 00003C30 E863E2                  		call	TestNet
  7156 00003C33 7306                    		jnb	short LOCAL_RMDIR
  7157 00003C35 B80111                  		mov	ax, 1101h
  7158 00003C38 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - REMOVE REMOTE DIRECTORY
  7159                                  					; SS = DOS CS
  7160                                  					; SDA first filename pointer ->	fully-qualified	directory name
  7161                                  					; SDA CDS pointer -> current directory
  7162                                  					; Return: CF set on error, AX =	DOS error code
  7163                                  					; CF clear if successful
  7164 00003C3A C3                      		retn
  7165                                  
  7166                                  ; ---------------------------------------------------------------------------
  7167                                  		
  7168                                  		; 09/09/2022
  7169                                  		; 08/09/2022
  7170                                  LOCAL_RMDIR:
  7171 00003C3B E8F7E2                  		call	EcritDisk
  7172 00003C3E C606[F802]00            		mov	byte [NoSetDir], 0
  7173 00003C43 C606[0805]16            		mov	byte [ExtFCB+1], 16h
  7174 00003C48 E8FB0A                  		call	GetPath
  7175 00003C4B 720C                    		jb	short NOPATH
  7176 00003C4D 7512                    		jnz	short NOTDIRPATH
  7177 00003C4F 8B3E[5805]              		mov	di, [DIRSTART]
  7178 00003C53 09FF                    		or	di, di
  7179 00003C55 750D                    		jnz	short rmdir_get_buf
  7180 00003C57 EB08                    		jmp	short NOTDIRPATH
  7181                                  NOPATH:
  7182 00003C59 B80300                  		mov	ax, 3
  7183 00003C5C E9C8FE                  		jmp	_BadRet
  7184                                  NOTDIRPATHPOP:
  7185 00003C5F 58                      		pop	ax
  7186                                  NOTDIRPATHPOP2:
  7187 00003C60 58                      		pop	ax
  7188                                  NOTDIRPATH:
  7189 00003C61 E9C0FE                  		jmp	NODEACCERRJ
  7190                                  rmdir_get_buf:
  7191 00003C64 C53E[7405]              		lds	di, [CURBUF]
  7192 00003C68 29FB                    		sub	bx, di
  7193 00003C6A 53                      		push	bx
  7194 00003C6B FF7506                  		push	word [di+6]
  7195 00003C6E 16                      		push	ss
  7196 00003C6F 1F                      		pop	ds
  7197 00003C70 16                      		push	ss
  7198 00003C71 07                      		pop	es
  7199 00003C72 BF[E604]                		mov	di, NAME1
  7200 00003C75 B03F                    		mov	al, '?'
  7201 00003C77 B90B00                  		mov	cx, 11
  7202 00003C7A F3AA                    		rep stosb
  7203 00003C7C 30C0                    		xor	al, al
  7204 00003C7E AA                      		stosb
  7205 00003C7F E8570D                  		call	STARTSRCH
  7206 00003C82 E8390A                  		call	GETENTRY
  7207 00003C85 72D8                    		jb	short NOTDIRPATHPOP
  7208 00003C87 8E1E[7605]              		mov	ds, word [CURBUF+2]
  7209 00003C8B 89DE                    		mov	si, bx
  7210 00003C8D AD                      		lodsw
  7211 00003C8E 3D2E20                  		cmp	ax, 202Eh
  7212 00003C91 75CC                    		jnz	short NOTDIRPATHPOP
  7213 00003C93 83C61E                  		add	si, 30
  7214 00003C96 AD                      		lodsw
  7215 00003C97 3D2E2E                  		cmp	ax, '..'
  7216 00003C9A 75C3                    		jnz	short NOTDIRPATHPOP
  7217 00003C9C 16                      		push	ss
  7218 00003C9D 1F                      		pop	ds
  7219 00003C9E C706[F402]0200          		mov	word [LASTENT], 2
  7220 00003CA4 E8170A                  		call	GETENTRY
  7221 00003CA7 72B6                    		jb	short NOTDIRPATHPOP
  7222 00003CA9 C606[0605]16            		mov	byte [ATTRIB], 16h
  7223 00003CAE E81809                  		call	SRCH
  7224 00003CB1 73AC                    		jnb	short NOTDIRPATHPOP
  7225 00003CB3 803E[F602]00            		cmp	byte [FAILERR], 0
  7226 00003CB8 75A5                    		jnz	short NOTDIRPATHPOP
  7227 00003CBA C42E[2405]              		les	bp, [THISDPB]
  7228 00003CBE 8B1E[5805]              		mov	bx, [DIRSTART]
  7229 00003CC2 E82F17                  		call	RELEASE
  7230 00003CC5 7298                    		jb	short NOTDIRPATHPOP
  7231 00003CC7 5A                      		pop	dx
  7232 00003CC8 C606[F702]18            		mov	byte [ALLOWED], 18h
  7233 00003CCD 30C0                    		xor	al, al
  7234 00003CCF E8C020                  		call	GETBUFFR
  7235 00003CD2 728C                    		jb	short NOTDIRPATHPOP2
  7236 00003CD4 C53E[7405]              		lds	di, [CURBUF]
  7237 00003CD8 804D0504                		or	byte [di+5], 4
  7238 00003CDC 5B                      		pop	bx
  7239 00003CDD 01FB                    		add	bx, di
  7240 00003CDF C607E5                  		mov	byte [bx], 0E5h
  7241 00003CE2 1E                      		push	ds
  7242 00003CE3 16                      		push	ss
  7243 00003CE4 1F                      		pop	ds
  7244 00003CE5 50                      		push	ax
  7245 00003CE6 8B36[4A05]              		mov	si, [WFP_START]
  7246 00003CEA BB[3B0F]                		mov	bx, FastTable
  7247 00003CED B003                    		mov	al, 3
  7248 00003CEF FF5F02                  		call	far [bx+2] ; 09/09/2022
  7249 00003CF2 58                      		pop	ax
  7250 00003CF3 1F                      		pop	ds
  7251 00003CF4 E9C4FE                  		jmp	DIRUP
  7252                                  
  7253                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7254                                  
  7255                                  		; 08/09/2022
  7256                                  SWAPBACK:
  7257 00003CF7 C606[0303]00            		mov	byte [CONSWAP], 0
  7258 00003CFC C3                      		retn
  7259                                  
  7260                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7261                                  
  7262                                  		; 08/09/2022
  7263                                  SWAPCON:
  7264 00003CFD 06                      		push	es
  7265 00003CFE 57                      		push	di
  7266 00003CFF C606[0303]01            		mov	byte [CONSWAP], 1
  7267 00003D04 C43E[3605]              		les	di, [THISSFT]
  7268 00003D08 893E[7805]              		mov	word [CONSFT], di
  7269 00003D0C 8C06[7A05]              		mov	word [CONSFT+2], es
  7270 00003D10 5F                      		pop	di
  7271 00003D11 07                      		pop	es
  7272 00003D12 C3                      		retn
  7273                                  
  7274                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7275                                  
  7276                                  		; 08/09/2022
  7277                                  DOS_READ:
  7278 00003D13 C43E[3605]              		les	di, [THISSFT]
  7279 00003D17 268A4502                		mov	al, [es:di+2]
  7280 00003D1B 240F                    		and	al, 0Fh
  7281 00003D1D 3C01                    		cmp	al, 1
  7282 00003D1F 7503                    		jnz	short READ_NO_MODE
  7283 00003D21 E93D05                  		jmp	SET_ACC_ERR
  7284                                  READ_NO_MODE:
  7285 00003D24 E8F303                  		call	SETUP
  7286 00003D27 E30B                    		jcxz	NoIORet
  7287 00003D29 E87FE1                  		call	IsSFTNet
  7288 00003D2C 7408                    		jz	short LOCAL_READ
  7289 00003D2E B80811                  		mov	ax, 1108h
  7290 00003D31 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - READ	FROM REMOTE FILE
  7291                                  					; ES:DI	-> SFT
  7292                                  					; SFT DPB field	-> DPB of drive	containing file
  7293                                  					; CX = number of bytes,	SS = DOS CS, SDA DTA field -> user buffer
  7294                                  					; Return: CF set on error, CX =	bytes read
  7295 00003D33 C3                      		retn
  7296                                  NoIORet:
  7297 00003D34 F8                      		clc
  7298 00003D35 C3                      		retn
  7299                                  
  7300                                  ; ---------------------------------------------------------------------------
  7301                                  
  7302                                  		; 14/09/2022
  7303                                  		; 10/09/2022
  7304                                  		; 08/09/2022
  7305                                  LOCAL_READ:
  7306 00003D36 26F745058000            		test	word [es:di+5], 80h
  7307 00003D3C 750F                    		jnz	short READDEV
  7308 00003D3E C606[D102]02            		mov	byte [EXTERR_LOCUS], 2
  7309 00003D43 E8EFE1                  		call	EcritDisk
  7310 00003D46 E8C804                  		call	DISKREAD
  7311 00003D49 E8F1E1                  		call	LcritDisk
  7312 00003D4C C3                      		retn
  7313                                  READDEV:
  7314 00003D4D C606[D102]04            		mov	byte [EXTERR_LOCUS], 4
  7315 00003D52 268A5D05                		mov	bl, [es:di+5]
  7316 00003D56 C43E[DA02]              		les	di, [DMAADD]
  7317 00003D5A F6C340                  		test	bl, 40h
  7318 00003D5D 7407                    		jz	short ENDRDDEVJ3
  7319 00003D5F F6C304                  		test	bl, 4
  7320 00003D62 7405                    		jz	short TESTRAW
  7321 00003D64 30C0                    		xor	al, al
  7322                                  ENDRDDEVJ3:
  7323 00003D66 E9C000                  		jmp	ENDRDDEVJ2
  7324                                  TESTRAW:
  7325 00003D69 F6C320                  		test	bl, 20h
  7326 00003D6C 7508                    		jnz	short DVRDRAW
  7327 00003D6E F6C301                  		test	bl, 1
  7328 00003D71 7449                    		jz	short NOTRDCON
  7329 00003D73 E9E900                  		jmp	READCON
  7330                                  DVRDRAW:
  7331 00003D76 06                      		push	es
  7332 00003D77 1F                      		pop	ds
  7333                                  ReadRawRetry:
  7334                                  		; 14/09/2022
  7335                                  		;mov	bx, di
  7336                                  		; 10/09/2022 - Magic Code ! (for Windows 3.1)
  7337 00003D78 8BDF                    		db	8Bh, 0DFh
  7338                                  		;xor	ax, ax
  7339 00003D7A 33C0                    		db	33h, 0C0h
  7340                                  		;mov	dx, ax
  7341 00003D7C 8BD0                    		db	8Bh, 0D0h
  7342 00003D7E E8A510                  		call	SETREAD
  7343 00003D81 1E                      		push	ds
  7344 00003D82 36C536[3605]            		lds	si, [ss:THISSFT]
  7345 00003D87 E87510                  		call	DEVIOCALL
  7346                                  		;mov	dx, di
  7347 00003D8A 8BD7                    		db	8Bh, 0D7h
  7348 00003D8C B486                    		mov	ah, 86h
  7349 00003D8E 368B3E[0903]            		mov	di, word [ss:DEVCALL_REQSTAT]
  7350 00003D93 F7C70080                		test	di, 8000h
  7351 00003D97 7419                    		jz	short CRDROK
  7352 00003D99 E89419                  		call	CHARHARD
  7353                                  		;mov	di, dx
  7354 00003D9C 8BFA                    		db	8Bh, 0FAh
  7355 00003D9E 08C0                    		or	al, al
  7356 00003DA0 7410                    		jz	short CRDROK
  7357 00003DA2 3C03                    		cmp	al, 3
  7358 00003DA4 7403                    		jz	short CRDFERR
  7359 00003DA6 1F                      		pop	ds
  7360 00003DA7 EBCF                    		jmp	short ReadRawRetry
  7361                                  CRDFERR:
  7362 00003DA9 5F                      		pop	di
  7363                                  DEVIOFERR:
  7364 00003DAA 36C43E[3605]            		les	di, [ss:THISSFT]
  7365 00003DAF E9AD04                  		jmp	SET_ACC_ERR_DS
  7366                                  CRDROK:
  7367 00003DB2 5F                      		pop	di
  7368 00003DB3 89D7                    		mov	di, dx
  7369 00003DB5 36033E[1803]            		add	di, word [ss:CALLSCNT]
  7370 00003DBA EBAA                    		jmp	short ENDRDDEVJ3
  7371                                  NOTRDCON:
  7372 00003DBC 8CC0                    		mov	ax, es
  7373 00003DBE 8ED8                    		mov	ds, ax
  7374 00003DC0 89FB                    		mov	bx, di
  7375 00003DC2 31D2                    		xor	dx, dx
  7376 00003DC4 89D0                    		mov	ax, dx
  7377 00003DC6 51                      		push	cx
  7378 00003DC7 B90100                  		mov	cx, 1
  7379 00003DCA E85910                  		call	SETREAD
  7380 00003DCD 59                      		pop	cx
  7381 00003DCE 36C536[3605]            		lds	si, [ss:THISSFT]
  7382 00003DD3 C57407                  		lds	si, [si+7]
  7383                                  DVRDLP:
  7384 00003DD6 E88417                  		call	DSKSTATCHK
  7385 00003DD9 E82610                  		call	DEVIOCALL2
  7386 00003DDC 57                      		push	di
  7387 00003DDD B486                    		mov	ah, 86h
  7388 00003DDF 368B3E[0903]            		mov	di, word [ss:DEVCALL_REQSTAT]
  7389 00003DE4 F7C70080                		test	di, 8000h
  7390 00003DE8 7417                    		jz	short CRDOK
  7391 00003DEA E84319                  		call	CHARHARD
  7392 00003DED 5F                      		pop	di
  7393 00003DEE 36C706[1803]0100        		mov	word [ss:CALLSCNT], 1
  7394 00003DF5 3C01                    		cmp	al, 1
  7395 00003DF7 74DD                    		jz	short DVRDLP
  7396 00003DF9 3C03                    		cmp	al, 3
  7397 00003DFB 74AD                    		jz	short DEVIOFERR
  7398 00003DFD 30C0                    		xor	al, al
  7399 00003DFF EB12                    		jmp	short DVRDIGN
  7400                                  CRDOK:
  7401 00003E01 5F                      		pop	di
  7402 00003E02 36833E[1803]01          		cmp	word [ss:CALLSCNT], 1
  7403 00003E08 751F                    		jnz	short ENDRDDEVJ2
  7404 00003E0A 1E                      		push	ds
  7405 00003E0B 368E1E[1603]            		mov	ds, [ss:CALLXAD+2]
  7406 00003E10 8A05                    		mov	al, [di]
  7407 00003E12 1F                      		pop	ds
  7408                                  DVRDIGN:
  7409 00003E13 36FF06[1403]            		inc	word [ss:CALLXAD]
  7410 00003E18 36C706[0903]0000        		mov	word [ss:DEVCALL_REQSTAT], 0
  7411 00003E1F 47                      		inc	di
  7412 00003E20 3C1A                    		cmp	al, 1Ah
  7413 00003E22 7405                    		jz	short ENDRDDEVJ2
  7414 00003E24 3C0D                    		cmp	al, 0Dh
  7415 00003E26 E0AE                    		loopne	DVRDLP
  7416 00003E28 40                      		inc	ax
  7417                                  ENDRDDEVJ2:
  7418 00003E29 EB1F                    		jmp	short ENDRDDEV
  7419                                  
  7420                                  ; ---------------------------------------------------------------------------
  7421                                  
  7422                                  		; 08/09/2022
  7423                                  TRANBUF:
  7424 00003E2B AC                      		lodsb
  7425 00003E2C AA                      		stosb
  7426 00003E2D 3C0D                    		cmp	al, 0Dh
  7427 00003E2F 7503                    		jnz	short NORMCH
  7428 00003E31 C6040A                  		mov	byte [si], 0Ah
  7429                                  NORMCH:
  7430 00003E34 3C0A                    		cmp	al, 0Ah
  7431 00003E36 E0F3                    		loopne	TRANBUF
  7432 00003E38 7507                    		jnz	short ENDRDCON
  7433 00003E3A 31F6                    		xor	si, si
  7434 00003E3C E845E4                  		call	OUTT
  7435 00003E3F 0C01                    		or	al, 1
  7436                                  ENDRDCON:
  7437 00003E41 16                      		push	ss
  7438 00003E42 1F                      		pop	ds
  7439 00003E43 E8B1FE                  		call	SWAPBACK
  7440 00003E46 8936[2200]              		mov	[CONTPOS], si
  7441                                  ENDRDDEV:
  7442 00003E4A 16                      		push	ss
  7443 00003E4B 1F                      		pop	ds
  7444 00003E4C 893E[5005]              		mov	[NEXTADD], di
  7445 00003E50 7509                    		jnz	short SETSFTC
  7446 00003E52 C43E[3605]              		les	di, [THISSFT]
  7447 00003E56 26806505BF              		and	byte [es:di+5], 0BFh
  7448                                  SETSFTC:
  7449 00003E5B E8DF04                  		call	SETSFT
  7450 00003E5E C3                      		retn
  7451                                  
  7452                                  ; ---------------------------------------------------------------------------
  7453                                  
  7454                                  		; 08/09/2022
  7455                                  READCON:
  7456 00003E5F E89BFE                  		call	SWAPCON
  7457 00003E62 8B36[2200]              		mov	si, [CONTPOS]
  7458 00003E66 09F6                    		or	si, si
  7459 00003E68 75C1                    		jnz	short TRANBUF
  7460 00003E6A 803E[2902]80            		cmp	byte [CONBUF], 128
  7461 00003E6F 7406                    		jz	short GETBUF
  7462 00003E71 C706[2902]80FF          		mov	word [CONBUF], 0FF80h
  7463                                  GETBUF:
  7464 00003E77 51                      		push	cx
  7465 00003E78 06                      		push	es
  7466 00003E79 57                      		push	di
  7467 00003E7A BA[2902]                		mov	dx, CONBUF
  7468 00003E7D E847E1                  		call	_$STD_CON_STRING_INPUT
  7469 00003E80 5F                      		pop	di
  7470 00003E81 07                      		pop	es
  7471 00003E82 59                      		pop	cx
  7472 00003E83 BE[2B02]                		mov	si, CONBUF+2
  7473 00003E86 803C1A                  		cmp	byte [si], 1Ah
  7474 00003E89 75A0                    		jnz	short TRANBUF
  7475 00003E8B B01A                    		mov	al, 1Ah
  7476 00003E8D AA                      		stosb
  7477 00003E8E 4F                      		dec	di
  7478 00003E8F B00A                    		mov	al, 0Ah
  7479 00003E91 E8F0E3                  		call	OUTT
  7480 00003E94 31F6                    		xor	si, si
  7481 00003E96 EBA9                    		jmp	short ENDRDCON
  7482                                  
  7483                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7484                                  
  7485                                  		; 08/09/2022
  7486                                  DOS_WRITE:
  7487 00003E98 C43E[3605]              		les	di, [THISSFT]
  7488 00003E9C 268A4502                		mov	al, [es:di+2]
  7489 00003EA0 240F                    		and	al, 0Fh
  7490 00003EA2 3C00                    		cmp	al, 0
  7491 00003EA4 7503                    		jnz	short Check_FCB_RO
  7492                                  BadMode:
  7493 00003EA6 E9B803                  		jmp	SET_ACC_ERR
  7494                                  Check_FCB_RO:
  7495 00003EA9 26F745020080            		test	word [es:di+2], 8000h
  7496 00003EAF 7407                    		jz	short WRITE_NO_MODE
  7497 00003EB1 26F6450401              		test	byte [es:di+4], 1
  7498 00003EB6 75EE                    		jnz	short BadMode
  7499                                  WRITE_NO_MODE:
  7500 00003EB8 E85F02                  		call	SETUP
  7501 00003EBB E8EDDF                  		call	IsSFTNet
  7502 00003EBE 7406                    		jz	short LOCAL_WRITE
  7503 00003EC0 B80911                  		mov	ax, 1109h
  7504 00003EC3 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - WRITE TO REMOTE FILE
  7505                                  					; ES:DI	-> SFT
  7506                                  					; SFT DPB field	-> DPB of drive	containing file
  7507                                  					; CX = number of bytes,	SS = DOS CS, SDA DTA field -> user buffer
  7508                                  					; Return: CF set on error, CX =	bytes written
  7509 00003EC5 C3                      		retn
  7510                                  
  7511                                  ; ---------------------------------------------------------------------------
  7512                                  
  7513                                  		; 08/09/2022
  7514                                  LOCAL_WRITE:
  7515 00003EC6 26F745058000            		test	word [es:di+5], 80h
  7516 00003ECC 7554                    		jnz	short WRTDEV
  7517 00003ECE C606[D102]02            		mov	byte [EXTERR_LOCUS], 2
  7518 00003ED3 E85FE0                  		call	EcritDisk
  7519 00003ED6 E89304                  		call	DISKWRITE
  7520 00003ED9 E861E0                  		call	LcritDisk
  7521 00003EDC C3                      		retn
  7522                                  DVWRTRAW:
  7523 00003EDD 31C0                    		xor	ax, ax
  7524 00003EDF E8770F                  		call	SETWRITE
  7525 00003EE2 1E                      		push	ds
  7526 00003EE3 36C536[3605]            		lds	si, [ss:THISSFT]
  7527 00003EE8 E8140F                  		call	DEVIOCALL
  7528 00003EEB 89FA                    		mov	dx, di
  7529 00003EED B487                    		mov	ah, 87h
  7530 00003EEF 368B3E[0903]            		mov	di, word [ss:DEVCALL_REQSTAT]
  7531 00003EF4 F7C70080                		test	di, 8000h
  7532 00003EF8 7414                    		jz	short CWRTROK
  7533 00003EFA E83318                  		call	CHARHARD
  7534 00003EFD 89D3                    		mov	bx, dx
  7535 00003EFF 08C0                    		or	al, al
  7536 00003F01 740B                    		jz	short CWRTROK
  7537 00003F03 3C03                    		cmp	al, 3
  7538 00003F05 7403                    		jz	short CWRFERR
  7539 00003F07 1F                      		pop	ds
  7540 00003F08 EBD3                    		jmp	short DVWRTRAW
  7541                                  CWRFERR:
  7542 00003F0A 58                      		pop	ax
  7543 00003F0B E99BFE                  		jmp	CRDFERR
  7544                                  CWRTROK:
  7545 00003F0E 58                      		pop	ax
  7546 00003F0F 1F                      		pop	ds
  7547 00003F10 A1[1803]                		mov	ax, word [CALLSCNT]
  7548                                  ENDWRDEV:
  7549 00003F13 C43E[3605]              		les	di, [THISSFT]
  7550 00003F17 89C1                    		mov	cx, ax
  7551 00003F19 E84304                  		call	ADDREC
  7552 00003F1C C3                      		retn
  7553                                  WRTNUL:	
  7554 00003F1D 89CA                    		mov	dx, cx
  7555                                  WRTCOOKJ:
  7556 00003F1F E99100                  		jmp	WRTCOOKDONE
  7557                                  WRTDEV:
  7558 00003F22 C606[D102]04            		mov	byte [EXTERR_LOCUS], 4
  7559 00003F27 26804D0540              		or	byte [es:di+5], 40h
  7560 00003F2C 268A5D05                		mov	bl, [es:di+5]
  7561 00003F30 31C0                    		xor	ax, ax
  7562 00003F32 E3DF                    		jcxz	ENDWRDEV
  7563 00003F34 1E                      		push	ds
  7564 00003F35 88D8                    		mov	al, bl
  7565 00003F37 C51E[DA02]              		lds	bx, [DMAADD]
  7566 00003F3B 89DF                    		mov	di, bx
  7567 00003F3D 31D2                    		xor	dx, dx
  7568 00003F3F A820                    		test	al, 20h
  7569 00003F41 7402                    		jz	short TEST_DEV_CON
  7570 00003F43 EB98                    		jmp	short DVWRTRAW
  7571                                  TEST_DEV_CON:
  7572 00003F45 A802                    		test	al, 2
  7573 00003F47 7570                    		jnz	short WRITECON
  7574 00003F49 A804                    		test	al, 4
  7575 00003F4B 75D0                    		jnz	short WRTNUL
  7576 00003F4D 89D0                    		mov	ax, dx
  7577 00003F4F 803F1A                  		cmp	byte [bx], 1Ah
  7578 00003F52 74CB                    		jz	short WRTCOOKJ
  7579 00003F54 51                      		push	cx
  7580 00003F55 B90100                  		mov	cx, 1
  7581 00003F58 E8FE0E                  		call	SETWRITE
  7582 00003F5B 59                      		pop	cx
  7583 00003F5C 36C536[3605]            		lds	si, [ss:THISSFT]
  7584 00003F61 C57407                  		lds	si, [si+7]
  7585                                  DVWRTLP:
  7586 00003F64 E8F615                  		call	DSKSTATCHK
  7587 00003F67 E8980E                  		call	DEVIOCALL2
  7588 00003F6A 57                      		push	di
  7589 00003F6B B487                    		mov	ah, 87h
  7590 00003F6D 368B3E[0903]            		mov	di, word [ss:DEVCALL_REQSTAT]
  7591 00003F72 F7C70080                		test	di, 8000h
  7592 00003F76 7416                    		jz	short CWROK
  7593 00003F78 E8B517                  		call	CHARHARD
  7594 00003F7B 5F                      		pop	di
  7595 00003F7C 36C706[1803]0100        		mov	word [ss:CALLSCNT], 1
  7596 00003F83 3C01                    		cmp	al, 1
  7597 00003F85 74DD                    		jz	short DVWRTLP
  7598 00003F87 08C0                    		or	al, al
  7599 00003F89 740C                    		jz	short DVWRTIGN
  7600 00003F8B E91BFE                  		jmp	CRDFERR
  7601                                  
  7602                                  ; ---------------------------------------------------------------------------
  7603                                  
  7604                                  		; 08/09/2022
  7605                                  CWROK:
  7606 00003F8E 5F                      		pop	di
  7607 00003F8F 36833E[1803]00          		cmp	word [ss:CALLSCNT], 0
  7608 00003F95 741C                    		jz	short WRTCOOKDONE
  7609                                  DVWRTIGN:
  7610 00003F97 42                      		inc	dx
  7611 00003F98 36FF06[1403]            		inc	word [ss:CALLXAD]
  7612 00003F9D 47                      		inc	di
  7613 00003F9E 1E                      		push	ds
  7614 00003F9F 368E1E[1603]            		mov	ds, [ss:CALLXAD+2]
  7615 00003FA4 803D1A                  		cmp	byte [di], 1Ah
  7616 00003FA7 1F                      		pop	ds
  7617 00003FA8 7409                    		jz	short WRTCOOKDONE
  7618 00003FAA 36C706[0903]0000        		mov	word [ss:DEVCALL_REQSTAT], 0
  7619 00003FB1 E2B1                    		loop	DVWRTLP
  7620                                  WRTCOOKDONE:
  7621 00003FB3 89D0                    		mov	ax, dx
  7622 00003FB5 1F                      		pop	ds
  7623 00003FB6 E95AFF                  		jmp	ENDWRDEV
  7624                                  WRITECON:
  7625 00003FB9 1E                      		push	ds
  7626 00003FBA 16                      		push	ss
  7627 00003FBB 1F                      		pop	ds
  7628 00003FBC E83EFD                  		call	SWAPCON
  7629 00003FBF 1F                      		pop	ds
  7630 00003FC0 89DE                    		mov	si, bx
  7631 00003FC2 51                      		push	cx
  7632                                  WRCONLP:
  7633 00003FC3 AC                      		lodsb
  7634 00003FC4 3C1A                    		cmp	al, 1Ah
  7635 00003FC6 7405                    		jz	short CONEOF
  7636 00003FC8 E8B9E2                  		call	OUTT
  7637 00003FCB E2F6                    		loop	WRCONLP
  7638                                  CONEOF:
  7639 00003FCD 58                      		pop	ax
  7640 00003FCE 29C8                    		sub	ax, cx
  7641 00003FD0 1F                      		pop	ds
  7642 00003FD1 E823FD                  		call	SWAPBACK
  7643 00003FD4 E93CFF                  		jmp	ENDWRDEV
  7644                                  
  7645                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7646                                  
  7647                                  		; 08/09/2022
  7648                                  GET_IO_SFT:
  7649 00003FD7 36F606[0303]FF          		test	byte [ss:CONSWAP], 0FFh
  7650 00003FDD 7512                    		jnz	short GetRedir
  7651                                  GetNormal:
  7652 00003FDF 16                      		push	ss
  7653 00003FE0 1F                      		pop	ds
  7654 00003FE1 06                      		push	es
  7655 00003FE2 57                      		push	di
  7656 00003FE3 E8E026                  		call	SFFromHandle
  7657 00003FE6 7206                    		jb	short RET44P
  7658 00003FE8 8CC6                    		mov	si, es
  7659 00003FEA 8EDE                    		mov	ds, si
  7660 00003FEC 89FE                    		mov	si, di
  7661                                  RET44P:
  7662 00003FEE 5F                      		pop	di
  7663 00003FEF 07                      		pop	es
  7664 00003FF0 C3                      		retn
  7665                                  GetRedir:
  7666 00003FF1 83FB01                  		cmp	bx, 1
  7667 00003FF4 77E9                    		ja	short GetNormal
  7668 00003FF6 36C536[7805]            		lds	si, [ss:CONSFT]
  7669 00003FFB F8                      		clc
  7670                                  get_io_sft_retn:
  7671 00003FFC C3                      		retn
  7672                                  
  7673                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7674                                  
  7675                                  		; 08/09/2022
  7676                                  DIRREAD:
  7677 00003FFD 31D2                    		xor	dx, dx
  7678 00003FFF 833E[5805]00            		cmp	word [DIRSTART], 0
  7679 00004004 7504                    		jnz	short SubDir
  7680 00004006 92                      		xchg	ax, dx
  7681 00004007 EB0D                    		jmp	short DoRead
  7682                                  
  7683 00004009 90                      		nop
  7684                                  SubDir:
  7685 0000400A 88C2                    		mov	dl, al
  7686 0000400C 26225604                		and	dl, [es:bp+4]
  7687 00004010 268A4E05                		mov	cl, [es:bp+5]
  7688 00004014 D3E8                    		shr	ax, cl
  7689                                  DoRead:
  7690 00004016 8816[0E05]              		mov	byte [SECCLUSPOS], dl
  7691 0000401A 89C1                    		mov	cx, ax
  7692 0000401C 88D4                    		mov	ah, dl
  7693 0000401E 8B16[5605]              		mov	dx, [DIRSEC]
  7694 00004022 00E2                    		add	dl, ah
  7695 00004024 80D600                  		adc	dh, 0
  7696 00004027 8B1E[5405]              		mov	bx, [CLUSNUM]
  7697 0000402B 891E[6E05]              		mov	[NXTCLUSNUM], bx
  7698 0000402F E319                    		jcxz	FIRSTCLUSTER
  7699                                  SKPCLLP:
  7700 00004031 E81D19                  		call	UNPACK
  7701 00004034 72C6                    		jb	short get_io_sft_retn
  7702 00004036 87DF                    		xchg	bx, di
  7703 00004038 E8FF18                  		call	IsEOF
  7704 0000403B 7302                    		jnb	short HAVESKIPPED
  7705 0000403D E2F2                    		loop	SKPCLLP
  7706                                  HAVESKIPPED:
  7707 0000403F 891E[6E05]              		mov	[NXTCLUSNUM], bx
  7708 00004043 89FA                    		mov	dx, di
  7709 00004045 88E3                    		mov	bl, ah
  7710 00004047 E8F212                  		call	FIGREC
  7711                                  FIRSTCLUSTER:
  7712 0000404A C606[F702]18            		mov	byte [ALLOWED], 18h
  7713 0000404F 30C0                    		xor	al, al
  7714 00004051 E83E1D                  		call	GETBUFFR
  7715 00004054 72A6                    		jb	short get_io_sft_retn
  7716                                  SET_BUF_AS_DIR:
  7717 00004056 1E                      		push	ds
  7718 00004057 56                      		push	si
  7719 00004058 C536[7405]              		lds	si, [CURBUF]
  7720 0000405C 804C0504                		or	byte [si+5], 4
  7721 00004060 5E                      		pop	si
  7722 00004061 1F                      		pop	ds
  7723                                  dirread_retn:
  7724 00004062 C3                      		retn
  7725                                  
  7726                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7727                                  
  7728                                  		; 08/09/2022
  7729                                  FATSECRD:
  7730 00004063 36C606[F702]18          		mov	byte [ss:ALLOWED], 18h
  7731 00004069 89CF                    		mov	di, cx
  7732 0000406B 268A4E08                		mov	cl, [es:bp+8]
  7733 0000406F 268A460F                		mov	al, [es:bp+0Fh]
  7734 00004073 30E4                    		xor	ah, ah
  7735 00004075 88E5                    		mov	ch, ah
  7736 00004077 52                      		push	dx
  7737                                  NXTFAT:
  7738 00004078 51                      		push	cx
  7739 00004079 50                      		push	ax
  7740 0000407A 89F9                    		mov	cx, di
  7741 0000407C E82600                  		call	DSKREAD
  7742 0000407F 58                      		pop	ax
  7743 00004080 59                      		pop	cx
  7744 00004081 7420                    		jz	short RET41P
  7745 00004083 01C2                    		add	dx, ax
  7746 00004085 E2F1                    		loop	NXTFAT
  7747 00004087 5A                      		pop	dx
  7748 00004088 89F9                    		mov	cx, di
  7749                                  DREAD:
  7750 0000408A E81800                  		call	DSKREAD
  7751 0000408D 74D3                    		jz	short dirread_retn
  7752 0000408F 36C606[1005]00          		mov	byte [ss:SECCLUSPOS+2], 0
  7753 00004095 E86700                  		call	HARDERRRW
  7754 00004098 3C01                    		cmp	al, 1
  7755 0000409A 74EE                    		jz	short DREAD
  7756 0000409C 3C03                    		cmp	al, 3
  7757 0000409E F8                      		clc
  7758 0000409F 7501                    		jnz	short NO_CAR
  7759 000040A1 F9                      		stc
  7760                                  NO_CAR:
  7761 000040A2 C3                      		retn
  7762                                  RET41P:
  7763 000040A3 5A                      		pop	dx
  7764 000040A4 C3                      		retn
  7765                                  
  7766                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7767                                  
  7768                                  		; 08/09/2022
  7769                                  DSKREAD:
  7770 000040A5 51                      		push	cx
  7771 000040A6 268A6616                		mov	ah, [es:bp+16h]
  7772 000040AA 268A4601                		mov	al, [es:bp+1]
  7773 000040AE 53                      		push	bx
  7774 000040AF 06                      		push	es
  7775 000040B0 E8730D                  		call	SETREAD
  7776 000040B3 EB29                    		jmp	short DODSKOP
  7777                                  
  7778 000040B5 90                      		nop
  7779                                  
  7780                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7781                                  
  7782                                  		; 08/09/2022
  7783                                  DWRITE:
  7784 000040B6 E81700                  		call	DSKWRITE
  7785 000040B9 7501                    		jnz	short DWRITE_ERR
  7786 000040BB C3                      		retn
  7787                                  DWRITE_ERR:
  7788 000040BC 36C606[1005]01          		mov	byte [ss:SECCLUSPOS+2], 1
  7789 000040C2 E83A00                  		call	HARDERRRW
  7790 000040C5 3C01                    		cmp	al, 1
  7791 000040C7 74ED                    		jz	short DWRITE
  7792 000040C9 3C03                    		cmp	al, 3
  7793 000040CB F8                      		clc
  7794 000040CC 7501                    		jnz	short ret_label
  7795 000040CE F9                      		stc
  7796                                  ret_label:
  7797 000040CF C3                      		retn
  7798                                  
  7799                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7800                                  
  7801                                  		; 08/09/2022
  7802                                  DSKWRITE:
  7803 000040D0 51                      		push	cx
  7804 000040D1 268A6616                		mov	ah, [es:bp+16h]
  7805 000040D5 268A4601                		mov	al, [es:bp+1]
  7806 000040D9 53                      		push	bx
  7807 000040DA 06                      		push	es
  7808 000040DB E87B0D                  		call	SETWRITE
  7809                                  DODSKOP:
  7810 000040DE 8CD9                    		mov	cx, ds
  7811 000040E0 1F                      		pop	ds
  7812 000040E1 1E                      		push	ds
  7813 000040E2 3EC57612                		lds	si, [ds:bp+12h]
  7814 000040E6 E8190D                  		call	DEVIOCALL2
  7815 000040E9 8ED9                    		mov	ds, cx
  7816 000040EB 07                      		pop	es
  7817 000040EC 5B                      		pop	bx
  7818 000040ED 368B0E[1803]            		mov	cx, word [ss:CALLSCNT]
  7819 000040F2 5F                      		pop	di
  7820 000040F3 29F9                    		sub	cx, di
  7821 000040F5 F7D9                    		neg	cx
  7822 000040F7 36A1[0903]              		mov	ax, word [ss:DEVCALL_REQSTAT]
  7823 000040FB A90080                  		test	ax, 8000h
  7824 000040FE C3                      		retn
  7825                                  
  7826                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7827                                  
  7828                                  		; 08/09/2022
  7829                                  HARDERRRW:
  7830 000040FF 3C0F                    		cmp	al, 0Fh
  7831 00004101 7513                    		jnz	short DO_ERR
  7832 00004103 1E                      		push	ds
  7833 00004104 56                      		push	si
  7834 00004105 36C536[1C03]            		lds	si, [ss:CALLVIDRW]
  7835 0000410A 368C1E[D802]            		mov	[ss:EXTERRPT+2], ds
  7836 0000410F 368936[D602]            		mov	[ss:EXTERRPT], si
  7837 00004114 5E                      		pop	si
  7838 00004115 1F                      		pop	ds
  7839                                  DO_ERR:
  7840 00004116 E83516                  		call	HARDERR
  7841 00004119 C3                      		retn
  7842                                  
  7843                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7844                                  
  7845                                  		; 08/09/2022
  7846                                  SETUP:
  7847 0000411A 26C57507                		lds	si, [es:di+7]
  7848 0000411E 368C1E[2605]            		mov	word [ss:THISDPB+2], ds
  7849 00004123 16                      		push	ss
  7850 00004124 1F                      		pop	ds
  7851 00004125 8936[2405]              		mov	word [THISDPB], si
  7852 00004129 8B1E[DA02]              		mov	bx, [DMAADD]
  7853 0000412D 891E[5005]              		mov	[NEXTADD], bx
  7854 00004131 C606[0F05]00            		mov	byte [SECCLUSPOS+1], 0
  7855 00004136 268B4515                		mov	ax, [es:di+15h]
  7856 0000413A 268B5517                		mov	dx, [es:di+17h]
  7857 0000413E 8916[6205]              		mov	word [BYTPOS+2], dx
  7858 00004142 A3[6005]                		mov	word [BYTPOS], ax
  7859 00004145 26F745058080            		test	word [es:di+5], 8080h
  7860 0000414B 7536                    		jnz	short NOSETSTUFF
  7861 0000414D 06                      		push	es
  7862 0000414E C42E[2405]              		les	bp, [THISDPB]
  7863 00004152 268A5E00                		mov	bl, [es:bp+0]
  7864 00004156 881E[1105]              		mov	byte [THISDRV], bl
  7865 0000415A 268B5E02                		mov	bx, [es:bp+2]
  7866 0000415E 39DA                    		cmp	dx, bx
  7867 00004160 7336                    		jnb	short EOFERR
  7868 00004162 F7F3                    		div	bx
  7869 00004164 A3[5A05]                		mov	[SECPOS], ax
  7870 00004167 8916[5E05]              		mov	[BYTSECPOS], dx
  7871 0000416B 89C2                    		mov	dx, ax
  7872 0000416D 26224604                		and	al, [es:bp+4]
  7873 00004171 A2[0E05]                		mov	byte [SECCLUSPOS], al
  7874 00004174 89C8                    		mov	ax, cx
  7875 00004176 268A4E05                		mov	cl, [es:bp+5]
  7876 0000417A D3EA                    		shr	dx, cl
  7877 0000417C 8916[5405]              		mov	[CLUSNUM], dx
  7878 00004180 07                      		pop	es
  7879 00004181 89C1                    		mov	cx, ax
  7880                                  NOSETSTUFF:
  7881 00004183 89C8                    		mov	ax, cx
  7882 00004185 0306[DA02]              		add	ax, [DMAADD]
  7883 00004189 730C                    		jnb	short setup_OK
  7884 0000418B A1[DA02]                		mov	ax, [DMAADD]
  7885 0000418E F7D8                    		neg	ax
  7886 00004190 7501                    		jnz	short NoDec
  7887 00004192 48                      		dec	ax
  7888                                  NoDec:
  7889 00004193 89C1                    		mov	cx, ax
  7890 00004195 E309                    		jcxz	NOROOM
  7891                                  setup_OK:
  7892 00004197 C3                      		retn
  7893                                  EOFERR:
  7894 00004198 07                      		pop	es
  7895 00004199 31C9                    		xor	cx, cx
  7896 0000419B C606[840F]01            		mov	byte [DISK_FULL], 1
  7897                                  NOROOM:
  7898 000041A0 5B                      		pop	bx
  7899 000041A1 F8                      		clc
  7900                                  breakdown_retn:
  7901 000041A2 C3                      		retn
  7902                                  
  7903                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7904                                  
  7905                                  		; 08/09/2022
  7906                                  BREAKDOWN:
  7907 000041A3 A1[5E05]                		mov	ax, [BYTSECPOS]
  7908 000041A6 89CB                    		mov	bx, cx
  7909 000041A8 09C0                    		or	ax, ax
  7910 000041AA 740E                    		jz	short SAVFIR
  7911 000041AC 262B4602                		sub	ax, [es:bp+2]
  7912 000041B0 F7D8                    		neg	ax
  7913 000041B2 29C3                    		sub	bx, ax
  7914 000041B4 7304                    		jnb	short SAVFIR
  7915 000041B6 01D8                    		add	ax, bx
  7916 000041B8 31DB                    		xor	bx, bx
  7917                                  SAVFIR:
  7918 000041BA A3[6405]                		mov	[BYTCNT1], ax
  7919 000041BD 89D8                    		mov	ax, bx
  7920 000041BF 31D2                    		xor	dx, dx
  7921 000041C1 26F77602                		div	word [es:bp+2]
  7922 000041C5 A3[6805]                		mov	[SECCNT], ax
  7923 000041C8 8916[6605]              		mov	[BYTCNT2], dx
  7924 000041CC 0B16[6405]              		or	dx, [BYTCNT1]
  7925 000041D0 75D0                    		jnz	short breakdown_retn
  7926 000041D2 83F801                  		cmp	ax, 1
  7927 000041D5 75CB                    		jnz	short breakdown_retn
  7928 000041D7 268B4602                		mov	ax, [es:bp+2]
  7929 000041DB A3[6605]                		mov	[BYTCNT2], ax
  7930 000041DE 8916[6805]              		mov	[SECCNT], dx
  7931                                  _RET45:
  7932 000041E2 C3                      		retn
  7933                                  
  7934                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7935                                  
  7936                                  		; 08/09/2022
  7937                                  READ_LOCK_VIOLATION:
  7938 000041E3 C606[1005]00            		mov	byte [SECCLUSPOS+2], 0
  7939                                  ERR_ON_CHECK:
  7940 000041E8 26F745020080            		test	word [es:di+2], 8000h
  7941 000041EE 750E                    		jnz	short _HARD_ERR
  7942 000041F0 51                      		push	cx
  7943 000041F1 268A4D02                		mov	cl, [es:di+2]
  7944 000041F5 80E1F0                  		and	cl, 0F0h
  7945 000041F8 80F900                  		cmp	cl, 0
  7946 000041FB 59                      		pop	cx
  7947 000041FC 7505                    		jnz	short _NO_HARD_ERR
  7948                                  _HARD_ERR:
  7949 000041FE E8862F                  		call	LOCK_VIOLATION
  7950 00004201 73DF                    		jnb	short _RET45
  7951                                  _NO_HARD_ERR:
  7952 00004203 31C9                    		xor	cx, cx
  7953 00004205 B82100                  		mov	ax, 21h
  7954 00004208 F9                      		stc
  7955 00004209 C3                      		retn
  7956                                  
  7957                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7958                                  
  7959                                  		; 08/09/2022
  7960                                  WRITE_LOCK_VIOLATION:
  7961 0000420A C606[1005]01            		mov	byte [SECCLUSPOS+2], 1
  7962 0000420F EBD7                    		jmp	short ERR_ON_CHECK
  7963                                  
  7964                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  7965                                  
  7966                                  		; 14/09/2022
  7967                                  		; 10/09/2022
  7968                                  		; 08/09/2022
  7969                                  DISKREAD:
  7970 00004211 268B4511                		mov	ax, [es:di+11h]
  7971 00004215 268B5D13                		mov	bx, [es:di+13h]
  7972 00004219 2B06[6005]              		sub	ax, word [BYTPOS]
  7973 0000421D 1B1E[6205]              		sbb	bx, word [BYTPOS+2]
  7974 00004221 7230                    		jb	short RDERR
  7975 00004223 750A                    		jnz	short ENUF
  7976 00004225 09C0                    		or	ax, ax
  7977 00004227 742A                    		jz	short RDERR
  7978 00004229 39C8                    		cmp	ax, cx
  7979 0000422B 7302                    		jnb	short ENUF
  7980 0000422D 89C1                    		mov	cx, ax
  7981                                  ENUF:
  7982 0000422F 26F6450408              		test	byte [es:di+4], 8
  7983 00004234 752B                    		jnz	short SET_ACC_ERR
  7984 00004236 E8392F                  		call	LOCK_CHECK
  7985 00004239 7306                    		jnb	short READ_OK
  7986 0000423B E8A5FF                  		call	READ_LOCK_VIOLATION
  7987 0000423E 73EF                    		jnb	short ENUF
  7988 00004240 C3                      		retn
  7989                                  READ_OK:
  7990 00004241 C42E[2405]              		les	bp, [THISDPB]
  7991 00004245 E85BFF                  		call	BREAKDOWN
  7992 00004248 8B0E[5405]              		mov	cx, [CLUSNUM]
  7993 0000424C E8680F                  		call	FNDCLUS
  7994 0000424F 09C9                    		or	cx, cx
  7995 00004251 7415                    		jz	short SKIPERR
  7996                                  RDERR:
  7997 00004253 E9B501                  		jmp	WRTERR
  7998                                  RDLASTJ:
  7999 00004256 E9C700                  		jmp	RDLAST
  8000                                  SETSFTJ2:
  8001 00004259 E9E100                  		jmp	SETSFT
  8002                                  CANOT_READ:
  8003 0000425C 59                      		pop	cx
  8004 0000425D 59                      		pop	cx
  8005 0000425E 5B                      		pop	bx
  8006                                  SET_ACC_ERR_DS:
  8007 0000425F 16                      		push	ss
  8008 00004260 1F                      		pop	ds
  8009                                  SET_ACC_ERR:
  8010 00004261 31C9                    		xor	cx, cx
  8011 00004263 B80500                  		mov	ax, 5
  8012 00004266 F9                      		stc
  8013 00004267 C3                      		retn
  8014                                  SKIPERR:
  8015 00004268 8916[5205]              		mov	[LASTPOS], dx
  8016 0000426C 891E[5405]              		mov	[CLUSNUM], bx
  8017                                  		;cmp	byte [BYTCNT1], 0 ; 14/09/2022
  8018                                  		; 10/09/2022 - Magic Code ! (for Windows 3.1)
  8019 00004270 833E640500              		db	83h, 3Eh, 64h, 5, 0
  8020 00004275 7405                    		jz	short RDMID
  8021 00004277 E8B40F                  		call	BUFRD
  8022 0000427A 72E3                    		jb	short SET_ACC_ERR_DS
  8023                                  RDMID:
  8024 0000427C 833E[6805]00            		cmp	word [SECCNT], 0
  8025 00004281 74D3                    		jz	short RDLASTJ
  8026 00004283 E82510                  		call	NEXTSEC
  8027 00004286 72D1                    		jb	short SETSFTJ2
  8028 00004288 C606[0F05]01            		mov	byte [SECCLUSPOS+1], 1
  8029 0000428D 8A16[0E05]              		mov	dl, byte [SECCLUSPOS]
  8030 00004291 8B0E[6805]              		mov	cx, [SECCNT]
  8031 00004295 8B1E[5405]              		mov	bx, [CLUSNUM]
  8032                                  RDLP:
  8033 00004299 E84010                  		call	OPTIMIZE
  8034 0000429C 72C1                    		jb	short SET_ACC_ERR_DS
  8035 0000429E 57                      		push	di
  8036 0000429F 50                      		push	ax
  8037 000042A0 53                      		push	bx
  8038 000042A1 C606[F702]38            		mov	byte [ALLOWED], 38h
  8039 000042A6 8E1E[DC02]              		mov	ds, [DMAADD+2]
  8040 000042AA 52                      		push	dx
  8041 000042AB 51                      		push	cx
  8042 000042AC E8DBFD                  		call	DREAD
  8043 000042AF 5B                      		pop	bx
  8044 000042B0 5A                      		pop	dx
  8045 000042B1 72A9                    		jb	short CANOT_READ
  8046 000042B3 01D3                    		add	bx, dx
  8047 000042B5 268A4600                		mov	al, [es:bp+0]
  8048 000042B9 E8F219                  		call	SETVISIT
  8049                                  bufq:
  8050 000042BC 804D0520                		or	byte [di+5], 20h
  8051 000042C0 3A4504                  		cmp	al, [di+4]
  8052 000042C3 7541                    		jnz	short bufq3
  8053 000042C5 395506                  		cmp	[di+6],	dx
  8054 000042C8 723C                    		jb	short bufq3
  8055 000042CA 395D06                  		cmp	[di+6],	bx
  8056 000042CD 7337                    		jnb	short bufq3
  8057 000042CF F6450540                		test	byte [di+5], 40h
  8058 000042D3 742E                    		jz	short bufq2
  8059 000042D5 58                      		pop	ax
  8060 000042D6 50                      		push	ax
  8061 000042D7 57                      		push	di
  8062 000042D8 52                      		push	dx
  8063 000042D9 2B5506                  		sub	dx, [di+6]
  8064 000042DC F7DA                    		neg	dx
  8065 000042DE 89FE                    		mov	si, di
  8066 000042E0 89C7                    		mov	di, ax
  8067 000042E2 89D0                    		mov	ax, dx
  8068 000042E4 268B4E02                		mov	cx, [es:bp+2]
  8069 000042E8 F7E1                    		mul	cx
  8070 000042EA 01C7                    		add	di, ax
  8071 000042EC 8D7410                  		lea	si, [si+16]
  8072 000042EF D1E9                    		shr	cx, 1
  8073 000042F1 06                      		push	es
  8074 000042F2 368E06[DC02]            		mov	es, [ss:DMAADD+2]
  8075 000042F7 F3A5                    		rep movsw
  8076 000042F9 7301                    		jnb	short bufq1
  8077 000042FB A4                      		movsb
  8078                                  bufq1:
  8079 000042FC 07                      		pop	es
  8080 000042FD 5A                      		pop	dx
  8081 000042FE 5F                      		pop	di
  8082 000042FF 268A4600                		mov	al, [es:bp+0]
  8083                                  bufq2:
  8084 00004303 E8D519                  		call	SCANPLACE
  8085                                  bufq3:
  8086 00004306 E8BE19                  		call	SKIPVISIT
  8087 00004309 75B1                    		jnz	short bufq
  8088 0000430B 16                      		push	ss
  8089 0000430C 1F                      		pop	ds
  8090 0000430D 59                      		pop	cx
  8091 0000430E 59                      		pop	cx
  8092 0000430F 5B                      		pop	bx
  8093                                  bufq4:
  8094 00004310 E30E                    		jcxz	RDLAST
  8095 00004312 E82516                  		call	IsEOF
  8096 00004315 7326                    		jnb	short SETSFT
  8097 00004317 B200                    		mov	dl, 0
  8098 00004319 FF06[5205]              		inc	word [LASTPOS]
  8099 0000431D E979FF                  		jmp	RDLP
  8100                                  RDLAST:
  8101 00004320 A1[6605]                		mov	ax, [BYTCNT2]
  8102 00004323 09C0                    		or	ax, ax
  8103 00004325 7416                    		jz	short SETSFT
  8104 00004327 A3[6405]                		mov	[BYTCNT1], ax
  8105 0000432A E87E0F                  		call	NEXTSEC
  8106 0000432D 720E                    		jb	short SETSFT
  8107 0000432F C706[5E05]0000          		mov	word [BYTSECPOS], 0
  8108 00004335 E8F60E                  		call	BUFRD
  8109 00004338 7303                    		jnb	short SETSFT
  8110 0000433A E922FF                  		jmp	SET_ACC_ERR_DS
  8111                                  SETSFT:
  8112 0000433D C43E[3605]              		les	di, [THISSFT]
  8113                                  SETCLUS:
  8114 00004341 8B0E[5005]              		mov	cx, [NEXTADD]
  8115 00004345 2B0E[DA02]              		sub	cx, [DMAADD]
  8116 00004349 26F745058000            		test	word [es:di+5], 80h
  8117 0000434F 750E                    		jnz	short ADDREC
  8118 00004351 A1[5405]                		mov	ax, [CLUSNUM]
  8119 00004354 2689451B                		mov	[es:di+1Bh], ax
  8120 00004358 A1[5205]                		mov	ax, [LASTPOS]
  8121 0000435B 26894519                		mov	[es:di+19h], ax
  8122                                  ADDREC:
  8123 0000435F E309                    		jcxz	RET28
  8124 00004361 26014D15                		add	[es:di+15h], cx
  8125 00004365 2683551700              		adc	word [es:di+17h], 0
  8126                                  RET28:
  8127 0000436A F8                      		clc
  8128 0000436B C3                      		retn
  8129                                  
  8130                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  8131                                  
  8132                                  		; 08/09/2022
  8133                                  DISKWRITE:
  8134 0000436C 26F6450408              		test	byte [es:di+4], 8
  8135 00004371 7403                    		jz	short write_cont
  8136 00004373 E9A000                  		jmp	ACC_ERRWJ
  8137                                  write_cont:
  8138 00004376 51                      		push	cx
  8139 00004377 09C9                    		or	cx, cx
  8140 00004379 7503                    		jnz	short Not_Truncate
  8141 0000437B B9FFFF                  		mov	cx, -1
  8142                                  Not_Truncate:
  8143 0000437E E8F12D                  		call	LOCK_CHECK
  8144 00004381 59                      		pop	cx
  8145 00004382 7309                    		jnb	short WRITE_OK
  8146 00004384 E883FE                  		call	WRITE_LOCK_VIOLATION
  8147 00004387 73E3                    		jnb	short DISKWRITE
  8148 00004389 C3                      		retn
  8149                                  WRTEOFJ:
  8150 0000438A E99601                  		jmp	WRTEOF
  8151                                  WRITE_OK:
  8152 0000438D 26816505BFBF            		and	word [es:di+5], 0BFBFh
  8153 00004393 C42E[2405]              		les	bp, [THISDPB]
  8154 00004397 E809FE                  		call	BREAKDOWN
  8155 0000439A A1[6005]                		mov	ax, word [BYTPOS]
  8156 0000439D 8B16[6205]              		mov	dx, word [BYTPOS+2]
  8157 000043A1 E3E7                    		jcxz	WRTEOFJ
  8158 000043A3 01C8                    		add	ax, cx
  8159 000043A5 83D200                  		adc	dx, 0
  8160 000043A8 268B5E02                		mov	bx, [es:bp+2]
  8161 000043AC 39DA                    		cmp	dx, bx
  8162 000043AE 735B                    		jnb	short WRTERR
  8163 000043B0 F7F3                    		div	bx
  8164 000043B2 89C3                    		mov	bx, ax
  8165 000043B4 09D2                    		or	dx, dx
  8166 000043B6 7501                    		jnz	short CALCLUS
  8167 000043B8 48                      		dec	ax
  8168                                  CALCLUS:
  8169 000043B9 268A4E05                		mov	cl, [es:bp+5]
  8170 000043BD D3E8                    		shr	ax, cl
  8171 000043BF 50                      		push	ax
  8172 000043C0 52                      		push	dx
  8173 000043C1 06                      		push	es
  8174 000043C2 C43E[3605]              		les	di, [THISSFT]
  8175 000043C6 268B4511                		mov	ax, [es:di+11h]
  8176 000043CA 268B5513                		mov	dx, [es:di+13h]
  8177 000043CE 07                      		pop	es
  8178 000043CF 26F77602                		div	word [es:bp+2]
  8179 000043D3 89C1                    		mov	cx, ax
  8180 000043D5 09D2                    		or	dx, dx
  8181 000043D7 7401                    		jz	short NORND
  8182 000043D9 40                      		inc	ax
  8183                                  NORND:
  8184 000043DA A3[5C05]                		mov	[VALSEC], ax
  8185 000043DD 31C0                    		xor	ax, ax
  8186 000043DF A3[7005]                		mov	word [GROWCNT], ax
  8187 000043E2 A3[7205]                		mov	word [GROWCNT+2], ax
  8188 000043E5 58                      		pop	ax
  8189 000043E6 29CB                    		sub	bx, cx
  8190 000043E8 723C                    		jb	short NOGROW
  8191 000043EA 742D                    		jz	short TESTTAIL
  8192                                  yesgrow:
  8193 000043EC 89D1                    		mov	cx, dx
  8194 000043EE 93                      		xchg	ax, bx
  8195 000043EF 26F76602                		mul	word [es:bp+2]
  8196 000043F3 29C8                    		sub	ax, cx
  8197 000043F5 83DA00                  		sbb	dx, 0
  8198 000043F8 01D8                    		add	ax, bx
  8199 000043FA 83D200                  		adc	dx, 0
  8200 000043FD EB20                    		jmp	short SETGRW
  8201                                  
  8202                                  ; ---------------------------------------------------------------------------
  8203                                  
  8204                                  		; 08/09/2022
  8205                                  HAVSTART:
  8206 000043FF 89C1                    		mov	cx, ax
  8207 00004401 E8D30D                  		call	SKPCLP
  8208 00004404 E30D                    		jcxz	DOWRTJ
  8209 00004406 E8440F                  		call	ALLOCATE
  8210 00004409 7308                    		jnb	short DOWRTJ
  8211                                  WRTERR:
  8212 0000440B 31C9                    		xor	cx, cx
  8213 0000440D C43E[3605]              		les	di, [THISSFT]
  8214 00004411 F8                      		clc
  8215 00004412 C3                      		retn
  8216                                  DOWRTJ:
  8217 00004413 EB49                    		jmp	short DOWRT
  8218                                  
  8219 00004415 90                      		nop
  8220                                  ACC_ERRWJ:
  8221 00004416 E90701                  		jmp	SET_ACC_ERRW
  8222                                  TESTTAIL:
  8223 00004419 29D0                    		sub	ax, dx
  8224 0000441B 7609                    		jbe	short NOGROW
  8225 0000441D 31D2                    		xor	dx, dx
  8226                                  SETGRW:
  8227 0000441F A3[7005]                		mov	word [GROWCNT], ax
  8228 00004422 8916[7205]              		mov	word [GROWCNT+2], dx
  8229                                  NOGROW:
  8230 00004426 58                      		pop	ax
  8231 00004427 8B0E[5405]              		mov	cx, [CLUSNUM]
  8232 0000442B E8890D                  		call	FNDCLUS
  8233 0000442E 72E6                    		jb	short ACC_ERRWJ
  8234 00004430 891E[5405]              		mov	[CLUSNUM], bx
  8235 00004434 8916[5205]              		mov	[LASTPOS], dx
  8236 00004438 29D0                    		sub	ax, dx
  8237 0000443A 7422                    		jz	short DOWRT
  8238 0000443C E3C1                    		jcxz	HAVSTART
  8239 0000443E 51                      		push	cx
  8240 0000443F 89C1                    		mov	cx, ax
  8241 00004441 E8090F                  		call	ALLOCATE
  8242 00004444 58                      		pop	ax
  8243 00004445 72C4                    		jb	short WRTERR
  8244 00004447 89C1                    		mov	cx, ax
  8245 00004449 8B16[5205]              		mov	dx, [LASTPOS]
  8246 0000444D 42                      		inc	dx
  8247 0000444E 49                      		dec	cx
  8248 0000444F 7405                    		jz	short NOSKIP
  8249 00004451 E8830D                  		call	SKPCLP
  8250 00004454 72C0                    		jb	short ACC_ERRWJ
  8251                                  NOSKIP:
  8252 00004456 891E[5405]              		mov	[CLUSNUM], bx
  8253 0000445A 8916[5205]              		mov	[LASTPOS], dx
  8254                                  DOWRT:
  8255 0000445E 833E[6405]00            		cmp	word [BYTCNT1], 0
  8256 00004463 7409                    		jz	short WRTMID
  8257 00004465 8B1E[5405]              		mov	bx, [CLUSNUM]
  8258 00004469 E8FA0D                  		call	BUFWRT
  8259 0000446C 72A8                    		jb	short ACC_ERRWJ
  8260                                  WRTMID:
  8261 0000446E A1[6805]                		mov	ax, [SECCNT]
  8262 00004471 09C0                    		or	ax, ax
  8263 00004473 746E                    		jz	short WRTLAST
  8264 00004475 0106[5A05]              		add	[SECPOS], ax
  8265 00004479 E82F0E                  		call	NEXTSEC
  8266 0000447C 7298                    		jb	short ACC_ERRWJ
  8267 0000447E C606[0F05]01            		mov	byte [SECCLUSPOS+1], 1
  8268 00004483 8A16[0E05]              		mov	dl, byte [SECCLUSPOS]
  8269 00004487 8B1E[5405]              		mov	bx, [CLUSNUM]
  8270 0000448B 8B0E[6805]              		mov	cx, [SECCNT]
  8271                                  WRTLP:
  8272 0000448F E84A0E                  		call	OPTIMIZE
  8273 00004492 7282                    		jb	short ACC_ERRWJ
  8274 00004494 57                      		push	di
  8275 00004495 50                      		push	ax
  8276 00004496 52                      		push	dx
  8277 00004497 53                      		push	bx
  8278 00004498 268A4600                		mov	al, [es:bp+0]
  8279 0000449C 89CB                    		mov	bx, cx
  8280 0000449E 01D3                    		add	bx, dx
  8281 000044A0 E80B18                  		call	SETVISIT
  8282                                  wbufq1:
  8283 000044A3 804D0520                		or	byte [di+5], 20h
  8284 000044A7 3A4504                  		cmp	al, [di+4]
  8285 000044AA 7512                    		jnz	short wbufq2
  8286 000044AC 395506                  		cmp	[di+6],	dx
  8287 000044AF 720D                    		jb	short wbufq2
  8288 000044B1 395D06                  		cmp	[di+6],	bx
  8289 000044B4 7308                    		jnb	short wbufq2
  8290 000044B6 C74504FF20              		mov	word [di+4], 20FFh
  8291 000044BB E81D18                  		call	SCANPLACE
  8292                                  wbufq2:
  8293 000044BE E80618                  		call	SKIPVISIT
  8294 000044C1 75E0                    		jnz	short wbufq1
  8295 000044C3 5B                      		pop	bx
  8296 000044C4 5A                      		pop	dx
  8297 000044C5 368E1E[DC02]            		mov	ds, [ss:DMAADD+2]
  8298 000044CA 36C606[F702]38          		mov	byte [ss:ALLOWED], 38h
  8299 000044D0 E8E3FB                  		call	DWRITE
  8300                                  DWRITE_OKAY:
  8301 000044D3 59                      		pop	cx
  8302 000044D4 5B                      		pop	bx
  8303 000044D5 16                      		push	ss
  8304 000044D6 1F                      		pop	ds
  8305 000044D7 7247                    		jb	short SET_ACC_ERRW
  8306 000044D9 E308                    		jcxz	WRTLAST
  8307 000044DB B200                    		mov	dl, 0
  8308 000044DD FF06[5205]              		inc	word [LASTPOS]
  8309 000044E1 EBAC                    		jmp	short WRTLP
  8310                                  WRTLAST:
  8311 000044E3 A1[6605]                		mov	ax, [BYTCNT2]
  8312 000044E6 09C0                    		or	ax, ax
  8313 000044E8 7413                    		jz	short FINWRT
  8314 000044EA A3[6405]                		mov	[BYTCNT1], ax
  8315 000044ED E8BB0D                  		call	NEXTSEC
  8316 000044F0 722E                    		jb	short SET_ACC_ERRW
  8317 000044F2 C706[5E05]0000          		mov	word [BYTSECPOS], 0
  8318 000044F8 E86B0D                  		call	BUFWRT
  8319 000044FB 7223                    		jb	short SET_ACC_ERRW
  8320                                  FINWRT:
  8321 000044FD C43E[3605]              		les	di, [THISSFT]
  8322 00004501 A1[7005]                		mov	ax, word [GROWCNT]
  8323 00004504 8B0E[7205]              		mov	cx, word [GROWCNT+2]
  8324 00004508 09C0                    		or	ax, ax
  8325 0000450A 7502                    		jnz	short UPDATE_size
  8326 0000450C E30F                    		jcxz	SAMSIZ
  8327                                  UPDATE_size:
  8328 0000450E 26014511                		add	[es:di+11h], ax
  8329 00004512 26114D13                		adc	[es:di+13h], cx
  8330 00004516 B80100                  		mov	ax, 1
  8331 00004519 FF1E[9400]              		call	far [ShSU]
  8332                                  SAMSIZ:
  8333 0000451D E921FE                  		jmp	SETCLUS
  8334                                  SET_ACC_ERRW:
  8335 00004520 E93CFD                  		jmp	SET_ACC_ERR_DS
  8336                                  WRTEOF:
  8337 00004523 89C1                    		mov	cx, ax
  8338 00004525 09D1                    		or	cx, dx
  8339 00004527 7451                    		jz	short KILLFIL
  8340 00004529 83E801                  		sub	ax, 1
  8341 0000452C 83DA00                  		sbb	dx, 0
  8342 0000452F 26F77602                		div	word [es:bp+2]
  8343 00004533 268A4E05                		mov	cl, [es:bp+5]
  8344 00004537 D3E8                    		shr	ax, cl
  8345 00004539 89C1                    		mov	cx, ax
  8346 0000453B E8790C                  		call	FNDCLUS
  8347                                  SET_ACC_ERRWJ2:
  8348 0000453E 72E0                    		jb	short SET_ACC_ERRW
  8349 00004540 E32E                    		jcxz	RELFILE
  8350 00004542 E8080E                  		call	ALLOCATE
  8351 00004545 7221                    		jb	short WRTERRJ
  8352                                  UPDATE:
  8353 00004547 C43E[3605]              		les	di, [THISSFT]
  8354 0000454B A1[6005]                		mov	ax, word [BYTPOS]
  8355 0000454E 26894511                		mov	[es:di+11h], ax
  8356 00004552 A1[6205]                		mov	ax, word [BYTPOS+2]
  8357 00004555 26894513                		mov	[es:di+13h], ax
  8358 00004559 B80200                  		mov	ax, 2
  8359 0000455C FF1E[9400]              		call	far [ShSU]
  8360 00004560 31C9                    		xor	cx, cx
  8361 00004562 E9FAFD                  		jmp	ADDREC
  8362                                  
  8363 00004565 E9A3FE                  		jmp	WRTERR
  8364                                  
  8365                                  WRTERRJ:
  8366 00004568 C606[840F]01            		mov	byte [DISK_FULL], 1
  8367 0000456D E99BFE                  		jmp	WRTERR
  8368                                  RELFILE:
  8369 00004570 BAFFFF                  		mov	dx, 0FFFFh
  8370 00004573 E8800E                  		call	RELBLKS
  8371                                  SET_ACC_ERRWJJ:
  8372 00004576 72C6                    		jb	short SET_ACC_ERRWJ2
  8373 00004578 EBCD                    		jmp	short UPDATE
  8374                                  KILLFIL:
  8375 0000457A 31DB                    		xor	bx, bx
  8376 0000457C 06                      		push	es
  8377 0000457D C43E[3605]              		les	di, [THISSFT]
  8378 00004581 26895D19                		mov	[es:di+19h], bx
  8379 00004585 26895D1B                		mov	[es:di+1Bh], bx
  8380 00004589 26875D0B                		xchg	bx, [es:di+0Bh]
  8381 0000458D 07                      		pop	es
  8382 0000458E 09DB                    		or	bx, bx
  8383 00004590 741E                    		jz	short UpDateJ
  8384 00004592 06                      		push	es
  8385 00004593 55                      		push	bp
  8386 00004594 50                      		push	ax
  8387 00004595 51                      		push	cx
  8388 00004596 52                      		push	dx
  8389 00004597 C42E[2405]              		les	bp, [THISDPB]
  8390 0000459B 268A5600                		mov	dl, [es:bp+0]
  8391 0000459F 89D9                    		mov	cx, bx
  8392 000045A1 B402                    		mov	ah, 2
  8393 000045A3 E87CED                  		call	FastOpen_Update
  8394 000045A6 5A                      		pop	dx
  8395 000045A7 59                      		pop	cx
  8396 000045A8 58                      		pop	ax
  8397 000045A9 5D                      		pop	bp
  8398 000045AA 07                      		pop	es
  8399 000045AB E8460E                  		call	RELEASE
  8400 000045AE 72C6                    		jb	short SET_ACC_ERRWJJ
  8401                                  UpDateJ:
  8402 000045B0 EB95                    		jmp	short UPDATE
  8403                                  
  8404                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  8405                                  
  8406                                  		; 09/09/2022
  8407                                  		; 08/09/2022
  8408                                  FINDENTRY:
  8409 000045B2 E82404                  		call	STARTSRCH
  8410 000045B5 A0[0605]                		mov	al, byte [ATTRIB]
  8411 000045B8 249E                    		and	al, 9Eh
  8412 000045BA 3C08                    		cmp	al, 8
  8413 000045BC 7503                    		jnz	short NOTVOLSRCH
  8414 000045BE E86601                  		call	SETROOTSRCH
  8415                                  NOTVOLSRCH:
  8416 000045C1 E8FA00                  		call	GETENTRY
  8417 000045C4 7303                    		jnb	short SRCH
  8418 000045C6 E99500                  		jmp	SETESRET
  8419                                  SRCH:
  8420 000045C9 1E                      		push	ds
  8421 000045CA 8E1E[7605]              		mov	ds, word [CURBUF+2]
  8422 000045CE 8A27                    		mov	ah, [bx]
  8423 000045D0 08E4                    		or	ah, ah
  8424 000045D2 743A                    		jz	short FREE
  8425 000045D4 363A26[1905]            		cmp	ah, [ss:DELALL]
  8426 000045D9 7433                    		jz	short FREE
  8427 000045DB F6470B08                		test	byte [bx+0Bh], 8
  8428 000045DF 7405                    		jz	short CHKFNAM
  8429 000045E1 36FE06[1605]            		inc	byte [ss:cMeta+1]
  8430                                  CHKFNAM:
  8431 000045E6 8CD6                    		mov	si, ss
  8432 000045E8 8EC6                    		mov	es, si
  8433 000045EA 89DE                    		mov	si, bx
  8434 000045EC BF[E604]                		mov	di, NAME1
  8435 000045EF 36803E[E604]E5          		cmp	byte [ss:NAME1], 0E5h
  8436 000045F5 7506                    		jnz	short NO_E5
  8437 000045F7 36C606[E604]05          		mov	byte [ss:NAME1], 5
  8438                                  NO_E5:
  8439 000045FD E86100                  		call	MetaCompare
  8440 00004600 7428                    		jz	short FOUND
  8441 00004602 1F                      		pop	ds
  8442                                  NextEnt:
  8443 00004603 C42E[2405]              		les	bp, [THISDPB]
  8444 00004607 E86600                  		call	NEXTENTRY
  8445 0000460A 73BD                    		jnb	short SRCH
  8446 0000460C EB50                    		jmp	short SETESRET
  8447                                  FREE:
  8448 0000460E 1F                      		pop	ds
  8449 0000460F 8B0E[F402]              		mov	cx, word [LASTENT]
  8450 00004613 3B0E[6A05]              		cmp	cx, [ENTFREE]
  8451 00004617 7304                    		jnb	short TSTALL
  8452 00004619 890E[6A05]              		mov	[ENTFREE], cx
  8453                                  TSTALL:
  8454 0000461D 3A26[1905]              		cmp	ah, [DELALL]
  8455                                  NEXTENTJ:
  8456 00004621 74E0                    		jz	short NextEnt
  8457 00004623 890E[6C05]              		mov	[ENTLAST], cx
  8458 00004627 F9                      		stc
  8459 00004628 EB34                    		jmp	short SETESRET
  8460                                  FOUND:
  8461 0000462A 8A2C                    		mov	ch, [si]
  8462 0000462C 1F                      		pop	ds
  8463 0000462D 8A26[0605]              		mov	ah, byte [ATTRIB]
  8464 00004631 80E49E                  		and	ah, 9Eh
  8465 00004634 8D740F                  		lea	si, [si+15]
  8466 00004637 F6C508                  		test	ch, 8
  8467 0000463A 7409                    		jz	short CHECK_ONE_VOLUME_ID
  8468 0000463C F6C408                  		test	ah, 8
  8469 0000463F 74E0                    		jz	short NEXTENTJ
  8470 00004641 30E4                    		xor	ah, ah
  8471 00004643 EB11                    		jmp	short RETFF
  8472                                  CHECK_ONE_VOLUME_ID:
  8473 00004645 80FC08                  		cmp	ah, 8
  8474 00004648 74D7                    		jz	short NEXTENTJ
  8475 0000464A E8A003                  		call	MatchAttributes
  8476 0000464D 7407                    		jz	short RETFF
  8477 0000464F F606[1805]FF            		test	byte [CREATING], -1
  8478 00004654 74CB                    		jz	short NEXTENTJ
  8479                                  RETFF:
  8480 00004656 C42E[2405]              		les	bp, [THISDPB]
  8481 0000465A 268A6600                		mov	ah, [es:bp+0]
  8482                                  SETESRET:
  8483 0000465E 16                      		push	ss
  8484 0000465F 07                      		pop	es
  8485 00004660 C3                      		retn
  8486                                  
  8487                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  8488                                  
  8489                                  		; 08/09/2022
  8490                                  MetaCompare:
  8491 00004661 B90B00                  		mov	cx, 11
  8492                                  WILDCRD:
  8493 00004664 F3A6                    		repe cmpsb
  8494 00004666 7407                    		jz	short MetaRet
  8495 00004668 26807DFF3F              		cmp	byte [es:di-1], '?'
  8496 0000466D 74F5                    		jz	short WILDCRD
  8497                                  MetaRet:
  8498 0000466F C3                      		retn
  8499                                  
  8500                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  8501                                  
  8502                                  		; 08/09/2022
  8503                                  NEXTENTRY:
  8504 00004670 A1[F402]                		mov	ax, word [LASTENT]
  8505 00004673 3B06[6C05]              		cmp	ax, [ENTLAST]
  8506 00004677 7425                    		jz	short NONE
  8507 00004679 40                      		inc	ax
  8508 0000467A 8D5F20                  		lea	bx, [bx+32]
  8509 0000467D 39D3                    		cmp	bx, dx
  8510 0000467F 721F                    		jb	short HAVIT
  8511 00004681 8A1E[0E05]              		mov	bl, byte [SECCLUSPOS]
  8512 00004685 FEC3                    		inc	bl
  8513 00004687 3A1E[1205]              		cmp	bl, byte [THISDRV+1]
  8514 0000468B 7218                    		jb	short SAMECLUS
  8515 0000468D 8B1E[6E05]              		mov	bx, [NXTCLUSNUM]
  8516 00004691 E8A612                  		call	IsEOF
  8517 00004694 7308                    		jnb	short NONE
  8518 00004696 83FB02                  		cmp	bx, 2
  8519 00004699 7203                    		jb	short NONE
  8520 0000469B EB24                    		jmp	short GetEnt
  8521                                  
  8522 0000469D 90                      		nop
  8523                                  NONE:
  8524 0000469E F9                      		stc
  8525 0000469F C3                      		retn
  8526                                  HAVIT:
  8527 000046A0 A3[F402]                		mov	word [LASTENT], ax
  8528 000046A3 F8                      		clc
  8529                                  nextentry_retn:
  8530 000046A4 C3                      		retn
  8531                                  SAMECLUS:
  8532 000046A5 881E[0E05]              		mov	byte [SECCLUSPOS], bl
  8533 000046A9 A3[F402]                		mov	word [LASTENT], ax
  8534 000046AC 1E                      		push	ds
  8535 000046AD C53E[7405]              		lds	di, [CURBUF]
  8536 000046B1 8B5506                  		mov	dx, [di+6]
  8537 000046B4 42                      		inc	dx
  8538 000046B5 1F                      		pop	ds
  8539 000046B6 E891F9                  		call	FIRSTCLUSTER
  8540 000046B9 31DB                    		xor	bx, bx
  8541 000046BB EB26                    		jmp	short SETENTRY
  8542                                  
  8543 000046BD 90                      		nop
  8544                                  
  8545                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  8546                                  
  8547                                  		; 08/09/2022
  8548                                  GETENTRY:
  8549 000046BE A1[F402]                		mov	ax, word [LASTENT]
  8550                                  GetEnt:
  8551 000046C1 A3[F402]                		mov	word [LASTENT], ax
  8552 000046C4 B105                    		mov	cl, 5
  8553 000046C6 D3C0                    		rol	ax, cl
  8554 000046C8 89C2                    		mov	dx, ax
  8555 000046CA 83E0E0                  		and	ax, 0FFE0h
  8556                                  		;and	dx, 1Fh
  8557                                  		; 09/09/2022 - Temporary !
  8558 000046CD 81E21F00                		db	81h, 0E2h, 1Fh, 0
  8559 000046D1 268B5E02                		mov	bx, [es:bp+2]
  8560 000046D5 80E3E0                  		and	bl, 0E0h
  8561 000046D8 F7F3                    		div	bx
  8562 000046DA 89D3                    		mov	bx, dx
  8563 000046DC 53                      		push	bx
  8564 000046DD E81DF9                  		call	DIRREAD
  8565 000046E0 5B                      		pop	bx
  8566 000046E1 72C1                    		jb	short nextentry_retn
  8567                                  SETENTRY:
  8568 000046E3 8B16[7405]              		mov	dx, word [CURBUF]
  8569 000046E7 83C210                  		add	dx, 16
  8570 000046EA 01D3                    		add	bx, dx
  8571 000046EC 26035602                		add	dx, [es:bp+2]
  8572 000046F0 C3                      		retn
  8573                                  
  8574                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  8575                                  
  8576                                  		; 08/09/2022
  8577                                  SETDIRSRCH:
  8578 000046F1 09DB                    		or	bx, bx
  8579 000046F3 7432                    		jz	short SETROOTSRCH
  8580 000046F5 891E[5805]              		mov	[DIRSTART], bx
  8581 000046F9 268A4604                		mov	al, [es:bp+4]
  8582 000046FD FEC0                    		inc	al
  8583 000046FF A2[1205]                		mov	byte [THISDRV+1], al
  8584 00004702 56                      		push	si
  8585 00004703 F606[660F]02            		test	byte [FastOpenFlg], 2
  8586 00004708 7507                    		jnz	short UNP_OK
  8587 0000470A E84412                  		call	UNPACK
  8588 0000470D 7302                    		jnb	short UNP_OK
  8589 0000470F 5E                      		pop	si
  8590 00004710 C3                      		retn
  8591                                  UNP_OK:
  8592 00004711 893E[5405]              		mov	[CLUSNUM], di
  8593 00004715 89DA                    		mov	dx, bx
  8594 00004717 30DB                    		xor	bl, bl
  8595 00004719 881E[0E05]              		mov	byte [SECCLUSPOS], bl
  8596 0000471D E81C0C                  		call	FIGREC
  8597 00004720 5E                      		pop	si
  8598 00004721 8916[5605]              		mov	[DIRSEC], dx
  8599 00004725 F8                      		clc
  8600 00004726 C3                      		retn
  8601                                  SETROOTSRCH:
  8602 00004727 31C0                    		xor	ax, ax
  8603 00004729 A3[5805]                		mov	[DIRSTART], ax
  8604 0000472C A2[0E05]                		mov	byte [SECCLUSPOS], al
  8605 0000472F 48                      		dec	ax
  8606 00004730 A3[5405]                		mov	[CLUSNUM], ax
  8607 00004733 268B460B                		mov	ax, [es:bp+0Bh]
  8608 00004737 268B5610                		mov	dx, [es:bp+10h]
  8609 0000473B 29D0                    		sub	ax, dx
  8610 0000473D A2[1205]                		mov	byte [THISDRV+1], al
  8611 00004740 8916[5605]              		mov	[DIRSEC], dx
  8612 00004744 F8                      		clc
  8613 00004745 C3                      		retn
  8614                                  
  8615                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  8616                                  
  8617                                  		; 09/09/2022
  8618                                  		; 08/09/2022
  8619                                  GetPath:
  8620 00004746 C706[1805]00E5          		mov	word [CREATING], 0E500h
  8621                                  GetPathNoSet:
  8622 0000474C C606[D102]02            		mov	byte [EXTERR_LOCUS], 2
  8623 00004751 C706[7405]FFFF          		mov	word [CURBUF], -1
  8624 00004757 8B3E[4A05]              		mov	di, [WFP_START]
  8625 0000475B 817D013A5C              		cmp	word [di+1], ':\'
  8626 00004760 743A                    		jz	short CrackIt
  8627 00004762 83C703                  		add	di, 3
  8628 00004765 89FE                    		mov	si, di
  8629 00004767 E8B400                  		call	CHKDEV
  8630 0000476A 722E                    		jb	short InternalError
  8631                                  Build_devJ:
  8632 0000476C A0[0805]                		mov	al, byte [ExtFCB+1]
  8633 0000476F A2[0605]                		mov	byte [ATTRIB], al
  8634 00004772 C606[D102]01            		mov	byte [EXTERR_LOCUS], 1
  8635 00004777 16                      		push	ss
  8636 00004778 07                      		pop	es
  8637 00004779 BE[E604]                		mov	si, NAME1
  8638 0000477C 8B3E[4A05]              		mov	di, [WFP_START]
  8639 00004780 89FA                    		mov	dx, di
  8640 00004782 B90800                  		mov	cx, 8
  8641                                  MoveLoop:
  8642 00004785 AC                      		lodsb
  8643 00004786 AA                      		stosb
  8644 00004787 3C20                    		cmp	al, ' '
  8645 00004789 7402                    		jz	short nosave
  8646 0000478B 89FA                    		mov	dx, di
  8647                                  nosave:
  8648 0000478D E2F6                    		loop	MoveLoop
  8649 0000478F 89D7                    		mov	di, dx
  8650 00004791 C60500                  		mov	byte [di], 0
  8651 00004794 E8C302                  		call	Build_device_ent
  8652 00004797 FEC0                    		inc	al
  8653 00004799 C3                      		retn
  8654                                  InternalError:
  8655 0000479A EBFE                    		jmp	short InternalError
  8656                                  CrackIt:
  8657 0000479C 8B36[4E05]              		mov	si, [CURR_DIR_END]
  8658 000047A0 83FEFF                  		cmp	si, -1
  8659 000047A3 7503                    		jnz	short LOOK_SING
  8660 000047A5 8D7503                  		lea	si, [di+3]
  8661                                  LOOK_SING:
  8662 000047A8 C606[0605]16            		mov	byte [ATTRIB], 16h
  8663 000047AD C43E[3A05]              		les	di, [THISCDS]
  8664 000047B1 B8FFFF                  		mov	ax, -1
  8665 000047B4 268B5D49                		mov	bx, [es:di+73]
  8666 000047B8 8B36[4E05]              		mov	si, [CURR_DIR_END]
  8667 000047BC 39C6                    		cmp	si, ax
  8668 000047BE 7440                    		jz	short NO_CURR_D
  8669 000047C0 39C3                    		cmp	bx, ax
  8670 000047C2 743C                    		jz	short NO_CURR_D
  8671 000047C4 F606[660F]01            		test	byte [FastOpenFlg], 1
  8672 000047C9 7443                    		jz	short GOT_SEARCH_CLUSTER
  8673 000047CB 06                      		push	es
  8674 000047CC 57                      		push	di
  8675 000047CD 51                      		push	cx
  8676 000047CE FF74FF                  		push	word [si-1]
  8677 000047D1 56                      		push	si
  8678 000047D2 53                      		push	bx
  8679 000047D3 C644FF00                		mov	byte [si-1], 0
  8680 000047D7 8B36[4A05]              		mov	si, [WFP_START]
  8681 000047DB BB[3B0F]                		mov	bx, FastTable
  8682 000047DE BF[460F]                		mov	di, Dir_Info_Buff
  8683 000047E1 B9[410F]                		mov	cx, FastOpen_Ext_Info
  8684 000047E4 B001                    		mov	al, 1
  8685 000047E6 1E                      		push	ds
  8686 000047E7 07                      		pop	es
  8687 000047E8 FF5F02                  		call	far [bx+2] ; 09/09/2022
  8688 000047EB 7208                    		jb	short GO_Chk_end1
  8689 000047ED 803C00                  		cmp	byte [si], 0
  8690 000047F0 7404                    		jz	short GO_Chk_end
  8691 000047F2 F9                      		stc
  8692 000047F3 EB01                    		jmp	short GO_Chk_end
  8693                                  GO_Chk_end1:
  8694 000047F5 F8                      		clc
  8695                                  GO_Chk_end:
  8696 000047F6 5B                      		pop	bx
  8697 000047F7 5E                      		pop	si
  8698 000047F8 8F44FF                  		pop	word [si-1]
  8699 000047FB 59                      		pop	cx
  8700 000047FC 5F                      		pop	di
  8701 000047FD 07                      		pop	es
  8702 000047FE 730E                    		jnb	short GOT_SEARCH_CLUSTER
  8703                                  NO_CURR_D:
  8704 00004800 8B36[4A05]              		mov	si, [WFP_START]
  8705 00004804 8D7403                  		lea	si, [si+3]
  8706 00004807 C42E[2405]              		les	bp, [THISDPB]
  8707 0000480B EB41                    		jmp	short ROOTPATH
  8708                                  
  8709 0000480D 90                      		nop
  8710                                  GOT_SEARCH_CLUSTER:
  8711 0000480E C42E[2405]              		les	bp, [THISDPB]
  8712 00004812 E8DCFE                  		call	SETDIRSRCH
  8713 00004815 7203                    		jb	short SETFERR
  8714 00004817 EB46                    		jmp	short FINDPATH
  8715                                  
  8716 00004819 90                      		nop
  8717                                  SETFERR:
  8718 0000481A 30C9                    		xor	cl, cl
  8719 0000481C F9                      		stc
  8720 0000481D C3                      		retn
  8721                                  
  8722                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  8723                                  
  8724                                  		; 09/09/2022
  8725                                  		; 08/09/2022
  8726                                  CHKDEV:
  8727 0000481E 89FE                    		mov	si, di
  8728 00004820 8CD7                    		mov	di, ss
  8729 00004822 8EC7                    		mov	es, di
  8730 00004824 BF[E604]                		mov	di, NAME1
  8731 00004827 B90900                  		mov	cx, 9
  8732                                  TESTLOOP:
  8733 0000482A E8E90C                  		call	GETLET
  8734 0000482D 3C2E                    		cmp	al, '.'
  8735 0000482F 740E                    		jz	short TESTDEVICE
  8736 00004831 E81C0D                  		call	PATHCHRCMP
  8737 00004834 7407                    		jz	short NOTDEV
  8738 00004836 08C0                    		or	al, al
  8739 00004838 7405                    		jz	short TESTDEVICE
  8740 0000483A AA                      		stosb
  8741 0000483B E2ED                    		loop	TESTLOOP
  8742                                  NOTDEV:
  8743 0000483D F9                      		stc
  8744 0000483E C3                      		retn
  8745                                  TESTDEVICE:
  8746 0000483F 83C102                  		add	cx, 2
  8747 00004842 B020                    		mov	al, ' '
  8748 00004844 F3AA                    		rep stosb
  8749 00004846 8CD0                    		mov	ax, ss
  8750 00004848 8ED8                    		mov	ds, ax
  8751 0000484A E8AD01                  		call	DEVNAME
  8752 0000484D C3                      		retn
  8753                                  
  8754                                  ; ---------------------------------------------------------------------------
  8755                                  
  8756                                  		; 08/09/2022
  8757                                  ROOTPATH:
  8758 0000484E E8D6FE                  		call	SETROOTSRCH
  8759 00004851 803C00                  		cmp	byte [si], 0
  8760 00004854 7509                    		jnz	short FINDPATH
  8761 00004856 A0[0805]                		mov	al, byte [ExtFCB+1]
  8762 00004859 A2[0605]                		mov	byte [ATTRIB], al
  8763 0000485C 30E4                    		xor	ah, ah
  8764 0000485E C3                      		retn
  8765                                  ; ---------------------------------------------------------------------------
  8766                                  
  8767                                  		; 09/09/2022
  8768                                  		; 08/09/2022
  8769                                  FINDPATH:
  8770 0000485F 06                      		push	es
  8771 00004860 56                      		push	si
  8772 00004861 89F7                    		mov	di, si
  8773 00004863 8B0E[5805]              		mov	cx, [DIRSTART]
  8774 00004867 833E[4E05]FF            		cmp	word [CURR_DIR_END], -1
  8775 0000486C 740E                    		jz	short NOIDS
  8776 0000486E 3B3E[4E05]              		cmp	di, [CURR_DIR_END]
  8777 00004872 7508                    		jnz	short NOIDS
  8778 00004874 C43E[3A05]              		les	di, [THISCDS]
  8779 00004878 26894D49                		mov	[es:di+73], cx
  8780                                  NOIDS:
  8781 0000487C 8CD0                    		mov	ax, ss
  8782 0000487E 8EC0                    		mov	es, ax
  8783 00004880 BF[E604]                		mov	di, NAME1
  8784 00004883 B82020                  		mov	ax, '  '
  8785 00004886 AA                      		stosb
  8786 00004887 AB                      		stosw
  8787 00004888 AB                      		stosw
  8788 00004889 AB                      		stosw
  8789 0000488A AB                      		stosw
  8790 0000488B AB                      		stosw
  8791 0000488C BF[E604]                		mov	di, NAME1
  8792 0000488F 30E4                    		xor	ah, ah
  8793                                  GetNam:
  8794 00004891 AC                      		lodsb
  8795 00004892 3C2E                    		cmp	al, '.'
  8796 00004894 7412                    		jz	short setExt
  8797 00004896 08C0                    		or	al, al
  8798 00004898 7424                    		jz	short _GetDone
  8799 0000489A 3C5C                    		cmp	al, '\'
  8800 0000489C 7420                    		jz	short _GetDone
  8801 0000489E 3C3F                    		cmp	al, '?'
  8802 000048A0 7503                    		jnz	short StoNam
  8803 000048A2 80CC01                  		or	ah, 1
  8804                                  StoNam:
  8805 000048A5 AA                      		stosb
  8806 000048A6 EBE9                    		jmp	short GetNam
  8807                                  setExt:
  8808 000048A8 BF[EE04]                		mov	di, NAME1+8
  8809                                  GetExt:
  8810 000048AB AC                      		lodsb
  8811 000048AC 08C0                    		or	al, al
  8812 000048AE 740E                    		jz	short _GetDone
  8813 000048B0 3C5C                    		cmp	al, '\'
  8814 000048B2 740A                    		jz	short _GetDone
  8815 000048B4 3C3F                    		cmp	al, '?'
  8816 000048B6 7503                    		jnz	short StoExt
  8817 000048B8 80CC01                  		or	ah, 1
  8818                                  StoExt:
  8819 000048BB AA                      		stosb
  8820 000048BC EBED                    		jmp	short GetExt
  8821                                  _GetDone:
  8822 000048BE 4E                      		dec	si
  8823 000048BF 88E1                    		mov	cl, ah
  8824 000048C1 80C980                  		or	cl, 80h
  8825 000048C4 5F                      		pop	di
  8826 000048C5 07                      		pop	es
  8827 000048C6 39FE                    		cmp	si, di
  8828 000048C8 7503                    		jnz	short check_device
  8829 000048CA E9D400                  		jmp	BADPATH
  8830                                  check_device:
  8831 000048CD 56                      		push	si
  8832 000048CE 8A04                    		mov	al, [si]
  8833 000048D0 08C0                    		or	al, al
  8834 000048D2 7508                    		jnz	short NOT_LAST
  8835 000048D4 8A3E[0805]              		mov	bh, byte [ExtFCB+1]
  8836 000048D8 883E[0605]              		mov	byte [ATTRIB], bh
  8837                                  NOT_LAST:
  8838 000048DC 06                      		push	es
  8839 000048DD 16                      		push	ss
  8840 000048DE 07                      		pop	es
  8841 000048DF E81801                  		call	DEVNAME
  8842 000048E2 07                      		pop	es
  8843 000048E3 720B                    		jb	short FindFile
  8844 000048E5 08C0                    		or	al, al
  8845 000048E7 7403                    		jz	short GO_BDEV
  8846 000048E9 E9B900                  		jmp	FileInPath
  8847                                  GO_BDEV:
  8848 000048EC 5E                      		pop	si
  8849 000048ED E97CFE                  		jmp	Build_devJ
  8850                                  
  8851                                  ; ---------------------------------------------------------------------------
  8852                                  
  8853                                  		; 09/09/2022
  8854                                  		; 08/09/2022
  8855                                  FindFile:
  8856 000048F0 803E[E604]E5            		cmp	byte [NAME1], 0E5h
  8857 000048F5 7505                    		jnz	short NOE5
  8858 000048F7 C606[E604]05            		mov	byte [NAME1], 5
  8859                                  NOE5:
  8860 000048FC 57                      		push	di
  8861 000048FD 06                      		push	es
  8862 000048FE 51                      		push	cx
  8863 000048FF E87902                  		call	LookupPath
  8864 00004902 7303                    		jnb	short DIR_FOUND
  8865 00004904 E8ABFC                  		call	FINDENTRY
  8866                                  DIR_FOUND:
  8867 00004907 59                      		pop	cx
  8868 00004908 07                      		pop	es
  8869 00004909 5F                      		pop	di
  8870 0000490A 7303                    		jnb	short LOAD_BUF
  8871 0000490C E9BB00                  		jmp	BADPATHPOP
  8872                                  LOAD_BUF:
  8873 0000490F C53E[7405]              		lds	di, [CURBUF]
  8874 00004913 F6470B10                		test	byte [bx+0Bh], 10h
  8875 00004917 7503                    		jnz	short GO_NEXT
  8876 00004919 E98900                  		jmp	FileInPath
  8877                                  GO_NEXT:
  8878 0000491C 36803E[F802]00          		cmp	byte [ss:NoSetDir], 0
  8879 00004922 7414                    		jz	short SetDir
  8880 00004924 89FA                    		mov	dx, di
  8881 00004926 8CD9                    		mov	cx, ds
  8882 00004928 16                      		push	ss
  8883 00004929 1F                      		pop	ds
  8884 0000492A 5F                      		pop	di
  8885 0000492B 803D00                  		cmp	byte [di], 0
  8886 0000492E 7503                    		jnz	short NEXT_ONE
  8887 00004930 E99600                  		jmp	SetRet
  8888                                  NEXT_ONE:
  8889 00004933 57                      		push	di
  8890 00004934 89D7                    		mov	di, dx
  8891 00004936 8ED9                    		mov	ds, cx
  8892                                  SetDir:
  8893 00004938 8B14                    		mov	dx, [si]
  8894 0000493A 1E                      		push	ds
  8895 0000493B 16                      		push	ss
  8896 0000493C 1F                      		pop	ds
  8897 0000493D F606[660F]02            		test	byte [FastOpenFlg], 2
  8898 00004942 7411                    		jz	short DO_NORMAL
  8899 00004944 89D3                    		mov	bx, dx
  8900 00004946 8B3E[5405]              		mov	di, [CLUSNUM]
  8901 0000494A 50                      		push	ax
  8902 0000494B E8A3FD                  		call	SETDIRSRCH
  8903 0000494E 58                      		pop	ax
  8904 0000494F 83C402                  		add	sp, 2
  8905 00004952 EB37                    		jmp	short FAST_OPEN_SKIP
  8906                                  
  8907 00004954 90                      		nop
  8908                                  DO_NORMAL:
  8909 00004955 1F                      		pop	ds
  8910 00004956 29FB                    		sub	bx, di
  8911 00004958 29FE                    		sub	si, di
  8912 0000495A 53                      		push	bx
  8913 0000495B 50                      		push	ax
  8914 0000495C 56                      		push	si
  8915 0000495D 51                      		push	cx
  8916 0000495E FF7506                  		push	word [di+6]
  8917 00004961 89D3                    		mov	bx, dx
  8918 00004963 16                      		push	ss
  8919 00004964 1F                      		pop	ds
  8920 00004965 E889FD                  		call	SETDIRSRCH
  8921 00004968 5A                      		pop	dx
  8922 00004969 720A                    		jb	short SKIP_GETB
  8923 0000496B C606[F702]18            		mov	byte [ALLOWED], 18h
  8924 00004970 30C0                    		xor	al, al
  8925 00004972 E81D14                  		call	GETBUFFR
  8926                                  SKIP_GETB:
  8927 00004975 59                      		pop	cx
  8928 00004976 5E                      		pop	si
  8929 00004977 58                      		pop	ax
  8930 00004978 5B                      		pop	bx
  8931 00004979 7305                    		jnb	short SET_THE_BUF
  8932 0000497B 5F                      		pop	di
  8933 0000497C 89FE                    		mov	si, di
  8934 0000497E EB21                    		jmp	short BADPATH
  8935                                  SET_THE_BUF:
  8936 00004980 E8D3F6                  		call	SET_BUF_AS_DIR
  8937 00004983 8B3E[7405]              		mov	di, word [CURBUF]
  8938 00004987 01FE                    		add	si, di
  8939 00004989 01FB                    		add	bx, di
  8940                                  FAST_OPEN_SKIP:
  8941 0000498B 5F                      		pop	di
  8942 0000498C E85902                  		call	InsertPath
  8943 0000498F 8A05                    		mov	al, [di]
  8944 00004991 08C0                    		or	al, al
  8945 00004993 7434                    		jz	short SetRet
  8946 00004995 47                      		inc	di
  8947 00004996 89FE                    		mov	si, di
  8948 00004998 E8B50B                  		call	PATHCHRCMP
  8949 0000499B 7503                    		jnz	short find_bad_name
  8950 0000499D E9BFFE                  		jmp	FINDPATH
  8951                                  find_bad_name:
  8952 000049A0 4E                      		dec	si
  8953                                  BADPATH:
  8954 000049A1 30C9                    		xor	cl, cl
  8955 000049A3 EB2C                    		jmp	short BADPRET
  8956                                  ; ---------------------------------------------------------------------------
  8957                                  
  8958                                  		; 08/09/2022
  8959                                  FileInPath:
  8960 000049A5 5F                      		pop	di
  8961 000049A6 16                      		push	ss
  8962 000049A7 1F                      		pop	ds
  8963 000049A8 F606[660F]01            		test	byte [FastOpenFlg], 1
  8964 000049AD 740B                    		jz	short NO_FAST
  8965 000049AF F606[660F]02            		test	byte [FastOpenFlg], 2
  8966 000049B4 7404                    		jz	short NO_FAST
  8967 000049B6 8B3E[670F]              		mov	di, [Next_Element_Start]
  8968                                  NO_FAST:
  8969 000049BA 8A05                    		mov	al, [di]
  8970 000049BC 08C0                    		or	al, al
  8971 000049BE 7404                    		jz	short INCRET
  8972 000049C0 89FE                    		mov	si, di
  8973 000049C2 EB0D                    		jmp	short BADPRET
  8974                                  INCRET:
  8975 000049C4 E82102                  		call	InsertPath
  8976 000049C7 FEC0                    		inc	al
  8977                                  SetRet:
  8978 000049C9 C3                      		retn
  8979                                  BADPATHPOP:
  8980 000049CA 5E                      		pop	si
  8981 000049CB 8A04                    		mov	al, [si]
  8982 000049CD 89FE                    		mov	si, di
  8983 000049CF 08C0                    		or	al, al
  8984                                  BADPRET:
  8985 000049D1 A0[0805]                		mov	al, byte [ExtFCB+1]
  8986 000049D4 A2[0605]                		mov	byte [ATTRIB], al
  8987 000049D7 F9                      		stc
  8988 000049D8 C3                      		retn
  8989                                  
  8990                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  8991                                  
  8992                                  		; 08/09/2022
  8993                                  STARTSRCH:
  8994 000049D9 C42E[2405]              		les	bp, [THISDPB]
  8995 000049DD 31C0                    		xor	ax, ax
  8996 000049DF A3[F402]                		mov	word [LASTENT], ax
  8997 000049E2 A2[1605]                		mov	byte [cMeta+1], al
  8998 000049E5 48                      		dec	ax
  8999 000049E6 A3[6A05]                		mov	[ENTFREE], ax
  9000 000049E9 A3[6C05]                		mov	[ENTLAST], ax
  9001 000049EC C3                      		retn
  9002                                  
  9003                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9004                                  
  9005                                  		; 08/09/2022
  9006                                  MatchAttributes:
  9007 000049ED 50                      		push	ax
  9008 000049EE 36A0[0605]              		mov	al, byte [ss:ATTRIB]
  9009 000049F2 F6D0                    		not	al
  9010 000049F4 20E8                    		and	al, ch
  9011 000049F6 2416                    		and	al, 16h
  9012 000049F8 58                      		pop	ax
  9013 000049F9 C3                      		retn
  9014                                  
  9015                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9016                                  
  9017                                  		; 09/09/2022
  9018                                  		; 08/09/2022
  9019                                  DEVNAME:
  9020 000049FA 56                      		push	si
  9021 000049FB 57                      		push	di
  9022 000049FC 51                      		push	cx
  9023 000049FD 50                      		push	ax
  9024 000049FE FF36[E604]              		push	word [NAME1]
  9025 00004A02 803E[E604]05            		cmp	byte [NAME1], 5
  9026 00004A07 7505                    		jnz	short NOKTR
  9027 00004A09 C606[E604]E5            		mov	byte [NAME1], 0E5h
  9028                                  NOKTR:
  9029 00004A0E F606[0605]08            		test	byte [ATTRIB], 8
  9030 00004A13 7522                    		jnz	short RET31
  9031 00004A15 BE[4800]                		mov	si, NULDEV
  9032                                  LOOKIO:
  9033 00004A18 F744040080              		test	word [si+4], 8000h
  9034 00004A1D 7411                    		jz	short SKIPDEV
  9035 00004A1F 89F0                    		mov	ax, si
  9036 00004A21 83C60A                  		add	si, 10
  9037 00004A24 BF[E604]                		mov	di, NAME1
  9038 00004A27 B90400                  		mov	cx, 4
  9039 00004A2A F3A7                    		repe cmpsw
  9040 00004A2C 89C6                    		mov	si, ax
  9041 00004A2E 7415                    		jz	short IOCHK
  9042                                  SKIPDEV:
  9043 00004A30 C534                    		lds	si, [si]
  9044 00004A32 83FEFF                  		cmp	si, -1
  9045 00004A35 75E1                    		jnz	short LOOKIO
  9046                                  RET31:
  9047 00004A37 F9                      		stc
  9048                                  RETNV:
  9049 00004A38 8CD1                    		mov	cx, ss
  9050 00004A3A 8ED9                    		mov	ds, cx
  9051 00004A3C 8F06[E604]              		pop	word [NAME1]
  9052 00004A40 58                      		pop	ax
  9053 00004A41 59                      		pop	cx
  9054 00004A42 5F                      		pop	di
  9055 00004A43 5E                      		pop	si
  9056 00004A44 C3                      		retn
  9057                                  IOCHK:
  9058 00004A45 368C1E[3405]            		mov	word [ss:DEVPT+2], ds
  9059 00004A4A 8A7C04                  		mov	bh, [si+4]
  9060 00004A4D 80CFC0                  		or	bh, 0C0h
  9061 00004A50 80E7DF                  		and	bh, 0DFh
  9062 00004A53 368936[3205]            		mov	word [ss:DEVPT], si
  9063 00004A58 EBDE                    		jmp	short RETNV
  9064                                  
  9065                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9066                                  
  9067                                  		; 09/09/2022
  9068                                  		; 08/09/2022
  9069                                  Build_device_ent:
  9070 00004A5A B82020                  		mov	ax, 2020h
  9071 00004A5D BF[EE04]                		mov	di, DEVFCB+8 ; 09/09/2022
  9072 00004A60 AB                      		stosw
  9073 00004A61 AA                      		stosb
  9074 00004A62 B040                    		mov	al, 40h
  9075 00004A64 AA                      		stosb
  9076 00004A65 31C0                    		xor	ax, ax
  9077 00004A67 B90A00                  		mov	cx, 10
  9078 00004A6A F3AB                    		rep stosw
  9079 00004A6C E8B7CD                  		call	DATE16
  9080 00004A6F BF[FC04]                		mov	di, DEVFCB_dir_time
  9081 00004A72 92                      		xchg	ax, dx
  9082 00004A73 AB                      		stosw
  9083 00004A74 92                      		xchg	ax, dx
  9084 00004A75 AB                      		stosw
  9085 00004A76 89FE                    		mov	si, di
  9086 00004A78 A1[3205]                		mov	ax, word [DEVPT]
  9087 00004A7B AB                      		stosw
  9088 00004A7C A1[3405]                		mov	ax, word [DEVPT+2]
  9089 00004A7F AB                      		stosw
  9090 00004A80 88FC                    		mov	ah, bh
  9091 00004A82 BB[E604]                		mov	bx, NAME1
  9092 00004A85 30C0                    		xor	al, al
  9093 00004A87 C3                      		retn
  9094                                  
  9095                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9096                                  
  9097                                  		; 08/09/2022
  9098                                  ValidateCDS:
  9099 00004A88 55                      		push	bp
  9100 00004A89 89E5                    		mov	bp, sp
  9101 00004A8B 83EC06                  		sub	sp, 6
  9102 00004A8E 897EFE                  		mov	[bp-2],	di
  9103 00004A91 36C536[3A05]            		lds	si, [ss:THISCDS]
  9104 00004A96 8976FA                  		mov	[bp-6],	si
  9105 00004A99 8C5EFC                  		mov	word [bp-4], ds
  9106 00004A9C E896D4                  		call	EcritDisk
  9107 00004A9F F744430080              		test	word [si+67], 8000h
  9108 00004AA4 7403                    		jz	short DoSplice
  9109 00004AA6 E98900                  		jmp	FatFail
  9110                                  DoSplice:
  9111 00004AA9 30D2                    		xor	dl, dl
  9112 00004AAB 368616[F802]            		xchg	dl, [ss:NoSetDir]
  9113 00004AB0 16                      		push	ss
  9114 00004AB1 07                      		pop	es
  9115 00004AB2 E870D3                  		call	FStrCpy
  9116 00004AB5 8B76FE                  		mov	si, [bp-2]
  9117 00004AB8 16                      		push	ss
  9118 00004AB9 1F                      		pop	ds
  9119 00004ABA E8F520                  		call	Splice
  9120 00004ABD 16                      		push	ss
  9121 00004ABE 1F                      		pop	ds
  9122 00004ABF 8816[F802]              		mov	[NoSetDir], dl
  9123 00004AC3 C43E[3A05]              		les	di, [THISCDS]
  9124 00004AC7 55                      		push	bp
  9125 00004AC8 E8F50F                  		call	FatRead_CDS
  9126 00004ACB 5D                      		pop	bp
  9127 00004ACC 7264                    		jb	short FatFail
  9128 00004ACE C536[3A05]              		lds	si, [THISCDS]
  9129 00004AD2 837C49FF                		cmp	word [si+73], -1
  9130 00004AD6 754C                    		jnz	short RestoreCDS
  9131 00004AD8 16                      		push	ss
  9132 00004AD9 07                      		pop	es
  9133 00004ADA 36FF36[4A05]            		push	word [ss:WFP_START]
  9134 00004ADF 3B76FA                  		cmp	si, [bp-6]
  9135 00004AE2 750B                    		jnz	short DoChdir
  9136 00004AE4 8B7EFE                  		mov	di, [bp-2]
  9137 00004AE7 36893E[4A05]            		mov	[ss:WFP_START], di
  9138 00004AEC E836D3                  		call	FStrCpy
  9139                                  DoChdir:
  9140 00004AEF 16                      		push	ss
  9141 00004AF0 1F                      		pop	ds
  9142 00004AF1 FF36[0805]              		push	word [ExtFCB+1]
  9143 00004AF5 55                      		push	bp
  9144 00004AF6 E802F1                  		call	DOS_CHDIR
  9145 00004AF9 5D                      		pop	bp
  9146 00004AFA 5B                      		pop	bx
  9147 00004AFB 8F06[4A05]              		pop	word [WFP_START]
  9148 00004AFF 881E[0805]              		mov	byte [ExtFCB+1], bl
  9149 00004B03 C576FA                  		lds	si, [bp-6]
  9150 00004B06 730F                    		jnb	short SetCluster
  9151 00004B08 368936[3A05]            		mov	word [ss:THISCDS], si
  9152 00004B0D 368C1E[3C05]            		mov	word [ss:THISCDS+2], ds
  9153 00004B12 31C9                    		xor	cx, cx
  9154 00004B14 884C03                  		mov	[si+3],	cl
  9155                                  SetCluster:
  9156 00004B17 C74449FFFF              		mov	word [si+73], 0FFFFh
  9157 00004B1C 36C536[3A05]            		lds	si, [ss:THISCDS]
  9158 00004B21 894C49                  		mov	[si+73], cx
  9159                                  RestoreCDS:
  9160 00004B24 C47EFA                  		les	di, [bp-6]
  9161 00004B27 36893E[3A05]            		mov	word [ss:THISCDS], di
  9162 00004B2C 368C06[3C05]            		mov	word [ss:THISCDS+2], es
  9163 00004B31 F8                      		clc
  9164                                  FatFail:
  9165 00004B32 E808D4                  		call	LcritDisk
  9166 00004B35 C47EFA                  		les	di, [bp-6]
  9167 00004B38 89EC                    		mov	sp, bp
  9168 00004B3A 5D                      		pop	bp
  9169 00004B3B C3                      		retn
  9170                                  
  9171                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9172                                  
  9173                                  		; 08/09/2022
  9174                                  CheckThisDevice:
  9175 00004B3C 57                      		push	di
  9176 00004B3D 56                      		push	si
  9177 00004B3E 89F7                    		mov	di, si
  9178 00004B40 8A04                    		mov	al, [si]
  9179 00004B42 E80B0A                  		call	PATHCHRCMP
  9180 00004B45 7517                    		jnz	short ParseDev
  9181 00004B47 46                      		inc	si
  9182 00004B48 AD                      		lodsw
  9183 00004B49 0D2020                  		or	ax, 2020h
  9184 00004B4C 3D6465                  		cmp	ax, 'de'
  9185 00004B4F 7527                    		jnz	short NotDevice
  9186 00004B51 AC                      		lodsb
  9187 00004B52 0C20                    		or	al, 20h
  9188 00004B54 3C76                    		cmp	al, 'v'
  9189 00004B56 7520                    		jnz	short NotDevice
  9190 00004B58 AC                      		lodsb
  9191 00004B59 E8F409                  		call	PATHCHRCMP
  9192 00004B5C 751A                    		jnz	short NotDevice
  9193                                  ParseDev:
  9194 00004B5E 1E                      		push	ds
  9195 00004B5F 56                      		push	si
  9196 00004B60 E88609                  		call	NameTrans
  9197 00004B63 803C00                  		cmp	byte [si], 0
  9198 00004B66 F9                      		stc
  9199 00004B67 7505                    		jnz	short SkipSearch
  9200 00004B69 16                      		push	ss
  9201 00004B6A 1F                      		pop	ds
  9202 00004B6B E88CFE                  		call	DEVNAME
  9203                                  SkipSearch:
  9204 00004B6E 5E                      		pop	si
  9205 00004B6F 1F                      		pop	ds
  9206                                  CheckReturn:
  9207 00004B70 5F                      		pop	di
  9208 00004B71 7302                    		jnb	short _CheckDone
  9209 00004B73 89FE                    		mov	si, di
  9210                                  _CheckDone:
  9211 00004B75 5F                      		pop	di
  9212 00004B76 F5                      		cmc
  9213 00004B77 C3                      		retn
  9214                                  NotDevice:
  9215 00004B78 F9                      		stc
  9216 00004B79 EBF5                    		jmp	short CheckReturn
  9217                                  
  9218                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9219                                  
  9220                                  		; 08/09/2022
  9221                                  LookupPath:
  9222 00004B7B 36F606[660F]01          		test	byte [ss:FastOpenFlg], 1
  9223 00004B81 7463                    		jz	short NOLOOKUP
  9224 00004B83 36F606[660F]08          		test	byte [ss:FastOpenFlg], 8
  9225 00004B89 755B                    		jnz	short NOLOOKUP
  9226 00004B8B BB[3B0F]                		mov	bx, FastTable
  9227 00004B8E 368B36[4A05]            		mov	si, [ss:WFP_START]
  9228 00004B93 BF[460F]                		mov	di, Dir_Info_Buff
  9229 00004B96 B9[410F]                		mov	cx, FastOpen_Ext_Info
  9230 00004B99 B001                    		mov	al, 1
  9231 00004B9B 1E                      		push	ds
  9232 00004B9C 07                      		pop	es
  9233 00004B9D FF5F02                  		call	far [bx+2] ; 09/09/2022
  9234 00004BA0 7233                    		jb	short NOTFOUND
  9235 00004BA2 8D5CFE                  		lea	bx, [si-2]
  9236 00004BA5 363B1E[4A05]            		cmp	bx, [ss:WFP_START]
  9237 00004BAA 7429                    		jz	short NOTFOUND
  9238 00004BAC 368936[670F]            		mov	[ss:Next_Element_Start], si
  9239 00004BB1 89CB                    		mov	bx, cx
  9240 00004BB3 8B4703                  		mov	ax, [bx+3]
  9241 00004BB6 36A3[5405]              		mov	[ss:CLUSNUM], ax
  9242 00004BBA 06                      		push	es
  9243 00004BBB 36C41E[2405]            		les	bx, [ss:THISDPB]
  9244 00004BC0 268A27                  		mov	ah, [es:bx]
  9245 00004BC3 07                      		pop	es
  9246 00004BC4 368C06[7605]            		mov	word [ss:CURBUF+2], es
  9247 00004BC9 89FB                    		mov	bx, di
  9248 00004BCB 8D751A                  		lea	si, [di+1Ah]
  9249 00004BCE 36800E[660F]02          		or	byte [ss:FastOpenFlg], 2
  9250 00004BD4 C3                      		retn
  9251                                  NOTFOUND:
  9252 00004BD5 83F8FF                  		cmp	ax, -1
  9253 00004BD8 7506                    		jnz	short Partial_Success
  9254 00004BDA 36C606[660F]00          		mov	byte [ss:FastOpenFlg], 0
  9255                                  Partial_Success:
  9256 00004BE0 368026[660F]FB          		and	byte [ss:FastOpenFlg], 0FBh
  9257                                  NOLOOKUP:
  9258 00004BE6 F9                      		stc
  9259 00004BE7 C3                      		retn
  9260                                  
  9261                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9262                                  
  9263                                  		; 08/09/2022
  9264                                  InsertPath:
  9265 00004BE8 9C                      		pushf
  9266 00004BE9 36F606[660F]01          		test	byte [ss:FastOpenFlg], 1
  9267 00004BEF 7467                    		jz	short GET_NEXT_ELEMENT
  9268 00004BF1 36F606[660F]02          		test	byte [ss:FastOpenFlg], 2
  9269 00004BF7 740E                    		jz	short INSERT_DIR_INFO
  9270 00004BF9 368026[660F]FD          		and	byte [ss:FastOpenFlg], 0FDh
  9271 00004BFF 368B3E[670F]            		mov	di, [ss:Next_Element_Start]
  9272 00004C04 EB4C                    		jmp	short GET_NEXT2
  9273                                  
  9274 00004C06 90                      		nop
  9275                                  INSERT_DIR_INFO:
  9276 00004C07 1E                      		push	ds
  9277 00004C08 06                      		push	es
  9278 00004C09 53                      		push	bx
  9279 00004C0A 56                      		push	si
  9280 00004C0B 57                      		push	di
  9281 00004C0C 51                      		push	cx
  9282 00004C0D 50                      		push	ax
  9283 00004C0E 36C53E[7405]            		lds	di, [ss:CURBUF]
  9284 00004C13 BE[410F]                		mov	si, FastOpen_Ext_Info
  9285 00004C16 8B4506                  		mov	ax, [di+6]
  9286 00004C19 16                      		push	ss
  9287 00004C1A 1F                      		pop	ds
  9288 00004C1B 894401                  		mov	[si+1],	ax
  9289 00004C1E A1[5405]                		mov	ax, [CLUSNUM]
  9290 00004C21 894403                  		mov	[si+3],	ax
  9291 00004C24 89D8                    		mov	ax, bx
  9292 00004C26 83C710                  		add	di, 16
  9293 00004C29 29F8                    		sub	ax, di
  9294 00004C2B B120                    		mov	cl, 32
  9295 00004C2D F6F1                    		div	cl
  9296 00004C2F 8804                    		mov	[si], al
  9297 00004C31 1E                      		push	ds
  9298 00004C32 07                      		pop	es
  9299 00004C33 8E1E[7605]              		mov	ds, word [CURBUF+2]
  9300 00004C37 89DF                    		mov	di, bx
  9301 00004C39 837D1A00                		cmp	word [di+1Ah], 0
  9302 00004C3D 740C                    		jz	short SKIP_INSERT
  9303 00004C3F 56                      		push	si
  9304 00004C40 5B                      		pop	bx
  9305 00004C41 B002                    		mov	al, 2
  9306 00004C43 BE[3B0F]                		mov	si, FastTable
  9307 00004C46 26FF5C02                		call	far [es:si+2] ; 09/09/2022
  9308 00004C4A F8                      		clc
  9309                                  SKIP_INSERT:
  9310 00004C4B 58                      		pop	ax
  9311 00004C4C 59                      		pop	cx
  9312 00004C4D 5F                      		pop	di
  9313 00004C4E 5E                      		pop	si
  9314 00004C4F 5B                      		pop	bx
  9315 00004C50 07                      		pop	es
  9316 00004C51 1F                      		pop	ds
  9317                                  GET_NEXT2:
  9318 00004C52 36800E[660F]08          		or	byte [ss:FastOpenFlg], 8
  9319                                  GET_NEXT_ELEMENT:
  9320 00004C58 9D                      		popf
  9321 00004C59 C3                      		retn
  9322                                  
  9323                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9324                                  
  9325                                  		; 08/09/2022
  9326                                  IOFUNC:
  9327 00004C5A 368C16[3403]            		mov	word [ss:IOXAD+2], ss
  9328 00004C5F 36C706[3203][5E03]      		mov	word [ss:IOXAD], DEVIOBUF
  9329 00004C66 36C706[3603]0100        		mov	word [ss:IOSCNT], 1
  9330 00004C6D 36A3[5E03]              		mov	[ss:DEVIOBUF], ax
  9331 00004C71 F744050080              		test	word [si+5], 8000h
  9332 00004C76 756E                    		jnz	short IOTOFILEJ
  9333 00004C78 F744058000              		test	word [si+5], 80h
  9334 00004C7D 7467                    		jz	short IOTOFILEJ
  9335 00004C7F E8FEC8                  		call	save_world
  9336 00004C82 8CDA                    		mov	dx, ds
  9337 00004C84 8CD3                    		mov	bx, ss
  9338 00004C86 8EDB                    		mov	ds, bx
  9339 00004C88 8EC3                    		mov	es, bx
  9340 00004C8A 31DB                    		xor	bx, bx
  9341 00004C8C 80FC05                  		cmp	ah, 5
  9342 00004C8F 7504                    		jnz	short _no_sys_wait
  9343 00004C91 81CB0004                		or	bx, 400h
  9344                                  _no_sys_wait:
  9345 00004C95 891E[2703]              		mov	word [IOCALL_REQSTAT], bx
  9346 00004C99 31DB                    		xor	bx, bx
  9347 00004C9B 881E[3103]              		mov	[IOMED], bl
  9348 00004C9F 88E3                    		mov	bl, ah
  9349 00004CA1 8AA7[B812]              		mov	ah, [bx+LenTab]
  9350 00004CA5 D1E3                    		shl	bx, 1
  9351 00004CA7 8B8F[BE12]              		mov	cx, word [bx+CmdTab]
  9352 00004CAB BB[2403]                		mov	bx, IOCALL
  9353 00004CAE 8826[2403]              		mov	[IOCALL], ah
  9354 00004CB2 882E[2603]              		mov	[IOCALL_REQFUNC], ch
  9355 00004CB6 8EDA                    		mov	ds, dx
  9356 00004CB8 E84401                  		call	DEVIOCALL
  9357 00004CBB 368B3E[2703]            		mov	di, word [ss:IOCALL_REQSTAT]
  9358 00004CC0 F7C70080                		test	di, 8000h
  9359 00004CC4 7522                    		jnz	short DevErr
  9360                                  OkDevIO:
  9361 00004CC6 8CD0                    		mov	ax, ss
  9362 00004CC8 8ED8                    		mov	ds, ax
  9363 00004CCA 80FD05                  		cmp	ch, 5
  9364 00004CCD 7506                    		jnz	short DNODRD
  9365 00004CCF A0[3103]                		mov	al, [IOMED]
  9366 00004CD2 A2[5E03]                		mov	byte [DEVIOBUF], al
  9367                                  DNODRD:
  9368 00004CD5 8A26[2803]              		mov	ah, [IOCALL_REQSTAT+1]
  9369 00004CD9 F6D4                    		not	ah
  9370 00004CDB 80E402                  		and	ah, 2
  9371 00004CDE E88CC8                  		call	restore_world
  9372 00004CE1 36A1[5E03]              		mov	ax, [ss:DEVIOBUF]
  9373 00004CE5 C3                      		retn
  9374                                  IOTOFILEJ:
  9375 00004CE6 EB17                    		jmp	short IOTOFILE
  9376                                  DevErr:
  9377 00004CE8 88CC                    		mov	ah, cl
  9378 00004CEA E8430A                  		call	CHARHARD
  9379 00004CED 3C01                    		cmp	al, 1
  9380 00004CEF 7506                    		jnz	short NO_RETRY
  9381 00004CF1 E879C8                  		call	restore_world
  9382 00004CF4 E963FF                  		jmp	IOFUNC
  9383                                  NO_RETRY:
  9384 00004CF7 368026[2803]FD          		and	byte [ss:IOCALL_REQSTAT+1], 0FDh
  9385 00004CFD EBC7                    		jmp	short OkDevIO
  9386                                  IOTOFILE:
  9387 00004CFF 08E4                    		or	ah, ah
  9388 00004D01 7423                    		jz	short IOIN
  9389 00004D03 FECC                    		dec	ah
  9390 00004D05 7405                    		jz	short IOIST
  9391 00004D07 FECC                    		dec	ah
  9392 00004D09 7411                    		jz	short IOUT
  9393 00004D0B C3                      		retn
  9394                                  IOIST:
  9395 00004D0C FF7415                  		push	word [si+15h]
  9396 00004D0F FF7417                  		push	word [si+17h]
  9397 00004D12 E81100                  		call	IOIN
  9398 00004D15 8F4417                  		pop	word [si+17h]
  9399 00004D18 8F4415                  		pop	word [si+15h]
  9400 00004D1B C3                      		retn
  9401                                  IOUT:
  9402 00004D1C E81B00                  		call	SETXADDR
  9403 00004D1F E876F1                  		call	DOS_WRITE
  9404 00004D22 E84800                  		call	RESTXADDR
  9405                                  IOUT_retn:
  9406 00004D25 C3                      		retn
  9407                                  IOIN:
  9408 00004D26 E81100                  		call	SETXADDR
  9409 00004D29 E8E7EF                  		call	DOS_READ
  9410 00004D2C 09C9                    		or	cx, cx
  9411 00004D2E E83C00                  		call	RESTXADDR
  9412 00004D31 36A0[5E03]              		mov	al, byte [ss:DEVIOBUF]
  9413 00004D35 75EE                    		jnz	short IOUT_retn
  9414 00004D37 B01A                    		mov	al, 1Ah
  9415 00004D39 C3                      		retn
  9416                                  
  9417                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9418                                  
  9419                                  		; 08/09/2022
  9420                                  SETXADDR:
  9421 00004D3A 368F06[1803]            		pop	word [ss:CALLSCNT]
  9422 00004D3F E83EC8                  		call	save_world
  9423 00004D42 36FF36[DA02]            		push	word [ss:DMAADD]
  9424 00004D47 36FF36[DC02]            		push	word [ss:DMAADD+2]
  9425 00004D4C 368C1E[3805]            		mov	word [ss:THISSFT+2], ds
  9426 00004D51 16                      		push	ss
  9427 00004D52 1F                      		pop	ds
  9428 00004D53 8936[3605]              		mov	word [THISSFT], si
  9429 00004D57 8B0E[3403]              		mov	cx, word [IOXAD+2]
  9430 00004D5B 890E[DC02]              		mov	[DMAADD+2], cx
  9431 00004D5F 8B0E[3203]              		mov	cx, word [IOXAD]
  9432 00004D63 890E[DA02]              		mov	[DMAADD], cx
  9433 00004D67 8B0E[3603]              		mov	cx, word [IOSCNT]
  9434                                  
  9435 00004D6B EB0F                    		jmp	short RESTRET
  9436                                  
  9437                                  
  9438                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9439                                  
  9440                                  		; 08/09/2022
  9441                                  RESTXADDR:
  9442 00004D6D 8F06[1803]              		pop	word [CALLSCNT]
  9443 00004D71 8F06[DC02]              		pop	word [DMAADD+2]
  9444 00004D75 8F06[DA02]              		pop	word [DMAADD]
  9445 00004D79 E8F1C7                  		call	restore_world
  9446                                  RESTRET:
  9447 00004D7C 36FF26[1803]            		jmp	word [ss:CALLSCNT]
  9448                                  
  9449                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9450                                  
  9451                                  		; 08/09/2022
  9452                                  DEV_OPEN_SFT:
  9453 00004D81 E8FCC7                  		call	save_world
  9454 00004D84 B00D                    		mov	al, 0Dh
  9455 00004D86 EB05                    		jmp	short DO_OPCLS
  9456                                  
  9457                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9458                                  
  9459                                  		; 08/09/2022
  9460                                  DEV_CLOSE_SFT:
  9461 00004D88 E8F5C7                  		call	save_world
  9462 00004D8B B00E                    		mov	al, 0Eh
  9463                                  DO_OPCLS:
  9464 00004D8D E81BD1                  		call	IsSFTNet
  9465 00004D90 7569                    		jnz	short OPCLS_DONE
  9466 00004D92 30E4                    		xor	ah, ah
  9467 00004D94 26F745058000            		test	word [es:di+5], 80h
  9468 00004D9A 26C47D07                		les	di, [es:di+7]
  9469 00004D9E 7510                    		jnz	short Got_Dev_Addr
  9470 00004DA0 E80A24                  		call	CheckShare
  9471 00004DA3 7456                    		jz	short OPCLS_DONE
  9472 00004DA5 268A6501                		mov	ah, [es:di+1]
  9473 00004DA9 268A0D                  		mov	cl, [es:di]
  9474 00004DAC 26C47D12                		les	di, [es:di+12h]
  9475                                  Got_Dev_Addr:
  9476 00004DB0 26F745040008            		test	word [es:di+4], 800h
  9477 00004DB6 7443                    		jz	short OPCLS_DONE
  9478 00004DB8 06                      		push	es
  9479 00004DB9 1F                      		pop	ds
  9480 00004DBA 89FE                    		mov	si, di
  9481                                  OPCLS_RETRY:
  9482 00004DBC 16                      		push	ss
  9483 00004DBD 07                      		pop	es
  9484 00004DBE BF[0603]                		mov	di, DEVCALL
  9485 00004DC1 89FB                    		mov	bx, di
  9486 00004DC3 50                      		push	ax
  9487 00004DC4 B00D                    		mov	al, 13
  9488 00004DC6 AA                      		stosb
  9489 00004DC7 58                      		pop	ax
  9490 00004DC8 86E0                    		xchg	ah, al
  9491 00004DCA AA                      		stosb
  9492 00004DCB 86E0                    		xchg	ah, al
  9493 00004DCD AA                      		stosb
  9494 00004DCE 26C7050000              		mov	word [es:di], 0
  9495 00004DD3 50                      		push	ax
  9496 00004DD4 E82B00                  		call	DEVIOCALL2
  9497 00004DD7 268B7F03                		mov	di, [es:bx+3]
  9498 00004DDB F7C70080                		test	di, 8000h
  9499 00004DDF 7419                    		jz	short OPCLS_DONEP
  9500 00004DE1 F744040080              		test	word [si+4], 8000h
  9501 00004DE6 7404                    		jz	short BLKDEV
  9502 00004DE8 B486                    		mov	ah, 86h
  9503 00004DEA EB04                    		jmp	short HRDERR
  9504                                  BLKDEV:
  9505 00004DEC 88C8                    		mov	al, cl
  9506 00004DEE B406                    		mov	ah, 6
  9507                                  HRDERR:
  9508 00004DF0 E83D09                  		call	CHARHARD
  9509 00004DF3 3C01                    		cmp	al, 1
  9510 00004DF5 7503                    		jnz	short OPCLS_DONEP
  9511 00004DF7 58                      		pop	ax
  9512 00004DF8 EBC2                    		jmp	short OPCLS_RETRY
  9513                                  OPCLS_DONEP:
  9514 00004DFA 58                      		pop	ax
  9515                                  OPCLS_DONE:
  9516 00004DFB E86FC7                  		call	restore_world
  9517 00004DFE C3                      		retn
  9518                                  
  9519                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9520                                  
  9521                                  		; 08/09/2022
  9522                                  DEVIOCALL:
  9523 00004DFF C57407                  		lds	si, [si+7]
  9524                                  
  9525                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9526                                  
  9527                                  		; 08/09/2022
  9528                                  DEVIOCALL2:
  9529 00004E02 E840D1                  		call	EcritDevice
  9530 00004E05 8B4406                  		mov	ax, [si+6]
  9531 00004E08 36A3[2003]              		mov	[ss:CALLDEVAD], ax
  9532 00004E0C 368C1E[2203]            		mov	[ss:CALLDEVAD+2], ds
  9533 00004E11 36FF1E[2003]            		call	far [ss:CALLDEVAD] ; 09/09/2022
  9534 00004E16 8B4408                  		mov	ax, [si+8]
  9535 00004E19 36A3[2003]              		mov	[ss:CALLDEVAD], ax
  9536 00004E1D 36FF1E[2003]            		call	far [ss:CALLDEVAD] ; 09/09/2022
  9537 00004E22 E828D1                  		call	LcritDevice
  9538 00004E25 C3                      		retn
  9539                                  
  9540                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9541                                  
  9542                                  		; 08/09/2022
  9543                                  SETREAD:
  9544 00004E26 57                      		push	di
  9545 00004E27 51                      		push	cx
  9546 00004E28 50                      		push	ax
  9547 00004E29 B104                    		mov	cl, 4
  9548                                  SETCALLHEAD:
  9549 00004E2B B016                    		mov	al, 16h
  9550 00004E2D 16                      		push	ss
  9551 00004E2E 07                      		pop	es
  9552 00004E2F BF[0603]                		mov	di, DEVCALL
  9553 00004E32 AA                      		stosb
  9554 00004E33 58                      		pop	ax
  9555 00004E34 AA                      		stosb
  9556 00004E35 50                      		push	ax
  9557 00004E36 88C8                    		mov	al, cl
  9558 00004E38 AA                      		stosb
  9559 00004E39 31C0                    		xor	ax, ax
  9560 00004E3B AB                      		stosw
  9561 00004E3C 83C708                  		add	di, 8
  9562 00004E3F 58                      		pop	ax
  9563 00004E40 86E0                    		xchg	ah, al
  9564 00004E42 AA                      		stosb
  9565 00004E43 86C4                    		xchg	al, ah
  9566 00004E45 50                      		push	ax
  9567 00004E46 89D8                    		mov	ax, bx
  9568 00004E48 AB                      		stosw
  9569 00004E49 8CD8                    		mov	ax, ds
  9570 00004E4B AB                      		stosw
  9571 00004E4C 59                      		pop	cx
  9572 00004E4D 58                      		pop	ax
  9573 00004E4E AB                      		stosw
  9574 00004E4F 92                      		xchg	ax, dx
  9575 00004E50 AB                      		stosw
  9576 00004E51 91                      		xchg	ax, cx
  9577 00004E52 87D1                    		xchg	dx, cx
  9578 00004E54 5F                      		pop	di
  9579 00004E55 BB[0603]                		mov	bx, DEVCALL
  9580 00004E58 C3                      		retn
  9581                                  
  9582                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9583                                  
  9584                                  		; 08/09/2022
  9585                                  SETWRITE:
  9586 00004E59 57                      		push	di
  9587 00004E5A 51                      		push	cx
  9588 00004E5B 50                      		push	ax
  9589 00004E5C B108                    		mov	cl, 8
  9590 00004E5E 36020E[AD02]            		add	cl, [ss:VERFLG]
  9591 00004E63 EBC6                    		jmp	short SETCALLHEAD
  9592                                  
  9593                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9594                                  
  9595                                  		; 08/09/2022
  9596                                  BUILDDIR:
  9597 00004E65 A1[6A05]                		mov	ax, [ENTFREE]
  9598 00004E68 83F8FF                  		cmp	ax, -1
  9599 00004E6B 7402                    		jz	short CHECK_IF_ROOT
  9600 00004E6D F8                      		clc
  9601 00004E6E C3                      		retn
  9602                                  CHECK_IF_ROOT:
  9603 00004E6F 833E[5805]00            		cmp	word [DIRSTART], 0
  9604 00004E74 7502                    		jnz	short NEWDIR
  9605 00004E76 F9                      		stc
  9606                                  builddir_retn:
  9607 00004E77 C3                      		retn
  9608                                  NEWDIR:
  9609 00004E78 8B1E[5805]              		mov	bx, [DIRSTART]
  9610 00004E7C 09DB                    		or	bx, bx
  9611 00004E7E 7405                    		jz	short NULLDIR
  9612 00004E80 E89D05                  		call	GETEOF
  9613 00004E83 72F2                    		jb	short builddir_retn
  9614                                  NULLDIR:
  9615 00004E85 B90100                  		mov	cx, 1
  9616 00004E88 E8C204                  		call	ALLOCATE
  9617 00004E8B 72EA                    		jb	short builddir_retn
  9618 00004E8D 8B16[5805]              		mov	dx, [DIRSTART]
  9619 00004E91 09D2                    		or	dx, dx
  9620 00004E93 750D                    		jnz	short ADDINGDIR
  9621 00004E95 E859F8                  		call	SETDIRSRCH
  9622 00004E98 72DD                    		jb	short builddir_retn
  9623 00004E9A C706[F402]FFFF          		mov	word [LASTENT], -1
  9624 00004EA0 EB2B                    		jmp	short GOTDIRREC
  9625                                  ADDINGDIR:
  9626 00004EA2 53                      		push	bx
  9627 00004EA3 8B1E[5405]              		mov	bx, [CLUSNUM]
  9628 00004EA7 E8900A                  		call	IsEOF
  9629 00004EAA 5B                      		pop	bx
  9630 00004EAB 7219                    		jb	short NOTFIRSTGROW
  9631 00004EAD 891E[5405]              		mov	[CLUSNUM], bx
  9632 00004EB1 51                      		push	cx
  9633 00004EB2 50                      		push	ax
  9634 00004EB3 55                      		push	bp
  9635 00004EB4 B401                    		mov	ah, 1
  9636 00004EB6 268A5600                		mov	dl, [es:bp+0]
  9637 00004EBA 8B0E[5805]              		mov	cx, [DIRSTART]
  9638 00004EBE 89DD                    		mov	bp, bx
  9639 00004EC0 E85FE4                  		call	FastOpen_Update
  9640 00004EC3 5D                      		pop	bp
  9641 00004EC4 58                      		pop	ax
  9642 00004EC5 59                      		pop	cx
  9643                                  NOTFIRSTGROW:
  9644 00004EC6 89DA                    		mov	dx, bx
  9645 00004EC8 30DB                    		xor	bl, bl
  9646 00004ECA E86F04                  		call	FIGREC
  9647                                  GOTDIRREC:
  9648 00004ECD 268A4E04                		mov	cl, [es:bp+4]
  9649 00004ED1 FEC1                    		inc	cl
  9650 00004ED3 30ED                    		xor	ch, ch
  9651                                  ZERODIR:
  9652 00004ED5 51                      		push	cx
  9653 00004ED6 C606[F702]18            		mov	byte [ALLOWED], 18h
  9654 00004EDB B0FF                    		mov	al, 0FFh
  9655 00004EDD E8B20E                  		call	GETBUFFR
  9656 00004EE0 7302                    		jnb	short GET_SSIZE
  9657 00004EE2 59                      		pop	cx
  9658 00004EE3 C3                      		retn
  9659                                  GET_SSIZE:
  9660 00004EE4 268B4E02                		mov	cx, [es:bp+2]
  9661 00004EE8 06                      		push	es
  9662 00004EE9 C43E[7405]              		les	di, [CURBUF]
  9663 00004EED 26804D0504              		or	byte [es:di+5], 4
  9664 00004EF2 57                      		push	di
  9665 00004EF3 83C710                  		add	di, 16
  9666 00004EF6 31C0                    		xor	ax, ax
  9667 00004EF8 D1E9                    		shr	cx, 1
  9668 00004EFA F3AB                    		rep stosw
  9669 00004EFC 7301                    		jnb	short EVENZ
  9670 00004EFE AA                      		stosb
  9671                                  EVENZ:
  9672 00004EFF 5F                      		pop	di
  9673 00004F00 26804D0540              		or	byte [es:di+5], 40h
  9674 00004F05 07                      		pop	es
  9675 00004F06 59                      		pop	cx
  9676 00004F07 42                      		inc	dx
  9677 00004F08 E2CB                    		loop	ZERODIR
  9678 00004F0A A1[F402]                		mov	ax, word [LASTENT]
  9679 00004F0D 40                      		inc	ax
  9680 00004F0E F8                      		clc
  9681 00004F0F C3                      		retn
  9682                                  
  9683                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9684                                  
  9685                                  		; 08/09/2022
  9686                                  SETDOTENT:
  9687 00004F10 AB                      		stosw
  9688 00004F11 B90400                  		mov	cx, 4
  9689 00004F14 B82020                  		mov	ax, '  '
  9690 00004F17 F3AB                    		rep stosw
  9691 00004F19 AA                      		stosb
  9692 00004F1A B010                    		mov	al, 10h
  9693 00004F1C AA                      		stosb
  9694 00004F1D 83C70A                  		add	di, 10
  9695 00004F20 8B36[3605]              		mov	si, word [THISSFT]
  9696 00004F24 8B440D                  		mov	ax, [si+0Dh]
  9697 00004F27 AB                      		stosw
  9698 00004F28 8B440F                  		mov	ax, [si+0Fh]
  9699 00004F2B AB                      		stosw
  9700 00004F2C 89D0                    		mov	ax, dx
  9701 00004F2E AB                      		stosw
  9702 00004F2F 31C0                    		xor	ax, ax
  9703 00004F31 AB                      		stosw
  9704 00004F32 AB                      		stosw
  9705 00004F33 C3                      		retn
  9706                                  
  9707                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9708                                  
  9709                                  		; 08/09/2022
  9710                                  MakeNode:
  9711 00004F34 C706[1805]FFE5          		mov	word [CREATING], 0E5FFh
  9712 00004F3A 50                      		push	ax
  9713 00004F3B C606[F802]00            		mov	byte [NoSetDir], 0
  9714 00004F40 A2[0805]                		mov	byte [ExtFCB+1], al
  9715 00004F43 E806F8                  		call	GetPathNoSet
  9716 00004F46 88CA                    		mov	dl, cl
  9717 00004F48 89C1                    		mov	cx, ax
  9718 00004F4A 58                      		pop	ax
  9719 00004F4B 7317                    		jnb	short make_exists
  9720 00004F4D 7505                    		jnz	short make_err_4
  9721 00004F4F 80FA80                  		cmp	dl, 80h
  9722 00004F52 7406                    		jz	short make_type
  9723                                  make_err_4:
  9724 00004F54 B004                    		mov	al, 4
  9725                                  make_err_ret:
  9726 00004F56 30E4                    		xor	ah, ah
  9727 00004F58 F9                      		stc
  9728                                  make_retn:
  9729 00004F59 C3                      		retn
  9730                                  make_type:
  9731 00004F5A C43E[3605]              		les	di, [THISSFT]
  9732 00004F5E 31C0                    		xor	ax, ax
  9733 00004F60 F9                      		stc
  9734 00004F61 EB5B                    		jmp	short make_new
  9735                                  
  9736 00004F63 90                      		nop
  9737                                  make_exists:
  9738 00004F64 7448                    		jz	short make_exists_dir
  9739 00004F66 B003                    		mov	al, 3
  9740 00004F68 F606[0605]18            		test	byte [ATTRIB], 18h
  9741 00004F6D 753B                    		jnz	short make_err_ret_5
  9742 00004F6F 08ED                    		or	ch, ch
  9743 00004F71 781A                    		js	short make_share
  9744 00004F73 08E4                    		or	ah, ah
  9745 00004F75 75DF                    		jnz	short make_err_ret
  9746 00004F77 51                      		push	cx
  9747 00004F78 8E06[7605]              		mov	es, word [CURBUF+2]
  9748 00004F7C 268A6F0B                		mov	ch, [es:bx+0Bh]
  9749 00004F80 F6C501                  		test	ch, 1
  9750 00004F83 7524                    		jnz	short make_err_ret_5P
  9751 00004F85 E865FA                  		call	MatchAttributes
  9752 00004F88 59                      		pop	cx
  9753 00004F89 751F                    		jnz	short make_err_ret_5
  9754 00004F8B 30C0                    		xor	al, al
  9755                                  make_share:
  9756 00004F8D 30E4                    		xor	ah, ah
  9757 00004F8F 50                      		push	ax
  9758 00004F90 51                      		push	cx
  9759 00004F91 88EC                    		mov	ah, ch
  9760 00004F93 E83201                  		call	DOOPEN
  9761 00004F96 C43E[3605]              		les	di, [THISSFT]
  9762 00004F9A 56                      		push	si
  9763 00004F9B 53                      		push	bx
  9764 00004F9C E84522                  		call	ShareEnter
  9765 00004F9F 7350                    		jnb	short MakeEndShare
  9766 00004FA1 5B                      		pop	bx
  9767 00004FA2 5E                      		pop	si
  9768 00004FA3 59                      		pop	cx
  9769 00004FA4 58                      		pop	ax
  9770                                  Make_Share_ret:
  9771 00004FA5 B006                    		mov	al, 6
  9772 00004FA7 EBAD                    		jmp	short make_err_ret
  9773                                  make_err_ret_5P:
  9774 00004FA9 59                      		pop	cx
  9775                                  make_err_ret_5:
  9776 00004FAA B005                    		mov	al, 5
  9777 00004FAC EBA8                    		jmp	short make_err_ret
  9778                                  make_exists_dir:
  9779 00004FAE B001                    		mov	al, 1
  9780 00004FB0 EBA4                    		jmp	short make_err_ret
  9781                                  
  9782                                  ; ---------------------------------------------------------------------------
  9783                                  
  9784                                  		; 08/09/2022
  9785                                  make_save:
  9786 00004FB2 50                      		push	ax
  9787 00004FB3 89C8                    		mov	ax, cx
  9788 00004FB5 E86A00                  		call	NewEntry
  9789 00004FB8 58                      		pop	ax
  9790 00004FB9 739E                    		jnb	short make_retn
  9791 00004FBB B002                    		mov	al, 2
  9792                                  make_save_retn:
  9793 00004FBD C3                      		retn
  9794                                  
  9795                                  ; ---------------------------------------------------------------------------
  9796                                  
  9797                                  		; 08/09/2022
  9798                                  make_new:
  9799 00004FBE E8F1FF                  		call	make_save
  9800 00004FC1 72FA                    		jb	short make_save_retn
  9801 00004FC3 F606[0605]10            		test	byte [ATTRIB], 10h
  9802 00004FC8 75F3                    		jnz	short make_save_retn
  9803 00004FCA 50                      		push	ax
  9804 00004FCB 53                      		push	bx
  9805 00004FCC 56                      		push	si
  9806 00004FCD E81422                  		call	ShareEnter
  9807 00004FD0 5E                      		pop	si
  9808 00004FD1 5B                      		pop	bx
  9809 00004FD2 58                      		pop	ax
  9810 00004FD3 73E8                    		jnb	short make_save_retn
  9811 00004FD5 50                      		push	ax
  9812 00004FD6 C43E[7405]              		les	di, [CURBUF]
  9813 00004FDA 26C607E5                		mov	byte [es:bx], 0E5h
  9814 00004FDE 26804D0540              		or	byte [es:di+5], 40h
  9815 00004FE3 C42E[2405]              		les	bp, [THISDPB]
  9816 00004FE7 268A4600                		mov	al, [es:bp+0]
  9817 00004FEB E84F0E                  		call	FLUSHBUF
  9818 00004FEE 58                      		pop	ax
  9819 00004FEF EBB4                    		jmp	short Make_Share_ret
  9820                                  
  9821                                  ; ---------------------------------------------------------------------------
  9822                                  
  9823                                  		; 08/09/2022
  9824                                  MakeEndShare:
  9825 00004FF1 C43E[3605]              		les	di, [THISSFT]
  9826 00004FF5 31C0                    		xor	ax, ax
  9827 00004FF7 E83BCF                  		call	EcritDisk
  9828 00004FFA 268705                  		xchg	ax, [es:di]
  9829 00004FFD 50                      		push	ax
  9830 00004FFE 57                      		push	di
  9831 00004FFF 06                      		push	es
  9832 00005000 9C                      		pushf
  9833 00005001 E8DB21                  		call	ShareEnd
  9834 00005004 9D                      		popf
  9835 00005005 07                      		pop	es
  9836 00005006 5F                      		pop	di
  9837 00005007 268F05                  		pop	word [es:di]
  9838 0000500A E830CF                  		call	LcritDisk
  9839 0000500D 5B                      		pop	bx
  9840 0000500E 5E                      		pop	si
  9841 0000500F 59                      		pop	cx
  9842 00005010 58                      		pop	ax
  9843 00005011 E89EFF                  		call	make_save
  9844 00005014 72A7                    		jb	short make_save_retn
  9845 00005016 50                      		push	ax
  9846 00005017 53                      		push	bx
  9847 00005018 56                      		push	si
  9848 00005019 9C                      		pushf
  9849 0000501A E8C721                  		call	ShareEnter
  9850 0000501D 9D                      		popf
  9851 0000501E 5E                      		pop	si
  9852 0000501F 5B                      		pop	bx
  9853 00005020 58                      		pop	ax
  9854                                  makeendshare_retn:
  9855 00005021 C3                      		retn
  9856                                  
  9857                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
  9858                                  
  9859                                  		; 09/09/2022
  9860                                  		; 08/09/2022
  9861                                  NewEntry:
  9862 00005022 C42E[2405]              		les	bp, [THISDPB]
  9863 00005026 7316                    		jnb	short EXISTENT
  9864 00005028 803E[F602]00            		cmp	byte [FAILERR], 0
  9865 0000502D F9                      		stc
  9866 0000502E 75F1                    		jnz	short makeendshare_retn
  9867 00005030 E832FE                  		call	BUILDDIR
  9868 00005033 72EC                    		jb	short makeendshare_retn
  9869 00005035 E889F6                  		call	GetEnt
  9870 00005038 72E7                    		jb	short makeendshare_retn
  9871 0000503A EB0E                    		jmp	short FREESPOT
  9872                                  ERRRET3:
  9873 0000503C F9                      		stc
  9874                                  newentry_retn:
  9875 0000503D C3                      		retn
  9876                                  EXISTENT:
  9877 0000503E 08E4                    		or	ah, ah
  9878 00005040 7903                    		jns	short NOT_DEV1
  9879 00005042 E98300                  		jmp	DOOPEN
  9880                                  NOT_DEV1:
  9881 00005045 E81401                  		call	FREEENT
  9882                                  newentry_errj:
  9883 00005048 72F3                    		jb	short newentry_retn
  9884                                  FREESPOT:
  9885 0000504A F606[0605]08            		test	byte [ATTRIB], 8
  9886 0000504F 7407                    		jz	short NOTVOLID
  9887 00005051 803E[1605]00            		cmp	byte [cMeta+1], 0
  9888 00005056 75E4                    		jnz	short ERRRET3
  9889                                  NOTVOLID:
  9890 00005058 8E06[7605]              		mov	es, word [CURBUF+2]
  9891 0000505C 89DF                    		mov	di, bx
  9892 0000505E BE[E604]                		mov	si, NAME1
  9893 00005061 B90500                  		mov	cx, 5
  9894 00005064 F3A5                    		rep movsw
  9895 00005066 A4                      		movsb
  9896 00005067 A0[0605]                		mov	al, byte [ATTRIB]
  9897 0000506A AA                      		stosb
  9898 0000506B B105                    		mov	cl, 5
  9899 0000506D 31C0                    		xor	ax, ax
  9900 0000506F F3AB                    		rep stosw
  9901 00005071 E8B2C7                  		call	DATE16
  9902 00005074 92                      		xchg	ax, dx
  9903 00005075 AB                      		stosw
  9904 00005076 92                      		xchg	ax, dx
  9905 00005077 AB                      		stosw
  9906 00005078 31C0                    		xor	ax, ax
  9907 0000507A 57                      		push	di
  9908 0000507B AB                      		stosw
  9909 0000507C AB                      		stosw
  9910 0000507D AB                      		stosw
  9911 0000507E 8B36[7405]              		mov	si, word [CURBUF]
  9912 00005082 26804C0540              		or	byte [es:si+5], 40h
  9913 00005087 C42E[2405]              		les	bp, [THISDPB]
  9914 0000508B 268A4600                		mov	al, [es:bp+0]
  9915 0000508F 50                      		push	ax
  9916 00005090 53                      		push	bx
  9917 00005091 06                      		push	es
  9918 00005092 57                      		push	di
  9919 00005093 C43E[3605]              		les	di, [THISSFT]
  9920 00005097 26F745058000            		test	word [es:di+5], 80h
  9921 0000509D 751A                    		jnz	short GotADevice
  9922 0000509F 1E                      		push	ds
  9923 000050A0 53                      		push	bx
  9924 000050A1 C51E[2405]              		lds	bx, [THISDPB]
  9925 000050A5 26895D07                		mov	[es:di+7], bx
  9926 000050A9 8CDB                    		mov	bx, ds
  9927 000050AB 26895D09                		mov	[es:di+9], bx
  9928 000050AF 5B                      		pop	bx
  9929 000050B0 1F                      		pop	ds
  9930 000050B1 E8CDFC                  		call	DEV_OPEN_SFT
  9931 000050B4 C606[080A]01            		mov	byte [VIRTUAL_OPEN], 1
  9932                                  GotADevice:
  9933 000050B9 5F                      		pop	di
  9934 000050BA 07                      		pop	es
  9935 000050BB E87F0D                  		call	FLUSHBUF
  9936 000050BE E8DA00                  		call	CHECK_VIRT_OPEN
  9937 000050C1 5B                      		pop	bx
  9938 000050C2 58                      		pop	ax
  9939 000050C3 5E                      		pop	si
  9940 000050C4 88C4                    		mov	ah, al
  9941 000050C6 7280                    		jb	short newentry_errj
  9942                                  
  9943                                  ; ---------------------------------------------------------------------------
  9944                                  
  9945                                  		; 08/09/2022
  9946                                  DOOPEN:
  9947 000050C8 88E6                    		mov	dh, ah
  9948 000050CA C43E[3605]              		les	di, [THISSFT]
  9949 000050CE 83C704                  		add	di, 4
  9950 000050D1 30C0                    		xor	al, al
  9951 000050D3 08F6                    		or	dh, dh
  9952 000050D5 7807                    		js	short DEV_SFT1
  9953 000050D7 8E1E[7605]              		mov	ds, word [CURBUF+2]
  9954 000050DB 8A470B                  		mov	al, [bx+0Bh]
  9955                                  DEV_SFT1:
  9956 000050DE AA                      		stosb
  9957 000050DF 31C0                    		xor	ax, ax
  9958 000050E1 88F0                    		mov	al, dh
  9959 000050E3 0C40                    		or	al, 40h
  9960 000050E5 AB                      		stosw
  9961 000050E6 1E                      		push	ds
  9962 000050E7 C5471A                  		lds	ax, [bx+1Ah]
  9963 000050EA 08F6                    		or	dh, dh
  9964 000050EC 7805                    		js	short DEV_SFT2
  9965 000050EE 36C506[2405]            		lds	ax, [ss:THISDPB]
  9966                                  DEV_SFT2:
  9967 000050F3 AB                      		stosw
  9968 000050F4 8CD8                    		mov	ax, ds
  9969 000050F6 1F                      		pop	ds
  9970 000050F7 AB                      		stosw
  9971 000050F8 56                      		push	si
  9972 000050F9 A5                      		movsw
  9973 000050FA 83EE06                  		sub	si, 6
  9974 000050FD A5                      		movsw
  9975 000050FE A5                      		movsw
  9976 000050FF AD                      		lodsw
  9977 00005100 AD                      		lodsw
  9978 00005101 89C1                    		mov	cx, ax
  9979 00005103 AD                      		lodsw
  9980 00005104 08F6                    		or	dh, dh
  9981 00005106 7904                    		jns	short FILE_SFT1
  9982 00005108 31C0                    		xor	ax, ax
  9983 0000510A 89C1                    		mov	cx, ax
  9984                                  FILE_SFT1:
  9985 0000510C 91                      		xchg	ax, cx
  9986 0000510D AB                      		stosw
  9987 0000510E 91                      		xchg	ax, cx
  9988 0000510F AB                      		stosw
  9989 00005110 31C0                    		xor	ax, ax
  9990 00005112 AB                      		stosw
  9991 00005113 AB                      		stosw
  9992 00005114 08F6                    		or	dh, dh
  9993 00005116 7835                    		js	short DEV_SFT3
  9994 00005118 AB                      		stosw
  9995 00005119 8B471A                  		mov	ax, [bx+1Ah]
  9996 0000511C AB                      		stosw
  9997 0000511D 1E                      		push	ds
  9998 0000511E 16                      		push	ss
  9999 0000511F 1F                      		pop	ds
 10000 00005120 F606[660F]04            		test	byte [FastOpenFlg], 4
 10001 00005125 740E                    		jz	short Not_FastOpen
 10002 00005127 BE[410F]                		mov	si, FastOpen_Ext_Info
 10003 0000512A 8B4401                  		mov	ax, [si+1]
 10004 0000512D AB                      		stosw
 10005 0000512E 8A04                    		mov	al, [si]
 10006 00005130 AA                      		stosb
 10007 00005131 1F                      		pop	ds
 10008 00005132 EB17                    		jmp	short Next_Name
 10009                                  
 10010 00005134 90                      		nop
 10011                                  Not_FastOpen:
 10012 00005135 1F                      		pop	ds
 10013 00005136 368B36[7405]            		mov	si, word [ss:CURBUF]
 10014 0000513B 8B4406                  		mov	ax, [si+6]
 10015 0000513E AB                      		stosw
 10016 0000513F 89D8                    		mov	ax, bx
 10017 00005141 83C610                  		add	si, 16
 10018 00005144 29F0                    		sub	ax, si
 10019 00005146 B120                    		mov	cl, 32
 10020 00005148 F6F1                    		div	cl
 10021 0000514A AA                      		stosb
 10022                                  Next_Name:
 10023 0000514B EB03                    		jmp	short FILE_SFT2
 10024                                  DEV_SFT3:
 10025 0000514D 83C707                  		add	di, 7
 10026                                  FILE_SFT2:
 10027 00005150 89DE                    		mov	si, bx
 10028 00005152 B90B00                  		mov	cx, 11
 10029 00005155 F3A4                    		rep movsb
 10030 00005157 5E                      		pop	si
 10031 00005158 16                      		push	ss
 10032 00005159 1F                      		pop	ds
 10033 0000515A F8                      		clc
 10034 0000515B C3                      		retn
 10035                                  
 10036                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10037                                  
 10038                                  		; 08/09/2022
 10039                                  FREEENT:
 10040 0000515C 1E                      		push	ds
 10041 0000515D C53E[7405]              		lds	di, [CURBUF]
 10042 00005161 8B0C                    		mov	cx, [si]
 10043 00005163 8B5506                  		mov	dx, [di+6]
 10044 00005166 1F                      		pop	ds
 10045 00005167 83F902                  		cmp	cx, 2
 10046 0000516A 722D                    		jb	short RET1
 10047 0000516C 263B4E0D                		cmp	cx, [es:bp+0Dh]
 10048 00005170 7727                    		ja	short RET1
 10049 00005172 29FB                    		sub	bx, di
 10050 00005174 53                      		push	bx
 10051 00005175 52                      		push	dx
 10052 00005176 89CB                    		mov	bx, cx
 10053 00005178 E87902                  		call	RELEASE
 10054 0000517B 5A                      		pop	dx
 10055 0000517C 7302                    		jnb	short GET_BUF_BACK
 10056 0000517E 5B                      		pop	bx
 10057                                  freeent_retn:
 10058 0000517F C3                      		retn
 10059                                  
 10060                                  ; ---------------------------------------------------------------------------
 10061                                  
 10062                                  		; 08/09/2022
 10063                                  GET_BUF_BACK:
 10064 00005180 C606[F702]18            		mov	byte [ALLOWED], 18h
 10065 00005185 30C0                    		xor	al, al
 10066 00005187 E8080C                  		call	GETBUFFR
 10067 0000518A 5B                      		pop	bx
 10068 0000518B 72F2                    		jb	short freeent_retn
 10069 0000518D E8C6EE                  		call	SET_BUF_AS_DIR
 10070 00005190 031E[7405]              		add	bx, word [CURBUF]
 10071 00005194 89DE                    		mov	si, bx
 10072 00005196 83C61A                  		add	si, 1Ah
 10073                                  RET1:
 10074 00005199 F8                      		clc
 10075 0000519A C3                      		retn
 10076                                  
 10077                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10078                                  
 10079                                  		; 08/09/2022
 10080                                  CHECK_VIRT_OPEN:
 10081 0000519B 50                      		push	ax
 10082 0000519C 9F                      		lahf
 10083 0000519D 803E[080A]00            		cmp	byte [VIRTUAL_OPEN], 0
 10084 000051A2 7410                    		jz	short ALL_CLOSED
 10085 000051A4 C606[080A]00            		mov	byte [VIRTUAL_OPEN], 0
 10086 000051A9 06                      		push	es
 10087 000051AA 57                      		push	di
 10088 000051AB C43E[3605]              		les	di, [THISSFT]
 10089 000051AF E8D6FB                  		call	DEV_CLOSE_SFT
 10090 000051B2 5F                      		pop	di
 10091 000051B3 07                      		pop	es
 10092                                  ALL_CLOSED:
 10093 000051B4 9E                      		sahf
 10094 000051B5 58                      		pop	ax
 10095 000051B6 C3                      		retn
 10096                                  
 10097                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10098                                  
 10099                                  		; 08/09/2022
 10100                                  FNDCLUS:
 10101 000051B7 06                      		push	es
 10102 000051B8 C43E[3605]              		les	di, [THISSFT]
 10103 000051BC 268B5D1B                		mov	bx, [es:di+1Bh]
 10104 000051C0 268B5519                		mov	dx, [es:di+19h]
 10105 000051C4 09DB                    		or	bx, bx
 10106 000051C6 7425                    		jz	short NOCLUS
 10107 000051C8 29D1                    		sub	cx, dx
 10108 000051CA 7308                    		jnb	short FINDIT
 10109 000051CC 01D1                    		add	cx, dx
 10110 000051CE 31D2                    		xor	dx, dx
 10111 000051D0 268B5D0B                		mov	bx, [es:di+0Bh]
 10112                                  FINDIT:
 10113 000051D4 07                      		pop	es
 10114 000051D5 E314                    		jcxz	RET9
 10115                                  SKPCLP:
 10116 000051D7 E87707                  		call	UNPACK
 10117 000051DA 7301                    		jnb	short skpclp1
 10118 000051DC C3                      		retn
 10119                                  skpclp1:
 10120 000051DD 53                      		push	bx
 10121 000051DE 89FB                    		mov	bx, di
 10122 000051E0 E85707                  		call	IsEOF
 10123 000051E3 5B                      		pop	bx
 10124 000051E4 7305                    		jnb	short RET9
 10125 000051E6 87DF                    		xchg	bx, di
 10126 000051E8 42                      		inc	dx
 10127 000051E9 E2EC                    		loop	SKPCLP
 10128                                  RET9:
 10129 000051EB F8                      		clc
 10130 000051EC C3                      		retn
 10131                                  NOCLUS:
 10132 000051ED 07                      		pop	es
 10133 000051EE 41                      		inc	cx
 10134 000051EF 4A                      		dec	dx
 10135 000051F0 F8                      		clc
 10136                                  fndclus_retn:
 10137 000051F1 C3                      		retn
 10138                                  
 10139                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10140                                  
 10141                                  		; 08/09/2022
 10142                                  BUFSEC:
 10143 000051F2 8B16[5405]              		mov	dx, [CLUSNUM]
 10144 000051F6 8A1E[0E05]              		mov	bl, byte [SECCLUSPOS]
 10145 000051FA C606[F702]38            		mov	byte [ALLOWED], 38h
 10146 000051FF E83A01                  		call	FIGREC
 10147 00005202 E88D0B                  		call	GETBUFFR
 10148 00005205 72EA                    		jb	short fndclus_retn
 10149 00005207 C606[0F05]01            		mov	byte [SECCLUSPOS+1], 1
 10150 0000520C 8B36[5005]              		mov	si, [NEXTADD]
 10151 00005210 89F7                    		mov	di, si
 10152 00005212 8B0E[6405]              		mov	cx, [BYTCNT1]
 10153 00005216 01CF                    		add	di, cx
 10154 00005218 893E[5005]              		mov	[NEXTADD], di
 10155 0000521C C43E[7405]              		les	di, [CURBUF]
 10156 00005220 26804D0508              		or	byte [es:di+5], 8
 10157 00005225 8D7D10                  		lea	di, [di+16]
 10158 00005228 033E[5E05]              		add	di, [BYTSECPOS]
 10159 0000522C F8                      		clc
 10160 0000522D C3                      		retn
 10161                                  
 10162                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10163                                  
 10164                                  		; 08/09/2022
 10165                                  BUFRD:
 10166 0000522E 06                      		push	es
 10167 0000522F B80000                  		mov	ax, 0
 10168 00005232 E8BDFF                  		call	BUFSEC
 10169 00005235 7303                    		jnb	short BUF_OK
 10170                                  BUF_IO_FAIL:
 10171 00005237 07                      		pop	es
 10172 00005238 EB29                    		jmp	short RBUFPLACED
 10173                                  BUF_OK:
 10174 0000523A 8CC3                    		mov	bx, es
 10175 0000523C 8E06[DC02]              		mov	es, [DMAADD+2]
 10176 00005240 8EDB                    		mov	ds, bx
 10177 00005242 87FE                    		xchg	di, si
 10178 00005244 D1E9                    		shr	cx, 1
 10179 00005246 7301                    		jnb	short EVENRD
 10180 00005248 A4                      		movsb
 10181                                  EVENRD:
 10182 00005249 F3A5                    		rep movsw
 10183 0000524B 07                      		pop	es
 10184 0000524C 36C53E[7405]            		lds	di, [ss:CURBUF]
 10185 00005251 8D5D10                  		lea	bx, [di+16]
 10186 00005254 29DE                    		sub	si, bx
 10187 00005256 E88E0A                  		call	PLACEBUF
 10188 00005259 263B7602                		cmp	si, [es:bp+2]
 10189 0000525D 7203                    		jb	short RBUFPLACEDC
 10190 0000525F E8E70A                  		call	PLACEHEAD
 10191                                  RBUFPLACEDC:
 10192 00005262 F8                      		clc
 10193                                  RBUFPLACED:
 10194 00005263 16                      		push	ss
 10195 00005264 1F                      		pop	ds
 10196 00005265 C3                      		retn
 10197                                  
 10198                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10199                                  
 10200                                  		; 08/09/2022
 10201                                  BUFWRT:
 10202 00005266 A1[5A05]                		mov	ax, [SECPOS]
 10203 00005269 40                      		inc	ax
 10204 0000526A A3[5A05]                		mov	[SECPOS], ax
 10205 0000526D 3B06[5C05]              		cmp	ax, [VALSEC]
 10206 00005271 B001                    		mov	al, 1
 10207 00005273 7702                    		ja	short NOREAD
 10208 00005275 30C0                    		xor	al, al
 10209                                  NOREAD:
 10210 00005277 06                      		push	es
 10211 00005278 E877FF                  		call	BUFSEC
 10212 0000527B 72BA                    		jb	short BUF_IO_FAIL
 10213 0000527D 8E1E[DC02]              		mov	ds, [DMAADD+2]
 10214 00005281 D1E9                    		shr	cx, 1
 10215 00005283 7301                    		jnb	short EVENWRT
 10216 00005285 A4                      		movsb
 10217                                  EVENWRT:
 10218 00005286 F3A5                    		rep movsw
 10219 00005288 07                      		pop	es
 10220 00005289 36C51E[7405]            		lds	bx, [ss:CURBUF]
 10221 0000528E 804F0540                		or	byte [bx+5], 40h
 10222 00005292 8D7710                  		lea	si, [bx+16]
 10223 00005295 29F7                    		sub	di, si
 10224 00005297 89FE                    		mov	si, di
 10225 00005299 89DF                    		mov	di, bx
 10226 0000529B E8490A                  		call	PLACEBUF
 10227 0000529E 263B7602                		cmp	si, [es:bp+2]
 10228 000052A2 7203                    		jb	short WBUFPLACED
 10229 000052A4 E8A20A                  		call	PLACEHEAD
 10230                                  WBUFPLACED:
 10231 000052A7 F8                      		clc
 10232 000052A8 16                      		push	ss
 10233 000052A9 1F                      		pop	ds
 10234 000052AA C3                      		retn
 10235                                  
 10236                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10237                                  
 10238                                  		; 08/09/2022
 10239                                  NEXTSEC:
 10240 000052AB F606[0F05]FF            		test	byte [SECCLUSPOS+1], -1
 10241 000052B0 7426                    		jz	short CLRET
 10242 000052B2 A0[0E05]                		mov	al, byte [SECCLUSPOS]
 10243 000052B5 FEC0                    		inc	al
 10244 000052B7 263A4604                		cmp	al, [es:bp+4]
 10245 000052BB 7618                    		jbe	short SAVPOS
 10246 000052BD 8B1E[5405]              		mov	bx, [CLUSNUM]
 10247 000052C1 E87606                  		call	IsEOF
 10248 000052C4 7314                    		jnb	short NONEXT
 10249 000052C6 E88806                  		call	UNPACK
 10250 000052C9 720F                    		jb	short NONEXT
 10251 000052CB 893E[5405]              		mov	[CLUSNUM], di
 10252 000052CF FF06[5205]              		inc	word [LASTPOS]
 10253 000052D3 B000                    		mov	al, 0
 10254                                  SAVPOS:
 10255 000052D5 A2[0E05]                		mov	byte [SECCLUSPOS], al
 10256                                  CLRET:
 10257 000052D8 F8                      		clc
 10258 000052D9 C3                      		retn
 10259                                  NONEXT:
 10260 000052DA F9                      		stc
 10261 000052DB C3                      		retn
 10262                                  
 10263                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10264                                  
 10265                                  		; 08/09/2022
 10266                                  OPTIMIZE:
 10267 000052DC 52                      		push	dx
 10268 000052DD 53                      		push	bx
 10269 000052DE 268A4604                		mov	al, [es:bp+4]
 10270 000052E2 FEC0                    		inc	al
 10271 000052E4 88C4                    		mov	ah, al
 10272 000052E6 28D0                    		sub	al, dl
 10273 000052E8 89CA                    		mov	dx, cx
 10274 000052EA B90000                  		mov	cx, 0
 10275                                  OPTCLUS:
 10276 000052ED E86106                  		call	UNPACK
 10277 000052F0 7237                    		jb	short OP_ERR
 10278 000052F2 00C1                    		add	cl, al
 10279 000052F4 80D500                  		adc	ch, 0
 10280 000052F7 39D1                    		cmp	cx, dx
 10281 000052F9 7333                    		jnb	short BLKDON
 10282 000052FB 88E0                    		mov	al, ah
 10283 000052FD 43                      		inc	bx
 10284 000052FE 39DF                    		cmp	di, bx
 10285 00005300 74EB                    		jz	short OPTCLUS
 10286 00005302 4B                      		dec	bx
 10287                                  FINCLUS:
 10288 00005303 891E[5405]              		mov	[CLUSNUM], bx
 10289 00005307 29CA                    		sub	dx, cx
 10290 00005309 52                      		push	dx
 10291 0000530A 89C8                    		mov	ax, cx
 10292 0000530C 26F76602                		mul	word [es:bp+2]
 10293 00005310 8B36[5005]              		mov	si, [NEXTADD]
 10294 00005314 01F0                    		add	ax, si
 10295 00005316 A3[5005]                		mov	[NEXTADD], ax
 10296 00005319 58                      		pop	ax
 10297 0000531A 5A                      		pop	dx
 10298 0000531B 29D3                    		sub	bx, dx
 10299 0000531D 011E[5205]              		add	[LASTPOS], bx
 10300 00005321 5B                      		pop	bx
 10301 00005322 E81700                  		call	FIGREC
 10302 00005325 89F3                    		mov	bx, si
 10303 00005327 F8                      		clc
 10304 00005328 C3                      		retn
 10305                                  OP_ERR:
 10306 00005329 83C404                  		add	sp, 4
 10307 0000532C F9                      		stc
 10308 0000532D C3                      		retn
 10309                                  BLKDON:
 10310 0000532E 29D1                    		sub	cx, dx
 10311 00005330 28CC                    		sub	ah, cl
 10312 00005332 FECC                    		dec	ah
 10313 00005334 8826[0E05]              		mov	byte [SECCLUSPOS], ah
 10314 00005338 89D1                    		mov	cx, dx
 10315 0000533A EBC7                    		jmp	short FINCLUS
 10316                                  
 10317                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10318                                  
 10319                                  		; 08/09/2022
 10320                                  FIGREC:
 10321 0000533C 51                      		push	cx
 10322 0000533D 268A4E05                		mov	cl, [es:bp+5]
 10323 00005341 4A                      		dec	dx
 10324 00005342 4A                      		dec	dx
 10325 00005343 D3E2                    		shl	dx, cl
 10326 00005345 08DA                    		or	dl, bl
 10327 00005347 2603560B                		add	dx, [es:bp+0Bh]
 10328 0000534B 59                      		pop	cx
 10329                                  figrec_retn:
 10330 0000534C C3                      		retn
 10331                                  
 10332                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10333                                  
 10334                                  		; 08/09/2022
 10335                                  ALLOCATE:
 10336 0000534D 53                      		push	bx
 10337 0000534E 31DB                    		xor	bx, bx
 10338 00005350 E8FE05                  		call	UNPACK
 10339 00005353 893E[2E05]              		mov	[FATBYT], di
 10340 00005357 5B                      		pop	bx
 10341 00005358 72F2                    		jb	short figrec_retn
 10342 0000535A 51                      		push	cx
 10343 0000535B 53                      		push	bx
 10344 0000535C 89DA                    		mov	dx, bx
 10345 0000535E 268B5E1C                		mov	bx, [es:bp+1Ch]
 10346 00005362 83FB02                  		cmp	bx, 2
 10347 00005365 7709                    		ja	short FINDFRE
 10348                                  ads1:
 10349 00005367 26C7461C0200            		mov	word [es:bp+1Ch], 2
 10350 0000536D BB0100                  		mov	bx, 1
 10351                                  FINDFRE:
 10352 00005370 43                      		inc	bx
 10353 00005371 263B5E0D                		cmp	bx, [es:bp+0Dh]
 10354 00005375 7757                    		ja	short ads7
 10355 00005377 E8D705                  		call	UNPACK
 10356 0000537A 722F                    		jb	short ads4
 10357 0000537C 75F2                    		jnz	short FINDFRE
 10358 0000537E 26895E1C                		mov	[es:bp+1Ch], bx
 10359 00005382 92                      		xchg	ax, dx
 10360 00005383 BA0100                  		mov	dx, 1
 10361 00005386 E81106                  		call	PACK
 10362 00005389 7220                    		jb	short ads4
 10363 0000538B 26837E1EFF              		cmp	word [es:bp+1Eh], -1
 10364 00005390 7404                    		jz	short NO_ALLOC
 10365 00005392 26FF4E1E                		dec	word [es:bp+1Eh]
 10366                                  NO_ALLOC:
 10367 00005396 92                      		xchg	ax, dx
 10368 00005397 87DA                    		xchg	bx, dx
 10369 00005399 89D0                    		mov	ax, dx
 10370 0000539B E8FC05                  		call	PACK
 10371 0000539E 720B                    		jb	short ads4
 10372 000053A0 93                      		xchg	ax, bx
 10373 000053A1 89DA                    		mov	dx, bx
 10374 000053A3 E2CB                    		loop	FINDFRE
 10375 000053A5 BAFFFF                  		mov	dx, 0FFFFh
 10376 000053A8 E8EF05                  		call	PACK
 10377                                  ads4:
 10378 000053AB 5B                      		pop	bx
 10379 000053AC 59                      		pop	cx
 10380 000053AD 729D                    		jb	short figrec_retn
 10381 000053AF E89F05                  		call	UNPACK
 10382 000053B2 7298                    		jb	short figrec_retn
 10383 000053B4 E82D00                  		call	RESTFATBYT
 10384 000053B7 7293                    		jb	short figrec_retn
 10385 000053B9 87DF                    		xchg	bx, di
 10386 000053BB 09FF                    		or	di, di
 10387 000053BD 758D                    		jnz	short figrec_retn
 10388 000053BF 06                      		push	es
 10389 000053C0 C43E[3605]              		les	di, [THISSFT]
 10390 000053C4 26895D0B                		mov	[es:di+0Bh], bx
 10391 000053C8 26895D1B                		mov	[es:di+1Bh], bx
 10392 000053CC 07                      		pop	es
 10393 000053CD C3                      		retn
 10394                                  ads7:
 10395 000053CE 26837E1C02              		cmp	word [es:bp+1Ch], 2
 10396 000053D3 7592                    		jnz	short ads1
 10397 000053D5 5B                      		pop	bx
 10398 000053D6 BAFFFF                  		mov	dx, 0FFFFh
 10399 000053D9 E81A00                  		call	RELBLKS
 10400 000053DC 58                      		pop	ax
 10401 000053DD 29C8                    		sub	ax, cx
 10402 000053DF E80200                  		call	RESTFATBYT
 10403 000053E2 F9                      		stc
 10404 000053E3 C3                      		retn
 10405                                  
 10406                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10407                                  
 10408                                  		; 08/09/2022
 10409                                  RESTFATBYT:
 10410 000053E4 53                      		push	bx
 10411 000053E5 52                      		push	dx
 10412 000053E6 57                      		push	di
 10413 000053E7 31DB                    		xor	bx, bx
 10414 000053E9 8B16[2E05]              		mov	dx, [FATBYT]
 10415 000053ED E8AA05                  		call	PACK
 10416 000053F0 5F                      		pop	di
 10417 000053F1 5A                      		pop	dx
 10418 000053F2 5B                      		pop	bx
 10419                                  RELEASE_flush:
 10420 000053F3 C3                      		retn
 10421                                  
 10422                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10423                                  
 10424                                  		; 08/09/2022
 10425                                  RELEASE:
 10426 000053F4 31D2                    		xor	dx, dx
 10427                                  RELBLKS:
 10428 000053F6 E85805                  		call	UNPACK
 10429 000053F9 72F8                    		jb	short RELEASE_flush
 10430 000053FB 74F6                    		jz	short RELEASE_flush
 10431 000053FD 89F8                    		mov	ax, di
 10432 000053FF 52                      		push	dx
 10433 00005400 E89705                  		call	PACK
 10434 00005403 5A                      		pop	dx
 10435 00005404 72ED                    		jb	short RELEASE_flush
 10436 00005406 09D2                    		or	dx, dx
 10437 00005408 750B                    		jnz	short NO_DEALLOC
 10438 0000540A 26837E1EFF              		cmp	word [es:bp+1Eh], -1
 10439 0000540F 7404                    		jz	short NO_DEALLOC
 10440 00005411 26FF461E                		inc	word [es:bp+1Eh]
 10441                                  NO_DEALLOC:
 10442 00005415 89C3                    		mov	bx, ax
 10443 00005417 48                      		dec	ax
 10444 00005418 74D9                    		jz	short RELEASE_flush
 10445 0000541A E81D05                  		call	IsEOF
 10446 0000541D 72D5                    		jb	short RELEASE
 10447                                  RET12:
 10448 0000541F C3                      		retn
 10449                                  
 10450                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10451                                  
 10452                                  		; 08/09/2022
 10453                                  GETEOF:
 10454 00005420 E82E05                  		call	UNPACK
 10455 00005423 72FA                    		jb	short RET12
 10456 00005425 53                      		push	bx
 10457 00005426 89FB                    		mov	bx, di
 10458 00005428 E80F05                  		call	IsEOF
 10459 0000542B 5B                      		pop	bx
 10460 0000542C 73F1                    		jnb	short RET12
 10461 0000542E 89FB                    		mov	bx, di
 10462 00005430 EBEE                    		jmp	short GETEOF
 10463                                  
 10464                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10465                                  
 10466                                  		; 08/09/2022
 10467                                  MAKEFCB:
 10468 00005432 36C606[FA02]00          		mov	byte [ss:SpaceFlag], 0
 10469 00005438 30D2                    		xor	dl, dl
 10470 0000543A A802                    		test	al, 2
 10471 0000543C 7504                    		jnz	short DEFDRV
 10472 0000543E 26C60500                		mov	byte [es:di], 0
 10473                                  DEFDRV:
 10474 00005442 47                      		inc	di
 10475 00005443 B90800                  		mov	cx, 8
 10476 00005446 A804                    		test	al, 4
 10477 00005448 93                      		xchg	ax, bx
 10478 00005449 B020                    		mov	al, ' '
 10479 0000544B 7404                    		jz	short FILLB
 10480 0000544D 01CF                    		add	di, cx
 10481 0000544F 31C9                    		xor	cx, cx
 10482                                  FILLB:
 10483 00005451 F3AA                    		rep stosb
 10484 00005453 B103                    		mov	cl, 3
 10485 00005455 F6C308                  		test	bl, 8
 10486 00005458 7404                    		jz	short FILLB2
 10487 0000545A 01CF                    		add	di, cx
 10488 0000545C 31C9                    		xor	cx, cx
 10489                                  FILLB2:
 10490 0000545E F3AA                    		rep stosb
 10491 00005460 91                      		xchg	ax, cx
 10492 00005461 AB                      		stosw
 10493 00005462 AB                      		stosw
 10494 00005463 83EF10                  		sub	di, 16
 10495 00005466 F6C301                  		test	bl, 1
 10496 00005469 7409                    		jz	short SKPSPC
 10497 0000546B E87300                  		call	SCANB
 10498 0000546E E8C700                  		call	DELIM
 10499 00005471 7504                    		jnz	short NOSCAN
 10500 00005473 46                      		inc	si
 10501                                  SKPSPC:
 10502 00005474 E86A00                  		call	SCANB
 10503                                  NOSCAN:
 10504 00005477 E89C00                  		call	GETLET
 10505 0000547A 7616                    		jbe	short NODRV
 10506 0000547C 803C3A                  		cmp	byte [si], ':'
 10507 0000547F 7511                    		jnz	short NODRV
 10508 00005481 46                      		inc	si
 10509 00005482 2C40                    		sub	al, 40h
 10510 00005484 7607                    		jbe	short BADDRV
 10511 00005486 50                      		push	ax
 10512 00005487 E8AE13                  		call	GETVISDRV
 10513 0000548A 58                      		pop	ax
 10514 0000548B 7302                    		jnb	short HavDrv
 10515                                  BADDRV:
 10516 0000548D B2FF                    		mov	dl, -1
 10517                                  HavDrv:
 10518 0000548F AA                      		stosb
 10519 00005490 46                      		inc	si
 10520 00005491 4F                      		dec	di
 10521                                  NODRV:
 10522 00005492 4E                      		dec	si
 10523 00005493 47                      		inc	di
 10524                                  
 10525                                  ; ---------------------------------------------------------------------------
 10526                                  	
 10527                                  		; 08/09/2022
 10528                                  NORMSCAN:
 10529 00005494 B90800                  		mov	cx, 8
 10530 00005497 E81300                  		call	GETWORD
 10531 0000549A 803C2E                  		cmp	byte [si], '.'
 10532 0000549D 7507                    		jnz	short NODOT
 10533 0000549F 46                      		inc	si
 10534 000054A0 B90300                  		mov	cx, 3
 10535 000054A3 E80D00                  		call	MUSTGETWORD
 10536                                  NODOT:
 10537 000054A6 88D0                    		mov	al, dl
 10538 000054A8 C3                      		retn
 10539                                  
 10540                                  ; ---------------------------------------------------------------------------
 10541                                  
 10542                                  		; 08/09/2022
 10543                                  NONAM:
 10544 000054A9 01CF                    		add	di, cx
 10545 000054AB 4E                      		dec	si
 10546 000054AC C3                      		retn
 10547                                  
 10548                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10549                                  
 10550                                  		; 08/09/2022
 10551                                  GETWORD:
 10552                                  
 10553 000054AD E86600                  		call	GETLET
 10554 000054B0 76F7                    		jbe	short NONAM
 10555 000054B2 4E                      		dec	si
 10556                                  
 10557                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10558                                  
 10559                                  		; 08/09/2022
 10560                                  MUSTGETWORD:
 10561 000054B3 E86000                  		call	GETLET
 10562 000054B6 7223                    		jb	short FILLNAM
 10563 000054B8 750C                    		jnz	short MustCheckCX
 10564 000054BA 36F606[FA02]FF          		test	byte [ss:SpaceFlag], 0FFh
 10565 000054C0 7419                    		jz	short FILLNAM
 10566 000054C2 3C20                    		cmp	al, ' '
 10567 000054C4 7515                    		jnz	short FILLNAM
 10568                                  MustCheckCX:
 10569 000054C6 E3EB                    		jcxz	MUSTGETWORD
 10570 000054C8 49                      		dec	cx
 10571 000054C9 3C2A                    		cmp	al, '*'
 10572 000054CB 7504                    		jnz	short NOSTAR
 10573 000054CD B03F                    		mov	al, '?'
 10574 000054CF F3AA                    		rep stosb
 10575                                  NOSTAR:
 10576 000054D1 AA                      		stosb
 10577 000054D2 3C3F                    		cmp	al, '?'
 10578 000054D4 75DD                    		jnz	short MUSTGETWORD
 10579 000054D6 80CA01                  		or	dl, 1
 10580 000054D9 EBD8                    		jmp	short MUSTGETWORD
 10581                                  FILLNAM:
 10582 000054DB B020                    		mov	al, ' '
 10583 000054DD F3AA                    		rep stosb
 10584 000054DF 4E                      		dec	si
 10585 000054E0 C3                      		retn
 10586                                  
 10587                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10588                                  
 10589                                  		; 08/09/2022
 10590                                  SCANB:
 10591 000054E1 AC                      		lodsb
 10592 000054E2 E85F00                  		call	SPCHK
 10593 000054E5 74FA                    		jz	short SCANB
 10594 000054E7 4E                      		dec	si
 10595                                  scanb_retn:
 10596 000054E8 C3                      		retn
 10597                                  
 10598                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10599                                  
 10600                                  		; 09/09/2022
 10601                                  		; 08/09/2022
 10602                                  NameTrans:
 10603 000054E9 36C606[FA02]01          		mov	byte [ss:SpaceFlag], 1
 10604 000054EF 16                      		push	ss
 10605 000054F0 07                      		pop	es
 10606 000054F1 BF[E604]                		mov	di, NAME1
 10607 000054F4 57                      		push	di
 10608 000054F5 B82020                  		mov	ax, '  '
 10609 000054F8 B90500                  		mov	cx, 5
 10610 000054FB AA                      		stosb
 10611 000054FC F3AB                    		rep stosw
 10612 000054FE 30C0                    		xor	al, al
 10613 00005500 88C2                    		mov	dl, al
 10614 00005502 AA                      		stosb
 10615 00005503 5F                      		pop	di
 10616 00005504 E88DFF                  		call	NORMSCAN
 10617 00005507 36803E[E604]E5          		cmp	byte [ss:NAME1], 0E5h
 10618 0000550D 75D9                    		jnz	short scanb_retn
 10619 0000550F 36C606[E604]05          		mov	byte [ss:NAME1], 5
 10620 00005515 C3                      		retn
 10621                                  
 10622                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10623                                  
 10624                                  		; 08/09/2022
 10625                                  GETLET:
 10626 00005516 AC                      		lodsb
 10627                                  
 10628                                  ; ---------------------------------------------------------------------------
 10629                                  
 10630                                  		; 08/09/2022
 10631                                  _UCase:
 10632 00005517 53                      		push	bx
 10633 00005518 3C61                    		cmp	al, 'a'
 10634 0000551A 7206                    		jb	short gl_1
 10635 0000551C 3C7A                    		cmp	al, 'z'
 10636 0000551E 7702                    		ja	short gl_1
 10637 00005520 2C20                    		sub	al, ' '
 10638                                  gl_1:
 10639 00005522 3C80                    		cmp	al, 80h
 10640 00005524 7207                    		jb	short gl_2
 10641 00005526 2C80                    		sub	al, 80h
 10642 00005528 BB[BE10]                		mov	bx, FILE_UCASE_TAB+2
 10643                                  		;xlat	byte [cs:bx]
 10644 0000552B 2ED7                    		cs	xlat
 10645                                  gl_2:
 10646 0000552D 50                      		push	ax
 10647 0000552E BB[CA12]                		mov	bx, CharType
 10648                                  		;xlat	byte [cs:bx]
 10649 00005531 2ED7                    		cs	xlat
 10650 00005533 A801                    		test	al, 1
 10651 00005535 58                      		pop	ax
 10652 00005536 5B                      		pop	bx
 10653 00005537 C3                      		retn
 10654                                  
 10655                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10656                                  
 10657                                  		; 08/09/2022
 10658                                  DELIM:
 10659 00005538 50                      		push	ax
 10660 00005539 53                      		push	bx
 10661 0000553A BB[CA12]                		mov	bx, CharType
 10662                                  		;xlat	byte [cs:bx]
 10663 0000553D 2ED7                    		cs	xlat
 10664 0000553F A802                    		test	al, 2
 10665 00005541 5B                      		pop	bx
 10666 00005542 58                      		pop	ax
 10667 00005543 C3                      		retn
 10668                                  
 10669                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10670                                  
 10671                                  		; 08/09/2022
 10672                                  SPCHK:
 10673 00005544 50                      		push	ax
 10674 00005545 53                      		push	bx
 10675 00005546 BB[CA12]                		mov	bx, CharType
 10676                                  		;xlat	byte [cs:bx]
 10677 00005549 2ED7                    		cs	xlat
 10678 0000554B A804                    		test	al, 4
 10679 0000554D 5B                      		pop	bx
 10680 0000554E 58                      		pop	ax
 10681 0000554F C3                      		retn
 10682                                  
 10683                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10684                                  
 10685                                  		; 08/09/2022
 10686                                  PATHCHRCMP:
 10687 00005550 3C2F                    		cmp	al, '/'
 10688 00005552 7606                    		jbe	short PathRet
 10689 00005554 3C5C                    		cmp	al, '\'
 10690 00005556 C3                      		retn
 10691                                  GotFor:	
 10692 00005557 B05C                    		mov	al, '\'
 10693 00005559 C3                      		retn
 10694                                  PathRet:
 10695 0000555A 74FB                    		jz	short GotFor
 10696 0000555C C3                      		retn
 10697                                  
 10698                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10699                                  
 10700                                  		; 08/09/2022
 10701                                  DSKSTATCHK:
 10702 0000555D 36803E[CF02]01          		cmp	byte [ss:INDOS], 1
 10703 00005563 7401                    		jz	short dskstatuschk1
 10704 00005565 C3                      		retn
 10705                                  dskstatuschk1:
 10706 00005566 51                      		push	cx
 10707 00005567 06                      		push	es
 10708 00005568 53                      		push	bx
 10709 00005569 1E                      		push	ds
 10710 0000556A 56                      		push	si
 10711 0000556B 0E                      		push	cs
 10712 0000556C 07                      		pop	es
 10713 0000556D 16                      		push	ss
 10714 0000556E 1F                      		pop	ds
 10715 0000556F C606[3C03]05            		mov	byte [DSKSTCOM], 5
 10716 00005574 C606[3A03]0E            		mov	byte [DSKSTCALL], 14
 10717 00005579 C706[3D03]0000          		mov	word [DSKSTST], 0
 10718 0000557F BB[3A03]                		mov	bx, DSKSTCALL
 10719 00005582 C536[3200]              		lds	si, [BCON]
 10720 00005586 E879F8                  		call	DEVIOCALL2
 10721 00005589 36F706[3D03]0002        		test	word [ss:DSKSTST], 200h
 10722 00005590 7408                    		jz	short GotCh
 10723 00005592 30C0                    		xor	al, al
 10724                                  RET36:
 10725 00005594 5E                      		pop	si
 10726 00005595 1F                      		pop	ds
 10727 00005596 5B                      		pop	bx
 10728 00005597 07                      		pop	es
 10729 00005598 59                      		pop	cx
 10730 00005599 C3                      		retn
 10731                                  GotCh:
 10732 0000559A 36A0[4703]              		mov	al, [ss:DSKCHRET]
 10733 0000559E 3C03                    		cmp	al, 3		; "C"-"@"
 10734 000055A0 75F2                    		jnz	short RET36
 10735 000055A2 36C606[3C03]04          		mov	byte [ss:DSKSTCOM], 4
 10736 000055A8 36C606[3A03]16          		mov	byte [ss:DSKSTCALL], 16h
 10737 000055AE 36880E[4703]            		mov	[ss:DSKCHRET], cl
 10738 000055B3 36C706[3D03]0000        		mov	word [ss:DSKSTST], 0
 10739 000055BA 36C706[4C03]0100        		mov	word [ss:DSKSTCNT], 1
 10740 000055C1 E83EF8                  		call	DEVIOCALL2
 10741 000055C4 5E                      		pop	si
 10742 000055C5 1F                      		pop	ds
 10743 000055C6 5B                      		pop	bx
 10744 000055C7 07                      		pop	es
 10745 000055C8 59                      		pop	cx
 10746 000055C9 E9BF00                  		jmp	CNTCHAND
 10747                                  
 10748                                  ; ---------------------------------------------------------------------------
 10749                                  
 10750                                  		; 08/09/2022
 10751                                  NOSTOP:
 10752 000055CC 3C10                    		cmp	al, 16		; "P"-"@"
 10753 000055CE 7405                    		jz	short INCHKJ
 10754 000055D0 3C03                    		cmp	al, 3		; "C"-"@"
 10755 000055D2 7401                    		jz	short INCHKJ
 10756 000055D4 C3                      		retn
 10757                                  INCHKJ:
 10758 000055D5 E98F00                  		jmp	INCHK
 10759                                  
 10760                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10761                                  
 10762                                  		; 08/09/2022
 10763                                  SPOOLINT:
 10764 000055D8 9C                      		pushf
 10765 000055D9 36F606[0403]FF          		test	byte [ss:IDLEINT], 0FFh
 10766 000055DF 7414                    		jz	short POPFRET
 10767 000055E1 36F606[CE02]FF          		test	byte [ss:ERRORMODE], 0FFh
 10768 000055E7 750C                    		jnz	short POPFRET
 10769 000055E9 36FF36[0403]            		push	word [ss:IDLEINT]
 10770 000055EE CD28                    		int	28h		; DOS 2+ internal - KEYBOARD BUSY LOOP
 10771 000055F0 368F06[0403]            		pop	word [ss:IDLEINT]
 10772                                  POPFRET:
 10773 000055F5 9D                      		popf
 10774                                  _RET18:
 10775 000055F6 C3                      		retn
 10776                                  
 10777                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10778                                  
 10779                                  		; 08/09/2022
 10780                                  STATCHK:
 10781 000055F7 E863FF                  		call	DSKSTATCHK
 10782 000055FA 53                      		push	bx
 10783 000055FB 31DB                    		xor	bx, bx
 10784 000055FD E8D7E9                  		call	GET_IO_SFT
 10785 00005600 5B                      		pop	bx
 10786 00005601 72F3                    		jb	short _RET18
 10787 00005603 B401                    		mov	ah, 1
 10788 00005605 E852F6                  		call	IOFUNC
 10789 00005608 74CE                    		jz	short SPOOLINT
 10790 0000560A 3C13                    		cmp	al, 19		; S'-'@'
 10791 0000560C 75BE                    		jnz	short NOSTOP
 10792 0000560E 30E4                    		xor	ah, ah
 10793 00005610 E847F6                  		call	IOFUNC
 10794 00005613 EB4B                    		jmp	short PAUSOSTRT
 10795                                  
 10796                                  ; ---------------------------------------------------------------------------
 10797                                  
 10798                                  		; 08/09/2022
 10799                                  PRINTON_OFF:
 10800 00005615 36F616[AC02]            		not	byte [ss:PFLAG]
 10801 0000561A 53                      		push	bx
 10802 0000561B BB0400                  		mov	bx, 4
 10803 0000561E E8B6E9                  		call	GET_IO_SFT
 10804 00005621 5B                      		pop	bx
 10805 00005622 72D2                    		jb	short _RET18
 10806 00005624 06                      		push	es
 10807 00005625 57                      		push	di
 10808 00005626 1E                      		push	ds
 10809 00005627 07                      		pop	es
 10810 00005628 89F7                    		mov	di, si
 10811 0000562A 26F745050008            		test	word [es:di+5], 800h
 10812 00005630 7418                    		jz	short NORM_PR
 10813 00005632 50                      		push	ax
 10814 00005633 B82611                  		mov	ax, 1126h
 10815 00005636 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - ???
 10816                                  					; Return: CF set on error, AX =	error code
 10817                                  					; STACK	unchanged
 10818 00005638 58                      		pop	ax
 10819 00005639 730F                    		jnb	short NORM_PR
 10820 0000563B 36C606[AC02]00          		mov	byte [ss:PFLAG], 0
 10821 00005641 50                      		push	ax
 10822 00005642 B82411                  		mov	ax, 1124h
 10823 00005645 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - ???
 10824                                  					; ES:DI	-> SFT,	SS = DOS CS
 10825 00005647 58                      		pop	ax
 10826 00005648 EB10                    		jmp	short RETP6
 10827                                  NORM_PR:
 10828 0000564A 36803E[AC02]00          		cmp	byte [ss:PFLAG], 0
 10829 00005650 7505                    		jnz	short PRNOPN
 10830 00005652 E833F7                  		call	DEV_CLOSE_SFT
 10831 00005655 EB03                    		jmp	short RETP6
 10832                                  PRNOPN:	
 10833 00005657 E827F7                  		call	DEV_OPEN_SFT
 10834                                  RETP6:
 10835 0000565A 5F                      		pop	di
 10836 0000565B 07                      		pop	es
 10837                                  STATCHK_RETN:
 10838 0000565C C3                      		retn
 10839                                  ; ---------------------------------------------------------------------------
 10840                                  
 10841                                  		; 08/09/2022
 10842                                  PAUSOLP:
 10843 0000565D E878FF                  		call	SPOOLINT
 10844                                  
 10845                                  PAUSOSTRT:
 10846 00005660 B401                    		mov	ah, 1
 10847 00005662 E8F5F5                  		call	IOFUNC
 10848 00005665 74F6                    		jz	short PAUSOLP
 10849                                  INCHK:
 10850 00005667 53                      		push	bx
 10851 00005668 31DB                    		xor	bx, bx
 10852 0000566A E86AE9                  		call	GET_IO_SFT
 10853 0000566D 5B                      		pop	bx
 10854 0000566E 72EC                    		jb	short STATCHK_RETN
 10855 00005670 30E4                    		xor	ah, ah
 10856 00005672 E8E5F5                  		call	IOFUNC
 10857 00005675 3C10                    		cmp	al, 16		; 'P'-'@'
 10858 00005677 750E                    		jnz	short NOPRINT
 10859 00005679 36803E[830F]00          		cmp	byte [ss:SCAN_FLAG], 0
 10860 0000567F 7494                    		jz	short PRINTON_OFF
 10861 00005681 36C606[830F]00          		mov	byte [ss:SCAN_FLAG], 0
 10862                                  NOPRINT:
 10863 00005687 3C03                    		cmp	al, 3		; "C"-"@"
 10864 00005689 75D1                    		jnz	short STATCHK_RETN
 10865                                  
 10866                                  ; ---------------------------------------------------------------------------
 10867                                  		
 10868                                  		; 08/09/2022
 10869                                  CNTCHAND:
 10870 0000568B B003                    		mov	al, 3		; ; Display "^C"
 10871 0000568D E88FCC                  		call	BUFOUT
 10872 00005690 E827CB                  		call	CRLF
 10873 00005693 16                      		push	ss
 10874 00005694 1F                      		pop	ds
 10875 00005695 803E[0303]00            		cmp	byte [CONSWAP], 0
 10876 0000569A 7403                    		jz	short NOSWAP
 10877 0000569C E858E6                  		call	SWAPBACK
 10878                                  NOSWAP:
 10879 0000569F FA                      		cli
 10880 000056A0 8E16[2005]              		mov	ss, [User_SS]
 10881 000056A4 8B26[1E05]              		mov	sp, [User_SP]
 10882 000056A8 E8C2BE                  		call	restore_world
 10883 000056AB 2EC606[CF02]00          		mov	byte [cs:INDOS], 0
 10884 000056B1 2EC606[CE02]00          		mov	byte [cs:ERRORMODE], 0
 10885 000056B7 2E8926[E002]            		mov	[cs:ConC_Spsave], sp
 10886 000056BC F8                      		clc
 10887 000056BD CD23                    		int	23h		; DOS -	CONTROL	"C" EXIT ADDRESS
 10888                                  					; Return: return via RETF 2 with CF set
 10889                                  					; DOS will abort program with errorlevel 0
 10890                                  					; else
 10891                                  					; interrupted DOS call continues
 10892 000056BF FA                      		cli
 10893 000056C0 2EA3[E602]              		mov	word [cs:USER_IN_AX], ax
 10894 000056C4 9C                      		pushf
 10895 000056C5 58                      		pop	ax
 10896 000056C6 2E3B26[E002]            		cmp	sp, [cs:ConC_Spsave]
 10897 000056CB 7507                    		jnz	short ctrlc_try_new
 10898                                  ctrlc_repeat:
 10899 000056CD 2EA1[E602]              		mov	ax, word [cs:USER_IN_AX]
 10900                                  
 10901                                  COMMANDJ:
 10902 000056D1 E98CBD                  		jmp	COMMAND
 10903                                  ctrlc_try_new:
 10904 000056D4 83C402                  		add	sp, 2
 10905 000056D7 A90100                  		test	ax, 1
 10906 000056DA 74F1                    		jz	short ctrlc_repeat
 10907                                  ctrlc_abort:
 10908 000056DC B8004C                  		mov	ax, 4C00h
 10909 000056DF 2EC606[F902]FF          		mov	byte [cs:DidCTRLC], 0FFh
 10910 000056E5 EBEA                    		jmp	short COMMANDJ
 10911                                  
 10912                                  ; ---------------------------------------------------------------------------
 10913                                  
 10914                                  		; 08/09/2022
 10915                                  DIVOV:
 10916 000056E7 BE[7012]                		mov	si, DIVMES ; "\r\nDivide overflow\r\n"
 10917 000056EA 2E8B1E[8312]            		mov	bx, [cs:DivMesLen]
 10918 000056EF 8CC8                    		mov	ax, cs
 10919 000056F1 8ED0                    		mov	ss, ax
 10920 000056F3 BC[0607]                		mov	sp, AUXSTACK
 10921 000056F6 E80200                  		call	RealDivOv
 10922 000056F9 EBE1                    		jmp	short ctrlc_abort
 10923                                  
 10924                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10925                                  
 10926                                  		; 08/09/2022
 10927                                  RealDivOv:
 10928 000056FB 16                      		push	ss
 10929 000056FC 07                      		pop	es
 10930 000056FD 16                      		push	ss
 10931 000056FE 1F                      		pop	ds
 10932 000056FF C606[3C03]08            		mov	byte [DSKSTCOM], 8
 10933 00005704 C606[3A03]16            		mov	byte [DSKSTCALL], 16h
 10934 00005709 C706[3D03]0000          		mov	word [DSKSTST], 0
 10935 0000570F 891E[4C03]              		mov	word [DSKSTCNT], bx
 10936 00005713 BB[3A03]                		mov	bx, DSKSTCALL
 10937 00005716 8936[4803]              		mov	word [DEVIOBUF_PTR], si
 10938 0000571A C536[3200]              		lds	si, [BCON]
 10939 0000571E E8E1F6                  		call	DEVIOCALL2
 10940 00005721 2EC706[4803][5E03]      		mov	word [cs:DEVIOBUF_PTR], DEVIOBUF
 10941 00005728 2EC706[4C03]0100        		mov	word [cs:DSKSTCNT], 1
 10942 0000572F C3                      		retn
 10943                                  
 10944                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10945                                  
 10946                                  		; 08/09/2022
 10947                                  CHARHARD:
 10948 00005730 80CC38                  		or	ah, 38h
 10949 00005733 368826[F702]            		mov	[ss:ALLOWED], ah
 10950 00005738 368C06[1C05]            		mov	word [ss:EXITHOLD+2], es
 10951 0000573D 36892E[1A05]            		mov	word [ss:EXITHOLD], bp
 10952 00005742 56                      		push	si
 10953 00005743 81E7FF00                		and	di, 0FFh
 10954 00005747 8CDD                    		mov	bp, ds
 10955 00005749 E86400                  		call	FATALC
 10956 0000574C 5E                      		pop	si
 10957 0000574D C3                      		retn
 10958                                  
 10959                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 10960                                  
 10961                                  		; 08/09/2022
 10962                                  HARDERR:
 10963 0000574E 97                      		xchg	ax, di
 10964 0000574F 81E7FF00                		and	di, 0FFh
 10965 00005753 83FF00                  		cmp	di, 0
 10966 00005756 750A                    		jnz	short NOSETWRPERR
 10967 00005758 50                      		push	ax
 10968 00005759 268A4600                		mov	al, [es:bp+0]
 10969 0000575D 36A2[D002]              		mov	[ss:WPERR], al
 10970 00005761 58                      		pop	ax
 10971                                  NOSETWRPERR:
 10972 00005762 29C8                    		sub	ax, cx
 10973 00005764 01C2                    		add	dx, ax
 10974 00005766 52                      		push	dx
 10975 00005767 26F76602                		mul	word [es:bp+2]
 10976 0000576B 5A                      		pop	dx
 10977 0000576C 01C3                    		add	bx, ax
 10978 0000576E 30E4                    		xor	ah, ah
 10979 00005770 263B5606                		cmp	dx, [es:bp+6]
 10980 00005774 721A                    		jb	short ERRINT
 10981 00005776 FEC4                    		inc	ah
 10982 00005778 263B5610                		cmp	dx, [es:bp+10h]
 10983 0000577C 7308                    		jnb	short TESTDIR
 10984 0000577E 26C7461EFFFF            		mov	word [es:bp+1Eh], -1
 10985 00005784 EB0A                    		jmp	short ERRINT
 10986                                  TESTDIR:
 10987 00005786 FEC4                    		inc	ah
 10988 00005788 263B560B                		cmp	dx, [es:bp+0Bh]
 10989 0000578C 7202                    		jb	short ERRINT
 10990 0000578E FEC4                    		inc	ah
 10991                                  ERRINT:
 10992 00005790 D0E4                    		shl	ah, 1
 10993 00005792 360A26[1005]            		or	ah, byte [ss:SECCLUSPOS+2]
 10994 00005797 360A26[F702]            		or	ah, [ss:ALLOWED]
 10995                                  
 10996                                  ; ---------------------------------------------------------------------------
 10997                                  
 10998                                  		; 08/09/2022
 10999                                  FATAL:
 11000 0000579C 268A4600                		mov	al, [es:bp+0]
 11001                                  FATAL1:
 11002 000057A0 368C06[1C05]            		mov	word [ss:EXITHOLD+2], es
 11003 000057A5 36892E[1A05]            		mov	word [ss:EXITHOLD], bp
 11004 000057AA 26C47612                		les	si, [es:bp+12h]
 11005 000057AE 8CC5                    		mov	bp, es
 11006                                  FATALC:
 11007 000057B0 E86501                  		call	SET_I24_EXTENDED_ERROR
 11008 000057B3 83FF0C                  		cmp	di, 0Ch
 11009 000057B6 7603                    		jbe	short NET_I24_ENTRY
 11010 000057B8 BF0C00                  		mov	di, 0Ch
 11011                                  NET_I24_ENTRY:
 11012 000057BB 36803E[CE02]00          		cmp	byte [ss:ERRORMODE], 0
 11013 000057C1 7405                    		jz	short NoSetFail
 11014 000057C3 B003                    		mov	al, 3
 11015 000057C5 EB52                    		jmp	short FailRet
 11016                                  
 11017 000057C7 90                      		nop
 11018                                  NoSetFail:
 11019 000057C8 368926[2205]            		mov	[ss:CONTSTK], sp
 11020 000057CD 16                      		push	ss
 11021 000057CE 07                      		pop	es
 11022 000057CF 36833E[4205]FF          		cmp	word [ss:SFN], -1
 11023 000057D5 740C                    		jz	short _NoFree
 11024 000057D7 1E                      		push	ds
 11025 000057D8 56                      		push	si
 11026 000057D9 36C536[4605]            		lds	si, [ss:PJFN]
 11027 000057DE C604FF                  		mov	byte [si], 0FFh
 11028 000057E1 5E                      		pop	si
 11029 000057E2 1F                      		pop	ds
 11030                                  _NoFree:
 11031 000057E3 FA                      		cli
 11032 000057E4 36FE06[CE02]            		inc	byte [ss:ERRORMODE]
 11033 000057E9 36FE0E[CF02]            		dec	byte [ss:INDOS]
 11034 000057EE 368E16[2005]            		mov	ss, [ss:User_SS]
 11035 000057F3 268B26[1E05]            		mov	sp, [es:User_SP]
 11036 000057F8 CD24                    		int	24h		; DOS -	FATAL ERROR HANDLER ADDRESS
 11037                                  					; Automatically	called upon detection of unrecoverable I/O error.
 11038 000057FA 268926[1E05]            		mov	[es:User_SP], sp
 11039 000057FF 268C16[2005]            		mov	[es:User_SS], ss
 11040 00005804 8CC5                    		mov	bp, es
 11041 00005806 8ED5                    		mov	ss, bp
 11042 00005808 368B26[2205]            		mov	sp, [ss:CONTSTK]
 11043 0000580D 36FE06[CF02]            		inc	byte [ss:INDOS]
 11044 00005812 36C606[CE02]00          		mov	byte [ss:ERRORMODE], 0
 11045 00005818 FB                      		sti
 11046                                  FailRet:
 11047 00005819 36C42E[1A05]            		les	bp, [ss:EXITHOLD]
 11048 0000581E 3C01                    		cmp	al, 1
 11049 00005820 7236                    		jb	short CheckIgnore
 11050 00005822 743E                    		jz	short CheckRetry
 11051 00005824 3C03                    		cmp	al, 3
 11052 00005826 7544                    		jnz	short DoAbort
 11053 00005828 36F606[F702]08          		test	byte [ss:ALLOWED], 8
 11054 0000582E 743C                    		jz	short DoAbort
 11055                                  DoFail:
 11056 00005830 B003                    		mov	al, 3
 11057 00005832 36FE06[F602]            		inc	byte [ss:FAILERR]
 11058                                  CleanUp:
 11059 00005837 36C606[D002]FF          		mov	byte [ss:WPERR], -1
 11060 0000583D 36833E[4205]FF          		cmp	word [ss:SFN], -1
 11061 00005843 7501                    		jnz	short CleanUp2
 11062 00005845 C3                      		retn
 11063                                  CleanUp2:
 11064 00005846 1E                      		push	ds
 11065 00005847 56                      		push	si
 11066 00005848 50                      		push	ax
 11067 00005849 36A1[4205]              		mov	ax, [ss:SFN]
 11068 0000584D 36C536[4605]            		lds	si, [ss:PJFN]
 11069 00005852 8804                    		mov	[si], al
 11070 00005854 58                      		pop	ax
 11071 00005855 5E                      		pop	si
 11072 00005856 1F                      		pop	ds
 11073 00005857 C3                      		retn
 11074                                  CheckIgnore:
 11075 00005858 36F606[F702]20          		test	byte [ss:ALLOWED], 20h
 11076 0000585E 74D0                    		jz	short DoFail
 11077 00005860 EBD5                    		jmp	short CleanUp
 11078                                  CheckRetry:
 11079 00005862 36F606[F702]10          		test	byte [ss:ALLOWED], 10h
 11080 00005868 74C6                    		jz	short DoFail
 11081 0000586A EBCB                    		jmp	short CleanUp
 11082                                  DoAbort:
 11083 0000586C 16                      		push	ss
 11084 0000586D 1F                      		pop	ds
 11085 0000586E 803E[0303]00            		cmp	byte [CONSWAP], 0
 11086 00005873 7403                    		jz	short NOSWAP2
 11087 00005875 E87FE4                  		call	SWAPBACK
 11088                                  NOSWAP2:
 11089 00005878 F606[0503]FF            		test	byte [fAborting], 0FFh
 11090 0000587D 75B1                    		jnz	short DoFail
 11091 0000587F C606[1705]02            		mov	byte [cMeta+2], 2
 11092 00005884 30C0                    		xor	al, al
 11093 00005886 E9020B                  		jmp	exit_inner
 11094                                  
 11095                                  ; ---------------------------------------------------------------------------
 11096                                  
 11097                                  		; 08/09/2022
 11098                                  reset_environment:
 11099 00005889 1E                      		push	ds
 11100 0000588A B482                    		mov	ah, 82h
 11101 0000588C CD2A                    		int	2Ah		; Microsoft Networks - END DOS CRITICAL	SECTIONS 0 THROUGH 7
 11102 0000588E 36C606[0503]FF          		mov	byte [ss:fAborting], -1
 11103 00005894 B82211                  		mov	ax, 1122h
 11104 00005897 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - PROCESS TERMINATION HOOK
 11105                                  					; SS = DOS CS
 11106 00005899 B022                    		mov	al, 22h
 11107 0000589B E8C0C2                  		call	_$GET_INTERRUPT_VECTOR
 11108 0000589E 59                      		pop	cx
 11109 0000589F 06                      		push	es
 11110 000058A0 53                      		push	bx
 11111 000058A1 368B1E[DE02]            		mov	bx, [ss:CurrentPDB]
 11112 000058A6 8EDB                    		mov	ds, bx
 11113 000058A8 A1[1600]                		mov	ax, [OEM_HANDLER+2]
 11114 000058AB 39D8                    		cmp	ax, bx
 11115 000058AD 7418                    		jz	short reset_return
 11116 000058AF 39CB                    		cmp	bx, cx
 11117 000058B1 7514                    		jnz	short reset_return
 11118 000058B3 50                      		push	ax
 11119 000058B4 36803E[1705]03          		cmp	byte [ss:cMeta+2], 3
 11120 000058BA 7406                    		jz	short reset_to_parent
 11121 000058BC E8030B                  		call	arena_free_process
 11122 000058BF E8A0E0                  		call	DOS_ABORT
 11123                                  reset_to_parent:
 11124 000058C2 368F06[DE02]            		pop	word [ss:CurrentPDB]
 11125                                  reset_return:
 11126 000058C7 0E                      		push	cs
 11127 000058C8 1F                      		pop	ds
 11128 000058C9 B0FF                    		mov	al, -1
 11129 000058CB E867C6                  		call	EcritDisk
 11130 000058CE E86C05                  		call	FLUSHBUF
 11131 000058D1 E869C6                  		call	LcritDisk
 11132 000058D4 E8C4F8                  		call	CHECK_VIRT_OPEN
 11133 000058D7 FA                      		cli
 11134 000058D8 C606[CF02]00            		mov	byte [INDOS], 0
 11135 000058DD C606[D002]FF            		mov	byte [WPERR], -1
 11136 000058E2 C606[0503]00            		mov	byte [fAborting], 0
 11137 000058E7 8F06[1A05]              		pop	word [EXITHOLD]
 11138 000058EB 8F06[1C05]              		pop	word [EXITHOLD+2]
 11139 000058EF 8E1E[DE02]              		mov	ds, [CurrentPDB]
 11140 000058F3 8E16[3000]              		mov	ss, word [BCLOCK+2]
 11141 000058F7 8B26[2E00]              		mov	sp, word [BCLOCK]
 11142 000058FB E86FBC                  		call	restore_world
 11143 000058FE 2EA3[1E05]              		mov	[cs:User_SP], ax
 11144 00005902 58                      		pop	ax
 11145 00005903 58                      		pop	ax
 11146 00005904 58                      		pop	ax
 11147 00005905 B802F2                  		mov	ax, 0F202h
 11148 00005908 50                      		push	ax
 11149 00005909 2EFF36[1C05]            		push	word [cs:EXITHOLD+2]
 11150 0000590E 2EFF36[1A05]            		push	word [cs:EXITHOLD]
 11151 00005913 2EA1[1E05]              		mov	ax, [cs:User_SP]
 11152 00005917 CF                      		iret
 11153                                  
 11154                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11155                                  
 11156                                  		; 08/09/2022
 11157                                  SET_I24_EXTENDED_ERROR:
 11158 00005918 50                      		push	ax
 11159 00005919 B8[FE0D]                		mov	ax, MAXCALL
 11160 0000591C 2D[EE0D]                		sub	ax, ErrMap24
 11161 0000591F 39C7                    		cmp	di, ax
 11162 00005921 89F8                    		mov	ax, di
 11163 00005923 7307                    		jnb	short NoTrans
 11164 00005925 2E8A85[EE0D]            		mov	al, [cs:di+ErrMap24]
 11165 0000592A 30E4                    		xor	ah, ah
 11166                                  NoTrans:
 11167 0000592C 2EA3[D202]              		mov	[cs:EXTERR], ax
 11168 00005930 58                      		pop	ax
 11169 00005931 56                      		push	si
 11170 00005932 BE[9E0D]                		mov	si, ERR_TABLE_24
 11171 00005935 E878BD                  		call	CAL_LK
 11172 00005938 5E                      		pop	si
 11173 00005939 C3                      		retn
 11174                                  
 11175                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11176                                  
 11177                                  		; 08/09/2022
 11178                                  IsEOF:
 11179 0000593A 26817E0DF60F            		cmp	word [es:bp+0Dh], 0FF6h
 11180 00005940 730B                    		jnb	short EOF16
 11181 00005942 81FBF00F                		cmp	bx, 0FF0h
 11182 00005946 7404                    		jz	short IsEOF_other
 11183 00005948 81FBF80F                		cmp	bx, 0FF8h
 11184                                  IsEOF_other:
 11185 0000594C C3                      		retn
 11186                                  EOF16:
 11187 0000594D 83FBF8                  		cmp	bx, 0FFF8h
 11188 00005950 C3                      		retn
 11189                                  
 11190                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11191                                  
 11192                                  		; 08/09/2022
 11193                                  UNPACK:
 11194 00005951 263B5E0D                		cmp	bx, [es:bp+0Dh]
 11195 00005955 7726                    		ja	short HURTFAT
 11196 00005957 E8BA00                  		call	MAPCLUSTER
 11197 0000595A 721E                    		jb	short _DoContext
 11198 0000595C 8B3D                    		mov	di, [di]
 11199 0000595E 750E                    		jnz	short High12
 11200 00005960 268B760D                		mov	si, [es:bp+0Dh]
 11201 00005964 81FEF60F                		cmp	si, 0FF6h
 11202 00005968 720C                    		jb	short Unpack12
 11203 0000596A 09FF                    		or	di, di
 11204 0000596C EB0C                    		jmp	short _DoContext
 11205                                  High12:
 11206 0000596E D1EF                    		shr	di, 1
 11207 00005970 D1EF                    		shr	di, 1
 11208 00005972 D1EF                    		shr	di, 1
 11209 00005974 D1EF                    		shr	di, 1
 11210                                  Unpack12:
 11211 00005976 81E7FF0F                		and	di, 0FFFh
 11212                                  _DoContext:
 11213 0000597A 16                      		push	ss
 11214 0000597B 1F                      		pop	ds
 11215 0000597C C3                      		retn
 11216                                  HURTFAT:
 11217 0000597D 26C7461EFFFF            		mov	word [es:bp+1Eh], 0FFFFh
 11218 00005983 50                      		push	ax
 11219 00005984 B488                    		mov	ah, 88h
 11220 00005986 36C606[F702]08          		mov	byte [ss:ALLOWED], 8
 11221 0000598C BFFF0F                  		mov	di, 0FFFh
 11222 0000598F E80AFE                  		call	FATAL
 11223 00005992 3C03                    		cmp	al, 3
 11224 00005994 F8                      		clc
 11225 00005995 7501                    		jnz	short OKU_RET
 11226 00005997 F9                      		stc
 11227                                  OKU_RET:
 11228 00005998 58                      		pop	ax
 11229                                  hurtfat_retn:
 11230 00005999 C3                      		retn
 11231                                  
 11232                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11233                                  
 11234                                  		; 08/09/2022
 11235                                  PACK:
 11236 0000599A E87700                  		call	MAPCLUSTER
 11237 0000599D 72DB                    		jb	short _DoContext
 11238 0000599F 8B35                    		mov	si, [di]
 11239 000059A1 740C                    		jz	short ALIGNED
 11240 000059A3 51                      		push	cx
 11241 000059A4 B104                    		mov	cl, 4
 11242 000059A6 D3E2                    		shl	dx, cl
 11243 000059A8 59                      		pop	cx
 11244                                  		;and	si, 0Fh
 11245                                  		; 09/09/2022 - Temporary !
 11246 000059A9 81E60F00                		db	81h, 0E6h, 0Fh, 0
 11247 000059AD EB14                    		jmp	short PACKIN
 11248                                  ALIGNED:
 11249 000059AF 26817E0DF60F            		cmp	word [es:bp+0Dh], 0FF6h
 11250 000059B5 730A                    		jnb	short Pack16
 11251 000059B7 81E600F0                		and	si, 0F000h
 11252 000059BB 81E2FF0F                		and	dx, 0FFFh
 11253 000059BF EB02                    		jmp	short PACKIN
 11254                                  Pack16:
 11255 000059C1 31F6                    		xor	si, si
 11256                                  PACKIN:
 11257 000059C3 09D6                    		or	si, dx
 11258 000059C5 8935                    		mov	[di], si
 11259 000059C7 36C536[7405]            		lds	si, [ss:CURBUF]
 11260 000059CC 804C0540                		or	byte [si+5], 40h
 11261 000059D0 36803E[1305]00          		cmp	byte [ss:THISDRV+2], 0
 11262 000059D6 16                      		push	ss
 11263 000059D7 1F                      		pop	ds
 11264 000059D8 74BF                    		jz	short hurtfat_retn
 11265 000059DA 50                      		push	ax
 11266 000059DB 53                      		push	bx
 11267 000059DC 51                      		push	cx
 11268 000059DD A1[2805]                		mov	ax, [CLUSSAVE]
 11269 000059E0 8E1E[7605]              		mov	ds, word [CURBUF+2]
 11270 000059E4 83C610                  		add	si, 16
 11271 000059E7 8824                    		mov	[si], ah
 11272 000059E9 16                      		push	ss
 11273 000059EA 1F                      		pop	ds
 11274 000059EB 50                      		push	ax
 11275 000059EC 8B16[2A05]              		mov	dx, [CLUSSEC]
 11276 000059F0 BE0100                  		mov	si, 1
 11277 000059F3 30C0                    		xor	al, al
 11278 000059F5 E89C03                  		call	GETBUFFRB
 11279 000059F8 58                      		pop	ax
 11280 000059F9 7213                    		jb	short POPP_RET
 11281 000059FB C53E[7405]              		lds	di, [CURBUF]
 11282 000059FF 804D0540                		or	byte [di+5], 40h
 11283 00005A03 83C710                  		add	di, 10h
 11284 00005A06 4F                      		dec	di
 11285 00005A07 26037E02                		add	di, [es:bp+2]
 11286 00005A0B 8805                    		mov	[di], al
 11287 00005A0D F8                      		clc
 11288                                  POPP_RET:
 11289 00005A0E 16                      		push	ss
 11290 00005A0F 1F                      		pop	ds
 11291 00005A10 59                      		pop	cx
 11292 00005A11 5B                      		pop	bx
 11293 00005A12 58                      		pop	ax
 11294 00005A13 C3                      		retn
 11295                                  
 11296                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11297                                  
 11298                                  		; 08/09/2022
 11299                                  MAPCLUSTER:
 11300 00005A14 C606[1305]00            		mov	byte [THISDRV+2], 0
 11301 00005A19 50                      		push	ax
 11302 00005A1A 53                      		push	bx
 11303 00005A1B 51                      		push	cx
 11304 00005A1C 52                      		push	dx
 11305 00005A1D 89D8                    		mov	ax, bx
 11306 00005A1F B9F60F                  		mov	cx, 0FF6h
 11307 00005A22 26394E0D                		cmp	[es:bp+0Dh], cx
 11308 00005A26 7302                    		jnb	short Map16
 11309 00005A28 D1E8                    		shr	ax, 1
 11310                                  Map16:
 11311 00005A2A 01D8                    		add	ax, bx
 11312 00005A2C 268B4E02                		mov	cx, [es:bp+2]
 11313 00005A30 81F90002                		cmp	cx, 512
 11314 00005A34 7572                    		jnz	short _DoDiv
 11315 00005A36 89C2                    		mov	dx, ax
 11316 00005A38 81E2FF01                		and	dx, 511
 11317 00005A3C 88E0                    		mov	al, ah
 11318 00005A3E D0E8                    		shr	al, 1
 11319 00005A40 98                      		cbw
 11320                                  DivDone:
 11321 00005A41 26034606                		add	ax, [es:bp+6]
 11322 00005A45 49                      		dec	cx
 11323 00005A46 50                      		push	ax
 11324 00005A47 52                      		push	dx
 11325 00005A48 51                      		push	cx
 11326 00005A49 89C2                    		mov	dx, ax
 11327 00005A4B 30C0                    		xor	al, al
 11328 00005A4D BE0100                  		mov	si, 1
 11329 00005A50 E84103                  		call	GETBUFFRB
 11330 00005A53 59                      		pop	cx
 11331 00005A54 58                      		pop	ax
 11332 00005A55 5A                      		pop	dx
 11333 00005A56 724B                    		jb	short MAP_POP
 11334 00005A58 C536[7405]              		lds	si, [CURBUF]
 11335 00005A5C 8D7C10                  		lea	di, [si+16]
 11336 00005A5F 01C7                    		add	di, ax
 11337 00005A61 39C8                    		cmp	ax, cx
 11338 00005A63 752B                    		jnz	short MAPRET
 11339 00005A65 8A05                    		mov	al, [di]
 11340 00005A67 16                      		push	ss
 11341 00005A68 1F                      		pop	ds
 11342 00005A69 FE06[1305]              		inc	byte [THISDRV+2]
 11343 00005A6D A2[2805]                		mov	byte [CLUSSAVE], al
 11344 00005A70 8916[2A05]              		mov	[CLUSSEC], dx
 11345 00005A74 42                      		inc	dx
 11346 00005A75 30C0                    		xor	al, al
 11347 00005A77 BE0100                  		mov	si, 1
 11348 00005A7A E81703                  		call	GETBUFFRB
 11349 00005A7D 7224                    		jb	short MAP_POP
 11350 00005A7F C536[7405]              		lds	si, [CURBUF]
 11351 00005A83 8D7C10                  		lea	di, [si+16]
 11352 00005A86 8A05                    		mov	al, [di]
 11353 00005A88 16                      		push	ss
 11354 00005A89 1F                      		pop	ds
 11355 00005A8A A2[2905]                		mov	byte [CLUSSAVE+1], al
 11356 00005A8D BF[2805]                		mov	di, CLUSSAVE
 11357                                  MAPRET:
 11358 00005A90 5A                      		pop	dx
 11359 00005A91 59                      		pop	cx
 11360 00005A92 5B                      		pop	bx
 11361 00005A93 31C0                    		xor	ax, ax
 11362 00005A95 26817E0DF60F            		cmp	word [es:bp+0Dh], 4086
 11363 00005A9B 7302                    		jnb	short MapSet
 11364 00005A9D 89D8                    		mov	ax, bx
 11365                                  MapSet:
 11366 00005A9F A801                    		test	al, 1
 11367 00005AA1 58                      		pop	ax
 11368 00005AA2 C3                      		retn
 11369                                  MAP_POP:
 11370 00005AA3 5A                      		pop	dx
 11371 00005AA4 59                      		pop	cx
 11372 00005AA5 5B                      		pop	bx
 11373 00005AA6 58                      		pop	ax
 11374 00005AA7 C3                      		retn
 11375                                  _DoDiv:
 11376 00005AA8 31D2                    		xor	dx, dx
 11377 00005AAA F7F1                    		div	cx
 11378 00005AAC EB93                    		jmp	short DivDone
 11379                                  
 11380                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11381                                  
 11382                                  		; 08/09/2022
 11383                                  FATREAD_SFT:
 11384 00005AAE 26C46D07                		les	bp, [es:di+7]
 11385 00005AB2 268A4600                		mov	al, [es:bp+0]
 11386 00005AB6 A2[1105]                		mov	byte [THISDRV], al
 11387 00005AB9 E8A1BB                  		call	GOTDPB
 11388 00005ABC E87900                  		call	FAT_GOT_DPB
 11389                                  fatread_sft_retn:
 11390 00005ABF C3                      		retn
 11391                                  
 11392                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11393                                  
 11394                                  		; 08/09/2022
 11395                                  FatRead_CDS:
 11396 00005AC0 06                      		push	es
 11397 00005AC1 57                      		push	di
 11398 00005AC2 26C46D45                		les	bp, [es:di+45h]
 11399 00005AC6 268A4600                		mov	al, [es:bp+0]
 11400 00005ACA A2[1105]                		mov	byte [THISDRV], al
 11401 00005ACD E88DBB                  		call	GOTDPB
 11402 00005AD0 E86500                  		call	FAT_GOT_DPB
 11403 00005AD3 5F                      		pop	di
 11404 00005AD4 07                      		pop	es
 11405 00005AD5 72E8                    		jb	short fatread_sft_retn
 11406 00005AD7 7538                    		jnz	short NO_CHANGE
 11407 00005AD9 31C0                    		xor	ax, ax
 11408 00005ADB 48                      		dec	ax
 11409 00005ADC 1E                      		push	ds
 11410 00005ADD 8A0E[4700]              		mov	cl, [CDSCOUNT]
 11411 00005AE1 30ED                    		xor	ch, ch
 11412 00005AE3 26C57545                		lds	si, [es:di+45h]
 11413 00005AE7 36C43E[3C00]            		les	di, [ss:CDSAddr]
 11414                                  frcd20:
 11415 00005AEC 26F745430080            		test	word [es:di+43h], 8000h
 11416 00005AF2 7517                    		jnz	short frcd25
 11417 00005AF4 06                      		push	es
 11418 00005AF5 57                      		push	di
 11419 00005AF6 26C47D45                		les	di, [es:di+45h]
 11420 00005AFA E88602                  		call	POINTCOMP
 11421 00005AFD 5F                      		pop	di
 11422 00005AFE 07                      		pop	es
 11423 00005AFF 750A                    		jnz	short frcd25
 11424 00005B01 26854549                		test	[es:di+49h], ax
 11425 00005B05 7404                    		jz	short frcd25
 11426 00005B07 26894549                		mov	[es:di+49h], ax
 11427                                  frcd25:
 11428 00005B0B 83C751                  		add	di, 81
 11429 00005B0E E2DC                    		loop	frcd20
 11430 00005B10 1F                      		pop	ds
 11431                                  NO_CHANGE:
 11432 00005B11 C42E[2405]              		les	bp, [THISDPB]
 11433 00005B15 F8                      		clc
 11434 00005B16 C3                      		retn
 11435                                  
 11436                                  ; ---------------------------------------------------------------------------
 11437                                  
 11438                                  		; 08/09/2022
 11439                                  FATERR:
 11440 00005B17 26C7461EFFFF            		mov	word [es:bp+1Eh], -1
 11441 00005B1D 81E7FF00                		and	di, 0FFh
 11442 00005B21 C606[F702]18            		mov	byte [ALLOWED], 18h
 11443 00005B26 B41A                    		mov	ah, 1Ah
 11444 00005B28 A0[1105]                		mov	al, byte [THISDRV]
 11445 00005B2B E872FC                  		call	FATAL1
 11446 00005B2E C42E[2405]              		les	bp, [THISDPB]
 11447 00005B32 3C03                    		cmp	al, 3
 11448 00005B34 7502                    		jnz	short FAT_GOT_DPB
 11449 00005B36 F9                      		stc
 11450 00005B37 C3                      		retn
 11451                                  
 11452                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11453                                  
 11454                                  		; 08/09/2022
 11455                                  FAT_GOT_DPB:
 11456 00005B38 16                      		push	ss
 11457 00005B39 1F                      		pop	ds
 11458 00005B3A B00F                    		mov	al, 0Fh
 11459 00005B3C 268A6601                		mov	ah, [es:bp+1]
 11460 00005B40 A3[0603]                		mov	word [DEVCALL], ax
 11461 00005B43 C606[0803]01            		mov	byte [DEVCALL_REQFUNC], 1
 11462 00005B48 C706[0903]0000          		mov	word [DEVCALL_REQSTAT], 0
 11463 00005B4E 268A4616                		mov	al, [es:bp+16h]
 11464 00005B52 A2[1303]                		mov	[CALLMED], al
 11465 00005B55 06                      		push	es
 11466 00005B56 1E                      		push	ds
 11467 00005B57 BB[0603]                		mov	bx, DEVCALL
 11468 00005B5A 26C57612                		lds	si, [es:bp+12h]
 11469 00005B5E 07                      		pop	es
 11470 00005B5F E8A0F2                  		call	DEVIOCALL2
 11471 00005B62 16                      		push	ss
 11472 00005B63 1F                      		pop	ds
 11473 00005B64 07                      		pop	es
 11474 00005B65 8B3E[0903]              		mov	di, word [DEVCALL_REQSTAT]
 11475 00005B69 F7C70080                		test	di, 8000h
 11476 00005B6D 75A8                    		jnz	short FATERR
 11477 00005B6F 30E4                    		xor	ah, ah
 11478 00005B71 26866617                		xchg	ah, [es:bp+17h]
 11479 00005B75 A0[1105]                		mov	al, byte [THISDRV]
 11480 00005B78 3806[070A]              		cmp	[VOLCHNG_FLAG], al
 11481 00005B7C 7508                    		jnz	short CHECK_BYT
 11482 00005B7E C606[070A]FF            		mov	byte [VOLCHNG_FLAG], -1
 11483 00005B83 E98D00                  		jmp	GOGETBPB
 11484                                  CHECK_BYT:
 11485 00005B86 0A26[1403]              		or	ah, [CALLXAD]
 11486 00005B8A 7903                    		jns	short CHECK_ZR
 11487 00005B8C EB5E                    		jmp	short NEWDSK
 11488                                  
 11489 00005B8E 90                      		nop
 11490                                  CHECK_ZR:
 11491 00005B8F 743D                    		jz	short CHKBUFFDIRT
 11492 00005B91 F8                      		clc
 11493 00005B92 C3                      		retn
 11494                                  
 11495                                  ; ---------------------------------------------------------------------------
 11496                                  
 11497                                  		; 08/09/2022
 11498                                  DISK_CHNG_ERR:
 11499 00005B93 06                      		push	es
 11500 00005B94 55                      		push	bp
 11501 00005B95 26C46E12                		les	bp, [es:bp+12h]
 11502 00005B99 26F746040008            		test	word [es:bp+4], 800h
 11503 00005B9F 5D                      		pop	bp
 11504 00005BA0 07                      		pop	es
 11505 00005BA1 7426                    		jz	short FAIL_OPJ2
 11506 00005BA3 1E                      		push	ds
 11507 00005BA4 57                      		push	di
 11508 00005BA5 16                      		push	ss
 11509 00005BA6 1F                      		pop	ds
 11510 00005BA7 C606[F702]18            		mov	byte [ALLOWED], 18h
 11511 00005BAC 06                      		push	es
 11512 00005BAD C43E[1503]              		les	di, [CALLVIDM]
 11513 00005BB1 8C06[D802]              		mov	[EXTERRPT+2], es
 11514 00005BB5 07                      		pop	es
 11515 00005BB6 893E[D602]              		mov	[EXTERRPT], di
 11516 00005BBA B80F00                  		mov	ax, 0Fh
 11517 00005BBD C606[1005]01            		mov	byte [SECCLUSPOS+2], 1
 11518 00005BC2 E889FB                  		call	HARDERR
 11519 00005BC5 5F                      		pop	di
 11520 00005BC6 1F                      		pop	ds
 11521 00005BC7 3C03                    		cmp	al, 3
 11522                                  FAIL_OPJ2:
 11523 00005BC9 7416                    		jz	short FAIL_OP
 11524 00005BCB E96AFF                  		jmp	FAT_GOT_DPB
 11525                                  
 11526                                  ; ---------------------------------------------------------------------------
 11527                                  
 11528                                  		; 08/09/2022
 11529                                  CHKBUFFDIRT:
 11530 00005BCE C53E[3800]              		lds	di, [BUFFHEAD]
 11531                                  
 11532                                  nbuffer:
 11533 00005BD2 3A4504                  		cmp	al, [di+4]
 11534 00005BD5 750E                    		jnz	short lfnxt
 11535 00005BD7 F6450540                		test	byte [di+5], 40h
 11536 00005BDB 7408                    		jz	short lfnxt
 11537 00005BDD 16                      		push	ss
 11538 00005BDE 1F                      		pop	ds
 11539 00005BDF F8                      		clc
 11540 00005BE0 C3                      		retn
 11541                                  
 11542                                  ; ---------------------------------------------------------------------------
 11543                                  
 11544                                  		; 08/09/2022
 11545                                  FAIL_OP:
 11546 00005BE1 16                      		push	ss
 11547 00005BE2 1F                      		pop	ds
 11548 00005BE3 F9                      		stc
 11549 00005BE4 C3                      		retn
 11550                                  ; ---------------------------------------------------------------------------
 11551                                  
 11552                                  		; 08/09/2022
 11553                                  lfnxt:
 11554 00005BE5 C53D                    		lds	di, [di]
 11555 00005BE7 83FFFF                  		cmp	di, -1
 11556 00005BEA 75E6                    		jnz	short nbuffer
 11557                                  NEWDSK:
 11558 00005BEC 26C7461EFFFF            		mov	word [es:bp+1Eh], 0FFFFh
 11559 00005BF2 E8B900                  		call	SETVISIT
 11560                                  nxbuffer:
 11561 00005BF5 804D0520                		or	byte [di+5], 20h
 11562 00005BF9 3A4504                  		cmp	al, [di+4]
 11563 00005BFC 7510                    		jnz	short lfnxt2
 11564 00005BFE F6450540                		test	byte [di+5], 40h
 11565 00005C02 7402                    		jz	short lfnxt1
 11566 00005C04 EB8D                    		jmp	short DISK_CHNG_ERR
 11567                                  lfnxt1:
 11568 00005C06 C74504FF20              		mov	word [di+4], 20FFh
 11569 00005C0B E8CD00                  		call	SCANPLACE
 11570                                  lfnxt2:
 11571 00005C0E E8B600                  		call	SKIPVISIT
 11572 00005C11 75E2                    		jnz	short nxbuffer
 11573                                  GOGETBPB:
 11574 00005C13 26C57E12                		lds	di, [es:bp+12h]
 11575 00005C17 F745040020              		test	word [di+4], 2000h
 11576 00005C1C 7510                    		jnz	short GETFREEBUF
 11577 00005C1E 16                      		push	ss
 11578 00005C1F 1F                      		pop	ds
 11579 00005C20 BB0200                  		mov	bx, 2
 11580 00005C23 E82BFD                  		call	UNPACK
 11581                                  FAIL_OPJ:
 11582 00005C26 72B9                    		jb	short FAIL_OP
 11583 00005C28 C53E[7405]              		lds	di, [CURBUF]
 11584 00005C2C EB0E                    		jmp	short GOTGETBUF
 11585                                  
 11586                                  ; ---------------------------------------------------------------------------
 11587                                  
 11588                                  		; 08/09/2022
 11589                                  GETFREEBUF:
 11590 00005C2E 06                      		push	es
 11591 00005C2F 55                      		push	bp
 11592 00005C30 36C53E[3800]            		lds	di, [ss:BUFFHEAD]
 11593 00005C35 E85B02                  		call	BUFWRITE
 11594 00005C38 5D                      		pop	bp
 11595 00005C39 07                      		pop	es
 11596 00005C3A 72EA                    		jb	short FAIL_OPJ
 11597                                  GOTGETBUF:
 11598 00005C3C 83C710                  		add	di, 16
 11599 00005C3F 368C1E[1603]            		mov	[ss:CALLXAD+2], ds
 11600 00005C44 16                      		push	ss
 11601 00005C45 1F                      		pop	ds
 11602 00005C46 893E[1403]              		mov	word [CALLXAD], di
 11603 00005C4A B016                    		mov	al, 16h
 11604 00005C4C 268A6601                		mov	ah, [es:bp+1]
 11605 00005C50 A3[0603]                		mov	word [DEVCALL], ax
 11606 00005C53 C606[0803]02            		mov	byte [DEVCALL_REQFUNC], 2
 11607 00005C58 C706[0903]0000          		mov	word [DEVCALL_REQSTAT], 0
 11608 00005C5E 268A4616                		mov	al, [es:bp+16h]
 11609 00005C62 A2[1303]                		mov	[CALLMED], al
 11610 00005C65 06                      		push	es
 11611 00005C66 1E                      		push	ds
 11612 00005C67 26FF7614                		push	word [es:bp+14h]
 11613 00005C6B 26FF7612                		push	word [es:bp+12h]
 11614 00005C6F BB[0603]                		mov	bx, DEVCALL
 11615 00005C72 5E                      		pop	si
 11616 00005C73 1F                      		pop	ds
 11617 00005C74 07                      		pop	es
 11618 00005C75 E88AF1                  		call	DEVIOCALL2
 11619 00005C78 07                      		pop	es
 11620 00005C79 16                      		push	ss
 11621 00005C7A 1F                      		pop	ds
 11622 00005C7B 8B3E[0903]              		mov	di, word [DEVCALL_REQSTAT]
 11623 00005C7F F7C70080                		test	di, 8000h
 11624 00005C83 7526                    		jnz	short FATERRJ
 11625 00005C85 268A4616                		mov	al, [es:bp+16h]
 11626 00005C89 C536[1803]              		lds	si, [CALLSCNT]
 11627 00005C8D 26C7461C0000            		mov	word [es:bp+1Ch], 0
 11628 00005C93 E8F4BF                  		call	_$SETDPB
 11629 00005C96 36C53E[1403]            		lds	di, [ss:CALLXAD]
 11630 00005C9B 268A4608                		mov	al, [es:bp+8]
 11631 00005C9F 268A660F                		mov	ah, [es:bp+0Fh]
 11632 00005CA3 8945F8                  		mov	[di-8],	ax
 11633 00005CA6 16                      		push	ss
 11634 00005CA7 1F                      		pop	ds
 11635 00005CA8 30C0                    		xor	al, al
 11636 00005CAA C3                      		retn
 11637                                  ; ---------------------------------------------------------------------------
 11638                                  
 11639                                  		; 08/09/2022
 11640                                  FATERRJ:
 11641 00005CAB E969FE                  		jmp	FATERR
 11642                                  
 11643                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11644                                  
 11645                                  		; 08/09/2022
 11646                                  
 11647                                  SETVISIT:
 11648 00005CAE 36C53E[3800]            		lds	di, [ss:BUFFHEAD]
 11649 00005CB3 50                      		push	ax
 11650 00005CB4 B0DF                    		mov	al, 0DFh
 11651                                  SETLOOP:
 11652 00005CB6 204505                  		and	[di+5],	al
 11653 00005CB9 C53D                    		lds	di, [di]
 11654 00005CBB 83FFFF                  		cmp	di, -1
 11655 00005CBE 75F6                    		jnz	short SETLOOP
 11656 00005CC0 58                      		pop	ax
 11657 00005CC1 36C53E[3800]            		lds	di, [ss:BUFFHEAD]
 11658                                  SVISIT_RETN:
 11659 00005CC6 C3                      		retn
 11660                                  
 11661                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11662                                  
 11663                                  		; 08/09/2022
 11664                                  SKIPVISIT:
 11665 00005CC7 83FFFF                  		cmp	di, -1
 11666 00005CCA 74FA                    		jz	short SVISIT_RETN
 11667 00005CCC F6450520                		test	byte [di+5], 20h
 11668 00005CD0 7505                    		jnz	short SKIPLOOP
 11669 00005CD2 50                      		push	ax
 11670 00005CD3 0C01                    		or	al, 1
 11671 00005CD5 58                      		pop	ax
 11672 00005CD6 C3                      		retn
 11673                                  SKIPLOOP:
 11674 00005CD7 C53D                    		lds	di, [di]
 11675 00005CD9 EBEC                    		jmp	short SKIPVISIT
 11676                                  
 11677                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11678                                  
 11679                                  		; 08/09/2022
 11680                                  SCANPLACE:
 11681 00005CDB 06                      		push	es
 11682 00005CDC C435                    		les	si, [di]
 11683 00005CDE E80600                  		call	PLACEBUF
 11684 00005CE1 06                      		push	es
 11685 00005CE2 1F                      		pop	ds
 11686 00005CE3 89F7                    		mov	di, si
 11687 00005CE5 07                      		pop	es
 11688                                  scanplace_retn:
 11689 00005CE6 C3                      		retn
 11690                                  
 11691                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11692                                  
 11693                                  		; 08/09/2022
 11694                                  PLACEBUF:
 11695 00005CE7 E896B8                  		call	save_world
 11696 00005CEA C40D                    		les	cx, [di]
 11697 00005CEC 83F9FF                  		cmp	cx, -1
 11698 00005CEF 744B                    		jz	short NRET
 11699 00005CF1 8CC5                    		mov	bp, es
 11700 00005CF3 1E                      		push	ds
 11701 00005CF4 07                      		pop	es
 11702 00005CF5 36C536[3800]            		lds	si, [ss:BUFFHEAD]
 11703 00005CFA E88600                  		call	POINTCOMP
 11704 00005CFD 750C                    		jnz	short BUFLOOP
 11705 00005CFF 36890E[3800]            		mov	word [ss:BUFFHEAD], cx
 11706 00005D04 36892E[3A00]            		mov	word [ss:BUFFHEAD+2], bp
 11707 00005D09 EB14                    		jmp	short LOOKEND
 11708                                  BUFLOOP:
 11709 00005D0B 8CD8                    		mov	ax, ds
 11710 00005D0D 89F3                    		mov	bx, si
 11711 00005D0F C534                    		lds	si, [si]
 11712 00005D11 E86F00                  		call	POINTCOMP
 11713 00005D14 75F5                    		jnz	short BUFLOOP
 11714 00005D16 8ED8                    		mov	ds, ax
 11715 00005D18 89DE                    		mov	si, bx
 11716 00005D1A 890C                    		mov	[si], cx
 11717 00005D1C 896C02                  		mov	[si+2],	bp
 11718                                  LOOKEND:
 11719 00005D1F 8CD8                    		mov	ax, ds
 11720 00005D21 89F3                    		mov	bx, si
 11721 00005D23 C534                    		lds	si, [si]
 11722 00005D25 83FEFF                  		cmp	si, -1
 11723 00005D28 75F5                    		jnz	short LOOKEND
 11724 00005D2A 8ED8                    		mov	ds, ax
 11725 00005D2C 893F                    		mov	[bx], di
 11726 00005D2E 8C4702                  		mov	word [bx+2], es
 11727 00005D31 26C705FFFF              		mov	word [es:di], -1
 11728 00005D36 26C74502FFFF            		mov	word [es:di+2], -1
 11729                                  NRET:
 11730 00005D3C E82EB8                  		call	restore_world
 11731 00005D3F 807D04FF                		cmp	byte [di+4], -1
 11732 00005D43 75A1                    		jnz	short scanplace_retn
 11733 00005D45 E80100                  		call	PLACEHEAD
 11734 00005D48 C3                      		retn
 11735                                  
 11736                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11737                                  
 11738                                  		; 08/09/2022
 11739                                  PLACEHEAD:
 11740 00005D49 E834B8                  		call	save_world
 11741 00005D4C 1E                      		push	ds
 11742 00005D4D 07                      		pop	es
 11743 00005D4E 36C536[3800]            		lds	si, [ss:BUFFHEAD]
 11744 00005D53 E82D00                  		call	POINTCOMP
 11745 00005D56 7427                    		jz	short GOTHEEND2
 11746 00005D58 268935                  		mov	[es:di], si
 11747 00005D5B 268C5D02                		mov	word [es:di+2], ds
 11748 00005D5F 36893E[3800]            		mov	word [ss:BUFFHEAD], di
 11749 00005D64 368C06[3A00]            		mov	word [ss:BUFFHEAD+2], es
 11750                                  LOOKEND2:
 11751 00005D69 8CD8                    		mov	ax, ds
 11752 00005D6B 89F3                    		mov	bx, si
 11753 00005D6D C534                    		lds	si, [si]
 11754 00005D6F E81100                  		call	POINTCOMP
 11755 00005D72 75F5                    		jnz	short LOOKEND2
 11756 00005D74 8ED8                    		mov	ds, ax
 11757 00005D76 C707FFFF                		mov	word [bx], 0FFFFh
 11758 00005D7A C74702FFFF              		mov	word [bx+2], 0FFFFh
 11759                                  GOTHEEND2:
 11760 00005D7F E8EBB7                  		call	restore_world
 11761                                  placehead_retn:
 11762 00005D82 C3                      		retn
 11763                                  
 11764                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11765                                  
 11766                                  		; 08/09/2022
 11767                                  POINTCOMP:
 11768 00005D83 39FE                    		cmp	si, di
 11769 00005D85 75FB                    		jnz	short placehead_retn
 11770 00005D87 51                      		push	cx
 11771 00005D88 52                      		push	dx
 11772 00005D89 8CD9                    		mov	cx, ds
 11773 00005D8B 8CC2                    		mov	dx, es
 11774 00005D8D 39D1                    		cmp	cx, dx
 11775 00005D8F 5A                      		pop	dx
 11776 00005D90 59                      		pop	cx
 11777 00005D91 C3                      		retn
 11778                                  
 11779                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11780                                  
 11781                                  		; 08/09/2022
 11782                                  GETBUFFR:
 11783 00005D92 31F6                    		xor	si, si
 11784                                  
 11785                                  ; ---------------------------------------------------------------------------
 11786                                  
 11787                                  		; 08/09/2022
 11788                                  GETBUFFRB:
 11789 00005D94 A3[2C05]                		mov	[PREREAD], ax
 11790 00005D97 268A4600                		mov	al, [es:bp+0]
 11791 00005D9B C53E[1E00]              		lds	di, [LastBuffer]
 11792 00005D9F 83FFFF                  		cmp	di, -1
 11793 00005DA2 740C                    		jz	short getb5
 11794 00005DA4 3B5506                  		cmp	dx, [di+6]
 11795 00005DA7 7507                    		jnz	short getb5
 11796 00005DA9 3A4504                  		cmp	al, [di+4]
 11797 00005DAC 7502                    		jnz	short getb5
 11798 00005DAE EB75                    		jmp	short getb35
 11799                                  getb5:
 11800 00005DB0 36C53E[3800]            		lds	di, [ss:BUFFHEAD]
 11801                                  getb10:
 11802 00005DB5 3B5506                  		cmp	dx, [di+6]
 11803 00005DB8 7505                    		jnz	short getb12
 11804 00005DBA 3A4504                  		cmp	al, [di+4]
 11805 00005DBD 7451                    		jz	short getb25
 11806                                  getb12:
 11807 00005DBF C53D                    		lds	di, [di]
 11808 00005DC1 83FFFF                  		cmp	di, -1
 11809 00005DC4 75EF                    		jnz	short getb10
 11810 00005DC6 36C53E[3800]            		lds	di, [ss:BUFFHEAD]
 11811 00005DCB 56                      		push	si
 11812 00005DCC 52                      		push	dx
 11813 00005DCD 55                      		push	bp
 11814 00005DCE 06                      		push	es
 11815 00005DCF E8C100                  		call	BUFWRITE
 11816 00005DD2 07                      		pop	es
 11817 00005DD3 5D                      		pop	bp
 11818 00005DD4 5A                      		pop	dx
 11819 00005DD5 5E                      		pop	si
 11820 00005DD6 7262                    		jb	short getbx
 11821 00005DD8 30E4                    		xor	ah, ah
 11822 00005DDA 36F606[2C05]FF          		test	byte [ss:PREREAD], 0FFh
 11823 00005DE0 751E                    		jnz	short getb20
 11824 00005DE2 8D5D10                  		lea	bx, [di+16]
 11825 00005DE5 B90100                  		mov	cx, 1
 11826 00005DE8 56                      		push	si
 11827 00005DE9 57                      		push	di
 11828 00005DEA 52                      		push	dx
 11829 00005DEB 09F6                    		or	si, si
 11830 00005DED 7407                    		jz	short getb15
 11831 00005DEF E871E2                  		call	FATSECRD
 11832 00005DF2 B402                    		mov	ah, 2
 11833 00005DF4 EB05                    		jmp	short getb17
 11834                                  getb15:
 11835 00005DF6 E891E2                  		call	DREAD
 11836 00005DF9 B400                    		mov	ah, 0
 11837                                  getb17:
 11838 00005DFB 5A                      		pop	dx
 11839 00005DFC 5F                      		pop	di
 11840 00005DFD 5E                      		pop	si
 11841 00005DFE 723A                    		jb	short getbx
 11842                                  getb20:
 11843 00005E00 895506                  		mov	[di+6],	dx
 11844 00005E03 896D0A                  		mov	[di+0Ah], bp
 11845 00005E06 8C450C                  		mov	word [di+0Ch], es
 11846 00005E09 268A4600                		mov	al, [es:bp+0]
 11847 00005E0D 894504                  		mov	[di+4],	ax
 11848                                  getb25:
 11849 00005E10 B80100                  		mov	ax, 1
 11850 00005E13 09F6                    		or	si, si
 11851 00005E15 7408                    		jz	short getb30
 11852 00005E17 268A4608                		mov	al, [es:bp+8]
 11853 00005E1B 268A660F                		mov	ah, [es:bp+0Fh]
 11854                                  getb30:
 11855 00005E1F 894508                  		mov	[di+8],	ax
 11856 00005E22 E8C2FE                  		call	PLACEBUF
 11857                                  getb35:
 11858 00005E25 368C1E[7605]            		mov	word [ss:CURBUF+2], ds
 11859 00005E2A 368C1E[2000]            		mov	word [ss:LastBuffer+2], ds
 11860 00005E2F 36893E[7405]            		mov	word [ss:CURBUF], di
 11861 00005E34 36893E[1E00]            		mov	word [ss:LastBuffer], di
 11862 00005E39 F8                      		clc
 11863                                  getbx:
 11864 00005E3A 16                      		push	ss
 11865 00005E3B 1F                      		pop	ds
 11866 00005E3C C3                      		retn
 11867                                  
 11868                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11869                                  
 11870                                  		; 08/09/2022
 11871                                  FLUSHBUF:
 11872 00005E3D B4FF                    		mov	ah, -1
 11873 00005E3F C53E[3800]              		lds	di, [BUFFHEAD]
 11874                                  scan_buf_queue:
 11875 00005E43 E82600                  		call	CHECKFLUSH
 11876 00005E46 50                      		push	ax
 11877 00005E47 8A4504                  		mov	al, [di+4]
 11878 00005E4A 363A06[D002]            		cmp	al, [ss:WPERR]
 11879 00005E4F 7414                    		jz	short free_the_buf
 11880                                  dont_free_the_buf:
 11881 00005E51 58                      		pop	ax
 11882 00005E52 C53D                    		lds	di, [di]
 11883 00005E54 83FFFF                  		cmp	di, -1
 11884 00005E57 75EA                    		jnz	short scan_buf_queue
 11885 00005E59 16                      		push	ss
 11886 00005E5A 1F                      		pop	ds
 11887 00005E5B 803E[F602]00            		cmp	byte [FAILERR], 0
 11888 00005E60 7501                    		jnz	short bad_flush
 11889 00005E62 C3                      		retn
 11890                                  bad_flush:
 11891 00005E63 F9                      		stc
 11892                                  flushbuf_retn:
 11893 00005E64 C3                      		retn
 11894                                  free_the_buf:
 11895 00005E65 C74504FF00              		mov	word [di+4], 0FFh
 11896 00005E6A EBE5                    		jmp	short dont_free_the_buf
 11897                                  
 11898                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11899                                  
 11900                                  		; 08/09/2022
 11901                                  CHECKFLUSH:
 11902 00005E6C 386504                  		cmp	[di+4],	ah
 11903 00005E6F 74F3                    		jz	short flushbuf_retn
 11904 00005E71 38C4                    		cmp	ah, al
 11905 00005E73 7406                    		jz	short DOBUFFER
 11906 00005E75 3A4504                  		cmp	al, [di+4]
 11907 00005E78 F8                      		clc
 11908 00005E79 75E9                    		jnz	short flushbuf_retn
 11909                                  DOBUFFER:
 11910 00005E7B F6450540                		test	byte [di+5], 40h
 11911 00005E7F 74E3                    		jz	short flushbuf_retn
 11912 00005E81 50                      		push	ax
 11913 00005E82 FF7504                  		push	word [di+4]
 11914 00005E85 E80B00                  		call	BUFWRITE
 11915 00005E88 58                      		pop	ax
 11916 00005E89 7206                    		jb	short LEAVE_BUF
 11917 00005E8B 80E4BF                  		and	ah, 0BFh
 11918 00005E8E 894504                  		mov	[di+4],	ax
 11919                                  LEAVE_BUF:
 11920 00005E91 58                      		pop	ax
 11921                                  checkflush_retn:
 11922 00005E92 C3                      		retn
 11923                                  
 11924                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 11925                                  
 11926                                  		; 08/09/2022
 11927                                  BUFWRITE:
 11928 00005E93 B8FF00                  		mov	ax, 0FFh
 11929 00005E96 874504                  		xchg	ax, [di+4]
 11930 00005E99 3CFF                    		cmp	al, 0FFh
 11931 00005E9B 74F5                    		jz	short checkflush_retn
 11932 00005E9D F6C440                  		test	ah, 40h
 11933 00005EA0 74F0                    		jz	short checkflush_retn
 11934 00005EA2 363A06[D002]            		cmp	al, [ss:WPERR]
 11935 00005EA7 74E9                    		jz	short checkflush_retn
 11936 00005EA9 C46D0A                  		les	bp, [di+10]
 11937 00005EAC 8D5D10                  		lea	bx, [di+16]
 11938 00005EAF 8B5506                  		mov	dx, [di+6]
 11939 00005EB2 8B4D08                  		mov	cx, [di+8]
 11940 00005EB5 88E8                    		mov	al, ch
 11941 00005EB7 30ED                    		xor	ch, ch
 11942 00005EB9 88EC                    		mov	ah, ch
 11943 00005EBB 36C606[F702]18          		mov	byte [ss:ALLOWED], 18h
 11944 00005EC1 F6450508                		test	byte [di+5], 8
 11945 00005EC5 7406                    		jz	short NO_IGNORE
 11946 00005EC7 36800E[F702]20          		or	byte [ss:ALLOWED], 20h
 11947                                  NO_IGNORE:
 11948 00005ECD 57                      		push	di
 11949 00005ECE 31FF                    		xor	di, di
 11950                                  WRTAGAIN:
 11951 00005ED0 57                      		push	di
 11952 00005ED1 51                      		push	cx
 11953 00005ED2 50                      		push	ax
 11954 00005ED3 B90100                  		mov	cx, 1
 11955 00005ED6 53                      		push	bx
 11956 00005ED7 52                      		push	dx
 11957 00005ED8 1E                      		push	ds
 11958 00005ED9 E8DAE1                  		call	DWRITE
 11959 00005EDC 1F                      		pop	ds
 11960 00005EDD 5A                      		pop	dx
 11961 00005EDE 5B                      		pop	bx
 11962 00005EDF 58                      		pop	ax
 11963 00005EE0 59                      		pop	cx
 11964 00005EE1 5F                      		pop	di
 11965 00005EE2 7201                    		jb	short NOSET
 11966 00005EE4 47                      		inc	di
 11967                                  NOSET:
 11968 00005EE5 01C2                    		add	dx, ax
 11969 00005EE7 E2E7                    		loop	WRTAGAIN
 11970 00005EE9 09FF                    		or	di, di
 11971 00005EEB 7501                    		jnz	short BWROK
 11972 00005EED F9                      		stc
 11973                                  BWROK:
 11974 00005EEE 5F                      		pop	di
 11975 00005EEF C3                      		retn
 11976                                  
 11977                                  ; ---------------------------------------------------------------------------
 11978                                  
 11979                                  		; 08/09/2022
 11980                                  _$WAIT:
 11981 00005EF0 31C0                    		xor	ax, ax
 11982 00005EF2 368706[E202]            		xchg	ax, [ss:exit_code]
 11983 00005EF7 E96CB7                  		jmp	SYS_RET_OK
 11984                                  
 11985                                  ; ---------------------------------------------------------------------------
 11986                                  
 11987                                  		; 09/09/2022
 11988                                  _$EXEC:
 11989 00005EFA 55                      		push	bp
 11990 00005EFB 89E5                    		mov	bp, sp
 11991 00005EFD 83EC1A                  		sub	sp, 26
 11992 00005F00 3C03                    		cmp	al, 3
 11993 00005F02 760E                    		jbe	short Exec_Check_2
 11994                                  Exec_Bad_Fun:
 11995 00005F04 36C606[D102]01          		mov	byte [ss:EXTERR_LOCUS], 1
 11996 00005F0A B001                    		mov	al, 1
 11997                                  Exec_Ret_Err:
 11998 00005F0C 89EC                    		mov	sp, bp
 11999 00005F0E 5D                      		pop	bp
 12000 00005F0F E960B7                  		jmp	SYS_Ret_Err
 12001                                  Exec_Check_2:
 12002 00005F12 3C02                    		cmp	al, 2
 12003 00005F14 74EE                    		jz	short Exec_Bad_Fun
 12004 00005F16 895EFC                  		mov	[bp-4],	bx
 12005 00005F19 8C46FE                  		mov	word [bp-2], es
 12006 00005F1C 8846FB                  		mov	[bp-5],	al
 12007 00005F1F C646FA00                		mov	byte [bp-6], 0
 12008 00005F23 8956E6                  		mov	[bp-26], dx
 12009 00005F26 8C5EE8                  		mov	word [bp-24], ds
 12010 00005F29 89D6                    		mov	si, dx
 12011 00005F2B E812BF                  		call	DStrLen
 12012 00005F2E 894EEA                  		mov	[bp-22], cx
 12013 00005F31 30C0                    		xor	al, al
 12014 00005F33 55                      		push	bp
 12015 00005F34 E8C80F                  		call	_$OPEN
 12016 00005F37 5D                      		pop	bp
 12017 00005F38 72D2                    		jb	short Exec_Ret_Err
 12018 00005F3A 8946F8                  		mov	[bp-8],	ax
 12019 00005F3D 89C3                    		mov	bx, ax
 12020 00005F3F 30C0                    		xor	al, al
 12021 00005F41 E84DCF                  		call	_$IOCTL
 12022 00005F44 7207                    		jb	short Exec_BombJ
 12023 00005F46 F6C280                  		test	dl, 80h
 12024 00005F49 740A                    		jz	short Exec_Check_Environ
 12025 00005F4B B002                    		mov	al, 2
 12026                                  Exec_BombJ:
 12027 00005F4D E9CF00                  		jmp	Exec_Bomb
 12028                                  BadEnv:
 12029 00005F50 B00A                    		mov	al, 0Ah
 12030 00005F52 E9CA00                  		jmp	Exec_Bomb
 12031                                  Exec_Check_Environ:
 12032 00005F55 C746EE0000              		mov	word [bp-18], 0
 12033 00005F5A C746F20000              		mov	word [bp-14], 0
 12034 00005F5F F646FB02                		test	byte [bp-5], 2
 12035 00005F63 7558                    		jnz	short Exec_Read_Header
 12036 00005F65 C576FC                  		lds	si, [bp-4]
 12037 00005F68 8B04                    		mov	ax, [si]
 12038 00005F6A 09C0                    		or	ax, ax
 12039 00005F6C 750F                    		jnz	short exec_scan_env
 12040 00005F6E 368E1E[DE02]            		mov	ds, [ss:CurrentPDB]
 12041 00005F73 A1[2C00]                		mov	ax, word [SFT_ADDR+2]
 12042 00005F76 8946F2                  		mov	[bp-14], ax
 12043 00005F79 09C0                    		or	ax, ax
 12044 00005F7B 7440                    		jz	short Exec_Read_Header
 12045                                  exec_scan_env:
 12046 00005F7D 8EC0                    		mov	es, ax
 12047 00005F7F 31FF                    		xor	di, di
 12048 00005F81 B9FF7F                  		mov	cx, 7FFFh
 12049 00005F84 30C0                    		xor	al, al
 12050                                  Exec_Get_Environ_Len:
 12051 00005F86 F2AE                    		repne scasb
 12052 00005F88 75C6                    		jnz	short BadEnv
 12053 00005F8A 49                      		dec	cx
 12054 00005F8B 72C3                    		jb	short BadEnv
 12055 00005F8D AE                      		scasb
 12056 00005F8E 75F6                    		jnz	short Exec_Get_Environ_Len
 12057 00005F90 57                      		push	di
 12058 00005F91 8D5D11                  		lea	bx, [di+11h]
 12059 00005F94 035EEA                  		add	bx, [bp-22]
 12060 00005F97 B104                    		mov	cl, 4
 12061 00005F99 D3EB                    		shr	bx, cl
 12062 00005F9B 06                      		push	es
 12063 00005F9C E87F04                  		call	_$ALLOC
 12064 00005F9F 1F                      		pop	ds
 12065 00005FA0 59                      		pop	cx
 12066 00005FA1 7303                    		jnb	short Exec_Save_Environ
 12067 00005FA3 EB74                    		jmp	short Exec_No_Mem
 12068                                  
 12069 00005FA5 90                      		nop
 12070                                  Exec_Save_Environ:
 12071 00005FA6 8EC0                    		mov	es, ax
 12072 00005FA8 8946F2                  		mov	[bp-14], ax
 12073 00005FAB 31F6                    		xor	si, si
 12074 00005FAD 89F7                    		mov	di, si
 12075 00005FAF F3A4                    		rep movsb
 12076 00005FB1 B80100                  		mov	ax, 1
 12077 00005FB4 AB                      		stosw
 12078 00005FB5 C576E6                  		lds	si, [bp-26]
 12079 00005FB8 8B4EEA                  		mov	cx, [bp-22]
 12080 00005FBB F3A4                    		rep movsb
 12081                                  Exec_Read_Header:
 12082 00005FBD 16                      		push	ss
 12083 00005FBE 1F                      		pop	ds
 12084 00005FBF B91A00                  		mov	cx, 26
 12085 00005FC2 BA[D213]                		mov	dx, exec_signature
 12086 00005FC5 06                      		push	es
 12087 00005FC6 1E                      		push	ds
 12088 00005FC7 E82A03                  		call	ExecRead
 12089 00005FCA 1F                      		pop	ds
 12090 00005FCB 07                      		pop	es
 12091 00005FCC 724F                    		jb	short Exec_Bad_File
 12092 00005FCE 09C0                    		or	ax, ax
 12093 00005FD0 744B                    		jz	short Exec_Bad_File
 12094 00005FD2 83F81A                  		cmp	ax, 26
 12095 00005FD5 7519                    		jnz	short Exec_Com_Filej
 12096 00005FD7 F706[DE13]FFFF          		test	word [exec_max_BSS], 0FFFFh
 12097 00005FDD 7504                    		jnz	short Exec_Check_Sig
 12098 00005FDF C646FAFF                		mov	byte [bp-6], 0FFh
 12099                                  Exec_Check_Sig:
 12100 00005FE3 A1[D213]                		mov	ax, [exec_signature]
 12101 00005FE6 3D4D5A                  		cmp	ax, 5A4Dh  ; 'MZ'
 12102 00005FE9 7408                    		jz	short Exec_Save_Start
 12103 00005FEB 3D5A4D                  		cmp	ax, 4D5Ah  ; 'ZM'
 12104 00005FEE 7403                    		jz	short Exec_Save_Start
 12105                                  Exec_Com_Filej:
 12106 00005FF0 E96501                  		jmp	Exec_Com_file
 12107                                  Exec_Save_Start:
 12108 00005FF3 A1[D613]                		mov	ax, [exec_pages]
 12109 00005FF6 B105                    		mov	cl, 5
 12110 00005FF8 D3E0                    		shl	ax, cl
 12111 00005FFA 2B06[DA13]              		sub	ax, [exec_par_dir]
 12112 00005FFE 8946F4                  		mov	[bp-12], ax
 12113 00006001 F646FB02                		test	byte [bp-5], 2
 12114 00006005 742B                    		jz	short exec_allocate
 12115 00006007 C47EFC                  		les	di, [bp-4]
 12116 0000600A 268B05                  		mov	ax, [es:di]
 12117 0000600D 8946EC                  		mov	[bp-20], ax
 12118 00006010 268B4502                		mov	ax, [es:di+2]
 12119 00006014 8946F6                  		mov	[bp-10], ax
 12120 00006017 EB76                    		jmp	short Exec_Find_Res
 12121                                  Exec_No_Mem:
 12122 00006019 B008                    		mov	al, 8
 12123 0000601B EB02                    		jmp	short Exec_Bomb
 12124                                  
 12125                                  ; ---------------------------------------------------------------------------
 12126                                  
 12127                                  		; 09/09/2022
 12128                                  Exec_Bad_File:
 12129 0000601D B00B                    		mov	al, 0Bh
 12130                                  Exec_Bomb:
 12131 0000601F 8B5EF8                  		mov	bx, [bp-8]
 12132 00006022 E8DE02                  		call	Exec_Dealloc
 12133 00006025 E815BF                  		call	LcritDisk
 12134 00006028 50                      		push	ax
 12135 00006029 55                      		push	bp
 12136 0000602A E86C0C                  		call	_$CLOSE
 12137 0000602D 5D                      		pop	bp
 12138 0000602E 58                      		pop	ax
 12139 0000602F E9DAFE                  		jmp	Exec_Ret_Err
 12140                                  exec_allocate:
 12141 00006032 50                      		push	ax
 12142 00006033 BBFFFF                  		mov	bx, 0FFFFh
 12143 00006036 1E                      		push	ds
 12144 00006037 E8E403                  		call	_$ALLOC
 12145 0000603A 1F                      		pop	ds
 12146 0000603B 58                      		pop	ax
 12147 0000603C 83C010                  		add	ax, 10h
 12148 0000603F 83FB11                  		cmp	bx, 11h
 12149 00006042 72D5                    		jb	short Exec_No_Mem
 12150 00006044 39D8                    		cmp	ax, bx
 12151 00006046 77D1                    		ja	short Exec_No_Mem
 12152 00006048 F646FAFF                		test	byte [bp-6], 0FFh
 12153 0000604C 7518                    		jnz	short Exec_BX_Max
 12154 0000604E 0306[DC13]              		add	ax, [exec_min_BSS]
 12155 00006052 72C5                    		jb	short Exec_No_Mem
 12156 00006054 39D8                    		cmp	ax, bx
 12157 00006056 77C1                    		ja	short Exec_No_Mem
 12158 00006058 2B06[DC13]              		sub	ax, [exec_min_BSS]
 12159 0000605C 0306[DE13]              		add	ax, [exec_max_BSS]
 12160 00006060 7204                    		jb	short Exec_BX_Max
 12161 00006062 39D8                    		cmp	ax, bx
 12162 00006064 7602                    		jbe	short Exec_Got_Block
 12163                                  Exec_BX_Max:
 12164 00006066 89D8                    		mov	ax, bx
 12165                                  Exec_Got_Block:
 12166 00006068 1E                      		push	ds
 12167 00006069 89C3                    		mov	bx, ax
 12168 0000606B 895EF0                  		mov	[bp-16], bx
 12169 0000606E E8AD03                  		call	_$ALLOC
 12170 00006071 1F                      		pop	ds
 12171 00006072 72A5                    		jb	short Exec_No_Mem
 12172 00006074 8946EE                  		mov	[bp-18], ax
 12173 00006077 83C010                  		add	ax, 10h
 12174 0000607A F646FAFF                		test	byte [bp-6], 0FFh
 12175 0000607E 7409                    		jz	short Exec_Use_Ax
 12176 00006080 0346F0                  		add	ax, [bp-16]
 12177 00006083 2B46F4                  		sub	ax, [bp-12]
 12178 00006086 83E810                  		sub	ax, 10h
 12179                                  Exec_Use_Ax:
 12180 00006089 8946F6                  		mov	[bp-10], ax
 12181 0000608C 8946EC                  		mov	[bp-20], ax
 12182                                  Exec_Find_Res:
 12183 0000608F 8B16[DA13]              		mov	dx, [exec_par_dir]
 12184 00006093 52                      		push	dx
 12185 00006094 B104                    		mov	cl, 4
 12186 00006096 D3E2                    		shl	dx, cl
 12187 00006098 58                      		pop	ax
 12188 00006099 B10C                    		mov	cl, 12
 12189 0000609B D3E8                    		shr	ax, cl
 12190 0000609D 89C1                    		mov	cx, ax
 12191 0000609F 8B5EF8                  		mov	bx, [bp-8]
 12192 000060A2 1E                      		push	ds
 12193 000060A3 30C0                    		xor	al, al
 12194 000060A5 E85C0D                  		call	_$LSEEK
 12195 000060A8 1F                      		pop	ds
 12196 000060A9 7303                    		jnb	short exec_big_read
 12197 000060AB E971FF                  		jmp	Exec_Bomb
 12198                                  exec_big_read:
 12199 000060AE 8B5EF4                  		mov	bx, [bp-12]
 12200 000060B1 81FB0010                		cmp	bx, 1000h
 12201 000060B5 7203                    		jb	short Exec_Read_OK
 12202 000060B7 BBE00F                  		mov	bx, 0FE0h
 12203                                  Exec_Read_OK:
 12204 000060BA 295EF4                  		sub	[bp-12], bx
 12205 000060BD 53                      		push	bx
 12206 000060BE B104                    		mov	cl, 4
 12207 000060C0 D3E3                    		shl	bx, cl
 12208 000060C2 89D9                    		mov	cx, bx
 12209 000060C4 1E                      		push	ds
 12210 000060C5 8E5EEC                  		mov	ds, word [bp-20]
 12211 000060C8 31D2                    		xor	dx, dx
 12212 000060CA 51                      		push	cx
 12213 000060CB E82602                  		call	ExecRead
 12214 000060CE 59                      		pop	cx
 12215 000060CF 1F                      		pop	ds
 12216 000060D0 7248                    		jb	short Exec_Bad_FileJ
 12217 000060D2 39C1                    		cmp	cx, ax
 12218 000060D4 5B                      		pop	bx
 12219 000060D5 7408                    		jz	short ExecCheckEnd
 12220 000060D7 29C1                    		sub	cx, ax
 12221 000060D9 81F90002                		cmp	cx, 512
 12222 000060DD 733B                    		jnb	short Exec_Bad_FileJ
 12223                                  ExecCheckEnd:
 12224 000060DF 015EEC                  		add	[bp-20], bx
 12225 000060E2 F746F4FFFF              		test	word [bp-12], 0FFFFh
 12226 000060E7 75C5                    		jnz	short exec_big_read
 12227 000060E9 8B4EF6                  		mov	cx, [bp-10]
 12228 000060EC A1[E013]                		mov	ax, [exec_SS]
 12229 000060EF 01C8                    		add	ax, cx
 12230 000060F1 A3[CC13]                		mov	[exec_init_ss], ax
 12231 000060F4 A1[E213]                		mov	ax, [exec_SP]
 12232 000060F7 A3[CA13]                		mov	[exec_init_sp], ax
 12233 000060FA C406[E613]              		les	ax, [exec_IP]
 12234 000060FE A3[CE13]                		mov	[exec_init_ip], ax
 12235 00006101 8CC0                    		mov	ax, es
 12236 00006103 01C8                    		add	ax, cx
 12237 00006105 A3[D013]                		mov	[exec_init_cs], ax
 12238 00006108 31C9                    		xor	cx, cx
 12239 0000610A 8B16[EA13]              		mov	dx, [exec_rle_table]
 12240 0000610E 8B5EF8                  		mov	bx, [bp-8]
 12241 00006111 1E                      		push	ds
 12242 00006112 31C0                    		xor	ax, ax
 12243 00006114 E8ED0C                  		call	_$LSEEK
 12244 00006117 1F                      		pop	ds
 12245 00006118 7303                    		jnb	short Exec_Get_Entries
 12246                                  Exec_Bad_FileJ:
 12247 0000611A E900FF                  		jmp	Exec_Bad_File
 12248                                  ; ---------------------------------------------------------------------------
 12249                                  
 12250                                  		; 09/09/2022
 12251                                  Exec_Get_Entries:
 12252 0000611D 8B16[D813]              		mov	dx, [exec_rle_count]
 12253                                  
 12254                                  exec_read_reloc:
 12255 00006121 52                      		push	dx
 12256 00006122 BA[6003]                		mov	dx, OPENBUF
 12257 00006125 B98401                  		mov	cx, 388
 12258 00006128 1E                      		push	ds
 12259 00006129 E8C801                  		call	ExecRead
 12260 0000612C 07                      		pop	es
 12261 0000612D 5A                      		pop	dx
 12262 0000612E 72EA                    		jb	short Exec_Bad_FileJ
 12263 00006130 B96100                  		mov	cx, 97
 12264 00006133 BF[6003]                		mov	di, OPENBUF
 12265 00006136 8B76F6                  		mov	si, [bp-10]
 12266                                  exec_reloc_one:
 12267 00006139 09D2                    		or	dx, dx
 12268 0000613B 7415                    		jz	short Exec_Set_PDBJ
 12269 0000613D 26C51D                  		lds	bx, [es:di]
 12270 00006140 8CD8                    		mov	ax, ds
 12271 00006142 01F0                    		add	ax, si
 12272 00006144 8ED8                    		mov	ds, ax
 12273 00006146 0137                    		add	[bx], si
 12274 00006148 83C704                  		add	di, 4
 12275 0000614B 4A                      		dec	dx
 12276 0000614C E2EB                    		loop	exec_reloc_one
 12277 0000614E 06                      		push	es
 12278 0000614F 1F                      		pop	ds
 12279 00006150 EBCF                    		jmp	short exec_read_reloc
 12280                                  Exec_Set_PDBJ:
 12281 00006152 E98C00                  		jmp	Exec_Set_PDB
 12282                                  Exec_No_Memj:
 12283 00006155 E9C1FE                  		jmp	Exec_No_Mem
 12284                                  
 12285                                  ; ---------------------------------------------------------------------------
 12286                                  
 12287                                  		; 09/09/2022
 12288                                  Exec_Com_file:
 12289 00006158 F646FB02                		test	byte [bp-5], 2
 12290 0000615C 740C                    		jz	short Exec_Alloc_Com_File
 12291 0000615E C576FC                  		lds	si, [bp-4]
 12292 00006161 AD                      		lodsw
 12293 00006162 8946EC                  		mov	[bp-20], ax
 12294 00006165 B8FFFF                  		mov	ax, 0FFFFh
 12295 00006168 EB2C                    		jmp	short Exec_Read_Block
 12296                                  Exec_Alloc_Com_File:
 12297 0000616A BBFFFF                  		mov	bx, 0FFFFh
 12298 0000616D E8AE02                  		call	_$ALLOC
 12299 00006170 09DB                    		or	bx, bx
 12300 00006172 74E1                    		jz	short Exec_No_Memj
 12301 00006174 895EF0                  		mov	[bp-16], bx
 12302 00006177 53                      		push	bx
 12303 00006178 E8A302                  		call	_$ALLOC
 12304 0000617B 5B                      		pop	bx
 12305 0000617C 8946EE                  		mov	[bp-18], ax
 12306 0000617F 83C010                  		add	ax, 10h
 12307 00006182 8946EC                  		mov	[bp-20], ax
 12308 00006185 31C0                    		xor	ax, ax
 12309 00006187 81FB0010                		cmp	bx, 1000h
 12310 0000618B 7306                    		jnb	short Exec_Read_Com
 12311 0000618D 89D8                    		mov	ax, bx
 12312 0000618F B104                    		mov	cl, 4
 12313 00006191 D3E0                    		shl	ax, cl
 12314                                  Exec_Read_Com:
 12315 00006193 2D0001                  		sub	ax, 100h
 12316                                  Exec_Read_Block:
 12317 00006196 50                      		push	ax
 12318 00006197 8B5EF8                  		mov	bx, [bp-8]
 12319 0000619A 31C9                    		xor	cx, cx
 12320 0000619C 89CA                    		mov	dx, cx
 12321 0000619E 31C0                    		xor	ax, ax
 12322 000061A0 E8610C                  		call	_$LSEEK
 12323 000061A3 59                      		pop	cx
 12324 000061A4 8E5EEC                  		mov	ds, word [bp-20]
 12325 000061A7 31D2                    		xor	dx, dx
 12326 000061A9 51                      		push	cx
 12327 000061AA E84701                  		call	ExecRead
 12328 000061AD 5E                      		pop	si
 12329 000061AE 7303                    		jnb	short OkRead
 12330 000061B0 E96AFE                  		jmp	Exec_Bad_File
 12331                                  OkRead:
 12332 000061B3 39F0                    		cmp	ax, si
 12333 000061B5 749E                    		jz	short Exec_No_Memj
 12334 000061B7 F646FB02                		test	byte [bp-5], 2
 12335 000061BB 7524                    		jnz	short Exec_Set_PDB
 12336 000061BD 8B46EC                  		mov	ax, [bp-20]
 12337 000061C0 83E810                  		sub	ax, 10h
 12338 000061C3 36A3[D013]              		mov	[ss:exec_init_cs], ax
 12339 000061C7 36C706[CE13]0001        		mov	word [ss:exec_init_ip], 100h
 12340 000061CE 81C6FE00                		add	si, 0FEh
 12341 000061D2 368936[CA13]            		mov	[ss:exec_init_sp], si
 12342 000061D7 36A3[CC13]              		mov	[ss:exec_init_ss], ax
 12343 000061DB 8ED8                    		mov	ds, ax
 12344 000061DD C7040000                		mov	word [si], 0
 12345                                  Exec_Set_PDB:
 12346 000061E1 8B5EF8                  		mov	bx, [bp-8]
 12347 000061E4 E81C01                  		call	Exec_Dealloc
 12348 000061E7 55                      		push	bp
 12349 000061E8 E8AE0A                  		call	_$CLOSE
 12350 000061EB 5D                      		pop	bp
 12351 000061EC E82001                  		call	Exec_Alloc
 12352 000061EF F646FB02                		test	byte [bp-5], 2
 12353 000061F3 7406                    		jz	short Exec_Build_Header
 12354 000061F5 89EC                    		mov	sp, bp
 12355 000061F7 5D                      		pop	bp
 12356 000061F8 E96BB4                  		jmp	SYS_RET_OK
 12357                                  
 12358                                  ; ---------------------------------------------------------------------------
 12359                                  
 12360                                  		; 09/09/2022
 12361                                  Exec_Build_Header:
 12362 000061FB 8B56EE                  		mov	dx, [bp-18]
 12363 000061FE BE0100                  		mov	si, 1
 12364 00006201 8B46F2                  		mov	ax, [bp-14]
 12365 00006204 09C0                    		or	ax, ax
 12366 00006206 7405                    		jz	short No_Owner
 12367 00006208 48                      		dec	ax
 12368 00006209 8ED8                    		mov	ds, ax
 12369 0000620B 8914                    		mov	[si], dx
 12370                                  No_Owner:
 12371 0000620D 8B46EE                  		mov	ax, [bp-18]
 12372 00006210 48                      		dec	ax
 12373 00006211 8ED8                    		mov	ds, ax
 12374 00006213 8914                    		mov	[si], dx
 12375 00006215 52                      		push	dx
 12376 00006216 8B76F0                  		mov	si, [bp-16]
 12377 00006219 01D6                    		add	si, dx
 12378 0000621B E8D5BA                  		call	_$DUP_PDB
 12379 0000621E 5A                      		pop	dx
 12380 0000621F FF76F2                  		push	word [bp-14]
 12381 00006222 268F06[2C00]            		pop	word [es:SFT_ADDR+2]
 12382 00006227 C576FC                  		lds	si, [bp-4]
 12383 0000622A 1E                      		push	ds
 12384 0000622B 56                      		push	si
 12385 0000622C C57406                  		lds	si, [si+6]
 12386 0000622F B90C00                  		mov	cx, 12
 12387 00006232 51                      		push	cx
 12388 00006233 BF5C00                  		mov	di, 5Ch
 12389 00006236 8A1C                    		mov	bl, [si]
 12390 00006238 F3A4                    		rep movsb
 12391 0000623A 31C0                    		xor	ax, ax
 12392 0000623C AB                      		stosw
 12393 0000623D AB                      		stosw
 12394 0000623E 59                      		pop	cx
 12395 0000623F 5E                      		pop	si
 12396 00006240 1F                      		pop	ds
 12397 00006241 1E                      		push	ds
 12398 00006242 56                      		push	si
 12399 00006243 C5740A                  		lds	si, [si+0Ah]
 12400 00006246 8A3C                    		mov	bh, [si]
 12401 00006248 F3A4                    		rep movsb
 12402 0000624A AB                      		stosw
 12403 0000624B AB                      		stosw
 12404 0000624C 5E                      		pop	si
 12405 0000624D 1F                      		pop	ds
 12406 0000624E C57402                  		lds	si, [si+2]
 12407 00006251 80C980                  		or	cl, 80h
 12408 00006254 89CF                    		mov	di, cx
 12409 00006256 F3A4                    		rep movsb
 12410 00006258 FEC9                    		dec	cl
 12411 0000625A 88F8                    		mov	al, bh
 12412 0000625C 30FF                    		xor	bh, bh
 12413 0000625E E8D705                  		call	GETVISDRV
 12414 00006261 7302                    		jnb	short Exec_BL
 12415 00006263 88CF                    		mov	bh, cl
 12416                                  Exec_BL:
 12417 00006265 88D8                    		mov	al, bl
 12418 00006267 30DB                    		xor	bl, bl
 12419 00006269 E8CC05                  		call	GETVISDRV
 12420 0000626C 7302                    		jnb	short exec_Set_Return
 12421 0000626E 88CB                    		mov	bl, cl
 12422                                  exec_Set_Return:
 12423 00006270 E820B3                  		call	Get_User_Stack
 12424 00006273 FF7414                  		push	word [si+14h]
 12425 00006276 FF7412                  		push	word [si+12h]
 12426 00006279 FF7414                  		push	word [si+14h]
 12427 0000627C FF7412                  		push	word [si+12h]
 12428 0000627F 268F060A00              		pop	word [es:PDB_EXIT]
 12429 00006284 268F060C00              		pop	word [es:PDB_EXIT+2]
 12430 00006289 31C0                    		xor	ax, ax
 12431 0000628B 8ED8                    		mov	ds, ax
 12432 0000628D 8F06[8800]              		pop	word [ShChk]
 12433 00006291 8F06[8A00]              		pop	word [ShChk+2]
 12434 00006295 36C706[DA02]8000        		mov	word [ss:DMAADD], 80h
 12435 0000629C 368E1E[DE02]            		mov	ds, [ss:CurrentPDB]
 12436 000062A1 368C1E[DC02]            		mov	[ss:DMAADD+2], ds
 12437 000062A6 F646FB01                		test	byte [bp-5], 1
 12438 000062AA 7427                    		jz	short exec_go
 12439 000062AC 36C536[CA13]            		lds	si, [ss:exec_init_sp]
 12440 000062B1 C47EFC                  		les	di, [bp-4]
 12441 000062B4 268C5D10                		mov	word [es:di+10h], ds
 12442 000062B8 4E                      		dec	si
 12443 000062B9 4E                      		dec	si
 12444 000062BA 891C                    		mov	[si], bx
 12445 000062BC 2689750E                		mov	[es:di+0Eh], si
 12446 000062C0 36C506[CE13]            		lds	ax, [ss:exec_init_ip]
 12447 000062C5 268C5D14                		mov	word [es:di+14h], ds
 12448 000062C9 26894512                		mov	[es:di+12h], ax
 12449 000062CD 89EC                    		mov	sp, bp
 12450 000062CF 5D                      		pop	bp
 12451 000062D0 E993B3                  		jmp	SYS_RET_OK
 12452                                  
 12453                                  ; ---------------------------------------------------------------------------
 12454                                  
 12455                                  		; 09/09/2022
 12456                                  exec_go:
 12457 000062D3 36C536[CE13]            		lds	si, [ss:exec_init_ip]
 12458 000062D8 36C43E[CA13]            		les	di, [ss:exec_init_sp]
 12459 000062DD 8CC0                    		mov	ax, es
 12460                                  Xfer_To_User:
 12461 000062DF FA                      		cli
 12462 000062E0 36C606[CF02]00          		mov	byte [ss:INDOS], 0
 12463 000062E6 8ED0                    		mov	ss, ax
 12464 000062E8 89FC                    		mov	sp, di
 12465 000062EA FB                      		sti
 12466 000062EB 1E                      		push	ds
 12467 000062EC 56                      		push	si
 12468 000062ED 8EC2                    		mov	es, dx
 12469 000062EF 8EDA                    		mov	ds, dx
 12470 000062F1 89D8                    		mov	ax, bx
 12471 000062F3 CB                      		retf
 12472                                  
 12473                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12474                                  
 12475                                  		; 09/09/2022
 12476                                  ExecRead:
 12477 000062F4 E80C00                  		call	Exec_Dealloc
 12478 000062F7 8B5EF8                  		mov	bx, [bp-8]
 12479 000062FA 55                      		push	bp
 12480 000062FB E8AD0A                  		call	_$READ
 12481 000062FE 5D                      		pop	bp
 12482 000062FF E80D00                  		call	Exec_Alloc
 12483 00006302 C3                      		retn
 12484                                  
 12485                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12486                                  
 12487                                  		; 09/09/2022
 12488                                  Exec_Dealloc:
 12489 00006303 53                      		push	bx
 12490 00006304 BB0000                  		mov	bx, 0
 12491 00006307 E82BBC                  		call	EcritDisk
 12492 0000630A E81000                  		call	ChangeOwners
 12493 0000630D 5B                      		pop	bx
 12494 0000630E C3                      		retn
 12495                                  
 12496                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12497                                  
 12498                                  		; 09/09/2022
 12499                                  Exec_Alloc:
 12500 0000630F 53                      		push	bx
 12501 00006310 2E8B1E[DE02]            		mov	bx, [cs:CurrentPDB]
 12502 00006315 E80500                  		call	ChangeOwners
 12503 00006318 E822BC                  		call	LcritDisk
 12504 0000631B 5B                      		pop	bx
 12505 0000631C C3                      		retn
 12506                                  
 12507                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12508                                  
 12509                                  		; 09/09/2022
 12510                                  ChangeOwners:
 12511 0000631D 9C                      		pushf
 12512 0000631E 50                      		push	ax
 12513 0000631F 8B46F2                  		mov	ax, [bp-14]
 12514 00006322 E80900                  		call	ChangeOwner
 12515 00006325 8B46EE                  		mov	ax, [bp-18]
 12516 00006328 E80300                  		call	ChangeOwner
 12517 0000632B 58                      		pop	ax
 12518 0000632C 9D                      		popf
 12519                                  chgown_retn:
 12520 0000632D C3                      		retn
 12521                                  
 12522                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12523                                  
 12524                                  		; 09/09/2022
 12525                                  ChangeOwner:
 12526 0000632E 09C0                    		or	ax, ax
 12527 00006330 74FB                    		jz	short chgown_retn
 12528 00006332 48                      		dec	ax
 12529 00006333 1E                      		push	ds
 12530 00006334 8ED8                    		mov	ds, ax
 12531 00006336 891E[0100]              		mov	word [START+1], bx
 12532 0000633A 1F                      		pop	ds
 12533 0000633B C3                      		retn
 12534                                  
 12535                                  ; ---------------------------------------------------------------------------
 12536                                  
 12537                                  		; 09/09/2022
 12538                                  _$KEEP_PROCESS:
 12539 0000633C 50                      		push	ax
 12540 0000633D 36C606[1705]03          		mov	byte [ss:cMeta+2], 3
 12541 00006343 368E06[DE02]            		mov	es, [ss:CurrentPDB]
 12542 00006348 83FA06                  		cmp	dx, 6
 12543 0000634B 7303                    		jnb	short Keep_shrink
 12544 0000634D BA0600                  		mov	dx, 6
 12545                                  Keep_shrink:
 12546 00006350 89D3                    		mov	bx, dx
 12547 00006352 53                      		push	bx
 12548 00006353 06                      		push	es
 12549 00006354 E8C001                  		call	_$SETBLOCK
 12550 00006357 1F                      		pop	ds
 12551 00006358 5B                      		pop	bx
 12552 00006359 7207                    		jb	short Keep_Done
 12553 0000635B 8CD8                    		mov	ax, ds
 12554 0000635D 01D8                    		add	ax, bx
 12555 0000635F A3[0200]                		mov	word [START+2], ax
 12556                                  Keep_Done:
 12557 00006362 58                      		pop	ax
 12558 00006363 EB26                    		jmp	short exit_inner
 12559                                  
 12560                                  ; ---------------------------------------------------------------------------
 12561                                  
 12562                                  		; 09/09/2022
 12563                                  STAY_RESIDENT:
 12564 00006365 B80031                  		mov	ax, 3100h
 12565 00006368 83C20F                  		add	dx, 15
 12566 0000636B D1DA                    		rcr	dx, 1
 12567 0000636D B103                    		mov	cl, 3
 12568 0000636F D3EA                    		shr	dx, cl
 12569 00006371 E9ECB0                  		jmp	COMMAND
 12570                                  
 12571                                  ; ---------------------------------------------------------------------------
 12572                                  
 12573                                  		; 09/09/2022
 12574                                  _$EXIT:
 12575 00006374 30E4                    		xor	ah, ah
 12576 00006376 368626[F902]            		xchg	ah, [ss:DidCTRLC]
 12577 0000637B 08E4                    		or	ah, ah
 12578 0000637D 36C606[1705]00          		mov	byte [ss:cMeta+2], 0
 12579 00006383 7406                    		jz	short exit_inner
 12580 00006385 36C606[1705]01          		mov	byte [ss:cMeta+2], 1
 12581                                  exit_inner:
 12582 0000638B E805B2                  		call	Get_User_Stack
 12583 0000638E 36FF36[DE02]            		push	word [ss:CurrentPDB]
 12584 00006393 8F4414                  		pop	word [si+14h]
 12585 00006396 EB08                    		jmp	short abort_inner
 12586                                  
 12587                                  ; ---------------------------------------------------------------------------
 12588                                  
 12589                                  		; 09/09/2022
 12590                                  _$ABORT:
 12591 00006398 30C0                    		xor	al, al
 12592 0000639A 36C606[1705]00          		mov	byte [ss:cMeta+2], 0
 12593                                  abort_inner:
 12594 000063A0 368A26[1705]            		mov	ah, byte [ss:cMeta+2]
 12595 000063A5 36A3[E202]              		mov	[ss:exit_code], ax
 12596 000063A9 E8E7B1                  		call	Get_User_Stack
 12597 000063AC 8E5C14                  		mov	ds, word [si+14h]
 12598 000063AF 31C0                    		xor	ax, ax
 12599 000063B1 8EC0                    		mov	es, ax
 12600 000063B3 BE0A00                  		mov	si, 0Ah
 12601 000063B6 BF8800                  		mov	di, 88h
 12602 000063B9 A5                      		movsw
 12603 000063BA A5                      		movsw
 12604 000063BB A5                      		movsw
 12605 000063BC A5                      		movsw
 12606 000063BD A5                      		movsw
 12607 000063BE A5                      		movsw
 12608 000063BF E9C7F4                  		jmp	reset_environment
 12609                                  
 12610                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12611                                  
 12612                                  		; 09/09/2022
 12613                                  arena_free_process:
 12614 000063C2 BF0000                  		mov	di, 0
 12615 000063C5 36A1[2400]              		mov	ax, [ss:arena_head]
 12616 000063C9 E82000                  		call	check_signature
 12617                                  arena_free_process_loop:
 12618 000063CC 7301                    		jnb	short afp_chksign_ok
 12619                                  afp_retn:
 12620 000063CE C3                      		retn
 12621                                  afp_chksign_ok:
 12622 000063CF 06                      		push	es
 12623 000063D0 1F                      		pop	ds
 12624 000063D1 391E[0100]              		cmp	word [START+1], bx
 12625 000063D5 7504                    		jnz	short arena_free_next
 12626 000063D7 893E[0100]              		mov	word [START+1], di
 12627                                  arena_free_next:
 12628 000063DB 803D5A                  		cmp	byte [di], 5Ah
 12629 000063DE 74EE                    		jz	short afp_retn
 12630 000063E0 E80200                  		call	arena_next
 12631 000063E3 EBE7                    		jmp	short arena_free_process_loop
 12632                                  
 12633                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12634                                  
 12635                                  		; 09/09/2022
 12636                                  arena_next:
 12637 000063E5 8CD8                    		mov	ax, ds
 12638 000063E7 03060300                		add	ax, [ARENA_SIZE]
 12639 000063EB 40                      		inc	ax
 12640                                  check_signature:
 12641 000063EC 8EC0                    		mov	es, ax
 12642 000063EE 26803D4D                		cmp	byte [es:di], 4Dh ; 'M'
 12643 000063F2 74DA                    		jz	short afp_retn
 12644 000063F4 26803D5A                		cmp	byte [es:di], 5Ah ; 'Z'
 12645 000063F8 74D4                    		jz	short afp_retn
 12646 000063FA F9                      		stc
 12647                                  COALESCE_RETN:
 12648 000063FB C3                      		retn
 12649                                  
 12650                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12651                                  
 12652                                  		; 09/09/2022
 12653                                  Coalesce:
 12654 000063FC 803D5A                  		cmp	byte [di], 5Ah
 12655 000063FF 74FA                    		jz	short COALESCE_RETN
 12656 00006401 E8E1FF                  		call	arena_next
 12657 00006404 72F5                    		jb	short COALESCE_RETN
 12658 00006406 26393E[0100]            		cmp	word [es:START+1], di
 12659 0000640B 75EE                    		jnz	short COALESCE_RETN
 12660 0000640D 268B0E0300              		mov	cx, [es:ARENA_SIZE]
 12661 00006412 41                      		inc	cx
 12662 00006413 010E0300                		add	[ARENA_SIZE], cx
 12663 00006417 268A0D                  		mov	cl, [es:di]
 12664 0000641A 880D                    		mov	[di], cl
 12665 0000641C EBDE                    		jmp	short Coalesce
 12666                                  
 12667                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12668                                  
 12669                                  		; 09/09/2022
 12670                                  _$ALLOC:
 12671 0000641E E814BB                  		call	EcritDisk
 12672 00006421 31C0                    		xor	ax, ax
 12673 00006423 89C7                    		mov	di, ax
 12674 00006425 36A3[EC02]              		mov	word [ss:FirstArena], ax
 12675 00006429 36A3[EE02]              		mov	word [ss:BestArena], ax
 12676 0000642D 36A3[F002]              		mov	word [ss:LastArena], ax
 12677 00006431 50                      		push	ax
 12678 00006432 36A1[2400]              		mov	ax, [ss:arena_head]
 12679 00006436 E8B3FF                  		call	check_signature
 12680 00006439 7212                    		jb	short alloc_err
 12681                                  alloc_scan:
 12682 0000643B 06                      		push	es
 12683 0000643C 1F                      		pop	ds
 12684 0000643D 393E[0100]              		cmp	word [START+1], di
 12685 00006441 7429                    		jz	short alloc_free
 12686                                  alloc_next:
 12687 00006443 803D5A                  		cmp	byte [di], 5Ah
 12688 00006446 740E                    		jz	short alloc_end
 12689 00006448 E89AFF                  		call	arena_next
 12690 0000644B 73EE                    		jnb	short alloc_scan
 12691                                  alloc_err:
 12692 0000644D 58                      		pop	ax
 12693                                  alloc_trashed:
 12694 0000644E E8ECBA                  		call	LcritDisk
 12695 00006451 B007                    		mov	al, 7
 12696                                  alloc_errj:
 12697 00006453 E91CB2                  		jmp	SYS_Ret_Err
 12698                                  alloc_end:
 12699 00006456 36833E[EC02]00          		cmp	word [ss:FirstArena], 0
 12700 0000645C 756B                    		jnz	short alloc_do_split
 12701                                  alloc_fail:
 12702 0000645E E832B1                  		call	Get_User_Stack
 12703 00006461 5B                      		pop	bx
 12704 00006462 895C02                  		mov	[si+2],	bx
 12705 00006465 E8D5BA                  		call	LcritDisk
 12706 00006468 B008                    		mov	al, 8
 12707 0000646A EBE7                    		jmp	short alloc_errj
 12708                                  alloc_free:
 12709 0000646C E88DFF                  		call	Coalesce
 12710 0000646F 72DC                    		jb	short alloc_err
 12711 00006471 8B0E0300                		mov	cx, [ARENA_SIZE]
 12712 00006475 5A                      		pop	dx
 12713 00006476 39D1                    		cmp	cx, dx
 12714 00006478 7602                    		jbe	short alloc_test
 12715 0000647A 89CA                    		mov	dx, cx
 12716                                  alloc_test:
 12717 0000647C 52                      		push	dx
 12718 0000647D 39CB                    		cmp	bx, cx
 12719 0000647F 77C2                    		ja	short alloc_next
 12720 00006481 36833E[EC02]00          		cmp	word [ss:FirstArena], 0
 12721 00006487 7505                    		jnz	short alloc_best
 12722 00006489 368C1E[EC02]            		mov	word [ss:FirstArena], ds
 12723                                  
 12724                                  alloc_best:				; CODE XREF: _$ALLOC+69j
 12725 0000648E 36833E[EE02]00          		cmp	word [ss:BestArena], 0
 12726 00006494 740E                    		jz	short alloc_make_best
 12727 00006496 06                      		push	es
 12728 00006497 368E06[EE02]            		mov	es, word [ss:BestArena]
 12729 0000649C 26390E0300              		cmp	[es:ARENA_SIZE], cx
 12730 000064A1 07                      		pop	es
 12731 000064A2 7605                    		jbe	short alloc_last
 12732                                  alloc_make_best:
 12733 000064A4 368C1E[EE02]            		mov	word [ss:BestArena], ds
 12734                                  alloc_last:
 12735 000064A9 368C1E[F002]            		mov	word [ss:LastArena], ds
 12736 000064AE EB93                    		jmp	short alloc_next
 12737                                  alloc_do_split_high:
 12738 000064B0 368E1E[F002]            		mov	ds, word [ss:LastArena]
 12739 000064B5 8B0E0300                		mov	cx, [ARENA_SIZE]
 12740 000064B9 29D9                    		sub	cx, bx
 12741 000064BB 8CDA                    		mov	dx, ds
 12742 000064BD 7445                    		jz	short alloc_set_owner
 12743 000064BF 01CA                    		add	dx, cx
 12744 000064C1 8EC2                    		mov	es, dx
 12745 000064C3 49                      		dec	cx
 12746 000064C4 87D9                    		xchg	bx, cx
 12747 000064C6 EB27                    		jmp	short alloc_set_sizes
 12748                                  
 12749 000064C8 90                      		nop
 12750                                  alloc_do_split:
 12751 000064C9 36803E[B002]01          		cmp	byte [ss:AllocMethod], 1
 12752 000064CF 77DF                    		ja	short alloc_do_split_high
 12753 000064D1 368E1E[EC02]            		mov	ds, word [ss:FirstArena]
 12754 000064D6 7205                    		jb	short alloc_get_size
 12755 000064D8 368E1E[EE02]            		mov	ds, word [ss:BestArena]
 12756                                  alloc_get_size:
 12757 000064DD 8B0E0300                		mov	cx, [ARENA_SIZE]
 12758 000064E1 29D9                    		sub	cx, bx
 12759 000064E3 8CD8                    		mov	ax, ds
 12760 000064E5 89C2                    		mov	dx, ax
 12761 000064E7 741B                    		jz	short alloc_set_owner
 12762 000064E9 01D8                    		add	ax, bx
 12763 000064EB 40                      		inc	ax
 12764 000064EC 8EC0                    		mov	es, ax
 12765 000064EE 49                      		dec	cx
 12766                                  alloc_set_sizes:
 12767 000064EF 891E0300                		mov	[ARENA_SIZE], bx
 12768 000064F3 26890E0300              		mov	[es:ARENA_SIZE], cx
 12769 000064F8 B34D                    		mov	bl, 4Dh
 12770 000064FA 861D                    		xchg	bl, [di]
 12771 000064FC 26881D                  		mov	[es:di], bl
 12772 000064FF 26893E[0100]            		mov	word [es:START+1], di
 12773                                  alloc_set_owner:
 12774 00006504 8EDA                    		mov	ds, dx
 12775 00006506 36A1[DE02]              		mov	ax, [ss:CurrentPDB]
 12776 0000650A A3[0100]                		mov	word [START+1], ax
 12777 0000650D 8CD8                    		mov	ax, ds
 12778 0000650F 40                      		inc	ax
 12779 00006510 5B                      		pop	bx
 12780 00006511 E829BA                  		call	LcritDisk
 12781                                  alloc_ok:
 12782 00006514 E94FB1                  		jmp	SYS_RET_OK
 12783                                  
 12784                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12785                                  
 12786                                  		; 09/09/2022
 12787                                  _$SETBLOCK:
 12788 00006517 E81BBA                  		call	EcritDisk
 12789 0000651A BF0000                  		mov	di, 0
 12790 0000651D 8CC0                    		mov	ax, es
 12791 0000651F 48                      		dec	ax
 12792 00006520 E8C9FE                  		call	check_signature
 12793 00006523 7303                    		jnb	short setblock_grab
 12794                                  setblock_bad:
 12795 00006525 E926FF                  		jmp	alloc_trashed
 12796                                  setblock_grab:
 12797 00006528 8ED8                    		mov	ds, ax
 12798 0000652A E8CFFE                  		call	Coalesce
 12799 0000652D 72F6                    		jb	short setblock_bad
 12800 0000652F 8B0E0300                		mov	cx, [ARENA_SIZE]
 12801 00006533 51                      		push	cx
 12802 00006534 39CB                    		cmp	bx, cx
 12803 00006536 76A5                    		jbe	short alloc_get_size
 12804 00006538 E923FF                  		jmp	alloc_fail
 12805                                  
 12806                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 12807                                  
 12808                                  		; 09/09/2022
 12809                                  _$DEALLOC:
 12810 0000653B E8F7B9                  		call	EcritDisk
 12811 0000653E BF0000                  		mov	di, 0
 12812 00006541 8CC0                    		mov	ax, es
 12813 00006543 48                      		dec	ax
 12814 00006544 E8A5FE                  		call	check_signature
 12815 00006547 720A                    		jb	short dealloc_err
 12816 00006549 26893E[0100]            		mov	word [es:START+1], di
 12817 0000654E E8ECB9                  		call	LcritDisk
 12818                                  dealloc_ok:
 12819 00006551 EBC1                    		jmp	short alloc_ok
 12820                                  dealloc_err:
 12821 00006553 E8E7B9                  		call	LcritDisk
 12822 00006556 B009                    		mov	al, 9
 12823                                  dealloc_errj:
 12824 00006558 E917B1                  		jmp	SYS_Ret_Err
 12825                                  
 12826                                  ; ---------------------------------------------------------------------------
 12827                                  
 12828                                  		; 09/09/2022
 12829                                  _$ALLOCOPER:
 12830 0000655B 3C01                    		cmp	al, 1
 12831 0000655D 720C                    		jb	short AllocOperGet
 12832 0000655F 7412                    		jz	short AllocOperSet
 12833                                  allocoper_err:
 12834 00006561 36C606[D102]05          		mov	byte [ss:EXTERR_LOCUS], 5
 12835 00006567 B001                    		mov	al, 1
 12836 00006569 EBED                    		jmp	short dealloc_errj
 12837                                  AllocOperGet:
 12838 0000656B 36A0[B002]              		mov	al, [ss:AllocMethod]
 12839 0000656F 30E4                    		xor	ah, ah
 12840                                  allocoper_ok:
 12841 00006571 EBDE                    		jmp	short dealloc_ok
 12842                                  AllocOperSet:
 12843 00006573 36881E[B002]            		mov	[ss:AllocMethod], bl
 12844 00006578 EBF7                    		jmp	short allocoper_ok
 12845                                  
 12846                                  ; ---------------------------------------------------------------------------
 12847                                  
 12848                                  		; 14/09/2022
 12849                                  		; 10/09/2022
 12850                                  		; 09/09/2022
 12851                                  _$ServerCall:
 12852 0000657A 3C07                    		cmp	al, 7
 12853 0000657C 7204                    		jb	short SET_STUFF
 12854 0000657E 3C09                    		cmp	al, 9
 12855 00006580 7612                    		jbe	short NO_SET_ID
 12856                                  SET_STUFF:
 12857                                  		;mov	si, dx ; 14/09/2022
 12858                                  		; 10/09/2022 - Magic Code ! (for Windows 3.1)
 12859 00006582 8BF2                    		db	8Bh, 0F2h
 12860 00006584 8B5C12                  		mov	bx, [si+12h]
 12861 00006587 36891E[EA02]            		mov	[ss:USER_ID], bx
 12862 0000658C 8B5C14                  		mov	bx, [si+14h]
 12863 0000658F 36891E[E802]            		mov	[ss:PROC_ID], bx
 12864                                  NO_SET_ID:
 12865 00006594 36FF36[EE13]            		push	word [ss:SERVERLEAVE]
 12866 00006599 36FF36[EC13]            		push	word [ss:SERVERTAB]
 12867 0000659E 50                      		push	ax
 12868 0000659F E8C9B8                  		call	TableDispatch
 12869 000065A2 36C606[D102]01          		mov	byte [ss:EXTERR_LOCUS], 1
 12870 000065A8 B001                    		mov	al, 1
 12871                                  servercall_error:
 12872 000065AA E9C5B0                  		jmp	SYS_Ret_Err
 12873                                  SERVERRETURN:
 12874 000065AD C3                      		retn
 12875                                  COMMIT_ALL:
 12876 000065AE 31DB                    		xor	bx, bx
 12877 000065B0 16                      		push	ss
 12878 000065B1 1F                      		pop	ds
 12879 000065B2 E880B9                  		call	EcritDisk
 12880                                  CommitLoop:
 12881 000065B5 53                      		push	bx
 12882 000065B6 E82701                  		call	SFFromSFN
 12883 000065B9 7223                    		jb	short CommitDone
 12884 000065BB 26833D00                		cmp	word [es:di], 0
 12885 000065BF 7419                    		jz	short CommitNext
 12886 000065C1 26833DFF                		cmp	word [es:di], 0FFFFh
 12887 000065C5 7413                    		jz	short CommitNext
 12888 000065C7 26F745050080            		test	word [es:di+5], 8000h
 12889 000065CD 750B                    		jnz	short CommitNext
 12890 000065CF 893E[3605]              		mov	word [THISSFT], di
 12891 000065D3 8C06[3805]              		mov	word [THISSFT+2], es
 12892 000065D7 E8F6D4                  		call	DOS_COMMIT
 12893                                  CommitNext:
 12894 000065DA 5B                      		pop	bx
 12895 000065DB 43                      		inc	bx
 12896 000065DC EBD7                    		jmp	short CommitLoop
 12897                                  CommitDone:
 12898 000065DE E85CB9                  		call	LcritDisk
 12899 000065E1 5B                      		pop	bx
 12900                                  commit_all_return:
 12901 000065E2 E981B0                  		jmp	SYS_RET_OK
 12902                                  
 12903                                  ; ---------------------------------------------------------------------------
 12904                                  
 12905                                  		; 09/09/2022
 12906                                  CLOSE_NAME:
 12907 000065E5 36FF1E[7000]            		call	far [ss:MFTCloN]
 12908                                  CheckReturns:
 12909 000065EA 7202                    		jb	short func_err
 12910                                  close_name_return:
 12911 000065EC EBF4                    		jmp	short commit_all_return
 12912                                  func_err:
 12913 000065EE EBBA                    		jmp	short servercall_error
 12914                                  CLOSE_UID:
 12915 000065F0 36FF1E[6800]            		call	far [ss:MFTclU]
 12916 000065F5 EBF3                    		jmp	short CheckReturns
 12917                                  CLOSE_UID_PID:
 12918 000065F7 36FF1E[6C00]            		call	far [ss:MFTCloseP]
 12919 000065FC EBEC                    		jmp	short CheckReturns
 12920                                  
 12921                                  ; ---------------------------------------------------------------------------
 12922                                  
 12923                                  		; 09/09/2022
 12924                                  GET_LIST:
 12925 000065FE 36FF1E[8000]            		call	far [ss:MFT_get]
 12926 00006603 72E9                    		jb	short func_err
 12927 00006605 E88BAF                  		call	Get_User_Stack
 12928 00006608 895C02                  		mov	[si+2],	bx
 12929 0000660B 897C0A                  		mov	[si+10], di
 12930 0000660E 8C4410                  		mov	word [si+16], es
 12931                                  SetCXOK:
 12932 00006611 894C04                  		mov	[si+4],	cx
 12933                                  get_list_return:
 12934 00006614 EBD6                    		jmp	short close_name_return
 12935                                  
 12936                                  ; ---------------------------------------------------------------------------
 12937                                  
 12938                                  		; 09/09/2022
 12939                                  SRV_CALL:
 12940 00006616 58                      		pop	ax
 12941 00006617 1E                      		push	ds
 12942 00006618 56                      		push	si
 12943 00006619 E877AF                  		call	Get_User_Stack
 12944 0000661C 5F                      		pop	di
 12945 0000661D 07                      		pop	es
 12946 0000661E E829B8                  		call	XCHGP
 12947 00006621 56                      		push	si
 12948 00006622 B90600                  		mov	cx, 6
 12949 00006625 F3A5                    		rep movsw
 12950 00006627 47                      		inc	di
 12951 00006628 47                      		inc	di
 12952 00006629 A5                      		movsw
 12953 0000662A A5                      		movsw
 12954 0000662B 5E                      		pop	si
 12955 0000662C 8B04                    		mov	ax, [si]
 12956 0000662E 8B5C02                  		mov	bx, [si+2]
 12957 00006631 8B4C04                  		mov	cx, [si+4]
 12958 00006634 8B5406                  		mov	dx, [si+6]
 12959 00006637 8B7C0A                  		mov	di, [si+10]
 12960 0000663A 8E440E                  		mov	es, word [si+14]
 12961 0000663D FF7408                  		push	word [si+8]
 12962 00006640 8E5C0C                  		mov	ds, word [si+12]
 12963 00006643 5E                      		pop	si
 12964 00006644 368C1E[7E05]            		mov	[ss:SaveDS], ds
 12965 00006649 36891E[7C05]            		mov	[ss:SaveBX], bx
 12966 0000664E 36C606[0D05]FF          		mov	byte [ss:fSharing], -1
 12967 00006654 E975AE                  		jmp	REDISP
 12968                                  
 12969                                  ; ---------------------------------------------------------------------------
 12970                                  
 12971                                  		; 09/09/2022
 12972                                  GET_DOS_DATA:
 12973 00006657 16                      		push	ss
 12974 00006658 07                      		pop	es
 12975 00006659 BF[CE02]                		mov	di, ERRORMODE ; SWAPSTART
 12976 0000665C B9[090A]                		mov	cx, SWAP_END
 12977 0000665F BA[E602]                		mov	dx, USER_IN_AX
 12978 00006662 29F9                    		sub	cx, di
 12979 00006664 29FA                    		sub	dx, di
 12980 00006666 D1E9                    		shr	cx, 1
 12981 00006668 83D100                  		adc	cx, 0
 12982 0000666B D1E1                    		shl	cx, 1
 12983 0000666D E823AF                  		call	Get_User_Stack
 12984 00006670 8C440E                  		mov	word [si+14], es
 12985 00006673 897C08                  		mov	[si+8],	di
 12986 00006676 895406                  		mov	[si+6],	dx
 12987 00006679 EB96                    		jmp	short SetCXOK
 12988                                  
 12989                                  ; ---------------------------------------------------------------------------
 12990                                  
 12991                                  		; 09/09/2022
 12992                                  SPOOL_OPER:
 12993 0000667B 50                      		push	ax
 12994 0000667C B82511                  		mov	ax, 1125h
 12995 0000667F CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - REDIRECTED PRINTER MODE
 12996                                  					; STACK: WORD subfunction
 12997                                  					; Return: CF set on error, AX =	error code
 12998                                  					; STACK	unchanged
 12999 00006681 5B                      		pop	bx
 13000 00006682 7202                    		jb	short func_err2
 13001 00006684 EB8E                    		jmp	short get_list_return
 13002                                  func_err2:
 13003 00006686 E9E9AF                  		jmp	SYS_Ret_Err
 13004                                  
 13005                                  ; ---------------------------------------------------------------------------
 13006                                  
 13007                                  		; 09/09/2022
 13008                                  _$setExtendedError:
 13009 00006689 8B04                    		mov	ax, [si]
 13010 0000668B 36A3[D202]              		mov	[ss:EXTERR], ax
 13011 0000668F 8B440A                  		mov	ax, [si+10]
 13012 00006692 36A3[D602]              		mov	[ss:EXTERRPT], ax
 13013 00006696 8B440E                  		mov	ax, [si+14]
 13014 00006699 36A3[D802]              		mov	[ss:EXTERRPT+2], ax
 13015 0000669D 8B4402                  		mov	ax, [si+2]
 13016 000066A0 36A3[D402]              		mov	word [ss:EXTERR_ACTION], ax
 13017 000066A4 8B4404                  		mov	ax, [si+4]
 13018 000066A7 368826[D102]            		mov	[ss:EXTERR_LOCUS], ah
 13019 000066AC C3                      		retn
 13020                                  
 13021                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13022                                  
 13023                                  		; 09/09/2022
 13024                                  pJFNFromHandle:
 13025 000066AD 2E8E06[DE02]            		mov	es, [cs:CurrentPDB]
 13026 000066B2 263B1E[3200]            		cmp	bx, word [es:BCON]
 13027 000066B7 7204                    		jb	short pjfn10
 13028 000066B9 B006                    		mov	al, 6
 13029                                  ReturnCarry:
 13030 000066BB F9                      		stc
 13031 000066BC C3                      		retn
 13032                                  pjfn10:
 13033 000066BD 26C43E[3400]            		les	di, [es:BCON+2]
 13034 000066C2 01DF                    		add	di, bx
 13035 000066C4 F8                      		clc
 13036                                  pJFNFromHandle_error:
 13037 000066C5 C3                      		retn
 13038                                  
 13039                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13040                                  
 13041                                  		; 09/09/2022
 13042                                  SFFromHandle:
 13043 000066C6 E8E4FF                  		call	pJFNFromHandle
 13044 000066C9 72FA                    		jb	short pJFNFromHandle_error
 13045 000066CB 26803DFF                		cmp	byte [es:di], -1
 13046 000066CF 7504                    		jnz	short GetSF
 13047 000066D1 B006                    		mov	al, 6
 13048 000066D3 EBE6                    		jmp	short ReturnCarry
 13049                                  GetSF:
 13050 000066D5 53                      		push	bx
 13051 000066D6 268A1D                  		mov	bl, [es:di]
 13052 000066D9 30FF                    		xor	bh, bh
 13053 000066DB E80200                  		call	SFFromSFN
 13054 000066DE 5B                      		pop	bx
 13055 000066DF C3                      		retn
 13056                                  
 13057                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13058                                  
 13059                                  		; 09/09/2022
 13060                                  SFFromSFN:
 13061 000066E0 2EC43E[2A00]            		les	di, [cs:SFT_ADDR]
 13062                                  sfsfn5:
 13063 000066E5 263B5D04                		cmp	bx, [es:di+4]
 13064 000066E9 720F                    		jb	short sfsfn7
 13065 000066EB 262B5D04                		sub	bx, [es:di+4]
 13066 000066EF 26C43D                  		les	di, [es:di]
 13067 000066F2 83FFFF                  		cmp	di, 0FFFFh
 13068 000066F5 75EE                    		jnz	short sfsfn5
 13069 000066F7 F9                      		stc
 13070 000066F8 EB0D                    		jmp	short sfsfn_err
 13071                                  sfsfn7:
 13072 000066FA 50                      		push	ax
 13073 000066FB B83500                  		mov	ax, 53
 13074 000066FE F6E3                    		mul	bl
 13075 00006700 01C7                    		add	di, ax
 13076 00006702 58                      		pop	ax
 13077 00006703 83C706                  		add	di, 6
 13078 00006706 F8                      		clc
 13079                                  sfsfn_err:
 13080 00006707 C3                      		retn
 13081                                  
 13082                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13083                                  
 13084                                  		; 09/09/2022
 13085                                  JFNFree:
 13086 00006708 31DB                    		xor	bx, bx
 13087                                  jfnf1:
 13088 0000670A E8A0FF                  		call	pJFNFromHandle
 13089 0000670D 7209                    		jb	short jfnf5
 13090 0000670F 26803DFF                		cmp	byte [es:di], -1
 13091 00006713 7405                    		jz	short jfnfx
 13092 00006715 43                      		inc	bx
 13093 00006716 EBF2                    		jmp	short jfnf1
 13094                                  jfnf5:
 13095 00006718 B004                    		mov	al, 4
 13096                                  jfnfx:
 13097 0000671A C3                      		retn
 13098                                  
 13099                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13100                                  
 13101                                  		; 07/09/2022
 13102                                  SFNFree:
 13103 0000671B 31DB                    		xor	bx, bx
 13104                                  sfnf5:
 13105 0000671D 53                      		push	bx
 13106 0000671E E8BFFF                  		call	SFFromSFN
 13107 00006721 5B                      		pop	bx
 13108 00006722 7305                    		jnb	short sfnf6
 13109                                  sfn95:
 13110 00006724 B004                    		mov	al, 4
 13111 00006726 EB42                    		jmp	short sfnfree_return
 13112                                  
 13113 00006728 90                      		nop
 13114                                  sfnf6:
 13115 00006729 26833D00                		cmp	word [es:di], 0
 13116 0000672D 7421                    		jz	short sfnf20
 13117 0000672F 26833DFF                		cmp	word [es:di], 0FFFFh
 13118 00006733 7518                    		jnz	short sfnf7
 13119                                  sfnf10:
 13120 00006735 53                      		push	bx
 13121 00006736 368B1E[EA02]            		mov	bx, [ss:USER_ID]
 13122 0000673B 26395D2F                		cmp	[es:di+2Fh], bx
 13123 0000673F 750B                    		jnz	short sfnf67
 13124 00006741 368B1E[E802]            		mov	bx, [ss:PROC_ID]
 13125 00006746 26395D31                		cmp	[es:di+31h], bx
 13126 0000674A 7405                    		jz	short sfnf21
 13127                                  sfnf67:
 13128 0000674C 5B                      		pop	bx
 13129                                  sfnf7:
 13130 0000674D 43                      		inc	bx
 13131 0000674E EBCD                    		jmp	short sfnf5
 13132                                  sfnf20:
 13133 00006750 53                      		push	bx
 13134                                  sfnf21:
 13135 00006751 F8                      		clc
 13136 00006752 26C705FFFF              		mov	word [es:di], 0FFFFh
 13137 00006757 368B1E[EA02]            		mov	bx, [ss:USER_ID]
 13138 0000675C 26895D2F                		mov	[es:di+2Fh], bx
 13139 00006760 368B1E[E802]            		mov	bx, [ss:PROC_ID]
 13140 00006765 26895D31                		mov	[es:di+31h], bx
 13141 00006769 5B                      		pop	bx
 13142                                  sfnfree_return:
 13143 0000676A C3                      		retn
 13144                                  
 13145                                  ; ---------------------------------------------------------------------------
 13146                                  
 13147                                  		; 07/09/2022
 13148                                  _$AssignOper:
 13149 0000676B 50                      		push	ax
 13150 0000676C B81E11                  		mov	ax, 111Eh
 13151 0000676F CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - DO REDIRECTION
 13152                                  					; SS = DOS CS
 13153                                  					; STACK: WORD function to execute
 13154                                  					; Return: CF set on error, AX =	error code
 13155                                  					; STACK	unchanged
 13156 00006771 5B                      		pop	bx
 13157 00006772 7203                    		jb	short ASS_ERR
 13158 00006774 E9EFAE                  		jmp	SYS_RET_OK
 13159                                  ASS_ERR:
 13160 00006777 E9F8AE                  		jmp	SYS_Ret_Err
 13161                                  
 13162                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13163                                  
 13164                                  		; 07/09/2022
 13165                                  Find_DPB:
 13166 0000677A 36C536[2600]            		lds	si, [ss:DPBHEAD]
 13167                                  fdpb5:
 13168 0000677F 83FEFF                  		cmp	si, 0FFFFh
 13169 00006782 740A                    		jz	short fdpb10
 13170 00006784 3A04                    		cmp	al, [si]
 13171 00006786 7501                    		jnz	short fdpb7
 13172 00006788 C3                      		retn
 13173                                  fdpb7:
 13174 00006789 C57418                  		lds	si, [si+18h]
 13175 0000678C EBF1                    		jmp	short fdpb5
 13176                                  fdpb10:
 13177 0000678E F9                      		stc
 13178 0000678F C3                      		retn
 13179                                  
 13180                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13181                                  
 13182                                  		; 07/09/2022
 13183                                  InitCDS:
 13184 00006790 B43A                    		mov	ah, ':'
 13185 00006792 50                      		push	ax
 13186 00006793 2C40                    		sub	al, 40h
 13187 00006795 363806[4600]            		cmp	[ss:NUMIO], al
 13188 0000679A 58                      		pop	ax
 13189 0000679B 36C43E[3A05]            		les	di, [ss:THISCDS]
 13190 000067A0 26C745430000            		mov	word [es:di+67], 0
 13191 000067A6 7239                    		jb	short RET45
 13192 000067A8 268905                  		mov	[es:di], ax
 13193 000067AB 50                      		push	ax
 13194 000067AC B85C00                  		mov	ax, '\'
 13195 000067AF 26894502                		mov	[es:di+2], ax
 13196 000067B3 58                      		pop	ax
 13197 000067B4 26814D430040            		or	word [es:di+67], 4000h
 13198 000067BA 26C7454F0200            		mov	word [es:di+79], 2
 13199 000067C0 26C745490000            		mov	word [es:di+73], 0
 13200 000067C6 26C7454B0000            		mov	word [es:di+75], 0
 13201 000067CC 50                      		push	ax
 13202 000067CD 1E                      		push	ds
 13203 000067CE 56                      		push	si
 13204 000067CF 2C41                    		sub	al, 'A'
 13205 000067D1 E8A6FF                  		call	Find_DPB
 13206 000067D4 7208                    		jb	short icds5
 13207 000067D6 26897545                		mov	[es:di+69], si
 13208 000067DA 268C5D47                		mov	word [es:di+71], ds
 13209                                  icds5:
 13210 000067DE 5E                      		pop	si
 13211 000067DF 1F                      		pop	ds
 13212 000067E0 58                      		pop	ax
 13213                                  RET45:
 13214 000067E1 C3                      		retn
 13215                                  
 13216                                  ; ---------------------------------------------------------------------------
 13217                                  
 13218                                  		; 07/09/2022
 13219                                  _$UserOper:
 13220 000067E2 50                      		push	ax
 13221 000067E3 2C01                    		sub	al, 1
 13222 000067E5 58                      		pop	ax
 13223 000067E6 7211                    		jb	short UserGet
 13224 000067E8 742E                    		jz	short UserSet
 13225 000067EA 3C05                    		cmp	al, 5
 13226 000067EC 763D                    		jbe	short UserPrint
 13227 000067EE 36C606[D102]01          		mov	byte [ss:EXTERR_LOCUS], 1
 13228 000067F4 B001                    		mov	al, 1
 13229                                  useroper_error:
 13230 000067F6 E979AE                  		jmp	SYS_Ret_Err
 13231                                  UserGet:
 13232 000067F9 1E                      		push	ds
 13233 000067FA 07                      		pop	es
 13234 000067FB 89D7                    		mov	di, dx
 13235 000067FD 368B0E[0E00]            		mov	cx, [ss:MYNUM]
 13236 00006802 E88EAD                  		call	Get_User_Stack
 13237 00006805 894C04                  		mov	[si+4],	cx
 13238 00006808 16                      		push	ss
 13239 00006809 1F                      		pop	ds
 13240 0000680A BE[B302]                		mov	si, MYNAME
 13241                                  UserMove:
 13242 0000680D B90F00                  		mov	cx, 15
 13243 00006810 F3A4                    		rep movsb
 13244 00006812 31C0                    		xor	ax, ax
 13245 00006814 AA                      		stosb
 13246                                  UserBye:
 13247 00006815 E94EAE                  		jmp	SYS_RET_OK
 13248                                  UserSet:
 13249 00006818 36890E[0E00]            		mov	[ss:MYNUM], cx
 13250 0000681D 89D6                    		mov	si, dx
 13251 0000681F 16                      		push	ss
 13252 00006820 07                      		pop	es
 13253 00006821 BF[B302]                		mov	di, MYNAME
 13254 00006824 36FE06[B202]            		inc	byte [ss:DIFFNAM]
 13255 00006829 EBE2                    		jmp	short UserMove
 13256                                  UserPrint:
 13257 0000682B 50                      		push	ax
 13258 0000682C B81F11                  		mov	ax, 111Fh
 13259 0000682F CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - PRINTER SETUP
 13260                                  					; STACK: WORD function
 13261                                  					; Return: CF set on error, AX =	error code
 13262                                  					; STACK	unchanged
 13263 00006831 5A                      		pop	dx
 13264 00006832 7302                    		jnb	short OKPA
 13265 00006834 EBC0                    		jmp	short useroper_error
 13266                                  OKPA:
 13267 00006836 EBDD                    		jmp	short UserBye
 13268                                  
 13269                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13270                                  
 13271                                  		; 07/09/2022
 13272                                  GETVISDRV:
 13273 00006838 E81400                  		call	GetThisDrv
 13274 0000683B 72A4                    		jb	short RET45
 13275 0000683D 1E                      		push	ds
 13276 0000683E 56                      		push	si
 13277 0000683F 36C536[3A05]            		lds	si, [ss:THISCDS]
 13278 00006844 F744430020              		test	word [si+67], 2000h
 13279 00006849 5E                      		pop	si
 13280 0000684A 1F                      		pop	ds
 13281 0000684B 7494                    		jz	short RET45
 13282 0000684D F9                      		stc
 13283 0000684E C3                      		retn
 13284                                  
 13285                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13286                                  
 13287                                  		; 07/09/2022
 13288                                  GetThisDrv:
 13289 0000684F 08C0                    		or	al, al
 13290 00006851 7506                    		jnz	short GTD10
 13291 00006853 36A0[E402]              		mov	al, [ss:CURDRV]
 13292 00006857 FEC0                    		inc	al
 13293                                  GTD10:
 13294 00006859 FEC8                    		dec	al
 13295 0000685B 1E                      		push	ds
 13296 0000685C 56                      		push	si
 13297 0000685D 36C606[D102]02          		mov	byte [ss:EXTERR_LOCUS], 2
 13298 00006863 36F606[0D05]FF          		test	byte [ss:fSharing], -1
 13299 00006869 7421                    		jz	short GTD20
 13300 0000686B 50                      		push	ax
 13301 0000686C 06                      		push	es
 13302 0000686D 57                      		push	di
 13303 0000686E 36C706[3A05][9504]      		mov	word [ss:THISCDS], SETFINDPB+3
 13304 00006875 368C0E[3C05]            		mov	word [ss:THISCDS+2], cs
 13305 0000687A 0441                    		add	al, 'A'
 13306 0000687C E811FF                  		call	InitCDS
 13307 0000687F 26F745430040            		test	word [es:di+67], 4000h
 13308 00006885 5F                      		pop	di
 13309 00006886 07                      		pop	es
 13310 00006887 58                      		pop	ax
 13311 00006888 740E                    		jz	short GTD30
 13312 0000688A EB13                    		jmp	short GTDX
 13313                                  GTD20:
 13314 0000688C E81300                  		call	GetCDSFromDrv
 13315 0000688F 7207                    		jb	short GTD30
 13316 00006891 F744430040              		test	word [si+43h], 4000h
 13317 00006896 7507                    		jnz	short GTDX
 13318                                  GTD30:
 13319 00006898 36C606[D102]01          		mov	byte [ss:EXTERR_LOCUS], 1
 13320 0000689E F9                      		stc
 13321                                  GTDX:
 13322 0000689F 5E                      		pop	si
 13323 000068A0 1F                      		pop	ds
 13324 000068A1 C3                      		retn
 13325                                  
 13326                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13327                                  		
 13328                                  		; 07/09/2022
 13329                                  GetCDSFromDrv:
 13330 000068A2 363A06[4700]            		cmp	al, [ss:CDSCOUNT]
 13331 000068A7 7202                    		jb	short GetCDS
 13332 000068A9 F9                      		stc
 13333 000068AA C3                      		retn
 13334                                  
 13335                                  ; ---------------------------------------------------------------------------
 13336                                  
 13337                                  		; 07/09/2022
 13338                                  GetCDS:
 13339 000068AB 53                      		push	bx
 13340 000068AC 50                      		push	ax
 13341 000068AD 36C536[3C00]            		lds	si, [ss:CDSAddr]
 13342 000068B2 B351                    		mov	bl, 81
 13343 000068B4 F6E3                    		mul	bl
 13344 000068B6 01C6                    		add	si, ax
 13345 000068B8 368936[3A05]            		mov	word [ss:THISCDS], si
 13346 000068BD 368C1E[3C05]            		mov	word [ss:THISCDS+2], ds
 13347 000068C2 58                      		pop	ax
 13348 000068C3 5B                      		pop	bx
 13349 000068C4 F8                      		clc
 13350 000068C5 C3                      		retn
 13351                                  
 13352                                  ; ---------------------------------------------------------------------------
 13353                                  
 13354                                  		; 07/09/2022
 13355                                  TransFCB:
 13356 000068C6 55                      		push	bp
 13357 000068C7 89E5                    		mov	bp, sp
 13358 000068C9 83EC0F                  		sub	sp, 15
 13359 000068CC 16                      		push	ss
 13360 000068CD 07                      		pop	es
 13361 000068CE 06                      		push	es
 13362 000068CF 57                      		push	di
 13363 000068D0 8D7EF1                  		lea	di, [bp-15]
 13364 000068D3 36C606[0705]00          		mov	byte [ss:ExtFCB], 0
 13365 000068D9 36C606[0805]00          		mov	byte [ss:ExtFCB+1], 0
 13366 000068DF E8EBBF                  		call	GetExtended
 13367 000068E2 740D                    		jz	short GetDrive
 13368 000068E4 8A44FF                  		mov	al, [si-1]
 13369 000068E7 36A2[0805]              		mov	byte [ss:ExtFCB+1], al
 13370 000068EB 36C606[0705]FF          		mov	byte [ss:ExtFCB], -1
 13371                                  GetDrive:
 13372 000068F1 AC                      		lodsb
 13373 000068F2 E85AFF                  		call	GetThisDrv
 13374 000068F5 722C                    		jb	short BadPack
 13375 000068F7 E87403                  		call	TextFromDrive
 13376 000068FA BB[CA12]                		mov	bx, CharType
 13377 000068FD B90B00                  		mov	cx, 11
 13378 00006900 56                      		push	si
 13379                                  FCBScan:
 13380 00006901 AC                      		lodsb
 13381                                  		;xlat	byte [es:bx]
 13382 00006902 26D7                    		es	xlat
 13383 00006904 A808                    		test	al, 8
 13384 00006906 741B                    		jz	short BadPack
 13385 00006908 E2F7                    		loop	FCBScan
 13386 0000690A 5E                      		pop	si
 13387 0000690B 89FB                    		mov	bx, di
 13388 0000690D E808C4                  		call	PackName
 13389 00006910 5F                      		pop	di
 13390 00006911 07                      		pop	es
 13391 00006912 16                      		push	ss
 13392 00006913 1F                      		pop	ds
 13393 00006914 8D76F1                  		lea	si, [bp-15]
 13394 00006917 803F00                  		cmp	byte [bx], 0
 13395 0000691A 7407                    		jz	short BadPack
 13396 0000691C 55                      		push	bp
 13397 0000691D E80E00                  		call	TransPathSet
 13398 00006920 5D                      		pop	bp
 13399 00006921 7303                    		jnb	short FCBRet
 13400                                  BadPack:
 13401 00006923 F9                      		stc
 13402 00006924 B003                    		mov	al, 3
 13403                                  FCBRet:
 13404 00006926 89EC                    		mov	sp, bp
 13405 00006928 5D                      		pop	bp
 13406                                  TransPath_retn:
 13407 00006929 C3                      		retn
 13408                                  
 13409                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13410                                  
 13411                                  		; 07/09/2022
 13412                                  TransPath:
 13413 0000692A 30C0                    		xor	al, al
 13414 0000692C EB02                    		jmp	short SetSplice
 13415                                  
 13416                                  
 13417                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13418                                  
 13419                                  		; 09/09/2022
 13420                                  		; 07/09/2022
 13421                                  TransPathSet:
 13422 0000692E B0FF                    		mov	al, -1
 13423                                  SetSplice:
 13424 00006930 36A2[F802]              		mov	[ss:NoSetDir], al
 13425 00006934 B0FF                    		mov	al, -1
 13426                                  TransPathNoSet:
 13427 00006936 36A2[0C05]              		mov	byte [ss:fSplice], al ; 09/09/2022
 13428 0000693A 36C606[1505]FF          		mov	byte [ss:cMeta], -1
 13429 00006940 36893E[4A05]            		mov	[ss:WFP_START], di
 13430 00006945 36C706[4E05]FFFF        		mov	word [ss:CURR_DIR_END], -1
 13431 0000694C 16                      		push	ss
 13432 0000694D 07                      		pop	es
 13433 0000694E 8DAD8600                		lea	bp, [di+134]
 13434 00006952 36F606[0D05]FF          		test	byte [ss:fSharing], -1
 13435 00006958 7435                    		jz	short CheckUNC
 13436 0000695A E8FA02                  		call	DriveFromText
 13437 0000695D E8EFFE                  		call	GetThisDrv
 13438 00006960 722A                    		jb	short NoPath
 13439 00006962 E80903                  		call	TextFromDrive
 13440 00006965 8D5D01                  		lea	bx, [di+1]
 13441 00006968 E83601                  		call	Canonicalize
 13442 0000696B 72BC                    		jb	short TransPath_retn
 13443 0000696D 16                      		push	ss
 13444 0000696E 1F                      		pop	ds
 13445 0000696F 8B36[4A05]              		mov	si, [WFP_START]
 13446 00006973 F606[0C05]FF            		test	byte [fSplice], -1 ; 09/09/2022
 13447 00006978 7403                    		jz	short NoServerSplice
 13448 0000697A E83502                  		call	Splice
 13449                                  NoServerSplice:
 13450 0000697D 16                      		push	ss
 13451 0000697E 1F                      		pop	ds
 13452 0000697F C43E[3A05]              		les	di, [THISCDS]
 13453 00006983 E8AFB5                  		call	EcritDisk
 13454 00006986 E837F1                  		call	FatRead_CDS
 13455 00006989 E8B1B5                  		call	LcritDisk
 13456                                  NoPath:
 13457 0000698C B003                    		mov	al, 3
 13458 0000698E C3                      		retn
 13459                                  
 13460                                  ; ---------------------------------------------------------------------------
 13461                                  
 13462                                  		; 07/09/2022
 13463                                  CheckUNC:
 13464 0000698F 36C706[3A05]FFFF        		mov	word [ss:THISCDS], -1
 13465 00006996 B82311                  		mov	ax, 1123h
 13466 00006999 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - QUALIFY REMOTE FILENAME
 13467                                  					; DS:SI	-> ASCIZ filename to canonicalize
 13468                                  					; ES:DI	-> 128-byte buffer for qualified name
 13469                                  					; Return: CF set if not	resolved
 13470 0000699B 7329                    		jnb	short UNCDone
 13471 0000699D E8B702                  		call	DriveFromText
 13472 000069A0 50                      		push	ax
 13473 000069A1 8B04                    		mov	ax, [si]
 13474 000069A3 E8AAEB                  		call	PATHCHRCMP
 13475 000069A6 86E0                    		xchg	ah, al
 13476 000069A8 E8A5EB                  		call	PATHCHRCMP
 13477 000069AB 751F                    		jnz	short CheckDevice
 13478 000069AD 38C4                    		cmp	ah, al
 13479 000069AF 751B                    		jnz	short CheckDevice
 13480 000069B1 58                      		pop	ax
 13481 000069B2 A5                      		movsw
 13482                                  UNCCpy:
 13483 000069B3 AC                      		lodsb
 13484 000069B4 E877B4                  		call	Ucase
 13485 000069B7 08C0                    		or	al, al
 13486 000069B9 740E                    		jz	short UNCTerm
 13487 000069BB E892EB                  		call	PATHCHRCMP
 13488 000069BE 89FB                    		mov	bx, di
 13489 000069C0 AA                      		stosb
 13490 000069C1 75F0                    		jnz	short UNCCpy
 13491 000069C3 E8DB00                  		call	Canonicalize
 13492                                  UNCDone:
 13493 000069C6 16                      		push	ss
 13494 000069C7 1F                      		pop	ds
 13495 000069C8 C3                      		retn
 13496                                  UNCTerm:
 13497 000069C9 AA                      		stosb
 13498 000069CA EBFA                    		jmp	short UNCDone
 13499                                  
 13500                                  ; ---------------------------------------------------------------------------
 13501                                  
 13502                                  		; 07/09/2022
 13503                                  CheckDevice:
 13504 000069CC 58                      		pop	ax
 13505 000069CD 803C00                  		cmp	byte [si], 0
 13506 000069D0 7504                    		jnz	short CheckPath
 13507 000069D2 B002                    		mov	al, 2
 13508 000069D4 F9                      		stc
 13509 000069D5 C3                      		retn
 13510                                  
 13511                                  ; ---------------------------------------------------------------------------
 13512                                  
 13513                                  		; 07/09/2022
 13514                                  CheckPath:
 13515 000069D6 50                      		push	ax
 13516 000069D7 55                      		push	bp
 13517 000069D8 E861E1                  		call	CheckThisDevice
 13518 000069DB 5D                      		pop	bp
 13519 000069DC 58                      		pop	ax
 13520 000069DD 731C                    		jnb	short DoFile
 13521 000069DF 36C606[0D05]FF          		mov	byte [ss:fSharing], -1
 13522 000069E5 E867FE                  		call	GetThisDrv
 13523 000069E8 36C606[0D05]00          		mov	byte [ss:fSharing], 0
 13524 000069EE E87D02                  		call	TextFromDrive
 13525 000069F1 B02F                    		mov	al, '/'
 13526 000069F3 AA                      		stosb
 13527 000069F4 E81FB4                  		call	StrCpy
 13528 000069F7 F8                      		clc
 13529 000069F8 16                      		push	ss
 13530 000069F9 1F                      		pop	ds
 13531                                  DoFile_retn:
 13532 000069FA C3                      		retn
 13533                                  
 13534                                  ; ---------------------------------------------------------------------------
 13535                                  
 13536                                  		; 09/09/2022
 13537                                  		; 07/09/2022
 13538                                  DoFile:
 13539 000069FB E83AFE                  		call	GETVISDRV
 13540 000069FE B003                    		mov	al, 3
 13541 00006A00 72F8                    		jb	short DoFile_retn
 13542 00006A02 1E                      		push	ds
 13543 00006A03 56                      		push	si
 13544 00006A04 06                      		push	es
 13545 00006A05 57                      		push	di
 13546 00006A06 E87FE0                  		call	ValidateCDS
 13547 00006A09 5F                      		pop	di
 13548 00006A0A 07                      		pop	es
 13549 00006A0B 5E                      		pop	si
 13550 00006A0C 1F                      		pop	ds
 13551 00006A0D B003                    		mov	al, 3
 13552 00006A0F 72E9                    		jb	short DoFile_retn
 13553 00006A11 1E                      		push	ds
 13554 00006A12 56                      		push	si
 13555 00006A13 36C536[3A05]            		lds	si, [ss:THISCDS]
 13556 00006A18 89FB                    		mov	bx, di
 13557 00006A1A 035C4F                  		add	bx, [si+79]
 13558 00006A1D 8DAD8600                		lea	bp, [di+134]
 13559 00006A21 E801B4                  		call	FStrCpy
 13560 00006A24 4F                      		dec	di
 13561 00006A25 B05C                    		mov	al, '\'
 13562 00006A27 263845FF                		cmp	[es:di-1], al
 13563 00006A2B 7401                    		jz	short GetOrig
 13564 00006A2D AA                      		stosb
 13565                                  GetOrig:
 13566 00006A2E 4F                      		dec	di
 13567 00006A2F 5E                      		pop	si
 13568 00006A30 1F                      		pop	ds
 13569 00006A31 E8D300                  		call	PathSep
 13570 00006A34 7511                    		jnz	short PathAssure
 13571 00006A36 08C0                    		or	al, al
 13572 00006A38 7410                    		jz	short DoCanon
 13573 00006A3A 89DF                    		mov	di, bx
 13574                                  SkipPath:
 13575 00006A3C AC                      		lodsb
 13576 00006A3D E810EB                  		call	PATHCHRCMP
 13577 00006A40 74FA                    		jz	short SkipPath
 13578 00006A42 4E                      		dec	si
 13579 00006A43 08C0                    		or	al, al
 13580 00006A45 7403                    		jz	short DoCanon
 13581                                  PathAssure:
 13582 00006A47 B05C                    		mov	al, '\'
 13583 00006A49 AA                      		stosb
 13584                                  DoCanon:
 13585 00006A4A E85400                  		call	Canonicalize
 13586 00006A4D 72AB                    		jb	short DoFile_retn
 13587 00006A4F 16                      		push	ss
 13588 00006A50 1F                      		pop	ds
 13589 00006A51 8B3E[4A05]              		mov	di, [WFP_START]
 13590 00006A55 C536[3A05]              		lds	si, [THISCDS]
 13591 00006A59 E81A02                  		call	PathPref
 13592 00006A5C 7514                    		jnz	short _DoSplice
 13593 00006A5E 8A44FF                  		mov	al, [si-1]
 13594 00006A61 E8ECEA                  		call	PATHCHRCMP
 13595 00006A64 740C                    		jz	short _DoSplice
 13596 00006A66 26803D00                		cmp	byte [es:di], 0
 13597 00006A6A 7406                    		jz	short _DoSplice
 13598 00006A6C 47                      		inc	di
 13599 00006A6D 36893E[4E05]            		mov	[ss:CURR_DIR_END], di
 13600                                  _DoSplice:
 13601 00006A72 16                      		push	ss
 13602 00006A73 1F                      		pop	ds
 13603 00006A74 8B36[4A05]              		mov	si, [WFP_START]
 13604 00006A78 31C9                    		xor	cx, cx
 13605 00006A7A F606[0C05]FF            		test	byte [fSplice], -1 ; 09/09/2022
 13606 00006A7F 7403                    		jz	short SkipSplice
 13607 00006A81 E82E01                  		call	Splice
 13608                                  SkipSplice:
 13609 00006A84 16                      		push	ss
 13610 00006A85 1F                      		pop	ds
 13611 00006A86 C43E[3A05]              		les	di, [THISCDS]
 13612 00006A8A 26F745430080            		test	word [es:di+67], 8000h
 13613 00006A90 7401                    		jz	short SkipSplice2
 13614 00006A92 C3                      		retn
 13615                                  
 13616                                  ; ---------------------------------------------------------------------------
 13617                                  		
 13618                                  		; 07/09/2022
 13619                                  SkipSplice2:
 13620 00006A93 E30B                    		jcxz	Done
 13621 00006A95 E89DB4                  		call	EcritDisk
 13622 00006A98 E825F0                  		call	FatRead_CDS
 13623 00006A9B E89FB4                  		call	LcritDisk
 13624 00006A9E B003                    		mov	al, 3
 13625                                  Done:
 13626 00006AA0 C3                      		retn
 13627                                  
 13628                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13629                                  
 13630                                  		; 07/09/2022
 13631                                  Canonicalize:
 13632 00006AA1 AC                      		lodsb
 13633 00006AA2 E8ABEA                  		call	PATHCHRCMP
 13634 00006AA5 7507                    		jnz	short CanonDec
 13635 00006AA7 39EF                    		cmp	di, bp
 13636 00006AA9 7319                    		jnb	short CanonBad
 13637 00006AAB AA                      		stosb
 13638 00006AAC EBF3                    		jmp	short Canonicalize
 13639                                  CanonDec:
 13640 00006AAE 4E                      		dec	si
 13641                                  CanonLoop:
 13642 00006AAF 31C0                    		xor	ax, ax
 13643 00006AB1 3804                    		cmp	[si], al
 13644 00006AB3 751A                    		jnz	short DoComponent
 13645 00006AB5 26807DFF3A              		cmp	byte [es:di-1], ':'
 13646 00006ABA 7505                    		jnz	short DoTerminate
 13647 00006ABC B05C                    		mov	al, '\'
 13648 00006ABE AA                      		stosb
 13649 00006ABF 88E0                    		mov	al, ah
 13650                                  DoTerminate:
 13651 00006AC1 AA                      		stosb
 13652 00006AC2 F8                      		clc
 13653 00006AC3 C3                      		retn
 13654                                  
 13655                                  ; ---------------------------------------------------------------------------
 13656                                  
 13657                                  		; 07/09/2022
 13658                                  CanonBad:
 13659 00006AC4 E8C801                  		call	ScanPathChar
 13660 00006AC7 B003                    		mov	al, 3
 13661 00006AC9 7402                    		jz	short PathEnc
 13662 00006ACB B002                    		mov	al, 2
 13663                                  PathEnc:
 13664 00006ACD F9                      		stc
 13665                                  CanonBad_retn:
 13666 00006ACE C3                      		retn
 13667                                  
 13668                                  ; ---------------------------------------------------------------------------
 13669                                  
 13670                                  		; 07/09/2022
 13671                                  DoComponent:
 13672 00006ACF E85200                  		call	CopyComponent
 13673 00006AD2 72FA                    		jb	short CanonBad_retn
 13674 00006AD4 26833D2E                		cmp	word [es:di], 2Eh
 13675 00006AD8 7408                    		jz	short Skip1
 13676 00006ADA 26813D2E2E              		cmp	word [es:di], '..'
 13677 00006ADF 750B                    		jnz	short CanonNormal
 13678 00006AE1 4F                      		dec	di
 13679                                  Skip1:
 13680 00006AE2 E82C00                  		call	SkipBack
 13681 00006AE5 B003                    		mov	al, 3
 13682 00006AE7 72E5                    		jb	short CanonBad_retn
 13683 00006AE9 EB03                    		jmp	short CanonPath
 13684                                  
 13685 00006AEB 90                      		nop
 13686                                  CanonNormal:
 13687 00006AEC 01CF                    		add	di, cx
 13688                                  CanonPath:
 13689 00006AEE E81600                  		call	PathSep
 13690 00006AF1 75D1                    		jnz	short CanonBad
 13691 00006AF3 AC                      		lodsb
 13692 00006AF4 E859EA                  		call	PATHCHRCMP
 13693 00006AF7 75B5                    		jnz	short CanonDec
 13694 00006AF9 39EF                    		cmp	di, bp
 13695 00006AFB 73C7                    		jnb	short CanonBad
 13696 00006AFD AA                      		stosb
 13697                                  CanonPathLoop:
 13698 00006AFE AC                      		lodsb
 13699 00006AFF E84EEA                  		call	PATHCHRCMP
 13700 00006B02 74FA                    		jz	short CanonPathLoop
 13701 00006B04 4E                      		dec	si
 13702 00006B05 EBA8                    		jmp	short CanonLoop
 13703                                  
 13704                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13705                                  
 13706                                  		; 07/09/2022
 13707                                  PathSep:
 13708 00006B07 8A04                    		mov	al, [si]
 13709                                  
 13710                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13711                                  
 13712                                  		; 07/09/2022
 13713                                  PathSepGotCh:
 13714 00006B09 08C0                    		or	al, al
 13715 00006B0B 74C1                    		jz	short CanonBad_retn
 13716 00006B0D E840EA                  		call	PATHCHRCMP
 13717 00006B10 C3                      		retn
 13718                                  
 13719                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13720                                  
 13721                                  		; 07/09/2022
 13722                                  SkipBack:
 13723 00006B11 39DF                    		cmp	di, bx
 13724 00006B13 720B                    		jb	short SkipBad
 13725 00006B15 4F                      		dec	di
 13726 00006B16 268A05                  		mov	al, [es:di]
 13727 00006B19 E834EA                  		call	PATHCHRCMP
 13728 00006B1C 75F3                    		jnz	short SkipBack
 13729 00006B1E F8                      		clc
 13730 00006B1F C3                      		retn
 13731                                  SkipBad:
 13732 00006B20 B003                    		mov	al, 3
 13733 00006B22 F9                      		stc
 13734 00006B23 C3                      		retn
 13735                                  
 13736                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13737                                  
 13738                                  		; 09/09/2022
 13739                                  		; 07/09/2022
 13740                                  CopyComponent:
 13741 00006B24 83EC0E                  		sub	sp, 14
 13742 00006B27 1E                      		push	ds
 13743 00006B28 56                      		push	si
 13744 00006B29 06                      		push	es
 13745 00006B2A 57                      		push	di
 13746 00006B2B 55                      		push	bp
 13747 00006B2C 89E5                    		mov	bp, sp
 13748 00006B2E B42E                    		mov	ah, '.'
 13749 00006B30 AC                      		lodsb
 13750 00006B31 AA                      		stosb
 13751 00006B32 38E0                    		cmp	al, ah
 13752 00006B34 7518                    		jnz	short NormalComp
 13753 00006B36 E8CEFF                  		call	PathSep
 13754 00006B39 740B                    		jz	short NulTerm
 13755                                  TryTwoDot:
 13756 00006B3B AC                      		lodsb
 13757 00006B3C AA                      		stosb
 13758 00006B3D 38E0                    		cmp	al, ah
 13759 00006B3F 7557                    		jnz	short CopyBad
 13760 00006B41 E8C3FF                  		call	PathSep
 13761 00006B44 7552                    		jnz	short CopyBad
 13762                                  NulTerm:
 13763 00006B46 30C0                    		xor	al, al
 13764 00006B48 AA                      		stosb
 13765 00006B49 897606                  		mov	[bp+6],	si
 13766 00006B4C EB47                    		jmp	short _GoodRet
 13767                                  NormalComp:
 13768 00006B4E 8B7606                  		mov	si, [bp+6]
 13769 00006B51 E895E9                  		call	NameTrans
 13770 00006B54 3B7606                  		cmp	si, [bp+6]
 13771 00006B57 743F                    		jz	short CopyBad
 13772 00006B59 36F606[0D05]FF          		test	byte [ss:fSharing], -1
 13773 00006B5F 7510                    		jnz	short DoPack
 13774 00006B61 80E201                  		and	dl, 1
 13775 00006B64 360016[1505]            		add	byte [ss:cMeta], dl
 13776 00006B69 7F2D                    		jg	short CopyBad
 13777 00006B6B 7504                    		jnz	short DoPack
 13778 00006B6D 08D2                    		or	dl, dl
 13779 00006B6F 742F                    		jz	short CopyBadPath
 13780                                  DoPack:
 13781 00006B71 897606                  		mov	[bp+6],	si
 13782 00006B74 16                      		push	ss
 13783 00006B75 1F                      		pop	ds
 13784 00006B76 BE[E604]                		mov	si, NAME1
 13785 00006B79 8D7E0A                  		lea	di, [bp+10]
 13786 00006B7C 57                      		push	di
 13787 00006B7D E898C1                  		call	PackName
 13788 00006B80 5F                      		pop	di
 13789 00006B81 E8AEB2                  		call	StrLen
 13790 00006B84 49                      		dec	cx
 13791 00006B85 034E02                  		add	cx, [bp+2]
 13792 00006B88 3B4E00                  		cmp	cx, [bp+0]
 13793 00006B8B 730B                    		jnb	short CopyBad
 13794 00006B8D 89FE                    		mov	si, di
 13795 00006B8F C47E02                  		les	di, [bp+2]
 13796 00006B92 E890B2                  		call	FStrCpy
 13797                                  _GoodRet:
 13798 00006B95 F8                      		clc
 13799 00006B96 EB0B                    		jmp	short CopyEnd
 13800                                  CopyBad:
 13801 00006B98 F9                      		stc
 13802 00006B99 E8F300                  		call	ScanPathChar
 13803 00006B9C B002                    		mov	al, 2
 13804 00006B9E 7503                    		jnz	short CopyEnd
 13805                                  CopyBadPath:
 13806 00006BA0 F9                      		stc
 13807 00006BA1 B003                    		mov	al, 3
 13808                                  CopyEnd:
 13809 00006BA3 5D                      		pop	bp
 13810 00006BA4 5F                      		pop	di
 13811 00006BA5 07                      		pop	es
 13812 00006BA6 5E                      		pop	si
 13813 00006BA7 1F                      		pop	ds
 13814 00006BA8 9F                      		lahf
 13815 00006BA9 83C40E                  		add	sp, 14
 13816 00006BAC E883B2                  		call	StrLen
 13817 00006BAF 49                      		dec	cx
 13818 00006BB0 9E                      		sahf
 13819 00006BB1 C3                      		retn
 13820                                  
 13821                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13822                                  
 13823                                  		; 07/09/2022
 13824                                  Splice:
 13825 00006BB2 36F606[5A00]FF          		test	byte [ss:SPLICES], -1
 13826 00006BB8 746A                    		jz	short AllDone
 13827 00006BBA 36FF36[3A05]            		push	word [ss:THISCDS]
 13828 00006BBF 36FF36[3C05]            		push	word [ss:THISCDS+2]
 13829 00006BC4 1E                      		push	ds
 13830 00006BC5 56                      		push	si
 13831 00006BC6 5F                      		pop	di
 13832 00006BC7 07                      		pop	es
 13833 00006BC8 31C0                    		xor	ax, ax
 13834                                  SpliceScan:
 13835 00006BCA E8D5FC                  		call	GetCDSFromDrv
 13836 00006BCD 724B                    		jb	short SpliceDone
 13837 00006BCF FEC0                    		inc	al
 13838 00006BD1 F744430020              		test	word [si+67], 2000h
 13839 00006BD6 74F2                    		jz	short SpliceScan
 13840 00006BD8 57                      		push	di
 13841 00006BD9 E89A00                  		call	PathPref
 13842 00006BDC 7403                    		jz	short SpliceFound
 13843                                  SpliceSkip:
 13844 00006BDE 5F                      		pop	di
 13845 00006BDF EBE9                    		jmp	short SpliceScan
 13846                                  SpliceFound:
 13847 00006BE1 26803D00                		cmp	byte [es:di], 0
 13848 00006BE5 7508                    		jnz	short SpliceDo
 13849 00006BE7 36F606[F802]FF          		test	byte [ss:NoSetDir], -1
 13850 00006BED 75EF                    		jnz	short SpliceSkip
 13851                                  SpliceDo:
 13852 00006BEF 89FE                    		mov	si, di
 13853 00006BF1 06                      		push	es
 13854 00006BF2 1F                      		pop	ds
 13855 00006BF3 5F                      		pop	di
 13856 00006BF4 E87900                  		call	TextFromDrive1
 13857 00006BF7 36A1[4E05]              		mov	ax, [ss:CURR_DIR_END]
 13858 00006BFB 09C0                    		or	ax, ax
 13859 00006BFD 7808                    		js	short NoPoke
 13860 00006BFF 01F8                    		add	ax, di
 13861 00006C01 29F0                    		sub	ax, si
 13862 00006C03 36A3[4E05]              		mov	[ss:CURR_DIR_END], ax
 13863                                  NoPoke:
 13864 00006C07 803C00                  		cmp	byte [si], 0
 13865 00006C0A 7503                    		jnz	short SpliceCopy
 13866 00006C0C B05C                    		mov	al, '\'
 13867 00006C0E AA                      		stosb
 13868                                  SpliceCopy:
 13869 00006C0F E813B2                  		call	FStrCpy
 13870 00006C12 83C404                  		add	sp, 4
 13871 00006C15 80C901                  		or	cl, 1
 13872 00006C18 EB0C                    		jmp	short DoSet
 13873                                  SpliceDone:
 13874 00006C1A 368F06[3C05]            		pop	word [ss:THISCDS+2]
 13875 00006C1F 368F06[3A05]            		pop	word [ss:THISCDS]
 13876                                  AllDone:
 13877 00006C24 31C9                    		xor	cx, cx
 13878                                  DoSet:
 13879 00006C26 36C536[3A05]            		lds	si, [ss:THISCDS]
 13880 00006C2B C47C45                  		les	di, [si+69]
 13881 00006C2E 36893E[2405]            		mov	word [ss:THISDPB], di
 13882 00006C33 368C06[2605]            		mov	word [ss:THISDPB+2], es
 13883                                  Splice_retn:
 13884 00006C38 C3                      		retn
 13885                                  
 13886                                  ; ---------------------------------------------------------------------------
 13887                                  
 13888                                  		; 07/09/2022
 13889                                  _$NameTrans:
 13890 00006C39 1E                      		push	ds
 13891 00006C3A 56                      		push	si
 13892 00006C3B 06                      		push	es
 13893 00006C3C 57                      		push	di
 13894 00006C3D BF[6003]                		mov	di, OPENBUF
 13895 00006C40 E8E7FC                  		call	TransPath
 13896 00006C43 5F                      		pop	di
 13897 00006C44 07                      		pop	es
 13898 00006C45 5E                      		pop	si
 13899 00006C46 1F                      		pop	ds
 13900 00006C47 7303                    		jnb	short TransOK
 13901 00006C49 E926AA                  		jmp	SYS_Ret_Err
 13902                                  TransOK:
 13903 00006C4C BE[6003]                		mov	si, OPENBUF
 13904 00006C4F 16                      		push	ss
 13905 00006C50 1F                      		pop	ds
 13906                                  GotText:
 13907 00006C51 E8D1B1                  		call	FStrCpy
 13908 00006C54 E90FAA                  		jmp	SYS_RET_OK
 13909                                  
 13910                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13911                                  
 13912                                  		; 07/09/2022
 13913                                  DriveFromText:
 13914 00006C57 30C0                    		xor	al, al
 13915 00006C59 803C00                  		cmp	byte [si], 0
 13916 00006C5C 74DA                    		jz	short Splice_retn
 13917 00006C5E 807C013A                		cmp	byte [si+1], ':'
 13918 00006C62 75D4                    		jnz	short Splice_retn
 13919 00006C64 AD                      		lodsw
 13920 00006C65 0C20                    		or	al, 20h
 13921 00006C67 2C60                    		sub	al, 60h
 13922 00006C69 75CD                    		jnz	short Splice_retn
 13923 00006C6B B0FF                    		mov	al, -1
 13924 00006C6D C3                      		retn
 13925                                  
 13926                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13927                                  
 13928                                  		; 07/09/2022
 13929                                  TextFromDrive:
 13930 00006C6E FEC0                    		inc	al
 13931                                  
 13932                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13933                                  
 13934                                  		; 07/09/2022
 13935                                  TextFromDrive1:
 13936 00006C70 0440                    		add	al, 40h
 13937 00006C72 B43A                    		mov	ah, ':'
 13938 00006C74 AB                      		stosw
 13939                                  PathPref_retn:
 13940 00006C75 C3                      		retn
 13941                                  
 13942                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13943                                  
 13944                                  		; 07/09/2022
 13945                                  PathPref:
 13946 00006C76 E8C7B1                  		call	DStrLen
 13947 00006C79 49                      		dec	cx
 13948 00006C7A F3A6                    		repe cmpsb
 13949 00006C7C 75F7                    		jnz	short PathPref_retn
 13950 00006C7E 50                      		push	ax
 13951 00006C7F 8A44FF                  		mov	al, [si-1]
 13952 00006C82 E8CBE8                  		call	PATHCHRCMP
 13953 00006C85 7406                    		jz	short Prefix
 13954                                  NotSep:
 13955 00006C87 268A05                  		mov	al, [es:di]
 13956 00006C8A E87CFE                  		call	PathSepGotCh
 13957                                  Prefix:
 13958 00006C8D 58                      		pop	ax
 13959 00006C8E C3                      		retn
 13960                                  
 13961                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13962                                  
 13963                                  		; 07/09/2022
 13964                                  ScanPathChar:
 13965 00006C8F AC                      		lodsb
 13966 00006C90 E876FE                  		call	PathSepGotCh
 13967 00006C93 75FA                    		jnz	short ScanPathChar
 13968 00006C95 E8B8E8                  		call	PATHCHRCMP
 13969 00006C98 C3                      		retn
 13970                                  
 13971                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 13972                                  
 13973                                  		; 07/09/2022
 13974                                  _$CLOSE:
 13975 00006C99 E84D02                  		call	CheckOwner
 13976 00006C9C 722B                    		jb	short CloseError
 13977 00006C9E 16                      		push	ss
 13978 00006C9F 1F                      		pop	ds
 13979 00006CA0 893E[3605]              		mov	word [THISSFT], di
 13980 00006CA4 8C06[3805]              		mov	word [THISSFT+2], es
 13981 00006CA8 26833D01                		cmp	word [es:di], 1
 13982 00006CAC 740A                    		jz	short FreeJFN
 13983 00006CAE 268A4502                		mov	al, [es:di+2]
 13984 00006CB2 24F0                    		and	al, 0F0h
 13985 00006CB4 3C70                    		cmp	al, 70h
 13986 00006CB6 7407                    		jz	short PostFree
 13987                                  FreeJFN:
 13988 00006CB8 E8F2F9                  		call	pJFNFromHandle
 13989 00006CBB 26C605FF                		mov	byte [es:di], 0FFh
 13990                                  PostFree:
 13991 00006CBF E80DCD                  		call	DOS_CLOSE
 13992 00006CC2 7205                    		jb	short CloseError
 13993 00006CC4 B43E                    		mov	ah, 3Eh
 13994                                  Sys_Ret_OK_j1:
 13995 00006CC6 E99DA9                  		jmp	SYS_RET_OK
 13996                                  CloseError:
 13997 00006CC9 E9A6A9                  		jmp	SYS_Ret_Err
 13998                                  
 13999                                  ; ---------------------------------------------------------------------------
 14000                                  
 14001                                  		; 07/09/2022
 14002                                  _$COMMIT:
 14003 00006CCC E81A02                  		call	CheckOwner
 14004 00006CCF 7213                    		jb	short CommitError
 14005 00006CD1 16                      		push	ss
 14006 00006CD2 1F                      		pop	ds
 14007 00006CD3 893E[3605]              		mov	word [THISSFT], di
 14008 00006CD7 8C06[3805]              		mov	word [THISSFT+2], es
 14009 00006CDB E8F2CD                  		call	DOS_COMMIT
 14010 00006CDE 7204                    		jb	short CommitError
 14011 00006CE0 B468                    		mov	ah, 68h
 14012                                  Sys_Ret_OK_j2:
 14013 00006CE2 EBE2                    		jmp	short Sys_Ret_OK_j1
 14014                                  CommitError:
 14015 00006CE4 EBE3                    		jmp	short CloseError
 14016                                  
 14017                                  ; ---------------------------------------------------------------------------
 14018                                  
 14019                                  		; 07/09/2022
 14020                                  _$ExtHandle:
 14021 00006CE6 31ED                    		xor	bp, bp
 14022 00006CE8 83FB14                  		cmp	bx, 20
 14023 00006CEB 7303                    		jnb	short exth2
 14024 00006CED BB1400                  		mov	bx, 20
 14025                                  exth2:
 14026 00006CF0 368E06[DE02]            		mov	es, [ss:CurrentPDB]
 14027 00006CF5 268B0E[3200]            		mov	cx, word [es:BCON]
 14028 00006CFA 39CB                    		cmp	bx, cx
 14029 00006CFC 7452                    		jz	short ok_done
 14030 00006CFE 7723                    		ja	short larger
 14031 00006D00 BD0100                  		mov	bp, 1
 14032 00006D03 268E1E[3600]            		mov	ds, [es:MAXSEC]
 14033 00006D08 89DE                    		mov	si, bx
 14034 00006D0A 29D9                    		sub	cx, bx
 14035                                  chck_handles:
 14036 00006D0C 803CFF                  		cmp	byte [si], -1
 14037 00006D0F 7541                    		jnz	short too_many_files
 14038 00006D11 46                      		inc	si
 14039 00006D12 E2F8                    		loop	chck_handles
 14040 00006D14 83FB14                  		cmp	bx, 20
 14041 00006D17 770A                    		ja	short larger
 14042 00006D19 BD0200                  		mov	bp, 2
 14043 00006D1C BF1800                  		mov	di, 24
 14044 00006D1F 53                      		push	bx
 14045 00006D20 EB1E                    		jmp	short movhandl
 14046                                  
 14047 00006D22 90                      		nop
 14048                                  larger:
 14049 00006D23 83FBFF                  		cmp	bx, 0FFFFh
 14050 00006D26 747F                    		jz	short invalid_func
 14051 00006D28 F8                      		clc
 14052 00006D29 53                      		push	bx
 14053 00006D2A 83C30F                  		add	bx, 0Fh
 14054 00006D2D B104                    		mov	cl, 4
 14055 00006D2F D3CB                    		ror	bx, cl
 14056 00006D31 81E3FF1F                		and	bx, 1FFFh
 14057 00006D35 55                      		push	bp
 14058 00006D36 E8E5F6                  		call	_$ALLOC
 14059 00006D39 5D                      		pop	bp
 14060 00006D3A 7266                    		jb	short no_memory
 14061 00006D3C 8EC0                    		mov	es, ax
 14062 00006D3E 31FF                    		xor	di, di
 14063                                  movhandl:
 14064 00006D40 368E1E[DE02]            		mov	ds, [ss:CurrentPDB]
 14065 00006D45 F7C50300                		test	bp, 3
 14066 00006D49 740B                    		jz	short enlarge
 14067 00006D4B 59                      		pop	cx
 14068 00006D4C 51                      		push	cx
 14069 00006D4D EB0B                    		jmp	short copy_hand
 14070                                  
 14071 00006D4F 90                      		nop
 14072                                  ok_done:
 14073 00006D50 EB90                    		jmp	short Sys_Ret_OK_j2
 14074                                  too_many_files:
 14075 00006D52 B004                    		mov	al, 4
 14076                                  ExtHandle_err_j1:
 14077 00006D54 EB8E                    		jmp	short CommitError
 14078                                  enlarge:
 14079 00006D56 8B0E[3200]              		mov	cx, word [BCON]
 14080                                  copy_hand:
 14081 00006D5A 89CA                    		mov	dx, cx
 14082 00006D5C C536[3400]              		lds	si, [BCON+2]
 14083 00006D60 F3A4                    		rep movsb
 14084 00006D62 59                      		pop	cx
 14085 00006D63 51                      		push	cx
 14086 00006D64 29D1                    		sub	cx, dx
 14087 00006D66 B0FF                    		mov	al, -1
 14088 00006D68 F3AA                    		rep stosb
 14089 00006D6A 368E1E[DE02]            		mov	ds, [ss:CurrentPDB]
 14090 00006D6F 833E[3400]00            		cmp	word [BCON+2], 0
 14091 00006D74 750D                    		jnz	short update_info
 14092 00006D76 55                      		push	bp
 14093 00006D77 1E                      		push	ds
 14094 00006D78 06                      		push	es
 14095 00006D79 8E06[3600]              		mov	es, [MAXSEC]
 14096 00006D7D E8BBF7                  		call	_$DEALLOC
 14097 00006D80 07                      		pop	es
 14098 00006D81 1F                      		pop	ds
 14099 00006D82 5D                      		pop	bp
 14100                                  update_info:
 14101 00006D83 F7C50200                		test	bp, 2
 14102 00006D87 7409                    		jz	short non_psp
 14103 00006D89 C706[3400]1800          		mov	word [BCON+2], 18h
 14104 00006D8F EB07                    		jmp	short final
 14105                                  
 14106 00006D91 90                      		nop
 14107                                  non_psp:
 14108 00006D92 C706[3400]0000          		mov	word [BCON+2], 0
 14109                                  final:
 14110 00006D98 8C06[3600]              		mov	[MAXSEC], es
 14111 00006D9C 8F06[3200]              		pop	word [BCON]
 14112                                  ExtHandle_ok:
 14113 00006DA0 EBAE                    		jmp	short ok_done
 14114                                  no_memory:
 14115 00006DA2 5B                      		pop	bx
 14116 00006DA3 B008                    		mov	al, 8
 14117                                  ExtHandle_errj_2:
 14118 00006DA5 EBAD                    		jmp	short ExtHandle_err_j1
 14119                                  
 14120                                  ; ---------------------------------------------------------------------------
 14121                                  
 14122                                  		; 07/09/2022
 14123                                  invalid_func:
 14124 00006DA7 B001                    		mov	al, 1
 14125                                  ExtHandle_errj_3:
 14126 00006DA9 EBFA                    		jmp	short ExtHandle_errj_2
 14127                                  
 14128                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14129                                  
 14130                                  		; 07/09/2022
 14131                                  _$READ:
 14132 00006DAB BE[133D]                		mov	si, DOS_READ
 14133                                  ReadDo:
 14134 00006DAE E8FCF8                  		call	pJFNFromHandle
 14135 00006DB1 7208                    		jb	short ReadError
 14136 00006DB3 268A05                  		mov	al, [es:di]
 14137 00006DB6 E83001                  		call	CheckOwner
 14138 00006DB9 7302                    		jnb	short ReadSetup
 14139                                  ReadError:
 14140 00006DBB EBEC                    		jmp	short ExtHandle_errj_3
 14141                                  ReadSetup:
 14142 00006DBD 36893E[3605]            		mov	word [ss:THISSFT], di
 14143 00006DC2 368C06[3805]            		mov	word [ss:THISSFT+2], es
 14144 00006DC7 36FF36[DA02]            		push	word [ss:DMAADD]
 14145 00006DCC 36FF36[DC02]            		push	word [ss:DMAADD+2]
 14146 00006DD1 89D3                    		mov	bx, dx
 14147 00006DD3 51                      		push	cx
 14148 00006DD4 B104                    		mov	cl, 4
 14149 00006DD6 D3EB                    		shr	bx, cl
 14150 00006DD8 59                      		pop	cx
 14151 00006DD9 8CD8                    		mov	ax, ds
 14152 00006DDB 01D8                    		add	ax, bx
 14153 00006DDD 8ED8                    		mov	ds, ax
 14154                                  		;and	dx, 0Fh
 14155                                  		; 09/09/2022 - Temporary !
 14156 00006DDF 81E20F00                		db	81h, 0E2h, 0Fh, 0
 14157 00006DE3 368916[DA02]            		mov	[ss:DMAADD], dx
 14158 00006DE8 368C1E[DC02]            		mov	[ss:DMAADD+2], ds
 14159 00006DED 16                      		push	ss
 14160 00006DEE 1F                      		pop	ds
 14161 00006DEF FFD6                    		call	si ; DOS_READ or DOS_WRITE
 14162 00006DF1 8F06[DC02]              		pop	word [DMAADD+2]
 14163 00006DF5 8F06[DA02]              		pop	word [DMAADD]
 14164 00006DF9 72C0                    		jb	short ReadError
 14165 00006DFB 89C8                    		mov	ax, cx
 14166                                  _READ_OK:
 14167 00006DFD EBA1                    		jmp	short ExtHandle_ok
 14168                                  
 14169                                  ; ---------------------------------------------------------------------------
 14170                                  
 14171                                  		; 07/09/2022
 14172                                  _$WRITE:
 14173 00006DFF BE[983E]                		mov	si, DOS_WRITE
 14174 00006E02 EBAA                    		jmp	short ReadDo
 14175                                  
 14176                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14177                                  
 14178                                  		; 07/09/2022
 14179                                  _$LSEEK:
 14180 00006E04 E8E200                  		call	CheckOwner
 14181                                  LSeekError:
 14182 00006E07 72B2                    		jb	short ReadError
 14183 00006E09 3C02                    		cmp	al, 2
 14184 00006E0B 760A                    		jbe	short LSeekDisp
 14185 00006E0D 36C606[D102]01          		mov	byte [ss:EXTERR_LOCUS], 1
 14186 00006E13 B001                    		mov	al, 1
 14187                                  LSeekError_j1:
 14188 00006E15 EBA4                    		jmp	short ReadError
 14189                                  LSeekDisp:
 14190 00006E17 3C01                    		cmp	al, 1
 14191 00006E19 720A                    		jb	short LSeekStore
 14192 00006E1B 771B                    		ja	short LSeekEOF
 14193 00006E1D 26035515                		add	dx, [es:di+15h]
 14194 00006E21 26134D17                		adc	cx, [es:di+17h]
 14195                                  LSeekStore:
 14196 00006E25 89C8                    		mov	ax, cx
 14197 00006E27 92                      		xchg	ax, dx
 14198                                  LSeekSetpos:
 14199 00006E28 26894515                		mov	[es:di+15h], ax
 14200 00006E2C 26895517                		mov	[es:di+17h], dx
 14201 00006E30 E860A7                  		call	Get_User_Stack
 14202 00006E33 895406                  		mov	[si+6],	dx
 14203                                  LSeek_ok:
 14204 00006E36 EBC5                    		jmp	short _READ_OK
 14205                                  LSeekEOF:
 14206 00006E38 26F745050080            		test	word [es:di+5], 8000h
 14207 00006E3E 750A                    		jnz	short Check_LSeek_Mode
 14208                                  LOCAL_LSeek:
 14209 00006E40 26035511                		add	dx, [es:di+11h]
 14210 00006E44 26134D13                		adc	cx, [es:di+13h]
 14211 00006E48 EBDB                    		jmp	short LSeekStore
 14212                                  Check_LSeek_Mode:
 14213 00006E4A 26F745020080            		test	word [es:di+2], 8000h
 14214 00006E50 75EE                    		jnz	short LOCAL_LSeek
 14215 00006E52 268B4502                		mov	ax, [es:di+2]
 14216 00006E56 25F000                  		and	ax, 0F0h
 14217 00006E59 83F840                  		cmp	ax, 40h
 14218 00006E5C 7405                    		jz	short NET_LSEEK
 14219 00006E5E 83F830                  		cmp	ax, 30h
 14220 00006E61 75DD                    		jnz	short LOCAL_LSeek
 14221                                  NET_LSEEK:
 14222 00006E63 B82111                  		mov	ax, 1121h
 14223 00006E66 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - SEEK	FROM END OF REMOTE FILE
 14224                                  					; CX:DX	= offset (in bytes) from end
 14225                                  					; ES:DI	-> SFT,	SFT DPB	field -> DPB of	drive with file
 14226                                  					; SS = DOS CS
 14227                                  					; Return: CF set on error
 14228                                  					; CF clear if successful, DX:AX	= new file position
 14229 00006E68 73BE                    		jnb	short LSeekSetpos
 14230                                  LSeekError_j2:
 14231 00006E6A EBA9                    		jmp	short LSeekError_j1
 14232                                  
 14233                                  ; ---------------------------------------------------------------------------
 14234                                  
 14235                                  		; 09/09/2022
 14236                                  		; 07/09/2022
 14237                                  _$FILE_TIMES:
 14238 00006E6C 3C02                    		cmp	al, 2
 14239 00006E6E 720A                    		jb	short ft1
 14240 00006E70 36C606[D102]01          		mov	byte [ss:EXTERR_LOCUS], 1
 14241 00006E76 B001                    		mov	al, 1
 14242                                  ft_err_j:
 14243 00006E78 EBF0                    		jmp	short LSeekError_j2
 14244                                  ft1:
 14245 00006E7A E86C00                  		call	CheckOwner
 14246 00006E7D 7288                    		jb	short LSeekError
 14247 00006E7F 08C0                    		or	al, al
 14248 00006E81 7515                    		jnz	short ft_set_time
 14249 00006E83 FA                      		cli
 14250 00006E84 268B4D0D                		mov	cx, [es:di+0Dh]
 14251 00006E88 268B550F                		mov	dx, [es:di+0Fh]
 14252 00006E8C FB                      		sti
 14253 00006E8D E803A7                  		call	Get_User_Stack
 14254 00006E90 894C04                  		mov	[si+4],	cx
 14255 00006E93 895406                  		mov	[si+6],	dx
 14256                                  ft_ok:
 14257 00006E96 EB9E                    		jmp	short LSeek_ok
 14258                                  ft_set_time:
 14259 00006E98 E89AB0                  		call	EcritDisk
 14260 00006E9B 26894D0D                		mov	[es:di+0Dh], cx
 14261 00006E9F 2689550F                		mov	[es:di+0Fh], dx
 14262 00006EA3 31C0                    		xor	ax, ax
 14263 00006EA5 36FF1E[9400]            		call	far [ss:ShSU]
 14264                                  		;and	word [es:di+5], 0FFBFh ; 14/09/2022
 14265                                  		; 09/09/2022 - Temporary !
 14266 00006EAA 26816505BFFF            		db	26h, 81h, 65h, 05h, 0BFh, 0FFh
 14267 00006EB0 26814D050040            		or	word [es:di+5], 4000h
 14268 00006EB6 E884B0                  		call	LcritDisk
 14269                                  ok_ret:
 14270 00006EB9 EBDB                    		jmp	short ft_ok
 14271                                  ; ---------------------------------------------------------------------------
 14272                                  
 14273                                  		; 07/09/2022
 14274                                  _$DUP:
 14275 00006EBB 89D8                    		mov	ax, bx
 14276 00006EBD E848F8                  		call	JFNFree
 14277                                  DupErrorCheck:
 14278 00006EC0 7217                    		jb	short DupErr
 14279 00006EC2 06                      		push	es
 14280 00006EC3 57                      		push	di
 14281 00006EC4 5E                      		pop	si
 14282 00006EC5 1F                      		pop	ds
 14283 00006EC6 93                      		xchg	ax, bx
 14284 00006EC7 E81F00                  		call	CheckOwner
 14285 00006ECA 720D                    		jb	short DupErr
 14286 00006ECC E807C7                  		call	DOS_Dup_Direct
 14287 00006ECF E8DBF7                  		call	pJFNFromHandle
 14288 00006ED2 268A1D                  		mov	bl, [es:di]
 14289 00006ED5 881C                    		mov	[si], bl
 14290 00006ED7 EBE0                    		jmp	short ok_ret
 14291                                  DupErr:
 14292 00006ED9 EB9D                    		jmp	short ft_err_j
 14293                                  
 14294                                  ; ---------------------------------------------------------------------------
 14295                                  		
 14296                                  		; 07/09/2022
 14297                                  _$DUP2:
 14298 00006EDB 53                      		push	bx
 14299 00006EDC 51                      		push	cx
 14300 00006EDD 89CB                    		mov	bx, cx
 14301 00006EDF E8B7FD                  		call	_$CLOSE
 14302 00006EE2 5B                      		pop	bx
 14303 00006EE3 58                      		pop	ax
 14304 00006EE4 E8C6F7                  		call	pJFNFromHandle
 14305 00006EE7 EBD7                    		jmp	short DupErrorCheck
 14306                                  
 14307                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14308                                  
 14309                                  		; 07/09/2022
 14310                                  CheckOwner:
 14311 00006EE9 E8DAF7                  		call	SFFromHandle
 14312 00006EEC 7301                    		jnb	short no_win386
 14313                                  _ret_label:
 14314 00006EEE C3                      		retn
 14315                                  no_win386:
 14316 00006EEF 50                      		push	ax
 14317 00006EF0 36A1[EA02]              		mov	ax, [ss:USER_ID]
 14318 00006EF4 263B452F                		cmp	ax, [es:di+47]
 14319 00006EF8 58                      		pop	ax
 14320 00006EF9 74F3                    		jz	short _ret_label
 14321 00006EFB B006                    		mov	al, 6
 14322 00006EFD F9                      		stc
 14323 00006EFE C3                      		retn
 14324                                  
 14325                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14326                                  
 14327                                  		; 07/09/2022
 14328                                  _$OPEN:
 14329 00006EFF B516                    		mov	ch, 16h
 14330 00006F01 E80A02                  		call	SetAttrib
 14331 00006F04 B9[7936]                		mov	cx, DOS_OPEN
 14332 00006F07 30E4                    		xor	ah, ah
 14333 00006F09 50                      		push	ax
 14334                                  AccessFile:
 14335 00006F0A E828B0                  		call	EcritDisk
 14336 00006F0D E80BF8                  		call	SFNFree
 14337 00006F10 E82AB0                  		call	LcritDisk
 14338 00006F13 7214                    		jb	short OpenFailJ
 14339 00006F15 36891E[4205]            		mov	[ss:SFN], bx
 14340 00006F1A 36893E[3605]            		mov	word [ss:THISSFT], di
 14341 00006F1F 368C06[3805]            		mov	word [ss:THISSFT+2], es
 14342 00006F24 E8E1F7                  		call	JFNFree
 14343 00006F27 7303                    		jnb	short SaveJFN
 14344                                  OpenFailJ:
 14345 00006F29 E98600                  		jmp	OpenFail
 14346                                  SaveJFN:
 14347 00006F2C 36893E[4605]            		mov	word [ss:PJFN], di
 14348 00006F31 368C06[4805]            		mov	word [ss:PJFN+2], es
 14349 00006F36 36891E[4405]            		mov	[ss:JFN], bx
 14350 00006F3B 368B1E[4205]            		mov	bx, [ss:SFN]
 14351 00006F40 26881D                  		mov	[es:di], bl
 14352 00006F43 89D6                    		mov	si, dx
 14353 00006F45 BF[6003]                		mov	di, OPENBUF
 14354 00006F48 51                      		push	cx
 14355 00006F49 E8DEF9                  		call	TransPath
 14356 00006F4C 5B                      		pop	bx
 14357 00006F4D 36C536[3605]            		lds	si, [ss:THISSFT]
 14358 00006F52 720A                    		jb	short OpenCleanJ
 14359 00006F54 36803E[1505]FF          		cmp	byte [ss:cMeta], -1
 14360 00006F5A 7405                    		jz	short SetSearch
 14361 00006F5C B002                    		mov	al, 2
 14362                                  OpenCleanJ:
 14363 00006F5E EB43                    		jmp	short OpenClean
 14364                                  
 14365 00006F60 90                      		nop
 14366                                  SetSearch:
 14367 00006F61 58                      		pop	ax
 14368 00006F62 31C9                    		xor	cx, cx
 14369 00006F64 81FB[7936]              		cmp	bx, DOS_OPEN
 14370 00006F68 7509                    		jnz	short _DoOper
 14371 00006F6A A880                    		test	al, 80h
 14372 00006F6C 7405                    		jz	short _DoOper
 14373 00006F6E 247F                    		and	al, 7Fh
 14374 00006F70 B90010                  		mov	cx, 1000h
 14375                                  _DoOper:
 14376 00006F73 C744020000              		mov	word [si+2], 0
 14377 00006F78 C744330000              		mov	word [si+51], 0
 14378 00006F7D 16                      		push	ss
 14379 00006F7E 1F                      		pop	ds
 14380 00006F7F 51                      		push	cx
 14381 00006F80 FFD3                    		call	bx
 14382 00006F82 59                      		pop	cx
 14383 00006F83 C536[3605]              		lds	si, [THISSFT]
 14384 00006F87 721B                    		jb	short OpenE
 14385                                  OpenOK:
 14386 00006F89 C7040100                		mov	word [si], 1
 14387 00006F8D 094C05                  		or	[si+5],	cx
 14388 00006F90 36A1[4405]              		mov	ax, [ss:JFN]
 14389 00006F94 36FF1E[8C00]            		call	far [ss:ShCol]
 14390 00006F99 36C706[4205]FFFF        		mov	word [ss:SFN], -1
 14391                                  OpenOKJ:
 14392 00006FA0 E9C3A6                  		jmp	SYS_RET_OK
 14393                                  OpenClean:
 14394 00006FA3 5B                      		pop	bx
 14395                                  OpenE:
 14396 00006FA4 C7040000                		mov	word [si], 0
 14397 00006FA8 36C536[4605]            		lds	si, [ss:PJFN]
 14398 00006FAD C604FF                  		mov	byte [si], 0FFh
 14399 00006FB0 EB02                    		jmp	short OpenCritLeave
 14400                                  OpenFail:
 14401 00006FB2 FB                      		sti
 14402 00006FB3 59                      		pop	cx
 14403                                  OpenCritLeave:
 14404 00006FB4 36C706[4205]FFFF        		mov	word [ss:SFN], -1
 14405                                  OpenErrJ:
 14406 00006FBB E9B4A6                  		jmp	SYS_Ret_Err
 14407                                  
 14408                                  ; ---------------------------------------------------------------------------
 14409                                  
 14410                                  		; 07/09/2022
 14411                                  _$CREAT:
 14412 00006FBE 51                      		push	cx
 14413 00006FBF B9[E235]                		mov	cx, DOS_CREATE
 14414                                  AccessSet:
 14415 00006FC2 36C606[0805]06          		mov	byte [ss:ExtFCB+1], 6
 14416 00006FC8 E93FFF                  		jmp	AccessFile
 14417                                  
 14418                                  ; ---------------------------------------------------------------------------
 14419                                  
 14420                                  		; 07/09/2022
 14421                                  _$CHMOD:
 14422 00006FCB BF[6003]                		mov	di, OPENBUF
 14423 00006FCE 50                      		push	ax
 14424 00006FCF 51                      		push	cx
 14425 00006FD0 89D6                    		mov	si, dx
 14426 00006FD2 E859F9                  		call	TransPathSet
 14427 00006FD5 59                      		pop	cx
 14428 00006FD6 58                      		pop	ax
 14429 00006FD7 7233                    		jb	short ChModErr
 14430 00006FD9 16                      		push	ss
 14431 00006FDA 1F                      		pop	ds
 14432 00006FDB 803E[1505]FF            		cmp	byte [cMeta], -1
 14433 00006FE0 752A                    		jnz	short ChModErr
 14434 00006FE2 C606[0805]16            		mov	byte [ExtFCB+1], 16h
 14435 00006FE7 2C01                    		sub	al, 1
 14436 00006FE9 720B                    		jb	short ChModGet
 14437 00006FEB 7416                    		jz	short ChModSet
 14438 00006FED C606[D102]01            		mov	byte [EXTERR_LOCUS], 1
 14439 00006FF2 B001                    		mov	al, 1
 14440                                  chmod_errj:
 14441 00006FF4 EBC5                    		jmp	short OpenErrJ
 14442                                  ChModGet:
 14443 00006FF6 E80BC5                  		call	GET_FILE_INFO
 14444 00006FF9 7213                    		jb	short ChModE
 14445 00006FFB E895A5                  		call	Get_User_Stack
 14446 00006FFE 894404                  		mov	[si+4],	ax
 14447                                  
 14448                                  chmod_ok_j1:
 14449 00007001 EB9D                    		jmp	short OpenOKJ
 14450                                  ChModSet:
 14451 00007003 89C8                    		mov	ax, cx
 14452 00007005 E84FC5                  		call	SET_FILE_ATTRIBUTE
 14453 00007008 7204                    		jb	short ChModE
 14454                                  chmod_ok_j2:
 14455 0000700A EBF5                    		jmp	short chmod_ok_j1
 14456                                  ChModErr:
 14457 0000700C B003                    		mov	al, 3
 14458                                  ChModE:
 14459 0000700E EBE4                    		jmp	short chmod_errj
 14460                                  
 14461                                  ; ---------------------------------------------------------------------------
 14462                                  
 14463                                  		; 07/09/2022
 14464                                  _$UNLINK:
 14465 00007010 51                      		push	cx
 14466 00007011 89D6                    		mov	si, dx
 14467 00007013 BF[6003]                		mov	di, OPENBUF
 14468 00007016 E815F9                  		call	TransPathSet
 14469 00007019 59                      		pop	cx
 14470 0000701A 72F0                    		jb	short ChModErr
 14471 0000701C 36803E[1505]FF          		cmp	byte [ss:cMeta], -1
 14472 00007022 750E                    		jnz	short NotFound
 14473 00007024 16                      		push	ss
 14474 00007025 1F                      		pop	ds
 14475 00007026 B506                    		mov	ch, 6
 14476 00007028 E8E300                  		call	SetAttrib
 14477 0000702B E850C1                  		call	DOS_DELETE
 14478 0000702E 7204                    		jb	short UnlinkE
 14479                                  unlink_ok_J:
 14480 00007030 EBD8                    		jmp	short chmod_ok_j2
 14481                                  NotFound:
 14482 00007032 B003                    		mov	al, 3
 14483                                  UnlinkE:
 14484 00007034 EBD8                    		jmp	short ChModE
 14485                                  
 14486                                  ; ---------------------------------------------------------------------------
 14487                                  
 14488                                  		; 07/09/2022
 14489                                  _$RENAME:
 14490 00007036 51                      		push	cx
 14491 00007037 1E                      		push	ds
 14492 00007038 52                      		push	dx
 14493 00007039 06                      		push	es
 14494 0000703A 1F                      		pop	ds
 14495 0000703B 89FE                    		mov	si, di
 14496 0000703D BF[E003]                		mov	di, RENBUF
 14497 00007040 E8EBF8                  		call	TransPathSet
 14498 00007043 36FF36[4A05]            		push	word [ss:WFP_START]
 14499 00007048 368F06[4C05]            		pop	word [ss:REN_WFP]
 14500 0000704D 5E                      		pop	si
 14501 0000704E 1F                      		pop	ds
 14502 0000704F 59                      		pop	cx
 14503                                  
 14504                                  epjc2:
 14505 00007050 72BA                    		jb	short ChModErr
 14506 00007052 36803E[1505]FF          		cmp	byte [ss:cMeta], -1
 14507 00007058 75D8                    		jnz	short NotFound
 14508 0000705A 51                      		push	cx
 14509 0000705B BF[6003]                		mov	di, OPENBUF
 14510 0000705E E8CDF8                  		call	TransPathSet
 14511 00007061 59                      		pop	cx
 14512 00007062 72EC                    		jb	short epjc2
 14513 00007064 16                      		push	ss
 14514 00007065 1F                      		pop	ds
 14515 00007066 803E[1505]FF            		cmp	byte [cMeta], -1
 14516 0000706B 72C5                    		jb	short NotFound
 14517 0000706D B516                    		mov	ch, 16h
 14518 0000706F E89C00                  		call	SetAttrib
 14519 00007072 E8BCC2                  		call	DOS_RENAME
 14520 00007075 72BD                    		jb	short UnlinkE
 14521 00007077 EBB7                    		jmp	short unlink_ok_J
 14522                                  
 14523                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14524                                  
 14525                                  		; 07/09/2022
 14526                                  _$CreateNewFile:
 14527 00007079 51                      		push	cx
 14528 0000707A B9[7436]                		mov	cx, DOS_Create_New
 14529 0000707D E942FF                  		jmp	AccessSet
 14530                                  
 14531                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14532                                  
 14533                                  		; 07/09/2022
 14534                                  BinToAscii:
 14535 00007080 B90400                  		mov	cx, 4
 14536                                  bta5:
 14537 00007083 51                      		push	cx
 14538 00007084 B104                    		mov	cl, 4
 14539 00007086 D3C0                    		rol	ax, cl
 14540 00007088 50                      		push	ax
 14541 00007089 240F                    		and	al, 0Fh
 14542 0000708B 0430                    		add	al, '0'
 14543 0000708D 3C39                    		cmp	al, '9'
 14544 0000708F 7602                    		jbe	short bta6
 14545 00007091 0407                    		add	al, 7
 14546                                  bta6:
 14547 00007093 AA                      		stosb
 14548 00007094 58                      		pop	ax
 14549 00007095 59                      		pop	cx
 14550 00007096 E2EB                    		loop	bta5
 14551 00007098 C3                      		retn
 14552                                  
 14553                                  ; ---------------------------------------------------------------------------
 14554                                  
 14555                                  		; 07/09/2022
 14556                                  _$CreateTempFile:
 14557 00007099 55                      		push	bp
 14558 0000709A 89E5                    		mov	bp, sp
 14559 0000709C 83EC0A                  		sub	sp, 10
 14560 0000709F F7C1D8FF                		test	cx, 0FFD8h
 14561 000070A3 7405                    		jz	short OKatts
 14562 000070A5 B80500                  		mov	ax, 5
 14563 000070A8 EB58                    		jmp	short SETTMPERR
 14564                                  OKatts:
 14565 000070AA 894EF6                  		mov	[bp-10], cx
 14566 000070AD 8956F8                  		mov	[bp-8],	dx
 14567 000070B0 8C5EFA                  		mov	word [bp-6], ds
 14568 000070B3 8C5EFE                  		mov	word [bp-2], ds
 14569 000070B6 1E                      		push	ds
 14570 000070B7 07                      		pop	es
 14571 000070B8 89D7                    		mov	di, dx
 14572 000070BA 89F9                    		mov	cx, di
 14573 000070BC F7D9                    		neg	cx
 14574 000070BE 31C0                    		xor	ax, ax
 14575 000070C0 F2AE                    		repne scasb
 14576 000070C2 4F                      		dec	di
 14577 000070C3 268A45FF                		mov	al, [es:di-1]
 14578 000070C7 E886E4                  		call	PATHCHRCMP
 14579 000070CA 7403                    		jz	short SETENDPTR
 14580                                  STOREPTH:
 14581 000070CC B05C                    		mov	al, '\'
 14582 000070CE AA                      		stosb
 14583                                  SETENDPTR:
 14584 000070CF 897EFC                  		mov	[bp-4],	di
 14585                                  CreateLoop:
 14586 000070D2 16                      		push	ss
 14587 000070D3 1F                      		pop	ds
 14588 000070D4 55                      		push	bp
 14589 000070D5 E875A7                  		call	READTIME
 14590 000070D8 5D                      		pop	bp
 14591 000070D9 C47EFC                  		les	di, [bp-4]
 14592 000070DC 89C8                    		mov	ax, cx
 14593 000070DE E89FFF                  		call	BinToAscii
 14594 000070E1 89D0                    		mov	ax, dx
 14595 000070E3 E89AFF                  		call	BinToAscii
 14596 000070E6 30C0                    		xor	al, al
 14597 000070E8 AA                      		stosb
 14598 000070E9 C556F8                  		lds	dx, [bp-8]
 14599 000070EC 8B4EF6                  		mov	cx, [bp-10]
 14600 000070EF 55                      		push	bp
 14601 000070F0 E886FF                  		call	_$CreateNewFile
 14602 000070F3 5D                      		pop	bp
 14603 000070F4 730D                    		jnb	short CreateDone
 14604 000070F6 36A1[D202]              		mov	ax, [ss:EXTERR]
 14605 000070FA 3C50                    		cmp	al, 50h
 14606 000070FC 74D4                    		jz	short CreateLoop
 14607 000070FE 3C05                    		cmp	al, 5
 14608 00007100 74D0                    		jz	short CreateLoop
 14609                                  SETTMPERR:
 14610 00007102 F9                      		stc
 14611                                  CreateDone:
 14612 00007103 89EC                    		mov	sp, bp
 14613 00007105 5D                      		pop	bp
 14614 00007106 7203                    		jb	short CreateFail
 14615 00007108 E95BA5                  		jmp	SYS_RET_OK
 14616                                  CreateFail:
 14617 0000710B E964A5                  		jmp	SYS_Ret_Err
 14618                                  
 14619                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14620                                  
 14621                                  		; 07/09/2022
 14622                                  SetAttrib:
 14623 0000710E 36F606[0D05]FF          		test	byte [ss:fSharing], -1
 14624 00007114 7502                    		jnz	short Set
 14625 00007116 88E9                    		mov	cl, ch
 14626                                  Set:
 14627 00007118 36880E[0805]            		mov	byte [ss:ExtFCB+1], cl
 14628 0000711D C3                      		retn
 14629                                  
 14630                                  ; ---------------------------------------------------------------------------
 14631                                  
 14632                                  		; 07/09/2022
 14633                                  _$LockOper:
 14634 0000711E 3C01                    		cmp	al, 1
 14635 00007120 770C                    		ja	short lock_bad_func
 14636 00007122 57                      		push	di
 14637 00007123 E8A0F5                  		call	SFFromHandle
 14638 00007126 7310                    		jnb	short lock_do
 14639 00007128 5F                      		pop	di
 14640 00007129 B006                    		mov	al, 6
 14641                                  LockOper_Err_J1:
 14642 0000712B E944A5                  		jmp	SYS_Ret_Err
 14643                                  lock_bad_func:
 14644 0000712E 36C606[D102]01          		mov	byte [ss:EXTERR_LOCUS], 1
 14645 00007134 B001                    		mov	al, 1
 14646                                  LockOper_Err_J2:
 14647 00007136 EBF3                    		jmp	short LockOper_Err_J1
 14648                                  
 14649                                  ; ---------------------------------------------------------------------------
 14650                                  
 14651                                  lock_do:
 14652 00007138 08C0                    		or	al, al
 14653 0000713A 58                      		pop	ax
 14654 0000713B 741D                    		jz	short DOS_Lock
 14655                                  
 14656 0000713D 26F745050080            		test	word [es:di+5], 8000h
 14657 00007143 7409                    		jz	short LOCAL_UNLOCK
 14658 00007145 50                      		push	ax
 14659 00007146 B80B11                  		mov	ax, 110Bh
 14660 00007149 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - UNLOCK REGION OF FILE
 14661                                  					; BX = file handle, CX:DX = starting offset, SI	= high word of size
 14662                                  					; STACK: WORD low word of size,	ES:DI -> SFT for file
 14663                                  					; SFT DPB field	-> DPB of drive	containing file
 14664                                  					; Return: CF set error
 14665 0000714B 5B                      		pop	bx
 14666 0000714C EB05                    		jmp	short ValChk
 14667                                  LOCAL_UNLOCK:
 14668 0000714E 36FF1E[7800]            		call	far [ss:clr_block]
 14669                                  ValChk:
 14670 00007153 7302                    		jnb	short Lock_OK
 14671 00007155 EBDF                    		jmp	short LockOper_Err_J2
 14672                                  Lock_OK:
 14673 00007157 E90CA5                  		jmp	SYS_RET_OK
 14674                                  ; ---------------------------------------------------------------------------
 14675                                  
 14676                                  		; 07/09/2022
 14677                                  DOS_Lock:
 14678 0000715A 26F745050080            		test	word [es:di+5], 8000h
 14679 00007160 7409                    		jz	short LOCAL_LOCK
 14680 00007162 50                      		push	ax
 14681 00007163 B80A11                  		mov	ax, 110Ah
 14682 00007166 CD2F                    		int	2Fh		; Multiplex - NETWORK REDIRECTOR - LOCK	REGION OF FILE
 14683                                  					; BX = file handle, CX:DX = starting offset, SI	= high word of size
 14684                                  					; STACK: WORD low word of size,	ES:DI -> SFT
 14685                                  					; SFT DPB field	-> DPB of drive	containing file, SS = DOS CS
 14686                                  					; Return: CF set error
 14687 00007168 5B                      		pop	bx
 14688 00007169 EBE8                    		jmp	short ValChk
 14689                                  LOCAL_LOCK:
 14690 0000716B 36FF1E[7400]            		call	far [ss:set_block]
 14691 00007170 EBE1                    		jmp	short ValChk
 14692                                  
 14693                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14694                                  
 14695                                  		; 07/09/2022
 14696                                  LOCK_CHECK:
 14697 00007172 8B1E[1A00]              		mov	bx, [RetryCount]
 14698                                  LockRetry:
 14699 00007176 53                      		push	bx
 14700 00007177 FF1E[7C00]              		call	far [chk_block]
 14701 0000717B 5B                      		pop	bx
 14702 0000717C 7201                    		jb	short LockN
 14703 0000717E C3                      		retn
 14704                                  LockN:
 14705 0000717F E8CFAC                  		call	Idle
 14706 00007182 4B                      		dec	bx
 14707 00007183 75F1                    		jnz	short LockRetry
 14708 00007185 F9                      		stc
 14709                                  retlabel:
 14710 00007186 C3                      		retn
 14711                                  
 14712                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14713                                  
 14714                                  		; 07/09/2022
 14715                                  LOCK_VIOLATION:
 14716 00007187 1E                      		push	ds
 14717 00007188 06                      		push	es
 14718 00007189 57                      		push	di
 14719 0000718A 51                      		push	cx
 14720 0000718B B82100                  		mov	ax, 21h
 14721 0000718E C606[F702]18            		mov	byte [ALLOWED], 18h
 14722 00007193 C42E[2405]              		les	bp, [THISDPB]
 14723 00007197 BF0100                  		mov	di, 1
 14724 0000719A 89F9                    		mov	cx, di
 14725 0000719C 268B560B                		mov	dx, [es:bp+11]
 14726 000071A0 E8ABE5                  		call	HARDERR
 14727 000071A3 59                      		pop	cx
 14728 000071A4 5F                      		pop	di
 14729 000071A5 07                      		pop	es
 14730 000071A6 1F                      		pop	ds
 14731 000071A7 3C01                    		cmp	al, 1
 14732 000071A9 74DB                    		jz	short retlabel
 14733 000071AB F9                      		stc
 14734 000071AC C3                      		retn
 14735                                  
 14736                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14737                                  
 14738                                  		; 07/09/2022
 14739                                  CheckShare:
 14740 000071AD 2E803E[B102]00          		cmp	byte [cs:fShare], 0
 14741 000071B3 C3                      		retn
 14742                                  
 14743                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14744                                  
 14745                                  		; 07/09/2022
 14746                                  SHARE_CHECK:
 14747 000071B4 FF1E[6000]              		call	far [MFT_enter]
 14748                                  shchk_retn:
 14749 000071B8 C3                      		retn
 14750                                  
 14751                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14752                                  
 14753                                  		; 07/09/2022
 14754                                  SHARE_VIOLATION:
 14755 000071B9 1E                      		push	ds
 14756 000071BA 06                      		push	es
 14757 000071BB 57                      		push	di
 14758 000071BC C606[1005]00            		mov	byte [SECCLUSPOS+2], 0
 14759 000071C1 C606[F702]18            		mov	byte [ALLOWED], 18h
 14760 000071C6 C42E[2405]              		les	bp, [THISDPB]
 14761 000071CA BF0100                  		mov	di, 1
 14762 000071CD 89F9                    		mov	cx, di
 14763 000071CF 268B5610                		mov	dx, [es:bp+10h]
 14764 000071D3 E878E5                  		call	HARDERR
 14765 000071D6 5F                      		pop	di
 14766 000071D7 07                      		pop	es
 14767 000071D8 1F                      		pop	ds
 14768 000071D9 3C01                    		cmp	al, 1
 14769 000071DB 74DB                    		jz	short shchk_retn
 14770 000071DD F9                      		stc
 14771 000071DE C3                      		retn
 14772                                  
 14773                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14774                                  
 14775                                  		; 07/09/2022
 14776                                  ShareEnd:
 14777 000071DF FF1E[6400]              		call	far [MFTClose]
 14778 000071E3 C3                      		retn
 14779                                  
 14780                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14781                                  
 14782                                  		; 07/09/2022
 14783                                  ShareEnter:
 14784 000071E4 51                      		push	cx
 14785                                  retry:
 14786 000071E5 8B0E[1A00]              		mov	cx, [RetryCount]
 14787                                  attempt:
 14788 000071E9 C43E[3605]              		les	di, [THISSFT]
 14789 000071ED 31C0                    		xor	ax, ax
 14790 000071EF 26894533                		mov	[es:di+51], ax
 14791 000071F3 51                      		push	cx
 14792 000071F4 E8BDFF                  		call	SHARE_CHECK
 14793 000071F7 59                      		pop	cx
 14794 000071F8 730A                    		jnb	short done
 14795 000071FA E854AC                  		call	Idle
 14796 000071FD E2EA                    		loop	attempt
 14797 000071FF E8B7FF                  		call	SHARE_VIOLATION
 14798 00007202 73E1                    		jnb	short retry
 14799                                  done:
 14800 00007204 59                      		pop	cx
 14801 00007205 C3                      		retn
 14802                                  
 14803                                  ; ---------------------------------------------------------------------------
 14804                                  		;times 9 db 0
 14805                                  ; 15/09/2022
 14806 00007206 90<rep Ah>              align 16
 14807                                  
 14808                                  ; ---------------------------------------------------------------------------
 14809                                  	
 14810                                  		; 15/09/2022
 14811                                  SYSBUF:	
 14812                                  		; 07/09/2022
 14813                                  IRETT:
 14814 00007210 CF                      		iret
 14815                                  
 14816                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 14817                                  
 14818                                  		; 07/09/2022
 14819                                  DOSINIT:
 14820 00007211 FA                      		cli
 14821 00007212 FC                      		cld
 14822 00007213 2E8916[F202]            		mov	[cs:ENDMEM], dx
 14823 00007218 2E8926[6804]            		mov	[cs:INITSP], sp
 14824 0000721D 2E8C16[6A04]            		mov	[cs:INITSS], ss
 14825 00007222 8CC8                    		mov	ax, cs
 14826 00007224 8ED0                    		mov	ss, ax
 14827 00007226 BC[2475]                		mov	sp, INITSTACK
 14828 00007229 368C1E[4A00]            		mov	word [ss:NULDEV+2], ds
 14829 0000722E 368936[4800]            		mov	word [ss:NULDEV], si
 14830 00007233 1E                      		push	ds
 14831 00007234 31C0                    		xor	ax, ax
 14832 00007236 8ED8                    		mov	ds, ax
 14833 00007238 B8[1072]                		mov	ax, IRETT
 14834 0000723B A3A800                  		mov	[2Ah*4], ax
 14835 0000723E 8CC8                    		mov	ax, cs
 14836 00007240 A3AA00                  		mov	[(2Ah*4)+2], ax
 14837 00007243 1F                      		pop	ds
 14838 00007244 E83502                  		call	CHARINIT
 14839 00007247 56                      		push	si
 14840 00007248 0E                      		push	cs
 14841 00007249 07                      		pop	es
 14842 0000724A BF[9E00]                		mov	di, SFTABL_SFT_SFTable
 14843 0000724D B80300                  		mov	ax, 3
 14844 00007250 AB                      		stosw
 14845 00007251 FEC8                    		dec	al
 14846 00007253 AB                      		stosw
 14847 00007254 30C0                    		xor	al, al
 14848 00007256 AA                      		stosb
 14849 00007257 B0C3                    		mov	al, 0C3h
 14850 00007259 AB                      		stosw
 14851 0000725A 89F0                    		mov	ax, si
 14852 0000725C AB                      		stosw
 14853 0000725D 8CD8                    		mov	ax, ds
 14854 0000725F AB                      		stosw
 14855 00007260 31C0                    		xor	ax, ax
 14856 00007262 AB                      		stosw
 14857 00007263 AB                      		stosw
 14858 00007264 AB                      		stosw
 14859 00007265 48                      		dec	ax
 14860 00007266 AB                      		stosw
 14861 00007267 AB                      		stosw
 14862 00007268 40                      		inc	ax
 14863 00007269 AB                      		stosw
 14864 0000726A AB                      		stosw
 14865 0000726B 83C707                  		add	di, 7
 14866 0000726E 83C60A                  		add	si, 10
 14867 00007271 B90400                  		mov	cx, 4
 14868 00007274 F3A5                    		rep movsw
 14869 00007276 B103                    		mov	cl, 3
 14870 00007278 B020                    		mov	al, ' '
 14871 0000727A F3AA                    		rep stosb
 14872 0000727C 5E                      		pop	si
 14873 0000727D 804C0403                		or	byte [si+4], 3
 14874 00007281 368936[3200]            		mov	word [ss:BCON], si
 14875 00007286 368C1E[3400]            		mov	word [ss:BCON+2], ds
 14876                                  CHAR_INIT_LOOP:
 14877 0000728B C534                    		lds	si, [si]
 14878 0000728D E8EC01                  		call	CHARINIT
 14879 00007290 F6440408                		test	byte [si+4], 8
 14880 00007294 74F5                    		jz	short CHAR_INIT_LOOP
 14881 00007296 368936[2E00]            		mov	word [ss:BCLOCK], si
 14882 0000729B 368C1E[3000]            		mov	word [ss:BCLOCK+2], ds
 14883 000072A0 BD[2675]                		mov	bp, MEMSTRT
 14884                                  PERDRV:
 14885 000072A3 C534                    		lds	si, [si]
 14886 000072A5 83FEFF                  		cmp	si, -1
 14887 000072A8 7468                    		jz	short CONTINIT
 14888 000072AA E8CF01                  		call	CHARINIT
 14889 000072AD F744040080              		test	word [si+4], 8000h
 14890 000072B2 75EF                    		jnz	short PERDRV
 14891 000072B4 368A0E[1303]            		mov	cl, [ss:CALLMED]
 14892 000072B9 30ED                    		xor	ch, ch
 14893 000072BB 884C0A                  		mov	[si+10], cl
 14894 000072BE 368A16[4600]            		mov	dl, [ss:NUMIO]
 14895 000072C3 30F6                    		xor	dh, dh
 14896 000072C5 36000E[4600]            		add	[ss:NUMIO], cl
 14897 000072CA 1E                      		push	ds
 14898 000072CB 56                      		push	si
 14899 000072CC 36C51E[1803]            		lds	bx, [ss:CALLSCNT]
 14900                                  PERUNIT:
 14901 000072D1 8B37                    		mov	si, [bx]
 14902 000072D3 43                      		inc	bx
 14903 000072D4 43                      		inc	bx
 14904 000072D5 26885600                		mov	[es:bp+0], dl
 14905 000072D9 26887601                		mov	[es:bp+1], dh
 14906 000072DD 53                      		push	bx
 14907 000072DE 51                      		push	cx
 14908 000072DF 52                      		push	dx
 14909 000072E0 E8A7A9                  		call	_$SETDPB
 14910 000072E3 268B4602                		mov	ax, [es:bp+2]
 14911 000072E7 363B06[3600]            		cmp	ax, [ss:MAXSEC]
 14912 000072EC 7604                    		jbe	short NOTMAX
 14913 000072EE 36A3[3600]              		mov	[ss:MAXSEC], ax
 14914                                  NOTMAX:
 14915 000072F2 5A                      		pop	dx
 14916 000072F3 59                      		pop	cx
 14917 000072F4 5B                      		pop	bx
 14918 000072F5 8CD8                    		mov	ax, ds
 14919 000072F7 5E                      		pop	si
 14920 000072F8 1F                      		pop	ds
 14921 000072F9 26897612                		mov	[es:bp+18], si
 14922 000072FD 268C5E14                		mov	word [es:bp+20], ds
 14923 00007301 1E                      		push	ds
 14924 00007302 56                      		push	si
 14925 00007303 FEC6                    		inc	dh
 14926 00007305 FEC2                    		inc	dl
 14927 00007307 8ED8                    		mov	ds, ax
 14928 00007309 83C520                  		add	bp, 32
 14929 0000730C E2C3                    		loop	PERUNIT
 14930 0000730E 5E                      		pop	si
 14931 0000730F 1F                      		pop	ds
 14932 00007310 EB91                    		jmp	short PERDRV
 14933                                  
 14934                                  ; ---------------------------------------------------------------------------
 14935                                  
 14936                                  		; 15/09/2022
 14937                                  		; 07/09/2022
 14938                                  CONTINIT:
 14939 00007312 0E                      		push	cs
 14940 00007313 1F                      		pop	ds
 14941 00007314 89EF                    		mov	di, bp
 14942 00007316 8B2E[3600]              		mov	bp, [MAXSEC]
 14943                                  		;mov	ax, IRETT
 14944                                  		; 15/09/2022
 14945 0000731A B8[1072]                		mov	ax, SYSBUF
 14946 0000731D 01E8                    		add	ax, bp
 14947 0000731F 83C010                  		add	ax, 16
 14948 00007322 A3[2600]                		mov	word [DPBHEAD], ax
 14949 00007325 89C2                    		mov	dx, ax
 14950                                  		;sub	dx, IRETT ; SYSBUF
 14951                                  		; 15/09/2022
 14952 00007327 81EA[1072]              		sub	dx, SYSBUF
 14953 0000732B 89D5                    		mov	bp, dx
 14954 0000732D 01FD                    		add	bp, di
 14955                                  		;sub	bp, 918	; ADJFAC
 14956                                  		; 15/09/2022
 14957 0000732F 81ED1603                		sub	bp, ADJFAC
 14958 00007333 55                      		push	bp
 14959 00007334 BF[2675]                		mov	di, MEMSTRT
 14960 00007337 83C718                  		add	di, 24
 14961 0000733A 8A0E[4600]              		mov	cl, [NUMIO]
 14962 0000733E 30ED                    		xor	ch, ch
 14963                                  TRUEDPBAD:
 14964 00007340 83C020                  		add	ax, 32
 14965 00007343 AB                      		stosw
 14966 00007344 83C71E                  		add	di, 30
 14967 00007347 E2F7                    		loop	TRUEDPBAD
 14968 00007349 83EF20                  		sub	di, 32
 14969 0000734C B8FFFF                  		mov	ax, -1
 14970 0000734F AB                      		stosw
 14971 00007350 83C50F                  		add	bp, 15
 14972 00007353 D1DD                    		rcr	bp, 1
 14973 00007355 B103                    		mov	cl, 3
 14974 00007357 D3ED                    		shr	bp, cl
 14975 00007359 8CCA                    		mov	dx, cs
 14976 0000735B 01EA                    		add	dx, bp
 14977 0000735D BB0F00                  		mov	bx, 15
 14978 00007360 8B0E[F202]              		mov	cx, [ENDMEM]
 14979 00007364 8CCD                    		mov	bp, cs
 14980 00007366 890E[F202]              		mov	[ENDMEM], cx
 14981 0000736A 8EC5                    		mov	es, bp
 14982 0000736C 268C06[4A03]            		mov	[es:DSKCHRET+3], es
 14983 00007371 31C0                    		xor	ax, ax
 14984 00007373 8ED8                    		mov	ds, ax
 14985 00007375 8EC0                    		mov	es, ax
 14986 00007377 BF8200                  		mov	di, 82h
 14987 0000737A 89E8                    		mov	ax, bp
 14988 0000737C C706[0000][E756]        		mov	word [START], DIVOV
 14989 00007382 A3[0200]                		mov	word [START+2], ax
 14990 00007385 B91100                  		mov	cx, 17
 14991 00007388 F3AB                    		rep stosw
 14992 0000738A 83C706                  		add	di, 6
 14993 0000738D B92B00                  		mov	cx, 43
 14994 00007390 F3AB                    		rep stosw
 14995 00007392 BF8000                  		mov	di, 80h
 14996 00007395 B8[4514]                		mov	ax, _IRET
 14997 00007398 B90900                  		mov	cx, 9
 14998                                  iset1:
 14999 0000739B AB                      		stosw
 15000 0000739C 83C702                  		add	di, 2
 15001 0000739F E2FA                    		loop	iset1
 15002 000073A1 83C704                  		add	di, 4
 15003 000073A4 B91600                  		mov	cx, 22
 15004                                  iset2:
 15005 000073A7 AB                      		stosw
 15006 000073A8 83C702                  		add	di, 2
 15007 000073AB E2FA                    		loop	iset2
 15008 000073AD 89E8                    		mov	ax, bp
 15009 000073AF C706BC00[2E17]          		mov	word [2Fh*4], INT2F
 15010 000073B5 C606C000EA              		mov	byte [ENTRYPOINT], 0EAh
 15011 000073BA C706C100[4614]          		mov	word [ENTRYPOINT+1], CALL_ENTRY
 15012 000073C0 A3C300                  		mov	[ENTRYPOINT+3], ax
 15013 000073C3 C706[8000][3F14]        		mov	word [MFT_get], QUIT
 15014 000073C9 C706[8400][6014]        		mov	word [ShSave], COMMAND
 15015 000073CF C706[8800]0001          		mov	word [ShChk], 100h
 15016 000073D5 8916[8A00]              		mov	word [ShChk+2], dx
 15017 000073D9 C706[9400][DC15]        		mov	word [ShSU], ABSDRD
 15018 000073DF C706[9800][1F16]        		mov	word [SFTABL], ABSDWRT
 15019 000073E5 C706[9C00][6563]        		mov	word [SFTABL_SFT_SFCOUNT], STAY_RESIDENT
 15020 000073EB 0E                      		push	cs
 15021 000073EC 1F                      		pop	ds
 15022 000073ED 0E                      		push	cs
 15023 000073EE 07                      		pop	es
 15024 000073EF BF[5C00]                		mov	di, JShare
 15025 000073F2 8CC8                    		mov	ax, cs
 15026 000073F4 B90F00                  		mov	cx, 15
 15027                                  iset3:
 15028 000073F7 83C702                  		add	di, 2
 15029 000073FA AB                      		stosw
 15030 000073FB E2FA                    		loop	iset3
 15031 000073FD B8[5803]                		mov	ax, TIMEBUF
 15032 00007400 83C00F                  		add	ax, 0Fh
 15033 00007403 B104                    		mov	cl, 4
 15034 00007405 D3E8                    		shr	ax, cl
 15035 00007407 8CDF                    		mov	di, ds
 15036 00007409 01C7                    		add	di, ax
 15037 0000740B 47                      		inc	di
 15038 0000740C 893E[DE02]              		mov	[CurrentPDB], di
 15039 00007410 55                      		push	bp
 15040 00007411 52                      		push	dx
 15041 00007412 A1[F202]                		mov	ax, [ENDMEM]
 15042 00007415 89FA                    		mov	dx, di
 15043 00007417 E864A9                  		call	setmem
 15044 0000741A 0E                      		push	cs
 15045 0000741B 1F                      		pop	ds
 15046 0000741C BF1800                  		mov	di, 24
 15047 0000741F 31C0                    		xor	ax, ax
 15048 00007421 AB                      		stosw
 15049 00007422 AA                      		stosb
 15050 00007423 B0FF                    		mov	al, 0FFh
 15051 00007425 B91100                  		mov	cx, 17
 15052 00007428 F3AA                    		rep stosb
 15053 0000742A 0E                      		push	cs
 15054 0000742B 07                      		pop	es
 15055 0000742C 8C1E[2C00]              		mov	word [SFT_ADDR+2], ds
 15056 00007430 BE[B10F]                		mov	si, COUNTRY_CDPG
 15057 00007433 268C444F                		mov	word [es:si+79], es
 15058 00007437 268C4454                		mov	word [es:si+84], es
 15059 0000743B 268C4459                		mov	word [es:si+89], es
 15060 0000743F 268C445E                		mov	word [es:si+94], es
 15061 00007443 268C447B                		mov	word [es:si+123], es
 15062 00007447 BE[330F]                		mov	si, SysInitTable
 15063 0000744A 268C4406                		mov	word [es:si+6], es
 15064 0000744E 268C4402                		mov	word [es:si+2], es
 15065 00007452 BE[3B0F]                		mov	si, FastTable
 15066 00007455 268C4404                		mov	word [es:si+4], es
 15067 00007459 26C706[870F]7258        		mov	word [es:FETCHI_TAG], 5872h
 15068 00007460 5A                      		pop	dx
 15069 00007461 5D                      		pop	bp
 15070 00007462 59                      		pop	cx
 15071 00007463 BE[2675]                		mov	si, MEMSTRT
 15072 00007466 8B3E[2600]              		mov	di, word [DPBHEAD]
 15073 0000746A 29F9                    		sub	cx, di
 15074 0000746C 39F7                    		cmp	di, si
 15075 0000746E 7607                    		jbe	short MOVJMP
 15076 00007470 49                      		dec	cx
 15077 00007471 01CF                    		add	di, cx
 15078 00007473 01CE                    		add	si, cx
 15079 00007475 41                      		inc	cx
 15080 00007476 FD                      		std
 15081                                  MOVJMP:
 15082 00007477 8EC5                    		mov	es, bp
 15083 00007479 E9F08F                  		jmp	MOVDPB
 15084                                  
 15085                                  ; --------------- S U B	R O U T	I N E ---------------------------------------
 15086                                  
 15087                                  		; 07/09/2022
 15088                                  CHARINIT:
 15089 0000747C 36C606[0603]1A          		mov	byte [ss:DEVCALL], 26
 15090 00007482 36C606[0703]00          		mov	byte [ss:DEVCALL_REQUNIT], 0
 15091 00007488 36C606[0803]00          		mov	byte [ss:DEVCALL_REQFUNC], 0
 15092 0000748E 36C706[0903]0000        		mov	word [ss:DEVCALL_REQSTAT], 0
 15093 00007495 06                      		push	es
 15094 00007496 53                      		push	bx
 15095 00007497 50                      		push	ax
 15096 00007498 BB[0603]                		mov	bx, DEVCALL
 15097 0000749B 0E                      		push	cs
 15098 0000749C 07                      		pop	es
 15099 0000749D E862D9                  		call	DEVIOCALL2
 15100 000074A0 58                      		pop	ax
 15101 000074A1 5B                      		pop	bx
 15102 000074A2 07                      		pop	es
 15103 000074A3 C3                      		retn
 15104                                  
 15105                                  ; ---------------------------------------------------------------------------
 15106                                  
 15107                                  align 2 ; 14/09/2022
 15108                                  
 15109                                  		; 15/09/2022
 15110 000074A4 00<rep 80h>             		times 128 db 0	; ADJFAC = 790
 15111                                  		; 07/09/2022
 15112                                  		;times 256 db 0 ; ADJFAC = 918
 15113                                  
 15114 00007524 0000                    INITSTACK:	dw 0
 15115                                  ;MEMSTRT:	times 10 db 0
 15116                                  ; 15/09/2022
 15117                                  MEMSTRT		equ $
 15118                                  ADJFAC		equ MEMSTRT-SYSBUF
 15119                                  
 15120                                  		; 15/09/2022
 15121                                  		;times 10 db 0
 15122                                  ; 15/09/2022
 15123                                  RETRODOSMSG:
 15124 00007526 0D0A                    	db	13,10
 15125 00007528 526574726F20444F53-     	db	"Retro DOS v3.30 (for Windows 3.1) by Erdogan Tan [2018-2022]"
 15125 00007531 2076332E3330202866-
 15125 0000753A 6F722057696E646F77-
 15125 00007543 7320332E3129206279-
 15125 0000754C 204572646F67616E20-
 15125 00007555 54616E205B32303138-
 15125 0000755E 2D323032325D       
 15126 00007564 0D0A2400                	db	13,10,"$", 0 
 15127                                  
 15128                                  ; 14/09/2022
 15129                                  ;PcDosVersion	db 1Ah,'@@@### PC-DOS Version 3.30',0Dh,0Ah
 15130                                  ;		db 1Ah,0
